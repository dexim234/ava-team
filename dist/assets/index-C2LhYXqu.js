import{r as D,a as A0,g as C0,R as nh,u as ah,b as D0,L as Kt,c as R0,N as mi,B as P0,d as M0,e as ir}from"./react-vendor-Dou2_yf_.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))n(a);new MutationObserver(a=>{for(const i of a)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function t(a){const i={};return a.integrity&&(i.integrity=a.integrity),a.referrerPolicy&&(i.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?i.credentials="include":a.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(a){if(a.ep)return;a.ep=!0;const i=t(a);fetch(a.href,i)}})();var ih={exports:{}},Vi={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var $0=D,O0=Symbol.for("react.element"),V0=Symbol.for("react.fragment"),L0=Object.prototype.hasOwnProperty,F0=$0.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,U0={key:!0,ref:!0,__self:!0,__source:!0};function oh(r,e,t){var n,a={},i=null,o=null;t!==void 0&&(i=""+t),e.key!==void 0&&(i=""+e.key),e.ref!==void 0&&(o=e.ref);for(n in e)L0.call(e,n)&&!U0.hasOwnProperty(n)&&(a[n]=e[n]);if(r&&r.defaultProps)for(n in e=r.defaultProps,e)a[n]===void 0&&(a[n]=e[n]);return{$$typeof:O0,type:r,key:i,ref:o,props:a,_owner:F0.current}}Vi.Fragment=V0;Vi.jsx=oh;Vi.jsxs=oh;ih.exports=Vi;var s=ih.exports,Ho={},cd=A0;Ho.createRoot=cd.createRoot,Ho.hydrateRoot=cd.hydrateRoot;const B0={},dd=r=>{let e;const t=new Set,n=(g,f)=>{const p=typeof g=="function"?g(e):g;if(!Object.is(p,e)){const v=e;e=f??(typeof p!="object"||p===null)?p:Object.assign({},e,p),t.forEach(A=>A(e,v))}},a=()=>e,d={setState:n,getState:a,getInitialState:()=>h,subscribe:g=>(t.add(g),()=>t.delete(g)),destroy:()=>{(B0?"production":void 0)!=="production"&&console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),t.clear()}},h=e=r(n,a,d);return d},W0=r=>r?dd(r):dd;var lh={exports:{}},ch={},dh={exports:{}},uh={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var on=D;function q0(r,e){return r===e&&(r!==0||1/r===1/e)||r!==r&&e!==e}var z0=typeof Object.is=="function"?Object.is:q0,H0=on.useState,G0=on.useEffect,K0=on.useLayoutEffect,Y0=on.useDebugValue;function Q0(r,e){var t=e(),n=H0({inst:{value:t,getSnapshot:e}}),a=n[0].inst,i=n[1];return K0(function(){a.value=t,a.getSnapshot=e,Eo(a)&&i({inst:a})},[r,t,e]),G0(function(){return Eo(a)&&i({inst:a}),r(function(){Eo(a)&&i({inst:a})})},[r]),Y0(t),t}function Eo(r){var e=r.getSnapshot;r=r.value;try{var t=e();return!z0(r,t)}catch{return!0}}function X0(r,e){return e()}var J0=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?X0:Q0;uh.useSyncExternalStore=on.useSyncExternalStore!==void 0?on.useSyncExternalStore:J0;dh.exports=uh;var Z0=dh.exports;/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Li=D,ep=Z0;function tp(r,e){return r===e&&(r!==0||1/r===1/e)||r!==r&&e!==e}var rp=typeof Object.is=="function"?Object.is:tp,sp=ep.useSyncExternalStore,np=Li.useRef,ap=Li.useEffect,ip=Li.useMemo,op=Li.useDebugValue;ch.useSyncExternalStoreWithSelector=function(r,e,t,n,a){var i=np(null);if(i.current===null){var o={hasValue:!1,value:null};i.current=o}else o=i.current;i=ip(function(){function d(v){if(!h){if(h=!0,g=v,v=n(v),a!==void 0&&o.hasValue){var A=o.value;if(a(A,v))return f=A}return f=v}if(A=f,rp(g,v))return A;var T=n(v);return a!==void 0&&a(A,T)?(g=v,A):(g=v,f=T)}var h=!1,g,f,p=t===void 0?null:t;return[function(){return d(e())},p===null?void 0:function(){return d(p())}]},[e,t,n,a]);var c=sp(r,i[0],i[1]);return ap(function(){o.hasValue=!0,o.value=c},[c]),op(c),c};lh.exports=ch;var lp=lh.exports;const cp=C0(lp),hh={},{useDebugValue:dp}=nh,{useSyncExternalStoreWithSelector:up}=cp;let ud=!1;const hp=r=>r;function mp(r,e=hp,t){(hh?"production":void 0)!=="production"&&t&&!ud&&(console.warn("[DEPRECATED] Use `createWithEqualityFn` instead of `create` or use `useStoreWithEqualityFn` instead of `useStore`. They can be imported from 'zustand/traditional'. https://github.com/pmndrs/zustand/discussions/1937"),ud=!0);const n=up(r.subscribe,r.getState,r.getServerState||r.getInitialState,e,t);return dp(n),n}const gp=r=>{(hh?"production":void 0)!=="production"&&typeof r!="function"&&console.warn("[DEPRECATED] Passing a vanilla store will be unsupported in a future version. Instead use `import { useStore } from 'zustand'`.");const e=typeof r=="function"?W0(r):r,t=(n,a)=>mp(e,n,a);return Object.assign(t,e),t},bl=r=>gp,pp={};function fp(r,e){let t;try{t=r()}catch{return}return{getItem:a=>{var i;const o=d=>d===null?null:JSON.parse(d,void 0),c=(i=t.getItem(a))!=null?i:null;return c instanceof Promise?c.then(o):o(c)},setItem:(a,i)=>t.setItem(a,JSON.stringify(i,void 0)),removeItem:a=>t.removeItem(a)}}const Zn=r=>e=>{try{const t=r(e);return t instanceof Promise?t:{then(n){return Zn(n)(t)},catch(n){return this}}}catch(t){return{then(n){return this},catch(n){return Zn(n)(t)}}}},xp=(r,e)=>(t,n,a)=>{let i={getStorage:()=>localStorage,serialize:JSON.stringify,deserialize:JSON.parse,partialize:S=>S,version:0,merge:(S,z)=>({...z,...S}),...e},o=!1;const c=new Set,d=new Set;let h;try{h=i.getStorage()}catch{}if(!h)return r((...S)=>{console.warn(`[zustand persist middleware] Unable to update item '${i.name}', the given storage is currently unavailable.`),t(...S)},n,a);const g=Zn(i.serialize),f=()=>{const S=i.partialize({...n()});let z;const L=g({state:S,version:i.version}).then(C=>h.setItem(i.name,C)).catch(C=>{z=C});if(z)throw z;return L},p=a.setState;a.setState=(S,z)=>{p(S,z),f()};const v=r((...S)=>{t(...S),f()},n,a);let A;const T=()=>{var S;if(!h)return;o=!1,c.forEach(L=>L(n()));const z=((S=i.onRehydrateStorage)==null?void 0:S.call(i,n()))||void 0;return Zn(h.getItem.bind(h))(i.name).then(L=>{if(L)return i.deserialize(L)}).then(L=>{if(L)if(typeof L.version=="number"&&L.version!==i.version){if(i.migrate)return i.migrate(L.state,L.version);console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return L.state}).then(L=>{var C;return A=i.merge(L,(C=n())!=null?C:v),t(A,!0),f()}).then(()=>{z==null||z(A,void 0),o=!0,d.forEach(L=>L(A))}).catch(L=>{z==null||z(void 0,L)})};return a.persist={setOptions:S=>{i={...i,...S},S.getStorage&&(h=S.getStorage())},clearStorage:()=>{h==null||h.removeItem(i.name)},getOptions:()=>i,rehydrate:()=>T(),hasHydrated:()=>o,onHydrate:S=>(c.add(S),()=>{c.delete(S)}),onFinishHydration:S=>(d.add(S),()=>{d.delete(S)})},T(),A||v},yp=(r,e)=>(t,n,a)=>{let i={storage:fp(()=>localStorage),partialize:T=>T,version:0,merge:(T,S)=>({...S,...T}),...e},o=!1;const c=new Set,d=new Set;let h=i.storage;if(!h)return r((...T)=>{console.warn(`[zustand persist middleware] Unable to update item '${i.name}', the given storage is currently unavailable.`),t(...T)},n,a);const g=()=>{const T=i.partialize({...n()});return h.setItem(i.name,{state:T,version:i.version})},f=a.setState;a.setState=(T,S)=>{f(T,S),g()};const p=r((...T)=>{t(...T),g()},n,a);a.getInitialState=()=>p;let v;const A=()=>{var T,S;if(!h)return;o=!1,c.forEach(L=>{var C;return L((C=n())!=null?C:p)});const z=((S=i.onRehydrateStorage)==null?void 0:S.call(i,(T=n())!=null?T:p))||void 0;return Zn(h.getItem.bind(h))(i.name).then(L=>{if(L)if(typeof L.version=="number"&&L.version!==i.version){if(i.migrate)return[!0,i.migrate(L.state,L.version)];console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return[!1,L.state];return[!1,void 0]}).then(L=>{var C;const[j,H]=L;if(v=i.merge(H,(C=n())!=null?C:p),t(v,!0),j)return g()}).then(()=>{z==null||z(v,void 0),v=n(),o=!0,d.forEach(L=>L(v))}).catch(L=>{z==null||z(void 0,L)})};return a.persist={setOptions:T=>{i={...i,...T},T.storage&&(h=T.storage)},clearStorage:()=>{h==null||h.removeItem(i.name)},getOptions:()=>i,rehydrate:()=>A(),hasHydrated:()=>o,onHydrate:T=>(c.add(T),()=>{c.delete(T)}),onFinishHydration:T=>(d.add(T),()=>{d.delete(T)})},i.skipHydration||A(),v||p},bp=(r,e)=>"getStorage"in e||"serialize"in e||"deserialize"in e?((pp?"production":void 0)!=="production"&&console.warn("[DEPRECATED] `getStorage`, `serialize` and `deserialize` options are deprecated. Use `storage` option instead."),xp(r,e)):yp(r,e),vl=bp,Ts={memecoins:{label:"Мемкоины",accent:"emerald",icon:"rocket"},futures:{label:"Фьючерсы",accent:"blue",icon:"line"},nft:{label:"NFT",accent:"purple",icon:"image"},spot:{label:"Спот",accent:"amber",icon:"coins"},polymarket:{label:"PolyMarket",accent:"pink",icon:"barchart"},staking:{label:"Стейкинг",accent:"indigo",icon:"shield"},other:{label:"Другое",accent:"gray",icon:"sparkles"}},Se=[{id:"1",name:"Артём",login:"artyom03",password:"248artdex",avatar:"/avatars/artyom.jpg"},{id:"2",name:"Enowk",login:"adel05",password:"058adeldex",avatar:"/avatars/adel.jpg"},{id:"3",name:"Ксения",login:"ksen03",password:"907ksendex",avatar:"/avatars/kseniya.jpg"},{id:"4",name:"Ольга",login:"olga04",password:"638olgadex",avatar:"/avatars/olga.jpg"},{id:"5",name:"Анастасия",login:"anastasia05",password:"638anastadex",avatar:"/avatars/anastasia.jpg"}],ea={trading:{label:"Торговля",icon:"candles",color:"green"},learning:{label:"Обучение",icon:"book",color:"blue"},technical:{label:"ТЧ",icon:"cpu",color:"purple"},stream:{label:"Стрим",icon:"broadcast",color:"red"},research:{label:"Изучение",icon:"flask",color:"yellow"},organization:{label:"Ресёрч",icon:"clipboard",color:"indigo"}},Ss={in_progress:{label:"В работе",color:"blue"},completed:{label:"Выполнено",color:"green"},closed:{label:"Закрыто",color:"gray"}},jt=bl()(vl(r=>({user:null,isAuthenticated:!1,login:(e,t)=>{const n=Se.find(a=>a.login===e&&a.password===t);return n?(r({user:n,isAuthenticated:!0}),!0):!1},logout:()=>r({user:null,isAuthenticated:!1})}),{name:"apevault-auth"})),mh="9119ApeVault",At=bl()(vl(r=>({isAdmin:!1,activateAdmin:e=>e===mh?(r({isAdmin:!0}),!0):!1,deactivateAdmin:()=>r({isAdmin:!1})}),{name:"apevault-admin"})),it=bl()(vl(r=>({theme:"light",toggleTheme:()=>r(e=>{const t=e.theme==="light"?"dark":"light";return document.body.classList.toggle("dark",t==="dark"),{theme:t}}),setTheme:e=>r(()=>(document.body.classList.toggle("dark",e==="dark"),{theme:e}))}),{name:"apevault-theme"}));/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var vp={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wp=r=>r.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().trim(),he=(r,e)=>{const t=D.forwardRef(({color:n="currentColor",size:a=24,strokeWidth:i=2,absoluteStrokeWidth:o,className:c="",children:d,...h},g)=>D.createElement("svg",{ref:g,...vp,width:a,height:a,stroke:n,strokeWidth:o?Number(i)*24/Number(a):i,className:["lucide",`lucide-${wp(r)}`,c].join(" "),...h},[...e.map(([f,p])=>D.createElement(f,p)),...Array.isArray(d)?d:[d]]));return t.displayName=`${r}`,t};/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gh=he("Activity",[["path",{d:"M22 12h-4l-3 9L9 3l-3 9H2",key:"d5dnw9"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ph=he("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pr=he("AlertTriangle",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z",key:"c3ski4"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kp=he("Archive",[["rect",{width:"20",height:"5",x:"2",y:"3",rx:"1",key:"1wp1u1"}],["path",{d:"M4 8v11a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8",key:"1s80jp"}],["path",{d:"M10 12h4",key:"a56b0p"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _p=he("ArrowDownRight",[["path",{d:"m7 7 10 10",key:"1fmybs"}],["path",{d:"M17 7v10H7",key:"6fjiku"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Et=he("ArrowUpRight",[["path",{d:"M7 7h10v10",key:"1tivn9"}],["path",{d:"M7 17 17 7",key:"1vkiza"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wl=he("BarChart3",[["path",{d:"M3 3v18h18",key:"1s2lah"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Np=he("Bell",[["path",{d:"M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9",key:"1qo2s2"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ta=he("BookOpen",[["path",{d:"M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z",key:"vv98re"}],["path",{d:"M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z",key:"1cyq3y"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hd=he("Building2",[["path",{d:"M6 22V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v18Z",key:"1b4qmf"}],["path",{d:"M6 12H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h2",key:"i71pzd"}],["path",{d:"M18 9h2a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2h-2",key:"10jefs"}],["path",{d:"M10 6h4",key:"1itunk"}],["path",{d:"M10 10h4",key:"tcdvrf"}],["path",{d:"M10 14h4",key:"kelpxr"}],["path",{d:"M10 18h4",key:"1ulq68"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Io=he("CalendarCheck",[["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",ry:"2",key:"eu3xkr"}],["line",{x1:"16",x2:"16",y1:"2",y2:"6",key:"m3sa8f"}],["line",{x1:"8",x2:"8",y1:"2",y2:"6",key:"18kwsl"}],["line",{x1:"3",x2:"21",y1:"10",y2:"10",key:"xt86sb"}],["path",{d:"m9 16 2 2 4-4",key:"19s6y9"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Go=he("CalendarClock",[["path",{d:"M21 7.5V6a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h3.5",key:"1osxxc"}],["path",{d:"M16 2v4",key:"4m81vk"}],["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M3 10h5",key:"r794hk"}],["path",{d:"M17.5 17.5 16 16.25V14",key:"re2vv1"}],["path",{d:"M22 16a6 6 0 1 1-12 0 6 6 0 0 1 12 0Z",key:"ame013"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gs=he("Calendar",[["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",ry:"2",key:"eu3xkr"}],["line",{x1:"16",x2:"16",y1:"2",y2:"6",key:"m3sa8f"}],["line",{x1:"8",x2:"8",y1:"2",y2:"6",key:"18kwsl"}],["line",{x1:"3",x2:"21",y1:"10",y2:"10",key:"xt86sb"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jp=he("CandlestickChart",[["path",{d:"M9 5v4",key:"14uxtq"}],["rect",{width:"4",height:"6",x:"7",y:"9",rx:"1",key:"f4fvz0"}],["path",{d:"M9 15v2",key:"r5rk32"}],["path",{d:"M17 3v2",key:"1l2re6"}],["rect",{width:"4",height:"8",x:"15",y:"5",rx:"1",key:"z38je5"}],["path",{d:"M17 13v3",key:"5l0wba"}],["path",{d:"M3 3v18h18",key:"1s2lah"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ds=he("CheckCircle2",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fr=he("CheckSquare",[["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}],["path",{d:"M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11",key:"1jnkn4"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Rs=he("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const md=he("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ep=he("CircleDot",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gd=he("ClipboardCheck",[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}],["path",{d:"m9 14 2 2 4-4",key:"df797q"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ip=he("ClipboardList",[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}],["path",{d:"M12 11h4",key:"1jrz19"}],["path",{d:"M12 16h4",key:"n85exb"}],["path",{d:"M8 11h.01",key:"1dfujw"}],["path",{d:"M8 16h.01",key:"18s6g9"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Hn=he("Clock3",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16.5 12",key:"1aq6pp"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ps=he("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fr=he("Coins",[["circle",{cx:"8",cy:"8",r:"6",key:"3yglwk"}],["path",{d:"M18.09 10.37A6 6 0 1 1 10.34 18",key:"t5s6rm"}],["path",{d:"M7 6h1v4",key:"1obek4"}],["path",{d:"m16.71 13.88.7.71-2.82 2.82",key:"1rbuyh"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gi=he("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Tp=he("Cpu",[["rect",{x:"4",y:"4",width:"16",height:"16",rx:"2",key:"1vbyd7"}],["rect",{x:"9",y:"9",width:"6",height:"6",key:"o3kz5p"}],["path",{d:"M15 2v2",key:"13l42r"}],["path",{d:"M15 20v2",key:"15mkzm"}],["path",{d:"M2 15h2",key:"1gxd5l"}],["path",{d:"M2 9h2",key:"1bbxkp"}],["path",{d:"M20 15h2",key:"19e6y8"}],["path",{d:"M20 9h2",key:"19tzq7"}],["path",{d:"M9 2v2",key:"165o2o"}],["path",{d:"M9 20v2",key:"i2bqo8"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fi=he("DollarSign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Sp=he("EyeOff",[["path",{d:"M9.88 9.88a3 3 0 1 0 4.24 4.24",key:"1jxqfv"}],["path",{d:"M10.73 5.08A10.43 10.43 0 0 1 12 5c7 0 10 7 10 7a13.16 13.16 0 0 1-1.67 2.68",key:"9wicm4"}],["path",{d:"M6.61 6.61A13.526 13.526 0 0 0 2 12s3 7 10 7a9.74 9.74 0 0 0 5.39-1.61",key:"1jreej"}],["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ap=he("Eye",[["path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",key:"rwhkz3"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Cp=he("FileCode",[["path",{d:"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z",key:"1nnpy2"}],["polyline",{points:"14 2 14 8 20 8",key:"1ew0cm"}],["path",{d:"m10 13-2 2 2 2",key:"17smn8"}],["path",{d:"m14 17 2-2-2-2",key:"14mezr"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Dp=he("FileText",[["path",{d:"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z",key:"1nnpy2"}],["polyline",{points:"14 2 14 8 20 8",key:"1ew0cm"}],["line",{x1:"16",x2:"8",y1:"13",y2:"13",key:"14keom"}],["line",{x1:"16",x2:"8",y1:"17",y2:"17",key:"17nazh"}],["line",{x1:"10",x2:"8",y1:"9",y2:"9",key:"1a5vjj"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fh=he("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Rp=he("FlaskConical",[["path",{d:"M10 2v7.527a2 2 0 0 1-.211.896L4.72 20.55a1 1 0 0 0 .9 1.45h12.76a1 1 0 0 0 .9-1.45l-5.069-10.127A2 2 0 0 1 14 9.527V2",key:"pzvekw"}],["path",{d:"M8.5 2h7",key:"csnxdl"}],["path",{d:"M7 16h10",key:"wp8him"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ri=he("Gauge",[["path",{d:"m12 14 4-4",key:"9kzdfg"}],["path",{d:"M3.34 19a10 10 0 1 1 17.32 0",key:"19p75a"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pp=he("Globe2",[["path",{d:"M21.54 15H17a2 2 0 0 0-2 2v4.54",key:"1djwo0"}],["path",{d:"M7 3.34V5a3 3 0 0 0 3 3v0a2 2 0 0 1 2 2v0c0 1.1.9 2 2 2v0a2 2 0 0 0 2-2v0c0-1.1.9-2 2-2h3.17",key:"1fi5u6"}],["path",{d:"M11 21.95V18a2 2 0 0 0-2-2v0a2 2 0 0 1-2-2v-1a2 2 0 0 0-2-2H2.05",key:"xsiumc"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Mp=he("Hash",[["line",{x1:"4",x2:"20",y1:"9",y2:"9",key:"4lhtct"}],["line",{x1:"4",x2:"20",y1:"15",y2:"15",key:"vyu0kd"}],["line",{x1:"10",x2:"8",y1:"3",y2:"21",key:"1ggp8o"}],["line",{x1:"16",x2:"14",y1:"3",y2:"21",key:"weycgp"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $p=he("Heart",[["path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z",key:"c3ymky"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Op=he("Hourglass",[["path",{d:"M5 22h14",key:"ehvnwv"}],["path",{d:"M5 2h14",key:"pdyrp9"}],["path",{d:"M17 22v-4.172a2 2 0 0 0-.586-1.414L12 12l-4.414 4.414A2 2 0 0 0 7 17.828V22",key:"1d314k"}],["path",{d:"M7 2v4.172a2 2 0 0 0 .586 1.414L12 12l4.414-4.414A2 2 0 0 0 17 6.172V2",key:"1vvvr6"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fa=he("Image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ln=he("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vp=he("Key",[["circle",{cx:"7.5",cy:"15.5",r:"5.5",key:"yqb3hr"}],["path",{d:"m21 2-9.6 9.6",key:"1j0ho8"}],["path",{d:"m15.5 7.5 3 3L22 7l-3-3",key:"1rn1fs"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Lp=he("Layers",[["path",{d:"m12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83Z",key:"8b97xw"}],["path",{d:"m22 17.65-9.17 4.16a2 2 0 0 1-1.66 0L2 17.65",key:"dd6zsq"}],["path",{d:"m22 12.65-9.17 4.16a2 2 0 0 1-1.66 0L2 12.65",key:"ep9fru"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fp=he("LayoutGrid",[["rect",{width:"7",height:"7",x:"3",y:"3",rx:"1",key:"1g98yp"}],["rect",{width:"7",height:"7",x:"14",y:"3",rx:"1",key:"6d4xhi"}],["rect",{width:"7",height:"7",x:"14",y:"14",rx:"1",key:"nxv5o0"}],["rect",{width:"7",height:"7",x:"3",y:"14",rx:"1",key:"1bb6yr"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xa=he("LineChart",[["path",{d:"M3 3v18h18",key:"1s2lah"}],["path",{d:"m19 9-5 5-4-4-3 3",key:"2osh9i"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pd=he("Link2",[["path",{d:"M9 17H7A5 5 0 0 1 7 7h2",key:"8i5ue5"}],["path",{d:"M15 7h2a5 5 0 1 1 0 10h-2",key:"1b9ql8"}],["line",{x1:"8",x2:"16",y1:"12",y2:"12",key:"1jonct"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Up=he("List",[["line",{x1:"8",x2:"21",y1:"6",y2:"6",key:"7ey8pc"}],["line",{x1:"8",x2:"21",y1:"12",y2:"12",key:"rjfblc"}],["line",{x1:"8",x2:"21",y1:"18",y2:"18",key:"c3b1m8"}],["line",{x1:"3",x2:"3.01",y1:"6",y2:"6",key:"1g7gq3"}],["line",{x1:"3",x2:"3.01",y1:"12",y2:"12",key:"1pjlvk"}],["line",{x1:"3",x2:"3.01",y1:"18",y2:"18",key:"28t2mc"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pi=he("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bp=he("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Wp=he("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const za=he("MapPin",[["path",{d:"M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z",key:"2oe9fu"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qp=he("MessageCircle",[["path",{d:"m3 21 1.9-5.7a8.5 8.5 0 1 1 3.8 3.8z",key:"v2veuj"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ys=he("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kl=he("Moon",[["path",{d:"M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z",key:"a7tn18"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zp=he("MoreVertical",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Hp=he("Network",[["rect",{x:"16",y:"16",width:"6",height:"6",rx:"1",key:"4q2zg0"}],["rect",{x:"2",y:"16",width:"6",height:"6",rx:"1",key:"8cvhb9"}],["rect",{x:"9",y:"2",width:"6",height:"6",rx:"1",key:"1egb70"}],["path",{d:"M5 16v-3a1 1 0 0 1 1-1h12a1 1 0 0 1 1 1v3",key:"1jsf9p"}],["path",{d:"M12 12V8",key:"2874zd"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const To=he("Octagon",[["polygon",{points:"7.86 2 16.14 2 22 7.86 22 16.14 16.14 22 7.86 22 2 16.14 2 7.86 7.86 2",key:"h1p8hx"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gp=he("Palette",[["circle",{cx:"13.5",cy:"6.5",r:".5",key:"1xcu5"}],["circle",{cx:"17.5",cy:"10.5",r:".5",key:"736e4u"}],["circle",{cx:"8.5",cy:"7.5",r:".5",key:"clrty"}],["circle",{cx:"6.5",cy:"12.5",r:".5",key:"1s4xz9"}],["path",{d:"M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10c.926 0 1.648-.746 1.648-1.688 0-.437-.18-.835-.437-1.125-.29-.289-.438-.652-.438-1.125a1.64 1.64 0 0 1 1.668-1.668h1.996c3.051 0 5.555-2.503 5.555-5.554C21.965 6.012 17.461 2 12 2z",key:"12rzf8"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fd=he("PenLine",[["path",{d:"M12 20h9",key:"t2du7b"}],["path",{d:"M16.5 3.5a2.12 2.12 0 0 1 3 3L7 19l-4 1 1-4Z",key:"ymcmye"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rr=he("PenSquare",[["path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1qinfi"}],["path",{d:"M18.5 2.5a2.12 2.12 0 0 1 3 3L12 15l-4 1 1-4Z",key:"w2jsv5"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xd=he("Pen",[["path",{d:"M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z",key:"5qss01"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ha=he("Percent",[["line",{x1:"19",x2:"5",y1:"5",y2:"19",key:"1x9vlm"}],["circle",{cx:"6.5",cy:"6.5",r:"2.5",key:"4mh3h7"}],["circle",{cx:"17.5",cy:"17.5",r:"2.5",key:"1mdrzq"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Kp=he("PieChart",[["path",{d:"M21.21 15.89A10 10 0 1 1 8 2.83",key:"k2fpak"}],["path",{d:"M22 12A10 10 0 0 0 12 2v10z",key:"1rfc4y"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yd=he("PiggyBank",[["path",{d:"M19 5c-1.5 0-2.8 1.4-3 2-3.5-1.5-11-.3-11 5 0 1.8 0 3 2 4.5V20h4v-2h3v2h4v-4c1-.5 1.7-1 2-2h2v-4h-2c0-1-.5-1.5-1-2h0V5z",key:"uf6l00"}],["path",{d:"M2 9v1c0 1.1.9 2 2 2h1",key:"nm575m"}],["path",{d:"M16 11h0",key:"k2aug8"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Yp=he("Plane",[["path",{d:"M17.8 19.2 16 11l3.5-3.5C21 6 21.5 4 21 3c-1-.5-3 0-4.5 1.5L13 8 4.8 6.2c-.5-.1-.9.1-1.1.5l-.3.5c-.2.5-.1 1 .3 1.3L9 12l-2 3H4l-1 1 3 2 2 3 1-1v-3l3-2 3.5 5.3c.3.4.8.5 1.3.3l.5-.2c.4-.3.6-.7.5-1.2z",key:"1v9wt8"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xh=he("PlusCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}],["path",{d:"M12 8v8",key:"napkw2"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ra=he("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qp=he("Radio",[["path",{d:"M4.9 19.1C1 15.2 1 8.8 4.9 4.9",key:"1vaf9d"}],["path",{d:"M7.8 16.2c-2.3-2.3-2.3-6.1 0-8.5",key:"u1ii0m"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}],["path",{d:"M16.2 7.8c2.3 2.3 2.3 6.1 0 8.5",key:"1j5fej"}],["path",{d:"M19.1 4.9C23 8.8 23 15.1 19.1 19",key:"10b0cb"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xp=he("RefreshCcw",[["path",{d:"M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"14sxne"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16",key:"1hlbsb"}],["path",{d:"M16 16h5v5",key:"ccwih5"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ya=he("Rocket",[["path",{d:"M4.5 16.5c-1.5 1.26-2 5-2 5s3.74-.5 5-2c.71-.84.7-2.13-.09-2.91a2.18 2.18 0 0 0-2.91-.09z",key:"m3kijz"}],["path",{d:"m12 15-3-3a22 22 0 0 1 2-3.95A12.88 12.88 0 0 1 22 2c0 2.72-.78 7.5-6 11a22.35 22.35 0 0 1-4 2z",key:"1fmvmk"}],["path",{d:"M9 12H4s.55-3.03 2-4c1.62-1.08 5 0 5 0",key:"1f8sc4"}],["path",{d:"M12 15v5s3.03-.55 4-2c1.08-1.62 0-5 0-5",key:"qeys4"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Jp=he("Scale",[["path",{d:"m16 16 3-8 3 8c-.87.65-1.92 1-3 1s-2.13-.35-3-1Z",key:"7g6ntu"}],["path",{d:"m2 16 3-8 3 8c-.87.65-1.92 1-3 1s-2.13-.35-3-1Z",key:"ijws7r"}],["path",{d:"M7 21h10",key:"1b0cd5"}],["path",{d:"M12 3v18",key:"108xh3"}],["path",{d:"M3 7h2c2 0 5-1 7-2 2 1 5 2 7 2h2",key:"3gwbw2"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rs=he("ScrollText",[["path",{d:"M8 21h12a2 2 0 0 0 2-2v-2H10v2a2 2 0 1 1-4 0V5a2 2 0 1 0-4 0v3h4",key:"13a6an"}],["path",{d:"M19 17V5a2 2 0 0 0-2-2H4",key:"zz82l3"}],["path",{d:"M15 8h-5",key:"1khuty"}],["path",{d:"M15 12h-5",key:"r7krc0"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zp=he("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bd=he("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $n=he("ShieldAlert",[["path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10",key:"1irkt0"}],["path",{d:"M12 8v4",key:"1got3b"}],["path",{d:"M12 16h.01",key:"1drbdi"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ui=he("ShieldCheck",[["path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10",key:"1irkt0"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gt=he("Shield",[["path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10",key:"1irkt0"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vd=he("SlidersHorizontal",[["line",{x1:"21",x2:"14",y1:"4",y2:"4",key:"obuewd"}],["line",{x1:"10",x2:"3",y1:"4",y2:"4",key:"1q6298"}],["line",{x1:"21",x2:"12",y1:"12",y2:"12",key:"1iu8h1"}],["line",{x1:"8",x2:"3",y1:"12",y2:"12",key:"ntss68"}],["line",{x1:"21",x2:"16",y1:"20",y2:"20",key:"14d8ph"}],["line",{x1:"12",x2:"3",y1:"20",y2:"20",key:"m0wm8r"}],["line",{x1:"14",x2:"14",y1:"2",y2:"6",key:"14e1ph"}],["line",{x1:"8",x2:"8",y1:"10",y2:"14",key:"1i6ji0"}],["line",{x1:"16",x2:"16",y1:"18",y2:"22",key:"1lctlv"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qt=he("Sparkles",[["path",{d:"m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z",key:"17u4zn"}],["path",{d:"M5 3v4",key:"bklmnn"}],["path",{d:"M19 17v4",key:"iiml17"}],["path",{d:"M3 5h4",key:"nem4j1"}],["path",{d:"M17 19h4",key:"lbex7p"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const So=he("Square",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ef=he("StickyNote",[["path",{d:"M15.5 3H5a2 2 0 0 0-2 2v14c0 1.1.9 2 2 2h14a2 2 0 0 0 2-2V8.5L15.5 3Z",key:"1wis1t"}],["path",{d:"M15 3v6h6",key:"edgan2"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yh=he("Sun",[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"m4.93 4.93 1.41 1.41",key:"149t6j"}],["path",{d:"m17.66 17.66 1.41 1.41",key:"ptbguv"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"m6.34 17.66-1.41 1.41",key:"1m8zz5"}],["path",{d:"m19.07 4.93-1.41 1.41",key:"1shlcs"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tf=he("Table2",[["path",{d:"M9 3H5a2 2 0 0 0-2 2v4m6-6h10a2 2 0 0 1 2 2v4M9 3v18m0 0h10a2 2 0 0 0 2-2V9M9 21H5a2 2 0 0 1-2-2V9m0 0h18",key:"gugj83"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rf=he("Tag",[["path",{d:"M12 2H2v10l9.29 9.29c.94.94 2.48.94 3.42 0l6.58-6.58c.94-.94.94-2.48 0-3.42L12 2Z",key:"14b2ls"}],["path",{d:"M7 7h.01",key:"7u93v4"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ss=he("Target",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sf=he("ThumbsDown",[["path",{d:"M17 14V2",key:"8ymqnk"}],["path",{d:"M9 18.12 10 14H4.17a2 2 0 0 1-1.92-2.56l2.33-8A2 2 0 0 1 6.5 2H20a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2h-2.76a2 2 0 0 0-1.79 1.11L12 22h0a3.13 3.13 0 0 1-3-3.88Z",key:"s6e0r"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bh=he("Timer",[["line",{x1:"10",x2:"14",y1:"2",y2:"2",key:"14vaq8"}],["line",{x1:"12",x2:"15",y1:"14",y2:"11",key:"17fdiu"}],["circle",{cx:"12",cy:"14",r:"8",key:"1e1u0o"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $t=he("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nf=he("Trash",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ms=he("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cn=he("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bn=he("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const af=he("Wallet2",[["path",{d:"M17 14h.01",key:"7oqj8z"}],["path",{d:"M7 7h12a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h14",key:"u1rqew"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const of=he("Wallet",[["path",{d:"M21 12V7H5a2 2 0 0 1 0-4h14v4",key:"195gfw"}],["path",{d:"M3 5v14a2 2 0 0 0 2 2h16v-5",key:"195n9w"}],["path",{d:"M18 12a2 2 0 0 0 0 4h4v-4Z",key:"vllfpd"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ao=he("Wand2",[["path",{d:"m21.64 3.64-1.28-1.28a1.21 1.21 0 0 0-1.72 0L2.36 18.64a1.21 1.21 0 0 0 0 1.72l1.28 1.28a1.2 1.2 0 0 0 1.72 0L21.64 5.36a1.2 1.2 0 0 0 0-1.72Z",key:"1bcowg"}],["path",{d:"m14 7 3 3",key:"1r5n42"}],["path",{d:"M5 6v4",key:"ilb8ba"}],["path",{d:"M19 14v4",key:"blhpug"}],["path",{d:"M10 2v2",key:"7u0qdc"}],["path",{d:"M7 8H3",key:"zfb6yr"}],["path",{d:"M21 16h-4",key:"1cnmox"}],["path",{d:"M11 3H9",key:"1obp7u"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zt=he("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const si=he("Zap",[["polygon",{points:"13 2 3 14 12 14 11 22 21 10 12 10 13 2",key:"45s27k"}]]),vh="/assets/logo-D0_tMQfC.png",lf=()=>{const[r,e]=D.useState("member"),[t,n]=D.useState(""),[a,i]=D.useState(""),[o,c]=D.useState(""),{login:d,user:h,isAuthenticated:g}=jt(),{theme:f,toggleTheme:p}=it(),{activateAdmin:v}=At(),A=ah(),[T]=D0();D.useEffect(()=>{document.body.classList.toggle("dark",f==="dark")},[f]),D.useEffect(()=>{var L,C,j;if(g&&h){A("/management");return}if((L=window.Telegram)!=null&&L.WebApp){window.Telegram.WebApp.ready(),window.Telegram.WebApp.expand();const Y=T.get("tgWebAppData")||window.Telegram.WebApp.initData,I=T.get("login"),y=T.get("password");if(I&&y&&d(I,y)){A("/management");return}if(Y)try{const E=new URLSearchParams(Y).get("user");if(E){const x=JSON.parse(decodeURIComponent(E)).id;sessionStorage.setItem("telegram_user_id",String(x));const de=localStorage.getItem("apevault-auth");if(de)try{const M=JSON.parse(de);if((C=M.state)!=null&&C.user){const X=M.state.user;if(d(X.login,X.password)){A("/management");return}}}catch(M){console.error("Error parsing saved auth:",M)}console.log("Telegram Mini App detected, user ID:",x)}}catch(N){console.error("Error parsing Telegram initData:",N)}const w=(j=window.Telegram.WebApp.initDataUnsafe)==null?void 0:j.user;w&&(sessionStorage.setItem("telegram_user_id",String(w.id)),console.log("Telegram user detected:",w.first_name))}},[T,g,h,A,d]);const S=L=>{if(L.preventDefault(),c(""),!a){c("Пожалуйста, введите пароль");return}if(r==="admin")v(a)?A("/management"):c("Неверный пароль администратора");else{if(!t){c("Пожалуйста, введите логин");return}d(t,a)?A("/management"):c("Неверный логин или пароль")}},z=()=>{p()};return s.jsxs("div",{className:`min-h-screen relative overflow-hidden ${f==="dark"?"bg-[#0b0f17]":"bg-gradient-to-br from-slate-50 via-white to-slate-100"}`,children:[s.jsxs("div",{className:"absolute inset-0 pointer-events-none",children:[s.jsx("div",{className:"absolute -top-24 -left-24 w-[620px] h-[620px] bg-gradient-to-br from-[#4E6E49]/35 via-emerald-400/22 to-transparent blur-[110px]"}),s.jsx("div",{className:"absolute top-[-120px] right-[-180px] w-[780px] h-[780px] bg-gradient-to-bl from-blue-500/24 via-purple-500/22 to-transparent blur-[140px]"}),s.jsx("div",{className:"absolute bottom-[-200px] right-[-80px] w-[620px] h-[620px] bg-gradient-to-tr from-amber-400/18 via-[#4E6E49]/18 to-transparent blur-[120px]"}),s.jsx("div",{className:"floating-grid opacity-75 dark:opacity-45"})]}),s.jsx("div",{className:"relative z-10 max-w-6xl mx-auto px-4 lg:px-6 min-h-screen flex items-center justify-center py-10",children:s.jsxs("div",{className:"glass-panel rounded-[28px] p-4 sm:p-6 md:p-8 border border-white/70 dark:border-white/10 shadow-2xl overflow-hidden w-full",children:[s.jsx("div",{className:"accent-dots"}),s.jsxs("div",{className:"relative z-10 grid md:grid-cols-[1.05fr_0.95fr] gap-6 lg:gap-8 items-stretch",children:[s.jsxs("div",{className:"section-card rounded-2xl p-6 lg:p-7 border border-white/60 dark:border-white/10 shadow-xl flex flex-col items-center text-center gap-4",children:[s.jsx("div",{className:"p-4 rounded-2xl bg-white/80 dark:bg-white/5 border border-white/50 dark:border-white/10 shadow-lg",children:s.jsx("img",{src:vh,alt:"ApeVault Logo",className:"w-16 h-16 object-contain"})}),s.jsxs("div",{className:"space-y-1",children:[s.jsx("p",{className:`text-xs uppercase tracking-[0.16em] ${f==="dark"?"text-gray-400":"text-gray-500"}`,children:"ApeVault Black Ops"}),s.jsx("h1",{className:`text-3xl lg:text-4xl font-extrabold ${f==="dark"?"text-white":"text-gray-900"}`,children:"Командная панель"})]}),s.jsxs("div",{className:"inline-flex items-center gap-2 px-3 py-1 rounded-full bg-gradient-to-r from-[#4E6E49]/15 to-emerald-500/10 text-[#4E6E49] text-xs font-semibold",children:[s.jsx(Gt,{className:"w-4 h-4"}),"Защищенный доступ"]}),s.jsxs("div",{className:`w-full mt-4 rounded-xl border ${f==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white/80"} p-4 text-left space-y-3`,children:[s.jsxs("div",{className:"flex items-center gap-2 text-sm font-semibold",children:[s.jsx(Gt,{className:"w-4 h-4 text-[#4E6E49]"}),s.jsx("span",{className:f==="dark"?"text-white":"text-gray-900",children:"Правила и доступ"})]}),s.jsxs("ul",{className:`text-xs leading-relaxed space-y-1 ${f==="dark"?"text-gray-300":"text-gray-700"}`,children:[s.jsx("li",{children:"• Пользуемся данными из бота: логин + пароль."}),s.jsx("li",{children:"• Админ пароль: только для доверенных (режим администратора)."}),s.jsx("li",{children:"• Правила: открыты на странице «Правила» на сайте."})]}),s.jsxs(Kt,{to:"/rules",className:"inline-flex items-center justify-center gap-2 px-4 py-2 mt-2 text-xs font-semibold rounded-lg bg-gradient-to-r from-[#4E6E49] to-emerald-600 text-white shadow-md hover:shadow-lg hover:-translate-y-0.5 transition-all",children:[s.jsx(Gt,{className:"w-3 h-3"}),"Ознакомиться с правилами"]}),s.jsxs("div",{className:`text-xs ${f==="dark"?"text-gray-400":"text-gray-600"}`,children:["Администратор: ",s.jsx("span",{className:"font-semibold",children:"@artyommedoed"})]})]})]}),s.jsxs("div",{className:"section-card rounded-2xl p-6 lg:p-7 border border-white/60 dark:border-white/10 shadow-xl",children:[s.jsxs("div",{className:"flex items-center justify-between mb-6",children:[s.jsxs("div",{children:[s.jsx("p",{className:`text-xs uppercase tracking-[0.12em] ${f==="dark"?"text-gray-400":"text-gray-500"}`,children:"Доступ"}),s.jsx("h2",{className:`text-2xl font-extrabold ${f==="dark"?"text-white":"text-gray-900"}`,children:"Вход в систему"})]}),s.jsx("button",{onClick:z,className:"nav-chip px-3 py-2","data-active":"false","aria-label":"Toggle theme",children:f==="dark"?s.jsx(yh,{className:"w-5 h-5 text-amber-300"}):s.jsx(kl,{className:"w-5 h-5 text-gray-700"})})]}),s.jsxs("form",{onSubmit:S,className:"space-y-5",children:[s.jsxs("div",{children:[s.jsx("label",{className:`block text-sm font-semibold mb-3 ${f==="dark"?"text-gray-300":"text-gray-700"}`,children:"Тип пользователя"}),s.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[s.jsxs("button",{type:"button",onClick:()=>{e("member"),n(""),i(""),c("")},className:"pill justify-center","data-active":r==="member",children:[s.jsx(bn,{className:"w-5 h-5"}),s.jsx("span",{children:"Участник"})]}),s.jsxs("button",{type:"button",onClick:()=>{e("admin"),n(""),i(""),c("")},className:"pill justify-center","data-active":r==="admin",children:[s.jsx(Gt,{className:"w-5 h-5"}),s.jsx("span",{children:"Админ"})]})]})]}),r==="member"&&s.jsxs("div",{children:[s.jsxs("label",{htmlFor:"login",className:`block text-sm font-semibold mb-2 ${f==="dark"?"text-gray-300":"text-gray-700"}`,children:[s.jsx(cn,{className:"w-4 h-4 inline mr-2"}),"Логин"]}),s.jsx("div",{className:"flex items-center gap-2",children:s.jsx("input",{id:"login",type:"text",value:t,onChange:L=>n(L.target.value),className:`w-full px-4 py-3 rounded-xl border transition-all ${f==="dark"?"bg-white/5 border-white/10 text-white placeholder-gray-500 focus:border-[#4E6E49]":"bg-white border-gray-300 text-gray-900 placeholder-gray-400 focus:border-[#4E6E49]"} focus:outline-none focus:ring-4 focus:ring-[#4E6E49]/20`,placeholder:"Введите ваш логин",autoComplete:"username"})})]}),s.jsxs("div",{children:[s.jsxs("label",{htmlFor:"password",className:`block text-sm font-semibold mb-2 ${f==="dark"?"text-gray-300":"text-gray-700"}`,children:[s.jsx(Gt,{className:"w-4 h-4 inline mr-2"}),"Пароль"]}),s.jsx("input",{id:"password",type:"password",value:a,onChange:L=>i(L.target.value),className:`w-full px-4 py-3 rounded-xl border transition-all ${f==="dark"?"bg-white/5 border-white/10 text-white placeholder-gray-500 focus:border-[#4E6E49]":"bg-white border-gray-300 text-gray-900 placeholder-gray-400 focus:border-[#4E6E49]"} focus:outline-none focus:ring-4 focus:ring-[#4E6E49]/20`,placeholder:r==="admin"?"Введите пароль администратора":"Введите ваш пароль",autoComplete:r==="admin"?"off":"current-password"}),r==="admin"&&s.jsx("p",{className:`mt-2 text-xs ${f==="dark"?"text-gray-400":"text-gray-500"}`,children:"Для входа в режим администратора требуется специальный пароль"})]}),o&&s.jsx("div",{className:`p-4 rounded-xl border ${f==="dark"?"bg-red-500/15 border-red-500/40 text-red-300":"bg-red-50 border-red-300 text-red-700"} text-sm font-semibold animate-shake`,children:o}),s.jsx("button",{type:"submit",className:"w-full py-3 px-4 rounded-xl font-bold text-lg shadow-lg hover:shadow-xl transform hover:-translate-y-0.5 transition-all bg-gradient-to-r from-[#4E6E49] to-[#4E6E49] text-white",children:"Войти в систему"})]}),s.jsx("div",{className:`mt-6 pt-6 border-t ${f==="dark"?"border-white/10":"border-gray-200"} flex items-center justify-between gap-3 flex-wrap`,children:s.jsx("div",{className:`text-xs ${f==="dark"?"text-gray-400":"text-gray-600"}`,children:"Защищенная система для команды ApeVault"})})]})]})]})})]})};var wd={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wh=function(r){const e=[];let t=0;for(let n=0;n<r.length;n++){let a=r.charCodeAt(n);a<128?e[t++]=a:a<2048?(e[t++]=a>>6|192,e[t++]=a&63|128):(a&64512)===55296&&n+1<r.length&&(r.charCodeAt(n+1)&64512)===56320?(a=65536+((a&1023)<<10)+(r.charCodeAt(++n)&1023),e[t++]=a>>18|240,e[t++]=a>>12&63|128,e[t++]=a>>6&63|128,e[t++]=a&63|128):(e[t++]=a>>12|224,e[t++]=a>>6&63|128,e[t++]=a&63|128)}return e},cf=function(r){const e=[];let t=0,n=0;for(;t<r.length;){const a=r[t++];if(a<128)e[n++]=String.fromCharCode(a);else if(a>191&&a<224){const i=r[t++];e[n++]=String.fromCharCode((a&31)<<6|i&63)}else if(a>239&&a<365){const i=r[t++],o=r[t++],c=r[t++],d=((a&7)<<18|(i&63)<<12|(o&63)<<6|c&63)-65536;e[n++]=String.fromCharCode(55296+(d>>10)),e[n++]=String.fromCharCode(56320+(d&1023))}else{const i=r[t++],o=r[t++];e[n++]=String.fromCharCode((a&15)<<12|(i&63)<<6|o&63)}}return e.join("")},kh={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(r,e){if(!Array.isArray(r))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,n=[];for(let a=0;a<r.length;a+=3){const i=r[a],o=a+1<r.length,c=o?r[a+1]:0,d=a+2<r.length,h=d?r[a+2]:0,g=i>>2,f=(i&3)<<4|c>>4;let p=(c&15)<<2|h>>6,v=h&63;d||(v=64,o||(p=64)),n.push(t[g],t[f],t[p],t[v])}return n.join("")},encodeString(r,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(r):this.encodeByteArray(wh(r),e)},decodeString(r,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(r):cf(this.decodeStringToByteArray(r,e))},decodeStringToByteArray(r,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,n=[];for(let a=0;a<r.length;){const i=t[r.charAt(a++)],c=a<r.length?t[r.charAt(a)]:0;++a;const h=a<r.length?t[r.charAt(a)]:64;++a;const f=a<r.length?t[r.charAt(a)]:64;if(++a,i==null||c==null||h==null||f==null)throw new df;const p=i<<2|c>>4;if(n.push(p),h!==64){const v=c<<4&240|h>>2;if(n.push(v),f!==64){const A=h<<6&192|f;n.push(A)}}}return n},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let r=0;r<this.ENCODED_VALS.length;r++)this.byteToCharMap_[r]=this.ENCODED_VALS.charAt(r),this.charToByteMap_[this.byteToCharMap_[r]]=r,this.byteToCharMapWebSafe_[r]=this.ENCODED_VALS_WEBSAFE.charAt(r),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[r]]=r,r>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(r)]=r,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(r)]=r)}}};class df extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const uf=function(r){const e=wh(r);return kh.encodeByteArray(e,!0)},fi=function(r){return uf(r).replace(/\./g,"")},_h=function(r){try{return kh.decodeString(r,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hf(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mf=()=>hf().__FIREBASE_DEFAULTS__,gf=()=>{if(typeof process>"u"||typeof wd>"u")return;const r=wd.__FIREBASE_DEFAULTS__;if(r)return JSON.parse(r)},pf=()=>{if(typeof document>"u")return;let r;try{r=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=r&&_h(r[1]);return e&&JSON.parse(e)},Bi=()=>{try{return mf()||gf()||pf()}catch(r){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${r}`);return}},Nh=r=>{var e,t;return(t=(e=Bi())===null||e===void 0?void 0:e.emulatorHosts)===null||t===void 0?void 0:t[r]},jh=r=>{const e=Nh(r);if(!e)return;const t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const n=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),n]:[e.substring(0,t),n]},Eh=()=>{var r;return(r=Bi())===null||r===void 0?void 0:r.config},Ih=r=>{var e;return(e=Bi())===null||e===void 0?void 0:e[`_${r}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ff{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,n)=>{t?this.reject(t):this.resolve(n),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,n))}}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Th(r,e){if(r.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const t={alg:"none",type:"JWT"},n=e||"demo-project",a=r.iat||0,i=r.sub||r.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o=Object.assign({iss:`https://securetoken.google.com/${n}`,aud:n,iat:a,exp:a+3600,auth_time:a,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}}},r);return[fi(JSON.stringify(t)),fi(JSON.stringify(o)),""].join(".")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qt(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function xf(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(qt())}function yf(){var r;const e=(r=Bi())===null||r===void 0?void 0:r.forceEnvironment;if(e==="node")return!0;if(e==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function bf(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function vf(){const r=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof r=="object"&&r.id!==void 0}function wf(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function kf(){const r=qt();return r.indexOf("MSIE ")>=0||r.indexOf("Trident/")>=0}function _f(){return!yf()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function Nf(){try{return typeof indexedDB=="object"}catch{return!1}}function jf(){return new Promise((r,e)=>{try{let t=!0;const n="validate-browser-context-for-indexeddb-analytics-module",a=self.indexedDB.open(n);a.onsuccess=()=>{a.result.close(),t||self.indexedDB.deleteDatabase(n),r(!0)},a.onupgradeneeded=()=>{t=!1},a.onerror=()=>{var i;e(((i=a.error)===null||i===void 0?void 0:i.message)||"")}}catch(t){e(t)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ef="FirebaseError";class Tr extends Error{constructor(e,t,n){super(t),this.code=e,this.customData=n,this.name=Ef,Object.setPrototypeOf(this,Tr.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,ba.prototype.create)}}class ba{constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(e,...t){const n=t[0]||{},a=`${this.service}/${e}`,i=this.errors[e],o=i?If(i,n):"Error",c=`${this.serviceName}: ${o} (${a}).`;return new Tr(a,c,n)}}function If(r,e){return r.replace(Tf,(t,n)=>{const a=e[n];return a!=null?String(a):`<${n}?>`})}const Tf=/\{\$([^}]+)}/g;function Sf(r){for(const e in r)if(Object.prototype.hasOwnProperty.call(r,e))return!1;return!0}function xi(r,e){if(r===e)return!0;const t=Object.keys(r),n=Object.keys(e);for(const a of t){if(!n.includes(a))return!1;const i=r[a],o=e[a];if(kd(i)&&kd(o)){if(!xi(i,o))return!1}else if(i!==o)return!1}for(const a of n)if(!t.includes(a))return!1;return!0}function kd(r){return r!==null&&typeof r=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function va(r){const e=[];for(const[t,n]of Object.entries(r))Array.isArray(n)?n.forEach(a=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(a))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(n));return e.length?"&"+e.join("&"):""}function Af(r,e){const t=new Cf(r,e);return t.subscribe.bind(t)}class Cf{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(n=>{this.error(n)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,n){let a;if(e===void 0&&t===void 0&&n===void 0)throw new Error("Missing Observer.");Df(e,["next","error","complete"])?a=e:a={next:e,error:t,complete:n},a.next===void 0&&(a.next=Co),a.error===void 0&&(a.error=Co),a.complete===void 0&&(a.complete=Co);const i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?a.error(this.finalError):a.complete()}catch{}}),this.observers.push(a),i}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(n){typeof console<"u"&&console.error&&console.error(n)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function Df(r,e){if(typeof r!="object"||r===null)return!1;for(const t of e)if(t in r&&typeof r[t]=="function")return!0;return!1}function Co(){}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zt(r){return r&&r._delegate?r._delegate:r}class ps{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const js="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rf{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const n=new ff;if(this.instancesDeferred.set(t,n),this.isInitialized(t)||this.shouldAutoInitialize())try{const a=this.getOrInitializeService({instanceIdentifier:t});a&&n.resolve(a)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const n=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),a=(t=e==null?void 0:e.optional)!==null&&t!==void 0?t:!1;if(this.isInitialized(n)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:n})}catch(i){if(a)return null;throw i}else{if(a)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(Mf(e))try{this.getOrInitializeService({instanceIdentifier:js})}catch{}for(const[t,n]of this.instancesDeferred.entries()){const a=this.normalizeInstanceIdentifier(t);try{const i=this.getOrInitializeService({instanceIdentifier:a});n.resolve(i)}catch{}}}}clearInstance(e=js){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=js){return this.instances.has(e)}getOptions(e=js){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,n=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const a=this.getOrInitializeService({instanceIdentifier:n,options:t});for(const[i,o]of this.instancesDeferred.entries()){const c=this.normalizeInstanceIdentifier(i);n===c&&o.resolve(a)}return a}onInit(e,t){var n;const a=this.normalizeInstanceIdentifier(t),i=(n=this.onInitCallbacks.get(a))!==null&&n!==void 0?n:new Set;i.add(e),this.onInitCallbacks.set(a,i);const o=this.instances.get(a);return o&&e(o,a),()=>{i.delete(e)}}invokeOnInitCallbacks(e,t){const n=this.onInitCallbacks.get(t);if(n)for(const a of n)try{a(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let n=this.instances.get(e);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:Pf(e),options:t}),this.instances.set(e,n),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(n,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,n)}catch{}return n||null}normalizeInstanceIdentifier(e=js){return this.component?this.component.multipleInstances?e:js:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function Pf(r){return r===js?void 0:r}function Mf(r){return r.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $f{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new Rf(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Ye;(function(r){r[r.DEBUG=0]="DEBUG",r[r.VERBOSE=1]="VERBOSE",r[r.INFO=2]="INFO",r[r.WARN=3]="WARN",r[r.ERROR=4]="ERROR",r[r.SILENT=5]="SILENT"})(Ye||(Ye={}));const Of={debug:Ye.DEBUG,verbose:Ye.VERBOSE,info:Ye.INFO,warn:Ye.WARN,error:Ye.ERROR,silent:Ye.SILENT},Vf=Ye.INFO,Lf={[Ye.DEBUG]:"log",[Ye.VERBOSE]:"log",[Ye.INFO]:"info",[Ye.WARN]:"warn",[Ye.ERROR]:"error"},Ff=(r,e,...t)=>{if(e<r.logLevel)return;const n=new Date().toISOString(),a=Lf[e];if(a)console[a](`[${n}]  ${r.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class _l{constructor(e){this.name=e,this._logLevel=Vf,this._logHandler=Ff,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in Ye))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?Of[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,Ye.DEBUG,...e),this._logHandler(this,Ye.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,Ye.VERBOSE,...e),this._logHandler(this,Ye.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,Ye.INFO,...e),this._logHandler(this,Ye.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,Ye.WARN,...e),this._logHandler(this,Ye.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,Ye.ERROR,...e),this._logHandler(this,Ye.ERROR,...e)}}const Uf=(r,e)=>e.some(t=>r instanceof t);let _d,Nd;function Bf(){return _d||(_d=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function Wf(){return Nd||(Nd=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const Sh=new WeakMap,Ko=new WeakMap,Ah=new WeakMap,Do=new WeakMap,Nl=new WeakMap;function qf(r){const e=new Promise((t,n)=>{const a=()=>{r.removeEventListener("success",i),r.removeEventListener("error",o)},i=()=>{t(ds(r.result)),a()},o=()=>{n(r.error),a()};r.addEventListener("success",i),r.addEventListener("error",o)});return e.then(t=>{t instanceof IDBCursor&&Sh.set(t,r)}).catch(()=>{}),Nl.set(e,r),e}function zf(r){if(Ko.has(r))return;const e=new Promise((t,n)=>{const a=()=>{r.removeEventListener("complete",i),r.removeEventListener("error",o),r.removeEventListener("abort",o)},i=()=>{t(),a()},o=()=>{n(r.error||new DOMException("AbortError","AbortError")),a()};r.addEventListener("complete",i),r.addEventListener("error",o),r.addEventListener("abort",o)});Ko.set(r,e)}let Yo={get(r,e,t){if(r instanceof IDBTransaction){if(e==="done")return Ko.get(r);if(e==="objectStoreNames")return r.objectStoreNames||Ah.get(r);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return ds(r[e])},set(r,e,t){return r[e]=t,!0},has(r,e){return r instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in r}};function Hf(r){Yo=r(Yo)}function Gf(r){return r===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const n=r.call(Ro(this),e,...t);return Ah.set(n,e.sort?e.sort():[e]),ds(n)}:Wf().includes(r)?function(...e){return r.apply(Ro(this),e),ds(Sh.get(this))}:function(...e){return ds(r.apply(Ro(this),e))}}function Kf(r){return typeof r=="function"?Gf(r):(r instanceof IDBTransaction&&zf(r),Uf(r,Bf())?new Proxy(r,Yo):r)}function ds(r){if(r instanceof IDBRequest)return qf(r);if(Do.has(r))return Do.get(r);const e=Kf(r);return e!==r&&(Do.set(r,e),Nl.set(e,r)),e}const Ro=r=>Nl.get(r);function Yf(r,e,{blocked:t,upgrade:n,blocking:a,terminated:i}={}){const o=indexedDB.open(r,e),c=ds(o);return n&&o.addEventListener("upgradeneeded",d=>{n(ds(o.result),d.oldVersion,d.newVersion,ds(o.transaction),d)}),t&&o.addEventListener("blocked",d=>t(d.oldVersion,d.newVersion,d)),c.then(d=>{i&&d.addEventListener("close",()=>i()),a&&d.addEventListener("versionchange",h=>a(h.oldVersion,h.newVersion,h))}).catch(()=>{}),c}const Qf=["get","getKey","getAll","getAllKeys","count"],Xf=["put","add","delete","clear"],Po=new Map;function jd(r,e){if(!(r instanceof IDBDatabase&&!(e in r)&&typeof e=="string"))return;if(Po.get(e))return Po.get(e);const t=e.replace(/FromIndex$/,""),n=e!==t,a=Xf.includes(t);if(!(t in(n?IDBIndex:IDBObjectStore).prototype)||!(a||Qf.includes(t)))return;const i=async function(o,...c){const d=this.transaction(o,a?"readwrite":"readonly");let h=d.store;return n&&(h=h.index(c.shift())),(await Promise.all([h[t](...c),a&&d.done]))[0]};return Po.set(e,i),i}Hf(r=>({...r,get:(e,t,n)=>jd(e,t)||r.get(e,t,n),has:(e,t)=>!!jd(e,t)||r.has(e,t)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jf{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(Zf(t)){const n=t.getImmediate();return`${n.library}/${n.version}`}else return null}).filter(t=>t).join(" ")}}function Zf(r){const e=r.getComponent();return(e==null?void 0:e.type)==="VERSION"}const Qo="@firebase/app",Ed="0.10.13";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Br=new _l("@firebase/app"),ex="@firebase/app-compat",tx="@firebase/analytics-compat",rx="@firebase/analytics",sx="@firebase/app-check-compat",nx="@firebase/app-check",ax="@firebase/auth",ix="@firebase/auth-compat",ox="@firebase/database",lx="@firebase/data-connect",cx="@firebase/database-compat",dx="@firebase/functions",ux="@firebase/functions-compat",hx="@firebase/installations",mx="@firebase/installations-compat",gx="@firebase/messaging",px="@firebase/messaging-compat",fx="@firebase/performance",xx="@firebase/performance-compat",yx="@firebase/remote-config",bx="@firebase/remote-config-compat",vx="@firebase/storage",wx="@firebase/storage-compat",kx="@firebase/firestore",_x="@firebase/vertexai-preview",Nx="@firebase/firestore-compat",jx="firebase",Ex="10.14.1";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Xo="[DEFAULT]",Ix={[Qo]:"fire-core",[ex]:"fire-core-compat",[rx]:"fire-analytics",[tx]:"fire-analytics-compat",[nx]:"fire-app-check",[sx]:"fire-app-check-compat",[ax]:"fire-auth",[ix]:"fire-auth-compat",[ox]:"fire-rtdb",[lx]:"fire-data-connect",[cx]:"fire-rtdb-compat",[dx]:"fire-fn",[ux]:"fire-fn-compat",[hx]:"fire-iid",[mx]:"fire-iid-compat",[gx]:"fire-fcm",[px]:"fire-fcm-compat",[fx]:"fire-perf",[xx]:"fire-perf-compat",[yx]:"fire-rc",[bx]:"fire-rc-compat",[vx]:"fire-gcs",[wx]:"fire-gcs-compat",[kx]:"fire-fst",[Nx]:"fire-fst-compat",[_x]:"fire-vertex","fire-js":"fire-js",[jx]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yi=new Map,Tx=new Map,Jo=new Map;function Id(r,e){try{r.container.addComponent(e)}catch(t){Br.debug(`Component ${e.name} failed to register with FirebaseApp ${r.name}`,t)}}function $s(r){const e=r.name;if(Jo.has(e))return Br.debug(`There were multiple attempts to register component ${e}.`),!1;Jo.set(e,r);for(const t of yi.values())Id(t,r);for(const t of Tx.values())Id(t,r);return!0}function Wi(r,e){const t=r.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),r.container.getProvider(e)}function ls(r){return r.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Sx={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},us=new ba("app","Firebase",Sx);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ax{constructor(e,t,n){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new ps("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw us.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Us=Ex;function Ch(r,e={}){let t=r;typeof e!="object"&&(e={name:e});const n=Object.assign({name:Xo,automaticDataCollectionEnabled:!1},e),a=n.name;if(typeof a!="string"||!a)throw us.create("bad-app-name",{appName:String(a)});if(t||(t=Eh()),!t)throw us.create("no-options");const i=yi.get(a);if(i){if(xi(t,i.options)&&xi(n,i.config))return i;throw us.create("duplicate-app",{appName:a})}const o=new $f(a);for(const d of Jo.values())o.addComponent(d);const c=new Ax(t,n,o);return yi.set(a,c),c}function jl(r=Xo){const e=yi.get(r);if(!e&&r===Xo&&Eh())return Ch();if(!e)throw us.create("no-app",{appName:r});return e}function vr(r,e,t){var n;let a=(n=Ix[r])!==null&&n!==void 0?n:r;t&&(a+=`-${t}`);const i=a.match(/\s|\//),o=e.match(/\s|\//);if(i||o){const c=[`Unable to register library "${a}" with version "${e}":`];i&&c.push(`library name "${a}" contains illegal characters (whitespace or "/")`),i&&o&&c.push("and"),o&&c.push(`version name "${e}" contains illegal characters (whitespace or "/")`),Br.warn(c.join(" "));return}$s(new ps(`${a}-version`,()=>({library:a,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Cx="firebase-heartbeat-database",Dx=1,sa="firebase-heartbeat-store";let Mo=null;function Dh(){return Mo||(Mo=Yf(Cx,Dx,{upgrade:(r,e)=>{switch(e){case 0:try{r.createObjectStore(sa)}catch(t){console.warn(t)}}}}).catch(r=>{throw us.create("idb-open",{originalErrorMessage:r.message})})),Mo}async function Rx(r){try{const t=(await Dh()).transaction(sa),n=await t.objectStore(sa).get(Rh(r));return await t.done,n}catch(e){if(e instanceof Tr)Br.warn(e.message);else{const t=us.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});Br.warn(t.message)}}}async function Td(r,e){try{const n=(await Dh()).transaction(sa,"readwrite");await n.objectStore(sa).put(e,Rh(r)),await n.done}catch(t){if(t instanceof Tr)Br.warn(t.message);else{const n=us.create("idb-set",{originalErrorMessage:t==null?void 0:t.message});Br.warn(n.message)}}}function Rh(r){return`${r.name}!${r.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Px=1024,Mx=30*24*60*60*1e3;class $x{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new Vx(t),this._heartbeatsCachePromise=this._storage.read().then(n=>(this._heartbeatsCache=n,n))}async triggerHeartbeat(){var e,t;try{const a=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),i=Sd();return((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===i||this._heartbeatsCache.heartbeats.some(o=>o.date===i)?void 0:(this._heartbeatsCache.heartbeats.push({date:i,agent:a}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(o=>{const c=new Date(o.date).valueOf();return Date.now()-c<=Mx}),this._storage.overwrite(this._heartbeatsCache))}catch(n){Br.warn(n)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const t=Sd(),{heartbeatsToSend:n,unsentEntries:a}=Ox(this._heartbeatsCache.heartbeats),i=fi(JSON.stringify({version:2,heartbeats:n}));return this._heartbeatsCache.lastSentHeartbeatDate=t,a.length>0?(this._heartbeatsCache.heartbeats=a,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(t){return Br.warn(t),""}}}function Sd(){return new Date().toISOString().substring(0,10)}function Ox(r,e=Px){const t=[];let n=r.slice();for(const a of r){const i=t.find(o=>o.agent===a.agent);if(i){if(i.dates.push(a.date),Ad(t)>e){i.dates.pop();break}}else if(t.push({agent:a.agent,dates:[a.date]}),Ad(t)>e){t.pop();break}n=n.slice(1)}return{heartbeatsToSend:t,unsentEntries:n}}class Vx{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return Nf()?jf().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const t=await Rx(this.app);return t!=null&&t.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){const a=await this.read();return Td(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:a.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){var t;if(await this._canUseIndexedDBPromise){const a=await this.read();return Td(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:a.lastSentHeartbeatDate,heartbeats:[...a.heartbeats,...e.heartbeats]})}else return}}function Ad(r){return fi(JSON.stringify({version:2,heartbeats:r})).length}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Lx(r){$s(new ps("platform-logger",e=>new Jf(e),"PRIVATE")),$s(new ps("heartbeat",e=>new $x(e),"PRIVATE")),vr(Qo,Ed,r),vr(Qo,Ed,"esm2017"),vr("fire-js","")}Lx("");var Cd=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var As,Ph;(function(){var r;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(I,y){function w(){}w.prototype=y.prototype,I.D=y.prototype,I.prototype=new w,I.prototype.constructor=I,I.C=function(N,E,_){for(var x=Array(arguments.length-2),de=2;de<arguments.length;de++)x[de-2]=arguments[de];return y.prototype[E].apply(N,x)}}function t(){this.blockSize=-1}function n(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(n,t),n.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function a(I,y,w){w||(w=0);var N=Array(16);if(typeof y=="string")for(var E=0;16>E;++E)N[E]=y.charCodeAt(w++)|y.charCodeAt(w++)<<8|y.charCodeAt(w++)<<16|y.charCodeAt(w++)<<24;else for(E=0;16>E;++E)N[E]=y[w++]|y[w++]<<8|y[w++]<<16|y[w++]<<24;y=I.g[0],w=I.g[1],E=I.g[2];var _=I.g[3],x=y+(_^w&(E^_))+N[0]+3614090360&4294967295;y=w+(x<<7&4294967295|x>>>25),x=_+(E^y&(w^E))+N[1]+3905402710&4294967295,_=y+(x<<12&4294967295|x>>>20),x=E+(w^_&(y^w))+N[2]+606105819&4294967295,E=_+(x<<17&4294967295|x>>>15),x=w+(y^E&(_^y))+N[3]+3250441966&4294967295,w=E+(x<<22&4294967295|x>>>10),x=y+(_^w&(E^_))+N[4]+4118548399&4294967295,y=w+(x<<7&4294967295|x>>>25),x=_+(E^y&(w^E))+N[5]+1200080426&4294967295,_=y+(x<<12&4294967295|x>>>20),x=E+(w^_&(y^w))+N[6]+2821735955&4294967295,E=_+(x<<17&4294967295|x>>>15),x=w+(y^E&(_^y))+N[7]+4249261313&4294967295,w=E+(x<<22&4294967295|x>>>10),x=y+(_^w&(E^_))+N[8]+1770035416&4294967295,y=w+(x<<7&4294967295|x>>>25),x=_+(E^y&(w^E))+N[9]+2336552879&4294967295,_=y+(x<<12&4294967295|x>>>20),x=E+(w^_&(y^w))+N[10]+4294925233&4294967295,E=_+(x<<17&4294967295|x>>>15),x=w+(y^E&(_^y))+N[11]+2304563134&4294967295,w=E+(x<<22&4294967295|x>>>10),x=y+(_^w&(E^_))+N[12]+1804603682&4294967295,y=w+(x<<7&4294967295|x>>>25),x=_+(E^y&(w^E))+N[13]+4254626195&4294967295,_=y+(x<<12&4294967295|x>>>20),x=E+(w^_&(y^w))+N[14]+2792965006&4294967295,E=_+(x<<17&4294967295|x>>>15),x=w+(y^E&(_^y))+N[15]+1236535329&4294967295,w=E+(x<<22&4294967295|x>>>10),x=y+(E^_&(w^E))+N[1]+4129170786&4294967295,y=w+(x<<5&4294967295|x>>>27),x=_+(w^E&(y^w))+N[6]+3225465664&4294967295,_=y+(x<<9&4294967295|x>>>23),x=E+(y^w&(_^y))+N[11]+643717713&4294967295,E=_+(x<<14&4294967295|x>>>18),x=w+(_^y&(E^_))+N[0]+3921069994&4294967295,w=E+(x<<20&4294967295|x>>>12),x=y+(E^_&(w^E))+N[5]+3593408605&4294967295,y=w+(x<<5&4294967295|x>>>27),x=_+(w^E&(y^w))+N[10]+38016083&4294967295,_=y+(x<<9&4294967295|x>>>23),x=E+(y^w&(_^y))+N[15]+3634488961&4294967295,E=_+(x<<14&4294967295|x>>>18),x=w+(_^y&(E^_))+N[4]+3889429448&4294967295,w=E+(x<<20&4294967295|x>>>12),x=y+(E^_&(w^E))+N[9]+568446438&4294967295,y=w+(x<<5&4294967295|x>>>27),x=_+(w^E&(y^w))+N[14]+3275163606&4294967295,_=y+(x<<9&4294967295|x>>>23),x=E+(y^w&(_^y))+N[3]+4107603335&4294967295,E=_+(x<<14&4294967295|x>>>18),x=w+(_^y&(E^_))+N[8]+1163531501&4294967295,w=E+(x<<20&4294967295|x>>>12),x=y+(E^_&(w^E))+N[13]+2850285829&4294967295,y=w+(x<<5&4294967295|x>>>27),x=_+(w^E&(y^w))+N[2]+4243563512&4294967295,_=y+(x<<9&4294967295|x>>>23),x=E+(y^w&(_^y))+N[7]+1735328473&4294967295,E=_+(x<<14&4294967295|x>>>18),x=w+(_^y&(E^_))+N[12]+2368359562&4294967295,w=E+(x<<20&4294967295|x>>>12),x=y+(w^E^_)+N[5]+4294588738&4294967295,y=w+(x<<4&4294967295|x>>>28),x=_+(y^w^E)+N[8]+2272392833&4294967295,_=y+(x<<11&4294967295|x>>>21),x=E+(_^y^w)+N[11]+1839030562&4294967295,E=_+(x<<16&4294967295|x>>>16),x=w+(E^_^y)+N[14]+4259657740&4294967295,w=E+(x<<23&4294967295|x>>>9),x=y+(w^E^_)+N[1]+2763975236&4294967295,y=w+(x<<4&4294967295|x>>>28),x=_+(y^w^E)+N[4]+1272893353&4294967295,_=y+(x<<11&4294967295|x>>>21),x=E+(_^y^w)+N[7]+4139469664&4294967295,E=_+(x<<16&4294967295|x>>>16),x=w+(E^_^y)+N[10]+3200236656&4294967295,w=E+(x<<23&4294967295|x>>>9),x=y+(w^E^_)+N[13]+681279174&4294967295,y=w+(x<<4&4294967295|x>>>28),x=_+(y^w^E)+N[0]+3936430074&4294967295,_=y+(x<<11&4294967295|x>>>21),x=E+(_^y^w)+N[3]+3572445317&4294967295,E=_+(x<<16&4294967295|x>>>16),x=w+(E^_^y)+N[6]+76029189&4294967295,w=E+(x<<23&4294967295|x>>>9),x=y+(w^E^_)+N[9]+3654602809&4294967295,y=w+(x<<4&4294967295|x>>>28),x=_+(y^w^E)+N[12]+3873151461&4294967295,_=y+(x<<11&4294967295|x>>>21),x=E+(_^y^w)+N[15]+530742520&4294967295,E=_+(x<<16&4294967295|x>>>16),x=w+(E^_^y)+N[2]+3299628645&4294967295,w=E+(x<<23&4294967295|x>>>9),x=y+(E^(w|~_))+N[0]+4096336452&4294967295,y=w+(x<<6&4294967295|x>>>26),x=_+(w^(y|~E))+N[7]+1126891415&4294967295,_=y+(x<<10&4294967295|x>>>22),x=E+(y^(_|~w))+N[14]+2878612391&4294967295,E=_+(x<<15&4294967295|x>>>17),x=w+(_^(E|~y))+N[5]+4237533241&4294967295,w=E+(x<<21&4294967295|x>>>11),x=y+(E^(w|~_))+N[12]+1700485571&4294967295,y=w+(x<<6&4294967295|x>>>26),x=_+(w^(y|~E))+N[3]+2399980690&4294967295,_=y+(x<<10&4294967295|x>>>22),x=E+(y^(_|~w))+N[10]+4293915773&4294967295,E=_+(x<<15&4294967295|x>>>17),x=w+(_^(E|~y))+N[1]+2240044497&4294967295,w=E+(x<<21&4294967295|x>>>11),x=y+(E^(w|~_))+N[8]+1873313359&4294967295,y=w+(x<<6&4294967295|x>>>26),x=_+(w^(y|~E))+N[15]+4264355552&4294967295,_=y+(x<<10&4294967295|x>>>22),x=E+(y^(_|~w))+N[6]+2734768916&4294967295,E=_+(x<<15&4294967295|x>>>17),x=w+(_^(E|~y))+N[13]+1309151649&4294967295,w=E+(x<<21&4294967295|x>>>11),x=y+(E^(w|~_))+N[4]+4149444226&4294967295,y=w+(x<<6&4294967295|x>>>26),x=_+(w^(y|~E))+N[11]+3174756917&4294967295,_=y+(x<<10&4294967295|x>>>22),x=E+(y^(_|~w))+N[2]+718787259&4294967295,E=_+(x<<15&4294967295|x>>>17),x=w+(_^(E|~y))+N[9]+3951481745&4294967295,I.g[0]=I.g[0]+y&4294967295,I.g[1]=I.g[1]+(E+(x<<21&4294967295|x>>>11))&4294967295,I.g[2]=I.g[2]+E&4294967295,I.g[3]=I.g[3]+_&4294967295}n.prototype.u=function(I,y){y===void 0&&(y=I.length);for(var w=y-this.blockSize,N=this.B,E=this.h,_=0;_<y;){if(E==0)for(;_<=w;)a(this,I,_),_+=this.blockSize;if(typeof I=="string"){for(;_<y;)if(N[E++]=I.charCodeAt(_++),E==this.blockSize){a(this,N),E=0;break}}else for(;_<y;)if(N[E++]=I[_++],E==this.blockSize){a(this,N),E=0;break}}this.h=E,this.o+=y},n.prototype.v=function(){var I=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);I[0]=128;for(var y=1;y<I.length-8;++y)I[y]=0;var w=8*this.o;for(y=I.length-8;y<I.length;++y)I[y]=w&255,w/=256;for(this.u(I),I=Array(16),y=w=0;4>y;++y)for(var N=0;32>N;N+=8)I[w++]=this.g[y]>>>N&255;return I};function i(I,y){var w=c;return Object.prototype.hasOwnProperty.call(w,I)?w[I]:w[I]=y(I)}function o(I,y){this.h=y;for(var w=[],N=!0,E=I.length-1;0<=E;E--){var _=I[E]|0;N&&_==y||(w[E]=_,N=!1)}this.g=w}var c={};function d(I){return-128<=I&&128>I?i(I,function(y){return new o([y|0],0>y?-1:0)}):new o([I|0],0>I?-1:0)}function h(I){if(isNaN(I)||!isFinite(I))return f;if(0>I)return S(h(-I));for(var y=[],w=1,N=0;I>=w;N++)y[N]=I/w|0,w*=4294967296;return new o(y,0)}function g(I,y){if(I.length==0)throw Error("number format error: empty string");if(y=y||10,2>y||36<y)throw Error("radix out of range: "+y);if(I.charAt(0)=="-")return S(g(I.substring(1),y));if(0<=I.indexOf("-"))throw Error('number format error: interior "-" character');for(var w=h(Math.pow(y,8)),N=f,E=0;E<I.length;E+=8){var _=Math.min(8,I.length-E),x=parseInt(I.substring(E,E+_),y);8>_?(_=h(Math.pow(y,_)),N=N.j(_).add(h(x))):(N=N.j(w),N=N.add(h(x)))}return N}var f=d(0),p=d(1),v=d(16777216);r=o.prototype,r.m=function(){if(T(this))return-S(this).m();for(var I=0,y=1,w=0;w<this.g.length;w++){var N=this.i(w);I+=(0<=N?N:4294967296+N)*y,y*=4294967296}return I},r.toString=function(I){if(I=I||10,2>I||36<I)throw Error("radix out of range: "+I);if(A(this))return"0";if(T(this))return"-"+S(this).toString(I);for(var y=h(Math.pow(I,6)),w=this,N="";;){var E=j(w,y).g;w=z(w,E.j(y));var _=((0<w.g.length?w.g[0]:w.h)>>>0).toString(I);if(w=E,A(w))return _+N;for(;6>_.length;)_="0"+_;N=_+N}},r.i=function(I){return 0>I?0:I<this.g.length?this.g[I]:this.h};function A(I){if(I.h!=0)return!1;for(var y=0;y<I.g.length;y++)if(I.g[y]!=0)return!1;return!0}function T(I){return I.h==-1}r.l=function(I){return I=z(this,I),T(I)?-1:A(I)?0:1};function S(I){for(var y=I.g.length,w=[],N=0;N<y;N++)w[N]=~I.g[N];return new o(w,~I.h).add(p)}r.abs=function(){return T(this)?S(this):this},r.add=function(I){for(var y=Math.max(this.g.length,I.g.length),w=[],N=0,E=0;E<=y;E++){var _=N+(this.i(E)&65535)+(I.i(E)&65535),x=(_>>>16)+(this.i(E)>>>16)+(I.i(E)>>>16);N=x>>>16,_&=65535,x&=65535,w[E]=x<<16|_}return new o(w,w[w.length-1]&-2147483648?-1:0)};function z(I,y){return I.add(S(y))}r.j=function(I){if(A(this)||A(I))return f;if(T(this))return T(I)?S(this).j(S(I)):S(S(this).j(I));if(T(I))return S(this.j(S(I)));if(0>this.l(v)&&0>I.l(v))return h(this.m()*I.m());for(var y=this.g.length+I.g.length,w=[],N=0;N<2*y;N++)w[N]=0;for(N=0;N<this.g.length;N++)for(var E=0;E<I.g.length;E++){var _=this.i(N)>>>16,x=this.i(N)&65535,de=I.i(E)>>>16,M=I.i(E)&65535;w[2*N+2*E]+=x*M,L(w,2*N+2*E),w[2*N+2*E+1]+=_*M,L(w,2*N+2*E+1),w[2*N+2*E+1]+=x*de,L(w,2*N+2*E+1),w[2*N+2*E+2]+=_*de,L(w,2*N+2*E+2)}for(N=0;N<y;N++)w[N]=w[2*N+1]<<16|w[2*N];for(N=y;N<2*y;N++)w[N]=0;return new o(w,0)};function L(I,y){for(;(I[y]&65535)!=I[y];)I[y+1]+=I[y]>>>16,I[y]&=65535,y++}function C(I,y){this.g=I,this.h=y}function j(I,y){if(A(y))throw Error("division by zero");if(A(I))return new C(f,f);if(T(I))return y=j(S(I),y),new C(S(y.g),S(y.h));if(T(y))return y=j(I,S(y)),new C(S(y.g),y.h);if(30<I.g.length){if(T(I)||T(y))throw Error("slowDivide_ only works with positive integers.");for(var w=p,N=y;0>=N.l(I);)w=H(w),N=H(N);var E=Y(w,1),_=Y(N,1);for(N=Y(N,2),w=Y(w,2);!A(N);){var x=_.add(N);0>=x.l(I)&&(E=E.add(w),_=x),N=Y(N,1),w=Y(w,1)}return y=z(I,E.j(y)),new C(E,y)}for(E=f;0<=I.l(y);){for(w=Math.max(1,Math.floor(I.m()/y.m())),N=Math.ceil(Math.log(w)/Math.LN2),N=48>=N?1:Math.pow(2,N-48),_=h(w),x=_.j(y);T(x)||0<x.l(I);)w-=N,_=h(w),x=_.j(y);A(_)&&(_=p),E=E.add(_),I=z(I,x)}return new C(E,I)}r.A=function(I){return j(this,I).h},r.and=function(I){for(var y=Math.max(this.g.length,I.g.length),w=[],N=0;N<y;N++)w[N]=this.i(N)&I.i(N);return new o(w,this.h&I.h)},r.or=function(I){for(var y=Math.max(this.g.length,I.g.length),w=[],N=0;N<y;N++)w[N]=this.i(N)|I.i(N);return new o(w,this.h|I.h)},r.xor=function(I){for(var y=Math.max(this.g.length,I.g.length),w=[],N=0;N<y;N++)w[N]=this.i(N)^I.i(N);return new o(w,this.h^I.h)};function H(I){for(var y=I.g.length+1,w=[],N=0;N<y;N++)w[N]=I.i(N)<<1|I.i(N-1)>>>31;return new o(w,I.h)}function Y(I,y){var w=y>>5;y%=32;for(var N=I.g.length-w,E=[],_=0;_<N;_++)E[_]=0<y?I.i(_+w)>>>y|I.i(_+w+1)<<32-y:I.i(_+w);return new o(E,I.h)}n.prototype.digest=n.prototype.v,n.prototype.reset=n.prototype.s,n.prototype.update=n.prototype.u,Ph=n,o.prototype.add=o.prototype.add,o.prototype.multiply=o.prototype.j,o.prototype.modulo=o.prototype.A,o.prototype.compare=o.prototype.l,o.prototype.toNumber=o.prototype.m,o.prototype.toString=o.prototype.toString,o.prototype.getBits=o.prototype.i,o.fromNumber=h,o.fromString=g,As=o}).apply(typeof Cd<"u"?Cd:typeof self<"u"?self:typeof window<"u"?window:{});var Ga=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var Mh,Bn,$h,ni,Zo,Oh,Vh,Lh;(function(){var r,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(l,u,m){return l==Array.prototype||l==Object.prototype||(l[u]=m.value),l};function t(l){l=[typeof globalThis=="object"&&globalThis,l,typeof window=="object"&&window,typeof self=="object"&&self,typeof Ga=="object"&&Ga];for(var u=0;u<l.length;++u){var m=l[u];if(m&&m.Math==Math)return m}throw Error("Cannot find global object")}var n=t(this);function a(l,u){if(u)e:{var m=n;l=l.split(".");for(var b=0;b<l.length-1;b++){var B=l[b];if(!(B in m))break e;m=m[B]}l=l[l.length-1],b=m[l],u=u(b),u!=b&&u!=null&&e(m,l,{configurable:!0,writable:!0,value:u})}}function i(l,u){l instanceof String&&(l+="");var m=0,b=!1,B={next:function(){if(!b&&m<l.length){var Q=m++;return{value:u(Q,l[Q]),done:!1}}return b=!0,{done:!0,value:void 0}}};return B[Symbol.iterator]=function(){return B},B}a("Array.prototype.values",function(l){return l||function(){return i(this,function(u,m){return m})}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var o=o||{},c=this||self;function d(l){var u=typeof l;return u=u!="object"?u:l?Array.isArray(l)?"array":u:"null",u=="array"||u=="object"&&typeof l.length=="number"}function h(l){var u=typeof l;return u=="object"&&l!=null||u=="function"}function g(l,u,m){return l.call.apply(l.bind,arguments)}function f(l,u,m){if(!l)throw Error();if(2<arguments.length){var b=Array.prototype.slice.call(arguments,2);return function(){var B=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(B,b),l.apply(u,B)}}return function(){return l.apply(u,arguments)}}function p(l,u,m){return p=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?g:f,p.apply(null,arguments)}function v(l,u){var m=Array.prototype.slice.call(arguments,1);return function(){var b=m.slice();return b.push.apply(b,arguments),l.apply(this,b)}}function A(l,u){function m(){}m.prototype=u.prototype,l.aa=u.prototype,l.prototype=new m,l.prototype.constructor=l,l.Qb=function(b,B,Q){for(var be=Array(arguments.length-2),dt=2;dt<arguments.length;dt++)be[dt-2]=arguments[dt];return u.prototype[B].apply(b,be)}}function T(l){const u=l.length;if(0<u){const m=Array(u);for(let b=0;b<u;b++)m[b]=l[b];return m}return[]}function S(l,u){for(let m=1;m<arguments.length;m++){const b=arguments[m];if(d(b)){const B=l.length||0,Q=b.length||0;l.length=B+Q;for(let be=0;be<Q;be++)l[B+be]=b[be]}else l.push(b)}}class z{constructor(u,m){this.i=u,this.j=m,this.h=0,this.g=null}get(){let u;return 0<this.h?(this.h--,u=this.g,this.g=u.next,u.next=null):u=this.i(),u}}function L(l){return/^[\s\xa0]*$/.test(l)}function C(){var l=c.navigator;return l&&(l=l.userAgent)?l:""}function j(l){return j[" "](l),l}j[" "]=function(){};var H=C().indexOf("Gecko")!=-1&&!(C().toLowerCase().indexOf("webkit")!=-1&&C().indexOf("Edge")==-1)&&!(C().indexOf("Trident")!=-1||C().indexOf("MSIE")!=-1)&&C().indexOf("Edge")==-1;function Y(l,u,m){for(const b in l)u.call(m,l[b],b,l)}function I(l,u){for(const m in l)u.call(void 0,l[m],m,l)}function y(l){const u={};for(const m in l)u[m]=l[m];return u}const w="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function N(l,u){let m,b;for(let B=1;B<arguments.length;B++){b=arguments[B];for(m in b)l[m]=b[m];for(let Q=0;Q<w.length;Q++)m=w[Q],Object.prototype.hasOwnProperty.call(b,m)&&(l[m]=b[m])}}function E(l){var u=1;l=l.split(":");const m=[];for(;0<u&&l.length;)m.push(l.shift()),u--;return l.length&&m.push(l.join(":")),m}function _(l){c.setTimeout(()=>{throw l},0)}function x(){var l=J;let u=null;return l.g&&(u=l.g,l.g=l.g.next,l.g||(l.h=null),u.next=null),u}class de{constructor(){this.h=this.g=null}add(u,m){const b=M.get();b.set(u,m),this.h?this.h.next=b:this.g=b,this.h=b}}var M=new z(()=>new X,l=>l.reset());class X{constructor(){this.next=this.g=this.h=null}set(u,m){this.h=u,this.g=m,this.next=null}reset(){this.next=this.g=this.h=null}}let R,ee=!1,J=new de,ae=()=>{const l=c.Promise.resolve(void 0);R=()=>{l.then(U)}};var U=()=>{for(var l;l=x();){try{l.h.call(l.g)}catch(m){_(m)}var u=M;u.j(l),100>u.h&&(u.h++,l.next=u.g,u.g=l)}ee=!1};function F(){this.s=this.s,this.C=this.C}F.prototype.s=!1,F.prototype.ma=function(){this.s||(this.s=!0,this.N())},F.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function V(l,u){this.type=l,this.g=this.target=u,this.defaultPrevented=!1}V.prototype.h=function(){this.defaultPrevented=!0};var te=function(){if(!c.addEventListener||!Object.defineProperty)return!1;var l=!1,u=Object.defineProperty({},"passive",{get:function(){l=!0}});try{const m=()=>{};c.addEventListener("test",m,u),c.removeEventListener("test",m,u)}catch{}return l}();function me(l,u){if(V.call(this,l?l.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,l){var m=this.type=l.type,b=l.changedTouches&&l.changedTouches.length?l.changedTouches[0]:null;if(this.target=l.target||l.srcElement,this.g=u,u=l.relatedTarget){if(H){e:{try{j(u.nodeName);var B=!0;break e}catch{}B=!1}B||(u=null)}}else m=="mouseover"?u=l.fromElement:m=="mouseout"&&(u=l.toElement);this.relatedTarget=u,b?(this.clientX=b.clientX!==void 0?b.clientX:b.pageX,this.clientY=b.clientY!==void 0?b.clientY:b.pageY,this.screenX=b.screenX||0,this.screenY=b.screenY||0):(this.clientX=l.clientX!==void 0?l.clientX:l.pageX,this.clientY=l.clientY!==void 0?l.clientY:l.pageY,this.screenX=l.screenX||0,this.screenY=l.screenY||0),this.button=l.button,this.key=l.key||"",this.ctrlKey=l.ctrlKey,this.altKey=l.altKey,this.shiftKey=l.shiftKey,this.metaKey=l.metaKey,this.pointerId=l.pointerId||0,this.pointerType=typeof l.pointerType=="string"?l.pointerType:xe[l.pointerType]||"",this.state=l.state,this.i=l,l.defaultPrevented&&me.aa.h.call(this)}}A(me,V);var xe={2:"touch",3:"pen",4:"mouse"};me.prototype.h=function(){me.aa.h.call(this);var l=this.i;l.preventDefault?l.preventDefault():l.returnValue=!1};var ue="closure_listenable_"+(1e6*Math.random()|0),O=0;function W(l,u,m,b,B){this.listener=l,this.proxy=null,this.src=u,this.type=m,this.capture=!!b,this.ha=B,this.key=++O,this.da=this.fa=!1}function ie(l){l.da=!0,l.listener=null,l.proxy=null,l.src=null,l.ha=null}function P(l){this.src=l,this.g={},this.h=0}P.prototype.add=function(l,u,m,b,B){var Q=l.toString();l=this.g[Q],l||(l=this.g[Q]=[],this.h++);var be=je(l,u,b,B);return-1<be?(u=l[be],m||(u.fa=!1)):(u=new W(u,this.src,Q,!!b,B),u.fa=m,l.push(u)),u};function oe(l,u){var m=u.type;if(m in l.g){var b=l.g[m],B=Array.prototype.indexOf.call(b,u,void 0),Q;(Q=0<=B)&&Array.prototype.splice.call(b,B,1),Q&&(ie(u),l.g[m].length==0&&(delete l.g[m],l.h--))}}function je(l,u,m,b){for(var B=0;B<l.length;++B){var Q=l[B];if(!Q.da&&Q.listener==u&&Q.capture==!!m&&Q.ha==b)return B}return-1}var K="closure_lm_"+(1e6*Math.random()|0),ge={};function pe(l,u,m,b,B){if(Array.isArray(u)){for(var Q=0;Q<u.length;Q++)pe(l,u[Q],m,b,B);return null}return m=Fe(m),l&&l[ue]?l.K(u,m,h(b)?!!b.capture:!1,B):Ce(l,u,m,!1,b,B)}function Ce(l,u,m,b,B,Q){if(!u)throw Error("Invalid event type");var be=h(B)?!!B.capture:!!B,dt=Z(l);if(dt||(l[K]=dt=new P(l)),m=dt.add(u,m,b,be,Q),m.proxy)return m;if(b=ze(),m.proxy=b,b.src=l,b.listener=m,l.addEventListener)te||(B=be),B===void 0&&(B=!1),l.addEventListener(u.toString(),b,B);else if(l.attachEvent)l.attachEvent(ne(u.toString()),b);else if(l.addListener&&l.removeListener)l.addListener(b);else throw Error("addEventListener and attachEvent are unavailable.");return m}function ze(){function l(m){return u.call(l.src,l.listener,m)}const u=Te;return l}function Qe(l,u,m,b,B){if(Array.isArray(u))for(var Q=0;Q<u.length;Q++)Qe(l,u[Q],m,b,B);else b=h(b)?!!b.capture:!!b,m=Fe(m),l&&l[ue]?(l=l.i,u=String(u).toString(),u in l.g&&(Q=l.g[u],m=je(Q,m,b,B),-1<m&&(ie(Q[m]),Array.prototype.splice.call(Q,m,1),Q.length==0&&(delete l.g[u],l.h--)))):l&&(l=Z(l))&&(u=l.g[u.toString()],l=-1,u&&(l=je(u,m,b,B)),(m=-1<l?u[l]:null)&&q(m))}function q(l){if(typeof l!="number"&&l&&!l.da){var u=l.src;if(u&&u[ue])oe(u.i,l);else{var m=l.type,b=l.proxy;u.removeEventListener?u.removeEventListener(m,b,l.capture):u.detachEvent?u.detachEvent(ne(m),b):u.addListener&&u.removeListener&&u.removeListener(b),(m=Z(u))?(oe(m,l),m.h==0&&(m.src=null,u[K]=null)):ie(l)}}}function ne(l){return l in ge?ge[l]:ge[l]="on"+l}function Te(l,u){if(l.da)l=!0;else{u=new me(u,this);var m=l.listener,b=l.ha||l.src;l.fa&&q(l),l=m.call(b,u)}return l}function Z(l){return l=l[K],l instanceof P?l:null}var $e="__closure_events_fn_"+(1e9*Math.random()>>>0);function Fe(l){return typeof l=="function"?l:(l[$e]||(l[$e]=function(u){return l.handleEvent(u)}),l[$e])}function $(){F.call(this),this.i=new P(this),this.M=this,this.F=null}A($,F),$.prototype[ue]=!0,$.prototype.removeEventListener=function(l,u,m,b){Qe(this,l,u,m,b)};function k(l,u){var m,b=l.F;if(b)for(m=[];b;b=b.F)m.push(b);if(l=l.M,b=u.type||u,typeof u=="string")u=new V(u,l);else if(u instanceof V)u.target=u.target||l;else{var B=u;u=new V(b,l),N(u,B)}if(B=!0,m)for(var Q=m.length-1;0<=Q;Q--){var be=u.g=m[Q];B=ye(be,b,!0,u)&&B}if(be=u.g=l,B=ye(be,b,!0,u)&&B,B=ye(be,b,!1,u)&&B,m)for(Q=0;Q<m.length;Q++)be=u.g=m[Q],B=ye(be,b,!1,u)&&B}$.prototype.N=function(){if($.aa.N.call(this),this.i){var l=this.i,u;for(u in l.g){for(var m=l.g[u],b=0;b<m.length;b++)ie(m[b]);delete l.g[u],l.h--}}this.F=null},$.prototype.K=function(l,u,m,b){return this.i.add(String(l),u,!1,m,b)},$.prototype.L=function(l,u,m,b){return this.i.add(String(l),u,!0,m,b)};function ye(l,u,m,b){if(u=l.i.g[String(u)],!u)return!0;u=u.concat();for(var B=!0,Q=0;Q<u.length;++Q){var be=u[Q];if(be&&!be.da&&be.capture==m){var dt=be.listener,Rt=be.ha||be.src;be.fa&&oe(l.i,be),B=dt.call(Rt,b)!==!1&&B}}return B&&!b.defaultPrevented}function _e(l,u,m){if(typeof l=="function")m&&(l=p(l,m));else if(l&&typeof l.handleEvent=="function")l=p(l.handleEvent,l);else throw Error("Invalid listener argument");return 2147483647<Number(u)?-1:c.setTimeout(l,u||0)}function Ie(l){l.g=_e(()=>{l.g=null,l.i&&(l.i=!1,Ie(l))},l.l);const u=l.h;l.h=null,l.m.apply(null,u)}class re extends F{constructor(u,m){super(),this.m=u,this.l=m,this.h=null,this.i=!1,this.g=null}j(u){this.h=arguments,this.g?this.i=!0:Ie(this)}N(){super.N(),this.g&&(c.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function ve(l){F.call(this),this.h=l,this.g={}}A(ve,F);var we=[];function Ae(l){Y(l.g,function(u,m){this.g.hasOwnProperty(m)&&q(u)},l),l.g={}}ve.prototype.N=function(){ve.aa.N.call(this),Ae(this)},ve.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var ot=c.JSON.stringify,ft=c.JSON.parse,bt=class{stringify(l){return c.JSON.stringify(l,void 0)}parse(l){return c.JSON.parse(l,void 0)}};function De(){}De.prototype.h=null;function lt(l){return l.h||(l.h=l.i())}function Pe(){}var Xe={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function Ne(){V.call(this,"d")}A(Ne,V);function Oe(){V.call(this,"c")}A(Oe,V);var at={},G=null;function fe(){return G=G||new $}at.La="serverreachability";function Me(l){V.call(this,at.La,l)}A(Me,V);function We(l){const u=fe();k(u,new Me(u))}at.STAT_EVENT="statevent";function Ke(l,u){V.call(this,at.STAT_EVENT,l),this.stat=u}A(Ke,V);function He(l){const u=fe();k(u,new Ke(u,l))}at.Ma="timingevent";function er(l,u){V.call(this,at.Ma,l),this.size=u}A(er,V);function et(l,u){if(typeof l!="function")throw Error("Fn must not be null and must be a function");return c.setTimeout(function(){l()},u)}function ct(){this.g=!0}ct.prototype.xa=function(){this.g=!1};function Dt(l,u,m,b,B,Q){l.info(function(){if(l.g)if(Q)for(var be="",dt=Q.split("&"),Rt=0;Rt<dt.length;Rt++){var tt=dt[Rt].split("=");if(1<tt.length){var Lt=tt[0];tt=tt[1];var Ft=Lt.split("_");be=2<=Ft.length&&Ft[1]=="type"?be+(Lt+"="+tt+"&"):be+(Lt+"=redacted&")}}else be=null;else be=Q;return"XMLHTTP REQ ("+b+") [attempt "+B+"]: "+u+`
`+m+`
`+be})}function nr(l,u,m,b,B,Q,be){l.info(function(){return"XMLHTTP RESP ("+b+") [ attempt "+B+"]: "+u+`
`+m+`
`+Q+" "+be})}function mt(l,u,m,b){l.info(function(){return"XMLHTTP TEXT ("+u+"): "+ur(l,m)+(b?" "+b:"")})}function Ze(l,u){l.info(function(){return"TIMEOUT: "+u})}ct.prototype.info=function(){};function ur(l,u){if(!l.g)return u;if(!u)return null;try{var m=JSON.parse(u);if(m){for(l=0;l<m.length;l++)if(Array.isArray(m[l])){var b=m[l];if(!(2>b.length)){var B=b[1];if(Array.isArray(B)&&!(1>B.length)){var Q=B[0];if(Q!="noop"&&Q!="stop"&&Q!="close")for(var be=1;be<B.length;be++)B[be]=""}}}}return ot(m)}catch{return u}}var ar={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},Qr={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},go;function Da(){}A(Da,De),Da.prototype.g=function(){return new XMLHttpRequest},Da.prototype.i=function(){return{}},go=new Da;function Xr(l,u,m,b){this.j=l,this.i=u,this.l=m,this.R=b||1,this.U=new ve(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new jc}function jc(){this.i=null,this.g="",this.h=!1}var Ec={},po={};function fo(l,u,m){l.L=1,l.v=$a(Ar(u)),l.m=m,l.P=!0,Ic(l,null)}function Ic(l,u){l.F=Date.now(),Ra(l),l.A=Ar(l.v);var m=l.A,b=l.R;Array.isArray(b)||(b=[String(b)]),Uc(m.i,"t",b),l.C=0,m=l.j.J,l.h=new jc,l.g=ad(l.j,m?u:null,!l.m),0<l.O&&(l.M=new re(p(l.Y,l,l.g),l.O)),u=l.U,m=l.g,b=l.ca;var B="readystatechange";Array.isArray(B)||(B&&(we[0]=B.toString()),B=we);for(var Q=0;Q<B.length;Q++){var be=pe(m,B[Q],b||u.handleEvent,!1,u.h||u);if(!be)break;u.g[be.key]=be}u=l.H?y(l.H):{},l.m?(l.u||(l.u="POST"),u["Content-Type"]="application/x-www-form-urlencoded",l.g.ea(l.A,l.u,l.m,u)):(l.u="GET",l.g.ea(l.A,l.u,null,u)),We(),Dt(l.i,l.u,l.A,l.l,l.R,l.m)}Xr.prototype.ca=function(l){l=l.target;const u=this.M;u&&Cr(l)==3?u.j():this.Y(l)},Xr.prototype.Y=function(l){try{if(l==this.g)e:{const Ft=Cr(this.g);var u=this.g.Ba();const Gs=this.g.Z();if(!(3>Ft)&&(Ft!=3||this.g&&(this.h.h||this.g.oa()||Kc(this.g)))){this.J||Ft!=4||u==7||(u==8||0>=Gs?We(3):We(2)),xo(this);var m=this.g.Z();this.X=m;t:if(Tc(this)){var b=Kc(this.g);l="";var B=b.length,Q=Cr(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){ks(this),Tn(this);var be="";break t}this.h.i=new c.TextDecoder}for(u=0;u<B;u++)this.h.h=!0,l+=this.h.i.decode(b[u],{stream:!(Q&&u==B-1)});b.length=0,this.h.g+=l,this.C=0,be=this.h.g}else be=this.g.oa();if(this.o=m==200,nr(this.i,this.u,this.A,this.l,this.R,Ft,m),this.o){if(this.T&&!this.K){t:{if(this.g){var dt,Rt=this.g;if((dt=Rt.g?Rt.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!L(dt)){var tt=dt;break t}}tt=null}if(m=tt)mt(this.i,this.l,m,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,yo(this,m);else{this.o=!1,this.s=3,He(12),ks(this),Tn(this);break e}}if(this.P){m=!0;let hr;for(;!this.J&&this.C<be.length;)if(hr=u0(this,be),hr==po){Ft==4&&(this.s=4,He(14),m=!1),mt(this.i,this.l,null,"[Incomplete Response]");break}else if(hr==Ec){this.s=4,He(15),mt(this.i,this.l,be,"[Invalid Chunk]"),m=!1;break}else mt(this.i,this.l,hr,null),yo(this,hr);if(Tc(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),Ft!=4||be.length!=0||this.h.h||(this.s=1,He(16),m=!1),this.o=this.o&&m,!m)mt(this.i,this.l,be,"[Invalid Chunked Response]"),ks(this),Tn(this);else if(0<be.length&&!this.W){this.W=!0;var Lt=this.j;Lt.g==this&&Lt.ba&&!Lt.M&&(Lt.j.info("Great, no buffering proxy detected. Bytes received: "+be.length),No(Lt),Lt.M=!0,He(11))}}else mt(this.i,this.l,be,null),yo(this,be);Ft==4&&ks(this),this.o&&!this.J&&(Ft==4?td(this.j,this):(this.o=!1,Ra(this)))}else T0(this.g),m==400&&0<be.indexOf("Unknown SID")?(this.s=3,He(12)):(this.s=0,He(13)),ks(this),Tn(this)}}}catch{}finally{}};function Tc(l){return l.g?l.u=="GET"&&l.L!=2&&l.j.Ca:!1}function u0(l,u){var m=l.C,b=u.indexOf(`
`,m);return b==-1?po:(m=Number(u.substring(m,b)),isNaN(m)?Ec:(b+=1,b+m>u.length?po:(u=u.slice(b,b+m),l.C=b+m,u)))}Xr.prototype.cancel=function(){this.J=!0,ks(this)};function Ra(l){l.S=Date.now()+l.I,Sc(l,l.I)}function Sc(l,u){if(l.B!=null)throw Error("WatchDog timer not null");l.B=et(p(l.ba,l),u)}function xo(l){l.B&&(c.clearTimeout(l.B),l.B=null)}Xr.prototype.ba=function(){this.B=null;const l=Date.now();0<=l-this.S?(Ze(this.i,this.A),this.L!=2&&(We(),He(17)),ks(this),this.s=2,Tn(this)):Sc(this,this.S-l)};function Tn(l){l.j.G==0||l.J||td(l.j,l)}function ks(l){xo(l);var u=l.M;u&&typeof u.ma=="function"&&u.ma(),l.M=null,Ae(l.U),l.g&&(u=l.g,l.g=null,u.abort(),u.ma())}function yo(l,u){try{var m=l.j;if(m.G!=0&&(m.g==l||bo(m.h,l))){if(!l.K&&bo(m.h,l)&&m.G==3){try{var b=m.Da.g.parse(u)}catch{b=null}if(Array.isArray(b)&&b.length==3){var B=b;if(B[0]==0){e:if(!m.u){if(m.g)if(m.g.F+3e3<l.F)Ba(m),Fa(m);else break e;_o(m),He(18)}}else m.za=B[1],0<m.za-m.T&&37500>B[2]&&m.F&&m.v==0&&!m.C&&(m.C=et(p(m.Za,m),6e3));if(1>=Dc(m.h)&&m.ca){try{m.ca()}catch{}m.ca=void 0}}else Ns(m,11)}else if((l.K||m.g==l)&&Ba(m),!L(u))for(B=m.Da.g.parse(u),u=0;u<B.length;u++){let tt=B[u];if(m.T=tt[0],tt=tt[1],m.G==2)if(tt[0]=="c"){m.K=tt[1],m.ia=tt[2];const Lt=tt[3];Lt!=null&&(m.la=Lt,m.j.info("VER="+m.la));const Ft=tt[4];Ft!=null&&(m.Aa=Ft,m.j.info("SVER="+m.Aa));const Gs=tt[5];Gs!=null&&typeof Gs=="number"&&0<Gs&&(b=1.5*Gs,m.L=b,m.j.info("backChannelRequestTimeoutMs_="+b)),b=m;const hr=l.g;if(hr){const qa=hr.g?hr.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(qa){var Q=b.h;Q.g||qa.indexOf("spdy")==-1&&qa.indexOf("quic")==-1&&qa.indexOf("h2")==-1||(Q.j=Q.l,Q.g=new Set,Q.h&&(vo(Q,Q.h),Q.h=null))}if(b.D){const jo=hr.g?hr.g.getResponseHeader("X-HTTP-Session-Id"):null;jo&&(b.ya=jo,ut(b.I,b.D,jo))}}m.G=3,m.l&&m.l.ua(),m.ba&&(m.R=Date.now()-l.F,m.j.info("Handshake RTT: "+m.R+"ms")),b=m;var be=l;if(b.qa=nd(b,b.J?b.ia:null,b.W),be.K){Rc(b.h,be);var dt=be,Rt=b.L;Rt&&(dt.I=Rt),dt.B&&(xo(dt),Ra(dt)),b.g=be}else Zc(b);0<m.i.length&&Ua(m)}else tt[0]!="stop"&&tt[0]!="close"||Ns(m,7);else m.G==3&&(tt[0]=="stop"||tt[0]=="close"?tt[0]=="stop"?Ns(m,7):ko(m):tt[0]!="noop"&&m.l&&m.l.ta(tt),m.v=0)}}We(4)}catch{}}var h0=class{constructor(l,u){this.g=l,this.map=u}};function Ac(l){this.l=l||10,c.PerformanceNavigationTiming?(l=c.performance.getEntriesByType("navigation"),l=0<l.length&&(l[0].nextHopProtocol=="hq"||l[0].nextHopProtocol=="h2")):l=!!(c.chrome&&c.chrome.loadTimes&&c.chrome.loadTimes()&&c.chrome.loadTimes().wasFetchedViaSpdy),this.j=l?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function Cc(l){return l.h?!0:l.g?l.g.size>=l.j:!1}function Dc(l){return l.h?1:l.g?l.g.size:0}function bo(l,u){return l.h?l.h==u:l.g?l.g.has(u):!1}function vo(l,u){l.g?l.g.add(u):l.h=u}function Rc(l,u){l.h&&l.h==u?l.h=null:l.g&&l.g.has(u)&&l.g.delete(u)}Ac.prototype.cancel=function(){if(this.i=Pc(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const l of this.g.values())l.cancel();this.g.clear()}};function Pc(l){if(l.h!=null)return l.i.concat(l.h.D);if(l.g!=null&&l.g.size!==0){let u=l.i;for(const m of l.g.values())u=u.concat(m.D);return u}return T(l.i)}function m0(l){if(l.V&&typeof l.V=="function")return l.V();if(typeof Map<"u"&&l instanceof Map||typeof Set<"u"&&l instanceof Set)return Array.from(l.values());if(typeof l=="string")return l.split("");if(d(l)){for(var u=[],m=l.length,b=0;b<m;b++)u.push(l[b]);return u}u=[],m=0;for(b in l)u[m++]=l[b];return u}function g0(l){if(l.na&&typeof l.na=="function")return l.na();if(!l.V||typeof l.V!="function"){if(typeof Map<"u"&&l instanceof Map)return Array.from(l.keys());if(!(typeof Set<"u"&&l instanceof Set)){if(d(l)||typeof l=="string"){var u=[];l=l.length;for(var m=0;m<l;m++)u.push(m);return u}u=[],m=0;for(const b in l)u[m++]=b;return u}}}function Mc(l,u){if(l.forEach&&typeof l.forEach=="function")l.forEach(u,void 0);else if(d(l)||typeof l=="string")Array.prototype.forEach.call(l,u,void 0);else for(var m=g0(l),b=m0(l),B=b.length,Q=0;Q<B;Q++)u.call(void 0,b[Q],m&&m[Q],l)}var $c=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function p0(l,u){if(l){l=l.split("&");for(var m=0;m<l.length;m++){var b=l[m].indexOf("="),B=null;if(0<=b){var Q=l[m].substring(0,b);B=l[m].substring(b+1)}else Q=l[m];u(Q,B?decodeURIComponent(B.replace(/\+/g," ")):"")}}}function _s(l){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,l instanceof _s){this.h=l.h,Pa(this,l.j),this.o=l.o,this.g=l.g,Ma(this,l.s),this.l=l.l;var u=l.i,m=new Cn;m.i=u.i,u.g&&(m.g=new Map(u.g),m.h=u.h),Oc(this,m),this.m=l.m}else l&&(u=String(l).match($c))?(this.h=!1,Pa(this,u[1]||"",!0),this.o=Sn(u[2]||""),this.g=Sn(u[3]||"",!0),Ma(this,u[4]),this.l=Sn(u[5]||"",!0),Oc(this,u[6]||"",!0),this.m=Sn(u[7]||"")):(this.h=!1,this.i=new Cn(null,this.h))}_s.prototype.toString=function(){var l=[],u=this.j;u&&l.push(An(u,Vc,!0),":");var m=this.g;return(m||u=="file")&&(l.push("//"),(u=this.o)&&l.push(An(u,Vc,!0),"@"),l.push(encodeURIComponent(String(m)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),m=this.s,m!=null&&l.push(":",String(m))),(m=this.l)&&(this.g&&m.charAt(0)!="/"&&l.push("/"),l.push(An(m,m.charAt(0)=="/"?y0:x0,!0))),(m=this.i.toString())&&l.push("?",m),(m=this.m)&&l.push("#",An(m,v0)),l.join("")};function Ar(l){return new _s(l)}function Pa(l,u,m){l.j=m?Sn(u,!0):u,l.j&&(l.j=l.j.replace(/:$/,""))}function Ma(l,u){if(u){if(u=Number(u),isNaN(u)||0>u)throw Error("Bad port number "+u);l.s=u}else l.s=null}function Oc(l,u,m){u instanceof Cn?(l.i=u,w0(l.i,l.h)):(m||(u=An(u,b0)),l.i=new Cn(u,l.h))}function ut(l,u,m){l.i.set(u,m)}function $a(l){return ut(l,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),l}function Sn(l,u){return l?u?decodeURI(l.replace(/%25/g,"%2525")):decodeURIComponent(l):""}function An(l,u,m){return typeof l=="string"?(l=encodeURI(l).replace(u,f0),m&&(l=l.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),l):null}function f0(l){return l=l.charCodeAt(0),"%"+(l>>4&15).toString(16)+(l&15).toString(16)}var Vc=/[#\/\?@]/g,x0=/[#\?:]/g,y0=/[#\?]/g,b0=/[#\?@]/g,v0=/#/g;function Cn(l,u){this.h=this.g=null,this.i=l||null,this.j=!!u}function Jr(l){l.g||(l.g=new Map,l.h=0,l.i&&p0(l.i,function(u,m){l.add(decodeURIComponent(u.replace(/\+/g," ")),m)}))}r=Cn.prototype,r.add=function(l,u){Jr(this),this.i=null,l=zs(this,l);var m=this.g.get(l);return m||this.g.set(l,m=[]),m.push(u),this.h+=1,this};function Lc(l,u){Jr(l),u=zs(l,u),l.g.has(u)&&(l.i=null,l.h-=l.g.get(u).length,l.g.delete(u))}function Fc(l,u){return Jr(l),u=zs(l,u),l.g.has(u)}r.forEach=function(l,u){Jr(this),this.g.forEach(function(m,b){m.forEach(function(B){l.call(u,B,b,this)},this)},this)},r.na=function(){Jr(this);const l=Array.from(this.g.values()),u=Array.from(this.g.keys()),m=[];for(let b=0;b<u.length;b++){const B=l[b];for(let Q=0;Q<B.length;Q++)m.push(u[b])}return m},r.V=function(l){Jr(this);let u=[];if(typeof l=="string")Fc(this,l)&&(u=u.concat(this.g.get(zs(this,l))));else{l=Array.from(this.g.values());for(let m=0;m<l.length;m++)u=u.concat(l[m])}return u},r.set=function(l,u){return Jr(this),this.i=null,l=zs(this,l),Fc(this,l)&&(this.h-=this.g.get(l).length),this.g.set(l,[u]),this.h+=1,this},r.get=function(l,u){return l?(l=this.V(l),0<l.length?String(l[0]):u):u};function Uc(l,u,m){Lc(l,u),0<m.length&&(l.i=null,l.g.set(zs(l,u),T(m)),l.h+=m.length)}r.toString=function(){if(this.i)return this.i;if(!this.g)return"";const l=[],u=Array.from(this.g.keys());for(var m=0;m<u.length;m++){var b=u[m];const Q=encodeURIComponent(String(b)),be=this.V(b);for(b=0;b<be.length;b++){var B=Q;be[b]!==""&&(B+="="+encodeURIComponent(String(be[b]))),l.push(B)}}return this.i=l.join("&")};function zs(l,u){return u=String(u),l.j&&(u=u.toLowerCase()),u}function w0(l,u){u&&!l.j&&(Jr(l),l.i=null,l.g.forEach(function(m,b){var B=b.toLowerCase();b!=B&&(Lc(this,b),Uc(this,B,m))},l)),l.j=u}function k0(l,u){const m=new ct;if(c.Image){const b=new Image;b.onload=v(Zr,m,"TestLoadImage: loaded",!0,u,b),b.onerror=v(Zr,m,"TestLoadImage: error",!1,u,b),b.onabort=v(Zr,m,"TestLoadImage: abort",!1,u,b),b.ontimeout=v(Zr,m,"TestLoadImage: timeout",!1,u,b),c.setTimeout(function(){b.ontimeout&&b.ontimeout()},1e4),b.src=l}else u(!1)}function _0(l,u){const m=new ct,b=new AbortController,B=setTimeout(()=>{b.abort(),Zr(m,"TestPingServer: timeout",!1,u)},1e4);fetch(l,{signal:b.signal}).then(Q=>{clearTimeout(B),Q.ok?Zr(m,"TestPingServer: ok",!0,u):Zr(m,"TestPingServer: server error",!1,u)}).catch(()=>{clearTimeout(B),Zr(m,"TestPingServer: error",!1,u)})}function Zr(l,u,m,b,B){try{B&&(B.onload=null,B.onerror=null,B.onabort=null,B.ontimeout=null),b(m)}catch{}}function N0(){this.g=new bt}function j0(l,u,m){const b=m||"";try{Mc(l,function(B,Q){let be=B;h(B)&&(be=ot(B)),u.push(b+Q+"="+encodeURIComponent(be))})}catch(B){throw u.push(b+"type="+encodeURIComponent("_badmap")),B}}function Oa(l){this.l=l.Ub||null,this.j=l.eb||!1}A(Oa,De),Oa.prototype.g=function(){return new Va(this.l,this.j)},Oa.prototype.i=function(l){return function(){return l}}({});function Va(l,u){$.call(this),this.D=l,this.o=u,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}A(Va,$),r=Va.prototype,r.open=function(l,u){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=l,this.A=u,this.readyState=1,Rn(this)},r.send=function(l){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const u={headers:this.u,method:this.B,credentials:this.m,cache:void 0};l&&(u.body=l),(this.D||c).fetch(new Request(this.A,u)).then(this.Sa.bind(this),this.ga.bind(this))},r.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,Dn(this)),this.readyState=0},r.Sa=function(l){if(this.g&&(this.l=l,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=l.headers,this.readyState=2,Rn(this)),this.g&&(this.readyState=3,Rn(this),this.g)))if(this.responseType==="arraybuffer")l.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof c.ReadableStream<"u"&&"body"in l){if(this.j=l.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;Bc(this)}else l.text().then(this.Ra.bind(this),this.ga.bind(this))};function Bc(l){l.j.read().then(l.Pa.bind(l)).catch(l.ga.bind(l))}r.Pa=function(l){if(this.g){if(this.o&&l.value)this.response.push(l.value);else if(!this.o){var u=l.value?l.value:new Uint8Array(0);(u=this.v.decode(u,{stream:!l.done}))&&(this.response=this.responseText+=u)}l.done?Dn(this):Rn(this),this.readyState==3&&Bc(this)}},r.Ra=function(l){this.g&&(this.response=this.responseText=l,Dn(this))},r.Qa=function(l){this.g&&(this.response=l,Dn(this))},r.ga=function(){this.g&&Dn(this)};function Dn(l){l.readyState=4,l.l=null,l.j=null,l.v=null,Rn(l)}r.setRequestHeader=function(l,u){this.u.append(l,u)},r.getResponseHeader=function(l){return this.h&&this.h.get(l.toLowerCase())||""},r.getAllResponseHeaders=function(){if(!this.h)return"";const l=[],u=this.h.entries();for(var m=u.next();!m.done;)m=m.value,l.push(m[0]+": "+m[1]),m=u.next();return l.join(`\r
`)};function Rn(l){l.onreadystatechange&&l.onreadystatechange.call(l)}Object.defineProperty(Va.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(l){this.m=l?"include":"same-origin"}});function Wc(l){let u="";return Y(l,function(m,b){u+=b,u+=":",u+=m,u+=`\r
`}),u}function wo(l,u,m){e:{for(b in m){var b=!1;break e}b=!0}b||(m=Wc(m),typeof l=="string"?m!=null&&encodeURIComponent(String(m)):ut(l,u,m))}function xt(l){$.call(this),this.headers=new Map,this.o=l||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}A(xt,$);var E0=/^https?$/i,I0=["POST","PUT"];r=xt.prototype,r.Ha=function(l){this.J=l},r.ea=function(l,u,m,b){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+l);u=u?u.toUpperCase():"GET",this.D=l,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():go.g(),this.v=this.o?lt(this.o):lt(go),this.g.onreadystatechange=p(this.Ea,this);try{this.B=!0,this.g.open(u,String(l),!0),this.B=!1}catch(Q){qc(this,Q);return}if(l=m||"",m=new Map(this.headers),b)if(Object.getPrototypeOf(b)===Object.prototype)for(var B in b)m.set(B,b[B]);else if(typeof b.keys=="function"&&typeof b.get=="function")for(const Q of b.keys())m.set(Q,b.get(Q));else throw Error("Unknown input type for opt_headers: "+String(b));b=Array.from(m.keys()).find(Q=>Q.toLowerCase()=="content-type"),B=c.FormData&&l instanceof c.FormData,!(0<=Array.prototype.indexOf.call(I0,u,void 0))||b||B||m.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[Q,be]of m)this.g.setRequestHeader(Q,be);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{Gc(this),this.u=!0,this.g.send(l),this.u=!1}catch(Q){qc(this,Q)}};function qc(l,u){l.h=!1,l.g&&(l.j=!0,l.g.abort(),l.j=!1),l.l=u,l.m=5,zc(l),La(l)}function zc(l){l.A||(l.A=!0,k(l,"complete"),k(l,"error"))}r.abort=function(l){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=l||7,k(this,"complete"),k(this,"abort"),La(this))},r.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),La(this,!0)),xt.aa.N.call(this)},r.Ea=function(){this.s||(this.B||this.u||this.j?Hc(this):this.bb())},r.bb=function(){Hc(this)};function Hc(l){if(l.h&&typeof o<"u"&&(!l.v[1]||Cr(l)!=4||l.Z()!=2)){if(l.u&&Cr(l)==4)_e(l.Ea,0,l);else if(k(l,"readystatechange"),Cr(l)==4){l.h=!1;try{const be=l.Z();e:switch(be){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var u=!0;break e;default:u=!1}var m;if(!(m=u)){var b;if(b=be===0){var B=String(l.D).match($c)[1]||null;!B&&c.self&&c.self.location&&(B=c.self.location.protocol.slice(0,-1)),b=!E0.test(B?B.toLowerCase():"")}m=b}if(m)k(l,"complete"),k(l,"success");else{l.m=6;try{var Q=2<Cr(l)?l.g.statusText:""}catch{Q=""}l.l=Q+" ["+l.Z()+"]",zc(l)}}finally{La(l)}}}}function La(l,u){if(l.g){Gc(l);const m=l.g,b=l.v[0]?()=>{}:null;l.g=null,l.v=null,u||k(l,"ready");try{m.onreadystatechange=b}catch{}}}function Gc(l){l.I&&(c.clearTimeout(l.I),l.I=null)}r.isActive=function(){return!!this.g};function Cr(l){return l.g?l.g.readyState:0}r.Z=function(){try{return 2<Cr(this)?this.g.status:-1}catch{return-1}},r.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},r.Oa=function(l){if(this.g){var u=this.g.responseText;return l&&u.indexOf(l)==0&&(u=u.substring(l.length)),ft(u)}};function Kc(l){try{if(!l.g)return null;if("response"in l.g)return l.g.response;switch(l.H){case"":case"text":return l.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in l.g)return l.g.mozResponseArrayBuffer}return null}catch{return null}}function T0(l){const u={};l=(l.g&&2<=Cr(l)&&l.g.getAllResponseHeaders()||"").split(`\r
`);for(let b=0;b<l.length;b++){if(L(l[b]))continue;var m=E(l[b]);const B=m[0];if(m=m[1],typeof m!="string")continue;m=m.trim();const Q=u[B]||[];u[B]=Q,Q.push(m)}I(u,function(b){return b.join(", ")})}r.Ba=function(){return this.m},r.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function Pn(l,u,m){return m&&m.internalChannelParams&&m.internalChannelParams[l]||u}function Yc(l){this.Aa=0,this.i=[],this.j=new ct,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=Pn("failFast",!1,l),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=Pn("baseRetryDelayMs",5e3,l),this.cb=Pn("retryDelaySeedMs",1e4,l),this.Wa=Pn("forwardChannelMaxRetries",2,l),this.wa=Pn("forwardChannelRequestTimeoutMs",2e4,l),this.pa=l&&l.xmlHttpFactory||void 0,this.Xa=l&&l.Tb||void 0,this.Ca=l&&l.useFetchStreams||!1,this.L=void 0,this.J=l&&l.supportsCrossDomainXhr||!1,this.K="",this.h=new Ac(l&&l.concurrentRequestLimit),this.Da=new N0,this.P=l&&l.fastHandshake||!1,this.O=l&&l.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=l&&l.Rb||!1,l&&l.xa&&this.j.xa(),l&&l.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&l&&l.detectBufferingProxy||!1,this.ja=void 0,l&&l.longPollingTimeout&&0<l.longPollingTimeout&&(this.ja=l.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}r=Yc.prototype,r.la=8,r.G=1,r.connect=function(l,u,m,b){He(0),this.W=l,this.H=u||{},m&&b!==void 0&&(this.H.OSID=m,this.H.OAID=b),this.F=this.X,this.I=nd(this,null,this.W),Ua(this)};function ko(l){if(Qc(l),l.G==3){var u=l.U++,m=Ar(l.I);if(ut(m,"SID",l.K),ut(m,"RID",u),ut(m,"TYPE","terminate"),Mn(l,m),u=new Xr(l,l.j,u),u.L=2,u.v=$a(Ar(m)),m=!1,c.navigator&&c.navigator.sendBeacon)try{m=c.navigator.sendBeacon(u.v.toString(),"")}catch{}!m&&c.Image&&(new Image().src=u.v,m=!0),m||(u.g=ad(u.j,null),u.g.ea(u.v)),u.F=Date.now(),Ra(u)}sd(l)}function Fa(l){l.g&&(No(l),l.g.cancel(),l.g=null)}function Qc(l){Fa(l),l.u&&(c.clearTimeout(l.u),l.u=null),Ba(l),l.h.cancel(),l.s&&(typeof l.s=="number"&&c.clearTimeout(l.s),l.s=null)}function Ua(l){if(!Cc(l.h)&&!l.s){l.s=!0;var u=l.Ga;R||ae(),ee||(R(),ee=!0),J.add(u,l),l.B=0}}function S0(l,u){return Dc(l.h)>=l.h.j-(l.s?1:0)?!1:l.s?(l.i=u.D.concat(l.i),!0):l.G==1||l.G==2||l.B>=(l.Va?0:l.Wa)?!1:(l.s=et(p(l.Ga,l,u),rd(l,l.B)),l.B++,!0)}r.Ga=function(l){if(this.s)if(this.s=null,this.G==1){if(!l){this.U=Math.floor(1e5*Math.random()),l=this.U++;const B=new Xr(this,this.j,l);let Q=this.o;if(this.S&&(Q?(Q=y(Q),N(Q,this.S)):Q=this.S),this.m!==null||this.O||(B.H=Q,Q=null),this.P)e:{for(var u=0,m=0;m<this.i.length;m++){t:{var b=this.i[m];if("__data__"in b.map&&(b=b.map.__data__,typeof b=="string")){b=b.length;break t}b=void 0}if(b===void 0)break;if(u+=b,4096<u){u=m;break e}if(u===4096||m===this.i.length-1){u=m+1;break e}}u=1e3}else u=1e3;u=Jc(this,B,u),m=Ar(this.I),ut(m,"RID",l),ut(m,"CVER",22),this.D&&ut(m,"X-HTTP-Session-Id",this.D),Mn(this,m),Q&&(this.O?u="headers="+encodeURIComponent(String(Wc(Q)))+"&"+u:this.m&&wo(m,this.m,Q)),vo(this.h,B),this.Ua&&ut(m,"TYPE","init"),this.P?(ut(m,"$req",u),ut(m,"SID","null"),B.T=!0,fo(B,m,null)):fo(B,m,u),this.G=2}}else this.G==3&&(l?Xc(this,l):this.i.length==0||Cc(this.h)||Xc(this))};function Xc(l,u){var m;u?m=u.l:m=l.U++;const b=Ar(l.I);ut(b,"SID",l.K),ut(b,"RID",m),ut(b,"AID",l.T),Mn(l,b),l.m&&l.o&&wo(b,l.m,l.o),m=new Xr(l,l.j,m,l.B+1),l.m===null&&(m.H=l.o),u&&(l.i=u.D.concat(l.i)),u=Jc(l,m,1e3),m.I=Math.round(.5*l.wa)+Math.round(.5*l.wa*Math.random()),vo(l.h,m),fo(m,b,u)}function Mn(l,u){l.H&&Y(l.H,function(m,b){ut(u,b,m)}),l.l&&Mc({},function(m,b){ut(u,b,m)})}function Jc(l,u,m){m=Math.min(l.i.length,m);var b=l.l?p(l.l.Na,l.l,l):null;e:{var B=l.i;let Q=-1;for(;;){const be=["count="+m];Q==-1?0<m?(Q=B[0].g,be.push("ofs="+Q)):Q=0:be.push("ofs="+Q);let dt=!0;for(let Rt=0;Rt<m;Rt++){let tt=B[Rt].g;const Lt=B[Rt].map;if(tt-=Q,0>tt)Q=Math.max(0,B[Rt].g-100),dt=!1;else try{j0(Lt,be,"req"+tt+"_")}catch{b&&b(Lt)}}if(dt){b=be.join("&");break e}}}return l=l.i.splice(0,m),u.D=l,b}function Zc(l){if(!l.g&&!l.u){l.Y=1;var u=l.Fa;R||ae(),ee||(R(),ee=!0),J.add(u,l),l.v=0}}function _o(l){return l.g||l.u||3<=l.v?!1:(l.Y++,l.u=et(p(l.Fa,l),rd(l,l.v)),l.v++,!0)}r.Fa=function(){if(this.u=null,ed(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var l=2*this.R;this.j.info("BP detection timer enabled: "+l),this.A=et(p(this.ab,this),l)}},r.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,He(10),Fa(this),ed(this))};function No(l){l.A!=null&&(c.clearTimeout(l.A),l.A=null)}function ed(l){l.g=new Xr(l,l.j,"rpc",l.Y),l.m===null&&(l.g.H=l.o),l.g.O=0;var u=Ar(l.qa);ut(u,"RID","rpc"),ut(u,"SID",l.K),ut(u,"AID",l.T),ut(u,"CI",l.F?"0":"1"),!l.F&&l.ja&&ut(u,"TO",l.ja),ut(u,"TYPE","xmlhttp"),Mn(l,u),l.m&&l.o&&wo(u,l.m,l.o),l.L&&(l.g.I=l.L);var m=l.g;l=l.ia,m.L=1,m.v=$a(Ar(u)),m.m=null,m.P=!0,Ic(m,l)}r.Za=function(){this.C!=null&&(this.C=null,Fa(this),_o(this),He(19))};function Ba(l){l.C!=null&&(c.clearTimeout(l.C),l.C=null)}function td(l,u){var m=null;if(l.g==u){Ba(l),No(l),l.g=null;var b=2}else if(bo(l.h,u))m=u.D,Rc(l.h,u),b=1;else return;if(l.G!=0){if(u.o)if(b==1){m=u.m?u.m.length:0,u=Date.now()-u.F;var B=l.B;b=fe(),k(b,new er(b,m)),Ua(l)}else Zc(l);else if(B=u.s,B==3||B==0&&0<u.X||!(b==1&&S0(l,u)||b==2&&_o(l)))switch(m&&0<m.length&&(u=l.h,u.i=u.i.concat(m)),B){case 1:Ns(l,5);break;case 4:Ns(l,10);break;case 3:Ns(l,6);break;default:Ns(l,2)}}}function rd(l,u){let m=l.Ta+Math.floor(Math.random()*l.cb);return l.isActive()||(m*=2),m*u}function Ns(l,u){if(l.j.info("Error code "+u),u==2){var m=p(l.fb,l),b=l.Xa;const B=!b;b=new _s(b||"//www.google.com/images/cleardot.gif"),c.location&&c.location.protocol=="http"||Pa(b,"https"),$a(b),B?k0(b.toString(),m):_0(b.toString(),m)}else He(2);l.G=0,l.l&&l.l.sa(u),sd(l),Qc(l)}r.fb=function(l){l?(this.j.info("Successfully pinged google.com"),He(2)):(this.j.info("Failed to ping google.com"),He(1))};function sd(l){if(l.G=0,l.ka=[],l.l){const u=Pc(l.h);(u.length!=0||l.i.length!=0)&&(S(l.ka,u),S(l.ka,l.i),l.h.i.length=0,T(l.i),l.i.length=0),l.l.ra()}}function nd(l,u,m){var b=m instanceof _s?Ar(m):new _s(m);if(b.g!="")u&&(b.g=u+"."+b.g),Ma(b,b.s);else{var B=c.location;b=B.protocol,u=u?u+"."+B.hostname:B.hostname,B=+B.port;var Q=new _s(null);b&&Pa(Q,b),u&&(Q.g=u),B&&Ma(Q,B),m&&(Q.l=m),b=Q}return m=l.D,u=l.ya,m&&u&&ut(b,m,u),ut(b,"VER",l.la),Mn(l,b),b}function ad(l,u,m){if(u&&!l.J)throw Error("Can't create secondary domain capable XhrIo object.");return u=l.Ca&&!l.pa?new xt(new Oa({eb:m})):new xt(l.pa),u.Ha(l.J),u}r.isActive=function(){return!!this.l&&this.l.isActive(this)};function id(){}r=id.prototype,r.ua=function(){},r.ta=function(){},r.sa=function(){},r.ra=function(){},r.isActive=function(){return!0},r.Na=function(){};function Wa(){}Wa.prototype.g=function(l,u){return new tr(l,u)};function tr(l,u){$.call(this),this.g=new Yc(u),this.l=l,this.h=u&&u.messageUrlParams||null,l=u&&u.messageHeaders||null,u&&u.clientProtocolHeaderRequired&&(l?l["X-Client-Protocol"]="webchannel":l={"X-Client-Protocol":"webchannel"}),this.g.o=l,l=u&&u.initMessageHeaders||null,u&&u.messageContentType&&(l?l["X-WebChannel-Content-Type"]=u.messageContentType:l={"X-WebChannel-Content-Type":u.messageContentType}),u&&u.va&&(l?l["X-WebChannel-Client-Profile"]=u.va:l={"X-WebChannel-Client-Profile":u.va}),this.g.S=l,(l=u&&u.Sb)&&!L(l)&&(this.g.m=l),this.v=u&&u.supportsCrossDomainXhr||!1,this.u=u&&u.sendRawJson||!1,(u=u&&u.httpSessionIdParam)&&!L(u)&&(this.g.D=u,l=this.h,l!==null&&u in l&&(l=this.h,u in l&&delete l[u])),this.j=new Hs(this)}A(tr,$),tr.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},tr.prototype.close=function(){ko(this.g)},tr.prototype.o=function(l){var u=this.g;if(typeof l=="string"){var m={};m.__data__=l,l=m}else this.u&&(m={},m.__data__=ot(l),l=m);u.i.push(new h0(u.Ya++,l)),u.G==3&&Ua(u)},tr.prototype.N=function(){this.g.l=null,delete this.j,ko(this.g),delete this.g,tr.aa.N.call(this)};function od(l){Ne.call(this),l.__headers__&&(this.headers=l.__headers__,this.statusCode=l.__status__,delete l.__headers__,delete l.__status__);var u=l.__sm__;if(u){e:{for(const m in u){l=m;break e}l=void 0}(this.i=l)&&(l=this.i,u=u!==null&&l in u?u[l]:void 0),this.data=u}else this.data=l}A(od,Ne);function ld(){Oe.call(this),this.status=1}A(ld,Oe);function Hs(l){this.g=l}A(Hs,id),Hs.prototype.ua=function(){k(this.g,"a")},Hs.prototype.ta=function(l){k(this.g,new od(l))},Hs.prototype.sa=function(l){k(this.g,new ld)},Hs.prototype.ra=function(){k(this.g,"b")},Wa.prototype.createWebChannel=Wa.prototype.g,tr.prototype.send=tr.prototype.o,tr.prototype.open=tr.prototype.m,tr.prototype.close=tr.prototype.close,Lh=function(){return new Wa},Vh=function(){return fe()},Oh=at,Zo={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},ar.NO_ERROR=0,ar.TIMEOUT=8,ar.HTTP_ERROR=6,ni=ar,Qr.COMPLETE="complete",$h=Qr,Pe.EventType=Xe,Xe.OPEN="a",Xe.CLOSE="b",Xe.ERROR="c",Xe.MESSAGE="d",$.prototype.listen=$.prototype.K,Bn=Pe,xt.prototype.listenOnce=xt.prototype.L,xt.prototype.getLastError=xt.prototype.Ka,xt.prototype.getLastErrorCode=xt.prototype.Ba,xt.prototype.getStatus=xt.prototype.Z,xt.prototype.getResponseJson=xt.prototype.Oa,xt.prototype.getResponseText=xt.prototype.oa,xt.prototype.send=xt.prototype.ea,xt.prototype.setWithCredentials=xt.prototype.Ha,Mh=xt}).apply(typeof Ga<"u"?Ga:typeof self<"u"?self:typeof window<"u"?window:{});const Dd="@firebase/firestore";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bt{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}Bt.UNAUTHENTICATED=new Bt(null),Bt.GOOGLE_CREDENTIALS=new Bt("google-credentials-uid"),Bt.FIRST_PARTY=new Bt("first-party-uid"),Bt.MOCK_USER=new Bt("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let vn="10.14.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Os=new _l("@firebase/firestore");function On(){return Os.logLevel}function Ee(r,...e){if(Os.logLevel<=Ye.DEBUG){const t=e.map(El);Os.debug(`Firestore (${vn}): ${r}`,...t)}}function Wr(r,...e){if(Os.logLevel<=Ye.ERROR){const t=e.map(El);Os.error(`Firestore (${vn}): ${r}`,...t)}}function dn(r,...e){if(Os.logLevel<=Ye.WARN){const t=e.map(El);Os.warn(`Firestore (${vn}): ${r}`,...t)}}function El(r){if(typeof r=="string")return r;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return function(t){return JSON.stringify(t)}(r)}catch{return r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Le(r="Unexpected state"){const e=`FIRESTORE (${vn}) INTERNAL ASSERTION FAILED: `+r;throw Wr(e),new Error(e)}function nt(r,e){r||Le()}function Be(r,e){return r}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const se={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class ke extends Tr{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ur{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fh{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class Fx{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(Bt.UNAUTHENTICATED))}shutdown(){}}class Ux{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class Bx{constructor(e){this.t=e,this.currentUser=Bt.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){nt(this.o===void 0);let n=this.i;const a=d=>this.i!==n?(n=this.i,t(d)):Promise.resolve();let i=new Ur;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new Ur,e.enqueueRetryable(()=>a(this.currentUser))};const o=()=>{const d=i;e.enqueueRetryable(async()=>{await d.promise,await a(this.currentUser)})},c=d=>{Ee("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=d,this.o&&(this.auth.addAuthTokenListener(this.o),o())};this.t.onInit(d=>c(d)),setTimeout(()=>{if(!this.auth){const d=this.t.getImmediate({optional:!0});d?c(d):(Ee("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new Ur)}},0),o()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(n=>this.i!==e?(Ee("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):n?(nt(typeof n.accessToken=="string"),new Fh(n.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return nt(e===null||typeof e=="string"),new Bt(e)}}class Wx{constructor(e,t,n){this.l=e,this.h=t,this.P=n,this.type="FirstParty",this.user=Bt.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);const e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class qx{constructor(e,t,n){this.l=e,this.h=t,this.P=n}getToken(){return Promise.resolve(new Wx(this.l,this.h,this.P))}start(e,t){e.enqueueRetryable(()=>t(Bt.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class zx{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class Hx{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,t){nt(this.o===void 0);const n=i=>{i.error!=null&&Ee("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${i.error.message}`);const o=i.token!==this.R;return this.R=i.token,Ee("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?t(i.token):Promise.resolve()};this.o=i=>{e.enqueueRetryable(()=>n(i))};const a=i=>{Ee("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=i,this.o&&this.appCheck.addTokenListener(this.o)};this.A.onInit(i=>a(i)),setTimeout(()=>{if(!this.appCheck){const i=this.A.getImmediate({optional:!0});i?a(i):Ee("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(nt(typeof t.token=="string"),this.R=t.token,new zx(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Gx(r){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(r);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let n=0;n<r;n++)t[n]=Math.floor(256*Math.random());return t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Uh{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length;let n="";for(;n.length<20;){const a=Gx(40);for(let i=0;i<a.length;++i)n.length<20&&a[i]<t&&(n+=e.charAt(a[i]%e.length))}return n}}function rt(r,e){return r<e?-1:r>e?1:0}function un(r,e,t){return r.length===e.length&&r.every((n,a)=>t(n,e[a]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class It{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new ke(se.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new ke(se.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new ke(se.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new ke(se.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return It.fromMillis(Date.now())}static fromDate(e){return It.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),n=Math.floor(1e6*(e-1e3*t));return new It(t,n)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?rt(this.nanoseconds,e.nanoseconds):rt(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ue{constructor(e){this.timestamp=e}static fromTimestamp(e){return new Ue(e)}static min(){return new Ue(new It(0,0))}static max(){return new Ue(new It(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class na{constructor(e,t,n){t===void 0?t=0:t>e.length&&Le(),n===void 0?n=e.length-t:n>e.length-t&&Le(),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return na.comparator(this,e)===0}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof na?e.forEach(n=>{t.push(n)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const n=Math.min(e.length,t.length);for(let a=0;a<n;a++){const i=e.get(a),o=t.get(a);if(i<o)return-1;if(i>o)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class ht extends na{construct(e,t,n){return new ht(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const n of e){if(n.indexOf("//")>=0)throw new ke(se.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter(a=>a.length>0))}return new ht(t)}static emptyPath(){return new ht([])}}const Kx=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Mt extends na{construct(e,t,n){return new Mt(e,t,n)}static isValidIdentifier(e){return Kx.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Mt.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new Mt(["__name__"])}static fromServerFormat(e){const t=[];let n="",a=0;const i=()=>{if(n.length===0)throw new ke(se.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""};let o=!1;for(;a<e.length;){const c=e[a];if(c==="\\"){if(a+1===e.length)throw new ke(se.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const d=e[a+1];if(d!=="\\"&&d!=="."&&d!=="`")throw new ke(se.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=d,a+=2}else c==="`"?(o=!o,a++):c!=="."||o?(n+=c,a++):(i(),a++)}if(i(),o)throw new ke(se.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new Mt(t)}static emptyPath(){return new Mt([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Re{constructor(e){this.path=e}static fromPath(e){return new Re(ht.fromString(e))}static fromName(e){return new Re(ht.fromString(e).popFirst(5))}static empty(){return new Re(ht.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&ht.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return ht.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new Re(new ht(e.slice()))}}function Yx(r,e){const t=r.toTimestamp().seconds,n=r.toTimestamp().nanoseconds+1,a=Ue.fromTimestamp(n===1e9?new It(t+1,0):new It(t,n));return new fs(a,Re.empty(),e)}function Qx(r){return new fs(r.readTime,r.key,-1)}class fs{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new fs(Ue.min(),Re.empty(),-1)}static max(){return new fs(Ue.max(),Re.empty(),-1)}}function Xx(r,e){let t=r.readTime.compareTo(e.readTime);return t!==0?t:(t=Re.comparator(r.documentKey,e.documentKey),t!==0?t:rt(r.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Jx="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class Zx{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function wa(r){if(r.code!==se.FAILED_PRECONDITION||r.message!==Jx)throw r;Ee("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class le{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&Le(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new le((n,a)=>{this.nextCallback=i=>{this.wrapSuccess(e,i).next(n,a)},this.catchCallback=i=>{this.wrapFailure(t,i).next(n,a)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof le?t:le.resolve(t)}catch(t){return le.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):le.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):le.reject(t)}static resolve(e){return new le((t,n)=>{t(e)})}static reject(e){return new le((t,n)=>{n(e)})}static waitFor(e){return new le((t,n)=>{let a=0,i=0,o=!1;e.forEach(c=>{++a,c.next(()=>{++i,o&&i===a&&t()},d=>n(d))}),o=!0,i===a&&t()})}static or(e){let t=le.resolve(!1);for(const n of e)t=t.next(a=>a?le.resolve(a):n());return t}static forEach(e,t){const n=[];return e.forEach((a,i)=>{n.push(t.call(this,a,i))}),this.waitFor(n)}static mapArray(e,t){return new le((n,a)=>{const i=e.length,o=new Array(i);let c=0;for(let d=0;d<i;d++){const h=d;t(e[h]).next(g=>{o[h]=g,++c,c===i&&n(o)},g=>a(g))}})}static doWhile(e,t){return new le((n,a)=>{const i=()=>{e()===!0?t().next(()=>{i()},a):n()};i()})}}function ey(r){const e=r.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}function ka(r){return r.name==="IndexedDbTransactionError"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Il{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=n=>this.ie(n),this.se=n=>t.writeSequenceNumber(n))}ie(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.se&&this.se(e),e}}Il.oe=-1;function qi(r){return r==null}function bi(r){return r===0&&1/r==-1/0}function ty(r){return typeof r=="number"&&Number.isInteger(r)&&!bi(r)&&r<=Number.MAX_SAFE_INTEGER&&r>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Rd(r){let e=0;for(const t in r)Object.prototype.hasOwnProperty.call(r,t)&&e++;return e}function Bs(r,e){for(const t in r)Object.prototype.hasOwnProperty.call(r,t)&&e(t,r[t])}function Bh(r){for(const e in r)if(Object.prototype.hasOwnProperty.call(r,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gt{constructor(e,t){this.comparator=e,this.root=t||Pt.EMPTY}insert(e,t){return new gt(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Pt.BLACK,null,null))}remove(e){return new gt(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Pt.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const n=this.comparator(e,t.key);if(n===0)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){const a=this.comparator(e,n.key);if(a===0)return t+n.left.size;a<0?n=n.left:(t+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,n)=>(e(t,n),!1))}toString(){const e=[];return this.inorderTraversal((t,n)=>(e.push(`${t}:${n}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Ka(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Ka(this.root,e,this.comparator,!1)}getReverseIterator(){return new Ka(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Ka(this.root,e,this.comparator,!0)}}class Ka{constructor(e,t,n,a){this.isReverse=a,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?n(e.key,t):1,t&&a&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(i===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Pt{constructor(e,t,n,a,i){this.key=e,this.value=t,this.color=n??Pt.RED,this.left=a??Pt.EMPTY,this.right=i??Pt.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,a,i){return new Pt(e??this.key,t??this.value,n??this.color,a??this.left,i??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let a=this;const i=n(e,a.key);return a=i<0?a.copy(null,null,null,a.left.insert(e,t,n),null):i===0?a.copy(null,t,null,null,null):a.copy(null,null,null,null,a.right.insert(e,t,n)),a.fixUp()}removeMin(){if(this.left.isEmpty())return Pt.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let n,a=this;if(t(e,a.key)<0)a.left.isEmpty()||a.left.isRed()||a.left.left.isRed()||(a=a.moveRedLeft()),a=a.copy(null,null,null,a.left.remove(e,t),null);else{if(a.left.isRed()&&(a=a.rotateRight()),a.right.isEmpty()||a.right.isRed()||a.right.left.isRed()||(a=a.moveRedRight()),t(e,a.key)===0){if(a.right.isEmpty())return Pt.EMPTY;n=a.right.min(),a=a.copy(n.key,n.value,null,null,a.right.removeMin())}a=a.copy(null,null,null,null,a.right.remove(e,t))}return a.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Pt.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Pt.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw Le();const e=this.left.check();if(e!==this.right.check())throw Le();return e+(this.isRed()?0:1)}}Pt.EMPTY=null,Pt.RED=!0,Pt.BLACK=!1;Pt.EMPTY=new class{constructor(){this.size=0}get key(){throw Le()}get value(){throw Le()}get color(){throw Le()}get left(){throw Le()}get right(){throw Le()}copy(e,t,n,a,i){return this}insert(e,t,n){return new Pt(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ot{constructor(e){this.comparator=e,this.data=new gt(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,n)=>(e(t),!1))}forEachInRange(e,t){const n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){const a=n.getNext();if(this.comparator(a.key,e[1])>=0)return;t(a.key)}}forEachWhile(e,t){let n;for(n=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new Pd(this.data.getIterator())}getIteratorFrom(e){return new Pd(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(n=>{t=t.add(n)}),t}isEqual(e){if(!(e instanceof Ot)||this.size!==e.size)return!1;const t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){const a=t.getNext().key,i=n.getNext().key;if(this.comparator(a,i)!==0)return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new Ot(this.comparator);return t.data=e,t}}class Pd{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sr{constructor(e){this.fields=e,e.sort(Mt.comparator)}static empty(){return new sr([])}unionWith(e){let t=new Ot(Mt.comparator);for(const n of this.fields)t=t.add(n);for(const n of e)t=t.add(n);return new sr(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return un(this.fields,e.fields,(t,n)=>t.isEqual(n))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wh extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vt{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(a){try{return atob(a)}catch(i){throw typeof DOMException<"u"&&i instanceof DOMException?new Wh("Invalid base64 string: "+i):i}}(e);return new Vt(t)}static fromUint8Array(e){const t=function(a){let i="";for(let o=0;o<a.length;++o)i+=String.fromCharCode(a[o]);return i}(e);return new Vt(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(t){return btoa(t)}(this.binaryString)}toUint8Array(){return function(t){const n=new Uint8Array(t.length);for(let a=0;a<t.length;a++)n[a]=t.charCodeAt(a);return n}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return rt(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Vt.EMPTY_BYTE_STRING=new Vt("");const ry=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function xs(r){if(nt(!!r),typeof r=="string"){let e=0;const t=ry.exec(r);if(nt(!!t),t[1]){let a=t[1];a=(a+"000000000").substr(0,9),e=Number(a)}const n=new Date(r);return{seconds:Math.floor(n.getTime()/1e3),nanos:e}}return{seconds:vt(r.seconds),nanos:vt(r.nanos)}}function vt(r){return typeof r=="number"?r:typeof r=="string"?Number(r):0}function Vs(r){return typeof r=="string"?Vt.fromBase64String(r):Vt.fromUint8Array(r)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Tl(r){var e,t;return((t=(((e=r==null?void 0:r.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||t===void 0?void 0:t.stringValue)==="server_timestamp"}function Sl(r){const e=r.mapValue.fields.__previous_value__;return Tl(e)?Sl(e):e}function aa(r){const e=xs(r.mapValue.fields.__local_write_time__.timestampValue);return new It(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sy{constructor(e,t,n,a,i,o,c,d,h){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=a,this.ssl=i,this.forceLongPolling=o,this.autoDetectLongPolling=c,this.longPollingOptions=d,this.useFetchStreams=h}}class ia{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new ia("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(e){return e instanceof ia&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ya={mapValue:{}};function Ls(r){return"nullValue"in r?0:"booleanValue"in r?1:"integerValue"in r||"doubleValue"in r?2:"timestampValue"in r?3:"stringValue"in r?5:"bytesValue"in r?6:"referenceValue"in r?7:"geoPointValue"in r?8:"arrayValue"in r?9:"mapValue"in r?Tl(r)?4:ay(r)?9007199254740991:ny(r)?10:11:Le()}function jr(r,e){if(r===e)return!0;const t=Ls(r);if(t!==Ls(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return r.booleanValue===e.booleanValue;case 4:return aa(r).isEqual(aa(e));case 3:return function(a,i){if(typeof a.timestampValue=="string"&&typeof i.timestampValue=="string"&&a.timestampValue.length===i.timestampValue.length)return a.timestampValue===i.timestampValue;const o=xs(a.timestampValue),c=xs(i.timestampValue);return o.seconds===c.seconds&&o.nanos===c.nanos}(r,e);case 5:return r.stringValue===e.stringValue;case 6:return function(a,i){return Vs(a.bytesValue).isEqual(Vs(i.bytesValue))}(r,e);case 7:return r.referenceValue===e.referenceValue;case 8:return function(a,i){return vt(a.geoPointValue.latitude)===vt(i.geoPointValue.latitude)&&vt(a.geoPointValue.longitude)===vt(i.geoPointValue.longitude)}(r,e);case 2:return function(a,i){if("integerValue"in a&&"integerValue"in i)return vt(a.integerValue)===vt(i.integerValue);if("doubleValue"in a&&"doubleValue"in i){const o=vt(a.doubleValue),c=vt(i.doubleValue);return o===c?bi(o)===bi(c):isNaN(o)&&isNaN(c)}return!1}(r,e);case 9:return un(r.arrayValue.values||[],e.arrayValue.values||[],jr);case 10:case 11:return function(a,i){const o=a.mapValue.fields||{},c=i.mapValue.fields||{};if(Rd(o)!==Rd(c))return!1;for(const d in o)if(o.hasOwnProperty(d)&&(c[d]===void 0||!jr(o[d],c[d])))return!1;return!0}(r,e);default:return Le()}}function oa(r,e){return(r.values||[]).find(t=>jr(t,e))!==void 0}function hn(r,e){if(r===e)return 0;const t=Ls(r),n=Ls(e);if(t!==n)return rt(t,n);switch(t){case 0:case 9007199254740991:return 0;case 1:return rt(r.booleanValue,e.booleanValue);case 2:return function(i,o){const c=vt(i.integerValue||i.doubleValue),d=vt(o.integerValue||o.doubleValue);return c<d?-1:c>d?1:c===d?0:isNaN(c)?isNaN(d)?0:-1:1}(r,e);case 3:return Md(r.timestampValue,e.timestampValue);case 4:return Md(aa(r),aa(e));case 5:return rt(r.stringValue,e.stringValue);case 6:return function(i,o){const c=Vs(i),d=Vs(o);return c.compareTo(d)}(r.bytesValue,e.bytesValue);case 7:return function(i,o){const c=i.split("/"),d=o.split("/");for(let h=0;h<c.length&&h<d.length;h++){const g=rt(c[h],d[h]);if(g!==0)return g}return rt(c.length,d.length)}(r.referenceValue,e.referenceValue);case 8:return function(i,o){const c=rt(vt(i.latitude),vt(o.latitude));return c!==0?c:rt(vt(i.longitude),vt(o.longitude))}(r.geoPointValue,e.geoPointValue);case 9:return $d(r.arrayValue,e.arrayValue);case 10:return function(i,o){var c,d,h,g;const f=i.fields||{},p=o.fields||{},v=(c=f.value)===null||c===void 0?void 0:c.arrayValue,A=(d=p.value)===null||d===void 0?void 0:d.arrayValue,T=rt(((h=v==null?void 0:v.values)===null||h===void 0?void 0:h.length)||0,((g=A==null?void 0:A.values)===null||g===void 0?void 0:g.length)||0);return T!==0?T:$d(v,A)}(r.mapValue,e.mapValue);case 11:return function(i,o){if(i===Ya.mapValue&&o===Ya.mapValue)return 0;if(i===Ya.mapValue)return 1;if(o===Ya.mapValue)return-1;const c=i.fields||{},d=Object.keys(c),h=o.fields||{},g=Object.keys(h);d.sort(),g.sort();for(let f=0;f<d.length&&f<g.length;++f){const p=rt(d[f],g[f]);if(p!==0)return p;const v=hn(c[d[f]],h[g[f]]);if(v!==0)return v}return rt(d.length,g.length)}(r.mapValue,e.mapValue);default:throw Le()}}function Md(r,e){if(typeof r=="string"&&typeof e=="string"&&r.length===e.length)return rt(r,e);const t=xs(r),n=xs(e),a=rt(t.seconds,n.seconds);return a!==0?a:rt(t.nanos,n.nanos)}function $d(r,e){const t=r.values||[],n=e.values||[];for(let a=0;a<t.length&&a<n.length;++a){const i=hn(t[a],n[a]);if(i)return i}return rt(t.length,n.length)}function mn(r){return el(r)}function el(r){return"nullValue"in r?"null":"booleanValue"in r?""+r.booleanValue:"integerValue"in r?""+r.integerValue:"doubleValue"in r?""+r.doubleValue:"timestampValue"in r?function(t){const n=xs(t);return`time(${n.seconds},${n.nanos})`}(r.timestampValue):"stringValue"in r?r.stringValue:"bytesValue"in r?function(t){return Vs(t).toBase64()}(r.bytesValue):"referenceValue"in r?function(t){return Re.fromName(t).toString()}(r.referenceValue):"geoPointValue"in r?function(t){return`geo(${t.latitude},${t.longitude})`}(r.geoPointValue):"arrayValue"in r?function(t){let n="[",a=!0;for(const i of t.values||[])a?a=!1:n+=",",n+=el(i);return n+"]"}(r.arrayValue):"mapValue"in r?function(t){const n=Object.keys(t.fields||{}).sort();let a="{",i=!0;for(const o of n)i?i=!1:a+=",",a+=`${o}:${el(t.fields[o])}`;return a+"}"}(r.mapValue):Le()}function Od(r,e){return{referenceValue:`projects/${r.projectId}/databases/${r.database}/documents/${e.path.canonicalString()}`}}function tl(r){return!!r&&"integerValue"in r}function Al(r){return!!r&&"arrayValue"in r}function Vd(r){return!!r&&"nullValue"in r}function Ld(r){return!!r&&"doubleValue"in r&&isNaN(Number(r.doubleValue))}function ai(r){return!!r&&"mapValue"in r}function ny(r){var e,t;return((t=(((e=r==null?void 0:r.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||t===void 0?void 0:t.stringValue)==="__vector__"}function Gn(r){if(r.geoPointValue)return{geoPointValue:Object.assign({},r.geoPointValue)};if(r.timestampValue&&typeof r.timestampValue=="object")return{timestampValue:Object.assign({},r.timestampValue)};if(r.mapValue){const e={mapValue:{fields:{}}};return Bs(r.mapValue.fields,(t,n)=>e.mapValue.fields[t]=Gn(n)),e}if(r.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(r.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=Gn(r.arrayValue.values[t]);return e}return Object.assign({},r)}function ay(r){return(((r.mapValue||{}).fields||{}).__type__||{}).stringValue==="__max__"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yt{constructor(e){this.value=e}static empty(){return new Yt({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(t=(t.mapValue.fields||{})[e.get(n)],!ai(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Gn(t)}setAll(e){let t=Mt.emptyPath(),n={},a=[];e.forEach((o,c)=>{if(!t.isImmediateParentOf(c)){const d=this.getFieldsMap(t);this.applyChanges(d,n,a),n={},a=[],t=c.popLast()}o?n[c.lastSegment()]=Gn(o):a.push(c.lastSegment())});const i=this.getFieldsMap(t);this.applyChanges(i,n,a)}delete(e){const t=this.field(e.popLast());ai(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return jr(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let a=t.mapValue.fields[e.get(n)];ai(a)&&a.mapValue.fields||(a={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=a),t=a}return t.mapValue.fields}applyChanges(e,t,n){Bs(t,(a,i)=>e[a]=i);for(const a of n)delete e[a]}clone(){return new Yt(Gn(this.value))}}function qh(r){const e=[];return Bs(r.fields,(t,n)=>{const a=new Mt([t]);if(ai(n)){const i=qh(n.mapValue).fields;if(i.length===0)e.push(a);else for(const o of i)e.push(a.child(o))}else e.push(a)}),new sr(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wt{constructor(e,t,n,a,i,o,c){this.key=e,this.documentType=t,this.version=n,this.readTime=a,this.createTime=i,this.data=o,this.documentState=c}static newInvalidDocument(e){return new Wt(e,0,Ue.min(),Ue.min(),Ue.min(),Yt.empty(),0)}static newFoundDocument(e,t,n,a){return new Wt(e,1,t,Ue.min(),n,a,0)}static newNoDocument(e,t){return new Wt(e,2,t,Ue.min(),Ue.min(),Yt.empty(),0)}static newUnknownDocument(e,t){return new Wt(e,3,t,Ue.min(),Ue.min(),Yt.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(Ue.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Yt.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Yt.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=Ue.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof Wt&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new Wt(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vi{constructor(e,t){this.position=e,this.inclusive=t}}function Fd(r,e,t){let n=0;for(let a=0;a<r.position.length;a++){const i=e[a],o=r.position[a];if(i.field.isKeyField()?n=Re.comparator(Re.fromName(o.referenceValue),t.key):n=hn(o,t.data.field(i.field)),i.dir==="desc"&&(n*=-1),n!==0)break}return n}function Ud(r,e){if(r===null)return e===null;if(e===null||r.inclusive!==e.inclusive||r.position.length!==e.position.length)return!1;for(let t=0;t<r.position.length;t++)if(!jr(r.position[t],e.position[t]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class la{constructor(e,t="asc"){this.field=e,this.dir=t}}function iy(r,e){return r.dir===e.dir&&r.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zh{}class _t extends zh{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,n):new ly(e,t,n):t==="array-contains"?new uy(e,n):t==="in"?new hy(e,n):t==="not-in"?new my(e,n):t==="array-contains-any"?new gy(e,n):new _t(e,t,n)}static createKeyFieldInFilter(e,t,n){return t==="in"?new cy(e,n):new dy(e,n)}matches(e){const t=e.data.field(this.field);return this.op==="!="?t!==null&&this.matchesComparison(hn(t,this.value)):t!==null&&Ls(this.value)===Ls(t)&&this.matchesComparison(hn(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return Le()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class pr extends zh{constructor(e,t){super(),this.filters=e,this.op=t,this.ae=null}static create(e,t){return new pr(e,t)}matches(e){return Hh(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.ae!==null||(this.ae=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.ae}getFilters(){return Object.assign([],this.filters)}}function Hh(r){return r.op==="and"}function Gh(r){return oy(r)&&Hh(r)}function oy(r){for(const e of r.filters)if(e instanceof pr)return!1;return!0}function rl(r){if(r instanceof _t)return r.field.canonicalString()+r.op.toString()+mn(r.value);if(Gh(r))return r.filters.map(e=>rl(e)).join(",");{const e=r.filters.map(t=>rl(t)).join(",");return`${r.op}(${e})`}}function Kh(r,e){return r instanceof _t?function(n,a){return a instanceof _t&&n.op===a.op&&n.field.isEqual(a.field)&&jr(n.value,a.value)}(r,e):r instanceof pr?function(n,a){return a instanceof pr&&n.op===a.op&&n.filters.length===a.filters.length?n.filters.reduce((i,o,c)=>i&&Kh(o,a.filters[c]),!0):!1}(r,e):void Le()}function Yh(r){return r instanceof _t?function(t){return`${t.field.canonicalString()} ${t.op} ${mn(t.value)}`}(r):r instanceof pr?function(t){return t.op.toString()+" {"+t.getFilters().map(Yh).join(" ,")+"}"}(r):"Filter"}class ly extends _t{constructor(e,t,n){super(e,t,n),this.key=Re.fromName(n.referenceValue)}matches(e){const t=Re.comparator(e.key,this.key);return this.matchesComparison(t)}}class cy extends _t{constructor(e,t){super(e,"in",t),this.keys=Qh("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class dy extends _t{constructor(e,t){super(e,"not-in",t),this.keys=Qh("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function Qh(r,e){var t;return(((t=e.arrayValue)===null||t===void 0?void 0:t.values)||[]).map(n=>Re.fromName(n.referenceValue))}class uy extends _t{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return Al(t)&&oa(t.arrayValue,this.value)}}class hy extends _t{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return t!==null&&oa(this.value.arrayValue,t)}}class my extends _t{constructor(e,t){super(e,"not-in",t)}matches(e){if(oa(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return t!==null&&!oa(this.value.arrayValue,t)}}class gy extends _t{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!Al(t)||!t.arrayValue.values)&&t.arrayValue.values.some(n=>oa(this.value.arrayValue,n))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class py{constructor(e,t=null,n=[],a=[],i=null,o=null,c=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=a,this.limit=i,this.startAt=o,this.endAt=c,this.ue=null}}function Bd(r,e=null,t=[],n=[],a=null,i=null,o=null){return new py(r,e,t,n,a,i,o)}function Cl(r){const e=Be(r);if(e.ue===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(n=>rl(n)).join(","),t+="|ob:",t+=e.orderBy.map(n=>function(i){return i.field.canonicalString()+i.dir}(n)).join(","),qi(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(n=>mn(n)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(n=>mn(n)).join(",")),e.ue=t}return e.ue}function Dl(r,e){if(r.limit!==e.limit||r.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<r.orderBy.length;t++)if(!iy(r.orderBy[t],e.orderBy[t]))return!1;if(r.filters.length!==e.filters.length)return!1;for(let t=0;t<r.filters.length;t++)if(!Kh(r.filters[t],e.filters[t]))return!1;return r.collectionGroup===e.collectionGroup&&!!r.path.isEqual(e.path)&&!!Ud(r.startAt,e.startAt)&&Ud(r.endAt,e.endAt)}function sl(r){return Re.isDocumentKey(r.path)&&r.collectionGroup===null&&r.filters.length===0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wn{constructor(e,t=null,n=[],a=[],i=null,o="F",c=null,d=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=a,this.limit=i,this.limitType=o,this.startAt=c,this.endAt=d,this.ce=null,this.le=null,this.he=null,this.startAt,this.endAt}}function fy(r,e,t,n,a,i,o,c){return new wn(r,e,t,n,a,i,o,c)}function Rl(r){return new wn(r)}function Wd(r){return r.filters.length===0&&r.limit===null&&r.startAt==null&&r.endAt==null&&(r.explicitOrderBy.length===0||r.explicitOrderBy.length===1&&r.explicitOrderBy[0].field.isKeyField())}function Xh(r){return r.collectionGroup!==null}function Kn(r){const e=Be(r);if(e.ce===null){e.ce=[];const t=new Set;for(const i of e.explicitOrderBy)e.ce.push(i),t.add(i.field.canonicalString());const n=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(o){let c=new Ot(Mt.comparator);return o.filters.forEach(d=>{d.getFlattenedFilters().forEach(h=>{h.isInequality()&&(c=c.add(h.field))})}),c})(e).forEach(i=>{t.has(i.canonicalString())||i.isKeyField()||e.ce.push(new la(i,n))}),t.has(Mt.keyField().canonicalString())||e.ce.push(new la(Mt.keyField(),n))}return e.ce}function wr(r){const e=Be(r);return e.le||(e.le=xy(e,Kn(r))),e.le}function xy(r,e){if(r.limitType==="F")return Bd(r.path,r.collectionGroup,e,r.filters,r.limit,r.startAt,r.endAt);{e=e.map(a=>{const i=a.dir==="desc"?"asc":"desc";return new la(a.field,i)});const t=r.endAt?new vi(r.endAt.position,r.endAt.inclusive):null,n=r.startAt?new vi(r.startAt.position,r.startAt.inclusive):null;return Bd(r.path,r.collectionGroup,e,r.filters,r.limit,t,n)}}function nl(r,e){const t=r.filters.concat([e]);return new wn(r.path,r.collectionGroup,r.explicitOrderBy.slice(),t,r.limit,r.limitType,r.startAt,r.endAt)}function al(r,e,t){return new wn(r.path,r.collectionGroup,r.explicitOrderBy.slice(),r.filters.slice(),e,t,r.startAt,r.endAt)}function zi(r,e){return Dl(wr(r),wr(e))&&r.limitType===e.limitType}function Jh(r){return`${Cl(wr(r))}|lt:${r.limitType}`}function Qs(r){return`Query(target=${function(t){let n=t.path.canonicalString();return t.collectionGroup!==null&&(n+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(n+=`, filters: [${t.filters.map(a=>Yh(a)).join(", ")}]`),qi(t.limit)||(n+=", limit: "+t.limit),t.orderBy.length>0&&(n+=`, orderBy: [${t.orderBy.map(a=>function(o){return`${o.field.canonicalString()} (${o.dir})`}(a)).join(", ")}]`),t.startAt&&(n+=", startAt: ",n+=t.startAt.inclusive?"b:":"a:",n+=t.startAt.position.map(a=>mn(a)).join(",")),t.endAt&&(n+=", endAt: ",n+=t.endAt.inclusive?"a:":"b:",n+=t.endAt.position.map(a=>mn(a)).join(",")),`Target(${n})`}(wr(r))}; limitType=${r.limitType})`}function Hi(r,e){return e.isFoundDocument()&&function(n,a){const i=a.key.path;return n.collectionGroup!==null?a.key.hasCollectionId(n.collectionGroup)&&n.path.isPrefixOf(i):Re.isDocumentKey(n.path)?n.path.isEqual(i):n.path.isImmediateParentOf(i)}(r,e)&&function(n,a){for(const i of Kn(n))if(!i.field.isKeyField()&&a.data.field(i.field)===null)return!1;return!0}(r,e)&&function(n,a){for(const i of n.filters)if(!i.matches(a))return!1;return!0}(r,e)&&function(n,a){return!(n.startAt&&!function(o,c,d){const h=Fd(o,c,d);return o.inclusive?h<=0:h<0}(n.startAt,Kn(n),a)||n.endAt&&!function(o,c,d){const h=Fd(o,c,d);return o.inclusive?h>=0:h>0}(n.endAt,Kn(n),a))}(r,e)}function yy(r){return r.collectionGroup||(r.path.length%2==1?r.path.lastSegment():r.path.get(r.path.length-2))}function Zh(r){return(e,t)=>{let n=!1;for(const a of Kn(r)){const i=by(a,e,t);if(i!==0)return i;n=n||a.field.isKeyField()}return 0}}function by(r,e,t){const n=r.field.isKeyField()?Re.comparator(e.key,t.key):function(i,o,c){const d=o.data.field(i),h=c.data.field(i);return d!==null&&h!==null?hn(d,h):Le()}(r.field,e,t);switch(r.dir){case"asc":return n;case"desc":return-1*n;default:return Le()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kn{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),n=this.inner[t];if(n!==void 0){for(const[a,i]of n)if(this.equalsFn(a,e))return i}}has(e){return this.get(e)!==void 0}set(e,t){const n=this.mapKeyFn(e),a=this.inner[n];if(a===void 0)return this.inner[n]=[[e,t]],void this.innerSize++;for(let i=0;i<a.length;i++)if(this.equalsFn(a[i][0],e))return void(a[i]=[e,t]);a.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),n=this.inner[t];if(n===void 0)return!1;for(let a=0;a<n.length;a++)if(this.equalsFn(n[a][0],e))return n.length===1?delete this.inner[t]:n.splice(a,1),this.innerSize--,!0;return!1}forEach(e){Bs(this.inner,(t,n)=>{for(const[a,i]of n)e(a,i)})}isEmpty(){return Bh(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vy=new gt(Re.comparator);function qr(){return vy}const em=new gt(Re.comparator);function Wn(...r){let e=em;for(const t of r)e=e.insert(t.key,t);return e}function tm(r){let e=em;return r.forEach((t,n)=>e=e.insert(t,n.overlayedDocument)),e}function Is(){return Yn()}function rm(){return Yn()}function Yn(){return new kn(r=>r.toString(),(r,e)=>r.isEqual(e))}const wy=new gt(Re.comparator),ky=new Ot(Re.comparator);function Ge(...r){let e=ky;for(const t of r)e=e.add(t);return e}const _y=new Ot(rt);function Ny(){return _y}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Pl(r,e){if(r.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:bi(e)?"-0":e}}function sm(r){return{integerValue:""+r}}function jy(r,e){return ty(e)?sm(e):Pl(r,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gi{constructor(){this._=void 0}}function Ey(r,e,t){return r instanceof wi?function(a,i){const o={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:a.seconds,nanos:a.nanoseconds}}}};return i&&Tl(i)&&(i=Sl(i)),i&&(o.fields.__previous_value__=i),{mapValue:o}}(t,e):r instanceof ca?am(r,e):r instanceof da?im(r,e):function(a,i){const o=nm(a,i),c=qd(o)+qd(a.Pe);return tl(o)&&tl(a.Pe)?sm(c):Pl(a.serializer,c)}(r,e)}function Iy(r,e,t){return r instanceof ca?am(r,e):r instanceof da?im(r,e):t}function nm(r,e){return r instanceof ki?function(n){return tl(n)||function(i){return!!i&&"doubleValue"in i}(n)}(e)?e:{integerValue:0}:null}class wi extends Gi{}class ca extends Gi{constructor(e){super(),this.elements=e}}function am(r,e){const t=om(e);for(const n of r.elements)t.some(a=>jr(a,n))||t.push(n);return{arrayValue:{values:t}}}class da extends Gi{constructor(e){super(),this.elements=e}}function im(r,e){let t=om(e);for(const n of r.elements)t=t.filter(a=>!jr(a,n));return{arrayValue:{values:t}}}class ki extends Gi{constructor(e,t){super(),this.serializer=e,this.Pe=t}}function qd(r){return vt(r.integerValue||r.doubleValue)}function om(r){return Al(r)&&r.arrayValue.values?r.arrayValue.values.slice():[]}function Ty(r,e){return r.field.isEqual(e.field)&&function(n,a){return n instanceof ca&&a instanceof ca||n instanceof da&&a instanceof da?un(n.elements,a.elements,jr):n instanceof ki&&a instanceof ki?jr(n.Pe,a.Pe):n instanceof wi&&a instanceof wi}(r.transform,e.transform)}class Sy{constructor(e,t){this.version=e,this.transformResults=t}}class gr{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new gr}static exists(e){return new gr(void 0,e)}static updateTime(e){return new gr(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function ii(r,e){return r.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(r.updateTime):r.exists===void 0||r.exists===e.isFoundDocument()}class Ki{}function lm(r,e){if(!r.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return r.isNoDocument()?new Ml(r.key,gr.none()):new _a(r.key,r.data,gr.none());{const t=r.data,n=Yt.empty();let a=new Ot(Mt.comparator);for(let i of e.fields)if(!a.has(i)){let o=t.field(i);o===null&&i.length>1&&(i=i.popLast(),o=t.field(i)),o===null?n.delete(i):n.set(i,o),a=a.add(i)}return new bs(r.key,n,new sr(a.toArray()),gr.none())}}function Ay(r,e,t){r instanceof _a?function(a,i,o){const c=a.value.clone(),d=Hd(a.fieldTransforms,i,o.transformResults);c.setAll(d),i.convertToFoundDocument(o.version,c).setHasCommittedMutations()}(r,e,t):r instanceof bs?function(a,i,o){if(!ii(a.precondition,i))return void i.convertToUnknownDocument(o.version);const c=Hd(a.fieldTransforms,i,o.transformResults),d=i.data;d.setAll(cm(a)),d.setAll(c),i.convertToFoundDocument(o.version,d).setHasCommittedMutations()}(r,e,t):function(a,i,o){i.convertToNoDocument(o.version).setHasCommittedMutations()}(0,e,t)}function Qn(r,e,t,n){return r instanceof _a?function(i,o,c,d){if(!ii(i.precondition,o))return c;const h=i.value.clone(),g=Gd(i.fieldTransforms,d,o);return h.setAll(g),o.convertToFoundDocument(o.version,h).setHasLocalMutations(),null}(r,e,t,n):r instanceof bs?function(i,o,c,d){if(!ii(i.precondition,o))return c;const h=Gd(i.fieldTransforms,d,o),g=o.data;return g.setAll(cm(i)),g.setAll(h),o.convertToFoundDocument(o.version,g).setHasLocalMutations(),c===null?null:c.unionWith(i.fieldMask.fields).unionWith(i.fieldTransforms.map(f=>f.field))}(r,e,t,n):function(i,o,c){return ii(i.precondition,o)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):c}(r,e,t)}function Cy(r,e){let t=null;for(const n of r.fieldTransforms){const a=e.data.field(n.field),i=nm(n.transform,a||null);i!=null&&(t===null&&(t=Yt.empty()),t.set(n.field,i))}return t||null}function zd(r,e){return r.type===e.type&&!!r.key.isEqual(e.key)&&!!r.precondition.isEqual(e.precondition)&&!!function(n,a){return n===void 0&&a===void 0||!(!n||!a)&&un(n,a,(i,o)=>Ty(i,o))}(r.fieldTransforms,e.fieldTransforms)&&(r.type===0?r.value.isEqual(e.value):r.type!==1||r.data.isEqual(e.data)&&r.fieldMask.isEqual(e.fieldMask))}class _a extends Ki{constructor(e,t,n,a=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=a,this.type=0}getFieldMask(){return null}}class bs extends Ki{constructor(e,t,n,a,i=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=a,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function cm(r){const e=new Map;return r.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){const n=r.data.field(t);e.set(t,n)}}),e}function Hd(r,e,t){const n=new Map;nt(r.length===t.length);for(let a=0;a<t.length;a++){const i=r[a],o=i.transform,c=e.data.field(i.field);n.set(i.field,Iy(o,c,t[a]))}return n}function Gd(r,e,t){const n=new Map;for(const a of r){const i=a.transform,o=t.data.field(a.field);n.set(a.field,Ey(i,o,e))}return n}class Ml extends Ki{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class Dy extends Ki{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ry{constructor(e,t,n,a){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=a}applyToRemoteDocument(e,t){const n=t.mutationResults;for(let a=0;a<this.mutations.length;a++){const i=this.mutations[a];i.key.isEqual(e.key)&&Ay(i,e,n[a])}}applyToLocalView(e,t){for(const n of this.baseMutations)n.key.isEqual(e.key)&&(t=Qn(n,e,t,this.localWriteTime));for(const n of this.mutations)n.key.isEqual(e.key)&&(t=Qn(n,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const n=rm();return this.mutations.forEach(a=>{const i=e.get(a.key),o=i.overlayedDocument;let c=this.applyToLocalView(o,i.mutatedFields);c=t.has(a.key)?null:c;const d=lm(o,c);d!==null&&n.set(a.key,d),o.isValidDocument()||o.convertToNoDocument(Ue.min())}),n}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),Ge())}isEqual(e){return this.batchId===e.batchId&&un(this.mutations,e.mutations,(t,n)=>zd(t,n))&&un(this.baseMutations,e.baseMutations,(t,n)=>zd(t,n))}}class $l{constructor(e,t,n,a){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=a}static from(e,t,n){nt(e.mutations.length===n.length);let a=function(){return wy}();const i=e.mutations;for(let o=0;o<i.length;o++)a=a.insert(i[o].key,n[o].version);return new $l(e,t,n,a)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Py{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class My{constructor(e,t){this.count=e,this.unchangedNames=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var wt,Je;function $y(r){switch(r){default:return Le();case se.CANCELLED:case se.UNKNOWN:case se.DEADLINE_EXCEEDED:case se.RESOURCE_EXHAUSTED:case se.INTERNAL:case se.UNAVAILABLE:case se.UNAUTHENTICATED:return!1;case se.INVALID_ARGUMENT:case se.NOT_FOUND:case se.ALREADY_EXISTS:case se.PERMISSION_DENIED:case se.FAILED_PRECONDITION:case se.ABORTED:case se.OUT_OF_RANGE:case se.UNIMPLEMENTED:case se.DATA_LOSS:return!0}}function dm(r){if(r===void 0)return Wr("GRPC error has no .code"),se.UNKNOWN;switch(r){case wt.OK:return se.OK;case wt.CANCELLED:return se.CANCELLED;case wt.UNKNOWN:return se.UNKNOWN;case wt.DEADLINE_EXCEEDED:return se.DEADLINE_EXCEEDED;case wt.RESOURCE_EXHAUSTED:return se.RESOURCE_EXHAUSTED;case wt.INTERNAL:return se.INTERNAL;case wt.UNAVAILABLE:return se.UNAVAILABLE;case wt.UNAUTHENTICATED:return se.UNAUTHENTICATED;case wt.INVALID_ARGUMENT:return se.INVALID_ARGUMENT;case wt.NOT_FOUND:return se.NOT_FOUND;case wt.ALREADY_EXISTS:return se.ALREADY_EXISTS;case wt.PERMISSION_DENIED:return se.PERMISSION_DENIED;case wt.FAILED_PRECONDITION:return se.FAILED_PRECONDITION;case wt.ABORTED:return se.ABORTED;case wt.OUT_OF_RANGE:return se.OUT_OF_RANGE;case wt.UNIMPLEMENTED:return se.UNIMPLEMENTED;case wt.DATA_LOSS:return se.DATA_LOSS;default:return Le()}}(Je=wt||(wt={}))[Je.OK=0]="OK",Je[Je.CANCELLED=1]="CANCELLED",Je[Je.UNKNOWN=2]="UNKNOWN",Je[Je.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Je[Je.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Je[Je.NOT_FOUND=5]="NOT_FOUND",Je[Je.ALREADY_EXISTS=6]="ALREADY_EXISTS",Je[Je.PERMISSION_DENIED=7]="PERMISSION_DENIED",Je[Je.UNAUTHENTICATED=16]="UNAUTHENTICATED",Je[Je.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Je[Je.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Je[Je.ABORTED=10]="ABORTED",Je[Je.OUT_OF_RANGE=11]="OUT_OF_RANGE",Je[Je.UNIMPLEMENTED=12]="UNIMPLEMENTED",Je[Je.INTERNAL=13]="INTERNAL",Je[Je.UNAVAILABLE=14]="UNAVAILABLE",Je[Je.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Oy(){return new TextEncoder}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Vy=new As([4294967295,4294967295],0);function Kd(r){const e=Oy().encode(r),t=new Ph;return t.update(e),new Uint8Array(t.digest())}function Yd(r){const e=new DataView(r.buffer),t=e.getUint32(0,!0),n=e.getUint32(4,!0),a=e.getUint32(8,!0),i=e.getUint32(12,!0);return[new As([t,n],0),new As([a,i],0)]}class Ol{constructor(e,t,n){if(this.bitmap=e,this.padding=t,this.hashCount=n,t<0||t>=8)throw new qn(`Invalid padding: ${t}`);if(n<0)throw new qn(`Invalid hash count: ${n}`);if(e.length>0&&this.hashCount===0)throw new qn(`Invalid hash count: ${n}`);if(e.length===0&&t!==0)throw new qn(`Invalid padding when bitmap length is 0: ${t}`);this.Ie=8*e.length-t,this.Te=As.fromNumber(this.Ie)}Ee(e,t,n){let a=e.add(t.multiply(As.fromNumber(n)));return a.compare(Vy)===1&&(a=new As([a.getBits(0),a.getBits(1)],0)),a.modulo(this.Te).toNumber()}de(e){return(this.bitmap[Math.floor(e/8)]&1<<e%8)!=0}mightContain(e){if(this.Ie===0)return!1;const t=Kd(e),[n,a]=Yd(t);for(let i=0;i<this.hashCount;i++){const o=this.Ee(n,a,i);if(!this.de(o))return!1}return!0}static create(e,t,n){const a=e%8==0?0:8-e%8,i=new Uint8Array(Math.ceil(e/8)),o=new Ol(i,a,t);return n.forEach(c=>o.insert(c)),o}insert(e){if(this.Ie===0)return;const t=Kd(e),[n,a]=Yd(t);for(let i=0;i<this.hashCount;i++){const o=this.Ee(n,a,i);this.Ae(o)}}Ae(e){const t=Math.floor(e/8),n=e%8;this.bitmap[t]|=1<<n}}class qn extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yi{constructor(e,t,n,a,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=a,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,n){const a=new Map;return a.set(e,Na.createSynthesizedTargetChangeForCurrentChange(e,t,n)),new Yi(Ue.min(),a,new gt(rt),qr(),Ge())}}class Na{constructor(e,t,n,a,i){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=a,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,n){return new Na(n,t,Ge(),Ge(),Ge())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oi{constructor(e,t,n,a){this.Re=e,this.removedTargetIds=t,this.key=n,this.Ve=a}}class um{constructor(e,t){this.targetId=e,this.me=t}}class hm{constructor(e,t,n=Vt.EMPTY_BYTE_STRING,a=null){this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=a}}class Qd{constructor(){this.fe=0,this.ge=Jd(),this.pe=Vt.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return this.fe!==0}get be(){return this.we}De(e){e.approximateByteSize()>0&&(this.we=!0,this.pe=e)}ve(){let e=Ge(),t=Ge(),n=Ge();return this.ge.forEach((a,i)=>{switch(i){case 0:e=e.add(a);break;case 2:t=t.add(a);break;case 1:n=n.add(a);break;default:Le()}}),new Na(this.pe,this.ye,e,t,n)}Ce(){this.we=!1,this.ge=Jd()}Fe(e,t){this.we=!0,this.ge=this.ge.insert(e,t)}Me(e){this.we=!0,this.ge=this.ge.remove(e)}xe(){this.fe+=1}Oe(){this.fe-=1,nt(this.fe>=0)}Ne(){this.we=!0,this.ye=!0}}class Ly{constructor(e){this.Le=e,this.Be=new Map,this.ke=qr(),this.qe=Xd(),this.Qe=new gt(rt)}Ke(e){for(const t of e.Re)e.Ve&&e.Ve.isFoundDocument()?this.$e(t,e.Ve):this.Ue(t,e.key,e.Ve);for(const t of e.removedTargetIds)this.Ue(t,e.key,e.Ve)}We(e){this.forEachTarget(e,t=>{const n=this.Ge(t);switch(e.state){case 0:this.ze(t)&&n.De(e.resumeToken);break;case 1:n.Oe(),n.Se||n.Ce(),n.De(e.resumeToken);break;case 2:n.Oe(),n.Se||this.removeTarget(t);break;case 3:this.ze(t)&&(n.Ne(),n.De(e.resumeToken));break;case 4:this.ze(t)&&(this.je(t),n.De(e.resumeToken));break;default:Le()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Be.forEach((n,a)=>{this.ze(a)&&t(a)})}He(e){const t=e.targetId,n=e.me.count,a=this.Je(t);if(a){const i=a.target;if(sl(i))if(n===0){const o=new Re(i.path);this.Ue(t,o,Wt.newNoDocument(o,Ue.min()))}else nt(n===1);else{const o=this.Ye(t);if(o!==n){const c=this.Ze(e),d=c?this.Xe(c,e,o):1;if(d!==0){this.je(t);const h=d===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Qe=this.Qe.insert(t,h)}}}}}Ze(e){const t=e.me.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:n="",padding:a=0},hashCount:i=0}=t;let o,c;try{o=Vs(n).toUint8Array()}catch(d){if(d instanceof Wh)return dn("Decoding the base64 bloom filter in existence filter failed ("+d.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw d}try{c=new Ol(o,a,i)}catch(d){return dn(d instanceof qn?"BloomFilter error: ":"Applying bloom filter failed: ",d),null}return c.Ie===0?null:c}Xe(e,t,n){return t.me.count===n-this.nt(e,t.targetId)?0:2}nt(e,t){const n=this.Le.getRemoteKeysForTarget(t);let a=0;return n.forEach(i=>{const o=this.Le.tt(),c=`projects/${o.projectId}/databases/${o.database}/documents/${i.path.canonicalString()}`;e.mightContain(c)||(this.Ue(t,i,null),a++)}),a}rt(e){const t=new Map;this.Be.forEach((i,o)=>{const c=this.Je(o);if(c){if(i.current&&sl(c.target)){const d=new Re(c.target.path);this.ke.get(d)!==null||this.it(o,d)||this.Ue(o,d,Wt.newNoDocument(d,e))}i.be&&(t.set(o,i.ve()),i.Ce())}});let n=Ge();this.qe.forEach((i,o)=>{let c=!0;o.forEachWhile(d=>{const h=this.Je(d);return!h||h.purpose==="TargetPurposeLimboResolution"||(c=!1,!1)}),c&&(n=n.add(i))}),this.ke.forEach((i,o)=>o.setReadTime(e));const a=new Yi(e,t,this.Qe,this.ke,n);return this.ke=qr(),this.qe=Xd(),this.Qe=new gt(rt),a}$e(e,t){if(!this.ze(e))return;const n=this.it(e,t.key)?2:0;this.Ge(e).Fe(t.key,n),this.ke=this.ke.insert(t.key,t),this.qe=this.qe.insert(t.key,this.st(t.key).add(e))}Ue(e,t,n){if(!this.ze(e))return;const a=this.Ge(e);this.it(e,t)?a.Fe(t,1):a.Me(t),this.qe=this.qe.insert(t,this.st(t).delete(e)),n&&(this.ke=this.ke.insert(t,n))}removeTarget(e){this.Be.delete(e)}Ye(e){const t=this.Ge(e).ve();return this.Le.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}xe(e){this.Ge(e).xe()}Ge(e){let t=this.Be.get(e);return t||(t=new Qd,this.Be.set(e,t)),t}st(e){let t=this.qe.get(e);return t||(t=new Ot(rt),this.qe=this.qe.insert(e,t)),t}ze(e){const t=this.Je(e)!==null;return t||Ee("WatchChangeAggregator","Detected inactive target",e),t}Je(e){const t=this.Be.get(e);return t&&t.Se?null:this.Le.ot(e)}je(e){this.Be.set(e,new Qd),this.Le.getRemoteKeysForTarget(e).forEach(t=>{this.Ue(e,t,null)})}it(e,t){return this.Le.getRemoteKeysForTarget(e).has(t)}}function Xd(){return new gt(Re.comparator)}function Jd(){return new gt(Re.comparator)}const Fy={asc:"ASCENDING",desc:"DESCENDING"},Uy={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},By={and:"AND",or:"OR"};class Wy{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function il(r,e){return r.useProto3Json||qi(e)?e:{value:e}}function _i(r,e){return r.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function mm(r,e){return r.useProto3Json?e.toBase64():e.toUint8Array()}function qy(r,e){return _i(r,e.toTimestamp())}function kr(r){return nt(!!r),Ue.fromTimestamp(function(t){const n=xs(t);return new It(n.seconds,n.nanos)}(r))}function Vl(r,e){return ol(r,e).canonicalString()}function ol(r,e){const t=function(a){return new ht(["projects",a.projectId,"databases",a.database])}(r).child("documents");return e===void 0?t:t.child(e)}function gm(r){const e=ht.fromString(r);return nt(bm(e)),e}function ll(r,e){return Vl(r.databaseId,e.path)}function $o(r,e){const t=gm(e);if(t.get(1)!==r.databaseId.projectId)throw new ke(se.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+r.databaseId.projectId);if(t.get(3)!==r.databaseId.database)throw new ke(se.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+r.databaseId.database);return new Re(fm(t))}function pm(r,e){return Vl(r.databaseId,e)}function zy(r){const e=gm(r);return e.length===4?ht.emptyPath():fm(e)}function cl(r){return new ht(["projects",r.databaseId.projectId,"databases",r.databaseId.database]).canonicalString()}function fm(r){return nt(r.length>4&&r.get(4)==="documents"),r.popFirst(5)}function Zd(r,e,t){return{name:ll(r,e),fields:t.value.mapValue.fields}}function Hy(r,e){let t;if("targetChange"in e){e.targetChange;const n=function(h){return h==="NO_CHANGE"?0:h==="ADD"?1:h==="REMOVE"?2:h==="CURRENT"?3:h==="RESET"?4:Le()}(e.targetChange.targetChangeType||"NO_CHANGE"),a=e.targetChange.targetIds||[],i=function(h,g){return h.useProto3Json?(nt(g===void 0||typeof g=="string"),Vt.fromBase64String(g||"")):(nt(g===void 0||g instanceof Buffer||g instanceof Uint8Array),Vt.fromUint8Array(g||new Uint8Array))}(r,e.targetChange.resumeToken),o=e.targetChange.cause,c=o&&function(h){const g=h.code===void 0?se.UNKNOWN:dm(h.code);return new ke(g,h.message||"")}(o);t=new hm(n,a,i,c||null)}else if("documentChange"in e){e.documentChange;const n=e.documentChange;n.document,n.document.name,n.document.updateTime;const a=$o(r,n.document.name),i=kr(n.document.updateTime),o=n.document.createTime?kr(n.document.createTime):Ue.min(),c=new Yt({mapValue:{fields:n.document.fields}}),d=Wt.newFoundDocument(a,i,o,c),h=n.targetIds||[],g=n.removedTargetIds||[];t=new oi(h,g,d.key,d)}else if("documentDelete"in e){e.documentDelete;const n=e.documentDelete;n.document;const a=$o(r,n.document),i=n.readTime?kr(n.readTime):Ue.min(),o=Wt.newNoDocument(a,i),c=n.removedTargetIds||[];t=new oi([],c,o.key,o)}else if("documentRemove"in e){e.documentRemove;const n=e.documentRemove;n.document;const a=$o(r,n.document),i=n.removedTargetIds||[];t=new oi([],i,a,null)}else{if(!("filter"in e))return Le();{e.filter;const n=e.filter;n.targetId;const{count:a=0,unchangedNames:i}=n,o=new My(a,i),c=n.targetId;t=new um(c,o)}}return t}function Gy(r,e){let t;if(e instanceof _a)t={update:Zd(r,e.key,e.value)};else if(e instanceof Ml)t={delete:ll(r,e.key)};else if(e instanceof bs)t={update:Zd(r,e.key,e.data),updateMask:rb(e.fieldMask)};else{if(!(e instanceof Dy))return Le();t={verify:ll(r,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(n=>function(i,o){const c=o.transform;if(c instanceof wi)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(c instanceof ca)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:c.elements}};if(c instanceof da)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:c.elements}};if(c instanceof ki)return{fieldPath:o.field.canonicalString(),increment:c.Pe};throw Le()}(0,n))),e.precondition.isNone||(t.currentDocument=function(a,i){return i.updateTime!==void 0?{updateTime:qy(a,i.updateTime)}:i.exists!==void 0?{exists:i.exists}:Le()}(r,e.precondition)),t}function Ky(r,e){return r&&r.length>0?(nt(e!==void 0),r.map(t=>function(a,i){let o=a.updateTime?kr(a.updateTime):kr(i);return o.isEqual(Ue.min())&&(o=kr(i)),new Sy(o,a.transformResults||[])}(t,e))):[]}function Yy(r,e){return{documents:[pm(r,e.path)]}}function Qy(r,e){const t={structuredQuery:{}},n=e.path;let a;e.collectionGroup!==null?(a=n,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(a=n.popLast(),t.structuredQuery.from=[{collectionId:n.lastSegment()}]),t.parent=pm(r,a);const i=function(h){if(h.length!==0)return ym(pr.create(h,"and"))}(e.filters);i&&(t.structuredQuery.where=i);const o=function(h){if(h.length!==0)return h.map(g=>function(p){return{field:Xs(p.field),direction:Zy(p.dir)}}(g))}(e.orderBy);o&&(t.structuredQuery.orderBy=o);const c=il(r,e.limit);return c!==null&&(t.structuredQuery.limit=c),e.startAt&&(t.structuredQuery.startAt=function(h){return{before:h.inclusive,values:h.position}}(e.startAt)),e.endAt&&(t.structuredQuery.endAt=function(h){return{before:!h.inclusive,values:h.position}}(e.endAt)),{_t:t,parent:a}}function Xy(r){let e=zy(r.parent);const t=r.structuredQuery,n=t.from?t.from.length:0;let a=null;if(n>0){nt(n===1);const g=t.from[0];g.allDescendants?a=g.collectionId:e=e.child(g.collectionId)}let i=[];t.where&&(i=function(f){const p=xm(f);return p instanceof pr&&Gh(p)?p.getFilters():[p]}(t.where));let o=[];t.orderBy&&(o=function(f){return f.map(p=>function(A){return new la(Js(A.field),function(S){switch(S){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(A.direction))}(p))}(t.orderBy));let c=null;t.limit&&(c=function(f){let p;return p=typeof f=="object"?f.value:f,qi(p)?null:p}(t.limit));let d=null;t.startAt&&(d=function(f){const p=!!f.before,v=f.values||[];return new vi(v,p)}(t.startAt));let h=null;return t.endAt&&(h=function(f){const p=!f.before,v=f.values||[];return new vi(v,p)}(t.endAt)),fy(e,a,o,i,c,"F",d,h)}function Jy(r,e){const t=function(a){switch(a){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return Le()}}(e.purpose);return t==null?null:{"goog-listen-tags":t}}function xm(r){return r.unaryFilter!==void 0?function(t){switch(t.unaryFilter.op){case"IS_NAN":const n=Js(t.unaryFilter.field);return _t.create(n,"==",{doubleValue:NaN});case"IS_NULL":const a=Js(t.unaryFilter.field);return _t.create(a,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const i=Js(t.unaryFilter.field);return _t.create(i,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const o=Js(t.unaryFilter.field);return _t.create(o,"!=",{nullValue:"NULL_VALUE"});default:return Le()}}(r):r.fieldFilter!==void 0?function(t){return _t.create(Js(t.fieldFilter.field),function(a){switch(a){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return Le()}}(t.fieldFilter.op),t.fieldFilter.value)}(r):r.compositeFilter!==void 0?function(t){return pr.create(t.compositeFilter.filters.map(n=>xm(n)),function(a){switch(a){case"AND":return"and";case"OR":return"or";default:return Le()}}(t.compositeFilter.op))}(r):Le()}function Zy(r){return Fy[r]}function eb(r){return Uy[r]}function tb(r){return By[r]}function Xs(r){return{fieldPath:r.canonicalString()}}function Js(r){return Mt.fromServerFormat(r.fieldPath)}function ym(r){return r instanceof _t?function(t){if(t.op==="=="){if(Ld(t.value))return{unaryFilter:{field:Xs(t.field),op:"IS_NAN"}};if(Vd(t.value))return{unaryFilter:{field:Xs(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(Ld(t.value))return{unaryFilter:{field:Xs(t.field),op:"IS_NOT_NAN"}};if(Vd(t.value))return{unaryFilter:{field:Xs(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Xs(t.field),op:eb(t.op),value:t.value}}}(r):r instanceof pr?function(t){const n=t.getFilters().map(a=>ym(a));return n.length===1?n[0]:{compositeFilter:{op:tb(t.op),filters:n}}}(r):Le()}function rb(r){const e=[];return r.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function bm(r){return r.length>=4&&r.get(0)==="projects"&&r.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cs{constructor(e,t,n,a,i=Ue.min(),o=Ue.min(),c=Vt.EMPTY_BYTE_STRING,d=null){this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=a,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=c,this.expectedCount=d}withSequenceNumber(e){return new cs(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new cs(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new cs(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new cs(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sb{constructor(e){this.ct=e}}function nb(r){const e=Xy({parent:r.parent,structuredQuery:r.structuredQuery});return r.limitType==="LAST"?al(e,e.limit,"L"):e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ab{constructor(){this.un=new ib}addToCollectionParentIndex(e,t){return this.un.add(t),le.resolve()}getCollectionParents(e,t){return le.resolve(this.un.getEntries(t))}addFieldIndex(e,t){return le.resolve()}deleteFieldIndex(e,t){return le.resolve()}deleteAllFieldIndexes(e){return le.resolve()}createTargetIndexes(e,t){return le.resolve()}getDocumentsMatchingTarget(e,t){return le.resolve(null)}getIndexType(e,t){return le.resolve(0)}getFieldIndexes(e,t){return le.resolve([])}getNextCollectionGroupToUpdate(e){return le.resolve(null)}getMinOffset(e,t){return le.resolve(fs.min())}getMinOffsetFromCollectionGroup(e,t){return le.resolve(fs.min())}updateCollectionGroup(e,t,n){return le.resolve()}updateIndexEntries(e,t){return le.resolve()}}class ib{constructor(){this.index={}}add(e){const t=e.lastSegment(),n=e.popLast(),a=this.index[t]||new Ot(ht.comparator),i=!a.has(n);return this.index[t]=a.add(n),i}has(e){const t=e.lastSegment(),n=e.popLast(),a=this.index[t];return a&&a.has(n)}getEntries(e){return(this.index[e]||new Ot(ht.comparator)).toArray()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gn{constructor(e){this.Ln=e}next(){return this.Ln+=2,this.Ln}static Bn(){return new gn(0)}static kn(){return new gn(-1)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ob{constructor(){this.changes=new kn(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,Wt.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const n=this.changes.get(t);return n!==void 0?le.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lb{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cb{constructor(e,t,n,a){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=a}getDocument(e,t){let n=null;return this.documentOverlayCache.getOverlay(e,t).next(a=>(n=a,this.remoteDocumentCache.getEntry(e,t))).next(a=>(n!==null&&Qn(n.mutation,a,sr.empty(),It.now()),a))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(n=>this.getLocalViewOfDocuments(e,n,Ge()).next(()=>n))}getLocalViewOfDocuments(e,t,n=Ge()){const a=Is();return this.populateOverlays(e,a,t).next(()=>this.computeViews(e,t,a,n).next(i=>{let o=Wn();return i.forEach((c,d)=>{o=o.insert(c,d.overlayedDocument)}),o}))}getOverlayedDocuments(e,t){const n=Is();return this.populateOverlays(e,n,t).next(()=>this.computeViews(e,t,n,Ge()))}populateOverlays(e,t,n){const a=[];return n.forEach(i=>{t.has(i)||a.push(i)}),this.documentOverlayCache.getOverlays(e,a).next(i=>{i.forEach((o,c)=>{t.set(o,c)})})}computeViews(e,t,n,a){let i=qr();const o=Yn(),c=function(){return Yn()}();return t.forEach((d,h)=>{const g=n.get(h.key);a.has(h.key)&&(g===void 0||g.mutation instanceof bs)?i=i.insert(h.key,h):g!==void 0?(o.set(h.key,g.mutation.getFieldMask()),Qn(g.mutation,h,g.mutation.getFieldMask(),It.now())):o.set(h.key,sr.empty())}),this.recalculateAndSaveOverlays(e,i).next(d=>(d.forEach((h,g)=>o.set(h,g)),t.forEach((h,g)=>{var f;return c.set(h,new lb(g,(f=o.get(h))!==null&&f!==void 0?f:null))}),c))}recalculateAndSaveOverlays(e,t){const n=Yn();let a=new gt((o,c)=>o-c),i=Ge();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(o=>{for(const c of o)c.keys().forEach(d=>{const h=t.get(d);if(h===null)return;let g=n.get(d)||sr.empty();g=c.applyToLocalView(h,g),n.set(d,g);const f=(a.get(c.batchId)||Ge()).add(d);a=a.insert(c.batchId,f)})}).next(()=>{const o=[],c=a.getReverseIterator();for(;c.hasNext();){const d=c.getNext(),h=d.key,g=d.value,f=rm();g.forEach(p=>{if(!i.has(p)){const v=lm(t.get(p),n.get(p));v!==null&&f.set(p,v),i=i.add(p)}}),o.push(this.documentOverlayCache.saveOverlays(e,h,f))}return le.waitFor(o)}).next(()=>n)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(n=>this.recalculateAndSaveOverlays(e,n))}getDocumentsMatchingQuery(e,t,n,a){return function(o){return Re.isDocumentKey(o.path)&&o.collectionGroup===null&&o.filters.length===0}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):Xh(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n,a):this.getDocumentsMatchingCollectionQuery(e,t,n,a)}getNextDocuments(e,t,n,a){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,n,a).next(i=>{const o=a-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,n.largestBatchId,a-i.size):le.resolve(Is());let c=-1,d=i;return o.next(h=>le.forEach(h,(g,f)=>(c<f.largestBatchId&&(c=f.largestBatchId),i.get(g)?le.resolve():this.remoteDocumentCache.getEntry(e,g).next(p=>{d=d.insert(g,p)}))).next(()=>this.populateOverlays(e,h,i)).next(()=>this.computeViews(e,d,h,Ge())).next(g=>({batchId:c,changes:tm(g)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new Re(t)).next(n=>{let a=Wn();return n.isFoundDocument()&&(a=a.insert(n.key,n)),a})}getDocumentsMatchingCollectionGroupQuery(e,t,n,a){const i=t.collectionGroup;let o=Wn();return this.indexManager.getCollectionParents(e,i).next(c=>le.forEach(c,d=>{const h=function(f,p){return new wn(p,null,f.explicitOrderBy.slice(),f.filters.slice(),f.limit,f.limitType,f.startAt,f.endAt)}(t,d.child(i));return this.getDocumentsMatchingCollectionQuery(e,h,n,a).next(g=>{g.forEach((f,p)=>{o=o.insert(f,p)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(e,t,n,a){let i;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,n.largestBatchId).next(o=>(i=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,n,i,a))).next(o=>{i.forEach((d,h)=>{const g=h.getKey();o.get(g)===null&&(o=o.insert(g,Wt.newInvalidDocument(g)))});let c=Wn();return o.forEach((d,h)=>{const g=i.get(d);g!==void 0&&Qn(g.mutation,h,sr.empty(),It.now()),Hi(t,h)&&(c=c.insert(d,h))}),c})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class db{constructor(e){this.serializer=e,this.hr=new Map,this.Pr=new Map}getBundleMetadata(e,t){return le.resolve(this.hr.get(t))}saveBundleMetadata(e,t){return this.hr.set(t.id,function(a){return{id:a.id,version:a.version,createTime:kr(a.createTime)}}(t)),le.resolve()}getNamedQuery(e,t){return le.resolve(this.Pr.get(t))}saveNamedQuery(e,t){return this.Pr.set(t.name,function(a){return{name:a.name,query:nb(a.bundledQuery),readTime:kr(a.readTime)}}(t)),le.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ub{constructor(){this.overlays=new gt(Re.comparator),this.Ir=new Map}getOverlay(e,t){return le.resolve(this.overlays.get(t))}getOverlays(e,t){const n=Is();return le.forEach(t,a=>this.getOverlay(e,a).next(i=>{i!==null&&n.set(a,i)})).next(()=>n)}saveOverlays(e,t,n){return n.forEach((a,i)=>{this.ht(e,t,i)}),le.resolve()}removeOverlaysForBatchId(e,t,n){const a=this.Ir.get(n);return a!==void 0&&(a.forEach(i=>this.overlays=this.overlays.remove(i)),this.Ir.delete(n)),le.resolve()}getOverlaysForCollection(e,t,n){const a=Is(),i=t.length+1,o=new Re(t.child("")),c=this.overlays.getIteratorFrom(o);for(;c.hasNext();){const d=c.getNext().value,h=d.getKey();if(!t.isPrefixOf(h.path))break;h.path.length===i&&d.largestBatchId>n&&a.set(d.getKey(),d)}return le.resolve(a)}getOverlaysForCollectionGroup(e,t,n,a){let i=new gt((h,g)=>h-g);const o=this.overlays.getIterator();for(;o.hasNext();){const h=o.getNext().value;if(h.getKey().getCollectionGroup()===t&&h.largestBatchId>n){let g=i.get(h.largestBatchId);g===null&&(g=Is(),i=i.insert(h.largestBatchId,g)),g.set(h.getKey(),h)}}const c=Is(),d=i.getIterator();for(;d.hasNext()&&(d.getNext().value.forEach((h,g)=>c.set(h,g)),!(c.size()>=a)););return le.resolve(c)}ht(e,t,n){const a=this.overlays.get(n.key);if(a!==null){const o=this.Ir.get(a.largestBatchId).delete(n.key);this.Ir.set(a.largestBatchId,o)}this.overlays=this.overlays.insert(n.key,new Py(t,n));let i=this.Ir.get(t);i===void 0&&(i=Ge(),this.Ir.set(t,i)),this.Ir.set(t,i.add(n.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hb{constructor(){this.sessionToken=Vt.EMPTY_BYTE_STRING}getSessionToken(e){return le.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,le.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ll{constructor(){this.Tr=new Ot(Tt.Er),this.dr=new Ot(Tt.Ar)}isEmpty(){return this.Tr.isEmpty()}addReference(e,t){const n=new Tt(e,t);this.Tr=this.Tr.add(n),this.dr=this.dr.add(n)}Rr(e,t){e.forEach(n=>this.addReference(n,t))}removeReference(e,t){this.Vr(new Tt(e,t))}mr(e,t){e.forEach(n=>this.removeReference(n,t))}gr(e){const t=new Re(new ht([])),n=new Tt(t,e),a=new Tt(t,e+1),i=[];return this.dr.forEachInRange([n,a],o=>{this.Vr(o),i.push(o.key)}),i}pr(){this.Tr.forEach(e=>this.Vr(e))}Vr(e){this.Tr=this.Tr.delete(e),this.dr=this.dr.delete(e)}yr(e){const t=new Re(new ht([])),n=new Tt(t,e),a=new Tt(t,e+1);let i=Ge();return this.dr.forEachInRange([n,a],o=>{i=i.add(o.key)}),i}containsKey(e){const t=new Tt(e,0),n=this.Tr.firstAfterOrEqual(t);return n!==null&&e.isEqual(n.key)}}class Tt{constructor(e,t){this.key=e,this.wr=t}static Er(e,t){return Re.comparator(e.key,t.key)||rt(e.wr,t.wr)}static Ar(e,t){return rt(e.wr,t.wr)||Re.comparator(e.key,t.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mb{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.Sr=1,this.br=new Ot(Tt.Er)}checkEmpty(e){return le.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,n,a){const i=this.Sr;this.Sr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const o=new Ry(i,t,n,a);this.mutationQueue.push(o);for(const c of a)this.br=this.br.add(new Tt(c.key,i)),this.indexManager.addToCollectionParentIndex(e,c.key.path.popLast());return le.resolve(o)}lookupMutationBatch(e,t){return le.resolve(this.Dr(t))}getNextMutationBatchAfterBatchId(e,t){const n=t+1,a=this.vr(n),i=a<0?0:a;return le.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return le.resolve(this.mutationQueue.length===0?-1:this.Sr-1)}getAllMutationBatches(e){return le.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const n=new Tt(t,0),a=new Tt(t,Number.POSITIVE_INFINITY),i=[];return this.br.forEachInRange([n,a],o=>{const c=this.Dr(o.wr);i.push(c)}),le.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new Ot(rt);return t.forEach(a=>{const i=new Tt(a,0),o=new Tt(a,Number.POSITIVE_INFINITY);this.br.forEachInRange([i,o],c=>{n=n.add(c.wr)})}),le.resolve(this.Cr(n))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,a=n.length+1;let i=n;Re.isDocumentKey(i)||(i=i.child(""));const o=new Tt(new Re(i),0);let c=new Ot(rt);return this.br.forEachWhile(d=>{const h=d.key.path;return!!n.isPrefixOf(h)&&(h.length===a&&(c=c.add(d.wr)),!0)},o),le.resolve(this.Cr(c))}Cr(e){const t=[];return e.forEach(n=>{const a=this.Dr(n);a!==null&&t.push(a)}),t}removeMutationBatch(e,t){nt(this.Fr(t.batchId,"removed")===0),this.mutationQueue.shift();let n=this.br;return le.forEach(t.mutations,a=>{const i=new Tt(a.key,t.batchId);return n=n.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,a.key)}).next(()=>{this.br=n})}On(e){}containsKey(e,t){const n=new Tt(t,0),a=this.br.firstAfterOrEqual(n);return le.resolve(t.isEqual(a&&a.key))}performConsistencyCheck(e){return this.mutationQueue.length,le.resolve()}Fr(e,t){return this.vr(e)}vr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Dr(e){const t=this.vr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gb{constructor(e){this.Mr=e,this.docs=function(){return new gt(Re.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const n=t.key,a=this.docs.get(n),i=a?a.size:0,o=this.Mr(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:o}),this.size+=o-i,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const n=this.docs.get(t);return le.resolve(n?n.document.mutableCopy():Wt.newInvalidDocument(t))}getEntries(e,t){let n=qr();return t.forEach(a=>{const i=this.docs.get(a);n=n.insert(a,i?i.document.mutableCopy():Wt.newInvalidDocument(a))}),le.resolve(n)}getDocumentsMatchingQuery(e,t,n,a){let i=qr();const o=t.path,c=new Re(o.child("")),d=this.docs.getIteratorFrom(c);for(;d.hasNext();){const{key:h,value:{document:g}}=d.getNext();if(!o.isPrefixOf(h.path))break;h.path.length>o.length+1||Xx(Qx(g),n)<=0||(a.has(g.key)||Hi(t,g))&&(i=i.insert(g.key,g.mutableCopy()))}return le.resolve(i)}getAllFromCollectionGroup(e,t,n,a){Le()}Or(e,t){return le.forEach(this.docs,n=>t(n))}newChangeBuffer(e){return new pb(this)}getSize(e){return le.resolve(this.size)}}class pb extends ob{constructor(e){super(),this.cr=e}applyChanges(e){const t=[];return this.changes.forEach((n,a)=>{a.isValidDocument()?t.push(this.cr.addEntry(e,a)):this.cr.removeEntry(n)}),le.waitFor(t)}getFromCache(e,t){return this.cr.getEntry(e,t)}getAllFromCache(e,t){return this.cr.getEntries(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fb{constructor(e){this.persistence=e,this.Nr=new kn(t=>Cl(t),Dl),this.lastRemoteSnapshotVersion=Ue.min(),this.highestTargetId=0,this.Lr=0,this.Br=new Ll,this.targetCount=0,this.kr=gn.Bn()}forEachTarget(e,t){return this.Nr.forEach((n,a)=>t(a)),le.resolve()}getLastRemoteSnapshotVersion(e){return le.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return le.resolve(this.Lr)}allocateTargetId(e){return this.highestTargetId=this.kr.next(),le.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.Lr&&(this.Lr=t),le.resolve()}Kn(e){this.Nr.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.kr=new gn(t),this.highestTargetId=t),e.sequenceNumber>this.Lr&&(this.Lr=e.sequenceNumber)}addTargetData(e,t){return this.Kn(t),this.targetCount+=1,le.resolve()}updateTargetData(e,t){return this.Kn(t),le.resolve()}removeTargetData(e,t){return this.Nr.delete(t.target),this.Br.gr(t.targetId),this.targetCount-=1,le.resolve()}removeTargets(e,t,n){let a=0;const i=[];return this.Nr.forEach((o,c)=>{c.sequenceNumber<=t&&n.get(c.targetId)===null&&(this.Nr.delete(o),i.push(this.removeMatchingKeysForTargetId(e,c.targetId)),a++)}),le.waitFor(i).next(()=>a)}getTargetCount(e){return le.resolve(this.targetCount)}getTargetData(e,t){const n=this.Nr.get(t)||null;return le.resolve(n)}addMatchingKeys(e,t,n){return this.Br.Rr(t,n),le.resolve()}removeMatchingKeys(e,t,n){this.Br.mr(t,n);const a=this.persistence.referenceDelegate,i=[];return a&&t.forEach(o=>{i.push(a.markPotentiallyOrphaned(e,o))}),le.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this.Br.gr(t),le.resolve()}getMatchingKeysForTargetId(e,t){const n=this.Br.yr(t);return le.resolve(n)}containsKey(e,t){return le.resolve(this.Br.containsKey(t))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xb{constructor(e,t){this.qr={},this.overlays={},this.Qr=new Il(0),this.Kr=!1,this.Kr=!0,this.$r=new hb,this.referenceDelegate=e(this),this.Ur=new fb(this),this.indexManager=new ab,this.remoteDocumentCache=function(a){return new gb(a)}(n=>this.referenceDelegate.Wr(n)),this.serializer=new sb(t),this.Gr=new db(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Kr=!1,Promise.resolve()}get started(){return this.Kr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new ub,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this.qr[e.toKey()];return n||(n=new mb(t,this.referenceDelegate),this.qr[e.toKey()]=n),n}getGlobalsCache(){return this.$r}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Gr}runTransaction(e,t,n){Ee("MemoryPersistence","Starting transaction:",e);const a=new yb(this.Qr.next());return this.referenceDelegate.zr(),n(a).next(i=>this.referenceDelegate.jr(a).next(()=>i)).toPromise().then(i=>(a.raiseOnCommittedEvent(),i))}Hr(e,t){return le.or(Object.values(this.qr).map(n=>()=>n.containsKey(e,t)))}}class yb extends Zx{constructor(e){super(),this.currentSequenceNumber=e}}class Fl{constructor(e){this.persistence=e,this.Jr=new Ll,this.Yr=null}static Zr(e){return new Fl(e)}get Xr(){if(this.Yr)return this.Yr;throw Le()}addReference(e,t,n){return this.Jr.addReference(n,t),this.Xr.delete(n.toString()),le.resolve()}removeReference(e,t,n){return this.Jr.removeReference(n,t),this.Xr.add(n.toString()),le.resolve()}markPotentiallyOrphaned(e,t){return this.Xr.add(t.toString()),le.resolve()}removeTarget(e,t){this.Jr.gr(t.targetId).forEach(a=>this.Xr.add(a.toString()));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next(a=>{a.forEach(i=>this.Xr.add(i.toString()))}).next(()=>n.removeTargetData(e,t))}zr(){this.Yr=new Set}jr(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return le.forEach(this.Xr,n=>{const a=Re.fromPath(n);return this.ei(e,a).next(i=>{i||t.removeEntry(a,Ue.min())})}).next(()=>(this.Yr=null,t.apply(e)))}updateLimboDocument(e,t){return this.ei(e,t).next(n=>{n?this.Xr.delete(t.toString()):this.Xr.add(t.toString())})}Wr(e){return 0}ei(e,t){return le.or([()=>le.resolve(this.Jr.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Hr(e,t)])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ul{constructor(e,t,n,a){this.targetId=e,this.fromCache=t,this.$i=n,this.Ui=a}static Wi(e,t){let n=Ge(),a=Ge();for(const i of t.docChanges)switch(i.type){case 0:n=n.add(i.doc.key);break;case 1:a=a.add(i.doc.key)}return new Ul(e,t.fromCache,n,a)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bb{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vb{constructor(){this.Gi=!1,this.zi=!1,this.ji=100,this.Hi=function(){return _f()?8:ey(qt())>0?6:4}()}initialize(e,t){this.Ji=e,this.indexManager=t,this.Gi=!0}getDocumentsMatchingQuery(e,t,n,a){const i={result:null};return this.Yi(e,t).next(o=>{i.result=o}).next(()=>{if(!i.result)return this.Zi(e,t,a,n).next(o=>{i.result=o})}).next(()=>{if(i.result)return;const o=new bb;return this.Xi(e,t,o).next(c=>{if(i.result=c,this.zi)return this.es(e,t,o,c.size)})}).next(()=>i.result)}es(e,t,n,a){return n.documentReadCount<this.ji?(On()<=Ye.DEBUG&&Ee("QueryEngine","SDK will not create cache indexes for query:",Qs(t),"since it only creates cache indexes for collection contains","more than or equal to",this.ji,"documents"),le.resolve()):(On()<=Ye.DEBUG&&Ee("QueryEngine","Query:",Qs(t),"scans",n.documentReadCount,"local documents and returns",a,"documents as results."),n.documentReadCount>this.Hi*a?(On()<=Ye.DEBUG&&Ee("QueryEngine","The SDK decides to create cache indexes for query:",Qs(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,wr(t))):le.resolve())}Yi(e,t){if(Wd(t))return le.resolve(null);let n=wr(t);return this.indexManager.getIndexType(e,n).next(a=>a===0?null:(t.limit!==null&&a===1&&(t=al(t,null,"F"),n=wr(t)),this.indexManager.getDocumentsMatchingTarget(e,n).next(i=>{const o=Ge(...i);return this.Ji.getDocuments(e,o).next(c=>this.indexManager.getMinOffset(e,n).next(d=>{const h=this.ts(t,c);return this.ns(t,h,o,d.readTime)?this.Yi(e,al(t,null,"F")):this.rs(e,h,t,d)}))})))}Zi(e,t,n,a){return Wd(t)||a.isEqual(Ue.min())?le.resolve(null):this.Ji.getDocuments(e,n).next(i=>{const o=this.ts(t,i);return this.ns(t,o,n,a)?le.resolve(null):(On()<=Ye.DEBUG&&Ee("QueryEngine","Re-using previous result from %s to execute query: %s",a.toString(),Qs(t)),this.rs(e,o,t,Yx(a,-1)).next(c=>c))})}ts(e,t){let n=new Ot(Zh(e));return t.forEach((a,i)=>{Hi(e,i)&&(n=n.add(i))}),n}ns(e,t,n,a){if(e.limit===null)return!1;if(n.size!==t.size)return!0;const i=e.limitType==="F"?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(a)>0)}Xi(e,t,n){return On()<=Ye.DEBUG&&Ee("QueryEngine","Using full collection scan to execute query:",Qs(t)),this.Ji.getDocumentsMatchingQuery(e,t,fs.min(),n)}rs(e,t,n,a){return this.Ji.getDocumentsMatchingQuery(e,n,a).next(i=>(t.forEach(o=>{i=i.insert(o.key,o)}),i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wb{constructor(e,t,n,a){this.persistence=e,this.ss=t,this.serializer=a,this.os=new gt(rt),this._s=new kn(i=>Cl(i),Dl),this.us=new Map,this.cs=e.getRemoteDocumentCache(),this.Ur=e.getTargetCache(),this.Gr=e.getBundleCache(),this.ls(n)}ls(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new cb(this.cs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.cs.setIndexManager(this.indexManager),this.ss.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.os))}}function kb(r,e,t,n){return new wb(r,e,t,n)}async function vm(r,e){const t=Be(r);return await t.persistence.runTransaction("Handle user change","readonly",n=>{let a;return t.mutationQueue.getAllMutationBatches(n).next(i=>(a=i,t.ls(e),t.mutationQueue.getAllMutationBatches(n))).next(i=>{const o=[],c=[];let d=Ge();for(const h of a){o.push(h.batchId);for(const g of h.mutations)d=d.add(g.key)}for(const h of i){c.push(h.batchId);for(const g of h.mutations)d=d.add(g.key)}return t.localDocuments.getDocuments(n,d).next(h=>({hs:h,removedBatchIds:o,addedBatchIds:c}))})})}function _b(r,e){const t=Be(r);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",n=>{const a=e.batch.keys(),i=t.cs.newChangeBuffer({trackRemovals:!0});return function(c,d,h,g){const f=h.batch,p=f.keys();let v=le.resolve();return p.forEach(A=>{v=v.next(()=>g.getEntry(d,A)).next(T=>{const S=h.docVersions.get(A);nt(S!==null),T.version.compareTo(S)<0&&(f.applyToRemoteDocument(T,h),T.isValidDocument()&&(T.setReadTime(h.commitVersion),g.addEntry(T)))})}),v.next(()=>c.mutationQueue.removeMutationBatch(d,f))}(t,n,e,i).next(()=>i.apply(n)).next(()=>t.mutationQueue.performConsistencyCheck(n)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(n,a,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(n,function(c){let d=Ge();for(let h=0;h<c.mutationResults.length;++h)c.mutationResults[h].transformResults.length>0&&(d=d.add(c.batch.mutations[h].key));return d}(e))).next(()=>t.localDocuments.getDocuments(n,a))})}function wm(r){const e=Be(r);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Ur.getLastRemoteSnapshotVersion(t))}function Nb(r,e){const t=Be(r),n=e.snapshotVersion;let a=t.os;return t.persistence.runTransaction("Apply remote event","readwrite-primary",i=>{const o=t.cs.newChangeBuffer({trackRemovals:!0});a=t.os;const c=[];e.targetChanges.forEach((g,f)=>{const p=a.get(f);if(!p)return;c.push(t.Ur.removeMatchingKeys(i,g.removedDocuments,f).next(()=>t.Ur.addMatchingKeys(i,g.addedDocuments,f)));let v=p.withSequenceNumber(i.currentSequenceNumber);e.targetMismatches.get(f)!==null?v=v.withResumeToken(Vt.EMPTY_BYTE_STRING,Ue.min()).withLastLimboFreeSnapshotVersion(Ue.min()):g.resumeToken.approximateByteSize()>0&&(v=v.withResumeToken(g.resumeToken,n)),a=a.insert(f,v),function(T,S,z){return T.resumeToken.approximateByteSize()===0||S.snapshotVersion.toMicroseconds()-T.snapshotVersion.toMicroseconds()>=3e8?!0:z.addedDocuments.size+z.modifiedDocuments.size+z.removedDocuments.size>0}(p,v,g)&&c.push(t.Ur.updateTargetData(i,v))});let d=qr(),h=Ge();if(e.documentUpdates.forEach(g=>{e.resolvedLimboDocuments.has(g)&&c.push(t.persistence.referenceDelegate.updateLimboDocument(i,g))}),c.push(jb(i,o,e.documentUpdates).next(g=>{d=g.Ps,h=g.Is})),!n.isEqual(Ue.min())){const g=t.Ur.getLastRemoteSnapshotVersion(i).next(f=>t.Ur.setTargetsMetadata(i,i.currentSequenceNumber,n));c.push(g)}return le.waitFor(c).next(()=>o.apply(i)).next(()=>t.localDocuments.getLocalViewOfDocuments(i,d,h)).next(()=>d)}).then(i=>(t.os=a,i))}function jb(r,e,t){let n=Ge(),a=Ge();return t.forEach(i=>n=n.add(i)),e.getEntries(r,n).next(i=>{let o=qr();return t.forEach((c,d)=>{const h=i.get(c);d.isFoundDocument()!==h.isFoundDocument()&&(a=a.add(c)),d.isNoDocument()&&d.version.isEqual(Ue.min())?(e.removeEntry(c,d.readTime),o=o.insert(c,d)):!h.isValidDocument()||d.version.compareTo(h.version)>0||d.version.compareTo(h.version)===0&&h.hasPendingWrites?(e.addEntry(d),o=o.insert(c,d)):Ee("LocalStore","Ignoring outdated watch update for ",c,". Current version:",h.version," Watch version:",d.version)}),{Ps:o,Is:a}})}function Eb(r,e){const t=Be(r);return t.persistence.runTransaction("Get next mutation batch","readonly",n=>(e===void 0&&(e=-1),t.mutationQueue.getNextMutationBatchAfterBatchId(n,e)))}function Ib(r,e){const t=Be(r);return t.persistence.runTransaction("Allocate target","readwrite",n=>{let a;return t.Ur.getTargetData(n,e).next(i=>i?(a=i,le.resolve(a)):t.Ur.allocateTargetId(n).next(o=>(a=new cs(e,o,"TargetPurposeListen",n.currentSequenceNumber),t.Ur.addTargetData(n,a).next(()=>a))))}).then(n=>{const a=t.os.get(n.targetId);return(a===null||n.snapshotVersion.compareTo(a.snapshotVersion)>0)&&(t.os=t.os.insert(n.targetId,n),t._s.set(e,n.targetId)),n})}async function dl(r,e,t){const n=Be(r),a=n.os.get(e),i=t?"readwrite":"readwrite-primary";try{t||await n.persistence.runTransaction("Release target",i,o=>n.persistence.referenceDelegate.removeTarget(o,a))}catch(o){if(!ka(o))throw o;Ee("LocalStore",`Failed to update sequence numbers for target ${e}: ${o}`)}n.os=n.os.remove(e),n._s.delete(a.target)}function eu(r,e,t){const n=Be(r);let a=Ue.min(),i=Ge();return n.persistence.runTransaction("Execute query","readwrite",o=>function(d,h,g){const f=Be(d),p=f._s.get(g);return p!==void 0?le.resolve(f.os.get(p)):f.Ur.getTargetData(h,g)}(n,o,wr(e)).next(c=>{if(c)return a=c.lastLimboFreeSnapshotVersion,n.Ur.getMatchingKeysForTargetId(o,c.targetId).next(d=>{i=d})}).next(()=>n.ss.getDocumentsMatchingQuery(o,e,t?a:Ue.min(),t?i:Ge())).next(c=>(Tb(n,yy(e),c),{documents:c,Ts:i})))}function Tb(r,e,t){let n=r.us.get(e)||Ue.min();t.forEach((a,i)=>{i.readTime.compareTo(n)>0&&(n=i.readTime)}),r.us.set(e,n)}class tu{constructor(){this.activeTargetIds=Ny()}fs(e){this.activeTargetIds=this.activeTargetIds.add(e)}gs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Vs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class Sb{constructor(){this.so=new tu,this.oo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e,t=!0){return t&&this.so.fs(e),this.oo[e]||"not-current"}updateQueryState(e,t,n){this.oo[e]=t}removeLocalQueryTarget(e){this.so.gs(e)}isLocalQueryTarget(e){return this.so.activeTargetIds.has(e)}clearQueryState(e){delete this.oo[e]}getAllActiveQueryTargets(){return this.so.activeTargetIds}isActiveQueryTarget(e){return this.so.activeTargetIds.has(e)}start(){return this.so=new tu,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ab{_o(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ru{constructor(){this.ao=()=>this.uo(),this.co=()=>this.lo(),this.ho=[],this.Po()}_o(e){this.ho.push(e)}shutdown(){window.removeEventListener("online",this.ao),window.removeEventListener("offline",this.co)}Po(){window.addEventListener("online",this.ao),window.addEventListener("offline",this.co)}uo(){Ee("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.ho)e(0)}lo(){Ee("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.ho)e(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Qa=null;function Oo(){return Qa===null?Qa=function(){return 268435456+Math.round(2147483648*Math.random())}():Qa++,"0x"+Qa.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Cb={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Db{constructor(e){this.Io=e.Io,this.To=e.To}Eo(e){this.Ao=e}Ro(e){this.Vo=e}mo(e){this.fo=e}onMessage(e){this.po=e}close(){this.To()}send(e){this.Io(e)}yo(){this.Ao()}wo(){this.Vo()}So(e){this.fo(e)}bo(e){this.po(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ut="WebChannelConnection";class Rb extends class{constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const n=t.ssl?"https":"http",a=encodeURIComponent(this.databaseId.projectId),i=encodeURIComponent(this.databaseId.database);this.Do=n+"://"+t.host,this.vo=`projects/${a}/databases/${i}`,this.Co=this.databaseId.database==="(default)"?`project_id=${a}`:`project_id=${a}&database_id=${i}`}get Fo(){return!1}Mo(t,n,a,i,o){const c=Oo(),d=this.xo(t,n.toUriEncodedString());Ee("RestConnection",`Sending RPC '${t}' ${c}:`,d,a);const h={"google-cloud-resource-prefix":this.vo,"x-goog-request-params":this.Co};return this.Oo(h,i,o),this.No(t,d,h,a).then(g=>(Ee("RestConnection",`Received RPC '${t}' ${c}: `,g),g),g=>{throw dn("RestConnection",`RPC '${t}' ${c} failed with error: `,g,"url: ",d,"request:",a),g})}Lo(t,n,a,i,o,c){return this.Mo(t,n,a,i,o)}Oo(t,n,a){t["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+vn}(),t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),n&&n.headers.forEach((i,o)=>t[o]=i),a&&a.headers.forEach((i,o)=>t[o]=i)}xo(t,n){const a=Cb[t];return`${this.Do}/v1/${n}:${a}`}terminate(){}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}No(e,t,n,a){const i=Oo();return new Promise((o,c)=>{const d=new Mh;d.setWithCredentials(!0),d.listenOnce($h.COMPLETE,()=>{try{switch(d.getLastErrorCode()){case ni.NO_ERROR:const g=d.getResponseJson();Ee(Ut,`XHR for RPC '${e}' ${i} received:`,JSON.stringify(g)),o(g);break;case ni.TIMEOUT:Ee(Ut,`RPC '${e}' ${i} timed out`),c(new ke(se.DEADLINE_EXCEEDED,"Request time out"));break;case ni.HTTP_ERROR:const f=d.getStatus();if(Ee(Ut,`RPC '${e}' ${i} failed with status:`,f,"response text:",d.getResponseText()),f>0){let p=d.getResponseJson();Array.isArray(p)&&(p=p[0]);const v=p==null?void 0:p.error;if(v&&v.status&&v.message){const A=function(S){const z=S.toLowerCase().replace(/_/g,"-");return Object.values(se).indexOf(z)>=0?z:se.UNKNOWN}(v.status);c(new ke(A,v.message))}else c(new ke(se.UNKNOWN,"Server responded with status "+d.getStatus()))}else c(new ke(se.UNAVAILABLE,"Connection failed."));break;default:Le()}}finally{Ee(Ut,`RPC '${e}' ${i} completed.`)}});const h=JSON.stringify(a);Ee(Ut,`RPC '${e}' ${i} sending request:`,a),d.send(t,"POST",h,n,15)})}Bo(e,t,n){const a=Oo(),i=[this.Do,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=Lh(),c=Vh(),d={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},h=this.longPollingOptions.timeoutSeconds;h!==void 0&&(d.longPollingTimeout=Math.round(1e3*h)),this.useFetchStreams&&(d.useFetchStreams=!0),this.Oo(d.initMessageHeaders,t,n),d.encodeInitMessageHeaders=!0;const g=i.join("");Ee(Ut,`Creating RPC '${e}' stream ${a}: ${g}`,d);const f=o.createWebChannel(g,d);let p=!1,v=!1;const A=new Db({Io:S=>{v?Ee(Ut,`Not sending because RPC '${e}' stream ${a} is closed:`,S):(p||(Ee(Ut,`Opening RPC '${e}' stream ${a} transport.`),f.open(),p=!0),Ee(Ut,`RPC '${e}' stream ${a} sending:`,S),f.send(S))},To:()=>f.close()}),T=(S,z,L)=>{S.listen(z,C=>{try{L(C)}catch(j){setTimeout(()=>{throw j},0)}})};return T(f,Bn.EventType.OPEN,()=>{v||(Ee(Ut,`RPC '${e}' stream ${a} transport opened.`),A.yo())}),T(f,Bn.EventType.CLOSE,()=>{v||(v=!0,Ee(Ut,`RPC '${e}' stream ${a} transport closed`),A.So())}),T(f,Bn.EventType.ERROR,S=>{v||(v=!0,dn(Ut,`RPC '${e}' stream ${a} transport errored:`,S),A.So(new ke(se.UNAVAILABLE,"The operation could not be completed")))}),T(f,Bn.EventType.MESSAGE,S=>{var z;if(!v){const L=S.data[0];nt(!!L);const C=L,j=C.error||((z=C[0])===null||z===void 0?void 0:z.error);if(j){Ee(Ut,`RPC '${e}' stream ${a} received error:`,j);const H=j.status;let Y=function(w){const N=wt[w];if(N!==void 0)return dm(N)}(H),I=j.message;Y===void 0&&(Y=se.INTERNAL,I="Unknown error status: "+H+" with message "+j.message),v=!0,A.So(new ke(Y,I)),f.close()}else Ee(Ut,`RPC '${e}' stream ${a} received:`,L),A.bo(L)}}),T(c,Oh.STAT_EVENT,S=>{S.stat===Zo.PROXY?Ee(Ut,`RPC '${e}' stream ${a} detected buffering proxy`):S.stat===Zo.NOPROXY&&Ee(Ut,`RPC '${e}' stream ${a} detected no buffering proxy`)}),setTimeout(()=>{A.wo()},0),A}}function Vo(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Qi(r){return new Wy(r,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class km{constructor(e,t,n=1e3,a=1.5,i=6e4){this.ui=e,this.timerId=t,this.ko=n,this.qo=a,this.Qo=i,this.Ko=0,this.$o=null,this.Uo=Date.now(),this.reset()}reset(){this.Ko=0}Wo(){this.Ko=this.Qo}Go(e){this.cancel();const t=Math.floor(this.Ko+this.zo()),n=Math.max(0,Date.now()-this.Uo),a=Math.max(0,t-n);a>0&&Ee("ExponentialBackoff",`Backing off for ${a} ms (base delay: ${this.Ko} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.$o=this.ui.enqueueAfterDelay(this.timerId,a,()=>(this.Uo=Date.now(),e())),this.Ko*=this.qo,this.Ko<this.ko&&(this.Ko=this.ko),this.Ko>this.Qo&&(this.Ko=this.Qo)}jo(){this.$o!==null&&(this.$o.skipDelay(),this.$o=null)}cancel(){this.$o!==null&&(this.$o.cancel(),this.$o=null)}zo(){return(Math.random()-.5)*this.Ko}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _m{constructor(e,t,n,a,i,o,c,d){this.ui=e,this.Ho=n,this.Jo=a,this.connection=i,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=c,this.listener=d,this.state=0,this.Yo=0,this.Zo=null,this.Xo=null,this.stream=null,this.e_=0,this.t_=new km(e,t)}n_(){return this.state===1||this.state===5||this.r_()}r_(){return this.state===2||this.state===3}start(){this.e_=0,this.state!==4?this.auth():this.i_()}async stop(){this.n_()&&await this.close(0)}s_(){this.state=0,this.t_.reset()}o_(){this.r_()&&this.Zo===null&&(this.Zo=this.ui.enqueueAfterDelay(this.Ho,6e4,()=>this.__()))}a_(e){this.u_(),this.stream.send(e)}async __(){if(this.r_())return this.close(0)}u_(){this.Zo&&(this.Zo.cancel(),this.Zo=null)}c_(){this.Xo&&(this.Xo.cancel(),this.Xo=null)}async close(e,t){this.u_(),this.c_(),this.t_.cancel(),this.Yo++,e!==4?this.t_.reset():t&&t.code===se.RESOURCE_EXHAUSTED?(Wr(t.toString()),Wr("Using maximum backoff delay to prevent overloading the backend."),this.t_.Wo()):t&&t.code===se.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.l_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.mo(t)}l_(){}auth(){this.state=1;const e=this.h_(this.Yo),t=this.Yo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([n,a])=>{this.Yo===t&&this.P_(n,a)},n=>{e(()=>{const a=new ke(se.UNKNOWN,"Fetching auth token failed: "+n.message);return this.I_(a)})})}P_(e,t){const n=this.h_(this.Yo);this.stream=this.T_(e,t),this.stream.Eo(()=>{n(()=>this.listener.Eo())}),this.stream.Ro(()=>{n(()=>(this.state=2,this.Xo=this.ui.enqueueAfterDelay(this.Jo,1e4,()=>(this.r_()&&(this.state=3),Promise.resolve())),this.listener.Ro()))}),this.stream.mo(a=>{n(()=>this.I_(a))}),this.stream.onMessage(a=>{n(()=>++this.e_==1?this.E_(a):this.onNext(a))})}i_(){this.state=5,this.t_.Go(async()=>{this.state=0,this.start()})}I_(e){return Ee("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}h_(e){return t=>{this.ui.enqueueAndForget(()=>this.Yo===e?t():(Ee("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class Pb extends _m{constructor(e,t,n,a,i,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,a,o),this.serializer=i}T_(e,t){return this.connection.Bo("Listen",e,t)}E_(e){return this.onNext(e)}onNext(e){this.t_.reset();const t=Hy(this.serializer,e),n=function(i){if(!("targetChange"in i))return Ue.min();const o=i.targetChange;return o.targetIds&&o.targetIds.length?Ue.min():o.readTime?kr(o.readTime):Ue.min()}(e);return this.listener.d_(t,n)}A_(e){const t={};t.database=cl(this.serializer),t.addTarget=function(i,o){let c;const d=o.target;if(c=sl(d)?{documents:Yy(i,d)}:{query:Qy(i,d)._t},c.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){c.resumeToken=mm(i,o.resumeToken);const h=il(i,o.expectedCount);h!==null&&(c.expectedCount=h)}else if(o.snapshotVersion.compareTo(Ue.min())>0){c.readTime=_i(i,o.snapshotVersion.toTimestamp());const h=il(i,o.expectedCount);h!==null&&(c.expectedCount=h)}return c}(this.serializer,e);const n=Jy(this.serializer,e);n&&(t.labels=n),this.a_(t)}R_(e){const t={};t.database=cl(this.serializer),t.removeTarget=e,this.a_(t)}}class Mb extends _m{constructor(e,t,n,a,i,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,a,o),this.serializer=i}get V_(){return this.e_>0}start(){this.lastStreamToken=void 0,super.start()}l_(){this.V_&&this.m_([])}T_(e,t){return this.connection.Bo("Write",e,t)}E_(e){return nt(!!e.streamToken),this.lastStreamToken=e.streamToken,nt(!e.writeResults||e.writeResults.length===0),this.listener.f_()}onNext(e){nt(!!e.streamToken),this.lastStreamToken=e.streamToken,this.t_.reset();const t=Ky(e.writeResults,e.commitTime),n=kr(e.commitTime);return this.listener.g_(n,t)}p_(){const e={};e.database=cl(this.serializer),this.a_(e)}m_(e){const t={streamToken:this.lastStreamToken,writes:e.map(n=>Gy(this.serializer,n))};this.a_(t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $b extends class{}{constructor(e,t,n,a){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=n,this.serializer=a,this.y_=!1}w_(){if(this.y_)throw new ke(se.FAILED_PRECONDITION,"The client has already been terminated.")}Mo(e,t,n,a){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,o])=>this.connection.Mo(e,ol(t,n),a,i,o)).catch(i=>{throw i.name==="FirebaseError"?(i.code===se.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),i):new ke(se.UNKNOWN,i.toString())})}Lo(e,t,n,a,i){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,c])=>this.connection.Lo(e,ol(t,n),a,o,c,i)).catch(o=>{throw o.name==="FirebaseError"?(o.code===se.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new ke(se.UNKNOWN,o.toString())})}terminate(){this.y_=!0,this.connection.terminate()}}class Ob{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.S_=0,this.b_=null,this.D_=!0}v_(){this.S_===0&&(this.C_("Unknown"),this.b_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.b_=null,this.F_("Backend didn't respond within 10 seconds."),this.C_("Offline"),Promise.resolve())))}M_(e){this.state==="Online"?this.C_("Unknown"):(this.S_++,this.S_>=1&&(this.x_(),this.F_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.C_("Offline")))}set(e){this.x_(),this.S_=0,e==="Online"&&(this.D_=!1),this.C_(e)}C_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}F_(e){const t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.D_?(Wr(t),this.D_=!1):Ee("OnlineStateTracker",t)}x_(){this.b_!==null&&(this.b_.cancel(),this.b_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vb{constructor(e,t,n,a,i){this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.O_=[],this.N_=new Map,this.L_=new Set,this.B_=[],this.k_=i,this.k_._o(o=>{n.enqueueAndForget(async()=>{Ws(this)&&(Ee("RemoteStore","Restarting streams for network reachability change."),await async function(d){const h=Be(d);h.L_.add(4),await ja(h),h.q_.set("Unknown"),h.L_.delete(4),await Xi(h)}(this))})}),this.q_=new Ob(n,a)}}async function Xi(r){if(Ws(r))for(const e of r.B_)await e(!0)}async function ja(r){for(const e of r.B_)await e(!1)}function Nm(r,e){const t=Be(r);t.N_.has(e.targetId)||(t.N_.set(e.targetId,e),zl(t)?ql(t):_n(t).r_()&&Wl(t,e))}function Bl(r,e){const t=Be(r),n=_n(t);t.N_.delete(e),n.r_()&&jm(t,e),t.N_.size===0&&(n.r_()?n.o_():Ws(t)&&t.q_.set("Unknown"))}function Wl(r,e){if(r.Q_.xe(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(Ue.min())>0){const t=r.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}_n(r).A_(e)}function jm(r,e){r.Q_.xe(e),_n(r).R_(e)}function ql(r){r.Q_=new Ly({getRemoteKeysForTarget:e=>r.remoteSyncer.getRemoteKeysForTarget(e),ot:e=>r.N_.get(e)||null,tt:()=>r.datastore.serializer.databaseId}),_n(r).start(),r.q_.v_()}function zl(r){return Ws(r)&&!_n(r).n_()&&r.N_.size>0}function Ws(r){return Be(r).L_.size===0}function Em(r){r.Q_=void 0}async function Lb(r){r.q_.set("Online")}async function Fb(r){r.N_.forEach((e,t)=>{Wl(r,e)})}async function Ub(r,e){Em(r),zl(r)?(r.q_.M_(e),ql(r)):r.q_.set("Unknown")}async function Bb(r,e,t){if(r.q_.set("Online"),e instanceof hm&&e.state===2&&e.cause)try{await async function(a,i){const o=i.cause;for(const c of i.targetIds)a.N_.has(c)&&(await a.remoteSyncer.rejectListen(c,o),a.N_.delete(c),a.Q_.removeTarget(c))}(r,e)}catch(n){Ee("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),n),await Ni(r,n)}else if(e instanceof oi?r.Q_.Ke(e):e instanceof um?r.Q_.He(e):r.Q_.We(e),!t.isEqual(Ue.min()))try{const n=await wm(r.localStore);t.compareTo(n)>=0&&await function(i,o){const c=i.Q_.rt(o);return c.targetChanges.forEach((d,h)=>{if(d.resumeToken.approximateByteSize()>0){const g=i.N_.get(h);g&&i.N_.set(h,g.withResumeToken(d.resumeToken,o))}}),c.targetMismatches.forEach((d,h)=>{const g=i.N_.get(d);if(!g)return;i.N_.set(d,g.withResumeToken(Vt.EMPTY_BYTE_STRING,g.snapshotVersion)),jm(i,d);const f=new cs(g.target,d,h,g.sequenceNumber);Wl(i,f)}),i.remoteSyncer.applyRemoteEvent(c)}(r,t)}catch(n){Ee("RemoteStore","Failed to raise snapshot:",n),await Ni(r,n)}}async function Ni(r,e,t){if(!ka(e))throw e;r.L_.add(1),await ja(r),r.q_.set("Offline"),t||(t=()=>wm(r.localStore)),r.asyncQueue.enqueueRetryable(async()=>{Ee("RemoteStore","Retrying IndexedDB access"),await t(),r.L_.delete(1),await Xi(r)})}function Im(r,e){return e().catch(t=>Ni(r,t,e))}async function Ji(r){const e=Be(r),t=ys(e);let n=e.O_.length>0?e.O_[e.O_.length-1].batchId:-1;for(;Wb(e);)try{const a=await Eb(e.localStore,n);if(a===null){e.O_.length===0&&t.o_();break}n=a.batchId,qb(e,a)}catch(a){await Ni(e,a)}Tm(e)&&Sm(e)}function Wb(r){return Ws(r)&&r.O_.length<10}function qb(r,e){r.O_.push(e);const t=ys(r);t.r_()&&t.V_&&t.m_(e.mutations)}function Tm(r){return Ws(r)&&!ys(r).n_()&&r.O_.length>0}function Sm(r){ys(r).start()}async function zb(r){ys(r).p_()}async function Hb(r){const e=ys(r);for(const t of r.O_)e.m_(t.mutations)}async function Gb(r,e,t){const n=r.O_.shift(),a=$l.from(n,e,t);await Im(r,()=>r.remoteSyncer.applySuccessfulWrite(a)),await Ji(r)}async function Kb(r,e){e&&ys(r).V_&&await async function(n,a){if(function(o){return $y(o)&&o!==se.ABORTED}(a.code)){const i=n.O_.shift();ys(n).s_(),await Im(n,()=>n.remoteSyncer.rejectFailedWrite(i.batchId,a)),await Ji(n)}}(r,e),Tm(r)&&Sm(r)}async function su(r,e){const t=Be(r);t.asyncQueue.verifyOperationInProgress(),Ee("RemoteStore","RemoteStore received new credentials");const n=Ws(t);t.L_.add(3),await ja(t),n&&t.q_.set("Unknown"),await t.remoteSyncer.handleCredentialChange(e),t.L_.delete(3),await Xi(t)}async function Yb(r,e){const t=Be(r);e?(t.L_.delete(2),await Xi(t)):e||(t.L_.add(2),await ja(t),t.q_.set("Unknown"))}function _n(r){return r.K_||(r.K_=function(t,n,a){const i=Be(t);return i.w_(),new Pb(n,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,a)}(r.datastore,r.asyncQueue,{Eo:Lb.bind(null,r),Ro:Fb.bind(null,r),mo:Ub.bind(null,r),d_:Bb.bind(null,r)}),r.B_.push(async e=>{e?(r.K_.s_(),zl(r)?ql(r):r.q_.set("Unknown")):(await r.K_.stop(),Em(r))})),r.K_}function ys(r){return r.U_||(r.U_=function(t,n,a){const i=Be(t);return i.w_(),new Mb(n,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,a)}(r.datastore,r.asyncQueue,{Eo:()=>Promise.resolve(),Ro:zb.bind(null,r),mo:Kb.bind(null,r),f_:Hb.bind(null,r),g_:Gb.bind(null,r)}),r.B_.push(async e=>{e?(r.U_.s_(),await Ji(r)):(await r.U_.stop(),r.O_.length>0&&(Ee("RemoteStore",`Stopping write stream with ${r.O_.length} pending writes`),r.O_=[]))})),r.U_}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hl{constructor(e,t,n,a,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=a,this.removalCallback=i,this.deferred=new Ur,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,n,a,i){const o=Date.now()+n,c=new Hl(e,t,o,a,i);return c.start(n),c}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new ke(se.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Gl(r,e){if(Wr("AsyncQueue",`${e}: ${r}`),ka(r))return new ke(se.UNAVAILABLE,`${e}: ${r}`);throw r}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class en{constructor(e){this.comparator=e?(t,n)=>e(t,n)||Re.comparator(t.key,n.key):(t,n)=>Re.comparator(t.key,n.key),this.keyedMap=Wn(),this.sortedSet=new gt(this.comparator)}static emptySet(e){return new en(e.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,n)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof en)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){const a=t.getNext().key,i=n.getNext().key;if(!a.isEqual(i))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){const n=new en;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nu{constructor(){this.W_=new gt(Re.comparator)}track(e){const t=e.doc.key,n=this.W_.get(t);n?e.type!==0&&n.type===3?this.W_=this.W_.insert(t,e):e.type===3&&n.type!==1?this.W_=this.W_.insert(t,{type:n.type,doc:e.doc}):e.type===2&&n.type===2?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):e.type===2&&n.type===0?this.W_=this.W_.insert(t,{type:0,doc:e.doc}):e.type===1&&n.type===0?this.W_=this.W_.remove(t):e.type===1&&n.type===2?this.W_=this.W_.insert(t,{type:1,doc:n.doc}):e.type===0&&n.type===1?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):Le():this.W_=this.W_.insert(t,e)}G_(){const e=[];return this.W_.inorderTraversal((t,n)=>{e.push(n)}),e}}class pn{constructor(e,t,n,a,i,o,c,d,h){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=a,this.mutatedKeys=i,this.fromCache=o,this.syncStateChanged=c,this.excludesMetadataChanges=d,this.hasCachedResults=h}static fromInitialDocuments(e,t,n,a,i){const o=[];return t.forEach(c=>{o.push({type:0,doc:c})}),new pn(e,t,en.emptySet(t),o,n,a,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&zi(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let a=0;a<t.length;a++)if(t[a].type!==n[a].type||!t[a].doc.isEqual(n[a].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qb{constructor(){this.z_=void 0,this.j_=[]}H_(){return this.j_.some(e=>e.J_())}}class Xb{constructor(){this.queries=au(),this.onlineState="Unknown",this.Y_=new Set}terminate(){(function(t,n){const a=Be(t),i=a.queries;a.queries=au(),i.forEach((o,c)=>{for(const d of c.j_)d.onError(n)})})(this,new ke(se.ABORTED,"Firestore shutting down"))}}function au(){return new kn(r=>Jh(r),zi)}async function Am(r,e){const t=Be(r);let n=3;const a=e.query;let i=t.queries.get(a);i?!i.H_()&&e.J_()&&(n=2):(i=new Qb,n=e.J_()?0:1);try{switch(n){case 0:i.z_=await t.onListen(a,!0);break;case 1:i.z_=await t.onListen(a,!1);break;case 2:await t.onFirstRemoteStoreListen(a)}}catch(o){const c=Gl(o,`Initialization of query '${Qs(e.query)}' failed`);return void e.onError(c)}t.queries.set(a,i),i.j_.push(e),e.Z_(t.onlineState),i.z_&&e.X_(i.z_)&&Kl(t)}async function Cm(r,e){const t=Be(r),n=e.query;let a=3;const i=t.queries.get(n);if(i){const o=i.j_.indexOf(e);o>=0&&(i.j_.splice(o,1),i.j_.length===0?a=e.J_()?0:1:!i.H_()&&e.J_()&&(a=2))}switch(a){case 0:return t.queries.delete(n),t.onUnlisten(n,!0);case 1:return t.queries.delete(n),t.onUnlisten(n,!1);case 2:return t.onLastRemoteStoreUnlisten(n);default:return}}function Jb(r,e){const t=Be(r);let n=!1;for(const a of e){const i=a.query,o=t.queries.get(i);if(o){for(const c of o.j_)c.X_(a)&&(n=!0);o.z_=a}}n&&Kl(t)}function Zb(r,e,t){const n=Be(r),a=n.queries.get(e);if(a)for(const i of a.j_)i.onError(t);n.queries.delete(e)}function Kl(r){r.Y_.forEach(e=>{e.next()})}var ul,iu;(iu=ul||(ul={})).ea="default",iu.Cache="cache";class Dm{constructor(e,t,n){this.query=e,this.ta=t,this.na=!1,this.ra=null,this.onlineState="Unknown",this.options=n||{}}X_(e){if(!this.options.includeMetadataChanges){const n=[];for(const a of e.docChanges)a.type!==3&&n.push(a);e=new pn(e.query,e.docs,e.oldDocs,n,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.na?this.ia(e)&&(this.ta.next(e),t=!0):this.sa(e,this.onlineState)&&(this.oa(e),t=!0),this.ra=e,t}onError(e){this.ta.error(e)}Z_(e){this.onlineState=e;let t=!1;return this.ra&&!this.na&&this.sa(this.ra,e)&&(this.oa(this.ra),t=!0),t}sa(e,t){if(!e.fromCache||!this.J_())return!0;const n=t!=="Offline";return(!this.options._a||!n)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}ia(e){if(e.docChanges.length>0)return!0;const t=this.ra&&this.ra.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}oa(e){e=pn.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.na=!0,this.ta.next(e)}J_(){return this.options.source!==ul.Cache}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rm{constructor(e){this.key=e}}class Pm{constructor(e){this.key=e}}class ev{constructor(e,t){this.query=e,this.Ta=t,this.Ea=null,this.hasCachedResults=!1,this.current=!1,this.da=Ge(),this.mutatedKeys=Ge(),this.Aa=Zh(e),this.Ra=new en(this.Aa)}get Va(){return this.Ta}ma(e,t){const n=t?t.fa:new nu,a=t?t.Ra:this.Ra;let i=t?t.mutatedKeys:this.mutatedKeys,o=a,c=!1;const d=this.query.limitType==="F"&&a.size===this.query.limit?a.last():null,h=this.query.limitType==="L"&&a.size===this.query.limit?a.first():null;if(e.inorderTraversal((g,f)=>{const p=a.get(g),v=Hi(this.query,f)?f:null,A=!!p&&this.mutatedKeys.has(p.key),T=!!v&&(v.hasLocalMutations||this.mutatedKeys.has(v.key)&&v.hasCommittedMutations);let S=!1;p&&v?p.data.isEqual(v.data)?A!==T&&(n.track({type:3,doc:v}),S=!0):this.ga(p,v)||(n.track({type:2,doc:v}),S=!0,(d&&this.Aa(v,d)>0||h&&this.Aa(v,h)<0)&&(c=!0)):!p&&v?(n.track({type:0,doc:v}),S=!0):p&&!v&&(n.track({type:1,doc:p}),S=!0,(d||h)&&(c=!0)),S&&(v?(o=o.add(v),i=T?i.add(g):i.delete(g)):(o=o.delete(g),i=i.delete(g)))}),this.query.limit!==null)for(;o.size>this.query.limit;){const g=this.query.limitType==="F"?o.last():o.first();o=o.delete(g.key),i=i.delete(g.key),n.track({type:1,doc:g})}return{Ra:o,fa:n,ns:c,mutatedKeys:i}}ga(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n,a){const i=this.Ra;this.Ra=e.Ra,this.mutatedKeys=e.mutatedKeys;const o=e.fa.G_();o.sort((g,f)=>function(v,A){const T=S=>{switch(S){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Le()}};return T(v)-T(A)}(g.type,f.type)||this.Aa(g.doc,f.doc)),this.pa(n),a=a!=null&&a;const c=t&&!a?this.ya():[],d=this.da.size===0&&this.current&&!a?1:0,h=d!==this.Ea;return this.Ea=d,o.length!==0||h?{snapshot:new pn(this.query,e.Ra,i,o,e.mutatedKeys,d===0,h,!1,!!n&&n.resumeToken.approximateByteSize()>0),wa:c}:{wa:c}}Z_(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({Ra:this.Ra,fa:new nu,mutatedKeys:this.mutatedKeys,ns:!1},!1)):{wa:[]}}Sa(e){return!this.Ta.has(e)&&!!this.Ra.has(e)&&!this.Ra.get(e).hasLocalMutations}pa(e){e&&(e.addedDocuments.forEach(t=>this.Ta=this.Ta.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.Ta=this.Ta.delete(t)),this.current=e.current)}ya(){if(!this.current)return[];const e=this.da;this.da=Ge(),this.Ra.forEach(n=>{this.Sa(n.key)&&(this.da=this.da.add(n.key))});const t=[];return e.forEach(n=>{this.da.has(n)||t.push(new Pm(n))}),this.da.forEach(n=>{e.has(n)||t.push(new Rm(n))}),t}ba(e){this.Ta=e.Ts,this.da=Ge();const t=this.ma(e.documents);return this.applyChanges(t,!0)}Da(){return pn.fromInitialDocuments(this.query,this.Ra,this.mutatedKeys,this.Ea===0,this.hasCachedResults)}}class tv{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}}class rv{constructor(e){this.key=e,this.va=!1}}class sv{constructor(e,t,n,a,i,o){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=a,this.currentUser=i,this.maxConcurrentLimboResolutions=o,this.Ca={},this.Fa=new kn(c=>Jh(c),zi),this.Ma=new Map,this.xa=new Set,this.Oa=new gt(Re.comparator),this.Na=new Map,this.La=new Ll,this.Ba={},this.ka=new Map,this.qa=gn.kn(),this.onlineState="Unknown",this.Qa=void 0}get isPrimaryClient(){return this.Qa===!0}}async function nv(r,e,t=!0){const n=Fm(r);let a;const i=n.Fa.get(e);return i?(n.sharedClientState.addLocalQueryTarget(i.targetId),a=i.view.Da()):a=await Mm(n,e,t,!0),a}async function av(r,e){const t=Fm(r);await Mm(t,e,!0,!1)}async function Mm(r,e,t,n){const a=await Ib(r.localStore,wr(e)),i=a.targetId,o=r.sharedClientState.addLocalQueryTarget(i,t);let c;return n&&(c=await iv(r,e,i,o==="current",a.resumeToken)),r.isPrimaryClient&&t&&Nm(r.remoteStore,a),c}async function iv(r,e,t,n,a){r.Ka=(f,p,v)=>async function(T,S,z,L){let C=S.view.ma(z);C.ns&&(C=await eu(T.localStore,S.query,!1).then(({documents:I})=>S.view.ma(I,C)));const j=L&&L.targetChanges.get(S.targetId),H=L&&L.targetMismatches.get(S.targetId)!=null,Y=S.view.applyChanges(C,T.isPrimaryClient,j,H);return lu(T,S.targetId,Y.wa),Y.snapshot}(r,f,p,v);const i=await eu(r.localStore,e,!0),o=new ev(e,i.Ts),c=o.ma(i.documents),d=Na.createSynthesizedTargetChangeForCurrentChange(t,n&&r.onlineState!=="Offline",a),h=o.applyChanges(c,r.isPrimaryClient,d);lu(r,t,h.wa);const g=new tv(e,t,o);return r.Fa.set(e,g),r.Ma.has(t)?r.Ma.get(t).push(e):r.Ma.set(t,[e]),h.snapshot}async function ov(r,e,t){const n=Be(r),a=n.Fa.get(e),i=n.Ma.get(a.targetId);if(i.length>1)return n.Ma.set(a.targetId,i.filter(o=>!zi(o,e))),void n.Fa.delete(e);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(a.targetId),n.sharedClientState.isActiveQueryTarget(a.targetId)||await dl(n.localStore,a.targetId,!1).then(()=>{n.sharedClientState.clearQueryState(a.targetId),t&&Bl(n.remoteStore,a.targetId),hl(n,a.targetId)}).catch(wa)):(hl(n,a.targetId),await dl(n.localStore,a.targetId,!0))}async function lv(r,e){const t=Be(r),n=t.Fa.get(e),a=t.Ma.get(n.targetId);t.isPrimaryClient&&a.length===1&&(t.sharedClientState.removeLocalQueryTarget(n.targetId),Bl(t.remoteStore,n.targetId))}async function cv(r,e,t){const n=fv(r);try{const a=await function(o,c){const d=Be(o),h=It.now(),g=c.reduce((v,A)=>v.add(A.key),Ge());let f,p;return d.persistence.runTransaction("Locally write mutations","readwrite",v=>{let A=qr(),T=Ge();return d.cs.getEntries(v,g).next(S=>{A=S,A.forEach((z,L)=>{L.isValidDocument()||(T=T.add(z))})}).next(()=>d.localDocuments.getOverlayedDocuments(v,A)).next(S=>{f=S;const z=[];for(const L of c){const C=Cy(L,f.get(L.key).overlayedDocument);C!=null&&z.push(new bs(L.key,C,qh(C.value.mapValue),gr.exists(!0)))}return d.mutationQueue.addMutationBatch(v,h,z,c)}).next(S=>{p=S;const z=S.applyToLocalDocumentSet(f,T);return d.documentOverlayCache.saveOverlays(v,S.batchId,z)})}).then(()=>({batchId:p.batchId,changes:tm(f)}))}(n.localStore,e);n.sharedClientState.addPendingMutation(a.batchId),function(o,c,d){let h=o.Ba[o.currentUser.toKey()];h||(h=new gt(rt)),h=h.insert(c,d),o.Ba[o.currentUser.toKey()]=h}(n,a.batchId,t),await Ea(n,a.changes),await Ji(n.remoteStore)}catch(a){const i=Gl(a,"Failed to persist write");t.reject(i)}}async function $m(r,e){const t=Be(r);try{const n=await Nb(t.localStore,e);e.targetChanges.forEach((a,i)=>{const o=t.Na.get(i);o&&(nt(a.addedDocuments.size+a.modifiedDocuments.size+a.removedDocuments.size<=1),a.addedDocuments.size>0?o.va=!0:a.modifiedDocuments.size>0?nt(o.va):a.removedDocuments.size>0&&(nt(o.va),o.va=!1))}),await Ea(t,n,e)}catch(n){await wa(n)}}function ou(r,e,t){const n=Be(r);if(n.isPrimaryClient&&t===0||!n.isPrimaryClient&&t===1){const a=[];n.Fa.forEach((i,o)=>{const c=o.view.Z_(e);c.snapshot&&a.push(c.snapshot)}),function(o,c){const d=Be(o);d.onlineState=c;let h=!1;d.queries.forEach((g,f)=>{for(const p of f.j_)p.Z_(c)&&(h=!0)}),h&&Kl(d)}(n.eventManager,e),a.length&&n.Ca.d_(a),n.onlineState=e,n.isPrimaryClient&&n.sharedClientState.setOnlineState(e)}}async function dv(r,e,t){const n=Be(r);n.sharedClientState.updateQueryState(e,"rejected",t);const a=n.Na.get(e),i=a&&a.key;if(i){let o=new gt(Re.comparator);o=o.insert(i,Wt.newNoDocument(i,Ue.min()));const c=Ge().add(i),d=new Yi(Ue.min(),new Map,new gt(rt),o,c);await $m(n,d),n.Oa=n.Oa.remove(i),n.Na.delete(e),Yl(n)}else await dl(n.localStore,e,!1).then(()=>hl(n,e,t)).catch(wa)}async function uv(r,e){const t=Be(r),n=e.batch.batchId;try{const a=await _b(t.localStore,e);Vm(t,n,null),Om(t,n),t.sharedClientState.updateMutationState(n,"acknowledged"),await Ea(t,a)}catch(a){await wa(a)}}async function hv(r,e,t){const n=Be(r);try{const a=await function(o,c){const d=Be(o);return d.persistence.runTransaction("Reject batch","readwrite-primary",h=>{let g;return d.mutationQueue.lookupMutationBatch(h,c).next(f=>(nt(f!==null),g=f.keys(),d.mutationQueue.removeMutationBatch(h,f))).next(()=>d.mutationQueue.performConsistencyCheck(h)).next(()=>d.documentOverlayCache.removeOverlaysForBatchId(h,g,c)).next(()=>d.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(h,g)).next(()=>d.localDocuments.getDocuments(h,g))})}(n.localStore,e);Vm(n,e,t),Om(n,e),n.sharedClientState.updateMutationState(e,"rejected",t),await Ea(n,a)}catch(a){await wa(a)}}function Om(r,e){(r.ka.get(e)||[]).forEach(t=>{t.resolve()}),r.ka.delete(e)}function Vm(r,e,t){const n=Be(r);let a=n.Ba[n.currentUser.toKey()];if(a){const i=a.get(e);i&&(t?i.reject(t):i.resolve(),a=a.remove(e)),n.Ba[n.currentUser.toKey()]=a}}function hl(r,e,t=null){r.sharedClientState.removeLocalQueryTarget(e);for(const n of r.Ma.get(e))r.Fa.delete(n),t&&r.Ca.$a(n,t);r.Ma.delete(e),r.isPrimaryClient&&r.La.gr(e).forEach(n=>{r.La.containsKey(n)||Lm(r,n)})}function Lm(r,e){r.xa.delete(e.path.canonicalString());const t=r.Oa.get(e);t!==null&&(Bl(r.remoteStore,t),r.Oa=r.Oa.remove(e),r.Na.delete(t),Yl(r))}function lu(r,e,t){for(const n of t)n instanceof Rm?(r.La.addReference(n.key,e),mv(r,n)):n instanceof Pm?(Ee("SyncEngine","Document no longer in limbo: "+n.key),r.La.removeReference(n.key,e),r.La.containsKey(n.key)||Lm(r,n.key)):Le()}function mv(r,e){const t=e.key,n=t.path.canonicalString();r.Oa.get(t)||r.xa.has(n)||(Ee("SyncEngine","New document in limbo: "+t),r.xa.add(n),Yl(r))}function Yl(r){for(;r.xa.size>0&&r.Oa.size<r.maxConcurrentLimboResolutions;){const e=r.xa.values().next().value;r.xa.delete(e);const t=new Re(ht.fromString(e)),n=r.qa.next();r.Na.set(n,new rv(t)),r.Oa=r.Oa.insert(t,n),Nm(r.remoteStore,new cs(wr(Rl(t.path)),n,"TargetPurposeLimboResolution",Il.oe))}}async function Ea(r,e,t){const n=Be(r),a=[],i=[],o=[];n.Fa.isEmpty()||(n.Fa.forEach((c,d)=>{o.push(n.Ka(d,e,t).then(h=>{var g;if((h||t)&&n.isPrimaryClient){const f=h?!h.fromCache:(g=t==null?void 0:t.targetChanges.get(d.targetId))===null||g===void 0?void 0:g.current;n.sharedClientState.updateQueryState(d.targetId,f?"current":"not-current")}if(h){a.push(h);const f=Ul.Wi(d.targetId,h);i.push(f)}}))}),await Promise.all(o),n.Ca.d_(a),await async function(d,h){const g=Be(d);try{await g.persistence.runTransaction("notifyLocalViewChanges","readwrite",f=>le.forEach(h,p=>le.forEach(p.$i,v=>g.persistence.referenceDelegate.addReference(f,p.targetId,v)).next(()=>le.forEach(p.Ui,v=>g.persistence.referenceDelegate.removeReference(f,p.targetId,v)))))}catch(f){if(!ka(f))throw f;Ee("LocalStore","Failed to update sequence numbers: "+f)}for(const f of h){const p=f.targetId;if(!f.fromCache){const v=g.os.get(p),A=v.snapshotVersion,T=v.withLastLimboFreeSnapshotVersion(A);g.os=g.os.insert(p,T)}}}(n.localStore,i))}async function gv(r,e){const t=Be(r);if(!t.currentUser.isEqual(e)){Ee("SyncEngine","User change. New user:",e.toKey());const n=await vm(t.localStore,e);t.currentUser=e,function(i,o){i.ka.forEach(c=>{c.forEach(d=>{d.reject(new ke(se.CANCELLED,o))})}),i.ka.clear()}(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,n.removedBatchIds,n.addedBatchIds),await Ea(t,n.hs)}}function pv(r,e){const t=Be(r),n=t.Na.get(e);if(n&&n.va)return Ge().add(n.key);{let a=Ge();const i=t.Ma.get(e);if(!i)return a;for(const o of i){const c=t.Fa.get(o);a=a.unionWith(c.view.Va)}return a}}function Fm(r){const e=Be(r);return e.remoteStore.remoteSyncer.applyRemoteEvent=$m.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=pv.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=dv.bind(null,e),e.Ca.d_=Jb.bind(null,e.eventManager),e.Ca.$a=Zb.bind(null,e.eventManager),e}function fv(r){const e=Be(r);return e.remoteStore.remoteSyncer.applySuccessfulWrite=uv.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=hv.bind(null,e),e}class ji{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=Qi(e.databaseInfo.databaseId),this.sharedClientState=this.Wa(e),this.persistence=this.Ga(e),await this.persistence.start(),this.localStore=this.za(e),this.gcScheduler=this.ja(e,this.localStore),this.indexBackfillerScheduler=this.Ha(e,this.localStore)}ja(e,t){return null}Ha(e,t){return null}za(e){return kb(this.persistence,new vb,e.initialUser,this.serializer)}Ga(e){return new xb(Fl.Zr,this.serializer)}Wa(e){return new Sb}async terminate(){var e,t;(e=this.gcScheduler)===null||e===void 0||e.stop(),(t=this.indexBackfillerScheduler)===null||t===void 0||t.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}ji.provider={build:()=>new ji};class ml{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=n=>ou(this.syncEngine,n,1),this.remoteStore.remoteSyncer.handleCredentialChange=gv.bind(null,this.syncEngine),await Yb(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return function(){return new Xb}()}createDatastore(e){const t=Qi(e.databaseInfo.databaseId),n=function(i){return new Rb(i)}(e.databaseInfo);return function(i,o,c,d){return new $b(i,o,c,d)}(e.authCredentials,e.appCheckCredentials,n,t)}createRemoteStore(e){return function(n,a,i,o,c){return new Vb(n,a,i,o,c)}(this.localStore,this.datastore,e.asyncQueue,t=>ou(this.syncEngine,t,0),function(){return ru.D()?new ru:new Ab}())}createSyncEngine(e,t){return function(a,i,o,c,d,h,g){const f=new sv(a,i,o,c,d,h);return g&&(f.Qa=!0),f}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){var e,t;await async function(a){const i=Be(a);Ee("RemoteStore","RemoteStore shutting down."),i.L_.add(5),await ja(i),i.k_.shutdown(),i.q_.set("Unknown")}(this.remoteStore),(e=this.datastore)===null||e===void 0||e.terminate(),(t=this.eventManager)===null||t===void 0||t.terminate()}}ml.provider={build:()=>new ml};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Um{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ya(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ya(this.observer.error,e):Wr("Uncaught Error in snapshot listener:",e.toString()))}Za(){this.muted=!0}Ya(e,t){setTimeout(()=>{this.muted||e(t)},0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xv{constructor(e,t,n,a,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=a,this.user=Bt.UNAUTHENTICATED,this.clientId=Uh.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(n,async o=>{Ee("FirestoreClient","Received user=",o.uid),await this.authCredentialListener(o),this.user=o}),this.appCheckCredentials.start(n,o=>(Ee("FirestoreClient","Received new app check token=",o),this.appCheckCredentialListener(o,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new Ur;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const n=Gl(t,"Failed to shutdown persistence");e.reject(n)}}),e.promise}}async function Lo(r,e){r.asyncQueue.verifyOperationInProgress(),Ee("FirestoreClient","Initializing OfflineComponentProvider");const t=r.configuration;await e.initialize(t);let n=t.initialUser;r.setCredentialChangeListener(async a=>{n.isEqual(a)||(await vm(e.localStore,a),n=a)}),e.persistence.setDatabaseDeletedListener(()=>r.terminate()),r._offlineComponents=e}async function cu(r,e){r.asyncQueue.verifyOperationInProgress();const t=await yv(r);Ee("FirestoreClient","Initializing OnlineComponentProvider"),await e.initialize(t,r.configuration),r.setCredentialChangeListener(n=>su(e.remoteStore,n)),r.setAppCheckTokenChangeListener((n,a)=>su(e.remoteStore,a)),r._onlineComponents=e}async function yv(r){if(!r._offlineComponents)if(r._uninitializedComponentsProvider){Ee("FirestoreClient","Using user provided OfflineComponentProvider");try{await Lo(r,r._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!function(a){return a.name==="FirebaseError"?a.code===se.FAILED_PRECONDITION||a.code===se.UNIMPLEMENTED:!(typeof DOMException<"u"&&a instanceof DOMException)||a.code===22||a.code===20||a.code===11}(t))throw t;dn("Error using user provided cache. Falling back to memory cache: "+t),await Lo(r,new ji)}}else Ee("FirestoreClient","Using default OfflineComponentProvider"),await Lo(r,new ji);return r._offlineComponents}async function Bm(r){return r._onlineComponents||(r._uninitializedComponentsProvider?(Ee("FirestoreClient","Using user provided OnlineComponentProvider"),await cu(r,r._uninitializedComponentsProvider._online)):(Ee("FirestoreClient","Using default OnlineComponentProvider"),await cu(r,new ml))),r._onlineComponents}function bv(r){return Bm(r).then(e=>e.syncEngine)}async function Wm(r){const e=await Bm(r),t=e.eventManager;return t.onListen=nv.bind(null,e.syncEngine),t.onUnlisten=ov.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=av.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=lv.bind(null,e.syncEngine),t}function vv(r,e,t={}){const n=new Ur;return r.asyncQueue.enqueueAndForget(async()=>function(i,o,c,d,h){const g=new Um({next:p=>{g.Za(),o.enqueueAndForget(()=>Cm(i,f));const v=p.docs.has(c);!v&&p.fromCache?h.reject(new ke(se.UNAVAILABLE,"Failed to get document because the client is offline.")):v&&p.fromCache&&d&&d.source==="server"?h.reject(new ke(se.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):h.resolve(p)},error:p=>h.reject(p)}),f=new Dm(Rl(c.path),g,{includeMetadataChanges:!0,_a:!0});return Am(i,f)}(await Wm(r),r.asyncQueue,e,t,n)),n.promise}function wv(r,e,t={}){const n=new Ur;return r.asyncQueue.enqueueAndForget(async()=>function(i,o,c,d,h){const g=new Um({next:p=>{g.Za(),o.enqueueAndForget(()=>Cm(i,f)),p.fromCache&&d.source==="server"?h.reject(new ke(se.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):h.resolve(p)},error:p=>h.reject(p)}),f=new Dm(c,g,{includeMetadataChanges:!0,_a:!0});return Am(i,f)}(await Wm(r),r.asyncQueue,e,t,n)),n.promise}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qm(r){const e={};return r.timeoutSeconds!==void 0&&(e.timeoutSeconds=r.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const du=new Map;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zm(r,e,t){if(!t)throw new ke(se.INVALID_ARGUMENT,`Function ${r}() cannot be called with an empty ${e}.`)}function kv(r,e,t,n){if(e===!0&&n===!0)throw new ke(se.INVALID_ARGUMENT,`${r} and ${t} cannot be used together.`)}function uu(r){if(!Re.isDocumentKey(r))throw new ke(se.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${r} has ${r.length}.`)}function hu(r){if(Re.isDocumentKey(r))throw new ke(se.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${r} has ${r.length}.`)}function Zi(r){if(r===void 0)return"undefined";if(r===null)return"null";if(typeof r=="string")return r.length>20&&(r=`${r.substring(0,20)}...`),JSON.stringify(r);if(typeof r=="number"||typeof r=="boolean")return""+r;if(typeof r=="object"){if(r instanceof Array)return"an array";{const e=function(n){return n.constructor?n.constructor.name:null}(r);return e?`a custom ${e} object`:"an object"}}return typeof r=="function"?"a function":Le()}function zr(r,e){if("_delegate"in r&&(r=r._delegate),!(r instanceof e)){if(e.name===r.constructor.name)throw new ke(se.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=Zi(r);throw new ke(se.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return r}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mu{constructor(e){var t,n;if(e.host===void 0){if(e.ssl!==void 0)throw new ke(se.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=(t=e.ssl)===null||t===void 0||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new ke(se.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}kv("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=qm((n=e.experimentalLongPollingOptions)!==null&&n!==void 0?n:{}),function(i){if(i.timeoutSeconds!==void 0){if(isNaN(i.timeoutSeconds))throw new ke(se.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (must not be NaN)`);if(i.timeoutSeconds<5)throw new ke(se.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (minimum allowed value is 5)`);if(i.timeoutSeconds>30)throw new ke(se.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(n,a){return n.timeoutSeconds===a.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class eo{constructor(e,t,n,a){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=a,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new mu({}),this._settingsFrozen=!1,this._terminateTask="notTerminated"}get app(){if(!this._app)throw new ke(se.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new ke(se.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new mu(e),e.credentials!==void 0&&(this._authCredentials=function(n){if(!n)return new Fx;switch(n.type){case"firstParty":return new qx(n.sessionIndex||"0",n.iamToken||null,n.authTokenFactory||null);case"provider":return n.client;default:throw new ke(se.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const n=du.get(t);n&&(Ee("ComponentProvider","Removing Datastore"),du.delete(t),n.terminate())}(this),Promise.resolve()}}function _v(r,e,t,n={}){var a;const i=(r=zr(r,eo))._getSettings(),o=`${e}:${t}`;if(i.host!=="firestore.googleapis.com"&&i.host!==o&&dn("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),r._setSettings(Object.assign(Object.assign({},i),{host:o,ssl:!1})),n.mockUserToken){let c,d;if(typeof n.mockUserToken=="string")c=n.mockUserToken,d=Bt.MOCK_USER;else{c=Th(n.mockUserToken,(a=r._app)===null||a===void 0?void 0:a.options.projectId);const h=n.mockUserToken.sub||n.mockUserToken.user_id;if(!h)throw new ke(se.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");d=new Bt(h)}r._authCredentials=new Ux(new Fh(c,d))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qs{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new qs(this.firestore,e,this._query)}}class Xt{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new hs(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Xt(this.firestore,e,this._key)}}class hs extends qs{constructor(e,t,n){super(e,t,Rl(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Xt(this.firestore,null,new Re(e))}withConverter(e){return new hs(this.firestore,e,this._path)}}function Nt(r,e,...t){if(r=zt(r),zm("collection","path",e),r instanceof eo){const n=ht.fromString(e,...t);return hu(n),new hs(r,null,n)}{if(!(r instanceof Xt||r instanceof hs))throw new ke(se.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const n=r._path.child(ht.fromString(e,...t));return hu(n),new hs(r.firestore,null,n)}}function Ct(r,e,...t){if(r=zt(r),arguments.length===1&&(e=Uh.newId()),zm("doc","path",e),r instanceof eo){const n=ht.fromString(e,...t);return uu(n),new Xt(r,null,new Re(n))}{if(!(r instanceof Xt||r instanceof hs))throw new ke(se.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const n=r._path.child(ht.fromString(e,...t));return uu(n),new Xt(r.firestore,r instanceof hs?r.converter:null,new Re(n))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gu{constructor(e=Promise.resolve()){this.Pu=[],this.Iu=!1,this.Tu=[],this.Eu=null,this.du=!1,this.Au=!1,this.Ru=[],this.t_=new km(this,"async_queue_retry"),this.Vu=()=>{const n=Vo();n&&Ee("AsyncQueue","Visibility state changed to "+n.visibilityState),this.t_.jo()},this.mu=e;const t=Vo();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this.Vu)}get isShuttingDown(){return this.Iu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.fu(),this.gu(e)}enterRestrictedMode(e){if(!this.Iu){this.Iu=!0,this.Au=e||!1;const t=Vo();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this.Vu)}}enqueue(e){if(this.fu(),this.Iu)return new Promise(()=>{});const t=new Ur;return this.gu(()=>this.Iu&&this.Au?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Pu.push(e),this.pu()))}async pu(){if(this.Pu.length!==0){try{await this.Pu[0](),this.Pu.shift(),this.t_.reset()}catch(e){if(!ka(e))throw e;Ee("AsyncQueue","Operation failed with retryable error: "+e)}this.Pu.length>0&&this.t_.Go(()=>this.pu())}}gu(e){const t=this.mu.then(()=>(this.du=!0,e().catch(n=>{this.Eu=n,this.du=!1;const a=function(o){let c=o.message||"";return o.stack&&(c=o.stack.includes(o.message)?o.stack:o.message+`
`+o.stack),c}(n);throw Wr("INTERNAL UNHANDLED ERROR: ",a),n}).then(n=>(this.du=!1,n))));return this.mu=t,t}enqueueAfterDelay(e,t,n){this.fu(),this.Ru.indexOf(e)>-1&&(t=0);const a=Hl.createAndSchedule(this,e,t,n,i=>this.yu(i));return this.Tu.push(a),a}fu(){this.Eu&&Le()}verifyOperationInProgress(){}async wu(){let e;do e=this.mu,await e;while(e!==this.mu)}Su(e){for(const t of this.Tu)if(t.timerId===e)return!0;return!1}bu(e){return this.wu().then(()=>{this.Tu.sort((t,n)=>t.targetTimeMs-n.targetTimeMs);for(const t of this.Tu)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.wu()})}Du(e){this.Ru.push(e)}yu(e){const t=this.Tu.indexOf(e);this.Tu.splice(t,1)}}class Nn extends eo{constructor(e,t,n,a){super(e,t,n,a),this.type="firestore",this._queue=new gu,this._persistenceKey=(a==null?void 0:a.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new gu(e),this._firestoreClient=void 0,await e}}}function Nv(r,e){const t=typeof r=="object"?r:jl(),n=typeof r=="string"?r:"(default)",a=Wi(t,"firestore").getImmediate({identifier:n});if(!a._initialized){const i=jh("firestore");i&&_v(a,...i)}return a}function Ql(r){if(r._terminated)throw new ke(se.FAILED_PRECONDITION,"The client has already been terminated.");return r._firestoreClient||jv(r),r._firestoreClient}function jv(r){var e,t,n;const a=r._freezeSettings(),i=function(c,d,h,g){return new sy(c,d,h,g.host,g.ssl,g.experimentalForceLongPolling,g.experimentalAutoDetectLongPolling,qm(g.experimentalLongPollingOptions),g.useFetchStreams)}(r._databaseId,((e=r._app)===null||e===void 0?void 0:e.options.appId)||"",r._persistenceKey,a);r._componentsProvider||!((t=a.localCache)===null||t===void 0)&&t._offlineComponentProvider&&(!((n=a.localCache)===null||n===void 0)&&n._onlineComponentProvider)&&(r._componentsProvider={_offline:a.localCache._offlineComponentProvider,_online:a.localCache._onlineComponentProvider}),r._firestoreClient=new xv(r._authCredentials,r._appCheckCredentials,r._queue,i,r._componentsProvider&&function(c){const d=c==null?void 0:c._online.build();return{_offline:c==null?void 0:c._offline.build(d),_online:d}}(r._componentsProvider))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fn{constructor(e){this._byteString=e}static fromBase64String(e){try{return new fn(Vt.fromBase64String(e))}catch(t){throw new ke(se.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new fn(Vt.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class to{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new ke(se.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Mt(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xl{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jl{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new ke(se.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new ke(se.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return rt(this._lat,e._lat)||rt(this._long,e._long)}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zl{constructor(e){this._values=(e||[]).map(t=>t)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(n,a){if(n.length!==a.length)return!1;for(let i=0;i<n.length;++i)if(n[i]!==a[i])return!1;return!0}(this._values,e._values)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ev=/^__.*__$/;class Iv{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return this.fieldMask!==null?new bs(e,this.data,this.fieldMask,t,this.fieldTransforms):new _a(e,this.data,t,this.fieldTransforms)}}class Hm{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return new bs(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function Gm(r){switch(r){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Le()}}class ec{constructor(e,t,n,a,i,o){this.settings=e,this.databaseId=t,this.serializer=n,this.ignoreUndefinedProperties=a,i===void 0&&this.vu(),this.fieldTransforms=i||[],this.fieldMask=o||[]}get path(){return this.settings.path}get Cu(){return this.settings.Cu}Fu(e){return new ec(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Mu(e){var t;const n=(t=this.path)===null||t===void 0?void 0:t.child(e),a=this.Fu({path:n,xu:!1});return a.Ou(e),a}Nu(e){var t;const n=(t=this.path)===null||t===void 0?void 0:t.child(e),a=this.Fu({path:n,xu:!1});return a.vu(),a}Lu(e){return this.Fu({path:void 0,xu:!0})}Bu(e){return Ei(e,this.settings.methodName,this.settings.ku||!1,this.path,this.settings.qu)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}vu(){if(this.path)for(let e=0;e<this.path.length;e++)this.Ou(this.path.get(e))}Ou(e){if(e.length===0)throw this.Bu("Document fields must not be empty");if(Gm(this.Cu)&&Ev.test(e))throw this.Bu('Document fields cannot begin and end with "__"')}}class Tv{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=n||Qi(e)}Qu(e,t,n,a=!1){return new ec({Cu:e,methodName:t,qu:n,path:Mt.emptyPath(),xu:!1,ku:a},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function tc(r){const e=r._freezeSettings(),t=Qi(r._databaseId);return new Tv(r._databaseId,!!e.ignoreUndefinedProperties,t)}function Sv(r,e,t,n,a,i={}){const o=r.Qu(i.merge||i.mergeFields?2:0,e,t,a);rc("Data must be an object, but it was:",o,n);const c=Km(n,o);let d,h;if(i.merge)d=new sr(o.fieldMask),h=o.fieldTransforms;else if(i.mergeFields){const g=[];for(const f of i.mergeFields){const p=gl(e,f,t);if(!o.contains(p))throw new ke(se.INVALID_ARGUMENT,`Field '${p}' is specified in your field mask but missing from your input data.`);Qm(g,p)||g.push(p)}d=new sr(g),h=o.fieldTransforms.filter(f=>d.covers(f.field))}else d=null,h=o.fieldTransforms;return new Iv(new Yt(c),d,h)}class ro extends Xl{_toFieldTransform(e){if(e.Cu!==2)throw e.Cu===1?e.Bu(`${this._methodName}() can only appear at the top level of your update data`):e.Bu(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof ro}}function Av(r,e,t,n){const a=r.Qu(1,e,t);rc("Data must be an object, but it was:",a,n);const i=[],o=Yt.empty();Bs(n,(d,h)=>{const g=sc(e,d,t);h=zt(h);const f=a.Nu(g);if(h instanceof ro)i.push(g);else{const p=Ia(h,f);p!=null&&(i.push(g),o.set(g,p))}});const c=new sr(i);return new Hm(o,c,a.fieldTransforms)}function Cv(r,e,t,n,a,i){const o=r.Qu(1,e,t),c=[gl(e,n,t)],d=[a];if(i.length%2!=0)throw new ke(se.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let p=0;p<i.length;p+=2)c.push(gl(e,i[p])),d.push(i[p+1]);const h=[],g=Yt.empty();for(let p=c.length-1;p>=0;--p)if(!Qm(h,c[p])){const v=c[p];let A=d[p];A=zt(A);const T=o.Nu(v);if(A instanceof ro)h.push(v);else{const S=Ia(A,T);S!=null&&(h.push(v),g.set(v,S))}}const f=new sr(h);return new Hm(g,f,o.fieldTransforms)}function Dv(r,e,t,n=!1){return Ia(t,r.Qu(n?4:3,e))}function Ia(r,e){if(Ym(r=zt(r)))return rc("Unsupported field value:",e,r),Km(r,e);if(r instanceof Xl)return function(n,a){if(!Gm(a.Cu))throw a.Bu(`${n._methodName}() can only be used with update() and set()`);if(!a.path)throw a.Bu(`${n._methodName}() is not currently supported inside arrays`);const i=n._toFieldTransform(a);i&&a.fieldTransforms.push(i)}(r,e),null;if(r===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),r instanceof Array){if(e.settings.xu&&e.Cu!==4)throw e.Bu("Nested arrays are not supported");return function(n,a){const i=[];let o=0;for(const c of n){let d=Ia(c,a.Lu(o));d==null&&(d={nullValue:"NULL_VALUE"}),i.push(d),o++}return{arrayValue:{values:i}}}(r,e)}return function(n,a){if((n=zt(n))===null)return{nullValue:"NULL_VALUE"};if(typeof n=="number")return jy(a.serializer,n);if(typeof n=="boolean")return{booleanValue:n};if(typeof n=="string")return{stringValue:n};if(n instanceof Date){const i=It.fromDate(n);return{timestampValue:_i(a.serializer,i)}}if(n instanceof It){const i=new It(n.seconds,1e3*Math.floor(n.nanoseconds/1e3));return{timestampValue:_i(a.serializer,i)}}if(n instanceof Jl)return{geoPointValue:{latitude:n.latitude,longitude:n.longitude}};if(n instanceof fn)return{bytesValue:mm(a.serializer,n._byteString)};if(n instanceof Xt){const i=a.databaseId,o=n.firestore._databaseId;if(!o.isEqual(i))throw a.Bu(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${i.projectId}/${i.database}`);return{referenceValue:Vl(n.firestore._databaseId||a.databaseId,n._key.path)}}if(n instanceof Zl)return function(o,c){return{mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{values:o.toArray().map(d=>{if(typeof d!="number")throw c.Bu("VectorValues must only contain numeric values.");return Pl(c.serializer,d)})}}}}}}(n,a);throw a.Bu(`Unsupported field value: ${Zi(n)}`)}(r,e)}function Km(r,e){const t={};return Bh(r)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Bs(r,(n,a)=>{const i=Ia(a,e.Mu(n));i!=null&&(t[n]=i)}),{mapValue:{fields:t}}}function Ym(r){return!(typeof r!="object"||r===null||r instanceof Array||r instanceof Date||r instanceof It||r instanceof Jl||r instanceof fn||r instanceof Xt||r instanceof Xl||r instanceof Zl)}function rc(r,e,t){if(!Ym(t)||!function(a){return typeof a=="object"&&a!==null&&(Object.getPrototypeOf(a)===Object.prototype||Object.getPrototypeOf(a)===null)}(t)){const n=Zi(t);throw n==="an object"?e.Bu(r+" a custom object"):e.Bu(r+" "+n)}}function gl(r,e,t){if((e=zt(e))instanceof to)return e._internalPath;if(typeof e=="string")return sc(r,e);throw Ei("Field path arguments must be of type string or ",r,!1,void 0,t)}const Rv=new RegExp("[~\\*/\\[\\]]");function sc(r,e,t){if(e.search(Rv)>=0)throw Ei(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,r,!1,void 0,t);try{return new to(...e.split("."))._internalPath}catch{throw Ei(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,r,!1,void 0,t)}}function Ei(r,e,t,n,a){const i=n&&!n.isEmpty(),o=a!==void 0;let c=`Function ${e}() called with invalid data`;t&&(c+=" (via `toFirestore()`)"),c+=". ";let d="";return(i||o)&&(d+=" (found",i&&(d+=` in field ${n}`),o&&(d+=` in document ${a}`),d+=")"),new ke(se.INVALID_ARGUMENT,c+r+d)}function Qm(r,e){return r.some(t=>t.isEqual(e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xm{constructor(e,t,n,a,i){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=a,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new Xt(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new Pv(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(so("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}}class Pv extends Xm{data(){return super.data()}}function so(r,e){return typeof e=="string"?sc(r,e):e instanceof to?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Mv(r){if(r.limitType==="L"&&r.explicitOrderBy.length===0)throw new ke(se.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class nc{}class Jm extends nc{}function yt(r,e,...t){let n=[];e instanceof nc&&n.push(e),n=n.concat(t),function(i){const o=i.filter(d=>d instanceof ac).length,c=i.filter(d=>d instanceof no).length;if(o>1||o>0&&c>0)throw new ke(se.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(n);for(const a of n)r=a._apply(r);return r}class no extends Jm{constructor(e,t,n){super(),this._field=e,this._op=t,this._value=n,this.type="where"}static _create(e,t,n){return new no(e,t,n)}_apply(e){const t=this._parse(e);return Zm(e._query,t),new qs(e.firestore,e.converter,nl(e._query,t))}_parse(e){const t=tc(e.firestore);return function(i,o,c,d,h,g,f){let p;if(h.isKeyField()){if(g==="array-contains"||g==="array-contains-any")throw new ke(se.INVALID_ARGUMENT,`Invalid Query. You can't perform '${g}' queries on documentId().`);if(g==="in"||g==="not-in"){fu(f,g);const v=[];for(const A of f)v.push(pu(d,i,A));p={arrayValue:{values:v}}}else p=pu(d,i,f)}else g!=="in"&&g!=="not-in"&&g!=="array-contains-any"||fu(f,g),p=Dv(c,o,f,g==="in"||g==="not-in");return _t.create(h,g,p)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}}function Jt(r,e,t){const n=e,a=so("where",r);return no._create(a,n,t)}class ac extends nc{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new ac(e,t)}_parse(e){const t=this._queryConstraints.map(n=>n._parse(e)).filter(n=>n.getFilters().length>0);return t.length===1?t[0]:pr.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return t.getFilters().length===0?e:(function(a,i){let o=a;const c=i.getFlattenedFilters();for(const d of c)Zm(o,d),o=nl(o,d)}(e._query,t),new qs(e.firestore,e.converter,nl(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}class ic extends Jm{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new ic(e,t)}_apply(e){const t=function(a,i,o){if(a.startAt!==null)throw new ke(se.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(a.endAt!==null)throw new ke(se.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new la(i,o)}(e._query,this._field,this._direction);return new qs(e.firestore,e.converter,function(a,i){const o=a.explicitOrderBy.concat([i]);return new wn(a.path,a.collectionGroup,o,a.filters.slice(),a.limit,a.limitType,a.startAt,a.endAt)}(e._query,t))}}function ua(r,e="asc"){const t=e,n=so("orderBy",r);return ic._create(n,t)}function pu(r,e,t){if(typeof(t=zt(t))=="string"){if(t==="")throw new ke(se.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Xh(e)&&t.indexOf("/")!==-1)throw new ke(se.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);const n=e.path.child(ht.fromString(t));if(!Re.isDocumentKey(n))throw new ke(se.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${n}' is not because it has an odd number of segments (${n.length}).`);return Od(r,new Re(n))}if(t instanceof Xt)return Od(r,t._key);throw new ke(se.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Zi(t)}.`)}function fu(r,e){if(!Array.isArray(r)||r.length===0)throw new ke(se.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function Zm(r,e){const t=function(a,i){for(const o of a)for(const c of o.getFlattenedFilters())if(i.indexOf(c.op)>=0)return c.op;return null}(r.filters,function(a){switch(a){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(t!==null)throw t===e.op?new ke(se.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new ke(se.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}class $v{convertValue(e,t="none"){switch(Ls(e)){case 0:return null;case 1:return e.booleanValue;case 2:return vt(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Vs(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw Le()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const n={};return Bs(e,(a,i)=>{n[a]=this.convertValue(i,t)}),n}convertVectorValue(e){var t,n,a;const i=(a=(n=(t=e.fields)===null||t===void 0?void 0:t.value.arrayValue)===null||n===void 0?void 0:n.values)===null||a===void 0?void 0:a.map(o=>vt(o.doubleValue));return new Zl(i)}convertGeoPoint(e){return new Jl(vt(e.latitude),vt(e.longitude))}convertArray(e,t){return(e.values||[]).map(n=>this.convertValue(n,t))}convertServerTimestamp(e,t){switch(t){case"previous":const n=Sl(e);return n==null?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(aa(e));default:return null}}convertTimestamp(e){const t=xs(e);return new It(t.seconds,t.nanos)}convertDocumentKey(e,t){const n=ht.fromString(e);nt(bm(n));const a=new ia(n.get(1),n.get(3)),i=new Re(n.popFirst(5));return a.isEqual(t)||Wr(`Document ${i} contains a document reference within a different database (${a.projectId}/${a.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ov(r,e,t){let n;return n=r?r.toFirestore(e):e,n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zn{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class eg extends Xm{constructor(e,t,n,a,i,o){super(e,t,n,a,o),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new li(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const n=this._document.data.field(so("DocumentSnapshot.get",e));if(n!==null)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}}class li extends eg{data(e={}){return super.data(e)}}class Vv{constructor(e,t,n,a){this._firestore=e,this._userDataWriter=t,this._snapshot=a,this.metadata=new zn(a.hasPendingWrites,a.fromCache),this.query=n}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(n=>{e.call(t,new li(this._firestore,this._userDataWriter,n.key,n,new zn(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new ke(se.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(a,i){if(a._snapshot.oldDocs.isEmpty()){let o=0;return a._snapshot.docChanges.map(c=>{const d=new li(a._firestore,a._userDataWriter,c.doc.key,c.doc,new zn(a._snapshot.mutatedKeys.has(c.doc.key),a._snapshot.fromCache),a.query.converter);return c.doc,{type:"added",doc:d,oldIndex:-1,newIndex:o++}})}{let o=a._snapshot.oldDocs;return a._snapshot.docChanges.filter(c=>i||c.type!==3).map(c=>{const d=new li(a._firestore,a._userDataWriter,c.doc.key,c.doc,new zn(a._snapshot.mutatedKeys.has(c.doc.key),a._snapshot.fromCache),a.query.converter);let h=-1,g=-1;return c.type!==0&&(h=o.indexOf(c.doc.key),o=o.delete(c.doc.key)),c.type!==1&&(o=o.add(c.doc),g=o.indexOf(c.doc.key)),{type:Lv(c.type),doc:d,oldIndex:h,newIndex:g}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function Lv(r){switch(r){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Le()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function tg(r){r=zr(r,Xt);const e=zr(r.firestore,Nn);return vv(Ql(e),r._key).then(t=>Fv(e,r,t))}class rg extends $v{constructor(e){super(),this.firestore=e}convertBytes(e){return new fn(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Xt(this.firestore,null,t)}}function cr(r){r=zr(r,qs);const e=zr(r.firestore,Nn),t=Ql(e),n=new rg(e);return Mv(r._query),wv(t,r._query).then(a=>new Vv(e,n,r,a))}function Yr(r,e,t,...n){r=zr(r,Xt);const a=zr(r.firestore,Nn),i=tc(a);let o;return o=typeof(e=zt(e))=="string"||e instanceof to?Cv(i,"updateDoc",r._key,e,t,n):Av(i,"updateDoc",r._key,e),oc(a,[o.toMutation(r._key,gr.exists(!0))])}function vs(r){return oc(zr(r.firestore,Nn),[new Ml(r._key,gr.none())])}function ws(r,e){const t=zr(r.firestore,Nn),n=Ct(r),a=Ov(r.converter,e);return oc(t,[Sv(tc(r.firestore),"addDoc",n._key,a,r.converter!==null,{}).toMutation(n._key,gr.exists(!1))]).then(()=>n)}function oc(r,e){return function(n,a){const i=new Ur;return n.asyncQueue.enqueueAndForget(async()=>cv(await bv(n),a,i)),i.promise}(Ql(r),e)}function Fv(r,e,t){const n=t.docs.get(e._key),a=new rg(r);return new eg(r,a,e._key,n,new zn(t.hasPendingWrites,t.fromCache),e.converter)}(function(e,t=!0){(function(a){vn=a})(Us),$s(new ps("firestore",(n,{instanceIdentifier:a,options:i})=>{const o=n.getProvider("app").getImmediate(),c=new Nn(new Bx(n.getProvider("auth-internal")),new Hx(n.getProvider("app-check-internal")),function(h,g){if(!Object.prototype.hasOwnProperty.apply(h.options,["projectId"]))throw new ke(se.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new ia(h.options.projectId,g)}(o,a),o);return i=Object.assign({useFetchStreams:t},i),c._setSettings(i),c},"PUBLIC").setMultipleInstances(!0)),vr(Dd,"4.7.3",e),vr(Dd,"4.7.3","esm2017")})();var Uv="firebase",Bv="10.14.1";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */vr(Uv,Bv,"app");function lc(r,e){var t={};for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&e.indexOf(n)<0&&(t[n]=r[n]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var a=0,n=Object.getOwnPropertySymbols(r);a<n.length;a++)e.indexOf(n[a])<0&&Object.prototype.propertyIsEnumerable.call(r,n[a])&&(t[n[a]]=r[n[a]]);return t}function sg(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const Wv=sg,ng=new ba("auth","Firebase",sg());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ii=new _l("@firebase/auth");function qv(r,...e){Ii.logLevel<=Ye.WARN&&Ii.warn(`Auth (${Us}): ${r}`,...e)}function ci(r,...e){Ii.logLevel<=Ye.ERROR&&Ii.error(`Auth (${Us}): ${r}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Hr(r,...e){throw cc(r,...e)}function _r(r,...e){return cc(r,...e)}function ag(r,e,t){const n=Object.assign(Object.assign({},Wv()),{[e]:t});return new ba("auth","Firebase",n).create(e,{appName:r.name})}function Cs(r){return ag(r,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function cc(r,...e){if(typeof r!="string"){const t=e[0],n=[...e.slice(1)];return n[0]&&(n[0].appName=r.name),r._errorFactory.create(t,...n)}return ng.create(r,...e)}function Ve(r,e,...t){if(!r)throw cc(e,...t)}function Or(r){const e="INTERNAL ASSERTION FAILED: "+r;throw ci(e),new Error(e)}function Gr(r,e){r||Or(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function pl(){var r;return typeof self<"u"&&((r=self.location)===null||r===void 0?void 0:r.href)||""}function zv(){return xu()==="http:"||xu()==="https:"}function xu(){var r;return typeof self<"u"&&((r=self.location)===null||r===void 0?void 0:r.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Hv(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(zv()||vf()||"connection"in navigator)?navigator.onLine:!0}function Gv(){if(typeof navigator>"u")return null;const r=navigator;return r.languages&&r.languages[0]||r.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ta{constructor(e,t){this.shortDelay=e,this.longDelay=t,Gr(t>e,"Short delay should be less than long delay!"),this.isMobile=xf()||wf()}get(){return Hv()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function dc(r,e){Gr(r.emulator,"Emulator should always be set here");const{url:t}=r.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ig{static initialize(e,t,n){this.fetchImpl=e,t&&(this.headersImpl=t),n&&(this.responseImpl=n)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;Or("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;Or("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;Or("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Kv={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Yv=new Ta(3e4,6e4);function uc(r,e){return r.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:r.tenantId}):e}async function jn(r,e,t,n,a={}){return og(r,a,async()=>{let i={},o={};n&&(e==="GET"?o=n:i={body:JSON.stringify(n)});const c=va(Object.assign({key:r.config.apiKey},o)).slice(1),d=await r._getAdditionalHeaders();d["Content-Type"]="application/json",r.languageCode&&(d["X-Firebase-Locale"]=r.languageCode);const h=Object.assign({method:e,headers:d},i);return bf()||(h.referrerPolicy="no-referrer"),ig.fetch()(lg(r,r.config.apiHost,t,c),h)})}async function og(r,e,t){r._canInitEmulator=!1;const n=Object.assign(Object.assign({},Kv),e);try{const a=new Xv(r),i=await Promise.race([t(),a.promise]);a.clearNetworkTimeout();const o=await i.json();if("needConfirmation"in o)throw Xa(r,"account-exists-with-different-credential",o);if(i.ok&&!("errorMessage"in o))return o;{const c=i.ok?o.errorMessage:o.error.message,[d,h]=c.split(" : ");if(d==="FEDERATED_USER_ID_ALREADY_LINKED")throw Xa(r,"credential-already-in-use",o);if(d==="EMAIL_EXISTS")throw Xa(r,"email-already-in-use",o);if(d==="USER_DISABLED")throw Xa(r,"user-disabled",o);const g=n[d]||d.toLowerCase().replace(/[_\s]+/g,"-");if(h)throw ag(r,g,h);Hr(r,g)}}catch(a){if(a instanceof Tr)throw a;Hr(r,"network-request-failed",{message:String(a)})}}async function Qv(r,e,t,n,a={}){const i=await jn(r,e,t,n,a);return"mfaPendingCredential"in i&&Hr(r,"multi-factor-auth-required",{_serverResponse:i}),i}function lg(r,e,t,n){const a=`${e}${t}?${n}`;return r.config.emulator?dc(r.config,a):`${r.config.apiScheme}://${a}`}class Xv{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,n)=>{this.timer=setTimeout(()=>n(_r(this.auth,"network-request-failed")),Yv.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function Xa(r,e,t){const n={appName:r.name};t.email&&(n.email=t.email),t.phoneNumber&&(n.phoneNumber=t.phoneNumber);const a=_r(r,e,n);return a.customData._tokenResponse=t,a}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Jv(r,e){return jn(r,"POST","/v1/accounts:delete",e)}async function cg(r,e){return jn(r,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Xn(r){if(r)try{const e=new Date(Number(r));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function Zv(r,e=!1){const t=zt(r),n=await t.getIdToken(e),a=hc(n);Ve(a&&a.exp&&a.auth_time&&a.iat,t.auth,"internal-error");const i=typeof a.firebase=="object"?a.firebase:void 0,o=i==null?void 0:i.sign_in_provider;return{claims:a,token:n,authTime:Xn(Fo(a.auth_time)),issuedAtTime:Xn(Fo(a.iat)),expirationTime:Xn(Fo(a.exp)),signInProvider:o||null,signInSecondFactor:(i==null?void 0:i.sign_in_second_factor)||null}}function Fo(r){return Number(r)*1e3}function hc(r){const[e,t,n]=r.split(".");if(e===void 0||t===void 0||n===void 0)return ci("JWT malformed, contained fewer than 3 sections"),null;try{const a=_h(t);return a?JSON.parse(a):(ci("Failed to decode base64 JWT payload"),null)}catch(a){return ci("Caught error parsing JWT payload as JSON",a==null?void 0:a.toString()),null}}function yu(r){const e=hc(r);return Ve(e,"internal-error"),Ve(typeof e.exp<"u","internal-error"),Ve(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function ha(r,e,t=!1){if(t)return e;try{return await e}catch(n){throw n instanceof Tr&&ew(n)&&r.auth.currentUser===r&&await r.auth.signOut(),n}}function ew({code:r}){return r==="auth/user-disabled"||r==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tw{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){const n=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),n}else{this.errorBackoff=3e4;const a=((t=this.user.stsTokenManager.expirationTime)!==null&&t!==void 0?t:0)-Date.now()-3e5;return Math.max(0,a)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(e==null?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fl{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=Xn(this.lastLoginAt),this.creationTime=Xn(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Ti(r){var e;const t=r.auth,n=await r.getIdToken(),a=await ha(r,cg(t,{idToken:n}));Ve(a==null?void 0:a.users.length,t,"internal-error");const i=a.users[0];r._notifyReloadListener(i);const o=!((e=i.providerUserInfo)===null||e===void 0)&&e.length?dg(i.providerUserInfo):[],c=sw(r.providerData,o),d=r.isAnonymous,h=!(r.email&&i.passwordHash)&&!(c!=null&&c.length),g=d?h:!1,f={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:c,metadata:new fl(i.createdAt,i.lastLoginAt),isAnonymous:g};Object.assign(r,f)}async function rw(r){const e=zt(r);await Ti(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function sw(r,e){return[...r.filter(n=>!e.some(a=>a.providerId===n.providerId)),...e]}function dg(r){return r.map(e=>{var{providerId:t}=e,n=lc(e,["providerId"]);return{providerId:t,uid:n.rawId||"",displayName:n.displayName||null,email:n.email||null,phoneNumber:n.phoneNumber||null,photoURL:n.photoUrl||null}})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function nw(r,e){const t=await og(r,{},async()=>{const n=va({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:a,apiKey:i}=r.config,o=lg(r,a,"/v1/token",`key=${i}`),c=await r._getAdditionalHeaders();return c["Content-Type"]="application/x-www-form-urlencoded",ig.fetch()(o,{method:"POST",headers:c,body:n})});return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}}async function aw(r,e){return jn(r,"POST","/v2/accounts:revokeToken",uc(r,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tn{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){Ve(e.idToken,"internal-error"),Ve(typeof e.idToken<"u","internal-error"),Ve(typeof e.refreshToken<"u","internal-error");const t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):yu(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){Ve(e.length!==0,"internal-error");const t=yu(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return!t&&this.accessToken&&!this.isExpired?this.accessToken:(Ve(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:n,refreshToken:a,expiresIn:i}=await nw(e,t);this.updateTokensAndExpiration(n,a,Number(i))}updateTokensAndExpiration(e,t,n){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+n*1e3}static fromJSON(e,t){const{refreshToken:n,accessToken:a,expirationTime:i}=t,o=new tn;return n&&(Ve(typeof n=="string","internal-error",{appName:e}),o.refreshToken=n),a&&(Ve(typeof a=="string","internal-error",{appName:e}),o.accessToken=a),i&&(Ve(typeof i=="number","internal-error",{appName:e}),o.expirationTime=i),o}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new tn,this.toJSON())}_performRefresh(){return Or("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function es(r,e){Ve(typeof r=="string"||typeof r>"u","internal-error",{appName:e})}class Vr{constructor(e){var{uid:t,auth:n,stsTokenManager:a}=e,i=lc(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new tw(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=n,this.stsTokenManager=a,this.accessToken=a.accessToken,this.displayName=i.displayName||null,this.email=i.email||null,this.emailVerified=i.emailVerified||!1,this.phoneNumber=i.phoneNumber||null,this.photoURL=i.photoURL||null,this.isAnonymous=i.isAnonymous||!1,this.tenantId=i.tenantId||null,this.providerData=i.providerData?[...i.providerData]:[],this.metadata=new fl(i.createdAt||void 0,i.lastLoginAt||void 0)}async getIdToken(e){const t=await ha(this,this.stsTokenManager.getToken(this.auth,e));return Ve(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return Zv(this,e)}reload(){return rw(this)}_assign(e){this!==e&&(Ve(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>Object.assign({},t)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new Vr(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){Ve(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let n=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),n=!0),t&&await Ti(this),await this.auth._persistUserIfCurrent(this),n&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(ls(this.auth.app))return Promise.reject(Cs(this.auth));const e=await this.getIdToken();return await ha(this,Jv(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var n,a,i,o,c,d,h,g;const f=(n=t.displayName)!==null&&n!==void 0?n:void 0,p=(a=t.email)!==null&&a!==void 0?a:void 0,v=(i=t.phoneNumber)!==null&&i!==void 0?i:void 0,A=(o=t.photoURL)!==null&&o!==void 0?o:void 0,T=(c=t.tenantId)!==null&&c!==void 0?c:void 0,S=(d=t._redirectEventId)!==null&&d!==void 0?d:void 0,z=(h=t.createdAt)!==null&&h!==void 0?h:void 0,L=(g=t.lastLoginAt)!==null&&g!==void 0?g:void 0,{uid:C,emailVerified:j,isAnonymous:H,providerData:Y,stsTokenManager:I}=t;Ve(C&&I,e,"internal-error");const y=tn.fromJSON(this.name,I);Ve(typeof C=="string",e,"internal-error"),es(f,e.name),es(p,e.name),Ve(typeof j=="boolean",e,"internal-error"),Ve(typeof H=="boolean",e,"internal-error"),es(v,e.name),es(A,e.name),es(T,e.name),es(S,e.name),es(z,e.name),es(L,e.name);const w=new Vr({uid:C,auth:e,email:p,emailVerified:j,displayName:f,isAnonymous:H,photoURL:A,phoneNumber:v,tenantId:T,stsTokenManager:y,createdAt:z,lastLoginAt:L});return Y&&Array.isArray(Y)&&(w.providerData=Y.map(N=>Object.assign({},N))),S&&(w._redirectEventId=S),w}static async _fromIdTokenResponse(e,t,n=!1){const a=new tn;a.updateFromServerResponse(t);const i=new Vr({uid:t.localId,auth:e,stsTokenManager:a,isAnonymous:n});return await Ti(i),i}static async _fromGetAccountInfoResponse(e,t,n){const a=t.users[0];Ve(a.localId!==void 0,"internal-error");const i=a.providerUserInfo!==void 0?dg(a.providerUserInfo):[],o=!(a.email&&a.passwordHash)&&!(i!=null&&i.length),c=new tn;c.updateFromIdToken(n);const d=new Vr({uid:a.localId,auth:e,stsTokenManager:c,isAnonymous:o}),h={uid:a.localId,displayName:a.displayName||null,photoURL:a.photoUrl||null,email:a.email||null,emailVerified:a.emailVerified||!1,phoneNumber:a.phoneNumber||null,tenantId:a.tenantId||null,providerData:i,metadata:new fl(a.createdAt,a.lastLoginAt),isAnonymous:!(a.email&&a.passwordHash)&&!(i!=null&&i.length)};return Object.assign(d,h),d}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bu=new Map;function Lr(r){Gr(r instanceof Function,"Expected a class definition");let e=bu.get(r);return e?(Gr(e instanceof r,"Instance stored in cache mismatched with class"),e):(e=new r,bu.set(r,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ug{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return t===void 0?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}ug.type="NONE";const vu=ug;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function di(r,e,t){return`firebase:${r}:${e}:${t}`}class rn{constructor(e,t,n){this.persistence=e,this.auth=t,this.userKey=n;const{config:a,name:i}=this.auth;this.fullUserKey=di(this.userKey,a.apiKey,i),this.fullPersistenceKey=di("persistence",a.apiKey,i),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);return e?Vr._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,n="authUser"){if(!t.length)return new rn(Lr(vu),e,n);const a=(await Promise.all(t.map(async h=>{if(await h._isAvailable())return h}))).filter(h=>h);let i=a[0]||Lr(vu);const o=di(n,e.config.apiKey,e.name);let c=null;for(const h of t)try{const g=await h._get(o);if(g){const f=Vr._fromJSON(e,g);h!==i&&(c=f),i=h;break}}catch{}const d=a.filter(h=>h._shouldAllowMigration);return!i._shouldAllowMigration||!d.length?new rn(i,e,n):(i=d[0],c&&await i._set(o,c.toJSON()),await Promise.all(t.map(async h=>{if(h!==i)try{await h._remove(o)}catch{}})),new rn(i,e,n))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wu(r){const e=r.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(pg(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(hg(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(xg(e))return"Blackberry";if(yg(e))return"Webos";if(mg(e))return"Safari";if((e.includes("chrome/")||gg(e))&&!e.includes("edge/"))return"Chrome";if(fg(e))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,n=r.match(t);if((n==null?void 0:n.length)===2)return n[1]}return"Other"}function hg(r=qt()){return/firefox\//i.test(r)}function mg(r=qt()){const e=r.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function gg(r=qt()){return/crios\//i.test(r)}function pg(r=qt()){return/iemobile/i.test(r)}function fg(r=qt()){return/android/i.test(r)}function xg(r=qt()){return/blackberry/i.test(r)}function yg(r=qt()){return/webos/i.test(r)}function mc(r=qt()){return/iphone|ipad|ipod/i.test(r)||/macintosh/i.test(r)&&/mobile/i.test(r)}function iw(r=qt()){var e;return mc(r)&&!!(!((e=window.navigator)===null||e===void 0)&&e.standalone)}function ow(){return kf()&&document.documentMode===10}function bg(r=qt()){return mc(r)||fg(r)||yg(r)||xg(r)||/windows phone/i.test(r)||pg(r)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vg(r,e=[]){let t;switch(r){case"Browser":t=wu(qt());break;case"Worker":t=`${wu(qt())}-${r}`;break;default:t=r}const n=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${Us}/${n}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lw{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const n=i=>new Promise((o,c)=>{try{const d=e(i);o(d)}catch(d){c(d)}});n.onAbort=t,this.queue.push(n);const a=this.queue.length-1;return()=>{this.queue[a]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const n of this.queue)await n(e),n.onAbort&&t.push(n.onAbort)}catch(n){t.reverse();for(const a of t)try{a()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:n==null?void 0:n.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function cw(r,e={}){return jn(r,"GET","/v2/passwordPolicy",uc(r,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dw=6;class uw{constructor(e){var t,n,a,i;const o=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(t=o.minPasswordLength)!==null&&t!==void 0?t:dw,o.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=o.maxPasswordLength),o.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=o.containsLowercaseCharacter),o.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=o.containsUppercaseCharacter),o.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=o.containsNumericCharacter),o.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=o.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(a=(n=e.allowedNonAlphanumericCharacters)===null||n===void 0?void 0:n.join(""))!==null&&a!==void 0?a:"",this.forceUpgradeOnSignin=(i=e.forceUpgradeOnSignin)!==null&&i!==void 0?i:!1,this.schemaVersion=e.schemaVersion}validatePassword(e){var t,n,a,i,o,c;const d={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,d),this.validatePasswordCharacterOptions(e,d),d.isValid&&(d.isValid=(t=d.meetsMinPasswordLength)!==null&&t!==void 0?t:!0),d.isValid&&(d.isValid=(n=d.meetsMaxPasswordLength)!==null&&n!==void 0?n:!0),d.isValid&&(d.isValid=(a=d.containsLowercaseLetter)!==null&&a!==void 0?a:!0),d.isValid&&(d.isValid=(i=d.containsUppercaseLetter)!==null&&i!==void 0?i:!0),d.isValid&&(d.isValid=(o=d.containsNumericCharacter)!==null&&o!==void 0?o:!0),d.isValid&&(d.isValid=(c=d.containsNonAlphanumericCharacter)!==null&&c!==void 0?c:!0),d}validatePasswordLengthOptions(e,t){const n=this.customStrengthOptions.minPasswordLength,a=this.customStrengthOptions.maxPasswordLength;n&&(t.meetsMinPasswordLength=e.length>=n),a&&(t.meetsMaxPasswordLength=e.length<=a)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let n;for(let a=0;a<e.length;a++)n=e.charAt(a),this.updatePasswordCharacterOptionsStatuses(t,n>="a"&&n<="z",n>="A"&&n<="Z",n>="0"&&n<="9",this.allowedNonAlphanumericCharacters.includes(n))}updatePasswordCharacterOptionsStatuses(e,t,n,a,i){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=n)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=a)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hw{constructor(e,t,n,a){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=n,this.config=a,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new ku(this),this.idTokenSubscription=new ku(this),this.beforeStateQueue=new lw(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=ng,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=a.sdkClientVersion}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=Lr(t)),this._initializationPromise=this.queue(async()=>{var n,a;if(!this._deleted&&(this.persistenceManager=await rn.create(this,e),!this._deleted)){if(!((n=this._popupRedirectResolver)===null||n===void 0)&&n._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(t),this.lastNotifiedUid=((a=this.currentUser)===null||a===void 0?void 0:a.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const t=await cg(this,{idToken:e}),n=await Vr._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(n)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var t;if(ls(this.app)){const o=this.app.settings.authIdToken;return o?new Promise(c=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(o).then(c,c))}):this.directlySetCurrentUser(null)}const n=await this.assertedPersistence.getCurrentUser();let a=n,i=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const o=(t=this.redirectUser)===null||t===void 0?void 0:t._redirectEventId,c=a==null?void 0:a._redirectEventId,d=await this.tryRedirectSignIn(e);(!o||o===c)&&(d!=null&&d.user)&&(a=d.user,i=!0)}if(!a)return this.directlySetCurrentUser(null);if(!a._redirectEventId){if(i)try{await this.beforeStateQueue.runMiddleware(a)}catch(o){a=n,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(o))}return a?this.reloadAndSetCurrentUserOrClear(a):this.directlySetCurrentUser(null)}return Ve(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===a._redirectEventId?this.directlySetCurrentUser(a):this.reloadAndSetCurrentUserOrClear(a)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await Ti(e)}catch(t){if((t==null?void 0:t.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=Gv()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(ls(this.app))return Promise.reject(Cs(this));const t=e?zt(e):null;return t&&Ve(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&Ve(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return ls(this.app)?Promise.reject(Cs(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return ls(this.app)?Promise.reject(Cs(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(Lr(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await cw(this),t=new uw(e);this.tenantId===null?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new ba("auth","Firebase",e())}onAuthStateChanged(e,t,n){return this.registerStateListener(this.authStateSubscription,e,t,n)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,n){return this.registerStateListener(this.idTokenSubscription,e,t,n)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const n=this.onAuthStateChanged(()=>{n(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){const t=await this.currentUser.getIdToken(),n={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};this.tenantId!=null&&(n.tenantId=this.tenantId),await aw(this,n)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)===null||e===void 0?void 0:e.toJSON()}}async _setRedirectUser(e,t){const n=await this.getOrInitRedirectPersistenceManager(t);return e===null?n.removeCurrentUser():n.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&Lr(e)||this._popupRedirectResolver;Ve(t,this,"argument-error"),this.redirectPersistenceManager=await rn.create(this,[Lr(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,n;return this._isInitialized&&await this.queue(async()=>{}),((t=this._currentUser)===null||t===void 0?void 0:t._redirectEventId)===e?this._currentUser:((n=this.redirectUser)===null||n===void 0?void 0:n._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const n=(t=(e=this.currentUser)===null||e===void 0?void 0:e.uid)!==null&&t!==void 0?t:null;this.lastNotifiedUid!==n&&(this.lastNotifiedUid=n,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,n,a){if(this._deleted)return()=>{};const i=typeof t=="function"?t:t.next.bind(t);let o=!1;const c=this._isInitialized?Promise.resolve():this._initializationPromise;if(Ve(c,this,"internal-error"),c.then(()=>{o||i(this.currentUser)}),typeof t=="function"){const d=e.addObserver(t,n,a);return()=>{o=!0,d()}}else{const d=e.addObserver(t);return()=>{o=!0,d()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return Ve(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=vg(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);const n=await((e=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getHeartbeatsHeader());n&&(t["X-Firebase-Client"]=n);const a=await this._getAppCheckToken();return a&&(t["X-Firebase-AppCheck"]=a),t}async _getAppCheckToken(){var e;const t=await((e=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getToken());return t!=null&&t.error&&qv(`Error while retrieving App Check token: ${t.error}`),t==null?void 0:t.token}}function gc(r){return zt(r)}class ku{constructor(e){this.auth=e,this.observer=null,this.addObserver=Af(t=>this.observer=t)}get next(){return Ve(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let pc={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function mw(r){pc=r}function gw(r){return pc.loadJS(r)}function pw(){return pc.gapiScript}function fw(r){return`__${r}${Math.floor(Math.random()*1e6)}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xw(r,e){const t=Wi(r,"auth");if(t.isInitialized()){const a=t.getImmediate(),i=t.getOptions();if(xi(i,e??{}))return a;Hr(a,"already-initialized")}return t.initialize({options:e})}function yw(r,e){const t=(e==null?void 0:e.persistence)||[],n=(Array.isArray(t)?t:[t]).map(Lr);e!=null&&e.errorMap&&r._updateErrorMap(e.errorMap),r._initializeWithPersistence(n,e==null?void 0:e.popupRedirectResolver)}function bw(r,e,t){const n=gc(r);Ve(n._canInitEmulator,n,"emulator-config-failed"),Ve(/^https?:\/\//.test(e),n,"invalid-emulator-scheme");const a=!1,i=wg(e),{host:o,port:c}=vw(e),d=c===null?"":`:${c}`;n.config.emulator={url:`${i}//${o}${d}/`},n.settings.appVerificationDisabledForTesting=!0,n.emulatorConfig=Object.freeze({host:o,port:c,protocol:i.replace(":",""),options:Object.freeze({disableWarnings:a})}),ww()}function wg(r){const e=r.indexOf(":");return e<0?"":r.substr(0,e+1)}function vw(r){const e=wg(r),t=/(\/\/)?([^?#/]+)/.exec(r.substr(e.length));if(!t)return{host:"",port:null};const n=t[2].split("@").pop()||"",a=/^(\[[^\]]+\])(:|$)/.exec(n);if(a){const i=a[1];return{host:i,port:_u(n.substr(i.length+1))}}else{const[i,o]=n.split(":");return{host:i,port:_u(o)}}}function _u(r){if(!r)return null;const e=Number(r);return isNaN(e)?null:e}function ww(){function r(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",r):r())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kg{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return Or("not implemented")}_getIdTokenResponse(e){return Or("not implemented")}_linkToIdToken(e,t){return Or("not implemented")}_getReauthenticationResolver(e){return Or("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function sn(r,e){return Qv(r,"POST","/v1/accounts:signInWithIdp",uc(r,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kw="http://localhost";class Fs extends kg{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new Fs(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):Hr("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:n,signInMethod:a}=t,i=lc(t,["providerId","signInMethod"]);if(!n||!a)return null;const o=new Fs(n,a);return o.idToken=i.idToken||void 0,o.accessToken=i.accessToken||void 0,o.secret=i.secret,o.nonce=i.nonce,o.pendingToken=i.pendingToken||null,o}_getIdTokenResponse(e){const t=this.buildRequest();return sn(e,t)}_linkToIdToken(e,t){const n=this.buildRequest();return n.idToken=t,sn(e,n)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,sn(e,t)}buildRequest(){const e={requestUri:kw,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=va(t)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _g{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sa extends _g{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ns extends Sa{constructor(){super("facebook.com")}static credential(e){return Fs._fromParams({providerId:ns.PROVIDER_ID,signInMethod:ns.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return ns.credentialFromTaggedObject(e)}static credentialFromError(e){return ns.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return ns.credential(e.oauthAccessToken)}catch{return null}}}ns.FACEBOOK_SIGN_IN_METHOD="facebook.com";ns.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class as extends Sa{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return Fs._fromParams({providerId:as.PROVIDER_ID,signInMethod:as.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return as.credentialFromTaggedObject(e)}static credentialFromError(e){return as.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:n}=e;if(!t&&!n)return null;try{return as.credential(t,n)}catch{return null}}}as.GOOGLE_SIGN_IN_METHOD="google.com";as.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class is extends Sa{constructor(){super("github.com")}static credential(e){return Fs._fromParams({providerId:is.PROVIDER_ID,signInMethod:is.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return is.credentialFromTaggedObject(e)}static credentialFromError(e){return is.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return is.credential(e.oauthAccessToken)}catch{return null}}}is.GITHUB_SIGN_IN_METHOD="github.com";is.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class os extends Sa{constructor(){super("twitter.com")}static credential(e,t){return Fs._fromParams({providerId:os.PROVIDER_ID,signInMethod:os.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return os.credentialFromTaggedObject(e)}static credentialFromError(e){return os.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:n}=e;if(!t||!n)return null;try{return os.credential(t,n)}catch{return null}}}os.TWITTER_SIGN_IN_METHOD="twitter.com";os.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xn{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,n,a=!1){const i=await Vr._fromIdTokenResponse(e,n,a),o=Nu(n);return new xn({user:i,providerId:o,_tokenResponse:n,operationType:t})}static async _forOperation(e,t,n){await e._updateTokensIfNecessary(n,!0);const a=Nu(n);return new xn({user:e,providerId:a,_tokenResponse:n,operationType:t})}}function Nu(r){return r.providerId?r.providerId:"phoneNumber"in r?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Si extends Tr{constructor(e,t,n,a){var i;super(t.code,t.message),this.operationType=n,this.user=a,Object.setPrototypeOf(this,Si.prototype),this.customData={appName:e.name,tenantId:(i=e.tenantId)!==null&&i!==void 0?i:void 0,_serverResponse:t.customData._serverResponse,operationType:n}}static _fromErrorAndOperation(e,t,n,a){return new Si(e,t,n,a)}}function Ng(r,e,t,n){return(e==="reauthenticate"?t._getReauthenticationResolver(r):t._getIdTokenResponse(r)).catch(i=>{throw i.code==="auth/multi-factor-auth-required"?Si._fromErrorAndOperation(r,i,e,n):i})}async function _w(r,e,t=!1){const n=await ha(r,e._linkToIdToken(r.auth,await r.getIdToken()),t);return xn._forOperation(r,"link",n)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Nw(r,e,t=!1){const{auth:n}=r;if(ls(n.app))return Promise.reject(Cs(n));const a="reauthenticate";try{const i=await ha(r,Ng(n,a,e,r),t);Ve(i.idToken,n,"internal-error");const o=hc(i.idToken);Ve(o,n,"internal-error");const{sub:c}=o;return Ve(r.uid===c,n,"user-mismatch"),xn._forOperation(r,a,i)}catch(i){throw(i==null?void 0:i.code)==="auth/user-not-found"&&Hr(n,"user-mismatch"),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function jw(r,e,t=!1){if(ls(r.app))return Promise.reject(Cs(r));const n="signIn",a=await Ng(r,n,e),i=await xn._fromIdTokenResponse(r,n,a);return t||await r._updateCurrentUser(i.user),i}function Ew(r,e,t,n){return zt(r).onIdTokenChanged(e,t,n)}function Iw(r,e,t){return zt(r).beforeAuthStateChanged(e,t)}const Ai="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jg{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(Ai,"1"),this.storage.removeItem(Ai),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Tw=1e3,Sw=10;class Eg extends jg{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=bg(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const n=this.storage.getItem(t),a=this.localCache[t];n!==a&&e(t,a,n)}}onStorageEvent(e,t=!1){if(!e.key){this.forAllChangedKeys((o,c,d)=>{this.notifyListeners(o,d)});return}const n=e.key;t?this.detachListener():this.stopPolling();const a=()=>{const o=this.storage.getItem(n);!t&&this.localCache[n]===o||this.notifyListeners(n,o)},i=this.storage.getItem(n);ow()&&i!==e.newValue&&e.newValue!==e.oldValue?setTimeout(a,Sw):a()}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const a of Array.from(n))a(t&&JSON.parse(t))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,n)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:n}),!0)})},Tw)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}Eg.type="LOCAL";const Aw=Eg;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ig extends jg{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}Ig.type="SESSION";const Tg=Ig;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Cw(r){return Promise.all(r.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ao{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(a=>a.isListeningto(e));if(t)return t;const n=new ao(e);return this.receivers.push(n),n}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:n,eventType:a,data:i}=t.data,o=this.handlersMap[a];if(!(o!=null&&o.size))return;t.ports[0].postMessage({status:"ack",eventId:n,eventType:a});const c=Array.from(o).map(async h=>h(t.origin,i)),d=await Cw(c);t.ports[0].postMessage({status:"done",eventId:n,eventType:a,response:d})}_subscribe(e,t){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),(!t||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}ao.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fc(r="",e=10){let t="";for(let n=0;n<e;n++)t+=Math.floor(Math.random()*10);return r+t}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dw{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,n=50){const a=typeof MessageChannel<"u"?new MessageChannel:null;if(!a)throw new Error("connection_unavailable");let i,o;return new Promise((c,d)=>{const h=fc("",20);a.port1.start();const g=setTimeout(()=>{d(new Error("unsupported_event"))},n);o={messageChannel:a,onMessage(f){const p=f;if(p.data.eventId===h)switch(p.data.status){case"ack":clearTimeout(g),i=setTimeout(()=>{d(new Error("timeout"))},3e3);break;case"done":clearTimeout(i),c(p.data.response);break;default:clearTimeout(g),clearTimeout(i),d(new Error("invalid_response"));break}}},this.handlers.add(o),a.port1.addEventListener("message",o.onMessage),this.target.postMessage({eventType:e,eventId:h,data:t},[a.port2])}).finally(()=>{o&&this.removeMessageHandler(o)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Nr(){return window}function Rw(r){Nr().location.href=r}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Sg(){return typeof Nr().WorkerGlobalScope<"u"&&typeof Nr().importScripts=="function"}async function Pw(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function Mw(){var r;return((r=navigator==null?void 0:navigator.serviceWorker)===null||r===void 0?void 0:r.controller)||null}function $w(){return Sg()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ag="firebaseLocalStorageDb",Ow=1,Ci="firebaseLocalStorage",Cg="fbase_key";class Aa{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function io(r,e){return r.transaction([Ci],e?"readwrite":"readonly").objectStore(Ci)}function Vw(){const r=indexedDB.deleteDatabase(Ag);return new Aa(r).toPromise()}function xl(){const r=indexedDB.open(Ag,Ow);return new Promise((e,t)=>{r.addEventListener("error",()=>{t(r.error)}),r.addEventListener("upgradeneeded",()=>{const n=r.result;try{n.createObjectStore(Ci,{keyPath:Cg})}catch(a){t(a)}}),r.addEventListener("success",async()=>{const n=r.result;n.objectStoreNames.contains(Ci)?e(n):(n.close(),await Vw(),e(await xl()))})})}async function ju(r,e,t){const n=io(r,!0).put({[Cg]:e,value:t});return new Aa(n).toPromise()}async function Lw(r,e){const t=io(r,!1).get(e),n=await new Aa(t).toPromise();return n===void 0?null:n.value}function Eu(r,e){const t=io(r,!0).delete(e);return new Aa(t).toPromise()}const Fw=800,Uw=3;class Dg{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await xl(),this.db)}async _withRetries(e){let t=0;for(;;)try{const n=await this._openDb();return await e(n)}catch(n){if(t++>Uw)throw n;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return Sg()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=ao._getInstance($w()),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){var e,t;if(this.activeServiceWorker=await Pw(),!this.activeServiceWorker)return;this.sender=new Dw(this.activeServiceWorker);const n=await this.sender._send("ping",{},800);n&&!((e=n[0])===null||e===void 0)&&e.fulfilled&&!((t=n[0])===null||t===void 0)&&t.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||Mw()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await xl();return await ju(e,Ai,"1"),await Eu(e,Ai),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(n=>ju(n,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(n=>Lw(n,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>Eu(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(a=>{const i=io(a,!1).getAll();return new Aa(i).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const t=[],n=new Set;if(e.length!==0)for(const{fbase_key:a,value:i}of e)n.add(a),JSON.stringify(this.localCache[a])!==JSON.stringify(i)&&(this.notifyListeners(a,i),t.push(a));for(const a of Object.keys(this.localCache))this.localCache[a]&&!n.has(a)&&(this.notifyListeners(a,null),t.push(a));return t}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const a of Array.from(n))a(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),Fw)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}Dg.type="LOCAL";const Bw=Dg;new Ta(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ww(r,e){return e?Lr(e):(Ve(r._popupRedirectResolver,r,"argument-error"),r._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xc extends kg{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return sn(e,this._buildIdpRequest())}_linkToIdToken(e,t){return sn(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return sn(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function qw(r){return jw(r.auth,new xc(r),r.bypassAuthState)}function zw(r){const{auth:e,user:t}=r;return Ve(t,e,"internal-error"),Nw(t,new xc(r),r.bypassAuthState)}async function Hw(r){const{auth:e,user:t}=r;return Ve(t,e,"internal-error"),_w(t,new xc(r),r.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rg{constructor(e,t,n,a,i=!1){this.auth=e,this.resolver=n,this.user=a,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(n){this.reject(n)}})}async onAuthEvent(e){const{urlResponse:t,sessionId:n,postBody:a,tenantId:i,error:o,type:c}=e;if(o){this.reject(o);return}const d={auth:this.auth,requestUri:t,sessionId:n,tenantId:i||void 0,postBody:a||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(c)(d))}catch(h){this.reject(h)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return qw;case"linkViaPopup":case"linkViaRedirect":return Hw;case"reauthViaPopup":case"reauthViaRedirect":return zw;default:Hr(this.auth,"internal-error")}}resolve(e){Gr(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){Gr(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Gw=new Ta(2e3,1e4);class Zs extends Rg{constructor(e,t,n,a,i){super(e,t,a,i),this.provider=n,this.authWindow=null,this.pollId=null,Zs.currentPopupAction&&Zs.currentPopupAction.cancel(),Zs.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return Ve(e,this.auth,"internal-error"),e}async onExecution(){Gr(this.filter.length===1,"Popup operations only handle one event");const e=fc();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(t=>{this.reject(t)}),this.resolver._isIframeWebStorageSupported(this.auth,t=>{t||this.reject(_r(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)===null||e===void 0?void 0:e.associatedEvent)||null}cancel(){this.reject(_r(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Zs.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,n;if(!((n=(t=this.authWindow)===null||t===void 0?void 0:t.window)===null||n===void 0)&&n.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(_r(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,Gw.get())};e()}}Zs.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Kw="pendingRedirect",ui=new Map;class Yw extends Rg{constructor(e,t,n=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,n),this.eventId=null}async execute(){let e=ui.get(this.auth._key());if(!e){try{const n=await Qw(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(n)}catch(t){e=()=>Promise.reject(t)}ui.set(this.auth._key(),e)}return this.bypassAuthState||ui.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function Qw(r,e){const t=Zw(e),n=Jw(r);if(!await n._isAvailable())return!1;const a=await n._get(t)==="true";return await n._remove(t),a}function Xw(r,e){ui.set(r._key(),e)}function Jw(r){return Lr(r._redirectPersistence)}function Zw(r){return di(Kw,r.config.apiKey,r.name)}async function e1(r,e,t=!1){if(ls(r.app))return Promise.reject(Cs(r));const n=gc(r),a=Ww(n,e),o=await new Yw(n,a,t).execute();return o&&!t&&(delete o.user._redirectEventId,await n._persistUserIfCurrent(o.user),await n._setRedirectUser(null,e)),o}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const t1=10*60*1e3;class r1{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(n=>{this.isEventForConsumer(e,n)&&(t=!0,this.sendToConsumer(e,n),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!s1(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var n;if(e.error&&!Pg(e)){const a=((n=e.error.code)===null||n===void 0?void 0:n.split("auth/")[1])||"internal-error";t.onError(_r(this.auth,a))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const n=t.eventId===null||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&n}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=t1&&this.cachedEventUids.clear(),this.cachedEventUids.has(Iu(e))}saveEventToCache(e){this.cachedEventUids.add(Iu(e)),this.lastProcessedEventTime=Date.now()}}function Iu(r){return[r.type,r.eventId,r.sessionId,r.tenantId].filter(e=>e).join("-")}function Pg({type:r,error:e}){return r==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function s1(r){switch(r.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return Pg(r);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function n1(r,e={}){return jn(r,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const a1=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,i1=/^https?/;async function o1(r){if(r.config.emulator)return;const{authorizedDomains:e}=await n1(r);for(const t of e)try{if(l1(t))return}catch{}Hr(r,"unauthorized-domain")}function l1(r){const e=pl(),{protocol:t,hostname:n}=new URL(e);if(r.startsWith("chrome-extension://")){const o=new URL(r);return o.hostname===""&&n===""?t==="chrome-extension:"&&r.replace("chrome-extension://","")===e.replace("chrome-extension://",""):t==="chrome-extension:"&&o.hostname===n}if(!i1.test(t))return!1;if(a1.test(r))return n===r;const a=r.replace(/\./g,"\\.");return new RegExp("^(.+\\."+a+"|"+a+")$","i").test(n)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const c1=new Ta(3e4,6e4);function Tu(){const r=Nr().___jsl;if(r!=null&&r.H){for(const e of Object.keys(r.H))if(r.H[e].r=r.H[e].r||[],r.H[e].L=r.H[e].L||[],r.H[e].r=[...r.H[e].L],r.CP)for(let t=0;t<r.CP.length;t++)r.CP[t]=null}}function d1(r){return new Promise((e,t)=>{var n,a,i;function o(){Tu(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{Tu(),t(_r(r,"network-request-failed"))},timeout:c1.get()})}if(!((a=(n=Nr().gapi)===null||n===void 0?void 0:n.iframes)===null||a===void 0)&&a.Iframe)e(gapi.iframes.getContext());else if(!((i=Nr().gapi)===null||i===void 0)&&i.load)o();else{const c=fw("iframefcb");return Nr()[c]=()=>{gapi.load?o():t(_r(r,"network-request-failed"))},gw(`${pw()}?onload=${c}`).catch(d=>t(d))}}).catch(e=>{throw hi=null,e})}let hi=null;function u1(r){return hi=hi||d1(r),hi}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const h1=new Ta(5e3,15e3),m1="__/auth/iframe",g1="emulator/auth/iframe",p1={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},f1=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function x1(r){const e=r.config;Ve(e.authDomain,r,"auth-domain-config-required");const t=e.emulator?dc(e,g1):`https://${r.config.authDomain}/${m1}`,n={apiKey:e.apiKey,appName:r.name,v:Us},a=f1.get(r.config.apiHost);a&&(n.eid=a);const i=r._getFrameworks();return i.length&&(n.fw=i.join(",")),`${t}?${va(n).slice(1)}`}async function y1(r){const e=await u1(r),t=Nr().gapi;return Ve(t,r,"internal-error"),e.open({where:document.body,url:x1(r),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:p1,dontclear:!0},n=>new Promise(async(a,i)=>{await n.restyle({setHideOnLeave:!1});const o=_r(r,"network-request-failed"),c=Nr().setTimeout(()=>{i(o)},h1.get());function d(){Nr().clearTimeout(c),a(n)}n.ping(d).then(d,()=>{i(o)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const b1={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},v1=500,w1=600,k1="_blank",_1="http://localhost";class Su{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function N1(r,e,t,n=v1,a=w1){const i=Math.max((window.screen.availHeight-a)/2,0).toString(),o=Math.max((window.screen.availWidth-n)/2,0).toString();let c="";const d=Object.assign(Object.assign({},b1),{width:n.toString(),height:a.toString(),top:i,left:o}),h=qt().toLowerCase();t&&(c=gg(h)?k1:t),hg(h)&&(e=e||_1,d.scrollbars="yes");const g=Object.entries(d).reduce((p,[v,A])=>`${p}${v}=${A},`,"");if(iw(h)&&c!=="_self")return j1(e||"",c),new Su(null);const f=window.open(e||"",c,g);Ve(f,r,"popup-blocked");try{f.focus()}catch{}return new Su(f)}function j1(r,e){const t=document.createElement("a");t.href=r,t.target=e;const n=document.createEvent("MouseEvent");n.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),t.dispatchEvent(n)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const E1="__/auth/handler",I1="emulator/auth/handler",T1=encodeURIComponent("fac");async function Au(r,e,t,n,a,i){Ve(r.config.authDomain,r,"auth-domain-config-required"),Ve(r.config.apiKey,r,"invalid-api-key");const o={apiKey:r.config.apiKey,appName:r.name,authType:t,redirectUrl:n,v:Us,eventId:a};if(e instanceof _g){e.setDefaultLanguage(r.languageCode),o.providerId=e.providerId||"",Sf(e.getCustomParameters())||(o.customParameters=JSON.stringify(e.getCustomParameters()));for(const[g,f]of Object.entries({}))o[g]=f}if(e instanceof Sa){const g=e.getScopes().filter(f=>f!=="");g.length>0&&(o.scopes=g.join(","))}r.tenantId&&(o.tid=r.tenantId);const c=o;for(const g of Object.keys(c))c[g]===void 0&&delete c[g];const d=await r._getAppCheckToken(),h=d?`#${T1}=${encodeURIComponent(d)}`:"";return`${S1(r)}?${va(c).slice(1)}${h}`}function S1({config:r}){return r.emulator?dc(r,I1):`https://${r.authDomain}/${E1}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Uo="webStorageSupport";class A1{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=Tg,this._completeRedirectFn=e1,this._overrideRedirectResult=Xw}async _openPopup(e,t,n,a){var i;Gr((i=this.eventManagers[e._key()])===null||i===void 0?void 0:i.manager,"_initialize() not called before _openPopup()");const o=await Au(e,t,n,pl(),a);return N1(e,o,fc())}async _openRedirect(e,t,n,a){await this._originValidation(e);const i=await Au(e,t,n,pl(),a);return Rw(i),new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:a,promise:i}=this.eventManagers[t];return a?Promise.resolve(a):(Gr(i,"If manager is not set, promise should be"),i)}const n=this.initAndGetManager(e);return this.eventManagers[t]={promise:n},n.catch(()=>{delete this.eventManagers[t]}),n}async initAndGetManager(e){const t=await y1(e),n=new r1(e);return t.register("authEvent",a=>(Ve(a==null?void 0:a.authEvent,e,"invalid-auth-event"),{status:n.onEvent(a.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:n},this.iframes[e._key()]=t,n}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(Uo,{type:Uo},a=>{var i;const o=(i=a==null?void 0:a[0])===null||i===void 0?void 0:i[Uo];o!==void 0&&t(!!o),Hr(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=o1(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return bg()||mg()||mc()}}const C1=A1;var Cu="@firebase/auth",Du="1.7.9";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class D1{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)===null||e===void 0?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(n=>{e((n==null?void 0:n.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){Ve(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function R1(r){switch(r){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function P1(r){$s(new ps("auth",(e,{options:t})=>{const n=e.getProvider("app").getImmediate(),a=e.getProvider("heartbeat"),i=e.getProvider("app-check-internal"),{apiKey:o,authDomain:c}=n.options;Ve(o&&!o.includes(":"),"invalid-api-key",{appName:n.name});const d={apiKey:o,authDomain:c,clientPlatform:r,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:vg(r)},h=new hw(n,a,i,d);return yw(h,t),h},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,n)=>{e.getProvider("auth-internal").initialize()})),$s(new ps("auth-internal",e=>{const t=gc(e.getProvider("auth").getImmediate());return(n=>new D1(n))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),vr(Cu,Du,R1(r)),vr(Cu,Du,"esm2017")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const M1=5*60,$1=Ih("authIdTokenMaxAge")||M1;let Ru=null;const O1=r=>async e=>{const t=e&&await e.getIdTokenResult(),n=t&&(new Date().getTime()-Date.parse(t.issuedAtTime))/1e3;if(n&&n>$1)return;const a=t==null?void 0:t.token;Ru!==a&&(Ru=a,await fetch(r,{method:a?"POST":"DELETE",headers:a?{Authorization:`Bearer ${a}`}:{}}))};function V1(r=jl()){const e=Wi(r,"auth");if(e.isInitialized())return e.getImmediate();const t=xw(r,{popupRedirectResolver:C1,persistence:[Bw,Aw,Tg]}),n=Ih("authTokenSyncURL");if(n&&typeof isSecureContext=="boolean"&&isSecureContext){const i=new URL(n,location.origin);if(location.origin===i.origin){const o=O1(i.toString());Iw(t,o,()=>o(t.currentUser)),Ew(t,c=>o(c))}}const a=Nh("auth");return a&&bw(t,`http://${a}`),t}function L1(){var r,e;return(e=(r=document.getElementsByTagName("head"))===null||r===void 0?void 0:r[0])!==null&&e!==void 0?e:document}mw({loadJS(r){return new Promise((e,t)=>{const n=document.createElement("script");n.setAttribute("src",r),n.onload=e,n.onerror=a=>{const i=_r("internal-error");i.customData=a,t(i)},n.type="text/javascript",n.charset="UTF-8",L1().appendChild(n)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});P1("Browser");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Mg="firebasestorage.googleapis.com",F1="storageBucket",U1=2*60*1e3,B1=10*60*1e3;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sr extends Tr{constructor(e,t,n=0){super(Bo(e),`Firebase Storage: ${t} (${Bo(e)})`),this.status_=n,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,Sr.prototype)}get status(){return this.status_}set status(e){this.status_=e}_codeEquals(e){return Bo(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message=`${this._baseMessage}
${this.customData.serverResponse}`:this.message=this._baseMessage}}var Er;(function(r){r.UNKNOWN="unknown",r.OBJECT_NOT_FOUND="object-not-found",r.BUCKET_NOT_FOUND="bucket-not-found",r.PROJECT_NOT_FOUND="project-not-found",r.QUOTA_EXCEEDED="quota-exceeded",r.UNAUTHENTICATED="unauthenticated",r.UNAUTHORIZED="unauthorized",r.UNAUTHORIZED_APP="unauthorized-app",r.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",r.INVALID_CHECKSUM="invalid-checksum",r.CANCELED="canceled",r.INVALID_EVENT_NAME="invalid-event-name",r.INVALID_URL="invalid-url",r.INVALID_DEFAULT_BUCKET="invalid-default-bucket",r.NO_DEFAULT_BUCKET="no-default-bucket",r.CANNOT_SLICE_BLOB="cannot-slice-blob",r.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",r.NO_DOWNLOAD_URL="no-download-url",r.INVALID_ARGUMENT="invalid-argument",r.INVALID_ARGUMENT_COUNT="invalid-argument-count",r.APP_DELETED="app-deleted",r.INVALID_ROOT_OPERATION="invalid-root-operation",r.INVALID_FORMAT="invalid-format",r.INTERNAL_ERROR="internal-error",r.UNSUPPORTED_ENVIRONMENT="unsupported-environment"})(Er||(Er={}));function Bo(r){return"storage/"+r}function W1(){const r="An unknown error occurred, please check the error payload for server response.";return new Sr(Er.UNKNOWN,r)}function q1(){return new Sr(Er.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function z1(){return new Sr(Er.CANCELED,"User canceled the upload/download.")}function H1(r){return new Sr(Er.INVALID_URL,"Invalid URL '"+r+"'.")}function G1(r){return new Sr(Er.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+r+"'.")}function Pu(r){return new Sr(Er.INVALID_ARGUMENT,r)}function $g(){return new Sr(Er.APP_DELETED,"The Firebase app was deleted.")}function K1(r){return new Sr(Er.INVALID_ROOT_OPERATION,"The operation '"+r+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mr{constructor(e,t){this.bucket=e,this.path_=t}get path(){return this.path_}get isRoot(){return this.path.length===0}fullServerUrl(){const e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(e,t){let n;try{n=mr.makeFromUrl(e,t)}catch{return new mr(e,"")}if(n.path==="")return n;throw G1(e)}static makeFromUrl(e,t){let n=null;const a="([A-Za-z0-9.\\-_]+)";function i(j){j.path.charAt(j.path.length-1)==="/"&&(j.path_=j.path_.slice(0,-1))}const o="(/(.*))?$",c=new RegExp("^gs://"+a+o,"i"),d={bucket:1,path:3};function h(j){j.path_=decodeURIComponent(j.path)}const g="v[A-Za-z0-9_]+",f=t.replace(/[.]/g,"\\."),p="(/([^?#]*).*)?$",v=new RegExp(`^https?://${f}/${g}/b/${a}/o${p}`,"i"),A={bucket:1,path:3},T=t===Mg?"(?:storage.googleapis.com|storage.cloud.google.com)":t,S="([^?#]*)",z=new RegExp(`^https?://${T}/${a}/${S}`,"i"),C=[{regex:c,indices:d,postModify:i},{regex:v,indices:A,postModify:h},{regex:z,indices:{bucket:1,path:2},postModify:h}];for(let j=0;j<C.length;j++){const H=C[j],Y=H.regex.exec(e);if(Y){const I=Y[H.indices.bucket];let y=Y[H.indices.path];y||(y=""),n=new mr(I,y),H.postModify(n);break}}if(n==null)throw H1(e);return n}}class Y1{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(e=!1){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Q1(r,e,t){let n=1,a=null,i=null,o=!1,c=0;function d(){return c===2}let h=!1;function g(...S){h||(h=!0,e.apply(null,S))}function f(S){a=setTimeout(()=>{a=null,r(v,d())},S)}function p(){i&&clearTimeout(i)}function v(S,...z){if(h){p();return}if(S){p(),g.call(null,S,...z);return}if(d()||o){p(),g.call(null,S,...z);return}n<64&&(n*=2);let C;c===1?(c=2,C=0):C=(n+Math.random())*1e3,f(C)}let A=!1;function T(S){A||(A=!0,p(),!h&&(a!==null?(S||(c=2),clearTimeout(a),f(0)):S||(c=1)))}return f(0),i=setTimeout(()=>{o=!0,T(!0)},t),T}function X1(r){r(!1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function J1(r){return r!==void 0}function Mu(r,e,t,n){if(n<e)throw Pu(`Invalid value for '${r}'. Expected ${e} or greater.`);if(n>t)throw Pu(`Invalid value for '${r}'. Expected ${t} or less.`)}function Z1(r){const e=encodeURIComponent;let t="?";for(const n in r)if(r.hasOwnProperty(n)){const a=e(n)+"="+e(r[n]);t=t+a+"&"}return t=t.slice(0,-1),t}var Di;(function(r){r[r.NO_ERROR=0]="NO_ERROR",r[r.NETWORK_ERROR=1]="NETWORK_ERROR",r[r.ABORT=2]="ABORT"})(Di||(Di={}));/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function e2(r,e){const t=r>=500&&r<600,a=[408,429].indexOf(r)!==-1,i=e.indexOf(r)!==-1;return t||a||i}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class t2{constructor(e,t,n,a,i,o,c,d,h,g,f,p=!0){this.url_=e,this.method_=t,this.headers_=n,this.body_=a,this.successCodes_=i,this.additionalRetryCodes_=o,this.callback_=c,this.errorCallback_=d,this.timeout_=h,this.progressCallback_=g,this.connectionFactory_=f,this.retry=p,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((v,A)=>{this.resolve_=v,this.reject_=A,this.start_()})}start_(){const e=(n,a)=>{if(a){n(!1,new Ja(!1,null,!0));return}const i=this.connectionFactory_();this.pendingConnection_=i;const o=c=>{const d=c.loaded,h=c.lengthComputable?c.total:-1;this.progressCallback_!==null&&this.progressCallback_(d,h)};this.progressCallback_!==null&&i.addUploadProgressListener(o),i.send(this.url_,this.method_,this.body_,this.headers_).then(()=>{this.progressCallback_!==null&&i.removeUploadProgressListener(o),this.pendingConnection_=null;const c=i.getErrorCode()===Di.NO_ERROR,d=i.getStatus();if(!c||e2(d,this.additionalRetryCodes_)&&this.retry){const g=i.getErrorCode()===Di.ABORT;n(!1,new Ja(!1,null,g));return}const h=this.successCodes_.indexOf(d)!==-1;n(!0,new Ja(h,i))})},t=(n,a)=>{const i=this.resolve_,o=this.reject_,c=a.connection;if(a.wasSuccessCode)try{const d=this.callback_(c,c.getResponse());J1(d)?i(d):i()}catch(d){o(d)}else if(c!==null){const d=W1();d.serverResponse=c.getErrorText(),this.errorCallback_?o(this.errorCallback_(c,d)):o(d)}else if(a.canceled){const d=this.appDelete_?$g():z1();o(d)}else{const d=q1();o(d)}};this.canceled_?t(!1,new Ja(!1,null,!0)):this.backoffId_=Q1(e,t,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,this.backoffId_!==null&&X1(this.backoffId_),this.pendingConnection_!==null&&this.pendingConnection_.abort()}}class Ja{constructor(e,t,n){this.wasSuccessCode=e,this.connection=t,this.canceled=!!n}}function r2(r,e){e!==null&&e.length>0&&(r.Authorization="Firebase "+e)}function s2(r,e){r["X-Firebase-Storage-Version"]="webjs/"+(e??"AppManager")}function n2(r,e){e&&(r["X-Firebase-GMPID"]=e)}function a2(r,e){e!==null&&(r["X-Firebase-AppCheck"]=e)}function i2(r,e,t,n,a,i,o=!0){const c=Z1(r.urlParams),d=r.url+c,h=Object.assign({},r.headers);return n2(h,e),r2(h,t),s2(h,i),a2(h,n),new t2(d,r.method,h,r.body,r.successCodes,r.additionalRetryCodes,r.handler,r.errorHandler,r.timeout,r.progressCallback,a,o)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function o2(r){if(r.length===0)return null;const e=r.lastIndexOf("/");return e===-1?"":r.slice(0,e)}function l2(r){const e=r.lastIndexOf("/",r.length-2);return e===-1?r:r.slice(e+1)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ri{constructor(e,t){this._service=e,t instanceof mr?this._location=t:this._location=mr.makeFromUrl(t,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,t){return new Ri(e,t)}get root(){const e=new mr(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return l2(this._location.path)}get storage(){return this._service}get parent(){const e=o2(this._location.path);if(e===null)return null;const t=new mr(this._location.bucket,e);return new Ri(this._service,t)}_throwIfRoot(e){if(this._location.path==="")throw K1(e)}}function $u(r,e){const t=e==null?void 0:e[F1];return t==null?null:mr.makeFromBucketSpec(t,r)}function c2(r,e,t,n={}){r.host=`${e}:${t}`,r._protocol="http";const{mockUserToken:a}=n;a&&(r._overrideAuthToken=typeof a=="string"?a:Th(a,r.app.options.projectId))}class d2{constructor(e,t,n,a,i){this.app=e,this._authProvider=t,this._appCheckProvider=n,this._url=a,this._firebaseVersion=i,this._bucket=null,this._host=Mg,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=U1,this._maxUploadRetryTime=B1,this._requests=new Set,a!=null?this._bucket=mr.makeFromBucketSpec(a,this._host):this._bucket=$u(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,this._url!=null?this._bucket=mr.makeFromBucketSpec(this._url,e):this._bucket=$u(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){Mu("time",0,Number.POSITIVE_INFINITY,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){Mu("time",0,Number.POSITIVE_INFINITY,e),this._maxOperationRetryTime=e}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const e=this._authProvider.getImmediate({optional:!0});if(e){const t=await e.getToken();if(t!==null)return t.accessToken}return null}async _getAppCheckToken(){const e=this._appCheckProvider.getImmediate({optional:!0});return e?(await e.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(e=>e.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new Ri(this,e)}_makeRequest(e,t,n,a,i=!0){if(this._deleted)return new Y1($g());{const o=i2(e,this._appId,n,a,t,this._firebaseVersion,i);return this._requests.add(o),o.getPromise().then(()=>this._requests.delete(o),()=>this._requests.delete(o)),o}}async makeRequestWithTokens(e,t){const[n,a]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,t,n,a).getPromise()}}const Ou="@firebase/storage",Vu="0.13.2";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Og="storage";function u2(r=jl(),e){r=zt(r);const n=Wi(r,Og).getImmediate({identifier:e}),a=jh("storage");return a&&h2(n,...a),n}function h2(r,e,t,n={}){c2(r,e,t,n)}function m2(r,{instanceIdentifier:e}){const t=r.getProvider("app").getImmediate(),n=r.getProvider("auth-internal"),a=r.getProvider("app-check-internal");return new d2(t,n,a,e,Us)}function g2(){$s(new ps(Og,m2,"PUBLIC").setMultipleInstances(!0)),vr(Ou,Vu,""),vr(Ou,Vu,"esm2017")}g2();const Mr={apiKey:"your-api-key",authDomain:"your-auth-domain",projectId:"your-project-id",storageBucket:"your-storage-bucket",messagingSenderId:"your-messaging-sender-id",appId:"your-app-id"};console.log("Firebase config check:",{hasApiKey:!!Mr.apiKey&&Mr.apiKey!=="your-api-key",authDomain:Mr.authDomain,projectId:Mr.projectId,hasStorageBucket:!!Mr.storageBucket&&Mr.storageBucket!=="your-storage-bucket",hasAppId:!!Mr.appId&&Mr.appId!=="your-app-id"});console.log("Raw env values:",{VITE_FIREBASE_API_KEY:void 0,VITE_FIREBASE_AUTH_DOMAIN:void 0,VITE_FIREBASE_PROJECT_ID:void 0,VITE_FIREBASE_STORAGE_BUCKET:void 0});const yc=Ch(Mr);V1(yc);const qe=Nv(yc);u2(yc);console.log("Firestore db initialized:",!!qe);const p2=30,Lu=r=>r.toString().padStart(2,"0"),f2=()=>{const r=new Date;return r.setDate(r.getDate()-p2),{dateOnly:`${r.getFullYear()}-${Lu(r.getMonth()+1)}-${Lu(r.getDate())}`,iso:r.toISOString()}},Za=async(r,e,t)=>{const n=Nt(qe,r),a=yt(n,Jt(e,"<",t)),i=await cr(a);await Promise.all(i.docs.map(o=>vs(Ct(qe,r,o.id))))},x2=async()=>{try{const{dateOnly:r,iso:e}=f2();await Promise.all([Za("workSlots","date",r),Za("dayStatuses","date",r),Za("earnings","date",r),Za("referrals","createdAt",e)])}catch(r){console.error("Failed to cleanup old data",r)}},Kr=async(r,e)=>{const t=Nt(qe,"workSlots");let n;r&&e||r?n=yt(t,Jt("userId","==",r)):e?n=yt(t,Jt("date","==",e)):n=yt(t);let i=(await cr(n)).docs.map(o=>{const c=o.data(),d=((c==null?void 0:c.slots)||[]).map(h=>h.break&&!h.breaks?{...h,breaks:[h.break],break:void 0}:h);return{id:o.id,userId:(c==null?void 0:c.userId)||"",date:(c==null?void 0:c.date)||"",slots:d,participants:(c==null?void 0:c.participants)||[],...(c==null?void 0:c.comment)&&{comment:c.comment}}});return r&&e&&(i=i.filter(o=>o.date===e)),i.sort((o,c)=>o.date.localeCompare(c.date)),i},Vg=async r=>{try{console.log("addWorkSlot: Starting, db initialized:",!!qe);const e=Nt(qe,"workSlots");console.log("addWorkSlot: Collection reference created");const t=Object.fromEntries(Object.entries(r).filter(([a,i])=>i!==void 0));console.log("addWorkSlot: Clean slot prepared:",t),console.log("addWorkSlot: Calling addDoc...");const n=await ws(e,t);return console.log("addWorkSlot: Work slot added successfully:",n.id),n}catch(e){throw console.error("addWorkSlot: Error caught:",e),console.error("addWorkSlot: Error code:",e==null?void 0:e.code),console.error("addWorkSlot: Error message:",e==null?void 0:e.message),console.error("addWorkSlot: Full error:",JSON.stringify(e,null,2)),e}},Lg=async(r,e)=>{const t=Ct(qe,"workSlots",r),n=Object.fromEntries(Object.entries(e).filter(([a,i])=>i!==void 0));await Yr(t,n)},oo=async r=>{const e=Ct(qe,"workSlots",r);await vs(e)},br=async(r,e)=>{const t=Nt(qe,"dayStatuses");let n;r?n=yt(t,Jt("userId","==",r)):n=yt(t);let i=(await cr(n)).docs.map(o=>{const c=o.data();return{id:o.id,userId:(c==null?void 0:c.userId)||"",date:(c==null?void 0:c.date)||"",type:(c==null?void 0:c.type)||"dayoff",...(c==null?void 0:c.comment)&&{comment:c.comment},...(c==null?void 0:c.endDate)&&{endDate:c.endDate}}});return i.sort((o,c)=>o.date.localeCompare(c.date)),i},lo=async r=>{try{const e=Nt(qe,"dayStatuses"),t=Object.fromEntries(Object.entries(r).filter(([a,i])=>i!==void 0));console.log("Adding day status:",t);const n=await ws(e,t);return console.log("Day status added successfully:",n.id),n}catch(e){throw console.error("Error in addDayStatus:",e),e}},ms=async(r,e)=>{const t=Ct(qe,"dayStatuses",r),n=Object.fromEntries(Object.entries(e).filter(([a,i])=>i!==void 0));await Yr(t,n)},co=async r=>{const e=Ct(qe,"dayStatuses",r);await vs(e)},uo="approvalRequests",bc=r=>{const e=r.data(),t=new Date().toISOString();return{id:r.id,entity:(e==null?void 0:e.entity)||"slot",action:(e==null?void 0:e.action)||"create",status:(e==null?void 0:e.status)||"pending",authorId:(e==null?void 0:e.authorId)||"",targetUserId:(e==null?void 0:e.targetUserId)||"",before:(e==null?void 0:e.before)??null,after:(e==null?void 0:e.after)??null,comment:e==null?void 0:e.comment,adminComment:e==null?void 0:e.adminComment,reviewedBy:e==null?void 0:e.reviewedBy,createdAt:(e==null?void 0:e.createdAt)||t,updatedAt:(e==null?void 0:e.updatedAt)||(e==null?void 0:e.createdAt)||t}},y2=async r=>{const e=r.before,t=r.after;switch(r.action){case"create":{if(!t)throw new Error("No slot payload for creation");const{id:n,...a}=t;await Vg(a);return}case"update":{const n=(t==null?void 0:t.id)||(e==null?void 0:e.id);if(!n||!t)throw new Error("No slot payload for update");const{id:a,...i}=t;await Lg(n,i);return}case"delete":{if(!(e!=null&&e.id))throw new Error("No slot id for delete");await oo(e.id);return}default:return}},b2=async r=>{const e=r.before,t=r.after;switch(r.action){case"create":{if(!t)throw new Error("No status payload for creation");const{id:n,...a}=t;await lo(a);return}case"update":{const n=(t==null?void 0:t.id)||(e==null?void 0:e.id);if(!n||!t)throw new Error("No status payload for update");const{id:a,...i}=t;await ms(n,i);return}case"delete":{if(!(e!=null&&e.id))throw new Error("No status id for delete");await co(e.id);return}default:return}},v2=async r=>{const e=r.before,t=r.after;switch(r.action){case"create":{if(!t)throw new Error("No earning payload for creation");const{id:n,...a}=t;await Fg(a);return}case"update":{const n=(t==null?void 0:t.id)||(e==null?void 0:e.id);if(!n||!t)throw new Error("No earning payload for update");const{id:a,...i}=t;await Ug(n,i);return}case"delete":{if(!(e!=null&&e.id))throw new Error("No earning id for delete");await Bg(e.id);return}default:return}},w2=async r=>{const e=r.before,t=r.after;switch(r.action){case"create":{if(!t)throw new Error("No referral payload for creation");const{id:n,...a}=t;await zg(a);return}case"update":{const n=(t==null?void 0:t.id)||(e==null?void 0:e.id);if(!n||!t)throw new Error("No referral payload for update");const{id:a,...i}=t;await Gg(n,i);return}case"delete":{if(!(e!=null&&e.id))throw new Error("No referral id for delete");await wc(e.id);return}default:return}},kt=async r=>{const e=Nt(qe,uo),t=new Date().toISOString(),n={...r,status:"pending",createdAt:t,updatedAt:t},a=Object.fromEntries(Object.entries(n).filter(([,o])=>o!==void 0));return await ws(e,a)},vc=async(r,e,t)=>{const n=Nt(qe,uo);let a;a=yt(n);let o=(await cr(a)).docs.map(bc);return o.sort((c,d)=>d.createdAt.localeCompare(c.createdAt)),o},Fu=async(r,e,t)=>{const n=Ct(qe,uo,r),a=await tg(n);if(!a.exists())return;const i=bc(a);if(i.status!=="pending")return;i.entity==="slot"?await y2(i):i.entity==="status"?await b2(i):i.entity==="earning"?await v2(i):i.entity==="referral"&&await w2(i);const o={status:"approved",reviewedBy:e,updatedAt:new Date().toISOString()},c=i.adminComment;c!==void 0&&(o.adminComment=c),await Yr(n,o)},k2=async(r,e,t)=>{const n=Ct(qe,uo,r),a=await tg(n);!a.exists()||bc(a).status!=="pending"||await Yr(n,{status:"rejected",adminComment:t,reviewedBy:e,updatedAt:new Date().toISOString()})},ma=async(r,e,t)=>{const n=Nt(qe,"earnings");let a;r?a=yt(n):e&&t?a=yt(n,Jt("date",">=",e),Jt("date","<=",t)):a=yt(n);let o=(await cr(a)).docs.map(c=>{const d=c.data();return{id:c.id,userId:(d==null?void 0:d.userId)||"",date:(d==null?void 0:d.date)||"",amount:(d==null?void 0:d.amount)||0,poolAmount:(d==null?void 0:d.poolAmount)||0,slotId:(d==null?void 0:d.slotId)||"",extraWalletsCount:(d==null?void 0:d.extraWalletsCount)||0,extraWalletsAmount:(d==null?void 0:d.extraWalletsAmount)||0,category:(d==null?void 0:d.category)||"other",participants:(d==null?void 0:d.participants)||[]}});return r&&(o=o.filter(c=>(c.participants&&c.participants.length>0?[...c.participants,c.userId]:[c.userId]).includes(r))),r&&e&&t?o=o.filter(c=>c.date>=e&&c.date<=t):!r&&e&&t&&(o=o.filter(c=>c.date>=e&&c.date<=t)),o.sort((c,d)=>d.date.localeCompare(c.date)),o},Fg=async r=>{try{const e=Nt(qe,"earnings"),t=Object.fromEntries(Object.entries(r).filter(([a,i])=>i!==void 0));console.log("Adding earnings:",t);const n=await ws(e,t);return console.log("Earnings added successfully:",n.id),n}catch(e){throw console.error("Error in addEarnings:",e),e}},Ug=async(r,e)=>{const t=Ct(qe,"earnings",r),n=Object.fromEntries(Object.entries(e).filter(([a,i])=>i!==void 0));await Yr(t,n)},Bg=async r=>{const e=Ct(qe,"earnings",r);await vs(e)},Wg=async r=>{const e=Nt(qe,"ratings");let t=yt(e);return r&&(t=yt(t,Jt("userId","==",r))),(await cr(t)).docs.map(a=>{const i=a.data();return{id:a.id,userId:i.userId||"",earnings:i.earnings||0,messages:i.messages||0,initiatives:i.initiatives||0,signals:i.signals||0,profitableSignals:i.profitableSignals||0,referrals:i.referrals||0,daysOff:i.daysOff||0,sickDays:i.sickDays||0,vacationDays:i.vacationDays||0,poolAmount:i.poolAmount||0,rating:i.rating||0,lastUpdated:i.lastUpdated||new Date().toISOString()}})},qg=async(r,e,t)=>{try{const n=Nt(qe,"messages"),a=yt(n,Jt("userId","==",r));return(await cr(a)).docs.filter(c=>{const h=c.data().date||"";return h>=e&&h<=t}).length}catch(n){console.error("Error getting weekly messages:",n);const a=Nt(qe,"ratings"),i=yt(a,Jt("userId","==",r)),o=await cr(i);return o.empty?0:o.docs[0].data().messages||0}},zg=async r=>{try{const e=Nt(qe,"referrals"),t=Object.fromEntries(Object.entries(r).filter(([a,i])=>i!==void 0));console.log("Adding referral:",t);const n=await ws(e,t);return console.log("Referral added successfully:",n.id),n}catch(e){throw console.error("Error in addReferral:",e),e}},Hg=async(r,e,t)=>{const n=Nt(qe,"referrals");let a;a=yt(n,ua("createdAt","desc"));let o=(await cr(a)).docs.map(c=>{const d=c.data();return{id:c.id,referralId:d.referralId,ownerId:d.ownerId,name:d.name,age:d.age,createdAt:d.createdAt,comment:d.comment}});return e&&t&&(o=o.filter(c=>c.createdAt>=e&&c.createdAt<=t)),o.sort((c,d)=>c.createdAt<d.createdAt?1:-1)},Gg=async(r,e)=>{const t=Ct(qe,"referrals",r),n=Object.fromEntries(Object.entries(e).filter(([a,i])=>i!==void 0));await Yr(t,n)},wc=async r=>{const e=Ct(qe,"referrals",r);await vs(e)},_2=async r=>{if(console.log("📝 Service site: Creating call:",{category:r.category,userId:r.userId,status:r.status,createdAt:r.createdAt}),!qe)throw console.error("❌ Service site: Firestore db is not initialized"),new Error("Firestore database is not initialized");const e=Nt(qe,"calls"),t=await ws(e,r);return console.log("✅ Service site: Call created successfully with ID:",t.id),console.log("📊 Service site: Call data saved to Firestore:",r),t.id},N2=async r=>{const e=Nt(qe,"calls"),t=[];t.push(ua("createdAt","desc"));let n;return t.length>0?n=yt(e,...t):n=yt(e,ua("createdAt","desc")),(await cr(n)).docs.map(o=>{var v,A,T,S,z,L,C,j;const c=o.data(),d=c.category||"memecoins",h=!c.details&&c.ticker?{memecoins:{coinName:c.pair||c.ticker,ticker:c.ticker||"",network:c.network||"solana",contract:c.contract,signalType:c.sentiment||"buy",reason:c.comment||c.risks||"",entryCap:c.entryPoint||"",targets:c.target||"",stopLoss:c.cancelConditions,riskLevel:c.riskLevel||"medium",risks:c.risks||"",holdPlan:"short",liquidityLocked:!1,traderComment:c.comment}}:{},g=c.details||h||{},f=c.riskLevel||((v=g.memecoins)==null?void 0:v.riskLevel)||((A=g.polymarket)==null?void 0:A.riskLevel)||((T=g.staking)==null?void 0:T.protocolRisk)||((S=g.spot)==null?void 0:S.riskLevel)||((z=g.futures)==null?void 0:z.riskLevel),p=c.sentiment||((L=g.memecoins)==null?void 0:L.signalType)||(((C=g.futures)==null?void 0:C.direction)==="long"?"buy":((j=g.futures)==null?void 0:j.direction)==="short"?"sell":void 0);return{id:o.id,userId:c.userId||"",category:d,details:g,sentiment:p,riskLevel:f,comment:c.comment,createdAt:c.createdAt||new Date().toISOString(),status:c.status||"active",maxProfit:c.maxProfit,currentPnL:c.currentPnL,currentMarketCap:c.currentMarketCap,signalMarketCap:c.signalMarketCap,currentPrice:c.currentPrice,entryPrice:c.entryPrice,tags:c.tags||[]}})},Kg=async(r,e)=>{const t=Ct(qe,"calls",r);await Yr(t,e)},j2=async r=>{const e=Ct(qe,"calls",r);await vs(e)},E2=async r=>{const e=Nt(qe,"tasks");return(await ws(e,r)).id},Yg=async r=>{const e=Nt(qe,"tasks"),t=[];r!=null&&r.status&&t.push(Jt("status","==",r.status)),r!=null&&r.category&&t.push(Jt("category","==",r.category)),r!=null&&r.createdBy&&t.push(Jt("createdBy","==",r.createdBy)),t.push(ua("createdAt","desc"));let n;t.length>0?n=yt(e,...t):n=yt(e,ua("createdAt","desc"));const a=await cr(n),i=p=>p==="high"||p==="low"||p==="urgent"?p:"medium",o=p=>p==="completed"||p==="closed"?p:"in_progress",c=(p=[])=>p.filter(v=>v==null?void 0:v.userId).slice(0,10).map(v=>({userId:v.userId,priority:i(v.priority),comment:v.comment,instruction:v.instruction}));let d=a.docs.map(p=>{const v=p.data(),T=((Array.isArray(v.assignees)?v.assignees:(v.assignedTo||[]).map(C=>({userId:C,priority:"medium"})))||[]).map(C=>({userId:C.userId||"",priority:i(C.priority),comment:C.comment})).filter(C=>!!C.userId),S=T.map(C=>C.userId),z=Array.isArray(v.coExecutors)?v.coExecutors:Array.isArray(v.executors)?v.executors:[],L=(v.stages||[]).map(C=>({id:C.id||`stage-${Date.now()}`,name:C.name||"Этап",description:C.description,responsible:C.responsible==="all"?"all":Array.isArray(C.responsible)?C.responsible:(C.assignees||[]).map(j=>j.userId),assignees:c(C.assignees),stagePriority:i(C.stagePriority),requiresApproval:C.requiresApproval??!0,approvals:C.approvals||[],comments:C.comments||[],status:C.status||"pending"}));return{id:p.id,title:v.title||"",description:v.description,category:v.category||"trading",status:o(v.status),createdBy:v.createdBy||"",assignedTo:S,assignees:T,approvals:v.approvals||[],createdAt:v.createdAt||new Date().toISOString(),updatedAt:v.updatedAt||new Date().toISOString(),completedAt:v.completedAt,closedAt:v.closedAt,completedBy:v.completedBy,priority:i(v.priority),dueDate:v.dueDate||new Date().toISOString().split("T")[0],dueTime:v.dueTime||"12:00",startTime:v.startTime,mainExecutor:v.mainExecutor,leadExecutor:v.leadExecutor,deputies:v.deputies||[],coExecutors:z,executors:v.executors||[],curators:v.curators||[],leads:v.leads||[],stages:L,currentStageId:v.currentStageId,awaitingStageId:v.awaitingStageId,comments:v.comments||[],expectedResult:v.expectedResult,requiresApproval:v.requiresApproval??!0}});const h=new Date,g=new Date(h.getTime()-12*60*60*1e3),f=d.filter(p=>p.status==="closed"&&p.closedAt?new Date(p.closedAt)<g:!1);if(f.length>0&&(await Promise.all(f.map(p=>Qg(p.id))),d=d.filter(p=>!f.find(v=>v.id===p.id))),r!=null&&r.assignedTo)if(Array.isArray(r.assignedTo)){const p=r.assignedTo;p.length>0&&(d=d.filter(v=>p.some(A=>v.assignedTo.includes(A))))}else d=d.filter(p=>p.assignedTo.includes(r.assignedTo));return d},$r=async(r,e)=>{const t=Ct(qe,"tasks",r),n=Object.fromEntries(Object.entries({...e,updatedAt:new Date().toISOString()}).filter(([a,i])=>i!==void 0));await Yr(t,n)},Qg=async r=>{const e=Ct(qe,"tasks",r);await vs(e)},Uu=async(r,e=!1)=>{const t=Nt(qe,"notes");let n;!e&&r?n=yt(t,Jt("userId","==",r)):n=yt(t);const i=(await cr(n)).docs.map(o=>{const c=o.data();return{id:o.id,userId:c.userId||"",title:c.title||"",text:c.text||"",priority:c.priority==="low"||c.priority==="high"?c.priority:"medium",createdAt:c.createdAt||new Date().toISOString(),updatedAt:c.updatedAt||new Date().toISOString()}});return i.sort((o,c)=>(c.updatedAt||"").localeCompare(o.updatedAt||"")),r&&!e?i.filter(o=>o.userId===r):i},I2=async r=>{const e=Nt(qe,"notes"),t={...r,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};return(await ws(e,t)).id},T2=async(r,e)=>{const t=Ct(qe,"notes",r),n=Object.fromEntries(Object.entries({...e,updatedAt:new Date().toISOString()}).filter(([a,i])=>i!==void 0));await Yr(t,n)},S2=async r=>{const e=Ct(qe,"notes",r);await vs(e)};function Pi(r){"@babel/helpers - typeof";return Pi=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Pi(r)}function Ir(r){if(r===null||r===!0||r===!1)return NaN;var e=Number(r);return isNaN(e)?e:e<0?Math.ceil(e):Math.floor(e)}function pt(r,e){if(e.length<r)throw new TypeError(r+" argument"+(r>1?"s":"")+" required, but only "+e.length+" present")}function St(r){pt(1,arguments);var e=Object.prototype.toString.call(r);return r instanceof Date||Pi(r)==="object"&&e==="[object Date]"?new Date(r.getTime()):typeof r=="number"||e==="[object Number]"?new Date(r):((typeof r=="string"||e==="[object String]")&&typeof console<"u"&&(console.warn("Starting with v2.0.0-beta.1 date-fns doesn't accept strings as date arguments. Please use `parseISO` to parse strings. See: https://github.com/date-fns/date-fns/blob/master/docs/upgradeGuide.md#string-arguments"),console.warn(new Error().stack)),new Date(NaN))}function A2(r,e){pt(2,arguments);var t=St(r).getTime(),n=Ir(e);return new Date(t+n)}var C2={};function En(){return C2}function D2(r,e){var t,n,a,i,o,c,d,h;pt(1,arguments);var g=En(),f=Ir((t=(n=(a=(i=e==null?void 0:e.weekStartsOn)!==null&&i!==void 0?i:e==null||(o=e.locale)===null||o===void 0||(c=o.options)===null||c===void 0?void 0:c.weekStartsOn)!==null&&a!==void 0?a:g.weekStartsOn)!==null&&n!==void 0?n:(d=g.locale)===null||d===void 0||(h=d.options)===null||h===void 0?void 0:h.weekStartsOn)!==null&&t!==void 0?t:0);if(!(f>=0&&f<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");var p=St(r),v=p.getDay(),A=(v<f?7:0)+v-f;return p.setDate(p.getDate()-A),p.setHours(0,0,0,0),p}function R2(r){var e=new Date(Date.UTC(r.getFullYear(),r.getMonth(),r.getDate(),r.getHours(),r.getMinutes(),r.getSeconds(),r.getMilliseconds()));return e.setUTCFullYear(r.getFullYear()),r.getTime()-e.getTime()}function Bu(r){pt(1,arguments);var e=St(r);return e.setHours(0,0,0,0),e}var Xg=6e4,Jg=36e5;function P2(r,e){pt(2,arguments);var t=Bu(r),n=Bu(e);return t.getTime()===n.getTime()}function M2(r){return pt(1,arguments),r instanceof Date||Pi(r)==="object"&&Object.prototype.toString.call(r)==="[object Date]"}function $2(r){if(pt(1,arguments),!M2(r)&&typeof r!="number")return!1;var e=St(r);return!isNaN(Number(e))}function O2(r,e){var t;pt(1,arguments);var n=r||{},a=St(n.start),i=St(n.end),o=i.getTime();if(!(a.getTime()<=o))throw new RangeError("Invalid interval");var c=[],d=a;d.setHours(0,0,0,0);var h=Number((t=void 0)!==null&&t!==void 0?t:1);if(h<1||isNaN(h))throw new RangeError("`options.step` must be a number greater than 1");for(;d.getTime()<=o;)c.push(St(d)),d.setDate(d.getDate()+h),d.setHours(0,0,0,0);return c}function V2(r,e){var t,n,a,i,o,c,d,h;pt(1,arguments);var g=En(),f=Ir((t=(n=(a=(i=e==null?void 0:e.weekStartsOn)!==null&&i!==void 0?i:e==null||(o=e.locale)===null||o===void 0||(c=o.options)===null||c===void 0?void 0:c.weekStartsOn)!==null&&a!==void 0?a:g.weekStartsOn)!==null&&n!==void 0?n:(d=g.locale)===null||d===void 0||(h=d.options)===null||h===void 0?void 0:h.weekStartsOn)!==null&&t!==void 0?t:0);if(!(f>=0&&f<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");var p=St(r),v=p.getDay(),A=(v<f?-7:0)+6-(v-f);return p.setDate(p.getDate()+A),p.setHours(23,59,59,999),p}function L2(r,e){pt(2,arguments);var t=Ir(e);return A2(r,-t)}var F2=864e5;function U2(r){pt(1,arguments);var e=St(r),t=e.getTime();e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0);var n=e.getTime(),a=t-n;return Math.floor(a/F2)+1}function Mi(r){pt(1,arguments);var e=1,t=St(r),n=t.getUTCDay(),a=(n<e?7:0)+n-e;return t.setUTCDate(t.getUTCDate()-a),t.setUTCHours(0,0,0,0),t}function Zg(r){pt(1,arguments);var e=St(r),t=e.getUTCFullYear(),n=new Date(0);n.setUTCFullYear(t+1,0,4),n.setUTCHours(0,0,0,0);var a=Mi(n),i=new Date(0);i.setUTCFullYear(t,0,4),i.setUTCHours(0,0,0,0);var o=Mi(i);return e.getTime()>=a.getTime()?t+1:e.getTime()>=o.getTime()?t:t-1}function B2(r){pt(1,arguments);var e=Zg(r),t=new Date(0);t.setUTCFullYear(e,0,4),t.setUTCHours(0,0,0,0);var n=Mi(t);return n}var W2=6048e5;function q2(r){pt(1,arguments);var e=St(r),t=Mi(e).getTime()-B2(e).getTime();return Math.round(t/W2)+1}function yn(r,e){var t,n,a,i,o,c,d,h;pt(1,arguments);var g=En(),f=Ir((t=(n=(a=(i=e==null?void 0:e.weekStartsOn)!==null&&i!==void 0?i:e==null||(o=e.locale)===null||o===void 0||(c=o.options)===null||c===void 0?void 0:c.weekStartsOn)!==null&&a!==void 0?a:g.weekStartsOn)!==null&&n!==void 0?n:(d=g.locale)===null||d===void 0||(h=d.options)===null||h===void 0?void 0:h.weekStartsOn)!==null&&t!==void 0?t:0);if(!(f>=0&&f<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");var p=St(r),v=p.getUTCDay(),A=(v<f?7:0)+v-f;return p.setUTCDate(p.getUTCDate()-A),p.setUTCHours(0,0,0,0),p}function e0(r,e){var t,n,a,i,o,c,d,h;pt(1,arguments);var g=St(r),f=g.getUTCFullYear(),p=En(),v=Ir((t=(n=(a=(i=e==null?void 0:e.firstWeekContainsDate)!==null&&i!==void 0?i:e==null||(o=e.locale)===null||o===void 0||(c=o.options)===null||c===void 0?void 0:c.firstWeekContainsDate)!==null&&a!==void 0?a:p.firstWeekContainsDate)!==null&&n!==void 0?n:(d=p.locale)===null||d===void 0||(h=d.options)===null||h===void 0?void 0:h.firstWeekContainsDate)!==null&&t!==void 0?t:1);if(!(v>=1&&v<=7))throw new RangeError("firstWeekContainsDate must be between 1 and 7 inclusively");var A=new Date(0);A.setUTCFullYear(f+1,0,v),A.setUTCHours(0,0,0,0);var T=yn(A,e),S=new Date(0);S.setUTCFullYear(f,0,v),S.setUTCHours(0,0,0,0);var z=yn(S,e);return g.getTime()>=T.getTime()?f+1:g.getTime()>=z.getTime()?f:f-1}function z2(r,e){var t,n,a,i,o,c,d,h;pt(1,arguments);var g=En(),f=Ir((t=(n=(a=(i=e==null?void 0:e.firstWeekContainsDate)!==null&&i!==void 0?i:e==null||(o=e.locale)===null||o===void 0||(c=o.options)===null||c===void 0?void 0:c.firstWeekContainsDate)!==null&&a!==void 0?a:g.firstWeekContainsDate)!==null&&n!==void 0?n:(d=g.locale)===null||d===void 0||(h=d.options)===null||h===void 0?void 0:h.firstWeekContainsDate)!==null&&t!==void 0?t:1),p=e0(r,e),v=new Date(0);v.setUTCFullYear(p,0,f),v.setUTCHours(0,0,0,0);var A=yn(v,e);return A}var H2=6048e5;function G2(r,e){pt(1,arguments);var t=St(r),n=yn(t,e).getTime()-z2(t,e).getTime();return Math.round(n/H2)+1}function st(r,e){for(var t=r<0?"-":"",n=Math.abs(r).toString();n.length<e;)n="0"+n;return t+n}var ts={y:function(e,t){var n=e.getUTCFullYear(),a=n>0?n:1-n;return st(t==="yy"?a%100:a,t.length)},M:function(e,t){var n=e.getUTCMonth();return t==="M"?String(n+1):st(n+1,2)},d:function(e,t){return st(e.getUTCDate(),t.length)},a:function(e,t){var n=e.getUTCHours()/12>=1?"pm":"am";switch(t){case"a":case"aa":return n.toUpperCase();case"aaa":return n;case"aaaaa":return n[0];case"aaaa":default:return n==="am"?"a.m.":"p.m."}},h:function(e,t){return st(e.getUTCHours()%12||12,t.length)},H:function(e,t){return st(e.getUTCHours(),t.length)},m:function(e,t){return st(e.getUTCMinutes(),t.length)},s:function(e,t){return st(e.getUTCSeconds(),t.length)},S:function(e,t){var n=t.length,a=e.getUTCMilliseconds(),i=Math.floor(a*Math.pow(10,n-3));return st(i,t.length)}},Ks={midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},K2={G:function(e,t,n){var a=e.getUTCFullYear()>0?1:0;switch(t){case"G":case"GG":case"GGG":return n.era(a,{width:"abbreviated"});case"GGGGG":return n.era(a,{width:"narrow"});case"GGGG":default:return n.era(a,{width:"wide"})}},y:function(e,t,n){if(t==="yo"){var a=e.getUTCFullYear(),i=a>0?a:1-a;return n.ordinalNumber(i,{unit:"year"})}return ts.y(e,t)},Y:function(e,t,n,a){var i=e0(e,a),o=i>0?i:1-i;if(t==="YY"){var c=o%100;return st(c,2)}return t==="Yo"?n.ordinalNumber(o,{unit:"year"}):st(o,t.length)},R:function(e,t){var n=Zg(e);return st(n,t.length)},u:function(e,t){var n=e.getUTCFullYear();return st(n,t.length)},Q:function(e,t,n){var a=Math.ceil((e.getUTCMonth()+1)/3);switch(t){case"Q":return String(a);case"QQ":return st(a,2);case"Qo":return n.ordinalNumber(a,{unit:"quarter"});case"QQQ":return n.quarter(a,{width:"abbreviated",context:"formatting"});case"QQQQQ":return n.quarter(a,{width:"narrow",context:"formatting"});case"QQQQ":default:return n.quarter(a,{width:"wide",context:"formatting"})}},q:function(e,t,n){var a=Math.ceil((e.getUTCMonth()+1)/3);switch(t){case"q":return String(a);case"qq":return st(a,2);case"qo":return n.ordinalNumber(a,{unit:"quarter"});case"qqq":return n.quarter(a,{width:"abbreviated",context:"standalone"});case"qqqqq":return n.quarter(a,{width:"narrow",context:"standalone"});case"qqqq":default:return n.quarter(a,{width:"wide",context:"standalone"})}},M:function(e,t,n){var a=e.getUTCMonth();switch(t){case"M":case"MM":return ts.M(e,t);case"Mo":return n.ordinalNumber(a+1,{unit:"month"});case"MMM":return n.month(a,{width:"abbreviated",context:"formatting"});case"MMMMM":return n.month(a,{width:"narrow",context:"formatting"});case"MMMM":default:return n.month(a,{width:"wide",context:"formatting"})}},L:function(e,t,n){var a=e.getUTCMonth();switch(t){case"L":return String(a+1);case"LL":return st(a+1,2);case"Lo":return n.ordinalNumber(a+1,{unit:"month"});case"LLL":return n.month(a,{width:"abbreviated",context:"standalone"});case"LLLLL":return n.month(a,{width:"narrow",context:"standalone"});case"LLLL":default:return n.month(a,{width:"wide",context:"standalone"})}},w:function(e,t,n,a){var i=G2(e,a);return t==="wo"?n.ordinalNumber(i,{unit:"week"}):st(i,t.length)},I:function(e,t,n){var a=q2(e);return t==="Io"?n.ordinalNumber(a,{unit:"week"}):st(a,t.length)},d:function(e,t,n){return t==="do"?n.ordinalNumber(e.getUTCDate(),{unit:"date"}):ts.d(e,t)},D:function(e,t,n){var a=U2(e);return t==="Do"?n.ordinalNumber(a,{unit:"dayOfYear"}):st(a,t.length)},E:function(e,t,n){var a=e.getUTCDay();switch(t){case"E":case"EE":case"EEE":return n.day(a,{width:"abbreviated",context:"formatting"});case"EEEEE":return n.day(a,{width:"narrow",context:"formatting"});case"EEEEEE":return n.day(a,{width:"short",context:"formatting"});case"EEEE":default:return n.day(a,{width:"wide",context:"formatting"})}},e:function(e,t,n,a){var i=e.getUTCDay(),o=(i-a.weekStartsOn+8)%7||7;switch(t){case"e":return String(o);case"ee":return st(o,2);case"eo":return n.ordinalNumber(o,{unit:"day"});case"eee":return n.day(i,{width:"abbreviated",context:"formatting"});case"eeeee":return n.day(i,{width:"narrow",context:"formatting"});case"eeeeee":return n.day(i,{width:"short",context:"formatting"});case"eeee":default:return n.day(i,{width:"wide",context:"formatting"})}},c:function(e,t,n,a){var i=e.getUTCDay(),o=(i-a.weekStartsOn+8)%7||7;switch(t){case"c":return String(o);case"cc":return st(o,t.length);case"co":return n.ordinalNumber(o,{unit:"day"});case"ccc":return n.day(i,{width:"abbreviated",context:"standalone"});case"ccccc":return n.day(i,{width:"narrow",context:"standalone"});case"cccccc":return n.day(i,{width:"short",context:"standalone"});case"cccc":default:return n.day(i,{width:"wide",context:"standalone"})}},i:function(e,t,n){var a=e.getUTCDay(),i=a===0?7:a;switch(t){case"i":return String(i);case"ii":return st(i,t.length);case"io":return n.ordinalNumber(i,{unit:"day"});case"iii":return n.day(a,{width:"abbreviated",context:"formatting"});case"iiiii":return n.day(a,{width:"narrow",context:"formatting"});case"iiiiii":return n.day(a,{width:"short",context:"formatting"});case"iiii":default:return n.day(a,{width:"wide",context:"formatting"})}},a:function(e,t,n){var a=e.getUTCHours(),i=a/12>=1?"pm":"am";switch(t){case"a":case"aa":return n.dayPeriod(i,{width:"abbreviated",context:"formatting"});case"aaa":return n.dayPeriod(i,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return n.dayPeriod(i,{width:"narrow",context:"formatting"});case"aaaa":default:return n.dayPeriod(i,{width:"wide",context:"formatting"})}},b:function(e,t,n){var a=e.getUTCHours(),i;switch(a===12?i=Ks.noon:a===0?i=Ks.midnight:i=a/12>=1?"pm":"am",t){case"b":case"bb":return n.dayPeriod(i,{width:"abbreviated",context:"formatting"});case"bbb":return n.dayPeriod(i,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return n.dayPeriod(i,{width:"narrow",context:"formatting"});case"bbbb":default:return n.dayPeriod(i,{width:"wide",context:"formatting"})}},B:function(e,t,n){var a=e.getUTCHours(),i;switch(a>=17?i=Ks.evening:a>=12?i=Ks.afternoon:a>=4?i=Ks.morning:i=Ks.night,t){case"B":case"BB":case"BBB":return n.dayPeriod(i,{width:"abbreviated",context:"formatting"});case"BBBBB":return n.dayPeriod(i,{width:"narrow",context:"formatting"});case"BBBB":default:return n.dayPeriod(i,{width:"wide",context:"formatting"})}},h:function(e,t,n){if(t==="ho"){var a=e.getUTCHours()%12;return a===0&&(a=12),n.ordinalNumber(a,{unit:"hour"})}return ts.h(e,t)},H:function(e,t,n){return t==="Ho"?n.ordinalNumber(e.getUTCHours(),{unit:"hour"}):ts.H(e,t)},K:function(e,t,n){var a=e.getUTCHours()%12;return t==="Ko"?n.ordinalNumber(a,{unit:"hour"}):st(a,t.length)},k:function(e,t,n){var a=e.getUTCHours();return a===0&&(a=24),t==="ko"?n.ordinalNumber(a,{unit:"hour"}):st(a,t.length)},m:function(e,t,n){return t==="mo"?n.ordinalNumber(e.getUTCMinutes(),{unit:"minute"}):ts.m(e,t)},s:function(e,t,n){return t==="so"?n.ordinalNumber(e.getUTCSeconds(),{unit:"second"}):ts.s(e,t)},S:function(e,t){return ts.S(e,t)},X:function(e,t,n,a){var i=a._originalDate||e,o=i.getTimezoneOffset();if(o===0)return"Z";switch(t){case"X":return qu(o);case"XXXX":case"XX":return Es(o);case"XXXXX":case"XXX":default:return Es(o,":")}},x:function(e,t,n,a){var i=a._originalDate||e,o=i.getTimezoneOffset();switch(t){case"x":return qu(o);case"xxxx":case"xx":return Es(o);case"xxxxx":case"xxx":default:return Es(o,":")}},O:function(e,t,n,a){var i=a._originalDate||e,o=i.getTimezoneOffset();switch(t){case"O":case"OO":case"OOO":return"GMT"+Wu(o,":");case"OOOO":default:return"GMT"+Es(o,":")}},z:function(e,t,n,a){var i=a._originalDate||e,o=i.getTimezoneOffset();switch(t){case"z":case"zz":case"zzz":return"GMT"+Wu(o,":");case"zzzz":default:return"GMT"+Es(o,":")}},t:function(e,t,n,a){var i=a._originalDate||e,o=Math.floor(i.getTime()/1e3);return st(o,t.length)},T:function(e,t,n,a){var i=a._originalDate||e,o=i.getTime();return st(o,t.length)}};function Wu(r,e){var t=r>0?"-":"+",n=Math.abs(r),a=Math.floor(n/60),i=n%60;if(i===0)return t+String(a);var o=e;return t+String(a)+o+st(i,2)}function qu(r,e){if(r%60===0){var t=r>0?"-":"+";return t+st(Math.abs(r)/60,2)}return Es(r,e)}function Es(r,e){var t=e||"",n=r>0?"-":"+",a=Math.abs(r),i=st(Math.floor(a/60),2),o=st(a%60,2);return n+i+t+o}var zu=function(e,t){switch(e){case"P":return t.date({width:"short"});case"PP":return t.date({width:"medium"});case"PPP":return t.date({width:"long"});case"PPPP":default:return t.date({width:"full"})}},t0=function(e,t){switch(e){case"p":return t.time({width:"short"});case"pp":return t.time({width:"medium"});case"ppp":return t.time({width:"long"});case"pppp":default:return t.time({width:"full"})}},Y2=function(e,t){var n=e.match(/(P+)(p+)?/)||[],a=n[1],i=n[2];if(!i)return zu(e,t);var o;switch(a){case"P":o=t.dateTime({width:"short"});break;case"PP":o=t.dateTime({width:"medium"});break;case"PPP":o=t.dateTime({width:"long"});break;case"PPPP":default:o=t.dateTime({width:"full"});break}return o.replace("{{date}}",zu(a,t)).replace("{{time}}",t0(i,t))},Q2={p:t0,P:Y2},X2=["D","DD"],J2=["YY","YYYY"];function Z2(r){return X2.indexOf(r)!==-1}function ek(r){return J2.indexOf(r)!==-1}function Hu(r,e,t){if(r==="YYYY")throw new RangeError("Use `yyyy` instead of `YYYY` (in `".concat(e,"`) for formatting years to the input `").concat(t,"`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md"));if(r==="YY")throw new RangeError("Use `yy` instead of `YY` (in `".concat(e,"`) for formatting years to the input `").concat(t,"`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md"));if(r==="D")throw new RangeError("Use `d` instead of `D` (in `".concat(e,"`) for formatting days of the month to the input `").concat(t,"`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md"));if(r==="DD")throw new RangeError("Use `dd` instead of `DD` (in `".concat(e,"`) for formatting days of the month to the input `").concat(t,"`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md"))}var tk={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},rk=function(e,t,n){var a,i=tk[e];return typeof i=="string"?a=i:t===1?a=i.one:a=i.other.replace("{{count}}",t.toString()),n!=null&&n.addSuffix?n.comparison&&n.comparison>0?"in "+a:a+" ago":a};function nn(r){return function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=e.width?String(e.width):r.defaultWidth,n=r.formats[t]||r.formats[r.defaultWidth];return n}}var sk={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},nk={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},ak={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},ik={date:nn({formats:sk,defaultWidth:"full"}),time:nn({formats:nk,defaultWidth:"full"}),dateTime:nn({formats:ak,defaultWidth:"full"})},ok={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},lk=function(e,t,n,a){return ok[e]};function xr(r){return function(e,t){var n=t!=null&&t.context?String(t.context):"standalone",a;if(n==="formatting"&&r.formattingValues){var i=r.defaultFormattingWidth||r.defaultWidth,o=t!=null&&t.width?String(t.width):i;a=r.formattingValues[o]||r.formattingValues[i]}else{var c=r.defaultWidth,d=t!=null&&t.width?String(t.width):r.defaultWidth;a=r.values[d]||r.values[c]}var h=r.argumentCallback?r.argumentCallback(e):e;return a[h]}}var ck={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},dk={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},uk={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},hk={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},mk={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},gk={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},pk=function(e,t){var n=Number(e),a=n%100;if(a>20||a<10)switch(a%10){case 1:return n+"st";case 2:return n+"nd";case 3:return n+"rd"}return n+"th"},fk={ordinalNumber:pk,era:xr({values:ck,defaultWidth:"wide"}),quarter:xr({values:dk,defaultWidth:"wide",argumentCallback:function(e){return e-1}}),month:xr({values:uk,defaultWidth:"wide"}),day:xr({values:hk,defaultWidth:"wide"}),dayPeriod:xr({values:mk,defaultWidth:"wide",formattingValues:gk,defaultFormattingWidth:"wide"})};function yr(r){return function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=t.width,a=n&&r.matchPatterns[n]||r.matchPatterns[r.defaultMatchWidth],i=e.match(a);if(!i)return null;var o=i[0],c=n&&r.parsePatterns[n]||r.parsePatterns[r.defaultParseWidth],d=Array.isArray(c)?yk(c,function(f){return f.test(o)}):xk(c,function(f){return f.test(o)}),h;h=r.valueCallback?r.valueCallback(d):d,h=t.valueCallback?t.valueCallback(h):h;var g=e.slice(o.length);return{value:h,rest:g}}}function xk(r,e){for(var t in r)if(r.hasOwnProperty(t)&&e(r[t]))return t}function yk(r,e){for(var t=0;t<r.length;t++)if(e(r[t]))return t}function r0(r){return function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=e.match(r.matchPattern);if(!n)return null;var a=n[0],i=e.match(r.parsePattern);if(!i)return null;var o=r.valueCallback?r.valueCallback(i[0]):i[0];o=t.valueCallback?t.valueCallback(o):o;var c=e.slice(a.length);return{value:o,rest:c}}}var bk=/^(\d+)(th|st|nd|rd)?/i,vk=/\d+/i,wk={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},kk={any:[/^b/i,/^(a|c)/i]},_k={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},Nk={any:[/1/i,/2/i,/3/i,/4/i]},jk={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},Ek={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},Ik={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},Tk={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},Sk={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},Ak={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},Ck={ordinalNumber:r0({matchPattern:bk,parsePattern:vk,valueCallback:function(e){return parseInt(e,10)}}),era:yr({matchPatterns:wk,defaultMatchWidth:"wide",parsePatterns:kk,defaultParseWidth:"any"}),quarter:yr({matchPatterns:_k,defaultMatchWidth:"wide",parsePatterns:Nk,defaultParseWidth:"any",valueCallback:function(e){return e+1}}),month:yr({matchPatterns:jk,defaultMatchWidth:"wide",parsePatterns:Ek,defaultParseWidth:"any"}),day:yr({matchPatterns:Ik,defaultMatchWidth:"wide",parsePatterns:Tk,defaultParseWidth:"any"}),dayPeriod:yr({matchPatterns:Sk,defaultMatchWidth:"any",parsePatterns:Ak,defaultParseWidth:"any"})},Dk={code:"en-US",formatDistance:rk,formatLong:ik,formatRelative:lk,localize:fk,match:Ck,options:{weekStartsOn:0,firstWeekContainsDate:1}},Rk=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,Pk=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,Mk=/^'([^]*?)'?$/,$k=/''/g,Ok=/[a-zA-Z]/;function s0(r,e,t){var n,a,i,o,c,d,h,g,f,p,v,A,T,S,z,L,C,j;pt(2,arguments);var H=String(e),Y=En(),I=(n=(a=t==null?void 0:t.locale)!==null&&a!==void 0?a:Y.locale)!==null&&n!==void 0?n:Dk,y=Ir((i=(o=(c=(d=t==null?void 0:t.firstWeekContainsDate)!==null&&d!==void 0?d:t==null||(h=t.locale)===null||h===void 0||(g=h.options)===null||g===void 0?void 0:g.firstWeekContainsDate)!==null&&c!==void 0?c:Y.firstWeekContainsDate)!==null&&o!==void 0?o:(f=Y.locale)===null||f===void 0||(p=f.options)===null||p===void 0?void 0:p.firstWeekContainsDate)!==null&&i!==void 0?i:1);if(!(y>=1&&y<=7))throw new RangeError("firstWeekContainsDate must be between 1 and 7 inclusively");var w=Ir((v=(A=(T=(S=t==null?void 0:t.weekStartsOn)!==null&&S!==void 0?S:t==null||(z=t.locale)===null||z===void 0||(L=z.options)===null||L===void 0?void 0:L.weekStartsOn)!==null&&T!==void 0?T:Y.weekStartsOn)!==null&&A!==void 0?A:(C=Y.locale)===null||C===void 0||(j=C.options)===null||j===void 0?void 0:j.weekStartsOn)!==null&&v!==void 0?v:0);if(!(w>=0&&w<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");if(!I.localize)throw new RangeError("locale must contain localize property");if(!I.formatLong)throw new RangeError("locale must contain formatLong property");var N=St(r);if(!$2(N))throw new RangeError("Invalid time value");var E=R2(N),_=L2(N,E),x={firstWeekContainsDate:y,weekStartsOn:w,locale:I,_originalDate:N},de=H.match(Pk).map(function(M){var X=M[0];if(X==="p"||X==="P"){var R=Q2[X];return R(M,I.formatLong)}return M}).join("").match(Rk).map(function(M){if(M==="''")return"'";var X=M[0];if(X==="'")return Vk(M);var R=K2[X];if(R)return!(t!=null&&t.useAdditionalWeekYearTokens)&&ek(M)&&Hu(M,e,String(r)),!(t!=null&&t.useAdditionalDayOfYearTokens)&&Z2(M)&&Hu(M,e,String(r)),R(_,M,I.localize,x);if(X.match(Ok))throw new RangeError("Format string contains an unescaped latin alphabet character `"+X+"`");return M}).join("");return de}function Vk(r){var e=r.match(Mk);return e?e[1].replace($k,"'"):r}function Lk(r,e){pt(2,arguments);var t=St(r),n=St(e);return t.getTime()<n.getTime()}function lr(r,e){var t;pt(1,arguments);var n=Ir((t=void 0)!==null&&t!==void 0?t:2);if(n!==2&&n!==1&&n!==0)throw new RangeError("additionalDigits must be 0, 1 or 2");if(!(typeof r=="string"||Object.prototype.toString.call(r)==="[object String]"))return new Date(NaN);var a=Wk(r),i;if(a.date){var o=qk(a.date,n);i=zk(o.restDateString,o.year)}if(!i||isNaN(i.getTime()))return new Date(NaN);var c=i.getTime(),d=0,h;if(a.time&&(d=Hk(a.time),isNaN(d)))return new Date(NaN);if(a.timezone){if(h=Gk(a.timezone),isNaN(h))return new Date(NaN)}else{var g=new Date(c+d),f=new Date(0);return f.setFullYear(g.getUTCFullYear(),g.getUTCMonth(),g.getUTCDate()),f.setHours(g.getUTCHours(),g.getUTCMinutes(),g.getUTCSeconds(),g.getUTCMilliseconds()),f}return new Date(c+d+h)}var ei={dateTimeDelimiter:/[T ]/,timeZoneDelimiter:/[Z ]/i,timezone:/([Z+-].*)$/},Fk=/^-?(?:(\d{3})|(\d{2})(?:-?(\d{2}))?|W(\d{2})(?:-?(\d{1}))?|)$/,Uk=/^(\d{2}(?:[.,]\d*)?)(?::?(\d{2}(?:[.,]\d*)?))?(?::?(\d{2}(?:[.,]\d*)?))?$/,Bk=/^([+-])(\d{2})(?::?(\d{2}))?$/;function Wk(r){var e={},t=r.split(ei.dateTimeDelimiter),n;if(t.length>2)return e;if(/:/.test(t[0])?n=t[0]:(e.date=t[0],n=t[1],ei.timeZoneDelimiter.test(e.date)&&(e.date=r.split(ei.timeZoneDelimiter)[0],n=r.substr(e.date.length,r.length))),n){var a=ei.timezone.exec(n);a?(e.time=n.replace(a[1],""),e.timezone=a[1]):e.time=n}return e}function qk(r,e){var t=new RegExp("^(?:(\\d{4}|[+-]\\d{"+(4+e)+"})|(\\d{2}|[+-]\\d{"+(2+e)+"})$)"),n=r.match(t);if(!n)return{year:NaN,restDateString:""};var a=n[1]?parseInt(n[1]):null,i=n[2]?parseInt(n[2]):null;return{year:i===null?a:i*100,restDateString:r.slice((n[1]||n[2]).length)}}function zk(r,e){if(e===null)return new Date(NaN);var t=r.match(Fk);if(!t)return new Date(NaN);var n=!!t[4],a=Vn(t[1]),i=Vn(t[2])-1,o=Vn(t[3]),c=Vn(t[4]),d=Vn(t[5])-1;if(n)return Jk(e,c,d)?Kk(e,c,d):new Date(NaN);var h=new Date(0);return!Qk(e,i,o)||!Xk(e,a)?new Date(NaN):(h.setUTCFullYear(e,i,Math.max(a,o)),h)}function Vn(r){return r?parseInt(r):1}function Hk(r){var e=r.match(Uk);if(!e)return NaN;var t=Wo(e[1]),n=Wo(e[2]),a=Wo(e[3]);return Zk(t,n,a)?t*Jg+n*Xg+a*1e3:NaN}function Wo(r){return r&&parseFloat(r.replace(",","."))||0}function Gk(r){if(r==="Z")return 0;var e=r.match(Bk);if(!e)return 0;var t=e[1]==="+"?-1:1,n=parseInt(e[2]),a=e[3]&&parseInt(e[3])||0;return e_(n,a)?t*(n*Jg+a*Xg):NaN}function Kk(r,e,t){var n=new Date(0);n.setUTCFullYear(r,0,4);var a=n.getUTCDay()||7,i=(e-1)*7+t+1-a;return n.setUTCDate(n.getUTCDate()+i),n}var Yk=[31,null,31,30,31,30,31,31,30,31,30,31];function n0(r){return r%400===0||r%4===0&&r%100!==0}function Qk(r,e,t){return e>=0&&e<=11&&t>=1&&t<=(Yk[e]||(n0(r)?29:28))}function Xk(r,e){return e>=1&&e<=(n0(r)?366:365)}function Jk(r,e,t){return e>=1&&e<=53&&t>=0&&t<=6}function Zk(r,e,t){return r===24?e===0&&t===0:t>=0&&t<60&&e>=0&&e<60&&r>=0&&r<25}function e_(r,e){return e>=0&&e<=59}function Gu(r,e,t){pt(2,arguments);var n=yn(r,t),a=yn(e,t);return n.getTime()===a.getTime()}function Ln(r,e){if(r.one!==void 0&&e===1)return r.one;var t=e%10,n=e%100;return t===1&&n!==11?r.singularNominative.replace("{{count}}",String(e)):t>=2&&t<=4&&(n<10||n>20)?r.singularGenitive.replace("{{count}}",String(e)):r.pluralGenitive.replace("{{count}}",String(e))}function Ht(r){return function(e,t){return t!=null&&t.addSuffix?t.comparison&&t.comparison>0?r.future?Ln(r.future,e):"через "+Ln(r.regular,e):r.past?Ln(r.past,e):Ln(r.regular,e)+" назад":Ln(r.regular,e)}}var t_={lessThanXSeconds:Ht({regular:{one:"меньше секунды",singularNominative:"меньше {{count}} секунды",singularGenitive:"меньше {{count}} секунд",pluralGenitive:"меньше {{count}} секунд"},future:{one:"меньше, чем через секунду",singularNominative:"меньше, чем через {{count}} секунду",singularGenitive:"меньше, чем через {{count}} секунды",pluralGenitive:"меньше, чем через {{count}} секунд"}}),xSeconds:Ht({regular:{singularNominative:"{{count}} секунда",singularGenitive:"{{count}} секунды",pluralGenitive:"{{count}} секунд"},past:{singularNominative:"{{count}} секунду назад",singularGenitive:"{{count}} секунды назад",pluralGenitive:"{{count}} секунд назад"},future:{singularNominative:"через {{count}} секунду",singularGenitive:"через {{count}} секунды",pluralGenitive:"через {{count}} секунд"}}),halfAMinute:function(e,t){return t!=null&&t.addSuffix?t.comparison&&t.comparison>0?"через полминуты":"полминуты назад":"полминуты"},lessThanXMinutes:Ht({regular:{one:"меньше минуты",singularNominative:"меньше {{count}} минуты",singularGenitive:"меньше {{count}} минут",pluralGenitive:"меньше {{count}} минут"},future:{one:"меньше, чем через минуту",singularNominative:"меньше, чем через {{count}} минуту",singularGenitive:"меньше, чем через {{count}} минуты",pluralGenitive:"меньше, чем через {{count}} минут"}}),xMinutes:Ht({regular:{singularNominative:"{{count}} минута",singularGenitive:"{{count}} минуты",pluralGenitive:"{{count}} минут"},past:{singularNominative:"{{count}} минуту назад",singularGenitive:"{{count}} минуты назад",pluralGenitive:"{{count}} минут назад"},future:{singularNominative:"через {{count}} минуту",singularGenitive:"через {{count}} минуты",pluralGenitive:"через {{count}} минут"}}),aboutXHours:Ht({regular:{singularNominative:"около {{count}} часа",singularGenitive:"около {{count}} часов",pluralGenitive:"около {{count}} часов"},future:{singularNominative:"приблизительно через {{count}} час",singularGenitive:"приблизительно через {{count}} часа",pluralGenitive:"приблизительно через {{count}} часов"}}),xHours:Ht({regular:{singularNominative:"{{count}} час",singularGenitive:"{{count}} часа",pluralGenitive:"{{count}} часов"}}),xDays:Ht({regular:{singularNominative:"{{count}} день",singularGenitive:"{{count}} дня",pluralGenitive:"{{count}} дней"}}),aboutXWeeks:Ht({regular:{singularNominative:"около {{count}} недели",singularGenitive:"около {{count}} недель",pluralGenitive:"около {{count}} недель"},future:{singularNominative:"приблизительно через {{count}} неделю",singularGenitive:"приблизительно через {{count}} недели",pluralGenitive:"приблизительно через {{count}} недель"}}),xWeeks:Ht({regular:{singularNominative:"{{count}} неделя",singularGenitive:"{{count}} недели",pluralGenitive:"{{count}} недель"}}),aboutXMonths:Ht({regular:{singularNominative:"около {{count}} месяца",singularGenitive:"около {{count}} месяцев",pluralGenitive:"около {{count}} месяцев"},future:{singularNominative:"приблизительно через {{count}} месяц",singularGenitive:"приблизительно через {{count}} месяца",pluralGenitive:"приблизительно через {{count}} месяцев"}}),xMonths:Ht({regular:{singularNominative:"{{count}} месяц",singularGenitive:"{{count}} месяца",pluralGenitive:"{{count}} месяцев"}}),aboutXYears:Ht({regular:{singularNominative:"около {{count}} года",singularGenitive:"около {{count}} лет",pluralGenitive:"около {{count}} лет"},future:{singularNominative:"приблизительно через {{count}} год",singularGenitive:"приблизительно через {{count}} года",pluralGenitive:"приблизительно через {{count}} лет"}}),xYears:Ht({regular:{singularNominative:"{{count}} год",singularGenitive:"{{count}} года",pluralGenitive:"{{count}} лет"}}),overXYears:Ht({regular:{singularNominative:"больше {{count}} года",singularGenitive:"больше {{count}} лет",pluralGenitive:"больше {{count}} лет"},future:{singularNominative:"больше, чем через {{count}} год",singularGenitive:"больше, чем через {{count}} года",pluralGenitive:"больше, чем через {{count}} лет"}}),almostXYears:Ht({regular:{singularNominative:"почти {{count}} год",singularGenitive:"почти {{count}} года",pluralGenitive:"почти {{count}} лет"},future:{singularNominative:"почти через {{count}} год",singularGenitive:"почти через {{count}} года",pluralGenitive:"почти через {{count}} лет"}})},r_=function(e,t,n){return t_[e](t,n)},s_={full:"EEEE, d MMMM y 'г.'",long:"d MMMM y 'г.'",medium:"d MMM y 'г.'",short:"dd.MM.y"},n_={full:"H:mm:ss zzzz",long:"H:mm:ss z",medium:"H:mm:ss",short:"H:mm"},a_={any:"{{date}}, {{time}}"},i_={date:nn({formats:s_,defaultWidth:"full"}),time:nn({formats:n_,defaultWidth:"full"}),dateTime:nn({formats:a_,defaultWidth:"any"})},kc=["воскресенье","понедельник","вторник","среду","четверг","пятницу","субботу"];function o_(r){var e=kc[r];switch(r){case 0:return"'в прошлое "+e+" в' p";case 1:case 2:case 4:return"'в прошлый "+e+" в' p";case 3:case 5:case 6:return"'в прошлую "+e+" в' p"}}function Ku(r){var e=kc[r];return r===2?"'во "+e+" в' p":"'в "+e+" в' p"}function l_(r){var e=kc[r];switch(r){case 0:return"'в следующее "+e+" в' p";case 1:case 2:case 4:return"'в следующий "+e+" в' p";case 3:case 5:case 6:return"'в следующую "+e+" в' p"}}var c_={lastWeek:function(e,t,n){var a=e.getUTCDay();return Gu(e,t,n)?Ku(a):o_(a)},yesterday:"'вчера в' p",today:"'сегодня в' p",tomorrow:"'завтра в' p",nextWeek:function(e,t,n){var a=e.getUTCDay();return Gu(e,t,n)?Ku(a):l_(a)},other:"P"},d_=function(e,t,n,a){var i=c_[e];return typeof i=="function"?i(t,n,a):i},u_={narrow:["до н.э.","н.э."],abbreviated:["до н. э.","н. э."],wide:["до нашей эры","нашей эры"]},h_={narrow:["1","2","3","4"],abbreviated:["1-й кв.","2-й кв.","3-й кв.","4-й кв."],wide:["1-й квартал","2-й квартал","3-й квартал","4-й квартал"]},m_={narrow:["Я","Ф","М","А","М","И","И","А","С","О","Н","Д"],abbreviated:["янв.","фев.","март","апр.","май","июнь","июль","авг.","сент.","окт.","нояб.","дек."],wide:["январь","февраль","март","апрель","май","июнь","июль","август","сентябрь","октябрь","ноябрь","декабрь"]},g_={narrow:["Я","Ф","М","А","М","И","И","А","С","О","Н","Д"],abbreviated:["янв.","фев.","мар.","апр.","мая","июн.","июл.","авг.","сент.","окт.","нояб.","дек."],wide:["января","февраля","марта","апреля","мая","июня","июля","августа","сентября","октября","ноября","декабря"]},p_={narrow:["В","П","В","С","Ч","П","С"],short:["вс","пн","вт","ср","чт","пт","сб"],abbreviated:["вск","пнд","втр","срд","чтв","птн","суб"],wide:["воскресенье","понедельник","вторник","среда","четверг","пятница","суббота"]},f_={narrow:{am:"ДП",pm:"ПП",midnight:"полн.",noon:"полд.",morning:"утро",afternoon:"день",evening:"веч.",night:"ночь"},abbreviated:{am:"ДП",pm:"ПП",midnight:"полн.",noon:"полд.",morning:"утро",afternoon:"день",evening:"веч.",night:"ночь"},wide:{am:"ДП",pm:"ПП",midnight:"полночь",noon:"полдень",morning:"утро",afternoon:"день",evening:"вечер",night:"ночь"}},x_={narrow:{am:"ДП",pm:"ПП",midnight:"полн.",noon:"полд.",morning:"утра",afternoon:"дня",evening:"веч.",night:"ночи"},abbreviated:{am:"ДП",pm:"ПП",midnight:"полн.",noon:"полд.",morning:"утра",afternoon:"дня",evening:"веч.",night:"ночи"},wide:{am:"ДП",pm:"ПП",midnight:"полночь",noon:"полдень",morning:"утра",afternoon:"дня",evening:"вечера",night:"ночи"}},y_=function(e,t){var n=Number(e),a=t==null?void 0:t.unit,i;return a==="date"?i="-е":a==="week"||a==="minute"||a==="second"?i="-я":i="-й",n+i},b_={ordinalNumber:y_,era:xr({values:u_,defaultWidth:"wide"}),quarter:xr({values:h_,defaultWidth:"wide",argumentCallback:function(e){return e-1}}),month:xr({values:m_,defaultWidth:"wide",formattingValues:g_,defaultFormattingWidth:"wide"}),day:xr({values:p_,defaultWidth:"wide"}),dayPeriod:xr({values:f_,defaultWidth:"any",formattingValues:x_,defaultFormattingWidth:"wide"})},v_=/^(\d+)(-?(е|я|й|ое|ье|ая|ья|ый|ой|ий|ый))?/i,w_=/\d+/i,k_={narrow:/^((до )?н\.?\s?э\.?)/i,abbreviated:/^((до )?н\.?\s?э\.?)/i,wide:/^(до нашей эры|нашей эры|наша эра)/i},__={any:[/^д/i,/^н/i]},N_={narrow:/^[1234]/i,abbreviated:/^[1234](-?[ыои]?й?)? кв.?/i,wide:/^[1234](-?[ыои]?й?)? квартал/i},j_={any:[/1/i,/2/i,/3/i,/4/i]},E_={narrow:/^[яфмаисонд]/i,abbreviated:/^(янв|фев|март?|апр|ма[йя]|июн[ья]?|июл[ья]?|авг|сент?|окт|нояб?|дек)\.?/i,wide:/^(январ[ья]|феврал[ья]|марта?|апрел[ья]|ма[йя]|июн[ья]|июл[ья]|августа?|сентябр[ья]|октябр[ья]|октябр[ья]|ноябр[ья]|декабр[ья])/i},I_={narrow:[/^я/i,/^ф/i,/^м/i,/^а/i,/^м/i,/^и/i,/^и/i,/^а/i,/^с/i,/^о/i,/^н/i,/^я/i],any:[/^я/i,/^ф/i,/^мар/i,/^ап/i,/^ма[йя]/i,/^июн/i,/^июл/i,/^ав/i,/^с/i,/^о/i,/^н/i,/^д/i]},T_={narrow:/^[впсч]/i,short:/^(вс|во|пн|по|вт|ср|чт|че|пт|пя|сб|су)\.?/i,abbreviated:/^(вск|вос|пнд|пон|втр|вто|срд|сре|чтв|чет|птн|пят|суб).?/i,wide:/^(воскресень[ея]|понедельника?|вторника?|сред[аы]|четверга?|пятниц[аы]|суббот[аы])/i},S_={narrow:[/^в/i,/^п/i,/^в/i,/^с/i,/^ч/i,/^п/i,/^с/i],any:[/^в[ос]/i,/^п[он]/i,/^в/i,/^ср/i,/^ч/i,/^п[ят]/i,/^с[уб]/i]},A_={narrow:/^([дп]п|полн\.?|полд\.?|утр[оа]|день|дня|веч\.?|ноч[ьи])/i,abbreviated:/^([дп]п|полн\.?|полд\.?|утр[оа]|день|дня|веч\.?|ноч[ьи])/i,wide:/^([дп]п|полночь|полдень|утр[оа]|день|дня|вечера?|ноч[ьи])/i},C_={any:{am:/^дп/i,pm:/^пп/i,midnight:/^полн/i,noon:/^полд/i,morning:/^у/i,afternoon:/^д[ен]/i,evening:/^в/i,night:/^н/i}},D_={ordinalNumber:r0({matchPattern:v_,parsePattern:w_,valueCallback:function(e){return parseInt(e,10)}}),era:yr({matchPatterns:k_,defaultMatchWidth:"wide",parsePatterns:__,defaultParseWidth:"any"}),quarter:yr({matchPatterns:N_,defaultMatchWidth:"wide",parsePatterns:j_,defaultParseWidth:"any",valueCallback:function(e){return e+1}}),month:yr({matchPatterns:E_,defaultMatchWidth:"wide",parsePatterns:I_,defaultParseWidth:"any"}),day:yr({matchPatterns:T_,defaultMatchWidth:"wide",parsePatterns:S_,defaultParseWidth:"any"}),dayPeriod:yr({matchPatterns:A_,defaultMatchWidth:"wide",parsePatterns:C_,defaultParseWidth:"any"})},R_={code:"ru",formatDistance:r_,formatLong:i_,formatRelative:d_,localize:b_,match:D_,options:{weekStartsOn:1,firstWeekContainsDate:1}};const ce=(r,e="dd.MM.yyyy")=>{try{const t=typeof r=="string"?lr(r):r;return!t||Number.isNaN(t.getTime())?"":s0(t,e,{locale:R_})}catch{return""}},Ca=(r=new Date)=>{const e=D2(r,{weekStartsOn:1}),t=V2(r,{weekStartsOn:1});return{start:e,end:t}},_c=(r=new Date)=>{const{start:e,end:t}=Ca(r);return O2({start:e,end:t})},a0=r=>{const e=new Date,t=new Date(e);t.setHours(0,0,0,0),t.setDate(t.getDate()-(r-1));const n=new Date(e);return n.setHours(23,59,59,999),{start:t,end:n}},i0=(r,e)=>{const t=typeof r=="string"?lr(r):r,n=typeof e=="string"?lr(e):e;return P2(t,n)},ho=r=>r.reduce((e,t)=>{const[n,a]=t.start.split(":").map(Number),[i,o]=t.end.split(":").map(Number),c=n*60+a;let h=(i*60+o-c)/60;if((h<0||t.endDate)&&(h+=24),t.breaks&&t.breaks.length>0){const g=t.breaks.reduce((f,p)=>{const[v,A]=p.start.split(":").map(Number),[T,S]=p.end.split(":").map(Number),z=v*60+A;let C=(T*60+S-z)/60;return C<0&&(C+=24),f+C},0);h-=g}return e+h},0),or=r=>{const[e,t]=r.split(":").map(Number);return e*60+t},$i=(r,e)=>{if(!r||!e)return[];const t=lr(r),n=lr(e);if(Lk(n,t))return[];const a=[],i=new Date(t);for(;i<=n;)a.push(ce(i,"yyyy-MM-dd")),i.setDate(i.getDate()+1);return a},o0=r=>{const e=Array.from(new Set(r.filter(Boolean)));return e.sort(),e},P_=(r,e)=>{const t=or(r.start),n=or(r.end),a=or(e.start),i=or(e.end);return t<i&&n>a},yl=()=>{const r=new Date,e=3*60,t=r.getTimezoneOffset();return new Date(r.getTime()+(e+t)*60*1e3)},Yu=(r,e=yl())=>{const t=e.getHours(),n=new Date(`${s0(e,"yyyy-MM-dd")}T${r}:00`);return t>=21||e>n},M_=r=>{const e=Math.floor(r),t=Math.round((r-e)*60);return e===0&&t===0?"0ч":e===0?`${t}м`:t===0?`${e}ч`:`${e}ч ${t}м`},an=(r,e,t,n)=>{const a=r,i=e||r;if(i<t||a>n)return 0;const o=a>t?a:t,c=i<n?i:n,d=lr(o),g=lr(c).getTime()-d.getTime();return Math.floor(g/(1e3*60*60*24))+1},dr=({children:r})=>{const{theme:e,toggleTheme:t}=it(),{isAdmin:n}=At(),{user:a}=jt(),i=R0(),[o,c]=D.useState(!1),[d,h]=D.useState(!1),[g,f]=D.useState([]),p=[{path:"/management",label:"Расписание",icon:gs},{path:"/earnings",label:"Заработок",icon:Fi},{path:"/tasks",label:"Задачи",icon:Fr},{path:"/rating",label:"Рейтинг",icon:Ms},{path:"/call",label:"HUB",icon:si},{path:"/approvals",label:"Согласования",icon:Ds}],v=p.some(T=>i.pathname===T.path),A=T=>i.pathname===T;return D.useEffect(()=>{c(!1)},[i.pathname]),D.useEffect(()=>{const T=async()=>{try{if(!a&&!n){f([]);return}const z=await vc(),L=Date.now()-6*60*60*1e3,C=z.filter(j=>{if(!n&&a&&j.authorId!==a.id&&j.targetUserId!==a.id)return!1;const H=Date.parse(j.updatedAt||j.createdAt);return!Number.isNaN(H)&&H>=L});f(C.map(j=>({id:j.id,status:j.status,text:`${j.entity==="slot"?"Слот":"Статус"} • ${j.status==="approved"?"Подтверждено":j.status==="rejected"?"Отклонено":"На согласовании"}${j.adminComment?`: ${j.adminComment}`:""}`,time:ce(j.updatedAt||j.createdAt||new Date().toISOString(),"dd.MM HH:mm")})))}catch(z){console.error("Failed to load notifications",z)}};T();const S=setInterval(T,2*60*1e3);return()=>clearInterval(S)},[a,n]),s.jsxs("div",{className:"app-shell",children:[s.jsxs("div",{className:"absolute inset-0 pointer-events-none -z-10 overflow-hidden",children:[s.jsx("div",{className:"absolute -top-24 -left-12 w-80 h-80 bg-gradient-to-br from-[#4E6E49]/25 via-transparent to-transparent blur-3xl"}),s.jsx("div",{className:"absolute top-8 right-0 w-[520px] h-[520px] bg-gradient-to-bl from-blue-500/12 via-purple-500/10 to-transparent blur-3xl"}),s.jsx("div",{className:"absolute bottom-[-120px] left-12 w-96 h-96 bg-gradient-to-tr from-amber-400/10 to-[#4E6E49]/12 blur-3xl"}),s.jsx("div",{className:"floating-grid"})]}),s.jsx("header",{className:"sticky top-0 z-50 backdrop-blur-md",children:s.jsx("div",{className:"max-w-7xl mx-auto px-4 lg:px-6 pt-4 pb-2",children:s.jsxs("div",{className:"glass-panel rounded-2xl px-4 lg:px-6 py-3 flex items-center gap-4 shadow-2xl",children:[s.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[s.jsxs("div",{className:"relative w-12 h-12 rounded-2xl bg-white/80 dark:bg-white/5 border border-white/50 dark:border-white/10 shadow-lg overflow-hidden flex items-center justify-center",children:[s.jsx("img",{src:vh,alt:"ApeVault Logo",className:"w-10 h-10 object-contain"}),s.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-white/20 to-transparent dark:from-white/5"})]}),s.jsxs("div",{className:"leading-tight",children:[s.jsx("p",{className:`text-xs uppercase tracking-[0.16em] ${e==="dark"?"text-gray-400":"text-gray-500"}`,children:"ApeVault Black Ops"}),s.jsx("p",{className:`text-xl font-extrabold ${e==="dark"?"text-white":"text-gray-900"}`,children:"Панель команды"})]})]}),s.jsxs("nav",{className:"hidden lg:flex items-center gap-2 flex-1 justify-center",children:[s.jsxs(Kt,{to:"/call","data-active":i.pathname==="/call",className:"nav-chip",children:[s.jsx(si,{className:"w-4 h-4"}),s.jsx("span",{children:"HUB"}),s.jsx(Et,{className:"w-4 h-4 opacity-70"})]}),s.jsxs("div",{className:"relative",children:[s.jsxs("button",{onClick:()=>{c(!o)},"data-active":v,className:"nav-chip",children:[s.jsx(bd,{className:"w-4 h-4"}),s.jsx("span",{children:"Функционал"}),s.jsx(md,{className:`w-4 h-4 transition-transform ${o?"rotate-180":""}`})]}),o&&s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"fixed inset-0 z-40",onClick:()=>c(!1)}),s.jsxs("div",{className:"absolute top-[calc(100%+12px)] left-0 min-w-[220px] glass-panel rounded-2xl border border-white/40 dark:border-white/10 shadow-2xl z-50 overflow-hidden",children:[s.jsx("div",{className:"accent-dots"}),s.jsx("div",{className:"relative z-10 divide-y divide-gray-100/60 dark:divide-white/5",children:p.map(T=>s.jsxs(Kt,{to:T.path,onClick:()=>c(!1),className:`flex items-center gap-3 px-4 py-3 transition-colors ${A(T.path)?"bg-gradient-to-r from-[#4E6E49]/15 to-[#4E6E49]/5 text-[#4E6E49] dark:from-[#4E6E49]/20 dark:text-[#4E6E49]":e==="dark"?"hover:bg-white/5 text-gray-200":"hover:bg-gray-50 text-gray-800"}`,children:[s.jsx(T.icon,{className:"w-4 h-4 flex-shrink-0"}),s.jsx("span",{className:"font-semibold flex-1",children:T.label}),s.jsx(Et,{className:"w-4 h-4 opacity-70"})]},T.path))})]})]})]}),s.jsxs(Kt,{to:"/about","data-active":i.pathname==="/about",className:"nav-chip",children:[s.jsx(ln,{className:"w-4 h-4"}),s.jsx("span",{children:"О нас"}),s.jsx(Et,{className:"w-4 h-4 opacity-70"})]}),s.jsxs(Kt,{to:"/profile","data-active":i.pathname==="/profile",className:"nav-chip",children:[s.jsx(cn,{className:"w-4 h-4"}),s.jsx("span",{children:"ЛК"}),s.jsx(Et,{className:"w-4 h-4 opacity-70"})]}),n&&s.jsxs(Kt,{to:"/admin","data-active":i.pathname==="/admin",className:"nav-chip",children:[s.jsx(Gt,{className:"w-4 h-4"}),s.jsx("span",{children:"Админ"}),s.jsx(Et,{className:"w-4 h-4 opacity-70"})]}),n&&s.jsxs(Kt,{to:"/approvals","data-active":i.pathname==="/approvals",className:"nav-chip",children:[s.jsx(Ds,{className:"w-4 h-4"}),s.jsx("span",{children:"Согласования"}),s.jsx(Et,{className:"w-4 h-4 opacity-70"})]})]}),s.jsxs("div",{className:"flex items-center gap-3 ml-auto relative",children:[s.jsxs("div",{className:"relative",children:[s.jsxs("button",{onClick:()=>h(T=>!T),className:"nav-chip px-3 py-2","data-active":d,"aria-label":"Notifications",children:[s.jsx(Np,{className:"w-5 h-5"}),g.length>0&&s.jsx("span",{className:"absolute -top-1 -right-1 inline-flex items-center justify-center px-1.5 py-0.5 text-[10px] font-bold rounded-full bg-red-500 text-white",children:g.length})]}),d&&s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"fixed inset-0 z-40",onClick:()=>h(!1)}),s.jsx("div",{className:"absolute right-0 mt-2 w-80 max-w-[88vw] glass-panel rounded-2xl border border-white/60 dark:border-white/10 shadow-2xl z-50 overflow-hidden",children:s.jsx("div",{className:"p-4 space-y-2 max-h-[360px] overflow-y-auto",children:g.length===0?s.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:"Новых уведомлений нет (храним до 6 часов)."}):g.map(T=>s.jsxs("div",{className:"rounded-xl border border-white/40 dark:border-white/10 bg-white/80 dark:bg-white/5 p-3 space-y-1",children:[s.jsx("div",{className:"text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400",children:T.time}),s.jsx("div",{className:"text-sm font-semibold text-gray-900 dark:text-white",children:T.text})]},T.id))})})]})]}),s.jsx("button",{onClick:t,className:"nav-chip px-3 py-2","data-active":"false","aria-label":"Toggle theme",children:e==="dark"?s.jsx(yh,{className:"w-5 h-5 text-amber-300"}):s.jsx(kl,{className:"w-5 h-5 text-gray-700"})})]})]})})}),s.jsx("main",{className:"page-shell",children:r}),s.jsx("nav",{className:"lg:hidden fixed bottom-4 left-0 right-0 px-3 z-50",children:s.jsx("div",{className:"max-w-5xl mx-auto",children:s.jsx("div",{className:"glass-panel rounded-2xl shadow-2xl border border-white/60 dark:border-white/10",children:s.jsxs("div",{className:"grid grid-cols-4 divide-x divide-white/40 dark:divide-white/5",children:[s.jsxs(Kt,{to:"/call",className:`flex flex-col items-center justify-center gap-1 py-3 ${i.pathname==="/call"?"text-[#4E6E49]":e==="dark"?"text-gray-300":"text-gray-700"}`,children:[s.jsx(si,{className:"w-5 h-5"}),s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx("span",{className:"text-[11px] font-semibold",children:"HUB"}),s.jsx(Et,{className:"w-3 h-3 opacity-70"})]})]}),s.jsxs("button",{onClick:()=>{c(!o)},className:`flex flex-col items-center justify-center gap-1 py-3 ${v?"text-[#4E6E49]":e==="dark"?"text-gray-300":"text-gray-700"}`,children:[s.jsx(bd,{className:"w-5 h-5"}),s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx("span",{className:"text-[11px] font-semibold",children:"Функционал"}),s.jsx(md,{className:"w-3 h-3 opacity-70"})]})]}),s.jsxs(Kt,{to:"/about",className:`flex flex-col items-center justify-center gap-1 py-3 ${i.pathname==="/about"?"text-[#4E6E49]":e==="dark"?"text-gray-300":"text-gray-700"}`,children:[s.jsx(ln,{className:"w-5 h-5"}),s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx("span",{className:"text-[11px] font-semibold",children:"О нас"}),s.jsx(Et,{className:"w-3 h-3 opacity-70"})]})]}),s.jsxs(Kt,{to:"/profile",className:`flex flex-col items-center justify-center gap-1 py-3 ${i.pathname==="/profile"?"text-[#4E6E49]":e==="dark"?"text-gray-300":"text-gray-700"}`,children:[s.jsx(cn,{className:"w-5 h-5"}),s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx("span",{className:"text-[11px] font-semibold",children:"ЛК"}),s.jsx(Et,{className:"w-3 h-3 opacity-70"})]})]})]})})})}),o&&s.jsx("div",{className:"lg:hidden fixed inset-0 z-40 bg-black/40 backdrop-blur-sm",onClick:()=>c(!1),children:s.jsxs("div",{className:"absolute bottom-24 left-1/2 -translate-x-1/2 w-[88%] max-w-sm glass-panel rounded-2xl shadow-2xl border border-white/50 dark:border-white/10 overflow-hidden",children:[s.jsx("div",{className:"accent-dots"}),s.jsx("div",{className:"relative z-10 divide-y divide-gray-100/60 dark:divide-white/5",children:p.map(T=>s.jsxs(Kt,{to:T.path,onClick:()=>c(!1),className:`flex items-center gap-3 px-4 py-3 transition-colors ${A(T.path)?"bg-gradient-to-r from-[#4E6E49]/15 to-[#4E6E49]/5 text-[#4E6E49] dark:from-[#4E6E49]/20 dark:text-[#4E6E49]":e==="dark"?"hover:bg-white/5 text-gray-200":"hover:bg-gray-50 text-gray-800"}`,children:[s.jsx(T.icon,{className:"w-4 h-4 flex-shrink-0"}),s.jsx("span",{className:"font-semibold flex-1",children:T.label}),s.jsx(Et,{className:"w-4 h-4 opacity-70"})]},T.path))})]})})]})},Qu=[{value:"solana",label:"Solana"},{value:"ethereum",label:"ETH"},{value:"bsc",label:"BSC"},{value:"ton",label:"TON"},{value:"base",label:"Base"},{value:"sui",label:"SUI"},{value:"monad",label:"Monad"},{value:"polygon",label:"Polygon"}],$_={memecoins:{label:"Мемкоины",gradient:"from-emerald-300 to-teal-400",icon:s.jsx(ya,{className:"w-5 h-5"}),pastelBg:"bg-emerald-50",pastelBorder:"border-emerald-100",pastelText:"text-emerald-800"},futures:{label:"Фьючерсы",gradient:"from-sky-300 to-indigo-400",icon:s.jsx(xa,{className:"w-5 h-5"}),pastelBg:"bg-sky-50",pastelBorder:"border-sky-100",pastelText:"text-sky-800"},nft:{label:"NFT",gradient:"from-purple-300 to-pink-300",icon:s.jsx(fa,{className:"w-5 h-5"}),pastelBg:"bg-purple-50",pastelBorder:"border-purple-100",pastelText:"text-purple-800"},spot:{label:"Спот",gradient:"from-amber-300 to-orange-300",icon:s.jsx(fr,{className:"w-5 h-5"}),pastelBg:"bg-amber-50",pastelBorder:"border-amber-100",pastelText:"text-amber-800"},polymarket:{label:"Polymarket",gradient:"from-rose-300 to-red-300",icon:s.jsx(ss,{className:"w-5 h-5"}),pastelBg:"bg-rose-50",pastelBorder:"border-rose-100",pastelText:"text-rose-800"},staking:{label:"Стейкинг",gradient:"from-cyan-300 to-blue-300",icon:s.jsx(Gt,{className:"w-5 h-5"}),pastelBg:"bg-cyan-50",pastelBorder:"border-cyan-100",pastelText:"text-cyan-800"}},O_={memecoins:[{key:"coinName",label:"Название монеты",placeholder:"PEPE"},{key:"ticker",label:"Тикер",placeholder:"PEPE"},{key:"network",label:"Сеть",type:"select",options:Qu},{key:"contract",label:"Контракт",placeholder:"0x..."},{key:"signalType",label:"Тип сигнала",type:"select",options:[{value:"buy",label:"Buy"},{value:"sell",label:"Sell"},{value:"hold",label:"Hold"},{value:"alert",label:"Alert"}]},{key:"reason",label:"Причина входа",placeholder:"Хайп, крупные покупки..."},{key:"entryCap",label:"Зона входа в капитализации",placeholder:"10M-15M"},{key:"targets",label:"Цели (TP1/TP2/TP3)",placeholder:"20M / 30M / 50M"},{key:"stopLoss",label:"Стоп-лосс (если применим)",placeholder:"5M или 15%"},{key:"riskLevel",label:"Риск-уровень",type:"select",options:[{value:"low",label:"Низкий"},{value:"medium",label:"Средний"},{value:"high",label:"Высокий"},{value:"ultra",label:"Ультра-высокий"}]},{key:"risks",label:"Риски",placeholder:"Разворот тренда, низкая ликвидность",type:"textarea"},{key:"holdPlan",label:"План удержания",type:"select",options:[{value:"flip",label:"Флип"},{value:"short",label:"Краткосрок"},{value:"medium",label:"Среднесрок"},{value:"long",label:"Дальнесрок"}]},{key:"liquidityLocked",label:"Залочена ли ликвидность",type:"checkbox"},{key:"traderComment",label:"Комментарий трейдера",type:"textarea",placeholder:"Доп. наблюдения, планы"}],futures:[{key:"pair",label:"Пара",placeholder:"BTC/USDT"},{key:"direction",label:"Направление",type:"select",options:[{value:"long",label:"Long"},{value:"short",label:"Short"}]},{key:"leverage",label:"Рекомендованное плечо",placeholder:"x3 - x10"},{key:"entryPrice",label:"Цена входа",placeholder:"69500"},{key:"entryZone",label:"Зоны входа (min-max)",placeholder:"69000 - 70000"},{key:"targets",label:"Цели (TP1/TP2/TP3)",placeholder:"71000 / 72500 / 74000"},{key:"stopLoss",label:"SL уровень",placeholder:"68000"},{key:"signalStyle",label:"Тип сигнала",type:"select",options:[{value:"breakout",label:"Breakout"},{value:"retest",label:"Retest"},{value:"range",label:"Range"},{value:"scalping",label:"Scalping"},{value:"swing",label:"Swing"}]},{key:"positionSize",label:"Размер позиции (% от депо)",placeholder:"2-5%"},{key:"reason",label:"Причина входа (анализ)",placeholder:"Тренд, объемы, дивергенция...",type:"textarea"},{key:"timeframe",label:"Таймфрейм анализа",type:"select",options:[{value:"1m",label:"1m"},{value:"5m",label:"5m"},{value:"15m",label:"15m"},{value:"1h",label:"1h"},{value:"4h",label:"4h"}]},{key:"risks",label:"Риски",placeholder:"Резкий вброс, низкая волатильность",type:"textarea"},{key:"riskLevel",label:"Риск-уровень",type:"select",options:[{value:"low",label:"Низкий"},{value:"medium",label:"Средний"},{value:"high",label:"Высокий"},{value:"ultra",label:"Ультра-высокий"}]}],nft:[{key:"collectionLink",label:"Коллекция (ссылка)",placeholder:"https://..."},{key:"nftLink",label:"NFT (ссылка)",placeholder:"https://.../item"},{key:"marketplace",label:"Маркетплейс",placeholder:"OpenSea / Magic Eden"},{key:"network",label:"Сеть",type:"select",options:Qu},{key:"entryPrice",label:"Рекомендованная цена входа",placeholder:"1.2 ETH"},{key:"rarity",label:"Редкость / атрибуты",placeholder:"Rank < 5% или редкий фон"},{key:"signalType",label:"Тип сигнала",type:"select",options:[{value:"buy",label:"Buy"},{value:"sell",label:"Sell"},{value:"mint",label:"Mint"}]},{key:"reason",label:"Причина входа",placeholder:"Новый минт, хайп, инсайд",type:"textarea"},{key:"holdingHorizon",label:"Срок удержания",type:"select",options:[{value:"flip",label:"Скоростной флип"},{value:"short",label:"Краткосрок"},{value:"medium",label:"Среднесрок"},{value:"long",label:"Долгосрок"}]},{key:"minLiquidity",label:"Минимальная ликвидность (floor + объём)",placeholder:"Floor 2 ETH, объём 120 ETH"},{key:"targetPrice",label:"Цель продажи / Target price",placeholder:"3 ETH"},{key:"traderComment",label:"Комментарий трейдера",type:"textarea",placeholder:"Что смотрим, когда фиксируем"},{key:"risks",label:"Риски",type:"textarea",placeholder:"Падение спроса, фальшивый объём"}],spot:[{key:"coin",label:"Монета",placeholder:"BTC"},{key:"entryCap",label:"Капитализация входа",placeholder:"500M"},{key:"targets",label:"Цели (TP1/TP2/TP3)",placeholder:"550M / 650M / 750M"},{key:"stopLoss",label:"SL",placeholder:"-10%"},{key:"holdingHorizon",label:"Горизонт удержания",type:"select",options:[{value:"short",label:"Краткосрок"},{value:"medium",label:"Среднесрок"},{value:"long",label:"Долгосрок"}]},{key:"reason",label:"Причина входа",placeholder:"Фундаментал, хайп, запуск",type:"textarea"},{key:"positionSize",label:"Размер позиции",placeholder:"5-10% портфеля"},{key:"risks",label:"Риски",placeholder:"Регуляторика, конкуренты",type:"textarea"},{key:"traderComment",label:"Комментарий",type:"textarea",placeholder:"Условия фиксации, обновления"},{key:"riskLevel",label:"Риск-уровень",type:"select",options:[{value:"low",label:"Низкий"},{value:"medium",label:"Средний"},{value:"high",label:"Высокий"},{value:"ultra",label:"Ультра-высокий"}]}],polymarket:[{key:"event",label:"Событие",placeholder:"Trump wins 2025"},{key:"positionType",label:"Тип позиции",type:"select",options:[{value:"yes",label:"Yes"},{value:"no",label:"No"}]},{key:"entryPrice",label:"Цена входа (%)",placeholder:"42%"},{key:"expectedProbability",label:"Ожидаемая вероятность (%)",placeholder:"65%"},{key:"reason",label:"Причина входа",placeholder:"Аналитика, инсайд, тренд новостей",type:"textarea"},{key:"eventDeadline",label:"Срок исхода события",placeholder:"31.12.2025"},{key:"riskLevel",label:"Риск",type:"select",options:[{value:"low",label:"Низкий"},{value:"medium",label:"Средний"},{value:"high",label:"Высокий"},{value:"ultra",label:"Ультра-высокий"}]},{key:"maxStake",label:"Максимальный объём ставки",placeholder:"до $5k"},{key:"risks",label:"Риски",placeholder:"Неопределённость новостей, низкая ликвидность",type:"textarea"},{key:"targetPlan",label:"Цель",placeholder:"Продажа до события или удержание"}],staking:[{key:"coin",label:"Монета",placeholder:"SOL"},{key:"platform",label:"Платформа",placeholder:"Jito, Lido..."},{key:"term",label:"Срок стейкинга",type:"select",options:[{value:"flexible",label:"Гибкий"},{value:"30d",label:"30 дней"},{value:"90d",label:"90 дней"},{value:"fixed",label:"Фиксированный"}]},{key:"apy",label:"APY",placeholder:"12-18%"},{key:"minDeposit",label:"Минимальный депозит",placeholder:"100 USDT"},{key:"protocolRisk",label:"Риски протокола",type:"select",options:[{value:"low",label:"Низкие"},{value:"medium",label:"Средние"},{value:"high",label:"Высокие"},{value:"ultra",label:"Ультра"}]},{key:"action",label:"Тип сигнала",type:"select",options:[{value:"enter",label:"Вход"},{value:"exit",label:"Выход"},{value:"rebalance",label:"Перераспределение"}]},{key:"reason",label:"Причина",placeholder:"Рост доходности, снижение рисков...",type:"textarea"},{key:"risks",label:"Риски",placeholder:"Смарт-контракт, ликвидность",type:"textarea"},{key:"traderComment",label:"Комментарий трейдера",type:"textarea",placeholder:"Тактика выхода, дополнительные условия"}]},Xu=()=>({memecoins:{coinName:"",ticker:"",network:"solana",contract:"",signalType:"buy",reason:"",entryCap:"",targets:"",stopLoss:"",riskLevel:"medium",risks:"",holdPlan:"short",liquidityLocked:!1,traderComment:""},futures:{pair:"",direction:"long",leverage:"",entryPrice:"",entryZone:"",targets:"",stopLoss:"",signalStyle:"breakout",positionSize:"",reason:"",timeframe:"1h",risks:"",riskLevel:"medium"},nft:{collectionLink:"",nftLink:"",marketplace:"",network:"ethereum",entryPrice:"",rarity:"",signalType:"buy",reason:"",holdingHorizon:"short",minLiquidity:"",targetPrice:"",traderComment:"",risks:""},spot:{coin:"",entryCap:"",targets:"",stopLoss:"",holdingHorizon:"medium",reason:"",positionSize:"",risks:"",traderComment:"",riskLevel:"medium"},polymarket:{event:"",positionType:"yes",entryPrice:"",expectedProbability:"",reason:"",eventDeadline:"",riskLevel:"medium",maxStake:"",risks:"",targetPlan:""},staking:{coin:"",platform:"",term:"flexible",apy:"",minDeposit:"",protocolRisk:"medium",action:"enter",reason:"",risks:"",traderComment:""}}),Ju=(r,e)=>({memecoins:{...r.memecoins,...(e==null?void 0:e.memecoins)||{}},futures:{...r.futures,...(e==null?void 0:e.futures)||{}},nft:{...r.nft,...(e==null?void 0:e.nft)||{}},spot:{...r.spot,...(e==null?void 0:e.spot)||{}},polymarket:{...r.polymarket,...(e==null?void 0:e.polymarket)||{}},staking:{...r.staking,...(e==null?void 0:e.staking)||{}}}),V_=({onSuccess:r,onCancel:e,callToEdit:t,initialCategory:n})=>{const{theme:a}=it(),{user:i}=jt(),[o,c]=D.useState(!1),[d,h]=D.useState(""),g=Ju(Xu(),t==null?void 0:t.details),[f,p]=D.useState((t==null?void 0:t.category)||n||"memecoins"),[v,A]=D.useState((t==null?void 0:t.comment)||""),[T,S]=D.useState(g);D.useEffect(()=>{const N=Ju(Xu(),t==null?void 0:t.details);S(N),p((t==null?void 0:t.category)||n||"memecoins"),A((t==null?void 0:t.comment)||"")},[t,n]);const z=a==="dark"?"text-white":"text-gray-900",L=a==="dark"?"border-gray-800":"border-gray-200",C=a==="dark"?"bg-gray-700/60":"bg-gray-50",j=a==="dark"?"text-gray-400":"text-gray-500",H=(N,E)=>{S(_=>({..._,[f]:{..._[f],[N]:E}}))},Y=N=>(N==null?void 0:N.riskLevel)||(N==null?void 0:N.protocolRisk)||void 0,I=N=>{if(N!=null&&N.signalType)return N.signalType;if((N==null?void 0:N.direction)==="long")return"buy";if((N==null?void 0:N.direction)==="short")return"sell"},y=async N=>{N.preventDefault(),h(""),c(!0);try{const E=T[f],_={...t==null?void 0:t.details,[f]:E},de={userId:(t==null?void 0:t.userId)||(i==null?void 0:i.id)||"unknown",category:f,details:_,createdAt:(t==null?void 0:t.createdAt)||new Date().toISOString(),status:(t==null?void 0:t.status)||"active",tags:(t==null?void 0:t.tags)||[]},M=v==null?void 0:v.trim();M&&(de.comment=M);const X=I(E);X&&(de.sentiment=X);const R=Y(E);R&&(de.riskLevel=R),(t==null?void 0:t.maxProfit)!==void 0&&(de.maxProfit=t.maxProfit),(t==null?void 0:t.currentPnL)!==void 0&&(de.currentPnL=t.currentPnL),(t==null?void 0:t.currentMarketCap)!==void 0&&(de.currentMarketCap=t.currentMarketCap),(t==null?void 0:t.signalMarketCap)!==void 0&&(de.signalMarketCap=t.signalMarketCap),(t==null?void 0:t.currentPrice)!==void 0&&(de.currentPrice=t.currentPrice),(t==null?void 0:t.entryPrice)!==void 0&&(de.entryPrice=t.entryPrice),t?await Kg(t.id,de):await _2(de),r==null||r()}catch(E){console.error("Error creating call:",E);const _=(E==null?void 0:E.message)||(E==null?void 0:E.code)||"Ошибка при сохранении сигнала";h(_)}finally{c(!1)}},w=N=>{var de;const _=(T[f]||{})[N.key],x=`w-full px-4 py-2 rounded-lg border ${L} ${C} ${z} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`;return N.type==="textarea"?s.jsx("textarea",{value:_||"",onChange:M=>H(N.key,M.target.value),className:`${x} min-h-[100px] resize-y`,placeholder:N.placeholder}):N.type==="select"&&N.options?s.jsx("select",{value:_||((de=N.options[0])==null?void 0:de.value)||"",onChange:M=>H(N.key,M.target.value),className:`${x} appearance-none`,children:N.options.map(M=>s.jsx("option",{value:M.value,children:M.label},M.value))}):N.type==="checkbox"?s.jsxs("label",{className:"inline-flex items-center gap-2 cursor-pointer select-none",children:[s.jsx("input",{type:"checkbox",checked:!!_,onChange:M=>H(N.key,M.target.checked),className:"accent-[#4E6E49] w-4 h-4"}),s.jsx("span",{className:z,children:N.label})]}):s.jsx("input",{type:"text",value:_||"",onChange:M=>H(N.key,M.target.value),className:x,placeholder:N.placeholder})};return s.jsxs("form",{onSubmit:y,className:"space-y-6",children:[d&&s.jsx("div",{className:`p-4 rounded-lg ${a==="dark"?"bg-red-900/30 border border-red-700 text-red-300":"bg-red-50 border border-red-200 text-red-800"}`,children:d}),s.jsxs("div",{className:`rounded-2xl border ${L} ${a==="dark"?"bg-gray-800/60":"bg-white"} p-4 sm:p-6 space-y-4`,children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("div",{className:"w-10 h-10 rounded-xl flex items-center justify-center text-white shadow-lg",style:{background:"linear-gradient(135deg, #4E6E49, #3b8d5a)"},children:s.jsx(Qt,{className:"w-5 h-5"})}),s.jsxs("div",{children:[s.jsx("p",{className:`text-lg font-bold ${z}`,children:$_[f].label}),s.jsx("p",{className:`text-xs ${j}`,children:"Добавьте любые детали по этому типу сигнала"})]})]}),s.jsx("div",{className:"grid grid-cols-1 gap-4",children:O_[f].map(N=>s.jsxs("div",{className:"space-y-2",children:[N.type!=="checkbox"&&s.jsxs("div",{className:"flex items-center justify-between gap-2",children:[s.jsx("label",{className:`text-sm font-semibold ${z}`,children:N.label}),N.helper&&s.jsx("span",{className:`text-[11px] ${j}`,children:N.helper})]}),w(N)]},N.key))})]}),s.jsxs("div",{children:[s.jsx("label",{className:`block text-sm font-medium ${z} mb-2`,children:"Общий комментарий или доп. заметки"}),s.jsx("textarea",{value:v,onChange:N=>A(N.target.value),className:`w-full px-4 py-3 rounded-lg border ${L} ${C} ${z} focus:outline-none focus:ring-2 focus:ring-[#4E6E49] min-h-[90px] resize-y`,placeholder:"Здесь можно оставить чеклист для апдейтов, условия выхода, алерты."})]}),s.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[s.jsx("button",{type:"submit",disabled:o,className:`flex-1 py-3 rounded-lg font-semibold transition-all shadow-md ${a==="dark"?"bg-gradient-to-r from-[#4E6E49] to-emerald-700 text-white hover:scale-[1.01] disabled:bg-gray-700":"bg-gradient-to-r from-[#4E6E49] to-emerald-600 text-white hover:shadow-lg disabled:bg-gray-300 disabled:text-gray-600"}`,children:o?"Сохраняем...":t?"Обновить сигнал":"Создать сигнал"}),e&&s.jsx("button",{type:"button",onClick:e,className:`px-6 py-3 rounded-lg font-semibold border ${L} ${a==="dark"?"text-white hover:bg-gray-800":"text-gray-800 hover:bg-gray-100"}`,children:"Отмена"})]})]})},Oi="modal-open";let Jn=0;const L_=()=>{typeof document>"u"||(Jn===0&&(document.body.classList.add(Oi),document.documentElement.classList.add(Oi)),Jn+=1)},F_=()=>{typeof document>"u"||(Jn=Math.max(Jn-1,0),Jn===0&&(document.body.classList.remove(Oi),document.documentElement.classList.remove(Oi)))},In=(r=!0)=>{D.useEffect(()=>{if(r)return L_(),()=>{F_()}},[r])},Fn={memecoins:{label:"Мемкоины",gradient:"from-emerald-400 to-teal-500",chip:"bg-emerald-500/10 text-emerald-600",icon:s.jsx(ya,{className:"w-4 h-4"})},futures:{label:"Фьючерсы",gradient:"from-blue-400 to-indigo-500",chip:"bg-blue-500/10 text-blue-600",icon:s.jsx(xa,{className:"w-4 h-4"})},nft:{label:"NFT",gradient:"from-purple-400 to-pink-500",chip:"bg-purple-500/10 text-purple-600",icon:s.jsx(fa,{className:"w-4 h-4"})},spot:{label:"Спот",gradient:"from-amber-400 to-orange-500",chip:"bg-amber-500/10 text-amber-600",icon:s.jsx(fr,{className:"w-4 h-4"})},polymarket:{label:"Polymarket",gradient:"from-rose-400 to-red-500",chip:"bg-rose-500/10 text-rose-600",icon:s.jsx(ss,{className:"w-4 h-4"})},staking:{label:"Стейкинг",gradient:"from-cyan-400 to-blue-500",chip:"bg-cyan-500/10 text-cyan-600",icon:s.jsx(Gt,{className:"w-4 h-4"})}},ti={all:{label:"Все",className:""},active:{label:"Активен",className:"bg-emerald-500/15 text-emerald-500 border border-emerald-500/20"},completed:{label:"Завершен",className:"bg-blue-500/15 text-blue-500 border border-blue-500/20"},cancelled:{label:"Отменен",className:"bg-red-500/15 text-red-500 border border-red-500/20"},reviewed:{label:"На рассмотрении",className:"bg-gray-500/15 text-gray-500 border border-gray-500/20"}},Zu={low:"bg-emerald-500/10 text-emerald-600 border border-emerald-500/20",medium:"bg-blue-500/10 text-blue-600 border border-blue-500/20",high:"bg-amber-500/10 text-amber-600 border border-amber-500/20",ultra:"bg-red-500/10 text-red-600 border border-red-500/20"},U_=()=>{const{theme:r}=it(),[e,t]=D.useState([]),[n,a]=D.useState(!0),[i,o]=D.useState(!1),[c,d]=D.useState(!1),[h,g]=D.useState(null),[f,p]=D.useState(null),[v,A]=D.useState(null),[T,S]=D.useState("memecoins"),[z,L]=D.useState(null),[C,j]=D.useState(""),[H,Y]=D.useState("all"),[I,y]=D.useState("all"),[w,N]=D.useState("all"),[E,_]=D.useState("all");In(i||c||!!f),D.useEffect(()=>{x()},[]);const x=async()=>{a(!0);try{const $=await N2();t($)}catch($){console.error("Error loading calls:",$),t([])}finally{a(!1)}},de=r==="dark"?"bg-[#121212]":"bg-white",M=r==="dark"?"text-white":"text-gray-900",X=r==="dark"?"text-gray-400":"text-gray-600",R=r==="dark"?"border-gray-800":"border-gray-200",ee={memecoins:{bg:r==="dark"?"bg-emerald-500/10":"bg-emerald-50",text:r==="dark"?"text-emerald-100":"text-emerald-800",border:r==="dark"?"border-emerald-500/30":"border-emerald-200",chipBg:r==="dark"?"bg-emerald-500/20":"bg-emerald-500/10"},futures:{bg:r==="dark"?"bg-sky-500/10":"bg-sky-50",text:r==="dark"?"text-sky-100":"text-sky-800",border:r==="dark"?"border-sky-500/30":"border-sky-200",chipBg:r==="dark"?"bg-sky-500/20":"bg-sky-500/10"},nft:{bg:r==="dark"?"bg-purple-500/10":"bg-purple-50",text:r==="dark"?"text-purple-100":"text-purple-800",border:r==="dark"?"border-purple-500/30":"border-purple-200",chipBg:r==="dark"?"bg-purple-500/20":"bg-purple-500/10"},spot:{bg:r==="dark"?"bg-amber-500/10":"bg-amber-50",text:r==="dark"?"text-amber-100":"text-amber-800",border:r==="dark"?"border-amber-500/30":"border-amber-200",chipBg:r==="dark"?"bg-amber-500/20":"bg-amber-500/10"},polymarket:{bg:r==="dark"?"bg-rose-500/10":"bg-rose-50",text:r==="dark"?"text-rose-100":"text-rose-800",border:r==="dark"?"border-rose-500/30":"border-rose-200",chipBg:r==="dark"?"bg-rose-500/20":"bg-rose-500/10"},staking:{bg:r==="dark"?"bg-cyan-500/10":"bg-cyan-50",text:r==="dark"?"text-cyan-100":"text-cyan-800",border:r==="dark"?"border-cyan-500/30":"border-cyan-200",chipBg:r==="dark"?"bg-cyan-500/20":"bg-cyan-500/10"}},J=()=>{o(!1),A(null),x()},ae=()=>{o(!1),A(null)},U=$=>{A($),S($.category),o(!0)},F=$=>{g($),d(!0)},V=async()=>{if(h)try{await j2(h),d(!1),g(null),x()}catch($){console.error("Error deleting call:",$),alert("Ошибка при удалении сигнала")}},te=async()=>{if(f)try{await Kg(f,{status:"cancelled"}),p(null),x()}catch($){console.error("Error cancelling call:",$),alert("Ошибка при отмене сигнала")}},me=async $=>{try{await navigator.clipboard.writeText($),L($),setTimeout(()=>L(null),1800)}catch(k){console.error("Failed to copy:",k)}},xe=$=>{var k;return((k=$.details)==null?void 0:k[$.category])||{}},ue=$=>{const k=xe($);switch($.category){case"memecoins":return k.coinName||k.ticker||"Мемкоин";case"futures":return k.pair||"Фьючерс";case"nft":return k.collectionLink||"NFT коллекция";case"spot":return k.coin||"Спот";case"polymarket":return k.event||"Polymarket событие";case"staking":return k.coin||"Стейкинг";default:return"Сигнал"}},O=$=>{const k=xe($);switch($.category){case"memecoins":return`${k.ticker||""} ${k.network?`• ${String(k.network).toUpperCase()}`:""}`.trim();case"futures":return`${k.direction==="long"?"Long":"Short"} • ${k.timeframe||""}`;case"nft":return`${k.marketplace||""}${k.network?` • ${String(k.network).toUpperCase()}`:""}`;case"spot":return k.holdingHorizon?`Горизонт: ${k.holdingHorizon}`:"";case"polymarket":return`${k.positionType==="yes"?"YES":"NO"} • ${k.entryPrice||""}`;case"staking":return`${k.platform||""}${k.term?` • ${k.term}`:""}`;default:return""}},W=$=>$.riskLevel||xe($).riskLevel||xe($).protocolRisk||"medium",ie=$=>{const k=xe($);return[$.category,$.status,$.comment,k.coinName,k.ticker,k.pair,k.reason,k.targets,k.event,k.marketplace,k.platform,k.entryCap,k.entryZone,k.network].filter(Boolean).join(" ").toLowerCase()},P=e.filter($=>H!=="all"&&$.status!==H||I!=="all"&&$.category!==I||w!=="all"&&W($)!==w||E!=="all"&&$.userId!==E?!1:C.trim()?ie($).includes(C.toLowerCase()):!0),oe=D.useMemo(()=>e.reduce(($,k)=>($[k.category]||($[k.category]={total:0,active:0}),$[k.category].total+=1,k.status==="active"&&($[k.category].active+=1),$),{memecoins:{total:0,active:0},futures:{total:0,active:0},nft:{total:0,active:0},spot:{total:0,active:0},polymarket:{total:0,active:0},staking:{total:0,active:0}}),[e]),je=D.useMemo(()=>({total:e.length,active:e.filter($=>$.status==="active").length,completed:e.filter($=>$.status==="completed").length,highRisk:e.filter($=>W($)==="high"||W($)==="ultra").length}),[e]),K=r==="dark"?"bg-gray-800 text-gray-200 border border-gray-700":"bg-white text-gray-700 border border-gray-200",ge="bg-gradient-to-r from-emerald-400 to-teal-500 text-white shadow-md shadow-emerald-300/30",pe=($,k,ye)=>s.jsxs("div",{className:`p-4 rounded-xl border ${R} ${r==="dark"?"bg-gray-800/70":"bg-gray-50"}`,children:[s.jsx("p",{className:`text-xs uppercase tracking-wider ${X}`,children:$}),s.jsx("p",{className:`text-2xl font-bold ${ye}`,children:k})]}),Ce={low:"Низкий",medium:"Средний",high:"Высокий",ultra:"Ультра"},ze={flip:"Flip",short:"Короткий",medium:"Средний",long:"Длинный"},Qe={flexible:"Гибкий","30d":"30 дней","90d":"90 дней",fixed:"Фикс."},q={enter:"Вход",exit:"Выход",rebalance:"Ребаланс"},ne={yes:"YES",no:"NO"},Te=($,k=28)=>{if(!$)return"";if($.length<=k)return $;const ye=$.slice(0,Math.floor(k/2)),_e=$.slice(-6);return`${ye}...${_e}`},Z=$=>$?$.includes("%")?$:`${$}%`:"",$e=$=>{if(!$)return"";const k=new Date($);if(Number.isNaN(k.getTime()))return $;const ye=new Date,_e=k.getTime()-ye.getTime(),Ie=k.toLocaleString("ru-RU",{day:"2-digit",month:"short",hour:"2-digit",minute:"2-digit"});if(_e<=0)return`${Ie} (истек)`;const re=Math.max(0,Math.floor(_e/(1e3*60))),ve=Math.floor(re/(60*24)),we=Math.floor(re%(60*24)/60),Ae=re%60,ot=[ve>0?`${ve}д`:null,we>0?`${we}ч`:null,Ae>0?`${Ae}м`:null].filter(Boolean).slice(0,2).join(" ");return`${Ie} (через ${ot||"минуты"})`},Fe=$=>{const k=xe($),ye=W($),_e=ee[$.category],Ie=[],re=(we,Ae,ot,ft)=>{Ae&&Ie.push({label:we,value:Ae,icon:ot,copyValue:ft??Ae})};switch($.category){case"memecoins":re("Монета",k.coinName,s.jsx(fr,{className:"w-4 h-4"})),re("Тикер",k.ticker,s.jsx(Mp,{className:"w-4 h-4"}),k.ticker),re("Сеть",k.network?String(k.network).toUpperCase():"",s.jsx(Pp,{className:"w-4 h-4"})),re("Контракт",Te(k.contract),s.jsx(Cp,{className:"w-4 h-4"}),k.contract),re("Тип сигнала",k.signalType?k.signalType.toUpperCase():"",s.jsx(Ao,{className:"w-4 h-4"})),re("Зона входа",k.entryCap,s.jsx(za,{className:"w-4 h-4"})),re("Цели",k.targets,s.jsx(ss,{className:"w-4 h-4"})),re("SL",k.stopLoss,s.jsx(To,{className:"w-4 h-4"})),re("План",ze[k.holdPlan]||k.holdPlan,s.jsx(Hn,{className:"w-4 h-4"})),re("Ликвидность",k.liquidityLocked?"Залочена":"",s.jsx(Gt,{className:"w-4 h-4"})),re("Риск",Ce[ye]||ye,s.jsx($n,{className:"w-4 h-4"})),re("Риски",k.risks,s.jsx(Pr,{className:"w-4 h-4"})),re("Комментарий",k.traderComment,s.jsx(Ys,{className:"w-4 h-4"})),re("Причина входа",k.reason,s.jsx(rs,{className:"w-4 h-4"}));break;case"futures":re("Пара",k.pair,s.jsx(gh,{className:"w-4 h-4"}),k.pair),re("Направление",k.direction?k.direction.toUpperCase():"",s.jsx(Ms,{className:"w-4 h-4"})),re("Плечо",k.leverage,s.jsx(ri,{className:"w-4 h-4"})),re("Зона входа",k.entryZone||k.entryPrice,s.jsx(za,{className:"w-4 h-4"})),re("Цели",k.targets,s.jsx(ss,{className:"w-4 h-4"})),re("SL",k.stopLoss,s.jsx(To,{className:"w-4 h-4"})),re("Стиль",k.signalStyle,s.jsx(Ao,{className:"w-4 h-4"})),re("Размер позиции",k.positionSize,s.jsx(Ha,{className:"w-4 h-4"})),re("Таймфрейм",k.timeframe,s.jsx(bh,{className:"w-4 h-4"})),re("Риск",Ce[ye]||ye,s.jsx($n,{className:"w-4 h-4"})),re("Риски",k.risks,s.jsx(Pr,{className:"w-4 h-4"})),re("Причина входа",k.reason,s.jsx(rs,{className:"w-4 h-4"}));break;case"nft":re("Коллекция",Te(k.collectionLink),s.jsx(pd,{className:"w-4 h-4"}),k.collectionLink),re("NFT",Te(k.nftLink),s.jsx(pd,{className:"w-4 h-4"}),k.nftLink),re("Маркетплейс",k.marketplace,s.jsx(hd,{className:"w-4 h-4"})),re("Сеть",k.network?String(k.network).toUpperCase():"",s.jsx(Hp,{className:"w-4 h-4"})),re("Вход",k.entryPrice,s.jsx(za,{className:"w-4 h-4"})),re("Редкость",k.rarity,s.jsx(Qt,{className:"w-4 h-4"})),re("Тип сигнала",k.signalType?k.signalType.toUpperCase():"",s.jsx(Ao,{className:"w-4 h-4"})),re("Срок удержания",ze[k.holdingHorizon]||k.holdingHorizon,s.jsx(Hn,{className:"w-4 h-4"})),re("Мин. ликвидность",k.minLiquidity,s.jsx(ri,{className:"w-4 h-4"})),re("Target",k.targetPrice,s.jsx(ss,{className:"w-4 h-4"})),re("Риски",k.risks,s.jsx(Pr,{className:"w-4 h-4"})),re("Комментарий",k.traderComment,s.jsx(Ys,{className:"w-4 h-4"})),re("Причина входа",k.reason,s.jsx(rs,{className:"w-4 h-4"}));break;case"spot":re("Монета",k.coin,s.jsx(fr,{className:"w-4 h-4"})),re("Зона входа",k.entryCap,s.jsx(za,{className:"w-4 h-4"})),re("Цели",k.targets,s.jsx(ss,{className:"w-4 h-4"})),re("SL",k.stopLoss,s.jsx(To,{className:"w-4 h-4"})),re("Горизонт",ze[k.holdingHorizon]||k.holdingHorizon,s.jsx(Hn,{className:"w-4 h-4"})),re("Размер",k.positionSize,s.jsx(Ha,{className:"w-4 h-4"})),re("Риск",k.riskLevel?Ce[k.riskLevel]:void 0,s.jsx($n,{className:"w-4 h-4"})),re("Риски",k.risks,s.jsx(Pr,{className:"w-4 h-4"})),re("Комментарий",k.traderComment,s.jsx(Ys,{className:"w-4 h-4"})),re("Причина входа",k.reason,s.jsx(rs,{className:"w-4 h-4"}));break;case"polymarket":const we=k.positionType;re("Событие",k.event,s.jsx(rs,{className:"w-4 h-4"})),re("Тип",we?ne[we]:"",s.jsx(Gt,{className:"w-4 h-4"})),re("Вход %",Z(k.entryPrice),s.jsx(Ha,{className:"w-4 h-4"})),re("Ожидание %",Z(k.expectedProbability),s.jsx(ri,{className:"w-4 h-4"})),re("Цель",k.targetPlan,s.jsx(ss,{className:"w-4 h-4"})),re("Макс ставка",k.maxStake,s.jsx(fr,{className:"w-4 h-4"})),re("Срок исхода",$e(k.eventDeadline),s.jsx(Go,{className:"w-4 h-4"})),re("Риск",Ce[ye]||ye,s.jsx($n,{className:"w-4 h-4"})),re("Риски",k.risks,s.jsx(Pr,{className:"w-4 h-4"})),re("Комментарий",k.traderComment,s.jsx(Ys,{className:"w-4 h-4"})),re("Причина входа",k.reason,s.jsx(rs,{className:"w-4 h-4"}));break;case"staking":re("Монета",k.coin,s.jsx(fr,{className:"w-4 h-4"})),re("Платформа",k.platform,s.jsx(hd,{className:"w-4 h-4"})),re("Срок",Qe[k.term]||k.term,s.jsx(Go,{className:"w-4 h-4"})),re("APY",Z(k.apy),s.jsx(Ha,{className:"w-4 h-4"})),re("Мин. депозит",k.minDeposit,s.jsx(fr,{className:"w-4 h-4"})),re("Тип сигнала",q[k.action]||k.action,s.jsx(Gt,{className:"w-4 h-4"})),re("Риск протокола",k.protocolRisk?Ce[k.protocolRisk]:void 0,s.jsx($n,{className:"w-4 h-4"})),re("Риски",k.risks,s.jsx(Pr,{className:"w-4 h-4"})),re("Комментарий",k.traderComment,s.jsx(Ys,{className:"w-4 h-4"})),re("Причина входа",k.reason,s.jsx(rs,{className:"w-4 h-4"}));break}const ve=Ie.filter(we=>we.value);return ve.length?s.jsxs("div",{className:`rounded-2xl border ${R} ${r==="dark"?"bg-gray-900/60":"bg-white"}`,children:[s.jsxs("div",{className:`flex items-center gap-2 px-4 py-3 border-b ${R} ${r==="dark"?"bg-white/5":"bg-gray-50"}`,children:[s.jsx(Qt,{className:"w-4 h-4 text-amber-500"}),s.jsx("p",{className:`text-sm font-semibold ${M}`,children:"Ключевые метрики"}),s.jsxs("span",{className:`ml-auto text-[11px] font-semibold px-3 py-1 rounded-full ${Zu[ye]}`,children:["Риск: ",Ce[ye]||ye]})]}),s.jsx("div",{className:"divide-y divide-gray-200/70 dark:divide-white/10",children:ve.map(we=>s.jsxs("div",{className:"flex items-center justify-between gap-3 px-4 py-3",children:[s.jsxs("div",{className:"flex items-start gap-3",children:[s.jsx("div",{className:`p-2 rounded-xl border ${_e.border} ${_e.bg} ${_e.text}`,children:we.icon}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsx("p",{className:`text-xs uppercase tracking-wide ${X}`,children:we.label}),s.jsx("p",{className:`${M} font-semibold whitespace-pre-wrap break-words`,children:we.value})]})]}),we.copyValue&&s.jsxs("button",{onClick:()=>me(we.copyValue),className:`px-3 py-2 rounded-lg border ${R} ${r==="dark"?"hover:bg-gray-800 bg-white/5":"hover:bg-gray-100 bg-white"} text-xs font-semibold flex items-center gap-2 shrink-0`,children:[z===we.copyValue?s.jsx(Rs,{className:"w-4 h-4 text-emerald-500"}):s.jsx(gi,{className:"w-4 h-4"}),z===we.copyValue?"Скопировано":"Копировать"]})]},we.label))})]}):null};return s.jsx(dr,{children:s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:`relative overflow-hidden rounded-2xl p-6 sm:p-7 md:p-8 border-2 shadow-2xl ${r==="dark"?"bg-gradient-to-br from-[#151c2a] via-[#0f1623] to-[#0a101b] border-[#4E6E49]/35":"bg-gradient-to-br from-white via-emerald-50/25 to-white border-emerald-200"}`,children:[s.jsxs("div",{className:"absolute inset-0 pointer-events-none",children:[s.jsx("div",{className:"absolute -top-24 -left-16 w-64 h-64 bg-gradient-to-br from-[#4E6E49]/18 via-transparent to-transparent blur-3xl"}),s.jsx("div",{className:"absolute top-0 right-0 w-72 h-72 bg-gradient-to-bl from-sky-400/14 via-emerald-400/12 to-transparent blur-3xl"}),s.jsx("div",{className:"absolute bottom-[-120px] left-12 w-64 h-64 bg-gradient-to-tr from-amber-300/14 via-[#4E6E49]/12 to-transparent blur-3xl"})]}),s.jsxs("div",{className:"relative z-10 flex flex-col gap-4 lg:flex-row lg:items-center lg:justify-between",children:[s.jsx("div",{className:"space-y-3",children:s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"p-3 rounded-2xl bg-gradient-to-br from-[#4E6E49] via-emerald-500 to-sky-500 text-white shadow-lg shadow-emerald-500/30",children:s.jsx(si,{className:"w-6 h-6"})}),s.jsx("div",{className:"flex flex-col justify-center",children:s.jsx("h1",{className:"text-2xl sm:text-3xl font-extrabold text-white drop-shadow-lg leading-tight",children:"Signals HUB"})})]})}),s.jsx("div",{className:"flex flex-wrap items-center gap-3"})]})]}),s.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-3 gap-4",children:Object.keys(Fn).map($=>{const k=Fn[$],ye=oe[$],_e=ee[$];return s.jsxs("button",{onClick:()=>{S($),A(null),o(!0)},className:`p-4 rounded-xl border ${_e.border} ${_e.bg} text-left shadow-sm hover:shadow-lg transition-all hover:-translate-y-0.5 space-y-2`,children:[s.jsxs("div",{className:"flex items-start justify-between gap-3",children:[s.jsxs("div",{className:`flex items-center gap-2 px-3 py-1 rounded-full text-[11px] font-semibold border border-transparent ${_e.text}`,children:[k.icon,s.jsx("span",{children:k.label})]}),s.jsx("span",{className:`px-3 py-1 rounded-full text-[11px] font-semibold border ${_e.border} ${_e.text} ${r==="dark"?"bg-white/5":"bg-white/80"}`,children:"Добавить"})]}),s.jsxs("div",{children:[s.jsx("p",{className:`text-2xl font-extrabold ${M}`,children:(ye==null?void 0:ye.total)||0}),s.jsxs("p",{className:`text-xs ${X}`,children:["Всего сигналов • Активных ",(ye==null?void 0:ye.active)||0]})]})]},$)})}),s.jsx("div",{className:`rounded-2xl border ${R} ${r==="dark"?"bg-gray-900/70":"bg-white"} p-5 space-y-4`,children:s.jsxs("div",{className:"flex flex-col gap-3",children:[s.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[s.jsxs("div",{className:"flex items-center gap-2 text-sm font-semibold",children:[s.jsx(fh,{className:`w-4 h-4 ${X}`}),s.jsx("span",{className:M,children:"Фильтры"})]}),s.jsx("div",{className:"flex flex-wrap gap-2",children:Object.keys(ti).map($=>s.jsx("button",{onClick:()=>Y($),className:`px-3 py-1.5 rounded-xl text-sm font-semibold transition-all ${H===$?ge:K}`,children:ti[$].label},$))})]}),s.jsxs("div",{className:"flex flex-col gap-2",children:[s.jsxs("label",{className:`text-xs uppercase tracking-wider ${X} flex items-center gap-2`,children:[s.jsx(Zp,{className:"w-4 h-4"}),"Поиск по всем сферам ",s.jsxs("span",{className:"text-[11px] text-gray-500 dark:text-gray-400",children:[P.length,"/",e.length]})]}),s.jsx("input",{value:C,onChange:$=>j($.target.value),placeholder:"тикер, событие, сеть, причина...",className:`w-full px-3 py-2 rounded-xl border ${R} ${r==="dark"?"bg-gray-800":"bg-gray-50"} ${M} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]/60`})]}),s.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[s.jsx("span",{className:`text-xs ${X} uppercase tracking-wider`,children:"Сфера:"}),s.jsx("button",{onClick:()=>y("all"),className:`px-3 py-1.5 rounded-full text-sm font-semibold border ${I==="all"?ge:K}`,children:"Все"}),Object.keys(Fn).map($=>s.jsx("button",{onClick:()=>y(I===$?"all":$),className:`px-3 py-1.5 rounded-full text-sm font-semibold border ${I===$?ge:K}`,children:Fn[$].label},$))]}),s.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[s.jsx("span",{className:`text-xs ${X} uppercase tracking-wider`,children:"Риск:"}),["all","low","medium","high","ultra"].map($=>s.jsx("button",{onClick:()=>N($),className:`px-3 py-1.5 rounded-full text-sm font-semibold border ${w===$?ge:K}`,children:$==="all"?"Все":$},$))]}),s.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[s.jsx("span",{className:`text-xs ${X} uppercase tracking-wider`,children:"Трейдер:"}),s.jsxs("select",{value:E,onChange:$=>_($.target.value),className:`px-3 py-2 rounded-lg border ${R} ${r==="dark"?"bg-gray-800 text-white":"bg-gray-50 text-gray-900"} text-sm focus:outline-none focus:ring-2 focus:ring-emerald-500/50`,children:[s.jsx("option",{value:"all",children:"Все трейдеры"}),Se.map($=>s.jsx("option",{value:$.id,children:$.name},$.id))]})]}),s.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:[pe("Всего сигналов",je.total,M),pe("Активных",je.active,"text-emerald-500"),pe("Завершено",je.completed,"text-blue-500"),pe("High risk",je.highRisk,"text-amber-500")]})]})}),i&&s.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-[70] flex items-start sm:items-center justify-center p-4 overflow-y-auto",children:s.jsx("div",{className:`${de} rounded-2xl shadow-2xl border ${R} max-w-3xl w-full max-h-[90vh] overflow-hidden`,children:s.jsxs("div",{className:"flex flex-col h-full",children:[s.jsxs("div",{className:`p-6 flex items-center justify-between sticky top-0 z-20 ${de} border-b ${R} shadow-sm`,children:[s.jsx("h2",{className:`text-2xl font-bold ${M}`,children:v?"Редактировать сигнал":"Создать сигнал"}),s.jsx("button",{onClick:ae,className:`p-2 rounded-xl ${r==="dark"?"hover:bg-gray-800":"hover:bg-gray-100"}`,children:s.jsx(Zt,{className:`w-5 h-5 ${X}`})})]}),s.jsx("div",{className:"px-6 pb-6 pt-2 overflow-y-auto flex-1 max-h-[75vh]",children:s.jsx(V_,{callToEdit:v,onSuccess:J,onCancel:ae,initialCategory:T})})]})})}),c&&s.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-[70] flex items-start sm:items-center justify-center p-4 overflow-y-auto overscroll-contain",children:s.jsx("div",{className:`${de} rounded-2xl shadow-2xl border ${R} max-w-md w-full`,children:s.jsxs("div",{className:"p-6 space-y-4",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx(Pr,{className:"w-6 h-6 text-red-500"}),s.jsxs("div",{children:[s.jsx("h3",{className:`text-xl font-bold ${M}`,children:"Удалить сигнал?"}),s.jsx("p",{className:X,children:"Это действие нельзя отменить"})]})]}),s.jsxs("div",{className:"flex gap-3",children:[s.jsx("button",{onClick:()=>{d(!1),g(null)},className:`flex-1 px-4 py-3 rounded-xl border ${R} ${r==="dark"?"text-white":"text-gray-800"}`,children:"Отмена"}),s.jsx("button",{onClick:V,className:"flex-1 px-4 py-3 rounded-xl bg-red-600 text-white font-semibold hover:bg-red-700",children:"Удалить"})]})]})})}),f&&s.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-[70] flex items-start sm:items-center justify-center p-4 overflow-y-auto overscroll-contain",children:s.jsx("div",{className:`${de} rounded-2xl shadow-2xl border ${R} max-w-md w-full`,children:s.jsxs("div",{className:"p-6 space-y-4",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx(Pr,{className:"w-6 h-6 text-amber-500"}),s.jsxs("div",{children:[s.jsx("h3",{className:`text-xl font-bold ${M}`,children:"Отменить сигнал?"}),s.jsx("p",{className:X,children:"Статус станет «Отменен», запись останется в списке."})]})]}),s.jsxs("div",{className:"flex gap-3",children:[s.jsx("button",{onClick:()=>p(null),className:`flex-1 px-4 py-3 rounded-xl border ${R} ${r==="dark"?"text-white":"text-gray-800"}`,children:"Отмена"}),s.jsx("button",{onClick:te,className:"flex-1 px-4 py-3 rounded-xl bg-amber-500 text-white font-semibold hover:bg-amber-600",children:"Отменить"})]})]})})}),!i&&s.jsx(s.Fragment,{children:n?s.jsxs("div",{className:`${de} rounded-2xl p-12 text-center ${R} border shadow-xl`,children:[s.jsx("div",{className:"animate-spin rounded-full h-14 w-14 border-4 border-[#4E6E49] border-t-transparent mx-auto mb-4"}),s.jsx("p",{className:`${X} text-lg`,children:"Загрузка сигналов..."})]}):e.length===0?s.jsxs("div",{className:`${de} rounded-2xl p-12 text-center ${R} border shadow-xl`,children:[s.jsx(Qt,{className:`w-16 h-16 mx-auto mb-4 ${X}`}),s.jsx("p",{className:`text-xl font-bold ${M}`,children:"Пока пусто"}),s.jsx("p",{className:X,children:"Создайте первый сигнал в новой структуре"})]}):P.length===0?s.jsxs("div",{className:`${de} rounded-2xl p-12 text-center ${R} border shadow-xl`,children:[s.jsx(Qt,{className:`w-16 h-16 mx-auto mb-4 ${X}`}),s.jsx("p",{className:`text-xl font-bold ${M}`,children:"Нет совпадений"}),s.jsxs("p",{className:X,children:["Сигналы есть (",e.length,"), но фильтр ничего не нашел."]})]}):s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-5",children:P.map($=>{const k=Fn[$.category],ye=ti[$.status]||ti.active,_e=W($),Ie=xe($),re=Se.find(ot=>ot.id===$.userId),ve=Ie.ticker||Ie.pair||Ie.coin||ue($),we=new Date($.createdAt).toLocaleDateString("ru-RU",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"}),Ae=ee[$.category];return s.jsxs("div",{className:`rounded-3xl border-2 shadow-xl overflow-hidden transition-all hover:-translate-y-1 ${Ae.border} ${Ae.bg}`,children:[s.jsxs("div",{className:`px-5 py-4 flex flex-wrap items-center justify-between gap-3 border-b ${r==="dark"?"border-white/10 bg-white/5":"border-white/70 bg-white/70"}`,children:[s.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[s.jsxs("span",{className:`flex items-center gap-2 px-3 py-1.5 rounded-full text-sm font-semibold border ${Ae.border} ${Ae.chipBg||""} ${Ae.text}`,children:[k.icon,k.label]}),s.jsx("span",{className:`px-3 py-1.5 rounded-full text-xs font-semibold ${ye.className}`,children:ye.label}),s.jsxs("span",{className:`px-3 py-1.5 rounded-full text-xs font-semibold ${Zu[_e]}`,children:["Риск: ",_e]})]}),s.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[s.jsxs("div",{className:`px-3 py-1.5 rounded-xl text-xs font-semibold border ${r==="dark"?"bg-gray-800/70 text-gray-200 border-white/10":"bg-white text-gray-700 border-gray-200"}`,children:[s.jsx("span",{className:"opacity-70",children:"Создано "}),we]}),re&&s.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 rounded-xl border border-white/10 bg-black/5 dark:bg-white/5",children:[s.jsx("div",{className:"w-8 h-8 rounded-full bg-gradient-to-r from-[#4E6E49] to-emerald-600 text-white flex items-center justify-center text-sm font-bold",children:re.name[0]}),s.jsx("span",{className:`text-xs ${X}`,children:re.name})]}),s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx("button",{onClick:()=>U($),className:`p-2 rounded-lg ${r==="dark"?"hover:bg-gray-800":"hover:bg-gray-100"}`,children:s.jsx(rr,{className:"w-4 h-4"})}),$.status!=="cancelled"&&s.jsx("button",{onClick:()=>p($.id),className:`p-2 rounded-lg ${r==="dark"?"hover:bg-gray-800":"hover:bg-gray-100"}`,children:s.jsx(Zt,{className:"w-4 h-4 text-amber-500"})}),s.jsx("button",{onClick:()=>F($.id),className:`p-2 rounded-lg ${r==="dark"?"hover:bg-gray-800":"hover:bg-gray-100"}`,children:s.jsx($t,{className:"w-4 h-4 text-red-500"})})]})]})]}),s.jsxs("div",{className:"p-5 space-y-5",children:[s.jsxs("div",{className:"grid md:grid-cols-[1.15fr_auto] gap-4 items-start",children:[s.jsxs("div",{className:"space-y-1",children:[s.jsx("p",{className:`text-2xl font-bold ${M}`,children:ue($)}),s.jsx("p",{className:`text-sm ${X}`,children:O($)})]}),s.jsx("div",{className:"flex flex-wrap gap-2 justify-end",children:s.jsxs("button",{onClick:()=>me(ve),className:`px-3 py-2 rounded-xl border ${R} ${r==="dark"?"hover:bg-gray-800 bg-white/5":"hover:bg-gray-100 bg-white"} text-sm font-semibold flex items-center gap-2`,children:[z===ve?s.jsx(Rs,{className:"w-4 h-4 text-emerald-500"}):s.jsx(gi,{className:"w-4 h-4"}),z===ve?"Скопировано":"Скопировать"]})})]}),Fe($)]})]},$.id)})})})]})})},B_=({selectedUserId:r,slotFilter:e,onEditSlot:t,onEditStatus:n,refreshKey:a})=>{const{theme:i}=it(),{user:o}=jt(),{isAdmin:c}=At(),[d,h]=D.useState([]),[g,f]=D.useState([]),[p,v]=D.useState(new Date),[A,T]=D.useState(!0),S=ce(new Date,"yyyy-MM-dd"),z={1:"Dex",2:"Enowk",3:"Xenia",4:"Olenka",5:"Sydney"},L={artyom:"1",adel:"2",kseniya:"3",olga:"4",anastasia:"5"},C=R=>{const ee=Se.find(J=>J.id===R)||Se.find(J=>L[R]===J.id);return z[(ee==null?void 0:ee.id)||R]||(ee==null?void 0:ee.name)||R},j=_c(p),H=r?Se.filter(R=>R.id===r):Se;D.useEffect(()=>{Y()},[r,p,a]),D.useEffect(()=>{const R=()=>{Y()};return window.addEventListener("focus",R),()=>window.removeEventListener("focus",R)},[]);const Y=async()=>{T(!0);try{const R=new Date(j[0]);R.setHours(0,0,0,0);const ee=new Date(j[6]);ee.setHours(23,59,59,999);const J=ce(R,"yyyy-MM-dd"),ae=ce(ee,"yyyy-MM-dd"),[U,F]=await Promise.all([Kr(),br()]),V=U.filter(ue=>ue.date>=J&&ue.date<=ae),te=F.filter(ue=>{const O=ue.date,W=ue.endDate||ue.date;return O<=ae&&W>=J}),me=r?V.filter(ue=>ue.userId===r):V,xe=r?te.filter(ue=>ue.userId===r):te;console.log("Loaded slots:",{weekStart:J,weekEnd:ae,allSlotsCount:U.length,weekSlotsCount:V.length,filteredSlotsCount:me.length,selectedUserId:r}),h(me),f(xe)}catch(R){console.error("Error loading data:",R)}finally{T(!1)}},I=async R=>{if(!c&&(o==null?void 0:o.id)!==R.userId){alert("Только администратор может удалять чужие слоты");return}if(c){confirm("Удалить слот?")&&(await oo(R.id),Y());return}confirm("Отправить на согласование удаление слота?")&&(await kt({entity:"slot",action:"delete",authorId:(o==null?void 0:o.id)||R.userId,targetUserId:R.userId,before:R,after:null,comment:R.comment}),Y())},y=async(R,ee)=>{if(!c&&(o==null?void 0:o.id)!==R.userId){alert("Только администратор может удалять чужие статусы");return}if(R.endDate&&ee){const J=R.date,ae=R.endDate;if(ee===J){if(confirm(c?"Удалить первый день диапазона?":"Отправить на согласование удаление первого дня диапазона?")){const U=new Date(J+"T00:00:00");U.setDate(U.getDate()+1);const F=ce(U,"yyyy-MM-dd");c?await ms(R.id,{...R,date:F}):await kt({entity:"status",action:"update",authorId:(o==null?void 0:o.id)||R.userId,targetUserId:R.userId,before:R,after:{...R,date:F},comment:R.comment}),Y()}return}if(ee===ae){if(confirm(c?"Удалить последний день диапазона?":"Отправить на согласование удаление последнего дня диапазона?")){const U=new Date(ae+"T00:00:00");U.setDate(U.getDate()-1);const F=ce(U,"yyyy-MM-dd");c?await ms(R.id,{...R,endDate:F}):await kt({entity:"status",action:"update",authorId:(o==null?void 0:o.id)||R.userId,targetUserId:R.userId,before:R,after:{...R,endDate:F},comment:R.comment}),Y()}return}if(ee>J&&ee<ae){if(confirm(c?"Удалить этот день? Диапазон будет разбит на две части.":"Отправить на согласование удаление этого дня? Диапазон будет разбит на две части.")){const U=new Date(ee+"T00:00:00");U.setDate(U.getDate()-1);const F=ce(U,"yyyy-MM-dd");if(c){await ms(R.id,{...R,endDate:F});const V=new Date(ee+"T00:00:00");V.setDate(V.getDate()+1);const te=ce(V,"yyyy-MM-dd");await lo({userId:R.userId,date:te,endDate:ae,type:R.type,comment:R.comment})}else{await kt({entity:"status",action:"update",authorId:(o==null?void 0:o.id)||R.userId,targetUserId:R.userId,before:R,after:{...R,endDate:F},comment:R.comment});const V=new Date(ee+"T00:00:00");V.setDate(V.getDate()+1);const te=ce(V,"yyyy-MM-dd");await kt({entity:"status",action:"create",authorId:(o==null?void 0:o.id)||R.userId,targetUserId:R.userId,before:null,after:{id:"",userId:R.userId,date:te,endDate:ae,type:R.type,comment:R.comment},comment:R.comment})}Y()}return}}c?confirm("Удалить статус?")&&(await co(R.id),Y()):confirm("Отправить на согласование удаление статуса?")&&(await kt({entity:"status",action:"delete",authorId:(o==null?void 0:o.id)||R.userId,targetUserId:R.userId,before:R,after:null,comment:R.comment}),Y())},w=R=>{const ee=new Date;ee.setHours(0,0,0,0);const J=new Date(R.date);if(J.setHours(0,0,0,0),J>ee)return!0;if(J.getTime()===ee.getTime()){const U=new Date,F=U.getHours()*60+U.getMinutes();return R.slots.some(V=>{if(V.endDate){const ue=new Date(V.endDate);if(ue.setHours(0,0,0,0),new Date(ee).setHours(23,59,59),ue>ee)return!0;if(ue.getTime()===ee.getTime()){const[W,ie]=V.end.split(":").map(Number);return W*60+ie>F}return!1}const[te,me]=V.end.split(":").map(Number);return te*60+me>F})}return R.slots.some(U=>{if(U.endDate){const F=new Date(U.endDate);return F.setHours(0,0,0,0),F>=ee}return!1})},N=(R,ee)=>{const J=d.find(ae=>ae.userId===R&&ae.date===ee)||null;if(J&&e!=="all"){const ae=w(J);if(e==="upcoming"&&!ae||e==="completed"&&ae)return null}return J},E=(R,ee)=>g.find(J=>J.userId!==R?!1:J.endDate?J.date<=ee&&J.endDate>=ee:J.date===ee)||null,_=R=>{const J=d.filter(te=>te.userId===R).reduce((te,me)=>te+ho(me.slots),0),ae=g.filter(te=>te.userId===R),U=ae.filter(te=>te.type==="dayoff").length,F=ae.filter(te=>te.type==="sick").length,V=ae.filter(te=>te.type==="vacation").length;return{totalHours:J,daysOff:U,sickDays:F,vacationDays:V}},x=R=>{const ee=new Date(p);R==="prev"?ee.setDate(ee.getDate()-7):ee.setDate(ee.getDate()+7),v(ee)};if(A)return s.jsx("div",{className:`rounded-lg p-8 text-center ${i==="dark"?"bg-[#1a1a1a]":"bg-white"}`,children:s.jsx("p",{className:i==="dark"?"text-gray-400":"text-gray-600",children:"Загрузка..."})});const de=i==="dark"?"text-white":"text-gray-900",M=i==="dark"?"text-gray-300":"text-gray-600",X={dayoff:"bg-amber-50 text-amber-900 border border-amber-200 shadow-inner dark:bg-amber-900/30 dark:text-amber-50 dark:border-amber-700",sick:"bg-orange-50 text-orange-900 border border-orange-200 shadow-inner dark:bg-orange-900/30 dark:text-orange-50 dark:border-orange-700",vacation:"bg-sky-50 text-sky-900 border border-sky-200 shadow-inner dark:bg-sky-900/30 dark:text-sky-50 dark:border-sky-700"};return s.jsxs("div",{className:`rounded-lg ${i==="dark"?"bg-[#1a1a1a]":"bg-white"} shadow-md overflow-hidden`,children:[s.jsxs("div",{className:`p-4 border-b ${i==="dark"?"border-gray-800":"border-gray-200"} flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between`,children:[s.jsxs("button",{onClick:()=>x("prev"),className:`w-full sm:w-auto px-3 py-2 text-sm sm:text-base rounded-lg transition-colors flex items-center justify-center gap-2 whitespace-nowrap ${i==="dark"?"border border-gray-700 bg-gray-900/60 hover:border-[#4E6E49]/50 hover:bg-gray-900":"border border-gray-200 bg-white hover:border-[#4E6E49]/40 hover:bg-gray-50"}`,children:[s.jsx("span",{children:"←"}),s.jsx("span",{children:"Предыдущая неделя"})]}),s.jsxs("span",{className:`${de} font-semibold text-center text-sm sm:text-base whitespace-nowrap`,children:[ce(j[0],"dd.MM.yyyy")," - ",ce(j[6],"dd.MM.yyyy")]}),s.jsxs("button",{onClick:()=>x("next"),className:`w-full sm:w-auto px-3 py-2 text-sm sm:text-base rounded-lg transition-colors flex items-center justify-center gap-2 whitespace-nowrap ${i==="dark"?"border border-gray-700 bg-gray-900/60 hover:border-[#4E6E49]/50 hover:bg-gray-900":"border border-gray-200 bg-white hover:border-[#4E6E49]/40 hover:bg-gray-50"}`,children:[s.jsx("span",{children:"Следующая неделя"}),s.jsx("span",{children:"→"})]})]}),s.jsx("div",{className:"overflow-x-auto -mx-3 sm:-mx-4 md:-mx-6 lg:-mx-8 px-3 sm:px-4 md:px-6 lg:px-8",children:s.jsx("div",{className:"min-w-full inline-block align-middle",children:s.jsxs("table",{className:"w-full",children:[s.jsx("thead",{className:"sticky top-0 z-30",children:s.jsxs("tr",{className:`${i==="dark"?"bg-[#0f172a]":"bg-gray-50"} shadow-sm`,children:[s.jsx("th",{className:`px-2 sm:px-3 md:px-4 py-3 text-left text-xs sm:text-sm font-semibold ${de} sticky left-0 z-30 ${i==="dark"?"bg-[#0f172a]":"bg-gray-50"}`,children:"Members"}),j.map(R=>s.jsx("th",{className:"px-1.5 sm:px-2 md:px-3 lg:px-4 py-3",children:s.jsxs("div",{className:`mx-auto w-full max-w-[110px] rounded-xl border ${i==="dark"?"border-white/10 bg-white/5 text-white":"border-gray-200 bg-white text-gray-900"} shadow-sm text-center`,children:[s.jsx("div",{className:"text-[10px] sm:text-xs opacity-70",children:ce(R,"EEE")}),s.jsx("div",{className:"text-sm font-semibold",children:ce(R,"dd.MM")})]})},R.toISOString())),s.jsx("th",{className:`px-2 sm:px-3 md:px-4 py-3 text-center text-xs sm:text-sm font-bold ${de} whitespace-nowrap`,children:"Итог"})]})}),s.jsx("tbody",{children:H.map((R,ee)=>{const J=_(R.id),ae=ee%2===0;return s.jsxs("tr",{className:`
                    group border-b transition-all duration-300 relative
                    ${i==="dark"?"border-gray-800/30":"border-gray-200/30"}
                    ${ae?i==="dark"?"bg-gradient-to-r from-[#1a1a1a]/40 via-[#1a1a1a]/20 to-transparent hover:from-[#1a1a1a]/70 hover:via-[#1a1a1a]/50 hover:shadow-lg hover:shadow-#4E6E49/10":"bg-gradient-to-r from-gray-50/70 via-gray-50/40 to-transparent hover:from-gray-100/90 hover:via-gray-100/70 hover:shadow-lg hover:shadow-#4E6E49/5":i==="dark"?"bg-gradient-to-r from-[#1a1a1a]/10 via-[#1a1a1a]/5 to-transparent hover:from-[#1a1a1a]/50 hover:via-[#1a1a1a]/30 hover:shadow-lg hover:shadow-#4E6E49/10":"bg-gradient-to-r from-white via-gray-50/30 to-transparent hover:from-gray-50 hover:via-gray-50/60 hover:shadow-lg hover:shadow-#4E6E49/5"}
                    hover:scale-[1.01] hover:-translate-y-0.5
                  `,children:[s.jsx("td",{className:`px-2 sm:px-3 md:px-4 py-2 sm:py-3 md:py-4 font-semibold text-xs sm:text-sm ${de} sticky left-0 z-10 transition-all duration-300 backdrop-blur-sm min-w-[120px] sm:min-w-[140px] ${ae?i==="dark"?"bg-gradient-to-r from-[#1a1a1a]/40 via-[#1a1a1a]/20 to-transparent group-hover:from-[#1a1a1a]/70 group-hover:via-[#1a1a1a]/50":"bg-gradient-to-r from-gray-50/70 via-gray-50/40 to-transparent group-hover:from-gray-100/90 group-hover:via-gray-100/70":i==="dark"?"bg-gradient-to-r from-[#1a1a1a]/10 via-[#1a1a1a]/5 to-transparent group-hover:from-[#1a1a1a]/50 group-hover:via-[#1a1a1a]/30":"bg-gradient-to-r from-white via-gray-50/30 to-transparent group-hover:from-gray-50 group-hover:via-gray-50/60"}`,children:s.jsxs("div",{className:"flex items-center gap-2 sm:gap-3",children:[s.jsxs("div",{className:"relative flex-shrink-0 group/avatar",children:[R.avatar?s.jsx("img",{src:R.avatar,alt:C(R.id),className:"w-8 h-8 sm:w-10 sm:h-10 md:w-11 md:h-11 rounded-full object-cover border-2 shadow-lg transition-all duration-300 group-hover:scale-110 group-hover:shadow-xl group-hover:shadow-#4E6E49/30 ring-2 ring-transparent group-hover:ring-#4E6E49/50",style:{borderColor:i==="dark"?"rgba(34, 197, 94, 0.6)":"rgba(34, 197, 94, 0.4)"},onError:U=>{const F=U.target;F.style.display="none";const V=F.nextElementSibling;V&&(V.style.display="flex")}}):null,s.jsx("div",{className:`w-8 h-8 sm:w-10 sm:h-10 md:w-11 md:h-11 rounded-full flex items-center justify-center font-bold text-xs sm:text-sm transition-all duration-300 shadow-lg ring-2 ring-transparent group-hover/avatar:scale-110 group-hover/avatar:shadow-xl group-hover/avatar:ring-#4E6E49/50 ${i==="dark"?"bg-gradient-to-br from-[#4E6E49] via-[#4E6E49] to-blue-500 text-white group-hover/avatar:shadow-#4E6E49/40":"bg-gradient-to-br from-[#4E6E49] via-[#4E6E49] to-blue-400 text-white group-hover/avatar:shadow-#4E6E49/40"} ${R.avatar?"absolute inset-0 hidden":""}`,children:C(R.id).charAt(0).toUpperCase()}),s.jsx("div",{className:"absolute -bottom-0.5 -right-0.5 w-2.5 h-2.5 sm:w-3 sm:h-3 md:w-3.5 md:h-3.5 bg-[#4E6E49] rounded-full border border-white sm:border-2 shadow-lg animate-pulse opacity-0 group-hover/avatar:opacity-100 transition-opacity duration-300"})]}),s.jsx("span",{className:"font-semibold group-hover:text-[#4E6E49] transition-colors duration-300 truncate hidden sm:inline",children:C(R.id)}),s.jsx("span",{className:"font-semibold group-hover:text-[#4E6E49] transition-colors duration-300 sm:hidden",children:(C(R.id).split(" ")[0]||C(R.id)).substring(0,8)})]})}),j.map(U=>{const F=ce(U,"yyyy-MM-dd"),V=N(R.id,F),te=E(R.id,F);return s.jsx("td",{className:`px-1 sm:px-2 py-2 sm:py-3 text-center border-l border-r border-transparent hover:border-blue-500/20 transition-colors min-w-[80px] sm:min-w-[100px] ${F===S?"bg-emerald-50 dark:bg-emerald-900/20 ring-1 ring-emerald-300/70 dark:ring-emerald-500/40":""}`,children:V?s.jsxs("div",{className:"space-y-2",children:[(()=>{const me=w(V),xe=me?"bg-gradient-to-r from-emerald-500 to-teal-600":"bg-gradient-to-r from-slate-500 to-slate-700",O=me?gs:Ds;return V.slots.map((W,ie)=>s.jsxs("div",{className:"space-y-1",children:[s.jsx("div",{className:`${xe} text-white rounded-md sm:rounded-lg px-2 sm:px-3 py-1 sm:py-1.5 text-[10px] sm:text-xs font-semibold shadow-lg transition-all duration-300 hover:scale-105 hover:shadow-xl ${me?"hover:shadow-emerald-500/40 ring-2 ring-emerald-400/40":"hover:shadow-slate-500/40 ring-2 ring-slate-400/40"}`,children:s.jsxs("div",{className:"flex items-center justify-center gap-0.5 sm:gap-1 flex-wrap",children:[s.jsx(O,{className:"w-2.5 h-2.5 sm:w-3 sm:h-3 animate-pulse flex-shrink-0"}),s.jsxs("span",{className:"whitespace-nowrap",children:[W.start," - ",W.end]}),W.endDate&&s.jsxs("span",{className:"text-[9px] sm:text-[10px] opacity-90 whitespace-nowrap",children:["(до ",ce(new Date(W.endDate),"dd.MM"),")"]})]})}),W.breaks&&W.breaks.length>0&&s.jsxs("div",{className:"space-y-1",children:[s.jsx("div",{className:`text-[10px] ${i==="dark"?"text-gray-400":"text-gray-600"} font-medium`,children:"Перерывы:"}),W.breaks.map((P,oe)=>s.jsx("div",{className:`${i==="dark"?"bg-gray-700/90":"bg-white"} ${i==="dark"?"text-gray-200":"text-gray-900"} border-2 ${i==="dark"?"border-orange-500/50":"border-orange-300"} rounded-md sm:rounded-lg px-1.5 sm:px-2 py-0.5 sm:py-1 text-[9px] sm:text-[10px] font-medium shadow-md transition-all duration-300 hover:scale-105 hover:shadow-lg ${i==="dark"?"hover:border-orange-400/70 hover:shadow-orange-500/20":"hover:border-orange-400 hover:shadow-orange-400/20"}`,children:s.jsxs("span",{className:"flex items-center gap-0.5 sm:gap-1 justify-center flex-wrap",children:[s.jsx("span",{className:"w-0.5 h-0.5 sm:w-1 sm:h-1 rounded-full bg-orange-500 flex-shrink-0"}),s.jsxs("span",{className:"whitespace-nowrap",children:[P.start," - ",P.end]})]})},oe))]})]},ie))})(),s.jsx("div",{className:"flex gap-1 justify-center",children:c||(R==null?void 0:R.id)===V.userId?s.jsxs(s.Fragment,{children:[s.jsx("button",{onClick:()=>t(V),className:"p-1 text-blue-500 hover:bg-blue-500 hover:text-white rounded",children:s.jsx(rr,{className:"w-3 h-3"})}),s.jsx("button",{onClick:()=>I(V),className:"p-1 text-red-500 hover:bg-red-500 hover:text-white rounded",children:s.jsx($t,{className:"w-3 h-3"})})]}):s.jsxs(s.Fragment,{children:[s.jsx("button",{disabled:!0,className:"p-1 text-gray-400 cursor-not-allowed rounded",title:"Вы можете редактировать только свои слоты",children:s.jsx(rr,{className:"w-3 h-3"})}),s.jsx("button",{disabled:!0,className:"p-1 text-gray-400 cursor-not-allowed rounded",title:"Вы можете удалять только свои слоты",children:s.jsx($t,{className:"w-3 h-3"})})]})})]}):te?s.jsxs("div",{className:"space-y-1",children:[s.jsx("div",{className:`rounded-lg px-3 py-2 text-xs font-semibold ring-1 ring-inset ring-black/5 dark:ring-white/10 ${X[te.type]}`,children:te.type==="dayoff"?"Выходной":te.type==="sick"?"Больничный":"Отпуск"}),s.jsx("div",{className:"flex gap-1 justify-center",children:c||(R==null?void 0:R.id)===te.userId?s.jsxs(s.Fragment,{children:[s.jsx("button",{onClick:()=>n(te),className:"p-1 text-blue-500 hover:bg-blue-500 hover:text-white rounded",children:s.jsx(rr,{className:"w-3 h-3"})}),s.jsx("button",{onClick:()=>y(te,F),className:"p-1 text-red-500 hover:bg-red-500 hover:text-white rounded",children:s.jsx($t,{className:"w-3 h-3"})})]}):s.jsxs(s.Fragment,{children:[s.jsx("button",{disabled:!0,className:"p-1 text-gray-400 cursor-not-allowed rounded",title:"Вы можете редактировать только свои статусы",children:s.jsx(rr,{className:"w-3 h-3"})}),s.jsx("button",{disabled:!0,className:"p-1 text-gray-400 cursor-not-allowed rounded",title:"Вы можете удалять только свои статусы",children:s.jsx($t,{className:"w-3 h-3"})})]})})]}):s.jsx("span",{className:`text-sm ${M}`,children:"—"})},F)}),s.jsx("td",{className:`px-4 py-3 text-sm ${de} text-center`,children:s.jsxs("div",{className:"space-y-1",children:[s.jsxs("div",{children:["Часов: ",J.totalHours.toFixed(1)]}),s.jsxs("div",{children:["Выходных: ",J.daysOff]}),s.jsxs("div",{children:["Больничных: ",J.sickDays]}),s.jsxs("div",{children:["Отпусков: ",J.vacationDays]})]})})]},R.id)})})]})})})]})},W_=({selectedUserId:r,slotFilter:e,onEditSlot:t,onEditStatus:n,refreshKey:a})=>{const{theme:i}=it(),{user:o}=jt(),{isAdmin:c}=At(),[d,h]=D.useState([]),[g,f]=D.useState([]),[p,v]=D.useState(new Date),[A,T]=D.useState(!0),S={1:"Dex",2:"Enowk",3:"Xenia",4:"Olenka",5:"Sydney"},z={artyom:"1",adel:"2",kseniya:"3",olga:"4",anastasia:"5"},L=M=>{const X=Se.find(R=>R.id===M)||Se.find(R=>z[M]===R.id);return{member:X,displayName:S[(X==null?void 0:X.id)||M]||(X==null?void 0:X.name)||M}},C=_c(p),j=new Date;D.useEffect(()=>{H()},[r,p,a]),D.useEffect(()=>{const M=()=>{H()};return window.addEventListener("focus",M),()=>window.removeEventListener("focus",M)},[]);const H=async()=>{T(!0);try{const M=new Date(C[0]);M.setHours(0,0,0,0);const X=new Date(C[6]);X.setHours(23,59,59,999);const R=ce(M,"yyyy-MM-dd"),ee=ce(X,"yyyy-MM-dd"),[J,ae]=await Promise.all([Kr(),br()]),U=J.filter(me=>me.date>=R&&me.date<=ee),F=ae.filter(me=>{const xe=me.date,ue=me.endDate||me.date;return xe<=ee&&ue>=R}),V=r?U.filter(me=>me.userId===r):U,te=r?F.filter(me=>me.userId===r):F;console.log("Loaded slots (week view):",{weekStart:R,weekEnd:ee,allSlotsCount:J.length,weekSlotsCount:U.length,filteredSlotsCount:V.length,selectedUserId:r}),h(V),f(te)}catch(M){console.error("Error loading data:",M)}finally{T(!1)}},Y=async M=>{if(!c&&(o==null?void 0:o.id)!==M.userId){alert("Только администратор может удалять чужие слоты");return}if(c){confirm("Удалить слот?")&&(await oo(M.id),H());return}confirm("Отправить на согласование удаление слота?")&&(await kt({entity:"slot",action:"delete",authorId:(o==null?void 0:o.id)||M.userId,targetUserId:M.userId,before:M,after:null,comment:M.comment}),H())},I=async(M,X)=>{if(!c&&(o==null?void 0:o.id)!==M.userId){alert("Только администратор может удалять чужие статусы");return}if(M.endDate&&X){const R=M.date,ee=M.endDate;if(X===R){if(confirm(c?"Удалить первый день диапазона?":"Отправить на согласование удаление первого дня диапазона?")){const J=new Date(lr(R));J.setDate(J.getDate()+1);const ae=ce(J,"yyyy-MM-dd");c?await ms(M.id,{...M,date:ae}):await kt({entity:"status",action:"update",authorId:(o==null?void 0:o.id)||M.userId,targetUserId:M.userId,before:M,after:{...M,date:ae},comment:M.comment}),H()}return}if(X===ee){if(confirm(c?"Удалить последний день диапазона?":"Отправить на согласование удаление последнего дня диапазона?")){const J=new Date(lr(ee));J.setDate(J.getDate()-1);const ae=ce(J,"yyyy-MM-dd");c?await ms(M.id,{...M,endDate:ae}):await kt({entity:"status",action:"update",authorId:(o==null?void 0:o.id)||M.userId,targetUserId:M.userId,before:M,after:{...M,endDate:ae},comment:M.comment}),H()}return}if(X>R&&X<ee){if(confirm(c?"Удалить этот день? Диапазон будет разбит на две части.":"Отправить на согласование удаление этого дня? Диапазон будет разбит на две части.")){const J=new Date(lr(X));J.setDate(J.getDate()-1);const ae=ce(J,"yyyy-MM-dd");if(c){await ms(M.id,{...M,endDate:ae});const U=new Date(lr(X));U.setDate(U.getDate()+1);const F=ce(U,"yyyy-MM-dd");await lo({userId:M.userId,date:F,endDate:ee,type:M.type,comment:M.comment})}else{await kt({entity:"status",action:"update",authorId:(o==null?void 0:o.id)||M.userId,targetUserId:M.userId,before:M,after:{...M,endDate:ae},comment:M.comment});const U=new Date(lr(X));U.setDate(U.getDate()+1);const F=ce(U,"yyyy-MM-dd");await kt({entity:"status",action:"create",authorId:(o==null?void 0:o.id)||M.userId,targetUserId:M.userId,before:null,after:{id:"",userId:M.userId,date:F,endDate:ee,type:M.type,comment:M.comment},comment:M.comment})}H()}return}}c?confirm("Удалить статус?")&&(await co(M.id),H()):confirm("Отправить на согласование удаление статуса?")&&(await kt({entity:"status",action:"delete",authorId:(o==null?void 0:o.id)||M.userId,targetUserId:M.userId,before:M,after:null,comment:M.comment}),H())},y=M=>{const X=new Date;X.setHours(0,0,0,0);const R=new Date(M.date);if(R.setHours(0,0,0,0),R>X)return!0;if(R.getTime()===X.getTime()){const J=new Date,ae=J.getHours()*60+J.getMinutes();return M.slots.some(U=>{if(U.endDate){const me=new Date(U.endDate);if(me.setHours(0,0,0,0),new Date(X).setHours(23,59,59),me>X)return!0;if(me.getTime()===X.getTime()){const[ue,O]=U.end.split(":").map(Number);return ue*60+O>ae}return!1}const[F,V]=U.end.split(":").map(Number);return F*60+V>ae})}return M.slots.some(J=>{if(J.endDate){const ae=new Date(J.endDate);return ae.setHours(0,0,0,0),ae>=X}return!1})},w=M=>{let X=d.filter(R=>R.date===M);return e!=="all"&&(X=X.filter(R=>{const ee=y(R);return e==="upcoming"?ee:e==="completed"?!ee:!0})),X},N=M=>g.filter(X=>X.endDate?X.date<=M&&X.endDate>=M:X.date===M),E=M=>{const X=new Date(p);M==="prev"?X.setDate(X.getDate()-7):X.setDate(X.getDate()+7),v(X)};if(A)return s.jsx("div",{className:`rounded-lg p-8 text-center ${i==="dark"?"bg-[#1a1a1a]":"bg-white"}`,children:s.jsx("p",{className:i==="dark"?"text-gray-400":"text-gray-600",children:"Загрузка..."})});const _=i==="dark"?"text-white":"text-gray-900",x=i==="dark"?"text-gray-400":"text-gray-600",de={dayoff:"bg-amber-50 text-amber-900 border border-amber-200 shadow-inner dark:bg-amber-900/25 dark:text-amber-50 dark:border-amber-700",sick:"bg-orange-50 text-orange-900 border border-orange-200 shadow-inner dark:bg-orange-900/25 dark:text-orange-50 dark:border-orange-700",vacation:"bg-sky-50 text-sky-900 border border-sky-200 shadow-inner dark:bg-sky-900/25 dark:text-sky-50 dark:border-sky-700"};return s.jsxs("div",{className:`rounded-lg ${i==="dark"?"bg-[#1a1a1a]":"bg-white"} shadow-md overflow-hidden`,children:[s.jsxs("div",{className:`p-3 sm:p-4 border-b ${i==="dark"?"border-gray-800":"border-gray-200"} flex flex-col gap-2 sm:gap-3 sm:flex-row sm:items-center sm:justify-between`,children:[s.jsxs("button",{onClick:()=>E("prev"),className:`w-full sm:w-auto px-3 sm:px-4 py-2 text-xs sm:text-sm md:text-base rounded-lg transition-colors touch-manipulation active:scale-95 flex items-center justify-center gap-2 whitespace-nowrap ${i==="dark"?"border border-gray-700 bg-gray-900/60 hover:border-[#4E6E49]/50 hover:bg-gray-900":"border border-gray-200 bg-white hover:border-[#4E6E49]/40 hover:bg-gray-50"}`,children:[s.jsx("span",{children:"←"}),s.jsx("span",{children:"Предыдущая неделя"})]}),s.jsxs("span",{className:`${_} font-semibold text-center text-xs sm:text-sm md:text-base whitespace-nowrap`,children:[ce(C[0],"dd.MM.yyyy")," - ",ce(C[6],"dd.MM.yyyy")]}),s.jsxs("button",{onClick:()=>E("next"),className:`w-full sm:w-auto px-3 sm:px-4 py-2 text-xs sm:text-sm md:text-base rounded-lg transition-colors touch-manipulation active:scale-95 flex items-center justify-center gap-2 whitespace-nowrap ${i==="dark"?"border border-gray-700 bg-gray-900/60 hover:border-[#4E6E49]/50 hover:bg-gray-900":"border border-gray-200 bg-white hover:border-[#4E6E49]/40 hover:bg-gray-50"}`,children:[s.jsx("span",{children:"Следующая неделя"}),s.jsx("span",{children:"→"})]})]}),s.jsx("div",{className:"p-3 sm:p-4 space-y-3 sm:space-y-4",children:C.map(M=>{const X=ce(M,"yyyy-MM-dd"),R=w(X),ee=N(X),J=i0(M,j),ae="relative rounded-xl p-4 sm:p-5 border transition-all duration-300",U=i==="dark"?"bg-gray-800/70 border-gray-700 shadow-md":"bg-gray-50 border-gray-200 shadow-sm",F=i==="dark"?"border-emerald-500/70 bg-gradient-to-br from-emerald-900/30 via-gray-800 to-gray-900/80 ring-2 ring-emerald-400/40 shadow-[0_20px_40px_-24px_rgba(52,211,153,0.8)]":"border-emerald-300 bg-gradient-to-br from-emerald-50 via-white to-green-50 ring-2 ring-emerald-200/70 shadow-[0_20px_40px_-24px_rgba(52,211,153,0.6)]";return s.jsxs("div",{className:`${ae} ${U} ${J?F:""}`,children:[J&&s.jsxs("div",{className:"absolute top-3 right-3 inline-flex items-center gap-2 px-3 py-1 rounded-full bg-emerald-500 text-white text-xs font-semibold shadow-lg ring-2 ring-white/50 dark:ring-emerald-200/30",children:[s.jsx("span",{className:"w-2 h-2 rounded-full bg-white animate-ping"}),s.jsx("span",{className:"relative",children:"Сегодня"})]}),s.jsx("h3",{className:`text-lg font-semibold mb-3 ${_}`,children:ce(M,"dd.MM.yyyy")}),s.jsxs("div",{className:"space-y-3 sm:space-y-4",children:[ee.map(V=>{const{displayName:te}=L(V.userId);return s.jsxs("div",{className:`relative flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 p-4 rounded-2xl border-2 transition-all duration-300 hover:shadow-xl backdrop-blur text-center sm:text-left ring-1 ring-inset ring-black/5 dark:ring-white/5 ${de[V.type]}`,children:[s.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2 justify-center sm:justify-start w-full",children:[s.jsx("span",{className:"font-semibold text-base sm:text-lg",children:te}),s.jsx("span",{className:"inline-flex items-center gap-2 px-3 py-1 rounded-full bg-white/70 dark:bg-white/10 text-xs sm:text-sm font-semibold",children:V.type==="dayoff"?"Выходной":V.type==="sick"?"Больничный":"Отпуск"})]}),s.jsx("div",{className:"flex gap-2 justify-center sm:justify-end w-full",children:c||(o==null?void 0:o.id)===V.userId?s.jsxs(s.Fragment,{children:[s.jsx("button",{onClick:()=>n(V),className:`p-1 rounded transition-colors ${i==="dark"?"bg-white/10 hover:bg-white/20 text-white":"bg-white border border-gray-200 text-gray-700 hover:bg-gray-100"}`,children:s.jsx(rr,{className:"w-4 h-4 text-current"})}),s.jsx("button",{onClick:()=>I(V,X),className:`p-1 rounded transition-colors ${i==="dark"?"bg-white/10 hover:bg-white/20 text-white":"bg-white border border-gray-200 text-gray-700 hover:bg-gray-100"}`,children:s.jsx($t,{className:"w-4 h-4 text-current"})})]}):s.jsxs(s.Fragment,{children:[s.jsx("button",{disabled:!0,className:`p-1 cursor-not-allowed rounded ${i==="dark"?"bg-white/5 text-white/60":"bg-gray-100 text-gray-400 border border-gray-200"}`,title:"Вы можете редактировать только свои статусы",children:s.jsx(rr,{className:"w-4 h-4 text-current opacity-60"})}),s.jsx("button",{disabled:!0,className:`p-1 cursor-not-allowed rounded ${i==="dark"?"bg-white/5 text-white/60":"bg-gray-100 text-gray-400 border border-gray-200"}`,title:"Вы можете удалять только свои статусы",children:s.jsx($t,{className:"w-4 h-4 text-current opacity-60"})})]})})]},V.id)}),R.map(V=>{const{member:te,displayName:me}=L(V.userId),xe=y(V),ue=xe?"bg-gradient-to-r from-emerald-500 to-teal-600 border-emerald-300/40":"bg-gradient-to-r from-slate-500 to-slate-700 border-slate-300/40",O=xe?gs:Ds;return s.jsxs("div",{className:`group relative space-y-2 sm:space-y-3 p-3 sm:p-4 ${ue} rounded-lg sm:rounded-xl shadow-xl border-2 transition-all duration-300 hover:shadow-2xl active:scale-[0.98] sm:hover:scale-[1.03] mb-2 sm:mb-3 ${xe?"hover:border-emerald-200/80 ring-2 ring-emerald-200/40 hover:ring-4 hover:ring-emerald-200/60":"hover:border-slate-200/80 ring-2 ring-slate-200/40 hover:ring-4 hover:ring-slate-200/60"}`,children:[s.jsxs("div",{className:"flex items-center justify-between border-b border-white/20 pb-2 sm:pb-3",children:[s.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 min-w-0 flex-1",children:[s.jsxs("div",{className:"relative flex-shrink-0 group/avatar",children:[te!=null&&te.avatar?s.jsx("img",{src:te.avatar,alt:me,className:`w-8 h-8 sm:w-9 sm:h-9 md:w-10 md:h-10 lg:w-11 lg:h-11 rounded-full object-cover border-2 shadow-xl transition-all duration-300 group-hover/avatar:scale-110 group-hover/avatar:shadow-2xl ${xe?"border-white/50 ring-2 ring-white/40 ring-offset-2 ring-offset-emerald-400/30 group-hover/avatar:ring-4 group-hover/avatar:ring-white/60":"border-white/40 ring-2 ring-white/30 ring-offset-2 ring-offset-slate-400/30 group-hover/avatar:ring-4 group-hover/avatar:ring-white/50"}`,onError:W=>{const ie=W.target;ie.style.display="none";const P=ie.nextElementSibling;P&&(P.style.display="flex")}}):null,s.jsx("div",{className:`w-8 h-8 sm:w-9 sm:h-9 md:w-10 md:h-10 lg:w-11 lg:h-11 rounded-full flex items-center justify-center font-bold text-xs sm:text-sm transition-all duration-300 shadow-xl group-hover/avatar:scale-110 group-hover/avatar:shadow-2xl ${xe?"bg-white/25 backdrop-blur-md border-2 border-white/40 ring-2 ring-white/30 group-hover/avatar:ring-4 group-hover/avatar:ring-white/60":"bg-white/15 backdrop-blur-md border-2 border-white/30 ring-2 ring-white/20 group-hover/avatar:ring-4 group-hover/avatar:ring-white/50"} ${te!=null&&te.avatar?"absolute inset-0 hidden":""}`,children:me.charAt(0).toUpperCase()}),s.jsx("div",{className:`absolute -bottom-0.5 -right-0.5 w-2.5 h-2.5 sm:w-3 sm:h-3 md:w-3.5 md:h-3.5 rounded-full border border-white sm:border-2 shadow-lg animate-pulse opacity-0 group-hover/avatar:opacity-100 transition-opacity duration-300 ${xe?"bg-emerald-300":"bg-slate-400"}`})]}),s.jsx("span",{className:"text-white font-bold text-sm sm:text-base group-hover:scale-105 transition-transform duration-300 truncate",children:me})]}),s.jsx("div",{className:"flex gap-2",children:c||(o==null?void 0:o.id)===V.userId?s.jsxs(s.Fragment,{children:[s.jsx("button",{onClick:()=>t(V),className:"p-1.5 bg-white/20 hover:bg-white/30 rounded-lg transition-colors",children:s.jsx(rr,{className:"w-4 h-4 text-white"})}),s.jsx("button",{onClick:()=>Y(V),className:"p-1.5 bg-white/20 hover:bg-white/30 rounded-lg transition-colors",children:s.jsx($t,{className:"w-4 h-4 text-white"})})]}):s.jsxs(s.Fragment,{children:[s.jsx("button",{disabled:!0,className:"p-1.5 bg-white/10 cursor-not-allowed rounded-lg",title:"Вы можете редактировать только свои слоты",children:s.jsx(rr,{className:"w-4 h-4 text-white/50"})}),s.jsx("button",{disabled:!0,className:"p-1.5 bg-white/10 cursor-not-allowed rounded-lg",title:"Вы можете удалять только свои слоты",children:s.jsx($t,{className:"w-4 h-4 text-white/50"})})]})})]}),s.jsx("div",{className:"space-y-2",children:V.slots.map((W,ie)=>s.jsxs("div",{className:"space-y-1.5",children:[s.jsx("div",{className:`bg-white/25 backdrop-blur-md rounded-md sm:rounded-lg px-2 sm:px-3 py-1.5 sm:py-2 border-2 transition-all duration-300 hover:scale-105 hover:shadow-xl ${xe?"border-white/40 ring-2 ring-white/20 hover:border-white/60 hover:ring-4 hover:ring-white/40":"border-white/30 ring-2 ring-white/10 hover:border-white/50 hover:ring-4 hover:ring-white/30"}`,children:s.jsxs("div",{className:"flex items-center gap-1.5 sm:gap-2 flex-wrap",children:[s.jsx(O,{className:`w-3.5 h-3.5 sm:w-4 sm:h-4 text-white flex-shrink-0 ${xe?"animate-pulse":""}`}),s.jsxs("span",{className:"text-white font-bold text-xs sm:text-sm whitespace-nowrap",children:[W.start," - ",W.end]}),W.endDate&&s.jsxs("span",{className:"text-white/80 font-medium text-[10px] sm:text-xs whitespace-nowrap",children:["(до ",ce(new Date(W.endDate),"dd.MM"),")"]})]})}),W.breaks&&W.breaks.length>0&&s.jsxs("div",{className:"space-y-1 w-full",children:[s.jsx("div",{className:`text-[10px] ${i==="dark"?"text-gray-300":"text-gray-700"} font-medium text-center sm:text-left`,children:"Перерывы:"}),W.breaks.map((P,oe)=>s.jsx("div",{className:`${i==="dark"?"bg-gray-700/95":"bg-white"} ${i==="dark"?"text-gray-200":"text-gray-900"} border-2 ${i==="dark"?"border-orange-500/60":"border-orange-300"} rounded-md sm:rounded-lg px-2 sm:px-3 py-1 sm:py-1.5 text-[10px] sm:text-xs font-semibold shadow-lg transition-all duration-300 hover:scale-105 hover:shadow-xl ${i==="dark"?"hover:border-orange-400/80 hover:shadow-orange-500/30 ring-2 ring-orange-500/20 hover:ring-4 hover:ring-orange-400/40":"hover:border-orange-400 hover:shadow-orange-400/30 ring-2 ring-orange-300/20 hover:ring-4 hover:ring-orange-300/40"} w-full`,children:s.jsxs("span",{className:"flex items-center gap-1 sm:gap-1.5 justify-center flex-wrap w-full",children:[s.jsx("span",{className:`w-1 h-1 sm:w-1.5 sm:h-1.5 rounded-full ${i==="dark"?"bg-orange-400":"bg-orange-500"} animate-pulse flex-shrink-0`}),s.jsxs("span",{className:"whitespace-nowrap",children:[P.start," - ",P.end]})]})},oe))]})]},ie))})]},V.id)}),R.length===0&&ee.length===0&&s.jsx("p",{className:`text-sm ${x}`,children:"Нет данных"})]})]},X)})})]})},q_=({slot:r,onClose:e,onSave:t})=>{var at;const{user:n}=jt(),{theme:a}=it(),{isAdmin:i}=At(),o=a==="dark"?"text-white":"text-gray-900",c=(r==null?void 0:r.date)||ce(new Date,"yyyy-MM-dd"),[d,h]=D.useState(c),[g,f]=D.useState(r!=null&&r.userId?[r.userId]:n!=null&&n.id?[n.id]:[]),[p,v]=D.useState(((at=r==null?void 0:r.slots)==null?void 0:at.map(G=>{const fe=G;return fe.break&&!fe.breaks?{...G,breaks:[fe.break]}:G}))||[]),[A,T]=D.useState(""),[S,z]=D.useState(""),[L,C]=D.useState(!1),[j,H]=D.useState(""),[Y,I]=D.useState(""),[y,w]=D.useState(null),[N,E]=D.useState(null),[_,x]=D.useState(null),[de,M]=D.useState(null),[X,R]=D.useState((r==null?void 0:r.comment)||""),[ee,J]=D.useState(!1),[ae,U]=D.useState([]),[F,V]=D.useState(!1),[te,me]=D.useState([]),[xe,ue]=D.useState("single"),[O,W]=D.useState(c),[ie,P]=D.useState(c),[oe,je]=D.useState(c),[K,ge]=D.useState([]),[pe,Ce]=D.useState(""),[ze,Qe]=D.useState(!1);In();const q=["Пн","Вт","Ср","Чт","Пт","Сб","Вс"],ne=i&&!r;D.useEffect(()=>{console.log("SlotForm mounted, user:",n==null?void 0:n.name,"slots count:",p.length)},[]),D.useEffect(()=>{if(ee&&d){const G=new Date(d),fe=G.getDay()===0?6:G.getDay()-1;U([fe])}},[ee,d]),D.useEffect(()=>{F||me([])},[F]),D.useEffect(()=>{xe!=="single"&&(J(!1),U([]),V(!1),me([]))},[xe]);const Te=()=>{var Ke;if(!A||!S){Ce("Заполните время начала и окончания");return}const G=L&&A>=S;if(!G&&A>=S){Ce('Время окончания должно быть позже времени начала. Включите "Переходит через полночь" для слотов, переходящих на следующий день.');return}let fe;if(G&&d){const He=new Date(d);He.setDate(He.getDate()+1),fe=ce(He,"yyyy-MM-dd")}const Me=y!==null?((Ke=p[y])==null?void 0:Ke.breaks)||[]:[],We={start:A,end:S,...fe&&{endDate:fe},breaks:Me};if(y!==null){const He=[...p];He[y]=We,v(He)}else v([...p,We]);T(""),z(""),C(!1),H(""),I(""),w(null),E(null),Ce("")},Z=G=>{const fe=p[G];if(!fe)return;const Me=!!fe.endDate||or(fe.end)<=or(fe.start);T(fe.start),z(fe.end),C(Me),w(G),E(null),x(null),M(null),H(""),I(""),Ce("")},$e=()=>{w(null),T(""),z(""),C(!1),Ce("")},Fe=G=>{if(!j||!Y){Ce("Заполните время начала и окончания перерыва");return}const fe=p[G];if(!fe)return;if(j>=Y){Ce("Время окончания перерыва должно быть позже времени начала");return}const Me=or(j),We=or(Y),Ke=or(fe.start),He=or(fe.end),er=fe.endDate||He<=Ke;let et=!1;if(er){const Ze=Me>=Ke&&Me<1440&&We>Me&&We<=1440&&We>Me,ur=Me>=0&&Me<=He&&We>Me&&We<=He,ar=Me>=Ke&&Me<1440&&We>0&&We<=He&&Me>We;et=Ze||ur||ar}else et=Me>=Ke&&We<=He&&We>Me;if(!et){Ce(`Перерыв должен быть в пределах времени слота (${fe.start} - ${fe.end})`);return}const ct=fe.breaks||[];for(let mt=0;mt<ct.length;mt++){if(_===G&&de===mt)continue;const Ze=ct[mt];if(j>=Ze.start&&j<Ze.end||Y>Ze.start&&Y<=Ze.end||j<=Ze.start&&Y>=Ze.end){Ce("Перерывы не должны пересекаться");return}}let Dt;_===G&&de!==null?(Dt=[...ct],Dt[de]={start:j,end:Y},Dt.sort((mt,Ze)=>mt.start.localeCompare(Ze.start))):Dt=[...ct,{start:j,end:Y}].sort((mt,Ze)=>mt.start.localeCompare(Ze.start));const nr=[...p];nr[G]={...fe,breaks:Dt},v(nr),H(""),I(""),E(null),x(null),M(null),Ce("")},$=(G,fe)=>{const Me=p[G];if(!Me||!Me.breaks||!Me.breaks[fe])return;const We=Me.breaks[fe];x(G),M(fe),E(G),H(We.start),I(We.end),Ce("")},k=()=>{H(""),I(""),E(null),x(null),M(null),Ce("")},ye=(G,fe)=>{const Me=p[G];if(!Me||!Me.breaks)return;const We=Me.breaks.filter((He,er)=>er!==fe),Ke=[...p];Ke[G]={...Me,breaks:We.length>0?We:void 0},v(Ke)},_e=G=>{v(p.filter((fe,Me)=>Me!==G)),y===G&&$e()},Ie=G=>{ae.includes(G)?U(ae.filter(fe=>fe!==G)):U([...ae,G])},re=G=>{te.includes(G)?me(te.filter(fe=>fe!==G)):me([...te,G])},ve=G=>{f(fe=>fe.includes(G)?fe.filter(Me=>Me!==G):[...fe,G])},we=()=>{g.length===Se.length?f([]):f(Se.map(G=>G.id))},Ae=()=>{if(!oe)return;const G=o0([...K,oe]);ge(G),je("")},ot=G=>{ge(fe=>fe.filter(Me=>Me!==G))},ft=()=>{if(ne){if(xe==="range")return $i(O,ie);if(xe==="multiple")return K}if(xe==="single"){if(ee&&ae.length>0){const G=[],fe=new Date(d),Me=new Date(fe.getFullYear(),fe.getMonth()+1,0),We=ae[0],Ke=new Date(fe);for(;Ke<=Me;)(Ke.getDay()===0?6:Ke.getDay()-1)===We&&G.push(ce(Ke,"yyyy-MM-dd")),Ke.setDate(Ke.getDate()+1);return G}if(F&&te.length>0){const G=[],fe=new Date(d),Me=fe.getDay()===0?6:fe.getDay()-1;fe.setDate(fe.getDate()-Me);for(let We=0;We<7;We++){const Ke=new Date(fe);Ke.setDate(fe.getDate()+We);const He=Ke.getDay()===0?6:Ke.getDay()-1;te.includes(He)&&G.push(ce(Ke,"yyyy-MM-dd"))}return G}return[d]}return xe==="range"?$i(O,ie):K},bt=()=>r?[r.userId]:ne?g:i&&!n?g.length>0?g:[]:n!=null&&n.id?[n.id]:[],De=G=>{var fe;return((fe=Se.find(Me=>Me.id===G))==null?void 0:fe.name)||G},lt=async(G,fe)=>{const We=(await Kr(void 0,G)).filter(Ke=>Ke.id!==(r==null?void 0:r.id));for(const Ke of fe)for(const He of We)if(P_(Ke,He.slots[0])&&He.participants.length>=3)return`Слот ${Ke.start}-${Ke.end} уже занят максимальным количеством участников (3)`;return null},Pe=async()=>{if(console.log("handleSave called"),!i&&!n){console.log("No user found"),Ce("Пользователь не найден");return}if(p.length===0){Ce("Добавьте хотя бы один временной интервал");return}if(r&&!i&&n&&r.userId!==n.id){Ce("Вы можете редактировать только свои слоты"),Qe(!1);return}const G=bt();if(G.length===0){Ce("Выберите хотя бы одного участника");return}const fe=ft();if(fe.length===0){Ce("Выберите даты");return}const Me=new Date;Me.setHours(0,0,0,0);const We=ce(Me,"yyyy-MM-dd"),Ke=et=>et<We,He=(et,ct)=>{const Dt=new Date(et),nr=new Date(ct);return Dt.setHours(0,0,0,0),nr.setHours(0,0,0,0),Math.round((nr.getTime()-Dt.getTime())/(1e3*60*60*24))},er=async(et,ct,Dt=[et])=>{const nr=p.map(Ze=>{const ur=!Ze.endDate&&or(Ze.end)<=or(Ze.start),ar=Ze.endDate?He(d,Ze.endDate):ur?1:0;if(ar>0){const Qr=new Date(ct);return Qr.setDate(Qr.getDate()+ar),{...Ze,endDate:ce(Qr,"yyyy-MM-dd")}}return{...Ze,...Ze.endDate?{endDate:Ze.endDate}:{}}});if(!i){const Ze=await lt(ct,nr);if(Ze)throw new Error(`[${De(et)} • ${ce(new Date(ct),"dd.MM.yyyy")}] ${Ze}`)}const mt={id:(r==null?void 0:r.id)||"",userId:et,date:ct,slots:nr,...X&&{comment:X},participants:Dt};if(i)if(r){const{id:Ze,...ur}=mt;await Lg(r.id,ur)}else{const{id:Ze,...ur}=mt;await Vg(ur)}else await kt({entity:"slot",action:r?"update":"create",authorId:(n==null?void 0:n.id)||et,targetUserId:et,before:r||null,after:mt,comment:X||void 0})};console.log("Starting save process..."),Ce(""),Qe(!0);try{if(r){await er(r.userId,d,r.participants||[r.userId]),t();return}if(F&&te.length>0){const et=ft();for(const ct of et)if(!Ke(ct))for(const Dt of G)await er(Dt,ct)}else if(ee&&ae.length>0){const et=new Date(d),ct=et.getMonth(),Dt=et.getFullYear(),nr=new Date(Dt,ct+1,0).getDate();for(let mt=1;mt<=nr;mt++){const Ze=new Date(Dt,ct,mt),ur=Ze.getDay()===0?6:Ze.getDay()-1;if(ae.includes(ur)){const ar=ce(Ze,"yyyy-MM-dd");if(Ke(ar))continue;for(const Qr of G)await er(Qr,ar)}}}else if(ne&&xe!=="single")for(const et of fe)for(const ct of G)await er(ct,et);else for(const et of G)await er(et,d);t()}catch(et){console.error("Error saving slot:",et);const ct=et.message||et.code||"Ошибка при сохранении";Ce(ct)}finally{Qe(!1)}},Xe=ne?ft():[d],Ne=g.map(G=>De(G)).join(", "),Oe=p.map(G=>`${G.start}–${G.end}${G.endDate?" (+1)":""}`);return s.jsx("div",{className:"fixed inset-0 bg-slate-950/75 backdrop-blur-xl flex items-start sm:items-center justify-center z-[70] p-4 sm:p-6 touch-manipulation overflow-y-auto",children:s.jsx("div",{className:`w-full max-w-5xl rounded-3xl shadow-[0_24px_80px_rgba(0,0,0,0.45)] border ${a==="dark"?"bg-gradient-to-br from-[#0c1320] via-[#0b1220] to-[#08111b] border-white/10":"bg-gradient-to-br from-white via-slate-50 to-white border-slate-200"} max-h-[90vh] overflow-y-auto`,children:s.jsxs("div",{className:"p-4 sm:p-6 lg:p-7 flex flex-col h-full min-h-0 overflow-y-auto",children:[s.jsxs("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between",children:[s.jsxs("div",{className:"space-y-1",children:[s.jsx("div",{className:"flex items-center gap-2 text-xs font-semibold text-[#4E6E49] tracking-tight",children:s.jsx("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full bg-[#4E6E49]/10 text-[#4E6E49] border border-[#4E6E49]/30",children:r?"Редактирование слота":"Создание слота"})}),s.jsx("h3",{className:`text-2xl sm:text-3xl font-bold ${o}`,children:r?"Редактировать слот":"Добавить слот"})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsxs("div",{className:`px-3 py-2 rounded-xl border text-xs sm:text-sm ${a==="dark"?"border-white/10 bg-white/5 text-gray-200":"border-slate-200 bg-slate-50 text-slate-700"}`,children:[r?"Редактирование":"Создание"," · ",p.length||0," интервал(ов)"]}),s.jsx("button",{onClick:e,className:`p-2.5 rounded-full border ${a==="dark"?"border-white/10 text-gray-200 hover:bg-white/5":"border-slate-200 text-slate-600 hover:bg-slate-100"} transition-colors touch-manipulation`,"aria-label":"Закрыть",children:s.jsx(Zt,{className:"w-4 h-4 sm:w-5 sm:h-5"})})]})]}),s.jsxs("div",{className:"mt-5 grid lg:grid-cols-[0.9fr_1.6fr] gap-4 lg:gap-6 flex-1 min-h-0",children:[s.jsxs("aside",{className:`rounded-2xl border ${a==="dark"?"border-white/10 bg-white/5":"border-slate-200 bg-white"} p-4 sm:p-5 space-y-4 sticky top-0 self-start max-h-full overflow-y-auto`,children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("p",{className:"text-sm font-semibold",children:"Навигация"}),s.jsx("span",{className:"text-[11px] uppercase tracking-wide text-[#4E6E49] font-semibold",children:"4 шага"})]}),s.jsx("div",{className:"space-y-2",children:[{label:"Участники",detail:Ne||"Не выбрано",done:g.length>0||!!r},{label:"Даты",detail:Xe.slice(0,2).map(G=>ce(G,"dd.MM")).join(", ")||"Выберите дату",done:Xe.length>0},{label:"Время",detail:Oe.slice(0,2).join(" · ")||"Добавьте интервал",done:p.length>0},{label:"Комментарий",detail:X?"Заполнен":"Необязателен",done:!!X}].map((G,fe)=>s.jsxs("div",{className:`flex items-start gap-3 rounded-xl border px-3 py-3 ${a==="dark"?"border-white/10 bg-white/5":"border-slate-200 bg-slate-50"}`,children:[s.jsx("span",{className:`mt-0.5 inline-flex h-6 w-6 items-center justify-center rounded-full text-xs font-bold ${G.done?"bg-[#4E6E49] text-white":a==="dark"?"bg-slate-800 text-gray-300":"bg-slate-200 text-slate-700"}`,children:fe+1}),s.jsxs("div",{className:"flex-1",children:[s.jsx("p",{className:"text-sm font-semibold",children:G.label}),s.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 truncate",children:G.detail})]})]},G.label))})]}),s.jsxs("div",{className:"space-y-4 overflow-y-auto overscroll-contain pr-1 pb-6 flex-1 min-h-0",children:[ne&&s.jsxs("div",{children:[s.jsx("label",{className:`block text-xs sm:text-sm font-medium mb-2 ${a==="dark"?"text-gray-300":"text-gray-700"}`,children:"Участники"}),s.jsxs("div",{className:"space-y-3",children:[s.jsx("div",{className:"flex flex-wrap gap-2",children:Se.map(G=>s.jsxs("label",{className:`px-3 py-1.5 rounded-full border cursor-pointer text-sm flex items-center gap-2 ${g.includes(G.id)?"bg-[#4E6E49] border-[#4E6E49] text-white":a==="dark"?"bg-gray-700 border-gray-800 text-gray-200":"bg-gray-100 border-gray-300 text-gray-700"}`,children:[s.jsx("input",{type:"checkbox",checked:g.includes(G.id),onChange:()=>ve(G.id),className:"hidden"}),G.name]},G.id))}),s.jsx("button",{type:"button",onClick:we,className:"text-sm text-[#4E6E49] hover:text-[#4E6E49]",children:g.length===Se.length?"Снять выделение":"Выбрать всех"})]})]}),ne&&s.jsxs("div",{children:[s.jsx("p",{className:`text-xs sm:text-sm font-medium mb-2 ${a==="dark"?"text-gray-300":"text-gray-700"}`,children:"Формат выбора дат"}),s.jsx("div",{className:"flex flex-wrap gap-4",children:[{value:"single",label:"Один день"},{value:"range",label:"Диапазон дат"},{value:"multiple",label:"Конкретные даты"}].map(G=>s.jsxs("label",{className:"flex items-center gap-2 text-sm cursor-pointer",children:[s.jsx("input",{type:"radio",value:G.value,checked:xe===G.value,onChange:fe=>ue(fe.target.value)}),s.jsx("span",{className:a==="dark"?"text-gray-200":"text-gray-700",children:G.label})]},G.value))})]}),(!ne||xe==="single")&&s.jsxs("div",{children:[s.jsx("label",{className:`block text-xs sm:text-sm font-medium mb-2 ${a==="dark"?"text-gray-300":"text-gray-700"}`,children:"Дата"}),s.jsx("input",{type:"date",value:d,onChange:G=>h(G.target.value),className:`w-full px-3 sm:px-4 py-2 sm:py-2.5 text-sm sm:text-base rounded-lg border touch-manipulation ${a==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`})]}),ne&&xe==="range"&&s.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:`block text-xs sm:text-sm font-medium mb-2 ${a==="dark"?"text-gray-300":"text-gray-700"}`,children:"Начало диапазона"}),s.jsx("input",{type:"date",value:O,onChange:G=>W(G.target.value),className:`w-full px-3 sm:px-4 py-2 sm:py-2.5 text-sm sm:text-base rounded-lg border touch-manipulation ${a==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`})]}),s.jsxs("div",{children:[s.jsx("label",{className:`block text-xs sm:text-sm font-medium mb-2 ${a==="dark"?"text-gray-300":"text-gray-700"}`,children:"Конец диапазона"}),s.jsx("input",{type:"date",value:ie,min:O,onChange:G=>P(G.target.value),className:`w-full px-3 sm:px-4 py-2 sm:py-2.5 text-sm sm:text-base rounded-lg border touch-manipulation ${a==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`})]})]}),ne&&xe==="multiple"&&s.jsxs("div",{children:[s.jsx("label",{className:`block text-xs sm:text-sm font-medium mb-2 ${a==="dark"?"text-gray-300":"text-gray-700"}`,children:"Выбранные даты"}),s.jsxs("div",{className:"flex flex-col gap-3",children:[s.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[s.jsx("input",{type:"date",value:oe,onChange:G=>je(G.target.value),className:`flex-1 px-3 sm:px-4 py-2 sm:py-2.5 text-sm sm:text-base rounded-lg border touch-manipulation ${a==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`}),s.jsx("button",{type:"button",onClick:Ae,className:"px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg transition-colors",children:"Добавить"})]}),K.length>0?s.jsx("div",{className:"flex flex-wrap gap-2",children:K.map(G=>s.jsxs("span",{className:"inline-flex items-center gap-2 px-3 py-1.5 rounded-full bg-gray-100 text-gray-800 text-sm",children:[ce(G,"dd.MM.yyyy"),s.jsx("button",{type:"button",onClick:()=>ot(G),className:"text-red-500 hover:text-red-600",children:"x"})]},G))}):s.jsx("p",{className:"text-sm text-gray-500",children:"Пока не выбрано ни одной даты"})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:`block text-xs sm:text-sm font-medium mb-2 ${a==="dark"?"text-gray-300":"text-gray-700"}`,children:"Временные слоты"}),s.jsxs("div",{className:"space-y-2 mb-2",children:[s.jsx("div",{className:"flex flex-col sm:flex-row gap-2",children:s.jsxs("div",{className:"flex gap-2 flex-1",children:[s.jsx("input",{type:"time",value:A,onChange:G=>T(G.target.value),className:`flex-1 px-3 sm:px-4 py-2 sm:py-2.5 text-sm sm:text-base rounded-lg border touch-manipulation ${a==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`,placeholder:"Начало"}),s.jsx("span",{className:"mx-1 sm:mx-2 text-gray-500 text-sm sm:text-base flex items-center",children:"—"}),s.jsx("input",{type:"time",value:S,onChange:G=>z(G.target.value),className:`flex-1 px-3 sm:px-4 py-2 sm:py-2.5 text-sm sm:text-base rounded-lg border touch-manipulation ${a==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`,placeholder:"Окончание"})]})}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("input",{type:"checkbox",id:"crossMidnight",checked:L,onChange:G=>{C(G.target.checked)},className:`w-4 h-4 rounded border-2 ${a==="dark"?"border-gray-800 bg-gray-700 checked:bg-[#4E6E49] checked:border-[#4E6E49]":"border-gray-300 bg-white checked:bg-[#4E6E49] checked:border-[#4E6E49]"} focus:ring-2 focus:ring-[#4E6E49] cursor-pointer touch-manipulation`}),s.jsx("label",{htmlFor:"crossMidnight",className:`text-xs sm:text-sm font-medium cursor-pointer ${a==="dark"?"text-gray-300":"text-gray-700"}`,children:"Переходит через полночь (на следующий день)"})]}),s.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[s.jsx("button",{onClick:Te,className:"w-full px-4 py-2 bg-[#4E6E49] hover:bg-[#4E6E49] text-white rounded-lg transition-colors flex items-center justify-center gap-2",children:y!==null?s.jsxs(s.Fragment,{children:[s.jsx(rr,{className:"w-4 h-4"}),"Сохранить слот"]}):s.jsxs(s.Fragment,{children:[s.jsx(ra,{className:"w-4 h-4"}),"Добавить слот"]})}),y!==null&&s.jsx("button",{onClick:$e,className:`w-full sm:w-auto px-4 py-2 rounded-lg border ${a==="dark"?"border-gray-700 text-gray-200 hover:bg-gray-700":"border-gray-300 text-gray-800 hover:bg-gray-100"}`,children:"Отмена"})]})]}),s.jsx("div",{className:"space-y-3",children:p.map((G,fe)=>s.jsxs("div",{className:`flex flex-col gap-2 p-3 rounded-lg ${a==="dark"?"bg-gray-700":"bg-gray-100"}`,children:[s.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-2",children:[s.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[s.jsxs("span",{className:o,children:[G.start," - ",G.end]}),G.endDate&&s.jsxs("span",{className:`text-xs px-2 py-0.5 rounded-full ${a==="dark"?"bg-blue-500/20 text-blue-400 border border-blue-500/30":"bg-blue-100 text-blue-700 border border-blue-300"}`,children:["до ",ce(new Date(G.endDate),"dd.MM.yyyy")]})]}),s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx("button",{onClick:()=>Z(fe),className:"p-1 text-blue-500 hover:bg-blue-500 hover:text-white rounded transition-colors flex-shrink-0",title:"Редактировать слот",children:s.jsx(rr,{className:"w-4 h-4"})}),s.jsx("button",{onClick:()=>_e(fe),className:"p-1 text-red-500 hover:bg-red-500 hover:text-white rounded transition-colors flex-shrink-0",title:"Удалить слот",children:s.jsx($t,{className:"w-4 h-4"})})]})]}),G.breaks&&G.breaks.length>0&&s.jsxs("div",{className:"ml-4 space-y-1",children:[s.jsx("span",{className:`text-xs ${a==="dark"?"text-gray-400":"text-gray-600"}`,children:"Перерывы:"}),G.breaks.map((Me,We)=>_===fe&&de===We?null:s.jsxs("div",{className:"flex items-center justify-between gap-2",children:[s.jsxs("span",{className:`text-sm ${a==="dark"?"text-gray-300":"text-gray-700"}`,children:[Me.start," - ",Me.end]}),s.jsxs("div",{className:"flex gap-1",children:[s.jsx("button",{onClick:()=>$(fe,We),className:"p-1 text-blue-400 hover:bg-blue-400 hover:text-white rounded transition-colors",title:"Редактировать перерыв",children:s.jsx(rr,{className:"w-3 h-3"})}),s.jsx("button",{onClick:()=>ye(fe,We),className:"p-1 text-red-400 hover:bg-red-400 hover:text-white rounded transition-colors",title:"Удалить перерыв",children:s.jsx(Zt,{className:"w-3 h-3"})})]})]},We))]}),s.jsx("div",{className:"ml-4 space-y-2 border-t pt-2 border-gray-500 border-opacity-30",children:N===fe?s.jsxs("div",{className:"space-y-2",children:[s.jsxs("div",{className:"flex gap-2",children:[s.jsx("input",{type:"time",value:j,onChange:Me=>H(Me.target.value),className:`flex-1 px-3 py-1.5 text-sm rounded-lg border ${a==="dark"?"bg-gray-600 border-gray-500 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`,placeholder:"Начало"}),s.jsx("input",{type:"time",value:Y,onChange:Me=>I(Me.target.value),className:`flex-1 px-3 py-1.5 text-sm rounded-lg border ${a==="dark"?"bg-gray-600 border-gray-500 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`,placeholder:"Конец"})]}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx("button",{onClick:()=>Fe(fe),className:"flex-1 px-3 py-1.5 text-sm bg-[#4E6E49] hover:bg-[#4E6E49] text-white rounded-lg transition-colors",children:_===fe&&de!==null?"Сохранить":"Добавить перерыв"}),s.jsx("button",{onClick:k,className:"px-3 py-1.5 text-sm bg-gray-500 hover:bg-gray-600 text-white rounded-lg transition-colors",children:"Отмена"})]})]}):s.jsxs("button",{onClick:()=>{E(fe),H(""),I(""),x(null),M(null),Ce("")},className:"w-full px-3 py-1.5 text-sm bg-blue-500 hover:bg-blue-600 text-white rounded-lg transition-colors flex items-center justify-center gap-1",children:[s.jsx(ra,{className:"w-3 h-3"}),"Добавить перерыв"]})})]},fe))}),p.length>0&&s.jsxs("p",{className:`text-sm mt-2 ${a==="dark"?"text-gray-400":"text-gray-600"}`,children:["Всего часов: ",ho(p).toFixed(1)]})]}),(!ne||xe==="single")&&s.jsxs("div",{className:"space-y-3",children:[s.jsxs("label",{className:"flex items-center gap-2",children:[s.jsx("input",{type:"checkbox",checked:F,onChange:G=>{V(G.target.checked),Ce("")},className:"w-4 h-4"}),s.jsx("span",{className:`${a==="dark"?"text-gray-300":"text-gray-700"}`,children:"Добавить слоты на актуальную неделю по дням"})]}),F&&s.jsxs("div",{className:"ml-6",children:[s.jsx("p",{className:`text-sm mb-2 ${a==="dark"?"text-gray-400":"text-gray-600"}`,children:"Выберите дни недели:"}),s.jsx("div",{className:"flex gap-2 flex-wrap",children:q.map((G,fe)=>s.jsx("button",{type:"button",onClick:()=>re(fe),className:`px-3 py-1 rounded-lg transition-colors ${te.includes(fe)?"bg-[#4E6E49] text-white":a==="dark"?"bg-gray-700 text-gray-300":"bg-gray-200 text-gray-700"}`,children:G},fe))})]}),s.jsxs("label",{className:"flex items-center gap-2",children:[s.jsx("input",{type:"checkbox",checked:ee,onChange:G=>{J(G.target.checked),Ce("")},className:"w-4 h-4"}),s.jsx("span",{className:`${a==="dark"?"text-gray-300":"text-gray-700"}`,children:"Добавить слоты на месяц вперед по дням"})]}),ee&&s.jsxs("div",{className:"ml-6",children:[s.jsx("p",{className:`text-sm mb-2 ${a==="dark"?"text-gray-400":"text-gray-600"}`,children:"Выберите день недели:"}),s.jsx("div",{className:"flex gap-2 flex-wrap",children:q.map((G,fe)=>s.jsx("button",{type:"button",onClick:()=>Ie(fe),className:`px-3 py-1 rounded-lg transition-colors ${ae.includes(fe)?"bg-[#4E6E49] text-white":a==="dark"?"bg-gray-700 text-gray-300":"bg-gray-200 text-gray-700"}`,children:G},fe))})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:`block text-xs sm:text-sm font-medium mb-2 ${a==="dark"?"text-gray-300":"text-gray-700"}`,children:"Комментарий"}),s.jsx("textarea",{value:X,onChange:G=>R(G.target.value),rows:3,className:`w-full px-3 sm:px-4 py-2 sm:py-2.5 text-sm sm:text-base rounded-lg border touch-manipulation resize-y ${a==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`,placeholder:"Добавьте комментарий (необязательно)"})]}),pe&&s.jsx("div",{className:"p-3 bg-red-500 text-white rounded-lg text-sm",children:pe}),s.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 sm:gap-3 pt-2",children:[s.jsx("button",{onClick:G=>{console.log("Save button clicked!",{loading:ze,slotsCount:p.length,disabled:ze||p.length===0}),G.preventDefault(),Pe()},disabled:ze||p.length===0,className:"flex-1 px-4 py-2.5 sm:py-2 bg-[#4E6E49] hover:bg-[#4E6E49] disabled:bg-gray-400 disabled:cursor-not-allowed text-white rounded-lg sm:rounded-xl transition-colors text-sm sm:text-base font-medium touch-manipulation active:scale-95 disabled:active:scale-100",children:ze?"Отправка...":"Отправить на согласование"}),s.jsx("button",{onClick:e,className:`px-4 py-2.5 sm:py-2 rounded-lg sm:rounded-xl transition-colors text-sm sm:text-base font-medium touch-manipulation active:scale-95 ${a==="dark"?"bg-gray-700 hover:bg-gray-600 active:bg-gray-500":"bg-gray-200 hover:bg-gray-300 active:bg-gray-400"}`,children:"Отмена"})]})]})]})]})})})},z_=({type:r,status:e,onClose:t,onSave:n})=>{const{user:a}=jt(),{theme:i}=it(),{isAdmin:o}=At(),c=i==="dark"?"text-white":"text-gray-900",d=(e==null?void 0:e.date)||ce(new Date,"yyyy-MM-dd"),[h,g]=D.useState(e!=null&&e.userId?[e.userId]:a!=null&&a.id?[a.id]:[]),[f,p]=D.useState(d),[v,A]=D.useState((e==null?void 0:e.endDate)||d),[T,S]=D.useState(!!(e!=null&&e.endDate)),[z,L]=D.useState((e==null?void 0:e.comment)||""),[C,j]=D.useState(r||(e==null?void 0:e.type)||null),[H,Y]=D.useState(""),[I,y]=D.useState(!1),[w,N]=D.useState("single"),[E,_]=D.useState(d),[x,de]=D.useState(d),[M,X]=D.useState(d),[R,ee]=D.useState([]),[J,ae]=D.useState(!1),[U,F]=D.useState([]),[V,te]=D.useState(!1),[me,xe]=D.useState([]),ue=o&&!e,O=["Пн","Вт","Ср","Чт","Пт","Сб","Вс"];In(),D.useEffect(()=>{T||A(f)},[T,f]),D.useEffect(()=>{ue&&w!=="single"&&S(!1)},[ue,w]),D.useEffect(()=>{J||F([])},[J]),D.useEffect(()=>{if(V&&f){const k=new Date(f),ye=k.getDay()===0?6:k.getDay()-1;xe([ye])}},[V,f]),D.useEffect(()=>{w!=="single"&&(ae(!1),F([]),te(!1),xe([]))},[w]);const W=k=>{g(ye=>ye.includes(k)?ye.filter(_e=>_e!==k):[...ye,k])},ie=()=>{h.length===Se.length?g([]):g(Se.map(k=>k.id))},P=()=>{if(!M)return;const k=o0([...R,M]);ee(k),X("")},oe=k=>{ee(ye=>ye.filter(_e=>_e!==k))},je=()=>e?[e.userId]:ue?h:o&&!a?h.length>0?h:[]:a!=null&&a.id?[a.id]:[],K=k=>{var ye;return Qe[k]||((ye=Se.find(_e=>_e.id===k))==null?void 0:ye.name)||k},ge=k=>{if(ue){if(w==="range")return E&&x?k==="dayoff"?$i(E,x).map(_e=>({date:_e})):[{date:E,endDate:x}]:[];if(w==="multiple")return k==="dayoff"?R.map(_e=>({date:_e})):R.map(_e=>({date:_e,endDate:_e}))}if(w==="single"){if(V&&me.length>0){const _e=[],Ie=new Date(f),re=new Date(Ie.getFullYear(),Ie.getMonth()+1,0),ve=me[0],we=new Date(Ie);for(;we<=re;)(we.getDay()===0?6:we.getDay()-1)===ve&&_e.push(ce(we,"yyyy-MM-dd")),we.setDate(we.getDate()+1);return _e.map(Ae=>k==="dayoff"?{date:Ae}:{date:Ae,endDate:Ae})}if(J&&U.length>0){const _e=[],Ie=new Date(f),re=Ie.getDay()===0?6:Ie.getDay()-1;Ie.setDate(Ie.getDate()-re);for(let ve=0;ve<7;ve++){const we=new Date(Ie);we.setDate(Ie.getDate()+ve);const Ae=we.getDay()===0?6:we.getDay()-1;U.includes(Ae)&&_e.push(ce(we,"yyyy-MM-dd"))}return _e.map(ve=>k==="dayoff"?{date:ve}:{date:ve,endDate:ve})}}if(k==="dayoff"){if(w==="range")return $i(E,x).map(_e=>({date:_e}));if(w==="multiple")return R.map(_e=>({date:_e}))}if(w==="range"&&E&&x)return[{date:E,endDate:x}];if(w==="multiple")return R.map(_e=>({date:_e,endDate:_e}));const ye={date:f};return k!=="dayoff"&&(T||e!=null&&e.endDate)&&(ye.endDate=v),[ye]},pe=async(k,ye,_e,Ie)=>{if(o)return null;if(!a)return"Пользователь не найден";const re=new Date,ve=new Date(ye),we=new Date(_e||ye);if(Ie==="dayoff"&&i0(ve,re))return"Нельзя установить выходной на сегодня. Выберите смену или возьмите больничный.";if(Ie==="sick"){const Ae=new Date;Ae.setHours(0,0,0,0);const ot=new Date(Ae);ot.setDate(ot.getDate()+2);const ft=new Date(ye);if(ft.setHours(0,0,0,0),ft<Ae||ft>ot)return"Больничный можно взять только на актуальную дату и + 2 суток. Нельзя выбрать заранее.";const bt=Math.ceil((we.getTime()-ve.getTime())/(1e3*60*60*24))+1;if(bt<1)return"Больничный должен быть минимум на 1 день";if(bt>14)return"Больничный может длиться не более 14 календарных дней в месяце";const De=new Date(ve.getFullYear(),ve.getMonth(),1),lt=new Date(ve.getFullYear(),ve.getMonth()+1,0);if((await br(k)).filter(Ne=>Ne.type==="sick"&&Ne.date>=ce(De,"yyyy-MM-dd")&&Ne.date<=ce(lt,"yyyy-MM-dd")).length+bt>14)return"Больничный ограничен 14 днями в месяц"}if(Ie==="vacation"){if(Math.ceil((we.getTime()-ve.getTime())/864e5)+1>14)return"Отпуск не может быть больше 14 дней в месяце";const ot=new Date(ve.getFullYear(),0,1),ft=new Date(ve.getFullYear(),11,31);if((await br(k)).filter(lt=>lt.type==="vacation"&&lt.date>=ce(ot,"yyyy-MM-dd")&&lt.date<=ce(ft,"yyyy-MM-dd")).length>=6)return"Не более 6 отпусков в год"}if(Ie==="dayoff"){const Ae=new Date(ve);Ae.setDate(Ae.getDate()-Ae.getDay()+1);const ot=new Date(Ae);ot.setDate(Ae.getDate()+6);let bt=(await br(k)).filter(Xe=>Xe.type==="dayoff"&&Xe.date>=ce(Ae,"yyyy-MM-dd")&&Xe.date<=ce(ot,"yyyy-MM-dd"));if(e&&(bt=bt.filter(Xe=>Xe.id!==e.id)),bt.length>=2)return"Выходные на неделе ограничены максимум 2 днями";const lt=(await br()).filter(Xe=>Xe.type==="dayoff"&&Xe.date===ye),Pe=new Set(lt.map(Xe=>Xe.userId));if(e&&e.type==="dayoff"&&e.date===ye&&Pe.delete(e.userId),Pe.size>=3)return"На этот день уже установлено максимальное количество выходных (3 человека). Выберите другую дату."}return null},Ce=async()=>{if(console.log("handleSave called (DayStatusForm)"),!o&&!a){console.log("No user found"),Y("Пользователь не найден");return}if(!C){Y("Выберите тип отсутствия");return}if(e&&!o&&a&&e.userId!==a.id){Y("Вы можете редактировать только свои статусы"),y(!1);return}const k=je();if(k.length===0){Y("Выберите хотя бы одного участника");return}if(ue&&w==="range"){if(!E||!x){Y("Укажите даты начала и окончания");return}if(new Date(x)<new Date(E)){Y("Дата окончания не может быть раньше даты начала");return}}const ye=ge(C);if(ye.length===0){Y("Выберите даты");return}const _e=async(Ie,re)=>{if(!o){const we=await pe(Ie,re.date,re.endDate,C);if(we)throw new Error(`[${K(Ie)} • ${ce(re.date,"dd.MM.yyyy")}] ${we}`)}const ve={id:(e==null?void 0:e.id)||"",userId:Ie,date:re.date,type:C,...re.endDate&&{endDate:re.endDate},...z&&{comment:z}};if(o){const{id:we,...Ae}=ve;e?await ms(e.id,Ae):await lo(Ae)}else await kt({entity:"status",action:e?"update":"create",authorId:(a==null?void 0:a.id)||Ie,targetUserId:Ie,before:e||null,after:ve,comment:z||void 0})};console.log("Starting save process..."),Y(""),y(!0);try{if(e){const Ie={date:f};C!=="dayoff"&&(T||e.endDate)&&(Ie.endDate=v),await _e(e.userId,Ie),n();return}for(const Ie of k)for(const re of ye)await _e(Ie,re);n()}catch(Ie){console.error("Error saving day status:",Ie);const re=Ie.message||Ie.code||"Ошибка при сохранении";Y(re)}finally{y(!1)}},ze={dayoff:"bg-yellow-500",sick:"bg-purple-500",vacation:"bg-orange-500"},Qe={1:"Dex",2:"Enowk",3:"Xenia",4:"Olenka",5:"Sydney"},q=ue&&w==="range"?[`${ce(E,"dd.MM")}–${ce(x,"dd.MM")}`]:ue&&w==="multiple"?R.map(k=>ce(k,"dd.MM")):[ce(f,"dd.MM")],ne=h.map(k=>K(k)).join(", "),Te=[{label:"Тип",detail:C?C==="dayoff"?"Выходной":C==="sick"?"Больничный":"Отпуск":"Не выбран",done:!!C,anchor:"#type"},{label:"Members",detail:ne||"Не выбрано",done:h.length>0||!!e,anchor:"#members"},{label:"Даты",detail:q.slice(0,2).join(" · "),done:q.length>0,anchor:"#dates"},{label:"Комментарий",detail:z?"Заполнен":"Необязателен",done:!!z,anchor:"#notes"}],Z=Math.round(Te.filter(k=>k.done).length/Te.length*100),$e=[{value:"single",label:"Один день",hint:"Быстрая отметка",icon:"•"},{value:"range",label:C==="dayoff"?"Диапазон (каждый день)":"Диапазон дат",hint:"Поток дней",icon:"⎯⎯"},{value:"multiple",label:"Конкретные даты",hint:"Точечный выбор",icon:"◎"}],$=C?`${e?"Редактировать":"Добавить"} ${{dayoff:"выходной",sick:"больничный",vacation:"отпуск"}[C]}`:"Добавить отсутствие";return s.jsx("div",{className:"fixed inset-0 bg-slate-950/80 backdrop-blur-xl flex items-start sm:items-center justify-center z-[70] p-4 sm:p-6 touch-manipulation overflow-y-auto overscroll-contain modal-scroll",children:s.jsx("div",{className:`w-full max-w-[52rem] rounded-3xl shadow-[0_28px_80px_rgba(0,0,0,0.55)] border ${i==="dark"?"bg-[#0b1222] border-white/10":"bg-white border-slate-200"} max-h-[85dvh] sm:max-h-[calc(100dvh-96px)] overflow-y-auto relative`,children:s.jsxs("div",{className:"relative p-4 sm:p-6 lg:p-7 flex flex-col h-full min-h-0 overflow-y-auto modal-scroll",children:[s.jsxs("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-start sm:justify-between",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsx("h3",{className:`text-2xl sm:text-3xl font-bold ${c}`,children:$}),s.jsx("div",{className:"flex flex-wrap gap-2",children:Te.map((k,ye)=>s.jsxs("a",{href:k.anchor,className:`inline-flex items-center gap-2 px-3 py-1.5 rounded-full border text-xs transition ${k.done?"bg-[#4E6E49] border-[#4E6E49] text-white shadow-sm":i==="dark"?"border-white/15 bg-white/5 text-gray-200 hover:border-white/30":"border-slate-200 bg-white text-gray-700 hover:border-slate-300"}`,children:[s.jsx("span",{className:"font-semibold",children:ye+1}),s.jsx("span",{className:"whitespace-nowrap",children:k.label})]},k.label))}),r==="dayoff"&&s.jsx("div",{className:"flex flex-wrap gap-2 text-xs sm:text-sm",children:["Один выходной","Диапазон дней","Несколько дат"].map(k=>s.jsx("span",{className:`px-3 py-1.5 rounded-full border ${i==="dark"?"border-white/10 text-gray-200 bg-white/5":"border-slate-200 text-gray-700 bg-slate-50"}`,children:k},k))})]}),s.jsx("button",{onClick:t,className:`p-2.5 rounded-full border shadow-sm transition hover:-translate-y-0.5 active:translate-y-0 ${i==="dark"?"border-white/10 text-gray-200 hover:bg-white/5":"border-slate-200 text-slate-600 hover:bg-slate-100"}`,children:s.jsx(Zt,{className:"w-5 h-5"})})]}),s.jsx("div",{className:`mt-5 rounded-2xl border ${i==="dark"?"border-white/10 bg-white/5":"border-slate-200 bg-white"} p-4 sm:p-5 shadow-inner`,children:s.jsxs("div",{className:"grid md:grid-cols-3 gap-3 md:gap-4",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"h-10 w-10 rounded-2xl bg-gradient-to-br from-emerald-500/20 to-emerald-400/10 flex items-center justify-center text-emerald-600 dark:text-emerald-300 text-lg font-semibold border border-emerald-500/30",children:"👥"}),s.jsxs("div",{children:[s.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Members"}),s.jsx("p",{className:"text-sm font-semibold text-gray-900 dark:text-gray-100 line-clamp-2",children:ne||"Не выбрано"})]})]}),s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"h-10 w-10 rounded-2xl bg-gradient-to-br from-blue-500/20 to-indigo-500/10 flex items-center justify-center text-blue-600 dark:text-blue-300 text-lg font-semibold border border-blue-500/30",children:"📅"}),s.jsxs("div",{children:[s.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Даты"}),s.jsx("p",{className:"text-sm font-semibold text-gray-900 dark:text-gray-100 line-clamp-2",children:q.length>0?q.join(" · "):"Не выбрано"})]})]}),s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"h-10 w-10 rounded-2xl bg-gradient-to-br from-amber-500/20 to-orange-500/10 flex items-center justify-center text-amber-600 dark:text-amber-300 text-lg font-semibold border border-amber-500/30",children:"✏️"}),s.jsxs("div",{children:[s.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Комментарий"}),s.jsx("p",{className:"text-sm font-semibold text-gray-900 dark:text-gray-100 line-clamp-2",children:z||"Необязателен"})]})]})]})}),s.jsxs("div",{className:"mt-5 grid lg:grid-cols-[0.9fr_1.4fr] gap-4 lg:gap-6 flex-1 overflow-hidden",children:[s.jsxs("aside",{className:`rounded-2xl border ${i==="dark"?"border-white/10 bg-white/5":"border-slate-200 bg-white"} p-4 sm:p-5 space-y-4 sticky top-2 self-start max-h-full overflow-y-auto`,children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("p",{className:"text-sm font-semibold",children:"Навигация"}),s.jsxs("span",{className:"text-[11px] uppercase tracking-wide text-[#4E6E49] font-semibold",children:[Te.length," шага"]})]}),s.jsx("div",{className:"h-1.5 rounded-full bg-slate-200 dark:bg-white/10 overflow-hidden",children:s.jsx("div",{className:"h-full rounded-full bg-gradient-to-r from-[#4E6E49] via-emerald-500 to-lime-400 transition-all",style:{width:`${Z}%`}})}),s.jsx("div",{className:"space-y-2",children:Te.map((k,ye)=>s.jsxs("a",{href:k.anchor,className:`flex items-start gap-3 rounded-xl border px-3 py-3 transition ${i==="dark"?"border-white/10 bg-white/5 hover:border-white/30":"border-slate-200 bg-slate-50 hover:border-slate-300"}`,children:[s.jsx("span",{className:`mt-0.5 inline-flex h-7 w-7 items-center justify-center rounded-full text-xs font-bold ${k.done?"bg-[#4E6E49] text-white shadow-sm":i==="dark"?"bg-slate-800 text-gray-300":"bg-slate-200 text-slate-700"}`,children:ye+1}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsx("p",{className:"text-sm font-semibold",children:k.label}),s.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 truncate",children:k.detail||"—"})]}),s.jsx("span",{className:"text-[11px] text-gray-400",children:k.done?"✓":""})]},k.label))})]}),s.jsxs("div",{className:"space-y-5 overflow-y-auto overscroll-contain pr-1 pb-6 flex-1 min-h-0",children:[!e&&!r&&s.jsxs("div",{id:"type",className:"scroll-mt-20 space-y-2",children:[s.jsx("p",{className:`text-xs sm:text-sm font-medium ${i==="dark"?"text-gray-300":"text-gray-700"}`,children:"Тип отсутствия"}),s.jsx("div",{className:"grid sm:grid-cols-3 gap-2",children:[{key:"dayoff",label:"Выходной",icon:"🌙"},{key:"sick",label:"Больничный",icon:"🏥"},{key:"vacation",label:"Отпуск",icon:"✈️"}].map(k=>s.jsxs("button",{type:"button",onClick:()=>j(k.key),className:`px-4 py-3 rounded-xl border text-sm font-semibold transition ${C===k.key?"border-[#4E6E49] bg-[#4E6E49]/10 text-[#4E6E49] shadow-sm":i==="dark"?"border-white/10 bg-white/5 text-gray-200 hover:border-white/30":"border-slate-200 bg-white text-gray-800 hover:border-slate-300"}`,children:[s.jsx("span",{className:"text-lg",children:k.icon}),s.jsx("span",{className:"block mt-1",children:k.label})]},k.key))})]}),ue&&s.jsxs("div",{id:"members",className:"scroll-mt-20",children:[s.jsx("label",{className:`block text-xs sm:text-sm font-medium mb-2 ${i==="dark"?"text-gray-300":"text-gray-700"}`,children:"Members"}),s.jsxs("div",{className:"space-y-3 rounded-2xl border border-dashed border-[#4E6E49]/30 p-3 sm:p-4 bg-[#4E6E49]/5 dark:bg-[#4E6E49]/10",children:[s.jsx("div",{className:"flex flex-wrap gap-2",children:Se.map(k=>{const ye=h.includes(k.id);return s.jsxs("label",{className:`px-3 py-1.5 rounded-full border cursor-pointer text-sm flex items-center gap-2 transition ${ye?"bg-[#4E6E49] border-[#4E6E49] text-white shadow-sm":i==="dark"?"bg-gray-800/60 border-gray-800 text-gray-200 hover:border-gray-600":"bg-gray-100 border-gray-300 text-gray-700 hover:border-gray-400"}`,children:[s.jsx("input",{type:"checkbox",checked:ye,onChange:()=>W(k.id),className:"hidden"}),Qe[k.id]||k.name]},k.id)})}),s.jsxs("div",{className:"flex items-center justify-between text-sm",children:[s.jsx("span",{className:`${i==="dark"?"text-gray-300":"text-gray-700"}`,children:"Быстрый выбор"}),s.jsx("button",{type:"button",onClick:ie,className:"text-sm text-[#4E6E49] hover:text-[#4E6E49] font-semibold",children:h.length===Se.length?"Снять выделение":"Выбрать всех"})]})]})]}),ue&&s.jsxs("div",{id:"dates",className:"scroll-mt-20",children:[s.jsx("p",{className:`text-xs sm:text-sm font-medium mb-2 ${i==="dark"?"text-gray-300":"text-gray-700"}`,children:"Формат выбора дат"}),s.jsx("div",{className:"grid sm:grid-cols-3 gap-2",children:$e.map(k=>{const ye=w===k.value;return s.jsxs("button",{type:"button",onClick:()=>N(k.value),className:`w-full text-left px-3 py-3 rounded-xl border transition flex flex-col gap-1 ${ye?"border-[#4E6E49] bg-[#4E6E49]/10 text-[#4E6E49] shadow-sm":i==="dark"?"border-white/10 bg-white/5 text-gray-200 hover:border-white/30":"border-slate-200 bg-white text-gray-800 hover:border-slate-300"}`,children:[s.jsx("span",{className:"text-lg leading-none",children:k.icon}),s.jsx("span",{className:"text-sm font-semibold",children:k.label}),s.jsx("span",{className:"text-[11px] text-gray-500 dark:text-gray-400",children:k.hint})]},k.value)})})]}),!ue&&r==="dayoff"&&s.jsxs("div",{id:"dates",className:"scroll-mt-20",children:[s.jsx("p",{className:`text-xs sm:text-sm font-medium mb-2 ${i==="dark"?"text-gray-300":"text-gray-700"}`,children:"Формат выбора дат"}),s.jsx("div",{className:"grid sm:grid-cols-3 gap-2",children:$e.map(k=>{const ye=w===k.value;return s.jsxs("button",{type:"button",onClick:()=>N(k.value),className:`w-full text-left px-3 py-3 rounded-xl border transition flex flex-col gap-1 ${ye?"border-[#4E6E49] bg-[#4E6E49]/10 text-[#4E6E49] shadow-sm":i==="dark"?"border-white/10 bg-white/5 text-gray-200 hover:border-white/30":"border-slate-200 bg-white text-gray-800 hover:border-slate-300"}`,children:[s.jsx("span",{className:"text-lg leading-none",children:k.icon}),s.jsx("span",{className:"text-sm font-semibold",children:k.label}),s.jsx("span",{className:"text-[11px] text-gray-500 dark:text-gray-400",children:k.hint})]},k.value)})})]}),(!ue||w==="single")&&s.jsxs("div",{children:[s.jsx("label",{className:`block text-xs sm:text-sm font-medium mb-2 ${i==="dark"?"text-gray-300":"text-gray-700"}`,children:"Дата начала"}),s.jsx("input",{type:"date",value:f,onChange:k=>p(k.target.value),className:`w-full px-3 sm:px-4 py-2 sm:py-2.5 text-sm sm:text-base rounded-lg border touch-manipulation ${i==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`})]}),ue&&w==="range"&&s.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:`block text-xs sm:text-sm font-medium mb-2 ${i==="dark"?"text-gray-300":"text-gray-700"}`,children:"Начало"}),s.jsx("input",{type:"date",value:E,onChange:k=>_(k.target.value),className:`w-full px-3 sm:px-4 py-2 sm:py-2.5 text-sm sm:text-base rounded-lg border touch-manipulation ${i==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`})]}),s.jsxs("div",{children:[s.jsx("label",{className:`block text-xs sm:text-sm font-medium mb-2 ${i==="dark"?"text-gray-300":"text-gray-700"}`,children:"Конец"}),s.jsx("input",{type:"date",value:x,min:E,onChange:k=>de(k.target.value),className:`w-full px-3 sm:px-4 py-2 sm:py-2.5 text-sm sm:text-base rounded-lg border touch-manipulation ${i==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`})]})]}),!ue&&r==="dayoff"&&w==="range"&&s.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:`block text-xs sm:text-sm font-medium mb-2 ${i==="dark"?"text-gray-300":"text-gray-700"}`,children:"Начало"}),s.jsx("input",{type:"date",value:E,onChange:k=>_(k.target.value),className:`w-full px-3 sm:px-4 py-2 sm:py-2.5 text-sm sm:text-base rounded-lg border touch-manipulation ${i==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`})]}),s.jsxs("div",{children:[s.jsx("label",{className:`block text-xs sm:text-sm font-medium mb-2 ${i==="dark"?"text-gray-300":"text-gray-700"}`,children:"Конец"}),s.jsx("input",{type:"date",value:x,min:E,onChange:k=>de(k.target.value),className:`w-full px-3 sm:px-4 py-2 sm:py-2.5 text-sm sm:text-base rounded-lg border touch-manipulation ${i==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`})]})]}),ue&&w==="multiple"&&s.jsxs("div",{children:[s.jsx("label",{className:`block text-xs sm:text-sm font-medium mb-2 ${i==="dark"?"text-gray-300":"text-gray-700"}`,children:"Выбранные даты"}),s.jsxs("div",{className:"flex flex-col gap-3",children:[s.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[s.jsx("input",{type:"date",value:M,onChange:k=>X(k.target.value),className:`flex-1 px-3 sm:px-4 py-2 sm:py-2.5 text-sm sm:text-base rounded-lg border touch-manipulation ${i==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`}),s.jsx("button",{type:"button",onClick:P,className:"px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg transition-colors",children:"Добавить"})]}),R.length>0?s.jsx("div",{className:"flex flex-wrap gap-2",children:R.map(k=>s.jsxs("span",{className:"inline-flex items-center gap-2 px-3 py-1.5 rounded-full bg-gray-100 text-gray-800 text-sm",children:[ce(k,"dd.MM.yyyy"),s.jsx("button",{type:"button",onClick:()=>oe(k),className:"text-red-500 hover:text-red-600",children:"x"})]},k))}):s.jsx("p",{className:"text-sm text-gray-500",children:"Пока не выбрано ни одной даты"})]})]}),!ue&&r==="dayoff"&&w==="multiple"&&s.jsxs("div",{children:[s.jsx("label",{className:`block text-xs sm:text-sm font-medium mb-2 ${i==="dark"?"text-gray-300":"text-gray-700"}`,children:"Выбранные даты"}),s.jsxs("div",{className:"flex flex-col gap-3",children:[s.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[s.jsx("input",{type:"date",value:M,onChange:k=>X(k.target.value),className:`flex-1 px-3 sm:px-4 py-2 sm:py-2.5 text-sm sm:text-base rounded-lg border touch-manipulation ${i==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`}),s.jsx("button",{type:"button",onClick:P,className:"px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg transition-colors",children:"Добавить"})]}),R.length>0?s.jsx("div",{className:"flex flex-wrap gap-2",children:R.map(k=>s.jsxs("span",{className:"inline-flex items-center gap-2 px-3 py-1.5 rounded-full bg-gray-100 text-gray-800 text-sm",children:[ce(k,"dd.MM.yyyy"),s.jsx("button",{type:"button",onClick:()=>oe(k),className:"text-red-500 hover:text-red-600",children:"x"})]},k))}):s.jsx("p",{className:"text-sm text-gray-500",children:"Пока не выбрано ни одной даты"})]})]}),w==="single"&&!ue&&s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{className:"rounded-xl border border-gray-200 dark:border-gray-800 p-3 sm:p-4 space-y-3",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("p",{className:`text-sm sm:text-base font-semibold ${c}`,children:"Повтор на неделю"}),s.jsx("p",{className:`text-xs ${i==="dark"?"text-gray-400":"text-gray-600"}`,children:"Выберите дни текущей недели"})]}),s.jsxs("label",{className:"inline-flex items-center gap-2",children:[s.jsx("input",{type:"checkbox",checked:J,onChange:k=>ae(k.target.checked),className:"w-4 h-4"}),s.jsx("span",{className:"text-sm",children:"Активировать"})]})]}),J&&s.jsx("div",{className:"flex flex-wrap gap-2",children:O.map((k,ye)=>{const _e=U.includes(ye);return s.jsx("button",{type:"button",onClick:()=>F(Ie=>_e?Ie.filter(re=>re!==ye):[...Ie,ye]),className:`px-3 py-1 rounded-lg border text-sm ${_e?"border-[#4E6E49] bg-[#4E6E49]/10 text-[#4E6E49]":i==="dark"?"border-white/10 bg-white/5 text-gray-200":"border-gray-200 bg-white text-gray-800"}`,children:k},k)})})]}),s.jsxs("div",{className:"rounded-xl border border-gray-200 dark:border-gray-800 p-3 sm:p-4 space-y-3",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("p",{className:`text-sm sm:text-base font-semibold ${c}`,children:"Повтор по месяцу"}),s.jsx("p",{className:`text-xs ${i==="dark"?"text-gray-400":"text-gray-600"}`,children:"На тот же день недели до конца месяца"})]}),s.jsxs("label",{className:"inline-flex items-center gap-2",children:[s.jsx("input",{type:"checkbox",checked:V,onChange:k=>te(k.target.checked),className:"w-4 h-4"}),s.jsx("span",{className:"text-sm",children:"Активировать"})]})]}),V&&s.jsx("div",{className:"flex flex-wrap gap-2",children:O.map((k,ye)=>s.jsx("span",{className:`px-3 py-1 rounded-lg border text-sm ${me.includes(ye)?"border-[#4E6E49] bg-[#4E6E49]/10 text-[#4E6E49]":i==="dark"?"border-white/10 bg-white/5 text-gray-200":"border-gray-200 bg-white text-gray-800"}`,children:k},k))})]})]}),(C==="sick"||C==="vacation")&&(!ue||w==="single")&&s.jsxs("label",{className:"flex items-center gap-2",children:[s.jsx("input",{type:"checkbox",checked:T,onChange:k=>S(k.target.checked),className:"w-4 h-4"}),s.jsx("span",{className:`${i==="dark"?"text-gray-300":"text-gray-700"}`,children:"Несколько дней"})]}),T&&s.jsxs("div",{children:[s.jsx("label",{className:`block text-xs sm:text-sm font-medium mb-2 ${i==="dark"?"text-gray-300":"text-gray-700"}`,children:"Дата окончания"}),s.jsx("input",{type:"date",value:v,onChange:k=>A(k.target.value),min:f,className:`w-full px-3 sm:px-4 py-2 sm:py-2.5 text-sm sm:text-base rounded-lg border touch-manipulation ${i==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`})]}),s.jsxs("div",{children:[s.jsx("label",{className:`block text-xs sm:text-sm font-medium mb-2 ${i==="dark"?"text-gray-300":"text-gray-700"}`,children:"Комментарий"}),s.jsx("textarea",{value:z,onChange:k=>L(k.target.value),rows:3,className:`w-full px-3 sm:px-4 py-2 sm:py-2.5 text-sm sm:text-base rounded-lg border touch-manipulation resize-y ${i==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`,placeholder:"Добавьте комментарий (необязательно)"})]}),H&&s.jsx("div",{className:"p-3 bg-red-500 text-white rounded-lg text-sm",children:H}),s.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 sm:gap-3 pt-2",children:[s.jsx("button",{onClick:Ce,disabled:I||!C,className:`flex-1 px-4 py-2.5 sm:py-2 ${C?ze[C]:"bg-gray-400"} hover:opacity-90 disabled:opacity-50 disabled:cursor-not-allowed text-white rounded-lg sm:rounded-xl transition-colors text-sm sm:text-base font-medium touch-manipulation active:scale-95 disabled:active:scale-100`,children:I?"Отправка...":o?"Сохранить":"Отправить на согласование"}),s.jsx("button",{onClick:t,className:`px-4 py-2.5 sm:py-2 rounded-lg sm:rounded-xl transition-colors text-sm sm:text-base font-medium touch-manipulation active:scale-95 ${i==="dark"?"bg-gray-700 hover:bg-gray-600 active:bg-gray-500":"bg-gray-200 hover:bg-gray-300 active:bg-gray-400"}`,children:"Отмена"})]})]})]})]})})})},H_=({onClose:r,onSave:e})=>{const{user:t}=jt(),{theme:n}=it(),{isAdmin:a}=At(),i=n==="dark"?"text-white":"text-gray-900",[o,c]=D.useState(a?[]:t!=null&&t.id?[t.id]:[]),[d,h]=D.useState("slots"),[g,f]=D.useState(!1),[p,v]=D.useState(!1),[A,T]=D.useState(!1),[S,z]=D.useState([]),[L,C]=D.useState([]),[j,H]=D.useState(""),[Y,I]=D.useState(""),[y,w]=D.useState(""),[N,E]=D.useState(""),[_,x]=D.useState(!1);In();const de=["Пн","Вт","Ср","Чт","Пт","Сб","Вс"],M=g?S.length>0?S.map(F=>de[F]).join(", "):"Дни недели":p?L[0]?`${ce(L[0],"dd.MM")} +${Math.max(L.length-1,0)}`:"Добавьте даты":A?Y&&y?`${ce(Y,"dd.MM")}–${ce(y,"dd.MM")}`:"Укажите диапазон":"Выберите режим",X=o.map(F=>{var V;return((V=Se.find(te=>te.id===F))==null?void 0:V.name)||F}).join(", "),R=F=>{c(V=>V.includes(F)?V.filter(te=>te!==F):[...V,F])},ee=(F,V,te)=>{if(V&&te.some(Boolean)){E("Снимите галочку с другой функции, чтобы активировать эту");return}F(V),V||E("")},J=()=>{if(!j){E("Выберите дату");return}if(L.includes(j)){E("Эта дата уже добавлена");return}C([...L,j].sort()),H(""),E("")},ae=F=>C(L.filter(V=>V!==F)),U=async()=>{var V;if(!a&&!t){E("Пользователь не найден");return}const F=a?o:t?[t.id]:[];if(F.length===0){E("Выберите хотя бы одного участника");return}if(!g&&!p&&!A){E("Выберите способ удаления");return}if(g&&S.length===0){E("Выберите день недели");return}if(p&&L.length===0){E("Добавьте хотя бы одну дату");return}if(A){if(!Y||!y){E("Укажите начальную и конечную дату диапазона");return}if(Y>y){E("Начальная дата должна быть раньше конечной");return}}E(""),x(!0);try{const te=await Promise.all(F.map(pe=>Kr(pe))),me=await Promise.all(F.map(pe=>br(pe))),xe=te.flat(),ue=me.flat(),O=(pe,Ce)=>!Y||!y?!1:!((Ce||pe)<Y||pe>y),W=(pe,Ce)=>L.length===0?!1:Ce?L.some(ze=>ze>=pe&&ze<=(Ce||pe)):L.includes(pe),ie=(pe,Ce)=>{if(S.length===0)return!1;const ze=[],Qe=new Date(pe+"T00:00:00"),q=Ce?new Date(Ce+"T00:00:00"):new Date(pe+"T00:00:00");let ne=Qe;for(;ne<=q;)ze.push(ce(ne,"yyyy-MM-dd")),ne.setDate(ne.getDate()+1);return ze.some(Te=>{const Z=new Date(Te+"T00:00:00"),$e=Z.getDay()===0?6:Z.getDay()-1;return S.includes($e)})};let P=[];if(d==="slots"?P=xe.filter(pe=>!!(g&&ie(pe.date)||p&&L.includes(pe.date)||A&&O(pe.date))).map(pe=>pe.id):P=ue.filter(pe=>pe.type!==d?!1:!!(g&&ie(pe.date,pe.endDate)||p&&W(pe.date,pe.endDate)||A&&O(pe.date,pe.endDate))).map(pe=>pe.id),P.length===0){E("Ничего не найдено под выбранные условия"),x(!1);return}const oe=F.length>1?`${F.length} участников`:((V=Se.find(pe=>pe.id===F[0]))==null?void 0:V.name)||"участника",je=S.map(pe=>de[pe]).join(", "),K=d==="slots"?"слоты":d==="dayoff"?"выходные":d==="sick"?"больничные":"отпуска",ge=g?`по дням недели (${je})`:p?`по датам: ${L.map(pe=>ce(pe,"dd.MM")).join(", ")}`:`по диапазону ${ce(Y,"dd.MM")} — ${ce(y,"dd.MM")}`;if(!confirm(`Удалить ${K} (${P.length}) ${ge} для ${oe}?`)){x(!1);return}if(d==="slots")for(const pe of P)await oo(pe);else for(const pe of P)await co(pe);e(),r()}catch(te){console.error("Error deleting items:",te),E("Ошибка при удалении")}finally{x(!1)}};return s.jsx("div",{className:"fixed inset-0 bg-slate-950/75 backdrop-blur-xl flex items-start sm:items-center justify-center z-[70] p-4 sm:p-6 overflow-y-auto overscroll-contain modal-scroll",children:s.jsx("div",{className:`w-full max-w-5xl rounded-3xl shadow-[0_24px_80px_rgba(0,0,0,0.45)] border ${n==="dark"?"bg-gradient-to-br from-[#0c1320] via-[#0b1220] to-[#08111b] border-white/10":"bg-gradient-to-br from-white via-slate-50 to-white border-slate-200"} max-h-[85dvh] sm:max-h-[calc(100dvh-96px)] overflow-y-auto`,children:s.jsxs("div",{className:"p-5 sm:p-6 lg:p-7 flex flex-col h-full min-h-0 overflow-y-auto modal-scroll",children:[s.jsxs("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between",children:[s.jsxs("div",{className:"space-y-1",children:[s.jsx("div",{className:"flex items-center gap-2 text-xs font-semibold text-[#4E6E49] tracking-tight",children:s.jsx("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full bg-[#4E6E49]/10 text-[#4E6E49] border border-[#4E6E49]/30",children:"Очистить расписание"})}),s.jsx("h3",{className:`text-2xl sm:text-3xl font-bold ${i}`,children:"Удаление слотов и отсутствий"})]}),s.jsx("button",{onClick:r,className:`p-2.5 rounded-full border ${n==="dark"?"border-white/10 text-gray-200 hover:bg-white/5":"border-slate-200 text-slate-600 hover:bg-slate-100"}`,children:s.jsx(Zt,{className:"w-5 h-5"})})]}),s.jsxs("div",{className:"mt-5 grid lg:grid-cols-[0.95fr_1.45fr] gap-4 lg:gap-6 flex-1 overflow-hidden",children:[s.jsxs("aside",{className:`rounded-2xl border ${n==="dark"?"border-white/10 bg-white/5":"border-slate-200 bg-white"} p-4 sm:p-5 space-y-4 sticky top-0 self-start max-h-full overflow-y-auto`,children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("p",{className:"text-sm font-semibold",children:"Навигация"}),s.jsx("span",{className:"text-[11px] uppercase tracking-wide text-[#4E6E49] font-semibold",children:"3 шага"})]}),s.jsx("div",{className:"space-y-2",children:[{label:"Участники",detail:X||"Не выбрано",done:o.length>0||!a},{label:"Тип удаления",detail:d==="slots"?"Слоты":d==="dayoff"?"Выходные":d==="sick"?"Больничные":"Отпуска",done:!0},{label:"Режим",detail:M,done:M!=="Выберите режим"}].map((F,V)=>s.jsxs("div",{className:`flex items-start gap-3 rounded-xl border px-3 py-3 ${n==="dark"?"border-white/10 bg-white/5":"border-slate-200 bg-slate-50"}`,children:[s.jsx("span",{className:`mt-0.5 inline-flex h-6 w-6 items-center justify-center rounded-full text-xs font-bold ${F.done?"bg-[#4E6E49] text-white":n==="dark"?"bg-slate-800 text-gray-300":"bg-slate-200 text-slate-700"}`,children:V+1}),s.jsxs("div",{className:"flex-1",children:[s.jsx("p",{className:"text-sm font-semibold",children:F.label}),s.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 truncate",children:F.detail||"—"})]})]},F.label))}),s.jsxs("div",{className:`rounded-xl border px-3 py-3 space-y-2 ${n==="dark"?"border-emerald-900/50 bg-emerald-900/20":"border-emerald-100 bg-emerald-50"}`,children:[s.jsx("p",{className:"text-xs uppercase tracking-wide text-emerald-600 font-semibold",children:"Подсказка"}),s.jsx("p",{className:"text-sm text-emerald-700 dark:text-emerald-200",children:"Один режим за раз: дни недели, конкретные даты или диапазон."})]})]}),s.jsxs("div",{className:"space-y-4 overflow-y-auto overscroll-contain pr-1 pb-6 flex-1 min-h-0",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsx("p",{className:`text-sm font-semibold ${i}`,children:"Что удаляем"}),s.jsx("div",{className:"flex flex-wrap gap-2",children:[{key:"slots",label:"Слоты"},{key:"dayoff",label:"Выходные"},{key:"sick",label:"Больничные"},{key:"vacation",label:"Отпуска"}].map(F=>s.jsx("button",{onClick:()=>h(F.key),className:`px-3 py-1.5 rounded-lg border text-sm ${d===F.key?"bg-red-500 text-white border-red-500":n==="dark"?"bg-gray-700 text-gray-200 border-gray-700 hover:bg-gray-600":"bg-gray-100 text-gray-800 border-gray-200 hover:bg-gray-200"}`,children:F.label},F.key))})]}),a&&s.jsxs("div",{className:"space-y-2",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("p",{className:`text-sm font-semibold ${i}`,children:"Участники"}),s.jsx("button",{onClick:()=>c(F=>F.length===Se.length?[]:Se.map(V=>V.id)),className:"text-xs text-[#4E6E49] font-semibold",children:o.length===Se.length?"Снять выделение":"Выбрать всех"})]}),s.jsx("div",{className:"flex flex-wrap gap-2",children:Se.map(F=>{const V=o.includes(F.id);return s.jsx("button",{onClick:()=>R(F.id),className:`px-3 py-1.5 rounded-lg transition-colors text-sm ${V?"bg-red-500 text-white":n==="dark"?"bg-gray-700 text-gray-300 hover:bg-gray-600":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:F.name},F.id)})})]}),s.jsxs("label",{className:"flex items-center gap-2",children:[s.jsx("input",{type:"checkbox",checked:g,onChange:F=>ee(f,F.target.checked,[p,A]),className:"w-4 h-4"}),s.jsx("span",{className:`${n==="dark"?"text-gray-300":"text-gray-700"}`,children:"Удалить по дню недели"})]}),g&&s.jsxs("div",{className:"ml-6",children:[s.jsx("p",{className:`text-sm mb-2 ${n==="dark"?"text-gray-400":"text-gray-600"}`,children:"Выберите дни недели:"}),s.jsx("div",{className:"flex gap-2 flex-wrap",children:de.map((F,V)=>{const te=S.includes(V);return s.jsx("button",{onClick:()=>z(me=>te?me.filter(xe=>xe!==V):[...me,V]),className:`px-3 py-1 rounded-lg transition-colors ${te?"bg-red-500 text-white":n==="dark"?"bg-gray-700 text-gray-300":"bg-gray-200 text-gray-700"}`,children:F},F)})})]}),s.jsxs("label",{className:"flex items-center gap-2",children:[s.jsx("input",{type:"checkbox",checked:p,onChange:F=>ee(v,F.target.checked,[g,A]),className:"w-4 h-4"}),s.jsx("span",{className:`${n==="dark"?"text-gray-300":"text-gray-700"}`,children:"Удалить по конкретным датам"})]}),p&&s.jsxs("div",{className:"ml-6 space-y-3",children:[s.jsxs("div",{className:"flex gap-2",children:[s.jsx("input",{type:"date",value:j,onChange:F=>H(F.target.value),className:`flex-1 px-4 py-2 rounded-lg border ${n==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-red-500`}),s.jsx("button",{onClick:J,className:"px-4 py-2 bg-[#4E6E49] hover:bg-[#4E6E49] text-white rounded-lg transition-colors",children:"Добавить"})]}),L.length>0&&s.jsxs("div",{className:"space-y-2",children:[s.jsxs("p",{className:`text-sm ${n==="dark"?"text-gray-400":"text-gray-600"}`,children:["Выбранные даты (",L.length,"):"]}),s.jsx("div",{className:"flex flex-wrap gap-2",children:L.map(F=>s.jsxs("div",{className:`flex items-center gap-2 px-3 py-1 rounded-lg ${n==="dark"?"bg-gray-700":"bg-gray-100"}`,children:[s.jsx("span",{className:i,children:ce(F,"dd.MM.yyyy")}),s.jsx("button",{onClick:()=>ae(F),className:"p-1 text-red-500 hover:bg-red-500 hover:text-white rounded transition-colors",children:s.jsx(Zt,{className:"w-3 h-3"})})]},F))})]})]}),s.jsxs("label",{className:"flex items-center gap-2",children:[s.jsx("input",{type:"checkbox",checked:A,onChange:F=>ee(T,F.target.checked,[g,p]),className:"w-4 h-4"}),s.jsx("span",{className:`${n==="dark"?"text-gray-300":"text-gray-700"}`,children:"Удалить по диапазону дат"})]}),A&&s.jsxs("div",{className:"ml-6 space-y-3",children:[s.jsxs("div",{className:"flex gap-2",children:[s.jsxs("div",{className:"flex-1",children:[s.jsx("label",{className:`block text-xs mb-1 ${n==="dark"?"text-gray-400":"text-gray-600"}`,children:"Начальная дата"}),s.jsx("input",{type:"date",value:Y,onChange:F=>I(F.target.value),className:`w-full px-4 py-2 rounded-lg border ${n==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-red-500`})]}),s.jsxs("div",{className:"flex-1",children:[s.jsx("label",{className:`block text-xs mb-1 ${n==="dark"?"text-gray-400":"text-gray-600"}`,children:"Конечная дата"}),s.jsx("input",{type:"date",value:y,onChange:F=>w(F.target.value),min:Y,className:`w-full px-4 py-2 rounded-lg border ${n==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-red-500`})]})]}),Y&&y&&s.jsxs("p",{className:`text-sm ${n==="dark"?"text-gray-400":"text-gray-600"}`,children:["Будет удалено: с ",ce(Y,"dd.MM.yyyy")," по ",ce(y,"dd.MM.yyyy")]})]}),N&&s.jsx("div",{className:"p-3 bg-red-500 text-white rounded-lg text-sm",children:N}),s.jsxs("div",{className:"flex gap-3",children:[s.jsxs("button",{onClick:U,disabled:_||!g&&!p&&!A,className:"flex-1 px-4 py-2 bg-red-500 hover:bg-red-600 disabled:bg-gray-400 disabled:cursor-not-allowed text-white rounded-lg transition-colors flex items-center justify-center gap-2",children:[s.jsx($t,{className:"w-4 h-4"}),_?"Удаление...":"Очистить расписание"]}),s.jsx("button",{onClick:r,className:`px-4 py-2 rounded-lg transition-colors ${n==="dark"?"bg-gray-700 hover:bg-gray-600":"bg-gray-200 hover:bg-gray-300"}`,children:"Отмена"})]})]})]})]})})})},G_=()=>{const{theme:r}=it(),[e,t]=D.useState("week"),[n,a]=D.useState("all"),[i,o]=D.useState(!1),[c,d]=D.useState(!1),[h,g]=D.useState(!1),[f,p]=D.useState(null),[v,A]=D.useState(null),[T,S]=D.useState(null),[z,L]=D.useState(null),[C,j]=D.useState("add-slot"),[H,Y]=D.useState(0),[I,y]=D.useState({slotsThisWeek:0,activeMembers:0,upcomingSlots:0,completedSlots:0,recommendedWeek:0,recommendedDay:0,mostActive:"",leastActive:[],remainingSlots:0,todaySlots:0}),[w,N]=D.useState({nextStart:null,activeEnd:null}),[E,_]=D.useState({nextStart:"—",activeRemaining:"—"});D.useEffect(()=>{R()},[]),D.useEffect(()=>{const K=(Ce,ze)=>{if(!Ce)return"—";const Qe=Ce.getTime()-Date.now();if(Qe<=0)return ze?"Слот завершён":"Уже начался";const q=Math.floor(Qe/6e4),ne=Math.floor(q/(60*24)),Te=Math.floor(q%(60*24)/60),Z=q%60;return ne>0?`${ne}д ${Te}ч`:Te>0?`${Te}ч ${Z}м`:`${Math.max(Z,1)}м`},ge=()=>{_({nextStart:K(w.nextStart,!1),activeRemaining:K(w.activeEnd,!0)})};ge();const pe=setInterval(ge,6e4);return()=>clearInterval(pe)},[w]);const x=K=>{const ge=new Date;ge.setHours(0,0,0,0);const pe=new Date(K.date);if(pe.setHours(0,0,0,0),pe>ge)return!0;if(pe.getTime()===ge.getTime()){const ze=new Date,Qe=ze.getHours()*60+ze.getMinutes();return K.slots.some(q=>{if(q.endDate){const $e=new Date(q.endDate);if($e.setHours(0,0,0,0),$e>ge)return!0;if($e.getTime()===ge.getTime()){const[Fe,$]=q.end.split(":").map(Number);return Fe*60+$>Qe}return!1}const[ne,Te]=q.end.split(":").map(Number);return ne*60+Te>Qe})}return K.slots.some(ze=>{if(ze.endDate){const Qe=new Date(ze.endDate);return Qe.setHours(0,0,0,0),Qe>=ge}return!1})},de={1:"Dex",2:"Enowk",3:"Xenia",4:"Olenka",5:"Sydney"},M={artyom:"1",adel:"2",kseniya:"3",olga:"4",anastasia:"5"},X=K=>{const ge=Se.find(pe=>pe.id===K)||Se.find(pe=>M[K]===pe.id);return de[(ge==null?void 0:ge.id)||K]||(ge==null?void 0:ge.name)||K},R=async()=>{var K,ge;try{const pe=new Date,Ce=_c(pe),ze=ce(Ce[0],"yyyy-MM-dd"),Qe=ce(Ce[6],"yyyy-MM-dd"),q=ce(pe,"yyyy-MM-dd"),[ne,Te]=await Promise.all([Kr(),br()]),Z=ne.filter(Pe=>Pe.date>=ze&&Pe.date<=Qe),$e=ne.filter(Pe=>Pe.date===q),Fe=new Set([...Z.flatMap(Pe=>[Pe.userId,...Pe.participants||[]]),...Te.map(Pe=>Pe.userId)]),$=Z.filter(x).length,k=Z.length-$,ye=Math.max(0,15-Z.length),_e=Math.max(0,3-$e.length),Ie={};Se.forEach(Pe=>{Ie[Pe.id]=0}),Z.forEach(Pe=>{new Set([Pe.userId,...Pe.participants||[]]).forEach(Ne=>{Ie[Ne]!==void 0&&(Ie[Ne]=(Ie[Ne]||0)+1)})});const re=Object.entries(Ie).sort((Pe,Xe)=>Xe[1]-Pe[1]),ve=(K=re[0])!=null&&K[1]?X(re[0][0]):"Нет данных",we=Math.min(...Object.values(Ie)),Ae=Object.entries(Ie).filter(([,Pe])=>Pe===we).map(([Pe])=>X(Pe)).slice(0,3),ot=ne.flatMap(Pe=>{const Xe=Pe.date;return(Pe.slots||[]).map(Ne=>{const Oe=new Date(`${Xe}T${Ne.start}`);let at=Ne.endDate?new Date(`${Ne.endDate}T${Ne.end}`):new Date(`${Xe}T${Ne.end}`);if(!Ne.endDate&&at.getTime()<=Oe.getTime()){const G=new Date(Xe);G.setDate(G.getDate()+1),at=new Date(`${ce(G,"yyyy-MM-dd")}T${Ne.end}`)}return{start:Oe,end:at}})}),ft=ot.filter(Pe=>pe>=Pe.start&&pe<=Pe.end),bt=ft.length?new Date(Math.min(...ft.map(Pe=>Pe.end.getTime()))):null,lt=((ge=ot.filter(Pe=>Pe.start>pe).sort((Pe,Xe)=>Pe.start.getTime()-Xe.start.getTime())[0])==null?void 0:ge.start)||null;y({slotsThisWeek:Z.length,activeMembers:Fe.size,upcomingSlots:$,completedSlots:k,recommendedWeek:ye,recommendedDay:_e,mostActive:ve,leastActive:Ae,remainingSlots:$,todaySlots:$e.length}),N({nextStart:lt,activeEnd:bt})}catch(pe){console.error("Error loading stats:",pe)}},ee=()=>{S(null),o(!0)},J=K=>{S(K),o(!0)},ae=()=>{p(null),L(null),g(!0),j("absence")},U=K=>{L(K),p(K.type),g(!0)},F=()=>{d(!0)},V=()=>{o(!1),d(!1),g(!1),p(null),S(null),L(null),R(),Y(K=>K+1)},te=r==="dark"?"text-white":"text-gray-900",me=r==="dark"?"text-gray-300":"text-gray-700",xe=r==="dark"?"border-[#4E6E49]/30 bg-gradient-to-br from-[#1a1a1a] via-[#1a1a1a] to-[#0A0A0A]":"border-green-200 bg-gradient-to-br from-white via-green-50/30 to-white",ue=`rounded-2xl p-4 sm:p-6 md:p-8 border-2 ${xe}`,O=`rounded-2xl border ${r==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white"}`,W=r==="dark"?"text-gray-400":"text-gray-600",ie=`rounded-2xl p-4 sm:p-5 border-2 ${xe}`,P={emerald:{bg:r==="dark"?"bg-emerald-500/10":"bg-emerald-50",text:r==="dark"?"text-emerald-100":"text-emerald-800",border:r==="dark"?"border-emerald-500/30":"border-emerald-200"},purple:{bg:r==="dark"?"bg-purple-500/10":"bg-purple-50",text:r==="dark"?"text-purple-100":"text-purple-800",border:r==="dark"?"border-purple-500/30":"border-purple-200"},amber:{bg:r==="dark"?"bg-amber-500/10":"bg-amber-50",text:r==="dark"?"text-amber-100":"text-amber-800",border:r==="dark"?"border-amber-500/30":"border-amber-200"},slate:{bg:r==="dark"?"bg-gray-500/10":"bg-gray-50",text:r==="dark"?"text-gray-100":"text-gray-800",border:r==="dark"?"border-gray-500/30":"border-gray-200"},blue:{bg:r==="dark"?"bg-blue-500/10":"bg-blue-50",text:r==="dark"?"text-blue-100":"text-blue-800",border:r==="dark"?"border-blue-500/30":"border-blue-200"},green:{bg:r==="dark"?"bg-green-500/10":"bg-green-50",text:r==="dark"?"text-green-100":"text-green-800",border:r==="dark"?"border-green-500/30":"border-green-200"},sky:{bg:r==="dark"?"bg-sky-500/10":"bg-sky-50",text:r==="dark"?"text-sky-100":"text-sky-800",border:r==="dark"?"border-sky-500/30":"border-sky-200"},pink:{bg:r==="dark"?"bg-pink-500/10":"bg-pink-50",text:r==="dark"?"text-pink-100":"text-pink-800",border:r==="dark"?"border-pink-500/30":"border-pink-200"}},oe=K=>{t(K)},je=[{label:"Сколько ещё добавить слотов",value:`${Math.max(I.recommendedDay,0)} в день`,note:`Неделя: ${Math.max(I.recommendedWeek,0)} до цели 15`,icon:s.jsx(Et,{className:"w-4 h-4"}),tone:"emerald"},{label:"Активные члены",value:I.activeMembers,note:"за неделю",icon:s.jsx(bn,{className:"w-4 h-4"}),tone:"purple"},{label:"Самый активный член недели",value:I.mostActive||"Нет данных",note:"по слотам",icon:s.jsx(gh,{className:"w-4 h-4"}),tone:"amber"},{label:"Самые неактивные члены недели",value:I.leastActive.length?I.leastActive.join(", "):"Нет данных",note:"минимум слотов",icon:s.jsx(_p,{className:"w-4 h-4"}),tone:"slate"},{label:"Осталось слотов на неделе",value:I.remainingSlots,note:"предстоящие",icon:s.jsx(Op,{className:"w-4 h-4"}),tone:"blue"},{label:"Завершено слотов на неделе",value:I.completedSlots,note:"факт",icon:s.jsx(Io,{className:"w-4 h-4"}),tone:"green"},{label:"Таймер ближайшего слота",value:E.nextStart,note:"до старта",icon:s.jsx(bh,{className:"w-4 h-4"}),tone:"sky"},{label:"До окончания активного слота",value:E.activeRemaining,note:"если слот идёт",icon:s.jsx(Ps,{className:"w-4 h-4"}),tone:"pink"}];return s.jsx(dr,{children:s.jsxs("div",{className:"space-y-5 sm:space-y-7",children:[s.jsxs("div",{id:"schedule-overview",className:`relative overflow-hidden ${ue} p-5 sm:p-6 md:p-8 ${r==="dark"?"bg-gradient-to-br from-[#0e1b2c] via-[#0c1827] to-[#0a1420]":"bg-gradient-to-br from-white via-emerald-50/40 to-sky-50"}`,children:[s.jsxs("div",{className:"absolute inset-0 pointer-events-none",children:[s.jsx("div",{className:"absolute -top-32 -left-16 w-80 h-80 bg-gradient-to-br from-[#4E6E49]/18 via-sky-500/8 to-transparent blur-3xl"}),s.jsx("div",{className:"absolute top-0 right-0 w-[26rem] h-[26rem] bg-gradient-to-bl from-sky-400/14 via-emerald-400/12 to-transparent blur-3xl"}),s.jsx("div",{className:"absolute bottom-[-140px] left-14 w-80 h-80 bg-gradient-to-tr from-sky-300/12 via-[#4E6E49]/12 to-transparent blur-3xl"})]}),s.jsx("div",{className:"relative z-10 grid grid-cols-1 gap-5",children:s.jsxs("div",{className:`${O} backdrop-blur p-4 sm:p-5 space-y-4`,children:[s.jsx("div",{className:"flex flex-col gap-4 sm:gap-5 lg:flex-row lg:items-center lg:justify-between",children:s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"p-3 rounded-2xl bg-white/80 dark:bg-white/5 border border-white/40 dark:border-white/10 shadow-lg",children:s.jsx(Io,{className:"w-6 h-6 text-[#4E6E49]"})}),s.jsx("div",{className:"flex items-center",children:s.jsxs("h1",{className:`text-xl sm:text-3xl font-extrabold leading-tight ${r==="dark"?"text-white":"text-gray-900"}`,children:[s.jsx("span",{className:"sm:inline hidden",children:"Расписание команды"}),s.jsx("span",{className:"sm:hidden inline",children:"Расписание"})]})})]})}),s.jsx("div",{className:"grid sm:grid-cols-2 lg:grid-cols-4 gap-3",children:je.map(K=>{const ge=P[K.tone];return s.jsxs("div",{className:`p-4 rounded-xl border-2 ${ge.border} ${ge.bg} shadow-sm space-y-2`,children:[s.jsxs("div",{className:"flex items-start justify-between gap-3",children:[s.jsx("p",{className:`text-[11px] sm:text-xs font-semibold uppercase tracking-wide ${ge.text}`,children:K.label}),s.jsx("span",{className:`inline-flex items-center gap-1 px-2 py-1 rounded-lg text-[11px] font-semibold border ${ge.border} ${ge.text} ${r==="dark"?"bg-white/5":"bg-white/80"}`,children:K.icon})]}),s.jsx("p",{className:`text-lg sm:text-2xl font-extrabold ${te}`,children:K.value}),s.jsx("p",{className:`text-xs ${W}`,children:K.note})]},K.label)})})]})})]}),s.jsxs("div",{id:"schedule-actions",className:`${ue} p-4 sm:p-5 space-y-5`,children:[s.jsx("div",{className:"space-y-3",children:s.jsxs("div",{className:"flex flex-wrap items-center gap-3 lg:justify-between",children:[s.jsxs("div",{className:`flex items-center gap-2 rounded-xl border ${r==="dark"?"border-gray-800 bg-gray-900/70":"border-gray-200 bg-gray-50"} px-1.5 py-1 shrink-0`,children:[s.jsxs("button",{onClick:()=>oe("table"),className:`px-3 sm:px-4 py-2 text-sm font-semibold flex items-center gap-2 transition-all rounded-lg ${e==="table"?"bg-[#4E6E49] text-white shadow-lg":r==="dark"?"text-gray-300 hover:bg-gray-800":"text-gray-700 hover:bg-white"}`,children:[s.jsx(tf,{className:"w-4 h-4"}),"Таблица"]}),s.jsxs("button",{onClick:()=>oe("week"),className:`px-3 sm:px-4 py-2 text-sm font-semibold flex items-center gap-2 transition-all rounded-lg ${e==="week"?"bg-[#4E6E49] text-white shadow-lg":r==="dark"?"text-gray-300 hover:bg-gray-800":"text-gray-700 hover:bg-white"}`,children:[s.jsx(gs,{className:"w-4 h-4"}),"Неделя"]})]}),s.jsx("div",{className:"flex flex-wrap gap-2 shrink",children:[{key:"all",label:"Все",icon:s.jsx(gs,{className:"w-4 h-4"})},{key:"upcoming",label:"Предстоящие",icon:s.jsx(Ps,{className:"w-4 h-4"})},{key:"completed",label:"Завершённые",icon:s.jsx(Io,{className:"w-4 h-4"})}].map(K=>s.jsxs("button",{onClick:()=>a(K.key),className:`px-3 py-2 rounded-xl text-sm font-semibold flex items-center gap-2 transition-all border ${n===K.key?"bg-gradient-to-r from-[#4E6E49] to-emerald-600 text-white border-transparent shadow-lg":r==="dark"?"border-gray-800 bg-gray-900/70 text-gray-200 hover:border-[#4E6E49]/40":"border-gray-200 bg-gray-50 text-gray-700 hover:border-[#4E6E49]/40"}`,children:[K.icon,K.label]},K.key))})]})}),s.jsxs("div",{className:`${O} p-3 sm:p-4 space-y-3`,children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("p",{className:`text-sm font-semibold ${te}`,children:"Действие"}),s.jsx("span",{className:"text-[11px] uppercase tracking-wide text-gray-500 dark:text-gray-400",children:"выбор задачи"})]}),s.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-2",children:[{key:"add-slot",label:"Добавить слот",desc:"Разовое или серия",icon:s.jsx(xh,{className:"w-5 h-5"}),tone:"bg-emerald-100 text-emerald-800 border-emerald-200 dark:bg-emerald-900/30 dark:text-emerald-100 dark:border-emerald-800",action:ee},{key:"delete-slots",label:"Очистить расписание",desc:"Удалить слоты/статусы",icon:s.jsx($t,{className:"w-5 h-5"}),tone:"bg-rose-100 text-rose-800 border-rose-200 dark:bg-rose-900/30 dark:text-rose-100 dark:border-rose-800",action:F},{key:"absence",label:"Добавить отсутствие",desc:"Выходной, больничный, отпуск",icon:s.jsx(kl,{className:"w-5 h-5"}),tone:"bg-teal-100 text-teal-800 border-teal-200 dark:bg-teal-900/30 dark:text-teal-100 dark:border-teal-800",action:ae}].map(K=>s.jsxs("button",{onClick:()=>{j(K.key),K.action()},className:`text-left rounded-xl border px-3 py-3 transition-all shadow-sm flex items-start gap-3 h-full ${C===K.key?`${K.tone} ring-2 ring-[#4E6E49]/50 shadow-lg`:`${r==="dark"?"border-gray-800 bg-gray-950/60 text-gray-100":"border-gray-200 bg-white text-gray-900"} hover:-translate-y-0.5 hover:shadow-md`}`,children:[s.jsx("span",{className:`p-2 rounded-lg ${C===K.key?"bg-white/30":r==="dark"?"bg-gray-800":"bg-gray-100"}`,children:K.icon}),s.jsxs("span",{className:"flex flex-col whitespace-normal leading-snug gap-0.5 w-full",children:[s.jsx("span",{className:"text-[13px] sm:text-sm font-semibold break-words leading-tight",children:K.label}),s.jsx("span",{className:"text-[11px] sm:text-xs text-gray-500 dark:text-gray-400 break-words leading-tight",children:K.desc})]})]},K.key))})]}),s.jsxs("div",{className:`${O} p-3 sm:p-4 space-y-2`,children:[s.jsx("p",{className:`text-sm font-semibold ${te}`,children:"Members"}),s.jsxs("div",{className:"flex gap-2 overflow-x-auto pb-1",children:[s.jsx("button",{onClick:()=>A(null),className:`px-3 py-2 rounded-xl text-sm font-semibold whitespace-nowrap border transition ${v===null?"bg-gradient-to-r from-[#4E6E49] to-[#4E6E49] text-white border-transparent shadow-lg":r==="dark"?"bg-gray-900/70 border-gray-800 text-gray-200 hover:border-[#4E6E49]/40":"bg-gray-50 border-gray-200 text-gray-700 hover:border-[#4E6E49]/40"}`,children:"Все Members"}),Se.map(K=>s.jsxs("button",{onClick:()=>A(K.id),className:`px-3 py-2 rounded-xl text-sm font-semibold whitespace-nowrap border transition flex items-center gap-2 ${v===K.id?"bg-gradient-to-r from-[#4E6E49] to-[#4E6E49] text-white border-transparent shadow-lg":r==="dark"?"bg-gray-900/70 border-gray-800 text-gray-200 hover:border-[#4E6E49]/40":"bg-gray-50 border-gray-200 text-gray-700 hover:border-[#4E6E49]/40"}`,children:[s.jsx("span",{className:"inline-flex items-center justify-center w-7 h-7 rounded-full bg-gradient-to-br from-[#4E6E49]/30 to-blue-500/30 text-xs font-bold",children:(de[K.id]||K.name).charAt(0)}),de[K.id]||K.name]},K.id))]})]})]}),s.jsx("div",{id:"schedule-view",className:ie,children:s.jsxs("div",{className:`${O} p-4 sm:p-5 flex flex-col gap-4`,children:[s.jsx("div",{className:"flex items-center justify-between flex-wrap gap-2 text-left",children:s.jsxs("div",{className:"text-left",children:[s.jsx("p",{className:`text-sm sm:text-base font-semibold ${te}`,children:"Расписание"}),s.jsx("p",{className:`text-xs sm:text-sm ${me}`,children:"Слоты и статусы за выбранную неделю"})]})}),e==="table"?s.jsx(W_,{selectedUserId:v,slotFilter:n,refreshKey:H,onEditSlot:J,onEditStatus:U}):s.jsx(B_,{selectedUserId:v,slotFilter:n,refreshKey:H,onEditSlot:J,onEditStatus:U})]})}),i&&s.jsx(q_,{slot:T,onClose:V,onSave:V}),c&&s.jsx(H_,{onClose:V,onSave:V}),h&&s.jsx(z_,{type:f||void 0,status:z,onClose:V,onSave:V})]})})},Un=.45,K_=({onClose:r,onSave:e,editingEarning:t})=>{var W,ie;const{user:n}=jt(),{isAdmin:a}=At(),{theme:i}=it(),o=i==="dark"?"text-white":"text-gray-900",c=!!t,[d,h]=D.useState((t==null?void 0:t.date)||ce(new Date,"yyyy-MM-dd")),[g,f]=D.useState((t==null?void 0:t.slotId)||""),[p,v]=D.useState((t==null?void 0:t.amount.toString())||""),[A,T]=D.useState(((W=t==null?void 0:t.extraWalletsCount)==null?void 0:W.toString())||""),[S,z]=D.useState(((ie=t==null?void 0:t.extraWalletsAmount)==null?void 0:ie.toString())||""),[L,C]=D.useState((t==null?void 0:t.category)||"memecoins"),[j,H]=D.useState(t?t.participants.length>1:!1),[Y,I]=D.useState(t?t.participants.filter(P=>P!==t.userId):[]),[y,w]=D.useState([]),[N,E]=D.useState([]),[_,x]=D.useState(""),[de,M]=D.useState(!1);In();const X=(P,oe="w-4 h-4")=>{switch(P){case"memecoins":return s.jsx(ya,{className:oe});case"futures":return s.jsx(xa,{className:oe});case"nft":return s.jsx(fa,{className:oe});case"spot":return s.jsx(fr,{className:oe});case"polymarket":return s.jsx(wl,{className:oe});case"staking":return s.jsx(Ui,{className:oe});default:return s.jsx(Qt,{className:oe})}},R=()=>{var P;return c&&t?(P=t.participants)!=null&&P.length?t.participants:[t.userId]:a&&!n?Y:n?j?Array.from(new Set([n.id,...Y])):[n.id]:[]},ee=R(),J=ee.length,ae=J||1,U=P=>{const oe=parseFloat(P.replace(",","."));return Number.isFinite(oe)?oe:0},F=D.useMemo(()=>{const P=U(p),oe=U(S),je=Math.max(P+oe,0),K=je>0?parseFloat((je*Un).toFixed(2)):0,ge=Math.max(je-K,0),pe=ae>0?parseFloat((ge/ae).toFixed(2)):0;return{gross:je,pool:K,net:ge,share:pe}},[p,S,ae]);D.useEffect(()=>{V()},[d,n,c]);const V=async()=>{if(!(!a&&!n&&!c))try{const P=c||a?await Kr(void 0,d):await Kr(n.id,d),oe=yl(),je=ce(oe,"yyyy-MM-dd"),K=c?P:P.filter(ge=>{if(d!==je)return a;const pe=ge.slots[ge.slots.length-1];return Yu(pe.end,oe)||a});w(K)}catch(P){console.error("Error loading slots:",P)}},te=P=>{Y.includes(P)?I(Y.filter(oe=>oe!==P)):I([...Y,P])},me=()=>{const P=U(p),oe=U(S),je=parseInt(A||"0",10);if(!P&&!oe)return x("Укажите сумму заработка (основную или по доп. кошелькам)"),null;if(P<0||oe<0)return x("Суммы не могут быть отрицательными"),null;if(!L)return x("Выберите сферу заработка"),null;const K=R();if(K.length===0)return x("Выберите хотя бы одного участника"),null;const ge=P+oe;return{id:crypto.randomUUID?crypto.randomUUID():`${Date.now()}-${Math.random()}`,category:L,amount:ge,extraWalletsAmount:oe,extraWalletsCount:Number.isFinite(je)?je:0,participants:K}},xe=()=>{x("");const P=me();P&&(E([...N,P]),v(""),z(""),T(""),I([]),H(!1))},ue=P=>{E(oe=>oe.filter(je=>je.id!==P))},O=async()=>{if(!a&&!n&&!c){x("Пользователь не найден");return}x(""),M(!0);try{if(!g){x("Выберите слот"),M(!1);return}const P=y.find(K=>K.id===g);if(!P&&!c){x("Выбранный слот не найден"),M(!1);return}if(!a&&!c){const K=yl(),ge=ce(K,"yyyy-MM-dd");if(d!==ge){x("Можно добавить заработок только за сегодня"),M(!1);return}if(P){const pe=P.slots[P.slots.length-1];if(!Yu(pe.end,K)){x("Слот еще идет или еще не начат. Можно добавить заработок после 21:00 МСК или после окончания слота"),M(!1);return}}}const oe=K=>({userId:K.userId,date:d,amount:K.amount,poolAmount:K.poolAmount,slotId:g,category:K.category,participants:K.participants,extraWalletsAmount:K.extraWalletsAmount,extraWalletsCount:K.extraWalletsCount}),je=async(K,ge,pe)=>{a?ge==="update"&&t?await Ug(t.id,K):await Fg(K):await kt({entity:"earning",action:ge,authorId:(n==null?void 0:n.id)||K.userId,targetUserId:K.userId,before:pe||null,after:{id:(t==null?void 0:t.id)||"",...K}})};if(c&&t){const K=me();if(!K){M(!1);return}await je(oe({userId:t.userId,amount:K.amount,poolAmount:parseFloat((K.amount*Un).toFixed(2)),category:K.category,participants:K.participants,extraWalletsAmount:K.extraWalletsAmount,extraWalletsCount:K.extraWalletsCount}),"update",t)}else{let K=N;if(K.length===0){const ge=me();if(!ge){M(!1);return}K=[ge]}for(const ge of K)await je(oe({userId:ge.participants[0],amount:ge.amount,poolAmount:parseFloat((ge.amount*Un).toFixed(2)),category:ge.category,participants:ge.participants,extraWalletsAmount:ge.extraWalletsAmount,extraWalletsCount:ge.extraWalletsCount}),"create")}e()}catch(P){console.error("Error saving earnings:",P);const oe=P.message||P.code||"Ошибка при сохранении";x(oe)}finally{M(!1)}};return s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-start sm:items-center justify-center z-[70] p-4 sm:p-6 touch-manipulation overflow-y-auto overflow-x-hidden overscroll-contain modal-scroll",children:s.jsxs("div",{className:`w-full max-w-[540px] sm:max-w-3xl rounded-2xl sm:rounded-3xl shadow-xl ${i==="dark"?"bg-[#1a1a1a]":"bg-white"} max-h-[85dvh] sm:max-h-[calc(100dvh-96px)] flex flex-col overflow-hidden`,children:[s.jsx("div",{className:"flex-shrink-0 p-4 sm:p-6",children:s.jsxs("div",{className:"flex items-center justify-between mb-4 sm:mb-6",children:[s.jsx("h3",{className:`text-lg sm:text-xl font-bold ${o} pr-2`,children:c?"Редактировать заработок":"Добавить заработок"}),s.jsx("button",{onClick:r,className:`p-1.5 sm:p-2 rounded-lg flex-shrink-0 ${i==="dark"?"hover:bg-gray-700 active:bg-gray-600 text-gray-200":"hover:bg-gray-100 active:bg-gray-200 text-gray-700"} transition-colors touch-manipulation`,"aria-label":"Закрыть",children:s.jsx(Zt,{className:"w-4 h-4 sm:w-5 sm:h-5"})})]})}),s.jsx("div",{className:"flex-1 min-h-0 overflow-y-auto overflow-x-hidden overscroll-contain modal-scroll px-4 sm:px-6",children:s.jsxs("div",{className:"space-y-3 sm:space-y-4 pb-8 min-w-0",children:[s.jsxs("div",{children:[s.jsxs("label",{className:`flex flex-col sm:flex-row sm:items-center sm:justify-between text-xs sm:text-sm font-medium mb-2 gap-1 sm:gap-2 ${i==="dark"?"text-gray-300":"text-gray-700"}`,children:[s.jsx("span",{children:"Дата"}),!a&&!c&&s.jsx("span",{className:"text-[10px] sm:text-xs text-gray-400 whitespace-nowrap",children:"Доступна только текущая дата"})]}),s.jsx("input",{type:"date",value:d,onChange:P=>h(P.target.value),disabled:!a&&!c,className:`w-full px-3 sm:px-4 py-2 sm:py-2.5 text-sm sm:text-base rounded-lg border touch-manipulation ${i==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49] disabled:opacity-50 disabled:cursor-not-allowed`}),c&&!a&&s.jsx("p",{className:`mt-1 text-xs ${i==="dark"?"text-gray-400":"text-gray-500"}`,children:"Только администратор может изменить дату"})]}),s.jsxs("div",{children:[s.jsx("label",{className:`block text-xs sm:text-sm font-medium mb-2 ${i==="dark"?"text-gray-300":"text-gray-700"}`,children:"Слот"}),s.jsxs("select",{value:g,onChange:P=>f(P.target.value),className:`w-full px-3 sm:px-4 py-2 sm:py-2.5 text-sm sm:text-base rounded-lg border touch-manipulation ${i==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`,children:[s.jsx("option",{value:"",children:"Выберите слот"}),y.map(P=>s.jsx("option",{value:P.id,children:P.slots.map(oe=>`${oe.start}-${oe.end}`).join(", ")},P.id)),c&&t&&!y.find(P=>P.id===t.slotId)&&s.jsx("option",{value:t.slotId,disabled:!0,children:"[Текущий слот - не найден]"})]}),c&&t&&!y.find(P=>P.id===t.slotId)&&s.jsx("p",{className:`mt-1 text-xs ${i==="dark"?"text-gray-400":"text-gray-500"}`,children:"Текущий слот не найден в списке. Выберите другой слот или оставьте текущий."})]}),s.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[s.jsxs("div",{children:[s.jsx("label",{className:`block text-xs sm:text-sm font-medium mb-2 ${i==="dark"?"text-gray-300":"text-gray-700"}`,children:"Сумма заработка (руб.)"}),s.jsx("input",{type:"number",value:p,onChange:P=>v(P.target.value),className:`w-full px-3 sm:px-4 py-2 sm:py-2.5 text-sm sm:text-base rounded-lg border touch-manipulation ${i==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`,placeholder:"0",min:"0",step:"100"})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[s.jsxs("div",{children:[s.jsx("label",{className:`block text-xs sm:text-sm font-medium mb-2 ${i==="dark"?"text-gray-300":"text-gray-700"}`,children:"Кол-во доп. кошельков"}),s.jsx("input",{type:"number",value:A,onChange:P=>T(P.target.value),className:`w-full px-3 sm:px-4 py-2 sm:py-2.5 text-sm sm:text-base rounded-lg border touch-manipulation ${i==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`,placeholder:"0",min:"0",step:"1"})]}),s.jsxs("div",{children:[s.jsx("label",{className:`block text-xs sm:text-sm font-medium mb-2 ${i==="dark"?"text-gray-300":"text-gray-700"}`,children:"Доп. кошельки (руб.)"}),s.jsx("input",{type:"number",value:S,onChange:P=>z(P.target.value),className:`w-full px-3 sm:px-4 py-2 sm:py-2.5 text-sm sm:text-base rounded-lg border touch-manipulation ${i==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`,placeholder:"0",min:"0",step:"100"})]})]}),s.jsx("div",{className:"space-y-1 text-[11px] text-gray-500",children:s.jsx("p",{children:"Общая сумма = основная + доп. кошельки. Пул 45% считается с общей суммы."})})]})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsxs("div",{className:"flex items-center justify-between gap-2",children:[s.jsx("label",{className:`text-xs sm:text-sm font-medium ${i==="dark"?"text-gray-300":"text-gray-700"}`,children:"Сфера заработка"}),s.jsx("span",{className:"text-[10px] sm:text-xs text-gray-400",children:"Влияет на статистику"})]}),s.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-2",children:Object.entries(Ts).map(([P,oe])=>s.jsxs("button",{type:"button",onClick:()=>C(P),className:`flex items-center gap-2 px-3 py-2 rounded-lg border text-left transition-all ${L===P?"border-[#4E6E49] bg-[#4E6E49]/10 text-[#4E6E49]":i==="dark"?"border-gray-800 bg-gray-800/60 text-gray-200 hover:border-[#4E6E49]/40":"border-gray-200 bg-white text-gray-800 hover:border-[#4E6E49]/40"}`,children:[s.jsx("span",{className:"p-1.5 rounded-lg bg-gray-100 dark:bg-gray-800/80",children:X(P,"w-4 h-4")}),s.jsxs("div",{className:"flex flex-col leading-tight",children:[s.jsx("span",{className:"text-sm font-semibold",children:oe.label}),s.jsx("span",{className:"text-[11px] text-gray-500",children:"45% пул / 55% чистыми"})]})]},P))})]}),s.jsxs(s.Fragment,{children:[s.jsxs("label",{className:"flex items-center gap-2",children:[s.jsx("input",{type:"checkbox",checked:j,onChange:P=>H(P.target.checked),className:"w-4 h-4"}),s.jsx("span",{className:`${i==="dark"?"text-gray-300":"text-gray-700"}`,children:"Отметить несколько участников"})]}),(j||a&&!n)&&s.jsx("div",{className:"ml-0 sm:ml-2 grid grid-cols-2 sm:grid-cols-3 gap-2",children:Se.filter(P=>!n||P.id!==n.id).map(P=>s.jsxs("label",{className:"flex items-center gap-2 rounded-lg px-2 py-1 border border-gray-200 dark:border-gray-800",children:[s.jsx("input",{type:"checkbox",checked:Y.includes(P.id),onChange:()=>te(P.id),className:"w-4 h-4"}),s.jsx("span",{className:i==="dark"?"text-gray-300":"text-gray-700",children:P.name})]},P.id))})]}),s.jsxs("div",{className:`p-4 rounded-xl border ${i==="dark"?"border-gray-800 bg-gray-900/60":"border-gray-200 bg-gray-50"}`,children:[s.jsxs("div",{className:"flex items-center justify-between gap-2 mb-3",children:[s.jsxs("div",{children:[s.jsx("p",{className:`text-xs font-semibold ${i==="dark"?"text-gray-200":"text-gray-800"}`,children:"Авторасчет"}),s.jsx("p",{className:"text-[11px] text-gray-500",children:"Пул 45% + деление между участниками"})]}),s.jsxs("span",{className:"text-[11px] px-2 py-1 rounded-full bg-[#4E6E49]/10 text-[#4E6E49] font-semibold",children:[J||0," участн."]})]}),s.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-2 mb-3",children:[s.jsxs("div",{className:`p-3 rounded-lg ${i==="dark"?"bg-gray-800/70":"bg-white"}`,children:[s.jsx("p",{className:"text-[11px] text-gray-500",children:"Пул (45%)"}),s.jsxs("p",{className:"text-lg font-bold text-purple-500",children:[F.pool.toFixed(2)," ₽"]})]}),s.jsxs("div",{className:`p-3 rounded-lg ${i==="dark"?"bg-gray-800/70":"bg-white"}`,children:[s.jsx("p",{className:"text-[11px] text-gray-500",children:"Чистыми после пула"}),s.jsxs("p",{className:"text-lg font-bold text-emerald-500",children:[F.net.toFixed(2)," ₽"]})]}),s.jsxs("div",{className:`p-3 rounded-lg ${i==="dark"?"bg-gray-800/70":"bg-white"}`,children:[s.jsx("p",{className:"text-[11px] text-gray-500",children:"На каждого"}),s.jsxs("p",{className:"text-lg font-bold text-[#4E6E49]",children:[F.share.toFixed(2)," ₽"]})]})]}),s.jsxs("div",{className:`text-xs ${i==="dark"?"text-gray-400":"text-gray-600"} mb-1`,children:["Отмеченные участники получат по ",F.share.toFixed(2)," ₽"]}),s.jsx("div",{className:"flex flex-wrap gap-2",children:ee.length===0?s.jsx("span",{className:"text-xs text-gray-400",children:"Нет выбранных участников"}):ee.map(P=>{var oe;return s.jsx("span",{className:`px-2.5 py-1 rounded-full text-xs font-semibold border ${i==="dark"?"border-gray-800 bg-gray-800/70 text-gray-100":"border-gray-200 bg-white text-gray-800"}`,children:((oe=Se.find(je=>je.id===P))==null?void 0:oe.name)||P},P)})})]}),!c&&N.length>0&&s.jsxs("div",{className:`rounded-xl border ${i==="dark"?"border-gray-800 bg-gray-900/70":"border-gray-200 bg-gray-50"} p-3 sm:p-4 space-y-3`,children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("p",{className:`text-sm font-semibold ${i==="dark"?"text-gray-200":"text-gray-800"}`,children:"Добавленные записи"}),s.jsxs("span",{className:"text-xs text-gray-500",children:[N.length," шт."]})]}),s.jsx("div",{className:"space-y-2 max-h-64 overflow-y-auto pr-1",children:N.map(P=>s.jsxs("div",{className:`flex flex-col sm:flex-row sm:items-center justify-between gap-3 p-3 rounded-lg border ${i==="dark"?"border-gray-800 bg-gray-800/60":"border-gray-200 bg-white"}`,children:[s.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[s.jsx("div",{className:"p-2 rounded-lg bg-gray-100 dark:bg-gray-900/70",children:X(P.category,"w-4 h-4")}),s.jsxs("div",{className:"min-w-0",children:[s.jsxs("p",{className:"text-sm font-semibold flex items-center gap-2",children:[Ts[P.category].label,s.jsxs("span",{className:"text-[11px] text-gray-500",children:["(",P.participants.length," уч.)"]})]}),s.jsxs("p",{className:"text-xs text-gray-500 whitespace-normal break-words",children:["Гросс ",P.amount.toFixed(0)," ₽ • Пул ",(P.amount*Un).toFixed(0)," ₽ • Чистыми ",(P.amount-P.amount*Un).toFixed(0)," ₽"]}),P.extraWalletsAmount>0&&s.jsxs("p",{className:"text-[11px] text-gray-500",children:["Доп. кошельки: ",P.extraWalletsCount," на ",P.extraWalletsAmount.toFixed(0)," ₽"]})]})]}),s.jsx("button",{type:"button",onClick:()=>ue(P.id),className:`self-start sm:self-center p-2 rounded-lg ${i==="dark"?"hover:bg-gray-700 text-red-400":"hover:bg-gray-100 text-red-600"}`,"aria-label":"Удалить запись",children:s.jsx($t,{className:"w-4 h-4"})})]},P.id))})]}),_&&s.jsx("div",{className:"p-3 bg-red-500 text-white rounded-lg text-sm",children:_}),s.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 sm:gap-3 pt-2",children:[!c&&s.jsxs("button",{type:"button",onClick:xe,disabled:de,className:"flex-1 sm:flex-none sm:px-4 px-4 py-2.5 sm:py-2 border border-[#4E6E49] text-[#4E6E49] rounded-lg sm:rounded-xl font-medium flex items-center justify-center gap-2 hover:bg-[#4E6E49]/10 active:scale-95 transition-colors",children:[s.jsx(xh,{className:"w-4 h-4"}),"Добавить в список"]}),s.jsx("button",{onClick:O,disabled:de,className:"flex-1 px-4 py-2.5 sm:py-2 bg-[#4E6E49] hover:bg-[#4E6E49] disabled:bg-gray-400 disabled:cursor-not-allowed text-white rounded-lg sm:rounded-xl transition-colors text-sm sm:text-base font-medium touch-manipulation active:scale-95 disabled:active:scale-100",children:de?"Сохранение...":c?"Сохранить":"Сохранить все"}),s.jsx("button",{type:"button",onClick:r,className:`flex-1 px-4 py-2.5 sm:py-2 rounded-lg sm:rounded-xl border text-sm sm:text-base font-medium transition-colors touch-manipulation active:scale-95 ${i==="dark"?"border-gray-700 text-gray-200 hover:bg-gray-800":"border-gray-300 text-gray-800 hover:bg-gray-100"}`,children:"Отмена"})]})]})})]})})},Y_=({earnings:r})=>{const{theme:e}=it(),t=.45,n=Ca(),a=ce(n.start,"yyyy-MM-dd"),i=ce(n.end,"yyyy-MM-dd"),o=ce(new Date(new Date().getFullYear(),new Date().getMonth(),1),"yyyy-MM-dd"),c=ce(new Date(new Date().getFullYear(),new Date().getMonth()+1,0),"yyyy-MM-dd"),d=(v,A,T)=>{const S=r.filter(C=>(C.participants&&C.participants.length>0?[...C.participants,C.userId]:[C.userId]).includes(v)&&C.date>=A&&C.date<=T),z=S.reduce((C,j)=>{const H=j.participants&&j.participants.length>0?j.participants.length:1,Y=j.poolAmount||j.amount*t,I=Math.max(j.amount-Y,0);return C+I/H},0),L=S.reduce((C,j)=>{const H=j.participants&&j.participants.length>0?j.participants.length:1,Y=j.poolAmount||j.amount*t;return C+Y/H},0);return{totalEarnings:z,totalPool:L,count:S.length}},h=Se.reduce((v,A)=>{const T=d(A.id,a,i);return v+T.totalEarnings},0),g=Se.reduce((v,A)=>{const T=d(A.id,a,i);return v+T.totalPool},0),f=Se.reduce((v,A)=>{const T=d(A.id,o,c);return v+T.totalEarnings},0),p=Se.reduce((v,A)=>{const T=d(A.id,o,c);return v+T.totalPool},0);return s.jsx("div",{className:`rounded-2xl ${e==="dark"?"bg-[#1a1a1a]":"bg-white"} shadow-lg border-2 ${e==="dark"?"border-gray-800":"border-gray-200"} overflow-hidden`,children:s.jsxs("div",{className:"p-6",children:[s.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[s.jsx("div",{className:`p-2 rounded-lg ${e==="dark"?"bg-blue-500/20":"bg-blue-100"}`,children:s.jsx(Ms,{className:`w-5 h-5 ${e==="dark"?"text-blue-400":"text-blue-600"}`})}),s.jsx("h3",{className:`text-xl font-bold ${e==="dark"?"text-white":"text-gray-900"}`,children:"Статистика заработка"})]}),s.jsxs("div",{className:"mb-6",children:[s.jsx("h4",{className:`text-lg font-semibold mb-4 px-2 ${e==="dark"?"text-white":"text-gray-900"}`,children:"За неделю"}),s.jsx("div",{className:"overflow-x-auto rounded-xl border-2 border-gray-800/50 dark:border-gray-800",children:s.jsxs("table",{className:"w-full",children:[s.jsx("thead",{children:s.jsxs("tr",{className:`${e==="dark"?"bg-gray-700/50":"bg-gray-100"}`,children:[s.jsx("th",{className:`px-4 py-3 text-left text-sm font-semibold ${e==="dark"?"text-white":"text-gray-900"}`,children:"Участник"}),s.jsx("th",{className:`px-4 py-3 text-right text-sm font-semibold ${e==="dark"?"text-white":"text-gray-900"}`,children:"Чистыми"}),s.jsx("th",{className:`px-4 py-3 text-right text-sm font-semibold ${e==="dark"?"text-white":"text-gray-900"}`,children:"Пул 45%"})]})}),s.jsxs("tbody",{children:[Se.map(v=>{const A=d(v.id,a,i);return s.jsxs("tr",{className:`border-b border-gray-800/30 dark:border-gray-800 transition-colors ${e==="dark"?"hover:bg-gray-700/30":"hover:bg-gray-50"}`,children:[s.jsx("td",{className:`px-4 py-3 font-medium ${e==="dark"?"text-white":"text-gray-900"}`,children:v.name}),s.jsxs("td",{className:"px-4 py-3 text-right font-semibold text-[#4E6E49]",children:[A.totalEarnings.toFixed(2)," ₽"]}),s.jsxs("td",{className:`px-4 py-3 text-right font-semibold ${e==="dark"?"text-purple-400":"text-purple-600"}`,children:[A.totalPool.toFixed(2)," ₽"]})]},v.id)}),s.jsxs("tr",{className:`${e==="dark"?"bg-gray-700/70":"bg-gray-100"} font-bold border-t-2 border-gray-800/50 dark:border-gray-800`,children:[s.jsx("td",{className:`px-4 py-3 ${e==="dark"?"text-white":"text-gray-900"}`,children:"Итого команды"}),s.jsxs("td",{className:"px-4 py-3 text-right text-[#4E6E49]",children:[h.toFixed(2)," ₽"]}),s.jsxs("td",{className:`px-4 py-3 text-right ${e==="dark"?"text-purple-400":"text-purple-600"}`,children:[g.toFixed(2)," ₽"]})]})]})]})})]}),s.jsxs("div",{children:[s.jsx("h4",{className:`text-lg font-semibold mb-4 px-2 ${e==="dark"?"text-white":"text-gray-900"}`,children:"За месяц"}),s.jsx("div",{className:"overflow-x-auto rounded-xl border-2 border-gray-800/50 dark:border-gray-800",children:s.jsxs("table",{className:"w-full",children:[s.jsx("thead",{children:s.jsxs("tr",{className:`${e==="dark"?"bg-gray-700/50":"bg-gray-100"}`,children:[s.jsx("th",{className:`px-4 py-3 text-left text-sm font-semibold ${e==="dark"?"text-white":"text-gray-900"}`,children:"Участник"}),s.jsx("th",{className:`px-4 py-3 text-right text-sm font-semibold ${e==="dark"?"text-white":"text-gray-900"}`,children:"Чистыми"}),s.jsx("th",{className:`px-4 py-3 text-right text-sm font-semibold ${e==="dark"?"text-white":"text-gray-900"}`,children:"Пул 45%"})]})}),s.jsxs("tbody",{children:[Se.map(v=>{const A=d(v.id,o,c);return s.jsxs("tr",{className:`border-b border-gray-800/30 dark:border-gray-800 transition-colors ${e==="dark"?"hover:bg-gray-700/30":"hover:bg-gray-50"}`,children:[s.jsx("td",{className:`px-4 py-3 font-medium ${e==="dark"?"text-white":"text-gray-900"}`,children:v.name}),s.jsxs("td",{className:"px-4 py-3 text-right font-semibold text-[#4E6E49]",children:[A.totalEarnings.toFixed(2)," ₽"]}),s.jsxs("td",{className:`px-4 py-3 text-right font-semibold ${e==="dark"?"text-purple-400":"text-purple-600"}`,children:[A.totalPool.toFixed(2)," ₽"]})]},v.id)}),s.jsxs("tr",{className:`${e==="dark"?"bg-gray-700/70":"bg-gray-100"} font-bold border-t-2 border-gray-800/50 dark:border-gray-800`,children:[s.jsx("td",{className:`px-4 py-3 ${e==="dark"?"text-white":"text-gray-900"}`,children:"Итого команды"}),s.jsxs("td",{className:"px-4 py-3 text-right text-[#4E6E49]",children:[f.toFixed(2)," ₽"]}),s.jsxs("td",{className:`px-4 py-3 text-right ${e==="dark"?"text-purple-400":"text-purple-600"}`,children:[p.toFixed(2)," ₽"]})]})]})]})})]})]})})},Q_=({earnings:r,onEdit:e,onDelete:t})=>{const{theme:n}=it(),{user:a}=jt(),{isAdmin:i}=At(),[o,c]=D.useState(null),d=.45,h=(C,j="w-4 h-4")=>{switch(C){case"memecoins":return s.jsx(ya,{className:j});case"futures":return s.jsx(xa,{className:j});case"nft":return s.jsx(fa,{className:j});case"spot":return s.jsx(fr,{className:j});case"polymarket":return s.jsx(wl,{className:j});case"staking":return s.jsx(Ui,{className:j});default:return s.jsx(Qt,{className:j})}},g=async C=>{if(confirm("Вы уверены, что хотите удалить эту запись о заработке?")){c(C.id);try{i?await Bg(C.id):await kt({entity:"earning",action:"delete",authorId:(a==null?void 0:a.id)||C.userId,targetUserId:C.userId,before:C,after:null}),t()}catch(j){console.error("Error deleting earnings:",j),alert("Ошибка при удалении записи")}finally{c(null)}}},f=C=>C.participants&&C.participants.length>0?C.participants:[C.userId],p=C=>C.poolAmount||C.amount*d,v=C=>Math.max(C.amount-p(C),0),A=C=>{const j=f(C);return j.length?v(C)/j.length:v(C)},T=C=>Ts[C]||Ts.other,S=C=>{var j;return((j=Se.find(H=>H.id===C))==null?void 0:j.name)||C},z=C=>i||C.userId===(a==null?void 0:a.id),L=[...r].sort((C,j)=>j.date.localeCompare(C.date));return L.length===0?s.jsxs("div",{className:`rounded-2xl p-8 text-center border-2 ${n==="dark"?"bg-[#1a1a1a] border-gray-800":"bg-white border-gray-200"} shadow-md`,children:[s.jsx("p",{className:`${n==="dark"?"text-gray-400":"text-gray-600"} text-lg`,children:"Пока нет записей о заработке"}),s.jsx("p",{className:"text-gray-500 text-sm mt-2",children:"Добавьте первую запись, чтобы начать отслеживать доходы команды"})]}):s.jsx("div",{className:`rounded-2xl ${n==="dark"?"bg-[#1a1a1a]":"bg-white"} shadow-lg border-2 ${n==="dark"?"border-gray-800":"border-gray-200"} overflow-hidden`,children:s.jsxs("div",{className:"p-6",children:[s.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[s.jsx("div",{className:`p-2 rounded-lg ${n==="dark"?"bg-blue-500/20":"bg-blue-100"}`,children:s.jsx(xd,{className:`w-5 h-5 ${n==="dark"?"text-blue-400":"text-blue-600"}`})}),s.jsx("h3",{className:`text-xl font-bold ${n==="dark"?"text-white":"text-gray-900"}`,children:"Все записи о заработке"})]}),s.jsx("div",{className:"overflow-x-auto rounded-xl border-2 border-gray-800/50 dark:border-gray-800",children:s.jsxs("table",{className:"w-full",children:[s.jsx("thead",{children:s.jsxs("tr",{className:`${n==="dark"?"bg-gray-700/50":"bg-gray-100"}`,children:[s.jsx("th",{className:`px-4 py-3 text-left text-sm font-semibold ${n==="dark"?"text-white":"text-gray-900"}`,children:"Дата"}),s.jsx("th",{className:`px-4 py-3 text-left text-sm font-semibold ${n==="dark"?"text-white":"text-gray-900"}`,children:"Сфера"}),s.jsx("th",{className:`px-4 py-3 text-left text-sm font-semibold ${n==="dark"?"text-white":"text-gray-900"}`,children:"Участники"}),s.jsx("th",{className:`px-4 py-3 text-right text-sm font-semibold ${n==="dark"?"text-white":"text-gray-900"}`,children:"Чистыми"}),s.jsx("th",{className:`px-4 py-3 text-right text-sm font-semibold ${n==="dark"?"text-white":"text-gray-900"}`,children:"Пул 45%"}),s.jsx("th",{className:`px-4 py-3 text-center text-sm font-semibold ${n==="dark"?"text-white":"text-gray-900"}`,children:"Действия"})]})}),s.jsx("tbody",{children:L.map(C=>{const j=f(C),H=T(C.category),Y=v(C),I=A(C),y=z(C);return s.jsxs("tr",{className:`border-b border-gray-800/30 dark:border-gray-800 transition-colors ${n==="dark"?"hover:bg-gray-700/30":"hover:bg-gray-50"}`,children:[s.jsx("td",{className:`px-4 py-3 font-medium ${n==="dark"?"text-white":"text-gray-900"}`,children:ce(new Date(C.date+"T00:00:00"),"dd.MM.yyyy")}),s.jsx("td",{className:"px-4 py-3",children:s.jsxs("span",{className:`inline-flex items-center gap-2 px-2.5 py-1 rounded-full text-xs font-semibold ${n==="dark"?"bg-gray-800 text-gray-100":"bg-gray-100 text-gray-900"}`,children:[h(C.category,"w-4 h-4"),H.label]})}),s.jsx("td",{className:"px-4 py-3",children:s.jsx("div",{className:"flex flex-wrap gap-2",children:j.map(w=>s.jsx("span",{className:`px-2.5 py-1 rounded-full text-xs font-semibold border ${n==="dark"?"border-gray-800 bg-gray-800/70 text-gray-100":"border-gray-200 bg-white text-gray-800"}`,children:S(w)},w))})}),s.jsxs("td",{className:"px-4 py-3 text-right font-semibold text-[#4E6E49]",children:[s.jsxs("div",{children:[Y.toFixed(2)," ₽"]}),s.jsxs("div",{className:"text-xs text-gray-500",children:["по ",I.toFixed(2)," ₽"]}),C.extraWalletsAmount?s.jsxs("div",{className:"text-[11px] text-gray-500 flex items-center gap-1 mt-1",children:[s.jsx(af,{className:"w-3 h-3"}),C.extraWalletsCount||0," / ",C.extraWalletsAmount.toFixed(0)," ₽"]}):null]}),s.jsxs("td",{className:`px-4 py-3 text-right font-semibold ${n==="dark"?"text-purple-400":"text-purple-600"}`,children:[p(C).toFixed(2)," ₽"]}),s.jsx("td",{className:"px-4 py-3 text-center",children:y?s.jsxs("div",{className:"flex items-center justify-center gap-2",children:[s.jsx("button",{onClick:()=>e(C),className:`p-2 rounded-lg transition-colors ${n==="dark"?"hover:bg-gray-600 text-blue-400":"hover:bg-gray-200 text-blue-600"}`,title:"Редактировать",children:s.jsx(xd,{className:"w-4 h-4"})}),s.jsx("button",{onClick:()=>g(C),disabled:o===C.id,className:`p-2 rounded-lg transition-colors ${n==="dark"?"hover:bg-gray-600 text-red-400":"hover:bg-gray-200 text-red-600"} disabled:opacity-50 disabled:cursor-not-allowed`,title:"Удалить",children:s.jsx($t,{className:"w-4 h-4"})})]}):s.jsx("span",{className:`text-sm ${n==="dark"?"text-gray-500":"text-gray-400"}`,children:"—"})})]},C.id)})})]})})]})})},X_=()=>{const{theme:r}=it(),[e,t]=D.useState(!1),[n,a]=D.useState(null),[i,o]=D.useState([]),[c,d]=D.useState(!0),[h,g]=D.useState({weekTotal:0,weekPool:0,weekNet:0,monthTotal:0,monthPool:0,monthNet:0}),f=.45,p=Object.keys(Ts),v=r==="dark"?"bg-[#1a1a1a]":"bg-white",A=_=>_.poolAmount||_.amount*f,T=_=>Math.max(_.amount-A(_),0),S=_=>{var x;return(x=_.participants)!=null&&x.length?_.participants:[_.userId]},z=_=>{var x;return((x=Se.find(de=>de.id===_))==null?void 0:x.name)||_},L=(_,x="w-4 h-4")=>{switch(_){case"memecoins":return s.jsx(ya,{className:x});case"futures":return s.jsx(xa,{className:x});case"nft":return s.jsx(fa,{className:x});case"spot":return s.jsx(fr,{className:x});case"polymarket":return s.jsx(wl,{className:x});case"staking":return s.jsx(Ui,{className:x});default:return s.jsx(Qt,{className:x})}},C=()=>{const _=Ca(),x=ce(_.start,"yyyy-MM-dd"),de=ce(_.end,"yyyy-MM-dd"),M=ce(new Date(new Date().getFullYear(),new Date().getMonth(),1),"yyyy-MM-dd"),X=ce(new Date(new Date().getFullYear(),new Date().getMonth()+1,0),"yyyy-MM-dd"),R=i.filter(J=>J.date>=x&&J.date<=de),ee=i.filter(J=>J.date>=M&&J.date<=X);g({weekTotal:R.reduce((J,ae)=>J+ae.amount,0),weekPool:R.reduce((J,ae)=>J+A(ae),0),weekNet:R.reduce((J,ae)=>J+T(ae),0),monthTotal:ee.reduce((J,ae)=>J+ae.amount,0),monthPool:ee.reduce((J,ae)=>J+A(ae),0),monthNet:ee.reduce((J,ae)=>J+T(ae),0)})};D.useEffect(()=>{j()},[]),D.useEffect(()=>{C()},[i]);const j=async()=>{d(!0);try{const _=await ma();o(_)}catch(_){console.error("Error loading earnings:",_)}finally{d(!1)}},H=_=>{a(_),t(!0)},Y=()=>{t(!1),a(null)},I=()=>{t(!1),a(null),j()},y=p.map(_=>{const x=i.filter(J=>J.category===_),de=x.reduce((J,ae)=>J+ae.amount,0),M=x.reduce((J,ae)=>J+A(ae),0),X=x.reduce((J,ae)=>J+T(ae),0),R=new Map;x.forEach(J=>{const ae=S(J),U=T(J)/Math.max(ae.length,1);ae.forEach(F=>{R.set(F,(R.get(F)||0)+U)})});const ee=Array.from(R.entries()).sort((J,ae)=>ae[1]-J[1]).slice(0,2);return{key:_,gross:de,pool:M,net:X,count:x.length,topParticipants:ee}}),w=Se.map(_=>{const x=i.filter(X=>S(X).includes(_.id)),de=x.reduce((X,R)=>{const ee=T(R)/Math.max(S(R).length,1);return X+ee},0),M=x.reduce((X,R)=>{const ee=A(R)/Math.max(S(R).length,1);return X+ee},0);return{..._,net:de,poolShare:M}}).sort((_,x)=>x.net-_.net),N=[...y].sort((_,x)=>x.net-_.net)[0],E=w[0];return s.jsx(dr,{children:s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:`rounded-xl sm:rounded-2xl p-4 sm:p-6 md:p-8 ${v} shadow-xl border-2 ${r==="dark"?"border-[#4E6E49]/30 bg-gradient-to-br from-[#1a1a1a] via-[#1a1a1a] to-[#0A0A0A]":"border-green-200 bg-gradient-to-br from-white via-green-50/30 to-white"} relative overflow-hidden`,children:[s.jsx("div",{className:"absolute top-0 right-0 w-32 h-32 sm:w-64 sm:h-64 bg-gradient-to-br from-[#4E6E49]/10 to-emerald-700/10 rounded-full blur-3xl -mr-16 sm:-mr-32 -mt-16 sm:-mt-32"}),s.jsx("div",{className:"absolute bottom-0 left-0 w-24 h-24 sm:w-48 sm:h-48 bg-gradient-to-tr from-yellow-500/10 to-orange-500/10 rounded-full blur-2xl -ml-12 sm:-ml-24 -mb-12 sm:-mb-24"}),s.jsx("div",{className:"relative z-10",children:s.jsxs("div",{className:"flex flex-col gap-4 sm:gap-6 lg:flex-row lg:items-start lg:justify-between mb-4 sm:mb-6",children:[s.jsxs("div",{className:"flex-1 min-w-0 space-y-3 sm:space-y-4",children:[s.jsxs("div",{className:"flex items-center gap-3 sm:gap-4",children:[s.jsx("div",{className:"p-3 sm:p-4 rounded-xl sm:rounded-2xl shadow-lg flex-shrink-0 bg-gradient-to-br from-[#4E6E49] to-emerald-700 text-white transform transition-transform active:scale-95 sm:hover:scale-110",children:s.jsx(Fi,{className:"w-5 h-5 sm:w-7 sm:h-7"})}),s.jsx("div",{className:"flex-1 min-w-0",children:s.jsxs("h1",{className:"text-2xl sm:text-3xl md:text-4xl font-extrabold text-white flex items-center gap-2 sm:gap-3 drop-shadow-lg",children:[s.jsx("span",{children:"Заработок команды"}),s.jsx(Qt,{className:`w-5 h-5 sm:w-6 sm:h-6 flex-shrink-0 ${r==="dark"?"text-yellow-300":"text-yellow-500"} animate-pulse`})]})})]}),s.jsx("p",{className:`text-sm sm:text-base font-medium ${r==="dark"?"text-gray-400":"text-gray-600"}`,children:"Отслеживайте доходы и вклад каждого участника в общий успех"}),s.jsx("div",{className:"flex flex-wrap gap-2",children:[{href:"#earn-stats",label:"Обзор"},{href:"#earn-history",label:"История"},{href:"#earn-insights",label:"Инсайты"}].map(_=>s.jsx("a",{href:_.href,className:`px-3 py-1.5 rounded-lg text-xs font-semibold border transition ${r==="dark"?"border-white/10 bg-white/5 text-white hover:border-[#4E6E49]/50":"border-gray-200 bg-white text-gray-800 hover:border-[#4E6E49]/50 hover:text-[#4E6E49]"}`,children:_.label},_.href))})]}),s.jsxs("button",{onClick:()=>t(!0),className:"w-full lg:w-auto px-4 sm:px-6 py-3 sm:py-4 bg-gradient-to-r from-[#4E6E49] to-[#4E6E49] hover:from-[#4E6E49] hover:to-[#4E6E49] text-white rounded-lg sm:rounded-xl transition-all duration-200 flex items-center justify-center gap-2 text-sm sm:text-base font-semibold shadow-lg hover:shadow-xl active:scale-95 sm:hover:scale-105 transform touch-manipulation",children:[s.jsx(ra,{className:"w-4 h-4 sm:w-5 sm:h-5 flex-shrink-0"}),s.jsx("span",{className:"whitespace-nowrap",children:"Добавить заработок"})]})]})}),s.jsxs("div",{id:"earn-stats",className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-6",children:[s.jsxs("div",{className:`p-4 rounded-xl border-2 ${r==="dark"?"bg-blue-500/10 border-blue-500/30":"bg-blue-50 border-blue-200"}`,children:[s.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[s.jsx("div",{className:`p-2 rounded-lg ${r==="dark"?"bg-blue-500/20":"bg-blue-100"}`,children:s.jsx(Ms,{className:`w-5 h-5 ${r==="dark"?"text-blue-400":"text-blue-600"}`})}),s.jsx("p",{className:`text-xs ${r==="dark"?"text-gray-400":"text-gray-600"}`,children:"Неделя (чистыми)"})]}),s.jsxs("p",{className:`text-2xl font-bold ${r==="dark"?"text-blue-400":"text-blue-600"}`,children:[h.weekNet.toFixed(2)," ₽"]}),s.jsxs("p",{className:"text-[11px] text-gray-500 mt-1",children:["Гросс: ",h.weekTotal.toFixed(2)," ₽"]})]}),s.jsxs("div",{className:`p-4 rounded-xl border-2 ${r==="dark"?"bg-purple-500/10 border-purple-500/30":"bg-purple-50 border-purple-200"}`,children:[s.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[s.jsx("div",{className:`p-2 rounded-lg ${r==="dark"?"bg-purple-500/20":"bg-purple-100"}`,children:s.jsx(yd,{className:`w-5 h-5 ${r==="dark"?"text-purple-400":"text-purple-600"}`})}),s.jsx("p",{className:`text-xs ${r==="dark"?"text-gray-400":"text-gray-600"}`,children:"Пул за неделю"})]}),s.jsxs("p",{className:`text-2xl font-bold ${r==="dark"?"text-purple-400":"text-purple-600"}`,children:[h.weekPool.toFixed(2)," ₽"]})]}),s.jsxs("div",{className:`p-4 rounded-xl border-2 ${r==="dark"?"bg-[#4E6E49]/10 border-[#4E6E49]/30":"bg-green-50 border-green-200"}`,children:[s.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[s.jsx("div",{className:`p-2 rounded-lg ${r==="dark"?"bg-[#4E6E49]/20":"bg-green-100"}`,children:s.jsx(of,{className:"w-5 h-5 text-[#4E6E49]"})}),s.jsx("p",{className:`text-xs ${r==="dark"?"text-gray-400":"text-gray-600"}`,children:"Месяц (чистыми)"})]}),s.jsxs("p",{className:"text-2xl font-bold text-[#4E6E49]",children:[h.monthNet.toFixed(2)," ₽"]}),s.jsxs("p",{className:"text-[11px] text-gray-500 mt-1",children:["Гросс: ",h.monthTotal.toFixed(2)," ₽"]})]}),s.jsxs("div",{className:`p-4 rounded-xl border-2 ${r==="dark"?"bg-orange-500/10 border-orange-500/30":"bg-orange-50 border-orange-200"}`,children:[s.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[s.jsx("div",{className:`p-2 rounded-lg ${r==="dark"?"bg-orange-500/20":"bg-orange-100"}`,children:s.jsx(yd,{className:`w-5 h-5 ${r==="dark"?"text-orange-400":"text-orange-600"}`})}),s.jsx("p",{className:`text-xs ${r==="dark"?"text-gray-400":"text-gray-600"}`,children:"Пул за месяц"})]}),s.jsxs("p",{className:`text-2xl font-bold ${r==="dark"?"text-orange-400":"text-orange-600"}`,children:[h.monthPool.toFixed(2)," ₽"]})]})]}),s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4 mb-4",children:[s.jsxs("div",{className:`lg:col-span-2 rounded-2xl p-5 ${v} border ${r==="dark"?"border-white/10":"border-gray-200"} shadow-lg`,children:[s.jsx("div",{className:"flex items-center justify-between mb-4",children:s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:`p-2 rounded-lg ${r==="dark"?"bg-[#4E6E49]/20":"bg-green-100"}`,children:s.jsx(Kp,{className:"w-5 h-5 text-[#4E6E49]"})}),s.jsxs("div",{children:[s.jsx("p",{className:`text-sm font-semibold ${r==="dark"?"text-gray-200":"text-gray-800"}`,children:"Сферы заработка"}),s.jsx("p",{className:"text-xs text-gray-500",children:"Сколько приносит каждый поток"})]})]})}),s.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3",children:y.map(_=>{const x=Ts[_.key];return s.jsxs("div",{className:`p-3 rounded-xl border ${r==="dark"?"border-gray-800 bg-gray-900/70":"border-gray-200 bg-white"} shadow-sm`,children:[s.jsxs("div",{className:"flex items-start justify-between gap-2",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("span",{className:"p-2 rounded-lg bg-gray-100 dark:bg-gray-800/80 flex items-center justify-center",children:L(_.key,"w-4 h-4")}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-semibold",children:x.label}),s.jsxs("p",{className:"text-[11px] text-gray-500",children:[_.count," записей"]})]})]}),s.jsxs("span",{className:"text-sm font-bold text-[#4E6E49]",children:[_.net.toFixed(0)," ₽"]})]}),s.jsxs("div",{className:"grid grid-cols-2 gap-2 mt-2 text-xs text-gray-500",children:[s.jsxs("div",{children:["Пул: ",_.pool.toFixed(0)," ₽"]}),s.jsxs("div",{children:["Гросс: ",_.gross.toFixed(0)," ₽"]})]}),s.jsxs("div",{className:"mt-2",children:[s.jsx("p",{className:"text-[11px] uppercase tracking-wide text-gray-500 mb-1",children:"Топ участники"}),s.jsx("div",{className:"flex flex-wrap gap-1.5",children:_.topParticipants.length===0?s.jsx("span",{className:"text-[11px] text-gray-500",children:"Нет записей"}):_.topParticipants.map(([de,M])=>s.jsxs("span",{className:`px-2 py-1 rounded-full text-[11px] font-semibold ${r==="dark"?"bg-gray-800 text-gray-100":"bg-gray-100 text-gray-800"}`,children:[z(de)," · ",M.toFixed(0)," ₽"]},de))})]})]},_.key)})})]}),s.jsxs("div",{className:`rounded-2xl p-5 ${v} border ${r==="dark"?"border-white/10":"border-gray-200"} shadow-lg`,children:[s.jsx("div",{className:"flex items-center justify-between mb-4",children:s.jsxs("div",{children:[s.jsx("p",{className:`text-sm font-semibold ${r==="dark"?"text-gray-200":"text-gray-800"}`,children:"Лидеры по доходу"}),s.jsx("p",{className:"text-xs text-gray-500",children:"Кто приносит больше всего чистыми"})]})}),s.jsxs("div",{className:"space-y-3",children:[w.slice(0,3).map((_,x)=>s.jsxs("div",{className:`flex items-center justify-between p-3 rounded-xl border ${r==="dark"?"border-gray-800 bg-gray-900/70":"border-gray-200 bg-white"}`,children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("span",{className:`w-7 h-7 rounded-full flex items-center justify-center text-sm font-bold ${r==="dark"?"bg-gray-800 text-gray-100":"bg-gray-100 text-gray-800"}`,children:x+1}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-semibold",children:_.name}),s.jsxs("p",{className:"text-[11px] text-gray-500",children:["Пул: ",_.poolShare.toFixed(0)," ₽"]})]})]}),s.jsxs("div",{className:"text-right",children:[s.jsxs("p",{className:"text-base font-bold text-[#4E6E49]",children:[_.net.toFixed(0)," ₽"]}),s.jsx("p",{className:"text-[11px] text-gray-500",children:"чистыми"})]})]},_.id)),w.length===0&&s.jsx("p",{className:"text-sm text-gray-500",children:"Нет данных по заработку"})]})]})]}),s.jsx("div",{className:"hidden sm:flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between pt-4 border-t border-gray-800/50 dark:border-gray-800",children:s.jsx("h2",{className:`text-base sm:text-lg md:text-xl font-semibold ${r==="dark"?"text-white":"text-gray-900"}`,children:"Управление заработком"})})]}),c?s.jsx("div",{className:`rounded-xl p-8 text-center border-2 ${r==="dark"?"bg-[#1a1a1a] border-gray-800":"bg-white border-gray-200"} shadow-md`,children:s.jsxs("div",{className:"flex flex-col items-center gap-3",children:[s.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-[#4E6E49]"}),s.jsx("p",{className:r==="dark"?"text-gray-400":"text-gray-600",children:"Загрузка данных..."})]})}):s.jsxs(s.Fragment,{children:[s.jsxs("div",{id:"earn-history",className:"space-y-6",children:[s.jsx(Y_,{earnings:i}),s.jsx(Q_,{earnings:i,onEdit:H,onDelete:j})]}),s.jsxs("div",{id:"earn-insights",className:`rounded-2xl p-6 ${v} border ${r==="dark"?"border-white/10":"border-gray-200"} shadow-lg space-y-4`,children:[s.jsx("div",{className:"flex items-center justify-between",children:s.jsxs("div",{children:[s.jsx("p",{className:`text-sm font-semibold ${r==="dark"?"text-gray-300":"text-gray-700"}`,children:"Инсайты"}),s.jsx("p",{className:`text-xs ${r==="dark"?"text-gray-400":"text-gray-500"}`,children:"Где мы зарабатываем больше всего"})]})}),s.jsx("div",{className:"grid sm:grid-cols-2 lg:grid-cols-4 gap-3",children:[{label:"Топ категория",value:N?`${Ts[N.key].label} · ${N.net.toFixed(0)} ₽`:"Нет данных",tone:"bg-blue-500/10 text-blue-600 dark:text-blue-200"},{label:"Лидер команды",value:E?`${E.name} · ${E.net.toFixed(0)} ₽`:"Нет данных",tone:"bg-purple-500/10 text-purple-600 dark:text-purple-200"},{label:"Доля пула (мес.)",value:h.monthTotal?`${Math.round(h.monthPool/h.monthTotal*100)}%`:"45%",tone:"bg-emerald-500/10 text-emerald-600 dark:text-emerald-200"},{label:"Средняя выплата",value:i.length?`${(i.reduce((_,x)=>_+T(x),0)/i.length).toFixed(0)} ₽`:"0 ₽",tone:"bg-orange-500/10 text-orange-600 dark:text-orange-200"}].map(_=>s.jsxs("div",{className:`p-3 rounded-xl ${_.tone} border ${r==="dark"?"border-white/10":"border-transparent"} shadow-sm`,children:[s.jsx("p",{className:"text-[11px] uppercase tracking-wide opacity-70",children:_.label}),s.jsx("p",{className:"text-xl font-extrabold",children:_.value})]},_.label))})]})]}),e&&s.jsx(K_,{onClose:Y,onSave:I,editingEarning:n})]})})},J_=({rating:r,place:e})=>{const{theme:t}=it(),[n,a]=D.useState(null),i=Se.find(j=>j.id===r.userId),o=t==="dark"?"text-white":"text-gray-900",c=t==="dark"?"text-gray-400":"text-gray-600",d=t==="dark"?"bg-[#0f0f0f]":"bg-white",h=t==="dark"?"border-white/10":"border-gray-200",g=t==="dark"?"hover:bg-white/5":"hover:bg-gray-50",f=t==="dark"?"bg-white/5":"bg-gray-50/80",p=r.rating<=0?"4%":`${Math.min(r.rating,100)}%`,v=r.rating>=80?"bg-emerald-500":r.rating>=60?"bg-blue-500":r.rating>=40?"bg-amber-500":"bg-rose-500",A=r.rating>=80?"#10b981":r.rating>=60?"#3b82f6":r.rating>=40?"#f59e0b":"#f43f5e",S={1:{bg:t==="dark"?"bg-emerald-500/10":"bg-emerald-50",border:t==="dark"?"border-emerald-400/30":"border-emerald-200",text:t==="dark"?"text-emerald-100":"text-emerald-900",icon:t==="dark"?"text-emerald-200":"text-emerald-600",soft:t==="dark"?"bg-emerald-500/8":"bg-emerald-50"},2:{bg:t==="dark"?"bg-sky-500/10":"bg-sky-50",border:t==="dark"?"border-sky-400/30":"border-sky-200",text:t==="dark"?"text-sky-100":"text-sky-900",icon:t==="dark"?"text-sky-200":"text-sky-600",soft:t==="dark"?"bg-sky-500/8":"bg-sky-50"},3:{bg:t==="dark"?"bg-purple-500/10":"bg-purple-50",border:t==="dark"?"border-purple-400/30":"border-purple-200",text:t==="dark"?"text-purple-100":"text-purple-900",icon:t==="dark"?"text-purple-200":"text-purple-600",soft:t==="dark"?"bg-purple-500/8":"bg-purple-50"},4:{bg:t==="dark"?"bg-amber-500/10":"bg-amber-50",border:t==="dark"?"border-amber-400/30":"border-amber-200",text:t==="dark"?"text-amber-100":"text-amber-900",icon:t==="dark"?"text-amber-200":"text-amber-600",soft:t==="dark"?"bg-amber-500/8":"bg-amber-50"},5:{bg:t==="dark"?"bg-rose-500/10":"bg-rose-50",border:t==="dark"?"border-rose-400/30":"border-rose-200",text:t==="dark"?"text-rose-100":"text-rose-900",icon:t==="dark"?"text-rose-200":"text-rose-600",soft:t==="dark"?"bg-rose-500/8":"bg-rose-50"},default:{bg:t==="dark"?"bg-white/5":"bg-gray-50",border:t==="dark"?"border-white/10":"border-gray-200",text:t==="dark"?"text-white":"text-gray-900",icon:t==="dark"?"text-white":"text-gray-700",soft:t==="dark"?"bg-white/5":"bg-gray-50"}}[(i==null?void 0:i.id)||"default"],z=r.breakdown?[{icon:s.jsx(gs,{className:"w-5 h-5"}),label:"Выходные",value:`${r.breakdown.daysOff} день`,points:r.breakdown.daysOffPoints,maxPoints:10,explanation:"0-2 выходных в неделю = 10% к рейтингу. Более 2 выходных = 0%. Показывает стабильность присутствия.",threshold:"0-2 дня",color:"bg-amber-200 text-amber-900"},{icon:s.jsx($p,{className:"w-5 h-5"}),label:"Больничные",value:`${r.breakdown.sickDays} дней`,points:r.breakdown.sickDaysPoints,maxPoints:10,explanation:"До 7 дней больничного в месяц = 10% к рейтингу. Более 7 дней = 0%. Учитывается за последние 30 дней.",threshold:"≤7 дней",color:"bg-purple-200 text-purple-900"},{icon:s.jsx(Yp,{className:"w-5 h-5"}),label:"Отпуск",value:`${r.breakdown.vacationDays} дней`,points:r.breakdown.vacationDaysPoints,maxPoints:10,explanation:"До 7 дней отпуска в месяц = 10% к рейтингу. Более 7 дней = 0%. Учитывается за последние 30 дней.",threshold:"≤7 дней",color:"bg-orange-200 text-orange-900"},{icon:s.jsx(Ps,{className:"w-5 h-5"}),label:"Часы работы",value:M_(r.breakdown.weeklyHours),points:r.breakdown.weeklyHoursPoints,maxPoints:25,explanation:"20+ часов в неделю = 25% к рейтингу. 15-19 часов = 15%. Менее 15 часов = 0%. Показывает объем работы за неделю.",threshold:"≥20ч: 25% | ≥15ч: 15%",color:"bg-blue-200 text-blue-900"},{icon:s.jsx(Fi,{className:"w-5 h-5"}),label:"Заработок",value:`${r.breakdown.weeklyEarnings.toFixed(2)} ₽`,points:r.breakdown.weeklyEarningsPoints,maxPoints:30,explanation:"6000+ ₽ в неделю = 30% к рейтингу. 3000-5999 ₽ = 15%. Менее 3000 ₽ = 0%. Основной показатель эффективности.",threshold:"≥6000₽: 30% | ≥3000₽: 15%",color:"bg-emerald-200 text-emerald-900"},{icon:s.jsx(bn,{className:"w-5 h-5"}),label:"Рефералы",value:`${r.breakdown.referrals} чел.`,points:r.breakdown.referralsPoints,maxPoints:30,explanation:"5% к рейтингу за каждого реферала. Максимум 30% (6 рефералов). Учитываются за последние 30 дней. Показывает активность по привлечению новых участников.",threshold:"5% за каждого (макс 30%)",color:"bg-pink-200 text-pink-900"},{icon:s.jsx(Ys,{className:"w-5 h-5"}),label:"Сообщения",value:`${r.breakdown.weeklyMessages} сообщений`,points:r.breakdown.weeklyMessagesPoints,maxPoints:15,explanation:"Более 50 сообщений в неделю в группе = 15% к рейтингу. Менее 50 = 0%. Учитываются все типы сообщений (текст, фото, стикеры и т.д.). Показывает активность в общении.",threshold:">50 сообщений",color:"bg-indigo-200 text-indigo-900"}]:[],L=z.reduce((j,H)=>j+H.points,0),C=(()=>{if(!e)return null;const j=e.rank,H=j===1?{bg:"from-amber-400 to-amber-600",ring:"ring-amber-300/50",icon:"🥇"}:j===2?{bg:"from-slate-300 to-slate-500",ring:"ring-slate-300/50",icon:"🥈"}:j===3?{bg:"from-amber-200 to-amber-500",ring:"ring-amber-200/40",icon:"🥉"}:{bg:"from-gray-200 to-gray-400",ring:"ring-gray-200/40",icon:j.toString()};return s.jsx("div",{className:"absolute top-3 right-3",children:s.jsx("div",{className:`w-10 h-10 rounded-full bg-gradient-to-br ${H.bg} ring-4 ${H.ring} shadow-lg grid place-items-center text-lg font-semibold`,children:H.icon})})})();return s.jsxs("div",{className:`relative rounded-2xl p-6 ${d} shadow-sm border ${h} transition-colors`,children:[C,s.jsxs("div",{className:"mb-5 flex flex-col gap-3",children:[s.jsx("div",{className:"flex items-start justify-between gap-3",children:s.jsxs("div",{className:"min-w-0",children:[s.jsx("p",{className:`text-[11px] uppercase tracking-[0.12em] ${c}`,children:"Участник"}),s.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[s.jsxs("h3",{className:`text-2xl font-bold ${o} truncate`,children:["@",(i==null?void 0:i.login)||"unknown"]}),(i==null?void 0:i.name)&&s.jsx("span",{className:`text-xs ${c}`,children:i.name})]}),s.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[s.jsxs("span",{className:`px-2.5 py-1 rounded-lg text-xs font-semibold border ${S.border} ${S.bg} ${S.text} flex items-center gap-1`,children:[s.jsx("span",{className:`text-lg leading-none ${S.icon}`,children:"●"}),s.jsx("span",{children:"Ник"})]}),s.jsx("div",{className:"flex items-center gap-2",children:s.jsxs("span",{className:"text-lg font-bold",style:{color:A},children:[r.rating.toFixed(1),"%"]})})]})]})}),s.jsxs("div",{children:[s.jsx("div",{className:"w-full bg-gray-200/70 dark:bg-gray-800 rounded-full h-6 overflow-hidden shadow-inner",children:s.jsx("div",{className:`h-full transition-all duration-500 flex items-center justify-center text-sm font-semibold text-white ${v}`,style:{width:p,minWidth:r.rating<=0?"40px":void 0},children:r.rating>=8&&s.jsxs("span",{children:[r.rating.toFixed(0),"%"]})})}),s.jsxs("div",{className:"flex justify-between mt-1",children:[s.jsx("span",{className:`text-xs ${c}`,children:"Общий рейтинг"}),s.jsxs("span",{className:`text-xs font-semibold ${c}`,children:[L,"/100 баллов"]})]})]})]}),r.breakdown&&s.jsxs("div",{className:"space-y-3 mb-6",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[s.jsx(Ms,{className:`w-5 h-5 ${c}`}),s.jsx("h4",{className:`text-lg font-semibold ${o}`,children:"Детальный разбор рейтинга"})]}),z.map((j,H)=>{const Y=j.maxPoints>0?j.points/j.maxPoints*100:0,I=n===H;return s.jsxs("div",{className:`rounded-lg border ${h} overflow-hidden transition-all ${I?"shadow-md":""}`,children:[s.jsx("button",{onClick:()=>a(I?null:H),className:`w-full p-4 flex items-center justify-between ${g} transition-colors`,children:s.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[s.jsx("div",{className:`p-2 rounded-lg ${j.color} flex-shrink-0`,children:j.icon}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsxs("div",{className:"flex items-center justify-between mb-1",children:[s.jsx("span",{className:`font-semibold ${o} truncate`,children:j.label}),s.jsxs("span",{className:`font-bold ml-2 ${j.points>0?"text-[#4E6E49]":"text-red-500"}`,children:[j.points,"/",j.maxPoints]})]}),s.jsx("div",{className:"w-full bg-gray-200 dark:bg-gray-800 rounded-full h-2 overflow-hidden",children:s.jsx("div",{className:`h-full transition-all duration-300 ${j.color}`,style:{width:`${Y}%`}})}),s.jsxs("div",{className:"flex items-center justify-between mt-1",children:[s.jsx("span",{className:`text-xs ${c} truncate mr-2`,children:j.value}),s.jsx("span",{className:`text-xs ${c} whitespace-nowrap`,children:j.threshold})]})]}),s.jsx(ln,{className:`w-4 h-4 flex-shrink-0 ml-2 ${c} transition-transform ${I?"rotate-180":""}`})]})}),I&&s.jsx("div",{className:`px-4 pb-4 pt-2 border-t ${h} ${f}`,children:s.jsx("p",{className:`text-sm ${c} leading-relaxed`,children:j.explanation})})]},H)})]}),s.jsxs("div",{className:`pt-4 border-t ${h}`,children:[s.jsx("h4",{className:`text-sm font-semibold mb-3 ${o}`,children:"Дополнительная статистика"}),s.jsxs("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[s.jsxs("div",{className:`p-3 rounded-lg ${f}`,children:[s.jsx("div",{className:`text-xs ${c} mb-1`,children:"Заработок (месяц)"}),s.jsxs("div",{className:`text-lg font-bold ${o}`,children:[r.earnings.toFixed(0)," ₽"]})]}),s.jsxs("div",{className:`p-3 rounded-lg ${f}`,children:[s.jsx("div",{className:`text-xs ${c} mb-1`,children:"В пул"}),s.jsxs("div",{className:`text-lg font-bold ${o}`,children:[r.poolAmount.toFixed(0)," ₽"]})]})]})]})]})},qo=()=>`REF-${Math.random().toString(36).slice(2,8).toUpperCase()}`,Z_=({referral:r,onClose:e,onSave:t})=>{const{user:n}=jt(),{isAdmin:a}=At(),{theme:i}=it(),[o,c]=D.useState(""),[d,h]=D.useState(""),[g,f]=D.useState(""),[p,v]=D.useState(qo()),[A,T]=D.useState(""),[S,z]=D.useState(!1),[L,C]=D.useState(!1);D.useEffect(()=>{r?(c(r.name),h(String(r.age)),v(r.referralId),f(r.comment||"")):(c(""),h(""),f(""),v(qo()))},[r]);const j=!!r,H=j?"Редактировать реферала":"Добавить реферала",Y=i==="dark"?"bg-gray-700 hover:bg-gray-600 text-white":"bg-gray-200 hover:bg-gray-300 text-gray-900",I=i==="dark"?"text-gray-300":"text-gray-700",y=i==="dark"?"text-white":"text-gray-900",w=async()=>{if(!r){if(!n){T("Пользователь не найден. Для добавления реферала необходимо войти как участник.");return}}if(!o.trim()||!d.trim()){T("Заполните имя и возраст");return}const E=Number(d);if(Number.isNaN(E)||E<16){T("Возраст должен быть числом не меньше 16");return}z(!0),T("");const _={referralId:p,ownerId:(r==null?void 0:r.ownerId)||n.id,name:o.trim(),age:E,createdAt:(r==null?void 0:r.createdAt)||new Date().toISOString(),...g.trim()&&{comment:g.trim()}};try{r?a?await Gg(r.id,_):await kt({entity:"referral",action:"update",authorId:(n==null?void 0:n.id)||r.ownerId,targetUserId:r.ownerId,before:r,after:{id:r.id,..._}}):a?await zg(_):await kt({entity:"referral",action:"create",authorId:n.id,targetUserId:n.id,before:null,after:{id:"",..._}}),t()}catch(x){console.error("Error saving referral:",x);const de=x.message||x.code||"Не удалось сохранить реферала";T(de)}finally{z(!1)}},N=async()=>{if(r&&confirm(`Удалить реферала ${r.name}?`)){C(!0);try{a?await wc(r.id):await kt({entity:"referral",action:"delete",authorId:(n==null?void 0:n.id)||r.ownerId,targetUserId:r.ownerId,before:r,after:null}),t()}catch(E){console.error("Error deleting referral:",E);const _=E.message||E.code||"Не удалось удалить реферала";T(_)}finally{C(!1)}}};return s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-start sm:items-center justify-center z-[70] p-4 sm:py-0 overflow-y-auto overflow-x-hidden overscroll-contain modal-scroll",children:s.jsxs("div",{className:`w-full max-w-md rounded-lg shadow-xl ${i==="dark"?"bg-[#1a1a1a]":"bg-white"} max-h-[90vh] flex flex-col overflow-hidden`,children:[s.jsx("div",{className:"flex-shrink-0 p-6 pb-4",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("h3",{className:`text-xl font-bold ${y}`,children:H}),s.jsx("button",{onClick:e,className:`p-2 rounded-lg flex-shrink-0 ${Y}`,"aria-label":"Закрыть",children:s.jsx(Zt,{className:"w-5 h-5"})})]})}),s.jsx("div",{className:"flex-1 min-h-0 overflow-y-auto overflow-x-hidden overscroll-contain modal-scroll px-6 pb-6",children:s.jsxs("div",{className:"space-y-4 min-w-0",children:[s.jsxs("div",{children:[s.jsx("label",{className:`block text-sm font-medium mb-2 ${I}`,children:"Имя"}),s.jsx("input",{type:"text",value:o,onChange:E=>c(E.target.value),className:`w-full px-4 py-2 rounded-lg border ${i==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`,placeholder:"Введите имя"})]}),s.jsxs("div",{children:[s.jsx("label",{className:`block text-sm font-medium mb-2 ${I}`,children:"Возраст"}),s.jsx("input",{type:"number",value:d,onChange:E=>h(E.target.value),className:`w-full px-4 py-2 rounded-lg border ${i==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`,placeholder:"18",min:16})]}),s.jsxs("div",{children:[s.jsx("label",{className:`block text-sm font-medium mb-2 ${I}`,children:"Комментарий"}),s.jsx("textarea",{value:g,onChange:E=>f(E.target.value),rows:3,className:`w-full px-4 py-2 rounded-lg border ${i==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`,placeholder:"Например, источник лида или статус"})]}),s.jsxs("div",{children:[s.jsx("label",{className:`block text-sm font-medium mb-2 ${I}`,children:"ID реферала"}),s.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[s.jsx("input",{type:"text",value:p,readOnly:j,onChange:E=>v(E.target.value),className:`flex-1 px-4 py-2 rounded-lg border ${i==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49] ${j?"opacity-80 cursor-not-allowed":""}`}),!j&&s.jsxs("button",{type:"button",onClick:()=>v(qo()),className:"px-3 py-2 bg-[#4E6E49] hover:bg-[#4E6E49] text-white rounded-lg transition-colors flex items-center justify-center gap-1 text-sm",children:[s.jsx(Xp,{className:"w-4 h-4"}),"Новый"]})]}),s.jsx("p",{className:`text-xs mt-1 ${i==="dark"?"text-gray-400":"text-gray-500"}`,children:"ID генерируется автоматически и используется для учета."})]}),A&&s.jsx("div",{className:"p-3 bg-red-500 text-white rounded-lg text-sm",children:A}),s.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[j&&s.jsxs("button",{onClick:N,disabled:L,className:"flex-1 px-4 py-2 bg-red-500 hover:bg-red-600 disabled:bg-red-300 text-white rounded-lg transition-colors flex items-center justify-center gap-2",children:[s.jsx($t,{className:"w-4 h-4"}),L?"Удаление...":"Удалить"]}),s.jsx("button",{onClick:w,disabled:S,className:"flex-1 px-4 py-2 bg-[#4E6E49] hover:bg-[#4E6E49] disabled:bg-gray-400 disabled:cursor-not-allowed text-white rounded-lg transition-colors",children:S?"Сохранение...":"Сохранить"}),s.jsx("button",{onClick:e,className:`px-4 py-2 rounded-lg transition-colors ${Y}`,children:"Отмена"})]})]})})]})})},l0=(r,e=0,t=0,n=0)=>{let a=0;(r.daysOff===0||r.daysOff<=2)&&(a+=10),r.sickDays<=7&&(a+=10),r.vacationDays<=7&&(a+=10),e>=20?a+=25:e>=15&&(a+=15),t>=6e3?a+=30:t>=3e3&&(a+=15);const i=Math.min(r.referrals*5,30);return a+=i,n>50&&(a+=15),Math.min(a,100)},c0=(r,e=0,t=0,n=0)=>{const a=r.daysOff===0||r.daysOff<=2?10:0,i=r.sickDays<=7?10:0,o=r.vacationDays<=7?10:0;let c=0;e>=20?c=25:e>=15&&(c=15);let d=0;t>=6e3?d=30:t>=3e3&&(d=15);const h=Math.min(r.referrals*5,30),g=n>50?15:0,f=Math.min(a+i+o+c+d+h+g,100);return{daysOff:r.daysOff,daysOffPoints:a,sickDays:r.sickDays,sickDaysPoints:i,vacationDays:r.vacationDays,vacationDaysPoints:o,weeklyHours:e,weeklyHoursPoints:c,weeklyEarnings:t,weeklyEarningsPoints:d,referrals:r.referrals,referralsPoints:h,weeklyMessages:n,weeklyMessagesPoints:g,totalRating:f}},eN=()=>{var J,ae;const{theme:r}=it(),{user:e}=jt(),{isAdmin:t}=At(),[n,a]=D.useState([]),[i,o]=D.useState(!0),[c,d]=D.useState([]),[h,g]=D.useState(!1),[f,p]=D.useState(null);D.useEffect(()=>{v()},[]);const v=async()=>{o(!0);try{const U=Ca(),F=ce(U.start,"yyyy-MM-dd"),V=ce(U.end,"yyyy-MM-dd"),te=a0(30),me=ce(te.start,"yyyy-MM-dd"),xe=ce(te.end,"yyyy-MM-dd"),ue=te.start.toISOString(),O=te.end.toISOString(),W=await Hg(void 0,ue,O);d(W);const ie=[];for(const P of Se){const je=(await ma(P.id,F,V)).reduce((ve,we)=>{const Ae=we.participants&&we.participants.length>0?we.participants.length:1;return ve+we.amount/Ae},0),K=await ma(P.id,me,xe),ge=K.reduce((ve,we)=>{const Ae=we.participants&&we.participants.length>0?we.participants.length:1;return ve+we.amount/Ae},0),pe=K.reduce((ve,we)=>{const Ae=we.participants&&we.participants.length>0?we.participants.length:1;return ve+we.poolAmount/Ae},0),ze=(await br(P.id)).filter(ve=>{const we=ve.date,Ae=ve.endDate||ve.date;return we<=xe&&Ae>=me}),Qe=ze.filter(ve=>ve.type==="dayoff").reduce((ve,we)=>ve+an(we.date,we.endDate,me,xe),0),q=ze.filter(ve=>ve.type==="sick").reduce((ve,we)=>ve+an(we.date,we.endDate,me,xe),0),ne=ze.filter(ve=>ve.type==="vacation").reduce((ve,we)=>ve+an(we.date,we.endDate,me,xe),0),$e=(await Kr(P.id)).filter(ve=>ve.date>=F&&ve.date<=V).reduce((ve,we)=>ve+ho(we.slots),0),Fe=await qg(P.id,F,V),k=(await Wg(P.id))[0]||{userId:P.id,earnings:0,messages:0,initiatives:0,signals:0,profitableSignals:0,referrals:0,daysOff:0,sickDays:0,vacationDays:0,poolAmount:0,rating:0,lastUpdated:new Date().toISOString()},ye=W.filter(ve=>ve.ownerId===P.id).length,_e={userId:P.id,earnings:ge,messages:k.messages||0,initiatives:k.initiatives||0,signals:k.signals||0,profitableSignals:k.profitableSignals||0,referrals:ye,daysOff:Qe,sickDays:q,vacationDays:ne,poolAmount:pe,lastUpdated:new Date().toISOString()},Ie=l0(_e,$e,je,Fe),re=c0(_e,$e,je,Fe);ie.push({..._e,rating:Ie,breakdown:re})}ie.sort((P,oe)=>oe.rating-P.rating),a(ie)}catch(U){console.error("Error loading ratings:",U)}finally{o(!1)}},A=n.reduce((U,F)=>U+F.rating,0)/(n.length||1),T=r==="dark"?"text-gray-400":"text-gray-600",S=r==="dark"?"text-white":"text-gray-900",z="bg-[#10141c]",L="border-[#48a35e]/60",C="shadow-[0_24px_80px_rgba(0,0,0,0.45)]",j=r==="dark"?"text-white/70":"text-slate-600",H=r==="dark"?"text-white":"text-slate-900",Y=[{label:"80-100%",title:"Эталон",desc:"Стабильный вклад, примеры для команды",tone:"text-emerald-700 dark:text-emerald-100",bg:"bg-emerald-50 dark:bg-emerald-900/40 border-emerald-200/60 dark:border-emerald-700/60"},{label:"60-79%",title:"Уверенно",desc:"Держат темп, есть потенциал роста",tone:"text-blue-700 dark:text-blue-100",bg:"bg-blue-50 dark:bg-blue-900/40 border-blue-200/60 dark:border-blue-700/60"},{label:"40-59%",title:"В пути",desc:"Нужна точечная поддержка и фокус",tone:"text-amber-700 dark:text-amber-100",bg:"bg-amber-50 dark:bg-amber-900/40 border-amber-200/60 dark:border-amber-700/60"},{label:"0-39%",title:"Зона роста",desc:"Запускаем план восстановления",tone:"text-rose-700 dark:text-rose-100",bg:"bg-rose-50 dark:bg-rose-900/40 border-rose-200/60 dark:border-rose-700/60"}],I=U=>{if(!U.breakdown)return["Недостаточно данных — обновите статистику."];const F=[];return U.breakdown.weeklyHoursPoints<25&&F.push("Дотяни рабочие часы до 20+ в неделю (25%)."),U.breakdown.weeklyEarningsPoints<30&&F.push("Увеличь недельный доход до 6000+ ₽ (30%)."),U.breakdown.referralsPoints<30&&F.push("Добавь рефералов: до +30% (6 человек)."),U.breakdown.weeklyMessagesPoints<15&&F.push("Сообщения: >50 в неделю для +15%."),U.breakdown.daysOffPoints<10&&F.push("Сократи выходные до 0–2 за неделю."),U.breakdown.sickDaysPoints<10&&F.push("Больничные держи ≤7 дней в месяц."),U.breakdown.vacationDaysPoints<10&&F.push("Отпуск ≤7 дней в месяц."),F.length?F:["Отлично! Держи текущий темп."]},y=D.useMemo(()=>[...n].sort((U,F)=>F.rating-U.rating),[n]),w=D.useMemo(()=>{var me,xe;if(!n.length)return{top:0,median:0,count:0,high:0};const U=[...n].sort((ue,O)=>O.rating-ue.rating),F=((me=U[0])==null?void 0:me.rating)||0,V=((xe=U[Math.floor((U.length-1)/2)])==null?void 0:xe.rating)||F,te=U.filter(ue=>ue.rating>=80).length;return{top:F,median:V,count:U.length,high:te}},[n]),N=y[0],E=N&&((J=Se.find(U=>U.id===N.userId))==null?void 0:J.name)||"—",_=new Date().toLocaleDateString("ru-RU"),x=[{label:"Средний рейтинг",value:`${A.toFixed(1)}%`,meta:"по команде за неделю",tone:"emerald"},{label:"Лидер недели",value:E,meta:N?`${N.rating.toFixed(1)}%`:"—",tone:"amber"},{label:"80%+ участников",value:`${w.high}`,meta:"стабильно высоко",tone:"blue"},{label:"Всего участников",value:`${n.length}`,meta:"в рейтинге",tone:"slate"},{label:"Медиана",value:`${w.median.toFixed(1)}%`,meta:"ровный темп",tone:"purple"},{label:"Рефералы 30д",value:`${c.length}`,meta:"активность команды",tone:"pink"},{label:"Обновление",value:_,meta:"автообновление данных",tone:"indigo"},{label:"КПД недели",value:`${A.toFixed(1)}%`,meta:"ключевой ориентир",tone:"emerald"}],de=U=>U==="emerald"?r==="dark"?"bg-emerald-500/15 border-emerald-400/30 text-emerald-50":"bg-emerald-50 border-emerald-200 text-emerald-900":U==="amber"?r==="dark"?"bg-amber-500/15 border-amber-400/30 text-amber-50":"bg-amber-50 border-amber-200 text-amber-900":U==="blue"?r==="dark"?"bg-sky-500/15 border-sky-400/30 text-sky-50":"bg-sky-50 border-sky-200 text-sky-900":U==="purple"?r==="dark"?"bg-indigo-500/15 border-indigo-400/30 text-indigo-50":"bg-indigo-50 border-indigo-200 text-indigo-900":U==="pink"?r==="dark"?"bg-rose-500/15 border-rose-400/30 text-rose-50":"bg-rose-50 border-rose-200 text-rose-900":U==="indigo"?r==="dark"?"bg-indigo-500/15 border-indigo-400/30 text-indigo-50":"bg-indigo-50 border-indigo-200 text-indigo-900":r==="dark"?"bg-white/5 border-white/15 text-white":"bg-gray-50 border-gray-200 text-gray-900",M=U=>{var F;return((F=Se.find(V=>V.id===U))==null?void 0:F.name)||"—"},X=()=>{p(null),g(!0)},R=U=>{p(U),g(!0)},ee=async U=>{(t||U.ownerId===(e==null?void 0:e.id))&&(t?await wc(U.id):await kt({entity:"referral",action:"delete",authorId:(e==null?void 0:e.id)||U.ownerId,targetUserId:U.ownerId,before:U,after:null}),await v())};return s.jsxs(dr,{children:[s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"relative overflow-hidden rounded-3xl border border-[#48a35e]/60 shadow-[0_24px_80px_rgba(0,0,0,0.45)] bg-[#10141c]",children:[s.jsxs("div",{className:"absolute inset-0 pointer-events-none",children:[s.jsx("div",{className:"absolute -left-16 -bottom-10 w-80 h-80 bg-emerald-500/18 blur-3xl"}),s.jsx("div",{className:"absolute inset-0 bg-[radial-gradient(circle_at_50%_0%,rgba(255,255,255,0.08),transparent_45%)]"})]}),s.jsxs("div",{className:"relative p-6 sm:p-8 space-y-6",children:[s.jsxs("div",{className:"flex flex-col gap-4 lg:flex-row lg:items-start lg:justify-between",children:[s.jsx("div",{className:"space-y-3 max-w-3xl",children:s.jsxs("div",{className:"flex items-start gap-3",children:[s.jsx("div",{className:"p-3 rounded-2xl bg-white/10 border border-white/20 text-white shadow-inner",children:s.jsxs("svg",{width:"26",height:"26",viewBox:"0 0 24 24",fill:"none",className:"text-emerald-300",children:[s.jsx("path",{d:"M4 13.5V20h4v-6.5H4Z",stroke:"currentColor",strokeWidth:"1.6",strokeLinecap:"round",strokeLinejoin:"round"}),s.jsx("path",{d:"M10 10v10h4V10h-4Z",stroke:"currentColor",strokeWidth:"1.6",strokeLinecap:"round",strokeLinejoin:"round"}),s.jsx("path",{d:"M16 4v16h4V4h-4Z",stroke:"currentColor",strokeWidth:"1.6",strokeLinecap:"round",strokeLinejoin:"round"}),s.jsx("path",{d:"M4 16.5 9.5 11l3 3 7-7",stroke:"currentColor",strokeWidth:"1.6",strokeLinecap:"round",strokeLinejoin:"round"})]})}),s.jsxs("div",{className:"space-y-2",children:[s.jsx("h1",{className:"text-3xl sm:text-4xl font-black text-white leading-tight",children:"Рейтинг команды"}),s.jsx("p",{className:"text-sm text-white/70",children:"Данные за текущую неделю + последние 30 дней. В фокусе KPI команды, динамика и реферальная активность — как на дашборде задач."}),s.jsx("div",{className:"flex flex-wrap gap-2",children:["КПД недели","Рейтинг 30д","Рефералы","Сообщения"].map((U,F)=>s.jsx("span",{className:`px-4 py-1.5 rounded-full text-xs font-semibold border ${F===0?"bg-emerald-500 text-white border-emerald-300/60 shadow-md":"bg-white/10 text-white border-white/20"}`,children:U},U))})]})]})}),s.jsx("div",{className:"flex flex-col items-start lg:items-end gap-2 text-white"})]}),s.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-4 gap-3",children:x.map(U=>s.jsxs("div",{className:`relative overflow-hidden rounded-2xl border ${de(U.tone)} p-4 backdrop-blur-sm`,children:[s.jsx("div",{className:"absolute right-3 top-3 text-xl opacity-20",children:"•"}),s.jsx("div",{className:`text-xs uppercase tracking-[0.1em] font-semibold ${j}`,children:U.label}),s.jsx("div",{className:`mt-2 text-2xl font-bold ${H}`,children:U.value}),s.jsx("div",{className:`text-sm ${j}`,children:U.meta})]},U.label))})]})]}),s.jsxs("div",{className:`rounded-2xl p-6 sm:p-7 ${z} ${C} border ${L}`,children:[s.jsxs("div",{className:"flex flex-col gap-2 mb-4",children:[s.jsx("p",{className:`text-xs uppercase tracking-[0.12em] ${T}`,children:"Методика"}),s.jsx("h3",{className:`text-2xl font-bold ${S}`,children:"Как мы строим эффективность команды?"}),s.jsx("p",{className:`text-sm ${T}`,children:"Четыре зоны, которые показывают, где сейчас участник и что делать дальше."})]}),s.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-4 gap-3",children:Y.map(U=>s.jsxs("div",{className:`rounded-xl border ${U.bg} p-3 transition`,children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("span",{className:`text-xs font-semibold ${T}`,children:U.label}),s.jsx("span",{className:"text-lg",children:"•"})]}),s.jsx("p",{className:`text-base font-semibold ${U.tone}`,children:U.title}),s.jsx("p",{className:`text-sm ${T}`,children:U.desc})]},U.label))})]}),s.jsxs("div",{className:`rounded-2xl p-6 sm:p-7 ${z} ${C} border ${L}`,children:[s.jsxs("div",{className:"flex flex-col gap-2 mb-4",children:[s.jsx("p",{className:`text-xs uppercase tracking-[0.12em] ${T}`,children:"Рекомендации"}),s.jsx("h3",{className:`text-2xl font-bold ${S}`,children:"Что улучшить каждому"}),s.jsx("p",{className:`text-sm ${T}`,children:"Динамические подсказки на основе текущих метрик рейтинга."})]}),s.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-3",children:y.map(U=>{const F=I(U),V=M(U.userId),te=U.rating>=80?"bg-emerald-500":U.rating>=60?"bg-blue-500":U.rating>=40?"bg-amber-500":"bg-rose-500",me=U.rating>=80?"Эталон":U.rating>=60?"Уверенно":U.rating>=40?"В пути":"Зона роста";return s.jsxs("div",{className:"rounded-xl border border-white/10 bg-white/5 p-4 space-y-3",children:[s.jsxs("div",{className:"flex items-center justify-between gap-2",children:[s.jsxs("div",{className:"min-w-0",children:[s.jsx("p",{className:`text-xs uppercase tracking-[0.12em] ${T}`,children:me}),s.jsx("h4",{className:`text-lg font-bold ${S} truncate`,children:V})]}),s.jsx("div",{className:"text-right",children:s.jsxs("div",{className:"text-2xl font-bold text-white",children:[U.rating.toFixed(1),"%"]})})]}),s.jsx("div",{className:"w-full bg-white/5 rounded-full h-3 overflow-hidden border border-white/10",children:s.jsx("div",{className:`h-full ${te}`,style:{width:`${Math.min(U.rating,100)}%`}})}),s.jsx("ul",{className:"space-y-1 text-sm text-white/80",children:F.map((xe,ue)=>s.jsxs("li",{className:"flex items-start gap-2",children:[s.jsx("span",{className:"text-xs mt-0.5",children:"•"}),s.jsx("span",{children:xe})]},ue))})]},U.userId)})})]}),s.jsxs("div",{id:"rating-ref",className:`rounded-2xl p-6 sm:p-7 ${z} ${C} border ${L}`,children:[s.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between mb-4",children:[s.jsxs("div",{className:"space-y-1",children:[s.jsx("p",{className:`text-xs uppercase tracking-[0.12em] ${T}`,children:"Рефералы · 30 дней"}),s.jsx("h3",{className:`text-2xl font-bold ${S}`,children:"Привлеченные участники"}),s.jsxs("p",{className:`text-sm ${T}`,children:["Всего добавлено: ",s.jsx("span",{className:"font-semibold",children:c.length})]})]}),s.jsxs("button",{onClick:X,className:"px-4 py-3 rounded-xl transition-all duration-200 flex items-center justify-center gap-2 font-semibold shadow-md w-full sm:w-auto border border-indigo-200/70 bg-indigo-50 text-indigo-900 hover:bg-indigo-100 dark:bg-indigo-500/15 dark:border-indigo-400/30 dark:text-indigo-50",children:[s.jsx("span",{className:"text-xl",children:"➕"}),s.jsx("span",{children:"Добавить реферала"})]})]}),c.length?s.jsx("div",{className:"overflow-auto rounded-xl border border-white/10 bg-white/5",children:s.jsxs("table",{className:"min-w-[820px] w-full text-sm text-white/90",children:[s.jsx("thead",{className:"bg-white/5 text-white/70 text-left",children:s.jsxs("tr",{children:[s.jsx("th",{className:"py-3 px-4 font-semibold",children:"Кто привел"}),s.jsx("th",{className:"py-3 px-4 font-semibold",children:"Код"}),s.jsx("th",{className:"py-3 px-4 font-semibold",children:"Имя"}),s.jsx("th",{className:"py-3 px-4 font-semibold",children:"Комментарий"}),s.jsx("th",{className:"py-3 px-4 font-semibold text-right",children:"Действия"})]})}),s.jsx("tbody",{children:c.map(U=>{const F=M(U.ownerId),V=t||U.ownerId===(e==null?void 0:e.id);return s.jsxs("tr",{className:"border-t border-white/10 hover:bg-white/5 transition-colors",children:[s.jsx("td",{className:"py-3 px-4 font-semibold text-white whitespace-nowrap",children:F}),s.jsx("td",{className:"py-3 px-4 text-white/80 whitespace-nowrap",children:U.referralId}),s.jsx("td",{className:"py-3 px-4 text-white/80",children:U.name}),s.jsx("td",{className:"py-3 px-4 text-white/70",children:U.comment||"—"}),s.jsxs("td",{className:"py-3 px-4 text-right whitespace-nowrap flex items-center justify-end gap-2",children:[s.jsx("button",{onClick:()=>V&&R(U),className:`px-3 py-1.5 rounded-lg text-xs font-semibold border border-white/20 bg-white/10 text-white transition ${V?"hover:bg-white/20":"opacity-40 cursor-not-allowed"}`,disabled:!V,children:"Редактировать"}),s.jsx("button",{onClick:()=>V&&ee(U),className:`px-3 py-1.5 rounded-lg text-xs font-semibold border border-rose-300/60 bg-rose-500/20 text-rose-50 transition ${V?"hover:bg-rose-500/30":"opacity-40 cursor-not-allowed"}`,disabled:!V,children:"Удалить"})]})]},U.id)})})]})}):s.jsx("div",{className:"rounded-xl border border-white/10 bg-white/5 p-4 text-white/70",children:"Пока нет рефералов."})]}),s.jsxs("div",{id:"rating-method",className:`rounded-2xl p-6 sm:p-7 ${z} ${C} border ${L}`,children:[s.jsx("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between mb-4",children:s.jsxs("div",{className:"space-y-1",children:[s.jsx("p",{className:`text-xs uppercase tracking-[0.12em] ${T}`,children:"Карточки участников"}),s.jsx("h3",{className:`text-2xl font-bold ${S}`,children:"Детальная статистика"})]})}),i?s.jsxs("div",{className:`rounded-xl p-12 text-center ${r==="dark"?"bg-white/5":"bg-gray-50"} border ${L}`,children:[s.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-4 border-emerald-500 border-t-transparent mx-auto mb-4"}),s.jsx("p",{className:`text-lg font-semibold ${S}`,children:"Загрузка рейтинга..."}),s.jsx("p",{className:`text-sm ${T} mt-2`,children:"Подождите, собираем статистику"})]}):s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3 mb-6",children:[{label:"Топ-1",value:(ae=y[0])!=null&&ae.rating?`${y[0].rating.toFixed(1)}%`:"—"},{label:"Средний рейтинг",value:`${A.toFixed(1)}%`},{label:"Медиана",value:`${w.median.toFixed(1)}%`},{label:"Участников",value:y.length}].map(U=>s.jsxs("div",{className:`rounded-xl border ${L} ${r==="dark"?"bg-white/5":"bg-gray-50"} px-4 py-3`,children:[s.jsx("p",{className:`text-[11px] uppercase tracking-wide ${T}`,children:U.label}),s.jsx("p",{className:`text-2xl font-extrabold ${S}`,children:U.value})]},U.label))}),s.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-2 gap-6",children:y.map((U,F)=>s.jsx("div",{children:s.jsx(J_,{rating:U,place:{rank:F+1}})},U.userId))})]})]})]}),h&&s.jsx(Z_,{referral:f,onClose:()=>{g(!1),p(null)},onSave:()=>{g(!1),p(null),v()}})]})},mo={trading:jp,learning:ta,technical:Tp,stream:Qp,research:Rp,organization:Ip},tN=({onClose:r,onSave:e,editingTask:t})=>{var xe,ue;const{user:n}=jt(),{theme:a}=it(),i=!!t,o=a==="dark"?"text-white":"text-gray-900",c=a==="dark"?"bg-[#1a1a1a]":"bg-white",d=a==="dark"?"bg-gray-800":"bg-gray-50",h=a==="dark"?"border-gray-800":"border-gray-300",[g,f]=D.useState((t==null?void 0:t.title)||""),[p,v]=D.useState((t==null?void 0:t.description)||""),[A,T]=D.useState((t==null?void 0:t.category)||"trading"),[S,z]=D.useState((t==null?void 0:t.priority)||"medium"),[L,C]=D.useState((t==null?void 0:t.expectedResult)||""),[j,H]=D.useState((t==null?void 0:t.dueDate)||ce(new Date,"yyyy-MM-dd")),[Y,I]=D.useState((t==null?void 0:t.dueTime)||"12:00"),y=O=>({...O,assignees:O.assignees||[],approvals:O.approvals||[],requiresApproval:O.requiresApproval??!0,stagePriority:O.stagePriority||"medium",status:O.status||"pending"}),[w,N]=D.useState((xe=t==null?void 0:t.stages)!=null&&xe.length?t.stages.map(y):[y({id:"stage-1",name:"Этап 1",description:"",responsible:"all",assignees:[],approvals:[],stagePriority:"medium",requiresApproval:!0,status:"pending"})]),[E,_]=D.useState((t==null?void 0:t.currentStageId)||((ue=w[0])==null?void 0:ue.id)||"stage-1"),[x,de]=D.useState(""),[M,X]=D.useState(!1);In();const R=[{value:"urgent",label:"Экстренный",desc:"Нужно прямо сейчас",tone:a==="dark"?"bg-rose-600/20 border-rose-500/50 text-rose-100":"bg-rose-50 border-rose-200 text-rose-700"},{value:"high",label:"Высокий",desc:"Быстрый старт",tone:a==="dark"?"bg-red-500/15 border-red-500/40 text-red-100":"bg-red-50 border-red-200 text-red-700"},{value:"medium",label:"Средний",desc:"Плановый слот",tone:a==="dark"?"bg-amber-500/15 border-amber-500/40 text-amber-100":"bg-amber-50 border-amber-200 text-amber-700"},{value:"low",label:"Низкий",desc:"Фон",tone:a==="dark"?"bg-gray-500/15 border-gray-500/40 text-gray-100":"bg-gray-50 border-gray-200 text-gray-700"}],ee=(O,W)=>{N(ie=>ie.map(P=>P.id===O?{...P,...W}:P))},J=(O,W)=>{N(ie=>ie.map(P=>P.id!==O?P:P.assignees.find(je=>je.userId===W)?{...P,assignees:P.assignees.filter(je=>je.userId!==W)}:P.assignees.length>=10?P:{...P,assignees:[...P.assignees,{userId:W,priority:"medium"}]}))},ae=(O,W,ie,P)=>{N(oe=>oe.map(je=>{if(je.id!==O)return je;const K=je.assignees.map(ge=>ge.userId===W?{...ge,[ie]:P}:ge);return{...je,assignees:K}}))},U=()=>{const O=y({id:`stage-${Date.now()}`,name:`Этап ${w.length+1}`,description:"",responsible:"all",assignees:[],approvals:[],stagePriority:"medium",requiresApproval:!0,status:"pending"});N(W=>[...W,O]),E||_(O.id)},F=O=>{var ie;if(w.length===1)return;const W=w.filter(P=>P.id!==O);N(W),E===O&&_(((ie=W[0])==null?void 0:ie.id)||"")},V=()=>g.trim()?!j||!Y?"Укажите дедлайн (дата и время)":new Set(w.flatMap(W=>W.assignees.map(ie=>ie.userId))).size===0?"Добавьте исполнителей в этапах":"":"Введите название задачи",te=(O,W)=>{const ie=O.assignees,P=ie.map(je=>je.userId),oe=P.map(je=>{const K=ie.find(ge=>ge.userId===je);return{userId:je,status:"pending",updatedAt:W,...K!=null&&K.comment?{comment:K.comment}:{}}});return{id:O.id,name:O.name,description:O.description,responsible:P,assignees:ie,stagePriority:O.stagePriority||"medium",requiresApproval:!0,approvals:oe,comments:O.comments||[],status:"pending"}},me=async()=>{var ie;const O=V();if(O){de(O);return}if(!n){de("Пользователь не найден");return}de(""),X(!0);const W=new Date().toISOString();try{const P=w.map(ge=>te(ge,W)),oe=Array.from(new Set(P.flatMap(ge=>{var pe;return((pe=ge.assignees)==null?void 0:pe.map(Ce=>Ce.userId))||[]}))),je=oe.map(ge=>({userId:ge,status:"pending",updatedAt:W})),K={title:g.trim(),description:p.trim()||void 0,category:A,priority:S,assignedTo:oe,assignees:oe.map(ge=>({userId:ge,priority:"medium"})),approvals:je,stages:P,currentStageId:E||((ie=P[0])==null?void 0:ie.id),dueDate:j,dueTime:Y,expectedResult:L.trim()||void 0,updatedAt:W};if(i&&t)await $r(t.id,K);else{const ge={...K,status:"in_progress",createdBy:n.id,createdAt:W};await E2(ge)}e()}catch(P){console.error("Error saving task:",P),de("Ошибка при сохранении задачи")}finally{X(!1)}};return s.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-start sm:items-center justify-center z-[70] p-4 overflow-y-auto overscroll-contain modal-scroll touch-pan-y",children:s.jsx("div",{className:`${c} rounded-xl sm:rounded-2xl shadow-2xl w-full max-w-2xl max-h-[calc(100vh-48px)] sm:max-h-[calc(100vh-64px)] overflow-y-auto border-2 touch-pan-y ${a==="dark"?"border-[#4E6E49]/30 bg-gradient-to-br from-[#1a1a1a] via-[#1a1a1a] to-[#0A0A0A]":"border-green-200 bg-gradient-to-br from-white via-green-50/30 to-white"} relative`,children:s.jsxs("div",{className:"flex flex-col h-full min-h-0",children:[s.jsxs("div",{className:`sticky top-0 ${c} border-b ${h} p-4 sm:p-6 flex items-center justify-between z-10`,children:[s.jsxs("h2",{className:`text-xl sm:text-2xl font-bold ${o} flex items-center gap-2`,children:[s.jsx(Dp,{className:"w-5 h-5 sm:w-6 sm:h-6"}),i?"Редактировать задачу":"Новая задача"]}),s.jsx("button",{onClick:r,className:`p-2 rounded-lg transition-colors ${a==="dark"?"hover:bg-gray-700":"hover:bg-gray-100"}`,children:s.jsx(Zt,{className:"w-5 h-5"})})]}),s.jsxs("div",{className:"p-4 sm:p-6 space-y-4 sm:space-y-6 flex-1 min-h-0 overflow-y-auto overscroll-contain modal-scroll touch-pan-y pb-10",children:[x&&s.jsxs("div",{className:"p-3 rounded-lg bg-red-500/10 border border-red-500/30 flex items-center gap-2 text-red-500",children:[s.jsx(qp,{className:"w-5 h-5 flex-shrink-0"}),s.jsx("span",{className:"text-sm",children:x})]}),s.jsxs("div",{children:[s.jsx("label",{className:`block text-sm font-medium mb-2 ${o}`,children:"Название *"}),s.jsx("input",{value:g,onChange:O=>f(O.target.value),className:`w-full px-4 py-2.5 rounded-lg border ${h} ${d} ${o} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]/50`,placeholder:"Введите название задачи"})]}),s.jsxs("div",{children:[s.jsx("label",{className:`block text-sm font-medium mb-2 ${o}`,children:"Описание"}),s.jsx("textarea",{value:p,onChange:O=>v(O.target.value),rows:4,className:`w-full px-4 py-2.5 rounded-lg border ${h} ${d} ${o} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]/50`,placeholder:"Кратко опишите задачу"})]}),s.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[s.jsxs("div",{className:"space-y-3",children:[s.jsxs("label",{className:`block text-sm font-medium ${o} flex items-center gap-2`,children:[s.jsx(rf,{className:"w-4 h-4"}),"Категория"]}),s.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2 sm:gap-3",children:Object.entries(ea).map(([O,{label:W}])=>{const ie=mo[O],P=A===O;return s.jsxs("button",{type:"button",onClick:()=>T(O),className:`p-3 rounded-lg border-2 text-sm font-semibold transition-all text-center ${P?a==="dark"?"border-[#4E6E49] bg-[#4E6E49]/15 text-[#4E6E49]":"border-[#4E6E49] bg-green-50 text-[#4E6E49]":a==="dark"?"border-gray-800 bg-gray-900 text-gray-200 hover:border-[#4E6E49]/40":"border-gray-200 bg-white text-gray-800 hover:border-[#4E6E49]/40"} flex items-center justify-center gap-2`,children:[s.jsx(ie,{className:"w-4 h-4"}),s.jsx("span",{children:W})]},O)})})]}),s.jsxs("div",{className:"space-y-3",children:[s.jsxs("label",{className:`block text-sm font-medium ${o} flex items-center gap-2`,children:[s.jsx(Qt,{className:"w-4 h-4"}),"Приоритет"]}),s.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2",children:R.map(O=>s.jsxs("button",{type:"button",onClick:()=>z(O.value),className:`p-3 rounded-lg border-2 text-left transition-all ${O.tone} ${S===O.value?"ring-2 ring-offset-2 ring-[#4E6E49] dark:ring-offset-[#1a1a1a]":""}`,children:[s.jsxs("div",{className:"flex items-center justify-between gap-2",children:[s.jsx("span",{className:"font-semibold text-sm",children:O.label}),S===O.value&&s.jsx("span",{className:"text-xs font-semibold",children:"выбрано"})]}),s.jsx("p",{className:"text-xs mt-1 opacity-80",children:O.desc})]},O.value))})]})]}),s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("label",{className:`block text-sm font-medium ${o}`,children:"Этапы и исполнители"}),s.jsxs("button",{type:"button",onClick:U,className:`px-3 py-1.5 rounded-lg text-xs font-semibold ${a==="dark"?"bg-gray-700 hover:bg-gray-600 text-gray-200":"bg-gray-200 hover:bg-gray-300 text-gray-800"}`,children:[s.jsx(ra,{className:"w-4 h-4 inline"})," Добавить этап"]})]}),s.jsx("div",{className:"space-y-3",children:w.map((O,W)=>s.jsxs("div",{className:`p-3 rounded-lg border-2 ${h} ${d}`,children:[s.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[s.jsx("input",{value:O.name,onChange:ie=>ee(O.id,{name:ie.target.value}),className:`flex-1 px-3 py-2 rounded-lg border ${h} ${a==="dark"?"bg-[#0f0f0f] text-gray-100":"bg-white text-gray-800"}`,placeholder:`Этап ${W+1}`}),w.length>1&&s.jsx("button",{onClick:()=>F(O.id),className:`p-2 rounded-lg ${a==="dark"?"bg-red-500/20 text-red-200":"bg-red-100 text-red-700"}`,children:s.jsx(nf,{className:"w-4 h-4"})})]}),s.jsx("textarea",{value:O.description||"",onChange:ie=>ee(O.id,{description:ie.target.value}),rows:2,className:`w-full px-3 py-2 rounded-lg border ${h} ${a==="dark"?"bg-[#0f0f0f] text-gray-100":"bg-white text-gray-800"}`,placeholder:"Описание этапа (опционально)"}),s.jsxs("div",{className:"mt-3 space-y-2",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("label",{className:`text-sm font-medium ${o} flex items-center gap-2`,children:[s.jsx(bn,{className:"w-4 h-4"}),"Исполнители этапа"]}),s.jsxs("span",{className:"text-[11px] text-gray-500",children:[O.assignees.length,"/10"]})]}),s.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-2",children:Se.map(ie=>{const P=O.assignees.some(oe=>oe.userId===ie.id);return s.jsx("button",{type:"button",onClick:()=>J(O.id,ie.id),className:`p-2 rounded-lg border text-left text-sm transition-all ${P?a==="dark"?"border-[#4E6E49] bg-[#4E6E49]/20":"border-[#4E6E49] bg-green-50":`${h} ${d}`}`,children:s.jsx("span",{className:P?"text-[#4E6E49]":o,children:ie.name})},ie.id)})}),O.assignees.length>0&&s.jsx("div",{className:"space-y-2",children:O.assignees.map(ie=>{const P=Se.find(oe=>oe.id===ie.userId);return s.jsxs("div",{className:`p-2 rounded-lg border ${h} ${a==="dark"?"bg-[#0f0f0f]":"bg-white"}`,children:[s.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2",children:[s.jsx("div",{className:"text-sm font-medium",children:(P==null?void 0:P.name)||ie.userId}),s.jsxs("select",{value:ie.priority,onChange:oe=>ae(O.id,ie.userId,"priority",oe.target.value),className:`px-3 py-1.5 rounded-lg border ${h} ${a==="dark"?"bg-[#1a1a1a] text-gray-100":"bg-white text-gray-700"}`,children:[s.jsx("option",{value:"urgent",children:"Экстренный"}),s.jsx("option",{value:"high",children:"Высокий"}),s.jsx("option",{value:"medium",children:"Средний"}),s.jsx("option",{value:"low",children:"Низкий"})]})]}),s.jsx("textarea",{value:ie.comment||"",onChange:oe=>ae(O.id,ie.userId,"comment",oe.target.value),rows:2,className:`mt-2 w-full px-3 py-2 rounded-lg border ${h} ${a==="dark"?"bg-[#1a1a1a] text-gray-100":"bg-white text-gray-700"}`,placeholder:"Комментарий для исполнителя (опционально)"})]},ie.userId)})})]})]},O.id))})]}),s.jsxs("div",{children:[s.jsxs("label",{className:`block text-sm font-medium mb-2 ${o} flex items-center gap-2`,children:[s.jsx(ss,{className:"w-4 h-4"}),"Какой результат должен быть"]}),s.jsx("textarea",{value:L,onChange:O=>C(O.target.value),rows:3,className:`w-full px-4 py-2.5 rounded-lg border ${h} ${d} ${o} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]/50`,placeholder:"Опишите ожидаемый итог"})]}),s.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[s.jsxs("div",{className:"space-y-1",children:[s.jsxs("label",{className:`text-sm font-medium ${o} flex items-center gap-2`,children:[s.jsx(gs,{className:"w-4 h-4"}),"Дата дедлайна *"]}),s.jsx("input",{type:"date",value:j,onChange:O=>H(O.target.value),min:ce(new Date,"yyyy-MM-dd"),className:`w-full px-4 py-2.5 rounded-lg border ${h} ${d} ${o} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]/50`})]}),s.jsxs("div",{className:"space-y-1",children:[s.jsxs("label",{className:`text-sm font-medium ${o} flex items-center gap-2`,children:[s.jsx(Ps,{className:"w-4 h-4"}),"Время дедлайна *"]}),s.jsx("input",{type:"time",value:Y,onChange:O=>I(O.target.value),className:`w-full px-4 py-2.5 rounded-lg border ${h} ${d} ${o} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]/50`})]})]}),s.jsxs("div",{className:`flex flex-col sm:flex-row gap-3 pt-4 border-t ${h}`,children:[s.jsx("button",{onClick:me,disabled:M,className:`flex-1 px-6 py-3 rounded-lg font-semibold transition-all ${M?"bg-gray-400 cursor-not-allowed":"bg-gradient-to-r from-[#4E6E49] to-emerald-700 hover:from-[#4E6E49] hover:to-emerald-700 text-white shadow-lg hover:shadow-xl transform hover:scale-[1.02]"}`,children:M?"Сохранение...":i?"Сохранить":"Создать задачу"}),s.jsx("button",{onClick:r,className:`px-6 py-3 rounded-lg font-semibold transition-colors ${a==="dark"?"bg-gray-700 hover:bg-gray-600 text-gray-300":"bg-gray-200 hover:bg-gray-300 text-gray-700"}`,children:"Отмена"})]})]})]})})})},Nc=60*1e3,ga=60*Nc,eh=24*ga,rN=r=>{if(r<=0)return"Просрочено";const e=Math.floor(r/eh),t=Math.floor(r%eh/ga),n=Math.floor(r%ga/Nc);return e>0?`${e}д ${t}ч`:t>0?`${t}ч ${n}м`:`${Math.max(n,1)}м`},sN=r=>r<=0?"overdue":r<=ga?"urgent":r<=6*ga?"soon":"on_track",zo=(r,e)=>{if(!r||!e)return{label:"—",status:"unknown",isOverdue:!1};const n=new Date(`${r}T${e}`).getTime()-Date.now();if(Number.isNaN(n))return{label:"—",status:"unknown",isOverdue:!1};const a=sN(n);return{label:rN(n),status:a,isOverdue:a==="overdue"}},nN=(r,e)=>{const t=D.useMemo(()=>zo(r,e),[r,e]),[n,a]=D.useState(t);return D.useEffect(()=>{a(zo(r,e));const i=setInterval(()=>{a(zo(r,e))},Nc);return()=>clearInterval(i)},[r,e]),n},aN=(r,e)=>e==="dark"?{overdue:"bg-red-500/10 border-red-500/40 text-red-300",urgent:"bg-orange-500/10 border-orange-500/40 text-orange-200",soon:"bg-yellow-500/10 border-yellow-500/40 text-yellow-200",on_track:"bg-[#4E6E49]/10 border-[#4E6E49]/40 text-green-200",unknown:"bg-gray-600/30 border-gray-500/40 text-gray-200"}[r]:{overdue:"bg-red-50 border-red-200 text-red-600",urgent:"bg-orange-50 border-orange-200 text-orange-600",soon:"bg-yellow-50 border-yellow-200 text-yellow-700",on_track:"bg-green-50 border-green-200 text-[#4E6E49]",unknown:"bg-gray-100 border-gray-200 text-gray-600"}[r],d0=({dueDate:r,dueTime:e,theme:t,size:n="default"})=>{const{label:a,status:i}=nN(r,e),o=aN(i,t),c=n==="compact"?"px-2 py-0.5 text-[11px]":"px-2.5 py-1 text-xs sm:text-sm",d=n==="compact"?"w-3 h-3":"w-4 h-4";return s.jsxs("span",{className:`inline-flex items-center gap-1 rounded-full border font-medium ${c} ${o}`,children:[s.jsx(Ps,{className:d}),a]})},iN=({task:r,onEdit:e,onDelete:t,onUpdate:n})=>{const{user:a}=jt(),{isAdmin:i}=At(),{theme:o}=it(),[c,d]=D.useState(!1),[h,g]=D.useState(!1),[f,p]=D.useState(""),v=o==="dark"?"text-white":"text-gray-900",A=o==="dark"?"bg-[#1a1a1a]":"bg-white",T=o==="dark"?"border-gray-800":"border-gray-300",S=ea[r.category],z=Ss[r.status],L=mo[r.category],C=Se.find(V=>V.id===r.createdBy),j=r.assignees&&r.assignees.length>0?r.assignees:r.assignedTo.map(V=>({userId:V,priority:"medium"})),H=j.map(V=>V.userId),Y=j.map(V=>{const te=Se.find(me=>me.id===V.userId);return te?{...V,member:te}:null}).filter(Boolean),I=i||(a==null?void 0:a.id)===r.createdBy||r.mainExecutor===(a==null?void 0:a.id),y=()=>{const V=new Date().toISOString(),me=(r.approvals||[]).filter(ue=>H.includes(ue.userId)).map(ue=>({userId:ue.userId,status:ue.status==="approved"?"approved":"pending",updatedAt:ue.updatedAt||V,...ue.comment?{comment:ue.comment}:{}})),xe=H.filter(ue=>!me.some(O=>O.userId===ue)).map(ue=>({userId:ue,status:"pending",updatedAt:V}));return[...me,...xe]},w=()=>!!a&&H.includes(a.id),N=()=>i||(a==null?void 0:a.id)===r.createdBy,E=()=>{const V=y(),te=V.filter(me=>me.status==="approved").length;return{approvals:V,approved:te,total:H.length}},{approvals:_,approved:x,total:de}=E(),M=_.find(V=>V.userId===(a==null?void 0:a.id)),X=w()&&r.status==="in_progress"&&(!M||M.status!=="approved"),R=N()&&r.status==="completed",ee=async()=>{if(!(!a||r.status!=="in_progress"||!w())){d(!0);try{const V=new Date().toISOString(),te=y().map(ue=>ue.userId===a.id?{...ue,status:"approved",updatedAt:V}:ue),me=H.length>0&&H.every(ue=>te.find(O=>O.userId===ue&&O.status==="approved")),xe={approvals:te,updatedAt:V};me&&(xe.status="completed",xe.completedAt=V,xe.completedBy=a.id),await $r(r.id,xe),n()}catch(V){console.error("Error confirming task:",V)}finally{d(!1)}}},J=async()=>{if(!(!N()||r.status!=="completed")){d(!0);try{const V=new Date().toISOString();await $r(r.id,{status:"closed",closedAt:V,updatedAt:V}),n()}catch(V){console.error("Error closing task:",V)}finally{d(!1)}}},ae=async()=>{if(!N())return;const V=(f||"").trim();if(V){d(!0);try{const te=new Date().toISOString(),me=H.map(ue=>({userId:ue,status:"pending",updatedAt:te})),xe={id:`c-${Date.now()}`,userId:(a==null?void 0:a.id)||"system",text:V,createdAt:te};await $r(r.id,{status:"in_progress",approvals:me,completedAt:void 0,completedBy:void 0,closedAt:void 0,comments:[...r.comments||[],xe],updatedAt:te}),g(!1),p(""),n()}catch(te){console.error("Error returning task:",te)}finally{d(!1)}}},U=()=>({in_progress:o==="dark"?"bg-blue-500/20 border-blue-500/50 text-blue-400":"bg-blue-50 border-blue-200 text-blue-700",completed:o==="dark"?"bg-[#4E6E49]/20 border-[#4E6E49]/50 text-[#4E6E49]":"bg-green-50 border-green-200 text-[#4E6E49]",closed:o==="dark"?"bg-gray-500/20 border-gray-500/50 text-gray-400":"bg-gray-50 border-gray-200 text-gray-700"})[r.status],F=()=>{const V={green:{bg:o==="dark"?"bg-[#4E6E49]/20":"bg-green-50",text:"text-[#4E6E49]"},blue:{bg:o==="dark"?"bg-blue-500/20":"bg-blue-50",text:o==="dark"?"text-blue-400":"text-blue-700"},purple:{bg:o==="dark"?"bg-purple-500/20":"bg-purple-50",text:o==="dark"?"text-purple-400":"text-purple-700"},red:{bg:o==="dark"?"bg-red-500/20":"bg-red-50",text:o==="dark"?"text-red-400":"text-red-700"},yellow:{bg:o==="dark"?"bg-yellow-500/20":"bg-yellow-50",text:o==="dark"?"text-yellow-400":"text-yellow-700"},indigo:{bg:o==="dark"?"bg-indigo-500/20":"bg-indigo-50",text:o==="dark"?"text-indigo-400":"text-indigo-700"}};return V[S.color]||V.green};return s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:`${A} rounded-xl border-2 ${T} p-4 sm:p-6 shadow-lg hover:shadow-xl transition-all ${o==="dark"?"hover:border-[#4E6E49]/50":"hover:border-[#4E6E49]"}`,children:[s.jsxs("div",{className:"flex items-start justify-between gap-3 mb-3",children:[s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsx("div",{className:"flex items-center gap-2 mb-2",children:s.jsx("h3",{className:`text-lg sm:text-xl font-bold ${v} truncate`,children:r.title})}),s.jsxs("div",{className:"flex flex-wrap items-center gap-2 sm:gap-3",children:[s.jsxs("span",{className:`px-2.5 py-1 rounded-lg text-xs sm:text-sm font-medium ${F().bg} ${F().text} inline-flex items-center gap-1.5`,children:[s.jsx(L,{className:"w-4 h-4"}),S.label]}),s.jsx("span",{className:`px-2.5 py-1 rounded-lg text-xs sm:text-sm font-medium border ${U()}`,children:z.label}),s.jsx("span",{className:`px-2.5 py-1 rounded-lg text-xs sm:text-sm font-medium border ${o==="dark"?"border-yellow-500/40 text-yellow-200 bg-yellow-500/10":"border-yellow-200 text-yellow-700 bg-yellow-50"}`,children:r.priority==="urgent"?"Экстренный приоритет":r.priority==="high"?"Высокий приоритет":r.priority==="medium"?"Средний приоритет":"Низкий приоритет"})]})]}),I&&s.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[s.jsx("button",{onClick:()=>e(r),className:`p-2 rounded-lg transition-colors ${o==="dark"?"hover:bg-gray-700":"hover:bg-gray-100"}`,title:"Редактировать",children:s.jsx(rr,{className:"w-4 h-4"})}),s.jsx("button",{onClick:()=>t(r.id),className:`p-2 rounded-lg transition-colors ${o==="dark"?"hover:bg-red-500/20 text-red-400":"hover:bg-red-50 text-red-600"}`,title:"Удалить",children:s.jsx($t,{className:"w-4 h-4"})})]})]}),r.description&&s.jsx("p",{className:`text-sm ${o==="dark"?"text-gray-300":"text-gray-600"} mb-4 line-clamp-2`,children:r.description}),s.jsxs("div",{className:"space-y-2 mb-4",children:[s.jsxs("div",{className:"flex flex-col gap-3",children:[s.jsxs("div",{className:"flex items-center gap-2 text-xs sm:text-sm",children:[s.jsx(cn,{className:`w-4 h-4 ${o==="dark"?"text-blue-400":"text-blue-600"}`}),s.jsx("span",{className:`font-medium ${o==="dark"?"text-gray-300":"text-gray-700"}`,children:"Автор:"}),s.jsx("span",{className:o==="dark"?"text-gray-400":"text-gray-600",children:(C==null?void 0:C.name)||"Неизвестно"})]}),s.jsxs("div",{children:[s.jsxs("div",{className:"flex items-center gap-2 text-xs sm:text-sm",children:[s.jsx(bn,{className:"w-4 h-4 text-[#4E6E49]"}),s.jsx("span",{className:`font-medium ${o==="dark"?"text-gray-300":"text-gray-700"}`,children:"Исполнители:"})]}),Y.length>0?s.jsx("div",{className:"mt-2 space-y-1",children:Y.map(V=>s.jsx("div",{className:`text-sm ${o==="dark"?"text-gray-100":"text-gray-800"}`,children:V.member.name},V.member.id))}):s.jsx("span",{className:"text-gray-500",children:"Не назначены"})]})]}),s.jsxs("div",{className:"flex items-center gap-3 flex-wrap text-xs sm:text-sm",children:[s.jsxs("span",{className:"inline-flex items-center gap-1",children:[s.jsx(gs,{className:`w-4 h-4 ${o==="dark"?"text-gray-400":"text-gray-500"}`}),s.jsxs("span",{className:o==="dark"?"text-gray-400":"text-gray-600",children:["Дедлайн: ",ce(new Date(r.dueDate),"dd.MM.yyyy")," ",r.dueTime]})]}),s.jsx(d0,{dueDate:r.dueDate,dueTime:r.dueTime,theme:o})]}),de>0&&s.jsxs("div",{className:"flex items-center gap-2 text-xs sm:text-sm",children:[s.jsx(ph,{className:`w-4 h-4 ${o==="dark"?"text-yellow-400":"text-yellow-600"}`}),s.jsxs("span",{className:o==="dark"?"text-yellow-400":"text-yellow-600",children:["Подтвердили: ",x,"/",de]})]})]}),s.jsxs("div",{className:`mt-4 p-3 rounded-lg border ${T} ${o==="dark"?"bg-[#1a1a1a]/70":"bg-gray-50"}`,children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsx("span",{className:"text-sm font-semibold",children:"Подтверждения исполнителей"}),s.jsxs("span",{className:"text-xs text-gray-500",children:[x,"/",de]})]}),_.length>0&&s.jsx("div",{className:"space-y-1 text-xs",children:_.map(V=>{const te=Se.find(xe=>xe.id===V.userId),me=V.status==="approved"?"подтвердил":"ожидает";return s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("span",{className:"flex items-center gap-1",children:[s.jsx("span",{className:"font-medium",children:(te==null?void 0:te.name)||V.userId}),s.jsxs("span",{className:"text-gray-500",children:["(",me,")"]})]}),V.comment&&s.jsx("span",{className:"text-gray-500 truncate max-w-[140px]",children:V.comment})]},V.userId)})})]}),s.jsxs("div",{className:`flex flex-wrap gap-2 pt-4 border-t ${T}`,children:[X&&s.jsxs("button",{onClick:ee,disabled:c,className:"flex-1 sm:flex-none px-4 py-2 bg-[#4E6E49] hover:bg-[#4E6E49] text-white rounded-lg text-sm font-medium transition-colors flex items-center justify-center gap-2 disabled:opacity-50",children:[s.jsx(Rs,{className:"w-4 h-4"}),"Подтвердить"]}),R&&s.jsxs(s.Fragment,{children:[s.jsxs("button",{onClick:J,disabled:c,className:"flex-1 sm:flex-none px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg text-sm font-medium transition-colors flex items-center justify-center gap-2 disabled:opacity-50",children:[s.jsx(Ds,{className:"w-4 h-4"}),"Закрыто"]}),s.jsxs("button",{onClick:()=>g(!0),disabled:c,className:"flex-1 sm:flex-none px-4 py-2 bg-red-500 hover:bg-red-600 text-white rounded-lg text-sm font-medium transition-colors flex items-center justify-center gap-2 disabled:opacity-50",children:[s.jsx(Zt,{className:"w-4 h-4"}),"Не выполнено"]})]}),r.status==="completed"&&!R&&s.jsx("span",{className:`text-xs ${o==="dark"?"text-gray-400":"text-gray-600"}`,children:"Ожидает подтверждения автора"})]})]}),h&&s.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-start sm:items-center justify-center z-[70] p-4 overflow-y-auto overscroll-contain modal-scroll",children:s.jsxs("div",{className:`${A} rounded-xl p-6 max-w-md w-full border-2 ${T}`,children:[s.jsx("h3",{className:`text-lg font-bold mb-4 ${v}`,children:"Не выполнено"}),s.jsx("textarea",{value:f,onChange:V=>p(V.target.value),placeholder:"Опишите, что нужно доработать",rows:3,className:`w-full px-4 py-2 rounded-lg border ${T} ${o==="dark"?"bg-gray-700":"bg-gray-50"} ${v} mb-4 focus:outline-none focus:ring-2 focus:ring-[#4E6E49]/50`}),s.jsxs("div",{className:"flex gap-3",children:[s.jsx("button",{onClick:ae,disabled:c||!f.trim(),className:"flex-1 px-4 py-2 rounded-lg font-medium transition-colors bg-red-500 hover:bg-red-600 text-white disabled:opacity-50",children:"Отправить на доработку"}),s.jsx("button",{onClick:()=>{g(!1),p("")},className:`px-4 py-2 rounded-lg font-medium transition-colors ${o==="dark"?"bg-gray-700 hover:bg-gray-600":"bg-gray-200 hover:bg-gray-300"}`,children:"Отмена"})]})]})})]})},oN=({selectedCategory:r,selectedStatus:e,selectedUsers:t,onCategoryChange:n,onStatusChange:a,onUsersChange:i,onClear:o})=>{const{theme:c}=it(),d=c==="dark"?"text-white":"text-gray-900",h=c==="dark"?"bg-[#1a1a1a]":"bg-white",g=c==="dark"?"border-gray-800":"border-gray-300",f=r!=="all"||e!=="all"||t.length>0,p=Se.filter(T=>t.includes(T.id)).map(T=>T.name),v=[{href:"#filter-status",label:"Статусы"},{href:"#filter-category",label:"Категории"},{href:"#filter-people",label:"Исполнители"}],A={in_progress:s.jsx(Hn,{className:"w-4 h-4"}),completed:s.jsx(Ds,{className:"w-4 h-4"}),closed:s.jsx(kp,{className:"w-4 h-4"})};return s.jsxs("div",{className:`${h} rounded-xl border-2 ${g} p-4 sm:p-6 shadow-lg sticky top-4 space-y-4`,children:[s.jsxs("div",{className:"flex items-start justify-between gap-3",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:`p-2 rounded-lg ${c==="dark"?"bg-[#4E6E49]/20":"bg-green-50"}`,children:s.jsx(fh,{className:"w-5 h-5 text-[#4E6E49]"})}),s.jsxs("div",{children:[s.jsx("h3",{className:`text-lg font-bold ${d}`,children:"Фильтры"}),s.jsx("p",{className:`text-xs ${c==="dark"?"text-gray-400":"text-gray-500"}`,children:"Быстрая навигация по статусам, категориям и участникам"})]})]}),f&&s.jsxs("button",{onClick:o,className:`px-3 py-1.5 rounded-lg text-sm transition-all flex items-center gap-2 ${c==="dark"?"bg-red-500/20 hover:bg-red-500/30 text-red-300 border border-red-500/50":"bg-red-50 hover:bg-red-100 text-red-600 border border-red-200"}`,children:[s.jsx(Zt,{className:"w-4 h-4"}),s.jsx("span",{className:"hidden sm:inline",children:"Сбросить всё"})]})]}),s.jsx("div",{className:"flex flex-wrap gap-2",children:v.map(T=>s.jsxs("a",{href:T.href,className:`px-3 py-1.5 rounded-lg text-xs font-semibold border transition flex items-center gap-2 ${c==="dark"?"border-white/10 bg-white/5 text-gray-100 hover:border-[#4E6E49]/50":"border-gray-200 bg-white text-gray-800 hover:border-[#4E6E49]/50 hover:text-[#4E6E49]"}`,children:[s.jsx(vd,{className:"w-4 h-4"}),T.label]},T.href))}),s.jsxs("div",{className:`rounded-lg border ${g} ${c==="dark"?"bg-[#1f1f1f]":"bg-gray-50"} p-3 space-y-2`,children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(Gp,{className:"w-4 h-4 text-[#4E6E49]"}),s.jsx("p",{className:`text-sm font-semibold ${d}`,children:"Текущая подборка"})]}),s.jsx("div",{className:"flex flex-wrap gap-2",children:f?s.jsxs(s.Fragment,{children:[r!=="all"&&s.jsx("span",{className:"px-2.5 py-1 rounded-full text-xs font-semibold bg-emerald-500/10 text-emerald-700 dark:text-emerald-200 border border-emerald-500/30",children:ea[r].label}),e!=="all"&&s.jsx("span",{className:"px-2.5 py-1 rounded-full text-xs font-semibold bg-sky-500/10 text-sky-700 dark:text-sky-200 border border-sky-500/30",children:Ss[e].label}),t.length>0&&s.jsx("span",{className:"px-2.5 py-1 rounded-full text-xs font-semibold bg-purple-500/10 text-purple-700 dark:text-purple-200 border border-purple-500/30",children:p.join(", ")})]}):s.jsx("span",{className:`text-xs ${c==="dark"?"text-gray-400":"text-gray-500"}`,children:"Фильтры не заданы"})})]}),s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{id:"filter-status",className:"space-y-3",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(Lp,{className:"w-4 h-4 text-yellow-500"}),s.jsx("label",{className:`block text-sm font-semibold ${d}`,children:"Статусы"})]}),s.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[s.jsxs("button",{onClick:()=>a("all"),className:`px-3 py-2 rounded-lg text-sm font-semibold transition-all border-2 ${e==="all"?c==="dark"?"bg-[#4E6E49]/20 border-[#4E6E49] text-[#4E6E49]":"bg-green-50 border-[#4E6E49] text-[#4E6E49]":`${c==="dark"?"bg-gray-800 border-gray-800 text-gray-200 hover:bg-gray-700":"bg-white border-gray-200 text-gray-700 hover:border-[#4E6E49]/40"}`} flex items-center gap-2 justify-start text-left w-full`,children:[s.jsx(ri,{className:"w-4 h-4"}),"Целиком"]}),Object.entries(Ss).map(([T,{label:S,color:z}])=>{const L={yellow:c==="dark"?"bg-yellow-500/10 border-yellow-500/50 text-yellow-300":"bg-yellow-50 border-yellow-500/40 text-yellow-700",blue:c==="dark"?"bg-blue-500/10 border-blue-500/50 text-blue-300":"bg-blue-50 border-blue-500/40 text-blue-700",purple:c==="dark"?"bg-purple-500/10 border-purple-500/50 text-purple-200":"bg-purple-50 border-purple-500/40 text-purple-700",green:c==="dark"?"bg-emerald-500/10 border-emerald-500/50 text-emerald-200":"bg-emerald-50 border-emerald-500/40 text-emerald-700",gray:c==="dark"?"bg-gray-500/10 border-gray-500/50 text-gray-300":"bg-gray-50 border-gray-400/60 text-gray-700",red:c==="dark"?"bg-red-500/10 border-red-500/50 text-red-300":"bg-red-50 border-red-500/40 text-red-700"},C=L[z]||L.gray,j=A[T];return s.jsx("button",{onClick:()=>a(T),className:`px-3 py-2 rounded-lg text-sm font-semibold transition-all border-2 flex items-center justify-start gap-3 text-left ${e===T?C:c==="dark"?"bg-gray-900 border-gray-800 text-gray-200 hover:border-[#4E6E49]/40":"bg-white border-gray-200 text-gray-700 hover:border-[#4E6E49]/40"}`,children:s.jsxs("span",{className:"flex items-center gap-2",children:[j,S]})},T)})]})]}),s.jsxs("div",{id:"filter-category",className:"space-y-3",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(Qt,{className:"w-4 h-4 text-purple-500"}),s.jsx("label",{className:`block text-sm font-semibold ${d}`,children:"Категории"})]}),s.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2",children:[s.jsxs("button",{onClick:()=>n("all"),className:`px-3 py-3 rounded-lg text-sm font-semibold transition-all border-2 flex items-center gap-2 justify-start text-left w-full ${r==="all"?c==="dark"?"bg-[#4E6E49]/20 border-[#4E6E49] text-[#4E6E49]":"bg-green-50 border-[#4E6E49] text-[#4E6E49]":`${c==="dark"?"bg-gray-900 border-gray-800 text-gray-200 hover:border-[#4E6E49]/40":"bg-white border-gray-200 text-gray-700 hover:border-[#4E6E49]/40"}`}`,children:[s.jsx(vd,{className:"w-4 h-4"}),"Всё"]}),Object.entries(ea).map(([T,{label:S}])=>{const z=mo[T],L=r===T;return s.jsx("button",{onClick:()=>n(T),className:`px-3 py-3 rounded-lg text-sm font-semibold transition-all border-2 flex flex-col items-start gap-2 text-left leading-tight whitespace-normal ${L?c==="dark"?"bg-[#4E6E49]/20 border-[#4E6E49] text-[#4E6E49]":"bg-green-50 border-[#4E6E49] text-[#4E6E49]":`${c==="dark"?"bg-gray-900 border-gray-800 text-gray-200 hover:border-[#4E6E49]/40":"bg-white border-gray-200 text-gray-700 hover:border-[#4E6E49]/40"}`}`,children:s.jsxs("span",{className:"flex items-center gap-2 justify-start",children:[s.jsx(z,{className:"w-4 h-4"}),s.jsx("span",{className:"break-words",children:S})]})},T)})]})]}),s.jsxs("div",{id:"filter-people",className:"space-y-3",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(bn,{className:"w-4 h-4 text-sky-500"}),s.jsx("label",{className:`block text-sm font-semibold ${d}`,children:"Исполнители"})]}),s.jsxs("div",{className:"flex flex-wrap gap-2",children:[s.jsx("button",{onClick:()=>i([]),className:`px-3 py-2 rounded-lg text-sm font-semibold transition-all border-2 ${t.length===0?c==="dark"?"bg-[#4E6E49]/20 border-[#4E6E49] text-[#4E6E49]":"bg-green-50 border-[#4E6E49] text-[#4E6E49]":`${c==="dark"?"bg-gray-900 border-gray-800 text-gray-200 hover:border-[#4E6E49]/40":"bg-white border-gray-200 text-gray-700 hover:border-[#4E6E49]/40"}`}`,children:"Все"}),Se.map(T=>{const S=t.includes(T.id);return s.jsxs("button",{onClick:()=>{i(S?t.filter(z=>z!==T.id):[...t,T.id])},className:`px-3 py-2 rounded-lg text-sm font-semibold transition-all border-2 flex items-center gap-2 ${S?c==="dark"?"bg-[#4E6E49]/20 border-[#4E6E49] text-[#4E6E49]":"bg-green-50 border-[#4E6E49] text-[#4E6E49]":`${c==="dark"?"bg-gray-900 border-gray-800 text-gray-200 hover:border-[#4E6E49]/40":"bg-white border-gray-200 text-gray-700 hover:border-[#4E6E49]/40"}`}`,children:[s.jsx(Ep,{className:`w-3 h-3 ${S?"text-[#4E6E49]":"text-gray-400"}`}),T.name]},T.id)})]})]})]})]})},lN=({tasks:r,onUpdate:e,onEdit:t,onDelete:n})=>{var ze,Qe;const{theme:a}=it(),{user:i}=jt(),{isAdmin:o}=At(),[c,d]=D.useState(null),[h,g]=D.useState(null),[f,p]=D.useState(null),[v,A]=D.useState(""),[T,S]=D.useState(null),[z,L]=D.useState(null),[C,j]=D.useState(null),[H,Y]=D.useState(null),I=a==="dark"?"text-white":"text-gray-900",y=a==="dark"?"bg-[#1a1a1a]":"bg-white",w=a==="dark"?"border-gray-800":"border-gray-300",N=["in_progress","completed","closed"],E=q=>q.assignees&&q.assignees.length>0?q.assignees:q.assignedTo.map(ne=>({userId:ne,priority:"medium"})),_=q=>E(q).map(ne=>ne.userId),x=q=>{if(q.stages&&q.stages.length>0){const ne=q.awaitingStageId||q.currentStageId||q.stages[0].id;return q.stages.find(Te=>Te.id===ne)||q.stages[0]}return{id:"legacy-stage",name:"Этап",responsible:"all",approvals:q.approvals||[],status:"pending",comments:[]}},de=q=>!!i&&q.createdBy===i.id,M=q=>!!i&&q.mainExecutor===i.id,X=q=>!!i&&(q.leadExecutor===i.id||(q.leads||[]).includes(i.id)),R=q=>o||de(q)||M(q)||X(q),ee=(q,ne)=>ne===q.createdBy?"A":ne===q.mainExecutor?"ГИ":ne===q.leadExecutor||(q.leads||[]).includes(ne)?"ВИ":"",J=q=>r.filter(ne=>ne.status===q),ae=(q,ne)=>{if(T||!R(ne)){q.preventDefault();return}d(ne),q.dataTransfer.effectAllowed="move",q.dataTransfer.setData("text/plain",ne.id)},U=q=>{q.preventDefault(),q.dataTransfer.dropEffect="move"},F=()=>{d(null)},V=(q,ne)=>{if(T||!R(ne))return;const Te=q.touches[0];L({x:Te.clientX,y:Te.clientY,task:ne})},te=q=>{if(!z)return;q.preventDefault();const ne=q.touches[0],Te=document.elementFromPoint(ne.clientX,ne.clientY);if(Te){const Z=Te.closest("[data-status]");if(Z){const $e=Z.getAttribute("data-status");$e&&j($e)}}},me=async(q,ne)=>{if(!z)return;const Te=q.changedTouches[0],Z=document.elementFromPoint(Te.clientX,Te.clientY);if(Z){const $e=Z.closest("[data-status]");if($e){const Fe=$e.getAttribute("data-status");Fe&&Fe!==ne&&await P(z.task,Fe)}}L(null),j(null)},xe=q=>{const ne=_(q),Te=new Date().toISOString(),$e=(q.approvals||[]).filter($=>ne.includes($.userId)).map($=>({userId:$.userId,status:$.status==="approved"?"approved":"pending",updatedAt:$.updatedAt||Te,...$.comment?{comment:$.comment}:{}})),Fe=ne.filter($=>!$e.some(k=>k.userId===$)).map($=>({userId:$,status:"pending",updatedAt:Te}));return[...$e,...Fe]},ue=q=>{const ne=xe(q),Te=_(q).length,Z=ne.filter($e=>$e.status==="approved").length;return{approvals:ne,approved:Z,total:Te}},O=q=>!!i&&_(q).includes(i.id),W=q=>o||de(q),ie=async(q,ne)=>{if(q.preventDefault(),q.stopPropagation(),!c||c.status===ne||T||!R(c)){d(null);return}const{approvals:Te,approved:Z,total:$e}=ue(c),Fe=new Date().toISOString();if(ne==="completed"&&($e===0||Z<$e)){d(null);return}if(ne==="closed"&&(!W(c)||c.status!=="completed")){d(null);return}const $={status:ne,updatedAt:Fe};ne==="completed"?($.completedAt=Fe,$.completedBy=(i==null?void 0:i.id)||"system",$.approvals=Te):ne==="closed"?$.closedAt=Fe:ne==="in_progress"&&($.approvals=_(c).map(k=>({userId:k,status:"pending",updatedAt:Fe})),$.completedAt=void 0,$.completedBy=void 0,$.closedAt=void 0),S(c.id);try{await $r(c.id,$),e()}catch(k){console.error("Error updating task status:",k)}finally{S(null),d(null)}},P=async(q,ne)=>{if(q.status===ne||T===q.id||!R(q)){g(null);return}const{approvals:Te,approved:Z,total:$e}=ue(q),Fe=new Date().toISOString();if(ne==="completed"&&($e===0||Z<$e)){g(null);return}if(ne==="closed"&&(!W(q)||q.status!=="completed")){g(null);return}const $={status:ne,updatedAt:Fe};ne==="completed"?($.completedAt=Fe,$.completedBy=(i==null?void 0:i.id)||"system",$.approvals=Te):ne==="closed"?$.closedAt=Fe:ne==="in_progress"&&($.approvals=_(q).map(k=>({userId:k,status:"pending",updatedAt:Fe})),$.completedAt=void 0,$.completedBy=void 0,$.closedAt=void 0),S(q.id);try{await $r(q.id,$),e(),g(null)}catch(k){console.error("Error updating task status:",k)}finally{S(null)}},oe=async q=>{if(!(!i||q.status!=="in_progress"||!O(q))){S(q.id);try{const ne=new Date().toISOString(),Te=xe(q).map($=>$.userId===i.id?{...$,status:"approved",updatedAt:ne}:$),Z=_(q),$e=Z.length>0&&Z.every($=>Te.find(k=>k.userId===$&&k.status==="approved")),Fe={approvals:Te,updatedAt:ne};$e&&(Fe.status="completed",Fe.completedAt=ne,Fe.completedBy=i.id),await $r(q.id,Fe),e()}catch(ne){console.error("Error confirming task:",ne)}finally{S(null)}}},je=async q=>{if(!(!W(q)||q.status!=="completed")){S(q.id);try{const ne=new Date().toISOString();await $r(q.id,{status:"closed",closedAt:ne,updatedAt:ne}),e()}catch(ne){console.error("Error closing task:",ne)}finally{S(null)}}},K=async(q,ne)=>{if(!W(q))return;const Te=(ne||"").trim();if(Te){S(q.id);try{const Z=new Date().toISOString(),$e=_(q).map($=>({userId:$,status:"pending",updatedAt:Z})),Fe={id:`c-${Date.now()}`,userId:(i==null?void 0:i.id)||"system",text:Te,createdAt:Z};await $r(q.id,{status:"in_progress",approvals:$e,completedAt:void 0,completedBy:void 0,closedAt:void 0,comments:[...q.comments||[],Fe],updatedAt:Z}),e(),p(null),A("")}catch(Z){console.error("Error returning task to work:",Z)}finally{S(null)}}},ge=q=>({in_progress:a==="dark"?"bg-blue-500/20 border-blue-500/50":"bg-blue-50 border-blue-200",completed:a==="dark"?"bg-[#4E6E49]/20 border-[#4E6E49]/50":"bg-green-50 border-green-200",closed:a==="dark"?"bg-gray-500/20 border-gray-500/50":"bg-gray-50 border-gray-200"})[q],pe=q=>({in_progress:a==="dark"?"text-blue-400":"text-blue-700",completed:"text-[#4E6E49]",closed:a==="dark"?"text-gray-400":"text-gray-700"})[q],Ce=q=>{const ne=new Date;return new Date(`${q.dueDate}T${q.dueTime}`)<ne&&q.status!=="completed"&&q.status!=="closed"};return s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"overflow-x-auto pb-4 -mx-4 px-4",children:s.jsx("div",{className:"flex gap-3 sm:gap-4 min-w-max",children:N.map(q=>{const ne=J(q),Te=Ss[q];return s.jsxs("div",{"data-status":q,className:`flex-shrink-0 w-[280px] sm:w-80 ${y} rounded-xl border-2 ${w} p-3 sm:p-4 ${C===q?"border-[#4E6E49]":""}`,onDragOver:U,onDrop:Z=>ie(Z,q),onTouchMove:te,children:[s.jsx("div",{className:`mb-3 sm:mb-4 pb-2 sm:pb-3 border-b ${w}`,children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("h3",{className:`text-base sm:text-lg font-bold ${pe(q)}`,children:Te.label}),s.jsx("span",{className:`px-2 py-1 rounded-lg text-xs sm:text-sm font-medium ${ge(q)} ${pe(q)}`,children:ne.length})]})}),s.jsxs("div",{className:"space-y-2 sm:space-y-3 max-h-[calc(100vh-280px)] sm:max-h-[calc(100vh-300px)] overflow-y-auto",children:[ne.map(Z=>{var ot,ft,bt;const $e=Ce(Z),Fe=o||(i==null?void 0:i.id)===Z.createdBy||Z.mainExecutor===(i==null?void 0:i.id),$=x(Z),ye=E(Z).map(De=>{const lt=Se.find(Pe=>Pe.id===De.userId);return lt?{...De,member:lt}:null}).filter(Boolean),{approvals:_e,approved:Ie,total:re}=ue(Z),ve=_e.find(De=>De.userId===(i==null?void 0:i.id)),we=O(Z)&&Z.status==="in_progress"&&(!ve||ve.status!=="approved"),Ae=W(Z)&&Z.status==="completed";return s.jsxs("div",{draggable:!T&&R(Z),onDragStart:De=>ae(De,Z),onDragEnd:F,onTouchStart:De=>V(De,Z),onTouchEnd:De=>me(De,q),className:`${y} rounded-lg border-2 ${w} p-2.5 sm:p-3 cursor-move hover:shadow-lg transition-all ${(c==null?void 0:c.id)===Z.id||(z==null?void 0:z.task.id)===Z.id?"opacity-50":""} ${$e?"border-red-500":""} ${T===Z.id?"opacity-50 pointer-events-none":""}`,children:[s.jsxs("div",{className:"flex items-start justify-between gap-2 mb-2",children:[s.jsx("h4",{className:`font-semibold text-xs sm:text-sm ${I} flex-1`,children:Z.title}),s.jsx("div",{className:"flex items-center gap-1 flex-shrink-0",children:s.jsxs("div",{className:"relative lg:hidden",children:[s.jsx("button",{onClick:()=>g((h==null?void 0:h.id)===Z.id?null:Z),className:`p-1 rounded ${a==="dark"?"hover:bg-gray-700":"hover:bg-gray-100"}`,children:s.jsx(zp,{className:"w-4 h-4"})}),(h==null?void 0:h.id)===Z.id&&s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"fixed inset-0 z-40",onClick:()=>g(null)}),s.jsx("div",{className:`absolute right-0 top-8 z-50 ${y} rounded-lg shadow-xl border-2 ${w} min-w-[200px]`,children:s.jsxs("div",{className:"p-2",children:[s.jsx("div",{className:`text-xs font-medium mb-2 px-2 py-1 ${a==="dark"?"text-gray-400":"text-gray-600"}`,children:"Изменить статус:"}),N.map(De=>s.jsx("button",{onClick:()=>P(Z,De),disabled:Z.status===De||T===Z.id||!R(Z),className:`w-full text-left px-3 py-2 rounded-lg text-sm transition-colors mb-1 ${Z.status===De?ge(De):a==="dark"?"hover:bg-gray-700":"hover:bg-gray-100"} ${Z.status===De?pe(De):I} disabled:opacity-50`,children:Ss[De].label},De)),Fe&&s.jsxs(s.Fragment,{children:[s.jsx("div",{className:`border-t ${w} my-2`}),s.jsx("button",{onClick:()=>{g(null),t(Z)},className:`w-full text-left px-3 py-2 rounded-lg text-sm transition-colors mb-1 ${a==="dark"?"hover:bg-gray-700":"hover:bg-gray-100"} ${I}`,children:"Редактировать"}),s.jsx("button",{onClick:()=>{g(null),Y(Z)},className:`w-full text-left px-3 py-2 rounded-lg text-sm transition-colors mb-1 ${a==="dark"?"hover:bg-gray-700":"hover:bg-gray-100"} ${I}`,children:"Всё о задаче"}),s.jsx("button",{onClick:()=>{g(null),n(Z.id)},className:`w-full text-left px-3 py-2 rounded-lg text-sm transition-colors ${a==="dark"?"hover:bg-red-500/20 text-red-400":"hover:bg-red-50 text-red-600"}`,children:"Удалить"})]})]})})]})]})})]}),s.jsxs("div",{className:"space-y-1.5 text-xs mb-2",children:[s.jsxs("div",{className:"space-y-1",children:[s.jsxs("div",{className:`flex items-center gap-1 ${a==="dark"?"text-blue-400":"text-blue-600"}`,children:[s.jsx("span",{className:"font-medium",children:"Автор:"}),s.jsx("span",{className:a==="dark"?"text-gray-400":"text-gray-600",children:((ot=Se.find(De=>De.id===Z.createdBy))==null?void 0:ot.name)||"Неизвестно"})]}),s.jsxs("div",{className:"flex flex-col gap-1",children:[s.jsx("div",{className:"flex items-center gap-1 text-[#4E6E49]",children:s.jsx("span",{className:"font-medium",children:"Исполнители:"})}),ye.length>0?ye.map(De=>s.jsx("div",{className:`text-[11px] sm:text-xs ${a==="dark"?"text-gray-300":"text-gray-700"} flex flex-wrap gap-1`,children:s.jsx("span",{className:"font-medium",children:De.member.name})},De.member.id)):s.jsx("span",{className:"text-gray-500",children:"Не назначены"})]})]}),s.jsxs("div",{className:`flex items-center gap-2 flex-wrap ${a==="dark"?"text-gray-400":"text-gray-600"}`,children:[s.jsxs("span",{className:"inline-flex items-center gap-1",children:[s.jsx(Go,{className:"w-3.5 h-3.5"}),ce(new Date(Z.dueDate),"dd.MM.yyyy")]}),s.jsxs("span",{className:"inline-flex items-center gap-1",children:[s.jsx(Hn,{className:"w-3.5 h-3.5"}),Z.dueTime]}),s.jsx(d0,{dueDate:Z.dueDate,dueTime:Z.dueTime,theme:a,size:"compact"})]}),s.jsx("div",{className:"flex items-center gap-1 text-[11px]",children:s.jsx("span",{className:`px-2 py-0.5 rounded-full border ${a==="dark"?"border-yellow-500/40 text-yellow-200 bg-yellow-500/10":"border-yellow-200 text-yellow-700 bg-yellow-50"}`,children:Z.priority==="urgent"?"Экстренный приоритет":Z.priority==="high"?"Высокий приоритет":Z.priority==="medium"?"Средний приоритет":"Низкий приоритет"})}),re>0&&s.jsxs("div",{className:`flex items-center justify-between gap-2 ${a==="dark"?"text-yellow-300":"text-yellow-700"}`,children:[s.jsxs("span",{className:"inline-flex items-center gap-1",children:[s.jsx(ph,{className:"w-3 h-3"}),"Подтверждения исполнителей"]}),s.jsxs("span",{className:"text-[11px] font-semibold",children:[Ie,"/",re]})]}),Z.description&&s.jsx("p",{className:`line-clamp-2 ${a==="dark"?"text-gray-300":"text-gray-600"}`,children:Z.description}),_e.length>0&&s.jsx("div",{className:`mt-1 space-y-1 ${a==="dark"?"text-gray-300":"text-gray-700"}`,children:_e.map(De=>{const lt=Se.find(Xe=>Xe.id===De.userId),Pe=De.status==="approved"?"подтвердил":"в ожидании";return s.jsxs("div",{className:"flex items-center justify-between text-[11px]",children:[s.jsxs("span",{className:"flex items-center gap-1",children:[s.jsxs("span",{className:"font-medium",children:[(lt==null?void 0:lt.name)||De.userId,ee(Z,De.userId)&&s.jsx("span",{className:"ml-1 text-[10px] px-1 rounded bg-gray-200 dark:bg-gray-800",children:ee(Z,De.userId)})]}),s.jsxs("span",{className:"text-gray-500",children:["(",Pe,")"]})]}),De.comment&&s.jsx("span",{className:"truncate max-w-[140px] text-gray-500",children:De.comment})]},De.userId)})}),(((ft=Z.comments)==null?void 0:ft.length)||((bt=$.comments)==null?void 0:bt.length))&&s.jsx("div",{className:"mt-2 space-y-1",children:[...Z.comments||[],...$.comments||[]].map(De=>{const lt=Se.find(Pe=>Pe.id===De.userId);return s.jsxs("div",{className:`text-[11px] ${a==="dark"?"text-gray-300":"text-gray-700"}`,children:[s.jsx("span",{className:"font-semibold",children:(lt==null?void 0:lt.name)||De.userId})," ",s.jsx("span",{className:"text-gray-500",children:De.stageId?"(этап)":"(задача)"}),": ",De.text]},De.id)})}),s.jsx("div",{className:"flex items-center gap-2 flex-wrap",children:s.jsx("span",{className:`px-1.5 py-0.5 rounded text-xs inline-flex items-center gap-1 ${ge(q)} ${pe(q)}`,children:(()=>{const De=mo[Z.category];return s.jsx(De,{className:"w-3.5 h-3.5"})})()})})]}),s.jsx("div",{className:"flex justify-end mt-1",children:s.jsx("button",{onClick:()=>Y(Z),className:`text-[11px] underline ${a==="dark"?"text-gray-300":"text-gray-600"} hover:text-[#4E6E49]`,children:"Всё о задаче"})}),s.jsxs("div",{className:`flex flex-col gap-2 mt-2 pt-2 border-t ${w}`,children:[we&&s.jsxs("button",{onClick:()=>oe(Z),disabled:T===Z.id,className:"w-full px-2 py-1.5 bg-[#4E6E49] hover:bg-emerald-700 text-white rounded-lg text-xs font-medium transition-colors flex items-center justify-center gap-1 disabled:opacity-50",children:[s.jsx(Rs,{className:"w-3 h-3"}),"Подтвердить"]}),Ae&&s.jsxs("div",{className:"flex gap-2",children:[s.jsxs("button",{onClick:()=>je(Z),disabled:T===Z.id,className:"flex-1 px-2 py-1.5 bg-blue-600 hover:bg-blue-700 text-white rounded-lg text-xs font-medium transition-colors flex items-center justify-center gap-1 disabled:opacity-50",children:[s.jsx(Rs,{className:"w-3 h-3"}),"Закрыто"]}),s.jsxs("button",{onClick:()=>{p({task:Z}),A("")},disabled:T===Z.id,className:"flex-1 px-2 py-1.5 bg-red-500 hover:bg-red-600 text-white rounded-lg text-xs font-medium transition-colors flex items-center justify-center gap-1 disabled:opacity-50",children:[s.jsx(Zt,{className:"w-3 h-3"}),"Не выполнено"]})]}),Z.status==="completed"&&!Ae&&s.jsx("p",{className:`text-[11px] ${a==="dark"?"text-gray-400":"text-gray-500"}`,children:"Ожидает подтверждения автора"})]})]},Z.id)}),ne.length===0&&s.jsxs("div",{className:`text-center py-6 sm:py-8 ${a==="dark"?"text-gray-500":"text-gray-400"}`,children:[s.jsx(Fr,{className:"w-6 h-6 sm:w-8 sm:h-8 mx-auto mb-2 opacity-50"}),s.jsx("p",{className:"text-xs sm:text-sm",children:"Нет задач"})]})]})]},q)})})}),f&&s.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-start sm:items-center justify-center z-[70] p-4 overflow-y-auto overscroll-contain modal-scroll",children:s.jsxs("div",{className:`${y} rounded-xl p-6 max-w-md w-full border-2 ${w}`,children:[s.jsx("h3",{className:`text-lg font-bold mb-4 ${I}`,children:"Не выполнено"}),s.jsx("textarea",{value:v,onChange:q=>A(q.target.value),placeholder:"Опишите, что нужно доработать",rows:3,className:`w-full px-4 py-2 rounded-lg border ${w} ${a==="dark"?"bg-gray-700":"bg-gray-50"} ${I} mb-4 focus:outline-none focus:ring-2 focus:ring-[#4E6E49]/50`}),s.jsxs("div",{className:"flex gap-3",children:[s.jsx("button",{onClick:()=>f.task&&K(f.task,v),disabled:T===f.task.id||!v.trim(),className:"flex-1 px-4 py-2 rounded-lg font-medium transition-colors bg-red-500 hover:bg-red-600 text-white disabled:opacity-50",children:"Отправить на доработку"}),s.jsx("button",{onClick:()=>{p(null),A("")},className:`px-4 py-2 rounded-lg font-medium transition-colors ${a==="dark"?"bg-gray-700 hover:bg-gray-600":"bg-gray-200 hover:bg-gray-300"}`,children:"Отмена"})]})]})}),H&&s.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-start sm:items-center justify-center z-[70] p-4 overflow-y-auto overscroll-contain modal-scroll",children:s.jsxs("div",{className:`${y} rounded-xl p-6 max-w-2xl w-full border-2 ${w}`,children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsx("h3",{className:`text-lg font-bold ${I}`,children:"Всё о задаче"}),s.jsx("button",{onClick:()=>Y(null),className:`p-2 rounded-lg ${a==="dark"?"hover:bg-gray-700":"hover:bg-gray-100"}`,children:s.jsx(Zt,{className:"w-4 h-4"})})]}),s.jsxs("div",{className:"space-y-4 text-sm",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-xs text-gray-500",children:"Название"}),s.jsx("p",{className:`font-semibold ${I}`,children:H.title})]}),H.description&&s.jsxs("div",{children:[s.jsx("p",{className:"text-xs text-gray-500",children:"Описание"}),s.jsx("p",{className:a==="dark"?"text-gray-300":"text-gray-700",children:H.description})]}),H.expectedResult&&s.jsxs("div",{children:[s.jsx("p",{className:"text-xs text-gray-500",children:"Ожидаемый результат"}),s.jsx("p",{className:a==="dark"?"text-gray-300":"text-gray-700",children:H.expectedResult})]}),s.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-xs text-gray-500",children:"Автор"}),s.jsx("p",{className:I,children:((ze=Se.find(q=>q.id===H.createdBy))==null?void 0:ze.name)||H.createdBy})]}),s.jsxs("div",{children:[s.jsx("p",{className:"text-xs text-gray-500",children:"Категория"}),s.jsx("p",{className:I,children:((Qe=ea[H.category])==null?void 0:Qe.label)||H.category})]}),s.jsxs("div",{children:[s.jsx("p",{className:"text-xs text-gray-500",children:"Приоритет"}),s.jsx("p",{className:I,children:H.priority==="urgent"?"Экстренный":H.priority==="high"?"Высокий":H.priority==="medium"?"Средний":"Низкий"})]}),s.jsxs("div",{children:[s.jsx("p",{className:"text-xs text-gray-500",children:"Дедлайн"}),s.jsxs("p",{className:I,children:[ce(new Date(H.dueDate),"dd.MM.yyyy")," · ",H.dueTime]})]})]}),s.jsxs("div",{children:[s.jsx("p",{className:"text-xs text-gray-500",children:"Статус"}),s.jsx("p",{className:`${I} font-semibold`,children:Ss[H.status].label})]}),H.stages&&H.stages.length>0&&s.jsxs("div",{className:"space-y-2",children:[s.jsx("p",{className:"text-xs text-gray-500",children:"Этапы"}),H.stages.map(q=>{var ne,Te;return s.jsxs("div",{className:`p-3 rounded border ${w} space-y-2`,children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("p",{className:`font-semibold ${I}`,children:q.name}),s.jsxs("p",{className:"text-xs text-gray-500",children:[((ne=q.approvals)==null?void 0:ne.filter(Z=>Z.status==="approved").length)||0,"/",((Te=q.approvals)==null?void 0:Te.length)||0," подтверждений"]})]}),q.assignees&&q.assignees.length>0&&s.jsx("div",{className:"space-y-1 text-xs",children:q.assignees.map(Z=>{const $e=Se.find(Fe=>Fe.id===Z.userId);return s.jsx("div",{className:"flex items-start justify-between gap-2",children:s.jsx("span",{className:"font-medium",children:($e==null?void 0:$e.name)||Z.userId})},Z.userId)})})]},q.id)})]})]})]})})]})},cN=()=>{var O;const{theme:r}=it(),{user:e}=jt(),[t,n]=D.useState(!1),[a,i]=D.useState(null),[o,c]=D.useState([]),[d,h]=D.useState(!0),[g,f]=D.useState("all"),[p,v]=D.useState("all"),[A,T]=D.useState([]),[S,z]=D.useState("kanban"),L=r==="dark"?"text-white":"text-gray-900",C=r==="dark"?"bg-[#1a1a1a]":"bg-white";D.useEffect(()=>{j()},[e]),D.useEffect(()=>{j()},[g,p,A]);const j=async()=>{h(!0);try{const W={};g!=="all"&&(W.category=g),p!=="all"&&(W.status=p),A.length>0&&(W.assignedTo=A);const ie=await Yg(W);c(ie)}catch(W){console.error("Error loading tasks:",W)}finally{h(!1)}},H=W=>{i(W),n(!0)},Y=async W=>{if(confirm("Вы уверены, что хотите удалить эту задачу?"))try{await Qg(W),j()}catch(ie){console.error("Error deleting task:",ie)}},I=()=>{n(!1),i(null)},y=()=>{n(!1),i(null),j()},w=()=>{f("all"),v("all"),T([])},N=o.filter(W=>!(g!=="all"&&W.category!==g||p!=="all"&&W.status!==p||A.length>0&&!A.some(ie=>W.assignedTo.includes(ie)))),E={inProgress:o.filter(W=>W.status==="in_progress").length,completed:o.filter(W=>W.status==="completed").length,closed:o.filter(W=>W.status==="closed").length},_=new Date,x=ce(_,"yyyy-MM-dd"),de=new Date(_);de.setDate(_.getDate()-7);const M=new Date(_);M.setDate(_.getDate()-30);const X=o.filter(W=>new Date(W.createdAt)>=de).length,R=o.filter(W=>new Date(W.createdAt)>=M).length,ee=o.filter(W=>W.completedAt&&W.completedAt.startsWith(x)).length,J=e?o.filter(W=>W.mainExecutor===e.id||W.leadExecutor===e.id||(W.assignedTo||[]).includes(e.id)||(W.coExecutors||[]).includes(e.id)):[],ae=J.length,U=o.length,F=U?Math.round(E.inProgress/U*100):0,V=(()=>{var P;const W={};return o.forEach(oe=>{[oe.mainExecutor,oe.leadExecutor,...oe.assignedTo||[],...oe.coExecutors||[]].filter(Boolean).forEach(K=>{W[K]=(W[K]||0)+1})}),((P=Object.entries(W).sort((oe,je)=>je[1]-oe[1])[0])==null?void 0:P[0])||""})(),te=V?((O=Se.find(W=>W.id===V))==null?void 0:O.name)||V:"—",me=o.filter(W=>W.status!=="completed"&&W.status!=="closed").sort((W,ie)=>new Date(`${W.dueDate}T${W.dueTime}`).getTime()-new Date(`${ie.dueDate}T${ie.dueTime}`).getTime())[0],xe=[{label:"Всего задач на неделе",value:X,sub:"последние 7 дней",tone:"sky"},{label:"Всего задач на месяце",value:R,sub:"последние 30 дней",tone:"emerald"},{label:"Задач в работе",value:E.inProgress,sub:`${F}% от всех`,tone:"blue"},{label:"Отмечено исполнителями",value:E.completed,sub:"ожидают проверки автора",tone:"amber"},{label:"Самый активный исполнитель",value:te,sub:"по числу назначений",tone:"purple"},{label:"Закрыто автором",value:E.closed,sub:"финально подтверждено",tone:"slate"},{label:"Ближайший дедлайн",value:me?me.title:"Нет активных",sub:me?`${ce(new Date(me.dueDate),"dd.MM.yyyy")} · ${me.dueTime}`:"Свободное окно",tone:"pink"},{label:"Сделано задач за сегодня",value:ee,sub:x,tone:"green"}],ue=[{href:"#tasks-board",label:"Все задачи"},{href:"#my-tasks",label:"Мои задачи",action:()=>e&&T([e.id])},{href:"#tasks-stats",label:"Статистика"}];return s.jsx(dr,{children:s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:`rounded-xl sm:rounded-2xl p-4 sm:p-6 md:p-8 ${C} shadow-xl border-2 ${r==="dark"?"border-[#4E6E49]/30 bg-gradient-to-br from-[#1a1a1a] via-[#1a1a1a] to-[#0A0A0A]":"border-green-200 bg-gradient-to-br from-white via-green-50/30 to-white"} relative overflow-hidden`,children:[s.jsx("div",{className:"absolute top-0 right-0 w-32 h-32 sm:w-64 sm:h-64 bg-gradient-to-br from-[#4E6E49]/10 to-emerald-700/10 rounded-full blur-3xl -mr-16 sm:-mr-32 -mt-16 sm:-mt-32"}),s.jsx("div",{className:"absolute bottom-0 left-0 w-24 h-24 sm:w-48 sm:h-48 bg-gradient-to-tr from-yellow-500/10 to-orange-500/10 rounded-full blur-2xl -ml-12 sm:-ml-24 -mb-12 sm:-mb-24"}),s.jsxs("div",{className:"relative z-10",children:[s.jsx("div",{className:"flex flex-col gap-4 sm:gap-6 lg:flex-row lg:items-start lg:justify-between mb-4 sm:mb-6",children:s.jsxs("div",{className:"flex-1",children:[s.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 mb-2",children:[s.jsx(Fr,{className:"w-6 h-6 sm:w-8 sm:h-8 text-[#4E6E49]"}),s.jsxs("h1",{className:`text-2xl sm:text-3xl md:text-4xl font-extrabold ${L} flex items-center gap-2`,children:["Task Team",s.jsx(Qt,{className:`w-5 h-5 sm:w-6 sm:h-6 ${r==="dark"?"text-yellow-400":"text-yellow-600"}`})]})]}),s.jsx("p",{className:`text-sm sm:text-base ${r==="dark"?"text-gray-300":"text-gray-600"}`,children:"Управление задачами и заданиями команды"}),s.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:ue.map(W=>s.jsx("a",{href:W.href,onClick:()=>{var ie;return(ie=W.action)==null?void 0:ie.call(W)},className:`px-3 py-1.5 rounded-lg text-xs font-semibold border transition ${r==="dark"?"border-white/10 bg-white/5 text-white hover:border-[#4E6E49]/50":"border-gray-200 bg-white text-gray-800 hover:border-[#4E6E49]/50 hover:text-[#4E6E49]"}`,children:W.label},W.href))})]})}),s.jsx("div",{id:"tasks-stats",className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3 sm:gap-4",children:xe.map(W=>{const P={emerald:{bg:r==="dark"?"bg-emerald-500/10":"bg-emerald-50",text:r==="dark"?"text-emerald-100":"text-emerald-800",border:r==="dark"?"border-emerald-500/30":"border-emerald-200"},sky:{bg:r==="dark"?"bg-sky-500/10":"bg-sky-50",text:r==="dark"?"text-sky-100":"text-sky-800",border:r==="dark"?"border-sky-500/30":"border-sky-200"},amber:{bg:r==="dark"?"bg-amber-500/10":"bg-amber-50",text:r==="dark"?"text-amber-100":"text-amber-800",border:r==="dark"?"border-amber-500/30":"border-amber-200"},blue:{bg:r==="dark"?"bg-blue-500/10":"bg-blue-50",text:r==="dark"?"text-blue-100":"text-blue-800",border:r==="dark"?"border-blue-500/30":"border-blue-200"},purple:{bg:r==="dark"?"bg-purple-500/10":"bg-purple-50",text:r==="dark"?"text-purple-100":"text-purple-800",border:r==="dark"?"border-purple-500/30":"border-purple-200"},slate:{bg:r==="dark"?"bg-gray-500/10":"bg-gray-50",text:r==="dark"?"text-gray-100":"text-gray-800",border:r==="dark"?"border-gray-500/30":"border-gray-200"},pink:{bg:r==="dark"?"bg-pink-500/10":"bg-pink-50",text:r==="dark"?"text-pink-100":"text-pink-800",border:r==="dark"?"border-pink-500/30":"border-pink-200"},green:{bg:r==="dark"?"bg-green-500/10":"bg-green-50",text:r==="dark"?"text-green-100":"text-green-800",border:r==="dark"?"border-green-500/30":"border-green-200"}}[W.tone];return s.jsxs("div",{className:`p-4 rounded-xl border ${P.border} ${P.bg} shadow-sm space-y-1`,children:[s.jsx("p",{className:`text-xs font-semibold uppercase ${P.text}`,children:W.label}),s.jsx("p",{className:`text-2xl font-extrabold ${L} truncate`,children:W.value}),s.jsx("p",{className:`text-xs ${r==="dark"?"text-gray-400":"text-gray-600"}`,children:W.sub})]},W.label)})})]})]}),e&&s.jsxs("div",{id:"my-tasks",className:`rounded-xl sm:rounded-2xl p-4 sm:p-6 ${C} border-2 ${r==="dark"?"border-white/10":"border-gray-200"}`,children:[s.jsxs("div",{className:"flex items-center justify-between gap-3 mb-3",children:[s.jsxs("div",{children:[s.jsx("p",{className:`text-xs uppercase font-semibold ${r==="dark"?"text-gray-400":"text-gray-500"}`,children:"Мои задачи"}),s.jsx("p",{className:`text-xl font-bold ${L}`,children:ae})]}),s.jsx("a",{href:"#tasks-board",className:`px-3 py-2 rounded-lg text-xs font-semibold border ${r==="dark"?"border-white/10 bg-white/5 text-white hover:border-[#4E6E49]/50":"border-gray-200 bg-white text-gray-800 hover:border-[#4E6E49]/50 hover:text-[#4E6E49]"}`,children:"Перейти на доску"})]}),J.length===0?s.jsx("p",{className:r==="dark"?"text-gray-400":"text-gray-600",children:"Нет назначенных задач"}):s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:J.slice(0,4).map(W=>s.jsxs("div",{className:`p-3 rounded-lg border ${r==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white"}`,children:[s.jsx("p",{className:`text-sm font-semibold ${L} truncate`,children:W.title}),s.jsxs("p",{className:`text-xs ${r==="dark"?"text-gray-400":"text-gray-600"}`,children:[ce(new Date(W.dueDate),"dd.MM.yyyy")," · ",W.dueTime]}),s.jsx("p",{className:"text-xs mt-1",children:s.jsx("span",{className:`px-2 py-0.5 rounded-full ${r==="dark"?"bg-gray-800 text-gray-200":"bg-gray-100 text-gray-700"}`,children:Ss[W.status].label})})]},W.id))})]}),s.jsxs("div",{className:"flex flex-col lg:flex-row gap-4 sm:gap-6",id:"tasks-board",children:[s.jsx("div",{className:"lg:w-80 flex-shrink-0",children:s.jsx(oN,{selectedCategory:g,selectedStatus:p,selectedUsers:A,onCategoryChange:f,onStatusChange:v,onUsersChange:T,onClear:w})}),s.jsxs("div",{className:"flex-1",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4 gap-3",children:[s.jsxs("h2",{className:`text-xl font-bold ${L}`,children:["Задачи (",N.length,")"]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsxs("div",{className:`flex rounded-lg border-2 ${r==="dark"?"border-gray-800":"border-gray-300"} overflow-hidden`,children:[s.jsx("button",{onClick:()=>z("kanban"),className:`px-3 py-2 transition-colors ${S==="kanban"?"bg-[#4E6E49] text-white":r==="dark"?"bg-[#1a1a1a] text-gray-300 hover:bg-gray-700":"bg-white text-gray-700 hover:bg-gray-50"}`,title:"Kanban доска",children:s.jsx(Fp,{className:"w-4 h-4"})}),s.jsx("button",{onClick:()=>z("list"),className:`px-3 py-2 transition-colors ${S==="list"?"bg-[#4E6E49] text-white":r==="dark"?"bg-[#1a1a1a] text-gray-300 hover:bg-gray-700":"bg-white text-gray-700 hover:bg-gray-50"}`,title:"Список",children:s.jsx(Up,{className:"w-4 h-4"})})]}),s.jsxs("button",{onClick:()=>n(!0),className:"px-4 py-2 bg-gradient-to-r from-[#4E6E49] to-emerald-700 hover:from-[#4E6E49] hover:to-emerald-700 text-white rounded-lg font-semibold transition-all shadow-lg hover:shadow-xl transform hover:scale-105 flex items-center gap-2",children:[s.jsx(ra,{className:"w-5 h-5"}),s.jsx("span",{className:"hidden sm:inline",children:"Новая задача"}),s.jsx("span",{className:"sm:hidden",children:"Добавить"})]})]})]}),d?s.jsx("div",{className:`${C} rounded-xl p-8 text-center ${L}`,children:s.jsx("div",{className:"animate-pulse",children:"Загрузка..."})}):N.length===0?s.jsxs("div",{className:`${C} rounded-xl p-8 text-center border-2 ${r==="dark"?"border-gray-800":"border-gray-300"}`,children:[s.jsx(Fr,{className:`w-12 h-12 mx-auto mb-4 ${r==="dark"?"text-gray-600":"text-gray-400"}`}),s.jsx("p",{className:`text-lg font-medium ${L} mb-2`,children:"Нет задач"}),s.jsx("p",{className:`text-sm ${r==="dark"?"text-gray-400":"text-gray-600"}`,children:g!=="all"||p!=="all"||A.length>0?"Попробуйте изменить фильтры":"Создайте первую задачу"})]}):S==="kanban"?s.jsx(lN,{tasks:N,onUpdate:j,onEdit:H,onDelete:Y}):s.jsx("div",{className:"grid grid-cols-1 gap-4 sm:gap-6",children:N.map(W=>s.jsx(iN,{task:W,onEdit:H,onDelete:Y,onUpdate:j},W.id))})]})]}),t&&s.jsx(tN,{onClose:I,onSave:y,editingTask:a})]})})},dN=()=>{const{theme:r}=it(),{isAdmin:e}=At(),t=r==="dark"?"text-white":"text-gray-900",n=r==="dark"?"text-gray-300":"text-gray-700",a=r==="dark"?"bg-[#1a1a1a]":"bg-white";return e?s.jsx(dr,{children:s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:`rounded-2xl p-6 ${a} shadow-lg border-2 ${r==="dark"?"border-purple-500/30 bg-gradient-to-br from-[#1a1a1a] to-[#1a1a1a]/90":"border-purple-200 bg-gradient-to-br from-white to-purple-50/30"}`,children:[s.jsxs("div",{className:"flex items-start gap-4 mb-6",children:[s.jsx("div",{className:`p-3 rounded-xl ${r==="dark"?"bg-purple-500/20":"bg-purple-100"}`,children:s.jsx(Gt,{className:`w-8 h-8 ${r==="dark"?"text-purple-400":"text-purple-600"}`})}),s.jsxs("div",{className:"flex-1",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[s.jsx("h1",{className:`text-3xl font-bold bg-gradient-to-r ${r==="dark"?"from-purple-400 to-pink-400 text-transparent bg-clip-text":"from-purple-600 to-pink-600 text-transparent bg-clip-text"}`,children:"Панель администратора"}),s.jsx(Qt,{className:`w-5 h-5 ${r==="dark"?"text-yellow-400":"text-yellow-500"} animate-pulse`})]}),s.jsxs("p",{className:`${n} text-sm flex items-center gap-2`,children:[s.jsx(pi,{className:"w-4 h-4"}),"Управление системой и командой ApeVault"]})]})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-6",children:[s.jsxs("div",{className:`p-4 rounded-xl border-2 ${r==="dark"?"bg-blue-500/10 border-blue-500/30":"bg-blue-50 border-blue-200"}`,children:[s.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[s.jsx("div",{className:`p-2 rounded-lg ${r==="dark"?"bg-blue-500/20":"bg-blue-100"}`,children:s.jsx(Gt,{className:`w-5 h-5 ${r==="dark"?"text-blue-400":"text-blue-600"}`})}),s.jsx("h3",{className:`font-semibold ${t}`,children:"Доступ к функциям"})]}),s.jsx("p",{className:`text-sm ${n}`,children:"В режиме администратора вы можете управлять слотами, статусами и заработком всех участников команды"})]}),s.jsxs("div",{className:"p-4 rounded-xl border-2 bg-[#4E6E49]/10 border-[#4E6E49]/30",children:[s.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[s.jsx("div",{className:`p-2 rounded-lg ${r==="dark"?"bg-[#4E6E49]/20":"bg-green-100"}`,children:s.jsx(Vp,{className:"w-5 h-5 text-[#4E6E49]"})}),s.jsx("h3",{className:`font-semibold ${t}`,children:"Безопасность"})]}),s.jsx("p",{className:`text-sm ${n}`,children:"Режим администратора требует ввода пароля. Не делитесь паролем с другими участниками"})]})]}),s.jsx("div",{className:`pt-4 border-t ${r==="dark"?"border-gray-800":"border-gray-200"}`,children:s.jsxs("div",{className:`flex items-center gap-3 p-4 rounded-xl ${r==="dark"?"bg-[#4E6E49]/20 border-2 border-[#4E6E49]/50":"bg-green-50 border-2 border-green-200"}`,children:[s.jsx("div",{className:`p-2 rounded-lg ${r==="dark"?"bg-[#4E6E49]/30":"bg-green-100"}`,children:s.jsx(Gt,{className:"w-6 h-6 text-[#4E6E49]"})}),s.jsxs("div",{children:[s.jsx("h3",{className:`font-semibold mb-1 ${t}`,children:"Режим администратора активен"}),s.jsx("p",{className:`text-sm ${n}`,children:"Вы вошли в систему как администратор. Все административные функции доступны."})]})]})})]}),s.jsxs("div",{className:`rounded-2xl p-6 ${a} shadow-lg border-2 ${r==="dark"?"border-gray-800":"border-gray-200"}`,children:[s.jsx("h2",{className:`text-xl font-semibold mb-4 ${t}`,children:"Возможности администратора"}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsxs("div",{className:`p-4 rounded-xl border ${r==="dark"?"border-gray-800 bg-gray-700/30":"border-gray-200 bg-gray-50"}`,children:[s.jsx("h3",{className:`font-semibold mb-2 ${t}`,children:"📅 Управление слотами"}),s.jsxs("ul",{className:`text-sm space-y-1 ${n} list-disc list-inside`,children:[s.jsx("li",{children:"Создание слотов для любого участника"}),s.jsx("li",{children:"Массовое создание слотов"}),s.jsx("li",{children:"Удаление слотов любого участника"}),s.jsx("li",{children:"Массовое удаление слотов"})]})]}),s.jsxs("div",{className:`p-4 rounded-xl border ${r==="dark"?"border-gray-800 bg-gray-700/30":"border-gray-200 bg-gray-50"}`,children:[s.jsx("h3",{className:`font-semibold mb-2 ${t}`,children:"📋 Управление статусами"}),s.jsxs("ul",{className:`text-sm space-y-1 ${n} list-disc list-inside`,children:[s.jsx("li",{children:"Установка выходных, больничных и отпуск"}),s.jsx("li",{children:"Массовое управление статусами"}),s.jsx("li",{children:"Удаление статусов любого участника"})]})]}),s.jsxs("div",{className:`p-4 rounded-xl border ${r==="dark"?"border-gray-800 bg-gray-700/30":"border-gray-200 bg-gray-50"}`,children:[s.jsx("h3",{className:`font-semibold mb-2 ${t}`,children:"💰 Управление заработком"}),s.jsxs("ul",{className:`text-sm space-y-1 ${n} list-disc list-inside`,children:[s.jsx("li",{children:"Добавление заработка за любую дату"}),s.jsx("li",{children:"Редактирование записей о заработке"}),s.jsx("li",{children:"Удаление записей о заработке"})]})]}),s.jsxs("div",{className:`p-4 rounded-xl border ${r==="dark"?"border-gray-800 bg-gray-700/30":"border-gray-200 bg-gray-50"}`,children:[s.jsx("h3",{className:`font-semibold mb-2 ${t}`,children:"📊 Дополнительно"}),s.jsxs("ul",{className:`text-sm space-y-1 ${n} list-disc list-inside`,children:[s.jsx("li",{children:"Удаление сообщений из подсчета"}),s.jsx("li",{children:"Полный доступ ко всем функциям"}),s.jsx("li",{children:"Просмотр и управление данными команды"})]})]})]})]})]})}):s.jsx(dr,{children:s.jsx("div",{className:`rounded-2xl p-8 ${a} shadow-xl border-2 ${r==="dark"?"border-red-500/30 bg-gradient-to-br from-[#1a1a1a] to-[#0A0A0A]":"border-red-200 bg-gradient-to-br from-white to-red-50/20"} relative overflow-hidden`,children:s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:`inline-flex p-4 rounded-2xl mb-4 ${r==="dark"?"bg-red-500/20":"bg-red-100"}`,children:s.jsx(pi,{className:`w-12 h-12 ${r==="dark"?"text-red-400":"text-red-600"}`})}),s.jsx("h2",{className:`text-2xl font-bold mb-2 ${t}`,children:"Доступ запрещен"}),s.jsx("p",{className:n,children:'Эта страница доступна только администраторам. Для входа используйте режим "Админ" на странице входа.'})]})})})},uN=()=>{var ue;const{theme:r}=it(),{user:e,logout:t}=jt(),{isAdmin:n,deactivateAdmin:a}=At(),i=ah(),[o,c]=D.useState(!1),[d,h]=D.useState(!1),[g,f]=D.useState([]),[p,v]=D.useState(null),[A,T]=D.useState(null),[S,z]=D.useState(null),[L,C]=D.useState([]),[j,H]=D.useState({id:"",userId:"",title:"",text:"",priority:"medium",createdAt:"",updatedAt:""}),[Y,I]=D.useState(!0),[y,w]=D.useState(!1),[N,E]=D.useState([]),_=e||(n?{name:"Администратор",login:"admin",password:mh}:null),x=e!=null&&e.id?(ue=Se.find(O=>O.id===e.id))==null?void 0:ue.avatar:void 0,de=_!=null&&_.name?_.name.charAt(0).toUpperCase():"A",M=r==="dark"?"text-white":"text-gray-900";D.useEffect(()=>{(e||n)&&X()},[e,n]);const X=async()=>{if(!(!e&&!n)){I(!0);try{const O=(e==null?void 0:e.id)||"admin",W=await Yg({assignedTo:O});if(f(W),e){const ie=Ca(),P=ce(ie.start,"yyyy-MM-dd"),oe=ce(ie.end,"yyyy-MM-dd"),je=a0(30),K=ce(je.start,"yyyy-MM-dd"),ge=ce(je.end,"yyyy-MM-dd"),pe=je.start.toISOString(),Ce=je.end.toISOString(),ze=await ma(O,P,oe),Qe=ze.reduce((Ne,Oe)=>{const at=Oe.participants&&Oe.participants.length>0?Oe.participants.length:1;return Ne+Oe.amount/at},0),q=ze.reduce((Ne,Oe)=>{const at=Oe.participants&&Oe.participants.length>0?Oe.participants.length:1;return Ne+Oe.poolAmount/at},0),ne=await ma(O,K,ge),Te=ne.reduce((Ne,Oe)=>{const at=Oe.participants&&Oe.participants.length>0?Oe.participants.length:1;return Ne+Oe.amount/at},0),Z=ne.reduce((Ne,Oe)=>{const at=Oe.participants&&Oe.participants.length>0?Oe.participants.length:1;return Ne+Oe.poolAmount/at},0),Fe=(await br(O)).filter(Ne=>{const Oe=Ne.date,at=Ne.endDate||Ne.date;return Oe<=ge&&at>=K}),$=Fe.filter(Ne=>Ne.type==="dayoff").reduce((Ne,Oe)=>Ne+an(Oe.date,Oe.endDate,K,ge),0),k=Fe.filter(Ne=>Ne.type==="sick").reduce((Ne,Oe)=>Ne+an(Oe.date,Oe.endDate,K,ge),0),ye=Fe.filter(Ne=>Ne.type==="vacation").reduce((Ne,Oe)=>Ne+an(Oe.date,Oe.endDate,K,ge),0),re=(await Kr(O)).filter(Ne=>Ne.date>=P&&Ne.date<=oe).reduce((Ne,Oe)=>Ne+ho(Oe.slots),0),ve=await qg(O,P,oe),Ae=(await Wg(O))[0]||{userId:O,earnings:0,messages:0,initiatives:0,signals:0,profitableSignals:0,referrals:0,daysOff:0,sickDays:0,vacationDays:0,poolAmount:0,rating:0,lastUpdated:new Date().toISOString()},ft=(await Hg(void 0,pe,Ce)).filter(Ne=>Ne.ownerId===O).length,bt={userId:O,earnings:Te,messages:Ae.messages||0,initiatives:Ae.initiatives||0,signals:Ae.signals||0,profitableSignals:Ae.profitableSignals||0,referrals:ft,daysOff:$,sickDays:k,vacationDays:ye,poolAmount:Z,lastUpdated:new Date().toISOString()},De=l0(bt,re,Qe,ve),lt=c0(bt,re,Qe,ve);if(e){const Ne=await vc(),Oe=Date.now()-24*60*60*1e3,at=Ne.filter(G=>G.status==="pending"||G.authorId!==e.id&&G.targetUserId!==e.id?!1:Date.parse(G.updatedAt||G.createdAt)>=Oe);E(at.map(G=>({id:G.id,status:G.status,updatedAt:G.updatedAt,text:`${G.entity==="slot"?"Слот":"Статус"} • ${G.status==="approved"?"Подтверждено":"Отклонено"}${G.adminComment?`: ${G.adminComment}`:""}`})))}v({...bt,rating:De}),T(lt),z({total:Te,pool:Z,net:Math.max(0,Te-Z),weekly:{gross:Qe,pool:q,net:Math.max(0,Qe-q)}});const Pe=e!=null&&e.id?`notes-cache-${e.id}`:null,Xe=Ne=>{if(Pe)try{localStorage.setItem(Pe,JSON.stringify(Ne))}catch(Oe){console.error("Error caching notes locally",Oe)}};try{if(e){const Ne=await Uu(e.id,n);C(Ne),Xe(Ne)}else if(n){const Ne=await Uu(void 0,!0);C(Ne),Xe(Ne)}}catch(Ne){if(console.error("Error loading notes",Ne),Pe)try{const Oe=localStorage.getItem(Pe);if(Oe){const at=JSON.parse(Oe);C(at)}}catch(Oe){console.error("Error loading cached notes",Oe)}}}}catch(O){console.error("Error loading profile data:",O)}finally{I(!1)}}},R=async()=>{if(!(e!=null&&e.id)||!j.title.trim()&&!j.text.trim())return;const O=e!=null&&e.id?`notes-cache-${e.id}`:null,W=ie=>{if(O)try{localStorage.setItem(O,JSON.stringify(ie))}catch(P){console.error("Error caching notes locally",P)}};try{if(j.id){await T2(j.id,{title:j.title,text:j.text,priority:j.priority});const ie=L.map(P=>P.id===j.id?{...P,title:j.title,text:j.text,priority:j.priority,updatedAt:new Date().toISOString()}:P);C(ie),W(ie)}else{const ie=await I2({userId:e.id,title:j.title,text:j.text,priority:j.priority}),P=new Date().toISOString(),oe=[{id:ie,userId:e.id,title:j.title,text:j.text,priority:j.priority,createdAt:P,updatedAt:P},...L];C(oe),W(oe)}}catch(ie){console.error("Error saving note",ie)}finally{H({id:"",userId:"",title:"",text:"",priority:"medium",createdAt:"",updatedAt:""})}},ee=O=>{const W=L.find(ie=>ie.id===O);W&&H(W)},J=async O=>{const W=e!=null&&e.id?`notes-cache-${e.id}`:null,ie=P=>{if(W)try{localStorage.setItem(W,JSON.stringify(P))}catch(oe){console.error("Error caching notes locally",oe)}};try{await S2(O);const P=L.filter(oe=>oe.id!==O);C(P),ie(P),j.id===O&&H({id:"",userId:"",title:"",text:"",priority:"medium",createdAt:"",updatedAt:""})}catch(P){console.error("Error deleting note",P)}},ae=()=>{n&&a(),t(),i("/login")},U=()=>{e!=null&&e.password&&(navigator.clipboard.writeText(e.password),h(!0),setTimeout(()=>h(!1),2e3))},F=()=>{_!=null&&_.login&&(navigator.clipboard.writeText(_.login),w(!0),setTimeout(()=>w(!1),2e3))},V=g.filter(O=>O.status==="in_progress").length,te=g.filter(O=>O.status==="completed").length,me=g.filter(O=>O.status==="closed").length,xe={in_progress:{label:"В работе",classes:r==="dark"?"bg-blue-500/15 text-blue-100 border-blue-500/30":"bg-blue-50 text-blue-900 border-blue-200"},completed:{label:"Выполнена",classes:r==="dark"?"bg-emerald-500/15 text-emerald-50 border-emerald-500/30":"bg-emerald-50 text-emerald-900 border-emerald-200"},closed:{label:"Закрыта",classes:r==="dark"?"bg-gray-600/20 text-gray-100 border-gray-500/40":"bg-gray-50 text-gray-800 border-gray-200"}};return _?s.jsx(dr,{children:s.jsxs("div",{className:"space-y-6",children:[N.length>0&&s.jsxs("div",{className:"rounded-2xl border border-emerald-200 dark:border-emerald-800 bg-emerald-50 dark:bg-emerald-900/20 p-4 shadow-sm",children:[s.jsx("p",{className:"text-sm font-semibold text-emerald-900 dark:text-emerald-100 mb-2",children:"Уведомления (последние 24 часа)"}),s.jsx("div",{className:"space-y-1.5",children:N.map(O=>s.jsx("div",{className:"text-sm text-emerald-900 dark:text-emerald-50",children:O.text},O.id))})]}),s.jsx("div",{className:`rounded-2xl p-6 border ${r==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white"} shadow-lg`,children:s.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"relative w-12 h-12 rounded-xl overflow-hidden shadow-lg border border-white/50 dark:border-white/10 bg-gradient-to-br from-[#4E6E49]/15 to-emerald-200/40 flex items-center justify-center",children:x?s.jsx("img",{src:x,alt:_.name,className:"w-full h-full object-cover",onError:O=>{const W=O.target;W.style.display="none"}}):s.jsx("span",{className:"text-lg font-extrabold text-[#4E6E49]",children:de})}),s.jsxs("div",{children:[s.jsx("p",{className:`text-xs uppercase tracking-[0.14em] ${r==="dark"?"text-gray-400":"text-gray-500"}`,children:"ApeVault Black Ops"}),s.jsx("h1",{className:`text-2xl sm:text-3xl font-extrabold ${M}`,children:"Личный кабинет"}),s.jsx("p",{className:`text-sm ${r==="dark"?"text-gray-300":"text-gray-600"}`,children:"Закрытый контур. Ваши данные и показатели."})]})]}),s.jsxs("div",{className:"flex flex-wrap gap-2",children:[s.jsxs("div",{className:"pill","data-active":"true",children:[s.jsx(cn,{className:"w-4 h-4"}),s.jsx("span",{children:_.name})]}),n&&s.jsxs("div",{className:"pill","data-active":"true",children:[s.jsx(Gt,{className:"w-4 h-4"}),s.jsx("span",{children:"Администратор"})]}),s.jsxs("div",{className:"pill","data-active":"false",children:[s.jsx(Fr,{className:"w-4 h-4"}),s.jsxs("span",{children:[g.length," задач"]})]}),p&&s.jsxs("div",{className:"pill","data-active":"false",children:[s.jsx(Ms,{className:"w-4 h-4"}),s.jsxs("span",{children:[p.rating.toFixed(1),"%"]})]}),s.jsxs(Kt,{to:"/rules",className:"inline-flex items-center gap-2 px-3 py-2 rounded-xl bg-gradient-to-r from-[#4E6E49] to-emerald-600 text-white text-sm font-semibold shadow-md hover:shadow-lg hover:-translate-y-0.5 transition-all",children:[s.jsx(ta,{className:"w-4 h-4"}),"Ознакомиться с правилами"]})]})]})}),Y?s.jsx("div",{className:`rounded-xl p-8 text-center ${r==="dark"?"bg-white/5 text-white":"bg-white text-gray-800"} shadow`,children:"Загрузка..."}):s.jsxs("div",{className:"space-y-5",children:[s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-[1.05fr_0.95fr] gap-4 items-stretch",children:[s.jsxs("div",{className:"space-y-4 flex flex-col",children:[s.jsxs("div",{className:`rounded-2xl p-5 border ${r==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white"} shadow flex-1`,children:[s.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[s.jsx("div",{className:`p-2.5 rounded-xl ${r==="dark"?"bg-blue-500/15 text-blue-200":"bg-blue-50 text-blue-700"}`,children:s.jsx(cn,{className:"w-5 h-5"})}),s.jsxs("div",{children:[s.jsx("h2",{className:`text-lg font-bold ${M}`,children:"Профиль"}),s.jsx("p",{className:`text-xs ${r==="dark"?"text-gray-400":"text-gray-500"}`,children:"Доступ и учетные данные"})]})]}),s.jsxs("div",{className:"grid sm:grid-cols-2 gap-3",children:[s.jsxs("div",{className:`p-4 rounded-xl border ${r==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white"} shadow-sm`,children:[s.jsx("p",{className:`text-xs font-semibold uppercase tracking-wide ${r==="dark"?"text-gray-400":"text-gray-500"}`,children:"Имя"}),s.jsx("p",{className:`mt-1 text-lg font-bold ${M}`,children:_.name})]}),s.jsxs("div",{className:`p-4 rounded-xl border ${r==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white"} shadow-sm`,children:[s.jsx("p",{className:`text-xs font-semibold uppercase tracking-wide ${r==="dark"?"text-gray-400":"text-gray-500"}`,children:"Логин"}),s.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[s.jsx("p",{className:`text-lg font-bold ${M}`,children:_.login}),s.jsx("button",{onClick:F,className:`p-2 rounded-lg border transition ${y?"bg-[#4E6E49] text-white border-[#4E6E49]":r==="dark"?"border-white/10 bg-white/5 hover:border-white/30":"border-gray-200 bg-white hover:border-gray-300"}`,title:"Скопировать логин",children:y?s.jsx(Rs,{className:"w-4 h-4"}):s.jsx(gi,{className:"w-4 h-4"})})]})]})]}),s.jsxs("div",{className:"mt-4 space-y-2",children:[s.jsx("label",{className:`text-sm font-semibold ${r==="dark"?"text-gray-300":"text-gray-700"} block`,children:"Пароль"}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("div",{className:`flex-1 px-4 py-3 rounded-lg border ${r==="dark"?"border-white/10 bg-white/5 text-white":"border-gray-200 bg-white text-gray-900"} font-mono text-sm`,children:o?_.password:"•".repeat(_.password.length)}),s.jsx("button",{onClick:()=>c(!o),className:`p-3 rounded-lg border ${r==="dark"?"border-white/10 bg-white/5 hover:border-white/30":"border-gray-200 bg-white hover:border-gray-300"} transition`,title:o?"Скрыть пароль":"Показать пароль",children:o?s.jsx(Sp,{className:"w-5 h-5"}):s.jsx(Ap,{className:"w-5 h-5"})}),s.jsx("button",{onClick:U,className:`p-3 rounded-lg border transition ${d?"bg-[#4E6E49] text-white border-[#4E6E49]":r==="dark"?"border-white/10 bg-white/5 hover:border-white/30":"border-gray-200 bg-white hover:border-gray-300"}`,title:"Скопировать пароль",children:d?s.jsx(Rs,{className:"w-5 h-5"}):s.jsx(gi,{className:"w-5 h-5"})})]})]}),s.jsx("div",{className:"mt-4 grid gap-3 sm:grid-cols-1",children:s.jsxs("div",{className:`p-4 rounded-xl border ${r==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white"} shadow-sm`,children:[s.jsx("p",{className:`text-xs font-semibold uppercase tracking-wide ${r==="dark"?"text-gray-400":"text-gray-500"}`,children:"Учебная панель (преподаватель)"}),s.jsxs("div",{className:"mt-2 space-y-2 text-sm",children:[s.jsxs("div",{className:`${r==="dark"?"text-gray-300":"text-gray-700"}`,children:[s.jsx("span",{className:"font-semibold",children:"Имя: "}),s.jsx("span",{className:"font-medium",children:"в разработке"})]}),s.jsxs("div",{className:`${r==="dark"?"text-gray-300":"text-gray-700"}`,children:[s.jsx("span",{className:"font-semibold",children:"Логин: "}),s.jsx("span",{className:"font-medium",children:"в разработке"})]}),s.jsxs("div",{className:`${r==="dark"?"text-gray-300":"text-gray-700"}`,children:[s.jsx("span",{className:"font-semibold",children:"Пароль: "}),s.jsx("span",{className:"font-medium",children:"в разработке"})]})]})]})})]}),s.jsxs("div",{className:`rounded-2xl p-5 border ${r==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white"} shadow flex-1`,children:[s.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[s.jsx("div",{className:`p-2.5 rounded-xl ${r==="dark"?"bg-green-500/15 text-green-200":"bg-green-50 text-[#4E6E49]"}`,children:s.jsx(Fr,{className:"w-5 h-5"})}),s.jsxs("div",{children:[s.jsx("h2",{className:`text-lg font-bold ${M}`,children:"Мои задачи"}),s.jsx("p",{className:`text-xs ${r==="dark"?"text-gray-400":"text-gray-500"}`,children:"Сводка по статусам"})]})]}),s.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-3 mb-4",children:[{label:"В работе",value:V,classes:r==="dark"?"bg-blue-500/15 border-blue-500/30 text-blue-100":"bg-blue-50 border-blue-200 text-blue-900"},{label:"Выполнено",value:te,classes:r==="dark"?"bg-emerald-500/15 border-emerald-500/30 text-emerald-50":"bg-emerald-50 border-emerald-200 text-emerald-900"},{label:"Закрыто",value:me,classes:r==="dark"?"bg-gray-600/20 border-gray-500/40 text-gray-100":"bg-gray-50 border-gray-200 text-gray-800"},{label:"Всего",value:g.length,classes:r==="dark"?"bg-gray-600/20 border-gray-500/40 text-gray-100":"bg-gray-50 border-gray-200 text-gray-800"}].map(({label:O,value:W,classes:ie})=>s.jsxs("div",{className:`p-4 rounded-xl border shadow-sm transition-all hover:translate-y-[-2px] ${ie}`,children:[s.jsx("div",{className:"text-xs font-semibold mb-2 opacity-80",children:O}),s.jsx("div",{className:`text-3xl font-extrabold ${M}`,children:W})]},O))}),g.length>0&&s.jsxs("div",{className:"space-y-2 mb-4",children:[s.jsx("p",{className:`text-sm font-semibold ${r==="dark"?"text-gray-200":"text-gray-800"}`,children:"Активные задачи"}),s.jsx("div",{className:"space-y-2",children:g.slice(0,3).map(O=>s.jsxs("div",{className:`p-3 rounded-lg border ${r==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-gray-50"} shadow-sm`,children:[s.jsxs("div",{className:"flex items-start justify-between gap-2",children:[s.jsxs("div",{className:"min-w-0",children:[s.jsx("p",{className:`text-sm font-semibold ${M} truncate`,children:O.title}),s.jsxs("p",{className:`text-xs ${r==="dark"?"text-gray-400":"text-gray-600"}`,children:["Дедлайн: ",O.dueDate?ce(new Date(O.dueDate),"dd.MM.yyyy"):"—"," ",O.dueTime||""]})]}),s.jsx("span",{className:`text-[11px] px-2 py-1 rounded-full border ${xe[O.status].classes}`,children:xe[O.status].label})]}),O.description&&s.jsx("p",{className:`text-xs mt-2 ${r==="dark"?"text-gray-300":"text-gray-600"} line-clamp-2`,children:O.description})]},O.id))})]}),s.jsxs("div",{className:"mt-4 space-y-3",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(ef,{className:"w-4 h-4 text-[#4E6E49]"}),s.jsx("p",{className:`text-sm font-semibold ${M}`,children:"Мои заметки"})]}),s.jsxs("div",{className:"grid gap-2 sm:grid-cols-2",children:[s.jsx("input",{type:"text",value:j.title,onChange:O=>H({...j,title:O.target.value}),placeholder:"Заголовок",className:`px-3 py-2 rounded-lg border ${r==="dark"?"border-white/10 bg-white/5 text-white":"border-gray-200 bg-white text-gray-900"} text-sm`}),s.jsx("div",{className:"flex gap-2",children:["low","medium","high"].map(O=>s.jsx("button",{onClick:()=>H({...j,priority:O}),className:`px-3 py-2 rounded-lg border text-sm flex-1 ${j.priority===O?"border-[#4E6E49] bg-[#4E6E49]/10 text-[#4E6E49]":r==="dark"?"border-white/10 bg-white/5 text-white":"border-gray-200 bg-white text-gray-800"}`,children:O==="low"?"Низкий":O==="medium"?"Средний":"Высокий"},O))})]}),s.jsx("textarea",{value:j.text,onChange:O=>H({...j,text:O.target.value}),rows:3,placeholder:"Текст заметки",className:`w-full px-3 py-2 rounded-lg border ${r==="dark"?"border-white/10 bg-white/5 text-white":"border-gray-200 bg-white text-gray-900"} text-sm`}),s.jsxs("div",{className:"flex gap-2",children:[s.jsxs("button",{onClick:R,className:`px-4 py-2 rounded-lg font-semibold flex items-center gap-2 ${e!=null&&e.id?r==="dark"?"bg-[#4E6E49]/20 text-[#4E6E49] border border-[#4E6E49]/40":"bg-gradient-to-r from-[#4E6E49] to-emerald-500 text-white":"bg-gray-300 text-gray-600 cursor-not-allowed"}`,disabled:!(e!=null&&e.id),children:[s.jsx(fd,{className:"w-4 h-4"}),j.id?"Сохранить":"Добавить"]}),j.id&&s.jsx("button",{onClick:()=>H({id:"",userId:"",title:"",text:"",priority:"medium",createdAt:"",updatedAt:""}),className:`px-4 py-2 rounded-lg font-semibold border ${r==="dark"?"border-white/15 text-gray-200":"border-gray-200 text-gray-700"}`,children:"Отмена"})]}),L.length>0&&s.jsx("div",{className:"space-y-2",children:L.map(O=>s.jsx("div",{className:`p-3 rounded-lg border ${r==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-gray-50"} flex flex-col gap-1`,children:s.jsxs("div",{className:"flex items-start justify-between gap-2",children:[s.jsxs("div",{className:"min-w-0",children:[s.jsx("p",{className:`text-sm font-semibold ${M} truncate`,children:O.title||"Без названия"}),s.jsx("p",{className:`text-xs ${r==="dark"?"text-gray-400":"text-gray-600"} whitespace-pre-line`,children:O.text})]}),s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx("span",{className:`text-[11px] px-2 py-1 rounded-full border ${O.priority==="high"?"border-rose-200 bg-rose-50 text-rose-700 dark:border-rose-500/40 dark:bg-rose-500/15 dark:text-rose-50":O.priority==="medium"?"border-amber-200 bg-amber-50 text-amber-700 dark:border-amber-500/40 dark:bg-amber-500/15 dark:text-amber-50":"border-emerald-200 bg-emerald-50 text-emerald-700 dark:border-emerald-500/40 dark:bg-emerald-500/15 dark:text-emerald-50"}`,children:O.priority==="high"?"Высокий":O.priority==="medium"?"Средний":"Низкий"}),s.jsx("button",{onClick:()=>ee(O.id),className:`p-1 rounded border ${r==="dark"?"border-white/10 text-gray-200":"border-gray-200 text-gray-700"}`,title:"Редактировать",children:s.jsx(fd,{className:"w-4 h-4"})}),s.jsx("button",{onClick:()=>J(O.id),className:`p-1 rounded border ${r==="dark"?"border-white/10 text-red-200":"border-gray-200 text-red-600"}`,title:"Удалить",children:s.jsx($t,{className:"w-4 h-4"})})]})]})},O.id))})]}),s.jsx("div",{className:"mt-4",children:s.jsxs("button",{onClick:()=>i("/tasks"),className:`w-full px-4 py-3 rounded-lg font-semibold transition-all flex items-center justify-center gap-2 ${r==="dark"?"bg-gradient-to-r from-[#4E6E49]/20 to-emerald-700/20 text-[#4E6E49] border border-[#4E6E49]/40":"bg-gradient-to-r from-green-50 to-emerald-50 text-[#4E6E49] border border-green-200"}`,children:[s.jsx(Fr,{className:"w-4 h-4"}),"Перейти к задачам"]})})]})]}),s.jsxs("div",{className:"space-y-4 flex flex-col",children:[S&&s.jsxs("div",{className:`rounded-2xl p-5 border ${r==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white"} shadow flex-1`,children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:`p-2.5 rounded-xl ${r==="dark"?"bg-emerald-500/20 text-emerald-200":"bg-emerald-50 text-emerald-700"}`,children:s.jsx(Fi,{className:"w-5 h-5"})}),s.jsxs("div",{children:[s.jsx("h2",{className:`text-lg font-bold ${M}`,children:"Мой заработок"}),s.jsx("p",{className:`text-xs ${r==="dark"?"text-gray-400":"text-gray-500"}`,children:"Суммы с учётом долей"})]})]}),s.jsx("div",{className:`px-3 py-1.5 rounded-full text-xs font-semibold border ${S.weekly.net>=1e4?"border-emerald-200 bg-emerald-50 text-emerald-800 dark:border-emerald-500/30 dark:bg-emerald-500/15 dark:text-emerald-100":"border-amber-200 bg-amber-50 text-amber-800 dark:border-amber-500/30 dark:bg-amber-500/15 dark:text-amber-100"}`,children:S.weekly.net>=1e4?"Вывод доступен":"Минимум 10 000 для вывода"})]}),s.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3 mb-4",children:[{label:"Всего заработано",value:S.total},{label:"Отправлено в пул",value:S.pool},{label:"Чистыми",value:S.net}].map(O=>s.jsxs("div",{className:`p-4 rounded-xl border shadow-sm ${r==="dark"?"border-white/10 bg-white/5":"border-gray-100 bg-gray-50"}`,children:[s.jsx("p",{className:"text-xs uppercase tracking-wide opacity-70",children:O.label}),s.jsxs("p",{className:`text-2xl font-extrabold ${M}`,children:[Math.round(O.value).toLocaleString("ru-RU")," ₽"]})]},O.label))}),s.jsxs("div",{className:`p-4 rounded-xl border ${r==="dark"?"border-white/10 bg-white/5":"border-emerald-50 bg-emerald-50/70"} flex flex-col gap-2`,children:[s.jsxs("div",{className:"flex items-center justify-between gap-2 flex-wrap",children:[s.jsxs("div",{children:[s.jsx("p",{className:`text-sm font-semibold ${M}`,children:"Активная неделя"}),s.jsx("p",{className:`text-xs ${r==="dark"?"text-gray-400":"text-gray-600"}`,children:"Понедельник, среда, пятница, суббота — дни вывода"})]}),s.jsx("span",{className:`text-xs px-3 py-1 rounded-full border ${S.weekly.net>=1e4?"border-emerald-200 bg-emerald-100 text-emerald-800 dark:border-emerald-500/40 dark:bg-emerald-500/15 dark:text-emerald-50":"border-amber-200 bg-amber-100 text-amber-800 dark:border-amber-500/40 dark:bg-amber-500/15 dark:text-amber-50"}`,children:S.weekly.net>=1e4?"Доступно к выводу":"Перенос на следующую неделю"})]}),s.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3",children:[{label:"Заработано за неделю",value:S.weekly.gross},{label:"В пул за неделю",value:S.weekly.pool},{label:"Чистыми за неделю",value:S.weekly.net}].map(O=>s.jsxs("div",{className:`p-3 rounded-lg border ${r==="dark"?"border-white/10 bg-white/5":"border-white/80 bg-white/80"} shadow-sm`,children:[s.jsx("p",{className:"text-[11px] uppercase tracking-wide opacity-70",children:O.label}),s.jsxs("p",{className:`text-lg font-bold ${M}`,children:[Math.round(O.value).toLocaleString("ru-RU")," ₽"]})]},O.label))}),S.weekly.net<1e4&&s.jsx("p",{className:`text-xs ${r==="dark"?"text-amber-200":"text-amber-700"}`,children:"Менее 10 000 ₽ чистыми за активную неделю — вывод недоступен, сумма переносится на следующую неделю."})]})]}),p&&A&&s.jsxs("div",{className:`rounded-2xl p-5 border ${r==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white"} shadow flex-1`,children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:`p-2.5 rounded-xl ${r==="dark"?"bg-purple-500/20 text-purple-200":"bg-purple-50 text-purple-700"}`,children:s.jsx(Ms,{className:"w-5 h-5"})}),s.jsxs("div",{children:[s.jsx("h2",{className:`text-lg font-bold ${M}`,children:"Рейтинг"}),s.jsx("p",{className:`text-xs ${r==="dark"?"text-gray-400":"text-gray-500"}`,children:"Еженедельная оценка"})]})]}),s.jsx("div",{className:"pill","data-active":"true",children:s.jsxs("span",{className:"font-bold",children:[p.rating.toFixed(1),"%"]})})]}),s.jsxs("div",{className:`p-4 rounded-xl border ${r==="dark"?"border-white/10 bg-white/5":"border-gray-100 bg-gray-50"} mb-4`,children:[s.jsxs("div",{className:`text-4xl font-extrabold ${M}`,children:[p.rating.toFixed(1),"%"]}),s.jsx("p",{className:`text-xs mt-1 ${r==="dark"?"text-gray-400":"text-gray-600"}`,children:p.rating>=70?"Отличный результат":p.rating>=50?"Хороший темп":"Требуется усиление показателей"})]}),s.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[{label:"Выходные",value:`${p.daysOff} дн`,pts:A.daysOffPoints,classes:r==="dark"?"bg-slate-700/40 border-slate-600/60":"bg-slate-50 border-slate-200"},{label:"Больничные",value:`${p.sickDays} дн`,pts:A.sickDaysPoints,classes:r==="dark"?"bg-amber-500/15 border-amber-500/30":"bg-amber-50 border-amber-200"},{label:"Отпуск",value:`${p.vacationDays} дн`,pts:A.vacationDaysPoints,classes:r==="dark"?"bg-orange-500/15 border-orange-500/30":"bg-orange-50 border-orange-200"},{label:"Часы",value:`${A.weeklyHours.toFixed(1)} ч/нед`,pts:A.weeklyHoursPoints,classes:r==="dark"?"bg-blue-500/15 border-blue-500/30":"bg-blue-50 border-blue-200"},{label:"Заработок",value:`${A.weeklyEarnings.toFixed(0)} ₽/нед`,pts:A.weeklyEarningsPoints,classes:r==="dark"?"bg-emerald-500/15 border-emerald-500/30":"bg-emerald-50 border-emerald-200"},{label:"Рефералы",value:`${p.referrals}`,pts:A.referralsPoints,classes:r==="dark"?"bg-purple-500/15 border-purple-500/30":"bg-purple-50 border-purple-200"},{label:"Сообщения",value:`${A.weeklyMessages} сообщ/нед`,pts:A.weeklyMessagesPoints,classes:r==="dark"?"bg-pink-500/15 border-pink-500/30":"bg-pink-50 border-pink-200"}].map(O=>s.jsxs("div",{className:`p-3 rounded-xl border shadow-sm ${O.classes}`,children:[s.jsx("div",{className:"text-xs font-semibold uppercase opacity-80",children:O.label}),s.jsx("div",{className:`text-lg font-bold ${M}`,children:O.value}),s.jsxs("div",{className:`text-sm ${r==="dark"?"text-gray-100":"text-gray-800"}`,children:[O.pts.toFixed(1),"%"]})]},O.label))}),s.jsxs("div",{className:`mt-4 p-4 rounded-xl border ${r==="dark"?"border-white/10 bg-white/5":"border-gray-100 bg-gray-50"}`,children:[s.jsxs("h3",{className:`text-sm font-bold ${M} mb-2 flex items-center gap-2`,children:[s.jsx(ln,{className:"w-4 h-4"}),"Как считается рейтинг"]}),s.jsx("p",{className:`text-xs ${r==="dark"?"text-gray-300":"text-gray-700"}`,children:"7 параметров: выходные, больничные, отпуск (месяц), часы, доход, рефералы, сообщения (неделя). Максимум 100%."})]})]})]})]}),s.jsx("div",{className:`rounded-2xl p-5 border ${r==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white"} shadow`,children:s.jsxs("button",{onClick:ae,className:`w-full px-6 py-3.5 rounded-lg font-semibold transition-all flex items-center justify-center gap-2 ${r==="dark"?"bg-gradient-to-r from-red-500/20 to-pink-500/20 text-red-300 border border-red-500/50":"bg-gradient-to-r from-red-50 to-pink-50 text-red-700 border border-red-200"}`,children:[s.jsx(Bp,{className:"w-5 h-5"}),"Выйти из аккаунта"]})})]})]})}):s.jsx(dr,{children:s.jsx("div",{className:"text-center py-12",children:s.jsx("p",{className:M,children:"Необходима авторизация"})})})},hN="/assets/image-779ddbd9-e512-4bda-8983-af1ab9237b7c-B_v6l7J0.png",mN=()=>{const{theme:r}=it(),e=r==="dark"?"text-white":"text-gray-900",t=r==="dark"?"text-gray-400":"text-gray-600",n=[{title:"Финансовая грамотность",note:"Учимся управлять рисками, понимать токеномику и принимать решения на основе анализа, а не эмоций.",accent:"from-emerald-200 to-teal-200"},{title:"Приватность превыше всего",note:"Уважаем личные границы и используем инструменты, защищающие цифровую идентичность.",accent:"from-sky-200 to-blue-200"},{title:"Образование и развитие",note:"Учимся от основ блокчейна до продвинутых DeFi-стратегий и делимся знаниями.",accent:"from-amber-200 to-orange-200"},{title:"Честность и прозрачность",note:"Внутри клуба — открытость, честные сделки и уважение. Доверие строим действиями.",accent:"from-purple-200 to-indigo-200"},{title:"Инновации и эксперименты",note:"Тестируем новые протоколы, участвуем в DAO, не боимся быть первыми в трендах.",accent:"from-pink-200 to-rose-200"},{title:"Критическое мышление",note:"Не следуем слепо за хайпом: анализируем, проверяем источники и опираемся на здравый смысл.",accent:"from-cyan-200 to-teal-200"},{title:"Глобальное мышление",note:"Открыты к сотрудничеству с людьми из разных стран ради цифровой и финансовой свободы в рамках закона.",accent:"from-lime-200 to-green-200"},{title:"Свобода и ответственность",note:"Ценим свободу крипты и понимаем её цену: зрелость, самоконтроль и ответственность за решения.",accent:"from-gray-200 to-slate-200"}],a=[{label:"Что такое ApeVault?",value:"Клуб криптоэнтузиастов, где знания превращаются в действие."},{label:"Цель",value:"Объединить инвесторов и трейдеров ради роста дохода и безопасности входа в рынок."}];return s.jsx(dr,{children:s.jsxs("div",{className:"space-y-7 sm:space-y-8",children:[s.jsxs("div",{className:"section-card rounded-3xl p-6 sm:p-8 border border-white/60 dark:border-white/10 shadow-2xl relative overflow-hidden",children:[s.jsx("div",{className:"accent-dots"}),s.jsx("div",{className:"absolute inset-y-0 right-0 w-1/3 pointer-events-none bg-gradient-to-l from-[#4E6E49]/10 to-transparent blur-2xl"}),s.jsxs("div",{className:"relative z-10 flex flex-col gap-5 lg:flex-row lg:items-center lg:justify-between",children:[s.jsxs("div",{className:"space-y-3 max-w-3xl",children:[s.jsxs("div",{className:"inline-flex items-center gap-2 px-3 py-1.5 rounded-full border border-white/50 dark:border-white/10 bg-white/70 dark:bg-white/5 text-xs font-semibold uppercase tracking-[0.16em]",children:[s.jsx(ln,{className:"w-4 h-4 text-[#4E6E49]"}),"ApeVault Community"]}),s.jsx("h1",{className:`text-3xl sm:text-4xl lg:text-5xl font-extrabold leading-tight ${e}`,children:"О нас и нашем сообществе"}),s.jsx("p",{className:`text-sm sm:text-base ${t} max-w-2xl`,children:"ApeVault — это пространство, где опытные криптоэнтузиасты объединяют знания и проверенные стратегии, чтобы безопасно заходить в рынок и расти вместе."}),s.jsx("div",{className:"flex flex-wrap gap-2",children:["Командные сессии","Проверенные стратегии","Прозрачные регламенты"].map(i=>s.jsx("span",{className:`px-3 py-1.5 rounded-full text-xs font-semibold border ${r==="dark"?"border-white/10 bg-white/5 text-white":"border-gray-200 bg-white text-gray-900"}`,children:i},i))})]}),s.jsx("div",{className:"grid grid-cols-2 gap-3 w-full max-w-xs lg:max-w-sm",children:[{label:"Участников",value:"50+"},{label:"Сессий / неделю",value:"10+"},{label:"Уроков",value:"100+"},{label:"Фокуса",value:"100% качество"}].map(i=>s.jsxs("div",{className:`rounded-2xl border p-3 sm:p-4 shadow-sm ${r==="dark"?"border-white/10 bg-white/5 text-white":"border-gray-200 bg-white text-gray-900"}`,children:[s.jsx("p",{className:"text-[11px] uppercase tracking-wide opacity-70",children:i.label}),s.jsx("p",{className:"text-xl font-extrabold leading-tight mt-1",children:i.value})]},i.label))})]})]}),s.jsxs("div",{className:"section-card rounded-3xl p-6 sm:p-7 border border-white/60 dark:border-white/10 shadow-xl relative overflow-hidden",children:[s.jsx("div",{className:"absolute top-0 right-0 w-40 h-40 bg-gradient-to-br from-emerald-500/10 to-blue-500/10 rounded-full blur-3xl -mr-16 -mt-16"}),s.jsxs("div",{className:"relative z-10 space-y-4",children:[s.jsxs("h2",{className:`text-2xl sm:text-3xl font-extrabold ${e} flex items-center gap-2`,children:[s.jsx(Qt,{className:"w-6 h-6 text-[#4E6E49]"}),"Что такое ApeVault?"]}),s.jsx("div",{className:"grid gap-4 sm:grid-cols-2",children:a.map(i=>s.jsxs("div",{className:`rounded-2xl border p-4 sm:p-5 flex gap-3 items-start ${r==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white"}`,children:[s.jsx("div",{className:"p-2 rounded-xl bg-gradient-to-br from-[#4E6E49] to-emerald-600 text-white shadow-lg",children:s.jsx(Et,{className:"w-4 h-4"})}),s.jsxs("div",{className:"space-y-1",children:[s.jsx("p",{className:"text-xs uppercase tracking-wide text-[#4E6E49] font-semibold",children:i.label}),s.jsx("p",{className:`text-sm sm:text-base leading-relaxed ${e}`,children:i.value})]})]},i.label))})]})]}),s.jsxs("div",{className:"section-card rounded-3xl p-6 sm:p-7 border border-white/60 dark:border-white/10 shadow-xl relative overflow-hidden",children:[s.jsx("div",{className:"absolute -left-10 top-0 w-52 h-52 bg-gradient-to-br from-amber-400/10 to-rose-400/10 rounded-full blur-3xl"}),s.jsx("div",{className:"absolute -right-10 bottom-0 w-52 h-52 bg-gradient-to-br from-blue-400/10 to-emerald-400/10 rounded-full blur-3xl"}),s.jsxs("div",{className:"relative z-10 space-y-5",children:[s.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-3",children:[s.jsx("h2",{className:`text-2xl sm:text-3xl font-extrabold ${e}`,children:"Принципы, которые держат нас на вершине"}),s.jsxs("div",{className:"flex gap-2",children:[s.jsxs(Kt,{to:"/rules",className:"pill justify-center text-center","data-active":"false",children:["Ознакомиться с правилами",s.jsx(Et,{className:"w-4 h-4"})]}),s.jsxs("a",{href:"#contacts",className:"pill","data-active":"false",children:["Контакты",s.jsx(Et,{className:"w-4 h-4"})]})]})]}),s.jsxs("div",{className:"grid lg:grid-cols-[1fr_420px_1fr] gap-6 items-center",children:[s.jsx("div",{className:"space-y-3",children:n.slice(0,4).map(i=>s.jsxs("div",{className:`rounded-2xl border px-4 py-3 flex items-start gap-3 ${r==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white/90"}`,children:[s.jsx("div",{className:`p-2 rounded-xl text-gray-900 bg-gradient-to-br ${i.accent}`,children:s.jsx(Et,{className:"w-4 h-4"})}),s.jsxs("div",{className:"space-y-1",children:[s.jsx("p",{className:`text-sm sm:text-base font-semibold ${e}`,children:i.title}),i.note&&s.jsx("p",{className:`text-xs ${t}`,children:i.note})]})]},i.title))}),s.jsxs("div",{className:`rounded-3xl border shadow-xl overflow-hidden relative ${r==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white/95"}`,children:[s.jsx("img",{src:hN,alt:"Принципы ApeVault",className:"w-full h-full object-contain"}),s.jsx("div",{className:"absolute inset-0 pointer-events-none bg-gradient-to-b from-transparent via-transparent to-white/0"})]}),s.jsx("div",{className:"space-y-3",children:n.slice(4).map(i=>s.jsxs("div",{className:`rounded-2xl border px-4 py-3 flex items-start gap-3 ${r==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white/90"}`,children:[s.jsx("div",{className:`p-2 rounded-xl text-gray-900 bg-gradient-to-br ${i.accent}`,children:s.jsx(Et,{className:"w-4 h-4"})}),s.jsxs("div",{className:"space-y-1",children:[s.jsx("p",{className:`text-sm sm:text-base font-semibold ${e}`,children:i.title}),i.note&&s.jsx("p",{className:`text-xs ${t}`,children:i.note})]})]},i.title))})]})]})]}),s.jsxs("div",{id:"rules",className:"section-card rounded-3xl p-6 sm:p-7 border border-white/60 dark:border-white/10 shadow-xl relative overflow-hidden",children:[s.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-indigo-100/50 via-white/40 to-purple-100/40 dark:from-indigo-900/30 dark:via-transparent dark:to-purple-900/20"}),s.jsxs("div",{className:"relative z-10 grid gap-5 sm:grid-cols-[1.15fr_0.85fr] items-center",children:[s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{className:"inline-flex items-center gap-2 px-3 py-1.5 rounded-full bg-white/80 dark:bg-white/10 border border-white/60 dark:border-white/10 text-xs font-semibold tracking-wide text-indigo-700 dark:text-white",children:[s.jsx(ta,{className:"w-4 h-4"}),"Правила сообщества"]}),s.jsx("h2",{className:`text-2xl sm:text-3xl font-extrabold ${e}`,children:"Простой регламент, чтобы оставаться на одной волне"}),s.jsx("p",{className:`text-sm sm:text-base ${t}`,children:"Подробно описали процессы, безопасность и взаимодействие, чтобы каждый чувствовал прозрачность и поддержку."}),s.jsx("div",{className:"flex flex-wrap gap-2",children:["Безопасность","Честные сделки","Уважение","Прозрачность"].map(i=>s.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-semibold border ${r==="dark"?"border-white/10 bg-white/5 text-white":"border-indigo-100 bg-white text-indigo-900"}`,children:i},i))}),s.jsxs(Kt,{to:"/rules",className:"inline-flex items-center gap-2 px-5 py-3 rounded-xl bg-gradient-to-r from-indigo-500 to-purple-500 text-white font-semibold shadow-lg hover:shadow-xl hover:-translate-y-0.5 transition-all",children:[s.jsx(ta,{className:"w-5 h-5"}),s.jsx("span",{children:"Ознакомиться с правилами"}),s.jsx(Et,{className:"w-4 h-4"})]})]}),s.jsx("div",{className:`rounded-2xl border p-4 sm:p-5 shadow-lg ${r==="dark"?"border-white/10 bg-white/5":"border-white/80 bg-white/90"}`,children:s.jsx("div",{className:"space-y-3",children:["Короткие правила для быстрых решений","Фокус на безопасности и приватности","Прозрачные роли и ответственность","Действуем в рамках законодательства"].map(i=>s.jsxs("div",{className:"flex items-start gap-2",children:[s.jsx("div",{className:"w-2 h-2 rounded-full bg-indigo-500 mt-2"}),s.jsx("p",{className:`text-sm ${e}`,children:i})]},i))})})]})]}),s.jsxs("div",{id:"contacts",className:"section-card rounded-3xl p-6 sm:p-7 border border-white/60 dark:border-white/10 shadow-xl relative overflow-hidden",children:[s.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-rose-100/50 via-white/40 to-amber-100/40 dark:from-rose-900/25 dark:via-transparent dark:to-amber-900/20"}),s.jsxs("div",{className:"relative z-10 grid gap-5 sm:grid-cols-[0.9fr_1.1fr] items-center",children:[s.jsxs("div",{className:`p-4 rounded-2xl shadow-lg inline-flex items-center gap-3 ${r==="dark"?"bg-gradient-to-br from-rose-600 to-amber-600 text-white":"bg-gradient-to-br from-rose-500 to-amber-500 text-white"}`,children:[s.jsx(Wp,{className:"w-7 h-7"}),s.jsxs("div",{children:[s.jsx("p",{className:"text-xs uppercase tracking-wide",children:"Контакты клуба"}),s.jsx("p",{className:"text-base font-semibold",children:"Свяжитесь с нами"})]})]}),s.jsxs("div",{className:"grid gap-3 sm:grid-cols-2",children:[s.jsxs("div",{className:`rounded-2xl border p-4 shadow-md flex flex-col gap-2 ${r==="dark"?"border-white/10 bg-white/5":"border-white/80 bg-white/90"}`,children:[s.jsx("p",{className:"text-xs uppercase tracking-wide text-rose-600 dark:text-rose-200 font-semibold",children:"Администратор"}),s.jsx("p",{className:`text-lg font-extrabold ${e}`,children:"@artyommedoed"}),s.jsx("p",{className:`text-sm ${t}`,children:"По вопросам правил, доступов и регламентов."})]}),s.jsxs("div",{className:`rounded-2xl border p-4 shadow-md flex flex-col gap-2 ${r==="dark"?"border-white/10 bg-white/5":"border-white/80 bg-white/90"}`,children:[s.jsx("p",{className:"text-xs uppercase tracking-wide text-amber-600 dark:text-amber-200 font-semibold",children:"Обратная связь"}),s.jsx("p",{className:`text-lg font-extrabold ${e}`,children:"Командный чат"}),s.jsx("p",{className:`text-sm ${t}`,children:"Оперативные вопросы по продуктам и сессиям."}),s.jsxs("a",{href:"https://t.me/+vPZdPwPaaKI1MjAy",target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-2 text-sm font-semibold text-[#4E6E49] hover:text-emerald-600",children:["Присоединиться",s.jsx(Et,{className:"w-4 h-4"})]})]})]})]})]})]})})},Dr=({title:r,description:e,children:t})=>{const{theme:n}=it(),a=n==="dark"?"text-white":"text-gray-900",i=n==="dark"?"text-gray-400":"text-gray-600";return s.jsx("div",{className:"section-card rounded-3xl p-6 sm:p-7 border border-white/60 dark:border-white/10 shadow-xl relative overflow-hidden",children:s.jsxs("div",{className:"relative z-10 space-y-4",children:[s.jsxs("div",{className:"flex items-start gap-3",children:[s.jsx("div",{className:"p-2 rounded-xl bg-gradient-to-br from-[#4E6E49]/20 to-emerald-500/15 text-[#4E6E49]",children:s.jsx(ta,{className:"w-5 h-5"})}),s.jsxs("div",{className:"space-y-1",children:[s.jsx("h2",{className:`text-xl sm:text-2xl font-extrabold ${a}`,children:r}),e&&s.jsx("p",{className:`text-sm ${i}`,children:e})]})]}),t]})})},gN=()=>{const{theme:r}=it(),e=r==="dark"?"text-white":"text-gray-900",t=r==="dark"?"text-gray-400":"text-gray-600",n=["последовательной эскалации","объективности и равного применения","недопустимости злоупотребления полномочиями","исключения спорных трактовок и субъективности"],a=["единичные опоздания (не более 1 раза за календарную неделю)","некорректное выполнение инструкций без последствий вследствие заболевания или сбоев в ПО","нарушение регламента общения, не приводящее к конфликту"],i=["повторяющиеся нарушения регламента","несоблюдение правил торговой сессии","недостаточная подготовка к сессии","игнорирование инструкций ведущего","нарушение процедур безопасности данных или доступа"],o=["оскорбления участников","провокации и попытки вызвать конфликт","манипуляции и мошеннические действия","действия, создающие финансовые, репутационные или организационные риски","подрыв дисциплины и порядка в сообществе"],c=[{term:"Нарушение",text:"любое действие или бездействие, противоречащее регламентам ApeVault"},{term:"Предупреждение",text:"официальное уведомление о нарушении"},{term:"Выговор",text:"фиксируемая мера повышенной строгости при повторных нарушениях"},{term:"Ведущий торговой сессии",text:"управляет процессом и следит за соблюдением регламента на сессии"},{term:"Ответственный за сообщество",text:"назначенное лицо, управляющее дисциплиной и коммуникацией"},{term:"Повторное нарушение",text:"нарушение в течение 30 календарных дней после предыдущего"}];return s.jsx(dr,{children:s.jsxs("div",{className:"space-y-7 sm:space-y-8",children:[s.jsxs("div",{className:"section-card rounded-3xl p-6 sm:p-8 border border-white/60 dark:border-white/10 shadow-2xl relative overflow-hidden",children:[s.jsx("div",{className:"accent-dots"}),s.jsx("div",{className:"absolute inset-y-0 right-0 w-1/3 pointer-events-none bg-gradient-to-l from-[#4E6E49]/12 to-transparent blur-3xl"}),s.jsxs("div",{className:"relative z-10 flex flex-col gap-5 lg:flex-row lg:items-center lg:justify-between",children:[s.jsxs("div",{className:"space-y-4 max-w-3xl",children:[s.jsx("div",{className:"inline-flex items-center gap-2 px-3 py-1.5 rounded-full border border-white/50 dark:border-white/10 bg-white/70 dark:bg-white/5 text-xs font-semibold uppercase tracking-[0.16em] text-[#4E6E49]",children:"ApeVault Standard Operating Code — ASOC"}),s.jsx("h1",{className:`text-3xl sm:text-4xl lg:text-5xl font-extrabold leading-tight ${e}`,children:"Кодекс операционных процедур и регламентов платформы ApeVault"}),s.jsx("p",{className:`text-sm sm:text-base ${t}`,children:"Единые правила ответственности, дисциплинарных мер и прозрачных процедур для команды ApeVault."}),s.jsx("div",{className:"flex flex-wrap gap-2",children:["Ответственность","Прозрачность","Безопасность","Справедливость"].map(d=>s.jsx("span",{className:`px-3 py-1.5 rounded-full text-xs font-semibold border ${r==="dark"?"border-white/10 bg-white/5 text-white":"border-gray-200 bg-white text-gray-900"}`,children:d},d))})]}),s.jsxs("div",{className:`rounded-3xl border shadow-xl p-4 sm:p-5 w-full lg:max-w-sm ${r==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white"}`,children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"p-3 rounded-2xl bg-gradient-to-br from-[#4E6E49] to-emerald-600 text-white shadow-lg",children:s.jsx(Ui,{className:"w-6 h-6"})}),s.jsxs("div",{children:[s.jsx("p",{className:"text-xs uppercase tracking-wide text-[#4E6E49] font-semibold",children:"Назначение раздела"}),s.jsx("p",{className:`text-base font-semibold ${e}`,children:"Поддержание порядка и профессионализма команды"})]})]}),s.jsxs("div",{className:"mt-4 space-y-2",children:[s.jsxs("div",{className:"flex items-center gap-2 text-sm font-semibold text-[#4E6E49]",children:[s.jsx(Et,{className:"w-4 h-4"}),"Публичная версия правил доступна на сайте"]}),s.jsx("p",{className:`text-xs ${t}`,children:"Используйте кнопку «Правила» в навигации или в профиле, чтобы быстро открыть этот раздел."})]})]})]})]}),s.jsxs(Dr,{title:"Политика ответственности и меры дисциплинарного воздействия",description:"Единый порядок применения мер для поддержания порядка, прозрачности и профессионального уровня.",children:[s.jsxs("div",{className:`grid gap-4 sm:grid-cols-2 ${r==="dark"?"text-gray-200":"text-gray-900"}`,children:[s.jsxs("div",{className:`rounded-2xl border p-4 sm:p-5 ${r==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white"}`,children:[s.jsxs("div",{className:"flex items-center gap-2 text-sm font-semibold text-[#4E6E49]",children:[s.jsx(gd,{className:"w-4 h-4"}),"Цели дисциплинарной политики"]}),s.jsx("p",{className:`text-sm mt-2 ${t}`,children:"Обеспечить соблюдение регламентов, процедур и рабочих стандартов команды."})]}),s.jsxs("div",{className:`rounded-2xl border p-4 sm:p-5 ${r==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white"}`,children:[s.jsxs("div",{className:"flex items-center gap-2 text-sm font-semibold text-[#4E6E49]",children:[s.jsx(Jp,{className:"w-4 h-4"}),"Принципы применения мер"]}),s.jsx("ul",{className:`text-sm mt-2 space-y-1 ${t}`,children:n.map(d=>s.jsxs("li",{children:["• ",d]},d))})]})]}),s.jsx("div",{className:`mt-3 text-sm ${t}`,children:"Меры ответственности применяются в зависимости от тяжести, регулярности и последствий нарушения."})]}),s.jsx(Dr,{title:"Унифицированный регламент торговой деятельности ApeVault",description:"Нормы поведения на торговых сессиях, полномочия ведущего, перерывы, записи и конфиденциальность.",children:s.jsxs("div",{className:`space-y-4 text-sm ${t}`,children:[s.jsxs("div",{className:`rounded-2xl border p-4 sm:p-5 ${r==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white"}`,children:[s.jsx("p",{className:"text-base font-semibold text-[#4E6E49]",children:"1. Общие положения"}),s.jsxs("ul",{className:"mt-2 space-y-1",children:[s.jsx("li",{children:"• Регламент задаёт нормы участия, дисциплину, полномочия ведущего и ответственность."}),s.jsx("li",{children:"• Все участники обязаны ознакомиться с разделом до начала торговой деятельности."})]})]}),s.jsxs("div",{className:`rounded-2xl border p-4 sm:p-5 ${r==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white"}`,children:[s.jsx("p",{className:"text-base font-semibold text-[#4E6E49]",children:"2. Права и полномочия ведущего"}),s.jsx("p",{className:"mt-2 font-semibold text-[#4E6E49]",children:"Полномочия:"}),s.jsxs("ul",{className:"mt-1 space-y-1",children:[s.jsx("li",{children:"• Давать обязательные распоряжения по порядку, действиям, стратегии и дисциплине."}),s.jsx("li",{children:"• Требовать соблюдения тайминга, регламента и корректного поведения."}),s.jsx("li",{children:"• Приостанавливать участие нарушающих участников."}),s.jsx("li",{children:"• Объявлять перерывы и завершение сессии."}),s.jsx("li",{children:"• Фиксировать нарушения, выдавать предупреждения/выговоры, вводить временный запрет на участие."})]}),s.jsx("p",{className:"mt-3 font-semibold text-[#4E6E49]",children:"Ограничения:"}),s.jsxs("ul",{className:"mt-1 space-y-1",children:[s.jsx("li",{children:"• Не изменяет дисциплинарные меры, установленные регламентом."}),s.jsx("li",{children:"• Не принимает решения об исключении из команды (решает ответственный за команду)."}),s.jsx("li",{children:"• Не меняет торговую стратегию вне утверждённой методологии или плана сессии."})]})]}),s.jsxs("div",{className:`rounded-2xl border p-4 sm:p-5 space-y-3 ${r==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white"}`,children:[s.jsx("p",{className:"text-base font-semibold text-[#4E6E49]",children:"3. Порядок проведения сессии"}),s.jsxs("div",{children:[s.jsx("p",{className:"font-semibold",children:"Начало и окончание:"}),s.jsxs("ul",{className:"mt-1 space-y-1",children:[s.jsx("li",{children:"• Старт строго по времени слота."}),s.jsx("li",{children:"• Подключение за 3–5 минут до старта обязательно."}),s.jsx("li",{children:"• Окончание объявляет ведущий, не позднее 30 минут после окончания слота."})]})]}),s.jsxs("div",{children:[s.jsx("p",{className:"font-semibold",children:"Поведение во время торгов:"}),s.jsx("p",{className:"text-xs uppercase tracking-wide opacity-70 mt-1",children:"Запрещено:"}),s.jsxs("ul",{className:"space-y-1",children:[s.jsx("li",{children:"• Перебивать ведущего или участников."}),s.jsx("li",{children:"• Отвлекать команду сторонними вопросами."}),s.jsx("li",{children:"• Включать микрофон без необходимости, создавать шум."}),s.jsx("li",{children:"• Саботировать процесс или предлагать несогласованные решения."}),s.jsx("li",{children:"• Коммуницировать с кем-либо вне участников сессии."})]}),s.jsx("p",{className:"text-xs uppercase tracking-wide opacity-70 mt-2",children:"Обязано:"}),s.jsxs("ul",{className:"space-y-1",children:[s.jsx("li",{children:"• Следовать инструкциям ведущего и оперативно исполнять распоряжения."}),s.jsx("li",{children:"• Сохранять корректность и нейтральность в коммуникации."}),s.jsx("li",{children:"• Обеспечивать техническую готовность: связь, устройство, ПО."})]})]})]}),s.jsxs("div",{className:`rounded-2xl border p-4 sm:p-5 space-y-2 ${r==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white"}`,children:[s.jsx("p",{className:"text-base font-semibold text-[#4E6E49]",children:"4. Политика перерывов"}),s.jsxs("ul",{className:"space-y-1",children:[s.jsx("li",{children:"• Краткий перерыв — до 10 минут каждые 45 минут."}),s.jsx("li",{children:"• Большой перерыв — до 45 минут каждые 3 часа активной торговли."}),s.jsx("li",{children:"• Все перерывы объявляет ведущий."}),s.jsx("li",{children:"• Самовольные перерывы запрещены; нарушение дисциплины, если не согласовано в трекере слотов и с ответственным."})]})]}),s.jsxs("div",{className:`rounded-2xl border p-4 sm:p-5 space-y-2 ${r==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white"}`,children:[s.jsx("p",{className:"text-base font-semibold text-[#4E6E49]",children:"5. Правила записи сессий"}),s.jsxs("ul",{className:"space-y-1",children:[s.jsx("li",{children:"• Запись включает только ведущий или ответственный за сообщество."}),s.jsx("li",{children:"• Хранение — в закрытом архиве команды; доступ: ведущий, управляющий сообществом, ответственные аналитики."}),s.jsx("li",{children:"• Распространение вне команды запрещено."}),s.jsx("li",{children:"• Срок хранения определяет ведущий: до 3 лет, но ≥14 календарных дней."})]})]}),s.jsxs("div",{className:`rounded-2xl border p-4 sm:p-5 space-y-2 ${r==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white"}`,children:[s.jsx("p",{className:"text-base font-semibold text-[#4E6E49]",children:"6. Конфликт интересов"}),s.jsxs("ul",{className:"space-y-1",children:[s.jsx("li",{children:"• Запрещено действовать в интересах сторонних групп/конкурентов."}),s.jsx("li",{children:"• Запрещено передавать стратегию, аналитику, материалы, алгоритмы, сигналы и методики ApeVault третьим лицам."}),s.jsx("li",{children:"• Запрещено получать вознаграждение за внешние консультации, использующие опыт или данные ApeVault."}),s.jsx("li",{children:"• Запрещено участвовать в параллельных торговых группах, если это создаёт риск конфликта или утечки информации."})]})]}),s.jsxs("div",{className:`rounded-2xl border p-4 sm:p-5 space-y-2 ${r==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white"}`,children:[s.jsx("p",{className:"text-base font-semibold text-[#4E6E49]",children:"7. Конфиденциальность"}),s.jsxs("ul",{className:"space-y-1",children:[s.jsx("li",{children:"• Все материалы, данные, аналитика, торговые решения и внутренняя коммуникация — интеллектуальная собственность ApeVault."}),s.jsx("li",{children:"• Запрещено копировать, распространять или передавать информацию третьим лицам."}),s.jsx("li",{children:"• Запрещено создавать производные материалы без согласования с ответственным."}),s.jsx("li",{children:"• Запрещено публиковать скриншоты, отчёты или содержимое сессий в открытых источниках (кроме чата команды)."}),s.jsx("li",{children:"• Требование к среде: наушники и отсутствие посторонних рядом; не допускать, чтобы экран/звук были доступны третьим лицам."}),s.jsx("li",{className:"font-semibold text-[#4E6E49]",children:"Нарушение положений конфиденциальности — основание для немедленного исключения."})]})]})]})}),s.jsx(Dr,{title:"Классификация нарушений",description:"Три уровня тяжести определяют, как быстро применяются ограничения.",children:s.jsxs("div",{className:"grid gap-4 lg:grid-cols-3",children:[s.jsxs("div",{className:`rounded-2xl border p-4 sm:p-5 ${r==="dark"?"border-white/10 bg-white/5":"border-amber-100 bg-white/95"}`,children:[s.jsxs("div",{className:"flex items-center gap-2 text-sm font-semibold text-amber-600 dark:text-amber-300",children:[s.jsx(ln,{className:"w-4 h-4"}),"Незначительные"]}),s.jsx("ul",{className:`text-sm mt-2 space-y-1 ${t}`,children:a.map(d=>s.jsxs("li",{children:["• ",d]},d))})]}),s.jsxs("div",{className:`rounded-2xl border p-4 sm:p-5 ${r==="dark"?"border-white/10 bg-white/5":"border-orange-100 bg-white/95"}`,children:[s.jsxs("div",{className:"flex items-center gap-2 text-sm font-semibold text-orange-600 dark:text-orange-300",children:[s.jsx(Pr,{className:"w-4 h-4"}),"Средние"]}),s.jsx("ul",{className:`text-sm mt-2 space-y-1 ${t}`,children:i.map(d=>s.jsxs("li",{children:["• ",d]},d))})]}),s.jsxs("div",{className:`rounded-2xl border p-4 sm:p-5 ${r==="dark"?"border-white/10 bg-white/5":"border-rose-100 bg-white/95"}`,children:[s.jsxs("div",{className:"flex items-center gap-2 text-sm font-semibold text-rose-600 dark:text-rose-300",children:[s.jsx(pi,{className:"w-4 h-4"}),"Грубые"]}),s.jsx("ul",{className:`text-sm mt-2 space-y-1 ${t}`,children:o.map(d=>s.jsxs("li",{children:["• ",d]},d))})]})]})}),s.jsx(Dr,{title:"Меры дисциплинарного воздействия и ограничения",description:"Применяются последовательно, кроме случаев грубых нарушений.",children:s.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[s.jsxs("div",{className:`rounded-2xl border p-4 sm:p-5 space-y-2 ${r==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white"}`,children:[s.jsxs("div",{className:"flex items-center gap-2 text-sm font-semibold text-[#4E6E49]",children:[s.jsx(gd,{className:"w-4 h-4"}),"Порядок эскалации"]}),s.jsxs("ul",{className:`text-sm space-y-1 ${t}`,children:[s.jsx("li",{children:"• Напоминания — не более 1 в неделю, без последствий."}),s.jsx("li",{children:"• Предупреждения — не более 2 в неделю, при повторении незначительных или единичном среднем нарушении."}),s.jsx("li",{children:"• Выговоры — не более 2 в неделю, назначаются ведущим сессии или ответственным за сообщество."})]})]}),s.jsxs("div",{className:`rounded-2xl border p-4 sm:p-5 space-y-2 ${r==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white"}`,children:[s.jsxs("div",{className:"flex items-center gap-2 text-sm font-semibold text-[#4E6E49]",children:[s.jsx(pi,{className:"w-4 h-4"}),"Ограничительные меры"]}),s.jsxs("ul",{className:`text-sm space-y-1 ${t}`,children:[s.jsx("li",{children:"• Ограничение доступа к торговым сессиям: 1-е — ≥3 дней; повторное — 1 неделя; систематическое — 2 недели; дальше — исключение без восстановления."}),s.jsx("li",{children:"• Немедленное исключение без эскалации за грубое нарушение, оскорбления, провокации или угрозу финансам/безопасности/репутации."})]})]})]})}),s.jsx(Dr,{title:"Финансовые последствия",description:"Что происходит при систематических нарушениях и невыполнении мер.",children:s.jsx("div",{className:`rounded-2xl border p-4 sm:p-5 space-y-2 ${r==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white"}`,children:s.jsxs("ul",{className:`text-sm space-y-2 ${t}`,children:[s.jsx("li",{children:"• При систематических нарушениях и игнорировании мер может быть отказано в удовлетворении заявки на вывод средств, включая заработок за успешные сессии."}),s.jsx("li",{children:"• Перераспределение заработка: удержанные средства делятся между участниками, кроме тех, кто допустил два и более нарушений в неделю или более 6 нарушений в месяц."}),s.jsx("li",{children:"• Добровольно внесённые в пул или кошелёк команды средства не возвращаются при досрочном выходе или исключении за нарушения."})]})})}),s.jsx(Dr,{title:"Фиксация нарушений и апелляции",description:"Прозрачный процесс учёта нарушений и возможность обжаловать решение.",children:s.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[s.jsxs("div",{className:`rounded-2xl border p-4 sm:p-5 space-y-2 ${r==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white"}`,children:[s.jsxs("div",{className:"flex items-center gap-2 text-sm font-semibold text-[#4E6E49]",children:[s.jsx(rs,{className:"w-4 h-4"}),"Порядок фиксации"]}),s.jsxs("ul",{className:`text-sm space-y-1 ${t}`,children:[s.jsx("li",{children:"• Все нарушения фиксируются ответственным за сообщество в отдельной ветви командного чата Telegram."}),s.jsx("li",{children:"• Обязательная фиксация: дата и время, тип нарушения, краткое описание ситуации, применённая мера."})]})]}),s.jsxs("div",{className:`rounded-2xl border p-4 sm:p-5 space-y-2 ${r==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white"}`,children:[s.jsxs("div",{className:"flex items-center gap-2 text-sm font-semibold text-[#4E6E49]",children:[s.jsx(Ps,{className:"w-4 h-4"}),"Процедура апелляции"]}),s.jsxs("ul",{className:`text-sm space-y-1 ${t}`,children:[s.jsx("li",{children:"• Апелляция подаётся в течение 24 часов с момента уведомления о мере."}),s.jsx("li",{children:"• Подача: ответственному за сообщество или назначенному куратору."}),s.jsx("li",{children:"• Рассмотрение: до 60 часов; решение окончательное."})]})]})]})}),s.jsx(Dr,{title:"Принцип равного применения",description:"Меры действуют одинаково для всех участников.",children:s.jsx("div",{className:`rounded-2xl border p-4 sm:p-5 space-y-1 ${r==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white"}`,children:s.jsx("p",{className:`text-sm ${t}`,children:"Дисциплинарные меры применяются ко всем участникам независимо от стажа, роли в проекте, вклада, личных отношений или результатов торговых сессий. Привилегии и исключения не допускаются."})})}),s.jsx(Dr,{title:"Определения",description:"Ключевые термины, чтобы избежать двусмысленностей.",children:s.jsx("div",{className:"grid gap-4 md:grid-cols-2",children:c.map(d=>s.jsxs("div",{className:`rounded-2xl border p-4 sm:p-5 space-y-1 ${r==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white"}`,children:[s.jsx("p",{className:"text-sm font-semibold text-[#4E6E49]",children:d.term}),s.jsx("p",{className:`text-sm ${t}`,children:d.text})]},d.term))})}),s.jsx(Dr,{title:"Заключительные положения",description:"Кто может обновлять раздел и обязанность ознакомления.",children:s.jsx("div",{className:`rounded-2xl border p-4 sm:p-5 space-y-2 ${r==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white"}`,children:s.jsxs("ul",{className:`text-sm space-y-1 ${t}`,children:[s.jsx("li",{children:"• Ответственный за сообщество или исполняющий обязанности оставляет за собой право корректировать и обновлять раздел при изменении процессов или структуры платформы."}),s.jsx("li",{children:"• Все участники обязаны ознакомиться с настоящей политикой и соблюдать её безусловно."})]})})})]})})},pN={create:"Создание",update:"Изменение",delete:"Удаление"},fN={slot:"Слот",status:"Статус",earning:"Заработок",referral:"Реферал"},xN={pending:"bg-amber-50 text-amber-900 border border-amber-200 shadow-inner dark:bg-amber-900/25 dark:text-amber-50 dark:border-amber-700",approved:"bg-emerald-50 text-emerald-900 border border-emerald-200 shadow-inner dark:bg-emerald-900/25 dark:text-emerald-50 dark:border-emerald-700",rejected:"bg-rose-50 text-rose-900 border border-rose-200 shadow-inner dark:bg-rose-900/25 dark:text-rose-50 dark:border-rose-700"},yN={pending:s.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-semibold bg-amber-100 text-amber-900 dark:bg-amber-900/40 dark:text-amber-100",children:[s.jsx(Ps,{className:"w-3 h-3"})," На согласовании"]}),approved:s.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-semibold bg-emerald-100 text-emerald-900 dark:bg-emerald-900/40 dark:text-emerald-100",children:[s.jsx(Ds,{className:"w-3 h-3"})," Принято"]}),rejected:s.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-semibold bg-rose-100 text-rose-900 dark:bg-rose-900/40 dark:text-rose-100",children:[s.jsx(sf,{className:"w-3 h-3"})," Отклонено"]})},th=r=>{var e;return((e=Se.find(t=>t.id===r))==null?void 0:e.name)||r},pa=r=>{if(!r)return"—";try{return ce(r,"dd.MM.yyyy")}catch{return"—"}},rh=r=>{var t,n;if(!r)return"—";const e=(n=(t=r.slots)==null?void 0:t.map(a=>`${a.start}-${a.end}${a.endDate?` (до ${pa(a.endDate)})`:""}`))==null?void 0:n.join(", ");return`${pa(r.date)}${e?` · ${e}`:""}`},sh=r=>{if(!r)return"—";const e=r.type==="dayoff"?"Выходной":r.type==="sick"?"Больничный":"Отпуск",t=r.endDate?` (${pa(r.endDate)})`:"";return`${pa(r.date)} · ${e}${t}`},bN=()=>{const{user:r}=jt(),[e,t]=D.useState([]),[n,a]=D.useState(!0),[i,o]=D.useState(null),[c,d]=D.useState(!1),[h,g]=D.useState([]),[f,p]=D.useState(null),v=async()=>{a(!0),p(null);try{const j=await vc();t(j)}catch(j){console.error("Не удалось загрузить заявки на согласование",j),p("Не удалось загрузить заявки")}finally{a(!1)}};D.useEffect(()=>{v()},[]);const A=async j=>{if(!i){o(j),p(null);try{await Fu(j,(r==null?void 0:r.id)||"admin"),await v(),g(H=>H.filter(Y=>Y!==j))}catch(H){console.error("Ошибка при подтверждении",H),p(`Не удалось подтвердить заявку: ${(H==null?void 0:H.message)||H}`),await v()}finally{o(null)}}},T=async j=>{if(i)return;const H=prompt("Комментарий для отклонения заявки","Уточните детали")||"Отклонено без комментария";o(j),p(null);try{await k2(j,(r==null?void 0:r.id)||"admin",H),await v()}catch(Y){console.error("Ошибка при отклонении",Y),p("Не удалось отклонить заявку")}finally{o(null)}},S=async()=>{if(!(c||i||h.length===0)){d(!0),p(null);try{for(const j of h)await Fu(j,(r==null?void 0:r.id)||"admin");await v(),g([])}catch(j){console.error("Ошибка при подтверждении выбранных",j),p(`Не удалось подтвердить выбранные заявки: ${(j==null?void 0:j.message)||j}`),await v()}finally{d(!1)}}},z=j=>{g(H=>H.includes(j)?H.filter(Y=>Y!==j):[...H,j])},L=()=>{const j=e.filter(Y=>Y.status==="pending").map(Y=>Y.id),H=j.every(Y=>h.includes(Y));g(H?[]:j)},C=j=>{if(j.entity==="slot"){const I=j.before,y=j.after;return`${rh(I)} → ${rh(y)}`}const H=j.before,Y=j.after;return`${sh(H)} → ${sh(Y)}`};return n?s.jsx("div",{className:"rounded-xl border border-gray-200 dark:border-gray-800 p-6 text-center text-sm text-gray-600 dark:text-gray-300",children:"Загружаем заявки..."}):s.jsxs("div",{className:"rounded-xl border border-gray-200 dark:border-gray-800 overflow-hidden shadow-sm",children:[s.jsxs("div",{className:"p-4 sm:p-5 border-b border-gray-200 dark:border-gray-800 flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-lg font-semibold",children:"Согласования"}),s.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Заявки на изменение слотов и статусов"})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("button",{onClick:S,disabled:c||i!==null||h.length===0,className:"text-sm px-3 py-2 rounded-lg bg-emerald-600 hover:bg-emerald-700 disabled:bg-emerald-400 text-white font-semibold",children:c?"Подтверждаем...":`Принять выбранные (${h.length})`}),s.jsx("button",{onClick:v,className:"text-sm px-3 py-2 rounded-lg bg-gray-100 hover:bg-gray-200 dark:bg-gray-800 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-200",children:"Обновить"})]})]}),f&&s.jsx("div",{className:"px-4 py-3 bg-rose-100 text-rose-900 dark:bg-rose-900/30 dark:text-rose-100 text-sm",children:f}),s.jsx("div",{className:"overflow-x-auto",children:s.jsxs("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-800 text-sm",children:[s.jsx("thead",{className:"bg-gray-50 dark:bg-gray-900/40",children:s.jsxs("tr",{children:[s.jsx("th",{className:"px-4 py-3 text-left font-semibold text-gray-700 dark:text-gray-200",children:"Статус"}),s.jsx("th",{className:"px-4 py-3 text-left font-semibold text-gray-700 dark:text-gray-200",children:"Тип"}),s.jsx("th",{className:"px-4 py-3 text-left font-semibold text-gray-700 dark:text-gray-200",children:"Действие"}),s.jsx("th",{className:"px-4 py-3 text-left font-semibold text-gray-700 dark:text-gray-200",children:"Кто"}),s.jsx("th",{className:"px-4 py-3 text-left font-semibold text-gray-700 dark:text-gray-200",children:"Изменение"}),s.jsx("th",{className:"px-4 py-3 text-left font-semibold text-gray-700 dark:text-gray-200",children:"Комментарий"}),s.jsx("th",{className:"px-4 py-3 text-left font-semibold text-gray-700 dark:text-gray-200",children:"Действия"}),s.jsx("th",{className:"px-4 py-3 text-left font-semibold text-gray-700 dark:text-gray-200",children:s.jsx("button",{onClick:L,className:"inline-flex items-center gap-1 text-sm text-[#4E6E49] hover:text-emerald-700",title:"Выбрать все на согласовании",children:e.some(j=>j.status==="pending")?s.jsxs(s.Fragment,{children:[e.filter(j=>j.status==="pending").every(j=>h.includes(j.id))?s.jsx(Fr,{className:"w-4 h-4"}):s.jsx(So,{className:"w-4 h-4"})," Все"]}):s.jsx(So,{className:"w-4 h-4 opacity-50"})})})]})}),s.jsxs("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-800",children:[e.map(j=>s.jsxs("tr",{className:`bg-white dark:bg-[#0f1624] ${xN[j.status]}`,children:[s.jsx("td",{className:"px-4 py-3 align-top",children:yN[j.status]}),s.jsx("td",{className:"px-4 py-3 align-top font-semibold",children:fN[j.entity]}),s.jsx("td",{className:"px-4 py-3 align-top",children:pN[j.action]}),s.jsx("td",{className:"px-4 py-3 align-top",children:s.jsxs("div",{className:"flex flex-col gap-1",children:[s.jsx("span",{className:"font-semibold",children:th(j.targetUserId)}),s.jsxs("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:["Автор: ",th(j.authorId)]}),s.jsxs("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:["Создано: ",pa(j.createdAt)," "]})]})}),s.jsxs("td",{className:"px-4 py-3 align-top",children:[s.jsx("div",{className:"text-xs sm:text-sm font-medium",children:C(j)}),j.after&&j.entity==="slot"&&j.after.comment&&s.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:["Комментарий слота: ",j.after.comment]}),j.after&&j.entity==="status"&&j.after.comment&&s.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:["Комментарий статуса: ",j.after.comment]})]}),s.jsxs("td",{className:"px-4 py-3 align-top",children:[s.jsx("div",{className:"text-xs sm:text-sm text-gray-700 dark:text-gray-200 whitespace-pre-wrap",children:j.comment||"—"}),j.adminComment&&s.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:["Ответ админа: ",j.adminComment]})]}),s.jsx("td",{className:"px-4 py-3 align-top",children:j.status==="pending"?s.jsxs("div",{className:"flex flex-col gap-2",children:[s.jsx("button",{onClick:()=>A(j.id),disabled:!!i,className:"px-3 py-2 rounded-lg bg-emerald-600 hover:bg-emerald-700 disabled:bg-emerald-400 text-white text-xs sm:text-sm font-semibold",children:i===j.id?"Применяем...":"Подтвердить и применить"}),s.jsx("button",{onClick:()=>T(j.id),disabled:!!i,className:"px-3 py-2 rounded-lg bg-rose-600 hover:bg-rose-700 disabled:bg-rose-400 text-white text-xs sm:text-sm font-semibold",children:i===j.id?"Отклоняем...":"Отклонить"})]}):s.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Действие выполнено"})}),s.jsx("td",{className:"px-4 py-3 align-top",children:j.status==="pending"?s.jsxs("button",{onClick:()=>z(j.id),className:"inline-flex items-center gap-1 text-sm text-[#4E6E49] hover:text-emerald-700",children:[h.includes(j.id)?s.jsx(Fr,{className:"w-4 h-4"}):s.jsx(So,{className:"w-4 h-4"}),s.jsx("span",{className:"sr-only",children:"Выбрать заявку"})]}):s.jsx("span",{className:"text-xs text-gray-400",children:"—"})})]},j.id)),e.length===0&&s.jsx("tr",{children:s.jsx("td",{colSpan:7,className:"px-4 py-6 text-center text-sm text-gray-500 dark:text-gray-400",children:"Нет заявок на согласование"})})]})]})})]})},vN=()=>{const{isAdmin:r}=At();return r?s.jsx(dr,{children:s.jsxs("div",{className:"max-w-6xl mx-auto px-4 sm:px-6 py-6 sm:py-8 space-y-6",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Администрирование"}),s.jsx("h1",{className:"text-2xl sm:text-3xl font-bold",children:"Согласования изменений"}),s.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Подтверждайте или отклоняйте изменения слотов, перерывов и статусов участников."})]}),s.jsx(bN,{})]})}):s.jsx(mi,{to:"/management",replace:!0})},Rr=({children:r})=>{const{isAuthenticated:e}=jt(),{isAdmin:t}=At();return!e&&!t?s.jsx(mi,{to:"/login",replace:!0}):s.jsx(s.Fragment,{children:r})};function wN(){const{isAuthenticated:r}=jt(),{isAdmin:e}=At(),{theme:t}=it();return D.useEffect(()=>{document.body.classList.toggle("dark",t==="dark")},[t]),D.useEffect(()=>{x2().catch(n=>console.error("Cleanup failed",n))},[]),s.jsx(P0,{children:s.jsxs(M0,{children:[s.jsx(ir,{path:"/login",element:!r&&!e?s.jsx(lf,{}):s.jsx(mi,{to:"/management",replace:!0})}),s.jsx(ir,{path:"/call",element:s.jsx(Rr,{children:s.jsx(U_,{})})}),s.jsx(ir,{path:"/management",element:s.jsx(Rr,{children:s.jsx(G_,{})})}),s.jsx(ir,{path:"/earnings",element:s.jsx(Rr,{children:s.jsx(X_,{})})}),s.jsx(ir,{path:"/rating",element:s.jsx(Rr,{children:s.jsx(eN,{})})}),s.jsx(ir,{path:"/tasks",element:s.jsx(Rr,{children:s.jsx(cN,{})})}),s.jsx(ir,{path:"/about",element:s.jsx(Rr,{children:s.jsx(mN,{})})}),s.jsx(ir,{path:"/rules",element:s.jsx(gN,{})}),s.jsx(ir,{path:"/approvals",element:s.jsx(Rr,{children:s.jsx(vN,{})})}),s.jsx(ir,{path:"/admin",element:s.jsx(Rr,{children:s.jsx(dN,{})})}),s.jsx(ir,{path:"/profile",element:s.jsx(Rr,{children:s.jsx(uN,{})})}),s.jsx(ir,{path:"/",element:s.jsx(mi,{to:r||e?"/management":"/login",replace:!0})})]})})}Ho.createRoot(document.getElementById("root")).render(s.jsx(nh.StrictMode,{children:s.jsx(wN,{})}));
