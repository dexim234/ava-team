import{r as D,a as A0,g as C0,R as sh,u as nh,b as D0,L as Gt,c as R0,N as mi,B as P0,d as M0,e as ar}from"./react-vendor-Dou2_yf_.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))n(a);new MutationObserver(a=>{for(const i of a)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function t(a){const i={};return a.integrity&&(i.integrity=a.integrity),a.referrerPolicy&&(i.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?i.credentials="include":a.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(a){if(a.ep)return;a.ep=!0;const i=t(a);fetch(a.href,i)}})();var ah={exports:{}},Vi={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var $0=D,O0=Symbol.for("react.element"),V0=Symbol.for("react.fragment"),L0=Object.prototype.hasOwnProperty,F0=$0.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,U0={key:!0,ref:!0,__self:!0,__source:!0};function ih(r,e,t){var n,a={},i=null,o=null;t!==void 0&&(i=""+t),e.key!==void 0&&(i=""+e.key),e.ref!==void 0&&(o=e.ref);for(n in e)L0.call(e,n)&&!U0.hasOwnProperty(n)&&(a[n]=e[n]);if(r&&r.defaultProps)for(n in e=r.defaultProps,e)a[n]===void 0&&(a[n]=e[n]);return{$$typeof:O0,type:r,key:i,ref:o,props:a,_owner:F0.current}}Vi.Fragment=V0;Vi.jsx=ih;Vi.jsxs=ih;ah.exports=Vi;var s=ah.exports,Ho={},ld=A0;Ho.createRoot=ld.createRoot,Ho.hydrateRoot=ld.hydrateRoot;const B0={},cd=r=>{let e;const t=new Set,n=(g,x)=>{const p=typeof g=="function"?g(e):g;if(!Object.is(p,e)){const v=e;e=x??(typeof p!="object"||p===null)?p:Object.assign({},e,p),t.forEach(A=>A(e,v))}},a=()=>e,d={setState:n,getState:a,getInitialState:()=>h,subscribe:g=>(t.add(g),()=>t.delete(g)),destroy:()=>{(B0?"production":void 0)!=="production"&&console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),t.clear()}},h=e=r(n,a,d);return d},W0=r=>r?cd(r):cd;var oh={exports:{}},lh={},ch={exports:{}},dh={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var on=D;function q0(r,e){return r===e&&(r!==0||1/r===1/e)||r!==r&&e!==e}var z0=typeof Object.is=="function"?Object.is:q0,H0=on.useState,G0=on.useEffect,K0=on.useLayoutEffect,Y0=on.useDebugValue;function Q0(r,e){var t=e(),n=H0({inst:{value:t,getSnapshot:e}}),a=n[0].inst,i=n[1];return K0(function(){a.value=t,a.getSnapshot=e,Eo(a)&&i({inst:a})},[r,t,e]),G0(function(){return Eo(a)&&i({inst:a}),r(function(){Eo(a)&&i({inst:a})})},[r]),Y0(t),t}function Eo(r){var e=r.getSnapshot;r=r.value;try{var t=e();return!z0(r,t)}catch{return!0}}function X0(r,e){return e()}var J0=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?X0:Q0;dh.useSyncExternalStore=on.useSyncExternalStore!==void 0?on.useSyncExternalStore:J0;ch.exports=dh;var Z0=ch.exports;/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Li=D,ep=Z0;function tp(r,e){return r===e&&(r!==0||1/r===1/e)||r!==r&&e!==e}var rp=typeof Object.is=="function"?Object.is:tp,sp=ep.useSyncExternalStore,np=Li.useRef,ap=Li.useEffect,ip=Li.useMemo,op=Li.useDebugValue;lh.useSyncExternalStoreWithSelector=function(r,e,t,n,a){var i=np(null);if(i.current===null){var o={hasValue:!1,value:null};i.current=o}else o=i.current;i=ip(function(){function d(v){if(!h){if(h=!0,g=v,v=n(v),a!==void 0&&o.hasValue){var A=o.value;if(a(A,v))return x=A}return x=v}if(A=x,rp(g,v))return A;var C=n(v);return a!==void 0&&a(A,C)?(g=v,A):(g=v,x=C)}var h=!1,g,x,p=t===void 0?null:t;return[function(){return d(e())},p===null?void 0:function(){return d(p())}]},[e,t,n,a]);var c=sp(r,i[0],i[1]);return ap(function(){o.hasValue=!0,o.value=c},[c]),op(c),c};oh.exports=lh;var lp=oh.exports;const cp=C0(lp),uh={},{useDebugValue:dp}=sh,{useSyncExternalStoreWithSelector:up}=cp;let dd=!1;const hp=r=>r;function mp(r,e=hp,t){(uh?"production":void 0)!=="production"&&t&&!dd&&(console.warn("[DEPRECATED] Use `createWithEqualityFn` instead of `create` or use `useStoreWithEqualityFn` instead of `useStore`. They can be imported from 'zustand/traditional'. https://github.com/pmndrs/zustand/discussions/1937"),dd=!0);const n=up(r.subscribe,r.getState,r.getServerState||r.getInitialState,e,t);return dp(n),n}const gp=r=>{(uh?"production":void 0)!=="production"&&typeof r!="function"&&console.warn("[DEPRECATED] Passing a vanilla store will be unsupported in a future version. Instead use `import { useStore } from 'zustand'`.");const e=typeof r=="function"?W0(r):r,t=(n,a)=>mp(e,n,a);return Object.assign(t,e),t},bl=r=>gp,pp={};function fp(r,e){let t;try{t=r()}catch{return}return{getItem:a=>{var i;const o=d=>d===null?null:JSON.parse(d,void 0),c=(i=t.getItem(a))!=null?i:null;return c instanceof Promise?c.then(o):o(c)},setItem:(a,i)=>t.setItem(a,JSON.stringify(i,void 0)),removeItem:a=>t.removeItem(a)}}const Zn=r=>e=>{try{const t=r(e);return t instanceof Promise?t:{then(n){return Zn(n)(t)},catch(n){return this}}}catch(t){return{then(n){return this},catch(n){return Zn(n)(t)}}}},xp=(r,e)=>(t,n,a)=>{let i={getStorage:()=>localStorage,serialize:JSON.stringify,deserialize:JSON.parse,partialize:T=>T,version:0,merge:(T,z)=>({...z,...T}),...e},o=!1;const c=new Set,d=new Set;let h;try{h=i.getStorage()}catch{}if(!h)return r((...T)=>{console.warn(`[zustand persist middleware] Unable to update item '${i.name}', the given storage is currently unavailable.`),t(...T)},n,a);const g=Zn(i.serialize),x=()=>{const T=i.partialize({...n()});let z;const $=g({state:T,version:i.version}).then(S=>h.setItem(i.name,S)).catch(S=>{z=S});if(z)throw z;return $},p=a.setState;a.setState=(T,z)=>{p(T,z),x()};const v=r((...T)=>{t(...T),x()},n,a);let A;const C=()=>{var T;if(!h)return;o=!1,c.forEach($=>$(n()));const z=((T=i.onRehydrateStorage)==null?void 0:T.call(i,n()))||void 0;return Zn(h.getItem.bind(h))(i.name).then($=>{if($)return i.deserialize($)}).then($=>{if($)if(typeof $.version=="number"&&$.version!==i.version){if(i.migrate)return i.migrate($.state,$.version);console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return $.state}).then($=>{var S;return A=i.merge($,(S=n())!=null?S:v),t(A,!0),x()}).then(()=>{z==null||z(A,void 0),o=!0,d.forEach($=>$(A))}).catch($=>{z==null||z(void 0,$)})};return a.persist={setOptions:T=>{i={...i,...T},T.getStorage&&(h=T.getStorage())},clearStorage:()=>{h==null||h.removeItem(i.name)},getOptions:()=>i,rehydrate:()=>C(),hasHydrated:()=>o,onHydrate:T=>(c.add(T),()=>{c.delete(T)}),onFinishHydration:T=>(d.add(T),()=>{d.delete(T)})},C(),A||v},yp=(r,e)=>(t,n,a)=>{let i={storage:fp(()=>localStorage),partialize:C=>C,version:0,merge:(C,T)=>({...T,...C}),...e},o=!1;const c=new Set,d=new Set;let h=i.storage;if(!h)return r((...C)=>{console.warn(`[zustand persist middleware] Unable to update item '${i.name}', the given storage is currently unavailable.`),t(...C)},n,a);const g=()=>{const C=i.partialize({...n()});return h.setItem(i.name,{state:C,version:i.version})},x=a.setState;a.setState=(C,T)=>{x(C,T),g()};const p=r((...C)=>{t(...C),g()},n,a);a.getInitialState=()=>p;let v;const A=()=>{var C,T;if(!h)return;o=!1,c.forEach($=>{var S;return $((S=n())!=null?S:p)});const z=((T=i.onRehydrateStorage)==null?void 0:T.call(i,(C=n())!=null?C:p))||void 0;return Zn(h.getItem.bind(h))(i.name).then($=>{if($)if(typeof $.version=="number"&&$.version!==i.version){if(i.migrate)return[!0,i.migrate($.state,$.version)];console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return[!1,$.state];return[!1,void 0]}).then($=>{var S;const[I,H]=$;if(v=i.merge(H,(S=n())!=null?S:p),t(v,!0),I)return g()}).then(()=>{z==null||z(v,void 0),v=n(),o=!0,d.forEach($=>$(v))}).catch($=>{z==null||z(void 0,$)})};return a.persist={setOptions:C=>{i={...i,...C},C.storage&&(h=C.storage)},clearStorage:()=>{h==null||h.removeItem(i.name)},getOptions:()=>i,rehydrate:()=>A(),hasHydrated:()=>o,onHydrate:C=>(c.add(C),()=>{c.delete(C)}),onFinishHydration:C=>(d.add(C),()=>{d.delete(C)})},i.skipHydration||A(),v||p},bp=(r,e)=>"getStorage"in e||"serialize"in e||"deserialize"in e?((pp?"production":void 0)!=="production"&&console.warn("[DEPRECATED] `getStorage`, `serialize` and `deserialize` options are deprecated. Use `storage` option instead."),xp(r,e)):yp(r,e),vl=bp,Ts={memecoins:{label:"Мемкоины",accent:"emerald",icon:"rocket"},futures:{label:"Фьючерсы",accent:"blue",icon:"line"},nft:{label:"NFT",accent:"purple",icon:"image"},spot:{label:"Спот",accent:"amber",icon:"coins"},polymarket:{label:"PolyMarket",accent:"pink",icon:"barchart"},staking:{label:"Стейкинг",accent:"indigo",icon:"shield"},other:{label:"Другое",accent:"gray",icon:"sparkles"}},Se=[{id:"1",name:"Артём",login:"artyom03",password:"248artdex",avatar:"/avatars/artyom.jpg"},{id:"2",name:"Enowk",login:"adel05",password:"058adeldex",avatar:"/avatars/adel.jpg"},{id:"3",name:"Ксения",login:"ksen03",password:"907ksendex",avatar:"/avatars/kseniya.jpg"},{id:"4",name:"Ольга",login:"olga04",password:"638olgadex",avatar:"/avatars/olga.jpg"},{id:"5",name:"Анастасия",login:"anastasia05",password:"638anastadex",avatar:"/avatars/anastasia.jpg"}],ea={trading:{label:"Торговля",icon:"candles",color:"green"},learning:{label:"Обучение",icon:"book",color:"blue"},technical:{label:"ТЧ",icon:"cpu",color:"purple"},stream:{label:"Стрим",icon:"broadcast",color:"red"},research:{label:"Изучение",icon:"flask",color:"yellow"},organization:{label:"Ресёрч",icon:"clipboard",color:"indigo"}},Ss={in_progress:{label:"В работе",color:"blue"},completed:{label:"Выполнено",color:"green"},closed:{label:"Закрыто",color:"gray"}},kt=bl()(vl(r=>({user:null,isAuthenticated:!1,login:(e,t)=>{const n=Se.find(a=>a.login===e&&a.password===t);return n?(r({user:n,isAuthenticated:!0}),!0):!1},logout:()=>r({user:null,isAuthenticated:!1})}),{name:"apevault-auth"})),hh="9119ApeVault",Tt=bl()(vl(r=>({isAdmin:!1,activateAdmin:e=>e===hh?(r({isAdmin:!0}),!0):!1,deactivateAdmin:()=>r({isAdmin:!1})}),{name:"apevault-admin"})),it=bl()(vl(r=>({theme:"light",toggleTheme:()=>r(e=>{const t=e.theme==="light"?"dark":"light";return document.body.classList.toggle("dark",t==="dark"),{theme:t}}),setTheme:e=>r(()=>(document.body.classList.toggle("dark",e==="dark"),{theme:e}))}),{name:"apevault-theme"}));/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var vp={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wp=r=>r.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().trim(),he=(r,e)=>{const t=D.forwardRef(({color:n="currentColor",size:a=24,strokeWidth:i=2,absoluteStrokeWidth:o,className:c="",children:d,...h},g)=>D.createElement("svg",{ref:g,...vp,width:a,height:a,stroke:n,strokeWidth:o?Number(i)*24/Number(a):i,className:["lucide",`lucide-${wp(r)}`,c].join(" "),...h},[...e.map(([x,p])=>D.createElement(x,p)),...Array.isArray(d)?d:[d]]));return t.displayName=`${r}`,t};/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mh=he("Activity",[["path",{d:"M22 12h-4l-3 9L9 3l-3 9H2",key:"d5dnw9"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gh=he("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Rr=he("AlertTriangle",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z",key:"c3ski4"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kp=he("Archive",[["rect",{width:"20",height:"5",x:"2",y:"3",rx:"1",key:"1wp1u1"}],["path",{d:"M4 8v11a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8",key:"1s80jp"}],["path",{d:"M10 12h4",key:"a56b0p"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _p=he("ArrowDownRight",[["path",{d:"m7 7 10 10",key:"1fmybs"}],["path",{d:"M17 7v10H7",key:"6fjiku"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Nt=he("ArrowUpRight",[["path",{d:"M7 7h10v10",key:"1tivn9"}],["path",{d:"M7 17 17 7",key:"1vkiza"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wl=he("BarChart3",[["path",{d:"M3 3v18h18",key:"1s2lah"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Np=he("Bell",[["path",{d:"M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9",key:"1qo2s2"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ta=he("BookOpen",[["path",{d:"M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z",key:"vv98re"}],["path",{d:"M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z",key:"1cyq3y"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ud=he("Building2",[["path",{d:"M6 22V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v18Z",key:"1b4qmf"}],["path",{d:"M6 12H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h2",key:"i71pzd"}],["path",{d:"M18 9h2a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2h-2",key:"10jefs"}],["path",{d:"M10 6h4",key:"1itunk"}],["path",{d:"M10 10h4",key:"tcdvrf"}],["path",{d:"M10 14h4",key:"kelpxr"}],["path",{d:"M10 18h4",key:"1ulq68"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Io=he("CalendarCheck",[["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",ry:"2",key:"eu3xkr"}],["line",{x1:"16",x2:"16",y1:"2",y2:"6",key:"m3sa8f"}],["line",{x1:"8",x2:"8",y1:"2",y2:"6",key:"18kwsl"}],["line",{x1:"3",x2:"21",y1:"10",y2:"10",key:"xt86sb"}],["path",{d:"m9 16 2 2 4-4",key:"19s6y9"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Go=he("CalendarClock",[["path",{d:"M21 7.5V6a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h3.5",key:"1osxxc"}],["path",{d:"M16 2v4",key:"4m81vk"}],["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M3 10h5",key:"r794hk"}],["path",{d:"M17.5 17.5 16 16.25V14",key:"re2vv1"}],["path",{d:"M22 16a6 6 0 1 1-12 0 6 6 0 0 1 12 0Z",key:"ame013"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jp=he("CalendarDays",[["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",ry:"2",key:"eu3xkr"}],["line",{x1:"16",x2:"16",y1:"2",y2:"6",key:"m3sa8f"}],["line",{x1:"8",x2:"8",y1:"2",y2:"6",key:"18kwsl"}],["line",{x1:"3",x2:"21",y1:"10",y2:"10",key:"xt86sb"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 18h.01",key:"lrp35t"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M16 18h.01",key:"kzsmim"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ur=he("Calendar",[["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",ry:"2",key:"eu3xkr"}],["line",{x1:"16",x2:"16",y1:"2",y2:"6",key:"m3sa8f"}],["line",{x1:"8",x2:"8",y1:"2",y2:"6",key:"18kwsl"}],["line",{x1:"3",x2:"21",y1:"10",y2:"10",key:"xt86sb"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ep=he("CandlestickChart",[["path",{d:"M9 5v4",key:"14uxtq"}],["rect",{width:"4",height:"6",x:"7",y:"9",rx:"1",key:"f4fvz0"}],["path",{d:"M9 15v2",key:"r5rk32"}],["path",{d:"M17 3v2",key:"1l2re6"}],["rect",{width:"4",height:"8",x:"15",y:"5",rx:"1",key:"z38je5"}],["path",{d:"M17 13v3",key:"5l0wba"}],["path",{d:"M3 3v18h18",key:"1s2lah"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ds=he("CheckCircle2",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Lr=he("CheckSquare",[["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}],["path",{d:"M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11",key:"1jnkn4"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Rs=he("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hd=he("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ip=he("CircleDot",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const md=he("ClipboardCheck",[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}],["path",{d:"m9 14 2 2 4-4",key:"df797q"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Tp=he("ClipboardList",[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}],["path",{d:"M12 11h4",key:"1jrz19"}],["path",{d:"M12 16h4",key:"n85exb"}],["path",{d:"M8 11h.01",key:"1dfujw"}],["path",{d:"M8 16h.01",key:"18s6g9"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Hn=he("Clock3",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16.5 12",key:"1aq6pp"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ps=he("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pr=he("Coins",[["circle",{cx:"8",cy:"8",r:"6",key:"3yglwk"}],["path",{d:"M18.09 10.37A6 6 0 1 1 10.34 18",key:"t5s6rm"}],["path",{d:"M7 6h1v4",key:"1obek4"}],["path",{d:"m16.71 13.88.7.71-2.82 2.82",key:"1rbuyh"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gi=he("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Sp=he("Cpu",[["rect",{x:"4",y:"4",width:"16",height:"16",rx:"2",key:"1vbyd7"}],["rect",{x:"9",y:"9",width:"6",height:"6",key:"o3kz5p"}],["path",{d:"M15 2v2",key:"13l42r"}],["path",{d:"M15 20v2",key:"15mkzm"}],["path",{d:"M2 15h2",key:"1gxd5l"}],["path",{d:"M2 9h2",key:"1bbxkp"}],["path",{d:"M20 15h2",key:"19e6y8"}],["path",{d:"M20 9h2",key:"19tzq7"}],["path",{d:"M9 2v2",key:"165o2o"}],["path",{d:"M9 20v2",key:"i2bqo8"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fi=he("DollarSign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ap=he("EyeOff",[["path",{d:"M9.88 9.88a3 3 0 1 0 4.24 4.24",key:"1jxqfv"}],["path",{d:"M10.73 5.08A10.43 10.43 0 0 1 12 5c7 0 10 7 10 7a13.16 13.16 0 0 1-1.67 2.68",key:"9wicm4"}],["path",{d:"M6.61 6.61A13.526 13.526 0 0 0 2 12s3 7 10 7a9.74 9.74 0 0 0 5.39-1.61",key:"1jreej"}],["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Cp=he("Eye",[["path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",key:"rwhkz3"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Dp=he("FileCode",[["path",{d:"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z",key:"1nnpy2"}],["polyline",{points:"14 2 14 8 20 8",key:"1ew0cm"}],["path",{d:"m10 13-2 2 2 2",key:"17smn8"}],["path",{d:"m14 17 2-2-2-2",key:"14mezr"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Rp=he("FileText",[["path",{d:"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z",key:"1nnpy2"}],["polyline",{points:"14 2 14 8 20 8",key:"1ew0cm"}],["line",{x1:"16",x2:"8",y1:"13",y2:"13",key:"14keom"}],["line",{x1:"16",x2:"8",y1:"17",y2:"17",key:"17nazh"}],["line",{x1:"10",x2:"8",y1:"9",y2:"9",key:"1a5vjj"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ph=he("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pp=he("FlaskConical",[["path",{d:"M10 2v7.527a2 2 0 0 1-.211.896L4.72 20.55a1 1 0 0 0 .9 1.45h12.76a1 1 0 0 0 .9-1.45l-5.069-10.127A2 2 0 0 1 14 9.527V2",key:"pzvekw"}],["path",{d:"M8.5 2h7",key:"csnxdl"}],["path",{d:"M7 16h10",key:"wp8him"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ri=he("Gauge",[["path",{d:"m12 14 4-4",key:"9kzdfg"}],["path",{d:"M3.34 19a10 10 0 1 1 17.32 0",key:"19p75a"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Mp=he("Globe2",[["path",{d:"M21.54 15H17a2 2 0 0 0-2 2v4.54",key:"1djwo0"}],["path",{d:"M7 3.34V5a3 3 0 0 0 3 3v0a2 2 0 0 1 2 2v0c0 1.1.9 2 2 2v0a2 2 0 0 0 2-2v0c0-1.1.9-2 2-2h3.17",key:"1fi5u6"}],["path",{d:"M11 21.95V18a2 2 0 0 0-2-2v0a2 2 0 0 1-2-2v-1a2 2 0 0 0-2-2H2.05",key:"xsiumc"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $p=he("Hash",[["line",{x1:"4",x2:"20",y1:"9",y2:"9",key:"4lhtct"}],["line",{x1:"4",x2:"20",y1:"15",y2:"15",key:"vyu0kd"}],["line",{x1:"10",x2:"8",y1:"3",y2:"21",key:"1ggp8o"}],["line",{x1:"16",x2:"14",y1:"3",y2:"21",key:"weycgp"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Op=he("Heart",[["path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z",key:"c3ymky"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vp=he("Hourglass",[["path",{d:"M5 22h14",key:"ehvnwv"}],["path",{d:"M5 2h14",key:"pdyrp9"}],["path",{d:"M17 22v-4.172a2 2 0 0 0-.586-1.414L12 12l-4.414 4.414A2 2 0 0 0 7 17.828V22",key:"1d314k"}],["path",{d:"M7 2v4.172a2 2 0 0 0 .586 1.414L12 12l4.414-4.414A2 2 0 0 0 17 6.172V2",key:"1vvvr6"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fa=he("Image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ln=he("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Lp=he("Key",[["circle",{cx:"7.5",cy:"15.5",r:"5.5",key:"yqb3hr"}],["path",{d:"m21 2-9.6 9.6",key:"1j0ho8"}],["path",{d:"m15.5 7.5 3 3L22 7l-3-3",key:"1rn1fs"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fp=he("Layers",[["path",{d:"m12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83Z",key:"8b97xw"}],["path",{d:"m22 17.65-9.17 4.16a2 2 0 0 1-1.66 0L2 17.65",key:"dd6zsq"}],["path",{d:"m22 12.65-9.17 4.16a2 2 0 0 1-1.66 0L2 12.65",key:"ep9fru"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Up=he("LayoutGrid",[["rect",{width:"7",height:"7",x:"3",y:"3",rx:"1",key:"1g98yp"}],["rect",{width:"7",height:"7",x:"14",y:"3",rx:"1",key:"6d4xhi"}],["rect",{width:"7",height:"7",x:"14",y:"14",rx:"1",key:"nxv5o0"}],["rect",{width:"7",height:"7",x:"3",y:"14",rx:"1",key:"1bb6yr"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xa=he("LineChart",[["path",{d:"M3 3v18h18",key:"1s2lah"}],["path",{d:"m19 9-5 5-4-4-3 3",key:"2osh9i"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gd=he("Link2",[["path",{d:"M9 17H7A5 5 0 0 1 7 7h2",key:"8i5ue5"}],["path",{d:"M15 7h2a5 5 0 1 1 0 10h-2",key:"1b9ql8"}],["line",{x1:"8",x2:"16",y1:"12",y2:"12",key:"1jonct"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bp=he("List",[["line",{x1:"8",x2:"21",y1:"6",y2:"6",key:"7ey8pc"}],["line",{x1:"8",x2:"21",y1:"12",y2:"12",key:"rjfblc"}],["line",{x1:"8",x2:"21",y1:"18",y2:"18",key:"c3b1m8"}],["line",{x1:"3",x2:"3.01",y1:"6",y2:"6",key:"1g7gq3"}],["line",{x1:"3",x2:"3.01",y1:"12",y2:"12",key:"1pjlvk"}],["line",{x1:"3",x2:"3.01",y1:"18",y2:"18",key:"28t2mc"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pi=he("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Wp=he("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qp=he("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const za=he("MapPin",[["path",{d:"M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z",key:"2oe9fu"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zp=he("MessageCircle",[["path",{d:"m3 21 1.9-5.7a8.5 8.5 0 1 1 3.8 3.8z",key:"v2veuj"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ys=he("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kl=he("Moon",[["path",{d:"M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z",key:"a7tn18"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Hp=he("MoreVertical",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gp=he("Network",[["rect",{x:"16",y:"16",width:"6",height:"6",rx:"1",key:"4q2zg0"}],["rect",{x:"2",y:"16",width:"6",height:"6",rx:"1",key:"8cvhb9"}],["rect",{x:"9",y:"2",width:"6",height:"6",rx:"1",key:"1egb70"}],["path",{d:"M5 16v-3a1 1 0 0 1 1-1h12a1 1 0 0 1 1 1v3",key:"1jsf9p"}],["path",{d:"M12 12V8",key:"2874zd"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const To=he("Octagon",[["polygon",{points:"7.86 2 16.14 2 22 7.86 22 16.14 16.14 22 7.86 22 2 16.14 2 7.86 7.86 2",key:"h1p8hx"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Kp=he("Palette",[["circle",{cx:"13.5",cy:"6.5",r:".5",key:"1xcu5"}],["circle",{cx:"17.5",cy:"10.5",r:".5",key:"736e4u"}],["circle",{cx:"8.5",cy:"7.5",r:".5",key:"clrty"}],["circle",{cx:"6.5",cy:"12.5",r:".5",key:"1s4xz9"}],["path",{d:"M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10c.926 0 1.648-.746 1.648-1.688 0-.437-.18-.835-.437-1.125-.29-.289-.438-.652-.438-1.125a1.64 1.64 0 0 1 1.668-1.668h1.996c3.051 0 5.555-2.503 5.555-5.554C21.965 6.012 17.461 2 12 2z",key:"12rzf8"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pd=he("PenLine",[["path",{d:"M12 20h9",key:"t2du7b"}],["path",{d:"M16.5 3.5a2.12 2.12 0 0 1 3 3L7 19l-4 1 1-4Z",key:"ymcmye"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tr=he("PenSquare",[["path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1qinfi"}],["path",{d:"M18.5 2.5a2.12 2.12 0 0 1 3 3L12 15l-4 1 1-4Z",key:"w2jsv5"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fd=he("Pen",[["path",{d:"M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z",key:"5qss01"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ha=he("Percent",[["line",{x1:"19",x2:"5",y1:"5",y2:"19",key:"1x9vlm"}],["circle",{cx:"6.5",cy:"6.5",r:"2.5",key:"4mh3h7"}],["circle",{cx:"17.5",cy:"17.5",r:"2.5",key:"1mdrzq"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Yp=he("PieChart",[["path",{d:"M21.21 15.89A10 10 0 1 1 8 2.83",key:"k2fpak"}],["path",{d:"M22 12A10 10 0 0 0 12 2v10z",key:"1rfc4y"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xd=he("PiggyBank",[["path",{d:"M19 5c-1.5 0-2.8 1.4-3 2-3.5-1.5-11-.3-11 5 0 1.8 0 3 2 4.5V20h4v-2h3v2h4v-4c1-.5 1.7-1 2-2h2v-4h-2c0-1-.5-1.5-1-2h0V5z",key:"uf6l00"}],["path",{d:"M2 9v1c0 1.1.9 2 2 2h1",key:"nm575m"}],["path",{d:"M16 11h0",key:"k2aug8"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qp=he("Plane",[["path",{d:"M17.8 19.2 16 11l3.5-3.5C21 6 21.5 4 21 3c-1-.5-3 0-4.5 1.5L13 8 4.8 6.2c-.5-.1-.9.1-1.1.5l-.3.5c-.2.5-.1 1 .3 1.3L9 12l-2 3H4l-1 1 3 2 2 3 1-1v-3l3-2 3.5 5.3c.3.4.8.5 1.3.3l.5-.2c.4-.3.6-.7.5-1.2z",key:"1v9wt8"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fh=he("PlusCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}],["path",{d:"M12 8v8",key:"napkw2"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ra=he("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xp=he("Radio",[["path",{d:"M4.9 19.1C1 15.2 1 8.8 4.9 4.9",key:"1vaf9d"}],["path",{d:"M7.8 16.2c-2.3-2.3-2.3-6.1 0-8.5",key:"u1ii0m"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}],["path",{d:"M16.2 7.8c2.3 2.3 2.3 6.1 0 8.5",key:"1j5fej"}],["path",{d:"M19.1 4.9C23 8.8 23 15.1 19.1 19",key:"10b0cb"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Jp=he("RefreshCcw",[["path",{d:"M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"14sxne"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16",key:"1hlbsb"}],["path",{d:"M16 16h5v5",key:"ccwih5"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ya=he("Rocket",[["path",{d:"M4.5 16.5c-1.5 1.26-2 5-2 5s3.74-.5 5-2c.71-.84.7-2.13-.09-2.91a2.18 2.18 0 0 0-2.91-.09z",key:"m3kijz"}],["path",{d:"m12 15-3-3a22 22 0 0 1 2-3.95A12.88 12.88 0 0 1 22 2c0 2.72-.78 7.5-6 11a22.35 22.35 0 0 1-4 2z",key:"1fmvmk"}],["path",{d:"M9 12H4s.55-3.03 2-4c1.62-1.08 5 0 5 0",key:"1f8sc4"}],["path",{d:"M12 15v5s3.03-.55 4-2c1.08-1.62 0-5 0-5",key:"qeys4"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zp=he("Scale",[["path",{d:"m16 16 3-8 3 8c-.87.65-1.92 1-3 1s-2.13-.35-3-1Z",key:"7g6ntu"}],["path",{d:"m2 16 3-8 3 8c-.87.65-1.92 1-3 1s-2.13-.35-3-1Z",key:"ijws7r"}],["path",{d:"M7 21h10",key:"1b0cd5"}],["path",{d:"M12 3v18",key:"108xh3"}],["path",{d:"M3 7h2c2 0 5-1 7-2 2 1 5 2 7 2h2",key:"3gwbw2"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ss=he("ScrollText",[["path",{d:"M8 21h12a2 2 0 0 0 2-2v-2H10v2a2 2 0 1 1-4 0V5a2 2 0 1 0-4 0v3h4",key:"13a6an"}],["path",{d:"M19 17V5a2 2 0 0 0-2-2H4",key:"zz82l3"}],["path",{d:"M15 8h-5",key:"1khuty"}],["path",{d:"M15 12h-5",key:"r7krc0"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ef=he("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yd=he("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $n=he("ShieldAlert",[["path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10",key:"1irkt0"}],["path",{d:"M12 8v4",key:"1got3b"}],["path",{d:"M12 16h.01",key:"1drbdi"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ui=he("ShieldCheck",[["path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10",key:"1irkt0"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zt=he("Shield",[["path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10",key:"1irkt0"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bd=he("SlidersHorizontal",[["line",{x1:"21",x2:"14",y1:"4",y2:"4",key:"obuewd"}],["line",{x1:"10",x2:"3",y1:"4",y2:"4",key:"1q6298"}],["line",{x1:"21",x2:"12",y1:"12",y2:"12",key:"1iu8h1"}],["line",{x1:"8",x2:"3",y1:"12",y2:"12",key:"ntss68"}],["line",{x1:"21",x2:"16",y1:"20",y2:"20",key:"14d8ph"}],["line",{x1:"12",x2:"3",y1:"20",y2:"20",key:"m0wm8r"}],["line",{x1:"14",x2:"14",y1:"2",y2:"6",key:"14e1ph"}],["line",{x1:"8",x2:"8",y1:"10",y2:"14",key:"1i6ji0"}],["line",{x1:"16",x2:"16",y1:"18",y2:"22",key:"1lctlv"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Yt=he("Sparkles",[["path",{d:"m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z",key:"17u4zn"}],["path",{d:"M5 3v4",key:"bklmnn"}],["path",{d:"M19 17v4",key:"iiml17"}],["path",{d:"M3 5h4",key:"nem4j1"}],["path",{d:"M17 19h4",key:"lbex7p"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const So=he("Square",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tf=he("StickyNote",[["path",{d:"M15.5 3H5a2 2 0 0 0-2 2v14c0 1.1.9 2 2 2h14a2 2 0 0 0 2-2V8.5L15.5 3Z",key:"1wis1t"}],["path",{d:"M15 3v6h6",key:"edgan2"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xh=he("Sun",[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"m4.93 4.93 1.41 1.41",key:"149t6j"}],["path",{d:"m17.66 17.66 1.41 1.41",key:"ptbguv"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"m6.34 17.66-1.41 1.41",key:"1m8zz5"}],["path",{d:"m19.07 4.93-1.41 1.41",key:"1shlcs"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rf=he("Table2",[["path",{d:"M9 3H5a2 2 0 0 0-2 2v4m6-6h10a2 2 0 0 1 2 2v4M9 3v18m0 0h10a2 2 0 0 0 2-2V9M9 21H5a2 2 0 0 1-2-2V9m0 0h18",key:"gugj83"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sf=he("Tag",[["path",{d:"M12 2H2v10l9.29 9.29c.94.94 2.48.94 3.42 0l6.58-6.58c.94-.94.94-2.48 0-3.42L12 2Z",key:"14b2ls"}],["path",{d:"M7 7h.01",key:"7u93v4"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ns=he("Target",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nf=he("ThumbsDown",[["path",{d:"M17 14V2",key:"8ymqnk"}],["path",{d:"M9 18.12 10 14H4.17a2 2 0 0 1-1.92-2.56l2.33-8A2 2 0 0 1 6.5 2H20a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2h-2.76a2 2 0 0 0-1.79 1.11L12 22h0a3.13 3.13 0 0 1-3-3.88Z",key:"s6e0r"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yh=he("Timer",[["line",{x1:"10",x2:"14",y1:"2",y2:"2",key:"14vaq8"}],["line",{x1:"12",x2:"15",y1:"14",y2:"11",key:"17fdiu"}],["circle",{cx:"12",cy:"14",r:"8",key:"1e1u0o"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pt=he("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const af=he("Trash",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ms=he("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cn=he("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bn=he("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const of=he("Wallet2",[["path",{d:"M17 14h.01",key:"7oqj8z"}],["path",{d:"M7 7h12a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h14",key:"u1rqew"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lf=he("Wallet",[["path",{d:"M21 12V7H5a2 2 0 0 1 0-4h14v4",key:"195gfw"}],["path",{d:"M3 5v14a2 2 0 0 0 2 2h16v-5",key:"195n9w"}],["path",{d:"M18 12a2 2 0 0 0 0 4h4v-4Z",key:"vllfpd"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ao=he("Wand2",[["path",{d:"m21.64 3.64-1.28-1.28a1.21 1.21 0 0 0-1.72 0L2.36 18.64a1.21 1.21 0 0 0 0 1.72l1.28 1.28a1.2 1.2 0 0 0 1.72 0L21.64 5.36a1.2 1.2 0 0 0 0-1.72Z",key:"1bcowg"}],["path",{d:"m14 7 3 3",key:"1r5n42"}],["path",{d:"M5 6v4",key:"ilb8ba"}],["path",{d:"M19 14v4",key:"blhpug"}],["path",{d:"M10 2v2",key:"7u0qdc"}],["path",{d:"M7 8H3",key:"zfb6yr"}],["path",{d:"M21 16h-4",key:"1cnmox"}],["path",{d:"M11 3H9",key:"1obp7u"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Jt=he("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const si=he("Zap",[["polygon",{points:"13 2 3 14 12 14 11 22 21 10 12 10 13 2",key:"45s27k"}]]),bh="/assets/logo-D0_tMQfC.png",cf=()=>{const[r,e]=D.useState("member"),[t,n]=D.useState(""),[a,i]=D.useState(""),[o,c]=D.useState(""),{login:d,user:h,isAuthenticated:g}=kt(),{theme:x,toggleTheme:p}=it(),{activateAdmin:v}=Tt(),A=nh(),[C]=D0();D.useEffect(()=>{document.body.classList.toggle("dark",x==="dark")},[x]),D.useEffect(()=>{var $,S,I;if(g&&h){A("/management");return}if(($=window.Telegram)!=null&&$.WebApp){window.Telegram.WebApp.ready(),window.Telegram.WebApp.expand();const G=C.get("tgWebAppData")||window.Telegram.WebApp.initData,E=C.get("login"),y=C.get("password");if(E&&y&&d(E,y)){A("/management");return}if(G)try{const j=new URLSearchParams(G).get("user");if(j){const f=JSON.parse(decodeURIComponent(j)).id;sessionStorage.setItem("telegram_user_id",String(f));const de=localStorage.getItem("apevault-auth");if(de)try{const V=JSON.parse(de);if((S=V.state)!=null&&S.user){const X=V.state.user;if(d(X.login,X.password)){A("/management");return}}}catch(V){console.error("Error parsing saved auth:",V)}console.log("Telegram Mini App detected, user ID:",f)}}catch(k){console.error("Error parsing Telegram initData:",k)}const w=(I=window.Telegram.WebApp.initDataUnsafe)==null?void 0:I.user;w&&(sessionStorage.setItem("telegram_user_id",String(w.id)),console.log("Telegram user detected:",w.first_name))}},[C,g,h,A,d]);const T=$=>{if($.preventDefault(),c(""),!a){c("Пожалуйста, введите пароль");return}if(r==="admin")v(a)?A("/management"):c("Неверный пароль администратора");else{if(!t){c("Пожалуйста, введите логин");return}d(t,a)?A("/management"):c("Неверный логин или пароль")}},z=()=>{p()};return s.jsxs("div",{className:`min-h-screen relative overflow-hidden ${x==="dark"?"bg-[#0b0f17]":"bg-gradient-to-br from-slate-50 via-white to-slate-100"}`,children:[s.jsxs("div",{className:"absolute inset-0 pointer-events-none",children:[s.jsx("div",{className:"absolute -top-24 -left-24 w-[620px] h-[620px] bg-gradient-to-br from-[#4E6E49]/35 via-emerald-400/22 to-transparent blur-[110px]"}),s.jsx("div",{className:"absolute top-[-120px] right-[-180px] w-[780px] h-[780px] bg-gradient-to-bl from-blue-500/24 via-purple-500/22 to-transparent blur-[140px]"}),s.jsx("div",{className:"absolute bottom-[-200px] right-[-80px] w-[620px] h-[620px] bg-gradient-to-tr from-amber-400/18 via-[#4E6E49]/18 to-transparent blur-[120px]"}),s.jsx("div",{className:"floating-grid opacity-75 dark:opacity-45"})]}),s.jsx("div",{className:"relative z-10 max-w-6xl mx-auto px-4 lg:px-6 min-h-screen flex items-center justify-center py-10",children:s.jsxs("div",{className:"glass-panel rounded-[28px] p-4 sm:p-6 md:p-8 border border-white/70 dark:border-white/10 shadow-2xl overflow-hidden w-full",children:[s.jsx("div",{className:"accent-dots"}),s.jsxs("div",{className:"relative z-10 grid md:grid-cols-[1.05fr_0.95fr] gap-6 lg:gap-8 items-stretch",children:[s.jsxs("div",{className:"section-card rounded-2xl p-6 lg:p-7 border border-white/60 dark:border-white/10 shadow-xl flex flex-col items-center text-center gap-4",children:[s.jsx("div",{className:"p-4 rounded-2xl bg-white/80 dark:bg-white/5 border border-white/50 dark:border-white/10 shadow-lg",children:s.jsx("img",{src:bh,alt:"ApeVault Logo",className:"w-16 h-16 object-contain"})}),s.jsxs("div",{className:"space-y-1",children:[s.jsx("p",{className:`text-xs uppercase tracking-[0.16em] ${x==="dark"?"text-gray-400":"text-gray-500"}`,children:"ApeVault Black Ops"}),s.jsx("h1",{className:`text-3xl lg:text-4xl font-extrabold ${x==="dark"?"text-white":"text-gray-900"}`,children:"Командная панель"})]}),s.jsxs("div",{className:"inline-flex items-center gap-2 px-3 py-1 rounded-full bg-gradient-to-r from-[#4E6E49]/15 to-emerald-500/10 text-[#4E6E49] text-xs font-semibold",children:[s.jsx(zt,{className:"w-4 h-4"}),"Защищенный доступ"]}),s.jsxs("div",{className:`w-full mt-4 rounded-xl border ${x==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white/80"} p-4 text-left space-y-3`,children:[s.jsxs("div",{className:"flex items-center gap-2 text-sm font-semibold",children:[s.jsx(zt,{className:"w-4 h-4 text-[#4E6E49]"}),s.jsx("span",{className:x==="dark"?"text-white":"text-gray-900",children:"Правила и доступ"})]}),s.jsxs("ul",{className:`text-xs leading-relaxed space-y-1 ${x==="dark"?"text-gray-300":"text-gray-700"}`,children:[s.jsx("li",{children:"• Пользуемся данными из бота: логин + пароль."}),s.jsx("li",{children:"• Админ пароль: только для доверенных (режим администратора)."}),s.jsx("li",{children:"• Правила: открыты на странице «Правила» на сайте."})]}),s.jsxs(Gt,{to:"/rules",className:"inline-flex items-center justify-center gap-2 px-4 py-2 mt-2 text-xs font-semibold rounded-lg bg-gradient-to-r from-[#4E6E49] to-emerald-600 text-white shadow-md hover:shadow-lg hover:-translate-y-0.5 transition-all",children:[s.jsx(zt,{className:"w-3 h-3"}),"Ознакомиться с правилами"]}),s.jsxs("div",{className:`text-xs ${x==="dark"?"text-gray-400":"text-gray-600"}`,children:["Администратор: ",s.jsx("span",{className:"font-semibold",children:"@artyommedoed"})]})]})]}),s.jsxs("div",{className:"section-card rounded-2xl p-6 lg:p-7 border border-white/60 dark:border-white/10 shadow-xl",children:[s.jsxs("div",{className:"flex items-center justify-between mb-6",children:[s.jsxs("div",{children:[s.jsx("p",{className:`text-xs uppercase tracking-[0.12em] ${x==="dark"?"text-gray-400":"text-gray-500"}`,children:"Доступ"}),s.jsx("h2",{className:`text-2xl font-extrabold ${x==="dark"?"text-white":"text-gray-900"}`,children:"Вход в систему"})]}),s.jsx("button",{onClick:z,className:"nav-chip px-3 py-2","data-active":"false","aria-label":"Toggle theme",children:x==="dark"?s.jsx(xh,{className:"w-5 h-5 text-amber-300"}):s.jsx(kl,{className:"w-5 h-5 text-gray-700"})})]}),s.jsxs("form",{onSubmit:T,className:"space-y-5",children:[s.jsxs("div",{children:[s.jsx("label",{className:`block text-sm font-semibold mb-3 ${x==="dark"?"text-gray-300":"text-gray-700"}`,children:"Тип пользователя"}),s.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[s.jsxs("button",{type:"button",onClick:()=>{e("member"),n(""),i(""),c("")},className:"pill justify-center","data-active":r==="member",children:[s.jsx(bn,{className:"w-5 h-5"}),s.jsx("span",{children:"Участник"})]}),s.jsxs("button",{type:"button",onClick:()=>{e("admin"),n(""),i(""),c("")},className:"pill justify-center","data-active":r==="admin",children:[s.jsx(zt,{className:"w-5 h-5"}),s.jsx("span",{children:"Админ"})]})]})]}),r==="member"&&s.jsxs("div",{children:[s.jsxs("label",{htmlFor:"login",className:`block text-sm font-semibold mb-2 ${x==="dark"?"text-gray-300":"text-gray-700"}`,children:[s.jsx(cn,{className:"w-4 h-4 inline mr-2"}),"Логин"]}),s.jsx("div",{className:"flex items-center gap-2",children:s.jsx("input",{id:"login",type:"text",value:t,onChange:$=>n($.target.value),className:`w-full px-4 py-3 rounded-xl border transition-all ${x==="dark"?"bg-white/5 border-white/10 text-white placeholder-gray-500 focus:border-[#4E6E49]":"bg-white border-gray-300 text-gray-900 placeholder-gray-400 focus:border-[#4E6E49]"} focus:outline-none focus:ring-4 focus:ring-[#4E6E49]/20`,placeholder:"Введите ваш логин",autoComplete:"username"})})]}),s.jsxs("div",{children:[s.jsxs("label",{htmlFor:"password",className:`block text-sm font-semibold mb-2 ${x==="dark"?"text-gray-300":"text-gray-700"}`,children:[s.jsx(zt,{className:"w-4 h-4 inline mr-2"}),"Пароль"]}),s.jsx("input",{id:"password",type:"password",value:a,onChange:$=>i($.target.value),className:`w-full px-4 py-3 rounded-xl border transition-all ${x==="dark"?"bg-white/5 border-white/10 text-white placeholder-gray-500 focus:border-[#4E6E49]":"bg-white border-gray-300 text-gray-900 placeholder-gray-400 focus:border-[#4E6E49]"} focus:outline-none focus:ring-4 focus:ring-[#4E6E49]/20`,placeholder:r==="admin"?"Введите пароль администратора":"Введите ваш пароль",autoComplete:r==="admin"?"off":"current-password"}),r==="admin"&&s.jsx("p",{className:`mt-2 text-xs ${x==="dark"?"text-gray-400":"text-gray-500"}`,children:"Для входа в режим администратора требуется специальный пароль"})]}),o&&s.jsx("div",{className:`p-4 rounded-xl border ${x==="dark"?"bg-red-500/15 border-red-500/40 text-red-300":"bg-red-50 border-red-300 text-red-700"} text-sm font-semibold animate-shake`,children:o}),s.jsx("button",{type:"submit",className:"w-full py-3 px-4 rounded-xl font-bold text-lg shadow-lg hover:shadow-xl transform hover:-translate-y-0.5 transition-all bg-gradient-to-r from-[#4E6E49] to-[#4E6E49] text-white",children:"Войти в систему"})]}),s.jsx("div",{className:`mt-6 pt-6 border-t ${x==="dark"?"border-white/10":"border-gray-200"} flex items-center justify-between gap-3 flex-wrap`,children:s.jsx("div",{className:`text-xs ${x==="dark"?"text-gray-400":"text-gray-600"}`,children:"Защищенная система для команды ApeVault"})})]})]})]})})]})};var vd={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vh=function(r){const e=[];let t=0;for(let n=0;n<r.length;n++){let a=r.charCodeAt(n);a<128?e[t++]=a:a<2048?(e[t++]=a>>6|192,e[t++]=a&63|128):(a&64512)===55296&&n+1<r.length&&(r.charCodeAt(n+1)&64512)===56320?(a=65536+((a&1023)<<10)+(r.charCodeAt(++n)&1023),e[t++]=a>>18|240,e[t++]=a>>12&63|128,e[t++]=a>>6&63|128,e[t++]=a&63|128):(e[t++]=a>>12|224,e[t++]=a>>6&63|128,e[t++]=a&63|128)}return e},df=function(r){const e=[];let t=0,n=0;for(;t<r.length;){const a=r[t++];if(a<128)e[n++]=String.fromCharCode(a);else if(a>191&&a<224){const i=r[t++];e[n++]=String.fromCharCode((a&31)<<6|i&63)}else if(a>239&&a<365){const i=r[t++],o=r[t++],c=r[t++],d=((a&7)<<18|(i&63)<<12|(o&63)<<6|c&63)-65536;e[n++]=String.fromCharCode(55296+(d>>10)),e[n++]=String.fromCharCode(56320+(d&1023))}else{const i=r[t++],o=r[t++];e[n++]=String.fromCharCode((a&15)<<12|(i&63)<<6|o&63)}}return e.join("")},wh={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(r,e){if(!Array.isArray(r))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,n=[];for(let a=0;a<r.length;a+=3){const i=r[a],o=a+1<r.length,c=o?r[a+1]:0,d=a+2<r.length,h=d?r[a+2]:0,g=i>>2,x=(i&3)<<4|c>>4;let p=(c&15)<<2|h>>6,v=h&63;d||(v=64,o||(p=64)),n.push(t[g],t[x],t[p],t[v])}return n.join("")},encodeString(r,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(r):this.encodeByteArray(vh(r),e)},decodeString(r,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(r):df(this.decodeStringToByteArray(r,e))},decodeStringToByteArray(r,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,n=[];for(let a=0;a<r.length;){const i=t[r.charAt(a++)],c=a<r.length?t[r.charAt(a)]:0;++a;const h=a<r.length?t[r.charAt(a)]:64;++a;const x=a<r.length?t[r.charAt(a)]:64;if(++a,i==null||c==null||h==null||x==null)throw new uf;const p=i<<2|c>>4;if(n.push(p),h!==64){const v=c<<4&240|h>>2;if(n.push(v),x!==64){const A=h<<6&192|x;n.push(A)}}}return n},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let r=0;r<this.ENCODED_VALS.length;r++)this.byteToCharMap_[r]=this.ENCODED_VALS.charAt(r),this.charToByteMap_[this.byteToCharMap_[r]]=r,this.byteToCharMapWebSafe_[r]=this.ENCODED_VALS_WEBSAFE.charAt(r),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[r]]=r,r>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(r)]=r,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(r)]=r)}}};class uf extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const hf=function(r){const e=vh(r);return wh.encodeByteArray(e,!0)},fi=function(r){return hf(r).replace(/\./g,"")},kh=function(r){try{return wh.decodeString(r,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mf(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gf=()=>mf().__FIREBASE_DEFAULTS__,pf=()=>{if(typeof process>"u"||typeof vd>"u")return;const r=vd.__FIREBASE_DEFAULTS__;if(r)return JSON.parse(r)},ff=()=>{if(typeof document>"u")return;let r;try{r=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=r&&kh(r[1]);return e&&JSON.parse(e)},Bi=()=>{try{return gf()||pf()||ff()}catch(r){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${r}`);return}},_h=r=>{var e,t;return(t=(e=Bi())===null||e===void 0?void 0:e.emulatorHosts)===null||t===void 0?void 0:t[r]},Nh=r=>{const e=_h(r);if(!e)return;const t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const n=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),n]:[e.substring(0,t),n]},jh=()=>{var r;return(r=Bi())===null||r===void 0?void 0:r.config},Eh=r=>{var e;return(e=Bi())===null||e===void 0?void 0:e[`_${r}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xf{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,n)=>{t?this.reject(t):this.resolve(n),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,n))}}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ih(r,e){if(r.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const t={alg:"none",type:"JWT"},n=e||"demo-project",a=r.iat||0,i=r.sub||r.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o=Object.assign({iss:`https://securetoken.google.com/${n}`,aud:n,iat:a,exp:a+3600,auth_time:a,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}}},r);return[fi(JSON.stringify(t)),fi(JSON.stringify(o)),""].join(".")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Bt(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function yf(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Bt())}function bf(){var r;const e=(r=Bi())===null||r===void 0?void 0:r.forceEnvironment;if(e==="node")return!0;if(e==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function vf(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function wf(){const r=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof r=="object"&&r.id!==void 0}function kf(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function _f(){const r=Bt();return r.indexOf("MSIE ")>=0||r.indexOf("Trident/")>=0}function Nf(){return!bf()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function jf(){try{return typeof indexedDB=="object"}catch{return!1}}function Ef(){return new Promise((r,e)=>{try{let t=!0;const n="validate-browser-context-for-indexeddb-analytics-module",a=self.indexedDB.open(n);a.onsuccess=()=>{a.result.close(),t||self.indexedDB.deleteDatabase(n),r(!0)},a.onupgradeneeded=()=>{t=!1},a.onerror=()=>{var i;e(((i=a.error)===null||i===void 0?void 0:i.message)||"")}}catch(t){e(t)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const If="FirebaseError";class Ir extends Error{constructor(e,t,n){super(t),this.code=e,this.customData=n,this.name=If,Object.setPrototypeOf(this,Ir.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,ba.prototype.create)}}class ba{constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(e,...t){const n=t[0]||{},a=`${this.service}/${e}`,i=this.errors[e],o=i?Tf(i,n):"Error",c=`${this.serviceName}: ${o} (${a}).`;return new Ir(a,c,n)}}function Tf(r,e){return r.replace(Sf,(t,n)=>{const a=e[n];return a!=null?String(a):`<${n}?>`})}const Sf=/\{\$([^}]+)}/g;function Af(r){for(const e in r)if(Object.prototype.hasOwnProperty.call(r,e))return!1;return!0}function xi(r,e){if(r===e)return!0;const t=Object.keys(r),n=Object.keys(e);for(const a of t){if(!n.includes(a))return!1;const i=r[a],o=e[a];if(wd(i)&&wd(o)){if(!xi(i,o))return!1}else if(i!==o)return!1}for(const a of n)if(!t.includes(a))return!1;return!0}function wd(r){return r!==null&&typeof r=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function va(r){const e=[];for(const[t,n]of Object.entries(r))Array.isArray(n)?n.forEach(a=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(a))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(n));return e.length?"&"+e.join("&"):""}function Cf(r,e){const t=new Df(r,e);return t.subscribe.bind(t)}class Df{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(n=>{this.error(n)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,n){let a;if(e===void 0&&t===void 0&&n===void 0)throw new Error("Missing Observer.");Rf(e,["next","error","complete"])?a=e:a={next:e,error:t,complete:n},a.next===void 0&&(a.next=Co),a.error===void 0&&(a.error=Co),a.complete===void 0&&(a.complete=Co);const i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?a.error(this.finalError):a.complete()}catch{}}),this.observers.push(a),i}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(n){typeof console<"u"&&console.error&&console.error(n)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function Rf(r,e){if(typeof r!="object"||r===null)return!1;for(const t of e)if(t in r&&typeof r[t]=="function")return!0;return!1}function Co(){}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Wt(r){return r&&r._delegate?r._delegate:r}class ps{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const js="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pf{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const n=new xf;if(this.instancesDeferred.set(t,n),this.isInitialized(t)||this.shouldAutoInitialize())try{const a=this.getOrInitializeService({instanceIdentifier:t});a&&n.resolve(a)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const n=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),a=(t=e==null?void 0:e.optional)!==null&&t!==void 0?t:!1;if(this.isInitialized(n)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:n})}catch(i){if(a)return null;throw i}else{if(a)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if($f(e))try{this.getOrInitializeService({instanceIdentifier:js})}catch{}for(const[t,n]of this.instancesDeferred.entries()){const a=this.normalizeInstanceIdentifier(t);try{const i=this.getOrInitializeService({instanceIdentifier:a});n.resolve(i)}catch{}}}}clearInstance(e=js){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=js){return this.instances.has(e)}getOptions(e=js){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,n=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const a=this.getOrInitializeService({instanceIdentifier:n,options:t});for(const[i,o]of this.instancesDeferred.entries()){const c=this.normalizeInstanceIdentifier(i);n===c&&o.resolve(a)}return a}onInit(e,t){var n;const a=this.normalizeInstanceIdentifier(t),i=(n=this.onInitCallbacks.get(a))!==null&&n!==void 0?n:new Set;i.add(e),this.onInitCallbacks.set(a,i);const o=this.instances.get(a);return o&&e(o,a),()=>{i.delete(e)}}invokeOnInitCallbacks(e,t){const n=this.onInitCallbacks.get(t);if(n)for(const a of n)try{a(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let n=this.instances.get(e);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:Mf(e),options:t}),this.instances.set(e,n),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(n,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,n)}catch{}return n||null}normalizeInstanceIdentifier(e=js){return this.component?this.component.multipleInstances?e:js:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function Mf(r){return r===js?void 0:r}function $f(r){return r.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Of{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new Pf(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Ke;(function(r){r[r.DEBUG=0]="DEBUG",r[r.VERBOSE=1]="VERBOSE",r[r.INFO=2]="INFO",r[r.WARN=3]="WARN",r[r.ERROR=4]="ERROR",r[r.SILENT=5]="SILENT"})(Ke||(Ke={}));const Vf={debug:Ke.DEBUG,verbose:Ke.VERBOSE,info:Ke.INFO,warn:Ke.WARN,error:Ke.ERROR,silent:Ke.SILENT},Lf=Ke.INFO,Ff={[Ke.DEBUG]:"log",[Ke.VERBOSE]:"log",[Ke.INFO]:"info",[Ke.WARN]:"warn",[Ke.ERROR]:"error"},Uf=(r,e,...t)=>{if(e<r.logLevel)return;const n=new Date().toISOString(),a=Ff[e];if(a)console[a](`[${n}]  ${r.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class _l{constructor(e){this.name=e,this._logLevel=Lf,this._logHandler=Uf,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in Ke))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?Vf[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,Ke.DEBUG,...e),this._logHandler(this,Ke.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,Ke.VERBOSE,...e),this._logHandler(this,Ke.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,Ke.INFO,...e),this._logHandler(this,Ke.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,Ke.WARN,...e),this._logHandler(this,Ke.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,Ke.ERROR,...e),this._logHandler(this,Ke.ERROR,...e)}}const Bf=(r,e)=>e.some(t=>r instanceof t);let kd,_d;function Wf(){return kd||(kd=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function qf(){return _d||(_d=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const Th=new WeakMap,Ko=new WeakMap,Sh=new WeakMap,Do=new WeakMap,Nl=new WeakMap;function zf(r){const e=new Promise((t,n)=>{const a=()=>{r.removeEventListener("success",i),r.removeEventListener("error",o)},i=()=>{t(us(r.result)),a()},o=()=>{n(r.error),a()};r.addEventListener("success",i),r.addEventListener("error",o)});return e.then(t=>{t instanceof IDBCursor&&Th.set(t,r)}).catch(()=>{}),Nl.set(e,r),e}function Hf(r){if(Ko.has(r))return;const e=new Promise((t,n)=>{const a=()=>{r.removeEventListener("complete",i),r.removeEventListener("error",o),r.removeEventListener("abort",o)},i=()=>{t(),a()},o=()=>{n(r.error||new DOMException("AbortError","AbortError")),a()};r.addEventListener("complete",i),r.addEventListener("error",o),r.addEventListener("abort",o)});Ko.set(r,e)}let Yo={get(r,e,t){if(r instanceof IDBTransaction){if(e==="done")return Ko.get(r);if(e==="objectStoreNames")return r.objectStoreNames||Sh.get(r);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return us(r[e])},set(r,e,t){return r[e]=t,!0},has(r,e){return r instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in r}};function Gf(r){Yo=r(Yo)}function Kf(r){return r===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const n=r.call(Ro(this),e,...t);return Sh.set(n,e.sort?e.sort():[e]),us(n)}:qf().includes(r)?function(...e){return r.apply(Ro(this),e),us(Th.get(this))}:function(...e){return us(r.apply(Ro(this),e))}}function Yf(r){return typeof r=="function"?Kf(r):(r instanceof IDBTransaction&&Hf(r),Bf(r,Wf())?new Proxy(r,Yo):r)}function us(r){if(r instanceof IDBRequest)return zf(r);if(Do.has(r))return Do.get(r);const e=Yf(r);return e!==r&&(Do.set(r,e),Nl.set(e,r)),e}const Ro=r=>Nl.get(r);function Qf(r,e,{blocked:t,upgrade:n,blocking:a,terminated:i}={}){const o=indexedDB.open(r,e),c=us(o);return n&&o.addEventListener("upgradeneeded",d=>{n(us(o.result),d.oldVersion,d.newVersion,us(o.transaction),d)}),t&&o.addEventListener("blocked",d=>t(d.oldVersion,d.newVersion,d)),c.then(d=>{i&&d.addEventListener("close",()=>i()),a&&d.addEventListener("versionchange",h=>a(h.oldVersion,h.newVersion,h))}).catch(()=>{}),c}const Xf=["get","getKey","getAll","getAllKeys","count"],Jf=["put","add","delete","clear"],Po=new Map;function Nd(r,e){if(!(r instanceof IDBDatabase&&!(e in r)&&typeof e=="string"))return;if(Po.get(e))return Po.get(e);const t=e.replace(/FromIndex$/,""),n=e!==t,a=Jf.includes(t);if(!(t in(n?IDBIndex:IDBObjectStore).prototype)||!(a||Xf.includes(t)))return;const i=async function(o,...c){const d=this.transaction(o,a?"readwrite":"readonly");let h=d.store;return n&&(h=h.index(c.shift())),(await Promise.all([h[t](...c),a&&d.done]))[0]};return Po.set(e,i),i}Gf(r=>({...r,get:(e,t,n)=>Nd(e,t)||r.get(e,t,n),has:(e,t)=>!!Nd(e,t)||r.has(e,t)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zf{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(ex(t)){const n=t.getImmediate();return`${n.library}/${n.version}`}else return null}).filter(t=>t).join(" ")}}function ex(r){const e=r.getComponent();return(e==null?void 0:e.type)==="VERSION"}const Qo="@firebase/app",jd="0.10.13";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Br=new _l("@firebase/app"),tx="@firebase/app-compat",rx="@firebase/analytics-compat",sx="@firebase/analytics",nx="@firebase/app-check-compat",ax="@firebase/app-check",ix="@firebase/auth",ox="@firebase/auth-compat",lx="@firebase/database",cx="@firebase/data-connect",dx="@firebase/database-compat",ux="@firebase/functions",hx="@firebase/functions-compat",mx="@firebase/installations",gx="@firebase/installations-compat",px="@firebase/messaging",fx="@firebase/messaging-compat",xx="@firebase/performance",yx="@firebase/performance-compat",bx="@firebase/remote-config",vx="@firebase/remote-config-compat",wx="@firebase/storage",kx="@firebase/storage-compat",_x="@firebase/firestore",Nx="@firebase/vertexai-preview",jx="@firebase/firestore-compat",Ex="firebase",Ix="10.14.1";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Xo="[DEFAULT]",Tx={[Qo]:"fire-core",[tx]:"fire-core-compat",[sx]:"fire-analytics",[rx]:"fire-analytics-compat",[ax]:"fire-app-check",[nx]:"fire-app-check-compat",[ix]:"fire-auth",[ox]:"fire-auth-compat",[lx]:"fire-rtdb",[cx]:"fire-data-connect",[dx]:"fire-rtdb-compat",[ux]:"fire-fn",[hx]:"fire-fn-compat",[mx]:"fire-iid",[gx]:"fire-iid-compat",[px]:"fire-fcm",[fx]:"fire-fcm-compat",[xx]:"fire-perf",[yx]:"fire-perf-compat",[bx]:"fire-rc",[vx]:"fire-rc-compat",[wx]:"fire-gcs",[kx]:"fire-gcs-compat",[_x]:"fire-fst",[jx]:"fire-fst-compat",[Nx]:"fire-vertex","fire-js":"fire-js",[Ex]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yi=new Map,Sx=new Map,Jo=new Map;function Ed(r,e){try{r.container.addComponent(e)}catch(t){Br.debug(`Component ${e.name} failed to register with FirebaseApp ${r.name}`,t)}}function $s(r){const e=r.name;if(Jo.has(e))return Br.debug(`There were multiple attempts to register component ${e}.`),!1;Jo.set(e,r);for(const t of yi.values())Ed(t,r);for(const t of Sx.values())Ed(t,r);return!0}function Wi(r,e){const t=r.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),r.container.getProvider(e)}function cs(r){return r.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ax={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},hs=new ba("app","Firebase",Ax);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cx{constructor(e,t,n){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new ps("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw hs.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Us=Ix;function Ah(r,e={}){let t=r;typeof e!="object"&&(e={name:e});const n=Object.assign({name:Xo,automaticDataCollectionEnabled:!1},e),a=n.name;if(typeof a!="string"||!a)throw hs.create("bad-app-name",{appName:String(a)});if(t||(t=jh()),!t)throw hs.create("no-options");const i=yi.get(a);if(i){if(xi(t,i.options)&&xi(n,i.config))return i;throw hs.create("duplicate-app",{appName:a})}const o=new Of(a);for(const d of Jo.values())o.addComponent(d);const c=new Cx(t,n,o);return yi.set(a,c),c}function jl(r=Xo){const e=yi.get(r);if(!e&&r===Xo&&jh())return Ah();if(!e)throw hs.create("no-app",{appName:r});return e}function br(r,e,t){var n;let a=(n=Tx[r])!==null&&n!==void 0?n:r;t&&(a+=`-${t}`);const i=a.match(/\s|\//),o=e.match(/\s|\//);if(i||o){const c=[`Unable to register library "${a}" with version "${e}":`];i&&c.push(`library name "${a}" contains illegal characters (whitespace or "/")`),i&&o&&c.push("and"),o&&c.push(`version name "${e}" contains illegal characters (whitespace or "/")`),Br.warn(c.join(" "));return}$s(new ps(`${a}-version`,()=>({library:a,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Dx="firebase-heartbeat-database",Rx=1,sa="firebase-heartbeat-store";let Mo=null;function Ch(){return Mo||(Mo=Qf(Dx,Rx,{upgrade:(r,e)=>{switch(e){case 0:try{r.createObjectStore(sa)}catch(t){console.warn(t)}}}}).catch(r=>{throw hs.create("idb-open",{originalErrorMessage:r.message})})),Mo}async function Px(r){try{const t=(await Ch()).transaction(sa),n=await t.objectStore(sa).get(Dh(r));return await t.done,n}catch(e){if(e instanceof Ir)Br.warn(e.message);else{const t=hs.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});Br.warn(t.message)}}}async function Id(r,e){try{const n=(await Ch()).transaction(sa,"readwrite");await n.objectStore(sa).put(e,Dh(r)),await n.done}catch(t){if(t instanceof Ir)Br.warn(t.message);else{const n=hs.create("idb-set",{originalErrorMessage:t==null?void 0:t.message});Br.warn(n.message)}}}function Dh(r){return`${r.name}!${r.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Mx=1024,$x=30*24*60*60*1e3;class Ox{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new Lx(t),this._heartbeatsCachePromise=this._storage.read().then(n=>(this._heartbeatsCache=n,n))}async triggerHeartbeat(){var e,t;try{const a=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),i=Td();return((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===i||this._heartbeatsCache.heartbeats.some(o=>o.date===i)?void 0:(this._heartbeatsCache.heartbeats.push({date:i,agent:a}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(o=>{const c=new Date(o.date).valueOf();return Date.now()-c<=$x}),this._storage.overwrite(this._heartbeatsCache))}catch(n){Br.warn(n)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const t=Td(),{heartbeatsToSend:n,unsentEntries:a}=Vx(this._heartbeatsCache.heartbeats),i=fi(JSON.stringify({version:2,heartbeats:n}));return this._heartbeatsCache.lastSentHeartbeatDate=t,a.length>0?(this._heartbeatsCache.heartbeats=a,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(t){return Br.warn(t),""}}}function Td(){return new Date().toISOString().substring(0,10)}function Vx(r,e=Mx){const t=[];let n=r.slice();for(const a of r){const i=t.find(o=>o.agent===a.agent);if(i){if(i.dates.push(a.date),Sd(t)>e){i.dates.pop();break}}else if(t.push({agent:a.agent,dates:[a.date]}),Sd(t)>e){t.pop();break}n=n.slice(1)}return{heartbeatsToSend:t,unsentEntries:n}}class Lx{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return jf()?Ef().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const t=await Px(this.app);return t!=null&&t.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){const a=await this.read();return Id(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:a.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){var t;if(await this._canUseIndexedDBPromise){const a=await this.read();return Id(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:a.lastSentHeartbeatDate,heartbeats:[...a.heartbeats,...e.heartbeats]})}else return}}function Sd(r){return fi(JSON.stringify({version:2,heartbeats:r})).length}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Fx(r){$s(new ps("platform-logger",e=>new Zf(e),"PRIVATE")),$s(new ps("heartbeat",e=>new Ox(e),"PRIVATE")),br(Qo,jd,r),br(Qo,jd,"esm2017"),br("fire-js","")}Fx("");var Ad=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var As,Rh;(function(){var r;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(E,y){function w(){}w.prototype=y.prototype,E.D=y.prototype,E.prototype=new w,E.prototype.constructor=E,E.C=function(k,j,N){for(var f=Array(arguments.length-2),de=2;de<arguments.length;de++)f[de-2]=arguments[de];return y.prototype[j].apply(k,f)}}function t(){this.blockSize=-1}function n(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(n,t),n.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function a(E,y,w){w||(w=0);var k=Array(16);if(typeof y=="string")for(var j=0;16>j;++j)k[j]=y.charCodeAt(w++)|y.charCodeAt(w++)<<8|y.charCodeAt(w++)<<16|y.charCodeAt(w++)<<24;else for(j=0;16>j;++j)k[j]=y[w++]|y[w++]<<8|y[w++]<<16|y[w++]<<24;y=E.g[0],w=E.g[1],j=E.g[2];var N=E.g[3],f=y+(N^w&(j^N))+k[0]+3614090360&4294967295;y=w+(f<<7&4294967295|f>>>25),f=N+(j^y&(w^j))+k[1]+3905402710&4294967295,N=y+(f<<12&4294967295|f>>>20),f=j+(w^N&(y^w))+k[2]+606105819&4294967295,j=N+(f<<17&4294967295|f>>>15),f=w+(y^j&(N^y))+k[3]+3250441966&4294967295,w=j+(f<<22&4294967295|f>>>10),f=y+(N^w&(j^N))+k[4]+4118548399&4294967295,y=w+(f<<7&4294967295|f>>>25),f=N+(j^y&(w^j))+k[5]+1200080426&4294967295,N=y+(f<<12&4294967295|f>>>20),f=j+(w^N&(y^w))+k[6]+2821735955&4294967295,j=N+(f<<17&4294967295|f>>>15),f=w+(y^j&(N^y))+k[7]+4249261313&4294967295,w=j+(f<<22&4294967295|f>>>10),f=y+(N^w&(j^N))+k[8]+1770035416&4294967295,y=w+(f<<7&4294967295|f>>>25),f=N+(j^y&(w^j))+k[9]+2336552879&4294967295,N=y+(f<<12&4294967295|f>>>20),f=j+(w^N&(y^w))+k[10]+4294925233&4294967295,j=N+(f<<17&4294967295|f>>>15),f=w+(y^j&(N^y))+k[11]+2304563134&4294967295,w=j+(f<<22&4294967295|f>>>10),f=y+(N^w&(j^N))+k[12]+1804603682&4294967295,y=w+(f<<7&4294967295|f>>>25),f=N+(j^y&(w^j))+k[13]+4254626195&4294967295,N=y+(f<<12&4294967295|f>>>20),f=j+(w^N&(y^w))+k[14]+2792965006&4294967295,j=N+(f<<17&4294967295|f>>>15),f=w+(y^j&(N^y))+k[15]+1236535329&4294967295,w=j+(f<<22&4294967295|f>>>10),f=y+(j^N&(w^j))+k[1]+4129170786&4294967295,y=w+(f<<5&4294967295|f>>>27),f=N+(w^j&(y^w))+k[6]+3225465664&4294967295,N=y+(f<<9&4294967295|f>>>23),f=j+(y^w&(N^y))+k[11]+643717713&4294967295,j=N+(f<<14&4294967295|f>>>18),f=w+(N^y&(j^N))+k[0]+3921069994&4294967295,w=j+(f<<20&4294967295|f>>>12),f=y+(j^N&(w^j))+k[5]+3593408605&4294967295,y=w+(f<<5&4294967295|f>>>27),f=N+(w^j&(y^w))+k[10]+38016083&4294967295,N=y+(f<<9&4294967295|f>>>23),f=j+(y^w&(N^y))+k[15]+3634488961&4294967295,j=N+(f<<14&4294967295|f>>>18),f=w+(N^y&(j^N))+k[4]+3889429448&4294967295,w=j+(f<<20&4294967295|f>>>12),f=y+(j^N&(w^j))+k[9]+568446438&4294967295,y=w+(f<<5&4294967295|f>>>27),f=N+(w^j&(y^w))+k[14]+3275163606&4294967295,N=y+(f<<9&4294967295|f>>>23),f=j+(y^w&(N^y))+k[3]+4107603335&4294967295,j=N+(f<<14&4294967295|f>>>18),f=w+(N^y&(j^N))+k[8]+1163531501&4294967295,w=j+(f<<20&4294967295|f>>>12),f=y+(j^N&(w^j))+k[13]+2850285829&4294967295,y=w+(f<<5&4294967295|f>>>27),f=N+(w^j&(y^w))+k[2]+4243563512&4294967295,N=y+(f<<9&4294967295|f>>>23),f=j+(y^w&(N^y))+k[7]+1735328473&4294967295,j=N+(f<<14&4294967295|f>>>18),f=w+(N^y&(j^N))+k[12]+2368359562&4294967295,w=j+(f<<20&4294967295|f>>>12),f=y+(w^j^N)+k[5]+4294588738&4294967295,y=w+(f<<4&4294967295|f>>>28),f=N+(y^w^j)+k[8]+2272392833&4294967295,N=y+(f<<11&4294967295|f>>>21),f=j+(N^y^w)+k[11]+1839030562&4294967295,j=N+(f<<16&4294967295|f>>>16),f=w+(j^N^y)+k[14]+4259657740&4294967295,w=j+(f<<23&4294967295|f>>>9),f=y+(w^j^N)+k[1]+2763975236&4294967295,y=w+(f<<4&4294967295|f>>>28),f=N+(y^w^j)+k[4]+1272893353&4294967295,N=y+(f<<11&4294967295|f>>>21),f=j+(N^y^w)+k[7]+4139469664&4294967295,j=N+(f<<16&4294967295|f>>>16),f=w+(j^N^y)+k[10]+3200236656&4294967295,w=j+(f<<23&4294967295|f>>>9),f=y+(w^j^N)+k[13]+681279174&4294967295,y=w+(f<<4&4294967295|f>>>28),f=N+(y^w^j)+k[0]+3936430074&4294967295,N=y+(f<<11&4294967295|f>>>21),f=j+(N^y^w)+k[3]+3572445317&4294967295,j=N+(f<<16&4294967295|f>>>16),f=w+(j^N^y)+k[6]+76029189&4294967295,w=j+(f<<23&4294967295|f>>>9),f=y+(w^j^N)+k[9]+3654602809&4294967295,y=w+(f<<4&4294967295|f>>>28),f=N+(y^w^j)+k[12]+3873151461&4294967295,N=y+(f<<11&4294967295|f>>>21),f=j+(N^y^w)+k[15]+530742520&4294967295,j=N+(f<<16&4294967295|f>>>16),f=w+(j^N^y)+k[2]+3299628645&4294967295,w=j+(f<<23&4294967295|f>>>9),f=y+(j^(w|~N))+k[0]+4096336452&4294967295,y=w+(f<<6&4294967295|f>>>26),f=N+(w^(y|~j))+k[7]+1126891415&4294967295,N=y+(f<<10&4294967295|f>>>22),f=j+(y^(N|~w))+k[14]+2878612391&4294967295,j=N+(f<<15&4294967295|f>>>17),f=w+(N^(j|~y))+k[5]+4237533241&4294967295,w=j+(f<<21&4294967295|f>>>11),f=y+(j^(w|~N))+k[12]+1700485571&4294967295,y=w+(f<<6&4294967295|f>>>26),f=N+(w^(y|~j))+k[3]+2399980690&4294967295,N=y+(f<<10&4294967295|f>>>22),f=j+(y^(N|~w))+k[10]+4293915773&4294967295,j=N+(f<<15&4294967295|f>>>17),f=w+(N^(j|~y))+k[1]+2240044497&4294967295,w=j+(f<<21&4294967295|f>>>11),f=y+(j^(w|~N))+k[8]+1873313359&4294967295,y=w+(f<<6&4294967295|f>>>26),f=N+(w^(y|~j))+k[15]+4264355552&4294967295,N=y+(f<<10&4294967295|f>>>22),f=j+(y^(N|~w))+k[6]+2734768916&4294967295,j=N+(f<<15&4294967295|f>>>17),f=w+(N^(j|~y))+k[13]+1309151649&4294967295,w=j+(f<<21&4294967295|f>>>11),f=y+(j^(w|~N))+k[4]+4149444226&4294967295,y=w+(f<<6&4294967295|f>>>26),f=N+(w^(y|~j))+k[11]+3174756917&4294967295,N=y+(f<<10&4294967295|f>>>22),f=j+(y^(N|~w))+k[2]+718787259&4294967295,j=N+(f<<15&4294967295|f>>>17),f=w+(N^(j|~y))+k[9]+3951481745&4294967295,E.g[0]=E.g[0]+y&4294967295,E.g[1]=E.g[1]+(j+(f<<21&4294967295|f>>>11))&4294967295,E.g[2]=E.g[2]+j&4294967295,E.g[3]=E.g[3]+N&4294967295}n.prototype.u=function(E,y){y===void 0&&(y=E.length);for(var w=y-this.blockSize,k=this.B,j=this.h,N=0;N<y;){if(j==0)for(;N<=w;)a(this,E,N),N+=this.blockSize;if(typeof E=="string"){for(;N<y;)if(k[j++]=E.charCodeAt(N++),j==this.blockSize){a(this,k),j=0;break}}else for(;N<y;)if(k[j++]=E[N++],j==this.blockSize){a(this,k),j=0;break}}this.h=j,this.o+=y},n.prototype.v=function(){var E=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);E[0]=128;for(var y=1;y<E.length-8;++y)E[y]=0;var w=8*this.o;for(y=E.length-8;y<E.length;++y)E[y]=w&255,w/=256;for(this.u(E),E=Array(16),y=w=0;4>y;++y)for(var k=0;32>k;k+=8)E[w++]=this.g[y]>>>k&255;return E};function i(E,y){var w=c;return Object.prototype.hasOwnProperty.call(w,E)?w[E]:w[E]=y(E)}function o(E,y){this.h=y;for(var w=[],k=!0,j=E.length-1;0<=j;j--){var N=E[j]|0;k&&N==y||(w[j]=N,k=!1)}this.g=w}var c={};function d(E){return-128<=E&&128>E?i(E,function(y){return new o([y|0],0>y?-1:0)}):new o([E|0],0>E?-1:0)}function h(E){if(isNaN(E)||!isFinite(E))return x;if(0>E)return T(h(-E));for(var y=[],w=1,k=0;E>=w;k++)y[k]=E/w|0,w*=4294967296;return new o(y,0)}function g(E,y){if(E.length==0)throw Error("number format error: empty string");if(y=y||10,2>y||36<y)throw Error("radix out of range: "+y);if(E.charAt(0)=="-")return T(g(E.substring(1),y));if(0<=E.indexOf("-"))throw Error('number format error: interior "-" character');for(var w=h(Math.pow(y,8)),k=x,j=0;j<E.length;j+=8){var N=Math.min(8,E.length-j),f=parseInt(E.substring(j,j+N),y);8>N?(N=h(Math.pow(y,N)),k=k.j(N).add(h(f))):(k=k.j(w),k=k.add(h(f)))}return k}var x=d(0),p=d(1),v=d(16777216);r=o.prototype,r.m=function(){if(C(this))return-T(this).m();for(var E=0,y=1,w=0;w<this.g.length;w++){var k=this.i(w);E+=(0<=k?k:4294967296+k)*y,y*=4294967296}return E},r.toString=function(E){if(E=E||10,2>E||36<E)throw Error("radix out of range: "+E);if(A(this))return"0";if(C(this))return"-"+T(this).toString(E);for(var y=h(Math.pow(E,6)),w=this,k="";;){var j=I(w,y).g;w=z(w,j.j(y));var N=((0<w.g.length?w.g[0]:w.h)>>>0).toString(E);if(w=j,A(w))return N+k;for(;6>N.length;)N="0"+N;k=N+k}},r.i=function(E){return 0>E?0:E<this.g.length?this.g[E]:this.h};function A(E){if(E.h!=0)return!1;for(var y=0;y<E.g.length;y++)if(E.g[y]!=0)return!1;return!0}function C(E){return E.h==-1}r.l=function(E){return E=z(this,E),C(E)?-1:A(E)?0:1};function T(E){for(var y=E.g.length,w=[],k=0;k<y;k++)w[k]=~E.g[k];return new o(w,~E.h).add(p)}r.abs=function(){return C(this)?T(this):this},r.add=function(E){for(var y=Math.max(this.g.length,E.g.length),w=[],k=0,j=0;j<=y;j++){var N=k+(this.i(j)&65535)+(E.i(j)&65535),f=(N>>>16)+(this.i(j)>>>16)+(E.i(j)>>>16);k=f>>>16,N&=65535,f&=65535,w[j]=f<<16|N}return new o(w,w[w.length-1]&-2147483648?-1:0)};function z(E,y){return E.add(T(y))}r.j=function(E){if(A(this)||A(E))return x;if(C(this))return C(E)?T(this).j(T(E)):T(T(this).j(E));if(C(E))return T(this.j(T(E)));if(0>this.l(v)&&0>E.l(v))return h(this.m()*E.m());for(var y=this.g.length+E.g.length,w=[],k=0;k<2*y;k++)w[k]=0;for(k=0;k<this.g.length;k++)for(var j=0;j<E.g.length;j++){var N=this.i(k)>>>16,f=this.i(k)&65535,de=E.i(j)>>>16,V=E.i(j)&65535;w[2*k+2*j]+=f*V,$(w,2*k+2*j),w[2*k+2*j+1]+=N*V,$(w,2*k+2*j+1),w[2*k+2*j+1]+=f*de,$(w,2*k+2*j+1),w[2*k+2*j+2]+=N*de,$(w,2*k+2*j+2)}for(k=0;k<y;k++)w[k]=w[2*k+1]<<16|w[2*k];for(k=y;k<2*y;k++)w[k]=0;return new o(w,0)};function $(E,y){for(;(E[y]&65535)!=E[y];)E[y+1]+=E[y]>>>16,E[y]&=65535,y++}function S(E,y){this.g=E,this.h=y}function I(E,y){if(A(y))throw Error("division by zero");if(A(E))return new S(x,x);if(C(E))return y=I(T(E),y),new S(T(y.g),T(y.h));if(C(y))return y=I(E,T(y)),new S(T(y.g),y.h);if(30<E.g.length){if(C(E)||C(y))throw Error("slowDivide_ only works with positive integers.");for(var w=p,k=y;0>=k.l(E);)w=H(w),k=H(k);var j=G(w,1),N=G(k,1);for(k=G(k,2),w=G(w,2);!A(k);){var f=N.add(k);0>=f.l(E)&&(j=j.add(w),N=f),k=G(k,1),w=G(w,1)}return y=z(E,j.j(y)),new S(j,y)}for(j=x;0<=E.l(y);){for(w=Math.max(1,Math.floor(E.m()/y.m())),k=Math.ceil(Math.log(w)/Math.LN2),k=48>=k?1:Math.pow(2,k-48),N=h(w),f=N.j(y);C(f)||0<f.l(E);)w-=k,N=h(w),f=N.j(y);A(N)&&(N=p),j=j.add(N),E=z(E,f)}return new S(j,E)}r.A=function(E){return I(this,E).h},r.and=function(E){for(var y=Math.max(this.g.length,E.g.length),w=[],k=0;k<y;k++)w[k]=this.i(k)&E.i(k);return new o(w,this.h&E.h)},r.or=function(E){for(var y=Math.max(this.g.length,E.g.length),w=[],k=0;k<y;k++)w[k]=this.i(k)|E.i(k);return new o(w,this.h|E.h)},r.xor=function(E){for(var y=Math.max(this.g.length,E.g.length),w=[],k=0;k<y;k++)w[k]=this.i(k)^E.i(k);return new o(w,this.h^E.h)};function H(E){for(var y=E.g.length+1,w=[],k=0;k<y;k++)w[k]=E.i(k)<<1|E.i(k-1)>>>31;return new o(w,E.h)}function G(E,y){var w=y>>5;y%=32;for(var k=E.g.length-w,j=[],N=0;N<k;N++)j[N]=0<y?E.i(N+w)>>>y|E.i(N+w+1)<<32-y:E.i(N+w);return new o(j,E.h)}n.prototype.digest=n.prototype.v,n.prototype.reset=n.prototype.s,n.prototype.update=n.prototype.u,Rh=n,o.prototype.add=o.prototype.add,o.prototype.multiply=o.prototype.j,o.prototype.modulo=o.prototype.A,o.prototype.compare=o.prototype.l,o.prototype.toNumber=o.prototype.m,o.prototype.toString=o.prototype.toString,o.prototype.getBits=o.prototype.i,o.fromNumber=h,o.fromString=g,As=o}).apply(typeof Ad<"u"?Ad:typeof self<"u"?self:typeof window<"u"?window:{});var Ga=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var Ph,Bn,Mh,ni,Zo,$h,Oh,Vh;(function(){var r,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(l,u,m){return l==Array.prototype||l==Object.prototype||(l[u]=m.value),l};function t(l){l=[typeof globalThis=="object"&&globalThis,l,typeof window=="object"&&window,typeof self=="object"&&self,typeof Ga=="object"&&Ga];for(var u=0;u<l.length;++u){var m=l[u];if(m&&m.Math==Math)return m}throw Error("Cannot find global object")}var n=t(this);function a(l,u){if(u)e:{var m=n;l=l.split(".");for(var b=0;b<l.length-1;b++){var U=l[b];if(!(U in m))break e;m=m[U]}l=l[l.length-1],b=m[l],u=u(b),u!=b&&u!=null&&e(m,l,{configurable:!0,writable:!0,value:u})}}function i(l,u){l instanceof String&&(l+="");var m=0,b=!1,U={next:function(){if(!b&&m<l.length){var K=m++;return{value:u(K,l[K]),done:!1}}return b=!0,{done:!0,value:void 0}}};return U[Symbol.iterator]=function(){return U},U}a("Array.prototype.values",function(l){return l||function(){return i(this,function(u,m){return m})}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var o=o||{},c=this||self;function d(l){var u=typeof l;return u=u!="object"?u:l?Array.isArray(l)?"array":u:"null",u=="array"||u=="object"&&typeof l.length=="number"}function h(l){var u=typeof l;return u=="object"&&l!=null||u=="function"}function g(l,u,m){return l.call.apply(l.bind,arguments)}function x(l,u,m){if(!l)throw Error();if(2<arguments.length){var b=Array.prototype.slice.call(arguments,2);return function(){var U=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(U,b),l.apply(u,U)}}return function(){return l.apply(u,arguments)}}function p(l,u,m){return p=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?g:x,p.apply(null,arguments)}function v(l,u){var m=Array.prototype.slice.call(arguments,1);return function(){var b=m.slice();return b.push.apply(b,arguments),l.apply(this,b)}}function A(l,u){function m(){}m.prototype=u.prototype,l.aa=u.prototype,l.prototype=new m,l.prototype.constructor=l,l.Qb=function(b,U,K){for(var ve=Array(arguments.length-2),lt=2;lt<arguments.length;lt++)ve[lt-2]=arguments[lt];return u.prototype[U].apply(b,ve)}}function C(l){const u=l.length;if(0<u){const m=Array(u);for(let b=0;b<u;b++)m[b]=l[b];return m}return[]}function T(l,u){for(let m=1;m<arguments.length;m++){const b=arguments[m];if(d(b)){const U=l.length||0,K=b.length||0;l.length=U+K;for(let ve=0;ve<K;ve++)l[U+ve]=b[ve]}else l.push(b)}}class z{constructor(u,m){this.i=u,this.j=m,this.h=0,this.g=null}get(){let u;return 0<this.h?(this.h--,u=this.g,this.g=u.next,u.next=null):u=this.i(),u}}function $(l){return/^[\s\xa0]*$/.test(l)}function S(){var l=c.navigator;return l&&(l=l.userAgent)?l:""}function I(l){return I[" "](l),l}I[" "]=function(){};var H=S().indexOf("Gecko")!=-1&&!(S().toLowerCase().indexOf("webkit")!=-1&&S().indexOf("Edge")==-1)&&!(S().indexOf("Trident")!=-1||S().indexOf("MSIE")!=-1)&&S().indexOf("Edge")==-1;function G(l,u,m){for(const b in l)u.call(m,l[b],b,l)}function E(l,u){for(const m in l)u.call(void 0,l[m],m,l)}function y(l){const u={};for(const m in l)u[m]=l[m];return u}const w="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function k(l,u){let m,b;for(let U=1;U<arguments.length;U++){b=arguments[U];for(m in b)l[m]=b[m];for(let K=0;K<w.length;K++)m=w[K],Object.prototype.hasOwnProperty.call(b,m)&&(l[m]=b[m])}}function j(l){var u=1;l=l.split(":");const m=[];for(;0<u&&l.length;)m.push(l.shift()),u--;return l.length&&m.push(l.join(":")),m}function N(l){c.setTimeout(()=>{throw l},0)}function f(){var l=Z;let u=null;return l.g&&(u=l.g,l.g=l.g.next,l.g||(l.h=null),u.next=null),u}class de{constructor(){this.h=this.g=null}add(u,m){const b=V.get();b.set(u,m),this.h?this.h.next=b:this.g=b,this.h=b}}var V=new z(()=>new X,l=>l.reset());class X{constructor(){this.next=this.g=this.h=null}set(u,m){this.h=u,this.g=m,this.next=null}reset(){this.next=this.g=this.h=null}}let R,te=!1,Z=new de,oe=()=>{const l=c.Promise.resolve(void 0);R=()=>{l.then(F)}};var F=()=>{for(var l;l=f();){try{l.h.call(l.g)}catch(m){N(m)}var u=V;u.j(l),100>u.h&&(u.h++,l.next=u.g,u.g=l)}te=!1};function L(){this.s=this.s,this.C=this.C}L.prototype.s=!1,L.prototype.ma=function(){this.s||(this.s=!0,this.N())},L.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function M(l,u){this.type=l,this.g=this.target=u,this.defaultPrevented=!1}M.prototype.h=function(){this.defaultPrevented=!0};var re=function(){if(!c.addEventListener||!Object.defineProperty)return!1;var l=!1,u=Object.defineProperty({},"passive",{get:function(){l=!0}});try{const m=()=>{};c.addEventListener("test",m,u),c.removeEventListener("test",m,u)}catch{}return l}();function me(l,u){if(M.call(this,l?l.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,l){var m=this.type=l.type,b=l.changedTouches&&l.changedTouches.length?l.changedTouches[0]:null;if(this.target=l.target||l.srcElement,this.g=u,u=l.relatedTarget){if(H){e:{try{I(u.nodeName);var U=!0;break e}catch{}U=!1}U||(u=null)}}else m=="mouseover"?u=l.fromElement:m=="mouseout"&&(u=l.toElement);this.relatedTarget=u,b?(this.clientX=b.clientX!==void 0?b.clientX:b.pageX,this.clientY=b.clientY!==void 0?b.clientY:b.pageY,this.screenX=b.screenX||0,this.screenY=b.screenY||0):(this.clientX=l.clientX!==void 0?l.clientX:l.pageX,this.clientY=l.clientY!==void 0?l.clientY:l.pageY,this.screenX=l.screenX||0,this.screenY=l.screenY||0),this.button=l.button,this.key=l.key||"",this.ctrlKey=l.ctrlKey,this.altKey=l.altKey,this.shiftKey=l.shiftKey,this.metaKey=l.metaKey,this.pointerId=l.pointerId||0,this.pointerType=typeof l.pointerType=="string"?l.pointerType:W[l.pointerType]||"",this.state=l.state,this.i=l,l.defaultPrevented&&me.aa.h.call(this)}}A(me,M);var W={2:"touch",3:"pen",4:"mouse"};me.prototype.h=function(){me.aa.h.call(this);var l=this.i;l.preventDefault?l.preventDefault():l.returnValue=!1};var ie="closure_listenable_"+(1e6*Math.random()|0),Q=0;function B(l,u,m,b,U){this.listener=l,this.proxy=null,this.src=u,this.type=m,this.capture=!!b,this.ha=U,this.key=++Q,this.da=this.fa=!1}function ue(l){l.da=!0,l.listener=null,l.proxy=null,l.src=null,l.ha=null}function O(l){this.src=l,this.g={},this.h=0}O.prototype.add=function(l,u,m,b,U){var K=l.toString();l=this.g[K],l||(l=this.g[K]=[],this.h++);var ve=Ee(l,u,b,U);return-1<ve?(u=l[ve],m||(u.fa=!1)):(u=new B(u,this.src,K,!!b,U),u.fa=m,l.push(u)),u};function ge(l,u){var m=u.type;if(m in l.g){var b=l.g[m],U=Array.prototype.indexOf.call(b,u,void 0),K;(K=0<=U)&&Array.prototype.splice.call(b,U,1),K&&(ue(u),l.g[m].length==0&&(delete l.g[m],l.h--))}}function Ee(l,u,m,b){for(var U=0;U<l.length;++U){var K=l[U];if(!K.da&&K.listener==u&&K.capture==!!m&&K.ha==b)return U}return-1}var Y="closure_lm_"+(1e6*Math.random()|0),fe={};function pe(l,u,m,b,U){if(Array.isArray(u)){for(var K=0;K<u.length;K++)pe(l,u[K],m,b,U);return null}return m=Ue(m),l&&l[ie]?l.K(u,m,h(b)?!!b.capture:!1,U):Ae(l,u,m,!1,b,U)}function Ae(l,u,m,b,U,K){if(!u)throw Error("Invalid event type");var ve=h(U)?!!U.capture:!!U,lt=ee(l);if(lt||(l[Y]=lt=new O(l)),m=lt.add(u,m,b,ve,K),m.proxy)return m;if(b=qe(),m.proxy=b,b.src=l,b.listener=m,l.addEventListener)re||(U=ve),U===void 0&&(U=!1),l.addEventListener(u.toString(),b,U);else if(l.attachEvent)l.attachEvent(ae(u.toString()),b);else if(l.addListener&&l.removeListener)l.addListener(b);else throw Error("addEventListener and attachEvent are unavailable.");return m}function qe(){function l(m){return u.call(l.src,l.listener,m)}const u=De;return l}function Je(l,u,m,b,U){if(Array.isArray(u))for(var K=0;K<u.length;K++)Je(l,u[K],m,b,U);else b=h(b)?!!b.capture:!!b,m=Ue(m),l&&l[ie]?(l=l.i,u=String(u).toString(),u in l.g&&(K=l.g[u],m=Ee(K,m,b,U),-1<m&&(ue(K[m]),Array.prototype.splice.call(K,m,1),K.length==0&&(delete l.g[u],l.h--)))):l&&(l=ee(l))&&(u=l.g[u.toString()],l=-1,u&&(l=Ee(u,m,b,U)),(m=-1<l?u[l]:null)&&q(m))}function q(l){if(typeof l!="number"&&l&&!l.da){var u=l.src;if(u&&u[ie])ge(u.i,l);else{var m=l.type,b=l.proxy;u.removeEventListener?u.removeEventListener(m,b,l.capture):u.detachEvent?u.detachEvent(ae(m),b):u.addListener&&u.removeListener&&u.removeListener(b),(m=ee(u))?(ge(m,l),m.h==0&&(m.src=null,u[Y]=null)):ue(l)}}}function ae(l){return l in fe?fe[l]:fe[l]="on"+l}function De(l,u){if(l.da)l=!0;else{u=new me(u,this);var m=l.listener,b=l.ha||l.src;l.fa&&q(l),l=m.call(b,u)}return l}function ee(l){return l=l[Y],l instanceof O?l:null}var Me="__closure_events_fn_"+(1e9*Math.random()>>>0);function Ue(l){return typeof l=="function"?l:(l[Me]||(l[Me]=function(u){return l.handleEvent(u)}),l[Me])}function P(){L.call(this),this.i=new O(this),this.M=this,this.F=null}A(P,L),P.prototype[ie]=!0,P.prototype.removeEventListener=function(l,u,m,b){Je(this,l,u,m,b)};function _(l,u){var m,b=l.F;if(b)for(m=[];b;b=b.F)m.push(b);if(l=l.M,b=u.type||u,typeof u=="string")u=new M(u,l);else if(u instanceof M)u.target=u.target||l;else{var U=u;u=new M(b,l),k(u,U)}if(U=!0,m)for(var K=m.length-1;0<=K;K--){var ve=u.g=m[K];U=be(ve,b,!0,u)&&U}if(ve=u.g=l,U=be(ve,b,!0,u)&&U,U=be(ve,b,!1,u)&&U,m)for(K=0;K<m.length;K++)ve=u.g=m[K],U=be(ve,b,!1,u)&&U}P.prototype.N=function(){if(P.aa.N.call(this),this.i){var l=this.i,u;for(u in l.g){for(var m=l.g[u],b=0;b<m.length;b++)ue(m[b]);delete l.g[u],l.h--}}this.F=null},P.prototype.K=function(l,u,m,b){return this.i.add(String(l),u,!1,m,b)},P.prototype.L=function(l,u,m,b){return this.i.add(String(l),u,!0,m,b)};function be(l,u,m,b){if(u=l.i.g[String(u)],!u)return!0;u=u.concat();for(var U=!0,K=0;K<u.length;++K){var ve=u[K];if(ve&&!ve.da&&ve.capture==m){var lt=ve.listener,Ct=ve.ha||ve.src;ve.fa&&ge(l.i,ve),U=lt.call(Ct,b)!==!1&&U}}return U&&!b.defaultPrevented}function Ne(l,u,m){if(typeof l=="function")m&&(l=p(l,m));else if(l&&typeof l.handleEvent=="function")l=p(l.handleEvent,l);else throw Error("Invalid listener argument");return 2147483647<Number(u)?-1:c.setTimeout(l,u||0)}function Ie(l){l.g=Ne(()=>{l.g=null,l.i&&(l.i=!1,Ie(l))},l.l);const u=l.h;l.h=null,l.m.apply(null,u)}class ne extends L{constructor(u,m){super(),this.m=u,this.l=m,this.h=null,this.i=!1,this.g=null}j(u){this.h=arguments,this.g?this.i=!0:Ie(this)}N(){super.N(),this.g&&(c.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function we(l){L.call(this),this.h=l,this.g={}}A(we,L);var ke=[];function $e(l){G(l.g,function(u,m){this.g.hasOwnProperty(m)&&q(u)},l),l.g={}}we.prototype.N=function(){we.aa.N.call(this),$e(this)},we.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var rt=c.JSON.stringify,gt=c.JSON.parse,_t=class{stringify(l){return c.JSON.stringify(l,void 0)}parse(l){return c.JSON.parse(l,void 0)}};function Ce(){}Ce.prototype.h=null;function at(l){return l.h||(l.h=l.i())}function ye(){}var _e={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function Qe(){M.call(this,"d")}A(Qe,M);function Qr(){M.call(this,"c")}A(Qr,M);var Ht={},J=null;function xe(){return J=J||new P}Ht.La="serverreachability";function Re(l){M.call(this,Ht.La,l)}A(Re,M);function Be(l){const u=xe();_(u,new Re(u))}Ht.STAT_EVENT="statevent";function Ge(l,u){M.call(this,Ht.STAT_EVENT,l),this.stat=u}A(Ge,M);function ze(l){const u=xe();_(u,new Ge(u,l))}Ht.Ma="timingevent";function Zt(l,u){M.call(this,Ht.Ma,l),this.size=u}A(Zt,M);function Ze(l,u){if(typeof l!="function")throw Error("Fn must not be null and must be a function");return c.setTimeout(function(){l()},u)}function ot(){this.g=!0}ot.prototype.xa=function(){this.g=!1};function At(l,u,m,b,U,K){l.info(function(){if(l.g)if(K)for(var ve="",lt=K.split("&"),Ct=0;Ct<lt.length;Ct++){var et=lt[Ct].split("=");if(1<et.length){var Ot=et[0];et=et[1];var Vt=Ot.split("_");ve=2<=Vt.length&&Vt[1]=="type"?ve+(Ot+"="+et+"&"):ve+(Ot+"=redacted&")}}else ve=null;else ve=K;return"XMLHTTP REQ ("+b+") [attempt "+U+"]: "+u+`
`+m+`
`+ve})}function sr(l,u,m,b,U,K,ve){l.info(function(){return"XMLHTTP RESP ("+b+") [ attempt "+U+"]: "+u+`
`+m+`
`+K+" "+ve})}function ut(l,u,m,b){l.info(function(){return"XMLHTTP TEXT ("+u+"): "+dr(l,m)+(b?" "+b:"")})}function Xe(l,u){l.info(function(){return"TIMEOUT: "+u})}ot.prototype.info=function(){};function dr(l,u){if(!l.g)return u;if(!u)return null;try{var m=JSON.parse(u);if(m){for(l=0;l<m.length;l++)if(Array.isArray(m[l])){var b=m[l];if(!(2>b.length)){var U=b[1];if(Array.isArray(U)&&!(1>U.length)){var K=U[0];if(K!="noop"&&K!="stop"&&K!="close")for(var ve=1;ve<U.length;ve++)U[ve]=""}}}}return rt(m)}catch{return u}}var nr={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},Xr={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},go;function Da(){}A(Da,Ce),Da.prototype.g=function(){return new XMLHttpRequest},Da.prototype.i=function(){return{}},go=new Da;function Jr(l,u,m,b){this.j=l,this.i=u,this.l=m,this.R=b||1,this.U=new we(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new Nc}function Nc(){this.i=null,this.g="",this.h=!1}var jc={},po={};function fo(l,u,m){l.L=1,l.v=$a(Sr(u)),l.m=m,l.P=!0,Ec(l,null)}function Ec(l,u){l.F=Date.now(),Ra(l),l.A=Sr(l.v);var m=l.A,b=l.R;Array.isArray(b)||(b=[String(b)]),Fc(m.i,"t",b),l.C=0,m=l.j.J,l.h=new Nc,l.g=nd(l.j,m?u:null,!l.m),0<l.O&&(l.M=new ne(p(l.Y,l,l.g),l.O)),u=l.U,m=l.g,b=l.ca;var U="readystatechange";Array.isArray(U)||(U&&(ke[0]=U.toString()),U=ke);for(var K=0;K<U.length;K++){var ve=pe(m,U[K],b||u.handleEvent,!1,u.h||u);if(!ve)break;u.g[ve.key]=ve}u=l.H?y(l.H):{},l.m?(l.u||(l.u="POST"),u["Content-Type"]="application/x-www-form-urlencoded",l.g.ea(l.A,l.u,l.m,u)):(l.u="GET",l.g.ea(l.A,l.u,null,u)),Be(),At(l.i,l.u,l.A,l.l,l.R,l.m)}Jr.prototype.ca=function(l){l=l.target;const u=this.M;u&&Ar(l)==3?u.j():this.Y(l)},Jr.prototype.Y=function(l){try{if(l==this.g)e:{const Vt=Ar(this.g);var u=this.g.Ba();const Gs=this.g.Z();if(!(3>Vt)&&(Vt!=3||this.g&&(this.h.h||this.g.oa()||Gc(this.g)))){this.J||Vt!=4||u==7||(u==8||0>=Gs?Be(3):Be(2)),xo(this);var m=this.g.Z();this.X=m;t:if(Ic(this)){var b=Gc(this.g);l="";var U=b.length,K=Ar(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){ks(this),Tn(this);var ve="";break t}this.h.i=new c.TextDecoder}for(u=0;u<U;u++)this.h.h=!0,l+=this.h.i.decode(b[u],{stream:!(K&&u==U-1)});b.length=0,this.h.g+=l,this.C=0,ve=this.h.g}else ve=this.g.oa();if(this.o=m==200,sr(this.i,this.u,this.A,this.l,this.R,Vt,m),this.o){if(this.T&&!this.K){t:{if(this.g){var lt,Ct=this.g;if((lt=Ct.g?Ct.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!$(lt)){var et=lt;break t}}et=null}if(m=et)ut(this.i,this.l,m,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,yo(this,m);else{this.o=!1,this.s=3,ze(12),ks(this),Tn(this);break e}}if(this.P){m=!0;let ur;for(;!this.J&&this.C<ve.length;)if(ur=u0(this,ve),ur==po){Vt==4&&(this.s=4,ze(14),m=!1),ut(this.i,this.l,null,"[Incomplete Response]");break}else if(ur==jc){this.s=4,ze(15),ut(this.i,this.l,ve,"[Invalid Chunk]"),m=!1;break}else ut(this.i,this.l,ur,null),yo(this,ur);if(Ic(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),Vt!=4||ve.length!=0||this.h.h||(this.s=1,ze(16),m=!1),this.o=this.o&&m,!m)ut(this.i,this.l,ve,"[Invalid Chunked Response]"),ks(this),Tn(this);else if(0<ve.length&&!this.W){this.W=!0;var Ot=this.j;Ot.g==this&&Ot.ba&&!Ot.M&&(Ot.j.info("Great, no buffering proxy detected. Bytes received: "+ve.length),No(Ot),Ot.M=!0,ze(11))}}else ut(this.i,this.l,ve,null),yo(this,ve);Vt==4&&ks(this),this.o&&!this.J&&(Vt==4?ed(this.j,this):(this.o=!1,Ra(this)))}else T0(this.g),m==400&&0<ve.indexOf("Unknown SID")?(this.s=3,ze(12)):(this.s=0,ze(13)),ks(this),Tn(this)}}}catch{}finally{}};function Ic(l){return l.g?l.u=="GET"&&l.L!=2&&l.j.Ca:!1}function u0(l,u){var m=l.C,b=u.indexOf(`
`,m);return b==-1?po:(m=Number(u.substring(m,b)),isNaN(m)?jc:(b+=1,b+m>u.length?po:(u=u.slice(b,b+m),l.C=b+m,u)))}Jr.prototype.cancel=function(){this.J=!0,ks(this)};function Ra(l){l.S=Date.now()+l.I,Tc(l,l.I)}function Tc(l,u){if(l.B!=null)throw Error("WatchDog timer not null");l.B=Ze(p(l.ba,l),u)}function xo(l){l.B&&(c.clearTimeout(l.B),l.B=null)}Jr.prototype.ba=function(){this.B=null;const l=Date.now();0<=l-this.S?(Xe(this.i,this.A),this.L!=2&&(Be(),ze(17)),ks(this),this.s=2,Tn(this)):Tc(this,this.S-l)};function Tn(l){l.j.G==0||l.J||ed(l.j,l)}function ks(l){xo(l);var u=l.M;u&&typeof u.ma=="function"&&u.ma(),l.M=null,$e(l.U),l.g&&(u=l.g,l.g=null,u.abort(),u.ma())}function yo(l,u){try{var m=l.j;if(m.G!=0&&(m.g==l||bo(m.h,l))){if(!l.K&&bo(m.h,l)&&m.G==3){try{var b=m.Da.g.parse(u)}catch{b=null}if(Array.isArray(b)&&b.length==3){var U=b;if(U[0]==0){e:if(!m.u){if(m.g)if(m.g.F+3e3<l.F)Ba(m),Fa(m);else break e;_o(m),ze(18)}}else m.za=U[1],0<m.za-m.T&&37500>U[2]&&m.F&&m.v==0&&!m.C&&(m.C=Ze(p(m.Za,m),6e3));if(1>=Cc(m.h)&&m.ca){try{m.ca()}catch{}m.ca=void 0}}else Ns(m,11)}else if((l.K||m.g==l)&&Ba(m),!$(u))for(U=m.Da.g.parse(u),u=0;u<U.length;u++){let et=U[u];if(m.T=et[0],et=et[1],m.G==2)if(et[0]=="c"){m.K=et[1],m.ia=et[2];const Ot=et[3];Ot!=null&&(m.la=Ot,m.j.info("VER="+m.la));const Vt=et[4];Vt!=null&&(m.Aa=Vt,m.j.info("SVER="+m.Aa));const Gs=et[5];Gs!=null&&typeof Gs=="number"&&0<Gs&&(b=1.5*Gs,m.L=b,m.j.info("backChannelRequestTimeoutMs_="+b)),b=m;const ur=l.g;if(ur){const qa=ur.g?ur.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(qa){var K=b.h;K.g||qa.indexOf("spdy")==-1&&qa.indexOf("quic")==-1&&qa.indexOf("h2")==-1||(K.j=K.l,K.g=new Set,K.h&&(vo(K,K.h),K.h=null))}if(b.D){const jo=ur.g?ur.g.getResponseHeader("X-HTTP-Session-Id"):null;jo&&(b.ya=jo,ct(b.I,b.D,jo))}}m.G=3,m.l&&m.l.ua(),m.ba&&(m.R=Date.now()-l.F,m.j.info("Handshake RTT: "+m.R+"ms")),b=m;var ve=l;if(b.qa=sd(b,b.J?b.ia:null,b.W),ve.K){Dc(b.h,ve);var lt=ve,Ct=b.L;Ct&&(lt.I=Ct),lt.B&&(xo(lt),Ra(lt)),b.g=ve}else Jc(b);0<m.i.length&&Ua(m)}else et[0]!="stop"&&et[0]!="close"||Ns(m,7);else m.G==3&&(et[0]=="stop"||et[0]=="close"?et[0]=="stop"?Ns(m,7):ko(m):et[0]!="noop"&&m.l&&m.l.ta(et),m.v=0)}}Be(4)}catch{}}var h0=class{constructor(l,u){this.g=l,this.map=u}};function Sc(l){this.l=l||10,c.PerformanceNavigationTiming?(l=c.performance.getEntriesByType("navigation"),l=0<l.length&&(l[0].nextHopProtocol=="hq"||l[0].nextHopProtocol=="h2")):l=!!(c.chrome&&c.chrome.loadTimes&&c.chrome.loadTimes()&&c.chrome.loadTimes().wasFetchedViaSpdy),this.j=l?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function Ac(l){return l.h?!0:l.g?l.g.size>=l.j:!1}function Cc(l){return l.h?1:l.g?l.g.size:0}function bo(l,u){return l.h?l.h==u:l.g?l.g.has(u):!1}function vo(l,u){l.g?l.g.add(u):l.h=u}function Dc(l,u){l.h&&l.h==u?l.h=null:l.g&&l.g.has(u)&&l.g.delete(u)}Sc.prototype.cancel=function(){if(this.i=Rc(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const l of this.g.values())l.cancel();this.g.clear()}};function Rc(l){if(l.h!=null)return l.i.concat(l.h.D);if(l.g!=null&&l.g.size!==0){let u=l.i;for(const m of l.g.values())u=u.concat(m.D);return u}return C(l.i)}function m0(l){if(l.V&&typeof l.V=="function")return l.V();if(typeof Map<"u"&&l instanceof Map||typeof Set<"u"&&l instanceof Set)return Array.from(l.values());if(typeof l=="string")return l.split("");if(d(l)){for(var u=[],m=l.length,b=0;b<m;b++)u.push(l[b]);return u}u=[],m=0;for(b in l)u[m++]=l[b];return u}function g0(l){if(l.na&&typeof l.na=="function")return l.na();if(!l.V||typeof l.V!="function"){if(typeof Map<"u"&&l instanceof Map)return Array.from(l.keys());if(!(typeof Set<"u"&&l instanceof Set)){if(d(l)||typeof l=="string"){var u=[];l=l.length;for(var m=0;m<l;m++)u.push(m);return u}u=[],m=0;for(const b in l)u[m++]=b;return u}}}function Pc(l,u){if(l.forEach&&typeof l.forEach=="function")l.forEach(u,void 0);else if(d(l)||typeof l=="string")Array.prototype.forEach.call(l,u,void 0);else for(var m=g0(l),b=m0(l),U=b.length,K=0;K<U;K++)u.call(void 0,b[K],m&&m[K],l)}var Mc=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function p0(l,u){if(l){l=l.split("&");for(var m=0;m<l.length;m++){var b=l[m].indexOf("="),U=null;if(0<=b){var K=l[m].substring(0,b);U=l[m].substring(b+1)}else K=l[m];u(K,U?decodeURIComponent(U.replace(/\+/g," ")):"")}}}function _s(l){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,l instanceof _s){this.h=l.h,Pa(this,l.j),this.o=l.o,this.g=l.g,Ma(this,l.s),this.l=l.l;var u=l.i,m=new Cn;m.i=u.i,u.g&&(m.g=new Map(u.g),m.h=u.h),$c(this,m),this.m=l.m}else l&&(u=String(l).match(Mc))?(this.h=!1,Pa(this,u[1]||"",!0),this.o=Sn(u[2]||""),this.g=Sn(u[3]||"",!0),Ma(this,u[4]),this.l=Sn(u[5]||"",!0),$c(this,u[6]||"",!0),this.m=Sn(u[7]||"")):(this.h=!1,this.i=new Cn(null,this.h))}_s.prototype.toString=function(){var l=[],u=this.j;u&&l.push(An(u,Oc,!0),":");var m=this.g;return(m||u=="file")&&(l.push("//"),(u=this.o)&&l.push(An(u,Oc,!0),"@"),l.push(encodeURIComponent(String(m)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),m=this.s,m!=null&&l.push(":",String(m))),(m=this.l)&&(this.g&&m.charAt(0)!="/"&&l.push("/"),l.push(An(m,m.charAt(0)=="/"?y0:x0,!0))),(m=this.i.toString())&&l.push("?",m),(m=this.m)&&l.push("#",An(m,v0)),l.join("")};function Sr(l){return new _s(l)}function Pa(l,u,m){l.j=m?Sn(u,!0):u,l.j&&(l.j=l.j.replace(/:$/,""))}function Ma(l,u){if(u){if(u=Number(u),isNaN(u)||0>u)throw Error("Bad port number "+u);l.s=u}else l.s=null}function $c(l,u,m){u instanceof Cn?(l.i=u,w0(l.i,l.h)):(m||(u=An(u,b0)),l.i=new Cn(u,l.h))}function ct(l,u,m){l.i.set(u,m)}function $a(l){return ct(l,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),l}function Sn(l,u){return l?u?decodeURI(l.replace(/%25/g,"%2525")):decodeURIComponent(l):""}function An(l,u,m){return typeof l=="string"?(l=encodeURI(l).replace(u,f0),m&&(l=l.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),l):null}function f0(l){return l=l.charCodeAt(0),"%"+(l>>4&15).toString(16)+(l&15).toString(16)}var Oc=/[#\/\?@]/g,x0=/[#\?:]/g,y0=/[#\?]/g,b0=/[#\?@]/g,v0=/#/g;function Cn(l,u){this.h=this.g=null,this.i=l||null,this.j=!!u}function Zr(l){l.g||(l.g=new Map,l.h=0,l.i&&p0(l.i,function(u,m){l.add(decodeURIComponent(u.replace(/\+/g," ")),m)}))}r=Cn.prototype,r.add=function(l,u){Zr(this),this.i=null,l=zs(this,l);var m=this.g.get(l);return m||this.g.set(l,m=[]),m.push(u),this.h+=1,this};function Vc(l,u){Zr(l),u=zs(l,u),l.g.has(u)&&(l.i=null,l.h-=l.g.get(u).length,l.g.delete(u))}function Lc(l,u){return Zr(l),u=zs(l,u),l.g.has(u)}r.forEach=function(l,u){Zr(this),this.g.forEach(function(m,b){m.forEach(function(U){l.call(u,U,b,this)},this)},this)},r.na=function(){Zr(this);const l=Array.from(this.g.values()),u=Array.from(this.g.keys()),m=[];for(let b=0;b<u.length;b++){const U=l[b];for(let K=0;K<U.length;K++)m.push(u[b])}return m},r.V=function(l){Zr(this);let u=[];if(typeof l=="string")Lc(this,l)&&(u=u.concat(this.g.get(zs(this,l))));else{l=Array.from(this.g.values());for(let m=0;m<l.length;m++)u=u.concat(l[m])}return u},r.set=function(l,u){return Zr(this),this.i=null,l=zs(this,l),Lc(this,l)&&(this.h-=this.g.get(l).length),this.g.set(l,[u]),this.h+=1,this},r.get=function(l,u){return l?(l=this.V(l),0<l.length?String(l[0]):u):u};function Fc(l,u,m){Vc(l,u),0<m.length&&(l.i=null,l.g.set(zs(l,u),C(m)),l.h+=m.length)}r.toString=function(){if(this.i)return this.i;if(!this.g)return"";const l=[],u=Array.from(this.g.keys());for(var m=0;m<u.length;m++){var b=u[m];const K=encodeURIComponent(String(b)),ve=this.V(b);for(b=0;b<ve.length;b++){var U=K;ve[b]!==""&&(U+="="+encodeURIComponent(String(ve[b]))),l.push(U)}}return this.i=l.join("&")};function zs(l,u){return u=String(u),l.j&&(u=u.toLowerCase()),u}function w0(l,u){u&&!l.j&&(Zr(l),l.i=null,l.g.forEach(function(m,b){var U=b.toLowerCase();b!=U&&(Vc(this,b),Fc(this,U,m))},l)),l.j=u}function k0(l,u){const m=new ot;if(c.Image){const b=new Image;b.onload=v(es,m,"TestLoadImage: loaded",!0,u,b),b.onerror=v(es,m,"TestLoadImage: error",!1,u,b),b.onabort=v(es,m,"TestLoadImage: abort",!1,u,b),b.ontimeout=v(es,m,"TestLoadImage: timeout",!1,u,b),c.setTimeout(function(){b.ontimeout&&b.ontimeout()},1e4),b.src=l}else u(!1)}function _0(l,u){const m=new ot,b=new AbortController,U=setTimeout(()=>{b.abort(),es(m,"TestPingServer: timeout",!1,u)},1e4);fetch(l,{signal:b.signal}).then(K=>{clearTimeout(U),K.ok?es(m,"TestPingServer: ok",!0,u):es(m,"TestPingServer: server error",!1,u)}).catch(()=>{clearTimeout(U),es(m,"TestPingServer: error",!1,u)})}function es(l,u,m,b,U){try{U&&(U.onload=null,U.onerror=null,U.onabort=null,U.ontimeout=null),b(m)}catch{}}function N0(){this.g=new _t}function j0(l,u,m){const b=m||"";try{Pc(l,function(U,K){let ve=U;h(U)&&(ve=rt(U)),u.push(b+K+"="+encodeURIComponent(ve))})}catch(U){throw u.push(b+"type="+encodeURIComponent("_badmap")),U}}function Oa(l){this.l=l.Ub||null,this.j=l.eb||!1}A(Oa,Ce),Oa.prototype.g=function(){return new Va(this.l,this.j)},Oa.prototype.i=function(l){return function(){return l}}({});function Va(l,u){P.call(this),this.D=l,this.o=u,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}A(Va,P),r=Va.prototype,r.open=function(l,u){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=l,this.A=u,this.readyState=1,Rn(this)},r.send=function(l){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const u={headers:this.u,method:this.B,credentials:this.m,cache:void 0};l&&(u.body=l),(this.D||c).fetch(new Request(this.A,u)).then(this.Sa.bind(this),this.ga.bind(this))},r.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,Dn(this)),this.readyState=0},r.Sa=function(l){if(this.g&&(this.l=l,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=l.headers,this.readyState=2,Rn(this)),this.g&&(this.readyState=3,Rn(this),this.g)))if(this.responseType==="arraybuffer")l.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof c.ReadableStream<"u"&&"body"in l){if(this.j=l.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;Uc(this)}else l.text().then(this.Ra.bind(this),this.ga.bind(this))};function Uc(l){l.j.read().then(l.Pa.bind(l)).catch(l.ga.bind(l))}r.Pa=function(l){if(this.g){if(this.o&&l.value)this.response.push(l.value);else if(!this.o){var u=l.value?l.value:new Uint8Array(0);(u=this.v.decode(u,{stream:!l.done}))&&(this.response=this.responseText+=u)}l.done?Dn(this):Rn(this),this.readyState==3&&Uc(this)}},r.Ra=function(l){this.g&&(this.response=this.responseText=l,Dn(this))},r.Qa=function(l){this.g&&(this.response=l,Dn(this))},r.ga=function(){this.g&&Dn(this)};function Dn(l){l.readyState=4,l.l=null,l.j=null,l.v=null,Rn(l)}r.setRequestHeader=function(l,u){this.u.append(l,u)},r.getResponseHeader=function(l){return this.h&&this.h.get(l.toLowerCase())||""},r.getAllResponseHeaders=function(){if(!this.h)return"";const l=[],u=this.h.entries();for(var m=u.next();!m.done;)m=m.value,l.push(m[0]+": "+m[1]),m=u.next();return l.join(`\r
`)};function Rn(l){l.onreadystatechange&&l.onreadystatechange.call(l)}Object.defineProperty(Va.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(l){this.m=l?"include":"same-origin"}});function Bc(l){let u="";return G(l,function(m,b){u+=b,u+=":",u+=m,u+=`\r
`}),u}function wo(l,u,m){e:{for(b in m){var b=!1;break e}b=!0}b||(m=Bc(m),typeof l=="string"?m!=null&&encodeURIComponent(String(m)):ct(l,u,m))}function pt(l){P.call(this),this.headers=new Map,this.o=l||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}A(pt,P);var E0=/^https?$/i,I0=["POST","PUT"];r=pt.prototype,r.Ha=function(l){this.J=l},r.ea=function(l,u,m,b){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+l);u=u?u.toUpperCase():"GET",this.D=l,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():go.g(),this.v=this.o?at(this.o):at(go),this.g.onreadystatechange=p(this.Ea,this);try{this.B=!0,this.g.open(u,String(l),!0),this.B=!1}catch(K){Wc(this,K);return}if(l=m||"",m=new Map(this.headers),b)if(Object.getPrototypeOf(b)===Object.prototype)for(var U in b)m.set(U,b[U]);else if(typeof b.keys=="function"&&typeof b.get=="function")for(const K of b.keys())m.set(K,b.get(K));else throw Error("Unknown input type for opt_headers: "+String(b));b=Array.from(m.keys()).find(K=>K.toLowerCase()=="content-type"),U=c.FormData&&l instanceof c.FormData,!(0<=Array.prototype.indexOf.call(I0,u,void 0))||b||U||m.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[K,ve]of m)this.g.setRequestHeader(K,ve);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{Hc(this),this.u=!0,this.g.send(l),this.u=!1}catch(K){Wc(this,K)}};function Wc(l,u){l.h=!1,l.g&&(l.j=!0,l.g.abort(),l.j=!1),l.l=u,l.m=5,qc(l),La(l)}function qc(l){l.A||(l.A=!0,_(l,"complete"),_(l,"error"))}r.abort=function(l){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=l||7,_(this,"complete"),_(this,"abort"),La(this))},r.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),La(this,!0)),pt.aa.N.call(this)},r.Ea=function(){this.s||(this.B||this.u||this.j?zc(this):this.bb())},r.bb=function(){zc(this)};function zc(l){if(l.h&&typeof o<"u"&&(!l.v[1]||Ar(l)!=4||l.Z()!=2)){if(l.u&&Ar(l)==4)Ne(l.Ea,0,l);else if(_(l,"readystatechange"),Ar(l)==4){l.h=!1;try{const ve=l.Z();e:switch(ve){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var u=!0;break e;default:u=!1}var m;if(!(m=u)){var b;if(b=ve===0){var U=String(l.D).match(Mc)[1]||null;!U&&c.self&&c.self.location&&(U=c.self.location.protocol.slice(0,-1)),b=!E0.test(U?U.toLowerCase():"")}m=b}if(m)_(l,"complete"),_(l,"success");else{l.m=6;try{var K=2<Ar(l)?l.g.statusText:""}catch{K=""}l.l=K+" ["+l.Z()+"]",qc(l)}}finally{La(l)}}}}function La(l,u){if(l.g){Hc(l);const m=l.g,b=l.v[0]?()=>{}:null;l.g=null,l.v=null,u||_(l,"ready");try{m.onreadystatechange=b}catch{}}}function Hc(l){l.I&&(c.clearTimeout(l.I),l.I=null)}r.isActive=function(){return!!this.g};function Ar(l){return l.g?l.g.readyState:0}r.Z=function(){try{return 2<Ar(this)?this.g.status:-1}catch{return-1}},r.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},r.Oa=function(l){if(this.g){var u=this.g.responseText;return l&&u.indexOf(l)==0&&(u=u.substring(l.length)),gt(u)}};function Gc(l){try{if(!l.g)return null;if("response"in l.g)return l.g.response;switch(l.H){case"":case"text":return l.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in l.g)return l.g.mozResponseArrayBuffer}return null}catch{return null}}function T0(l){const u={};l=(l.g&&2<=Ar(l)&&l.g.getAllResponseHeaders()||"").split(`\r
`);for(let b=0;b<l.length;b++){if($(l[b]))continue;var m=j(l[b]);const U=m[0];if(m=m[1],typeof m!="string")continue;m=m.trim();const K=u[U]||[];u[U]=K,K.push(m)}E(u,function(b){return b.join(", ")})}r.Ba=function(){return this.m},r.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function Pn(l,u,m){return m&&m.internalChannelParams&&m.internalChannelParams[l]||u}function Kc(l){this.Aa=0,this.i=[],this.j=new ot,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=Pn("failFast",!1,l),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=Pn("baseRetryDelayMs",5e3,l),this.cb=Pn("retryDelaySeedMs",1e4,l),this.Wa=Pn("forwardChannelMaxRetries",2,l),this.wa=Pn("forwardChannelRequestTimeoutMs",2e4,l),this.pa=l&&l.xmlHttpFactory||void 0,this.Xa=l&&l.Tb||void 0,this.Ca=l&&l.useFetchStreams||!1,this.L=void 0,this.J=l&&l.supportsCrossDomainXhr||!1,this.K="",this.h=new Sc(l&&l.concurrentRequestLimit),this.Da=new N0,this.P=l&&l.fastHandshake||!1,this.O=l&&l.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=l&&l.Rb||!1,l&&l.xa&&this.j.xa(),l&&l.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&l&&l.detectBufferingProxy||!1,this.ja=void 0,l&&l.longPollingTimeout&&0<l.longPollingTimeout&&(this.ja=l.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}r=Kc.prototype,r.la=8,r.G=1,r.connect=function(l,u,m,b){ze(0),this.W=l,this.H=u||{},m&&b!==void 0&&(this.H.OSID=m,this.H.OAID=b),this.F=this.X,this.I=sd(this,null,this.W),Ua(this)};function ko(l){if(Yc(l),l.G==3){var u=l.U++,m=Sr(l.I);if(ct(m,"SID",l.K),ct(m,"RID",u),ct(m,"TYPE","terminate"),Mn(l,m),u=new Jr(l,l.j,u),u.L=2,u.v=$a(Sr(m)),m=!1,c.navigator&&c.navigator.sendBeacon)try{m=c.navigator.sendBeacon(u.v.toString(),"")}catch{}!m&&c.Image&&(new Image().src=u.v,m=!0),m||(u.g=nd(u.j,null),u.g.ea(u.v)),u.F=Date.now(),Ra(u)}rd(l)}function Fa(l){l.g&&(No(l),l.g.cancel(),l.g=null)}function Yc(l){Fa(l),l.u&&(c.clearTimeout(l.u),l.u=null),Ba(l),l.h.cancel(),l.s&&(typeof l.s=="number"&&c.clearTimeout(l.s),l.s=null)}function Ua(l){if(!Ac(l.h)&&!l.s){l.s=!0;var u=l.Ga;R||oe(),te||(R(),te=!0),Z.add(u,l),l.B=0}}function S0(l,u){return Cc(l.h)>=l.h.j-(l.s?1:0)?!1:l.s?(l.i=u.D.concat(l.i),!0):l.G==1||l.G==2||l.B>=(l.Va?0:l.Wa)?!1:(l.s=Ze(p(l.Ga,l,u),td(l,l.B)),l.B++,!0)}r.Ga=function(l){if(this.s)if(this.s=null,this.G==1){if(!l){this.U=Math.floor(1e5*Math.random()),l=this.U++;const U=new Jr(this,this.j,l);let K=this.o;if(this.S&&(K?(K=y(K),k(K,this.S)):K=this.S),this.m!==null||this.O||(U.H=K,K=null),this.P)e:{for(var u=0,m=0;m<this.i.length;m++){t:{var b=this.i[m];if("__data__"in b.map&&(b=b.map.__data__,typeof b=="string")){b=b.length;break t}b=void 0}if(b===void 0)break;if(u+=b,4096<u){u=m;break e}if(u===4096||m===this.i.length-1){u=m+1;break e}}u=1e3}else u=1e3;u=Xc(this,U,u),m=Sr(this.I),ct(m,"RID",l),ct(m,"CVER",22),this.D&&ct(m,"X-HTTP-Session-Id",this.D),Mn(this,m),K&&(this.O?u="headers="+encodeURIComponent(String(Bc(K)))+"&"+u:this.m&&wo(m,this.m,K)),vo(this.h,U),this.Ua&&ct(m,"TYPE","init"),this.P?(ct(m,"$req",u),ct(m,"SID","null"),U.T=!0,fo(U,m,null)):fo(U,m,u),this.G=2}}else this.G==3&&(l?Qc(this,l):this.i.length==0||Ac(this.h)||Qc(this))};function Qc(l,u){var m;u?m=u.l:m=l.U++;const b=Sr(l.I);ct(b,"SID",l.K),ct(b,"RID",m),ct(b,"AID",l.T),Mn(l,b),l.m&&l.o&&wo(b,l.m,l.o),m=new Jr(l,l.j,m,l.B+1),l.m===null&&(m.H=l.o),u&&(l.i=u.D.concat(l.i)),u=Xc(l,m,1e3),m.I=Math.round(.5*l.wa)+Math.round(.5*l.wa*Math.random()),vo(l.h,m),fo(m,b,u)}function Mn(l,u){l.H&&G(l.H,function(m,b){ct(u,b,m)}),l.l&&Pc({},function(m,b){ct(u,b,m)})}function Xc(l,u,m){m=Math.min(l.i.length,m);var b=l.l?p(l.l.Na,l.l,l):null;e:{var U=l.i;let K=-1;for(;;){const ve=["count="+m];K==-1?0<m?(K=U[0].g,ve.push("ofs="+K)):K=0:ve.push("ofs="+K);let lt=!0;for(let Ct=0;Ct<m;Ct++){let et=U[Ct].g;const Ot=U[Ct].map;if(et-=K,0>et)K=Math.max(0,U[Ct].g-100),lt=!1;else try{j0(Ot,ve,"req"+et+"_")}catch{b&&b(Ot)}}if(lt){b=ve.join("&");break e}}}return l=l.i.splice(0,m),u.D=l,b}function Jc(l){if(!l.g&&!l.u){l.Y=1;var u=l.Fa;R||oe(),te||(R(),te=!0),Z.add(u,l),l.v=0}}function _o(l){return l.g||l.u||3<=l.v?!1:(l.Y++,l.u=Ze(p(l.Fa,l),td(l,l.v)),l.v++,!0)}r.Fa=function(){if(this.u=null,Zc(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var l=2*this.R;this.j.info("BP detection timer enabled: "+l),this.A=Ze(p(this.ab,this),l)}},r.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,ze(10),Fa(this),Zc(this))};function No(l){l.A!=null&&(c.clearTimeout(l.A),l.A=null)}function Zc(l){l.g=new Jr(l,l.j,"rpc",l.Y),l.m===null&&(l.g.H=l.o),l.g.O=0;var u=Sr(l.qa);ct(u,"RID","rpc"),ct(u,"SID",l.K),ct(u,"AID",l.T),ct(u,"CI",l.F?"0":"1"),!l.F&&l.ja&&ct(u,"TO",l.ja),ct(u,"TYPE","xmlhttp"),Mn(l,u),l.m&&l.o&&wo(u,l.m,l.o),l.L&&(l.g.I=l.L);var m=l.g;l=l.ia,m.L=1,m.v=$a(Sr(u)),m.m=null,m.P=!0,Ec(m,l)}r.Za=function(){this.C!=null&&(this.C=null,Fa(this),_o(this),ze(19))};function Ba(l){l.C!=null&&(c.clearTimeout(l.C),l.C=null)}function ed(l,u){var m=null;if(l.g==u){Ba(l),No(l),l.g=null;var b=2}else if(bo(l.h,u))m=u.D,Dc(l.h,u),b=1;else return;if(l.G!=0){if(u.o)if(b==1){m=u.m?u.m.length:0,u=Date.now()-u.F;var U=l.B;b=xe(),_(b,new Zt(b,m)),Ua(l)}else Jc(l);else if(U=u.s,U==3||U==0&&0<u.X||!(b==1&&S0(l,u)||b==2&&_o(l)))switch(m&&0<m.length&&(u=l.h,u.i=u.i.concat(m)),U){case 1:Ns(l,5);break;case 4:Ns(l,10);break;case 3:Ns(l,6);break;default:Ns(l,2)}}}function td(l,u){let m=l.Ta+Math.floor(Math.random()*l.cb);return l.isActive()||(m*=2),m*u}function Ns(l,u){if(l.j.info("Error code "+u),u==2){var m=p(l.fb,l),b=l.Xa;const U=!b;b=new _s(b||"//www.google.com/images/cleardot.gif"),c.location&&c.location.protocol=="http"||Pa(b,"https"),$a(b),U?k0(b.toString(),m):_0(b.toString(),m)}else ze(2);l.G=0,l.l&&l.l.sa(u),rd(l),Yc(l)}r.fb=function(l){l?(this.j.info("Successfully pinged google.com"),ze(2)):(this.j.info("Failed to ping google.com"),ze(1))};function rd(l){if(l.G=0,l.ka=[],l.l){const u=Rc(l.h);(u.length!=0||l.i.length!=0)&&(T(l.ka,u),T(l.ka,l.i),l.h.i.length=0,C(l.i),l.i.length=0),l.l.ra()}}function sd(l,u,m){var b=m instanceof _s?Sr(m):new _s(m);if(b.g!="")u&&(b.g=u+"."+b.g),Ma(b,b.s);else{var U=c.location;b=U.protocol,u=u?u+"."+U.hostname:U.hostname,U=+U.port;var K=new _s(null);b&&Pa(K,b),u&&(K.g=u),U&&Ma(K,U),m&&(K.l=m),b=K}return m=l.D,u=l.ya,m&&u&&ct(b,m,u),ct(b,"VER",l.la),Mn(l,b),b}function nd(l,u,m){if(u&&!l.J)throw Error("Can't create secondary domain capable XhrIo object.");return u=l.Ca&&!l.pa?new pt(new Oa({eb:m})):new pt(l.pa),u.Ha(l.J),u}r.isActive=function(){return!!this.l&&this.l.isActive(this)};function ad(){}r=ad.prototype,r.ua=function(){},r.ta=function(){},r.sa=function(){},r.ra=function(){},r.isActive=function(){return!0},r.Na=function(){};function Wa(){}Wa.prototype.g=function(l,u){return new er(l,u)};function er(l,u){P.call(this),this.g=new Kc(u),this.l=l,this.h=u&&u.messageUrlParams||null,l=u&&u.messageHeaders||null,u&&u.clientProtocolHeaderRequired&&(l?l["X-Client-Protocol"]="webchannel":l={"X-Client-Protocol":"webchannel"}),this.g.o=l,l=u&&u.initMessageHeaders||null,u&&u.messageContentType&&(l?l["X-WebChannel-Content-Type"]=u.messageContentType:l={"X-WebChannel-Content-Type":u.messageContentType}),u&&u.va&&(l?l["X-WebChannel-Client-Profile"]=u.va:l={"X-WebChannel-Client-Profile":u.va}),this.g.S=l,(l=u&&u.Sb)&&!$(l)&&(this.g.m=l),this.v=u&&u.supportsCrossDomainXhr||!1,this.u=u&&u.sendRawJson||!1,(u=u&&u.httpSessionIdParam)&&!$(u)&&(this.g.D=u,l=this.h,l!==null&&u in l&&(l=this.h,u in l&&delete l[u])),this.j=new Hs(this)}A(er,P),er.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},er.prototype.close=function(){ko(this.g)},er.prototype.o=function(l){var u=this.g;if(typeof l=="string"){var m={};m.__data__=l,l=m}else this.u&&(m={},m.__data__=rt(l),l=m);u.i.push(new h0(u.Ya++,l)),u.G==3&&Ua(u)},er.prototype.N=function(){this.g.l=null,delete this.j,ko(this.g),delete this.g,er.aa.N.call(this)};function id(l){Qe.call(this),l.__headers__&&(this.headers=l.__headers__,this.statusCode=l.__status__,delete l.__headers__,delete l.__status__);var u=l.__sm__;if(u){e:{for(const m in u){l=m;break e}l=void 0}(this.i=l)&&(l=this.i,u=u!==null&&l in u?u[l]:void 0),this.data=u}else this.data=l}A(id,Qe);function od(){Qr.call(this),this.status=1}A(od,Qr);function Hs(l){this.g=l}A(Hs,ad),Hs.prototype.ua=function(){_(this.g,"a")},Hs.prototype.ta=function(l){_(this.g,new id(l))},Hs.prototype.sa=function(l){_(this.g,new od)},Hs.prototype.ra=function(){_(this.g,"b")},Wa.prototype.createWebChannel=Wa.prototype.g,er.prototype.send=er.prototype.o,er.prototype.open=er.prototype.m,er.prototype.close=er.prototype.close,Vh=function(){return new Wa},Oh=function(){return xe()},$h=Ht,Zo={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},nr.NO_ERROR=0,nr.TIMEOUT=8,nr.HTTP_ERROR=6,ni=nr,Xr.COMPLETE="complete",Mh=Xr,ye.EventType=_e,_e.OPEN="a",_e.CLOSE="b",_e.ERROR="c",_e.MESSAGE="d",P.prototype.listen=P.prototype.K,Bn=ye,pt.prototype.listenOnce=pt.prototype.L,pt.prototype.getLastError=pt.prototype.Ka,pt.prototype.getLastErrorCode=pt.prototype.Ba,pt.prototype.getStatus=pt.prototype.Z,pt.prototype.getResponseJson=pt.prototype.Oa,pt.prototype.getResponseText=pt.prototype.oa,pt.prototype.send=pt.prototype.ea,pt.prototype.setWithCredentials=pt.prototype.Ha,Ph=pt}).apply(typeof Ga<"u"?Ga:typeof self<"u"?self:typeof window<"u"?window:{});const Cd="@firebase/firestore";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ft{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}Ft.UNAUTHENTICATED=new Ft(null),Ft.GOOGLE_CREDENTIALS=new Ft("google-credentials-uid"),Ft.FIRST_PARTY=new Ft("first-party-uid"),Ft.MOCK_USER=new Ft("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let vn="10.14.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Os=new _l("@firebase/firestore");function On(){return Os.logLevel}function Te(r,...e){if(Os.logLevel<=Ke.DEBUG){const t=e.map(El);Os.debug(`Firestore (${vn}): ${r}`,...t)}}function Wr(r,...e){if(Os.logLevel<=Ke.ERROR){const t=e.map(El);Os.error(`Firestore (${vn}): ${r}`,...t)}}function dn(r,...e){if(Os.logLevel<=Ke.WARN){const t=e.map(El);Os.warn(`Firestore (${vn}): ${r}`,...t)}}function El(r){if(typeof r=="string")return r;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return function(t){return JSON.stringify(t)}(r)}catch{return r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ve(r="Unexpected state"){const e=`FIRESTORE (${vn}) INTERNAL ASSERTION FAILED: `+r;throw Wr(e),new Error(e)}function nt(r,e){r||Ve()}function Fe(r,e){return r}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const se={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class je extends Ir{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fr{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lh{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class Ux{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(Ft.UNAUTHENTICATED))}shutdown(){}}class Bx{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class Wx{constructor(e){this.t=e,this.currentUser=Ft.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){nt(this.o===void 0);let n=this.i;const a=d=>this.i!==n?(n=this.i,t(d)):Promise.resolve();let i=new Fr;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new Fr,e.enqueueRetryable(()=>a(this.currentUser))};const o=()=>{const d=i;e.enqueueRetryable(async()=>{await d.promise,await a(this.currentUser)})},c=d=>{Te("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=d,this.o&&(this.auth.addAuthTokenListener(this.o),o())};this.t.onInit(d=>c(d)),setTimeout(()=>{if(!this.auth){const d=this.t.getImmediate({optional:!0});d?c(d):(Te("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new Fr)}},0),o()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(n=>this.i!==e?(Te("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):n?(nt(typeof n.accessToken=="string"),new Lh(n.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return nt(e===null||typeof e=="string"),new Ft(e)}}class qx{constructor(e,t,n){this.l=e,this.h=t,this.P=n,this.type="FirstParty",this.user=Ft.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);const e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class zx{constructor(e,t,n){this.l=e,this.h=t,this.P=n}getToken(){return Promise.resolve(new qx(this.l,this.h,this.P))}start(e,t){e.enqueueRetryable(()=>t(Ft.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class Hx{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class Gx{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,t){nt(this.o===void 0);const n=i=>{i.error!=null&&Te("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${i.error.message}`);const o=i.token!==this.R;return this.R=i.token,Te("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?t(i.token):Promise.resolve()};this.o=i=>{e.enqueueRetryable(()=>n(i))};const a=i=>{Te("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=i,this.o&&this.appCheck.addTokenListener(this.o)};this.A.onInit(i=>a(i)),setTimeout(()=>{if(!this.appCheck){const i=this.A.getImmediate({optional:!0});i?a(i):Te("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(nt(typeof t.token=="string"),this.R=t.token,new Hx(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Kx(r){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(r);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let n=0;n<r;n++)t[n]=Math.floor(256*Math.random());return t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fh{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length;let n="";for(;n.length<20;){const a=Kx(40);for(let i=0;i<a.length;++i)n.length<20&&a[i]<t&&(n+=e.charAt(a[i]%e.length))}return n}}function tt(r,e){return r<e?-1:r>e?1:0}function un(r,e,t){return r.length===e.length&&r.every((n,a)=>t(n,e[a]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jt{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new je(se.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new je(se.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new je(se.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new je(se.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return jt.fromMillis(Date.now())}static fromDate(e){return jt.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),n=Math.floor(1e6*(e-1e3*t));return new jt(t,n)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?tt(this.nanoseconds,e.nanoseconds):tt(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Le{constructor(e){this.timestamp=e}static fromTimestamp(e){return new Le(e)}static min(){return new Le(new jt(0,0))}static max(){return new Le(new jt(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class na{constructor(e,t,n){t===void 0?t=0:t>e.length&&Ve(),n===void 0?n=e.length-t:n>e.length-t&&Ve(),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return na.comparator(this,e)===0}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof na?e.forEach(n=>{t.push(n)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const n=Math.min(e.length,t.length);for(let a=0;a<n;a++){const i=e.get(a),o=t.get(a);if(i<o)return-1;if(i>o)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class dt extends na{construct(e,t,n){return new dt(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const n of e){if(n.indexOf("//")>=0)throw new je(se.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter(a=>a.length>0))}return new dt(t)}static emptyPath(){return new dt([])}}const Yx=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Rt extends na{construct(e,t,n){return new Rt(e,t,n)}static isValidIdentifier(e){return Yx.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Rt.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new Rt(["__name__"])}static fromServerFormat(e){const t=[];let n="",a=0;const i=()=>{if(n.length===0)throw new je(se.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""};let o=!1;for(;a<e.length;){const c=e[a];if(c==="\\"){if(a+1===e.length)throw new je(se.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const d=e[a+1];if(d!=="\\"&&d!=="."&&d!=="`")throw new je(se.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=d,a+=2}else c==="`"?(o=!o,a++):c!=="."||o?(n+=c,a++):(i(),a++)}if(i(),o)throw new je(se.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new Rt(t)}static emptyPath(){return new Rt([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pe{constructor(e){this.path=e}static fromPath(e){return new Pe(dt.fromString(e))}static fromName(e){return new Pe(dt.fromString(e).popFirst(5))}static empty(){return new Pe(dt.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&dt.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return dt.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new Pe(new dt(e.slice()))}}function Qx(r,e){const t=r.toTimestamp().seconds,n=r.toTimestamp().nanoseconds+1,a=Le.fromTimestamp(n===1e9?new jt(t+1,0):new jt(t,n));return new fs(a,Pe.empty(),e)}function Xx(r){return new fs(r.readTime,r.key,-1)}class fs{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new fs(Le.min(),Pe.empty(),-1)}static max(){return new fs(Le.max(),Pe.empty(),-1)}}function Jx(r,e){let t=r.readTime.compareTo(e.readTime);return t!==0?t:(t=Pe.comparator(r.documentKey,e.documentKey),t!==0?t:tt(r.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Zx="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class ey{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function wa(r){if(r.code!==se.FAILED_PRECONDITION||r.message!==Zx)throw r;Te("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class le{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&Ve(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new le((n,a)=>{this.nextCallback=i=>{this.wrapSuccess(e,i).next(n,a)},this.catchCallback=i=>{this.wrapFailure(t,i).next(n,a)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof le?t:le.resolve(t)}catch(t){return le.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):le.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):le.reject(t)}static resolve(e){return new le((t,n)=>{t(e)})}static reject(e){return new le((t,n)=>{n(e)})}static waitFor(e){return new le((t,n)=>{let a=0,i=0,o=!1;e.forEach(c=>{++a,c.next(()=>{++i,o&&i===a&&t()},d=>n(d))}),o=!0,i===a&&t()})}static or(e){let t=le.resolve(!1);for(const n of e)t=t.next(a=>a?le.resolve(a):n());return t}static forEach(e,t){const n=[];return e.forEach((a,i)=>{n.push(t.call(this,a,i))}),this.waitFor(n)}static mapArray(e,t){return new le((n,a)=>{const i=e.length,o=new Array(i);let c=0;for(let d=0;d<i;d++){const h=d;t(e[h]).next(g=>{o[h]=g,++c,c===i&&n(o)},g=>a(g))}})}static doWhile(e,t){return new le((n,a)=>{const i=()=>{e()===!0?t().next(()=>{i()},a):n()};i()})}}function ty(r){const e=r.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}function ka(r){return r.name==="IndexedDbTransactionError"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Il{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=n=>this.ie(n),this.se=n=>t.writeSequenceNumber(n))}ie(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.se&&this.se(e),e}}Il.oe=-1;function qi(r){return r==null}function bi(r){return r===0&&1/r==-1/0}function ry(r){return typeof r=="number"&&Number.isInteger(r)&&!bi(r)&&r<=Number.MAX_SAFE_INTEGER&&r>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Dd(r){let e=0;for(const t in r)Object.prototype.hasOwnProperty.call(r,t)&&e++;return e}function Bs(r,e){for(const t in r)Object.prototype.hasOwnProperty.call(r,t)&&e(t,r[t])}function Uh(r){for(const e in r)if(Object.prototype.hasOwnProperty.call(r,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ht{constructor(e,t){this.comparator=e,this.root=t||Dt.EMPTY}insert(e,t){return new ht(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Dt.BLACK,null,null))}remove(e){return new ht(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Dt.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const n=this.comparator(e,t.key);if(n===0)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){const a=this.comparator(e,n.key);if(a===0)return t+n.left.size;a<0?n=n.left:(t+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,n)=>(e(t,n),!1))}toString(){const e=[];return this.inorderTraversal((t,n)=>(e.push(`${t}:${n}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Ka(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Ka(this.root,e,this.comparator,!1)}getReverseIterator(){return new Ka(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Ka(this.root,e,this.comparator,!0)}}class Ka{constructor(e,t,n,a){this.isReverse=a,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?n(e.key,t):1,t&&a&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(i===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Dt{constructor(e,t,n,a,i){this.key=e,this.value=t,this.color=n??Dt.RED,this.left=a??Dt.EMPTY,this.right=i??Dt.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,a,i){return new Dt(e??this.key,t??this.value,n??this.color,a??this.left,i??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let a=this;const i=n(e,a.key);return a=i<0?a.copy(null,null,null,a.left.insert(e,t,n),null):i===0?a.copy(null,t,null,null,null):a.copy(null,null,null,null,a.right.insert(e,t,n)),a.fixUp()}removeMin(){if(this.left.isEmpty())return Dt.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let n,a=this;if(t(e,a.key)<0)a.left.isEmpty()||a.left.isRed()||a.left.left.isRed()||(a=a.moveRedLeft()),a=a.copy(null,null,null,a.left.remove(e,t),null);else{if(a.left.isRed()&&(a=a.rotateRight()),a.right.isEmpty()||a.right.isRed()||a.right.left.isRed()||(a=a.moveRedRight()),t(e,a.key)===0){if(a.right.isEmpty())return Dt.EMPTY;n=a.right.min(),a=a.copy(n.key,n.value,null,null,a.right.removeMin())}a=a.copy(null,null,null,null,a.right.remove(e,t))}return a.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Dt.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Dt.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw Ve();const e=this.left.check();if(e!==this.right.check())throw Ve();return e+(this.isRed()?0:1)}}Dt.EMPTY=null,Dt.RED=!0,Dt.BLACK=!1;Dt.EMPTY=new class{constructor(){this.size=0}get key(){throw Ve()}get value(){throw Ve()}get color(){throw Ve()}get left(){throw Ve()}get right(){throw Ve()}copy(e,t,n,a,i){return this}insert(e,t,n){return new Dt(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mt{constructor(e){this.comparator=e,this.data=new ht(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,n)=>(e(t),!1))}forEachInRange(e,t){const n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){const a=n.getNext();if(this.comparator(a.key,e[1])>=0)return;t(a.key)}}forEachWhile(e,t){let n;for(n=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new Rd(this.data.getIterator())}getIteratorFrom(e){return new Rd(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(n=>{t=t.add(n)}),t}isEqual(e){if(!(e instanceof Mt)||this.size!==e.size)return!1;const t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){const a=t.getNext().key,i=n.getNext().key;if(this.comparator(a,i)!==0)return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new Mt(this.comparator);return t.data=e,t}}class Rd{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rr{constructor(e){this.fields=e,e.sort(Rt.comparator)}static empty(){return new rr([])}unionWith(e){let t=new Mt(Rt.comparator);for(const n of this.fields)t=t.add(n);for(const n of e)t=t.add(n);return new rr(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return un(this.fields,e.fields,(t,n)=>t.isEqual(n))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bh extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $t{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(a){try{return atob(a)}catch(i){throw typeof DOMException<"u"&&i instanceof DOMException?new Bh("Invalid base64 string: "+i):i}}(e);return new $t(t)}static fromUint8Array(e){const t=function(a){let i="";for(let o=0;o<a.length;++o)i+=String.fromCharCode(a[o]);return i}(e);return new $t(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(t){return btoa(t)}(this.binaryString)}toUint8Array(){return function(t){const n=new Uint8Array(t.length);for(let a=0;a<t.length;a++)n[a]=t.charCodeAt(a);return n}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return tt(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}$t.EMPTY_BYTE_STRING=new $t("");const sy=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function xs(r){if(nt(!!r),typeof r=="string"){let e=0;const t=sy.exec(r);if(nt(!!t),t[1]){let a=t[1];a=(a+"000000000").substr(0,9),e=Number(a)}const n=new Date(r);return{seconds:Math.floor(n.getTime()/1e3),nanos:e}}return{seconds:xt(r.seconds),nanos:xt(r.nanos)}}function xt(r){return typeof r=="number"?r:typeof r=="string"?Number(r):0}function Vs(r){return typeof r=="string"?$t.fromBase64String(r):$t.fromUint8Array(r)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Tl(r){var e,t;return((t=(((e=r==null?void 0:r.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||t===void 0?void 0:t.stringValue)==="server_timestamp"}function Sl(r){const e=r.mapValue.fields.__previous_value__;return Tl(e)?Sl(e):e}function aa(r){const e=xs(r.mapValue.fields.__local_write_time__.timestampValue);return new jt(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ny{constructor(e,t,n,a,i,o,c,d,h){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=a,this.ssl=i,this.forceLongPolling=o,this.autoDetectLongPolling=c,this.longPollingOptions=d,this.useFetchStreams=h}}class ia{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new ia("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(e){return e instanceof ia&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ya={mapValue:{}};function Ls(r){return"nullValue"in r?0:"booleanValue"in r?1:"integerValue"in r||"doubleValue"in r?2:"timestampValue"in r?3:"stringValue"in r?5:"bytesValue"in r?6:"referenceValue"in r?7:"geoPointValue"in r?8:"arrayValue"in r?9:"mapValue"in r?Tl(r)?4:iy(r)?9007199254740991:ay(r)?10:11:Ve()}function Nr(r,e){if(r===e)return!0;const t=Ls(r);if(t!==Ls(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return r.booleanValue===e.booleanValue;case 4:return aa(r).isEqual(aa(e));case 3:return function(a,i){if(typeof a.timestampValue=="string"&&typeof i.timestampValue=="string"&&a.timestampValue.length===i.timestampValue.length)return a.timestampValue===i.timestampValue;const o=xs(a.timestampValue),c=xs(i.timestampValue);return o.seconds===c.seconds&&o.nanos===c.nanos}(r,e);case 5:return r.stringValue===e.stringValue;case 6:return function(a,i){return Vs(a.bytesValue).isEqual(Vs(i.bytesValue))}(r,e);case 7:return r.referenceValue===e.referenceValue;case 8:return function(a,i){return xt(a.geoPointValue.latitude)===xt(i.geoPointValue.latitude)&&xt(a.geoPointValue.longitude)===xt(i.geoPointValue.longitude)}(r,e);case 2:return function(a,i){if("integerValue"in a&&"integerValue"in i)return xt(a.integerValue)===xt(i.integerValue);if("doubleValue"in a&&"doubleValue"in i){const o=xt(a.doubleValue),c=xt(i.doubleValue);return o===c?bi(o)===bi(c):isNaN(o)&&isNaN(c)}return!1}(r,e);case 9:return un(r.arrayValue.values||[],e.arrayValue.values||[],Nr);case 10:case 11:return function(a,i){const o=a.mapValue.fields||{},c=i.mapValue.fields||{};if(Dd(o)!==Dd(c))return!1;for(const d in o)if(o.hasOwnProperty(d)&&(c[d]===void 0||!Nr(o[d],c[d])))return!1;return!0}(r,e);default:return Ve()}}function oa(r,e){return(r.values||[]).find(t=>Nr(t,e))!==void 0}function hn(r,e){if(r===e)return 0;const t=Ls(r),n=Ls(e);if(t!==n)return tt(t,n);switch(t){case 0:case 9007199254740991:return 0;case 1:return tt(r.booleanValue,e.booleanValue);case 2:return function(i,o){const c=xt(i.integerValue||i.doubleValue),d=xt(o.integerValue||o.doubleValue);return c<d?-1:c>d?1:c===d?0:isNaN(c)?isNaN(d)?0:-1:1}(r,e);case 3:return Pd(r.timestampValue,e.timestampValue);case 4:return Pd(aa(r),aa(e));case 5:return tt(r.stringValue,e.stringValue);case 6:return function(i,o){const c=Vs(i),d=Vs(o);return c.compareTo(d)}(r.bytesValue,e.bytesValue);case 7:return function(i,o){const c=i.split("/"),d=o.split("/");for(let h=0;h<c.length&&h<d.length;h++){const g=tt(c[h],d[h]);if(g!==0)return g}return tt(c.length,d.length)}(r.referenceValue,e.referenceValue);case 8:return function(i,o){const c=tt(xt(i.latitude),xt(o.latitude));return c!==0?c:tt(xt(i.longitude),xt(o.longitude))}(r.geoPointValue,e.geoPointValue);case 9:return Md(r.arrayValue,e.arrayValue);case 10:return function(i,o){var c,d,h,g;const x=i.fields||{},p=o.fields||{},v=(c=x.value)===null||c===void 0?void 0:c.arrayValue,A=(d=p.value)===null||d===void 0?void 0:d.arrayValue,C=tt(((h=v==null?void 0:v.values)===null||h===void 0?void 0:h.length)||0,((g=A==null?void 0:A.values)===null||g===void 0?void 0:g.length)||0);return C!==0?C:Md(v,A)}(r.mapValue,e.mapValue);case 11:return function(i,o){if(i===Ya.mapValue&&o===Ya.mapValue)return 0;if(i===Ya.mapValue)return 1;if(o===Ya.mapValue)return-1;const c=i.fields||{},d=Object.keys(c),h=o.fields||{},g=Object.keys(h);d.sort(),g.sort();for(let x=0;x<d.length&&x<g.length;++x){const p=tt(d[x],g[x]);if(p!==0)return p;const v=hn(c[d[x]],h[g[x]]);if(v!==0)return v}return tt(d.length,g.length)}(r.mapValue,e.mapValue);default:throw Ve()}}function Pd(r,e){if(typeof r=="string"&&typeof e=="string"&&r.length===e.length)return tt(r,e);const t=xs(r),n=xs(e),a=tt(t.seconds,n.seconds);return a!==0?a:tt(t.nanos,n.nanos)}function Md(r,e){const t=r.values||[],n=e.values||[];for(let a=0;a<t.length&&a<n.length;++a){const i=hn(t[a],n[a]);if(i)return i}return tt(t.length,n.length)}function mn(r){return el(r)}function el(r){return"nullValue"in r?"null":"booleanValue"in r?""+r.booleanValue:"integerValue"in r?""+r.integerValue:"doubleValue"in r?""+r.doubleValue:"timestampValue"in r?function(t){const n=xs(t);return`time(${n.seconds},${n.nanos})`}(r.timestampValue):"stringValue"in r?r.stringValue:"bytesValue"in r?function(t){return Vs(t).toBase64()}(r.bytesValue):"referenceValue"in r?function(t){return Pe.fromName(t).toString()}(r.referenceValue):"geoPointValue"in r?function(t){return`geo(${t.latitude},${t.longitude})`}(r.geoPointValue):"arrayValue"in r?function(t){let n="[",a=!0;for(const i of t.values||[])a?a=!1:n+=",",n+=el(i);return n+"]"}(r.arrayValue):"mapValue"in r?function(t){const n=Object.keys(t.fields||{}).sort();let a="{",i=!0;for(const o of n)i?i=!1:a+=",",a+=`${o}:${el(t.fields[o])}`;return a+"}"}(r.mapValue):Ve()}function $d(r,e){return{referenceValue:`projects/${r.projectId}/databases/${r.database}/documents/${e.path.canonicalString()}`}}function tl(r){return!!r&&"integerValue"in r}function Al(r){return!!r&&"arrayValue"in r}function Od(r){return!!r&&"nullValue"in r}function Vd(r){return!!r&&"doubleValue"in r&&isNaN(Number(r.doubleValue))}function ai(r){return!!r&&"mapValue"in r}function ay(r){var e,t;return((t=(((e=r==null?void 0:r.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||t===void 0?void 0:t.stringValue)==="__vector__"}function Gn(r){if(r.geoPointValue)return{geoPointValue:Object.assign({},r.geoPointValue)};if(r.timestampValue&&typeof r.timestampValue=="object")return{timestampValue:Object.assign({},r.timestampValue)};if(r.mapValue){const e={mapValue:{fields:{}}};return Bs(r.mapValue.fields,(t,n)=>e.mapValue.fields[t]=Gn(n)),e}if(r.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(r.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=Gn(r.arrayValue.values[t]);return e}return Object.assign({},r)}function iy(r){return(((r.mapValue||{}).fields||{}).__type__||{}).stringValue==="__max__"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kt{constructor(e){this.value=e}static empty(){return new Kt({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(t=(t.mapValue.fields||{})[e.get(n)],!ai(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Gn(t)}setAll(e){let t=Rt.emptyPath(),n={},a=[];e.forEach((o,c)=>{if(!t.isImmediateParentOf(c)){const d=this.getFieldsMap(t);this.applyChanges(d,n,a),n={},a=[],t=c.popLast()}o?n[c.lastSegment()]=Gn(o):a.push(c.lastSegment())});const i=this.getFieldsMap(t);this.applyChanges(i,n,a)}delete(e){const t=this.field(e.popLast());ai(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Nr(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let a=t.mapValue.fields[e.get(n)];ai(a)&&a.mapValue.fields||(a={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=a),t=a}return t.mapValue.fields}applyChanges(e,t,n){Bs(t,(a,i)=>e[a]=i);for(const a of n)delete e[a]}clone(){return new Kt(Gn(this.value))}}function Wh(r){const e=[];return Bs(r.fields,(t,n)=>{const a=new Rt([t]);if(ai(n)){const i=Wh(n.mapValue).fields;if(i.length===0)e.push(a);else for(const o of i)e.push(a.child(o))}else e.push(a)}),new rr(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ut{constructor(e,t,n,a,i,o,c){this.key=e,this.documentType=t,this.version=n,this.readTime=a,this.createTime=i,this.data=o,this.documentState=c}static newInvalidDocument(e){return new Ut(e,0,Le.min(),Le.min(),Le.min(),Kt.empty(),0)}static newFoundDocument(e,t,n,a){return new Ut(e,1,t,Le.min(),n,a,0)}static newNoDocument(e,t){return new Ut(e,2,t,Le.min(),Le.min(),Kt.empty(),0)}static newUnknownDocument(e,t){return new Ut(e,3,t,Le.min(),Le.min(),Kt.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(Le.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Kt.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Kt.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=Le.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof Ut&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new Ut(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vi{constructor(e,t){this.position=e,this.inclusive=t}}function Ld(r,e,t){let n=0;for(let a=0;a<r.position.length;a++){const i=e[a],o=r.position[a];if(i.field.isKeyField()?n=Pe.comparator(Pe.fromName(o.referenceValue),t.key):n=hn(o,t.data.field(i.field)),i.dir==="desc"&&(n*=-1),n!==0)break}return n}function Fd(r,e){if(r===null)return e===null;if(e===null||r.inclusive!==e.inclusive||r.position.length!==e.position.length)return!1;for(let t=0;t<r.position.length;t++)if(!Nr(r.position[t],e.position[t]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class la{constructor(e,t="asc"){this.field=e,this.dir=t}}function oy(r,e){return r.dir===e.dir&&r.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qh{}class vt extends qh{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,n):new cy(e,t,n):t==="array-contains"?new hy(e,n):t==="in"?new my(e,n):t==="not-in"?new gy(e,n):t==="array-contains-any"?new py(e,n):new vt(e,t,n)}static createKeyFieldInFilter(e,t,n){return t==="in"?new dy(e,n):new uy(e,n)}matches(e){const t=e.data.field(this.field);return this.op==="!="?t!==null&&this.matchesComparison(hn(t,this.value)):t!==null&&Ls(this.value)===Ls(t)&&this.matchesComparison(hn(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return Ve()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class gr extends qh{constructor(e,t){super(),this.filters=e,this.op=t,this.ae=null}static create(e,t){return new gr(e,t)}matches(e){return zh(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.ae!==null||(this.ae=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.ae}getFilters(){return Object.assign([],this.filters)}}function zh(r){return r.op==="and"}function Hh(r){return ly(r)&&zh(r)}function ly(r){for(const e of r.filters)if(e instanceof gr)return!1;return!0}function rl(r){if(r instanceof vt)return r.field.canonicalString()+r.op.toString()+mn(r.value);if(Hh(r))return r.filters.map(e=>rl(e)).join(",");{const e=r.filters.map(t=>rl(t)).join(",");return`${r.op}(${e})`}}function Gh(r,e){return r instanceof vt?function(n,a){return a instanceof vt&&n.op===a.op&&n.field.isEqual(a.field)&&Nr(n.value,a.value)}(r,e):r instanceof gr?function(n,a){return a instanceof gr&&n.op===a.op&&n.filters.length===a.filters.length?n.filters.reduce((i,o,c)=>i&&Gh(o,a.filters[c]),!0):!1}(r,e):void Ve()}function Kh(r){return r instanceof vt?function(t){return`${t.field.canonicalString()} ${t.op} ${mn(t.value)}`}(r):r instanceof gr?function(t){return t.op.toString()+" {"+t.getFilters().map(Kh).join(" ,")+"}"}(r):"Filter"}class cy extends vt{constructor(e,t,n){super(e,t,n),this.key=Pe.fromName(n.referenceValue)}matches(e){const t=Pe.comparator(e.key,this.key);return this.matchesComparison(t)}}class dy extends vt{constructor(e,t){super(e,"in",t),this.keys=Yh("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class uy extends vt{constructor(e,t){super(e,"not-in",t),this.keys=Yh("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function Yh(r,e){var t;return(((t=e.arrayValue)===null||t===void 0?void 0:t.values)||[]).map(n=>Pe.fromName(n.referenceValue))}class hy extends vt{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return Al(t)&&oa(t.arrayValue,this.value)}}class my extends vt{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return t!==null&&oa(this.value.arrayValue,t)}}class gy extends vt{constructor(e,t){super(e,"not-in",t)}matches(e){if(oa(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return t!==null&&!oa(this.value.arrayValue,t)}}class py extends vt{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!Al(t)||!t.arrayValue.values)&&t.arrayValue.values.some(n=>oa(this.value.arrayValue,n))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fy{constructor(e,t=null,n=[],a=[],i=null,o=null,c=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=a,this.limit=i,this.startAt=o,this.endAt=c,this.ue=null}}function Ud(r,e=null,t=[],n=[],a=null,i=null,o=null){return new fy(r,e,t,n,a,i,o)}function Cl(r){const e=Fe(r);if(e.ue===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(n=>rl(n)).join(","),t+="|ob:",t+=e.orderBy.map(n=>function(i){return i.field.canonicalString()+i.dir}(n)).join(","),qi(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(n=>mn(n)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(n=>mn(n)).join(",")),e.ue=t}return e.ue}function Dl(r,e){if(r.limit!==e.limit||r.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<r.orderBy.length;t++)if(!oy(r.orderBy[t],e.orderBy[t]))return!1;if(r.filters.length!==e.filters.length)return!1;for(let t=0;t<r.filters.length;t++)if(!Gh(r.filters[t],e.filters[t]))return!1;return r.collectionGroup===e.collectionGroup&&!!r.path.isEqual(e.path)&&!!Fd(r.startAt,e.startAt)&&Fd(r.endAt,e.endAt)}function sl(r){return Pe.isDocumentKey(r.path)&&r.collectionGroup===null&&r.filters.length===0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wn{constructor(e,t=null,n=[],a=[],i=null,o="F",c=null,d=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=a,this.limit=i,this.limitType=o,this.startAt=c,this.endAt=d,this.ce=null,this.le=null,this.he=null,this.startAt,this.endAt}}function xy(r,e,t,n,a,i,o,c){return new wn(r,e,t,n,a,i,o,c)}function Rl(r){return new wn(r)}function Bd(r){return r.filters.length===0&&r.limit===null&&r.startAt==null&&r.endAt==null&&(r.explicitOrderBy.length===0||r.explicitOrderBy.length===1&&r.explicitOrderBy[0].field.isKeyField())}function Qh(r){return r.collectionGroup!==null}function Kn(r){const e=Fe(r);if(e.ce===null){e.ce=[];const t=new Set;for(const i of e.explicitOrderBy)e.ce.push(i),t.add(i.field.canonicalString());const n=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(o){let c=new Mt(Rt.comparator);return o.filters.forEach(d=>{d.getFlattenedFilters().forEach(h=>{h.isInequality()&&(c=c.add(h.field))})}),c})(e).forEach(i=>{t.has(i.canonicalString())||i.isKeyField()||e.ce.push(new la(i,n))}),t.has(Rt.keyField().canonicalString())||e.ce.push(new la(Rt.keyField(),n))}return e.ce}function vr(r){const e=Fe(r);return e.le||(e.le=yy(e,Kn(r))),e.le}function yy(r,e){if(r.limitType==="F")return Ud(r.path,r.collectionGroup,e,r.filters,r.limit,r.startAt,r.endAt);{e=e.map(a=>{const i=a.dir==="desc"?"asc":"desc";return new la(a.field,i)});const t=r.endAt?new vi(r.endAt.position,r.endAt.inclusive):null,n=r.startAt?new vi(r.startAt.position,r.startAt.inclusive):null;return Ud(r.path,r.collectionGroup,e,r.filters,r.limit,t,n)}}function nl(r,e){const t=r.filters.concat([e]);return new wn(r.path,r.collectionGroup,r.explicitOrderBy.slice(),t,r.limit,r.limitType,r.startAt,r.endAt)}function al(r,e,t){return new wn(r.path,r.collectionGroup,r.explicitOrderBy.slice(),r.filters.slice(),e,t,r.startAt,r.endAt)}function zi(r,e){return Dl(vr(r),vr(e))&&r.limitType===e.limitType}function Xh(r){return`${Cl(vr(r))}|lt:${r.limitType}`}function Qs(r){return`Query(target=${function(t){let n=t.path.canonicalString();return t.collectionGroup!==null&&(n+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(n+=`, filters: [${t.filters.map(a=>Kh(a)).join(", ")}]`),qi(t.limit)||(n+=", limit: "+t.limit),t.orderBy.length>0&&(n+=`, orderBy: [${t.orderBy.map(a=>function(o){return`${o.field.canonicalString()} (${o.dir})`}(a)).join(", ")}]`),t.startAt&&(n+=", startAt: ",n+=t.startAt.inclusive?"b:":"a:",n+=t.startAt.position.map(a=>mn(a)).join(",")),t.endAt&&(n+=", endAt: ",n+=t.endAt.inclusive?"a:":"b:",n+=t.endAt.position.map(a=>mn(a)).join(",")),`Target(${n})`}(vr(r))}; limitType=${r.limitType})`}function Hi(r,e){return e.isFoundDocument()&&function(n,a){const i=a.key.path;return n.collectionGroup!==null?a.key.hasCollectionId(n.collectionGroup)&&n.path.isPrefixOf(i):Pe.isDocumentKey(n.path)?n.path.isEqual(i):n.path.isImmediateParentOf(i)}(r,e)&&function(n,a){for(const i of Kn(n))if(!i.field.isKeyField()&&a.data.field(i.field)===null)return!1;return!0}(r,e)&&function(n,a){for(const i of n.filters)if(!i.matches(a))return!1;return!0}(r,e)&&function(n,a){return!(n.startAt&&!function(o,c,d){const h=Ld(o,c,d);return o.inclusive?h<=0:h<0}(n.startAt,Kn(n),a)||n.endAt&&!function(o,c,d){const h=Ld(o,c,d);return o.inclusive?h>=0:h>0}(n.endAt,Kn(n),a))}(r,e)}function by(r){return r.collectionGroup||(r.path.length%2==1?r.path.lastSegment():r.path.get(r.path.length-2))}function Jh(r){return(e,t)=>{let n=!1;for(const a of Kn(r)){const i=vy(a,e,t);if(i!==0)return i;n=n||a.field.isKeyField()}return 0}}function vy(r,e,t){const n=r.field.isKeyField()?Pe.comparator(e.key,t.key):function(i,o,c){const d=o.data.field(i),h=c.data.field(i);return d!==null&&h!==null?hn(d,h):Ve()}(r.field,e,t);switch(r.dir){case"asc":return n;case"desc":return-1*n;default:return Ve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kn{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),n=this.inner[t];if(n!==void 0){for(const[a,i]of n)if(this.equalsFn(a,e))return i}}has(e){return this.get(e)!==void 0}set(e,t){const n=this.mapKeyFn(e),a=this.inner[n];if(a===void 0)return this.inner[n]=[[e,t]],void this.innerSize++;for(let i=0;i<a.length;i++)if(this.equalsFn(a[i][0],e))return void(a[i]=[e,t]);a.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),n=this.inner[t];if(n===void 0)return!1;for(let a=0;a<n.length;a++)if(this.equalsFn(n[a][0],e))return n.length===1?delete this.inner[t]:n.splice(a,1),this.innerSize--,!0;return!1}forEach(e){Bs(this.inner,(t,n)=>{for(const[a,i]of n)e(a,i)})}isEmpty(){return Uh(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wy=new ht(Pe.comparator);function qr(){return wy}const Zh=new ht(Pe.comparator);function Wn(...r){let e=Zh;for(const t of r)e=e.insert(t.key,t);return e}function em(r){let e=Zh;return r.forEach((t,n)=>e=e.insert(t,n.overlayedDocument)),e}function Is(){return Yn()}function tm(){return Yn()}function Yn(){return new kn(r=>r.toString(),(r,e)=>r.isEqual(e))}const ky=new ht(Pe.comparator),_y=new Mt(Pe.comparator);function He(...r){let e=_y;for(const t of r)e=e.add(t);return e}const Ny=new Mt(tt);function jy(){return Ny}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Pl(r,e){if(r.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:bi(e)?"-0":e}}function rm(r){return{integerValue:""+r}}function Ey(r,e){return ry(e)?rm(e):Pl(r,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gi{constructor(){this._=void 0}}function Iy(r,e,t){return r instanceof wi?function(a,i){const o={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:a.seconds,nanos:a.nanoseconds}}}};return i&&Tl(i)&&(i=Sl(i)),i&&(o.fields.__previous_value__=i),{mapValue:o}}(t,e):r instanceof ca?nm(r,e):r instanceof da?am(r,e):function(a,i){const o=sm(a,i),c=Wd(o)+Wd(a.Pe);return tl(o)&&tl(a.Pe)?rm(c):Pl(a.serializer,c)}(r,e)}function Ty(r,e,t){return r instanceof ca?nm(r,e):r instanceof da?am(r,e):t}function sm(r,e){return r instanceof ki?function(n){return tl(n)||function(i){return!!i&&"doubleValue"in i}(n)}(e)?e:{integerValue:0}:null}class wi extends Gi{}class ca extends Gi{constructor(e){super(),this.elements=e}}function nm(r,e){const t=im(e);for(const n of r.elements)t.some(a=>Nr(a,n))||t.push(n);return{arrayValue:{values:t}}}class da extends Gi{constructor(e){super(),this.elements=e}}function am(r,e){let t=im(e);for(const n of r.elements)t=t.filter(a=>!Nr(a,n));return{arrayValue:{values:t}}}class ki extends Gi{constructor(e,t){super(),this.serializer=e,this.Pe=t}}function Wd(r){return xt(r.integerValue||r.doubleValue)}function im(r){return Al(r)&&r.arrayValue.values?r.arrayValue.values.slice():[]}function Sy(r,e){return r.field.isEqual(e.field)&&function(n,a){return n instanceof ca&&a instanceof ca||n instanceof da&&a instanceof da?un(n.elements,a.elements,Nr):n instanceof ki&&a instanceof ki?Nr(n.Pe,a.Pe):n instanceof wi&&a instanceof wi}(r.transform,e.transform)}class Ay{constructor(e,t){this.version=e,this.transformResults=t}}class mr{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new mr}static exists(e){return new mr(void 0,e)}static updateTime(e){return new mr(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function ii(r,e){return r.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(r.updateTime):r.exists===void 0||r.exists===e.isFoundDocument()}class Ki{}function om(r,e){if(!r.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return r.isNoDocument()?new Ml(r.key,mr.none()):new _a(r.key,r.data,mr.none());{const t=r.data,n=Kt.empty();let a=new Mt(Rt.comparator);for(let i of e.fields)if(!a.has(i)){let o=t.field(i);o===null&&i.length>1&&(i=i.popLast(),o=t.field(i)),o===null?n.delete(i):n.set(i,o),a=a.add(i)}return new bs(r.key,n,new rr(a.toArray()),mr.none())}}function Cy(r,e,t){r instanceof _a?function(a,i,o){const c=a.value.clone(),d=zd(a.fieldTransforms,i,o.transformResults);c.setAll(d),i.convertToFoundDocument(o.version,c).setHasCommittedMutations()}(r,e,t):r instanceof bs?function(a,i,o){if(!ii(a.precondition,i))return void i.convertToUnknownDocument(o.version);const c=zd(a.fieldTransforms,i,o.transformResults),d=i.data;d.setAll(lm(a)),d.setAll(c),i.convertToFoundDocument(o.version,d).setHasCommittedMutations()}(r,e,t):function(a,i,o){i.convertToNoDocument(o.version).setHasCommittedMutations()}(0,e,t)}function Qn(r,e,t,n){return r instanceof _a?function(i,o,c,d){if(!ii(i.precondition,o))return c;const h=i.value.clone(),g=Hd(i.fieldTransforms,d,o);return h.setAll(g),o.convertToFoundDocument(o.version,h).setHasLocalMutations(),null}(r,e,t,n):r instanceof bs?function(i,o,c,d){if(!ii(i.precondition,o))return c;const h=Hd(i.fieldTransforms,d,o),g=o.data;return g.setAll(lm(i)),g.setAll(h),o.convertToFoundDocument(o.version,g).setHasLocalMutations(),c===null?null:c.unionWith(i.fieldMask.fields).unionWith(i.fieldTransforms.map(x=>x.field))}(r,e,t,n):function(i,o,c){return ii(i.precondition,o)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):c}(r,e,t)}function Dy(r,e){let t=null;for(const n of r.fieldTransforms){const a=e.data.field(n.field),i=sm(n.transform,a||null);i!=null&&(t===null&&(t=Kt.empty()),t.set(n.field,i))}return t||null}function qd(r,e){return r.type===e.type&&!!r.key.isEqual(e.key)&&!!r.precondition.isEqual(e.precondition)&&!!function(n,a){return n===void 0&&a===void 0||!(!n||!a)&&un(n,a,(i,o)=>Sy(i,o))}(r.fieldTransforms,e.fieldTransforms)&&(r.type===0?r.value.isEqual(e.value):r.type!==1||r.data.isEqual(e.data)&&r.fieldMask.isEqual(e.fieldMask))}class _a extends Ki{constructor(e,t,n,a=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=a,this.type=0}getFieldMask(){return null}}class bs extends Ki{constructor(e,t,n,a,i=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=a,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function lm(r){const e=new Map;return r.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){const n=r.data.field(t);e.set(t,n)}}),e}function zd(r,e,t){const n=new Map;nt(r.length===t.length);for(let a=0;a<t.length;a++){const i=r[a],o=i.transform,c=e.data.field(i.field);n.set(i.field,Ty(o,c,t[a]))}return n}function Hd(r,e,t){const n=new Map;for(const a of r){const i=a.transform,o=t.data.field(a.field);n.set(a.field,Iy(i,o,e))}return n}class Ml extends Ki{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class Ry extends Ki{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Py{constructor(e,t,n,a){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=a}applyToRemoteDocument(e,t){const n=t.mutationResults;for(let a=0;a<this.mutations.length;a++){const i=this.mutations[a];i.key.isEqual(e.key)&&Cy(i,e,n[a])}}applyToLocalView(e,t){for(const n of this.baseMutations)n.key.isEqual(e.key)&&(t=Qn(n,e,t,this.localWriteTime));for(const n of this.mutations)n.key.isEqual(e.key)&&(t=Qn(n,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const n=tm();return this.mutations.forEach(a=>{const i=e.get(a.key),o=i.overlayedDocument;let c=this.applyToLocalView(o,i.mutatedFields);c=t.has(a.key)?null:c;const d=om(o,c);d!==null&&n.set(a.key,d),o.isValidDocument()||o.convertToNoDocument(Le.min())}),n}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),He())}isEqual(e){return this.batchId===e.batchId&&un(this.mutations,e.mutations,(t,n)=>qd(t,n))&&un(this.baseMutations,e.baseMutations,(t,n)=>qd(t,n))}}class $l{constructor(e,t,n,a){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=a}static from(e,t,n){nt(e.mutations.length===n.length);let a=function(){return ky}();const i=e.mutations;for(let o=0;o<i.length;o++)a=a.insert(i[o].key,n[o].version);return new $l(e,t,n,a)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class My{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $y{constructor(e,t){this.count=e,this.unchangedNames=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var yt,Ye;function Oy(r){switch(r){default:return Ve();case se.CANCELLED:case se.UNKNOWN:case se.DEADLINE_EXCEEDED:case se.RESOURCE_EXHAUSTED:case se.INTERNAL:case se.UNAVAILABLE:case se.UNAUTHENTICATED:return!1;case se.INVALID_ARGUMENT:case se.NOT_FOUND:case se.ALREADY_EXISTS:case se.PERMISSION_DENIED:case se.FAILED_PRECONDITION:case se.ABORTED:case se.OUT_OF_RANGE:case se.UNIMPLEMENTED:case se.DATA_LOSS:return!0}}function cm(r){if(r===void 0)return Wr("GRPC error has no .code"),se.UNKNOWN;switch(r){case yt.OK:return se.OK;case yt.CANCELLED:return se.CANCELLED;case yt.UNKNOWN:return se.UNKNOWN;case yt.DEADLINE_EXCEEDED:return se.DEADLINE_EXCEEDED;case yt.RESOURCE_EXHAUSTED:return se.RESOURCE_EXHAUSTED;case yt.INTERNAL:return se.INTERNAL;case yt.UNAVAILABLE:return se.UNAVAILABLE;case yt.UNAUTHENTICATED:return se.UNAUTHENTICATED;case yt.INVALID_ARGUMENT:return se.INVALID_ARGUMENT;case yt.NOT_FOUND:return se.NOT_FOUND;case yt.ALREADY_EXISTS:return se.ALREADY_EXISTS;case yt.PERMISSION_DENIED:return se.PERMISSION_DENIED;case yt.FAILED_PRECONDITION:return se.FAILED_PRECONDITION;case yt.ABORTED:return se.ABORTED;case yt.OUT_OF_RANGE:return se.OUT_OF_RANGE;case yt.UNIMPLEMENTED:return se.UNIMPLEMENTED;case yt.DATA_LOSS:return se.DATA_LOSS;default:return Ve()}}(Ye=yt||(yt={}))[Ye.OK=0]="OK",Ye[Ye.CANCELLED=1]="CANCELLED",Ye[Ye.UNKNOWN=2]="UNKNOWN",Ye[Ye.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Ye[Ye.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Ye[Ye.NOT_FOUND=5]="NOT_FOUND",Ye[Ye.ALREADY_EXISTS=6]="ALREADY_EXISTS",Ye[Ye.PERMISSION_DENIED=7]="PERMISSION_DENIED",Ye[Ye.UNAUTHENTICATED=16]="UNAUTHENTICATED",Ye[Ye.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Ye[Ye.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Ye[Ye.ABORTED=10]="ABORTED",Ye[Ye.OUT_OF_RANGE=11]="OUT_OF_RANGE",Ye[Ye.UNIMPLEMENTED=12]="UNIMPLEMENTED",Ye[Ye.INTERNAL=13]="INTERNAL",Ye[Ye.UNAVAILABLE=14]="UNAVAILABLE",Ye[Ye.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Vy(){return new TextEncoder}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ly=new As([4294967295,4294967295],0);function Gd(r){const e=Vy().encode(r),t=new Rh;return t.update(e),new Uint8Array(t.digest())}function Kd(r){const e=new DataView(r.buffer),t=e.getUint32(0,!0),n=e.getUint32(4,!0),a=e.getUint32(8,!0),i=e.getUint32(12,!0);return[new As([t,n],0),new As([a,i],0)]}class Ol{constructor(e,t,n){if(this.bitmap=e,this.padding=t,this.hashCount=n,t<0||t>=8)throw new qn(`Invalid padding: ${t}`);if(n<0)throw new qn(`Invalid hash count: ${n}`);if(e.length>0&&this.hashCount===0)throw new qn(`Invalid hash count: ${n}`);if(e.length===0&&t!==0)throw new qn(`Invalid padding when bitmap length is 0: ${t}`);this.Ie=8*e.length-t,this.Te=As.fromNumber(this.Ie)}Ee(e,t,n){let a=e.add(t.multiply(As.fromNumber(n)));return a.compare(Ly)===1&&(a=new As([a.getBits(0),a.getBits(1)],0)),a.modulo(this.Te).toNumber()}de(e){return(this.bitmap[Math.floor(e/8)]&1<<e%8)!=0}mightContain(e){if(this.Ie===0)return!1;const t=Gd(e),[n,a]=Kd(t);for(let i=0;i<this.hashCount;i++){const o=this.Ee(n,a,i);if(!this.de(o))return!1}return!0}static create(e,t,n){const a=e%8==0?0:8-e%8,i=new Uint8Array(Math.ceil(e/8)),o=new Ol(i,a,t);return n.forEach(c=>o.insert(c)),o}insert(e){if(this.Ie===0)return;const t=Gd(e),[n,a]=Kd(t);for(let i=0;i<this.hashCount;i++){const o=this.Ee(n,a,i);this.Ae(o)}}Ae(e){const t=Math.floor(e/8),n=e%8;this.bitmap[t]|=1<<n}}class qn extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yi{constructor(e,t,n,a,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=a,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,n){const a=new Map;return a.set(e,Na.createSynthesizedTargetChangeForCurrentChange(e,t,n)),new Yi(Le.min(),a,new ht(tt),qr(),He())}}class Na{constructor(e,t,n,a,i){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=a,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,n){return new Na(n,t,He(),He(),He())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oi{constructor(e,t,n,a){this.Re=e,this.removedTargetIds=t,this.key=n,this.Ve=a}}class dm{constructor(e,t){this.targetId=e,this.me=t}}class um{constructor(e,t,n=$t.EMPTY_BYTE_STRING,a=null){this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=a}}class Yd{constructor(){this.fe=0,this.ge=Xd(),this.pe=$t.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return this.fe!==0}get be(){return this.we}De(e){e.approximateByteSize()>0&&(this.we=!0,this.pe=e)}ve(){let e=He(),t=He(),n=He();return this.ge.forEach((a,i)=>{switch(i){case 0:e=e.add(a);break;case 2:t=t.add(a);break;case 1:n=n.add(a);break;default:Ve()}}),new Na(this.pe,this.ye,e,t,n)}Ce(){this.we=!1,this.ge=Xd()}Fe(e,t){this.we=!0,this.ge=this.ge.insert(e,t)}Me(e){this.we=!0,this.ge=this.ge.remove(e)}xe(){this.fe+=1}Oe(){this.fe-=1,nt(this.fe>=0)}Ne(){this.we=!0,this.ye=!0}}class Fy{constructor(e){this.Le=e,this.Be=new Map,this.ke=qr(),this.qe=Qd(),this.Qe=new ht(tt)}Ke(e){for(const t of e.Re)e.Ve&&e.Ve.isFoundDocument()?this.$e(t,e.Ve):this.Ue(t,e.key,e.Ve);for(const t of e.removedTargetIds)this.Ue(t,e.key,e.Ve)}We(e){this.forEachTarget(e,t=>{const n=this.Ge(t);switch(e.state){case 0:this.ze(t)&&n.De(e.resumeToken);break;case 1:n.Oe(),n.Se||n.Ce(),n.De(e.resumeToken);break;case 2:n.Oe(),n.Se||this.removeTarget(t);break;case 3:this.ze(t)&&(n.Ne(),n.De(e.resumeToken));break;case 4:this.ze(t)&&(this.je(t),n.De(e.resumeToken));break;default:Ve()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Be.forEach((n,a)=>{this.ze(a)&&t(a)})}He(e){const t=e.targetId,n=e.me.count,a=this.Je(t);if(a){const i=a.target;if(sl(i))if(n===0){const o=new Pe(i.path);this.Ue(t,o,Ut.newNoDocument(o,Le.min()))}else nt(n===1);else{const o=this.Ye(t);if(o!==n){const c=this.Ze(e),d=c?this.Xe(c,e,o):1;if(d!==0){this.je(t);const h=d===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Qe=this.Qe.insert(t,h)}}}}}Ze(e){const t=e.me.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:n="",padding:a=0},hashCount:i=0}=t;let o,c;try{o=Vs(n).toUint8Array()}catch(d){if(d instanceof Bh)return dn("Decoding the base64 bloom filter in existence filter failed ("+d.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw d}try{c=new Ol(o,a,i)}catch(d){return dn(d instanceof qn?"BloomFilter error: ":"Applying bloom filter failed: ",d),null}return c.Ie===0?null:c}Xe(e,t,n){return t.me.count===n-this.nt(e,t.targetId)?0:2}nt(e,t){const n=this.Le.getRemoteKeysForTarget(t);let a=0;return n.forEach(i=>{const o=this.Le.tt(),c=`projects/${o.projectId}/databases/${o.database}/documents/${i.path.canonicalString()}`;e.mightContain(c)||(this.Ue(t,i,null),a++)}),a}rt(e){const t=new Map;this.Be.forEach((i,o)=>{const c=this.Je(o);if(c){if(i.current&&sl(c.target)){const d=new Pe(c.target.path);this.ke.get(d)!==null||this.it(o,d)||this.Ue(o,d,Ut.newNoDocument(d,e))}i.be&&(t.set(o,i.ve()),i.Ce())}});let n=He();this.qe.forEach((i,o)=>{let c=!0;o.forEachWhile(d=>{const h=this.Je(d);return!h||h.purpose==="TargetPurposeLimboResolution"||(c=!1,!1)}),c&&(n=n.add(i))}),this.ke.forEach((i,o)=>o.setReadTime(e));const a=new Yi(e,t,this.Qe,this.ke,n);return this.ke=qr(),this.qe=Qd(),this.Qe=new ht(tt),a}$e(e,t){if(!this.ze(e))return;const n=this.it(e,t.key)?2:0;this.Ge(e).Fe(t.key,n),this.ke=this.ke.insert(t.key,t),this.qe=this.qe.insert(t.key,this.st(t.key).add(e))}Ue(e,t,n){if(!this.ze(e))return;const a=this.Ge(e);this.it(e,t)?a.Fe(t,1):a.Me(t),this.qe=this.qe.insert(t,this.st(t).delete(e)),n&&(this.ke=this.ke.insert(t,n))}removeTarget(e){this.Be.delete(e)}Ye(e){const t=this.Ge(e).ve();return this.Le.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}xe(e){this.Ge(e).xe()}Ge(e){let t=this.Be.get(e);return t||(t=new Yd,this.Be.set(e,t)),t}st(e){let t=this.qe.get(e);return t||(t=new Mt(tt),this.qe=this.qe.insert(e,t)),t}ze(e){const t=this.Je(e)!==null;return t||Te("WatchChangeAggregator","Detected inactive target",e),t}Je(e){const t=this.Be.get(e);return t&&t.Se?null:this.Le.ot(e)}je(e){this.Be.set(e,new Yd),this.Le.getRemoteKeysForTarget(e).forEach(t=>{this.Ue(e,t,null)})}it(e,t){return this.Le.getRemoteKeysForTarget(e).has(t)}}function Qd(){return new ht(Pe.comparator)}function Xd(){return new ht(Pe.comparator)}const Uy={asc:"ASCENDING",desc:"DESCENDING"},By={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},Wy={and:"AND",or:"OR"};class qy{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function il(r,e){return r.useProto3Json||qi(e)?e:{value:e}}function _i(r,e){return r.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function hm(r,e){return r.useProto3Json?e.toBase64():e.toUint8Array()}function zy(r,e){return _i(r,e.toTimestamp())}function wr(r){return nt(!!r),Le.fromTimestamp(function(t){const n=xs(t);return new jt(n.seconds,n.nanos)}(r))}function Vl(r,e){return ol(r,e).canonicalString()}function ol(r,e){const t=function(a){return new dt(["projects",a.projectId,"databases",a.database])}(r).child("documents");return e===void 0?t:t.child(e)}function mm(r){const e=dt.fromString(r);return nt(ym(e)),e}function ll(r,e){return Vl(r.databaseId,e.path)}function $o(r,e){const t=mm(e);if(t.get(1)!==r.databaseId.projectId)throw new je(se.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+r.databaseId.projectId);if(t.get(3)!==r.databaseId.database)throw new je(se.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+r.databaseId.database);return new Pe(pm(t))}function gm(r,e){return Vl(r.databaseId,e)}function Hy(r){const e=mm(r);return e.length===4?dt.emptyPath():pm(e)}function cl(r){return new dt(["projects",r.databaseId.projectId,"databases",r.databaseId.database]).canonicalString()}function pm(r){return nt(r.length>4&&r.get(4)==="documents"),r.popFirst(5)}function Jd(r,e,t){return{name:ll(r,e),fields:t.value.mapValue.fields}}function Gy(r,e){let t;if("targetChange"in e){e.targetChange;const n=function(h){return h==="NO_CHANGE"?0:h==="ADD"?1:h==="REMOVE"?2:h==="CURRENT"?3:h==="RESET"?4:Ve()}(e.targetChange.targetChangeType||"NO_CHANGE"),a=e.targetChange.targetIds||[],i=function(h,g){return h.useProto3Json?(nt(g===void 0||typeof g=="string"),$t.fromBase64String(g||"")):(nt(g===void 0||g instanceof Buffer||g instanceof Uint8Array),$t.fromUint8Array(g||new Uint8Array))}(r,e.targetChange.resumeToken),o=e.targetChange.cause,c=o&&function(h){const g=h.code===void 0?se.UNKNOWN:cm(h.code);return new je(g,h.message||"")}(o);t=new um(n,a,i,c||null)}else if("documentChange"in e){e.documentChange;const n=e.documentChange;n.document,n.document.name,n.document.updateTime;const a=$o(r,n.document.name),i=wr(n.document.updateTime),o=n.document.createTime?wr(n.document.createTime):Le.min(),c=new Kt({mapValue:{fields:n.document.fields}}),d=Ut.newFoundDocument(a,i,o,c),h=n.targetIds||[],g=n.removedTargetIds||[];t=new oi(h,g,d.key,d)}else if("documentDelete"in e){e.documentDelete;const n=e.documentDelete;n.document;const a=$o(r,n.document),i=n.readTime?wr(n.readTime):Le.min(),o=Ut.newNoDocument(a,i),c=n.removedTargetIds||[];t=new oi([],c,o.key,o)}else if("documentRemove"in e){e.documentRemove;const n=e.documentRemove;n.document;const a=$o(r,n.document),i=n.removedTargetIds||[];t=new oi([],i,a,null)}else{if(!("filter"in e))return Ve();{e.filter;const n=e.filter;n.targetId;const{count:a=0,unchangedNames:i}=n,o=new $y(a,i),c=n.targetId;t=new dm(c,o)}}return t}function Ky(r,e){let t;if(e instanceof _a)t={update:Jd(r,e.key,e.value)};else if(e instanceof Ml)t={delete:ll(r,e.key)};else if(e instanceof bs)t={update:Jd(r,e.key,e.data),updateMask:sb(e.fieldMask)};else{if(!(e instanceof Ry))return Ve();t={verify:ll(r,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(n=>function(i,o){const c=o.transform;if(c instanceof wi)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(c instanceof ca)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:c.elements}};if(c instanceof da)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:c.elements}};if(c instanceof ki)return{fieldPath:o.field.canonicalString(),increment:c.Pe};throw Ve()}(0,n))),e.precondition.isNone||(t.currentDocument=function(a,i){return i.updateTime!==void 0?{updateTime:zy(a,i.updateTime)}:i.exists!==void 0?{exists:i.exists}:Ve()}(r,e.precondition)),t}function Yy(r,e){return r&&r.length>0?(nt(e!==void 0),r.map(t=>function(a,i){let o=a.updateTime?wr(a.updateTime):wr(i);return o.isEqual(Le.min())&&(o=wr(i)),new Ay(o,a.transformResults||[])}(t,e))):[]}function Qy(r,e){return{documents:[gm(r,e.path)]}}function Xy(r,e){const t={structuredQuery:{}},n=e.path;let a;e.collectionGroup!==null?(a=n,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(a=n.popLast(),t.structuredQuery.from=[{collectionId:n.lastSegment()}]),t.parent=gm(r,a);const i=function(h){if(h.length!==0)return xm(gr.create(h,"and"))}(e.filters);i&&(t.structuredQuery.where=i);const o=function(h){if(h.length!==0)return h.map(g=>function(p){return{field:Xs(p.field),direction:eb(p.dir)}}(g))}(e.orderBy);o&&(t.structuredQuery.orderBy=o);const c=il(r,e.limit);return c!==null&&(t.structuredQuery.limit=c),e.startAt&&(t.structuredQuery.startAt=function(h){return{before:h.inclusive,values:h.position}}(e.startAt)),e.endAt&&(t.structuredQuery.endAt=function(h){return{before:!h.inclusive,values:h.position}}(e.endAt)),{_t:t,parent:a}}function Jy(r){let e=Hy(r.parent);const t=r.structuredQuery,n=t.from?t.from.length:0;let a=null;if(n>0){nt(n===1);const g=t.from[0];g.allDescendants?a=g.collectionId:e=e.child(g.collectionId)}let i=[];t.where&&(i=function(x){const p=fm(x);return p instanceof gr&&Hh(p)?p.getFilters():[p]}(t.where));let o=[];t.orderBy&&(o=function(x){return x.map(p=>function(A){return new la(Js(A.field),function(T){switch(T){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(A.direction))}(p))}(t.orderBy));let c=null;t.limit&&(c=function(x){let p;return p=typeof x=="object"?x.value:x,qi(p)?null:p}(t.limit));let d=null;t.startAt&&(d=function(x){const p=!!x.before,v=x.values||[];return new vi(v,p)}(t.startAt));let h=null;return t.endAt&&(h=function(x){const p=!x.before,v=x.values||[];return new vi(v,p)}(t.endAt)),xy(e,a,o,i,c,"F",d,h)}function Zy(r,e){const t=function(a){switch(a){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return Ve()}}(e.purpose);return t==null?null:{"goog-listen-tags":t}}function fm(r){return r.unaryFilter!==void 0?function(t){switch(t.unaryFilter.op){case"IS_NAN":const n=Js(t.unaryFilter.field);return vt.create(n,"==",{doubleValue:NaN});case"IS_NULL":const a=Js(t.unaryFilter.field);return vt.create(a,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const i=Js(t.unaryFilter.field);return vt.create(i,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const o=Js(t.unaryFilter.field);return vt.create(o,"!=",{nullValue:"NULL_VALUE"});default:return Ve()}}(r):r.fieldFilter!==void 0?function(t){return vt.create(Js(t.fieldFilter.field),function(a){switch(a){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return Ve()}}(t.fieldFilter.op),t.fieldFilter.value)}(r):r.compositeFilter!==void 0?function(t){return gr.create(t.compositeFilter.filters.map(n=>fm(n)),function(a){switch(a){case"AND":return"and";case"OR":return"or";default:return Ve()}}(t.compositeFilter.op))}(r):Ve()}function eb(r){return Uy[r]}function tb(r){return By[r]}function rb(r){return Wy[r]}function Xs(r){return{fieldPath:r.canonicalString()}}function Js(r){return Rt.fromServerFormat(r.fieldPath)}function xm(r){return r instanceof vt?function(t){if(t.op==="=="){if(Vd(t.value))return{unaryFilter:{field:Xs(t.field),op:"IS_NAN"}};if(Od(t.value))return{unaryFilter:{field:Xs(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(Vd(t.value))return{unaryFilter:{field:Xs(t.field),op:"IS_NOT_NAN"}};if(Od(t.value))return{unaryFilter:{field:Xs(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Xs(t.field),op:tb(t.op),value:t.value}}}(r):r instanceof gr?function(t){const n=t.getFilters().map(a=>xm(a));return n.length===1?n[0]:{compositeFilter:{op:rb(t.op),filters:n}}}(r):Ve()}function sb(r){const e=[];return r.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function ym(r){return r.length>=4&&r.get(0)==="projects"&&r.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ds{constructor(e,t,n,a,i=Le.min(),o=Le.min(),c=$t.EMPTY_BYTE_STRING,d=null){this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=a,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=c,this.expectedCount=d}withSequenceNumber(e){return new ds(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new ds(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new ds(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new ds(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nb{constructor(e){this.ct=e}}function ab(r){const e=Jy({parent:r.parent,structuredQuery:r.structuredQuery});return r.limitType==="LAST"?al(e,e.limit,"L"):e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ib{constructor(){this.un=new ob}addToCollectionParentIndex(e,t){return this.un.add(t),le.resolve()}getCollectionParents(e,t){return le.resolve(this.un.getEntries(t))}addFieldIndex(e,t){return le.resolve()}deleteFieldIndex(e,t){return le.resolve()}deleteAllFieldIndexes(e){return le.resolve()}createTargetIndexes(e,t){return le.resolve()}getDocumentsMatchingTarget(e,t){return le.resolve(null)}getIndexType(e,t){return le.resolve(0)}getFieldIndexes(e,t){return le.resolve([])}getNextCollectionGroupToUpdate(e){return le.resolve(null)}getMinOffset(e,t){return le.resolve(fs.min())}getMinOffsetFromCollectionGroup(e,t){return le.resolve(fs.min())}updateCollectionGroup(e,t,n){return le.resolve()}updateIndexEntries(e,t){return le.resolve()}}class ob{constructor(){this.index={}}add(e){const t=e.lastSegment(),n=e.popLast(),a=this.index[t]||new Mt(dt.comparator),i=!a.has(n);return this.index[t]=a.add(n),i}has(e){const t=e.lastSegment(),n=e.popLast(),a=this.index[t];return a&&a.has(n)}getEntries(e){return(this.index[e]||new Mt(dt.comparator)).toArray()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gn{constructor(e){this.Ln=e}next(){return this.Ln+=2,this.Ln}static Bn(){return new gn(0)}static kn(){return new gn(-1)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lb{constructor(){this.changes=new kn(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,Ut.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const n=this.changes.get(t);return n!==void 0?le.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cb{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class db{constructor(e,t,n,a){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=a}getDocument(e,t){let n=null;return this.documentOverlayCache.getOverlay(e,t).next(a=>(n=a,this.remoteDocumentCache.getEntry(e,t))).next(a=>(n!==null&&Qn(n.mutation,a,rr.empty(),jt.now()),a))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(n=>this.getLocalViewOfDocuments(e,n,He()).next(()=>n))}getLocalViewOfDocuments(e,t,n=He()){const a=Is();return this.populateOverlays(e,a,t).next(()=>this.computeViews(e,t,a,n).next(i=>{let o=Wn();return i.forEach((c,d)=>{o=o.insert(c,d.overlayedDocument)}),o}))}getOverlayedDocuments(e,t){const n=Is();return this.populateOverlays(e,n,t).next(()=>this.computeViews(e,t,n,He()))}populateOverlays(e,t,n){const a=[];return n.forEach(i=>{t.has(i)||a.push(i)}),this.documentOverlayCache.getOverlays(e,a).next(i=>{i.forEach((o,c)=>{t.set(o,c)})})}computeViews(e,t,n,a){let i=qr();const o=Yn(),c=function(){return Yn()}();return t.forEach((d,h)=>{const g=n.get(h.key);a.has(h.key)&&(g===void 0||g.mutation instanceof bs)?i=i.insert(h.key,h):g!==void 0?(o.set(h.key,g.mutation.getFieldMask()),Qn(g.mutation,h,g.mutation.getFieldMask(),jt.now())):o.set(h.key,rr.empty())}),this.recalculateAndSaveOverlays(e,i).next(d=>(d.forEach((h,g)=>o.set(h,g)),t.forEach((h,g)=>{var x;return c.set(h,new cb(g,(x=o.get(h))!==null&&x!==void 0?x:null))}),c))}recalculateAndSaveOverlays(e,t){const n=Yn();let a=new ht((o,c)=>o-c),i=He();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(o=>{for(const c of o)c.keys().forEach(d=>{const h=t.get(d);if(h===null)return;let g=n.get(d)||rr.empty();g=c.applyToLocalView(h,g),n.set(d,g);const x=(a.get(c.batchId)||He()).add(d);a=a.insert(c.batchId,x)})}).next(()=>{const o=[],c=a.getReverseIterator();for(;c.hasNext();){const d=c.getNext(),h=d.key,g=d.value,x=tm();g.forEach(p=>{if(!i.has(p)){const v=om(t.get(p),n.get(p));v!==null&&x.set(p,v),i=i.add(p)}}),o.push(this.documentOverlayCache.saveOverlays(e,h,x))}return le.waitFor(o)}).next(()=>n)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(n=>this.recalculateAndSaveOverlays(e,n))}getDocumentsMatchingQuery(e,t,n,a){return function(o){return Pe.isDocumentKey(o.path)&&o.collectionGroup===null&&o.filters.length===0}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):Qh(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n,a):this.getDocumentsMatchingCollectionQuery(e,t,n,a)}getNextDocuments(e,t,n,a){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,n,a).next(i=>{const o=a-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,n.largestBatchId,a-i.size):le.resolve(Is());let c=-1,d=i;return o.next(h=>le.forEach(h,(g,x)=>(c<x.largestBatchId&&(c=x.largestBatchId),i.get(g)?le.resolve():this.remoteDocumentCache.getEntry(e,g).next(p=>{d=d.insert(g,p)}))).next(()=>this.populateOverlays(e,h,i)).next(()=>this.computeViews(e,d,h,He())).next(g=>({batchId:c,changes:em(g)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new Pe(t)).next(n=>{let a=Wn();return n.isFoundDocument()&&(a=a.insert(n.key,n)),a})}getDocumentsMatchingCollectionGroupQuery(e,t,n,a){const i=t.collectionGroup;let o=Wn();return this.indexManager.getCollectionParents(e,i).next(c=>le.forEach(c,d=>{const h=function(x,p){return new wn(p,null,x.explicitOrderBy.slice(),x.filters.slice(),x.limit,x.limitType,x.startAt,x.endAt)}(t,d.child(i));return this.getDocumentsMatchingCollectionQuery(e,h,n,a).next(g=>{g.forEach((x,p)=>{o=o.insert(x,p)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(e,t,n,a){let i;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,n.largestBatchId).next(o=>(i=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,n,i,a))).next(o=>{i.forEach((d,h)=>{const g=h.getKey();o.get(g)===null&&(o=o.insert(g,Ut.newInvalidDocument(g)))});let c=Wn();return o.forEach((d,h)=>{const g=i.get(d);g!==void 0&&Qn(g.mutation,h,rr.empty(),jt.now()),Hi(t,h)&&(c=c.insert(d,h))}),c})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ub{constructor(e){this.serializer=e,this.hr=new Map,this.Pr=new Map}getBundleMetadata(e,t){return le.resolve(this.hr.get(t))}saveBundleMetadata(e,t){return this.hr.set(t.id,function(a){return{id:a.id,version:a.version,createTime:wr(a.createTime)}}(t)),le.resolve()}getNamedQuery(e,t){return le.resolve(this.Pr.get(t))}saveNamedQuery(e,t){return this.Pr.set(t.name,function(a){return{name:a.name,query:ab(a.bundledQuery),readTime:wr(a.readTime)}}(t)),le.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hb{constructor(){this.overlays=new ht(Pe.comparator),this.Ir=new Map}getOverlay(e,t){return le.resolve(this.overlays.get(t))}getOverlays(e,t){const n=Is();return le.forEach(t,a=>this.getOverlay(e,a).next(i=>{i!==null&&n.set(a,i)})).next(()=>n)}saveOverlays(e,t,n){return n.forEach((a,i)=>{this.ht(e,t,i)}),le.resolve()}removeOverlaysForBatchId(e,t,n){const a=this.Ir.get(n);return a!==void 0&&(a.forEach(i=>this.overlays=this.overlays.remove(i)),this.Ir.delete(n)),le.resolve()}getOverlaysForCollection(e,t,n){const a=Is(),i=t.length+1,o=new Pe(t.child("")),c=this.overlays.getIteratorFrom(o);for(;c.hasNext();){const d=c.getNext().value,h=d.getKey();if(!t.isPrefixOf(h.path))break;h.path.length===i&&d.largestBatchId>n&&a.set(d.getKey(),d)}return le.resolve(a)}getOverlaysForCollectionGroup(e,t,n,a){let i=new ht((h,g)=>h-g);const o=this.overlays.getIterator();for(;o.hasNext();){const h=o.getNext().value;if(h.getKey().getCollectionGroup()===t&&h.largestBatchId>n){let g=i.get(h.largestBatchId);g===null&&(g=Is(),i=i.insert(h.largestBatchId,g)),g.set(h.getKey(),h)}}const c=Is(),d=i.getIterator();for(;d.hasNext()&&(d.getNext().value.forEach((h,g)=>c.set(h,g)),!(c.size()>=a)););return le.resolve(c)}ht(e,t,n){const a=this.overlays.get(n.key);if(a!==null){const o=this.Ir.get(a.largestBatchId).delete(n.key);this.Ir.set(a.largestBatchId,o)}this.overlays=this.overlays.insert(n.key,new My(t,n));let i=this.Ir.get(t);i===void 0&&(i=He(),this.Ir.set(t,i)),this.Ir.set(t,i.add(n.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mb{constructor(){this.sessionToken=$t.EMPTY_BYTE_STRING}getSessionToken(e){return le.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,le.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ll{constructor(){this.Tr=new Mt(Et.Er),this.dr=new Mt(Et.Ar)}isEmpty(){return this.Tr.isEmpty()}addReference(e,t){const n=new Et(e,t);this.Tr=this.Tr.add(n),this.dr=this.dr.add(n)}Rr(e,t){e.forEach(n=>this.addReference(n,t))}removeReference(e,t){this.Vr(new Et(e,t))}mr(e,t){e.forEach(n=>this.removeReference(n,t))}gr(e){const t=new Pe(new dt([])),n=new Et(t,e),a=new Et(t,e+1),i=[];return this.dr.forEachInRange([n,a],o=>{this.Vr(o),i.push(o.key)}),i}pr(){this.Tr.forEach(e=>this.Vr(e))}Vr(e){this.Tr=this.Tr.delete(e),this.dr=this.dr.delete(e)}yr(e){const t=new Pe(new dt([])),n=new Et(t,e),a=new Et(t,e+1);let i=He();return this.dr.forEachInRange([n,a],o=>{i=i.add(o.key)}),i}containsKey(e){const t=new Et(e,0),n=this.Tr.firstAfterOrEqual(t);return n!==null&&e.isEqual(n.key)}}class Et{constructor(e,t){this.key=e,this.wr=t}static Er(e,t){return Pe.comparator(e.key,t.key)||tt(e.wr,t.wr)}static Ar(e,t){return tt(e.wr,t.wr)||Pe.comparator(e.key,t.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gb{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.Sr=1,this.br=new Mt(Et.Er)}checkEmpty(e){return le.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,n,a){const i=this.Sr;this.Sr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const o=new Py(i,t,n,a);this.mutationQueue.push(o);for(const c of a)this.br=this.br.add(new Et(c.key,i)),this.indexManager.addToCollectionParentIndex(e,c.key.path.popLast());return le.resolve(o)}lookupMutationBatch(e,t){return le.resolve(this.Dr(t))}getNextMutationBatchAfterBatchId(e,t){const n=t+1,a=this.vr(n),i=a<0?0:a;return le.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return le.resolve(this.mutationQueue.length===0?-1:this.Sr-1)}getAllMutationBatches(e){return le.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const n=new Et(t,0),a=new Et(t,Number.POSITIVE_INFINITY),i=[];return this.br.forEachInRange([n,a],o=>{const c=this.Dr(o.wr);i.push(c)}),le.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new Mt(tt);return t.forEach(a=>{const i=new Et(a,0),o=new Et(a,Number.POSITIVE_INFINITY);this.br.forEachInRange([i,o],c=>{n=n.add(c.wr)})}),le.resolve(this.Cr(n))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,a=n.length+1;let i=n;Pe.isDocumentKey(i)||(i=i.child(""));const o=new Et(new Pe(i),0);let c=new Mt(tt);return this.br.forEachWhile(d=>{const h=d.key.path;return!!n.isPrefixOf(h)&&(h.length===a&&(c=c.add(d.wr)),!0)},o),le.resolve(this.Cr(c))}Cr(e){const t=[];return e.forEach(n=>{const a=this.Dr(n);a!==null&&t.push(a)}),t}removeMutationBatch(e,t){nt(this.Fr(t.batchId,"removed")===0),this.mutationQueue.shift();let n=this.br;return le.forEach(t.mutations,a=>{const i=new Et(a.key,t.batchId);return n=n.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,a.key)}).next(()=>{this.br=n})}On(e){}containsKey(e,t){const n=new Et(t,0),a=this.br.firstAfterOrEqual(n);return le.resolve(t.isEqual(a&&a.key))}performConsistencyCheck(e){return this.mutationQueue.length,le.resolve()}Fr(e,t){return this.vr(e)}vr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Dr(e){const t=this.vr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pb{constructor(e){this.Mr=e,this.docs=function(){return new ht(Pe.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const n=t.key,a=this.docs.get(n),i=a?a.size:0,o=this.Mr(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:o}),this.size+=o-i,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const n=this.docs.get(t);return le.resolve(n?n.document.mutableCopy():Ut.newInvalidDocument(t))}getEntries(e,t){let n=qr();return t.forEach(a=>{const i=this.docs.get(a);n=n.insert(a,i?i.document.mutableCopy():Ut.newInvalidDocument(a))}),le.resolve(n)}getDocumentsMatchingQuery(e,t,n,a){let i=qr();const o=t.path,c=new Pe(o.child("")),d=this.docs.getIteratorFrom(c);for(;d.hasNext();){const{key:h,value:{document:g}}=d.getNext();if(!o.isPrefixOf(h.path))break;h.path.length>o.length+1||Jx(Xx(g),n)<=0||(a.has(g.key)||Hi(t,g))&&(i=i.insert(g.key,g.mutableCopy()))}return le.resolve(i)}getAllFromCollectionGroup(e,t,n,a){Ve()}Or(e,t){return le.forEach(this.docs,n=>t(n))}newChangeBuffer(e){return new fb(this)}getSize(e){return le.resolve(this.size)}}class fb extends lb{constructor(e){super(),this.cr=e}applyChanges(e){const t=[];return this.changes.forEach((n,a)=>{a.isValidDocument()?t.push(this.cr.addEntry(e,a)):this.cr.removeEntry(n)}),le.waitFor(t)}getFromCache(e,t){return this.cr.getEntry(e,t)}getAllFromCache(e,t){return this.cr.getEntries(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xb{constructor(e){this.persistence=e,this.Nr=new kn(t=>Cl(t),Dl),this.lastRemoteSnapshotVersion=Le.min(),this.highestTargetId=0,this.Lr=0,this.Br=new Ll,this.targetCount=0,this.kr=gn.Bn()}forEachTarget(e,t){return this.Nr.forEach((n,a)=>t(a)),le.resolve()}getLastRemoteSnapshotVersion(e){return le.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return le.resolve(this.Lr)}allocateTargetId(e){return this.highestTargetId=this.kr.next(),le.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.Lr&&(this.Lr=t),le.resolve()}Kn(e){this.Nr.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.kr=new gn(t),this.highestTargetId=t),e.sequenceNumber>this.Lr&&(this.Lr=e.sequenceNumber)}addTargetData(e,t){return this.Kn(t),this.targetCount+=1,le.resolve()}updateTargetData(e,t){return this.Kn(t),le.resolve()}removeTargetData(e,t){return this.Nr.delete(t.target),this.Br.gr(t.targetId),this.targetCount-=1,le.resolve()}removeTargets(e,t,n){let a=0;const i=[];return this.Nr.forEach((o,c)=>{c.sequenceNumber<=t&&n.get(c.targetId)===null&&(this.Nr.delete(o),i.push(this.removeMatchingKeysForTargetId(e,c.targetId)),a++)}),le.waitFor(i).next(()=>a)}getTargetCount(e){return le.resolve(this.targetCount)}getTargetData(e,t){const n=this.Nr.get(t)||null;return le.resolve(n)}addMatchingKeys(e,t,n){return this.Br.Rr(t,n),le.resolve()}removeMatchingKeys(e,t,n){this.Br.mr(t,n);const a=this.persistence.referenceDelegate,i=[];return a&&t.forEach(o=>{i.push(a.markPotentiallyOrphaned(e,o))}),le.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this.Br.gr(t),le.resolve()}getMatchingKeysForTargetId(e,t){const n=this.Br.yr(t);return le.resolve(n)}containsKey(e,t){return le.resolve(this.Br.containsKey(t))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yb{constructor(e,t){this.qr={},this.overlays={},this.Qr=new Il(0),this.Kr=!1,this.Kr=!0,this.$r=new mb,this.referenceDelegate=e(this),this.Ur=new xb(this),this.indexManager=new ib,this.remoteDocumentCache=function(a){return new pb(a)}(n=>this.referenceDelegate.Wr(n)),this.serializer=new nb(t),this.Gr=new ub(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Kr=!1,Promise.resolve()}get started(){return this.Kr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new hb,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this.qr[e.toKey()];return n||(n=new gb(t,this.referenceDelegate),this.qr[e.toKey()]=n),n}getGlobalsCache(){return this.$r}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Gr}runTransaction(e,t,n){Te("MemoryPersistence","Starting transaction:",e);const a=new bb(this.Qr.next());return this.referenceDelegate.zr(),n(a).next(i=>this.referenceDelegate.jr(a).next(()=>i)).toPromise().then(i=>(a.raiseOnCommittedEvent(),i))}Hr(e,t){return le.or(Object.values(this.qr).map(n=>()=>n.containsKey(e,t)))}}class bb extends ey{constructor(e){super(),this.currentSequenceNumber=e}}class Fl{constructor(e){this.persistence=e,this.Jr=new Ll,this.Yr=null}static Zr(e){return new Fl(e)}get Xr(){if(this.Yr)return this.Yr;throw Ve()}addReference(e,t,n){return this.Jr.addReference(n,t),this.Xr.delete(n.toString()),le.resolve()}removeReference(e,t,n){return this.Jr.removeReference(n,t),this.Xr.add(n.toString()),le.resolve()}markPotentiallyOrphaned(e,t){return this.Xr.add(t.toString()),le.resolve()}removeTarget(e,t){this.Jr.gr(t.targetId).forEach(a=>this.Xr.add(a.toString()));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next(a=>{a.forEach(i=>this.Xr.add(i.toString()))}).next(()=>n.removeTargetData(e,t))}zr(){this.Yr=new Set}jr(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return le.forEach(this.Xr,n=>{const a=Pe.fromPath(n);return this.ei(e,a).next(i=>{i||t.removeEntry(a,Le.min())})}).next(()=>(this.Yr=null,t.apply(e)))}updateLimboDocument(e,t){return this.ei(e,t).next(n=>{n?this.Xr.delete(t.toString()):this.Xr.add(t.toString())})}Wr(e){return 0}ei(e,t){return le.or([()=>le.resolve(this.Jr.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Hr(e,t)])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ul{constructor(e,t,n,a){this.targetId=e,this.fromCache=t,this.$i=n,this.Ui=a}static Wi(e,t){let n=He(),a=He();for(const i of t.docChanges)switch(i.type){case 0:n=n.add(i.doc.key);break;case 1:a=a.add(i.doc.key)}return new Ul(e,t.fromCache,n,a)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vb{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wb{constructor(){this.Gi=!1,this.zi=!1,this.ji=100,this.Hi=function(){return Nf()?8:ty(Bt())>0?6:4}()}initialize(e,t){this.Ji=e,this.indexManager=t,this.Gi=!0}getDocumentsMatchingQuery(e,t,n,a){const i={result:null};return this.Yi(e,t).next(o=>{i.result=o}).next(()=>{if(!i.result)return this.Zi(e,t,a,n).next(o=>{i.result=o})}).next(()=>{if(i.result)return;const o=new vb;return this.Xi(e,t,o).next(c=>{if(i.result=c,this.zi)return this.es(e,t,o,c.size)})}).next(()=>i.result)}es(e,t,n,a){return n.documentReadCount<this.ji?(On()<=Ke.DEBUG&&Te("QueryEngine","SDK will not create cache indexes for query:",Qs(t),"since it only creates cache indexes for collection contains","more than or equal to",this.ji,"documents"),le.resolve()):(On()<=Ke.DEBUG&&Te("QueryEngine","Query:",Qs(t),"scans",n.documentReadCount,"local documents and returns",a,"documents as results."),n.documentReadCount>this.Hi*a?(On()<=Ke.DEBUG&&Te("QueryEngine","The SDK decides to create cache indexes for query:",Qs(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,vr(t))):le.resolve())}Yi(e,t){if(Bd(t))return le.resolve(null);let n=vr(t);return this.indexManager.getIndexType(e,n).next(a=>a===0?null:(t.limit!==null&&a===1&&(t=al(t,null,"F"),n=vr(t)),this.indexManager.getDocumentsMatchingTarget(e,n).next(i=>{const o=He(...i);return this.Ji.getDocuments(e,o).next(c=>this.indexManager.getMinOffset(e,n).next(d=>{const h=this.ts(t,c);return this.ns(t,h,o,d.readTime)?this.Yi(e,al(t,null,"F")):this.rs(e,h,t,d)}))})))}Zi(e,t,n,a){return Bd(t)||a.isEqual(Le.min())?le.resolve(null):this.Ji.getDocuments(e,n).next(i=>{const o=this.ts(t,i);return this.ns(t,o,n,a)?le.resolve(null):(On()<=Ke.DEBUG&&Te("QueryEngine","Re-using previous result from %s to execute query: %s",a.toString(),Qs(t)),this.rs(e,o,t,Qx(a,-1)).next(c=>c))})}ts(e,t){let n=new Mt(Jh(e));return t.forEach((a,i)=>{Hi(e,i)&&(n=n.add(i))}),n}ns(e,t,n,a){if(e.limit===null)return!1;if(n.size!==t.size)return!0;const i=e.limitType==="F"?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(a)>0)}Xi(e,t,n){return On()<=Ke.DEBUG&&Te("QueryEngine","Using full collection scan to execute query:",Qs(t)),this.Ji.getDocumentsMatchingQuery(e,t,fs.min(),n)}rs(e,t,n,a){return this.Ji.getDocumentsMatchingQuery(e,n,a).next(i=>(t.forEach(o=>{i=i.insert(o.key,o)}),i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kb{constructor(e,t,n,a){this.persistence=e,this.ss=t,this.serializer=a,this.os=new ht(tt),this._s=new kn(i=>Cl(i),Dl),this.us=new Map,this.cs=e.getRemoteDocumentCache(),this.Ur=e.getTargetCache(),this.Gr=e.getBundleCache(),this.ls(n)}ls(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new db(this.cs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.cs.setIndexManager(this.indexManager),this.ss.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.os))}}function _b(r,e,t,n){return new kb(r,e,t,n)}async function bm(r,e){const t=Fe(r);return await t.persistence.runTransaction("Handle user change","readonly",n=>{let a;return t.mutationQueue.getAllMutationBatches(n).next(i=>(a=i,t.ls(e),t.mutationQueue.getAllMutationBatches(n))).next(i=>{const o=[],c=[];let d=He();for(const h of a){o.push(h.batchId);for(const g of h.mutations)d=d.add(g.key)}for(const h of i){c.push(h.batchId);for(const g of h.mutations)d=d.add(g.key)}return t.localDocuments.getDocuments(n,d).next(h=>({hs:h,removedBatchIds:o,addedBatchIds:c}))})})}function Nb(r,e){const t=Fe(r);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",n=>{const a=e.batch.keys(),i=t.cs.newChangeBuffer({trackRemovals:!0});return function(c,d,h,g){const x=h.batch,p=x.keys();let v=le.resolve();return p.forEach(A=>{v=v.next(()=>g.getEntry(d,A)).next(C=>{const T=h.docVersions.get(A);nt(T!==null),C.version.compareTo(T)<0&&(x.applyToRemoteDocument(C,h),C.isValidDocument()&&(C.setReadTime(h.commitVersion),g.addEntry(C)))})}),v.next(()=>c.mutationQueue.removeMutationBatch(d,x))}(t,n,e,i).next(()=>i.apply(n)).next(()=>t.mutationQueue.performConsistencyCheck(n)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(n,a,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(n,function(c){let d=He();for(let h=0;h<c.mutationResults.length;++h)c.mutationResults[h].transformResults.length>0&&(d=d.add(c.batch.mutations[h].key));return d}(e))).next(()=>t.localDocuments.getDocuments(n,a))})}function vm(r){const e=Fe(r);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Ur.getLastRemoteSnapshotVersion(t))}function jb(r,e){const t=Fe(r),n=e.snapshotVersion;let a=t.os;return t.persistence.runTransaction("Apply remote event","readwrite-primary",i=>{const o=t.cs.newChangeBuffer({trackRemovals:!0});a=t.os;const c=[];e.targetChanges.forEach((g,x)=>{const p=a.get(x);if(!p)return;c.push(t.Ur.removeMatchingKeys(i,g.removedDocuments,x).next(()=>t.Ur.addMatchingKeys(i,g.addedDocuments,x)));let v=p.withSequenceNumber(i.currentSequenceNumber);e.targetMismatches.get(x)!==null?v=v.withResumeToken($t.EMPTY_BYTE_STRING,Le.min()).withLastLimboFreeSnapshotVersion(Le.min()):g.resumeToken.approximateByteSize()>0&&(v=v.withResumeToken(g.resumeToken,n)),a=a.insert(x,v),function(C,T,z){return C.resumeToken.approximateByteSize()===0||T.snapshotVersion.toMicroseconds()-C.snapshotVersion.toMicroseconds()>=3e8?!0:z.addedDocuments.size+z.modifiedDocuments.size+z.removedDocuments.size>0}(p,v,g)&&c.push(t.Ur.updateTargetData(i,v))});let d=qr(),h=He();if(e.documentUpdates.forEach(g=>{e.resolvedLimboDocuments.has(g)&&c.push(t.persistence.referenceDelegate.updateLimboDocument(i,g))}),c.push(Eb(i,o,e.documentUpdates).next(g=>{d=g.Ps,h=g.Is})),!n.isEqual(Le.min())){const g=t.Ur.getLastRemoteSnapshotVersion(i).next(x=>t.Ur.setTargetsMetadata(i,i.currentSequenceNumber,n));c.push(g)}return le.waitFor(c).next(()=>o.apply(i)).next(()=>t.localDocuments.getLocalViewOfDocuments(i,d,h)).next(()=>d)}).then(i=>(t.os=a,i))}function Eb(r,e,t){let n=He(),a=He();return t.forEach(i=>n=n.add(i)),e.getEntries(r,n).next(i=>{let o=qr();return t.forEach((c,d)=>{const h=i.get(c);d.isFoundDocument()!==h.isFoundDocument()&&(a=a.add(c)),d.isNoDocument()&&d.version.isEqual(Le.min())?(e.removeEntry(c,d.readTime),o=o.insert(c,d)):!h.isValidDocument()||d.version.compareTo(h.version)>0||d.version.compareTo(h.version)===0&&h.hasPendingWrites?(e.addEntry(d),o=o.insert(c,d)):Te("LocalStore","Ignoring outdated watch update for ",c,". Current version:",h.version," Watch version:",d.version)}),{Ps:o,Is:a}})}function Ib(r,e){const t=Fe(r);return t.persistence.runTransaction("Get next mutation batch","readonly",n=>(e===void 0&&(e=-1),t.mutationQueue.getNextMutationBatchAfterBatchId(n,e)))}function Tb(r,e){const t=Fe(r);return t.persistence.runTransaction("Allocate target","readwrite",n=>{let a;return t.Ur.getTargetData(n,e).next(i=>i?(a=i,le.resolve(a)):t.Ur.allocateTargetId(n).next(o=>(a=new ds(e,o,"TargetPurposeListen",n.currentSequenceNumber),t.Ur.addTargetData(n,a).next(()=>a))))}).then(n=>{const a=t.os.get(n.targetId);return(a===null||n.snapshotVersion.compareTo(a.snapshotVersion)>0)&&(t.os=t.os.insert(n.targetId,n),t._s.set(e,n.targetId)),n})}async function dl(r,e,t){const n=Fe(r),a=n.os.get(e),i=t?"readwrite":"readwrite-primary";try{t||await n.persistence.runTransaction("Release target",i,o=>n.persistence.referenceDelegate.removeTarget(o,a))}catch(o){if(!ka(o))throw o;Te("LocalStore",`Failed to update sequence numbers for target ${e}: ${o}`)}n.os=n.os.remove(e),n._s.delete(a.target)}function Zd(r,e,t){const n=Fe(r);let a=Le.min(),i=He();return n.persistence.runTransaction("Execute query","readwrite",o=>function(d,h,g){const x=Fe(d),p=x._s.get(g);return p!==void 0?le.resolve(x.os.get(p)):x.Ur.getTargetData(h,g)}(n,o,vr(e)).next(c=>{if(c)return a=c.lastLimboFreeSnapshotVersion,n.Ur.getMatchingKeysForTargetId(o,c.targetId).next(d=>{i=d})}).next(()=>n.ss.getDocumentsMatchingQuery(o,e,t?a:Le.min(),t?i:He())).next(c=>(Sb(n,by(e),c),{documents:c,Ts:i})))}function Sb(r,e,t){let n=r.us.get(e)||Le.min();t.forEach((a,i)=>{i.readTime.compareTo(n)>0&&(n=i.readTime)}),r.us.set(e,n)}class eu{constructor(){this.activeTargetIds=jy()}fs(e){this.activeTargetIds=this.activeTargetIds.add(e)}gs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Vs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class Ab{constructor(){this.so=new eu,this.oo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e,t=!0){return t&&this.so.fs(e),this.oo[e]||"not-current"}updateQueryState(e,t,n){this.oo[e]=t}removeLocalQueryTarget(e){this.so.gs(e)}isLocalQueryTarget(e){return this.so.activeTargetIds.has(e)}clearQueryState(e){delete this.oo[e]}getAllActiveQueryTargets(){return this.so.activeTargetIds}isActiveQueryTarget(e){return this.so.activeTargetIds.has(e)}start(){return this.so=new eu,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cb{_o(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tu{constructor(){this.ao=()=>this.uo(),this.co=()=>this.lo(),this.ho=[],this.Po()}_o(e){this.ho.push(e)}shutdown(){window.removeEventListener("online",this.ao),window.removeEventListener("offline",this.co)}Po(){window.addEventListener("online",this.ao),window.addEventListener("offline",this.co)}uo(){Te("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.ho)e(0)}lo(){Te("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.ho)e(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Qa=null;function Oo(){return Qa===null?Qa=function(){return 268435456+Math.round(2147483648*Math.random())}():Qa++,"0x"+Qa.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Db={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rb{constructor(e){this.Io=e.Io,this.To=e.To}Eo(e){this.Ao=e}Ro(e){this.Vo=e}mo(e){this.fo=e}onMessage(e){this.po=e}close(){this.To()}send(e){this.Io(e)}yo(){this.Ao()}wo(){this.Vo()}So(e){this.fo(e)}bo(e){this.po(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Lt="WebChannelConnection";class Pb extends class{constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const n=t.ssl?"https":"http",a=encodeURIComponent(this.databaseId.projectId),i=encodeURIComponent(this.databaseId.database);this.Do=n+"://"+t.host,this.vo=`projects/${a}/databases/${i}`,this.Co=this.databaseId.database==="(default)"?`project_id=${a}`:`project_id=${a}&database_id=${i}`}get Fo(){return!1}Mo(t,n,a,i,o){const c=Oo(),d=this.xo(t,n.toUriEncodedString());Te("RestConnection",`Sending RPC '${t}' ${c}:`,d,a);const h={"google-cloud-resource-prefix":this.vo,"x-goog-request-params":this.Co};return this.Oo(h,i,o),this.No(t,d,h,a).then(g=>(Te("RestConnection",`Received RPC '${t}' ${c}: `,g),g),g=>{throw dn("RestConnection",`RPC '${t}' ${c} failed with error: `,g,"url: ",d,"request:",a),g})}Lo(t,n,a,i,o,c){return this.Mo(t,n,a,i,o)}Oo(t,n,a){t["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+vn}(),t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),n&&n.headers.forEach((i,o)=>t[o]=i),a&&a.headers.forEach((i,o)=>t[o]=i)}xo(t,n){const a=Db[t];return`${this.Do}/v1/${n}:${a}`}terminate(){}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}No(e,t,n,a){const i=Oo();return new Promise((o,c)=>{const d=new Ph;d.setWithCredentials(!0),d.listenOnce(Mh.COMPLETE,()=>{try{switch(d.getLastErrorCode()){case ni.NO_ERROR:const g=d.getResponseJson();Te(Lt,`XHR for RPC '${e}' ${i} received:`,JSON.stringify(g)),o(g);break;case ni.TIMEOUT:Te(Lt,`RPC '${e}' ${i} timed out`),c(new je(se.DEADLINE_EXCEEDED,"Request time out"));break;case ni.HTTP_ERROR:const x=d.getStatus();if(Te(Lt,`RPC '${e}' ${i} failed with status:`,x,"response text:",d.getResponseText()),x>0){let p=d.getResponseJson();Array.isArray(p)&&(p=p[0]);const v=p==null?void 0:p.error;if(v&&v.status&&v.message){const A=function(T){const z=T.toLowerCase().replace(/_/g,"-");return Object.values(se).indexOf(z)>=0?z:se.UNKNOWN}(v.status);c(new je(A,v.message))}else c(new je(se.UNKNOWN,"Server responded with status "+d.getStatus()))}else c(new je(se.UNAVAILABLE,"Connection failed."));break;default:Ve()}}finally{Te(Lt,`RPC '${e}' ${i} completed.`)}});const h=JSON.stringify(a);Te(Lt,`RPC '${e}' ${i} sending request:`,a),d.send(t,"POST",h,n,15)})}Bo(e,t,n){const a=Oo(),i=[this.Do,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=Vh(),c=Oh(),d={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},h=this.longPollingOptions.timeoutSeconds;h!==void 0&&(d.longPollingTimeout=Math.round(1e3*h)),this.useFetchStreams&&(d.useFetchStreams=!0),this.Oo(d.initMessageHeaders,t,n),d.encodeInitMessageHeaders=!0;const g=i.join("");Te(Lt,`Creating RPC '${e}' stream ${a}: ${g}`,d);const x=o.createWebChannel(g,d);let p=!1,v=!1;const A=new Rb({Io:T=>{v?Te(Lt,`Not sending because RPC '${e}' stream ${a} is closed:`,T):(p||(Te(Lt,`Opening RPC '${e}' stream ${a} transport.`),x.open(),p=!0),Te(Lt,`RPC '${e}' stream ${a} sending:`,T),x.send(T))},To:()=>x.close()}),C=(T,z,$)=>{T.listen(z,S=>{try{$(S)}catch(I){setTimeout(()=>{throw I},0)}})};return C(x,Bn.EventType.OPEN,()=>{v||(Te(Lt,`RPC '${e}' stream ${a} transport opened.`),A.yo())}),C(x,Bn.EventType.CLOSE,()=>{v||(v=!0,Te(Lt,`RPC '${e}' stream ${a} transport closed`),A.So())}),C(x,Bn.EventType.ERROR,T=>{v||(v=!0,dn(Lt,`RPC '${e}' stream ${a} transport errored:`,T),A.So(new je(se.UNAVAILABLE,"The operation could not be completed")))}),C(x,Bn.EventType.MESSAGE,T=>{var z;if(!v){const $=T.data[0];nt(!!$);const S=$,I=S.error||((z=S[0])===null||z===void 0?void 0:z.error);if(I){Te(Lt,`RPC '${e}' stream ${a} received error:`,I);const H=I.status;let G=function(w){const k=yt[w];if(k!==void 0)return cm(k)}(H),E=I.message;G===void 0&&(G=se.INTERNAL,E="Unknown error status: "+H+" with message "+I.message),v=!0,A.So(new je(G,E)),x.close()}else Te(Lt,`RPC '${e}' stream ${a} received:`,$),A.bo($)}}),C(c,$h.STAT_EVENT,T=>{T.stat===Zo.PROXY?Te(Lt,`RPC '${e}' stream ${a} detected buffering proxy`):T.stat===Zo.NOPROXY&&Te(Lt,`RPC '${e}' stream ${a} detected no buffering proxy`)}),setTimeout(()=>{A.wo()},0),A}}function Vo(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Qi(r){return new qy(r,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wm{constructor(e,t,n=1e3,a=1.5,i=6e4){this.ui=e,this.timerId=t,this.ko=n,this.qo=a,this.Qo=i,this.Ko=0,this.$o=null,this.Uo=Date.now(),this.reset()}reset(){this.Ko=0}Wo(){this.Ko=this.Qo}Go(e){this.cancel();const t=Math.floor(this.Ko+this.zo()),n=Math.max(0,Date.now()-this.Uo),a=Math.max(0,t-n);a>0&&Te("ExponentialBackoff",`Backing off for ${a} ms (base delay: ${this.Ko} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.$o=this.ui.enqueueAfterDelay(this.timerId,a,()=>(this.Uo=Date.now(),e())),this.Ko*=this.qo,this.Ko<this.ko&&(this.Ko=this.ko),this.Ko>this.Qo&&(this.Ko=this.Qo)}jo(){this.$o!==null&&(this.$o.skipDelay(),this.$o=null)}cancel(){this.$o!==null&&(this.$o.cancel(),this.$o=null)}zo(){return(Math.random()-.5)*this.Ko}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class km{constructor(e,t,n,a,i,o,c,d){this.ui=e,this.Ho=n,this.Jo=a,this.connection=i,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=c,this.listener=d,this.state=0,this.Yo=0,this.Zo=null,this.Xo=null,this.stream=null,this.e_=0,this.t_=new wm(e,t)}n_(){return this.state===1||this.state===5||this.r_()}r_(){return this.state===2||this.state===3}start(){this.e_=0,this.state!==4?this.auth():this.i_()}async stop(){this.n_()&&await this.close(0)}s_(){this.state=0,this.t_.reset()}o_(){this.r_()&&this.Zo===null&&(this.Zo=this.ui.enqueueAfterDelay(this.Ho,6e4,()=>this.__()))}a_(e){this.u_(),this.stream.send(e)}async __(){if(this.r_())return this.close(0)}u_(){this.Zo&&(this.Zo.cancel(),this.Zo=null)}c_(){this.Xo&&(this.Xo.cancel(),this.Xo=null)}async close(e,t){this.u_(),this.c_(),this.t_.cancel(),this.Yo++,e!==4?this.t_.reset():t&&t.code===se.RESOURCE_EXHAUSTED?(Wr(t.toString()),Wr("Using maximum backoff delay to prevent overloading the backend."),this.t_.Wo()):t&&t.code===se.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.l_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.mo(t)}l_(){}auth(){this.state=1;const e=this.h_(this.Yo),t=this.Yo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([n,a])=>{this.Yo===t&&this.P_(n,a)},n=>{e(()=>{const a=new je(se.UNKNOWN,"Fetching auth token failed: "+n.message);return this.I_(a)})})}P_(e,t){const n=this.h_(this.Yo);this.stream=this.T_(e,t),this.stream.Eo(()=>{n(()=>this.listener.Eo())}),this.stream.Ro(()=>{n(()=>(this.state=2,this.Xo=this.ui.enqueueAfterDelay(this.Jo,1e4,()=>(this.r_()&&(this.state=3),Promise.resolve())),this.listener.Ro()))}),this.stream.mo(a=>{n(()=>this.I_(a))}),this.stream.onMessage(a=>{n(()=>++this.e_==1?this.E_(a):this.onNext(a))})}i_(){this.state=5,this.t_.Go(async()=>{this.state=0,this.start()})}I_(e){return Te("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}h_(e){return t=>{this.ui.enqueueAndForget(()=>this.Yo===e?t():(Te("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class Mb extends km{constructor(e,t,n,a,i,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,a,o),this.serializer=i}T_(e,t){return this.connection.Bo("Listen",e,t)}E_(e){return this.onNext(e)}onNext(e){this.t_.reset();const t=Gy(this.serializer,e),n=function(i){if(!("targetChange"in i))return Le.min();const o=i.targetChange;return o.targetIds&&o.targetIds.length?Le.min():o.readTime?wr(o.readTime):Le.min()}(e);return this.listener.d_(t,n)}A_(e){const t={};t.database=cl(this.serializer),t.addTarget=function(i,o){let c;const d=o.target;if(c=sl(d)?{documents:Qy(i,d)}:{query:Xy(i,d)._t},c.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){c.resumeToken=hm(i,o.resumeToken);const h=il(i,o.expectedCount);h!==null&&(c.expectedCount=h)}else if(o.snapshotVersion.compareTo(Le.min())>0){c.readTime=_i(i,o.snapshotVersion.toTimestamp());const h=il(i,o.expectedCount);h!==null&&(c.expectedCount=h)}return c}(this.serializer,e);const n=Zy(this.serializer,e);n&&(t.labels=n),this.a_(t)}R_(e){const t={};t.database=cl(this.serializer),t.removeTarget=e,this.a_(t)}}class $b extends km{constructor(e,t,n,a,i,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,a,o),this.serializer=i}get V_(){return this.e_>0}start(){this.lastStreamToken=void 0,super.start()}l_(){this.V_&&this.m_([])}T_(e,t){return this.connection.Bo("Write",e,t)}E_(e){return nt(!!e.streamToken),this.lastStreamToken=e.streamToken,nt(!e.writeResults||e.writeResults.length===0),this.listener.f_()}onNext(e){nt(!!e.streamToken),this.lastStreamToken=e.streamToken,this.t_.reset();const t=Yy(e.writeResults,e.commitTime),n=wr(e.commitTime);return this.listener.g_(n,t)}p_(){const e={};e.database=cl(this.serializer),this.a_(e)}m_(e){const t={streamToken:this.lastStreamToken,writes:e.map(n=>Ky(this.serializer,n))};this.a_(t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ob extends class{}{constructor(e,t,n,a){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=n,this.serializer=a,this.y_=!1}w_(){if(this.y_)throw new je(se.FAILED_PRECONDITION,"The client has already been terminated.")}Mo(e,t,n,a){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,o])=>this.connection.Mo(e,ol(t,n),a,i,o)).catch(i=>{throw i.name==="FirebaseError"?(i.code===se.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),i):new je(se.UNKNOWN,i.toString())})}Lo(e,t,n,a,i){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,c])=>this.connection.Lo(e,ol(t,n),a,o,c,i)).catch(o=>{throw o.name==="FirebaseError"?(o.code===se.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new je(se.UNKNOWN,o.toString())})}terminate(){this.y_=!0,this.connection.terminate()}}class Vb{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.S_=0,this.b_=null,this.D_=!0}v_(){this.S_===0&&(this.C_("Unknown"),this.b_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.b_=null,this.F_("Backend didn't respond within 10 seconds."),this.C_("Offline"),Promise.resolve())))}M_(e){this.state==="Online"?this.C_("Unknown"):(this.S_++,this.S_>=1&&(this.x_(),this.F_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.C_("Offline")))}set(e){this.x_(),this.S_=0,e==="Online"&&(this.D_=!1),this.C_(e)}C_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}F_(e){const t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.D_?(Wr(t),this.D_=!1):Te("OnlineStateTracker",t)}x_(){this.b_!==null&&(this.b_.cancel(),this.b_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lb{constructor(e,t,n,a,i){this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.O_=[],this.N_=new Map,this.L_=new Set,this.B_=[],this.k_=i,this.k_._o(o=>{n.enqueueAndForget(async()=>{Ws(this)&&(Te("RemoteStore","Restarting streams for network reachability change."),await async function(d){const h=Fe(d);h.L_.add(4),await ja(h),h.q_.set("Unknown"),h.L_.delete(4),await Xi(h)}(this))})}),this.q_=new Vb(n,a)}}async function Xi(r){if(Ws(r))for(const e of r.B_)await e(!0)}async function ja(r){for(const e of r.B_)await e(!1)}function _m(r,e){const t=Fe(r);t.N_.has(e.targetId)||(t.N_.set(e.targetId,e),zl(t)?ql(t):_n(t).r_()&&Wl(t,e))}function Bl(r,e){const t=Fe(r),n=_n(t);t.N_.delete(e),n.r_()&&Nm(t,e),t.N_.size===0&&(n.r_()?n.o_():Ws(t)&&t.q_.set("Unknown"))}function Wl(r,e){if(r.Q_.xe(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(Le.min())>0){const t=r.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}_n(r).A_(e)}function Nm(r,e){r.Q_.xe(e),_n(r).R_(e)}function ql(r){r.Q_=new Fy({getRemoteKeysForTarget:e=>r.remoteSyncer.getRemoteKeysForTarget(e),ot:e=>r.N_.get(e)||null,tt:()=>r.datastore.serializer.databaseId}),_n(r).start(),r.q_.v_()}function zl(r){return Ws(r)&&!_n(r).n_()&&r.N_.size>0}function Ws(r){return Fe(r).L_.size===0}function jm(r){r.Q_=void 0}async function Fb(r){r.q_.set("Online")}async function Ub(r){r.N_.forEach((e,t)=>{Wl(r,e)})}async function Bb(r,e){jm(r),zl(r)?(r.q_.M_(e),ql(r)):r.q_.set("Unknown")}async function Wb(r,e,t){if(r.q_.set("Online"),e instanceof um&&e.state===2&&e.cause)try{await async function(a,i){const o=i.cause;for(const c of i.targetIds)a.N_.has(c)&&(await a.remoteSyncer.rejectListen(c,o),a.N_.delete(c),a.Q_.removeTarget(c))}(r,e)}catch(n){Te("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),n),await Ni(r,n)}else if(e instanceof oi?r.Q_.Ke(e):e instanceof dm?r.Q_.He(e):r.Q_.We(e),!t.isEqual(Le.min()))try{const n=await vm(r.localStore);t.compareTo(n)>=0&&await function(i,o){const c=i.Q_.rt(o);return c.targetChanges.forEach((d,h)=>{if(d.resumeToken.approximateByteSize()>0){const g=i.N_.get(h);g&&i.N_.set(h,g.withResumeToken(d.resumeToken,o))}}),c.targetMismatches.forEach((d,h)=>{const g=i.N_.get(d);if(!g)return;i.N_.set(d,g.withResumeToken($t.EMPTY_BYTE_STRING,g.snapshotVersion)),Nm(i,d);const x=new ds(g.target,d,h,g.sequenceNumber);Wl(i,x)}),i.remoteSyncer.applyRemoteEvent(c)}(r,t)}catch(n){Te("RemoteStore","Failed to raise snapshot:",n),await Ni(r,n)}}async function Ni(r,e,t){if(!ka(e))throw e;r.L_.add(1),await ja(r),r.q_.set("Offline"),t||(t=()=>vm(r.localStore)),r.asyncQueue.enqueueRetryable(async()=>{Te("RemoteStore","Retrying IndexedDB access"),await t(),r.L_.delete(1),await Xi(r)})}function Em(r,e){return e().catch(t=>Ni(r,t,e))}async function Ji(r){const e=Fe(r),t=ys(e);let n=e.O_.length>0?e.O_[e.O_.length-1].batchId:-1;for(;qb(e);)try{const a=await Ib(e.localStore,n);if(a===null){e.O_.length===0&&t.o_();break}n=a.batchId,zb(e,a)}catch(a){await Ni(e,a)}Im(e)&&Tm(e)}function qb(r){return Ws(r)&&r.O_.length<10}function zb(r,e){r.O_.push(e);const t=ys(r);t.r_()&&t.V_&&t.m_(e.mutations)}function Im(r){return Ws(r)&&!ys(r).n_()&&r.O_.length>0}function Tm(r){ys(r).start()}async function Hb(r){ys(r).p_()}async function Gb(r){const e=ys(r);for(const t of r.O_)e.m_(t.mutations)}async function Kb(r,e,t){const n=r.O_.shift(),a=$l.from(n,e,t);await Em(r,()=>r.remoteSyncer.applySuccessfulWrite(a)),await Ji(r)}async function Yb(r,e){e&&ys(r).V_&&await async function(n,a){if(function(o){return Oy(o)&&o!==se.ABORTED}(a.code)){const i=n.O_.shift();ys(n).s_(),await Em(n,()=>n.remoteSyncer.rejectFailedWrite(i.batchId,a)),await Ji(n)}}(r,e),Im(r)&&Tm(r)}async function ru(r,e){const t=Fe(r);t.asyncQueue.verifyOperationInProgress(),Te("RemoteStore","RemoteStore received new credentials");const n=Ws(t);t.L_.add(3),await ja(t),n&&t.q_.set("Unknown"),await t.remoteSyncer.handleCredentialChange(e),t.L_.delete(3),await Xi(t)}async function Qb(r,e){const t=Fe(r);e?(t.L_.delete(2),await Xi(t)):e||(t.L_.add(2),await ja(t),t.q_.set("Unknown"))}function _n(r){return r.K_||(r.K_=function(t,n,a){const i=Fe(t);return i.w_(),new Mb(n,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,a)}(r.datastore,r.asyncQueue,{Eo:Fb.bind(null,r),Ro:Ub.bind(null,r),mo:Bb.bind(null,r),d_:Wb.bind(null,r)}),r.B_.push(async e=>{e?(r.K_.s_(),zl(r)?ql(r):r.q_.set("Unknown")):(await r.K_.stop(),jm(r))})),r.K_}function ys(r){return r.U_||(r.U_=function(t,n,a){const i=Fe(t);return i.w_(),new $b(n,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,a)}(r.datastore,r.asyncQueue,{Eo:()=>Promise.resolve(),Ro:Hb.bind(null,r),mo:Yb.bind(null,r),f_:Gb.bind(null,r),g_:Kb.bind(null,r)}),r.B_.push(async e=>{e?(r.U_.s_(),await Ji(r)):(await r.U_.stop(),r.O_.length>0&&(Te("RemoteStore",`Stopping write stream with ${r.O_.length} pending writes`),r.O_=[]))})),r.U_}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hl{constructor(e,t,n,a,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=a,this.removalCallback=i,this.deferred=new Fr,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,n,a,i){const o=Date.now()+n,c=new Hl(e,t,o,a,i);return c.start(n),c}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new je(se.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Gl(r,e){if(Wr("AsyncQueue",`${e}: ${r}`),ka(r))return new je(se.UNAVAILABLE,`${e}: ${r}`);throw r}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class en{constructor(e){this.comparator=e?(t,n)=>e(t,n)||Pe.comparator(t.key,n.key):(t,n)=>Pe.comparator(t.key,n.key),this.keyedMap=Wn(),this.sortedSet=new ht(this.comparator)}static emptySet(e){return new en(e.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,n)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof en)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){const a=t.getNext().key,i=n.getNext().key;if(!a.isEqual(i))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){const n=new en;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class su{constructor(){this.W_=new ht(Pe.comparator)}track(e){const t=e.doc.key,n=this.W_.get(t);n?e.type!==0&&n.type===3?this.W_=this.W_.insert(t,e):e.type===3&&n.type!==1?this.W_=this.W_.insert(t,{type:n.type,doc:e.doc}):e.type===2&&n.type===2?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):e.type===2&&n.type===0?this.W_=this.W_.insert(t,{type:0,doc:e.doc}):e.type===1&&n.type===0?this.W_=this.W_.remove(t):e.type===1&&n.type===2?this.W_=this.W_.insert(t,{type:1,doc:n.doc}):e.type===0&&n.type===1?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):Ve():this.W_=this.W_.insert(t,e)}G_(){const e=[];return this.W_.inorderTraversal((t,n)=>{e.push(n)}),e}}class pn{constructor(e,t,n,a,i,o,c,d,h){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=a,this.mutatedKeys=i,this.fromCache=o,this.syncStateChanged=c,this.excludesMetadataChanges=d,this.hasCachedResults=h}static fromInitialDocuments(e,t,n,a,i){const o=[];return t.forEach(c=>{o.push({type:0,doc:c})}),new pn(e,t,en.emptySet(t),o,n,a,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&zi(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let a=0;a<t.length;a++)if(t[a].type!==n[a].type||!t[a].doc.isEqual(n[a].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xb{constructor(){this.z_=void 0,this.j_=[]}H_(){return this.j_.some(e=>e.J_())}}class Jb{constructor(){this.queries=nu(),this.onlineState="Unknown",this.Y_=new Set}terminate(){(function(t,n){const a=Fe(t),i=a.queries;a.queries=nu(),i.forEach((o,c)=>{for(const d of c.j_)d.onError(n)})})(this,new je(se.ABORTED,"Firestore shutting down"))}}function nu(){return new kn(r=>Xh(r),zi)}async function Sm(r,e){const t=Fe(r);let n=3;const a=e.query;let i=t.queries.get(a);i?!i.H_()&&e.J_()&&(n=2):(i=new Xb,n=e.J_()?0:1);try{switch(n){case 0:i.z_=await t.onListen(a,!0);break;case 1:i.z_=await t.onListen(a,!1);break;case 2:await t.onFirstRemoteStoreListen(a)}}catch(o){const c=Gl(o,`Initialization of query '${Qs(e.query)}' failed`);return void e.onError(c)}t.queries.set(a,i),i.j_.push(e),e.Z_(t.onlineState),i.z_&&e.X_(i.z_)&&Kl(t)}async function Am(r,e){const t=Fe(r),n=e.query;let a=3;const i=t.queries.get(n);if(i){const o=i.j_.indexOf(e);o>=0&&(i.j_.splice(o,1),i.j_.length===0?a=e.J_()?0:1:!i.H_()&&e.J_()&&(a=2))}switch(a){case 0:return t.queries.delete(n),t.onUnlisten(n,!0);case 1:return t.queries.delete(n),t.onUnlisten(n,!1);case 2:return t.onLastRemoteStoreUnlisten(n);default:return}}function Zb(r,e){const t=Fe(r);let n=!1;for(const a of e){const i=a.query,o=t.queries.get(i);if(o){for(const c of o.j_)c.X_(a)&&(n=!0);o.z_=a}}n&&Kl(t)}function ev(r,e,t){const n=Fe(r),a=n.queries.get(e);if(a)for(const i of a.j_)i.onError(t);n.queries.delete(e)}function Kl(r){r.Y_.forEach(e=>{e.next()})}var ul,au;(au=ul||(ul={})).ea="default",au.Cache="cache";class Cm{constructor(e,t,n){this.query=e,this.ta=t,this.na=!1,this.ra=null,this.onlineState="Unknown",this.options=n||{}}X_(e){if(!this.options.includeMetadataChanges){const n=[];for(const a of e.docChanges)a.type!==3&&n.push(a);e=new pn(e.query,e.docs,e.oldDocs,n,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.na?this.ia(e)&&(this.ta.next(e),t=!0):this.sa(e,this.onlineState)&&(this.oa(e),t=!0),this.ra=e,t}onError(e){this.ta.error(e)}Z_(e){this.onlineState=e;let t=!1;return this.ra&&!this.na&&this.sa(this.ra,e)&&(this.oa(this.ra),t=!0),t}sa(e,t){if(!e.fromCache||!this.J_())return!0;const n=t!=="Offline";return(!this.options._a||!n)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}ia(e){if(e.docChanges.length>0)return!0;const t=this.ra&&this.ra.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}oa(e){e=pn.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.na=!0,this.ta.next(e)}J_(){return this.options.source!==ul.Cache}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dm{constructor(e){this.key=e}}class Rm{constructor(e){this.key=e}}class tv{constructor(e,t){this.query=e,this.Ta=t,this.Ea=null,this.hasCachedResults=!1,this.current=!1,this.da=He(),this.mutatedKeys=He(),this.Aa=Jh(e),this.Ra=new en(this.Aa)}get Va(){return this.Ta}ma(e,t){const n=t?t.fa:new su,a=t?t.Ra:this.Ra;let i=t?t.mutatedKeys:this.mutatedKeys,o=a,c=!1;const d=this.query.limitType==="F"&&a.size===this.query.limit?a.last():null,h=this.query.limitType==="L"&&a.size===this.query.limit?a.first():null;if(e.inorderTraversal((g,x)=>{const p=a.get(g),v=Hi(this.query,x)?x:null,A=!!p&&this.mutatedKeys.has(p.key),C=!!v&&(v.hasLocalMutations||this.mutatedKeys.has(v.key)&&v.hasCommittedMutations);let T=!1;p&&v?p.data.isEqual(v.data)?A!==C&&(n.track({type:3,doc:v}),T=!0):this.ga(p,v)||(n.track({type:2,doc:v}),T=!0,(d&&this.Aa(v,d)>0||h&&this.Aa(v,h)<0)&&(c=!0)):!p&&v?(n.track({type:0,doc:v}),T=!0):p&&!v&&(n.track({type:1,doc:p}),T=!0,(d||h)&&(c=!0)),T&&(v?(o=o.add(v),i=C?i.add(g):i.delete(g)):(o=o.delete(g),i=i.delete(g)))}),this.query.limit!==null)for(;o.size>this.query.limit;){const g=this.query.limitType==="F"?o.last():o.first();o=o.delete(g.key),i=i.delete(g.key),n.track({type:1,doc:g})}return{Ra:o,fa:n,ns:c,mutatedKeys:i}}ga(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n,a){const i=this.Ra;this.Ra=e.Ra,this.mutatedKeys=e.mutatedKeys;const o=e.fa.G_();o.sort((g,x)=>function(v,A){const C=T=>{switch(T){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Ve()}};return C(v)-C(A)}(g.type,x.type)||this.Aa(g.doc,x.doc)),this.pa(n),a=a!=null&&a;const c=t&&!a?this.ya():[],d=this.da.size===0&&this.current&&!a?1:0,h=d!==this.Ea;return this.Ea=d,o.length!==0||h?{snapshot:new pn(this.query,e.Ra,i,o,e.mutatedKeys,d===0,h,!1,!!n&&n.resumeToken.approximateByteSize()>0),wa:c}:{wa:c}}Z_(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({Ra:this.Ra,fa:new su,mutatedKeys:this.mutatedKeys,ns:!1},!1)):{wa:[]}}Sa(e){return!this.Ta.has(e)&&!!this.Ra.has(e)&&!this.Ra.get(e).hasLocalMutations}pa(e){e&&(e.addedDocuments.forEach(t=>this.Ta=this.Ta.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.Ta=this.Ta.delete(t)),this.current=e.current)}ya(){if(!this.current)return[];const e=this.da;this.da=He(),this.Ra.forEach(n=>{this.Sa(n.key)&&(this.da=this.da.add(n.key))});const t=[];return e.forEach(n=>{this.da.has(n)||t.push(new Rm(n))}),this.da.forEach(n=>{e.has(n)||t.push(new Dm(n))}),t}ba(e){this.Ta=e.Ts,this.da=He();const t=this.ma(e.documents);return this.applyChanges(t,!0)}Da(){return pn.fromInitialDocuments(this.query,this.Ra,this.mutatedKeys,this.Ea===0,this.hasCachedResults)}}class rv{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}}class sv{constructor(e){this.key=e,this.va=!1}}class nv{constructor(e,t,n,a,i,o){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=a,this.currentUser=i,this.maxConcurrentLimboResolutions=o,this.Ca={},this.Fa=new kn(c=>Xh(c),zi),this.Ma=new Map,this.xa=new Set,this.Oa=new ht(Pe.comparator),this.Na=new Map,this.La=new Ll,this.Ba={},this.ka=new Map,this.qa=gn.kn(),this.onlineState="Unknown",this.Qa=void 0}get isPrimaryClient(){return this.Qa===!0}}async function av(r,e,t=!0){const n=Lm(r);let a;const i=n.Fa.get(e);return i?(n.sharedClientState.addLocalQueryTarget(i.targetId),a=i.view.Da()):a=await Pm(n,e,t,!0),a}async function iv(r,e){const t=Lm(r);await Pm(t,e,!0,!1)}async function Pm(r,e,t,n){const a=await Tb(r.localStore,vr(e)),i=a.targetId,o=r.sharedClientState.addLocalQueryTarget(i,t);let c;return n&&(c=await ov(r,e,i,o==="current",a.resumeToken)),r.isPrimaryClient&&t&&_m(r.remoteStore,a),c}async function ov(r,e,t,n,a){r.Ka=(x,p,v)=>async function(C,T,z,$){let S=T.view.ma(z);S.ns&&(S=await Zd(C.localStore,T.query,!1).then(({documents:E})=>T.view.ma(E,S)));const I=$&&$.targetChanges.get(T.targetId),H=$&&$.targetMismatches.get(T.targetId)!=null,G=T.view.applyChanges(S,C.isPrimaryClient,I,H);return ou(C,T.targetId,G.wa),G.snapshot}(r,x,p,v);const i=await Zd(r.localStore,e,!0),o=new tv(e,i.Ts),c=o.ma(i.documents),d=Na.createSynthesizedTargetChangeForCurrentChange(t,n&&r.onlineState!=="Offline",a),h=o.applyChanges(c,r.isPrimaryClient,d);ou(r,t,h.wa);const g=new rv(e,t,o);return r.Fa.set(e,g),r.Ma.has(t)?r.Ma.get(t).push(e):r.Ma.set(t,[e]),h.snapshot}async function lv(r,e,t){const n=Fe(r),a=n.Fa.get(e),i=n.Ma.get(a.targetId);if(i.length>1)return n.Ma.set(a.targetId,i.filter(o=>!zi(o,e))),void n.Fa.delete(e);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(a.targetId),n.sharedClientState.isActiveQueryTarget(a.targetId)||await dl(n.localStore,a.targetId,!1).then(()=>{n.sharedClientState.clearQueryState(a.targetId),t&&Bl(n.remoteStore,a.targetId),hl(n,a.targetId)}).catch(wa)):(hl(n,a.targetId),await dl(n.localStore,a.targetId,!0))}async function cv(r,e){const t=Fe(r),n=t.Fa.get(e),a=t.Ma.get(n.targetId);t.isPrimaryClient&&a.length===1&&(t.sharedClientState.removeLocalQueryTarget(n.targetId),Bl(t.remoteStore,n.targetId))}async function dv(r,e,t){const n=xv(r);try{const a=await function(o,c){const d=Fe(o),h=jt.now(),g=c.reduce((v,A)=>v.add(A.key),He());let x,p;return d.persistence.runTransaction("Locally write mutations","readwrite",v=>{let A=qr(),C=He();return d.cs.getEntries(v,g).next(T=>{A=T,A.forEach((z,$)=>{$.isValidDocument()||(C=C.add(z))})}).next(()=>d.localDocuments.getOverlayedDocuments(v,A)).next(T=>{x=T;const z=[];for(const $ of c){const S=Dy($,x.get($.key).overlayedDocument);S!=null&&z.push(new bs($.key,S,Wh(S.value.mapValue),mr.exists(!0)))}return d.mutationQueue.addMutationBatch(v,h,z,c)}).next(T=>{p=T;const z=T.applyToLocalDocumentSet(x,C);return d.documentOverlayCache.saveOverlays(v,T.batchId,z)})}).then(()=>({batchId:p.batchId,changes:em(x)}))}(n.localStore,e);n.sharedClientState.addPendingMutation(a.batchId),function(o,c,d){let h=o.Ba[o.currentUser.toKey()];h||(h=new ht(tt)),h=h.insert(c,d),o.Ba[o.currentUser.toKey()]=h}(n,a.batchId,t),await Ea(n,a.changes),await Ji(n.remoteStore)}catch(a){const i=Gl(a,"Failed to persist write");t.reject(i)}}async function Mm(r,e){const t=Fe(r);try{const n=await jb(t.localStore,e);e.targetChanges.forEach((a,i)=>{const o=t.Na.get(i);o&&(nt(a.addedDocuments.size+a.modifiedDocuments.size+a.removedDocuments.size<=1),a.addedDocuments.size>0?o.va=!0:a.modifiedDocuments.size>0?nt(o.va):a.removedDocuments.size>0&&(nt(o.va),o.va=!1))}),await Ea(t,n,e)}catch(n){await wa(n)}}function iu(r,e,t){const n=Fe(r);if(n.isPrimaryClient&&t===0||!n.isPrimaryClient&&t===1){const a=[];n.Fa.forEach((i,o)=>{const c=o.view.Z_(e);c.snapshot&&a.push(c.snapshot)}),function(o,c){const d=Fe(o);d.onlineState=c;let h=!1;d.queries.forEach((g,x)=>{for(const p of x.j_)p.Z_(c)&&(h=!0)}),h&&Kl(d)}(n.eventManager,e),a.length&&n.Ca.d_(a),n.onlineState=e,n.isPrimaryClient&&n.sharedClientState.setOnlineState(e)}}async function uv(r,e,t){const n=Fe(r);n.sharedClientState.updateQueryState(e,"rejected",t);const a=n.Na.get(e),i=a&&a.key;if(i){let o=new ht(Pe.comparator);o=o.insert(i,Ut.newNoDocument(i,Le.min()));const c=He().add(i),d=new Yi(Le.min(),new Map,new ht(tt),o,c);await Mm(n,d),n.Oa=n.Oa.remove(i),n.Na.delete(e),Yl(n)}else await dl(n.localStore,e,!1).then(()=>hl(n,e,t)).catch(wa)}async function hv(r,e){const t=Fe(r),n=e.batch.batchId;try{const a=await Nb(t.localStore,e);Om(t,n,null),$m(t,n),t.sharedClientState.updateMutationState(n,"acknowledged"),await Ea(t,a)}catch(a){await wa(a)}}async function mv(r,e,t){const n=Fe(r);try{const a=await function(o,c){const d=Fe(o);return d.persistence.runTransaction("Reject batch","readwrite-primary",h=>{let g;return d.mutationQueue.lookupMutationBatch(h,c).next(x=>(nt(x!==null),g=x.keys(),d.mutationQueue.removeMutationBatch(h,x))).next(()=>d.mutationQueue.performConsistencyCheck(h)).next(()=>d.documentOverlayCache.removeOverlaysForBatchId(h,g,c)).next(()=>d.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(h,g)).next(()=>d.localDocuments.getDocuments(h,g))})}(n.localStore,e);Om(n,e,t),$m(n,e),n.sharedClientState.updateMutationState(e,"rejected",t),await Ea(n,a)}catch(a){await wa(a)}}function $m(r,e){(r.ka.get(e)||[]).forEach(t=>{t.resolve()}),r.ka.delete(e)}function Om(r,e,t){const n=Fe(r);let a=n.Ba[n.currentUser.toKey()];if(a){const i=a.get(e);i&&(t?i.reject(t):i.resolve(),a=a.remove(e)),n.Ba[n.currentUser.toKey()]=a}}function hl(r,e,t=null){r.sharedClientState.removeLocalQueryTarget(e);for(const n of r.Ma.get(e))r.Fa.delete(n),t&&r.Ca.$a(n,t);r.Ma.delete(e),r.isPrimaryClient&&r.La.gr(e).forEach(n=>{r.La.containsKey(n)||Vm(r,n)})}function Vm(r,e){r.xa.delete(e.path.canonicalString());const t=r.Oa.get(e);t!==null&&(Bl(r.remoteStore,t),r.Oa=r.Oa.remove(e),r.Na.delete(t),Yl(r))}function ou(r,e,t){for(const n of t)n instanceof Dm?(r.La.addReference(n.key,e),gv(r,n)):n instanceof Rm?(Te("SyncEngine","Document no longer in limbo: "+n.key),r.La.removeReference(n.key,e),r.La.containsKey(n.key)||Vm(r,n.key)):Ve()}function gv(r,e){const t=e.key,n=t.path.canonicalString();r.Oa.get(t)||r.xa.has(n)||(Te("SyncEngine","New document in limbo: "+t),r.xa.add(n),Yl(r))}function Yl(r){for(;r.xa.size>0&&r.Oa.size<r.maxConcurrentLimboResolutions;){const e=r.xa.values().next().value;r.xa.delete(e);const t=new Pe(dt.fromString(e)),n=r.qa.next();r.Na.set(n,new sv(t)),r.Oa=r.Oa.insert(t,n),_m(r.remoteStore,new ds(vr(Rl(t.path)),n,"TargetPurposeLimboResolution",Il.oe))}}async function Ea(r,e,t){const n=Fe(r),a=[],i=[],o=[];n.Fa.isEmpty()||(n.Fa.forEach((c,d)=>{o.push(n.Ka(d,e,t).then(h=>{var g;if((h||t)&&n.isPrimaryClient){const x=h?!h.fromCache:(g=t==null?void 0:t.targetChanges.get(d.targetId))===null||g===void 0?void 0:g.current;n.sharedClientState.updateQueryState(d.targetId,x?"current":"not-current")}if(h){a.push(h);const x=Ul.Wi(d.targetId,h);i.push(x)}}))}),await Promise.all(o),n.Ca.d_(a),await async function(d,h){const g=Fe(d);try{await g.persistence.runTransaction("notifyLocalViewChanges","readwrite",x=>le.forEach(h,p=>le.forEach(p.$i,v=>g.persistence.referenceDelegate.addReference(x,p.targetId,v)).next(()=>le.forEach(p.Ui,v=>g.persistence.referenceDelegate.removeReference(x,p.targetId,v)))))}catch(x){if(!ka(x))throw x;Te("LocalStore","Failed to update sequence numbers: "+x)}for(const x of h){const p=x.targetId;if(!x.fromCache){const v=g.os.get(p),A=v.snapshotVersion,C=v.withLastLimboFreeSnapshotVersion(A);g.os=g.os.insert(p,C)}}}(n.localStore,i))}async function pv(r,e){const t=Fe(r);if(!t.currentUser.isEqual(e)){Te("SyncEngine","User change. New user:",e.toKey());const n=await bm(t.localStore,e);t.currentUser=e,function(i,o){i.ka.forEach(c=>{c.forEach(d=>{d.reject(new je(se.CANCELLED,o))})}),i.ka.clear()}(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,n.removedBatchIds,n.addedBatchIds),await Ea(t,n.hs)}}function fv(r,e){const t=Fe(r),n=t.Na.get(e);if(n&&n.va)return He().add(n.key);{let a=He();const i=t.Ma.get(e);if(!i)return a;for(const o of i){const c=t.Fa.get(o);a=a.unionWith(c.view.Va)}return a}}function Lm(r){const e=Fe(r);return e.remoteStore.remoteSyncer.applyRemoteEvent=Mm.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=fv.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=uv.bind(null,e),e.Ca.d_=Zb.bind(null,e.eventManager),e.Ca.$a=ev.bind(null,e.eventManager),e}function xv(r){const e=Fe(r);return e.remoteStore.remoteSyncer.applySuccessfulWrite=hv.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=mv.bind(null,e),e}class ji{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=Qi(e.databaseInfo.databaseId),this.sharedClientState=this.Wa(e),this.persistence=this.Ga(e),await this.persistence.start(),this.localStore=this.za(e),this.gcScheduler=this.ja(e,this.localStore),this.indexBackfillerScheduler=this.Ha(e,this.localStore)}ja(e,t){return null}Ha(e,t){return null}za(e){return _b(this.persistence,new wb,e.initialUser,this.serializer)}Ga(e){return new yb(Fl.Zr,this.serializer)}Wa(e){return new Ab}async terminate(){var e,t;(e=this.gcScheduler)===null||e===void 0||e.stop(),(t=this.indexBackfillerScheduler)===null||t===void 0||t.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}ji.provider={build:()=>new ji};class ml{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=n=>iu(this.syncEngine,n,1),this.remoteStore.remoteSyncer.handleCredentialChange=pv.bind(null,this.syncEngine),await Qb(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return function(){return new Jb}()}createDatastore(e){const t=Qi(e.databaseInfo.databaseId),n=function(i){return new Pb(i)}(e.databaseInfo);return function(i,o,c,d){return new Ob(i,o,c,d)}(e.authCredentials,e.appCheckCredentials,n,t)}createRemoteStore(e){return function(n,a,i,o,c){return new Lb(n,a,i,o,c)}(this.localStore,this.datastore,e.asyncQueue,t=>iu(this.syncEngine,t,0),function(){return tu.D()?new tu:new Cb}())}createSyncEngine(e,t){return function(a,i,o,c,d,h,g){const x=new nv(a,i,o,c,d,h);return g&&(x.Qa=!0),x}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){var e,t;await async function(a){const i=Fe(a);Te("RemoteStore","RemoteStore shutting down."),i.L_.add(5),await ja(i),i.k_.shutdown(),i.q_.set("Unknown")}(this.remoteStore),(e=this.datastore)===null||e===void 0||e.terminate(),(t=this.eventManager)===null||t===void 0||t.terminate()}}ml.provider={build:()=>new ml};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fm{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ya(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ya(this.observer.error,e):Wr("Uncaught Error in snapshot listener:",e.toString()))}Za(){this.muted=!0}Ya(e,t){setTimeout(()=>{this.muted||e(t)},0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yv{constructor(e,t,n,a,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=a,this.user=Ft.UNAUTHENTICATED,this.clientId=Fh.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(n,async o=>{Te("FirestoreClient","Received user=",o.uid),await this.authCredentialListener(o),this.user=o}),this.appCheckCredentials.start(n,o=>(Te("FirestoreClient","Received new app check token=",o),this.appCheckCredentialListener(o,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new Fr;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const n=Gl(t,"Failed to shutdown persistence");e.reject(n)}}),e.promise}}async function Lo(r,e){r.asyncQueue.verifyOperationInProgress(),Te("FirestoreClient","Initializing OfflineComponentProvider");const t=r.configuration;await e.initialize(t);let n=t.initialUser;r.setCredentialChangeListener(async a=>{n.isEqual(a)||(await bm(e.localStore,a),n=a)}),e.persistence.setDatabaseDeletedListener(()=>r.terminate()),r._offlineComponents=e}async function lu(r,e){r.asyncQueue.verifyOperationInProgress();const t=await bv(r);Te("FirestoreClient","Initializing OnlineComponentProvider"),await e.initialize(t,r.configuration),r.setCredentialChangeListener(n=>ru(e.remoteStore,n)),r.setAppCheckTokenChangeListener((n,a)=>ru(e.remoteStore,a)),r._onlineComponents=e}async function bv(r){if(!r._offlineComponents)if(r._uninitializedComponentsProvider){Te("FirestoreClient","Using user provided OfflineComponentProvider");try{await Lo(r,r._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!function(a){return a.name==="FirebaseError"?a.code===se.FAILED_PRECONDITION||a.code===se.UNIMPLEMENTED:!(typeof DOMException<"u"&&a instanceof DOMException)||a.code===22||a.code===20||a.code===11}(t))throw t;dn("Error using user provided cache. Falling back to memory cache: "+t),await Lo(r,new ji)}}else Te("FirestoreClient","Using default OfflineComponentProvider"),await Lo(r,new ji);return r._offlineComponents}async function Um(r){return r._onlineComponents||(r._uninitializedComponentsProvider?(Te("FirestoreClient","Using user provided OnlineComponentProvider"),await lu(r,r._uninitializedComponentsProvider._online)):(Te("FirestoreClient","Using default OnlineComponentProvider"),await lu(r,new ml))),r._onlineComponents}function vv(r){return Um(r).then(e=>e.syncEngine)}async function Bm(r){const e=await Um(r),t=e.eventManager;return t.onListen=av.bind(null,e.syncEngine),t.onUnlisten=lv.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=iv.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=cv.bind(null,e.syncEngine),t}function wv(r,e,t={}){const n=new Fr;return r.asyncQueue.enqueueAndForget(async()=>function(i,o,c,d,h){const g=new Fm({next:p=>{g.Za(),o.enqueueAndForget(()=>Am(i,x));const v=p.docs.has(c);!v&&p.fromCache?h.reject(new je(se.UNAVAILABLE,"Failed to get document because the client is offline.")):v&&p.fromCache&&d&&d.source==="server"?h.reject(new je(se.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):h.resolve(p)},error:p=>h.reject(p)}),x=new Cm(Rl(c.path),g,{includeMetadataChanges:!0,_a:!0});return Sm(i,x)}(await Bm(r),r.asyncQueue,e,t,n)),n.promise}function kv(r,e,t={}){const n=new Fr;return r.asyncQueue.enqueueAndForget(async()=>function(i,o,c,d,h){const g=new Fm({next:p=>{g.Za(),o.enqueueAndForget(()=>Am(i,x)),p.fromCache&&d.source==="server"?h.reject(new je(se.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):h.resolve(p)},error:p=>h.reject(p)}),x=new Cm(c,g,{includeMetadataChanges:!0,_a:!0});return Sm(i,x)}(await Bm(r),r.asyncQueue,e,t,n)),n.promise}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Wm(r){const e={};return r.timeoutSeconds!==void 0&&(e.timeoutSeconds=r.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cu=new Map;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qm(r,e,t){if(!t)throw new je(se.INVALID_ARGUMENT,`Function ${r}() cannot be called with an empty ${e}.`)}function _v(r,e,t,n){if(e===!0&&n===!0)throw new je(se.INVALID_ARGUMENT,`${r} and ${t} cannot be used together.`)}function du(r){if(!Pe.isDocumentKey(r))throw new je(se.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${r} has ${r.length}.`)}function uu(r){if(Pe.isDocumentKey(r))throw new je(se.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${r} has ${r.length}.`)}function Zi(r){if(r===void 0)return"undefined";if(r===null)return"null";if(typeof r=="string")return r.length>20&&(r=`${r.substring(0,20)}...`),JSON.stringify(r);if(typeof r=="number"||typeof r=="boolean")return""+r;if(typeof r=="object"){if(r instanceof Array)return"an array";{const e=function(n){return n.constructor?n.constructor.name:null}(r);return e?`a custom ${e} object`:"an object"}}return typeof r=="function"?"a function":Ve()}function zr(r,e){if("_delegate"in r&&(r=r._delegate),!(r instanceof e)){if(e.name===r.constructor.name)throw new je(se.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=Zi(r);throw new je(se.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return r}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hu{constructor(e){var t,n;if(e.host===void 0){if(e.ssl!==void 0)throw new je(se.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=(t=e.ssl)===null||t===void 0||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new je(se.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}_v("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=Wm((n=e.experimentalLongPollingOptions)!==null&&n!==void 0?n:{}),function(i){if(i.timeoutSeconds!==void 0){if(isNaN(i.timeoutSeconds))throw new je(se.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (must not be NaN)`);if(i.timeoutSeconds<5)throw new je(se.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (minimum allowed value is 5)`);if(i.timeoutSeconds>30)throw new je(se.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(n,a){return n.timeoutSeconds===a.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class eo{constructor(e,t,n,a){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=a,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new hu({}),this._settingsFrozen=!1,this._terminateTask="notTerminated"}get app(){if(!this._app)throw new je(se.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new je(se.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new hu(e),e.credentials!==void 0&&(this._authCredentials=function(n){if(!n)return new Ux;switch(n.type){case"firstParty":return new zx(n.sessionIndex||"0",n.iamToken||null,n.authTokenFactory||null);case"provider":return n.client;default:throw new je(se.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const n=cu.get(t);n&&(Te("ComponentProvider","Removing Datastore"),cu.delete(t),n.terminate())}(this),Promise.resolve()}}function Nv(r,e,t,n={}){var a;const i=(r=zr(r,eo))._getSettings(),o=`${e}:${t}`;if(i.host!=="firestore.googleapis.com"&&i.host!==o&&dn("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),r._setSettings(Object.assign(Object.assign({},i),{host:o,ssl:!1})),n.mockUserToken){let c,d;if(typeof n.mockUserToken=="string")c=n.mockUserToken,d=Ft.MOCK_USER;else{c=Ih(n.mockUserToken,(a=r._app)===null||a===void 0?void 0:a.options.projectId);const h=n.mockUserToken.sub||n.mockUserToken.user_id;if(!h)throw new je(se.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");d=new Ft(h)}r._authCredentials=new Bx(new Lh(c,d))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qs{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new qs(this.firestore,e,this._query)}}class Qt{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new ms(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Qt(this.firestore,e,this._key)}}class ms extends qs{constructor(e,t,n){super(e,t,Rl(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Qt(this.firestore,null,new Pe(e))}withConverter(e){return new ms(this.firestore,e,this._path)}}function wt(r,e,...t){if(r=Wt(r),qm("collection","path",e),r instanceof eo){const n=dt.fromString(e,...t);return uu(n),new ms(r,null,n)}{if(!(r instanceof Qt||r instanceof ms))throw new je(se.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const n=r._path.child(dt.fromString(e,...t));return uu(n),new ms(r.firestore,null,n)}}function St(r,e,...t){if(r=Wt(r),arguments.length===1&&(e=Fh.newId()),qm("doc","path",e),r instanceof eo){const n=dt.fromString(e,...t);return du(n),new Qt(r,null,new Pe(n))}{if(!(r instanceof Qt||r instanceof ms))throw new je(se.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const n=r._path.child(dt.fromString(e,...t));return du(n),new Qt(r.firestore,r instanceof ms?r.converter:null,new Pe(n))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mu{constructor(e=Promise.resolve()){this.Pu=[],this.Iu=!1,this.Tu=[],this.Eu=null,this.du=!1,this.Au=!1,this.Ru=[],this.t_=new wm(this,"async_queue_retry"),this.Vu=()=>{const n=Vo();n&&Te("AsyncQueue","Visibility state changed to "+n.visibilityState),this.t_.jo()},this.mu=e;const t=Vo();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this.Vu)}get isShuttingDown(){return this.Iu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.fu(),this.gu(e)}enterRestrictedMode(e){if(!this.Iu){this.Iu=!0,this.Au=e||!1;const t=Vo();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this.Vu)}}enqueue(e){if(this.fu(),this.Iu)return new Promise(()=>{});const t=new Fr;return this.gu(()=>this.Iu&&this.Au?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Pu.push(e),this.pu()))}async pu(){if(this.Pu.length!==0){try{await this.Pu[0](),this.Pu.shift(),this.t_.reset()}catch(e){if(!ka(e))throw e;Te("AsyncQueue","Operation failed with retryable error: "+e)}this.Pu.length>0&&this.t_.Go(()=>this.pu())}}gu(e){const t=this.mu.then(()=>(this.du=!0,e().catch(n=>{this.Eu=n,this.du=!1;const a=function(o){let c=o.message||"";return o.stack&&(c=o.stack.includes(o.message)?o.stack:o.message+`
`+o.stack),c}(n);throw Wr("INTERNAL UNHANDLED ERROR: ",a),n}).then(n=>(this.du=!1,n))));return this.mu=t,t}enqueueAfterDelay(e,t,n){this.fu(),this.Ru.indexOf(e)>-1&&(t=0);const a=Hl.createAndSchedule(this,e,t,n,i=>this.yu(i));return this.Tu.push(a),a}fu(){this.Eu&&Ve()}verifyOperationInProgress(){}async wu(){let e;do e=this.mu,await e;while(e!==this.mu)}Su(e){for(const t of this.Tu)if(t.timerId===e)return!0;return!1}bu(e){return this.wu().then(()=>{this.Tu.sort((t,n)=>t.targetTimeMs-n.targetTimeMs);for(const t of this.Tu)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.wu()})}Du(e){this.Ru.push(e)}yu(e){const t=this.Tu.indexOf(e);this.Tu.splice(t,1)}}class Nn extends eo{constructor(e,t,n,a){super(e,t,n,a),this.type="firestore",this._queue=new mu,this._persistenceKey=(a==null?void 0:a.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new mu(e),this._firestoreClient=void 0,await e}}}function jv(r,e){const t=typeof r=="object"?r:jl(),n=typeof r=="string"?r:"(default)",a=Wi(t,"firestore").getImmediate({identifier:n});if(!a._initialized){const i=Nh("firestore");i&&Nv(a,...i)}return a}function Ql(r){if(r._terminated)throw new je(se.FAILED_PRECONDITION,"The client has already been terminated.");return r._firestoreClient||Ev(r),r._firestoreClient}function Ev(r){var e,t,n;const a=r._freezeSettings(),i=function(c,d,h,g){return new ny(c,d,h,g.host,g.ssl,g.experimentalForceLongPolling,g.experimentalAutoDetectLongPolling,Wm(g.experimentalLongPollingOptions),g.useFetchStreams)}(r._databaseId,((e=r._app)===null||e===void 0?void 0:e.options.appId)||"",r._persistenceKey,a);r._componentsProvider||!((t=a.localCache)===null||t===void 0)&&t._offlineComponentProvider&&(!((n=a.localCache)===null||n===void 0)&&n._onlineComponentProvider)&&(r._componentsProvider={_offline:a.localCache._offlineComponentProvider,_online:a.localCache._onlineComponentProvider}),r._firestoreClient=new yv(r._authCredentials,r._appCheckCredentials,r._queue,i,r._componentsProvider&&function(c){const d=c==null?void 0:c._online.build();return{_offline:c==null?void 0:c._offline.build(d),_online:d}}(r._componentsProvider))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fn{constructor(e){this._byteString=e}static fromBase64String(e){try{return new fn($t.fromBase64String(e))}catch(t){throw new je(se.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new fn($t.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class to{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new je(se.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Rt(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xl{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jl{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new je(se.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new je(se.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return tt(this._lat,e._lat)||tt(this._long,e._long)}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zl{constructor(e){this._values=(e||[]).map(t=>t)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(n,a){if(n.length!==a.length)return!1;for(let i=0;i<n.length;++i)if(n[i]!==a[i])return!1;return!0}(this._values,e._values)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Iv=/^__.*__$/;class Tv{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return this.fieldMask!==null?new bs(e,this.data,this.fieldMask,t,this.fieldTransforms):new _a(e,this.data,t,this.fieldTransforms)}}class zm{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return new bs(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function Hm(r){switch(r){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Ve()}}class ec{constructor(e,t,n,a,i,o){this.settings=e,this.databaseId=t,this.serializer=n,this.ignoreUndefinedProperties=a,i===void 0&&this.vu(),this.fieldTransforms=i||[],this.fieldMask=o||[]}get path(){return this.settings.path}get Cu(){return this.settings.Cu}Fu(e){return new ec(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Mu(e){var t;const n=(t=this.path)===null||t===void 0?void 0:t.child(e),a=this.Fu({path:n,xu:!1});return a.Ou(e),a}Nu(e){var t;const n=(t=this.path)===null||t===void 0?void 0:t.child(e),a=this.Fu({path:n,xu:!1});return a.vu(),a}Lu(e){return this.Fu({path:void 0,xu:!0})}Bu(e){return Ei(e,this.settings.methodName,this.settings.ku||!1,this.path,this.settings.qu)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}vu(){if(this.path)for(let e=0;e<this.path.length;e++)this.Ou(this.path.get(e))}Ou(e){if(e.length===0)throw this.Bu("Document fields must not be empty");if(Hm(this.Cu)&&Iv.test(e))throw this.Bu('Document fields cannot begin and end with "__"')}}class Sv{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=n||Qi(e)}Qu(e,t,n,a=!1){return new ec({Cu:e,methodName:t,qu:n,path:Rt.emptyPath(),xu:!1,ku:a},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function tc(r){const e=r._freezeSettings(),t=Qi(r._databaseId);return new Sv(r._databaseId,!!e.ignoreUndefinedProperties,t)}function Av(r,e,t,n,a,i={}){const o=r.Qu(i.merge||i.mergeFields?2:0,e,t,a);rc("Data must be an object, but it was:",o,n);const c=Gm(n,o);let d,h;if(i.merge)d=new rr(o.fieldMask),h=o.fieldTransforms;else if(i.mergeFields){const g=[];for(const x of i.mergeFields){const p=gl(e,x,t);if(!o.contains(p))throw new je(se.INVALID_ARGUMENT,`Field '${p}' is specified in your field mask but missing from your input data.`);Ym(g,p)||g.push(p)}d=new rr(g),h=o.fieldTransforms.filter(x=>d.covers(x.field))}else d=null,h=o.fieldTransforms;return new Tv(new Kt(c),d,h)}class ro extends Xl{_toFieldTransform(e){if(e.Cu!==2)throw e.Cu===1?e.Bu(`${this._methodName}() can only appear at the top level of your update data`):e.Bu(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof ro}}function Cv(r,e,t,n){const a=r.Qu(1,e,t);rc("Data must be an object, but it was:",a,n);const i=[],o=Kt.empty();Bs(n,(d,h)=>{const g=sc(e,d,t);h=Wt(h);const x=a.Nu(g);if(h instanceof ro)i.push(g);else{const p=Ia(h,x);p!=null&&(i.push(g),o.set(g,p))}});const c=new rr(i);return new zm(o,c,a.fieldTransforms)}function Dv(r,e,t,n,a,i){const o=r.Qu(1,e,t),c=[gl(e,n,t)],d=[a];if(i.length%2!=0)throw new je(se.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let p=0;p<i.length;p+=2)c.push(gl(e,i[p])),d.push(i[p+1]);const h=[],g=Kt.empty();for(let p=c.length-1;p>=0;--p)if(!Ym(h,c[p])){const v=c[p];let A=d[p];A=Wt(A);const C=o.Nu(v);if(A instanceof ro)h.push(v);else{const T=Ia(A,C);T!=null&&(h.push(v),g.set(v,T))}}const x=new rr(h);return new zm(g,x,o.fieldTransforms)}function Rv(r,e,t,n=!1){return Ia(t,r.Qu(n?4:3,e))}function Ia(r,e){if(Km(r=Wt(r)))return rc("Unsupported field value:",e,r),Gm(r,e);if(r instanceof Xl)return function(n,a){if(!Hm(a.Cu))throw a.Bu(`${n._methodName}() can only be used with update() and set()`);if(!a.path)throw a.Bu(`${n._methodName}() is not currently supported inside arrays`);const i=n._toFieldTransform(a);i&&a.fieldTransforms.push(i)}(r,e),null;if(r===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),r instanceof Array){if(e.settings.xu&&e.Cu!==4)throw e.Bu("Nested arrays are not supported");return function(n,a){const i=[];let o=0;for(const c of n){let d=Ia(c,a.Lu(o));d==null&&(d={nullValue:"NULL_VALUE"}),i.push(d),o++}return{arrayValue:{values:i}}}(r,e)}return function(n,a){if((n=Wt(n))===null)return{nullValue:"NULL_VALUE"};if(typeof n=="number")return Ey(a.serializer,n);if(typeof n=="boolean")return{booleanValue:n};if(typeof n=="string")return{stringValue:n};if(n instanceof Date){const i=jt.fromDate(n);return{timestampValue:_i(a.serializer,i)}}if(n instanceof jt){const i=new jt(n.seconds,1e3*Math.floor(n.nanoseconds/1e3));return{timestampValue:_i(a.serializer,i)}}if(n instanceof Jl)return{geoPointValue:{latitude:n.latitude,longitude:n.longitude}};if(n instanceof fn)return{bytesValue:hm(a.serializer,n._byteString)};if(n instanceof Qt){const i=a.databaseId,o=n.firestore._databaseId;if(!o.isEqual(i))throw a.Bu(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${i.projectId}/${i.database}`);return{referenceValue:Vl(n.firestore._databaseId||a.databaseId,n._key.path)}}if(n instanceof Zl)return function(o,c){return{mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{values:o.toArray().map(d=>{if(typeof d!="number")throw c.Bu("VectorValues must only contain numeric values.");return Pl(c.serializer,d)})}}}}}}(n,a);throw a.Bu(`Unsupported field value: ${Zi(n)}`)}(r,e)}function Gm(r,e){const t={};return Uh(r)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Bs(r,(n,a)=>{const i=Ia(a,e.Mu(n));i!=null&&(t[n]=i)}),{mapValue:{fields:t}}}function Km(r){return!(typeof r!="object"||r===null||r instanceof Array||r instanceof Date||r instanceof jt||r instanceof Jl||r instanceof fn||r instanceof Qt||r instanceof Xl||r instanceof Zl)}function rc(r,e,t){if(!Km(t)||!function(a){return typeof a=="object"&&a!==null&&(Object.getPrototypeOf(a)===Object.prototype||Object.getPrototypeOf(a)===null)}(t)){const n=Zi(t);throw n==="an object"?e.Bu(r+" a custom object"):e.Bu(r+" "+n)}}function gl(r,e,t){if((e=Wt(e))instanceof to)return e._internalPath;if(typeof e=="string")return sc(r,e);throw Ei("Field path arguments must be of type string or ",r,!1,void 0,t)}const Pv=new RegExp("[~\\*/\\[\\]]");function sc(r,e,t){if(e.search(Pv)>=0)throw Ei(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,r,!1,void 0,t);try{return new to(...e.split("."))._internalPath}catch{throw Ei(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,r,!1,void 0,t)}}function Ei(r,e,t,n,a){const i=n&&!n.isEmpty(),o=a!==void 0;let c=`Function ${e}() called with invalid data`;t&&(c+=" (via `toFirestore()`)"),c+=". ";let d="";return(i||o)&&(d+=" (found",i&&(d+=` in field ${n}`),o&&(d+=` in document ${a}`),d+=")"),new je(se.INVALID_ARGUMENT,c+r+d)}function Ym(r,e){return r.some(t=>t.isEqual(e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qm{constructor(e,t,n,a,i){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=a,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new Qt(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new Mv(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(so("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}}class Mv extends Qm{data(){return super.data()}}function so(r,e){return typeof e=="string"?sc(r,e):e instanceof to?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $v(r){if(r.limitType==="L"&&r.explicitOrderBy.length===0)throw new je(se.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class nc{}class Xm extends nc{}function ft(r,e,...t){let n=[];e instanceof nc&&n.push(e),n=n.concat(t),function(i){const o=i.filter(d=>d instanceof ac).length,c=i.filter(d=>d instanceof no).length;if(o>1||o>0&&c>0)throw new je(se.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(n);for(const a of n)r=a._apply(r);return r}class no extends Xm{constructor(e,t,n){super(),this._field=e,this._op=t,this._value=n,this.type="where"}static _create(e,t,n){return new no(e,t,n)}_apply(e){const t=this._parse(e);return Jm(e._query,t),new qs(e.firestore,e.converter,nl(e._query,t))}_parse(e){const t=tc(e.firestore);return function(i,o,c,d,h,g,x){let p;if(h.isKeyField()){if(g==="array-contains"||g==="array-contains-any")throw new je(se.INVALID_ARGUMENT,`Invalid Query. You can't perform '${g}' queries on documentId().`);if(g==="in"||g==="not-in"){pu(x,g);const v=[];for(const A of x)v.push(gu(d,i,A));p={arrayValue:{values:v}}}else p=gu(d,i,x)}else g!=="in"&&g!=="not-in"&&g!=="array-contains-any"||pu(x,g),p=Rv(c,o,x,g==="in"||g==="not-in");return vt.create(h,g,p)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}}function Xt(r,e,t){const n=e,a=so("where",r);return no._create(a,n,t)}class ac extends nc{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new ac(e,t)}_parse(e){const t=this._queryConstraints.map(n=>n._parse(e)).filter(n=>n.getFilters().length>0);return t.length===1?t[0]:gr.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return t.getFilters().length===0?e:(function(a,i){let o=a;const c=i.getFlattenedFilters();for(const d of c)Jm(o,d),o=nl(o,d)}(e._query,t),new qs(e.firestore,e.converter,nl(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}class ic extends Xm{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new ic(e,t)}_apply(e){const t=function(a,i,o){if(a.startAt!==null)throw new je(se.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(a.endAt!==null)throw new je(se.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new la(i,o)}(e._query,this._field,this._direction);return new qs(e.firestore,e.converter,function(a,i){const o=a.explicitOrderBy.concat([i]);return new wn(a.path,a.collectionGroup,o,a.filters.slice(),a.limit,a.limitType,a.startAt,a.endAt)}(e._query,t))}}function ua(r,e="asc"){const t=e,n=so("orderBy",r);return ic._create(n,t)}function gu(r,e,t){if(typeof(t=Wt(t))=="string"){if(t==="")throw new je(se.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Qh(e)&&t.indexOf("/")!==-1)throw new je(se.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);const n=e.path.child(dt.fromString(t));if(!Pe.isDocumentKey(n))throw new je(se.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${n}' is not because it has an odd number of segments (${n.length}).`);return $d(r,new Pe(n))}if(t instanceof Qt)return $d(r,t._key);throw new je(se.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Zi(t)}.`)}function pu(r,e){if(!Array.isArray(r)||r.length===0)throw new je(se.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function Jm(r,e){const t=function(a,i){for(const o of a)for(const c of o.getFlattenedFilters())if(i.indexOf(c.op)>=0)return c.op;return null}(r.filters,function(a){switch(a){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(t!==null)throw t===e.op?new je(se.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new je(se.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}class Ov{convertValue(e,t="none"){switch(Ls(e)){case 0:return null;case 1:return e.booleanValue;case 2:return xt(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Vs(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw Ve()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const n={};return Bs(e,(a,i)=>{n[a]=this.convertValue(i,t)}),n}convertVectorValue(e){var t,n,a;const i=(a=(n=(t=e.fields)===null||t===void 0?void 0:t.value.arrayValue)===null||n===void 0?void 0:n.values)===null||a===void 0?void 0:a.map(o=>xt(o.doubleValue));return new Zl(i)}convertGeoPoint(e){return new Jl(xt(e.latitude),xt(e.longitude))}convertArray(e,t){return(e.values||[]).map(n=>this.convertValue(n,t))}convertServerTimestamp(e,t){switch(t){case"previous":const n=Sl(e);return n==null?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(aa(e));default:return null}}convertTimestamp(e){const t=xs(e);return new jt(t.seconds,t.nanos)}convertDocumentKey(e,t){const n=dt.fromString(e);nt(ym(n));const a=new ia(n.get(1),n.get(3)),i=new Pe(n.popFirst(5));return a.isEqual(t)||Wr(`Document ${i} contains a document reference within a different database (${a.projectId}/${a.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Vv(r,e,t){let n;return n=r?r.toFirestore(e):e,n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zn{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class Zm extends Qm{constructor(e,t,n,a,i,o){super(e,t,n,a,o),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new li(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const n=this._document.data.field(so("DocumentSnapshot.get",e));if(n!==null)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}}class li extends Zm{data(e={}){return super.data(e)}}class Lv{constructor(e,t,n,a){this._firestore=e,this._userDataWriter=t,this._snapshot=a,this.metadata=new zn(a.hasPendingWrites,a.fromCache),this.query=n}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(n=>{e.call(t,new li(this._firestore,this._userDataWriter,n.key,n,new zn(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new je(se.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(a,i){if(a._snapshot.oldDocs.isEmpty()){let o=0;return a._snapshot.docChanges.map(c=>{const d=new li(a._firestore,a._userDataWriter,c.doc.key,c.doc,new zn(a._snapshot.mutatedKeys.has(c.doc.key),a._snapshot.fromCache),a.query.converter);return c.doc,{type:"added",doc:d,oldIndex:-1,newIndex:o++}})}{let o=a._snapshot.oldDocs;return a._snapshot.docChanges.filter(c=>i||c.type!==3).map(c=>{const d=new li(a._firestore,a._userDataWriter,c.doc.key,c.doc,new zn(a._snapshot.mutatedKeys.has(c.doc.key),a._snapshot.fromCache),a.query.converter);let h=-1,g=-1;return c.type!==0&&(h=o.indexOf(c.doc.key),o=o.delete(c.doc.key)),c.type!==1&&(o=o.add(c.doc),g=o.indexOf(c.doc.key)),{type:Fv(c.type),doc:d,oldIndex:h,newIndex:g}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function Fv(r){switch(r){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Ve()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function eg(r){r=zr(r,Qt);const e=zr(r.firestore,Nn);return wv(Ql(e),r._key).then(t=>Uv(e,r,t))}class tg extends Ov{constructor(e){super(),this.firestore=e}convertBytes(e){return new fn(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Qt(this.firestore,null,t)}}function lr(r){r=zr(r,qs);const e=zr(r.firestore,Nn),t=Ql(e),n=new tg(e);return $v(r._query),kv(t,r._query).then(a=>new Lv(e,n,r,a))}function Yr(r,e,t,...n){r=zr(r,Qt);const a=zr(r.firestore,Nn),i=tc(a);let o;return o=typeof(e=Wt(e))=="string"||e instanceof to?Dv(i,"updateDoc",r._key,e,t,n):Cv(i,"updateDoc",r._key,e),oc(a,[o.toMutation(r._key,mr.exists(!0))])}function vs(r){return oc(zr(r.firestore,Nn),[new Ml(r._key,mr.none())])}function ws(r,e){const t=zr(r.firestore,Nn),n=St(r),a=Vv(r.converter,e);return oc(t,[Av(tc(r.firestore),"addDoc",n._key,a,r.converter!==null,{}).toMutation(n._key,mr.exists(!1))]).then(()=>n)}function oc(r,e){return function(n,a){const i=new Fr;return n.asyncQueue.enqueueAndForget(async()=>dv(await vv(n),a,i)),i.promise}(Ql(r),e)}function Uv(r,e,t){const n=t.docs.get(e._key),a=new tg(r);return new Zm(r,a,e._key,n,new zn(t.hasPendingWrites,t.fromCache),e.converter)}(function(e,t=!0){(function(a){vn=a})(Us),$s(new ps("firestore",(n,{instanceIdentifier:a,options:i})=>{const o=n.getProvider("app").getImmediate(),c=new Nn(new Wx(n.getProvider("auth-internal")),new Gx(n.getProvider("app-check-internal")),function(h,g){if(!Object.prototype.hasOwnProperty.apply(h.options,["projectId"]))throw new je(se.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new ia(h.options.projectId,g)}(o,a),o);return i=Object.assign({useFetchStreams:t},i),c._setSettings(i),c},"PUBLIC").setMultipleInstances(!0)),br(Cd,"4.7.3",e),br(Cd,"4.7.3","esm2017")})();var Bv="firebase",Wv="10.14.1";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */br(Bv,Wv,"app");function lc(r,e){var t={};for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&e.indexOf(n)<0&&(t[n]=r[n]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var a=0,n=Object.getOwnPropertySymbols(r);a<n.length;a++)e.indexOf(n[a])<0&&Object.prototype.propertyIsEnumerable.call(r,n[a])&&(t[n[a]]=r[n[a]]);return t}function rg(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const qv=rg,sg=new ba("auth","Firebase",rg());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ii=new _l("@firebase/auth");function zv(r,...e){Ii.logLevel<=Ke.WARN&&Ii.warn(`Auth (${Us}): ${r}`,...e)}function ci(r,...e){Ii.logLevel<=Ke.ERROR&&Ii.error(`Auth (${Us}): ${r}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Hr(r,...e){throw cc(r,...e)}function kr(r,...e){return cc(r,...e)}function ng(r,e,t){const n=Object.assign(Object.assign({},qv()),{[e]:t});return new ba("auth","Firebase",n).create(e,{appName:r.name})}function Cs(r){return ng(r,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function cc(r,...e){if(typeof r!="string"){const t=e[0],n=[...e.slice(1)];return n[0]&&(n[0].appName=r.name),r._errorFactory.create(t,...n)}return sg.create(r,...e)}function Oe(r,e,...t){if(!r)throw cc(e,...t)}function $r(r){const e="INTERNAL ASSERTION FAILED: "+r;throw ci(e),new Error(e)}function Gr(r,e){r||$r(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function pl(){var r;return typeof self<"u"&&((r=self.location)===null||r===void 0?void 0:r.href)||""}function Hv(){return fu()==="http:"||fu()==="https:"}function fu(){var r;return typeof self<"u"&&((r=self.location)===null||r===void 0?void 0:r.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Gv(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(Hv()||wf()||"connection"in navigator)?navigator.onLine:!0}function Kv(){if(typeof navigator>"u")return null;const r=navigator;return r.languages&&r.languages[0]||r.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ta{constructor(e,t){this.shortDelay=e,this.longDelay=t,Gr(t>e,"Short delay should be less than long delay!"),this.isMobile=yf()||kf()}get(){return Gv()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function dc(r,e){Gr(r.emulator,"Emulator should always be set here");const{url:t}=r.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ag{static initialize(e,t,n){this.fetchImpl=e,t&&(this.headersImpl=t),n&&(this.responseImpl=n)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;$r("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;$r("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;$r("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Yv={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Qv=new Ta(3e4,6e4);function uc(r,e){return r.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:r.tenantId}):e}async function jn(r,e,t,n,a={}){return ig(r,a,async()=>{let i={},o={};n&&(e==="GET"?o=n:i={body:JSON.stringify(n)});const c=va(Object.assign({key:r.config.apiKey},o)).slice(1),d=await r._getAdditionalHeaders();d["Content-Type"]="application/json",r.languageCode&&(d["X-Firebase-Locale"]=r.languageCode);const h=Object.assign({method:e,headers:d},i);return vf()||(h.referrerPolicy="no-referrer"),ag.fetch()(og(r,r.config.apiHost,t,c),h)})}async function ig(r,e,t){r._canInitEmulator=!1;const n=Object.assign(Object.assign({},Yv),e);try{const a=new Jv(r),i=await Promise.race([t(),a.promise]);a.clearNetworkTimeout();const o=await i.json();if("needConfirmation"in o)throw Xa(r,"account-exists-with-different-credential",o);if(i.ok&&!("errorMessage"in o))return o;{const c=i.ok?o.errorMessage:o.error.message,[d,h]=c.split(" : ");if(d==="FEDERATED_USER_ID_ALREADY_LINKED")throw Xa(r,"credential-already-in-use",o);if(d==="EMAIL_EXISTS")throw Xa(r,"email-already-in-use",o);if(d==="USER_DISABLED")throw Xa(r,"user-disabled",o);const g=n[d]||d.toLowerCase().replace(/[_\s]+/g,"-");if(h)throw ng(r,g,h);Hr(r,g)}}catch(a){if(a instanceof Ir)throw a;Hr(r,"network-request-failed",{message:String(a)})}}async function Xv(r,e,t,n,a={}){const i=await jn(r,e,t,n,a);return"mfaPendingCredential"in i&&Hr(r,"multi-factor-auth-required",{_serverResponse:i}),i}function og(r,e,t,n){const a=`${e}${t}?${n}`;return r.config.emulator?dc(r.config,a):`${r.config.apiScheme}://${a}`}class Jv{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,n)=>{this.timer=setTimeout(()=>n(kr(this.auth,"network-request-failed")),Qv.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function Xa(r,e,t){const n={appName:r.name};t.email&&(n.email=t.email),t.phoneNumber&&(n.phoneNumber=t.phoneNumber);const a=kr(r,e,n);return a.customData._tokenResponse=t,a}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Zv(r,e){return jn(r,"POST","/v1/accounts:delete",e)}async function lg(r,e){return jn(r,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Xn(r){if(r)try{const e=new Date(Number(r));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function ew(r,e=!1){const t=Wt(r),n=await t.getIdToken(e),a=hc(n);Oe(a&&a.exp&&a.auth_time&&a.iat,t.auth,"internal-error");const i=typeof a.firebase=="object"?a.firebase:void 0,o=i==null?void 0:i.sign_in_provider;return{claims:a,token:n,authTime:Xn(Fo(a.auth_time)),issuedAtTime:Xn(Fo(a.iat)),expirationTime:Xn(Fo(a.exp)),signInProvider:o||null,signInSecondFactor:(i==null?void 0:i.sign_in_second_factor)||null}}function Fo(r){return Number(r)*1e3}function hc(r){const[e,t,n]=r.split(".");if(e===void 0||t===void 0||n===void 0)return ci("JWT malformed, contained fewer than 3 sections"),null;try{const a=kh(t);return a?JSON.parse(a):(ci("Failed to decode base64 JWT payload"),null)}catch(a){return ci("Caught error parsing JWT payload as JSON",a==null?void 0:a.toString()),null}}function xu(r){const e=hc(r);return Oe(e,"internal-error"),Oe(typeof e.exp<"u","internal-error"),Oe(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function ha(r,e,t=!1){if(t)return e;try{return await e}catch(n){throw n instanceof Ir&&tw(n)&&r.auth.currentUser===r&&await r.auth.signOut(),n}}function tw({code:r}){return r==="auth/user-disabled"||r==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rw{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){const n=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),n}else{this.errorBackoff=3e4;const a=((t=this.user.stsTokenManager.expirationTime)!==null&&t!==void 0?t:0)-Date.now()-3e5;return Math.max(0,a)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(e==null?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fl{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=Xn(this.lastLoginAt),this.creationTime=Xn(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Ti(r){var e;const t=r.auth,n=await r.getIdToken(),a=await ha(r,lg(t,{idToken:n}));Oe(a==null?void 0:a.users.length,t,"internal-error");const i=a.users[0];r._notifyReloadListener(i);const o=!((e=i.providerUserInfo)===null||e===void 0)&&e.length?cg(i.providerUserInfo):[],c=nw(r.providerData,o),d=r.isAnonymous,h=!(r.email&&i.passwordHash)&&!(c!=null&&c.length),g=d?h:!1,x={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:c,metadata:new fl(i.createdAt,i.lastLoginAt),isAnonymous:g};Object.assign(r,x)}async function sw(r){const e=Wt(r);await Ti(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function nw(r,e){return[...r.filter(n=>!e.some(a=>a.providerId===n.providerId)),...e]}function cg(r){return r.map(e=>{var{providerId:t}=e,n=lc(e,["providerId"]);return{providerId:t,uid:n.rawId||"",displayName:n.displayName||null,email:n.email||null,phoneNumber:n.phoneNumber||null,photoURL:n.photoUrl||null}})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function aw(r,e){const t=await ig(r,{},async()=>{const n=va({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:a,apiKey:i}=r.config,o=og(r,a,"/v1/token",`key=${i}`),c=await r._getAdditionalHeaders();return c["Content-Type"]="application/x-www-form-urlencoded",ag.fetch()(o,{method:"POST",headers:c,body:n})});return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}}async function iw(r,e){return jn(r,"POST","/v2/accounts:revokeToken",uc(r,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tn{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){Oe(e.idToken,"internal-error"),Oe(typeof e.idToken<"u","internal-error"),Oe(typeof e.refreshToken<"u","internal-error");const t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):xu(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){Oe(e.length!==0,"internal-error");const t=xu(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return!t&&this.accessToken&&!this.isExpired?this.accessToken:(Oe(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:n,refreshToken:a,expiresIn:i}=await aw(e,t);this.updateTokensAndExpiration(n,a,Number(i))}updateTokensAndExpiration(e,t,n){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+n*1e3}static fromJSON(e,t){const{refreshToken:n,accessToken:a,expirationTime:i}=t,o=new tn;return n&&(Oe(typeof n=="string","internal-error",{appName:e}),o.refreshToken=n),a&&(Oe(typeof a=="string","internal-error",{appName:e}),o.accessToken=a),i&&(Oe(typeof i=="number","internal-error",{appName:e}),o.expirationTime=i),o}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new tn,this.toJSON())}_performRefresh(){return $r("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ts(r,e){Oe(typeof r=="string"||typeof r>"u","internal-error",{appName:e})}class Or{constructor(e){var{uid:t,auth:n,stsTokenManager:a}=e,i=lc(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new rw(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=n,this.stsTokenManager=a,this.accessToken=a.accessToken,this.displayName=i.displayName||null,this.email=i.email||null,this.emailVerified=i.emailVerified||!1,this.phoneNumber=i.phoneNumber||null,this.photoURL=i.photoURL||null,this.isAnonymous=i.isAnonymous||!1,this.tenantId=i.tenantId||null,this.providerData=i.providerData?[...i.providerData]:[],this.metadata=new fl(i.createdAt||void 0,i.lastLoginAt||void 0)}async getIdToken(e){const t=await ha(this,this.stsTokenManager.getToken(this.auth,e));return Oe(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return ew(this,e)}reload(){return sw(this)}_assign(e){this!==e&&(Oe(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>Object.assign({},t)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new Or(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){Oe(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let n=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),n=!0),t&&await Ti(this),await this.auth._persistUserIfCurrent(this),n&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(cs(this.auth.app))return Promise.reject(Cs(this.auth));const e=await this.getIdToken();return await ha(this,Zv(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var n,a,i,o,c,d,h,g;const x=(n=t.displayName)!==null&&n!==void 0?n:void 0,p=(a=t.email)!==null&&a!==void 0?a:void 0,v=(i=t.phoneNumber)!==null&&i!==void 0?i:void 0,A=(o=t.photoURL)!==null&&o!==void 0?o:void 0,C=(c=t.tenantId)!==null&&c!==void 0?c:void 0,T=(d=t._redirectEventId)!==null&&d!==void 0?d:void 0,z=(h=t.createdAt)!==null&&h!==void 0?h:void 0,$=(g=t.lastLoginAt)!==null&&g!==void 0?g:void 0,{uid:S,emailVerified:I,isAnonymous:H,providerData:G,stsTokenManager:E}=t;Oe(S&&E,e,"internal-error");const y=tn.fromJSON(this.name,E);Oe(typeof S=="string",e,"internal-error"),ts(x,e.name),ts(p,e.name),Oe(typeof I=="boolean",e,"internal-error"),Oe(typeof H=="boolean",e,"internal-error"),ts(v,e.name),ts(A,e.name),ts(C,e.name),ts(T,e.name),ts(z,e.name),ts($,e.name);const w=new Or({uid:S,auth:e,email:p,emailVerified:I,displayName:x,isAnonymous:H,photoURL:A,phoneNumber:v,tenantId:C,stsTokenManager:y,createdAt:z,lastLoginAt:$});return G&&Array.isArray(G)&&(w.providerData=G.map(k=>Object.assign({},k))),T&&(w._redirectEventId=T),w}static async _fromIdTokenResponse(e,t,n=!1){const a=new tn;a.updateFromServerResponse(t);const i=new Or({uid:t.localId,auth:e,stsTokenManager:a,isAnonymous:n});return await Ti(i),i}static async _fromGetAccountInfoResponse(e,t,n){const a=t.users[0];Oe(a.localId!==void 0,"internal-error");const i=a.providerUserInfo!==void 0?cg(a.providerUserInfo):[],o=!(a.email&&a.passwordHash)&&!(i!=null&&i.length),c=new tn;c.updateFromIdToken(n);const d=new Or({uid:a.localId,auth:e,stsTokenManager:c,isAnonymous:o}),h={uid:a.localId,displayName:a.displayName||null,photoURL:a.photoUrl||null,email:a.email||null,emailVerified:a.emailVerified||!1,phoneNumber:a.phoneNumber||null,tenantId:a.tenantId||null,providerData:i,metadata:new fl(a.createdAt,a.lastLoginAt),isAnonymous:!(a.email&&a.passwordHash)&&!(i!=null&&i.length)};return Object.assign(d,h),d}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yu=new Map;function Vr(r){Gr(r instanceof Function,"Expected a class definition");let e=yu.get(r);return e?(Gr(e instanceof r,"Instance stored in cache mismatched with class"),e):(e=new r,yu.set(r,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dg{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return t===void 0?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}dg.type="NONE";const bu=dg;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function di(r,e,t){return`firebase:${r}:${e}:${t}`}class rn{constructor(e,t,n){this.persistence=e,this.auth=t,this.userKey=n;const{config:a,name:i}=this.auth;this.fullUserKey=di(this.userKey,a.apiKey,i),this.fullPersistenceKey=di("persistence",a.apiKey,i),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);return e?Or._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,n="authUser"){if(!t.length)return new rn(Vr(bu),e,n);const a=(await Promise.all(t.map(async h=>{if(await h._isAvailable())return h}))).filter(h=>h);let i=a[0]||Vr(bu);const o=di(n,e.config.apiKey,e.name);let c=null;for(const h of t)try{const g=await h._get(o);if(g){const x=Or._fromJSON(e,g);h!==i&&(c=x),i=h;break}}catch{}const d=a.filter(h=>h._shouldAllowMigration);return!i._shouldAllowMigration||!d.length?new rn(i,e,n):(i=d[0],c&&await i._set(o,c.toJSON()),await Promise.all(t.map(async h=>{if(h!==i)try{await h._remove(o)}catch{}})),new rn(i,e,n))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vu(r){const e=r.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(gg(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(ug(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(fg(e))return"Blackberry";if(xg(e))return"Webos";if(hg(e))return"Safari";if((e.includes("chrome/")||mg(e))&&!e.includes("edge/"))return"Chrome";if(pg(e))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,n=r.match(t);if((n==null?void 0:n.length)===2)return n[1]}return"Other"}function ug(r=Bt()){return/firefox\//i.test(r)}function hg(r=Bt()){const e=r.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function mg(r=Bt()){return/crios\//i.test(r)}function gg(r=Bt()){return/iemobile/i.test(r)}function pg(r=Bt()){return/android/i.test(r)}function fg(r=Bt()){return/blackberry/i.test(r)}function xg(r=Bt()){return/webos/i.test(r)}function mc(r=Bt()){return/iphone|ipad|ipod/i.test(r)||/macintosh/i.test(r)&&/mobile/i.test(r)}function ow(r=Bt()){var e;return mc(r)&&!!(!((e=window.navigator)===null||e===void 0)&&e.standalone)}function lw(){return _f()&&document.documentMode===10}function yg(r=Bt()){return mc(r)||pg(r)||xg(r)||fg(r)||/windows phone/i.test(r)||gg(r)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bg(r,e=[]){let t;switch(r){case"Browser":t=vu(Bt());break;case"Worker":t=`${vu(Bt())}-${r}`;break;default:t=r}const n=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${Us}/${n}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cw{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const n=i=>new Promise((o,c)=>{try{const d=e(i);o(d)}catch(d){c(d)}});n.onAbort=t,this.queue.push(n);const a=this.queue.length-1;return()=>{this.queue[a]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const n of this.queue)await n(e),n.onAbort&&t.push(n.onAbort)}catch(n){t.reverse();for(const a of t)try{a()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:n==null?void 0:n.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function dw(r,e={}){return jn(r,"GET","/v2/passwordPolicy",uc(r,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const uw=6;class hw{constructor(e){var t,n,a,i;const o=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(t=o.minPasswordLength)!==null&&t!==void 0?t:uw,o.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=o.maxPasswordLength),o.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=o.containsLowercaseCharacter),o.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=o.containsUppercaseCharacter),o.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=o.containsNumericCharacter),o.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=o.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(a=(n=e.allowedNonAlphanumericCharacters)===null||n===void 0?void 0:n.join(""))!==null&&a!==void 0?a:"",this.forceUpgradeOnSignin=(i=e.forceUpgradeOnSignin)!==null&&i!==void 0?i:!1,this.schemaVersion=e.schemaVersion}validatePassword(e){var t,n,a,i,o,c;const d={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,d),this.validatePasswordCharacterOptions(e,d),d.isValid&&(d.isValid=(t=d.meetsMinPasswordLength)!==null&&t!==void 0?t:!0),d.isValid&&(d.isValid=(n=d.meetsMaxPasswordLength)!==null&&n!==void 0?n:!0),d.isValid&&(d.isValid=(a=d.containsLowercaseLetter)!==null&&a!==void 0?a:!0),d.isValid&&(d.isValid=(i=d.containsUppercaseLetter)!==null&&i!==void 0?i:!0),d.isValid&&(d.isValid=(o=d.containsNumericCharacter)!==null&&o!==void 0?o:!0),d.isValid&&(d.isValid=(c=d.containsNonAlphanumericCharacter)!==null&&c!==void 0?c:!0),d}validatePasswordLengthOptions(e,t){const n=this.customStrengthOptions.minPasswordLength,a=this.customStrengthOptions.maxPasswordLength;n&&(t.meetsMinPasswordLength=e.length>=n),a&&(t.meetsMaxPasswordLength=e.length<=a)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let n;for(let a=0;a<e.length;a++)n=e.charAt(a),this.updatePasswordCharacterOptionsStatuses(t,n>="a"&&n<="z",n>="A"&&n<="Z",n>="0"&&n<="9",this.allowedNonAlphanumericCharacters.includes(n))}updatePasswordCharacterOptionsStatuses(e,t,n,a,i){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=n)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=a)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mw{constructor(e,t,n,a){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=n,this.config=a,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new wu(this),this.idTokenSubscription=new wu(this),this.beforeStateQueue=new cw(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=sg,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=a.sdkClientVersion}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=Vr(t)),this._initializationPromise=this.queue(async()=>{var n,a;if(!this._deleted&&(this.persistenceManager=await rn.create(this,e),!this._deleted)){if(!((n=this._popupRedirectResolver)===null||n===void 0)&&n._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(t),this.lastNotifiedUid=((a=this.currentUser)===null||a===void 0?void 0:a.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const t=await lg(this,{idToken:e}),n=await Or._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(n)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var t;if(cs(this.app)){const o=this.app.settings.authIdToken;return o?new Promise(c=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(o).then(c,c))}):this.directlySetCurrentUser(null)}const n=await this.assertedPersistence.getCurrentUser();let a=n,i=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const o=(t=this.redirectUser)===null||t===void 0?void 0:t._redirectEventId,c=a==null?void 0:a._redirectEventId,d=await this.tryRedirectSignIn(e);(!o||o===c)&&(d!=null&&d.user)&&(a=d.user,i=!0)}if(!a)return this.directlySetCurrentUser(null);if(!a._redirectEventId){if(i)try{await this.beforeStateQueue.runMiddleware(a)}catch(o){a=n,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(o))}return a?this.reloadAndSetCurrentUserOrClear(a):this.directlySetCurrentUser(null)}return Oe(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===a._redirectEventId?this.directlySetCurrentUser(a):this.reloadAndSetCurrentUserOrClear(a)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await Ti(e)}catch(t){if((t==null?void 0:t.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=Kv()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(cs(this.app))return Promise.reject(Cs(this));const t=e?Wt(e):null;return t&&Oe(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&Oe(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return cs(this.app)?Promise.reject(Cs(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return cs(this.app)?Promise.reject(Cs(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(Vr(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await dw(this),t=new hw(e);this.tenantId===null?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new ba("auth","Firebase",e())}onAuthStateChanged(e,t,n){return this.registerStateListener(this.authStateSubscription,e,t,n)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,n){return this.registerStateListener(this.idTokenSubscription,e,t,n)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const n=this.onAuthStateChanged(()=>{n(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){const t=await this.currentUser.getIdToken(),n={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};this.tenantId!=null&&(n.tenantId=this.tenantId),await iw(this,n)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)===null||e===void 0?void 0:e.toJSON()}}async _setRedirectUser(e,t){const n=await this.getOrInitRedirectPersistenceManager(t);return e===null?n.removeCurrentUser():n.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&Vr(e)||this._popupRedirectResolver;Oe(t,this,"argument-error"),this.redirectPersistenceManager=await rn.create(this,[Vr(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,n;return this._isInitialized&&await this.queue(async()=>{}),((t=this._currentUser)===null||t===void 0?void 0:t._redirectEventId)===e?this._currentUser:((n=this.redirectUser)===null||n===void 0?void 0:n._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const n=(t=(e=this.currentUser)===null||e===void 0?void 0:e.uid)!==null&&t!==void 0?t:null;this.lastNotifiedUid!==n&&(this.lastNotifiedUid=n,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,n,a){if(this._deleted)return()=>{};const i=typeof t=="function"?t:t.next.bind(t);let o=!1;const c=this._isInitialized?Promise.resolve():this._initializationPromise;if(Oe(c,this,"internal-error"),c.then(()=>{o||i(this.currentUser)}),typeof t=="function"){const d=e.addObserver(t,n,a);return()=>{o=!0,d()}}else{const d=e.addObserver(t);return()=>{o=!0,d()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return Oe(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=bg(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);const n=await((e=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getHeartbeatsHeader());n&&(t["X-Firebase-Client"]=n);const a=await this._getAppCheckToken();return a&&(t["X-Firebase-AppCheck"]=a),t}async _getAppCheckToken(){var e;const t=await((e=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getToken());return t!=null&&t.error&&zv(`Error while retrieving App Check token: ${t.error}`),t==null?void 0:t.token}}function gc(r){return Wt(r)}class wu{constructor(e){this.auth=e,this.observer=null,this.addObserver=Cf(t=>this.observer=t)}get next(){return Oe(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let pc={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function gw(r){pc=r}function pw(r){return pc.loadJS(r)}function fw(){return pc.gapiScript}function xw(r){return`__${r}${Math.floor(Math.random()*1e6)}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yw(r,e){const t=Wi(r,"auth");if(t.isInitialized()){const a=t.getImmediate(),i=t.getOptions();if(xi(i,e??{}))return a;Hr(a,"already-initialized")}return t.initialize({options:e})}function bw(r,e){const t=(e==null?void 0:e.persistence)||[],n=(Array.isArray(t)?t:[t]).map(Vr);e!=null&&e.errorMap&&r._updateErrorMap(e.errorMap),r._initializeWithPersistence(n,e==null?void 0:e.popupRedirectResolver)}function vw(r,e,t){const n=gc(r);Oe(n._canInitEmulator,n,"emulator-config-failed"),Oe(/^https?:\/\//.test(e),n,"invalid-emulator-scheme");const a=!1,i=vg(e),{host:o,port:c}=ww(e),d=c===null?"":`:${c}`;n.config.emulator={url:`${i}//${o}${d}/`},n.settings.appVerificationDisabledForTesting=!0,n.emulatorConfig=Object.freeze({host:o,port:c,protocol:i.replace(":",""),options:Object.freeze({disableWarnings:a})}),kw()}function vg(r){const e=r.indexOf(":");return e<0?"":r.substr(0,e+1)}function ww(r){const e=vg(r),t=/(\/\/)?([^?#/]+)/.exec(r.substr(e.length));if(!t)return{host:"",port:null};const n=t[2].split("@").pop()||"",a=/^(\[[^\]]+\])(:|$)/.exec(n);if(a){const i=a[1];return{host:i,port:ku(n.substr(i.length+1))}}else{const[i,o]=n.split(":");return{host:i,port:ku(o)}}}function ku(r){if(!r)return null;const e=Number(r);return isNaN(e)?null:e}function kw(){function r(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",r):r())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wg{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return $r("not implemented")}_getIdTokenResponse(e){return $r("not implemented")}_linkToIdToken(e,t){return $r("not implemented")}_getReauthenticationResolver(e){return $r("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function sn(r,e){return Xv(r,"POST","/v1/accounts:signInWithIdp",uc(r,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _w="http://localhost";class Fs extends wg{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new Fs(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):Hr("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:n,signInMethod:a}=t,i=lc(t,["providerId","signInMethod"]);if(!n||!a)return null;const o=new Fs(n,a);return o.idToken=i.idToken||void 0,o.accessToken=i.accessToken||void 0,o.secret=i.secret,o.nonce=i.nonce,o.pendingToken=i.pendingToken||null,o}_getIdTokenResponse(e){const t=this.buildRequest();return sn(e,t)}_linkToIdToken(e,t){const n=this.buildRequest();return n.idToken=t,sn(e,n)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,sn(e,t)}buildRequest(){const e={requestUri:_w,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=va(t)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kg{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sa extends kg{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class as extends Sa{constructor(){super("facebook.com")}static credential(e){return Fs._fromParams({providerId:as.PROVIDER_ID,signInMethod:as.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return as.credentialFromTaggedObject(e)}static credentialFromError(e){return as.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return as.credential(e.oauthAccessToken)}catch{return null}}}as.FACEBOOK_SIGN_IN_METHOD="facebook.com";as.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class is extends Sa{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return Fs._fromParams({providerId:is.PROVIDER_ID,signInMethod:is.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return is.credentialFromTaggedObject(e)}static credentialFromError(e){return is.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:n}=e;if(!t&&!n)return null;try{return is.credential(t,n)}catch{return null}}}is.GOOGLE_SIGN_IN_METHOD="google.com";is.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class os extends Sa{constructor(){super("github.com")}static credential(e){return Fs._fromParams({providerId:os.PROVIDER_ID,signInMethod:os.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return os.credentialFromTaggedObject(e)}static credentialFromError(e){return os.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return os.credential(e.oauthAccessToken)}catch{return null}}}os.GITHUB_SIGN_IN_METHOD="github.com";os.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ls extends Sa{constructor(){super("twitter.com")}static credential(e,t){return Fs._fromParams({providerId:ls.PROVIDER_ID,signInMethod:ls.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return ls.credentialFromTaggedObject(e)}static credentialFromError(e){return ls.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:n}=e;if(!t||!n)return null;try{return ls.credential(t,n)}catch{return null}}}ls.TWITTER_SIGN_IN_METHOD="twitter.com";ls.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xn{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,n,a=!1){const i=await Or._fromIdTokenResponse(e,n,a),o=_u(n);return new xn({user:i,providerId:o,_tokenResponse:n,operationType:t})}static async _forOperation(e,t,n){await e._updateTokensIfNecessary(n,!0);const a=_u(n);return new xn({user:e,providerId:a,_tokenResponse:n,operationType:t})}}function _u(r){return r.providerId?r.providerId:"phoneNumber"in r?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Si extends Ir{constructor(e,t,n,a){var i;super(t.code,t.message),this.operationType=n,this.user=a,Object.setPrototypeOf(this,Si.prototype),this.customData={appName:e.name,tenantId:(i=e.tenantId)!==null&&i!==void 0?i:void 0,_serverResponse:t.customData._serverResponse,operationType:n}}static _fromErrorAndOperation(e,t,n,a){return new Si(e,t,n,a)}}function _g(r,e,t,n){return(e==="reauthenticate"?t._getReauthenticationResolver(r):t._getIdTokenResponse(r)).catch(i=>{throw i.code==="auth/multi-factor-auth-required"?Si._fromErrorAndOperation(r,i,e,n):i})}async function Nw(r,e,t=!1){const n=await ha(r,e._linkToIdToken(r.auth,await r.getIdToken()),t);return xn._forOperation(r,"link",n)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function jw(r,e,t=!1){const{auth:n}=r;if(cs(n.app))return Promise.reject(Cs(n));const a="reauthenticate";try{const i=await ha(r,_g(n,a,e,r),t);Oe(i.idToken,n,"internal-error");const o=hc(i.idToken);Oe(o,n,"internal-error");const{sub:c}=o;return Oe(r.uid===c,n,"user-mismatch"),xn._forOperation(r,a,i)}catch(i){throw(i==null?void 0:i.code)==="auth/user-not-found"&&Hr(n,"user-mismatch"),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Ew(r,e,t=!1){if(cs(r.app))return Promise.reject(Cs(r));const n="signIn",a=await _g(r,n,e),i=await xn._fromIdTokenResponse(r,n,a);return t||await r._updateCurrentUser(i.user),i}function Iw(r,e,t,n){return Wt(r).onIdTokenChanged(e,t,n)}function Tw(r,e,t){return Wt(r).beforeAuthStateChanged(e,t)}const Ai="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ng{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(Ai,"1"),this.storage.removeItem(Ai),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Sw=1e3,Aw=10;class jg extends Ng{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=yg(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const n=this.storage.getItem(t),a=this.localCache[t];n!==a&&e(t,a,n)}}onStorageEvent(e,t=!1){if(!e.key){this.forAllChangedKeys((o,c,d)=>{this.notifyListeners(o,d)});return}const n=e.key;t?this.detachListener():this.stopPolling();const a=()=>{const o=this.storage.getItem(n);!t&&this.localCache[n]===o||this.notifyListeners(n,o)},i=this.storage.getItem(n);lw()&&i!==e.newValue&&e.newValue!==e.oldValue?setTimeout(a,Aw):a()}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const a of Array.from(n))a(t&&JSON.parse(t))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,n)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:n}),!0)})},Sw)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}jg.type="LOCAL";const Cw=jg;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Eg extends Ng{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}Eg.type="SESSION";const Ig=Eg;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Dw(r){return Promise.all(r.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ao{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(a=>a.isListeningto(e));if(t)return t;const n=new ao(e);return this.receivers.push(n),n}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:n,eventType:a,data:i}=t.data,o=this.handlersMap[a];if(!(o!=null&&o.size))return;t.ports[0].postMessage({status:"ack",eventId:n,eventType:a});const c=Array.from(o).map(async h=>h(t.origin,i)),d=await Dw(c);t.ports[0].postMessage({status:"done",eventId:n,eventType:a,response:d})}_subscribe(e,t){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),(!t||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}ao.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fc(r="",e=10){let t="";for(let n=0;n<e;n++)t+=Math.floor(Math.random()*10);return r+t}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rw{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,n=50){const a=typeof MessageChannel<"u"?new MessageChannel:null;if(!a)throw new Error("connection_unavailable");let i,o;return new Promise((c,d)=>{const h=fc("",20);a.port1.start();const g=setTimeout(()=>{d(new Error("unsupported_event"))},n);o={messageChannel:a,onMessage(x){const p=x;if(p.data.eventId===h)switch(p.data.status){case"ack":clearTimeout(g),i=setTimeout(()=>{d(new Error("timeout"))},3e3);break;case"done":clearTimeout(i),c(p.data.response);break;default:clearTimeout(g),clearTimeout(i),d(new Error("invalid_response"));break}}},this.handlers.add(o),a.port1.addEventListener("message",o.onMessage),this.target.postMessage({eventType:e,eventId:h,data:t},[a.port2])}).finally(()=>{o&&this.removeMessageHandler(o)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _r(){return window}function Pw(r){_r().location.href=r}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Tg(){return typeof _r().WorkerGlobalScope<"u"&&typeof _r().importScripts=="function"}async function Mw(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function $w(){var r;return((r=navigator==null?void 0:navigator.serviceWorker)===null||r===void 0?void 0:r.controller)||null}function Ow(){return Tg()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Sg="firebaseLocalStorageDb",Vw=1,Ci="firebaseLocalStorage",Ag="fbase_key";class Aa{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function io(r,e){return r.transaction([Ci],e?"readwrite":"readonly").objectStore(Ci)}function Lw(){const r=indexedDB.deleteDatabase(Sg);return new Aa(r).toPromise()}function xl(){const r=indexedDB.open(Sg,Vw);return new Promise((e,t)=>{r.addEventListener("error",()=>{t(r.error)}),r.addEventListener("upgradeneeded",()=>{const n=r.result;try{n.createObjectStore(Ci,{keyPath:Ag})}catch(a){t(a)}}),r.addEventListener("success",async()=>{const n=r.result;n.objectStoreNames.contains(Ci)?e(n):(n.close(),await Lw(),e(await xl()))})})}async function Nu(r,e,t){const n=io(r,!0).put({[Ag]:e,value:t});return new Aa(n).toPromise()}async function Fw(r,e){const t=io(r,!1).get(e),n=await new Aa(t).toPromise();return n===void 0?null:n.value}function ju(r,e){const t=io(r,!0).delete(e);return new Aa(t).toPromise()}const Uw=800,Bw=3;class Cg{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await xl(),this.db)}async _withRetries(e){let t=0;for(;;)try{const n=await this._openDb();return await e(n)}catch(n){if(t++>Bw)throw n;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return Tg()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=ao._getInstance(Ow()),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){var e,t;if(this.activeServiceWorker=await Mw(),!this.activeServiceWorker)return;this.sender=new Rw(this.activeServiceWorker);const n=await this.sender._send("ping",{},800);n&&!((e=n[0])===null||e===void 0)&&e.fulfilled&&!((t=n[0])===null||t===void 0)&&t.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||$w()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await xl();return await Nu(e,Ai,"1"),await ju(e,Ai),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(n=>Nu(n,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(n=>Fw(n,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>ju(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(a=>{const i=io(a,!1).getAll();return new Aa(i).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const t=[],n=new Set;if(e.length!==0)for(const{fbase_key:a,value:i}of e)n.add(a),JSON.stringify(this.localCache[a])!==JSON.stringify(i)&&(this.notifyListeners(a,i),t.push(a));for(const a of Object.keys(this.localCache))this.localCache[a]&&!n.has(a)&&(this.notifyListeners(a,null),t.push(a));return t}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const a of Array.from(n))a(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),Uw)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}Cg.type="LOCAL";const Ww=Cg;new Ta(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qw(r,e){return e?Vr(e):(Oe(r._popupRedirectResolver,r,"argument-error"),r._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xc extends wg{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return sn(e,this._buildIdpRequest())}_linkToIdToken(e,t){return sn(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return sn(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function zw(r){return Ew(r.auth,new xc(r),r.bypassAuthState)}function Hw(r){const{auth:e,user:t}=r;return Oe(t,e,"internal-error"),jw(t,new xc(r),r.bypassAuthState)}async function Gw(r){const{auth:e,user:t}=r;return Oe(t,e,"internal-error"),Nw(t,new xc(r),r.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dg{constructor(e,t,n,a,i=!1){this.auth=e,this.resolver=n,this.user=a,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(n){this.reject(n)}})}async onAuthEvent(e){const{urlResponse:t,sessionId:n,postBody:a,tenantId:i,error:o,type:c}=e;if(o){this.reject(o);return}const d={auth:this.auth,requestUri:t,sessionId:n,tenantId:i||void 0,postBody:a||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(c)(d))}catch(h){this.reject(h)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return zw;case"linkViaPopup":case"linkViaRedirect":return Gw;case"reauthViaPopup":case"reauthViaRedirect":return Hw;default:Hr(this.auth,"internal-error")}}resolve(e){Gr(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){Gr(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Kw=new Ta(2e3,1e4);class Zs extends Dg{constructor(e,t,n,a,i){super(e,t,a,i),this.provider=n,this.authWindow=null,this.pollId=null,Zs.currentPopupAction&&Zs.currentPopupAction.cancel(),Zs.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return Oe(e,this.auth,"internal-error"),e}async onExecution(){Gr(this.filter.length===1,"Popup operations only handle one event");const e=fc();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(t=>{this.reject(t)}),this.resolver._isIframeWebStorageSupported(this.auth,t=>{t||this.reject(kr(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)===null||e===void 0?void 0:e.associatedEvent)||null}cancel(){this.reject(kr(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Zs.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,n;if(!((n=(t=this.authWindow)===null||t===void 0?void 0:t.window)===null||n===void 0)&&n.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(kr(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,Kw.get())};e()}}Zs.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Yw="pendingRedirect",ui=new Map;class Qw extends Dg{constructor(e,t,n=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,n),this.eventId=null}async execute(){let e=ui.get(this.auth._key());if(!e){try{const n=await Xw(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(n)}catch(t){e=()=>Promise.reject(t)}ui.set(this.auth._key(),e)}return this.bypassAuthState||ui.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function Xw(r,e){const t=e1(e),n=Zw(r);if(!await n._isAvailable())return!1;const a=await n._get(t)==="true";return await n._remove(t),a}function Jw(r,e){ui.set(r._key(),e)}function Zw(r){return Vr(r._redirectPersistence)}function e1(r){return di(Yw,r.config.apiKey,r.name)}async function t1(r,e,t=!1){if(cs(r.app))return Promise.reject(Cs(r));const n=gc(r),a=qw(n,e),o=await new Qw(n,a,t).execute();return o&&!t&&(delete o.user._redirectEventId,await n._persistUserIfCurrent(o.user),await n._setRedirectUser(null,e)),o}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const r1=10*60*1e3;class s1{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(n=>{this.isEventForConsumer(e,n)&&(t=!0,this.sendToConsumer(e,n),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!n1(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var n;if(e.error&&!Rg(e)){const a=((n=e.error.code)===null||n===void 0?void 0:n.split("auth/")[1])||"internal-error";t.onError(kr(this.auth,a))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const n=t.eventId===null||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&n}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=r1&&this.cachedEventUids.clear(),this.cachedEventUids.has(Eu(e))}saveEventToCache(e){this.cachedEventUids.add(Eu(e)),this.lastProcessedEventTime=Date.now()}}function Eu(r){return[r.type,r.eventId,r.sessionId,r.tenantId].filter(e=>e).join("-")}function Rg({type:r,error:e}){return r==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function n1(r){switch(r.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return Rg(r);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function a1(r,e={}){return jn(r,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const i1=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,o1=/^https?/;async function l1(r){if(r.config.emulator)return;const{authorizedDomains:e}=await a1(r);for(const t of e)try{if(c1(t))return}catch{}Hr(r,"unauthorized-domain")}function c1(r){const e=pl(),{protocol:t,hostname:n}=new URL(e);if(r.startsWith("chrome-extension://")){const o=new URL(r);return o.hostname===""&&n===""?t==="chrome-extension:"&&r.replace("chrome-extension://","")===e.replace("chrome-extension://",""):t==="chrome-extension:"&&o.hostname===n}if(!o1.test(t))return!1;if(i1.test(r))return n===r;const a=r.replace(/\./g,"\\.");return new RegExp("^(.+\\."+a+"|"+a+")$","i").test(n)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const d1=new Ta(3e4,6e4);function Iu(){const r=_r().___jsl;if(r!=null&&r.H){for(const e of Object.keys(r.H))if(r.H[e].r=r.H[e].r||[],r.H[e].L=r.H[e].L||[],r.H[e].r=[...r.H[e].L],r.CP)for(let t=0;t<r.CP.length;t++)r.CP[t]=null}}function u1(r){return new Promise((e,t)=>{var n,a,i;function o(){Iu(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{Iu(),t(kr(r,"network-request-failed"))},timeout:d1.get()})}if(!((a=(n=_r().gapi)===null||n===void 0?void 0:n.iframes)===null||a===void 0)&&a.Iframe)e(gapi.iframes.getContext());else if(!((i=_r().gapi)===null||i===void 0)&&i.load)o();else{const c=xw("iframefcb");return _r()[c]=()=>{gapi.load?o():t(kr(r,"network-request-failed"))},pw(`${fw()}?onload=${c}`).catch(d=>t(d))}}).catch(e=>{throw hi=null,e})}let hi=null;function h1(r){return hi=hi||u1(r),hi}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const m1=new Ta(5e3,15e3),g1="__/auth/iframe",p1="emulator/auth/iframe",f1={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},x1=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function y1(r){const e=r.config;Oe(e.authDomain,r,"auth-domain-config-required");const t=e.emulator?dc(e,p1):`https://${r.config.authDomain}/${g1}`,n={apiKey:e.apiKey,appName:r.name,v:Us},a=x1.get(r.config.apiHost);a&&(n.eid=a);const i=r._getFrameworks();return i.length&&(n.fw=i.join(",")),`${t}?${va(n).slice(1)}`}async function b1(r){const e=await h1(r),t=_r().gapi;return Oe(t,r,"internal-error"),e.open({where:document.body,url:y1(r),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:f1,dontclear:!0},n=>new Promise(async(a,i)=>{await n.restyle({setHideOnLeave:!1});const o=kr(r,"network-request-failed"),c=_r().setTimeout(()=>{i(o)},m1.get());function d(){_r().clearTimeout(c),a(n)}n.ping(d).then(d,()=>{i(o)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const v1={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},w1=500,k1=600,_1="_blank",N1="http://localhost";class Tu{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function j1(r,e,t,n=w1,a=k1){const i=Math.max((window.screen.availHeight-a)/2,0).toString(),o=Math.max((window.screen.availWidth-n)/2,0).toString();let c="";const d=Object.assign(Object.assign({},v1),{width:n.toString(),height:a.toString(),top:i,left:o}),h=Bt().toLowerCase();t&&(c=mg(h)?_1:t),ug(h)&&(e=e||N1,d.scrollbars="yes");const g=Object.entries(d).reduce((p,[v,A])=>`${p}${v}=${A},`,"");if(ow(h)&&c!=="_self")return E1(e||"",c),new Tu(null);const x=window.open(e||"",c,g);Oe(x,r,"popup-blocked");try{x.focus()}catch{}return new Tu(x)}function E1(r,e){const t=document.createElement("a");t.href=r,t.target=e;const n=document.createEvent("MouseEvent");n.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),t.dispatchEvent(n)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const I1="__/auth/handler",T1="emulator/auth/handler",S1=encodeURIComponent("fac");async function Su(r,e,t,n,a,i){Oe(r.config.authDomain,r,"auth-domain-config-required"),Oe(r.config.apiKey,r,"invalid-api-key");const o={apiKey:r.config.apiKey,appName:r.name,authType:t,redirectUrl:n,v:Us,eventId:a};if(e instanceof kg){e.setDefaultLanguage(r.languageCode),o.providerId=e.providerId||"",Af(e.getCustomParameters())||(o.customParameters=JSON.stringify(e.getCustomParameters()));for(const[g,x]of Object.entries({}))o[g]=x}if(e instanceof Sa){const g=e.getScopes().filter(x=>x!=="");g.length>0&&(o.scopes=g.join(","))}r.tenantId&&(o.tid=r.tenantId);const c=o;for(const g of Object.keys(c))c[g]===void 0&&delete c[g];const d=await r._getAppCheckToken(),h=d?`#${S1}=${encodeURIComponent(d)}`:"";return`${A1(r)}?${va(c).slice(1)}${h}`}function A1({config:r}){return r.emulator?dc(r,T1):`https://${r.authDomain}/${I1}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Uo="webStorageSupport";class C1{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=Ig,this._completeRedirectFn=t1,this._overrideRedirectResult=Jw}async _openPopup(e,t,n,a){var i;Gr((i=this.eventManagers[e._key()])===null||i===void 0?void 0:i.manager,"_initialize() not called before _openPopup()");const o=await Su(e,t,n,pl(),a);return j1(e,o,fc())}async _openRedirect(e,t,n,a){await this._originValidation(e);const i=await Su(e,t,n,pl(),a);return Pw(i),new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:a,promise:i}=this.eventManagers[t];return a?Promise.resolve(a):(Gr(i,"If manager is not set, promise should be"),i)}const n=this.initAndGetManager(e);return this.eventManagers[t]={promise:n},n.catch(()=>{delete this.eventManagers[t]}),n}async initAndGetManager(e){const t=await b1(e),n=new s1(e);return t.register("authEvent",a=>(Oe(a==null?void 0:a.authEvent,e,"invalid-auth-event"),{status:n.onEvent(a.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:n},this.iframes[e._key()]=t,n}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(Uo,{type:Uo},a=>{var i;const o=(i=a==null?void 0:a[0])===null||i===void 0?void 0:i[Uo];o!==void 0&&t(!!o),Hr(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=l1(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return yg()||hg()||mc()}}const D1=C1;var Au="@firebase/auth",Cu="1.7.9";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class R1{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)===null||e===void 0?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(n=>{e((n==null?void 0:n.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){Oe(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function P1(r){switch(r){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function M1(r){$s(new ps("auth",(e,{options:t})=>{const n=e.getProvider("app").getImmediate(),a=e.getProvider("heartbeat"),i=e.getProvider("app-check-internal"),{apiKey:o,authDomain:c}=n.options;Oe(o&&!o.includes(":"),"invalid-api-key",{appName:n.name});const d={apiKey:o,authDomain:c,clientPlatform:r,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:bg(r)},h=new mw(n,a,i,d);return bw(h,t),h},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,n)=>{e.getProvider("auth-internal").initialize()})),$s(new ps("auth-internal",e=>{const t=gc(e.getProvider("auth").getImmediate());return(n=>new R1(n))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),br(Au,Cu,P1(r)),br(Au,Cu,"esm2017")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $1=5*60,O1=Eh("authIdTokenMaxAge")||$1;let Du=null;const V1=r=>async e=>{const t=e&&await e.getIdTokenResult(),n=t&&(new Date().getTime()-Date.parse(t.issuedAtTime))/1e3;if(n&&n>O1)return;const a=t==null?void 0:t.token;Du!==a&&(Du=a,await fetch(r,{method:a?"POST":"DELETE",headers:a?{Authorization:`Bearer ${a}`}:{}}))};function L1(r=jl()){const e=Wi(r,"auth");if(e.isInitialized())return e.getImmediate();const t=yw(r,{popupRedirectResolver:D1,persistence:[Ww,Cw,Ig]}),n=Eh("authTokenSyncURL");if(n&&typeof isSecureContext=="boolean"&&isSecureContext){const i=new URL(n,location.origin);if(location.origin===i.origin){const o=V1(i.toString());Tw(t,o,()=>o(t.currentUser)),Iw(t,c=>o(c))}}const a=_h("auth");return a&&vw(t,`http://${a}`),t}function F1(){var r,e;return(e=(r=document.getElementsByTagName("head"))===null||r===void 0?void 0:r[0])!==null&&e!==void 0?e:document}gw({loadJS(r){return new Promise((e,t)=>{const n=document.createElement("script");n.setAttribute("src",r),n.onload=e,n.onerror=a=>{const i=kr("internal-error");i.customData=a,t(i)},n.type="text/javascript",n.charset="UTF-8",F1().appendChild(n)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});M1("Browser");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Pg="firebasestorage.googleapis.com",U1="storageBucket",B1=2*60*1e3,W1=10*60*1e3;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tr extends Ir{constructor(e,t,n=0){super(Bo(e),`Firebase Storage: ${t} (${Bo(e)})`),this.status_=n,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,Tr.prototype)}get status(){return this.status_}set status(e){this.status_=e}_codeEquals(e){return Bo(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message=`${this._baseMessage}
${this.customData.serverResponse}`:this.message=this._baseMessage}}var jr;(function(r){r.UNKNOWN="unknown",r.OBJECT_NOT_FOUND="object-not-found",r.BUCKET_NOT_FOUND="bucket-not-found",r.PROJECT_NOT_FOUND="project-not-found",r.QUOTA_EXCEEDED="quota-exceeded",r.UNAUTHENTICATED="unauthenticated",r.UNAUTHORIZED="unauthorized",r.UNAUTHORIZED_APP="unauthorized-app",r.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",r.INVALID_CHECKSUM="invalid-checksum",r.CANCELED="canceled",r.INVALID_EVENT_NAME="invalid-event-name",r.INVALID_URL="invalid-url",r.INVALID_DEFAULT_BUCKET="invalid-default-bucket",r.NO_DEFAULT_BUCKET="no-default-bucket",r.CANNOT_SLICE_BLOB="cannot-slice-blob",r.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",r.NO_DOWNLOAD_URL="no-download-url",r.INVALID_ARGUMENT="invalid-argument",r.INVALID_ARGUMENT_COUNT="invalid-argument-count",r.APP_DELETED="app-deleted",r.INVALID_ROOT_OPERATION="invalid-root-operation",r.INVALID_FORMAT="invalid-format",r.INTERNAL_ERROR="internal-error",r.UNSUPPORTED_ENVIRONMENT="unsupported-environment"})(jr||(jr={}));function Bo(r){return"storage/"+r}function q1(){const r="An unknown error occurred, please check the error payload for server response.";return new Tr(jr.UNKNOWN,r)}function z1(){return new Tr(jr.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function H1(){return new Tr(jr.CANCELED,"User canceled the upload/download.")}function G1(r){return new Tr(jr.INVALID_URL,"Invalid URL '"+r+"'.")}function K1(r){return new Tr(jr.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+r+"'.")}function Ru(r){return new Tr(jr.INVALID_ARGUMENT,r)}function Mg(){return new Tr(jr.APP_DELETED,"The Firebase app was deleted.")}function Y1(r){return new Tr(jr.INVALID_ROOT_OPERATION,"The operation '"+r+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hr{constructor(e,t){this.bucket=e,this.path_=t}get path(){return this.path_}get isRoot(){return this.path.length===0}fullServerUrl(){const e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(e,t){let n;try{n=hr.makeFromUrl(e,t)}catch{return new hr(e,"")}if(n.path==="")return n;throw K1(e)}static makeFromUrl(e,t){let n=null;const a="([A-Za-z0-9.\\-_]+)";function i(I){I.path.charAt(I.path.length-1)==="/"&&(I.path_=I.path_.slice(0,-1))}const o="(/(.*))?$",c=new RegExp("^gs://"+a+o,"i"),d={bucket:1,path:3};function h(I){I.path_=decodeURIComponent(I.path)}const g="v[A-Za-z0-9_]+",x=t.replace(/[.]/g,"\\."),p="(/([^?#]*).*)?$",v=new RegExp(`^https?://${x}/${g}/b/${a}/o${p}`,"i"),A={bucket:1,path:3},C=t===Pg?"(?:storage.googleapis.com|storage.cloud.google.com)":t,T="([^?#]*)",z=new RegExp(`^https?://${C}/${a}/${T}`,"i"),S=[{regex:c,indices:d,postModify:i},{regex:v,indices:A,postModify:h},{regex:z,indices:{bucket:1,path:2},postModify:h}];for(let I=0;I<S.length;I++){const H=S[I],G=H.regex.exec(e);if(G){const E=G[H.indices.bucket];let y=G[H.indices.path];y||(y=""),n=new hr(E,y),H.postModify(n);break}}if(n==null)throw G1(e);return n}}class Q1{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(e=!1){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function X1(r,e,t){let n=1,a=null,i=null,o=!1,c=0;function d(){return c===2}let h=!1;function g(...T){h||(h=!0,e.apply(null,T))}function x(T){a=setTimeout(()=>{a=null,r(v,d())},T)}function p(){i&&clearTimeout(i)}function v(T,...z){if(h){p();return}if(T){p(),g.call(null,T,...z);return}if(d()||o){p(),g.call(null,T,...z);return}n<64&&(n*=2);let S;c===1?(c=2,S=0):S=(n+Math.random())*1e3,x(S)}let A=!1;function C(T){A||(A=!0,p(),!h&&(a!==null?(T||(c=2),clearTimeout(a),x(0)):T||(c=1)))}return x(0),i=setTimeout(()=>{o=!0,C(!0)},t),C}function J1(r){r(!1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Z1(r){return r!==void 0}function Pu(r,e,t,n){if(n<e)throw Ru(`Invalid value for '${r}'. Expected ${e} or greater.`);if(n>t)throw Ru(`Invalid value for '${r}'. Expected ${t} or less.`)}function e2(r){const e=encodeURIComponent;let t="?";for(const n in r)if(r.hasOwnProperty(n)){const a=e(n)+"="+e(r[n]);t=t+a+"&"}return t=t.slice(0,-1),t}var Di;(function(r){r[r.NO_ERROR=0]="NO_ERROR",r[r.NETWORK_ERROR=1]="NETWORK_ERROR",r[r.ABORT=2]="ABORT"})(Di||(Di={}));/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function t2(r,e){const t=r>=500&&r<600,a=[408,429].indexOf(r)!==-1,i=e.indexOf(r)!==-1;return t||a||i}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class r2{constructor(e,t,n,a,i,o,c,d,h,g,x,p=!0){this.url_=e,this.method_=t,this.headers_=n,this.body_=a,this.successCodes_=i,this.additionalRetryCodes_=o,this.callback_=c,this.errorCallback_=d,this.timeout_=h,this.progressCallback_=g,this.connectionFactory_=x,this.retry=p,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((v,A)=>{this.resolve_=v,this.reject_=A,this.start_()})}start_(){const e=(n,a)=>{if(a){n(!1,new Ja(!1,null,!0));return}const i=this.connectionFactory_();this.pendingConnection_=i;const o=c=>{const d=c.loaded,h=c.lengthComputable?c.total:-1;this.progressCallback_!==null&&this.progressCallback_(d,h)};this.progressCallback_!==null&&i.addUploadProgressListener(o),i.send(this.url_,this.method_,this.body_,this.headers_).then(()=>{this.progressCallback_!==null&&i.removeUploadProgressListener(o),this.pendingConnection_=null;const c=i.getErrorCode()===Di.NO_ERROR,d=i.getStatus();if(!c||t2(d,this.additionalRetryCodes_)&&this.retry){const g=i.getErrorCode()===Di.ABORT;n(!1,new Ja(!1,null,g));return}const h=this.successCodes_.indexOf(d)!==-1;n(!0,new Ja(h,i))})},t=(n,a)=>{const i=this.resolve_,o=this.reject_,c=a.connection;if(a.wasSuccessCode)try{const d=this.callback_(c,c.getResponse());Z1(d)?i(d):i()}catch(d){o(d)}else if(c!==null){const d=q1();d.serverResponse=c.getErrorText(),this.errorCallback_?o(this.errorCallback_(c,d)):o(d)}else if(a.canceled){const d=this.appDelete_?Mg():H1();o(d)}else{const d=z1();o(d)}};this.canceled_?t(!1,new Ja(!1,null,!0)):this.backoffId_=X1(e,t,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,this.backoffId_!==null&&J1(this.backoffId_),this.pendingConnection_!==null&&this.pendingConnection_.abort()}}class Ja{constructor(e,t,n){this.wasSuccessCode=e,this.connection=t,this.canceled=!!n}}function s2(r,e){e!==null&&e.length>0&&(r.Authorization="Firebase "+e)}function n2(r,e){r["X-Firebase-Storage-Version"]="webjs/"+(e??"AppManager")}function a2(r,e){e&&(r["X-Firebase-GMPID"]=e)}function i2(r,e){e!==null&&(r["X-Firebase-AppCheck"]=e)}function o2(r,e,t,n,a,i,o=!0){const c=e2(r.urlParams),d=r.url+c,h=Object.assign({},r.headers);return a2(h,e),s2(h,t),n2(h,i),i2(h,n),new r2(d,r.method,h,r.body,r.successCodes,r.additionalRetryCodes,r.handler,r.errorHandler,r.timeout,r.progressCallback,a,o)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function l2(r){if(r.length===0)return null;const e=r.lastIndexOf("/");return e===-1?"":r.slice(0,e)}function c2(r){const e=r.lastIndexOf("/",r.length-2);return e===-1?r:r.slice(e+1)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ri{constructor(e,t){this._service=e,t instanceof hr?this._location=t:this._location=hr.makeFromUrl(t,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,t){return new Ri(e,t)}get root(){const e=new hr(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return c2(this._location.path)}get storage(){return this._service}get parent(){const e=l2(this._location.path);if(e===null)return null;const t=new hr(this._location.bucket,e);return new Ri(this._service,t)}_throwIfRoot(e){if(this._location.path==="")throw Y1(e)}}function Mu(r,e){const t=e==null?void 0:e[U1];return t==null?null:hr.makeFromBucketSpec(t,r)}function d2(r,e,t,n={}){r.host=`${e}:${t}`,r._protocol="http";const{mockUserToken:a}=n;a&&(r._overrideAuthToken=typeof a=="string"?a:Ih(a,r.app.options.projectId))}class u2{constructor(e,t,n,a,i){this.app=e,this._authProvider=t,this._appCheckProvider=n,this._url=a,this._firebaseVersion=i,this._bucket=null,this._host=Pg,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=B1,this._maxUploadRetryTime=W1,this._requests=new Set,a!=null?this._bucket=hr.makeFromBucketSpec(a,this._host):this._bucket=Mu(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,this._url!=null?this._bucket=hr.makeFromBucketSpec(this._url,e):this._bucket=Mu(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){Pu("time",0,Number.POSITIVE_INFINITY,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){Pu("time",0,Number.POSITIVE_INFINITY,e),this._maxOperationRetryTime=e}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const e=this._authProvider.getImmediate({optional:!0});if(e){const t=await e.getToken();if(t!==null)return t.accessToken}return null}async _getAppCheckToken(){const e=this._appCheckProvider.getImmediate({optional:!0});return e?(await e.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(e=>e.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new Ri(this,e)}_makeRequest(e,t,n,a,i=!0){if(this._deleted)return new Q1(Mg());{const o=o2(e,this._appId,n,a,t,this._firebaseVersion,i);return this._requests.add(o),o.getPromise().then(()=>this._requests.delete(o),()=>this._requests.delete(o)),o}}async makeRequestWithTokens(e,t){const[n,a]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,t,n,a).getPromise()}}const $u="@firebase/storage",Ou="0.13.2";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $g="storage";function h2(r=jl(),e){r=Wt(r);const n=Wi(r,$g).getImmediate({identifier:e}),a=Nh("storage");return a&&m2(n,...a),n}function m2(r,e,t,n={}){d2(r,e,t,n)}function g2(r,{instanceIdentifier:e}){const t=r.getProvider("app").getImmediate(),n=r.getProvider("auth-internal"),a=r.getProvider("app-check-internal");return new u2(t,n,a,e,Us)}function p2(){$s(new ps($g,g2,"PUBLIC").setMultipleInstances(!0)),br($u,Ou,""),br($u,Ou,"esm2017")}p2();const Pr={apiKey:"your-api-key",authDomain:"your-auth-domain",projectId:"your-project-id",storageBucket:"your-storage-bucket",messagingSenderId:"your-messaging-sender-id",appId:"your-app-id"};console.log("Firebase config check:",{hasApiKey:!!Pr.apiKey&&Pr.apiKey!=="your-api-key",authDomain:Pr.authDomain,projectId:Pr.projectId,hasStorageBucket:!!Pr.storageBucket&&Pr.storageBucket!=="your-storage-bucket",hasAppId:!!Pr.appId&&Pr.appId!=="your-app-id"});console.log("Raw env values:",{VITE_FIREBASE_API_KEY:void 0,VITE_FIREBASE_AUTH_DOMAIN:void 0,VITE_FIREBASE_PROJECT_ID:void 0,VITE_FIREBASE_STORAGE_BUCKET:void 0});const yc=Ah(Pr);L1(yc);const We=jv(yc);h2(yc);console.log("Firestore db initialized:",!!We);const f2=30,Vu=r=>r.toString().padStart(2,"0"),x2=()=>{const r=new Date;return r.setDate(r.getDate()-f2),{dateOnly:`${r.getFullYear()}-${Vu(r.getMonth()+1)}-${Vu(r.getDate())}`,iso:r.toISOString()}},Za=async(r,e,t)=>{const n=wt(We,r),a=ft(n,Xt(e,"<",t)),i=await lr(a);await Promise.all(i.docs.map(o=>vs(St(We,r,o.id))))},y2=async()=>{try{const{dateOnly:r,iso:e}=x2();await Promise.all([Za("workSlots","date",r),Za("dayStatuses","date",r),Za("earnings","date",r),Za("referrals","createdAt",e)])}catch(r){console.error("Failed to cleanup old data",r)}},Kr=async(r,e)=>{const t=wt(We,"workSlots");let n;r&&e||r?n=ft(t,Xt("userId","==",r)):e?n=ft(t,Xt("date","==",e)):n=ft(t);let i=(await lr(n)).docs.map(o=>{const c=o.data(),d=((c==null?void 0:c.slots)||[]).map(h=>h.break&&!h.breaks?{...h,breaks:[h.break],break:void 0}:h);return{id:o.id,userId:(c==null?void 0:c.userId)||"",date:(c==null?void 0:c.date)||"",slots:d,participants:(c==null?void 0:c.participants)||[],...(c==null?void 0:c.comment)&&{comment:c.comment}}});return r&&e&&(i=i.filter(o=>o.date===e)),i.sort((o,c)=>o.date.localeCompare(c.date)),i},Og=async r=>{try{console.log("addWorkSlot: Starting, db initialized:",!!We);const e=wt(We,"workSlots");console.log("addWorkSlot: Collection reference created");const t=Object.fromEntries(Object.entries(r).filter(([a,i])=>i!==void 0));console.log("addWorkSlot: Clean slot prepared:",t),console.log("addWorkSlot: Calling addDoc...");const n=await ws(e,t);return console.log("addWorkSlot: Work slot added successfully:",n.id),n}catch(e){throw console.error("addWorkSlot: Error caught:",e),console.error("addWorkSlot: Error code:",e==null?void 0:e.code),console.error("addWorkSlot: Error message:",e==null?void 0:e.message),console.error("addWorkSlot: Full error:",JSON.stringify(e,null,2)),e}},Vg=async(r,e)=>{const t=St(We,"workSlots",r),n=Object.fromEntries(Object.entries(e).filter(([a,i])=>i!==void 0));await Yr(t,n)},oo=async r=>{const e=St(We,"workSlots",r);await vs(e)},yr=async(r,e)=>{const t=wt(We,"dayStatuses");let n;r?n=ft(t,Xt("userId","==",r)):n=ft(t);let i=(await lr(n)).docs.map(o=>{const c=o.data();return{id:o.id,userId:(c==null?void 0:c.userId)||"",date:(c==null?void 0:c.date)||"",type:(c==null?void 0:c.type)||"dayoff",...(c==null?void 0:c.comment)&&{comment:c.comment},...(c==null?void 0:c.endDate)&&{endDate:c.endDate}}});return i.sort((o,c)=>o.date.localeCompare(c.date)),i},lo=async r=>{try{const e=wt(We,"dayStatuses"),t=Object.fromEntries(Object.entries(r).filter(([a,i])=>i!==void 0));console.log("Adding day status:",t);const n=await ws(e,t);return console.log("Day status added successfully:",n.id),n}catch(e){throw console.error("Error in addDayStatus:",e),e}},gs=async(r,e)=>{const t=St(We,"dayStatuses",r),n=Object.fromEntries(Object.entries(e).filter(([a,i])=>i!==void 0));await Yr(t,n)},co=async r=>{const e=St(We,"dayStatuses",r);await vs(e)},uo="approvalRequests",bc=r=>{const e=r.data(),t=new Date().toISOString();return{id:r.id,entity:(e==null?void 0:e.entity)||"slot",action:(e==null?void 0:e.action)||"create",status:(e==null?void 0:e.status)||"pending",authorId:(e==null?void 0:e.authorId)||"",targetUserId:(e==null?void 0:e.targetUserId)||"",before:(e==null?void 0:e.before)??null,after:(e==null?void 0:e.after)??null,comment:e==null?void 0:e.comment,adminComment:e==null?void 0:e.adminComment,reviewedBy:e==null?void 0:e.reviewedBy,createdAt:(e==null?void 0:e.createdAt)||t,updatedAt:(e==null?void 0:e.updatedAt)||(e==null?void 0:e.createdAt)||t}},b2=async r=>{const e=r.before,t=r.after;switch(r.action){case"create":{if(!t)throw new Error("No slot payload for creation");const{id:n,...a}=t;await Og(a);return}case"update":{const n=(t==null?void 0:t.id)||(e==null?void 0:e.id);if(!n||!t)throw new Error("No slot payload for update");const{id:a,...i}=t;await Vg(n,i);return}case"delete":{if(!(e!=null&&e.id))throw new Error("No slot id for delete");await oo(e.id);return}default:return}},v2=async r=>{const e=r.before,t=r.after;switch(r.action){case"create":{if(!t)throw new Error("No status payload for creation");const{id:n,...a}=t;await lo(a);return}case"update":{const n=(t==null?void 0:t.id)||(e==null?void 0:e.id);if(!n||!t)throw new Error("No status payload for update");const{id:a,...i}=t;await gs(n,i);return}case"delete":{if(!(e!=null&&e.id))throw new Error("No status id for delete");await co(e.id);return}default:return}},w2=async r=>{const e=r.before,t=r.after;switch(r.action){case"create":{if(!t)throw new Error("No earning payload for creation");const{id:n,...a}=t;await Fg(a);return}case"update":{const n=(t==null?void 0:t.id)||(e==null?void 0:e.id);if(!n||!t)throw new Error("No earning payload for update");const{id:a,...i}=t;await Ug(n,i);return}case"delete":{if(!(e!=null&&e.id))throw new Error("No earning id for delete");await Bg(e.id);return}default:return}},k2=async r=>{const e=r.before,t=r.after;switch(r.action){case"create":{if(!t)throw new Error("No referral payload for creation");const{id:n,...a}=t;await zg(a);return}case"update":{const n=(t==null?void 0:t.id)||(e==null?void 0:e.id);if(!n||!t)throw new Error("No referral payload for update");const{id:a,...i}=t;await Gg(n,i);return}case"delete":{if(!(e!=null&&e.id))throw new Error("No referral id for delete");await vc(e.id);return}default:return}},bt=async r=>{const e=wt(We,uo),t=new Date().toISOString(),n={...r,status:"pending",createdAt:t,updatedAt:t},a=Object.fromEntries(Object.entries(n).filter(([,o])=>o!==void 0));return await ws(e,a)},Lg=async(r,e,t)=>{const n=wt(We,uo);let a;a=ft(n);let o=(await lr(a)).docs.map(bc);return o.sort((c,d)=>d.createdAt.localeCompare(c.createdAt)),o},Lu=async(r,e,t)=>{const n=St(We,uo,r),a=await eg(n);if(!a.exists())return;const i=bc(a);if(i.status!=="pending")return;i.entity==="slot"?await b2(i):i.entity==="status"?await v2(i):i.entity==="earning"?await w2(i):i.entity==="referral"&&await k2(i);const o={status:"approved",reviewedBy:e,updatedAt:new Date().toISOString()},c=i.adminComment;c!==void 0&&(o.adminComment=c),await Yr(n,o)},_2=async(r,e,t)=>{const n=St(We,uo,r),a=await eg(n);!a.exists()||bc(a).status!=="pending"||await Yr(n,{status:"rejected",adminComment:t,reviewedBy:e,updatedAt:new Date().toISOString()})},ma=async(r,e,t)=>{const n=wt(We,"earnings");let a;r?a=ft(n):e&&t?a=ft(n,Xt("date",">=",e),Xt("date","<=",t)):a=ft(n);let o=(await lr(a)).docs.map(c=>{const d=c.data();return{id:c.id,userId:(d==null?void 0:d.userId)||"",date:(d==null?void 0:d.date)||"",amount:(d==null?void 0:d.amount)||0,poolAmount:(d==null?void 0:d.poolAmount)||0,slotId:(d==null?void 0:d.slotId)||"",extraWalletsCount:(d==null?void 0:d.extraWalletsCount)||0,extraWalletsAmount:(d==null?void 0:d.extraWalletsAmount)||0,category:(d==null?void 0:d.category)||"other",participants:(d==null?void 0:d.participants)||[]}});return r&&(o=o.filter(c=>(c.participants&&c.participants.length>0?[...c.participants,c.userId]:[c.userId]).includes(r))),r&&e&&t?o=o.filter(c=>c.date>=e&&c.date<=t):!r&&e&&t&&(o=o.filter(c=>c.date>=e&&c.date<=t)),o.sort((c,d)=>d.date.localeCompare(c.date)),o},Fg=async r=>{try{const e=wt(We,"earnings"),t=Object.fromEntries(Object.entries(r).filter(([a,i])=>i!==void 0));console.log("Adding earnings:",t);const n=await ws(e,t);return console.log("Earnings added successfully:",n.id),n}catch(e){throw console.error("Error in addEarnings:",e),e}},Ug=async(r,e)=>{const t=St(We,"earnings",r),n=Object.fromEntries(Object.entries(e).filter(([a,i])=>i!==void 0));await Yr(t,n)},Bg=async r=>{const e=St(We,"earnings",r);await vs(e)},Wg=async r=>{const e=wt(We,"ratings");let t=ft(e);return r&&(t=ft(t,Xt("userId","==",r))),(await lr(t)).docs.map(a=>{const i=a.data();return{id:a.id,userId:i.userId||"",earnings:i.earnings||0,messages:i.messages||0,initiatives:i.initiatives||0,signals:i.signals||0,profitableSignals:i.profitableSignals||0,referrals:i.referrals||0,daysOff:i.daysOff||0,sickDays:i.sickDays||0,vacationDays:i.vacationDays||0,poolAmount:i.poolAmount||0,rating:i.rating||0,lastUpdated:i.lastUpdated||new Date().toISOString()}})},qg=async(r,e,t)=>{try{const n=wt(We,"messages"),a=ft(n,Xt("userId","==",r));return(await lr(a)).docs.filter(c=>{const h=c.data().date||"";return h>=e&&h<=t}).length}catch(n){console.error("Error getting weekly messages:",n);const a=wt(We,"ratings"),i=ft(a,Xt("userId","==",r)),o=await lr(i);return o.empty?0:o.docs[0].data().messages||0}},zg=async r=>{try{const e=wt(We,"referrals"),t=Object.fromEntries(Object.entries(r).filter(([a,i])=>i!==void 0));console.log("Adding referral:",t);const n=await ws(e,t);return console.log("Referral added successfully:",n.id),n}catch(e){throw console.error("Error in addReferral:",e),e}},Hg=async(r,e,t)=>{const n=wt(We,"referrals");let a;a=ft(n,ua("createdAt","desc"));let o=(await lr(a)).docs.map(c=>{const d=c.data();return{id:c.id,referralId:d.referralId,ownerId:d.ownerId,name:d.name,age:d.age,createdAt:d.createdAt,comment:d.comment}});return e&&t&&(o=o.filter(c=>c.createdAt>=e&&c.createdAt<=t)),o.sort((c,d)=>c.createdAt<d.createdAt?1:-1)},Gg=async(r,e)=>{const t=St(We,"referrals",r),n=Object.fromEntries(Object.entries(e).filter(([a,i])=>i!==void 0));await Yr(t,n)},vc=async r=>{const e=St(We,"referrals",r);await vs(e)},N2=async r=>{if(console.log("📝 Service site: Creating call:",{category:r.category,userId:r.userId,status:r.status,createdAt:r.createdAt}),!We)throw console.error("❌ Service site: Firestore db is not initialized"),new Error("Firestore database is not initialized");const e=wt(We,"calls"),t=await ws(e,r);return console.log("✅ Service site: Call created successfully with ID:",t.id),console.log("📊 Service site: Call data saved to Firestore:",r),t.id},j2=async r=>{const e=wt(We,"calls"),t=[];t.push(ua("createdAt","desc"));let n;return t.length>0?n=ft(e,...t):n=ft(e,ua("createdAt","desc")),(await lr(n)).docs.map(o=>{var v,A,C,T,z,$,S,I;const c=o.data(),d=c.category||"memecoins",h=!c.details&&c.ticker?{memecoins:{coinName:c.pair||c.ticker,ticker:c.ticker||"",network:c.network||"solana",contract:c.contract,signalType:c.sentiment||"buy",reason:c.comment||c.risks||"",entryCap:c.entryPoint||"",targets:c.target||"",stopLoss:c.cancelConditions,riskLevel:c.riskLevel||"medium",risks:c.risks||"",holdPlan:"short",liquidityLocked:!1,traderComment:c.comment}}:{},g=c.details||h||{},x=c.riskLevel||((v=g.memecoins)==null?void 0:v.riskLevel)||((A=g.polymarket)==null?void 0:A.riskLevel)||((C=g.staking)==null?void 0:C.protocolRisk)||((T=g.spot)==null?void 0:T.riskLevel)||((z=g.futures)==null?void 0:z.riskLevel),p=c.sentiment||(($=g.memecoins)==null?void 0:$.signalType)||(((S=g.futures)==null?void 0:S.direction)==="long"?"buy":((I=g.futures)==null?void 0:I.direction)==="short"?"sell":void 0);return{id:o.id,userId:c.userId||"",category:d,details:g,sentiment:p,riskLevel:x,comment:c.comment,createdAt:c.createdAt||new Date().toISOString(),status:c.status||"active",maxProfit:c.maxProfit,currentPnL:c.currentPnL,currentMarketCap:c.currentMarketCap,signalMarketCap:c.signalMarketCap,currentPrice:c.currentPrice,entryPrice:c.entryPrice,tags:c.tags||[]}})},Kg=async(r,e)=>{const t=St(We,"calls",r);await Yr(t,e)},E2=async r=>{const e=St(We,"calls",r);await vs(e)},I2=async r=>{const e=wt(We,"tasks");return(await ws(e,r)).id},Yg=async r=>{const e=wt(We,"tasks"),t=[];r!=null&&r.status&&t.push(Xt("status","==",r.status)),r!=null&&r.category&&t.push(Xt("category","==",r.category)),r!=null&&r.createdBy&&t.push(Xt("createdBy","==",r.createdBy)),t.push(ua("createdAt","desc"));let n;t.length>0?n=ft(e,...t):n=ft(e,ua("createdAt","desc"));const a=await lr(n),i=p=>p==="high"||p==="low"||p==="urgent"?p:"medium",o=p=>p==="completed"||p==="closed"?p:"in_progress",c=(p=[])=>p.filter(v=>v==null?void 0:v.userId).slice(0,10).map(v=>({userId:v.userId,priority:i(v.priority),comment:v.comment,instruction:v.instruction}));let d=a.docs.map(p=>{const v=p.data(),C=((Array.isArray(v.assignees)?v.assignees:(v.assignedTo||[]).map(S=>({userId:S,priority:"medium"})))||[]).map(S=>({userId:S.userId||"",priority:i(S.priority),comment:S.comment})).filter(S=>!!S.userId),T=C.map(S=>S.userId),z=Array.isArray(v.coExecutors)?v.coExecutors:Array.isArray(v.executors)?v.executors:[],$=(v.stages||[]).map(S=>({id:S.id||`stage-${Date.now()}`,name:S.name||"Этап",description:S.description,responsible:S.responsible==="all"?"all":Array.isArray(S.responsible)?S.responsible:(S.assignees||[]).map(I=>I.userId),assignees:c(S.assignees),stagePriority:i(S.stagePriority),requiresApproval:S.requiresApproval??!0,approvals:S.approvals||[],comments:S.comments||[],status:S.status||"pending"}));return{id:p.id,title:v.title||"",description:v.description,category:v.category||"trading",status:o(v.status),createdBy:v.createdBy||"",assignedTo:T,assignees:C,approvals:v.approvals||[],createdAt:v.createdAt||new Date().toISOString(),updatedAt:v.updatedAt||new Date().toISOString(),completedAt:v.completedAt,closedAt:v.closedAt,completedBy:v.completedBy,priority:i(v.priority),dueDate:v.dueDate||new Date().toISOString().split("T")[0],dueTime:v.dueTime||"12:00",startTime:v.startTime,mainExecutor:v.mainExecutor,leadExecutor:v.leadExecutor,deputies:v.deputies||[],coExecutors:z,executors:v.executors||[],curators:v.curators||[],leads:v.leads||[],stages:$,currentStageId:v.currentStageId,awaitingStageId:v.awaitingStageId,comments:v.comments||[],expectedResult:v.expectedResult,requiresApproval:v.requiresApproval??!0}});const h=new Date,g=new Date(h.getTime()-12*60*60*1e3),x=d.filter(p=>p.status==="closed"&&p.closedAt?new Date(p.closedAt)<g:!1);if(x.length>0&&(await Promise.all(x.map(p=>Qg(p.id))),d=d.filter(p=>!x.find(v=>v.id===p.id))),r!=null&&r.assignedTo)if(Array.isArray(r.assignedTo)){const p=r.assignedTo;p.length>0&&(d=d.filter(v=>p.some(A=>v.assignedTo.includes(A))))}else d=d.filter(p=>p.assignedTo.includes(r.assignedTo));return d},Mr=async(r,e)=>{const t=St(We,"tasks",r),n=Object.fromEntries(Object.entries({...e,updatedAt:new Date().toISOString()}).filter(([a,i])=>i!==void 0));await Yr(t,n)},Qg=async r=>{const e=St(We,"tasks",r);await vs(e)},Fu=async(r,e=!1)=>{const t=wt(We,"notes");let n;!e&&r?n=ft(t,Xt("userId","==",r)):n=ft(t);const i=(await lr(n)).docs.map(o=>{const c=o.data();return{id:o.id,userId:c.userId||"",title:c.title||"",text:c.text||"",priority:c.priority==="low"||c.priority==="high"?c.priority:"medium",createdAt:c.createdAt||new Date().toISOString(),updatedAt:c.updatedAt||new Date().toISOString()}});return i.sort((o,c)=>(c.updatedAt||"").localeCompare(o.updatedAt||"")),r&&!e?i.filter(o=>o.userId===r):i},T2=async r=>{const e=wt(We,"notes"),t={...r,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};return(await ws(e,t)).id},S2=async(r,e)=>{const t=St(We,"notes",r),n=Object.fromEntries(Object.entries({...e,updatedAt:new Date().toISOString()}).filter(([a,i])=>i!==void 0));await Yr(t,n)},A2=async r=>{const e=St(We,"notes",r);await vs(e)};function Pi(r){"@babel/helpers - typeof";return Pi=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Pi(r)}function Er(r){if(r===null||r===!0||r===!1)return NaN;var e=Number(r);return isNaN(e)?e:e<0?Math.ceil(e):Math.floor(e)}function mt(r,e){if(e.length<r)throw new TypeError(r+" argument"+(r>1?"s":"")+" required, but only "+e.length+" present")}function It(r){mt(1,arguments);var e=Object.prototype.toString.call(r);return r instanceof Date||Pi(r)==="object"&&e==="[object Date]"?new Date(r.getTime()):typeof r=="number"||e==="[object Number]"?new Date(r):((typeof r=="string"||e==="[object String]")&&typeof console<"u"&&(console.warn("Starting with v2.0.0-beta.1 date-fns doesn't accept strings as date arguments. Please use `parseISO` to parse strings. See: https://github.com/date-fns/date-fns/blob/master/docs/upgradeGuide.md#string-arguments"),console.warn(new Error().stack)),new Date(NaN))}function C2(r,e){mt(2,arguments);var t=It(r).getTime(),n=Er(e);return new Date(t+n)}var D2={};function En(){return D2}function R2(r,e){var t,n,a,i,o,c,d,h;mt(1,arguments);var g=En(),x=Er((t=(n=(a=(i=e==null?void 0:e.weekStartsOn)!==null&&i!==void 0?i:e==null||(o=e.locale)===null||o===void 0||(c=o.options)===null||c===void 0?void 0:c.weekStartsOn)!==null&&a!==void 0?a:g.weekStartsOn)!==null&&n!==void 0?n:(d=g.locale)===null||d===void 0||(h=d.options)===null||h===void 0?void 0:h.weekStartsOn)!==null&&t!==void 0?t:0);if(!(x>=0&&x<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");var p=It(r),v=p.getDay(),A=(v<x?7:0)+v-x;return p.setDate(p.getDate()-A),p.setHours(0,0,0,0),p}function P2(r){var e=new Date(Date.UTC(r.getFullYear(),r.getMonth(),r.getDate(),r.getHours(),r.getMinutes(),r.getSeconds(),r.getMilliseconds()));return e.setUTCFullYear(r.getFullYear()),r.getTime()-e.getTime()}function Uu(r){mt(1,arguments);var e=It(r);return e.setHours(0,0,0,0),e}var Xg=6e4,Jg=36e5;function M2(r,e){mt(2,arguments);var t=Uu(r),n=Uu(e);return t.getTime()===n.getTime()}function $2(r){return mt(1,arguments),r instanceof Date||Pi(r)==="object"&&Object.prototype.toString.call(r)==="[object Date]"}function O2(r){if(mt(1,arguments),!$2(r)&&typeof r!="number")return!1;var e=It(r);return!isNaN(Number(e))}function V2(r,e){var t;mt(1,arguments);var n=r||{},a=It(n.start),i=It(n.end),o=i.getTime();if(!(a.getTime()<=o))throw new RangeError("Invalid interval");var c=[],d=a;d.setHours(0,0,0,0);var h=Number((t=void 0)!==null&&t!==void 0?t:1);if(h<1||isNaN(h))throw new RangeError("`options.step` must be a number greater than 1");for(;d.getTime()<=o;)c.push(It(d)),d.setDate(d.getDate()+h),d.setHours(0,0,0,0);return c}function L2(r,e){var t,n,a,i,o,c,d,h;mt(1,arguments);var g=En(),x=Er((t=(n=(a=(i=e==null?void 0:e.weekStartsOn)!==null&&i!==void 0?i:e==null||(o=e.locale)===null||o===void 0||(c=o.options)===null||c===void 0?void 0:c.weekStartsOn)!==null&&a!==void 0?a:g.weekStartsOn)!==null&&n!==void 0?n:(d=g.locale)===null||d===void 0||(h=d.options)===null||h===void 0?void 0:h.weekStartsOn)!==null&&t!==void 0?t:0);if(!(x>=0&&x<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");var p=It(r),v=p.getDay(),A=(v<x?-7:0)+6-(v-x);return p.setDate(p.getDate()+A),p.setHours(23,59,59,999),p}function F2(r,e){mt(2,arguments);var t=Er(e);return C2(r,-t)}var U2=864e5;function B2(r){mt(1,arguments);var e=It(r),t=e.getTime();e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0);var n=e.getTime(),a=t-n;return Math.floor(a/U2)+1}function Mi(r){mt(1,arguments);var e=1,t=It(r),n=t.getUTCDay(),a=(n<e?7:0)+n-e;return t.setUTCDate(t.getUTCDate()-a),t.setUTCHours(0,0,0,0),t}function Zg(r){mt(1,arguments);var e=It(r),t=e.getUTCFullYear(),n=new Date(0);n.setUTCFullYear(t+1,0,4),n.setUTCHours(0,0,0,0);var a=Mi(n),i=new Date(0);i.setUTCFullYear(t,0,4),i.setUTCHours(0,0,0,0);var o=Mi(i);return e.getTime()>=a.getTime()?t+1:e.getTime()>=o.getTime()?t:t-1}function W2(r){mt(1,arguments);var e=Zg(r),t=new Date(0);t.setUTCFullYear(e,0,4),t.setUTCHours(0,0,0,0);var n=Mi(t);return n}var q2=6048e5;function z2(r){mt(1,arguments);var e=It(r),t=Mi(e).getTime()-W2(e).getTime();return Math.round(t/q2)+1}function yn(r,e){var t,n,a,i,o,c,d,h;mt(1,arguments);var g=En(),x=Er((t=(n=(a=(i=e==null?void 0:e.weekStartsOn)!==null&&i!==void 0?i:e==null||(o=e.locale)===null||o===void 0||(c=o.options)===null||c===void 0?void 0:c.weekStartsOn)!==null&&a!==void 0?a:g.weekStartsOn)!==null&&n!==void 0?n:(d=g.locale)===null||d===void 0||(h=d.options)===null||h===void 0?void 0:h.weekStartsOn)!==null&&t!==void 0?t:0);if(!(x>=0&&x<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");var p=It(r),v=p.getUTCDay(),A=(v<x?7:0)+v-x;return p.setUTCDate(p.getUTCDate()-A),p.setUTCHours(0,0,0,0),p}function e0(r,e){var t,n,a,i,o,c,d,h;mt(1,arguments);var g=It(r),x=g.getUTCFullYear(),p=En(),v=Er((t=(n=(a=(i=e==null?void 0:e.firstWeekContainsDate)!==null&&i!==void 0?i:e==null||(o=e.locale)===null||o===void 0||(c=o.options)===null||c===void 0?void 0:c.firstWeekContainsDate)!==null&&a!==void 0?a:p.firstWeekContainsDate)!==null&&n!==void 0?n:(d=p.locale)===null||d===void 0||(h=d.options)===null||h===void 0?void 0:h.firstWeekContainsDate)!==null&&t!==void 0?t:1);if(!(v>=1&&v<=7))throw new RangeError("firstWeekContainsDate must be between 1 and 7 inclusively");var A=new Date(0);A.setUTCFullYear(x+1,0,v),A.setUTCHours(0,0,0,0);var C=yn(A,e),T=new Date(0);T.setUTCFullYear(x,0,v),T.setUTCHours(0,0,0,0);var z=yn(T,e);return g.getTime()>=C.getTime()?x+1:g.getTime()>=z.getTime()?x:x-1}function H2(r,e){var t,n,a,i,o,c,d,h;mt(1,arguments);var g=En(),x=Er((t=(n=(a=(i=e==null?void 0:e.firstWeekContainsDate)!==null&&i!==void 0?i:e==null||(o=e.locale)===null||o===void 0||(c=o.options)===null||c===void 0?void 0:c.firstWeekContainsDate)!==null&&a!==void 0?a:g.firstWeekContainsDate)!==null&&n!==void 0?n:(d=g.locale)===null||d===void 0||(h=d.options)===null||h===void 0?void 0:h.firstWeekContainsDate)!==null&&t!==void 0?t:1),p=e0(r,e),v=new Date(0);v.setUTCFullYear(p,0,x),v.setUTCHours(0,0,0,0);var A=yn(v,e);return A}var G2=6048e5;function K2(r,e){mt(1,arguments);var t=It(r),n=yn(t,e).getTime()-H2(t,e).getTime();return Math.round(n/G2)+1}function st(r,e){for(var t=r<0?"-":"",n=Math.abs(r).toString();n.length<e;)n="0"+n;return t+n}var rs={y:function(e,t){var n=e.getUTCFullYear(),a=n>0?n:1-n;return st(t==="yy"?a%100:a,t.length)},M:function(e,t){var n=e.getUTCMonth();return t==="M"?String(n+1):st(n+1,2)},d:function(e,t){return st(e.getUTCDate(),t.length)},a:function(e,t){var n=e.getUTCHours()/12>=1?"pm":"am";switch(t){case"a":case"aa":return n.toUpperCase();case"aaa":return n;case"aaaaa":return n[0];case"aaaa":default:return n==="am"?"a.m.":"p.m."}},h:function(e,t){return st(e.getUTCHours()%12||12,t.length)},H:function(e,t){return st(e.getUTCHours(),t.length)},m:function(e,t){return st(e.getUTCMinutes(),t.length)},s:function(e,t){return st(e.getUTCSeconds(),t.length)},S:function(e,t){var n=t.length,a=e.getUTCMilliseconds(),i=Math.floor(a*Math.pow(10,n-3));return st(i,t.length)}},Ks={midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},Y2={G:function(e,t,n){var a=e.getUTCFullYear()>0?1:0;switch(t){case"G":case"GG":case"GGG":return n.era(a,{width:"abbreviated"});case"GGGGG":return n.era(a,{width:"narrow"});case"GGGG":default:return n.era(a,{width:"wide"})}},y:function(e,t,n){if(t==="yo"){var a=e.getUTCFullYear(),i=a>0?a:1-a;return n.ordinalNumber(i,{unit:"year"})}return rs.y(e,t)},Y:function(e,t,n,a){var i=e0(e,a),o=i>0?i:1-i;if(t==="YY"){var c=o%100;return st(c,2)}return t==="Yo"?n.ordinalNumber(o,{unit:"year"}):st(o,t.length)},R:function(e,t){var n=Zg(e);return st(n,t.length)},u:function(e,t){var n=e.getUTCFullYear();return st(n,t.length)},Q:function(e,t,n){var a=Math.ceil((e.getUTCMonth()+1)/3);switch(t){case"Q":return String(a);case"QQ":return st(a,2);case"Qo":return n.ordinalNumber(a,{unit:"quarter"});case"QQQ":return n.quarter(a,{width:"abbreviated",context:"formatting"});case"QQQQQ":return n.quarter(a,{width:"narrow",context:"formatting"});case"QQQQ":default:return n.quarter(a,{width:"wide",context:"formatting"})}},q:function(e,t,n){var a=Math.ceil((e.getUTCMonth()+1)/3);switch(t){case"q":return String(a);case"qq":return st(a,2);case"qo":return n.ordinalNumber(a,{unit:"quarter"});case"qqq":return n.quarter(a,{width:"abbreviated",context:"standalone"});case"qqqqq":return n.quarter(a,{width:"narrow",context:"standalone"});case"qqqq":default:return n.quarter(a,{width:"wide",context:"standalone"})}},M:function(e,t,n){var a=e.getUTCMonth();switch(t){case"M":case"MM":return rs.M(e,t);case"Mo":return n.ordinalNumber(a+1,{unit:"month"});case"MMM":return n.month(a,{width:"abbreviated",context:"formatting"});case"MMMMM":return n.month(a,{width:"narrow",context:"formatting"});case"MMMM":default:return n.month(a,{width:"wide",context:"formatting"})}},L:function(e,t,n){var a=e.getUTCMonth();switch(t){case"L":return String(a+1);case"LL":return st(a+1,2);case"Lo":return n.ordinalNumber(a+1,{unit:"month"});case"LLL":return n.month(a,{width:"abbreviated",context:"standalone"});case"LLLLL":return n.month(a,{width:"narrow",context:"standalone"});case"LLLL":default:return n.month(a,{width:"wide",context:"standalone"})}},w:function(e,t,n,a){var i=K2(e,a);return t==="wo"?n.ordinalNumber(i,{unit:"week"}):st(i,t.length)},I:function(e,t,n){var a=z2(e);return t==="Io"?n.ordinalNumber(a,{unit:"week"}):st(a,t.length)},d:function(e,t,n){return t==="do"?n.ordinalNumber(e.getUTCDate(),{unit:"date"}):rs.d(e,t)},D:function(e,t,n){var a=B2(e);return t==="Do"?n.ordinalNumber(a,{unit:"dayOfYear"}):st(a,t.length)},E:function(e,t,n){var a=e.getUTCDay();switch(t){case"E":case"EE":case"EEE":return n.day(a,{width:"abbreviated",context:"formatting"});case"EEEEE":return n.day(a,{width:"narrow",context:"formatting"});case"EEEEEE":return n.day(a,{width:"short",context:"formatting"});case"EEEE":default:return n.day(a,{width:"wide",context:"formatting"})}},e:function(e,t,n,a){var i=e.getUTCDay(),o=(i-a.weekStartsOn+8)%7||7;switch(t){case"e":return String(o);case"ee":return st(o,2);case"eo":return n.ordinalNumber(o,{unit:"day"});case"eee":return n.day(i,{width:"abbreviated",context:"formatting"});case"eeeee":return n.day(i,{width:"narrow",context:"formatting"});case"eeeeee":return n.day(i,{width:"short",context:"formatting"});case"eeee":default:return n.day(i,{width:"wide",context:"formatting"})}},c:function(e,t,n,a){var i=e.getUTCDay(),o=(i-a.weekStartsOn+8)%7||7;switch(t){case"c":return String(o);case"cc":return st(o,t.length);case"co":return n.ordinalNumber(o,{unit:"day"});case"ccc":return n.day(i,{width:"abbreviated",context:"standalone"});case"ccccc":return n.day(i,{width:"narrow",context:"standalone"});case"cccccc":return n.day(i,{width:"short",context:"standalone"});case"cccc":default:return n.day(i,{width:"wide",context:"standalone"})}},i:function(e,t,n){var a=e.getUTCDay(),i=a===0?7:a;switch(t){case"i":return String(i);case"ii":return st(i,t.length);case"io":return n.ordinalNumber(i,{unit:"day"});case"iii":return n.day(a,{width:"abbreviated",context:"formatting"});case"iiiii":return n.day(a,{width:"narrow",context:"formatting"});case"iiiiii":return n.day(a,{width:"short",context:"formatting"});case"iiii":default:return n.day(a,{width:"wide",context:"formatting"})}},a:function(e,t,n){var a=e.getUTCHours(),i=a/12>=1?"pm":"am";switch(t){case"a":case"aa":return n.dayPeriod(i,{width:"abbreviated",context:"formatting"});case"aaa":return n.dayPeriod(i,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return n.dayPeriod(i,{width:"narrow",context:"formatting"});case"aaaa":default:return n.dayPeriod(i,{width:"wide",context:"formatting"})}},b:function(e,t,n){var a=e.getUTCHours(),i;switch(a===12?i=Ks.noon:a===0?i=Ks.midnight:i=a/12>=1?"pm":"am",t){case"b":case"bb":return n.dayPeriod(i,{width:"abbreviated",context:"formatting"});case"bbb":return n.dayPeriod(i,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return n.dayPeriod(i,{width:"narrow",context:"formatting"});case"bbbb":default:return n.dayPeriod(i,{width:"wide",context:"formatting"})}},B:function(e,t,n){var a=e.getUTCHours(),i;switch(a>=17?i=Ks.evening:a>=12?i=Ks.afternoon:a>=4?i=Ks.morning:i=Ks.night,t){case"B":case"BB":case"BBB":return n.dayPeriod(i,{width:"abbreviated",context:"formatting"});case"BBBBB":return n.dayPeriod(i,{width:"narrow",context:"formatting"});case"BBBB":default:return n.dayPeriod(i,{width:"wide",context:"formatting"})}},h:function(e,t,n){if(t==="ho"){var a=e.getUTCHours()%12;return a===0&&(a=12),n.ordinalNumber(a,{unit:"hour"})}return rs.h(e,t)},H:function(e,t,n){return t==="Ho"?n.ordinalNumber(e.getUTCHours(),{unit:"hour"}):rs.H(e,t)},K:function(e,t,n){var a=e.getUTCHours()%12;return t==="Ko"?n.ordinalNumber(a,{unit:"hour"}):st(a,t.length)},k:function(e,t,n){var a=e.getUTCHours();return a===0&&(a=24),t==="ko"?n.ordinalNumber(a,{unit:"hour"}):st(a,t.length)},m:function(e,t,n){return t==="mo"?n.ordinalNumber(e.getUTCMinutes(),{unit:"minute"}):rs.m(e,t)},s:function(e,t,n){return t==="so"?n.ordinalNumber(e.getUTCSeconds(),{unit:"second"}):rs.s(e,t)},S:function(e,t){return rs.S(e,t)},X:function(e,t,n,a){var i=a._originalDate||e,o=i.getTimezoneOffset();if(o===0)return"Z";switch(t){case"X":return Wu(o);case"XXXX":case"XX":return Es(o);case"XXXXX":case"XXX":default:return Es(o,":")}},x:function(e,t,n,a){var i=a._originalDate||e,o=i.getTimezoneOffset();switch(t){case"x":return Wu(o);case"xxxx":case"xx":return Es(o);case"xxxxx":case"xxx":default:return Es(o,":")}},O:function(e,t,n,a){var i=a._originalDate||e,o=i.getTimezoneOffset();switch(t){case"O":case"OO":case"OOO":return"GMT"+Bu(o,":");case"OOOO":default:return"GMT"+Es(o,":")}},z:function(e,t,n,a){var i=a._originalDate||e,o=i.getTimezoneOffset();switch(t){case"z":case"zz":case"zzz":return"GMT"+Bu(o,":");case"zzzz":default:return"GMT"+Es(o,":")}},t:function(e,t,n,a){var i=a._originalDate||e,o=Math.floor(i.getTime()/1e3);return st(o,t.length)},T:function(e,t,n,a){var i=a._originalDate||e,o=i.getTime();return st(o,t.length)}};function Bu(r,e){var t=r>0?"-":"+",n=Math.abs(r),a=Math.floor(n/60),i=n%60;if(i===0)return t+String(a);var o=e;return t+String(a)+o+st(i,2)}function Wu(r,e){if(r%60===0){var t=r>0?"-":"+";return t+st(Math.abs(r)/60,2)}return Es(r,e)}function Es(r,e){var t=e||"",n=r>0?"-":"+",a=Math.abs(r),i=st(Math.floor(a/60),2),o=st(a%60,2);return n+i+t+o}var qu=function(e,t){switch(e){case"P":return t.date({width:"short"});case"PP":return t.date({width:"medium"});case"PPP":return t.date({width:"long"});case"PPPP":default:return t.date({width:"full"})}},t0=function(e,t){switch(e){case"p":return t.time({width:"short"});case"pp":return t.time({width:"medium"});case"ppp":return t.time({width:"long"});case"pppp":default:return t.time({width:"full"})}},Q2=function(e,t){var n=e.match(/(P+)(p+)?/)||[],a=n[1],i=n[2];if(!i)return qu(e,t);var o;switch(a){case"P":o=t.dateTime({width:"short"});break;case"PP":o=t.dateTime({width:"medium"});break;case"PPP":o=t.dateTime({width:"long"});break;case"PPPP":default:o=t.dateTime({width:"full"});break}return o.replace("{{date}}",qu(a,t)).replace("{{time}}",t0(i,t))},X2={p:t0,P:Q2},J2=["D","DD"],Z2=["YY","YYYY"];function ek(r){return J2.indexOf(r)!==-1}function tk(r){return Z2.indexOf(r)!==-1}function zu(r,e,t){if(r==="YYYY")throw new RangeError("Use `yyyy` instead of `YYYY` (in `".concat(e,"`) for formatting years to the input `").concat(t,"`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md"));if(r==="YY")throw new RangeError("Use `yy` instead of `YY` (in `".concat(e,"`) for formatting years to the input `").concat(t,"`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md"));if(r==="D")throw new RangeError("Use `d` instead of `D` (in `".concat(e,"`) for formatting days of the month to the input `").concat(t,"`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md"));if(r==="DD")throw new RangeError("Use `dd` instead of `DD` (in `".concat(e,"`) for formatting days of the month to the input `").concat(t,"`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md"))}var rk={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},sk=function(e,t,n){var a,i=rk[e];return typeof i=="string"?a=i:t===1?a=i.one:a=i.other.replace("{{count}}",t.toString()),n!=null&&n.addSuffix?n.comparison&&n.comparison>0?"in "+a:a+" ago":a};function nn(r){return function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=e.width?String(e.width):r.defaultWidth,n=r.formats[t]||r.formats[r.defaultWidth];return n}}var nk={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},ak={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},ik={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},ok={date:nn({formats:nk,defaultWidth:"full"}),time:nn({formats:ak,defaultWidth:"full"}),dateTime:nn({formats:ik,defaultWidth:"full"})},lk={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},ck=function(e,t,n,a){return lk[e]};function fr(r){return function(e,t){var n=t!=null&&t.context?String(t.context):"standalone",a;if(n==="formatting"&&r.formattingValues){var i=r.defaultFormattingWidth||r.defaultWidth,o=t!=null&&t.width?String(t.width):i;a=r.formattingValues[o]||r.formattingValues[i]}else{var c=r.defaultWidth,d=t!=null&&t.width?String(t.width):r.defaultWidth;a=r.values[d]||r.values[c]}var h=r.argumentCallback?r.argumentCallback(e):e;return a[h]}}var dk={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},uk={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},hk={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},mk={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},gk={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},pk={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},fk=function(e,t){var n=Number(e),a=n%100;if(a>20||a<10)switch(a%10){case 1:return n+"st";case 2:return n+"nd";case 3:return n+"rd"}return n+"th"},xk={ordinalNumber:fk,era:fr({values:dk,defaultWidth:"wide"}),quarter:fr({values:uk,defaultWidth:"wide",argumentCallback:function(e){return e-1}}),month:fr({values:hk,defaultWidth:"wide"}),day:fr({values:mk,defaultWidth:"wide"}),dayPeriod:fr({values:gk,defaultWidth:"wide",formattingValues:pk,defaultFormattingWidth:"wide"})};function xr(r){return function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=t.width,a=n&&r.matchPatterns[n]||r.matchPatterns[r.defaultMatchWidth],i=e.match(a);if(!i)return null;var o=i[0],c=n&&r.parsePatterns[n]||r.parsePatterns[r.defaultParseWidth],d=Array.isArray(c)?bk(c,function(x){return x.test(o)}):yk(c,function(x){return x.test(o)}),h;h=r.valueCallback?r.valueCallback(d):d,h=t.valueCallback?t.valueCallback(h):h;var g=e.slice(o.length);return{value:h,rest:g}}}function yk(r,e){for(var t in r)if(r.hasOwnProperty(t)&&e(r[t]))return t}function bk(r,e){for(var t=0;t<r.length;t++)if(e(r[t]))return t}function r0(r){return function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=e.match(r.matchPattern);if(!n)return null;var a=n[0],i=e.match(r.parsePattern);if(!i)return null;var o=r.valueCallback?r.valueCallback(i[0]):i[0];o=t.valueCallback?t.valueCallback(o):o;var c=e.slice(a.length);return{value:o,rest:c}}}var vk=/^(\d+)(th|st|nd|rd)?/i,wk=/\d+/i,kk={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},_k={any:[/^b/i,/^(a|c)/i]},Nk={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},jk={any:[/1/i,/2/i,/3/i,/4/i]},Ek={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},Ik={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},Tk={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},Sk={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},Ak={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},Ck={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},Dk={ordinalNumber:r0({matchPattern:vk,parsePattern:wk,valueCallback:function(e){return parseInt(e,10)}}),era:xr({matchPatterns:kk,defaultMatchWidth:"wide",parsePatterns:_k,defaultParseWidth:"any"}),quarter:xr({matchPatterns:Nk,defaultMatchWidth:"wide",parsePatterns:jk,defaultParseWidth:"any",valueCallback:function(e){return e+1}}),month:xr({matchPatterns:Ek,defaultMatchWidth:"wide",parsePatterns:Ik,defaultParseWidth:"any"}),day:xr({matchPatterns:Tk,defaultMatchWidth:"wide",parsePatterns:Sk,defaultParseWidth:"any"}),dayPeriod:xr({matchPatterns:Ak,defaultMatchWidth:"any",parsePatterns:Ck,defaultParseWidth:"any"})},Rk={code:"en-US",formatDistance:sk,formatLong:ok,formatRelative:ck,localize:xk,match:Dk,options:{weekStartsOn:0,firstWeekContainsDate:1}},Pk=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,Mk=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,$k=/^'([^]*?)'?$/,Ok=/''/g,Vk=/[a-zA-Z]/;function s0(r,e,t){var n,a,i,o,c,d,h,g,x,p,v,A,C,T,z,$,S,I;mt(2,arguments);var H=String(e),G=En(),E=(n=(a=t==null?void 0:t.locale)!==null&&a!==void 0?a:G.locale)!==null&&n!==void 0?n:Rk,y=Er((i=(o=(c=(d=t==null?void 0:t.firstWeekContainsDate)!==null&&d!==void 0?d:t==null||(h=t.locale)===null||h===void 0||(g=h.options)===null||g===void 0?void 0:g.firstWeekContainsDate)!==null&&c!==void 0?c:G.firstWeekContainsDate)!==null&&o!==void 0?o:(x=G.locale)===null||x===void 0||(p=x.options)===null||p===void 0?void 0:p.firstWeekContainsDate)!==null&&i!==void 0?i:1);if(!(y>=1&&y<=7))throw new RangeError("firstWeekContainsDate must be between 1 and 7 inclusively");var w=Er((v=(A=(C=(T=t==null?void 0:t.weekStartsOn)!==null&&T!==void 0?T:t==null||(z=t.locale)===null||z===void 0||($=z.options)===null||$===void 0?void 0:$.weekStartsOn)!==null&&C!==void 0?C:G.weekStartsOn)!==null&&A!==void 0?A:(S=G.locale)===null||S===void 0||(I=S.options)===null||I===void 0?void 0:I.weekStartsOn)!==null&&v!==void 0?v:0);if(!(w>=0&&w<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");if(!E.localize)throw new RangeError("locale must contain localize property");if(!E.formatLong)throw new RangeError("locale must contain formatLong property");var k=It(r);if(!O2(k))throw new RangeError("Invalid time value");var j=P2(k),N=F2(k,j),f={firstWeekContainsDate:y,weekStartsOn:w,locale:E,_originalDate:k},de=H.match(Mk).map(function(V){var X=V[0];if(X==="p"||X==="P"){var R=X2[X];return R(V,E.formatLong)}return V}).join("").match(Pk).map(function(V){if(V==="''")return"'";var X=V[0];if(X==="'")return Lk(V);var R=Y2[X];if(R)return!(t!=null&&t.useAdditionalWeekYearTokens)&&tk(V)&&zu(V,e,String(r)),!(t!=null&&t.useAdditionalDayOfYearTokens)&&ek(V)&&zu(V,e,String(r)),R(N,V,E.localize,f);if(X.match(Vk))throw new RangeError("Format string contains an unescaped latin alphabet character `"+X+"`");return V}).join("");return de}function Lk(r){var e=r.match($k);return e?e[1].replace(Ok,"'"):r}function Fk(r,e){mt(2,arguments);var t=It(r),n=It(e);return t.getTime()<n.getTime()}function or(r,e){var t;mt(1,arguments);var n=Er((t=void 0)!==null&&t!==void 0?t:2);if(n!==2&&n!==1&&n!==0)throw new RangeError("additionalDigits must be 0, 1 or 2");if(!(typeof r=="string"||Object.prototype.toString.call(r)==="[object String]"))return new Date(NaN);var a=qk(r),i;if(a.date){var o=zk(a.date,n);i=Hk(o.restDateString,o.year)}if(!i||isNaN(i.getTime()))return new Date(NaN);var c=i.getTime(),d=0,h;if(a.time&&(d=Gk(a.time),isNaN(d)))return new Date(NaN);if(a.timezone){if(h=Kk(a.timezone),isNaN(h))return new Date(NaN)}else{var g=new Date(c+d),x=new Date(0);return x.setFullYear(g.getUTCFullYear(),g.getUTCMonth(),g.getUTCDate()),x.setHours(g.getUTCHours(),g.getUTCMinutes(),g.getUTCSeconds(),g.getUTCMilliseconds()),x}return new Date(c+d+h)}var ei={dateTimeDelimiter:/[T ]/,timeZoneDelimiter:/[Z ]/i,timezone:/([Z+-].*)$/},Uk=/^-?(?:(\d{3})|(\d{2})(?:-?(\d{2}))?|W(\d{2})(?:-?(\d{1}))?|)$/,Bk=/^(\d{2}(?:[.,]\d*)?)(?::?(\d{2}(?:[.,]\d*)?))?(?::?(\d{2}(?:[.,]\d*)?))?$/,Wk=/^([+-])(\d{2})(?::?(\d{2}))?$/;function qk(r){var e={},t=r.split(ei.dateTimeDelimiter),n;if(t.length>2)return e;if(/:/.test(t[0])?n=t[0]:(e.date=t[0],n=t[1],ei.timeZoneDelimiter.test(e.date)&&(e.date=r.split(ei.timeZoneDelimiter)[0],n=r.substr(e.date.length,r.length))),n){var a=ei.timezone.exec(n);a?(e.time=n.replace(a[1],""),e.timezone=a[1]):e.time=n}return e}function zk(r,e){var t=new RegExp("^(?:(\\d{4}|[+-]\\d{"+(4+e)+"})|(\\d{2}|[+-]\\d{"+(2+e)+"})$)"),n=r.match(t);if(!n)return{year:NaN,restDateString:""};var a=n[1]?parseInt(n[1]):null,i=n[2]?parseInt(n[2]):null;return{year:i===null?a:i*100,restDateString:r.slice((n[1]||n[2]).length)}}function Hk(r,e){if(e===null)return new Date(NaN);var t=r.match(Uk);if(!t)return new Date(NaN);var n=!!t[4],a=Vn(t[1]),i=Vn(t[2])-1,o=Vn(t[3]),c=Vn(t[4]),d=Vn(t[5])-1;if(n)return Zk(e,c,d)?Yk(e,c,d):new Date(NaN);var h=new Date(0);return!Xk(e,i,o)||!Jk(e,a)?new Date(NaN):(h.setUTCFullYear(e,i,Math.max(a,o)),h)}function Vn(r){return r?parseInt(r):1}function Gk(r){var e=r.match(Bk);if(!e)return NaN;var t=Wo(e[1]),n=Wo(e[2]),a=Wo(e[3]);return e_(t,n,a)?t*Jg+n*Xg+a*1e3:NaN}function Wo(r){return r&&parseFloat(r.replace(",","."))||0}function Kk(r){if(r==="Z")return 0;var e=r.match(Wk);if(!e)return 0;var t=e[1]==="+"?-1:1,n=parseInt(e[2]),a=e[3]&&parseInt(e[3])||0;return t_(n,a)?t*(n*Jg+a*Xg):NaN}function Yk(r,e,t){var n=new Date(0);n.setUTCFullYear(r,0,4);var a=n.getUTCDay()||7,i=(e-1)*7+t+1-a;return n.setUTCDate(n.getUTCDate()+i),n}var Qk=[31,null,31,30,31,30,31,31,30,31,30,31];function n0(r){return r%400===0||r%4===0&&r%100!==0}function Xk(r,e,t){return e>=0&&e<=11&&t>=1&&t<=(Qk[e]||(n0(r)?29:28))}function Jk(r,e){return e>=1&&e<=(n0(r)?366:365)}function Zk(r,e,t){return e>=1&&e<=53&&t>=0&&t<=6}function e_(r,e,t){return r===24?e===0&&t===0:t>=0&&t<60&&e>=0&&e<60&&r>=0&&r<25}function t_(r,e){return e>=0&&e<=59}function Hu(r,e,t){mt(2,arguments);var n=yn(r,t),a=yn(e,t);return n.getTime()===a.getTime()}function Ln(r,e){if(r.one!==void 0&&e===1)return r.one;var t=e%10,n=e%100;return t===1&&n!==11?r.singularNominative.replace("{{count}}",String(e)):t>=2&&t<=4&&(n<10||n>20)?r.singularGenitive.replace("{{count}}",String(e)):r.pluralGenitive.replace("{{count}}",String(e))}function qt(r){return function(e,t){return t!=null&&t.addSuffix?t.comparison&&t.comparison>0?r.future?Ln(r.future,e):"через "+Ln(r.regular,e):r.past?Ln(r.past,e):Ln(r.regular,e)+" назад":Ln(r.regular,e)}}var r_={lessThanXSeconds:qt({regular:{one:"меньше секунды",singularNominative:"меньше {{count}} секунды",singularGenitive:"меньше {{count}} секунд",pluralGenitive:"меньше {{count}} секунд"},future:{one:"меньше, чем через секунду",singularNominative:"меньше, чем через {{count}} секунду",singularGenitive:"меньше, чем через {{count}} секунды",pluralGenitive:"меньше, чем через {{count}} секунд"}}),xSeconds:qt({regular:{singularNominative:"{{count}} секунда",singularGenitive:"{{count}} секунды",pluralGenitive:"{{count}} секунд"},past:{singularNominative:"{{count}} секунду назад",singularGenitive:"{{count}} секунды назад",pluralGenitive:"{{count}} секунд назад"},future:{singularNominative:"через {{count}} секунду",singularGenitive:"через {{count}} секунды",pluralGenitive:"через {{count}} секунд"}}),halfAMinute:function(e,t){return t!=null&&t.addSuffix?t.comparison&&t.comparison>0?"через полминуты":"полминуты назад":"полминуты"},lessThanXMinutes:qt({regular:{one:"меньше минуты",singularNominative:"меньше {{count}} минуты",singularGenitive:"меньше {{count}} минут",pluralGenitive:"меньше {{count}} минут"},future:{one:"меньше, чем через минуту",singularNominative:"меньше, чем через {{count}} минуту",singularGenitive:"меньше, чем через {{count}} минуты",pluralGenitive:"меньше, чем через {{count}} минут"}}),xMinutes:qt({regular:{singularNominative:"{{count}} минута",singularGenitive:"{{count}} минуты",pluralGenitive:"{{count}} минут"},past:{singularNominative:"{{count}} минуту назад",singularGenitive:"{{count}} минуты назад",pluralGenitive:"{{count}} минут назад"},future:{singularNominative:"через {{count}} минуту",singularGenitive:"через {{count}} минуты",pluralGenitive:"через {{count}} минут"}}),aboutXHours:qt({regular:{singularNominative:"около {{count}} часа",singularGenitive:"около {{count}} часов",pluralGenitive:"около {{count}} часов"},future:{singularNominative:"приблизительно через {{count}} час",singularGenitive:"приблизительно через {{count}} часа",pluralGenitive:"приблизительно через {{count}} часов"}}),xHours:qt({regular:{singularNominative:"{{count}} час",singularGenitive:"{{count}} часа",pluralGenitive:"{{count}} часов"}}),xDays:qt({regular:{singularNominative:"{{count}} день",singularGenitive:"{{count}} дня",pluralGenitive:"{{count}} дней"}}),aboutXWeeks:qt({regular:{singularNominative:"около {{count}} недели",singularGenitive:"около {{count}} недель",pluralGenitive:"около {{count}} недель"},future:{singularNominative:"приблизительно через {{count}} неделю",singularGenitive:"приблизительно через {{count}} недели",pluralGenitive:"приблизительно через {{count}} недель"}}),xWeeks:qt({regular:{singularNominative:"{{count}} неделя",singularGenitive:"{{count}} недели",pluralGenitive:"{{count}} недель"}}),aboutXMonths:qt({regular:{singularNominative:"около {{count}} месяца",singularGenitive:"около {{count}} месяцев",pluralGenitive:"около {{count}} месяцев"},future:{singularNominative:"приблизительно через {{count}} месяц",singularGenitive:"приблизительно через {{count}} месяца",pluralGenitive:"приблизительно через {{count}} месяцев"}}),xMonths:qt({regular:{singularNominative:"{{count}} месяц",singularGenitive:"{{count}} месяца",pluralGenitive:"{{count}} месяцев"}}),aboutXYears:qt({regular:{singularNominative:"около {{count}} года",singularGenitive:"около {{count}} лет",pluralGenitive:"около {{count}} лет"},future:{singularNominative:"приблизительно через {{count}} год",singularGenitive:"приблизительно через {{count}} года",pluralGenitive:"приблизительно через {{count}} лет"}}),xYears:qt({regular:{singularNominative:"{{count}} год",singularGenitive:"{{count}} года",pluralGenitive:"{{count}} лет"}}),overXYears:qt({regular:{singularNominative:"больше {{count}} года",singularGenitive:"больше {{count}} лет",pluralGenitive:"больше {{count}} лет"},future:{singularNominative:"больше, чем через {{count}} год",singularGenitive:"больше, чем через {{count}} года",pluralGenitive:"больше, чем через {{count}} лет"}}),almostXYears:qt({regular:{singularNominative:"почти {{count}} год",singularGenitive:"почти {{count}} года",pluralGenitive:"почти {{count}} лет"},future:{singularNominative:"почти через {{count}} год",singularGenitive:"почти через {{count}} года",pluralGenitive:"почти через {{count}} лет"}})},s_=function(e,t,n){return r_[e](t,n)},n_={full:"EEEE, d MMMM y 'г.'",long:"d MMMM y 'г.'",medium:"d MMM y 'г.'",short:"dd.MM.y"},a_={full:"H:mm:ss zzzz",long:"H:mm:ss z",medium:"H:mm:ss",short:"H:mm"},i_={any:"{{date}}, {{time}}"},o_={date:nn({formats:n_,defaultWidth:"full"}),time:nn({formats:a_,defaultWidth:"full"}),dateTime:nn({formats:i_,defaultWidth:"any"})},wc=["воскресенье","понедельник","вторник","среду","четверг","пятницу","субботу"];function l_(r){var e=wc[r];switch(r){case 0:return"'в прошлое "+e+" в' p";case 1:case 2:case 4:return"'в прошлый "+e+" в' p";case 3:case 5:case 6:return"'в прошлую "+e+" в' p"}}function Gu(r){var e=wc[r];return r===2?"'во "+e+" в' p":"'в "+e+" в' p"}function c_(r){var e=wc[r];switch(r){case 0:return"'в следующее "+e+" в' p";case 1:case 2:case 4:return"'в следующий "+e+" в' p";case 3:case 5:case 6:return"'в следующую "+e+" в' p"}}var d_={lastWeek:function(e,t,n){var a=e.getUTCDay();return Hu(e,t,n)?Gu(a):l_(a)},yesterday:"'вчера в' p",today:"'сегодня в' p",tomorrow:"'завтра в' p",nextWeek:function(e,t,n){var a=e.getUTCDay();return Hu(e,t,n)?Gu(a):c_(a)},other:"P"},u_=function(e,t,n,a){var i=d_[e];return typeof i=="function"?i(t,n,a):i},h_={narrow:["до н.э.","н.э."],abbreviated:["до н. э.","н. э."],wide:["до нашей эры","нашей эры"]},m_={narrow:["1","2","3","4"],abbreviated:["1-й кв.","2-й кв.","3-й кв.","4-й кв."],wide:["1-й квартал","2-й квартал","3-й квартал","4-й квартал"]},g_={narrow:["Я","Ф","М","А","М","И","И","А","С","О","Н","Д"],abbreviated:["янв.","фев.","март","апр.","май","июнь","июль","авг.","сент.","окт.","нояб.","дек."],wide:["январь","февраль","март","апрель","май","июнь","июль","август","сентябрь","октябрь","ноябрь","декабрь"]},p_={narrow:["Я","Ф","М","А","М","И","И","А","С","О","Н","Д"],abbreviated:["янв.","фев.","мар.","апр.","мая","июн.","июл.","авг.","сент.","окт.","нояб.","дек."],wide:["января","февраля","марта","апреля","мая","июня","июля","августа","сентября","октября","ноября","декабря"]},f_={narrow:["В","П","В","С","Ч","П","С"],short:["вс","пн","вт","ср","чт","пт","сб"],abbreviated:["вск","пнд","втр","срд","чтв","птн","суб"],wide:["воскресенье","понедельник","вторник","среда","четверг","пятница","суббота"]},x_={narrow:{am:"ДП",pm:"ПП",midnight:"полн.",noon:"полд.",morning:"утро",afternoon:"день",evening:"веч.",night:"ночь"},abbreviated:{am:"ДП",pm:"ПП",midnight:"полн.",noon:"полд.",morning:"утро",afternoon:"день",evening:"веч.",night:"ночь"},wide:{am:"ДП",pm:"ПП",midnight:"полночь",noon:"полдень",morning:"утро",afternoon:"день",evening:"вечер",night:"ночь"}},y_={narrow:{am:"ДП",pm:"ПП",midnight:"полн.",noon:"полд.",morning:"утра",afternoon:"дня",evening:"веч.",night:"ночи"},abbreviated:{am:"ДП",pm:"ПП",midnight:"полн.",noon:"полд.",morning:"утра",afternoon:"дня",evening:"веч.",night:"ночи"},wide:{am:"ДП",pm:"ПП",midnight:"полночь",noon:"полдень",morning:"утра",afternoon:"дня",evening:"вечера",night:"ночи"}},b_=function(e,t){var n=Number(e),a=t==null?void 0:t.unit,i;return a==="date"?i="-е":a==="week"||a==="minute"||a==="second"?i="-я":i="-й",n+i},v_={ordinalNumber:b_,era:fr({values:h_,defaultWidth:"wide"}),quarter:fr({values:m_,defaultWidth:"wide",argumentCallback:function(e){return e-1}}),month:fr({values:g_,defaultWidth:"wide",formattingValues:p_,defaultFormattingWidth:"wide"}),day:fr({values:f_,defaultWidth:"wide"}),dayPeriod:fr({values:x_,defaultWidth:"any",formattingValues:y_,defaultFormattingWidth:"wide"})},w_=/^(\d+)(-?(е|я|й|ое|ье|ая|ья|ый|ой|ий|ый))?/i,k_=/\d+/i,__={narrow:/^((до )?н\.?\s?э\.?)/i,abbreviated:/^((до )?н\.?\s?э\.?)/i,wide:/^(до нашей эры|нашей эры|наша эра)/i},N_={any:[/^д/i,/^н/i]},j_={narrow:/^[1234]/i,abbreviated:/^[1234](-?[ыои]?й?)? кв.?/i,wide:/^[1234](-?[ыои]?й?)? квартал/i},E_={any:[/1/i,/2/i,/3/i,/4/i]},I_={narrow:/^[яфмаисонд]/i,abbreviated:/^(янв|фев|март?|апр|ма[йя]|июн[ья]?|июл[ья]?|авг|сент?|окт|нояб?|дек)\.?/i,wide:/^(январ[ья]|феврал[ья]|марта?|апрел[ья]|ма[йя]|июн[ья]|июл[ья]|августа?|сентябр[ья]|октябр[ья]|октябр[ья]|ноябр[ья]|декабр[ья])/i},T_={narrow:[/^я/i,/^ф/i,/^м/i,/^а/i,/^м/i,/^и/i,/^и/i,/^а/i,/^с/i,/^о/i,/^н/i,/^я/i],any:[/^я/i,/^ф/i,/^мар/i,/^ап/i,/^ма[йя]/i,/^июн/i,/^июл/i,/^ав/i,/^с/i,/^о/i,/^н/i,/^д/i]},S_={narrow:/^[впсч]/i,short:/^(вс|во|пн|по|вт|ср|чт|че|пт|пя|сб|су)\.?/i,abbreviated:/^(вск|вос|пнд|пон|втр|вто|срд|сре|чтв|чет|птн|пят|суб).?/i,wide:/^(воскресень[ея]|понедельника?|вторника?|сред[аы]|четверга?|пятниц[аы]|суббот[аы])/i},A_={narrow:[/^в/i,/^п/i,/^в/i,/^с/i,/^ч/i,/^п/i,/^с/i],any:[/^в[ос]/i,/^п[он]/i,/^в/i,/^ср/i,/^ч/i,/^п[ят]/i,/^с[уб]/i]},C_={narrow:/^([дп]п|полн\.?|полд\.?|утр[оа]|день|дня|веч\.?|ноч[ьи])/i,abbreviated:/^([дп]п|полн\.?|полд\.?|утр[оа]|день|дня|веч\.?|ноч[ьи])/i,wide:/^([дп]п|полночь|полдень|утр[оа]|день|дня|вечера?|ноч[ьи])/i},D_={any:{am:/^дп/i,pm:/^пп/i,midnight:/^полн/i,noon:/^полд/i,morning:/^у/i,afternoon:/^д[ен]/i,evening:/^в/i,night:/^н/i}},R_={ordinalNumber:r0({matchPattern:w_,parsePattern:k_,valueCallback:function(e){return parseInt(e,10)}}),era:xr({matchPatterns:__,defaultMatchWidth:"wide",parsePatterns:N_,defaultParseWidth:"any"}),quarter:xr({matchPatterns:j_,defaultMatchWidth:"wide",parsePatterns:E_,defaultParseWidth:"any",valueCallback:function(e){return e+1}}),month:xr({matchPatterns:I_,defaultMatchWidth:"wide",parsePatterns:T_,defaultParseWidth:"any"}),day:xr({matchPatterns:S_,defaultMatchWidth:"wide",parsePatterns:A_,defaultParseWidth:"any"}),dayPeriod:xr({matchPatterns:C_,defaultMatchWidth:"wide",parsePatterns:D_,defaultParseWidth:"any"})},P_={code:"ru",formatDistance:s_,formatLong:o_,formatRelative:u_,localize:v_,match:R_,options:{weekStartsOn:1,firstWeekContainsDate:1}};const ce=(r,e="dd.MM.yyyy")=>{try{const t=typeof r=="string"?or(r):r;return!t||Number.isNaN(t.getTime())?"":s0(t,e,{locale:P_})}catch{return""}},Ca=(r=new Date)=>{const e=R2(r,{weekStartsOn:1}),t=L2(r,{weekStartsOn:1});return{start:e,end:t}},kc=(r=new Date)=>{const{start:e,end:t}=Ca(r);return V2({start:e,end:t})},a0=r=>{const e=new Date,t=new Date(e);t.setHours(0,0,0,0),t.setDate(t.getDate()-(r-1));const n=new Date(e);return n.setHours(23,59,59,999),{start:t,end:n}},i0=(r,e)=>{const t=typeof r=="string"?or(r):r,n=typeof e=="string"?or(e):e;return M2(t,n)},ho=r=>r.reduce((e,t)=>{const[n,a]=t.start.split(":").map(Number),[i,o]=t.end.split(":").map(Number),c=n*60+a;let h=(i*60+o-c)/60;if((h<0||t.endDate)&&(h+=24),t.breaks&&t.breaks.length>0){const g=t.breaks.reduce((x,p)=>{const[v,A]=p.start.split(":").map(Number),[C,T]=p.end.split(":").map(Number),z=v*60+A;let S=(C*60+T-z)/60;return S<0&&(S+=24),x+S},0);h-=g}return e+h},0),ir=r=>{const[e,t]=r.split(":").map(Number);return e*60+t},$i=(r,e)=>{if(!r||!e)return[];const t=or(r),n=or(e);if(Fk(n,t))return[];const a=[],i=new Date(t);for(;i<=n;)a.push(ce(i,"yyyy-MM-dd")),i.setDate(i.getDate()+1);return a},o0=r=>{const e=Array.from(new Set(r.filter(Boolean)));return e.sort(),e},M_=(r,e)=>{const t=ir(r.start),n=ir(r.end),a=ir(e.start),i=ir(e.end);return t<i&&n>a},yl=()=>{const r=new Date,e=3*60,t=r.getTimezoneOffset();return new Date(r.getTime()+(e+t)*60*1e3)},Ku=(r,e=yl())=>{const t=e.getHours(),n=new Date(`${s0(e,"yyyy-MM-dd")}T${r}:00`);return t>=21||e>n},$_=r=>{const e=Math.floor(r),t=Math.round((r-e)*60);return e===0&&t===0?"0ч":e===0?`${t}м`:t===0?`${e}ч`:`${e}ч ${t}м`},an=(r,e,t,n)=>{const a=r,i=e||r;if(i<t||a>n)return 0;const o=a>t?a:t,c=i<n?i:n,d=or(o),g=or(c).getTime()-d.getTime();return Math.floor(g/(1e3*60*60*24))+1},cr=({children:r})=>{const{theme:e,toggleTheme:t}=it(),{isAdmin:n}=Tt(),{user:a}=kt(),i=R0(),[o,c]=D.useState(!1),[d,h]=D.useState(!1),[g,x]=D.useState([]),p=[{path:"/management",label:"Расписание",icon:Ur},{path:"/earnings",label:"Заработок",icon:Fi},{path:"/tasks",label:"Задачи",icon:Lr},{path:"/rating",label:"Рейтинг",icon:Ms},{path:"/call",label:"HUB",icon:si},{path:"/approvals",label:"Согласования",icon:Ds}],v=p.some(T=>i.pathname===T.path),A=T=>i.pathname===T;D.useEffect(()=>{c(!1)},[i.pathname]),D.useEffect(()=>{const T=async()=>{try{if(!a&&!n){x([]);return}const $=await Lg(),S=Date.now()-6*60*60*1e3,I=`viewedNotifications_${(a==null?void 0:a.id)||"admin"}`,H=JSON.parse(localStorage.getItem(I)||"[]"),G=$.filter(E=>{if(!n&&a&&E.authorId!==a.id&&E.targetUserId!==a.id)return!1;const y=Date.parse(E.updatedAt||E.createdAt);return!(Number.isNaN(y)||y<S||H.includes(E.id))});x(G.map(E=>({id:E.id,status:E.status,text:`${E.entity==="slot"?"Слот":"Статус"} • ${E.status==="approved"?"Подтверждено":E.status==="rejected"?"Отклонено":"На согласовании"}${E.adminComment?`: ${E.adminComment}`:""}`,time:ce(E.updatedAt||E.createdAt||new Date().toISOString(),"dd.MM HH:mm")})))}catch($){console.error("Failed to load notifications",$)}};T();const z=setInterval(T,2*60*1e3);return()=>clearInterval(z)},[a,n]);const C=()=>{if(g.length>0){const T=`viewedNotifications_${(a==null?void 0:a.id)||"admin"}`,z=JSON.parse(localStorage.getItem(T)||"[]"),$=g.map(I=>I.id),S=[...new Set([...z,...$])];localStorage.setItem(T,JSON.stringify(S)),x([])}h(!1)};return s.jsxs("div",{className:"app-shell",children:[s.jsxs("div",{className:"absolute inset-0 pointer-events-none -z-10 overflow-hidden",children:[s.jsx("div",{className:"absolute -top-24 -left-12 w-80 h-80 bg-gradient-to-br from-[#4E6E49]/25 via-transparent to-transparent blur-3xl"}),s.jsx("div",{className:"absolute top-8 right-0 w-[520px] h-[520px] bg-gradient-to-bl from-blue-500/12 via-purple-500/10 to-transparent blur-3xl"}),s.jsx("div",{className:"absolute bottom-[-120px] left-12 w-96 h-96 bg-gradient-to-tr from-amber-400/10 to-[#4E6E49]/12 blur-3xl"}),s.jsx("div",{className:"floating-grid"})]}),s.jsx("header",{className:"sticky top-0 z-50 backdrop-blur-md",children:s.jsx("div",{className:"max-w-7xl mx-auto px-4 lg:px-6 pt-4 pb-2",children:s.jsxs("div",{className:"glass-panel rounded-2xl px-4 lg:px-6 py-3 flex items-center gap-4 shadow-2xl",children:[s.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[s.jsxs("div",{className:"relative w-12 h-12 rounded-2xl bg-white/80 dark:bg-white/5 border border-white/50 dark:border-white/10 shadow-lg overflow-hidden flex items-center justify-center",children:[s.jsx("img",{src:bh,alt:"ApeVault Logo",className:"w-10 h-10 object-contain"}),s.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-white/20 to-transparent dark:from-white/5"})]}),s.jsxs("div",{className:"leading-tight",children:[s.jsx("p",{className:`text-xs uppercase tracking-[0.16em] ${e==="dark"?"text-gray-400":"text-gray-500"}`,children:"ApeVault Black Ops"}),s.jsx("p",{className:`text-xl font-extrabold ${e==="dark"?"text-white":"text-gray-900"}`,children:"Панель команды"})]})]}),s.jsxs("nav",{className:"hidden lg:flex items-center gap-2 flex-1 justify-center",children:[s.jsxs(Gt,{to:"/call","data-active":i.pathname==="/call",className:"nav-chip",children:[s.jsx(si,{className:"w-4 h-4"}),s.jsx("span",{children:"HUB"}),s.jsx(Nt,{className:"w-4 h-4 opacity-70"})]}),s.jsxs("div",{className:"relative",children:[s.jsxs("button",{onClick:()=>{c(!o)},"data-active":v,className:"nav-chip",children:[s.jsx(yd,{className:"w-4 h-4"}),s.jsx("span",{children:"Функционал"}),s.jsx(hd,{className:`w-4 h-4 transition-transform ${o?"rotate-180":""}`})]}),o&&s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"fixed inset-0 z-40",onClick:()=>c(!1)}),s.jsxs("div",{className:"absolute top-[calc(100%+12px)] left-0 min-w-[220px] glass-panel rounded-2xl border border-white/40 dark:border-white/10 shadow-2xl z-50 overflow-hidden",children:[s.jsx("div",{className:"accent-dots"}),s.jsx("div",{className:"relative z-10 divide-y divide-gray-100/60 dark:divide-white/5",children:p.map(T=>s.jsxs(Gt,{to:T.path,onClick:()=>c(!1),className:`flex items-center gap-3 px-4 py-3 transition-colors ${A(T.path)?"bg-gradient-to-r from-[#4E6E49]/15 to-[#4E6E49]/5 text-[#4E6E49] dark:from-[#4E6E49]/20 dark:text-[#4E6E49]":e==="dark"?"hover:bg-white/5 text-gray-200":"hover:bg-gray-50 text-gray-800"}`,children:[s.jsx(T.icon,{className:"w-4 h-4 flex-shrink-0"}),s.jsx("span",{className:"font-semibold flex-1",children:T.label}),s.jsx(Nt,{className:"w-4 h-4 opacity-70"})]},T.path))})]})]})]}),s.jsxs(Gt,{to:"/about","data-active":i.pathname==="/about",className:"nav-chip",children:[s.jsx(ln,{className:"w-4 h-4"}),s.jsx("span",{children:"О нас"}),s.jsx(Nt,{className:"w-4 h-4 opacity-70"})]}),s.jsxs(Gt,{to:"/profile","data-active":i.pathname==="/profile",className:"nav-chip",children:[s.jsx(cn,{className:"w-4 h-4"}),s.jsx("span",{children:"ЛК"}),s.jsx(Nt,{className:"w-4 h-4 opacity-70"})]}),n&&s.jsxs(Gt,{to:"/admin","data-active":i.pathname==="/admin",className:"nav-chip",children:[s.jsx(zt,{className:"w-4 h-4"}),s.jsx("span",{children:"Админ"}),s.jsx(Nt,{className:"w-4 h-4 opacity-70"})]}),n&&s.jsxs(Gt,{to:"/approvals","data-active":i.pathname==="/approvals",className:"nav-chip",children:[s.jsx(Ds,{className:"w-4 h-4"}),s.jsx("span",{children:"Согласования"}),s.jsx(Nt,{className:"w-4 h-4 opacity-70"})]})]}),s.jsxs("div",{className:"flex items-center gap-3 ml-auto relative",children:[s.jsxs("div",{className:"relative",children:[s.jsxs("button",{onClick:()=>{d?C():h(!0)},className:"nav-chip px-3 py-2","data-active":d,"aria-label":"Notifications",children:[s.jsx(Np,{className:"w-5 h-5"}),g.length>0&&s.jsx("span",{className:"absolute -top-1 -right-1 inline-flex items-center justify-center px-1.5 py-0.5 text-[10px] font-bold rounded-full bg-red-500 text-white",children:g.length})]}),d&&s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"fixed inset-0 z-40",onClick:C}),s.jsx("div",{className:"absolute right-0 mt-2 w-80 max-w-[88vw] glass-panel rounded-2xl border border-white/60 dark:border-white/10 shadow-2xl z-50 overflow-hidden",children:s.jsx("div",{className:"p-4 space-y-2 max-h-[360px] overflow-y-auto",children:g.length===0?s.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:"Новых уведомлений нет (храним до 6 часов)."}):g.map(T=>s.jsxs("div",{className:"rounded-xl border border-white/40 dark:border-white/10 bg-white/80 dark:bg-white/5 p-3 space-y-1",children:[s.jsx("div",{className:"text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400",children:T.time}),s.jsx("div",{className:"text-sm font-semibold text-gray-900 dark:text-white",children:T.text})]},T.id))})})]})]}),s.jsx("button",{onClick:t,className:"nav-chip px-3 py-2","data-active":"false","aria-label":"Toggle theme",children:e==="dark"?s.jsx(xh,{className:"w-5 h-5 text-amber-300"}):s.jsx(kl,{className:"w-5 h-5 text-gray-700"})})]})]})})}),s.jsx("main",{className:"page-shell",children:r}),s.jsx("nav",{className:"lg:hidden fixed bottom-4 left-0 right-0 px-3 z-50",children:s.jsx("div",{className:"max-w-5xl mx-auto",children:s.jsx("div",{className:"glass-panel rounded-2xl shadow-2xl border border-white/60 dark:border-white/10",children:s.jsxs("div",{className:"grid grid-cols-4 divide-x divide-white/40 dark:divide-white/5",children:[s.jsxs(Gt,{to:"/call",className:`flex flex-col items-center justify-center gap-1 py-3 ${i.pathname==="/call"?"text-[#4E6E49]":e==="dark"?"text-gray-300":"text-gray-700"}`,children:[s.jsx(si,{className:"w-5 h-5"}),s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx("span",{className:"text-[11px] font-semibold",children:"HUB"}),s.jsx(Nt,{className:"w-3 h-3 opacity-70"})]})]}),s.jsxs("button",{onClick:()=>{c(!o)},className:`flex flex-col items-center justify-center gap-1 py-3 ${v?"text-[#4E6E49]":e==="dark"?"text-gray-300":"text-gray-700"}`,children:[s.jsx(yd,{className:"w-5 h-5"}),s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx("span",{className:"text-[11px] font-semibold",children:"Функционал"}),s.jsx(hd,{className:"w-3 h-3 opacity-70"})]})]}),s.jsxs(Gt,{to:"/about",className:`flex flex-col items-center justify-center gap-1 py-3 ${i.pathname==="/about"?"text-[#4E6E49]":e==="dark"?"text-gray-300":"text-gray-700"}`,children:[s.jsx(ln,{className:"w-5 h-5"}),s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx("span",{className:"text-[11px] font-semibold",children:"О нас"}),s.jsx(Nt,{className:"w-3 h-3 opacity-70"})]})]}),s.jsxs(Gt,{to:"/profile",className:`flex flex-col items-center justify-center gap-1 py-3 ${i.pathname==="/profile"?"text-[#4E6E49]":e==="dark"?"text-gray-300":"text-gray-700"}`,children:[s.jsx(cn,{className:"w-5 h-5"}),s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx("span",{className:"text-[11px] font-semibold",children:"ЛК"}),s.jsx(Nt,{className:"w-3 h-3 opacity-70"})]})]})]})})})}),o&&s.jsx("div",{className:"lg:hidden fixed inset-0 z-40 bg-black/40 backdrop-blur-sm",onClick:()=>c(!1),children:s.jsxs("div",{className:"absolute bottom-24 left-1/2 -translate-x-1/2 w-[88%] max-w-sm glass-panel rounded-2xl shadow-2xl border border-white/50 dark:border-white/10 overflow-hidden",children:[s.jsx("div",{className:"accent-dots"}),s.jsx("div",{className:"relative z-10 divide-y divide-gray-100/60 dark:divide-white/5",children:p.map(T=>s.jsxs(Gt,{to:T.path,onClick:()=>c(!1),className:`flex items-center gap-3 px-4 py-3 transition-colors ${A(T.path)?"bg-gradient-to-r from-[#4E6E49]/15 to-[#4E6E49]/5 text-[#4E6E49] dark:from-[#4E6E49]/20 dark:text-[#4E6E49]":e==="dark"?"hover:bg-white/5 text-gray-200":"hover:bg-gray-50 text-gray-800"}`,children:[s.jsx(T.icon,{className:"w-4 h-4 flex-shrink-0"}),s.jsx("span",{className:"font-semibold flex-1",children:T.label}),s.jsx(Nt,{className:"w-4 h-4 opacity-70"})]},T.path))})]})})]})},Yu=[{value:"solana",label:"Solana"},{value:"ethereum",label:"ETH"},{value:"bsc",label:"BSC"},{value:"ton",label:"TON"},{value:"base",label:"Base"},{value:"sui",label:"SUI"},{value:"monad",label:"Monad"},{value:"polygon",label:"Polygon"}],O_={memecoins:{label:"Мемкоины",gradient:"from-emerald-300 to-teal-400",icon:s.jsx(ya,{className:"w-5 h-5"}),pastelBg:"bg-emerald-50",pastelBorder:"border-emerald-100",pastelText:"text-emerald-800"},futures:{label:"Фьючерсы",gradient:"from-sky-300 to-indigo-400",icon:s.jsx(xa,{className:"w-5 h-5"}),pastelBg:"bg-sky-50",pastelBorder:"border-sky-100",pastelText:"text-sky-800"},nft:{label:"NFT",gradient:"from-purple-300 to-pink-300",icon:s.jsx(fa,{className:"w-5 h-5"}),pastelBg:"bg-purple-50",pastelBorder:"border-purple-100",pastelText:"text-purple-800"},spot:{label:"Спот",gradient:"from-amber-300 to-orange-300",icon:s.jsx(pr,{className:"w-5 h-5"}),pastelBg:"bg-amber-50",pastelBorder:"border-amber-100",pastelText:"text-amber-800"},polymarket:{label:"Polymarket",gradient:"from-rose-300 to-red-300",icon:s.jsx(ns,{className:"w-5 h-5"}),pastelBg:"bg-rose-50",pastelBorder:"border-rose-100",pastelText:"text-rose-800"},staking:{label:"Стейкинг",gradient:"from-cyan-300 to-blue-300",icon:s.jsx(zt,{className:"w-5 h-5"}),pastelBg:"bg-cyan-50",pastelBorder:"border-cyan-100",pastelText:"text-cyan-800"}},V_={memecoins:[{key:"coinName",label:"Название монеты",placeholder:"PEPE"},{key:"ticker",label:"Тикер",placeholder:"PEPE"},{key:"network",label:"Сеть",type:"select",options:Yu},{key:"contract",label:"Контракт",placeholder:"0x..."},{key:"signalType",label:"Тип сигнала",type:"select",options:[{value:"buy",label:"Buy"},{value:"sell",label:"Sell"},{value:"hold",label:"Hold"},{value:"alert",label:"Alert"}]},{key:"reason",label:"Причина входа",placeholder:"Хайп, крупные покупки..."},{key:"entryCap",label:"Зона входа в капитализации",placeholder:"10M-15M"},{key:"targets",label:"Цели (TP1/TP2/TP3)",placeholder:"20M / 30M / 50M"},{key:"stopLoss",label:"Стоп-лосс (если применим)",placeholder:"5M или 15%"},{key:"riskLevel",label:"Риск-уровень",type:"select",options:[{value:"low",label:"Низкий"},{value:"medium",label:"Средний"},{value:"high",label:"Высокий"},{value:"ultra",label:"Ультра-высокий"}]},{key:"risks",label:"Риски",placeholder:"Разворот тренда, низкая ликвидность",type:"textarea"},{key:"holdPlan",label:"План удержания",type:"select",options:[{value:"flip",label:"Флип"},{value:"short",label:"Краткосрок"},{value:"medium",label:"Среднесрок"},{value:"long",label:"Дальнесрок"}]},{key:"liquidityLocked",label:"Залочена ли ликвидность",type:"checkbox"},{key:"traderComment",label:"Комментарий трейдера",type:"textarea",placeholder:"Доп. наблюдения, планы"}],futures:[{key:"pair",label:"Пара",placeholder:"BTC/USDT"},{key:"direction",label:"Направление",type:"select",options:[{value:"long",label:"Long"},{value:"short",label:"Short"}]},{key:"leverage",label:"Рекомендованное плечо",placeholder:"x3 - x10"},{key:"entryPrice",label:"Цена входа",placeholder:"69500"},{key:"entryZone",label:"Зоны входа (min-max)",placeholder:"69000 - 70000"},{key:"targets",label:"Цели (TP1/TP2/TP3)",placeholder:"71000 / 72500 / 74000"},{key:"stopLoss",label:"SL уровень",placeholder:"68000"},{key:"signalStyle",label:"Тип сигнала",type:"select",options:[{value:"breakout",label:"Breakout"},{value:"retest",label:"Retest"},{value:"range",label:"Range"},{value:"scalping",label:"Scalping"},{value:"swing",label:"Swing"}]},{key:"positionSize",label:"Размер позиции (% от депо)",placeholder:"2-5%"},{key:"reason",label:"Причина входа (анализ)",placeholder:"Тренд, объемы, дивергенция...",type:"textarea"},{key:"timeframe",label:"Таймфрейм анализа",type:"select",options:[{value:"1m",label:"1m"},{value:"5m",label:"5m"},{value:"15m",label:"15m"},{value:"1h",label:"1h"},{value:"4h",label:"4h"}]},{key:"risks",label:"Риски",placeholder:"Резкий вброс, низкая волатильность",type:"textarea"},{key:"riskLevel",label:"Риск-уровень",type:"select",options:[{value:"low",label:"Низкий"},{value:"medium",label:"Средний"},{value:"high",label:"Высокий"},{value:"ultra",label:"Ультра-высокий"}]}],nft:[{key:"collectionLink",label:"Коллекция (ссылка)",placeholder:"https://..."},{key:"nftLink",label:"NFT (ссылка)",placeholder:"https://.../item"},{key:"marketplace",label:"Маркетплейс",placeholder:"OpenSea / Magic Eden"},{key:"network",label:"Сеть",type:"select",options:Yu},{key:"entryPrice",label:"Рекомендованная цена входа",placeholder:"1.2 ETH"},{key:"rarity",label:"Редкость / атрибуты",placeholder:"Rank < 5% или редкий фон"},{key:"signalType",label:"Тип сигнала",type:"select",options:[{value:"buy",label:"Buy"},{value:"sell",label:"Sell"},{value:"mint",label:"Mint"}]},{key:"reason",label:"Причина входа",placeholder:"Новый минт, хайп, инсайд",type:"textarea"},{key:"holdingHorizon",label:"Срок удержания",type:"select",options:[{value:"flip",label:"Скоростной флип"},{value:"short",label:"Краткосрок"},{value:"medium",label:"Среднесрок"},{value:"long",label:"Долгосрок"}]},{key:"minLiquidity",label:"Минимальная ликвидность (floor + объём)",placeholder:"Floor 2 ETH, объём 120 ETH"},{key:"targetPrice",label:"Цель продажи / Target price",placeholder:"3 ETH"},{key:"traderComment",label:"Комментарий трейдера",type:"textarea",placeholder:"Что смотрим, когда фиксируем"},{key:"risks",label:"Риски",type:"textarea",placeholder:"Падение спроса, фальшивый объём"}],spot:[{key:"coin",label:"Монета",placeholder:"BTC"},{key:"entryCap",label:"Капитализация входа",placeholder:"500M"},{key:"targets",label:"Цели (TP1/TP2/TP3)",placeholder:"550M / 650M / 750M"},{key:"stopLoss",label:"SL",placeholder:"-10%"},{key:"holdingHorizon",label:"Горизонт удержания",type:"select",options:[{value:"short",label:"Краткосрок"},{value:"medium",label:"Среднесрок"},{value:"long",label:"Долгосрок"}]},{key:"reason",label:"Причина входа",placeholder:"Фундаментал, хайп, запуск",type:"textarea"},{key:"positionSize",label:"Размер позиции",placeholder:"5-10% портфеля"},{key:"risks",label:"Риски",placeholder:"Регуляторика, конкуренты",type:"textarea"},{key:"traderComment",label:"Комментарий",type:"textarea",placeholder:"Условия фиксации, обновления"},{key:"riskLevel",label:"Риск-уровень",type:"select",options:[{value:"low",label:"Низкий"},{value:"medium",label:"Средний"},{value:"high",label:"Высокий"},{value:"ultra",label:"Ультра-высокий"}]}],polymarket:[{key:"event",label:"Событие",placeholder:"Trump wins 2025"},{key:"positionType",label:"Тип позиции",type:"select",options:[{value:"yes",label:"Yes"},{value:"no",label:"No"}]},{key:"entryPrice",label:"Цена входа (%)",placeholder:"42%"},{key:"expectedProbability",label:"Ожидаемая вероятность (%)",placeholder:"65%"},{key:"reason",label:"Причина входа",placeholder:"Аналитика, инсайд, тренд новостей",type:"textarea"},{key:"eventDeadline",label:"Срок исхода события",placeholder:"31.12.2025"},{key:"riskLevel",label:"Риск",type:"select",options:[{value:"low",label:"Низкий"},{value:"medium",label:"Средний"},{value:"high",label:"Высокий"},{value:"ultra",label:"Ультра-высокий"}]},{key:"maxStake",label:"Максимальный объём ставки",placeholder:"до $5k"},{key:"risks",label:"Риски",placeholder:"Неопределённость новостей, низкая ликвидность",type:"textarea"},{key:"targetPlan",label:"Цель",placeholder:"Продажа до события или удержание"}],staking:[{key:"coin",label:"Монета",placeholder:"SOL"},{key:"platform",label:"Платформа",placeholder:"Jito, Lido..."},{key:"term",label:"Срок стейкинга",type:"select",options:[{value:"flexible",label:"Гибкий"},{value:"30d",label:"30 дней"},{value:"90d",label:"90 дней"},{value:"fixed",label:"Фиксированный"}]},{key:"apy",label:"APY",placeholder:"12-18%"},{key:"minDeposit",label:"Минимальный депозит",placeholder:"100 USDT"},{key:"protocolRisk",label:"Риски протокола",type:"select",options:[{value:"low",label:"Низкие"},{value:"medium",label:"Средние"},{value:"high",label:"Высокие"},{value:"ultra",label:"Ультра"}]},{key:"action",label:"Тип сигнала",type:"select",options:[{value:"enter",label:"Вход"},{value:"exit",label:"Выход"},{value:"rebalance",label:"Перераспределение"}]},{key:"reason",label:"Причина",placeholder:"Рост доходности, снижение рисков...",type:"textarea"},{key:"risks",label:"Риски",placeholder:"Смарт-контракт, ликвидность",type:"textarea"},{key:"traderComment",label:"Комментарий трейдера",type:"textarea",placeholder:"Тактика выхода, дополнительные условия"}]},Qu=()=>({memecoins:{coinName:"",ticker:"",network:"solana",contract:"",signalType:"buy",reason:"",entryCap:"",targets:"",stopLoss:"",riskLevel:"medium",risks:"",holdPlan:"short",liquidityLocked:!1,traderComment:""},futures:{pair:"",direction:"long",leverage:"",entryPrice:"",entryZone:"",targets:"",stopLoss:"",signalStyle:"breakout",positionSize:"",reason:"",timeframe:"1h",risks:"",riskLevel:"medium"},nft:{collectionLink:"",nftLink:"",marketplace:"",network:"ethereum",entryPrice:"",rarity:"",signalType:"buy",reason:"",holdingHorizon:"short",minLiquidity:"",targetPrice:"",traderComment:"",risks:""},spot:{coin:"",entryCap:"",targets:"",stopLoss:"",holdingHorizon:"medium",reason:"",positionSize:"",risks:"",traderComment:"",riskLevel:"medium"},polymarket:{event:"",positionType:"yes",entryPrice:"",expectedProbability:"",reason:"",eventDeadline:"",riskLevel:"medium",maxStake:"",risks:"",targetPlan:""},staking:{coin:"",platform:"",term:"flexible",apy:"",minDeposit:"",protocolRisk:"medium",action:"enter",reason:"",risks:"",traderComment:""}}),Xu=(r,e)=>({memecoins:{...r.memecoins,...(e==null?void 0:e.memecoins)||{}},futures:{...r.futures,...(e==null?void 0:e.futures)||{}},nft:{...r.nft,...(e==null?void 0:e.nft)||{}},spot:{...r.spot,...(e==null?void 0:e.spot)||{}},polymarket:{...r.polymarket,...(e==null?void 0:e.polymarket)||{}},staking:{...r.staking,...(e==null?void 0:e.staking)||{}}}),L_=({onSuccess:r,onCancel:e,callToEdit:t,initialCategory:n})=>{const{theme:a}=it(),{user:i}=kt(),[o,c]=D.useState(!1),[d,h]=D.useState(""),g=Xu(Qu(),t==null?void 0:t.details),[x,p]=D.useState((t==null?void 0:t.category)||n||"memecoins"),[v,A]=D.useState((t==null?void 0:t.comment)||""),[C,T]=D.useState(g);D.useEffect(()=>{const k=Xu(Qu(),t==null?void 0:t.details);T(k),p((t==null?void 0:t.category)||n||"memecoins"),A((t==null?void 0:t.comment)||"")},[t,n]);const z=a==="dark"?"text-white":"text-gray-900",$=a==="dark"?"border-gray-800":"border-gray-200",S=a==="dark"?"bg-gray-700/60":"bg-gray-50",I=a==="dark"?"text-gray-400":"text-gray-500",H=(k,j)=>{T(N=>({...N,[x]:{...N[x],[k]:j}}))},G=k=>(k==null?void 0:k.riskLevel)||(k==null?void 0:k.protocolRisk)||void 0,E=k=>{if(k!=null&&k.signalType)return k.signalType;if((k==null?void 0:k.direction)==="long")return"buy";if((k==null?void 0:k.direction)==="short")return"sell"},y=async k=>{k.preventDefault(),h(""),c(!0);try{const j=C[x],N={...t==null?void 0:t.details,[x]:j},de={userId:(t==null?void 0:t.userId)||(i==null?void 0:i.id)||"unknown",category:x,details:N,createdAt:(t==null?void 0:t.createdAt)||new Date().toISOString(),status:(t==null?void 0:t.status)||"active",tags:(t==null?void 0:t.tags)||[]},V=v==null?void 0:v.trim();V&&(de.comment=V);const X=E(j);X&&(de.sentiment=X);const R=G(j);R&&(de.riskLevel=R),(t==null?void 0:t.maxProfit)!==void 0&&(de.maxProfit=t.maxProfit),(t==null?void 0:t.currentPnL)!==void 0&&(de.currentPnL=t.currentPnL),(t==null?void 0:t.currentMarketCap)!==void 0&&(de.currentMarketCap=t.currentMarketCap),(t==null?void 0:t.signalMarketCap)!==void 0&&(de.signalMarketCap=t.signalMarketCap),(t==null?void 0:t.currentPrice)!==void 0&&(de.currentPrice=t.currentPrice),(t==null?void 0:t.entryPrice)!==void 0&&(de.entryPrice=t.entryPrice),t?await Kg(t.id,de):await N2(de),r==null||r()}catch(j){console.error("Error creating call:",j);const N=(j==null?void 0:j.message)||(j==null?void 0:j.code)||"Ошибка при сохранении сигнала";h(N)}finally{c(!1)}},w=k=>{var de;const N=(C[x]||{})[k.key],f=`w-full px-4 py-2 rounded-lg border ${$} ${S} ${z} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`;return k.type==="textarea"?s.jsx("textarea",{value:N||"",onChange:V=>H(k.key,V.target.value),className:`${f} min-h-[100px] resize-y`,placeholder:k.placeholder}):k.type==="select"&&k.options?s.jsx("select",{value:N||((de=k.options[0])==null?void 0:de.value)||"",onChange:V=>H(k.key,V.target.value),className:`${f} appearance-none`,children:k.options.map(V=>s.jsx("option",{value:V.value,children:V.label},V.value))}):k.type==="checkbox"?s.jsxs("label",{className:"inline-flex items-center gap-2 cursor-pointer select-none",children:[s.jsx("input",{type:"checkbox",checked:!!N,onChange:V=>H(k.key,V.target.checked),className:"accent-[#4E6E49] w-4 h-4"}),s.jsx("span",{className:z,children:k.label})]}):s.jsx("input",{type:"text",value:N||"",onChange:V=>H(k.key,V.target.value),className:f,placeholder:k.placeholder})};return s.jsxs("form",{onSubmit:y,className:"space-y-6",children:[d&&s.jsx("div",{className:`p-4 rounded-lg ${a==="dark"?"bg-red-900/30 border border-red-700 text-red-300":"bg-red-50 border border-red-200 text-red-800"}`,children:d}),s.jsxs("div",{className:`rounded-2xl border ${$} ${a==="dark"?"bg-gray-800/60":"bg-white"} p-4 sm:p-6 space-y-4`,children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("div",{className:"w-10 h-10 rounded-xl flex items-center justify-center text-white shadow-lg",style:{background:"linear-gradient(135deg, #4E6E49, #3b8d5a)"},children:s.jsx(Yt,{className:"w-5 h-5"})}),s.jsxs("div",{children:[s.jsx("p",{className:`text-lg font-bold ${z}`,children:O_[x].label}),s.jsx("p",{className:`text-xs ${I}`,children:"Добавьте любые детали по этому типу сигнала"})]})]}),s.jsx("div",{className:"grid grid-cols-1 gap-4",children:V_[x].map(k=>s.jsxs("div",{className:"space-y-2",children:[k.type!=="checkbox"&&s.jsxs("div",{className:"flex items-center justify-between gap-2",children:[s.jsx("label",{className:`text-sm font-semibold ${z}`,children:k.label}),k.helper&&s.jsx("span",{className:`text-[11px] ${I}`,children:k.helper})]}),w(k)]},k.key))})]}),s.jsxs("div",{children:[s.jsx("label",{className:`block text-sm font-medium ${z} mb-2`,children:"Общий комментарий или доп. заметки"}),s.jsx("textarea",{value:v,onChange:k=>A(k.target.value),className:`w-full px-4 py-3 rounded-lg border ${$} ${S} ${z} focus:outline-none focus:ring-2 focus:ring-[#4E6E49] min-h-[90px] resize-y`,placeholder:"Здесь можно оставить чеклист для апдейтов, условия выхода, алерты."})]}),s.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[s.jsx("button",{type:"submit",disabled:o,className:`flex-1 py-3 rounded-lg font-semibold transition-all shadow-md ${a==="dark"?"bg-gradient-to-r from-[#4E6E49] to-emerald-700 text-white hover:scale-[1.01] disabled:bg-gray-700":"bg-gradient-to-r from-[#4E6E49] to-emerald-600 text-white hover:shadow-lg disabled:bg-gray-300 disabled:text-gray-600"}`,children:o?"Сохраняем...":t?"Обновить сигнал":"Создать сигнал"}),e&&s.jsx("button",{type:"button",onClick:e,className:`px-6 py-3 rounded-lg font-semibold border ${$} ${a==="dark"?"text-white hover:bg-gray-800":"text-gray-800 hover:bg-gray-100"}`,children:"Отмена"})]})]})},Oi="modal-open";let Jn=0;const F_=()=>{typeof document>"u"||(Jn===0&&(document.body.classList.add(Oi),document.documentElement.classList.add(Oi)),Jn+=1)},U_=()=>{typeof document>"u"||(Jn=Math.max(Jn-1,0),Jn===0&&(document.body.classList.remove(Oi),document.documentElement.classList.remove(Oi)))},In=(r=!0)=>{D.useEffect(()=>{if(r)return F_(),()=>{U_()}},[r])},Fn={memecoins:{label:"Мемкоины",gradient:"from-emerald-400 to-teal-500",chip:"bg-emerald-500/10 text-emerald-600",icon:s.jsx(ya,{className:"w-4 h-4"})},futures:{label:"Фьючерсы",gradient:"from-blue-400 to-indigo-500",chip:"bg-blue-500/10 text-blue-600",icon:s.jsx(xa,{className:"w-4 h-4"})},nft:{label:"NFT",gradient:"from-purple-400 to-pink-500",chip:"bg-purple-500/10 text-purple-600",icon:s.jsx(fa,{className:"w-4 h-4"})},spot:{label:"Спот",gradient:"from-amber-400 to-orange-500",chip:"bg-amber-500/10 text-amber-600",icon:s.jsx(pr,{className:"w-4 h-4"})},polymarket:{label:"Polymarket",gradient:"from-rose-400 to-red-500",chip:"bg-rose-500/10 text-rose-600",icon:s.jsx(ns,{className:"w-4 h-4"})},staking:{label:"Стейкинг",gradient:"from-cyan-400 to-blue-500",chip:"bg-cyan-500/10 text-cyan-600",icon:s.jsx(zt,{className:"w-4 h-4"})}},ti={all:{label:"Все",className:""},active:{label:"Активен",className:"bg-emerald-500/15 text-emerald-500 border border-emerald-500/20"},completed:{label:"Завершен",className:"bg-blue-500/15 text-blue-500 border border-blue-500/20"},cancelled:{label:"Отменен",className:"bg-red-500/15 text-red-500 border border-red-500/20"},reviewed:{label:"На рассмотрении",className:"bg-gray-500/15 text-gray-500 border border-gray-500/20"}},Ju={low:"bg-emerald-500/10 text-emerald-600 border border-emerald-500/20",medium:"bg-blue-500/10 text-blue-600 border border-blue-500/20",high:"bg-amber-500/10 text-amber-600 border border-amber-500/20",ultra:"bg-red-500/10 text-red-600 border border-red-500/20"},B_=()=>{const{theme:r}=it(),[e,t]=D.useState([]),[n,a]=D.useState(!0),[i,o]=D.useState(!1),[c,d]=D.useState(!1),[h,g]=D.useState(null),[x,p]=D.useState(null),[v,A]=D.useState(null),[C,T]=D.useState("memecoins"),[z,$]=D.useState(null),[S,I]=D.useState(""),[H,G]=D.useState("all"),[E,y]=D.useState("all"),[w,k]=D.useState("all"),[j,N]=D.useState("all");In(i||c||!!x),D.useEffect(()=>{f()},[]);const f=async()=>{a(!0);try{const P=await j2();t(P)}catch(P){console.error("Error loading calls:",P),t([])}finally{a(!1)}},de=r==="dark"?"bg-[#121212]":"bg-white",V=r==="dark"?"text-white":"text-gray-900",X=r==="dark"?"text-gray-400":"text-gray-600",R=r==="dark"?"border-gray-800":"border-gray-200",te={memecoins:{bg:r==="dark"?"bg-emerald-500/10":"bg-emerald-50",text:r==="dark"?"text-emerald-100":"text-emerald-800",border:r==="dark"?"border-emerald-500/30":"border-emerald-200",chipBg:r==="dark"?"bg-emerald-500/20":"bg-emerald-500/10"},futures:{bg:r==="dark"?"bg-sky-500/10":"bg-sky-50",text:r==="dark"?"text-sky-100":"text-sky-800",border:r==="dark"?"border-sky-500/30":"border-sky-200",chipBg:r==="dark"?"bg-sky-500/20":"bg-sky-500/10"},nft:{bg:r==="dark"?"bg-purple-500/10":"bg-purple-50",text:r==="dark"?"text-purple-100":"text-purple-800",border:r==="dark"?"border-purple-500/30":"border-purple-200",chipBg:r==="dark"?"bg-purple-500/20":"bg-purple-500/10"},spot:{bg:r==="dark"?"bg-amber-500/10":"bg-amber-50",text:r==="dark"?"text-amber-100":"text-amber-800",border:r==="dark"?"border-amber-500/30":"border-amber-200",chipBg:r==="dark"?"bg-amber-500/20":"bg-amber-500/10"},polymarket:{bg:r==="dark"?"bg-rose-500/10":"bg-rose-50",text:r==="dark"?"text-rose-100":"text-rose-800",border:r==="dark"?"border-rose-500/30":"border-rose-200",chipBg:r==="dark"?"bg-rose-500/20":"bg-rose-500/10"},staking:{bg:r==="dark"?"bg-cyan-500/10":"bg-cyan-50",text:r==="dark"?"text-cyan-100":"text-cyan-800",border:r==="dark"?"border-cyan-500/30":"border-cyan-200",chipBg:r==="dark"?"bg-cyan-500/20":"bg-cyan-500/10"}},Z=()=>{o(!1),A(null),f()},oe=()=>{o(!1),A(null)},F=P=>{A(P),T(P.category),o(!0)},L=P=>{g(P),d(!0)},M=async()=>{if(h)try{await E2(h),d(!1),g(null),f()}catch(P){console.error("Error deleting call:",P),alert("Ошибка при удалении сигнала")}},re=async()=>{if(x)try{await Kg(x,{status:"cancelled"}),p(null),f()}catch(P){console.error("Error cancelling call:",P),alert("Ошибка при отмене сигнала")}},me=async P=>{try{await navigator.clipboard.writeText(P),$(P),setTimeout(()=>$(null),1800)}catch(_){console.error("Failed to copy:",_)}},W=P=>{var _;return((_=P.details)==null?void 0:_[P.category])||{}},ie=P=>{const _=W(P);switch(P.category){case"memecoins":return _.coinName||_.ticker||"Мемкоин";case"futures":return _.pair||"Фьючерс";case"nft":return _.collectionLink||"NFT коллекция";case"spot":return _.coin||"Спот";case"polymarket":return _.event||"Polymarket событие";case"staking":return _.coin||"Стейкинг";default:return"Сигнал"}},Q=P=>{const _=W(P);switch(P.category){case"memecoins":return`${_.ticker||""} ${_.network?`• ${String(_.network).toUpperCase()}`:""}`.trim();case"futures":return`${_.direction==="long"?"Long":"Short"} • ${_.timeframe||""}`;case"nft":return`${_.marketplace||""}${_.network?` • ${String(_.network).toUpperCase()}`:""}`;case"spot":return _.holdingHorizon?`Горизонт: ${_.holdingHorizon}`:"";case"polymarket":return`${_.positionType==="yes"?"YES":"NO"} • ${_.entryPrice||""}`;case"staking":return`${_.platform||""}${_.term?` • ${_.term}`:""}`;default:return""}},B=P=>P.riskLevel||W(P).riskLevel||W(P).protocolRisk||"medium",ue=P=>{const _=W(P);return[P.category,P.status,P.comment,_.coinName,_.ticker,_.pair,_.reason,_.targets,_.event,_.marketplace,_.platform,_.entryCap,_.entryZone,_.network].filter(Boolean).join(" ").toLowerCase()},O=e.filter(P=>H!=="all"&&P.status!==H||E!=="all"&&P.category!==E||w!=="all"&&B(P)!==w||j!=="all"&&P.userId!==j?!1:S.trim()?ue(P).includes(S.toLowerCase()):!0),ge=D.useMemo(()=>e.reduce((P,_)=>(P[_.category]||(P[_.category]={total:0,active:0}),P[_.category].total+=1,_.status==="active"&&(P[_.category].active+=1),P),{memecoins:{total:0,active:0},futures:{total:0,active:0},nft:{total:0,active:0},spot:{total:0,active:0},polymarket:{total:0,active:0},staking:{total:0,active:0}}),[e]),Ee=D.useMemo(()=>({total:e.length,active:e.filter(P=>P.status==="active").length,completed:e.filter(P=>P.status==="completed").length,highRisk:e.filter(P=>B(P)==="high"||B(P)==="ultra").length}),[e]),Y=r==="dark"?"bg-gray-800 text-gray-200 border border-gray-700":"bg-white text-gray-700 border border-gray-200",fe="bg-gradient-to-r from-emerald-400 to-teal-500 text-white shadow-md shadow-emerald-300/30",pe=(P,_,be)=>s.jsxs("div",{className:`p-4 rounded-xl border ${R} ${r==="dark"?"bg-gray-800/70":"bg-gray-50"}`,children:[s.jsx("p",{className:`text-xs uppercase tracking-wider ${X}`,children:P}),s.jsx("p",{className:`text-2xl font-bold ${be}`,children:_})]}),Ae={low:"Низкий",medium:"Средний",high:"Высокий",ultra:"Ультра"},qe={flip:"Flip",short:"Короткий",medium:"Средний",long:"Длинный"},Je={flexible:"Гибкий","30d":"30 дней","90d":"90 дней",fixed:"Фикс."},q={enter:"Вход",exit:"Выход",rebalance:"Ребаланс"},ae={yes:"YES",no:"NO"},De=(P,_=28)=>{if(!P)return"";if(P.length<=_)return P;const be=P.slice(0,Math.floor(_/2)),Ne=P.slice(-6);return`${be}...${Ne}`},ee=P=>P?P.includes("%")?P:`${P}%`:"",Me=P=>{if(!P)return"";const _=new Date(P);if(Number.isNaN(_.getTime()))return P;const be=new Date,Ne=_.getTime()-be.getTime(),Ie=_.toLocaleString("ru-RU",{day:"2-digit",month:"short",hour:"2-digit",minute:"2-digit"});if(Ne<=0)return`${Ie} (истек)`;const ne=Math.max(0,Math.floor(Ne/(1e3*60))),we=Math.floor(ne/(60*24)),ke=Math.floor(ne%(60*24)/60),$e=ne%60,rt=[we>0?`${we}д`:null,ke>0?`${ke}ч`:null,$e>0?`${$e}м`:null].filter(Boolean).slice(0,2).join(" ");return`${Ie} (через ${rt||"минуты"})`},Ue=P=>{const _=W(P),be=B(P),Ne=te[P.category],Ie=[],ne=(ke,$e,rt,gt)=>{$e&&Ie.push({label:ke,value:$e,icon:rt,copyValue:gt??$e})};switch(P.category){case"memecoins":ne("Монета",_.coinName,s.jsx(pr,{className:"w-4 h-4"})),ne("Тикер",_.ticker,s.jsx($p,{className:"w-4 h-4"}),_.ticker),ne("Сеть",_.network?String(_.network).toUpperCase():"",s.jsx(Mp,{className:"w-4 h-4"})),ne("Контракт",De(_.contract),s.jsx(Dp,{className:"w-4 h-4"}),_.contract),ne("Тип сигнала",_.signalType?_.signalType.toUpperCase():"",s.jsx(Ao,{className:"w-4 h-4"})),ne("Зона входа",_.entryCap,s.jsx(za,{className:"w-4 h-4"})),ne("Цели",_.targets,s.jsx(ns,{className:"w-4 h-4"})),ne("SL",_.stopLoss,s.jsx(To,{className:"w-4 h-4"})),ne("План",qe[_.holdPlan]||_.holdPlan,s.jsx(Hn,{className:"w-4 h-4"})),ne("Ликвидность",_.liquidityLocked?"Залочена":"",s.jsx(zt,{className:"w-4 h-4"})),ne("Риск",Ae[be]||be,s.jsx($n,{className:"w-4 h-4"})),ne("Риски",_.risks,s.jsx(Rr,{className:"w-4 h-4"})),ne("Комментарий",_.traderComment,s.jsx(Ys,{className:"w-4 h-4"})),ne("Причина входа",_.reason,s.jsx(ss,{className:"w-4 h-4"}));break;case"futures":ne("Пара",_.pair,s.jsx(mh,{className:"w-4 h-4"}),_.pair),ne("Направление",_.direction?_.direction.toUpperCase():"",s.jsx(Ms,{className:"w-4 h-4"})),ne("Плечо",_.leverage,s.jsx(ri,{className:"w-4 h-4"})),ne("Зона входа",_.entryZone||_.entryPrice,s.jsx(za,{className:"w-4 h-4"})),ne("Цели",_.targets,s.jsx(ns,{className:"w-4 h-4"})),ne("SL",_.stopLoss,s.jsx(To,{className:"w-4 h-4"})),ne("Стиль",_.signalStyle,s.jsx(Ao,{className:"w-4 h-4"})),ne("Размер позиции",_.positionSize,s.jsx(Ha,{className:"w-4 h-4"})),ne("Таймфрейм",_.timeframe,s.jsx(yh,{className:"w-4 h-4"})),ne("Риск",Ae[be]||be,s.jsx($n,{className:"w-4 h-4"})),ne("Риски",_.risks,s.jsx(Rr,{className:"w-4 h-4"})),ne("Причина входа",_.reason,s.jsx(ss,{className:"w-4 h-4"}));break;case"nft":ne("Коллекция",De(_.collectionLink),s.jsx(gd,{className:"w-4 h-4"}),_.collectionLink),ne("NFT",De(_.nftLink),s.jsx(gd,{className:"w-4 h-4"}),_.nftLink),ne("Маркетплейс",_.marketplace,s.jsx(ud,{className:"w-4 h-4"})),ne("Сеть",_.network?String(_.network).toUpperCase():"",s.jsx(Gp,{className:"w-4 h-4"})),ne("Вход",_.entryPrice,s.jsx(za,{className:"w-4 h-4"})),ne("Редкость",_.rarity,s.jsx(Yt,{className:"w-4 h-4"})),ne("Тип сигнала",_.signalType?_.signalType.toUpperCase():"",s.jsx(Ao,{className:"w-4 h-4"})),ne("Срок удержания",qe[_.holdingHorizon]||_.holdingHorizon,s.jsx(Hn,{className:"w-4 h-4"})),ne("Мин. ликвидность",_.minLiquidity,s.jsx(ri,{className:"w-4 h-4"})),ne("Target",_.targetPrice,s.jsx(ns,{className:"w-4 h-4"})),ne("Риски",_.risks,s.jsx(Rr,{className:"w-4 h-4"})),ne("Комментарий",_.traderComment,s.jsx(Ys,{className:"w-4 h-4"})),ne("Причина входа",_.reason,s.jsx(ss,{className:"w-4 h-4"}));break;case"spot":ne("Монета",_.coin,s.jsx(pr,{className:"w-4 h-4"})),ne("Зона входа",_.entryCap,s.jsx(za,{className:"w-4 h-4"})),ne("Цели",_.targets,s.jsx(ns,{className:"w-4 h-4"})),ne("SL",_.stopLoss,s.jsx(To,{className:"w-4 h-4"})),ne("Горизонт",qe[_.holdingHorizon]||_.holdingHorizon,s.jsx(Hn,{className:"w-4 h-4"})),ne("Размер",_.positionSize,s.jsx(Ha,{className:"w-4 h-4"})),ne("Риск",_.riskLevel?Ae[_.riskLevel]:void 0,s.jsx($n,{className:"w-4 h-4"})),ne("Риски",_.risks,s.jsx(Rr,{className:"w-4 h-4"})),ne("Комментарий",_.traderComment,s.jsx(Ys,{className:"w-4 h-4"})),ne("Причина входа",_.reason,s.jsx(ss,{className:"w-4 h-4"}));break;case"polymarket":const ke=_.positionType;ne("Событие",_.event,s.jsx(ss,{className:"w-4 h-4"})),ne("Тип",ke?ae[ke]:"",s.jsx(zt,{className:"w-4 h-4"})),ne("Вход %",ee(_.entryPrice),s.jsx(Ha,{className:"w-4 h-4"})),ne("Ожидание %",ee(_.expectedProbability),s.jsx(ri,{className:"w-4 h-4"})),ne("Цель",_.targetPlan,s.jsx(ns,{className:"w-4 h-4"})),ne("Макс ставка",_.maxStake,s.jsx(pr,{className:"w-4 h-4"})),ne("Срок исхода",Me(_.eventDeadline),s.jsx(Go,{className:"w-4 h-4"})),ne("Риск",Ae[be]||be,s.jsx($n,{className:"w-4 h-4"})),ne("Риски",_.risks,s.jsx(Rr,{className:"w-4 h-4"})),ne("Комментарий",_.traderComment,s.jsx(Ys,{className:"w-4 h-4"})),ne("Причина входа",_.reason,s.jsx(ss,{className:"w-4 h-4"}));break;case"staking":ne("Монета",_.coin,s.jsx(pr,{className:"w-4 h-4"})),ne("Платформа",_.platform,s.jsx(ud,{className:"w-4 h-4"})),ne("Срок",Je[_.term]||_.term,s.jsx(Go,{className:"w-4 h-4"})),ne("APY",ee(_.apy),s.jsx(Ha,{className:"w-4 h-4"})),ne("Мин. депозит",_.minDeposit,s.jsx(pr,{className:"w-4 h-4"})),ne("Тип сигнала",q[_.action]||_.action,s.jsx(zt,{className:"w-4 h-4"})),ne("Риск протокола",_.protocolRisk?Ae[_.protocolRisk]:void 0,s.jsx($n,{className:"w-4 h-4"})),ne("Риски",_.risks,s.jsx(Rr,{className:"w-4 h-4"})),ne("Комментарий",_.traderComment,s.jsx(Ys,{className:"w-4 h-4"})),ne("Причина входа",_.reason,s.jsx(ss,{className:"w-4 h-4"}));break}const we=Ie.filter(ke=>ke.value);return we.length?s.jsxs("div",{className:`rounded-2xl border ${R} ${r==="dark"?"bg-gray-900/60":"bg-white"}`,children:[s.jsxs("div",{className:`flex items-center gap-2 px-4 py-3 border-b ${R} ${r==="dark"?"bg-white/5":"bg-gray-50"}`,children:[s.jsx(Yt,{className:"w-4 h-4 text-amber-500"}),s.jsx("p",{className:`text-sm font-semibold ${V}`,children:"Ключевые метрики"}),s.jsxs("span",{className:`ml-auto text-[11px] font-semibold px-3 py-1 rounded-full ${Ju[be]}`,children:["Риск: ",Ae[be]||be]})]}),s.jsx("div",{className:"divide-y divide-gray-200/70 dark:divide-white/10",children:we.map(ke=>s.jsxs("div",{className:"flex items-center justify-between gap-3 px-4 py-3",children:[s.jsxs("div",{className:"flex items-start gap-3",children:[s.jsx("div",{className:`p-2 rounded-xl border ${Ne.border} ${Ne.bg} ${Ne.text}`,children:ke.icon}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsx("p",{className:`text-xs uppercase tracking-wide ${X}`,children:ke.label}),s.jsx("p",{className:`${V} font-semibold whitespace-pre-wrap break-words`,children:ke.value})]})]}),ke.copyValue&&s.jsxs("button",{onClick:()=>me(ke.copyValue),className:`px-3 py-2 rounded-lg border ${R} ${r==="dark"?"hover:bg-gray-800 bg-white/5":"hover:bg-gray-100 bg-white"} text-xs font-semibold flex items-center gap-2 shrink-0`,children:[z===ke.copyValue?s.jsx(Rs,{className:"w-4 h-4 text-emerald-500"}):s.jsx(gi,{className:"w-4 h-4"}),z===ke.copyValue?"Скопировано":"Копировать"]})]},ke.label))})]}):null};return s.jsx(cr,{children:s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:`relative overflow-hidden rounded-2xl p-6 sm:p-7 md:p-8 border-2 shadow-2xl ${r==="dark"?"bg-gradient-to-br from-[#151c2a] via-[#0f1623] to-[#0a101b] border-[#4E6E49]/35":"bg-gradient-to-br from-white via-emerald-50/25 to-white border-emerald-200"}`,children:[s.jsxs("div",{className:"absolute inset-0 pointer-events-none",children:[s.jsx("div",{className:"absolute -top-24 -left-16 w-64 h-64 bg-gradient-to-br from-[#4E6E49]/18 via-transparent to-transparent blur-3xl"}),s.jsx("div",{className:"absolute top-0 right-0 w-72 h-72 bg-gradient-to-bl from-sky-400/14 via-emerald-400/12 to-transparent blur-3xl"}),s.jsx("div",{className:"absolute bottom-[-120px] left-12 w-64 h-64 bg-gradient-to-tr from-amber-300/14 via-[#4E6E49]/12 to-transparent blur-3xl"})]}),s.jsxs("div",{className:"relative z-10 flex flex-col gap-4 lg:flex-row lg:items-center lg:justify-between",children:[s.jsx("div",{className:"space-y-3",children:s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"p-3 rounded-2xl bg-gradient-to-br from-[#4E6E49] via-emerald-500 to-sky-500 text-white shadow-lg shadow-emerald-500/30",children:s.jsx(si,{className:"w-6 h-6"})}),s.jsx("div",{className:"flex flex-col justify-center",children:s.jsx("h1",{className:"text-2xl sm:text-3xl font-extrabold text-white drop-shadow-lg leading-tight",children:"Signals HUB"})})]})}),s.jsx("div",{className:"flex flex-wrap items-center gap-3"})]})]}),s.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-3 gap-4",children:Object.keys(Fn).map(P=>{const _=Fn[P],be=ge[P],Ne=te[P];return s.jsxs("button",{onClick:()=>{T(P),A(null),o(!0)},className:`p-4 rounded-xl border ${Ne.border} ${Ne.bg} text-left shadow-sm hover:shadow-lg transition-all hover:-translate-y-0.5 space-y-2`,children:[s.jsxs("div",{className:"flex items-start justify-between gap-3",children:[s.jsxs("div",{className:`flex items-center gap-2 px-3 py-1 rounded-full text-[11px] font-semibold border border-transparent ${Ne.text}`,children:[_.icon,s.jsx("span",{children:_.label})]}),s.jsx("span",{className:`px-3 py-1 rounded-full text-[11px] font-semibold border ${Ne.border} ${Ne.text} ${r==="dark"?"bg-white/5":"bg-white/80"}`,children:"Добавить"})]}),s.jsxs("div",{children:[s.jsx("p",{className:`text-2xl font-extrabold ${V}`,children:(be==null?void 0:be.total)||0}),s.jsxs("p",{className:`text-xs ${X}`,children:["Всего сигналов • Активных ",(be==null?void 0:be.active)||0]})]})]},P)})}),s.jsx("div",{className:`rounded-2xl border ${R} ${r==="dark"?"bg-gray-900/70":"bg-white"} p-5 space-y-4`,children:s.jsxs("div",{className:"flex flex-col gap-3",children:[s.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[s.jsxs("div",{className:"flex items-center gap-2 text-sm font-semibold",children:[s.jsx(ph,{className:`w-4 h-4 ${X}`}),s.jsx("span",{className:V,children:"Фильтры"})]}),s.jsx("div",{className:"flex flex-wrap gap-2",children:Object.keys(ti).map(P=>s.jsx("button",{onClick:()=>G(P),className:`px-3 py-1.5 rounded-xl text-sm font-semibold transition-all ${H===P?fe:Y}`,children:ti[P].label},P))})]}),s.jsxs("div",{className:"flex flex-col gap-2",children:[s.jsxs("label",{className:`text-xs uppercase tracking-wider ${X} flex items-center gap-2`,children:[s.jsx(ef,{className:"w-4 h-4"}),"Поиск по всем сферам ",s.jsxs("span",{className:"text-[11px] text-gray-500 dark:text-gray-400",children:[O.length,"/",e.length]})]}),s.jsx("input",{value:S,onChange:P=>I(P.target.value),placeholder:"тикер, событие, сеть, причина...",className:`w-full px-3 py-2 rounded-xl border ${R} ${r==="dark"?"bg-gray-800":"bg-gray-50"} ${V} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]/60`})]}),s.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[s.jsx("span",{className:`text-xs ${X} uppercase tracking-wider`,children:"Сфера:"}),s.jsx("button",{onClick:()=>y("all"),className:`px-3 py-1.5 rounded-full text-sm font-semibold border ${E==="all"?fe:Y}`,children:"Все"}),Object.keys(Fn).map(P=>s.jsx("button",{onClick:()=>y(E===P?"all":P),className:`px-3 py-1.5 rounded-full text-sm font-semibold border ${E===P?fe:Y}`,children:Fn[P].label},P))]}),s.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[s.jsx("span",{className:`text-xs ${X} uppercase tracking-wider`,children:"Риск:"}),["all","low","medium","high","ultra"].map(P=>s.jsx("button",{onClick:()=>k(P),className:`px-3 py-1.5 rounded-full text-sm font-semibold border ${w===P?fe:Y}`,children:P==="all"?"Все":P},P))]}),s.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[s.jsx("span",{className:`text-xs ${X} uppercase tracking-wider`,children:"Трейдер:"}),s.jsxs("select",{value:j,onChange:P=>N(P.target.value),className:`px-3 py-2 rounded-lg border ${R} ${r==="dark"?"bg-gray-800 text-white":"bg-gray-50 text-gray-900"} text-sm focus:outline-none focus:ring-2 focus:ring-emerald-500/50`,children:[s.jsx("option",{value:"all",children:"Все трейдеры"}),Se.map(P=>s.jsx("option",{value:P.id,children:P.name},P.id))]})]}),s.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:[pe("Всего сигналов",Ee.total,V),pe("Активных",Ee.active,"text-emerald-500"),pe("Завершено",Ee.completed,"text-blue-500"),pe("High risk",Ee.highRisk,"text-amber-500")]})]})}),i&&s.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-[70] flex items-start sm:items-center justify-center p-4 overflow-y-auto",children:s.jsx("div",{className:`${de} rounded-2xl shadow-2xl border ${R} max-w-3xl w-full max-h-[90vh] overflow-hidden`,children:s.jsxs("div",{className:"flex flex-col h-full",children:[s.jsxs("div",{className:`p-6 flex items-center justify-between sticky top-0 z-20 ${de} border-b ${R} shadow-sm`,children:[s.jsx("h2",{className:`text-2xl font-bold ${V}`,children:v?"Редактировать сигнал":"Создать сигнал"}),s.jsx("button",{onClick:oe,className:`p-2 rounded-xl ${r==="dark"?"hover:bg-gray-800":"hover:bg-gray-100"}`,children:s.jsx(Jt,{className:`w-5 h-5 ${X}`})})]}),s.jsx("div",{className:"px-6 pb-6 pt-2 overflow-y-auto flex-1 max-h-[75vh]",children:s.jsx(L_,{callToEdit:v,onSuccess:Z,onCancel:oe,initialCategory:C})})]})})}),c&&s.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-[70] flex items-start sm:items-center justify-center p-4 overflow-y-auto overscroll-contain",children:s.jsx("div",{className:`${de} rounded-2xl shadow-2xl border ${R} max-w-md w-full`,children:s.jsxs("div",{className:"p-6 space-y-4",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx(Rr,{className:"w-6 h-6 text-red-500"}),s.jsxs("div",{children:[s.jsx("h3",{className:`text-xl font-bold ${V}`,children:"Удалить сигнал?"}),s.jsx("p",{className:X,children:"Это действие нельзя отменить"})]})]}),s.jsxs("div",{className:"flex gap-3",children:[s.jsx("button",{onClick:()=>{d(!1),g(null)},className:`flex-1 px-4 py-3 rounded-xl border ${R} ${r==="dark"?"text-white":"text-gray-800"}`,children:"Отмена"}),s.jsx("button",{onClick:M,className:"flex-1 px-4 py-3 rounded-xl bg-red-600 text-white font-semibold hover:bg-red-700",children:"Удалить"})]})]})})}),x&&s.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-[70] flex items-start sm:items-center justify-center p-4 overflow-y-auto overscroll-contain",children:s.jsx("div",{className:`${de} rounded-2xl shadow-2xl border ${R} max-w-md w-full`,children:s.jsxs("div",{className:"p-6 space-y-4",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx(Rr,{className:"w-6 h-6 text-amber-500"}),s.jsxs("div",{children:[s.jsx("h3",{className:`text-xl font-bold ${V}`,children:"Отменить сигнал?"}),s.jsx("p",{className:X,children:"Статус станет «Отменен», запись останется в списке."})]})]}),s.jsxs("div",{className:"flex gap-3",children:[s.jsx("button",{onClick:()=>p(null),className:`flex-1 px-4 py-3 rounded-xl border ${R} ${r==="dark"?"text-white":"text-gray-800"}`,children:"Отмена"}),s.jsx("button",{onClick:re,className:"flex-1 px-4 py-3 rounded-xl bg-amber-500 text-white font-semibold hover:bg-amber-600",children:"Отменить"})]})]})})}),!i&&s.jsx(s.Fragment,{children:n?s.jsxs("div",{className:`${de} rounded-2xl p-12 text-center ${R} border shadow-xl`,children:[s.jsx("div",{className:"animate-spin rounded-full h-14 w-14 border-4 border-[#4E6E49] border-t-transparent mx-auto mb-4"}),s.jsx("p",{className:`${X} text-lg`,children:"Загрузка сигналов..."})]}):e.length===0?s.jsxs("div",{className:`${de} rounded-2xl p-12 text-center ${R} border shadow-xl`,children:[s.jsx(Yt,{className:`w-16 h-16 mx-auto mb-4 ${X}`}),s.jsx("p",{className:`text-xl font-bold ${V}`,children:"Пока пусто"}),s.jsx("p",{className:X,children:"Создайте первый сигнал в новой структуре"})]}):O.length===0?s.jsxs("div",{className:`${de} rounded-2xl p-12 text-center ${R} border shadow-xl`,children:[s.jsx(Yt,{className:`w-16 h-16 mx-auto mb-4 ${X}`}),s.jsx("p",{className:`text-xl font-bold ${V}`,children:"Нет совпадений"}),s.jsxs("p",{className:X,children:["Сигналы есть (",e.length,"), но фильтр ничего не нашел."]})]}):s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-5",children:O.map(P=>{const _=Fn[P.category],be=ti[P.status]||ti.active,Ne=B(P),Ie=W(P),ne=Se.find(rt=>rt.id===P.userId),we=Ie.ticker||Ie.pair||Ie.coin||ie(P),ke=new Date(P.createdAt).toLocaleDateString("ru-RU",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"}),$e=te[P.category];return s.jsxs("div",{className:`rounded-3xl border-2 shadow-xl overflow-hidden transition-all hover:-translate-y-1 ${$e.border} ${$e.bg}`,children:[s.jsxs("div",{className:`px-5 py-4 flex flex-wrap items-center justify-between gap-3 border-b ${r==="dark"?"border-white/10 bg-white/5":"border-white/70 bg-white/70"}`,children:[s.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[s.jsxs("span",{className:`flex items-center gap-2 px-3 py-1.5 rounded-full text-sm font-semibold border ${$e.border} ${$e.chipBg||""} ${$e.text}`,children:[_.icon,_.label]}),s.jsx("span",{className:`px-3 py-1.5 rounded-full text-xs font-semibold ${be.className}`,children:be.label}),s.jsxs("span",{className:`px-3 py-1.5 rounded-full text-xs font-semibold ${Ju[Ne]}`,children:["Риск: ",Ne]})]}),s.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[s.jsxs("div",{className:`px-3 py-1.5 rounded-xl text-xs font-semibold border ${r==="dark"?"bg-gray-800/70 text-gray-200 border-white/10":"bg-white text-gray-700 border-gray-200"}`,children:[s.jsx("span",{className:"opacity-70",children:"Создано "}),ke]}),ne&&s.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 rounded-xl border border-white/10 bg-black/5 dark:bg-white/5",children:[s.jsx("div",{className:"w-8 h-8 rounded-full bg-gradient-to-r from-[#4E6E49] to-emerald-600 text-white flex items-center justify-center text-sm font-bold",children:ne.name[0]}),s.jsx("span",{className:`text-xs ${X}`,children:ne.name})]}),s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx("button",{onClick:()=>F(P),className:`p-2 rounded-lg ${r==="dark"?"hover:bg-gray-800":"hover:bg-gray-100"}`,children:s.jsx(tr,{className:"w-4 h-4"})}),P.status!=="cancelled"&&s.jsx("button",{onClick:()=>p(P.id),className:`p-2 rounded-lg ${r==="dark"?"hover:bg-gray-800":"hover:bg-gray-100"}`,children:s.jsx(Jt,{className:"w-4 h-4 text-amber-500"})}),s.jsx("button",{onClick:()=>L(P.id),className:`p-2 rounded-lg ${r==="dark"?"hover:bg-gray-800":"hover:bg-gray-100"}`,children:s.jsx(Pt,{className:"w-4 h-4 text-red-500"})})]})]})]}),s.jsxs("div",{className:"p-5 space-y-5",children:[s.jsxs("div",{className:"grid md:grid-cols-[1.15fr_auto] gap-4 items-start",children:[s.jsxs("div",{className:"space-y-1",children:[s.jsx("p",{className:`text-2xl font-bold ${V}`,children:ie(P)}),s.jsx("p",{className:`text-sm ${X}`,children:Q(P)})]}),s.jsx("div",{className:"flex flex-wrap gap-2 justify-end",children:s.jsxs("button",{onClick:()=>me(we),className:`px-3 py-2 rounded-xl border ${R} ${r==="dark"?"hover:bg-gray-800 bg-white/5":"hover:bg-gray-100 bg-white"} text-sm font-semibold flex items-center gap-2`,children:[z===we?s.jsx(Rs,{className:"w-4 h-4 text-emerald-500"}):s.jsx(gi,{className:"w-4 h-4"}),z===we?"Скопировано":"Скопировать"]})})]}),Ue(P)]})]},P.id)})})})]})})},W_=({selectedUserId:r,slotFilter:e,onEditSlot:t,onEditStatus:n,refreshKey:a})=>{const{theme:i}=it(),{user:o}=kt(),{isAdmin:c}=Tt(),[d,h]=D.useState([]),[g,x]=D.useState([]),[p,v]=D.useState(new Date),[A,C]=D.useState(!0),T=ce(new Date,"yyyy-MM-dd"),z={1:"Dex",2:"Enowk",3:"Xenia",4:"Olenka",5:"Sydney"},$={artyom:"1",adel:"2",kseniya:"3",olga:"4",anastasia:"5"},S=R=>{const te=Se.find(Z=>Z.id===R)||Se.find(Z=>$[R]===Z.id);return z[(te==null?void 0:te.id)||R]||(te==null?void 0:te.name)||R},I=kc(p),H=r?Se.filter(R=>R.id===r):Se;D.useEffect(()=>{G()},[r,p,a]),D.useEffect(()=>{const R=()=>{G()};return window.addEventListener("focus",R),()=>window.removeEventListener("focus",R)},[]);const G=async()=>{C(!0);try{const R=new Date(I[0]);R.setHours(0,0,0,0);const te=new Date(I[6]);te.setHours(23,59,59,999);const Z=ce(R,"yyyy-MM-dd"),oe=ce(te,"yyyy-MM-dd"),[F,L]=await Promise.all([Kr(),yr()]),M=F.filter(ie=>ie.date>=Z&&ie.date<=oe),re=L.filter(ie=>{const Q=ie.date,B=ie.endDate||ie.date;return Q<=oe&&B>=Z}),me=r?M.filter(ie=>ie.userId===r):M,W=r?re.filter(ie=>ie.userId===r):re;console.log("Loaded slots:",{weekStart:Z,weekEnd:oe,allSlotsCount:F.length,weekSlotsCount:M.length,filteredSlotsCount:me.length,selectedUserId:r}),h(me),x(W)}catch(R){console.error("Error loading data:",R)}finally{C(!1)}},E=async R=>{if(!c&&(o==null?void 0:o.id)!==R.userId){alert("Только администратор может удалять чужие слоты");return}if(c){confirm("Удалить слот?")&&(await oo(R.id),G());return}confirm("Отправить на согласование удаление слота?")&&(await bt({entity:"slot",action:"delete",authorId:(o==null?void 0:o.id)||R.userId,targetUserId:R.userId,before:R,after:null,comment:R.comment}),G())},y=async(R,te)=>{if(!c&&(o==null?void 0:o.id)!==R.userId){alert("Только администратор может удалять чужие статусы");return}if(R.endDate&&te){const Z=R.date,oe=R.endDate;if(te===Z){if(confirm(c?"Удалить первый день диапазона?":"Отправить на согласование удаление первого дня диапазона?")){const F=new Date(Z+"T00:00:00");F.setDate(F.getDate()+1);const L=ce(F,"yyyy-MM-dd");c?await gs(R.id,{...R,date:L}):await bt({entity:"status",action:"update",authorId:(o==null?void 0:o.id)||R.userId,targetUserId:R.userId,before:R,after:{...R,date:L},comment:R.comment}),G()}return}if(te===oe){if(confirm(c?"Удалить последний день диапазона?":"Отправить на согласование удаление последнего дня диапазона?")){const F=new Date(oe+"T00:00:00");F.setDate(F.getDate()-1);const L=ce(F,"yyyy-MM-dd");c?await gs(R.id,{...R,endDate:L}):await bt({entity:"status",action:"update",authorId:(o==null?void 0:o.id)||R.userId,targetUserId:R.userId,before:R,after:{...R,endDate:L},comment:R.comment}),G()}return}if(te>Z&&te<oe){if(confirm(c?"Удалить этот день? Диапазон будет разбит на две части.":"Отправить на согласование удаление этого дня? Диапазон будет разбит на две части.")){const F=new Date(te+"T00:00:00");F.setDate(F.getDate()-1);const L=ce(F,"yyyy-MM-dd");if(c){await gs(R.id,{...R,endDate:L});const M=new Date(te+"T00:00:00");M.setDate(M.getDate()+1);const re=ce(M,"yyyy-MM-dd");await lo({userId:R.userId,date:re,endDate:oe,type:R.type,comment:R.comment})}else{await bt({entity:"status",action:"update",authorId:(o==null?void 0:o.id)||R.userId,targetUserId:R.userId,before:R,after:{...R,endDate:L},comment:R.comment});const M=new Date(te+"T00:00:00");M.setDate(M.getDate()+1);const re=ce(M,"yyyy-MM-dd");await bt({entity:"status",action:"create",authorId:(o==null?void 0:o.id)||R.userId,targetUserId:R.userId,before:null,after:{id:"",userId:R.userId,date:re,endDate:oe,type:R.type,comment:R.comment},comment:R.comment})}G()}return}}c?confirm("Удалить статус?")&&(await co(R.id),G()):confirm("Отправить на согласование удаление статуса?")&&(await bt({entity:"status",action:"delete",authorId:(o==null?void 0:o.id)||R.userId,targetUserId:R.userId,before:R,after:null,comment:R.comment}),G())},w=R=>{const te=new Date;te.setHours(0,0,0,0);const Z=new Date(R.date);if(Z.setHours(0,0,0,0),Z>te)return!0;if(Z.getTime()===te.getTime()){const F=new Date,L=F.getHours()*60+F.getMinutes();return R.slots.some(M=>{if(M.endDate){const ie=new Date(M.endDate);if(ie.setHours(0,0,0,0),new Date(te).setHours(23,59,59),ie>te)return!0;if(ie.getTime()===te.getTime()){const[B,ue]=M.end.split(":").map(Number);return B*60+ue>L}return!1}const[re,me]=M.end.split(":").map(Number);return re*60+me>L})}return R.slots.some(F=>{if(F.endDate){const L=new Date(F.endDate);return L.setHours(0,0,0,0),L>=te}return!1})},k=(R,te)=>{const Z=d.find(oe=>oe.userId===R&&oe.date===te)||null;if(Z&&e!=="all"){const oe=w(Z);if(e==="upcoming"&&!oe||e==="completed"&&oe)return null}return Z},j=(R,te)=>g.find(Z=>Z.userId!==R?!1:Z.endDate?Z.date<=te&&Z.endDate>=te:Z.date===te)||null,N=R=>{const Z=d.filter(re=>re.userId===R).reduce((re,me)=>re+ho(me.slots),0),oe=g.filter(re=>re.userId===R),F=oe.filter(re=>re.type==="dayoff").length,L=oe.filter(re=>re.type==="sick").length,M=oe.filter(re=>re.type==="vacation").length;return{totalHours:Z,daysOff:F,sickDays:L,vacationDays:M}},f=R=>{const te=new Date(p);R==="prev"?te.setDate(te.getDate()-7):te.setDate(te.getDate()+7),v(te)};if(A)return s.jsx("div",{className:`rounded-lg p-8 text-center ${i==="dark"?"bg-[#1a1a1a]":"bg-white"}`,children:s.jsx("p",{className:i==="dark"?"text-gray-400":"text-gray-600",children:"Загрузка..."})});const de=i==="dark"?"text-white":"text-gray-900",V=i==="dark"?"text-gray-300":"text-gray-600",X={dayoff:"bg-amber-50 text-amber-900 border border-amber-200 shadow-inner dark:bg-amber-900/30 dark:text-amber-50 dark:border-amber-700",sick:"bg-orange-50 text-orange-900 border border-orange-200 shadow-inner dark:bg-orange-900/30 dark:text-orange-50 dark:border-orange-700",vacation:"bg-sky-50 text-sky-900 border border-sky-200 shadow-inner dark:bg-sky-900/30 dark:text-sky-50 dark:border-sky-700"};return s.jsxs("div",{className:`rounded-lg ${i==="dark"?"bg-[#1a1a1a]":"bg-white"} shadow-md overflow-hidden`,children:[s.jsxs("div",{className:`p-4 border-b ${i==="dark"?"border-gray-800":"border-gray-200"} flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between`,children:[s.jsxs("button",{onClick:()=>f("prev"),className:`w-full sm:w-auto px-3 py-2 text-sm sm:text-base rounded-lg transition-colors flex items-center justify-center gap-2 whitespace-nowrap ${i==="dark"?"border border-gray-700 bg-gray-900/60 hover:border-[#4E6E49]/50 hover:bg-gray-900":"border border-gray-200 bg-white hover:border-[#4E6E49]/40 hover:bg-gray-50"}`,children:[s.jsx("span",{children:"←"}),s.jsx("span",{children:"Предыдущая неделя"})]}),s.jsxs("span",{className:`${de} font-semibold text-center text-sm sm:text-base whitespace-nowrap`,children:[ce(I[0],"dd.MM.yyyy")," - ",ce(I[6],"dd.MM.yyyy")]}),s.jsxs("button",{onClick:()=>f("next"),className:`w-full sm:w-auto px-3 py-2 text-sm sm:text-base rounded-lg transition-colors flex items-center justify-center gap-2 whitespace-nowrap ${i==="dark"?"border border-gray-700 bg-gray-900/60 hover:border-[#4E6E49]/50 hover:bg-gray-900":"border border-gray-200 bg-white hover:border-[#4E6E49]/40 hover:bg-gray-50"}`,children:[s.jsx("span",{children:"Следующая неделя"}),s.jsx("span",{children:"→"})]})]}),s.jsx("div",{className:"overflow-x-auto -mx-3 sm:-mx-4 md:-mx-6 lg:-mx-8 px-3 sm:px-4 md:px-6 lg:px-8",children:s.jsx("div",{className:"min-w-full inline-block align-middle",children:s.jsxs("table",{className:"w-full",children:[s.jsx("thead",{className:"sticky top-0 z-30",children:s.jsxs("tr",{className:`${i==="dark"?"bg-[#0f172a]":"bg-gray-50"} shadow-sm`,children:[s.jsx("th",{className:`px-2 sm:px-3 md:px-4 py-3 text-left text-xs sm:text-sm font-semibold ${de} sticky left-0 z-30 ${i==="dark"?"bg-[#0f172a]":"bg-gray-50"}`,children:"Members"}),I.map(R=>s.jsx("th",{className:"px-1.5 sm:px-2 md:px-3 lg:px-4 py-3",children:s.jsxs("div",{className:`mx-auto w-full max-w-[110px] rounded-xl border ${i==="dark"?"border-white/10 bg-white/5 text-white":"border-gray-200 bg-white text-gray-900"} shadow-sm text-center`,children:[s.jsx("div",{className:"text-[10px] sm:text-xs opacity-70",children:ce(R,"EEE")}),s.jsx("div",{className:"text-sm font-semibold",children:ce(R,"dd.MM")})]})},R.toISOString())),s.jsx("th",{className:`px-2 sm:px-3 md:px-4 py-3 text-center text-xs sm:text-sm font-bold ${de} whitespace-nowrap`,children:"Итог"})]})}),s.jsx("tbody",{children:H.map((R,te)=>{const Z=N(R.id),oe=te%2===0;return s.jsxs("tr",{className:`
                    group border-b transition-all duration-300 relative
                    ${i==="dark"?"border-gray-800/30":"border-gray-200/30"}
                    ${oe?i==="dark"?"bg-gradient-to-r from-[#1a1a1a]/40 via-[#1a1a1a]/20 to-transparent hover:from-[#1a1a1a]/70 hover:via-[#1a1a1a]/50 hover:shadow-lg hover:shadow-#4E6E49/10":"bg-gradient-to-r from-gray-50/70 via-gray-50/40 to-transparent hover:from-gray-100/90 hover:via-gray-100/70 hover:shadow-lg hover:shadow-#4E6E49/5":i==="dark"?"bg-gradient-to-r from-[#1a1a1a]/10 via-[#1a1a1a]/5 to-transparent hover:from-[#1a1a1a]/50 hover:via-[#1a1a1a]/30 hover:shadow-lg hover:shadow-#4E6E49/10":"bg-gradient-to-r from-white via-gray-50/30 to-transparent hover:from-gray-50 hover:via-gray-50/60 hover:shadow-lg hover:shadow-#4E6E49/5"}
                    hover:scale-[1.01] hover:-translate-y-0.5
                  `,children:[s.jsx("td",{className:`px-2 sm:px-3 md:px-4 py-2 sm:py-3 md:py-4 font-semibold text-xs sm:text-sm ${de} sticky left-0 z-10 transition-all duration-300 backdrop-blur-sm min-w-[120px] sm:min-w-[140px] ${oe?i==="dark"?"bg-gradient-to-r from-[#1a1a1a]/40 via-[#1a1a1a]/20 to-transparent group-hover:from-[#1a1a1a]/70 group-hover:via-[#1a1a1a]/50":"bg-gradient-to-r from-gray-50/70 via-gray-50/40 to-transparent group-hover:from-gray-100/90 group-hover:via-gray-100/70":i==="dark"?"bg-gradient-to-r from-[#1a1a1a]/10 via-[#1a1a1a]/5 to-transparent group-hover:from-[#1a1a1a]/50 group-hover:via-[#1a1a1a]/30":"bg-gradient-to-r from-white via-gray-50/30 to-transparent group-hover:from-gray-50 group-hover:via-gray-50/60"}`,children:s.jsxs("div",{className:"flex items-center gap-2 sm:gap-3",children:[s.jsxs("div",{className:"relative flex-shrink-0 group/avatar",children:[R.avatar?s.jsx("img",{src:R.avatar,alt:S(R.id),className:"w-8 h-8 sm:w-10 sm:h-10 md:w-11 md:h-11 rounded-full object-cover border-2 shadow-lg transition-all duration-300 group-hover:scale-110 group-hover:shadow-xl group-hover:shadow-#4E6E49/30 ring-2 ring-transparent group-hover:ring-#4E6E49/50",style:{borderColor:i==="dark"?"rgba(34, 197, 94, 0.6)":"rgba(34, 197, 94, 0.4)"},onError:F=>{const L=F.target;L.style.display="none";const M=L.nextElementSibling;M&&(M.style.display="flex")}}):null,s.jsx("div",{className:`w-8 h-8 sm:w-10 sm:h-10 md:w-11 md:h-11 rounded-full flex items-center justify-center font-bold text-xs sm:text-sm transition-all duration-300 shadow-lg ring-2 ring-transparent group-hover/avatar:scale-110 group-hover/avatar:shadow-xl group-hover/avatar:ring-#4E6E49/50 ${i==="dark"?"bg-gradient-to-br from-[#4E6E49] via-[#4E6E49] to-blue-500 text-white group-hover/avatar:shadow-#4E6E49/40":"bg-gradient-to-br from-[#4E6E49] via-[#4E6E49] to-blue-400 text-white group-hover/avatar:shadow-#4E6E49/40"} ${R.avatar?"absolute inset-0 hidden":""}`,children:S(R.id).charAt(0).toUpperCase()}),s.jsx("div",{className:"absolute -bottom-0.5 -right-0.5 w-2.5 h-2.5 sm:w-3 sm:h-3 md:w-3.5 md:h-3.5 bg-[#4E6E49] rounded-full border border-white sm:border-2 shadow-lg animate-pulse opacity-0 group-hover/avatar:opacity-100 transition-opacity duration-300"})]}),s.jsx("span",{className:"font-semibold group-hover:text-[#4E6E49] transition-colors duration-300 truncate hidden sm:inline",children:S(R.id)}),s.jsx("span",{className:"font-semibold group-hover:text-[#4E6E49] transition-colors duration-300 sm:hidden",children:(S(R.id).split(" ")[0]||S(R.id)).substring(0,8)})]})}),I.map(F=>{const L=ce(F,"yyyy-MM-dd"),M=k(R.id,L),re=j(R.id,L);return s.jsx("td",{className:`px-1 sm:px-2 py-2 sm:py-3 text-center border-l border-r border-transparent hover:border-blue-500/20 transition-colors min-w-[80px] sm:min-w-[100px] ${L===T?"bg-emerald-50 dark:bg-emerald-900/20 ring-1 ring-emerald-300/70 dark:ring-emerald-500/40":""}`,children:M?s.jsxs("div",{className:"space-y-2",children:[(()=>{const me=w(M),W=me?"bg-gradient-to-r from-emerald-500 to-teal-600":"bg-gradient-to-r from-slate-500 to-slate-700",Q=me?Ur:Ds;return M.slots.map((B,ue)=>s.jsxs("div",{className:"space-y-1",children:[s.jsx("div",{className:`${W} text-white rounded-md sm:rounded-lg px-2 sm:px-3 py-1 sm:py-1.5 text-[10px] sm:text-xs font-semibold shadow-lg transition-all duration-300 hover:scale-105 hover:shadow-xl ${me?"hover:shadow-emerald-500/40 ring-2 ring-emerald-400/40":"hover:shadow-slate-500/40 ring-2 ring-slate-400/40"}`,children:s.jsxs("div",{className:"flex items-center justify-center gap-0.5 sm:gap-1 flex-wrap",children:[s.jsx(Q,{className:"w-2.5 h-2.5 sm:w-3 sm:h-3 animate-pulse flex-shrink-0"}),s.jsxs("span",{className:"whitespace-nowrap",children:[B.start," - ",B.end]}),B.endDate&&s.jsxs("span",{className:"text-[9px] sm:text-[10px] opacity-90 whitespace-nowrap",children:["(до ",ce(new Date(B.endDate),"dd.MM"),")"]})]})}),B.breaks&&B.breaks.length>0&&s.jsxs("div",{className:"space-y-1",children:[s.jsx("div",{className:`text-[10px] ${i==="dark"?"text-gray-400":"text-gray-600"} font-medium`,children:"Перерывы:"}),B.breaks.map((O,ge)=>s.jsx("div",{className:`${i==="dark"?"bg-gray-700/90":"bg-white"} ${i==="dark"?"text-gray-200":"text-gray-900"} border-2 ${i==="dark"?"border-orange-500/50":"border-orange-300"} rounded-md sm:rounded-lg px-1.5 sm:px-2 py-0.5 sm:py-1 text-[9px] sm:text-[10px] font-medium shadow-md transition-all duration-300 hover:scale-105 hover:shadow-lg ${i==="dark"?"hover:border-orange-400/70 hover:shadow-orange-500/20":"hover:border-orange-400 hover:shadow-orange-400/20"}`,children:s.jsxs("span",{className:"flex items-center gap-0.5 sm:gap-1 justify-center flex-wrap",children:[s.jsx("span",{className:"w-0.5 h-0.5 sm:w-1 sm:h-1 rounded-full bg-orange-500 flex-shrink-0"}),s.jsxs("span",{className:"whitespace-nowrap",children:[O.start," - ",O.end]})]})},ge))]})]},ue))})(),s.jsx("div",{className:"flex gap-1 justify-center",children:c||(R==null?void 0:R.id)===M.userId?s.jsxs(s.Fragment,{children:[s.jsx("button",{onClick:()=>t(M),className:"p-1 text-blue-500 hover:bg-blue-500 hover:text-white rounded",children:s.jsx(tr,{className:"w-3 h-3"})}),s.jsx("button",{onClick:()=>E(M),className:"p-1 text-red-500 hover:bg-red-500 hover:text-white rounded",children:s.jsx(Pt,{className:"w-3 h-3"})})]}):s.jsxs(s.Fragment,{children:[s.jsx("button",{disabled:!0,className:"p-1 text-gray-400 cursor-not-allowed rounded",title:"Вы можете редактировать только свои слоты",children:s.jsx(tr,{className:"w-3 h-3"})}),s.jsx("button",{disabled:!0,className:"p-1 text-gray-400 cursor-not-allowed rounded",title:"Вы можете удалять только свои слоты",children:s.jsx(Pt,{className:"w-3 h-3"})})]})})]}):re?s.jsxs("div",{className:"space-y-1",children:[s.jsx("div",{className:`rounded-lg px-3 py-2 text-xs font-semibold ring-1 ring-inset ring-black/5 dark:ring-white/10 ${X[re.type]}`,children:re.type==="dayoff"?"Выходной":re.type==="sick"?"Больничный":"Отпуск"}),s.jsx("div",{className:"flex gap-1 justify-center",children:c||(R==null?void 0:R.id)===re.userId?s.jsxs(s.Fragment,{children:[s.jsx("button",{onClick:()=>n(re),className:"p-1 text-blue-500 hover:bg-blue-500 hover:text-white rounded",children:s.jsx(tr,{className:"w-3 h-3"})}),s.jsx("button",{onClick:()=>y(re,L),className:"p-1 text-red-500 hover:bg-red-500 hover:text-white rounded",children:s.jsx(Pt,{className:"w-3 h-3"})})]}):s.jsxs(s.Fragment,{children:[s.jsx("button",{disabled:!0,className:"p-1 text-gray-400 cursor-not-allowed rounded",title:"Вы можете редактировать только свои статусы",children:s.jsx(tr,{className:"w-3 h-3"})}),s.jsx("button",{disabled:!0,className:"p-1 text-gray-400 cursor-not-allowed rounded",title:"Вы можете удалять только свои статусы",children:s.jsx(Pt,{className:"w-3 h-3"})})]})})]}):s.jsx("span",{className:`text-sm ${V}`,children:"—"})},L)}),s.jsx("td",{className:`px-4 py-3 text-sm ${de} text-center`,children:s.jsxs("div",{className:"space-y-1",children:[s.jsxs("div",{children:["Часов: ",Z.totalHours.toFixed(1)]}),s.jsxs("div",{children:["Выходных: ",Z.daysOff]}),s.jsxs("div",{children:["Больничных: ",Z.sickDays]}),s.jsxs("div",{children:["Отпусков: ",Z.vacationDays]})]})})]},R.id)})})]})})})]})},q_=({selectedUserId:r,slotFilter:e,onEditSlot:t,onEditStatus:n,refreshKey:a})=>{const{theme:i}=it(),{user:o}=kt(),{isAdmin:c}=Tt(),[d,h]=D.useState([]),[g,x]=D.useState([]),[p,v]=D.useState(new Date),[A,C]=D.useState(!0),T={1:"Dex",2:"Enowk",3:"Xenia",4:"Olenka",5:"Sydney"},z={artyom:"1",adel:"2",kseniya:"3",olga:"4",anastasia:"5"},$=V=>{const X=Se.find(R=>R.id===V)||Se.find(R=>z[V]===R.id);return{member:X,displayName:T[(X==null?void 0:X.id)||V]||(X==null?void 0:X.name)||V}},S=kc(p),I=new Date;D.useEffect(()=>{H()},[r,p,a]),D.useEffect(()=>{const V=()=>{H()};return window.addEventListener("focus",V),()=>window.removeEventListener("focus",V)},[]);const H=async()=>{C(!0);try{const V=new Date(S[0]);V.setHours(0,0,0,0);const X=new Date(S[6]);X.setHours(23,59,59,999);const R=ce(V,"yyyy-MM-dd"),te=ce(X,"yyyy-MM-dd"),[Z,oe]=await Promise.all([Kr(),yr()]),F=Z.filter(me=>me.date>=R&&me.date<=te),L=oe.filter(me=>{const W=me.date,ie=me.endDate||me.date;return W<=te&&ie>=R}),M=r?F.filter(me=>me.userId===r):F,re=r?L.filter(me=>me.userId===r):L;console.log("Loaded slots (week view):",{weekStart:R,weekEnd:te,allSlotsCount:Z.length,weekSlotsCount:F.length,filteredSlotsCount:M.length,selectedUserId:r}),h(M),x(re)}catch(V){console.error("Error loading data:",V)}finally{C(!1)}},G=async V=>{if(!c&&(o==null?void 0:o.id)!==V.userId){alert("Только администратор может удалять чужие слоты");return}if(c){confirm("Удалить слот?")&&(await oo(V.id),H());return}confirm("Отправить на согласование удаление слота?")&&(await bt({entity:"slot",action:"delete",authorId:(o==null?void 0:o.id)||V.userId,targetUserId:V.userId,before:V,after:null,comment:V.comment}),H())},E=async(V,X)=>{if(!c&&(o==null?void 0:o.id)!==V.userId){alert("Только администратор может удалять чужие статусы");return}if(V.endDate&&X){const R=V.date,te=V.endDate;if(X===R){if(confirm(c?"Удалить первый день диапазона?":"Отправить на согласование удаление первого дня диапазона?")){const Z=new Date(or(R));Z.setDate(Z.getDate()+1);const oe=ce(Z,"yyyy-MM-dd");c?await gs(V.id,{...V,date:oe}):await bt({entity:"status",action:"update",authorId:(o==null?void 0:o.id)||V.userId,targetUserId:V.userId,before:V,after:{...V,date:oe},comment:V.comment}),H()}return}if(X===te){if(confirm(c?"Удалить последний день диапазона?":"Отправить на согласование удаление последнего дня диапазона?")){const Z=new Date(or(te));Z.setDate(Z.getDate()-1);const oe=ce(Z,"yyyy-MM-dd");c?await gs(V.id,{...V,endDate:oe}):await bt({entity:"status",action:"update",authorId:(o==null?void 0:o.id)||V.userId,targetUserId:V.userId,before:V,after:{...V,endDate:oe},comment:V.comment}),H()}return}if(X>R&&X<te){if(confirm(c?"Удалить этот день? Диапазон будет разбит на две части.":"Отправить на согласование удаление этого дня? Диапазон будет разбит на две части.")){const Z=new Date(or(X));Z.setDate(Z.getDate()-1);const oe=ce(Z,"yyyy-MM-dd");if(c){await gs(V.id,{...V,endDate:oe});const F=new Date(or(X));F.setDate(F.getDate()+1);const L=ce(F,"yyyy-MM-dd");await lo({userId:V.userId,date:L,endDate:te,type:V.type,comment:V.comment})}else{await bt({entity:"status",action:"update",authorId:(o==null?void 0:o.id)||V.userId,targetUserId:V.userId,before:V,after:{...V,endDate:oe},comment:V.comment});const F=new Date(or(X));F.setDate(F.getDate()+1);const L=ce(F,"yyyy-MM-dd");await bt({entity:"status",action:"create",authorId:(o==null?void 0:o.id)||V.userId,targetUserId:V.userId,before:null,after:{id:"",userId:V.userId,date:L,endDate:te,type:V.type,comment:V.comment},comment:V.comment})}H()}return}}c?confirm("Удалить статус?")&&(await co(V.id),H()):confirm("Отправить на согласование удаление статуса?")&&(await bt({entity:"status",action:"delete",authorId:(o==null?void 0:o.id)||V.userId,targetUserId:V.userId,before:V,after:null,comment:V.comment}),H())},y=V=>{const X=new Date;X.setHours(0,0,0,0);const R=new Date(V.date);if(R.setHours(0,0,0,0),R>X)return!0;if(R.getTime()===X.getTime()){const Z=new Date,oe=Z.getHours()*60+Z.getMinutes();return V.slots.some(F=>{if(F.endDate){const me=new Date(F.endDate);if(me.setHours(0,0,0,0),new Date(X).setHours(23,59,59),me>X)return!0;if(me.getTime()===X.getTime()){const[ie,Q]=F.end.split(":").map(Number);return ie*60+Q>oe}return!1}const[L,M]=F.end.split(":").map(Number);return L*60+M>oe})}return V.slots.some(Z=>{if(Z.endDate){const oe=new Date(Z.endDate);return oe.setHours(0,0,0,0),oe>=X}return!1})},w=V=>{let X=d.filter(R=>R.date===V);return e!=="all"&&(X=X.filter(R=>{const te=y(R);return e==="upcoming"?te:e==="completed"?!te:!0})),X},k=V=>g.filter(X=>X.endDate?X.date<=V&&X.endDate>=V:X.date===V),j=V=>{const X=new Date(p);V==="prev"?X.setDate(X.getDate()-7):X.setDate(X.getDate()+7),v(X)};if(A)return s.jsx("div",{className:`rounded-lg p-8 text-center ${i==="dark"?"bg-[#1a1a1a]":"bg-white"}`,children:s.jsx("p",{className:i==="dark"?"text-gray-400":"text-gray-600",children:"Загрузка..."})});const N=i==="dark"?"text-white":"text-gray-900",f=i==="dark"?"text-gray-400":"text-gray-600",de={dayoff:"bg-amber-50 text-amber-900 border border-amber-200 shadow-inner dark:bg-amber-900/25 dark:text-amber-50 dark:border-amber-700",sick:"bg-orange-50 text-orange-900 border border-orange-200 shadow-inner dark:bg-orange-900/25 dark:text-orange-50 dark:border-orange-700",vacation:"bg-sky-50 text-sky-900 border border-sky-200 shadow-inner dark:bg-sky-900/25 dark:text-sky-50 dark:border-sky-700"};return s.jsxs("div",{className:`rounded-lg ${i==="dark"?"bg-[#1a1a1a]":"bg-white"} shadow-md overflow-hidden`,children:[s.jsxs("div",{className:`p-3 sm:p-4 border-b ${i==="dark"?"border-gray-800":"border-gray-200"} flex flex-col gap-2 sm:gap-3 sm:flex-row sm:items-center sm:justify-between`,children:[s.jsxs("button",{onClick:()=>j("prev"),className:`w-full sm:w-auto px-3 sm:px-4 py-2 text-xs sm:text-sm md:text-base rounded-lg transition-colors touch-manipulation active:scale-95 flex items-center justify-center gap-2 whitespace-nowrap ${i==="dark"?"border border-gray-700 bg-gray-900/60 hover:border-[#4E6E49]/50 hover:bg-gray-900":"border border-gray-200 bg-white hover:border-[#4E6E49]/40 hover:bg-gray-50"}`,children:[s.jsx("span",{children:"←"}),s.jsx("span",{children:"Предыдущая неделя"})]}),s.jsxs("span",{className:`${N} font-semibold text-center text-xs sm:text-sm md:text-base whitespace-nowrap`,children:[ce(S[0],"dd.MM.yyyy")," - ",ce(S[6],"dd.MM.yyyy")]}),s.jsxs("button",{onClick:()=>j("next"),className:`w-full sm:w-auto px-3 sm:px-4 py-2 text-xs sm:text-sm md:text-base rounded-lg transition-colors touch-manipulation active:scale-95 flex items-center justify-center gap-2 whitespace-nowrap ${i==="dark"?"border border-gray-700 bg-gray-900/60 hover:border-[#4E6E49]/50 hover:bg-gray-900":"border border-gray-200 bg-white hover:border-[#4E6E49]/40 hover:bg-gray-50"}`,children:[s.jsx("span",{children:"Следующая неделя"}),s.jsx("span",{children:"→"})]})]}),s.jsx("div",{className:"p-3 sm:p-4 space-y-3 sm:space-y-4",children:S.map(V=>{const X=ce(V,"yyyy-MM-dd"),R=w(X),te=k(X),Z=i0(V,I),oe="relative rounded-xl p-4 sm:p-5 border transition-all duration-300",F=i==="dark"?"bg-gray-800/70 border-gray-700 shadow-md":"bg-gray-50 border-gray-200 shadow-sm",L=i==="dark"?"border-emerald-500/70 bg-gradient-to-br from-emerald-900/30 via-gray-800 to-gray-900/80 ring-2 ring-emerald-400/40 shadow-[0_20px_40px_-24px_rgba(52,211,153,0.8)]":"border-emerald-300 bg-gradient-to-br from-emerald-50 via-white to-green-50 ring-2 ring-emerald-200/70 shadow-[0_20px_40px_-24px_rgba(52,211,153,0.6)]";return s.jsxs("div",{className:`${oe} ${F} ${Z?L:""}`,children:[Z&&s.jsxs("div",{className:"absolute top-3 right-3 inline-flex items-center gap-2 px-3 py-1 rounded-full bg-emerald-500 text-white text-xs font-semibold shadow-lg ring-2 ring-white/50 dark:ring-emerald-200/30",children:[s.jsx("span",{className:"w-2 h-2 rounded-full bg-white animate-ping"}),s.jsx("span",{className:"relative",children:"Сегодня"})]}),s.jsx("h3",{className:`text-lg font-semibold mb-3 ${N}`,children:ce(V,"dd.MM.yyyy")}),s.jsxs("div",{className:"space-y-3 sm:space-y-4",children:[te.map(M=>{const{displayName:re}=$(M.userId);return s.jsxs("div",{className:`relative flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 p-4 rounded-2xl border-2 transition-all duration-300 hover:shadow-xl backdrop-blur text-center sm:text-left ring-1 ring-inset ring-black/5 dark:ring-white/5 ${de[M.type]}`,children:[s.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2 justify-center sm:justify-start w-full",children:[s.jsx("span",{className:"font-semibold text-base sm:text-lg",children:re}),s.jsx("span",{className:"inline-flex items-center gap-2 px-3 py-1 rounded-full bg-white/70 dark:bg-white/10 text-xs sm:text-sm font-semibold",children:M.type==="dayoff"?"Выходной":M.type==="sick"?"Больничный":"Отпуск"})]}),s.jsx("div",{className:"flex gap-2 justify-center sm:justify-end w-full",children:c||(o==null?void 0:o.id)===M.userId?s.jsxs(s.Fragment,{children:[s.jsx("button",{onClick:()=>n(M),className:`p-1 rounded transition-colors ${i==="dark"?"bg-white/10 hover:bg-white/20 text-white":"bg-white border border-gray-200 text-gray-700 hover:bg-gray-100"}`,children:s.jsx(tr,{className:"w-4 h-4 text-current"})}),s.jsx("button",{onClick:()=>E(M,X),className:`p-1 rounded transition-colors ${i==="dark"?"bg-white/10 hover:bg-white/20 text-white":"bg-white border border-gray-200 text-gray-700 hover:bg-gray-100"}`,children:s.jsx(Pt,{className:"w-4 h-4 text-current"})})]}):s.jsxs(s.Fragment,{children:[s.jsx("button",{disabled:!0,className:`p-1 cursor-not-allowed rounded ${i==="dark"?"bg-white/5 text-white/60":"bg-gray-100 text-gray-400 border border-gray-200"}`,title:"Вы можете редактировать только свои статусы",children:s.jsx(tr,{className:"w-4 h-4 text-current opacity-60"})}),s.jsx("button",{disabled:!0,className:`p-1 cursor-not-allowed rounded ${i==="dark"?"bg-white/5 text-white/60":"bg-gray-100 text-gray-400 border border-gray-200"}`,title:"Вы можете удалять только свои статусы",children:s.jsx(Pt,{className:"w-4 h-4 text-current opacity-60"})})]})})]},M.id)}),R.map(M=>{const{member:re,displayName:me}=$(M.userId),W=y(M),ie=W?"bg-gradient-to-r from-emerald-500 to-teal-600 border-emerald-300/40":"bg-gradient-to-r from-slate-500 to-slate-700 border-slate-300/40",Q=W?Ur:Ds;return s.jsxs("div",{className:`group relative space-y-2 sm:space-y-3 p-3 sm:p-4 ${ie} rounded-lg sm:rounded-xl shadow-xl border-2 transition-all duration-300 hover:shadow-2xl active:scale-[0.98] sm:hover:scale-[1.03] mb-2 sm:mb-3 ${W?"hover:border-emerald-200/80 ring-2 ring-emerald-200/40 hover:ring-4 hover:ring-emerald-200/60":"hover:border-slate-200/80 ring-2 ring-slate-200/40 hover:ring-4 hover:ring-slate-200/60"}`,children:[s.jsxs("div",{className:"flex items-center justify-between border-b border-white/20 pb-2 sm:pb-3",children:[s.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 min-w-0 flex-1",children:[s.jsxs("div",{className:"relative flex-shrink-0 group/avatar",children:[re!=null&&re.avatar?s.jsx("img",{src:re.avatar,alt:me,className:`w-8 h-8 sm:w-9 sm:h-9 md:w-10 md:h-10 lg:w-11 lg:h-11 rounded-full object-cover border-2 shadow-xl transition-all duration-300 group-hover/avatar:scale-110 group-hover/avatar:shadow-2xl ${W?"border-white/50 ring-2 ring-white/40 ring-offset-2 ring-offset-emerald-400/30 group-hover/avatar:ring-4 group-hover/avatar:ring-white/60":"border-white/40 ring-2 ring-white/30 ring-offset-2 ring-offset-slate-400/30 group-hover/avatar:ring-4 group-hover/avatar:ring-white/50"}`,onError:B=>{const ue=B.target;ue.style.display="none";const O=ue.nextElementSibling;O&&(O.style.display="flex")}}):null,s.jsx("div",{className:`w-8 h-8 sm:w-9 sm:h-9 md:w-10 md:h-10 lg:w-11 lg:h-11 rounded-full flex items-center justify-center font-bold text-xs sm:text-sm transition-all duration-300 shadow-xl group-hover/avatar:scale-110 group-hover/avatar:shadow-2xl ${W?"bg-white/25 backdrop-blur-md border-2 border-white/40 ring-2 ring-white/30 group-hover/avatar:ring-4 group-hover/avatar:ring-white/60":"bg-white/15 backdrop-blur-md border-2 border-white/30 ring-2 ring-white/20 group-hover/avatar:ring-4 group-hover/avatar:ring-white/50"} ${re!=null&&re.avatar?"absolute inset-0 hidden":""}`,children:me.charAt(0).toUpperCase()}),s.jsx("div",{className:`absolute -bottom-0.5 -right-0.5 w-2.5 h-2.5 sm:w-3 sm:h-3 md:w-3.5 md:h-3.5 rounded-full border border-white sm:border-2 shadow-lg animate-pulse opacity-0 group-hover/avatar:opacity-100 transition-opacity duration-300 ${W?"bg-emerald-300":"bg-slate-400"}`})]}),s.jsx("span",{className:"text-white font-bold text-sm sm:text-base group-hover:scale-105 transition-transform duration-300 truncate",children:me})]}),s.jsx("div",{className:"flex gap-2",children:c||(o==null?void 0:o.id)===M.userId?s.jsxs(s.Fragment,{children:[s.jsx("button",{onClick:()=>t(M),className:"p-1.5 bg-white/20 hover:bg-white/30 rounded-lg transition-colors",children:s.jsx(tr,{className:"w-4 h-4 text-white"})}),s.jsx("button",{onClick:()=>G(M),className:"p-1.5 bg-white/20 hover:bg-white/30 rounded-lg transition-colors",children:s.jsx(Pt,{className:"w-4 h-4 text-white"})})]}):s.jsxs(s.Fragment,{children:[s.jsx("button",{disabled:!0,className:"p-1.5 bg-white/10 cursor-not-allowed rounded-lg",title:"Вы можете редактировать только свои слоты",children:s.jsx(tr,{className:"w-4 h-4 text-white/50"})}),s.jsx("button",{disabled:!0,className:"p-1.5 bg-white/10 cursor-not-allowed rounded-lg",title:"Вы можете удалять только свои слоты",children:s.jsx(Pt,{className:"w-4 h-4 text-white/50"})})]})})]}),s.jsx("div",{className:"space-y-2",children:M.slots.map((B,ue)=>s.jsxs("div",{className:"space-y-1.5",children:[s.jsx("div",{className:`bg-white/25 backdrop-blur-md rounded-md sm:rounded-lg px-2 sm:px-3 py-1.5 sm:py-2 border-2 transition-all duration-300 hover:scale-105 hover:shadow-xl ${W?"border-white/40 ring-2 ring-white/20 hover:border-white/60 hover:ring-4 hover:ring-white/40":"border-white/30 ring-2 ring-white/10 hover:border-white/50 hover:ring-4 hover:ring-white/30"}`,children:s.jsxs("div",{className:"flex items-center gap-1.5 sm:gap-2 flex-wrap",children:[s.jsx(Q,{className:`w-3.5 h-3.5 sm:w-4 sm:h-4 text-white flex-shrink-0 ${W?"animate-pulse":""}`}),s.jsxs("span",{className:"text-white font-bold text-xs sm:text-sm whitespace-nowrap",children:[B.start," - ",B.end]}),B.endDate&&s.jsxs("span",{className:"text-white/80 font-medium text-[10px] sm:text-xs whitespace-nowrap",children:["(до ",ce(new Date(B.endDate),"dd.MM"),")"]})]})}),B.breaks&&B.breaks.length>0&&s.jsxs("div",{className:"space-y-1 w-full",children:[s.jsx("div",{className:`text-[10px] ${i==="dark"?"text-gray-300":"text-gray-700"} font-medium text-center sm:text-left`,children:"Перерывы:"}),B.breaks.map((O,ge)=>s.jsx("div",{className:`${i==="dark"?"bg-gray-700/95":"bg-white"} ${i==="dark"?"text-gray-200":"text-gray-900"} border-2 ${i==="dark"?"border-orange-500/60":"border-orange-300"} rounded-md sm:rounded-lg px-2 sm:px-3 py-1 sm:py-1.5 text-[10px] sm:text-xs font-semibold shadow-lg transition-all duration-300 hover:scale-105 hover:shadow-xl ${i==="dark"?"hover:border-orange-400/80 hover:shadow-orange-500/30 ring-2 ring-orange-500/20 hover:ring-4 hover:ring-orange-400/40":"hover:border-orange-400 hover:shadow-orange-400/30 ring-2 ring-orange-300/20 hover:ring-4 hover:ring-orange-300/40"} w-full`,children:s.jsxs("span",{className:"flex items-center gap-1 sm:gap-1.5 justify-center flex-wrap w-full",children:[s.jsx("span",{className:`w-1 h-1 sm:w-1.5 sm:h-1.5 rounded-full ${i==="dark"?"bg-orange-400":"bg-orange-500"} animate-pulse flex-shrink-0`}),s.jsxs("span",{className:"whitespace-nowrap",children:[O.start," - ",O.end]})]})},ge))]})]},ue))})]},M.id)}),R.length===0&&te.length===0&&s.jsx("p",{className:`text-sm ${f}`,children:"Нет данных"})]})]},X)})})]})},z_=({slot:r,onClose:e,onSave:t})=>{var Ht;const{user:n}=kt(),{theme:a}=it(),{isAdmin:i}=Tt(),o=a==="dark"?"text-white":"text-gray-900",c=(r==null?void 0:r.date)||ce(new Date,"yyyy-MM-dd"),[d,h]=D.useState(c),[g,x]=D.useState(r!=null&&r.userId?[r.userId]:n!=null&&n.id?[n.id]:[]),[p,v]=D.useState(((Ht=r==null?void 0:r.slots)==null?void 0:Ht.map(J=>{const xe=J;return xe.break&&!xe.breaks?{...J,breaks:[xe.break]}:J}))||[]),[A,C]=D.useState(""),[T,z]=D.useState(""),[$,S]=D.useState(!1),[I,H]=D.useState(""),[G,E]=D.useState(""),[y,w]=D.useState(null),[k,j]=D.useState(null),[N,f]=D.useState(null),[de,V]=D.useState(null),[X,R]=D.useState((r==null?void 0:r.comment)||""),[te,Z]=D.useState(!1),[oe,F]=D.useState([]),[L,M]=D.useState(!1),[re,me]=D.useState([]),[W,ie]=D.useState("single"),[Q,B]=D.useState(c),[ue,O]=D.useState(c),[ge,Ee]=D.useState(c),[Y,fe]=D.useState([]),[pe,Ae]=D.useState(""),[qe,Je]=D.useState(!1);In();const q=["Пн","Вт","Ср","Чт","Пт","Сб","Вс"],ae=i&&!r;D.useEffect(()=>{console.log("SlotForm mounted, user:",n==null?void 0:n.name,"slots count:",p.length)},[]),D.useEffect(()=>{if(te&&d){const J=new Date(d),xe=J.getDay()===0?6:J.getDay()-1;F([xe])}},[te,d]),D.useEffect(()=>{L||me([])},[L]),D.useEffect(()=>{W!=="single"&&(Z(!1),F([]),M(!1),me([]))},[W]);const De=()=>{var Ge;if(!A||!T){Ae("Заполните время начала и окончания");return}const J=$&&A>=T;if(!J&&A>=T){Ae('Время окончания должно быть позже времени начала. Включите "Переходит через полночь" для слотов, переходящих на следующий день.');return}let xe;if(J&&d){const ze=new Date(d);ze.setDate(ze.getDate()+1),xe=ce(ze,"yyyy-MM-dd")}const Re=y!==null?((Ge=p[y])==null?void 0:Ge.breaks)||[]:[],Be={start:A,end:T,...xe&&{endDate:xe},breaks:Re};if(y!==null){const ze=[...p];ze[y]=Be,v(ze)}else v([...p,Be]);C(""),z(""),S(!1),H(""),E(""),w(null),j(null),Ae("")},ee=J=>{const xe=p[J];if(!xe)return;const Re=!!xe.endDate||ir(xe.end)<=ir(xe.start);C(xe.start),z(xe.end),S(Re),w(J),j(null),f(null),V(null),H(""),E(""),Ae("")},Me=()=>{w(null),C(""),z(""),S(!1),Ae("")},Ue=J=>{if(!I||!G){Ae("Заполните время начала и окончания перерыва");return}const xe=p[J];if(!xe)return;if(I>=G){Ae("Время окончания перерыва должно быть позже времени начала");return}const Re=ir(I),Be=ir(G),Ge=ir(xe.start),ze=ir(xe.end),Zt=xe.endDate||ze<=Ge;let Ze=!1;if(Zt){const Xe=Re>=Ge&&Re<1440&&Be>Re&&Be<=1440&&Be>Re,dr=Re>=0&&Re<=ze&&Be>Re&&Be<=ze,nr=Re>=Ge&&Re<1440&&Be>0&&Be<=ze&&Re>Be;Ze=Xe||dr||nr}else Ze=Re>=Ge&&Be<=ze&&Be>Re;if(!Ze){Ae(`Перерыв должен быть в пределах времени слота (${xe.start} - ${xe.end})`);return}const ot=xe.breaks||[];for(let ut=0;ut<ot.length;ut++){if(N===J&&de===ut)continue;const Xe=ot[ut];if(I>=Xe.start&&I<Xe.end||G>Xe.start&&G<=Xe.end||I<=Xe.start&&G>=Xe.end){Ae("Перерывы не должны пересекаться");return}}let At;N===J&&de!==null?(At=[...ot],At[de]={start:I,end:G},At.sort((ut,Xe)=>ut.start.localeCompare(Xe.start))):At=[...ot,{start:I,end:G}].sort((ut,Xe)=>ut.start.localeCompare(Xe.start));const sr=[...p];sr[J]={...xe,breaks:At},v(sr),H(""),E(""),j(null),f(null),V(null),Ae("")},P=(J,xe)=>{const Re=p[J];if(!Re||!Re.breaks||!Re.breaks[xe])return;const Be=Re.breaks[xe];f(J),V(xe),j(J),H(Be.start),E(Be.end),Ae("")},_=()=>{H(""),E(""),j(null),f(null),V(null),Ae("")},be=(J,xe)=>{const Re=p[J];if(!Re||!Re.breaks)return;const Be=Re.breaks.filter((ze,Zt)=>Zt!==xe),Ge=[...p];Ge[J]={...Re,breaks:Be.length>0?Be:void 0},v(Ge)},Ne=J=>{v(p.filter((xe,Re)=>Re!==J)),y===J&&Me()},Ie=J=>{oe.includes(J)?F(oe.filter(xe=>xe!==J)):F([...oe,J])},ne=J=>{re.includes(J)?me(re.filter(xe=>xe!==J)):me([...re,J])},we=J=>{x(xe=>xe.includes(J)?xe.filter(Re=>Re!==J):[...xe,J])},ke=()=>{g.length===Se.length?x([]):x(Se.map(J=>J.id))},$e=()=>{if(!ge)return;const J=o0([...Y,ge]);fe(J),Ee("")},rt=J=>{fe(xe=>xe.filter(Re=>Re!==J))},gt=()=>{if(ae){if(W==="range")return $i(Q,ue);if(W==="multiple")return Y}if(W==="single"){if(te&&oe.length>0){const J=[],xe=new Date(d),Re=new Date(xe.getFullYear(),xe.getMonth()+1,0),Be=oe[0],Ge=new Date(xe);for(;Ge<=Re;)(Ge.getDay()===0?6:Ge.getDay()-1)===Be&&J.push(ce(Ge,"yyyy-MM-dd")),Ge.setDate(Ge.getDate()+1);return J}if(L&&re.length>0){const J=[],xe=new Date(d),Re=xe.getDay()===0?6:xe.getDay()-1;xe.setDate(xe.getDate()-Re);for(let Be=0;Be<7;Be++){const Ge=new Date(xe);Ge.setDate(xe.getDate()+Be);const ze=Ge.getDay()===0?6:Ge.getDay()-1;re.includes(ze)&&J.push(ce(Ge,"yyyy-MM-dd"))}return J}return[d]}return W==="range"?$i(Q,ue):Y},_t=()=>r?[r.userId]:ae?g:i&&!n?g.length>0?g:[]:n!=null&&n.id?[n.id]:[],Ce=J=>{var xe;return((xe=Se.find(Re=>Re.id===J))==null?void 0:xe.name)||J},at=async(J,xe)=>{const Be=(await Kr(void 0,J)).filter(Ge=>Ge.id!==(r==null?void 0:r.id));for(const Ge of xe)for(const ze of Be)if(M_(Ge,ze.slots[0])&&ze.participants.length>=3)return`Слот ${Ge.start}-${Ge.end} уже занят максимальным количеством участников (3)`;return null},ye=async()=>{if(console.log("handleSave called"),!i&&!n){console.log("No user found"),Ae("Пользователь не найден");return}if(p.length===0){Ae("Добавьте хотя бы один временной интервал");return}if(r&&!i&&n&&r.userId!==n.id){Ae("Вы можете редактировать только свои слоты"),Je(!1);return}const J=_t();if(J.length===0){Ae("Выберите хотя бы одного участника");return}const xe=gt();if(xe.length===0){Ae("Выберите даты");return}const Re=new Date;Re.setHours(0,0,0,0);const Be=ce(Re,"yyyy-MM-dd"),Ge=Ze=>Ze<Be,ze=(Ze,ot)=>{const At=new Date(Ze),sr=new Date(ot);return At.setHours(0,0,0,0),sr.setHours(0,0,0,0),Math.round((sr.getTime()-At.getTime())/(1e3*60*60*24))},Zt=async(Ze,ot,At=[Ze])=>{const sr=p.map(Xe=>{const dr=!Xe.endDate&&ir(Xe.end)<=ir(Xe.start),nr=Xe.endDate?ze(d,Xe.endDate):dr?1:0;if(nr>0){const Xr=new Date(ot);return Xr.setDate(Xr.getDate()+nr),{...Xe,endDate:ce(Xr,"yyyy-MM-dd")}}return{...Xe,...Xe.endDate?{endDate:Xe.endDate}:{}}});if(!i){const Xe=await at(ot,sr);if(Xe)throw new Error(`[${Ce(Ze)} • ${ce(new Date(ot),"dd.MM.yyyy")}] ${Xe}`)}const ut={id:(r==null?void 0:r.id)||"",userId:Ze,date:ot,slots:sr,...X&&{comment:X},participants:At};if(i)if(r){const{id:Xe,...dr}=ut;await Vg(r.id,dr)}else{const{id:Xe,...dr}=ut;await Og(dr)}else await bt({entity:"slot",action:r?"update":"create",authorId:(n==null?void 0:n.id)||Ze,targetUserId:Ze,before:r||null,after:ut,comment:X||void 0})};console.log("Starting save process..."),Ae(""),Je(!0);try{if(r){await Zt(r.userId,d,r.participants||[r.userId]),t();return}if(L&&re.length>0){const Ze=gt();for(const ot of Ze)if(!Ge(ot))for(const At of J)await Zt(At,ot)}else if(te&&oe.length>0){const Ze=new Date(d),ot=Ze.getMonth(),At=Ze.getFullYear(),sr=new Date(At,ot+1,0).getDate();for(let ut=1;ut<=sr;ut++){const Xe=new Date(At,ot,ut),dr=Xe.getDay()===0?6:Xe.getDay()-1;if(oe.includes(dr)){const nr=ce(Xe,"yyyy-MM-dd");if(Ge(nr))continue;for(const Xr of J)await Zt(Xr,nr)}}}else if(ae&&W!=="single")for(const Ze of xe)for(const ot of J)await Zt(ot,Ze);else for(const Ze of J)await Zt(Ze,d);t()}catch(Ze){console.error("Error saving slot:",Ze);const ot=Ze.message||Ze.code||"Ошибка при сохранении";Ae(ot)}finally{Je(!1)}},_e=ae?gt():[d],Qe=g.map(J=>Ce(J)).join(", "),Qr=p.map(J=>`${J.start}–${J.end}${J.endDate?" (+1)":""}`);return s.jsx("div",{className:"fixed inset-0 bg-slate-950/75 backdrop-blur-xl flex items-start sm:items-center justify-center z-[70] p-4 sm:p-6 touch-manipulation overflow-y-auto",children:s.jsx("div",{className:`w-full max-w-5xl rounded-3xl shadow-[0_24px_80px_rgba(0,0,0,0.45)] border ${a==="dark"?"bg-gradient-to-br from-[#0c1320] via-[#0b1220] to-[#08111b] border-white/10":"bg-gradient-to-br from-white via-slate-50 to-white border-slate-200"} max-h-[90vh] overflow-y-auto`,children:s.jsxs("div",{className:"p-4 sm:p-6 lg:p-7 flex flex-col h-full min-h-0 overflow-y-auto",children:[s.jsxs("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between",children:[s.jsxs("div",{className:"space-y-1",children:[s.jsx("div",{className:"flex items-center gap-2 text-xs font-semibold text-[#4E6E49] tracking-tight",children:s.jsx("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full bg-[#4E6E49]/10 text-[#4E6E49] border border-[#4E6E49]/30",children:r?"Редактирование слота":"Создание слота"})}),s.jsx("h3",{className:`text-2xl sm:text-3xl font-bold ${o}`,children:r?"Редактировать слот":"Добавить слот"})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsxs("div",{className:`px-3 py-2 rounded-xl border text-xs sm:text-sm ${a==="dark"?"border-white/10 bg-white/5 text-gray-200":"border-slate-200 bg-slate-50 text-slate-700"}`,children:[r?"Редактирование":"Создание"," · ",p.length||0," интервал(ов)"]}),s.jsx("button",{onClick:e,className:`p-2.5 rounded-full border ${a==="dark"?"border-white/10 text-gray-200 hover:bg-white/5":"border-slate-200 text-slate-600 hover:bg-slate-100"} transition-colors touch-manipulation`,"aria-label":"Закрыть",children:s.jsx(Jt,{className:"w-4 h-4 sm:w-5 sm:h-5"})})]})]}),s.jsxs("div",{className:"mt-5 grid lg:grid-cols-[0.9fr_1.6fr] gap-4 lg:gap-6 flex-1 min-h-0",children:[s.jsxs("aside",{className:`rounded-2xl border ${a==="dark"?"border-white/10 bg-white/5":"border-slate-200 bg-white"} p-4 sm:p-5 space-y-4 sticky top-0 self-start max-h-full overflow-y-auto`,children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("p",{className:"text-sm font-semibold",children:"Навигация"}),s.jsx("span",{className:"text-[11px] uppercase tracking-wide text-[#4E6E49] font-semibold",children:"4 шага"})]}),s.jsx("div",{className:"space-y-2",children:[{label:"Участники",detail:Qe||"Не выбрано",done:g.length>0||!!r},{label:"Даты",detail:_e.slice(0,2).map(J=>ce(J,"dd.MM")).join(", ")||"Выберите дату",done:_e.length>0},{label:"Время",detail:Qr.slice(0,2).join(" · ")||"Добавьте интервал",done:p.length>0},{label:"Комментарий",detail:X?"Заполнен":"Необязателен",done:!!X}].map((J,xe)=>s.jsxs("div",{className:`flex items-start gap-3 rounded-xl border px-3 py-3 ${a==="dark"?"border-white/10 bg-white/5":"border-slate-200 bg-slate-50"}`,children:[s.jsx("span",{className:`mt-0.5 inline-flex h-6 w-6 items-center justify-center rounded-full text-xs font-bold ${J.done?"bg-[#4E6E49] text-white":a==="dark"?"bg-slate-800 text-gray-300":"bg-slate-200 text-slate-700"}`,children:xe+1}),s.jsxs("div",{className:"flex-1",children:[s.jsx("p",{className:"text-sm font-semibold",children:J.label}),s.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 truncate",children:J.detail})]})]},J.label))})]}),s.jsxs("div",{className:"space-y-4 overflow-y-auto overscroll-contain pr-1 pb-6 flex-1 min-h-0",children:[ae&&s.jsxs("div",{children:[s.jsx("label",{className:`block text-xs sm:text-sm font-medium mb-2 ${a==="dark"?"text-gray-300":"text-gray-700"}`,children:"Участники"}),s.jsxs("div",{className:"space-y-3",children:[s.jsx("div",{className:"flex flex-wrap gap-2",children:Se.map(J=>s.jsxs("label",{className:`px-3 py-1.5 rounded-full border cursor-pointer text-sm flex items-center gap-2 ${g.includes(J.id)?"bg-[#4E6E49] border-[#4E6E49] text-white":a==="dark"?"bg-gray-700 border-gray-800 text-gray-200":"bg-gray-100 border-gray-300 text-gray-700"}`,children:[s.jsx("input",{type:"checkbox",checked:g.includes(J.id),onChange:()=>we(J.id),className:"hidden"}),J.name]},J.id))}),s.jsx("button",{type:"button",onClick:ke,className:"text-sm text-[#4E6E49] hover:text-[#4E6E49]",children:g.length===Se.length?"Снять выделение":"Выбрать всех"})]})]}),ae&&s.jsxs("div",{children:[s.jsx("p",{className:`text-xs sm:text-sm font-medium mb-2 ${a==="dark"?"text-gray-300":"text-gray-700"}`,children:"Формат выбора дат"}),s.jsx("div",{className:"flex flex-wrap gap-4",children:[{value:"single",label:"Один день"},{value:"range",label:"Диапазон дат"},{value:"multiple",label:"Конкретные даты"}].map(J=>s.jsxs("label",{className:"flex items-center gap-2 text-sm cursor-pointer",children:[s.jsx("input",{type:"radio",value:J.value,checked:W===J.value,onChange:xe=>ie(xe.target.value)}),s.jsx("span",{className:a==="dark"?"text-gray-200":"text-gray-700",children:J.label})]},J.value))})]}),(!ae||W==="single")&&s.jsxs("div",{children:[s.jsx("label",{className:`block text-xs sm:text-sm font-medium mb-2 ${a==="dark"?"text-gray-300":"text-gray-700"}`,children:"Дата"}),s.jsx("input",{type:"date",value:d,onChange:J=>h(J.target.value),className:`w-full px-3 sm:px-4 py-2 sm:py-2.5 text-sm sm:text-base rounded-lg border touch-manipulation ${a==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`})]}),ae&&W==="range"&&s.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:`block text-xs sm:text-sm font-medium mb-2 ${a==="dark"?"text-gray-300":"text-gray-700"}`,children:"Начало диапазона"}),s.jsx("input",{type:"date",value:Q,onChange:J=>B(J.target.value),className:`w-full px-3 sm:px-4 py-2 sm:py-2.5 text-sm sm:text-base rounded-lg border touch-manipulation ${a==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`})]}),s.jsxs("div",{children:[s.jsx("label",{className:`block text-xs sm:text-sm font-medium mb-2 ${a==="dark"?"text-gray-300":"text-gray-700"}`,children:"Конец диапазона"}),s.jsx("input",{type:"date",value:ue,min:Q,onChange:J=>O(J.target.value),className:`w-full px-3 sm:px-4 py-2 sm:py-2.5 text-sm sm:text-base rounded-lg border touch-manipulation ${a==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`})]})]}),ae&&W==="multiple"&&s.jsxs("div",{children:[s.jsx("label",{className:`block text-xs sm:text-sm font-medium mb-2 ${a==="dark"?"text-gray-300":"text-gray-700"}`,children:"Выбранные даты"}),s.jsxs("div",{className:"flex flex-col gap-3",children:[s.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[s.jsx("input",{type:"date",value:ge,onChange:J=>Ee(J.target.value),className:`flex-1 px-3 sm:px-4 py-2 sm:py-2.5 text-sm sm:text-base rounded-lg border touch-manipulation ${a==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`}),s.jsx("button",{type:"button",onClick:$e,className:"px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg transition-colors",children:"Добавить"})]}),Y.length>0?s.jsx("div",{className:"flex flex-wrap gap-2",children:Y.map(J=>s.jsxs("span",{className:"inline-flex items-center gap-2 px-3 py-1.5 rounded-full bg-gray-100 text-gray-800 text-sm",children:[ce(J,"dd.MM.yyyy"),s.jsx("button",{type:"button",onClick:()=>rt(J),className:"text-red-500 hover:text-red-600",children:"x"})]},J))}):s.jsx("p",{className:"text-sm text-gray-500",children:"Пока не выбрано ни одной даты"})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:`block text-xs sm:text-sm font-medium mb-2 ${a==="dark"?"text-gray-300":"text-gray-700"}`,children:"Временные слоты"}),s.jsxs("div",{className:"space-y-2 mb-2",children:[s.jsx("div",{className:"flex flex-col sm:flex-row gap-2",children:s.jsxs("div",{className:"flex gap-2 flex-1",children:[s.jsx("input",{type:"time",value:A,onChange:J=>C(J.target.value),className:`flex-1 px-3 sm:px-4 py-2 sm:py-2.5 text-sm sm:text-base rounded-lg border touch-manipulation ${a==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`,placeholder:"Начало"}),s.jsx("span",{className:"mx-1 sm:mx-2 text-gray-500 text-sm sm:text-base flex items-center",children:"—"}),s.jsx("input",{type:"time",value:T,onChange:J=>z(J.target.value),className:`flex-1 px-3 sm:px-4 py-2 sm:py-2.5 text-sm sm:text-base rounded-lg border touch-manipulation ${a==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`,placeholder:"Окончание"})]})}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("input",{type:"checkbox",id:"crossMidnight",checked:$,onChange:J=>{S(J.target.checked)},className:`w-4 h-4 rounded border-2 ${a==="dark"?"border-gray-800 bg-gray-700 checked:bg-[#4E6E49] checked:border-[#4E6E49]":"border-gray-300 bg-white checked:bg-[#4E6E49] checked:border-[#4E6E49]"} focus:ring-2 focus:ring-[#4E6E49] cursor-pointer touch-manipulation`}),s.jsx("label",{htmlFor:"crossMidnight",className:`text-xs sm:text-sm font-medium cursor-pointer ${a==="dark"?"text-gray-300":"text-gray-700"}`,children:"Переходит через полночь (на следующий день)"})]}),s.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[s.jsx("button",{onClick:De,className:"w-full px-4 py-2 bg-[#4E6E49] hover:bg-[#4E6E49] text-white rounded-lg transition-colors flex items-center justify-center gap-2",children:y!==null?s.jsxs(s.Fragment,{children:[s.jsx(tr,{className:"w-4 h-4"}),"Сохранить слот"]}):s.jsxs(s.Fragment,{children:[s.jsx(ra,{className:"w-4 h-4"}),"Добавить слот"]})}),y!==null&&s.jsx("button",{onClick:Me,className:`w-full sm:w-auto px-4 py-2 rounded-lg border ${a==="dark"?"border-gray-700 text-gray-200 hover:bg-gray-700":"border-gray-300 text-gray-800 hover:bg-gray-100"}`,children:"Отмена"})]})]}),s.jsx("div",{className:"space-y-3",children:p.map((J,xe)=>s.jsxs("div",{className:`flex flex-col gap-2 p-3 rounded-lg ${a==="dark"?"bg-gray-700":"bg-gray-100"}`,children:[s.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-2",children:[s.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[s.jsxs("span",{className:o,children:[J.start," - ",J.end]}),J.endDate&&s.jsxs("span",{className:`text-xs px-2 py-0.5 rounded-full ${a==="dark"?"bg-blue-500/20 text-blue-400 border border-blue-500/30":"bg-blue-100 text-blue-700 border border-blue-300"}`,children:["до ",ce(new Date(J.endDate),"dd.MM.yyyy")]})]}),s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx("button",{onClick:()=>ee(xe),className:"p-1 text-blue-500 hover:bg-blue-500 hover:text-white rounded transition-colors flex-shrink-0",title:"Редактировать слот",children:s.jsx(tr,{className:"w-4 h-4"})}),s.jsx("button",{onClick:()=>Ne(xe),className:"p-1 text-red-500 hover:bg-red-500 hover:text-white rounded transition-colors flex-shrink-0",title:"Удалить слот",children:s.jsx(Pt,{className:"w-4 h-4"})})]})]}),J.breaks&&J.breaks.length>0&&s.jsxs("div",{className:"ml-4 space-y-1",children:[s.jsx("span",{className:`text-xs ${a==="dark"?"text-gray-400":"text-gray-600"}`,children:"Перерывы:"}),J.breaks.map((Re,Be)=>N===xe&&de===Be?null:s.jsxs("div",{className:"flex items-center justify-between gap-2",children:[s.jsxs("span",{className:`text-sm ${a==="dark"?"text-gray-300":"text-gray-700"}`,children:[Re.start," - ",Re.end]}),s.jsxs("div",{className:"flex gap-1",children:[s.jsx("button",{onClick:()=>P(xe,Be),className:"p-1 text-blue-400 hover:bg-blue-400 hover:text-white rounded transition-colors",title:"Редактировать перерыв",children:s.jsx(tr,{className:"w-3 h-3"})}),s.jsx("button",{onClick:()=>be(xe,Be),className:"p-1 text-red-400 hover:bg-red-400 hover:text-white rounded transition-colors",title:"Удалить перерыв",children:s.jsx(Jt,{className:"w-3 h-3"})})]})]},Be))]}),s.jsx("div",{className:"ml-4 space-y-2 border-t pt-2 border-gray-500 border-opacity-30",children:k===xe?s.jsxs("div",{className:"space-y-2",children:[s.jsxs("div",{className:"flex gap-2",children:[s.jsx("input",{type:"time",value:I,onChange:Re=>H(Re.target.value),className:`flex-1 px-3 py-1.5 text-sm rounded-lg border ${a==="dark"?"bg-gray-600 border-gray-500 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`,placeholder:"Начало"}),s.jsx("input",{type:"time",value:G,onChange:Re=>E(Re.target.value),className:`flex-1 px-3 py-1.5 text-sm rounded-lg border ${a==="dark"?"bg-gray-600 border-gray-500 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`,placeholder:"Конец"})]}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx("button",{onClick:()=>Ue(xe),className:"flex-1 px-3 py-1.5 text-sm bg-[#4E6E49] hover:bg-[#4E6E49] text-white rounded-lg transition-colors",children:N===xe&&de!==null?"Сохранить":"Добавить перерыв"}),s.jsx("button",{onClick:_,className:"px-3 py-1.5 text-sm bg-gray-500 hover:bg-gray-600 text-white rounded-lg transition-colors",children:"Отмена"})]})]}):s.jsxs("button",{onClick:()=>{j(xe),H(""),E(""),f(null),V(null),Ae("")},className:"w-full px-3 py-1.5 text-sm bg-blue-500 hover:bg-blue-600 text-white rounded-lg transition-colors flex items-center justify-center gap-1",children:[s.jsx(ra,{className:"w-3 h-3"}),"Добавить перерыв"]})})]},xe))}),p.length>0&&s.jsxs("p",{className:`text-sm mt-2 ${a==="dark"?"text-gray-400":"text-gray-600"}`,children:["Всего часов: ",ho(p).toFixed(1)]})]}),(!ae||W==="single")&&s.jsxs("div",{children:[s.jsx("p",{className:`text-xs sm:text-sm font-medium mb-3 ${a==="dark"?"text-gray-300":"text-gray-700"}`,children:"Повторы"}),s.jsxs("div",{className:"grid sm:grid-cols-2 gap-3",children:[s.jsxs("button",{type:"button",onClick:()=>{M(!L),Ae("")},className:`text-left rounded-xl border px-4 py-4 transition-all shadow-sm flex items-start gap-3 h-full ${L?"bg-blue-100 text-blue-800 border-blue-200 dark:bg-blue-900/30 dark:text-blue-100 dark:border-blue-800 ring-2 ring-blue-500/50 shadow-lg":a==="dark"?"border-white/10 bg-white/5 text-gray-200 hover:border-white/30":"border-slate-200 bg-white text-gray-800 hover:border-slate-300"}`,children:[s.jsx(jp,{className:"w-5 h-5 flex-shrink-0 mt-0.5"}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsx("p",{className:"font-semibold text-sm",children:"Повтор на неделю"}),s.jsx("p",{className:"text-xs mt-1 opacity-80",children:"Актуальная неделя по дням"}),L&&s.jsx("div",{className:"mt-3 flex flex-wrap gap-2",children:q.map((J,xe)=>s.jsx("button",{type:"button",onClick:Re=>{Re.stopPropagation(),ne(xe)},className:`px-2 py-1 rounded-lg text-xs transition-colors ${re.includes(xe)?"bg-blue-600 text-white":a==="dark"?"bg-gray-700 text-gray-300":"bg-gray-200 text-gray-700"}`,children:J},xe))})]})]}),s.jsxs("button",{type:"button",onClick:()=>{Z(!te),Ae("")},className:`text-left rounded-xl border px-4 py-4 transition-all shadow-sm flex items-start gap-3 h-full ${te?"bg-purple-100 text-purple-800 border-purple-200 dark:bg-purple-900/30 dark:text-purple-100 dark:border-purple-800 ring-2 ring-purple-500/50 shadow-lg":a==="dark"?"border-white/10 bg-white/5 text-gray-200 hover:border-white/30":"border-slate-200 bg-white text-gray-800 hover:border-slate-300"}`,children:[s.jsx(Ur,{className:"w-5 h-5 flex-shrink-0 mt-0.5"}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsx("p",{className:"font-semibold text-sm",children:"Повтор по месяцу"}),s.jsx("p",{className:"text-xs mt-1 opacity-80",children:"На месяц вперед по дням"}),te&&s.jsx("div",{className:"mt-3 flex flex-wrap gap-2",children:q.map((J,xe)=>s.jsx("button",{type:"button",onClick:Re=>{Re.stopPropagation(),Ie(xe)},className:`px-2 py-1 rounded-lg text-xs transition-colors ${oe.includes(xe)?"bg-purple-600 text-white":a==="dark"?"bg-gray-700 text-gray-300":"bg-gray-200 text-gray-700"}`,children:J},xe))})]})]})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:`block text-xs sm:text-sm font-medium mb-2 ${a==="dark"?"text-gray-300":"text-gray-700"}`,children:"Комментарий"}),s.jsx("textarea",{value:X,onChange:J=>R(J.target.value),rows:3,className:`w-full px-3 sm:px-4 py-2 sm:py-2.5 text-sm sm:text-base rounded-lg border touch-manipulation resize-y ${a==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`,placeholder:"Добавьте комментарий (необязательно)"})]}),pe&&s.jsx("div",{className:"p-3 bg-red-500 text-white rounded-lg text-sm",children:pe}),s.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 sm:gap-3 pt-2",children:[s.jsx("button",{onClick:J=>{console.log("Save button clicked!",{loading:qe,slotsCount:p.length,disabled:qe||p.length===0}),J.preventDefault(),ye()},disabled:qe||p.length===0,className:"flex-1 px-4 py-2.5 sm:py-2 bg-[#4E6E49] hover:bg-[#4E6E49] disabled:bg-gray-400 disabled:cursor-not-allowed text-white rounded-lg sm:rounded-xl transition-colors text-sm sm:text-base font-medium touch-manipulation active:scale-95 disabled:active:scale-100",children:qe?"Отправка...":"Отправить на согласование"}),s.jsx("button",{onClick:e,className:`px-4 py-2.5 sm:py-2 rounded-lg sm:rounded-xl transition-colors text-sm sm:text-base font-medium touch-manipulation active:scale-95 ${a==="dark"?"bg-gray-700 hover:bg-gray-600 active:bg-gray-500":"bg-gray-200 hover:bg-gray-300 active:bg-gray-400"}`,children:"Отмена"})]})]})]})]})})})},H_=({type:r,status:e,onClose:t,onSave:n})=>{const{user:a}=kt(),{theme:i}=it(),{isAdmin:o}=Tt(),c=i==="dark"?"text-white":"text-gray-900",d=(e==null?void 0:e.date)||ce(new Date,"yyyy-MM-dd"),[h,g]=D.useState(e!=null&&e.userId?[e.userId]:a!=null&&a.id?[a.id]:[]),[x,p]=D.useState(d),[v,A]=D.useState((e==null?void 0:e.endDate)||d),[C,T]=D.useState(!!(e!=null&&e.endDate)),[z,$]=D.useState((e==null?void 0:e.comment)||""),[S,I]=D.useState(r||(e==null?void 0:e.type)||null),[H,G]=D.useState(""),[E,y]=D.useState(!1),[w,k]=D.useState("single"),[j,N]=D.useState(d),[f,de]=D.useState(d),[V,X]=D.useState(d),[R,te]=D.useState([]),[Z,oe]=D.useState(!1),[F,L]=D.useState([]),[M,re]=D.useState(!1),[me,W]=D.useState([]),ie=o&&!e,Q=["Пн","Вт","Ср","Чт","Пт","Сб","Вс"];In(),D.useEffect(()=>{C||A(x)},[C,x]),D.useEffect(()=>{ie&&w!=="single"&&T(!1)},[ie,w]),D.useEffect(()=>{Z||L([])},[Z]),D.useEffect(()=>{if(M&&x){const _=new Date(x),be=_.getDay()===0?6:_.getDay()-1;W([be])}},[M,x]),D.useEffect(()=>{w!=="single"&&(oe(!1),L([]),re(!1),W([]))},[w]);const B=_=>{g(be=>be.includes(_)?be.filter(Ne=>Ne!==_):[...be,_])},ue=()=>{h.length===Se.length?g([]):g(Se.map(_=>_.id))},O=()=>{if(!V)return;const _=o0([...R,V]);te(_),X("")},ge=_=>{te(be=>be.filter(Ne=>Ne!==_))},Ee=()=>e?[e.userId]:ie?h:o&&!a?h.length>0?h:[]:a!=null&&a.id?[a.id]:[],Y=_=>{var be;return Je[_]||((be=Se.find(Ne=>Ne.id===_))==null?void 0:be.name)||_},fe=_=>{if(ie){if(w==="range")return j&&f?_==="dayoff"?$i(j,f).map(Ne=>({date:Ne})):[{date:j,endDate:f}]:[];if(w==="multiple")return _==="dayoff"?R.map(Ne=>({date:Ne})):R.map(Ne=>({date:Ne,endDate:Ne}))}if(w==="single"&&_==="dayoff"){if(M&&me.length>0){const Ne=[],Ie=new Date(x),ne=new Date(Ie.getFullYear(),Ie.getMonth()+1,0),we=me[0],ke=new Date(Ie);for(;ke<=ne;)(ke.getDay()===0?6:ke.getDay()-1)===we&&Ne.push(ce(ke,"yyyy-MM-dd")),ke.setDate(ke.getDate()+1);return Ne.map($e=>({date:$e}))}if(Z&&F.length>0){const Ne=[],Ie=new Date(x),ne=Ie.getDay()===0?6:Ie.getDay()-1;Ie.setDate(Ie.getDate()-ne);for(let we=0;we<7;we++){const ke=new Date(Ie);ke.setDate(Ie.getDate()+we);const $e=ke.getDay()===0?6:ke.getDay()-1;F.includes($e)&&Ne.push(ce(ke,"yyyy-MM-dd"))}return Ne.map(we=>({date:we}))}}if(_==="dayoff"){if(w==="range")return $i(j,f).map(Ne=>({date:Ne}));if(w==="multiple")return R.map(Ne=>({date:Ne}))}if(w==="range"&&j&&f)return[{date:j,endDate:f}];if(w==="multiple")return R.map(Ne=>({date:Ne,endDate:Ne}));const be={date:x};return _!=="dayoff"&&(C||e!=null&&e.endDate)&&(be.endDate=v),[be]},pe=async(_,be,Ne,Ie)=>{if(o)return null;if(!a)return"Пользователь не найден";const ne=new Date,we=new Date(be),ke=new Date(Ne||be);if(Ie==="dayoff"&&i0(we,ne))return"Нельзя установить выходной на сегодня. Выберите смену или возьмите больничный.";if(Ie==="sick"){const $e=new Date;$e.setHours(0,0,0,0);const rt=new Date($e);rt.setDate(rt.getDate()+2);const gt=new Date(be);if(gt.setHours(0,0,0,0),gt<$e||gt>rt)return"Больничный можно взять только на актуальную дату и + 2 суток. Нельзя выбрать заранее.";const _t=Math.ceil((ke.getTime()-we.getTime())/(1e3*60*60*24))+1;if(_t<1)return"Больничный должен быть минимум на 1 день";if(_t>14)return"Больничный может длиться не более 14 календарных дней в месяце";const Ce=new Date(we.getFullYear(),we.getMonth(),1),at=new Date(we.getFullYear(),we.getMonth()+1,0);if((await yr(_)).filter(Qe=>Qe.type==="sick"&&Qe.date>=ce(Ce,"yyyy-MM-dd")&&Qe.date<=ce(at,"yyyy-MM-dd")).length+_t>14)return"Больничный ограничен 14 днями в месяц"}if(Ie==="vacation"){if(Math.ceil((ke.getTime()-we.getTime())/864e5)+1>14)return"Отпуск не может быть больше 14 дней в месяце";const rt=new Date(we.getFullYear(),0,1),gt=new Date(we.getFullYear(),11,31);if((await yr(_)).filter(at=>at.type==="vacation"&&at.date>=ce(rt,"yyyy-MM-dd")&&at.date<=ce(gt,"yyyy-MM-dd")).length>=6)return"Не более 6 отпусков в год"}if(Ie==="dayoff"){const $e=new Date(we);$e.setDate($e.getDate()-$e.getDay()+1);const rt=new Date($e);rt.setDate($e.getDate()+6);let _t=(await yr(_)).filter(_e=>_e.type==="dayoff"&&_e.date>=ce($e,"yyyy-MM-dd")&&_e.date<=ce(rt,"yyyy-MM-dd"));if(e&&(_t=_t.filter(_e=>_e.id!==e.id)),_t.length>=2)return"Выходные на неделе ограничены максимум 2 днями";const at=(await yr()).filter(_e=>_e.type==="dayoff"&&_e.date===be),ye=new Set(at.map(_e=>_e.userId));if(e&&e.type==="dayoff"&&e.date===be&&ye.delete(e.userId),ye.size>=3)return"На этот день уже установлено максимальное количество выходных (3 человека). Выберите другую дату."}return null},Ae=async()=>{if(console.log("handleSave called (DayStatusForm)"),!o&&!a){console.log("No user found"),G("Пользователь не найден");return}if(!S){G("Выберите тип отсутствия");return}if(e&&!o&&a&&e.userId!==a.id){G("Вы можете редактировать только свои статусы"),y(!1);return}const _=Ee();if(_.length===0){G("Выберите хотя бы одного участника");return}if(ie&&w==="range"){if(!j||!f){G("Укажите даты начала и окончания");return}if(new Date(f)<new Date(j)){G("Дата окончания не может быть раньше даты начала");return}}const be=fe(S);if(be.length===0){G("Выберите даты");return}const Ne=async(Ie,ne)=>{if(!o){const ke=await pe(Ie,ne.date,ne.endDate,S);if(ke)throw new Error(`[${Y(Ie)} • ${ce(ne.date,"dd.MM.yyyy")}] ${ke}`)}const we={id:(e==null?void 0:e.id)||"",userId:Ie,date:ne.date,type:S,...ne.endDate&&{endDate:ne.endDate},...z&&{comment:z}};if(o){const{id:ke,...$e}=we;e?await gs(e.id,$e):await lo($e)}else await bt({entity:"status",action:e?"update":"create",authorId:(a==null?void 0:a.id)||Ie,targetUserId:Ie,before:e||null,after:we,comment:z||void 0})};console.log("Starting save process..."),G(""),y(!0);try{if(e){const Ie={date:x};S!=="dayoff"&&(C||e.endDate)&&(Ie.endDate=v),await Ne(e.userId,Ie),n();return}for(const Ie of _)for(const ne of be)await Ne(Ie,ne);n()}catch(Ie){console.error("Error saving day status:",Ie);const ne=Ie.message||Ie.code||"Ошибка при сохранении";G(ne)}finally{y(!1)}},qe={dayoff:"bg-yellow-500",sick:"bg-purple-500",vacation:"bg-orange-500"},Je={1:"Dex",2:"Enowk",3:"Xenia",4:"Olenka",5:"Sydney"},q=ie&&w==="range"?[`${ce(j,"dd.MM")}–${ce(f,"dd.MM")}`]:ie&&w==="multiple"?R.map(_=>ce(_,"dd.MM")):[ce(x,"dd.MM")],ae=h.map(_=>Y(_)).join(", "),De=[{label:"Тип",detail:S?S==="dayoff"?"Выходной":S==="sick"?"Больничный":"Отпуск":"Не выбран",done:!!S,anchor:"#type"},{label:"Members",detail:ae||"Не выбрано",done:h.length>0||!!e,anchor:"#members"},{label:"Даты",detail:q.slice(0,2).join(" · "),done:q.length>0,anchor:"#dates"},{label:"Комментарий",detail:z?"Заполнен":"Необязателен",done:!!z,anchor:"#notes"}],ee=Math.round(De.filter(_=>_.done).length/De.length*100),Me=[{value:"single",label:"Один день",hint:"Быстрая отметка",icon:"•"},{value:"range",label:S==="dayoff"?"Диапазон (каждый день)":"Диапазон дат",hint:"Поток дней",icon:"⎯⎯"},{value:"multiple",label:"Конкретные даты",hint:"Точечный выбор",icon:"◎"}],P=S?`${e?"Редактировать":"Добавить"} ${{dayoff:"выходной",sick:"больничный",vacation:"отпуск"}[S]}`:"Добавить отсутствие";return s.jsx("div",{className:"fixed inset-0 bg-slate-950/80 backdrop-blur-xl flex items-start sm:items-center justify-center z-[70] p-4 sm:p-6 touch-manipulation overflow-y-auto overscroll-contain modal-scroll",children:s.jsx("div",{className:`w-full max-w-[52rem] rounded-3xl shadow-[0_28px_80px_rgba(0,0,0,0.55)] border ${i==="dark"?"bg-[#0b1222] border-white/10":"bg-white border-slate-200"} max-h-[85dvh] sm:max-h-[calc(100dvh-96px)] overflow-y-auto relative`,children:s.jsxs("div",{className:"relative p-4 sm:p-6 lg:p-7 flex flex-col h-full min-h-0 overflow-y-auto modal-scroll",children:[s.jsxs("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-start sm:justify-between",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsx("h3",{className:`text-2xl sm:text-3xl font-bold ${c}`,children:P}),s.jsx("div",{className:"flex flex-wrap gap-2",children:De.map((_,be)=>s.jsxs("a",{href:_.anchor,className:`inline-flex items-center gap-2 px-3 py-1.5 rounded-full border text-xs transition ${_.done?"bg-[#4E6E49] border-[#4E6E49] text-white shadow-sm":i==="dark"?"border-white/15 bg-white/5 text-gray-200 hover:border-white/30":"border-slate-200 bg-white text-gray-700 hover:border-slate-300"}`,children:[s.jsx("span",{className:"font-semibold",children:be+1}),s.jsx("span",{className:"whitespace-nowrap",children:_.label})]},_.label))}),r==="dayoff"&&s.jsx("div",{className:"flex flex-wrap gap-2 text-xs sm:text-sm",children:["Один выходной","Диапазон дней","Несколько дат"].map(_=>s.jsx("span",{className:`px-3 py-1.5 rounded-full border ${i==="dark"?"border-white/10 text-gray-200 bg-white/5":"border-slate-200 text-gray-700 bg-slate-50"}`,children:_},_))})]}),s.jsx("button",{onClick:t,className:`p-2.5 rounded-full border shadow-sm transition hover:-translate-y-0.5 active:translate-y-0 ${i==="dark"?"border-white/10 text-gray-200 hover:bg-white/5":"border-slate-200 text-slate-600 hover:bg-slate-100"}`,children:s.jsx(Jt,{className:"w-5 h-5"})})]}),s.jsx("div",{className:`mt-5 rounded-2xl border ${i==="dark"?"border-white/10 bg-white/5":"border-slate-200 bg-white"} p-4 sm:p-5 shadow-inner`,children:s.jsxs("div",{className:"grid md:grid-cols-3 gap-3 md:gap-4",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"h-10 w-10 rounded-2xl bg-gradient-to-br from-emerald-500/20 to-emerald-400/10 flex items-center justify-center text-emerald-600 dark:text-emerald-300 text-lg font-semibold border border-emerald-500/30",children:"👥"}),s.jsxs("div",{children:[s.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Members"}),s.jsx("p",{className:"text-sm font-semibold text-gray-900 dark:text-gray-100 line-clamp-2",children:ae||"Не выбрано"})]})]}),s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"h-10 w-10 rounded-2xl bg-gradient-to-br from-blue-500/20 to-indigo-500/10 flex items-center justify-center text-blue-600 dark:text-blue-300 text-lg font-semibold border border-blue-500/30",children:"📅"}),s.jsxs("div",{children:[s.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Даты"}),s.jsx("p",{className:"text-sm font-semibold text-gray-900 dark:text-gray-100 line-clamp-2",children:q.length>0?q.join(" · "):"Не выбрано"})]})]}),s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"h-10 w-10 rounded-2xl bg-gradient-to-br from-amber-500/20 to-orange-500/10 flex items-center justify-center text-amber-600 dark:text-amber-300 text-lg font-semibold border border-amber-500/30",children:"✏️"}),s.jsxs("div",{children:[s.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Комментарий"}),s.jsx("p",{className:"text-sm font-semibold text-gray-900 dark:text-gray-100 line-clamp-2",children:z||"Необязателен"})]})]})]})}),s.jsxs("div",{className:"mt-5 grid lg:grid-cols-[0.9fr_1.4fr] gap-4 lg:gap-6 flex-1 overflow-hidden",children:[s.jsxs("aside",{className:`rounded-2xl border ${i==="dark"?"border-white/10 bg-white/5":"border-slate-200 bg-white"} p-4 sm:p-5 space-y-4 sticky top-2 self-start max-h-full overflow-y-auto`,children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("p",{className:"text-sm font-semibold",children:"Навигация"}),s.jsxs("span",{className:"text-[11px] uppercase tracking-wide text-[#4E6E49] font-semibold",children:[De.length," шага"]})]}),s.jsx("div",{className:"h-1.5 rounded-full bg-slate-200 dark:bg-white/10 overflow-hidden",children:s.jsx("div",{className:"h-full rounded-full bg-gradient-to-r from-[#4E6E49] via-emerald-500 to-lime-400 transition-all",style:{width:`${ee}%`}})}),s.jsx("div",{className:"space-y-2",children:De.map((_,be)=>s.jsxs("a",{href:_.anchor,className:`flex items-start gap-3 rounded-xl border px-3 py-3 transition ${i==="dark"?"border-white/10 bg-white/5 hover:border-white/30":"border-slate-200 bg-slate-50 hover:border-slate-300"}`,children:[s.jsx("span",{className:`mt-0.5 inline-flex h-7 w-7 items-center justify-center rounded-full text-xs font-bold ${_.done?"bg-[#4E6E49] text-white shadow-sm":i==="dark"?"bg-slate-800 text-gray-300":"bg-slate-200 text-slate-700"}`,children:be+1}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsx("p",{className:"text-sm font-semibold",children:_.label}),s.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 truncate",children:_.detail||"—"})]}),s.jsx("span",{className:"text-[11px] text-gray-400",children:_.done?"✓":""})]},_.label))})]}),s.jsxs("div",{className:"space-y-5 overflow-y-auto overscroll-contain pr-1 pb-6 flex-1 min-h-0",children:[!e&&!r&&s.jsxs("div",{id:"type",className:"scroll-mt-20 space-y-2",children:[s.jsx("p",{className:`text-xs sm:text-sm font-medium ${i==="dark"?"text-gray-300":"text-gray-700"}`,children:"Тип отсутствия"}),s.jsx("div",{className:"grid sm:grid-cols-3 gap-2",children:[{key:"dayoff",label:"Выходной",icon:"🌙"},{key:"sick",label:"Больничный",icon:"🏥"},{key:"vacation",label:"Отпуск",icon:"✈️"}].map(_=>s.jsxs("button",{type:"button",onClick:()=>I(_.key),className:`px-4 py-3 rounded-xl border text-sm font-semibold transition ${S===_.key?"border-[#4E6E49] bg-[#4E6E49]/10 text-[#4E6E49] shadow-sm":i==="dark"?"border-white/10 bg-white/5 text-gray-200 hover:border-white/30":"border-slate-200 bg-white text-gray-800 hover:border-slate-300"}`,children:[s.jsx("span",{className:"text-lg",children:_.icon}),s.jsx("span",{className:"block mt-1",children:_.label})]},_.key))})]}),ie&&s.jsxs("div",{id:"members",className:"scroll-mt-20",children:[s.jsx("label",{className:`block text-xs sm:text-sm font-medium mb-2 ${i==="dark"?"text-gray-300":"text-gray-700"}`,children:"Members"}),s.jsxs("div",{className:"space-y-3 rounded-2xl border border-dashed border-[#4E6E49]/30 p-3 sm:p-4 bg-[#4E6E49]/5 dark:bg-[#4E6E49]/10",children:[s.jsx("div",{className:"flex flex-wrap gap-2",children:Se.map(_=>{const be=h.includes(_.id);return s.jsxs("label",{className:`px-3 py-1.5 rounded-full border cursor-pointer text-sm flex items-center gap-2 transition ${be?"bg-[#4E6E49] border-[#4E6E49] text-white shadow-sm":i==="dark"?"bg-gray-800/60 border-gray-800 text-gray-200 hover:border-gray-600":"bg-gray-100 border-gray-300 text-gray-700 hover:border-gray-400"}`,children:[s.jsx("input",{type:"checkbox",checked:be,onChange:()=>B(_.id),className:"hidden"}),Je[_.id]||_.name]},_.id)})}),s.jsxs("div",{className:"flex items-center justify-between text-sm",children:[s.jsx("span",{className:`${i==="dark"?"text-gray-300":"text-gray-700"}`,children:"Быстрый выбор"}),s.jsx("button",{type:"button",onClick:ue,className:"text-sm text-[#4E6E49] hover:text-[#4E6E49] font-semibold",children:h.length===Se.length?"Снять выделение":"Выбрать всех"})]})]})]}),ie&&s.jsxs("div",{id:"dates",className:"scroll-mt-20",children:[s.jsx("p",{className:`text-xs sm:text-sm font-medium mb-2 ${i==="dark"?"text-gray-300":"text-gray-700"}`,children:"Формат выбора дат"}),s.jsx("div",{className:"grid sm:grid-cols-3 gap-2",children:Me.map(_=>{const be=w===_.value;return s.jsxs("button",{type:"button",onClick:()=>k(_.value),className:`w-full text-left px-3 py-3 rounded-xl border transition flex flex-col gap-1 ${be?"border-[#4E6E49] bg-[#4E6E49]/10 text-[#4E6E49] shadow-sm":i==="dark"?"border-white/10 bg-white/5 text-gray-200 hover:border-white/30":"border-slate-200 bg-white text-gray-800 hover:border-slate-300"}`,children:[s.jsx("span",{className:"text-lg leading-none",children:_.icon}),s.jsx("span",{className:"text-sm font-semibold",children:_.label}),s.jsx("span",{className:"text-[11px] text-gray-500 dark:text-gray-400",children:_.hint})]},_.value)})})]}),!ie&&r==="dayoff"&&s.jsxs("div",{id:"dates",className:"scroll-mt-20",children:[s.jsx("p",{className:`text-xs sm:text-sm font-medium mb-2 ${i==="dark"?"text-gray-300":"text-gray-700"}`,children:"Формат выбора дат"}),s.jsx("div",{className:"grid sm:grid-cols-3 gap-2",children:Me.map(_=>{const be=w===_.value;return s.jsxs("button",{type:"button",onClick:()=>k(_.value),className:`w-full text-left px-3 py-3 rounded-xl border transition flex flex-col gap-1 ${be?"border-[#4E6E49] bg-[#4E6E49]/10 text-[#4E6E49] shadow-sm":i==="dark"?"border-white/10 bg-white/5 text-gray-200 hover:border-white/30":"border-slate-200 bg-white text-gray-800 hover:border-slate-300"}`,children:[s.jsx("span",{className:"text-lg leading-none",children:_.icon}),s.jsx("span",{className:"text-sm font-semibold",children:_.label}),s.jsx("span",{className:"text-[11px] text-gray-500 dark:text-gray-400",children:_.hint})]},_.value)})})]}),(!ie||w==="single")&&s.jsxs("div",{children:[s.jsx("label",{className:`block text-xs sm:text-sm font-medium mb-2 ${i==="dark"?"text-gray-300":"text-gray-700"}`,children:"Дата начала"}),s.jsx("input",{type:"date",value:x,onChange:_=>p(_.target.value),className:`w-full px-3 sm:px-4 py-2 sm:py-2.5 text-sm sm:text-base rounded-lg border touch-manipulation ${i==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`})]}),ie&&w==="range"&&s.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:`block text-xs sm:text-sm font-medium mb-2 ${i==="dark"?"text-gray-300":"text-gray-700"}`,children:"Начало"}),s.jsx("input",{type:"date",value:j,onChange:_=>N(_.target.value),className:`w-full px-3 sm:px-4 py-2 sm:py-2.5 text-sm sm:text-base rounded-lg border touch-manipulation ${i==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`})]}),s.jsxs("div",{children:[s.jsx("label",{className:`block text-xs sm:text-sm font-medium mb-2 ${i==="dark"?"text-gray-300":"text-gray-700"}`,children:"Конец"}),s.jsx("input",{type:"date",value:f,min:j,onChange:_=>de(_.target.value),className:`w-full px-3 sm:px-4 py-2 sm:py-2.5 text-sm sm:text-base rounded-lg border touch-manipulation ${i==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`})]})]}),!ie&&r==="dayoff"&&w==="range"&&s.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:`block text-xs sm:text-sm font-medium mb-2 ${i==="dark"?"text-gray-300":"text-gray-700"}`,children:"Начало"}),s.jsx("input",{type:"date",value:j,onChange:_=>N(_.target.value),className:`w-full px-3 sm:px-4 py-2 sm:py-2.5 text-sm sm:text-base rounded-lg border touch-manipulation ${i==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`})]}),s.jsxs("div",{children:[s.jsx("label",{className:`block text-xs sm:text-sm font-medium mb-2 ${i==="dark"?"text-gray-300":"text-gray-700"}`,children:"Конец"}),s.jsx("input",{type:"date",value:f,min:j,onChange:_=>de(_.target.value),className:`w-full px-3 sm:px-4 py-2 sm:py-2.5 text-sm sm:text-base rounded-lg border touch-manipulation ${i==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`})]})]}),ie&&w==="multiple"&&s.jsxs("div",{children:[s.jsx("label",{className:`block text-xs sm:text-sm font-medium mb-2 ${i==="dark"?"text-gray-300":"text-gray-700"}`,children:"Выбранные даты"}),s.jsxs("div",{className:"flex flex-col gap-3",children:[s.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[s.jsx("input",{type:"date",value:V,onChange:_=>X(_.target.value),className:`flex-1 px-3 sm:px-4 py-2 sm:py-2.5 text-sm sm:text-base rounded-lg border touch-manipulation ${i==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`}),s.jsx("button",{type:"button",onClick:O,className:"px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg transition-colors",children:"Добавить"})]}),R.length>0?s.jsx("div",{className:"flex flex-wrap gap-2",children:R.map(_=>s.jsxs("span",{className:"inline-flex items-center gap-2 px-3 py-1.5 rounded-full bg-gray-100 text-gray-800 text-sm",children:[ce(_,"dd.MM.yyyy"),s.jsx("button",{type:"button",onClick:()=>ge(_),className:"text-red-500 hover:text-red-600",children:"x"})]},_))}):s.jsx("p",{className:"text-sm text-gray-500",children:"Пока не выбрано ни одной даты"})]})]}),!ie&&r==="dayoff"&&w==="multiple"&&s.jsxs("div",{children:[s.jsx("label",{className:`block text-xs sm:text-sm font-medium mb-2 ${i==="dark"?"text-gray-300":"text-gray-700"}`,children:"Выбранные даты"}),s.jsxs("div",{className:"flex flex-col gap-3",children:[s.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[s.jsx("input",{type:"date",value:V,onChange:_=>X(_.target.value),className:`flex-1 px-3 sm:px-4 py-2 sm:py-2.5 text-sm sm:text-base rounded-lg border touch-manipulation ${i==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`}),s.jsx("button",{type:"button",onClick:O,className:"px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg transition-colors",children:"Добавить"})]}),R.length>0?s.jsx("div",{className:"flex flex-wrap gap-2",children:R.map(_=>s.jsxs("span",{className:"inline-flex items-center gap-2 px-3 py-1.5 rounded-full bg-gray-100 text-gray-800 text-sm",children:[ce(_,"dd.MM.yyyy"),s.jsx("button",{type:"button",onClick:()=>ge(_),className:"text-red-500 hover:text-red-600",children:"x"})]},_))}):s.jsx("p",{className:"text-sm text-gray-500",children:"Пока не выбрано ни одной даты"})]})]}),w==="single"&&!ie&&S==="dayoff"&&s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{className:"rounded-xl border border-gray-200 dark:border-gray-800 p-3 sm:p-4 space-y-3",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("p",{className:`text-sm sm:text-base font-semibold ${c}`,children:"Повтор на неделю"}),s.jsx("p",{className:`text-xs ${i==="dark"?"text-gray-400":"text-gray-600"}`,children:"Выберите дни текущей недели"})]}),s.jsxs("label",{className:"inline-flex items-center gap-2",children:[s.jsx("input",{type:"checkbox",checked:Z,onChange:_=>oe(_.target.checked),className:"w-4 h-4"}),s.jsx("span",{className:"text-sm",children:"Активировать"})]})]}),Z&&s.jsx("div",{className:"flex flex-wrap gap-2",children:Q.map((_,be)=>{const Ne=F.includes(be);return s.jsx("button",{type:"button",onClick:()=>L(Ie=>Ne?Ie.filter(ne=>ne!==be):[...Ie,be]),className:`px-3 py-1 rounded-lg border text-sm ${Ne?"border-[#4E6E49] bg-[#4E6E49]/10 text-[#4E6E49]":i==="dark"?"border-white/10 bg-white/5 text-gray-200":"border-gray-200 bg-white text-gray-800"}`,children:_},_)})})]}),s.jsxs("div",{className:"rounded-xl border border-gray-200 dark:border-gray-800 p-3 sm:p-4 space-y-3",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("p",{className:`text-sm sm:text-base font-semibold ${c}`,children:"Повтор по месяцу"}),s.jsx("p",{className:`text-xs ${i==="dark"?"text-gray-400":"text-gray-600"}`,children:"На тот же день недели до конца месяца"})]}),s.jsxs("label",{className:"inline-flex items-center gap-2",children:[s.jsx("input",{type:"checkbox",checked:M,onChange:_=>re(_.target.checked),className:"w-4 h-4"}),s.jsx("span",{className:"text-sm",children:"Активировать"})]})]}),M&&s.jsx("div",{className:"flex flex-wrap gap-2",children:Q.map((_,be)=>s.jsx("span",{className:`px-3 py-1 rounded-lg border text-sm ${me.includes(be)?"border-[#4E6E49] bg-[#4E6E49]/10 text-[#4E6E49]":i==="dark"?"border-white/10 bg-white/5 text-gray-200":"border-gray-200 bg-white text-gray-800"}`,children:_},_))})]})]}),(S==="sick"||S==="vacation")&&(!ie||w==="single")&&s.jsxs("label",{className:"flex items-center gap-2",children:[s.jsx("input",{type:"checkbox",checked:C,onChange:_=>T(_.target.checked),className:"w-4 h-4"}),s.jsx("span",{className:`${i==="dark"?"text-gray-300":"text-gray-700"}`,children:"Несколько дней"})]}),C&&s.jsxs("div",{children:[s.jsx("label",{className:`block text-xs sm:text-sm font-medium mb-2 ${i==="dark"?"text-gray-300":"text-gray-700"}`,children:"Дата окончания"}),s.jsx("input",{type:"date",value:v,onChange:_=>A(_.target.value),min:x,className:`w-full px-3 sm:px-4 py-2 sm:py-2.5 text-sm sm:text-base rounded-lg border touch-manipulation ${i==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`})]}),s.jsxs("div",{children:[s.jsx("label",{className:`block text-xs sm:text-sm font-medium mb-2 ${i==="dark"?"text-gray-300":"text-gray-700"}`,children:"Комментарий"}),s.jsx("textarea",{value:z,onChange:_=>$(_.target.value),rows:3,className:`w-full px-3 sm:px-4 py-2 sm:py-2.5 text-sm sm:text-base rounded-lg border touch-manipulation resize-y ${i==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`,placeholder:"Добавьте комментарий (необязательно)"})]}),H&&s.jsx("div",{className:"p-3 bg-red-500 text-white rounded-lg text-sm",children:H}),s.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 sm:gap-3 pt-2",children:[s.jsx("button",{onClick:Ae,disabled:E||!S,className:`flex-1 px-4 py-2.5 sm:py-2 ${S?qe[S]:"bg-gray-400"} hover:opacity-90 disabled:opacity-50 disabled:cursor-not-allowed text-white rounded-lg sm:rounded-xl transition-colors text-sm sm:text-base font-medium touch-manipulation active:scale-95 disabled:active:scale-100`,children:E?"Отправка...":o?"Сохранить":"Отправить на согласование"}),s.jsx("button",{onClick:t,className:`px-4 py-2.5 sm:py-2 rounded-lg sm:rounded-xl transition-colors text-sm sm:text-base font-medium touch-manipulation active:scale-95 ${i==="dark"?"bg-gray-700 hover:bg-gray-600 active:bg-gray-500":"bg-gray-200 hover:bg-gray-300 active:bg-gray-400"}`,children:"Отмена"})]})]})]})]})})})},G_=({onClose:r,onSave:e})=>{const{user:t}=kt(),{theme:n}=it(),{isAdmin:a}=Tt(),i=n==="dark"?"text-white":"text-gray-900",[o,c]=D.useState(a?[]:t!=null&&t.id?[t.id]:[]),[d,h]=D.useState("slots"),[g,x]=D.useState(!1),[p,v]=D.useState(!1),[A,C]=D.useState(!1),[T,z]=D.useState([]),[$,S]=D.useState([]),[I,H]=D.useState(""),[G,E]=D.useState(""),[y,w]=D.useState(""),[k,j]=D.useState(""),[N,f]=D.useState(!1);In();const de=["Пн","Вт","Ср","Чт","Пт","Сб","Вс"],V=g?T.length>0?T.map(L=>de[L]).join(", "):"Дни недели":p?$[0]?`${ce($[0],"dd.MM")} +${Math.max($.length-1,0)}`:"Добавьте даты":A?G&&y?`${ce(G,"dd.MM")}–${ce(y,"dd.MM")}`:"Укажите диапазон":"Выберите режим",X=o.map(L=>{var M;return((M=Se.find(re=>re.id===L))==null?void 0:M.name)||L}).join(", "),R=L=>{c(M=>M.includes(L)?M.filter(re=>re!==L):[...M,L])},te=(L,M,re)=>{if(M&&re.some(Boolean)){j("Снимите галочку с другой функции, чтобы активировать эту");return}L(M),M||j("")},Z=()=>{if(!I){j("Выберите дату");return}if($.includes(I)){j("Эта дата уже добавлена");return}S([...$,I].sort()),H(""),j("")},oe=L=>S($.filter(M=>M!==L)),F=async()=>{var M;if(!a&&!t){j("Пользователь не найден");return}const L=a?o:t?[t.id]:[];if(L.length===0){j("Выберите хотя бы одного участника");return}if(!g&&!p&&!A){j("Выберите способ удаления");return}if(g&&T.length===0){j("Выберите день недели");return}if(p&&$.length===0){j("Добавьте хотя бы одну дату");return}if(A){if(!G||!y){j("Укажите начальную и конечную дату диапазона");return}if(G>y){j("Начальная дата должна быть раньше конечной");return}}j(""),f(!0);try{const re=await Promise.all(L.map(pe=>Kr(pe))),me=await Promise.all(L.map(pe=>yr(pe))),W=re.flat(),ie=me.flat(),Q=(pe,Ae)=>!G||!y?!1:!((Ae||pe)<G||pe>y),B=(pe,Ae)=>$.length===0?!1:Ae?$.some(qe=>qe>=pe&&qe<=(Ae||pe)):$.includes(pe),ue=(pe,Ae)=>{if(T.length===0)return!1;const qe=[],Je=new Date(pe+"T00:00:00"),q=Ae?new Date(Ae+"T00:00:00"):new Date(pe+"T00:00:00");let ae=Je;for(;ae<=q;)qe.push(ce(ae,"yyyy-MM-dd")),ae.setDate(ae.getDate()+1);return qe.some(De=>{const ee=new Date(De+"T00:00:00"),Me=ee.getDay()===0?6:ee.getDay()-1;return T.includes(Me)})};let O=[];if(d==="slots"?O=W.filter(pe=>!!(g&&ue(pe.date)||p&&$.includes(pe.date)||A&&Q(pe.date))).map(pe=>pe.id):O=ie.filter(pe=>pe.type!==d?!1:!!(g&&ue(pe.date,pe.endDate)||p&&B(pe.date,pe.endDate)||A&&Q(pe.date,pe.endDate))).map(pe=>pe.id),O.length===0){j("Ничего не найдено под выбранные условия"),f(!1);return}const ge=L.length>1?`${L.length} участников`:((M=Se.find(pe=>pe.id===L[0]))==null?void 0:M.name)||"участника",Ee=T.map(pe=>de[pe]).join(", "),Y=d==="slots"?"слоты":d==="dayoff"?"выходные":d==="sick"?"больничные":"отпуска",fe=g?`по дням недели (${Ee})`:p?`по датам: ${$.map(pe=>ce(pe,"dd.MM")).join(", ")}`:`по диапазону ${ce(G,"dd.MM")} — ${ce(y,"dd.MM")}`;if(!confirm(`Удалить ${Y} (${O.length}) ${fe} для ${ge}?`)){f(!1);return}if(d==="slots")for(const pe of O)await oo(pe);else for(const pe of O)await co(pe);e(),r()}catch(re){console.error("Error deleting items:",re),j("Ошибка при удалении")}finally{f(!1)}};return s.jsx("div",{className:"fixed inset-0 bg-slate-950/75 backdrop-blur-xl flex items-start sm:items-center justify-center z-[70] p-4 sm:p-6 overflow-y-auto overscroll-contain modal-scroll",children:s.jsx("div",{className:`w-full max-w-5xl rounded-3xl shadow-[0_24px_80px_rgba(0,0,0,0.45)] border ${n==="dark"?"bg-gradient-to-br from-[#0c1320] via-[#0b1220] to-[#08111b] border-white/10":"bg-gradient-to-br from-white via-slate-50 to-white border-slate-200"} max-h-[85dvh] sm:max-h-[calc(100dvh-96px)] overflow-y-auto`,children:s.jsxs("div",{className:"p-5 sm:p-6 lg:p-7 flex flex-col h-full min-h-0 overflow-y-auto modal-scroll",children:[s.jsxs("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between",children:[s.jsxs("div",{className:"space-y-1",children:[s.jsx("div",{className:"flex items-center gap-2 text-xs font-semibold text-[#4E6E49] tracking-tight",children:s.jsx("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full bg-[#4E6E49]/10 text-[#4E6E49] border border-[#4E6E49]/30",children:"Очистить расписание"})}),s.jsx("h3",{className:`text-2xl sm:text-3xl font-bold ${i}`,children:"Удаление слотов и отсутствий"})]}),s.jsx("button",{onClick:r,className:`p-2.5 rounded-full border ${n==="dark"?"border-white/10 text-gray-200 hover:bg-white/5":"border-slate-200 text-slate-600 hover:bg-slate-100"}`,children:s.jsx(Jt,{className:"w-5 h-5"})})]}),s.jsxs("div",{className:"mt-5 grid lg:grid-cols-[0.95fr_1.45fr] gap-4 lg:gap-6 flex-1 overflow-hidden",children:[s.jsxs("aside",{className:`rounded-2xl border ${n==="dark"?"border-white/10 bg-white/5":"border-slate-200 bg-white"} p-4 sm:p-5 space-y-4 sticky top-0 self-start max-h-full overflow-y-auto`,children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("p",{className:"text-sm font-semibold",children:"Навигация"}),s.jsx("span",{className:"text-[11px] uppercase tracking-wide text-[#4E6E49] font-semibold",children:"3 шага"})]}),s.jsx("div",{className:"space-y-2",children:[{label:"Участники",detail:X||"Не выбрано",done:o.length>0||!a},{label:"Тип удаления",detail:d==="slots"?"Слоты":d==="dayoff"?"Выходные":d==="sick"?"Больничные":"Отпуска",done:!0},{label:"Режим",detail:V,done:V!=="Выберите режим"}].map((L,M)=>s.jsxs("div",{className:`flex items-start gap-3 rounded-xl border px-3 py-3 ${n==="dark"?"border-white/10 bg-white/5":"border-slate-200 bg-slate-50"}`,children:[s.jsx("span",{className:`mt-0.5 inline-flex h-6 w-6 items-center justify-center rounded-full text-xs font-bold ${L.done?"bg-[#4E6E49] text-white":n==="dark"?"bg-slate-800 text-gray-300":"bg-slate-200 text-slate-700"}`,children:M+1}),s.jsxs("div",{className:"flex-1",children:[s.jsx("p",{className:"text-sm font-semibold",children:L.label}),s.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 truncate",children:L.detail||"—"})]})]},L.label))}),s.jsxs("div",{className:`rounded-xl border px-3 py-3 space-y-2 ${n==="dark"?"border-emerald-900/50 bg-emerald-900/20":"border-emerald-100 bg-emerald-50"}`,children:[s.jsx("p",{className:"text-xs uppercase tracking-wide text-emerald-600 font-semibold",children:"Подсказка"}),s.jsx("p",{className:"text-sm text-emerald-700 dark:text-emerald-200",children:"Один режим за раз: дни недели, конкретные даты или диапазон."})]})]}),s.jsxs("div",{className:"space-y-4 overflow-y-auto overscroll-contain pr-1 pb-6 flex-1 min-h-0",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsx("p",{className:`text-sm font-semibold ${i}`,children:"Что удаляем"}),s.jsx("div",{className:"flex flex-wrap gap-2",children:[{key:"slots",label:"Слоты"},{key:"dayoff",label:"Выходные"},{key:"sick",label:"Больничные"},{key:"vacation",label:"Отпуска"}].map(L=>s.jsx("button",{onClick:()=>h(L.key),className:`px-3 py-1.5 rounded-lg border text-sm ${d===L.key?"bg-red-500 text-white border-red-500":n==="dark"?"bg-gray-700 text-gray-200 border-gray-700 hover:bg-gray-600":"bg-gray-100 text-gray-800 border-gray-200 hover:bg-gray-200"}`,children:L.label},L.key))})]}),a&&s.jsxs("div",{className:"space-y-2",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("p",{className:`text-sm font-semibold ${i}`,children:"Участники"}),s.jsx("button",{onClick:()=>c(L=>L.length===Se.length?[]:Se.map(M=>M.id)),className:"text-xs text-[#4E6E49] font-semibold",children:o.length===Se.length?"Снять выделение":"Выбрать всех"})]}),s.jsx("div",{className:"flex flex-wrap gap-2",children:Se.map(L=>{const M=o.includes(L.id);return s.jsx("button",{onClick:()=>R(L.id),className:`px-3 py-1.5 rounded-lg transition-colors text-sm ${M?"bg-red-500 text-white":n==="dark"?"bg-gray-700 text-gray-300 hover:bg-gray-600":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:L.name},L.id)})})]}),s.jsxs("label",{className:"flex items-center gap-2",children:[s.jsx("input",{type:"checkbox",checked:g,onChange:L=>te(x,L.target.checked,[p,A]),className:"w-4 h-4"}),s.jsx("span",{className:`${n==="dark"?"text-gray-300":"text-gray-700"}`,children:"Удалить по дню недели"})]}),g&&s.jsxs("div",{className:"ml-6",children:[s.jsx("p",{className:`text-sm mb-2 ${n==="dark"?"text-gray-400":"text-gray-600"}`,children:"Выберите дни недели:"}),s.jsx("div",{className:"flex gap-2 flex-wrap",children:de.map((L,M)=>{const re=T.includes(M);return s.jsx("button",{onClick:()=>z(me=>re?me.filter(W=>W!==M):[...me,M]),className:`px-3 py-1 rounded-lg transition-colors ${re?"bg-red-500 text-white":n==="dark"?"bg-gray-700 text-gray-300":"bg-gray-200 text-gray-700"}`,children:L},L)})})]}),s.jsxs("label",{className:"flex items-center gap-2",children:[s.jsx("input",{type:"checkbox",checked:p,onChange:L=>te(v,L.target.checked,[g,A]),className:"w-4 h-4"}),s.jsx("span",{className:`${n==="dark"?"text-gray-300":"text-gray-700"}`,children:"Удалить по конкретным датам"})]}),p&&s.jsxs("div",{className:"ml-6 space-y-3",children:[s.jsxs("div",{className:"flex gap-2",children:[s.jsx("input",{type:"date",value:I,onChange:L=>H(L.target.value),className:`flex-1 px-4 py-2 rounded-lg border ${n==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-red-500`}),s.jsx("button",{onClick:Z,className:"px-4 py-2 bg-[#4E6E49] hover:bg-[#4E6E49] text-white rounded-lg transition-colors",children:"Добавить"})]}),$.length>0&&s.jsxs("div",{className:"space-y-2",children:[s.jsxs("p",{className:`text-sm ${n==="dark"?"text-gray-400":"text-gray-600"}`,children:["Выбранные даты (",$.length,"):"]}),s.jsx("div",{className:"flex flex-wrap gap-2",children:$.map(L=>s.jsxs("div",{className:`flex items-center gap-2 px-3 py-1 rounded-lg ${n==="dark"?"bg-gray-700":"bg-gray-100"}`,children:[s.jsx("span",{className:i,children:ce(L,"dd.MM.yyyy")}),s.jsx("button",{onClick:()=>oe(L),className:"p-1 text-red-500 hover:bg-red-500 hover:text-white rounded transition-colors",children:s.jsx(Jt,{className:"w-3 h-3"})})]},L))})]})]}),s.jsxs("label",{className:"flex items-center gap-2",children:[s.jsx("input",{type:"checkbox",checked:A,onChange:L=>te(C,L.target.checked,[g,p]),className:"w-4 h-4"}),s.jsx("span",{className:`${n==="dark"?"text-gray-300":"text-gray-700"}`,children:"Удалить по диапазону дат"})]}),A&&s.jsxs("div",{className:"ml-6 space-y-3",children:[s.jsxs("div",{className:"flex gap-2",children:[s.jsxs("div",{className:"flex-1",children:[s.jsx("label",{className:`block text-xs mb-1 ${n==="dark"?"text-gray-400":"text-gray-600"}`,children:"Начальная дата"}),s.jsx("input",{type:"date",value:G,onChange:L=>E(L.target.value),className:`w-full px-4 py-2 rounded-lg border ${n==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-red-500`})]}),s.jsxs("div",{className:"flex-1",children:[s.jsx("label",{className:`block text-xs mb-1 ${n==="dark"?"text-gray-400":"text-gray-600"}`,children:"Конечная дата"}),s.jsx("input",{type:"date",value:y,onChange:L=>w(L.target.value),min:G,className:`w-full px-4 py-2 rounded-lg border ${n==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-red-500`})]})]}),G&&y&&s.jsxs("p",{className:`text-sm ${n==="dark"?"text-gray-400":"text-gray-600"}`,children:["Будет удалено: с ",ce(G,"dd.MM.yyyy")," по ",ce(y,"dd.MM.yyyy")]})]}),k&&s.jsx("div",{className:"p-3 bg-red-500 text-white rounded-lg text-sm",children:k}),s.jsxs("div",{className:"flex gap-3",children:[s.jsxs("button",{onClick:F,disabled:N||!g&&!p&&!A,className:"flex-1 px-4 py-2 bg-red-500 hover:bg-red-600 disabled:bg-gray-400 disabled:cursor-not-allowed text-white rounded-lg transition-colors flex items-center justify-center gap-2",children:[s.jsx(Pt,{className:"w-4 h-4"}),N?"Удаление...":"Очистить расписание"]}),s.jsx("button",{onClick:r,className:`px-4 py-2 rounded-lg transition-colors ${n==="dark"?"bg-gray-700 hover:bg-gray-600":"bg-gray-200 hover:bg-gray-300"}`,children:"Отмена"})]})]})]})]})})})},K_=()=>{const{theme:r}=it(),[e,t]=D.useState("week"),[n,a]=D.useState("all"),[i,o]=D.useState(!1),[c,d]=D.useState(!1),[h,g]=D.useState(!1),[x,p]=D.useState(null),[v,A]=D.useState(null),[C,T]=D.useState(null),[z,$]=D.useState(null),[S,I]=D.useState("add-slot"),[H,G]=D.useState(0),[E,y]=D.useState({slotsThisWeek:0,activeMembers:0,upcomingSlots:0,completedSlots:0,recommendedWeek:0,recommendedDay:0,mostActive:"",leastActive:[],remainingSlots:0,todaySlots:0}),[w,k]=D.useState({nextStart:null,activeEnd:null}),[j,N]=D.useState({nextStart:"—",activeRemaining:"—"});D.useEffect(()=>{R()},[]),D.useEffect(()=>{const Y=(Ae,qe)=>{if(!Ae)return"—";const Je=Ae.getTime()-Date.now();if(Je<=0)return qe?"Слот завершён":"Уже начался";const q=Math.floor(Je/6e4),ae=Math.floor(q/(60*24)),De=Math.floor(q%(60*24)/60),ee=q%60;return ae>0?`${ae}д ${De}ч`:De>0?`${De}ч ${ee}м`:`${Math.max(ee,1)}м`},fe=()=>{N({nextStart:Y(w.nextStart,!1),activeRemaining:Y(w.activeEnd,!0)})};fe();const pe=setInterval(fe,6e4);return()=>clearInterval(pe)},[w]);const f=Y=>{const fe=new Date;fe.setHours(0,0,0,0);const pe=new Date(Y.date);if(pe.setHours(0,0,0,0),pe>fe)return!0;if(pe.getTime()===fe.getTime()){const qe=new Date,Je=qe.getHours()*60+qe.getMinutes();return Y.slots.some(q=>{if(q.endDate){const Me=new Date(q.endDate);if(Me.setHours(0,0,0,0),Me>fe)return!0;if(Me.getTime()===fe.getTime()){const[Ue,P]=q.end.split(":").map(Number);return Ue*60+P>Je}return!1}const[ae,De]=q.end.split(":").map(Number);return ae*60+De>Je})}return Y.slots.some(qe=>{if(qe.endDate){const Je=new Date(qe.endDate);return Je.setHours(0,0,0,0),Je>=fe}return!1})},de={1:"Dex",2:"Enowk",3:"Xenia",4:"Olenka",5:"Sydney"},V={artyom:"1",adel:"2",kseniya:"3",olga:"4",anastasia:"5"},X=Y=>{const fe=Se.find(pe=>pe.id===Y)||Se.find(pe=>V[Y]===pe.id);return de[(fe==null?void 0:fe.id)||Y]||(fe==null?void 0:fe.name)||Y},R=async()=>{var Y,fe;try{const pe=new Date,Ae=kc(pe),qe=ce(Ae[0],"yyyy-MM-dd"),Je=ce(Ae[6],"yyyy-MM-dd"),q=ce(pe,"yyyy-MM-dd"),[ae,De]=await Promise.all([Kr(),yr()]),ee=ae.filter(ye=>ye.date>=qe&&ye.date<=Je),Me=ae.filter(ye=>ye.date===q),Ue=new Set([...ee.flatMap(ye=>[ye.userId,...ye.participants||[]]),...De.map(ye=>ye.userId)]),P=ee.filter(f).length,_=ee.length-P,be=Math.max(0,15-ee.length),Ne=Math.max(0,3-Me.length),Ie={};Se.forEach(ye=>{Ie[ye.id]=0}),ee.forEach(ye=>{new Set([ye.userId,...ye.participants||[]]).forEach(Qe=>{Ie[Qe]!==void 0&&(Ie[Qe]=(Ie[Qe]||0)+1)})});const ne=Object.entries(Ie).sort((ye,_e)=>_e[1]-ye[1]),we=(Y=ne[0])!=null&&Y[1]?X(ne[0][0]):"Нет данных",ke=Math.min(...Object.values(Ie)),$e=Object.entries(Ie).filter(([,ye])=>ye===ke).map(([ye])=>X(ye)).slice(0,3),rt=ae.flatMap(ye=>{const _e=ye.date;return(ye.slots||[]).map(Qe=>{const Qr=new Date(`${_e}T${Qe.start}`);let Ht=Qe.endDate?new Date(`${Qe.endDate}T${Qe.end}`):new Date(`${_e}T${Qe.end}`);if(!Qe.endDate&&Ht.getTime()<=Qr.getTime()){const J=new Date(_e);J.setDate(J.getDate()+1),Ht=new Date(`${ce(J,"yyyy-MM-dd")}T${Qe.end}`)}return{start:Qr,end:Ht}})}),gt=rt.filter(ye=>pe>=ye.start&&pe<=ye.end),_t=gt.length?new Date(Math.min(...gt.map(ye=>ye.end.getTime()))):null,at=((fe=rt.filter(ye=>ye.start>pe).sort((ye,_e)=>ye.start.getTime()-_e.start.getTime())[0])==null?void 0:fe.start)||null;y({slotsThisWeek:ee.length,activeMembers:Ue.size,upcomingSlots:P,completedSlots:_,recommendedWeek:be,recommendedDay:Ne,mostActive:we,leastActive:$e,remainingSlots:P,todaySlots:Me.length}),k({nextStart:at,activeEnd:_t})}catch(pe){console.error("Error loading stats:",pe)}},te=()=>{T(null),o(!0)},Z=Y=>{T(Y),o(!0)},oe=()=>{p(null),$(null),g(!0),I("absence")},F=Y=>{$(Y),p(Y.type),g(!0)},L=()=>{d(!0)},M=()=>{o(!1),d(!1),g(!1),p(null),T(null),$(null),R(),G(Y=>Y+1)},re=r==="dark"?"text-white":"text-gray-900",me=r==="dark"?"text-gray-300":"text-gray-700",W=r==="dark"?"border-[#4E6E49]/30 bg-gradient-to-br from-[#1a1a1a] via-[#1a1a1a] to-[#0A0A0A]":"border-green-200 bg-gradient-to-br from-white via-green-50/30 to-white",ie=`rounded-2xl p-4 sm:p-6 md:p-8 border-2 ${W}`,Q=`rounded-2xl border ${r==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white"}`,B=r==="dark"?"text-gray-400":"text-gray-600",ue=`rounded-2xl p-4 sm:p-5 border-2 ${W}`,O={emerald:{bg:r==="dark"?"bg-emerald-500/10":"bg-emerald-50",text:r==="dark"?"text-emerald-100":"text-emerald-800",border:r==="dark"?"border-emerald-500/30":"border-emerald-200"},purple:{bg:r==="dark"?"bg-purple-500/10":"bg-purple-50",text:r==="dark"?"text-purple-100":"text-purple-800",border:r==="dark"?"border-purple-500/30":"border-purple-200"},amber:{bg:r==="dark"?"bg-amber-500/10":"bg-amber-50",text:r==="dark"?"text-amber-100":"text-amber-800",border:r==="dark"?"border-amber-500/30":"border-amber-200"},slate:{bg:r==="dark"?"bg-gray-500/10":"bg-gray-50",text:r==="dark"?"text-gray-100":"text-gray-800",border:r==="dark"?"border-gray-500/30":"border-gray-200"},blue:{bg:r==="dark"?"bg-blue-500/10":"bg-blue-50",text:r==="dark"?"text-blue-100":"text-blue-800",border:r==="dark"?"border-blue-500/30":"border-blue-200"},green:{bg:r==="dark"?"bg-green-500/10":"bg-green-50",text:r==="dark"?"text-green-100":"text-green-800",border:r==="dark"?"border-green-500/30":"border-green-200"},sky:{bg:r==="dark"?"bg-sky-500/10":"bg-sky-50",text:r==="dark"?"text-sky-100":"text-sky-800",border:r==="dark"?"border-sky-500/30":"border-sky-200"},pink:{bg:r==="dark"?"bg-pink-500/10":"bg-pink-50",text:r==="dark"?"text-pink-100":"text-pink-800",border:r==="dark"?"border-pink-500/30":"border-pink-200"}},ge=Y=>{t(Y)},Ee=[{label:"Сколько ещё добавить слотов",value:`${Math.max(E.recommendedDay,0)} в день`,note:`Неделя: ${Math.max(E.recommendedWeek,0)} до цели 15`,icon:s.jsx(Nt,{className:"w-4 h-4"}),tone:"emerald"},{label:"Активные члены",value:E.activeMembers,note:"за неделю",icon:s.jsx(bn,{className:"w-4 h-4"}),tone:"purple"},{label:"Самый активный член недели",value:E.mostActive||"Нет данных",note:"по слотам",icon:s.jsx(mh,{className:"w-4 h-4"}),tone:"amber"},{label:"Самые неактивные члены недели",value:E.leastActive.length?E.leastActive.join(", "):"Нет данных",note:"минимум слотов",icon:s.jsx(_p,{className:"w-4 h-4"}),tone:"slate"},{label:"Осталось слотов на неделе",value:E.remainingSlots,note:"предстоящие",icon:s.jsx(Vp,{className:"w-4 h-4"}),tone:"blue"},{label:"Завершено слотов на неделе",value:E.completedSlots,note:"факт",icon:s.jsx(Io,{className:"w-4 h-4"}),tone:"green"},{label:"Таймер ближайшего слота",value:j.nextStart,note:"до старта",icon:s.jsx(yh,{className:"w-4 h-4"}),tone:"sky"},{label:"До окончания активного слота",value:j.activeRemaining,note:"если слот идёт",icon:s.jsx(Ps,{className:"w-4 h-4"}),tone:"pink"}];return s.jsx(cr,{children:s.jsxs("div",{className:"space-y-5 sm:space-y-7",children:[s.jsxs("div",{id:"schedule-overview",className:`relative overflow-hidden ${ie} p-5 sm:p-6 md:p-8 ${r==="dark"?"bg-gradient-to-br from-[#0e1b2c] via-[#0c1827] to-[#0a1420]":"bg-gradient-to-br from-white via-emerald-50/40 to-sky-50"}`,children:[s.jsxs("div",{className:"absolute inset-0 pointer-events-none",children:[s.jsx("div",{className:"absolute -top-32 -left-16 w-80 h-80 bg-gradient-to-br from-[#4E6E49]/18 via-sky-500/8 to-transparent blur-3xl"}),s.jsx("div",{className:"absolute top-0 right-0 w-[26rem] h-[26rem] bg-gradient-to-bl from-sky-400/14 via-emerald-400/12 to-transparent blur-3xl"}),s.jsx("div",{className:"absolute bottom-[-140px] left-14 w-80 h-80 bg-gradient-to-tr from-sky-300/12 via-[#4E6E49]/12 to-transparent blur-3xl"})]}),s.jsx("div",{className:"relative z-10 grid grid-cols-1 gap-5",children:s.jsxs("div",{className:`${Q} backdrop-blur p-4 sm:p-5 space-y-4`,children:[s.jsx("div",{className:"flex flex-col gap-4 sm:gap-5 lg:flex-row lg:items-center lg:justify-between",children:s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"p-3 rounded-2xl bg-white/80 dark:bg-white/5 border border-white/40 dark:border-white/10 shadow-lg",children:s.jsx(Io,{className:"w-6 h-6 text-[#4E6E49]"})}),s.jsx("div",{className:"flex items-center",children:s.jsxs("h1",{className:`text-xl sm:text-3xl font-extrabold leading-tight ${r==="dark"?"text-white":"text-gray-900"}`,children:[s.jsx("span",{className:"sm:inline hidden",children:"Расписание команды"}),s.jsx("span",{className:"sm:hidden inline",children:"Расписание"})]})})]})}),s.jsx("div",{className:"grid sm:grid-cols-2 lg:grid-cols-4 gap-3",children:Ee.map(Y=>{const fe=O[Y.tone];return s.jsxs("div",{className:`p-4 rounded-xl border-2 ${fe.border} ${fe.bg} shadow-sm space-y-2`,children:[s.jsxs("div",{className:"flex items-start justify-between gap-3",children:[s.jsx("p",{className:`text-[11px] sm:text-xs font-semibold uppercase tracking-wide ${fe.text}`,children:Y.label}),s.jsx("span",{className:`inline-flex items-center gap-1 px-2 py-1 rounded-lg text-[11px] font-semibold border ${fe.border} ${fe.text} ${r==="dark"?"bg-white/5":"bg-white/80"}`,children:Y.icon})]}),s.jsx("p",{className:`text-lg sm:text-2xl font-extrabold ${re}`,children:Y.value}),s.jsx("p",{className:`text-xs ${B}`,children:Y.note})]},Y.label)})})]})})]}),s.jsxs("div",{id:"schedule-actions",className:`${ie} p-4 sm:p-5 space-y-5`,children:[s.jsx("div",{className:"space-y-3",children:s.jsxs("div",{className:"flex flex-wrap items-center gap-3 lg:justify-between",children:[s.jsxs("div",{className:`flex items-center gap-2 rounded-xl border ${r==="dark"?"border-gray-800 bg-gray-900/70":"border-gray-200 bg-gray-50"} px-1.5 py-1 shrink-0`,children:[s.jsxs("button",{onClick:()=>ge("table"),className:`px-3 sm:px-4 py-2 text-sm font-semibold flex items-center gap-2 transition-all rounded-lg ${e==="table"?"bg-[#4E6E49] text-white shadow-lg":r==="dark"?"text-gray-300 hover:bg-gray-800":"text-gray-700 hover:bg-white"}`,children:[s.jsx(rf,{className:"w-4 h-4"}),"Таблица"]}),s.jsxs("button",{onClick:()=>ge("week"),className:`px-3 sm:px-4 py-2 text-sm font-semibold flex items-center gap-2 transition-all rounded-lg ${e==="week"?"bg-[#4E6E49] text-white shadow-lg":r==="dark"?"text-gray-300 hover:bg-gray-800":"text-gray-700 hover:bg-white"}`,children:[s.jsx(Ur,{className:"w-4 h-4"}),"Неделя"]})]}),s.jsx("div",{className:"flex flex-wrap gap-2 shrink",children:[{key:"all",label:"Все",icon:s.jsx(Ur,{className:"w-4 h-4"})},{key:"upcoming",label:"Предстоящие",icon:s.jsx(Ps,{className:"w-4 h-4"})},{key:"completed",label:"Завершённые",icon:s.jsx(Io,{className:"w-4 h-4"})}].map(Y=>s.jsxs("button",{onClick:()=>a(Y.key),className:`px-3 py-2 rounded-xl text-sm font-semibold flex items-center gap-2 transition-all border ${n===Y.key?"bg-gradient-to-r from-[#4E6E49] to-emerald-600 text-white border-transparent shadow-lg":r==="dark"?"border-gray-800 bg-gray-900/70 text-gray-200 hover:border-[#4E6E49]/40":"border-gray-200 bg-gray-50 text-gray-700 hover:border-[#4E6E49]/40"}`,children:[Y.icon,Y.label]},Y.key))})]})}),s.jsxs("div",{className:`${Q} p-3 sm:p-4 space-y-3`,children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("p",{className:`text-sm font-semibold ${re}`,children:"Действие"}),s.jsx("span",{className:"text-[11px] uppercase tracking-wide text-gray-500 dark:text-gray-400",children:"выбор задачи"})]}),s.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-2",children:[{key:"add-slot",label:"Добавить слот",desc:"Разовое или серия",icon:s.jsx(fh,{className:"w-5 h-5"}),tone:"bg-emerald-100 text-emerald-800 border-emerald-200 dark:bg-emerald-900/30 dark:text-emerald-100 dark:border-emerald-800",action:te},{key:"delete-slots",label:"Очистить расписание",desc:"Удалить слоты/статусы",icon:s.jsx(Pt,{className:"w-5 h-5"}),tone:"bg-rose-100 text-rose-800 border-rose-200 dark:bg-rose-900/30 dark:text-rose-100 dark:border-rose-800",action:L},{key:"absence",label:"Добавить отсутствие",desc:"Выходной, больничный, отпуск",icon:s.jsx(kl,{className:"w-5 h-5"}),tone:"bg-teal-100 text-teal-800 border-teal-200 dark:bg-teal-900/30 dark:text-teal-100 dark:border-teal-800",action:oe}].map(Y=>s.jsxs("button",{onClick:()=>{I(Y.key),Y.action()},className:`text-left rounded-xl border px-3 py-3 transition-all shadow-sm flex items-start gap-3 h-full ${S===Y.key?`${Y.tone} ring-2 ring-[#4E6E49]/50 shadow-lg`:`${r==="dark"?"border-gray-800 bg-gray-950/60 text-gray-100":"border-gray-200 bg-white text-gray-900"} hover:-translate-y-0.5 hover:shadow-md`}`,children:[s.jsx("span",{className:`p-2 rounded-lg ${S===Y.key?"bg-white/30":r==="dark"?"bg-gray-800":"bg-gray-100"}`,children:Y.icon}),s.jsxs("span",{className:"flex flex-col whitespace-normal leading-snug gap-0.5 w-full",children:[s.jsx("span",{className:"text-[13px] sm:text-sm font-semibold break-words leading-tight",children:Y.label}),s.jsx("span",{className:"text-[11px] sm:text-xs text-gray-500 dark:text-gray-400 break-words leading-tight",children:Y.desc})]})]},Y.key))})]}),s.jsxs("div",{className:`${Q} p-3 sm:p-4 space-y-2`,children:[s.jsx("p",{className:`text-sm font-semibold ${re}`,children:"Members"}),s.jsxs("div",{className:"flex gap-2 overflow-x-auto pb-1",children:[s.jsx("button",{onClick:()=>A(null),className:`px-3 py-2 rounded-xl text-sm font-semibold whitespace-nowrap border transition ${v===null?"bg-gradient-to-r from-[#4E6E49] to-[#4E6E49] text-white border-transparent shadow-lg":r==="dark"?"bg-gray-900/70 border-gray-800 text-gray-200 hover:border-[#4E6E49]/40":"bg-gray-50 border-gray-200 text-gray-700 hover:border-[#4E6E49]/40"}`,children:"Все Members"}),Se.map(Y=>s.jsxs("button",{onClick:()=>A(Y.id),className:`px-3 py-2 rounded-xl text-sm font-semibold whitespace-nowrap border transition flex items-center gap-2 ${v===Y.id?"bg-gradient-to-r from-[#4E6E49] to-[#4E6E49] text-white border-transparent shadow-lg":r==="dark"?"bg-gray-900/70 border-gray-800 text-gray-200 hover:border-[#4E6E49]/40":"bg-gray-50 border-gray-200 text-gray-700 hover:border-[#4E6E49]/40"}`,children:[s.jsx("span",{className:"inline-flex items-center justify-center w-7 h-7 rounded-full bg-gradient-to-br from-[#4E6E49]/30 to-blue-500/30 text-xs font-bold",children:(de[Y.id]||Y.name).charAt(0)}),de[Y.id]||Y.name]},Y.id))]})]})]}),s.jsx("div",{id:"schedule-view",className:ue,children:s.jsxs("div",{className:`${Q} p-4 sm:p-5 flex flex-col gap-4`,children:[s.jsx("div",{className:"flex items-center justify-between flex-wrap gap-2 text-left",children:s.jsxs("div",{className:"text-left",children:[s.jsx("p",{className:`text-sm sm:text-base font-semibold ${re}`,children:"Расписание"}),s.jsx("p",{className:`text-xs sm:text-sm ${me}`,children:"Слоты и статусы за выбранную неделю"})]})}),e==="table"?s.jsx(q_,{selectedUserId:v,slotFilter:n,refreshKey:H,onEditSlot:Z,onEditStatus:F}):s.jsx(W_,{selectedUserId:v,slotFilter:n,refreshKey:H,onEditSlot:Z,onEditStatus:F})]})}),i&&s.jsx(z_,{slot:C,onClose:M,onSave:M}),c&&s.jsx(G_,{onClose:M,onSave:M}),h&&s.jsx(H_,{type:x||void 0,status:z,onClose:M,onSave:M})]})})},Un=.45,Y_=({onClose:r,onSave:e,editingEarning:t})=>{var B,ue;const{user:n}=kt(),{isAdmin:a}=Tt(),{theme:i}=it(),o=i==="dark"?"text-white":"text-gray-900",c=!!t,[d,h]=D.useState((t==null?void 0:t.date)||ce(new Date,"yyyy-MM-dd")),[g,x]=D.useState((t==null?void 0:t.slotId)||""),[p,v]=D.useState((t==null?void 0:t.amount.toString())||""),[A,C]=D.useState(((B=t==null?void 0:t.extraWalletsCount)==null?void 0:B.toString())||""),[T,z]=D.useState(((ue=t==null?void 0:t.extraWalletsAmount)==null?void 0:ue.toString())||""),[$,S]=D.useState((t==null?void 0:t.category)||"memecoins"),[I,H]=D.useState(t?t.participants.length>1:!1),[G,E]=D.useState(t?t.participants.filter(O=>O!==t.userId):[]),[y,w]=D.useState([]),[k,j]=D.useState([]),[N,f]=D.useState(""),[de,V]=D.useState(!1);In();const X=(O,ge="w-4 h-4")=>{switch(O){case"memecoins":return s.jsx(ya,{className:ge});case"futures":return s.jsx(xa,{className:ge});case"nft":return s.jsx(fa,{className:ge});case"spot":return s.jsx(pr,{className:ge});case"polymarket":return s.jsx(wl,{className:ge});case"staking":return s.jsx(Ui,{className:ge});default:return s.jsx(Yt,{className:ge})}},R=()=>{var O;return c&&t?(O=t.participants)!=null&&O.length?t.participants:[t.userId]:a&&!n?G:n?I?Array.from(new Set([n.id,...G])):[n.id]:[]},te=R(),Z=te.length,oe=Z||1,F=O=>{const ge=parseFloat(O.replace(",","."));return Number.isFinite(ge)?ge:0},L=D.useMemo(()=>{const O=F(p),ge=F(T),Ee=Math.max(O+ge,0),Y=Ee>0?parseFloat((Ee*Un).toFixed(2)):0,fe=Math.max(Ee-Y,0),pe=oe>0?parseFloat((fe/oe).toFixed(2)):0;return{gross:Ee,pool:Y,net:fe,share:pe}},[p,T,oe]);D.useEffect(()=>{M()},[d,n,c]);const M=async()=>{if(!(!a&&!n&&!c))try{const O=c||a?await Kr(void 0,d):await Kr(n.id,d),ge=yl(),Ee=ce(ge,"yyyy-MM-dd"),Y=c?O:O.filter(fe=>{if(d!==Ee)return a;const pe=fe.slots[fe.slots.length-1];return Ku(pe.end,ge)||a});w(Y)}catch(O){console.error("Error loading slots:",O)}},re=O=>{G.includes(O)?E(G.filter(ge=>ge!==O)):E([...G,O])},me=()=>{const O=F(p),ge=F(T),Ee=parseInt(A||"0",10);if(!O&&!ge)return f("Укажите сумму заработка (основную или по доп. кошелькам)"),null;if(O<0||ge<0)return f("Суммы не могут быть отрицательными"),null;if(!$)return f("Выберите сферу заработка"),null;const Y=R();if(Y.length===0)return f("Выберите хотя бы одного участника"),null;const fe=O+ge;return{id:crypto.randomUUID?crypto.randomUUID():`${Date.now()}-${Math.random()}`,category:$,amount:fe,extraWalletsAmount:ge,extraWalletsCount:Number.isFinite(Ee)?Ee:0,participants:Y}},W=()=>{f("");const O=me();O&&(j([...k,O]),v(""),z(""),C(""),E([]),H(!1))},ie=O=>{j(ge=>ge.filter(Ee=>Ee.id!==O))},Q=async()=>{if(!a&&!n&&!c){f("Пользователь не найден");return}f(""),V(!0);try{if(!g){f("Выберите слот"),V(!1);return}const O=y.find(Y=>Y.id===g);if(!O&&!c){f("Выбранный слот не найден"),V(!1);return}if(!a&&!c){const Y=yl(),fe=ce(Y,"yyyy-MM-dd");if(d!==fe){f("Можно добавить заработок только за сегодня"),V(!1);return}if(O){const pe=O.slots[O.slots.length-1];if(!Ku(pe.end,Y)){f("Слот еще идет или еще не начат. Можно добавить заработок после 21:00 МСК или после окончания слота"),V(!1);return}}}const ge=Y=>({userId:Y.userId,date:d,amount:Y.amount,poolAmount:Y.poolAmount,slotId:g,category:Y.category,participants:Y.participants,extraWalletsAmount:Y.extraWalletsAmount,extraWalletsCount:Y.extraWalletsCount}),Ee=async(Y,fe,pe)=>{a?fe==="update"&&t?await Ug(t.id,Y):await Fg(Y):await bt({entity:"earning",action:fe,authorId:(n==null?void 0:n.id)||Y.userId,targetUserId:Y.userId,before:pe||null,after:{id:(t==null?void 0:t.id)||"",...Y}})};if(c&&t){const Y=me();if(!Y){V(!1);return}await Ee(ge({userId:t.userId,amount:Y.amount,poolAmount:parseFloat((Y.amount*Un).toFixed(2)),category:Y.category,participants:Y.participants,extraWalletsAmount:Y.extraWalletsAmount,extraWalletsCount:Y.extraWalletsCount}),"update",t)}else{let Y=k;if(Y.length===0){const fe=me();if(!fe){V(!1);return}Y=[fe]}for(const fe of Y)await Ee(ge({userId:fe.participants[0],amount:fe.amount,poolAmount:parseFloat((fe.amount*Un).toFixed(2)),category:fe.category,participants:fe.participants,extraWalletsAmount:fe.extraWalletsAmount,extraWalletsCount:fe.extraWalletsCount}),"create")}e()}catch(O){console.error("Error saving earnings:",O);const ge=O.message||O.code||"Ошибка при сохранении";f(ge)}finally{V(!1)}};return s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-start sm:items-center justify-center z-[70] p-4 sm:p-6 touch-manipulation overflow-y-auto overflow-x-hidden overscroll-contain modal-scroll",children:s.jsxs("div",{className:`w-full max-w-[540px] sm:max-w-3xl rounded-2xl sm:rounded-3xl shadow-xl ${i==="dark"?"bg-[#1a1a1a]":"bg-white"} max-h-[85dvh] sm:max-h-[calc(100dvh-96px)] flex flex-col overflow-hidden`,children:[s.jsx("div",{className:"flex-shrink-0 p-4 sm:p-6",children:s.jsxs("div",{className:"flex items-center justify-between mb-4 sm:mb-6",children:[s.jsx("h3",{className:`text-lg sm:text-xl font-bold ${o} pr-2`,children:c?"Редактировать заработок":"Добавить заработок"}),s.jsx("button",{onClick:r,className:`p-1.5 sm:p-2 rounded-lg flex-shrink-0 ${i==="dark"?"hover:bg-gray-700 active:bg-gray-600 text-gray-200":"hover:bg-gray-100 active:bg-gray-200 text-gray-700"} transition-colors touch-manipulation`,"aria-label":"Закрыть",children:s.jsx(Jt,{className:"w-4 h-4 sm:w-5 sm:h-5"})})]})}),s.jsx("div",{className:"flex-1 min-h-0 overflow-y-auto overflow-x-hidden overscroll-contain modal-scroll px-4 sm:px-6",children:s.jsxs("div",{className:"space-y-3 sm:space-y-4 pb-8 min-w-0",children:[s.jsxs("div",{children:[s.jsxs("label",{className:`flex flex-col sm:flex-row sm:items-center sm:justify-between text-xs sm:text-sm font-medium mb-2 gap-1 sm:gap-2 ${i==="dark"?"text-gray-300":"text-gray-700"}`,children:[s.jsx("span",{children:"Дата"}),!a&&!c&&s.jsx("span",{className:"text-[10px] sm:text-xs text-gray-400 whitespace-nowrap",children:"Доступна только текущая дата"})]}),s.jsx("input",{type:"date",value:d,onChange:O=>h(O.target.value),disabled:!a&&!c,className:`w-full px-3 sm:px-4 py-2 sm:py-2.5 text-sm sm:text-base rounded-lg border touch-manipulation ${i==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49] disabled:opacity-50 disabled:cursor-not-allowed`}),c&&!a&&s.jsx("p",{className:`mt-1 text-xs ${i==="dark"?"text-gray-400":"text-gray-500"}`,children:"Только администратор может изменить дату"})]}),s.jsxs("div",{children:[s.jsx("label",{className:`block text-xs sm:text-sm font-medium mb-2 ${i==="dark"?"text-gray-300":"text-gray-700"}`,children:"Слот"}),s.jsxs("select",{value:g,onChange:O=>x(O.target.value),className:`w-full px-3 sm:px-4 py-2 sm:py-2.5 text-sm sm:text-base rounded-lg border touch-manipulation ${i==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`,children:[s.jsx("option",{value:"",children:"Выберите слот"}),y.map(O=>s.jsx("option",{value:O.id,children:O.slots.map(ge=>`${ge.start}-${ge.end}`).join(", ")},O.id)),c&&t&&!y.find(O=>O.id===t.slotId)&&s.jsx("option",{value:t.slotId,disabled:!0,children:"[Текущий слот - не найден]"})]}),c&&t&&!y.find(O=>O.id===t.slotId)&&s.jsx("p",{className:`mt-1 text-xs ${i==="dark"?"text-gray-400":"text-gray-500"}`,children:"Текущий слот не найден в списке. Выберите другой слот или оставьте текущий."})]}),s.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[s.jsxs("div",{children:[s.jsx("label",{className:`block text-xs sm:text-sm font-medium mb-2 ${i==="dark"?"text-gray-300":"text-gray-700"}`,children:"Сумма заработка (руб.)"}),s.jsx("input",{type:"number",value:p,onChange:O=>v(O.target.value),className:`w-full px-3 sm:px-4 py-2 sm:py-2.5 text-sm sm:text-base rounded-lg border touch-manipulation ${i==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`,placeholder:"0",min:"0",step:"100"})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[s.jsxs("div",{children:[s.jsx("label",{className:`block text-xs sm:text-sm font-medium mb-2 ${i==="dark"?"text-gray-300":"text-gray-700"}`,children:"Кол-во доп. кошельков"}),s.jsx("input",{type:"number",value:A,onChange:O=>C(O.target.value),className:`w-full px-3 sm:px-4 py-2 sm:py-2.5 text-sm sm:text-base rounded-lg border touch-manipulation ${i==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`,placeholder:"0",min:"0",step:"1"})]}),s.jsxs("div",{children:[s.jsx("label",{className:`block text-xs sm:text-sm font-medium mb-2 ${i==="dark"?"text-gray-300":"text-gray-700"}`,children:"Доп. кошельки (руб.)"}),s.jsx("input",{type:"number",value:T,onChange:O=>z(O.target.value),className:`w-full px-3 sm:px-4 py-2 sm:py-2.5 text-sm sm:text-base rounded-lg border touch-manipulation ${i==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`,placeholder:"0",min:"0",step:"100"})]})]}),s.jsx("div",{className:"space-y-1 text-[11px] text-gray-500",children:s.jsx("p",{children:"Общая сумма = основная + доп. кошельки. Пул 45% считается с общей суммы."})})]})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsxs("div",{className:"flex items-center justify-between gap-2",children:[s.jsx("label",{className:`text-xs sm:text-sm font-medium ${i==="dark"?"text-gray-300":"text-gray-700"}`,children:"Сфера заработка"}),s.jsx("span",{className:"text-[10px] sm:text-xs text-gray-400",children:"Влияет на статистику"})]}),s.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-2",children:Object.entries(Ts).map(([O,ge])=>s.jsxs("button",{type:"button",onClick:()=>S(O),className:`flex items-center gap-2 px-3 py-2 rounded-lg border text-left transition-all ${$===O?"border-[#4E6E49] bg-[#4E6E49]/10 text-[#4E6E49]":i==="dark"?"border-gray-800 bg-gray-800/60 text-gray-200 hover:border-[#4E6E49]/40":"border-gray-200 bg-white text-gray-800 hover:border-[#4E6E49]/40"}`,children:[s.jsx("span",{className:"p-1.5 rounded-lg bg-gray-100 dark:bg-gray-800/80",children:X(O,"w-4 h-4")}),s.jsxs("div",{className:"flex flex-col leading-tight",children:[s.jsx("span",{className:"text-sm font-semibold",children:ge.label}),s.jsx("span",{className:"text-[11px] text-gray-500",children:"45% пул / 55% чистыми"})]})]},O))})]}),s.jsxs(s.Fragment,{children:[s.jsxs("label",{className:"flex items-center gap-2",children:[s.jsx("input",{type:"checkbox",checked:I,onChange:O=>H(O.target.checked),className:"w-4 h-4"}),s.jsx("span",{className:`${i==="dark"?"text-gray-300":"text-gray-700"}`,children:"Отметить несколько участников"})]}),(I||a&&!n)&&s.jsx("div",{className:"ml-0 sm:ml-2 grid grid-cols-2 sm:grid-cols-3 gap-2",children:Se.filter(O=>!n||O.id!==n.id).map(O=>s.jsxs("label",{className:"flex items-center gap-2 rounded-lg px-2 py-1 border border-gray-200 dark:border-gray-800",children:[s.jsx("input",{type:"checkbox",checked:G.includes(O.id),onChange:()=>re(O.id),className:"w-4 h-4"}),s.jsx("span",{className:i==="dark"?"text-gray-300":"text-gray-700",children:O.name})]},O.id))})]}),s.jsxs("div",{className:`p-4 rounded-xl border ${i==="dark"?"border-gray-800 bg-gray-900/60":"border-gray-200 bg-gray-50"}`,children:[s.jsxs("div",{className:"flex items-center justify-between gap-2 mb-3",children:[s.jsxs("div",{children:[s.jsx("p",{className:`text-xs font-semibold ${i==="dark"?"text-gray-200":"text-gray-800"}`,children:"Авторасчет"}),s.jsx("p",{className:"text-[11px] text-gray-500",children:"Пул 45% + деление между участниками"})]}),s.jsxs("span",{className:"text-[11px] px-2 py-1 rounded-full bg-[#4E6E49]/10 text-[#4E6E49] font-semibold",children:[Z||0," участн."]})]}),s.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-2 mb-3",children:[s.jsxs("div",{className:`p-3 rounded-lg ${i==="dark"?"bg-gray-800/70":"bg-white"}`,children:[s.jsx("p",{className:"text-[11px] text-gray-500",children:"Пул (45%)"}),s.jsxs("p",{className:"text-lg font-bold text-purple-500",children:[L.pool.toFixed(2)," ₽"]})]}),s.jsxs("div",{className:`p-3 rounded-lg ${i==="dark"?"bg-gray-800/70":"bg-white"}`,children:[s.jsx("p",{className:"text-[11px] text-gray-500",children:"Чистыми после пула"}),s.jsxs("p",{className:"text-lg font-bold text-emerald-500",children:[L.net.toFixed(2)," ₽"]})]}),s.jsxs("div",{className:`p-3 rounded-lg ${i==="dark"?"bg-gray-800/70":"bg-white"}`,children:[s.jsx("p",{className:"text-[11px] text-gray-500",children:"На каждого"}),s.jsxs("p",{className:"text-lg font-bold text-[#4E6E49]",children:[L.share.toFixed(2)," ₽"]})]})]}),s.jsxs("div",{className:`text-xs ${i==="dark"?"text-gray-400":"text-gray-600"} mb-1`,children:["Отмеченные участники получат по ",L.share.toFixed(2)," ₽"]}),s.jsx("div",{className:"flex flex-wrap gap-2",children:te.length===0?s.jsx("span",{className:"text-xs text-gray-400",children:"Нет выбранных участников"}):te.map(O=>{var ge;return s.jsx("span",{className:`px-2.5 py-1 rounded-full text-xs font-semibold border ${i==="dark"?"border-gray-800 bg-gray-800/70 text-gray-100":"border-gray-200 bg-white text-gray-800"}`,children:((ge=Se.find(Ee=>Ee.id===O))==null?void 0:ge.name)||O},O)})})]}),!c&&k.length>0&&s.jsxs("div",{className:`rounded-xl border ${i==="dark"?"border-gray-800 bg-gray-900/70":"border-gray-200 bg-gray-50"} p-3 sm:p-4 space-y-3`,children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("p",{className:`text-sm font-semibold ${i==="dark"?"text-gray-200":"text-gray-800"}`,children:"Добавленные записи"}),s.jsxs("span",{className:"text-xs text-gray-500",children:[k.length," шт."]})]}),s.jsx("div",{className:"space-y-2 max-h-64 overflow-y-auto pr-1",children:k.map(O=>s.jsxs("div",{className:`flex flex-col sm:flex-row sm:items-center justify-between gap-3 p-3 rounded-lg border ${i==="dark"?"border-gray-800 bg-gray-800/60":"border-gray-200 bg-white"}`,children:[s.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[s.jsx("div",{className:"p-2 rounded-lg bg-gray-100 dark:bg-gray-900/70",children:X(O.category,"w-4 h-4")}),s.jsxs("div",{className:"min-w-0",children:[s.jsxs("p",{className:"text-sm font-semibold flex items-center gap-2",children:[Ts[O.category].label,s.jsxs("span",{className:"text-[11px] text-gray-500",children:["(",O.participants.length," уч.)"]})]}),s.jsxs("p",{className:"text-xs text-gray-500 whitespace-normal break-words",children:["Гросс ",O.amount.toFixed(0)," ₽ • Пул ",(O.amount*Un).toFixed(0)," ₽ • Чистыми ",(O.amount-O.amount*Un).toFixed(0)," ₽"]}),O.extraWalletsAmount>0&&s.jsxs("p",{className:"text-[11px] text-gray-500",children:["Доп. кошельки: ",O.extraWalletsCount," на ",O.extraWalletsAmount.toFixed(0)," ₽"]})]})]}),s.jsx("button",{type:"button",onClick:()=>ie(O.id),className:`self-start sm:self-center p-2 rounded-lg ${i==="dark"?"hover:bg-gray-700 text-red-400":"hover:bg-gray-100 text-red-600"}`,"aria-label":"Удалить запись",children:s.jsx(Pt,{className:"w-4 h-4"})})]},O.id))})]}),N&&s.jsx("div",{className:"p-3 bg-red-500 text-white rounded-lg text-sm",children:N}),s.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 sm:gap-3 pt-2",children:[!c&&s.jsxs("button",{type:"button",onClick:W,disabled:de,className:"flex-1 sm:flex-none sm:px-4 px-4 py-2.5 sm:py-2 border border-[#4E6E49] text-[#4E6E49] rounded-lg sm:rounded-xl font-medium flex items-center justify-center gap-2 hover:bg-[#4E6E49]/10 active:scale-95 transition-colors",children:[s.jsx(fh,{className:"w-4 h-4"}),"Добавить в список"]}),s.jsx("button",{onClick:Q,disabled:de,className:"flex-1 px-4 py-2.5 sm:py-2 bg-[#4E6E49] hover:bg-[#4E6E49] disabled:bg-gray-400 disabled:cursor-not-allowed text-white rounded-lg sm:rounded-xl transition-colors text-sm sm:text-base font-medium touch-manipulation active:scale-95 disabled:active:scale-100",children:de?"Сохранение...":c?"Сохранить":"Сохранить все"}),s.jsx("button",{type:"button",onClick:r,className:`flex-1 px-4 py-2.5 sm:py-2 rounded-lg sm:rounded-xl border text-sm sm:text-base font-medium transition-colors touch-manipulation active:scale-95 ${i==="dark"?"border-gray-700 text-gray-200 hover:bg-gray-800":"border-gray-300 text-gray-800 hover:bg-gray-100"}`,children:"Отмена"})]})]})})]})})},Q_=({earnings:r})=>{const{theme:e}=it(),t=.45,n=Ca(),a=ce(n.start,"yyyy-MM-dd"),i=ce(n.end,"yyyy-MM-dd"),o=ce(new Date(new Date().getFullYear(),new Date().getMonth(),1),"yyyy-MM-dd"),c=ce(new Date(new Date().getFullYear(),new Date().getMonth()+1,0),"yyyy-MM-dd"),d=(v,A,C)=>{const T=r.filter(S=>(S.participants&&S.participants.length>0?[...S.participants,S.userId]:[S.userId]).includes(v)&&S.date>=A&&S.date<=C),z=T.reduce((S,I)=>{const H=I.participants&&I.participants.length>0?I.participants.length:1,G=I.poolAmount||I.amount*t,E=Math.max(I.amount-G,0);return S+E/H},0),$=T.reduce((S,I)=>{const H=I.participants&&I.participants.length>0?I.participants.length:1,G=I.poolAmount||I.amount*t;return S+G/H},0);return{totalEarnings:z,totalPool:$,count:T.length}},h=Se.reduce((v,A)=>{const C=d(A.id,a,i);return v+C.totalEarnings},0),g=Se.reduce((v,A)=>{const C=d(A.id,a,i);return v+C.totalPool},0),x=Se.reduce((v,A)=>{const C=d(A.id,o,c);return v+C.totalEarnings},0),p=Se.reduce((v,A)=>{const C=d(A.id,o,c);return v+C.totalPool},0);return s.jsx("div",{className:`rounded-2xl ${e==="dark"?"bg-[#1a1a1a]":"bg-white"} shadow-lg border-2 ${e==="dark"?"border-gray-800":"border-gray-200"} overflow-hidden`,children:s.jsxs("div",{className:"p-6",children:[s.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[s.jsx("div",{className:`p-2 rounded-lg ${e==="dark"?"bg-blue-500/20":"bg-blue-100"}`,children:s.jsx(Ms,{className:`w-5 h-5 ${e==="dark"?"text-blue-400":"text-blue-600"}`})}),s.jsx("h3",{className:`text-xl font-bold ${e==="dark"?"text-white":"text-gray-900"}`,children:"Статистика заработка"})]}),s.jsxs("div",{className:"mb-6",children:[s.jsx("h4",{className:`text-lg font-semibold mb-4 px-2 ${e==="dark"?"text-white":"text-gray-900"}`,children:"За неделю"}),s.jsx("div",{className:"overflow-x-auto rounded-xl border-2 border-gray-800/50 dark:border-gray-800",children:s.jsxs("table",{className:"w-full",children:[s.jsx("thead",{children:s.jsxs("tr",{className:`${e==="dark"?"bg-gray-700/50":"bg-gray-100"}`,children:[s.jsx("th",{className:`px-4 py-3 text-left text-sm font-semibold ${e==="dark"?"text-white":"text-gray-900"}`,children:"Участник"}),s.jsx("th",{className:`px-4 py-3 text-right text-sm font-semibold ${e==="dark"?"text-white":"text-gray-900"}`,children:"Чистыми"}),s.jsx("th",{className:`px-4 py-3 text-right text-sm font-semibold ${e==="dark"?"text-white":"text-gray-900"}`,children:"Пул 45%"})]})}),s.jsxs("tbody",{children:[Se.map(v=>{const A=d(v.id,a,i);return s.jsxs("tr",{className:`border-b border-gray-800/30 dark:border-gray-800 transition-colors ${e==="dark"?"hover:bg-gray-700/30":"hover:bg-gray-50"}`,children:[s.jsx("td",{className:`px-4 py-3 font-medium ${e==="dark"?"text-white":"text-gray-900"}`,children:v.name}),s.jsxs("td",{className:"px-4 py-3 text-right font-semibold text-[#4E6E49]",children:[A.totalEarnings.toFixed(2)," ₽"]}),s.jsxs("td",{className:`px-4 py-3 text-right font-semibold ${e==="dark"?"text-purple-400":"text-purple-600"}`,children:[A.totalPool.toFixed(2)," ₽"]})]},v.id)}),s.jsxs("tr",{className:`${e==="dark"?"bg-gray-700/70":"bg-gray-100"} font-bold border-t-2 border-gray-800/50 dark:border-gray-800`,children:[s.jsx("td",{className:`px-4 py-3 ${e==="dark"?"text-white":"text-gray-900"}`,children:"Итого команды"}),s.jsxs("td",{className:"px-4 py-3 text-right text-[#4E6E49]",children:[h.toFixed(2)," ₽"]}),s.jsxs("td",{className:`px-4 py-3 text-right ${e==="dark"?"text-purple-400":"text-purple-600"}`,children:[g.toFixed(2)," ₽"]})]})]})]})})]}),s.jsxs("div",{children:[s.jsx("h4",{className:`text-lg font-semibold mb-4 px-2 ${e==="dark"?"text-white":"text-gray-900"}`,children:"За месяц"}),s.jsx("div",{className:"overflow-x-auto rounded-xl border-2 border-gray-800/50 dark:border-gray-800",children:s.jsxs("table",{className:"w-full",children:[s.jsx("thead",{children:s.jsxs("tr",{className:`${e==="dark"?"bg-gray-700/50":"bg-gray-100"}`,children:[s.jsx("th",{className:`px-4 py-3 text-left text-sm font-semibold ${e==="dark"?"text-white":"text-gray-900"}`,children:"Участник"}),s.jsx("th",{className:`px-4 py-3 text-right text-sm font-semibold ${e==="dark"?"text-white":"text-gray-900"}`,children:"Чистыми"}),s.jsx("th",{className:`px-4 py-3 text-right text-sm font-semibold ${e==="dark"?"text-white":"text-gray-900"}`,children:"Пул 45%"})]})}),s.jsxs("tbody",{children:[Se.map(v=>{const A=d(v.id,o,c);return s.jsxs("tr",{className:`border-b border-gray-800/30 dark:border-gray-800 transition-colors ${e==="dark"?"hover:bg-gray-700/30":"hover:bg-gray-50"}`,children:[s.jsx("td",{className:`px-4 py-3 font-medium ${e==="dark"?"text-white":"text-gray-900"}`,children:v.name}),s.jsxs("td",{className:"px-4 py-3 text-right font-semibold text-[#4E6E49]",children:[A.totalEarnings.toFixed(2)," ₽"]}),s.jsxs("td",{className:`px-4 py-3 text-right font-semibold ${e==="dark"?"text-purple-400":"text-purple-600"}`,children:[A.totalPool.toFixed(2)," ₽"]})]},v.id)}),s.jsxs("tr",{className:`${e==="dark"?"bg-gray-700/70":"bg-gray-100"} font-bold border-t-2 border-gray-800/50 dark:border-gray-800`,children:[s.jsx("td",{className:`px-4 py-3 ${e==="dark"?"text-white":"text-gray-900"}`,children:"Итого команды"}),s.jsxs("td",{className:"px-4 py-3 text-right text-[#4E6E49]",children:[x.toFixed(2)," ₽"]}),s.jsxs("td",{className:`px-4 py-3 text-right ${e==="dark"?"text-purple-400":"text-purple-600"}`,children:[p.toFixed(2)," ₽"]})]})]})]})})]})]})})},X_=({earnings:r,onEdit:e,onDelete:t})=>{const{theme:n}=it(),{user:a}=kt(),{isAdmin:i}=Tt(),[o,c]=D.useState(null),d=.45,h=(S,I="w-4 h-4")=>{switch(S){case"memecoins":return s.jsx(ya,{className:I});case"futures":return s.jsx(xa,{className:I});case"nft":return s.jsx(fa,{className:I});case"spot":return s.jsx(pr,{className:I});case"polymarket":return s.jsx(wl,{className:I});case"staking":return s.jsx(Ui,{className:I});default:return s.jsx(Yt,{className:I})}},g=async S=>{if(confirm("Вы уверены, что хотите удалить эту запись о заработке?")){c(S.id);try{i?await Bg(S.id):await bt({entity:"earning",action:"delete",authorId:(a==null?void 0:a.id)||S.userId,targetUserId:S.userId,before:S,after:null}),t()}catch(I){console.error("Error deleting earnings:",I),alert("Ошибка при удалении записи")}finally{c(null)}}},x=S=>S.participants&&S.participants.length>0?S.participants:[S.userId],p=S=>S.poolAmount||S.amount*d,v=S=>Math.max(S.amount-p(S),0),A=S=>{const I=x(S);return I.length?v(S)/I.length:v(S)},C=S=>Ts[S]||Ts.other,T=S=>{var I;return((I=Se.find(H=>H.id===S))==null?void 0:I.name)||S},z=S=>i||S.userId===(a==null?void 0:a.id),$=[...r].sort((S,I)=>I.date.localeCompare(S.date));return $.length===0?s.jsxs("div",{className:`rounded-2xl p-8 text-center border-2 ${n==="dark"?"bg-[#1a1a1a] border-gray-800":"bg-white border-gray-200"} shadow-md`,children:[s.jsx("p",{className:`${n==="dark"?"text-gray-400":"text-gray-600"} text-lg`,children:"Пока нет записей о заработке"}),s.jsx("p",{className:"text-gray-500 text-sm mt-2",children:"Добавьте первую запись, чтобы начать отслеживать доходы команды"})]}):s.jsx("div",{className:`rounded-2xl ${n==="dark"?"bg-[#1a1a1a]":"bg-white"} shadow-lg border-2 ${n==="dark"?"border-gray-800":"border-gray-200"} overflow-hidden`,children:s.jsxs("div",{className:"p-6",children:[s.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[s.jsx("div",{className:`p-2 rounded-lg ${n==="dark"?"bg-blue-500/20":"bg-blue-100"}`,children:s.jsx(fd,{className:`w-5 h-5 ${n==="dark"?"text-blue-400":"text-blue-600"}`})}),s.jsx("h3",{className:`text-xl font-bold ${n==="dark"?"text-white":"text-gray-900"}`,children:"Все записи о заработке"})]}),s.jsx("div",{className:"overflow-x-auto rounded-xl border-2 border-gray-800/50 dark:border-gray-800",children:s.jsxs("table",{className:"w-full",children:[s.jsx("thead",{children:s.jsxs("tr",{className:`${n==="dark"?"bg-gray-700/50":"bg-gray-100"}`,children:[s.jsx("th",{className:`px-4 py-3 text-left text-sm font-semibold ${n==="dark"?"text-white":"text-gray-900"}`,children:"Дата"}),s.jsx("th",{className:`px-4 py-3 text-left text-sm font-semibold ${n==="dark"?"text-white":"text-gray-900"}`,children:"Сфера"}),s.jsx("th",{className:`px-4 py-3 text-left text-sm font-semibold ${n==="dark"?"text-white":"text-gray-900"}`,children:"Участники"}),s.jsx("th",{className:`px-4 py-3 text-right text-sm font-semibold ${n==="dark"?"text-white":"text-gray-900"}`,children:"Чистыми"}),s.jsx("th",{className:`px-4 py-3 text-right text-sm font-semibold ${n==="dark"?"text-white":"text-gray-900"}`,children:"Пул 45%"}),s.jsx("th",{className:`px-4 py-3 text-center text-sm font-semibold ${n==="dark"?"text-white":"text-gray-900"}`,children:"Действия"})]})}),s.jsx("tbody",{children:$.map(S=>{const I=x(S),H=C(S.category),G=v(S),E=A(S),y=z(S);return s.jsxs("tr",{className:`border-b border-gray-800/30 dark:border-gray-800 transition-colors ${n==="dark"?"hover:bg-gray-700/30":"hover:bg-gray-50"}`,children:[s.jsx("td",{className:`px-4 py-3 font-medium ${n==="dark"?"text-white":"text-gray-900"}`,children:ce(new Date(S.date+"T00:00:00"),"dd.MM.yyyy")}),s.jsx("td",{className:"px-4 py-3",children:s.jsxs("span",{className:`inline-flex items-center gap-2 px-2.5 py-1 rounded-full text-xs font-semibold ${n==="dark"?"bg-gray-800 text-gray-100":"bg-gray-100 text-gray-900"}`,children:[h(S.category,"w-4 h-4"),H.label]})}),s.jsx("td",{className:"px-4 py-3",children:s.jsx("div",{className:"flex flex-wrap gap-2",children:I.map(w=>s.jsx("span",{className:`px-2.5 py-1 rounded-full text-xs font-semibold border ${n==="dark"?"border-gray-800 bg-gray-800/70 text-gray-100":"border-gray-200 bg-white text-gray-800"}`,children:T(w)},w))})}),s.jsxs("td",{className:"px-4 py-3 text-right font-semibold text-[#4E6E49]",children:[s.jsxs("div",{children:[G.toFixed(2)," ₽"]}),s.jsxs("div",{className:"text-xs text-gray-500",children:["по ",E.toFixed(2)," ₽"]}),S.extraWalletsAmount?s.jsxs("div",{className:"text-[11px] text-gray-500 flex items-center gap-1 mt-1",children:[s.jsx(of,{className:"w-3 h-3"}),S.extraWalletsCount||0," / ",S.extraWalletsAmount.toFixed(0)," ₽"]}):null]}),s.jsxs("td",{className:`px-4 py-3 text-right font-semibold ${n==="dark"?"text-purple-400":"text-purple-600"}`,children:[p(S).toFixed(2)," ₽"]}),s.jsx("td",{className:"px-4 py-3 text-center",children:y?s.jsxs("div",{className:"flex items-center justify-center gap-2",children:[s.jsx("button",{onClick:()=>e(S),className:`p-2 rounded-lg transition-colors ${n==="dark"?"hover:bg-gray-600 text-blue-400":"hover:bg-gray-200 text-blue-600"}`,title:"Редактировать",children:s.jsx(fd,{className:"w-4 h-4"})}),s.jsx("button",{onClick:()=>g(S),disabled:o===S.id,className:`p-2 rounded-lg transition-colors ${n==="dark"?"hover:bg-gray-600 text-red-400":"hover:bg-gray-200 text-red-600"} disabled:opacity-50 disabled:cursor-not-allowed`,title:"Удалить",children:s.jsx(Pt,{className:"w-4 h-4"})})]}):s.jsx("span",{className:`text-sm ${n==="dark"?"text-gray-500":"text-gray-400"}`,children:"—"})})]},S.id)})})]})})]})})},J_=()=>{const{theme:r}=it(),[e,t]=D.useState(!1),[n,a]=D.useState(null),[i,o]=D.useState([]),[c,d]=D.useState(!0),[h,g]=D.useState({weekTotal:0,weekPool:0,weekNet:0,monthTotal:0,monthPool:0,monthNet:0}),x=.45,p=Object.keys(Ts),v=r==="dark"?"bg-[#1a1a1a]":"bg-white",A=N=>N.poolAmount||N.amount*x,C=N=>Math.max(N.amount-A(N),0),T=N=>{var f;return(f=N.participants)!=null&&f.length?N.participants:[N.userId]},z=N=>{var f;return((f=Se.find(de=>de.id===N))==null?void 0:f.name)||N},$=(N,f="w-4 h-4")=>{switch(N){case"memecoins":return s.jsx(ya,{className:f});case"futures":return s.jsx(xa,{className:f});case"nft":return s.jsx(fa,{className:f});case"spot":return s.jsx(pr,{className:f});case"polymarket":return s.jsx(wl,{className:f});case"staking":return s.jsx(Ui,{className:f});default:return s.jsx(Yt,{className:f})}},S=()=>{const N=Ca(),f=ce(N.start,"yyyy-MM-dd"),de=ce(N.end,"yyyy-MM-dd"),V=ce(new Date(new Date().getFullYear(),new Date().getMonth(),1),"yyyy-MM-dd"),X=ce(new Date(new Date().getFullYear(),new Date().getMonth()+1,0),"yyyy-MM-dd"),R=i.filter(Z=>Z.date>=f&&Z.date<=de),te=i.filter(Z=>Z.date>=V&&Z.date<=X);g({weekTotal:R.reduce((Z,oe)=>Z+oe.amount,0),weekPool:R.reduce((Z,oe)=>Z+A(oe),0),weekNet:R.reduce((Z,oe)=>Z+C(oe),0),monthTotal:te.reduce((Z,oe)=>Z+oe.amount,0),monthPool:te.reduce((Z,oe)=>Z+A(oe),0),monthNet:te.reduce((Z,oe)=>Z+C(oe),0)})};D.useEffect(()=>{I()},[]),D.useEffect(()=>{S()},[i]);const I=async()=>{d(!0);try{const N=await ma();o(N)}catch(N){console.error("Error loading earnings:",N)}finally{d(!1)}},H=N=>{a(N),t(!0)},G=()=>{t(!1),a(null)},E=()=>{t(!1),a(null),I()},y=p.map(N=>{const f=i.filter(Z=>Z.category===N),de=f.reduce((Z,oe)=>Z+oe.amount,0),V=f.reduce((Z,oe)=>Z+A(oe),0),X=f.reduce((Z,oe)=>Z+C(oe),0),R=new Map;f.forEach(Z=>{const oe=T(Z),F=C(Z)/Math.max(oe.length,1);oe.forEach(L=>{R.set(L,(R.get(L)||0)+F)})});const te=Array.from(R.entries()).sort((Z,oe)=>oe[1]-Z[1]).slice(0,2);return{key:N,gross:de,pool:V,net:X,count:f.length,topParticipants:te}}),w=Se.map(N=>{const f=i.filter(X=>T(X).includes(N.id)),de=f.reduce((X,R)=>{const te=C(R)/Math.max(T(R).length,1);return X+te},0),V=f.reduce((X,R)=>{const te=A(R)/Math.max(T(R).length,1);return X+te},0);return{...N,net:de,poolShare:V}}).sort((N,f)=>f.net-N.net),k=[...y].sort((N,f)=>f.net-N.net)[0],j=w[0];return s.jsx(cr,{children:s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:`rounded-xl sm:rounded-2xl p-4 sm:p-6 md:p-8 ${v} shadow-xl border-2 ${r==="dark"?"border-[#4E6E49]/30 bg-gradient-to-br from-[#1a1a1a] via-[#1a1a1a] to-[#0A0A0A]":"border-green-200 bg-gradient-to-br from-white via-green-50/30 to-white"} relative overflow-hidden`,children:[s.jsx("div",{className:"absolute top-0 right-0 w-32 h-32 sm:w-64 sm:h-64 bg-gradient-to-br from-[#4E6E49]/10 to-emerald-700/10 rounded-full blur-3xl -mr-16 sm:-mr-32 -mt-16 sm:-mt-32"}),s.jsx("div",{className:"absolute bottom-0 left-0 w-24 h-24 sm:w-48 sm:h-48 bg-gradient-to-tr from-yellow-500/10 to-orange-500/10 rounded-full blur-2xl -ml-12 sm:-ml-24 -mb-12 sm:-mb-24"}),s.jsx("div",{className:"relative z-10",children:s.jsxs("div",{className:"flex flex-col gap-4 sm:gap-6 lg:flex-row lg:items-start lg:justify-between mb-4 sm:mb-6",children:[s.jsxs("div",{className:"flex-1 min-w-0 space-y-3 sm:space-y-4",children:[s.jsxs("div",{className:"flex items-center gap-3 sm:gap-4",children:[s.jsx("div",{className:"p-3 sm:p-4 rounded-xl sm:rounded-2xl shadow-lg flex-shrink-0 bg-gradient-to-br from-[#4E6E49] to-emerald-700 text-white transform transition-transform active:scale-95 sm:hover:scale-110",children:s.jsx(Fi,{className:"w-5 h-5 sm:w-7 sm:h-7"})}),s.jsx("div",{className:"flex-1 min-w-0",children:s.jsxs("h1",{className:"text-2xl sm:text-3xl md:text-4xl font-extrabold text-white flex items-center gap-2 sm:gap-3 drop-shadow-lg",children:[s.jsx("span",{children:"Заработок команды"}),s.jsx(Yt,{className:`w-5 h-5 sm:w-6 sm:h-6 flex-shrink-0 ${r==="dark"?"text-yellow-300":"text-yellow-500"} animate-pulse`})]})})]}),s.jsx("p",{className:`text-sm sm:text-base font-medium ${r==="dark"?"text-gray-400":"text-gray-600"}`,children:"Отслеживайте доходы и вклад каждого участника в общий успех"}),s.jsx("div",{className:"flex flex-wrap gap-2",children:[{href:"#earn-stats",label:"Обзор"},{href:"#earn-history",label:"История"},{href:"#earn-insights",label:"Инсайты"}].map(N=>s.jsx("a",{href:N.href,className:`px-3 py-1.5 rounded-lg text-xs font-semibold border transition ${r==="dark"?"border-white/10 bg-white/5 text-white hover:border-[#4E6E49]/50":"border-gray-200 bg-white text-gray-800 hover:border-[#4E6E49]/50 hover:text-[#4E6E49]"}`,children:N.label},N.href))})]}),s.jsxs("button",{onClick:()=>t(!0),className:"w-full lg:w-auto px-4 sm:px-6 py-3 sm:py-4 bg-gradient-to-r from-[#4E6E49] to-[#4E6E49] hover:from-[#4E6E49] hover:to-[#4E6E49] text-white rounded-lg sm:rounded-xl transition-all duration-200 flex items-center justify-center gap-2 text-sm sm:text-base font-semibold shadow-lg hover:shadow-xl active:scale-95 sm:hover:scale-105 transform touch-manipulation",children:[s.jsx(ra,{className:"w-4 h-4 sm:w-5 sm:h-5 flex-shrink-0"}),s.jsx("span",{className:"whitespace-nowrap",children:"Добавить заработок"})]})]})}),s.jsxs("div",{id:"earn-stats",className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-6",children:[s.jsxs("div",{className:`p-4 rounded-xl border-2 ${r==="dark"?"bg-blue-500/10 border-blue-500/30":"bg-blue-50 border-blue-200"}`,children:[s.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[s.jsx("div",{className:`p-2 rounded-lg ${r==="dark"?"bg-blue-500/20":"bg-blue-100"}`,children:s.jsx(Ms,{className:`w-5 h-5 ${r==="dark"?"text-blue-400":"text-blue-600"}`})}),s.jsx("p",{className:`text-xs ${r==="dark"?"text-gray-400":"text-gray-600"}`,children:"Неделя (чистыми)"})]}),s.jsxs("p",{className:`text-2xl font-bold ${r==="dark"?"text-blue-400":"text-blue-600"}`,children:[h.weekNet.toFixed(2)," ₽"]}),s.jsxs("p",{className:"text-[11px] text-gray-500 mt-1",children:["Гросс: ",h.weekTotal.toFixed(2)," ₽"]})]}),s.jsxs("div",{className:`p-4 rounded-xl border-2 ${r==="dark"?"bg-purple-500/10 border-purple-500/30":"bg-purple-50 border-purple-200"}`,children:[s.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[s.jsx("div",{className:`p-2 rounded-lg ${r==="dark"?"bg-purple-500/20":"bg-purple-100"}`,children:s.jsx(xd,{className:`w-5 h-5 ${r==="dark"?"text-purple-400":"text-purple-600"}`})}),s.jsx("p",{className:`text-xs ${r==="dark"?"text-gray-400":"text-gray-600"}`,children:"Пул за неделю"})]}),s.jsxs("p",{className:`text-2xl font-bold ${r==="dark"?"text-purple-400":"text-purple-600"}`,children:[h.weekPool.toFixed(2)," ₽"]})]}),s.jsxs("div",{className:`p-4 rounded-xl border-2 ${r==="dark"?"bg-[#4E6E49]/10 border-[#4E6E49]/30":"bg-green-50 border-green-200"}`,children:[s.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[s.jsx("div",{className:`p-2 rounded-lg ${r==="dark"?"bg-[#4E6E49]/20":"bg-green-100"}`,children:s.jsx(lf,{className:"w-5 h-5 text-[#4E6E49]"})}),s.jsx("p",{className:`text-xs ${r==="dark"?"text-gray-400":"text-gray-600"}`,children:"Месяц (чистыми)"})]}),s.jsxs("p",{className:"text-2xl font-bold text-[#4E6E49]",children:[h.monthNet.toFixed(2)," ₽"]}),s.jsxs("p",{className:"text-[11px] text-gray-500 mt-1",children:["Гросс: ",h.monthTotal.toFixed(2)," ₽"]})]}),s.jsxs("div",{className:`p-4 rounded-xl border-2 ${r==="dark"?"bg-orange-500/10 border-orange-500/30":"bg-orange-50 border-orange-200"}`,children:[s.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[s.jsx("div",{className:`p-2 rounded-lg ${r==="dark"?"bg-orange-500/20":"bg-orange-100"}`,children:s.jsx(xd,{className:`w-5 h-5 ${r==="dark"?"text-orange-400":"text-orange-600"}`})}),s.jsx("p",{className:`text-xs ${r==="dark"?"text-gray-400":"text-gray-600"}`,children:"Пул за месяц"})]}),s.jsxs("p",{className:`text-2xl font-bold ${r==="dark"?"text-orange-400":"text-orange-600"}`,children:[h.monthPool.toFixed(2)," ₽"]})]})]}),s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4 mb-4",children:[s.jsxs("div",{className:`lg:col-span-2 rounded-2xl p-5 ${v} border ${r==="dark"?"border-white/10":"border-gray-200"} shadow-lg`,children:[s.jsx("div",{className:"flex items-center justify-between mb-4",children:s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:`p-2 rounded-lg ${r==="dark"?"bg-[#4E6E49]/20":"bg-green-100"}`,children:s.jsx(Yp,{className:"w-5 h-5 text-[#4E6E49]"})}),s.jsxs("div",{children:[s.jsx("p",{className:`text-sm font-semibold ${r==="dark"?"text-gray-200":"text-gray-800"}`,children:"Сферы заработка"}),s.jsx("p",{className:"text-xs text-gray-500",children:"Сколько приносит каждый поток"})]})]})}),s.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3",children:y.map(N=>{const f=Ts[N.key];return s.jsxs("div",{className:`p-3 rounded-xl border ${r==="dark"?"border-gray-800 bg-gray-900/70":"border-gray-200 bg-white"} shadow-sm`,children:[s.jsxs("div",{className:"flex items-start justify-between gap-2",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("span",{className:"p-2 rounded-lg bg-gray-100 dark:bg-gray-800/80 flex items-center justify-center",children:$(N.key,"w-4 h-4")}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-semibold",children:f.label}),s.jsxs("p",{className:"text-[11px] text-gray-500",children:[N.count," записей"]})]})]}),s.jsxs("span",{className:"text-sm font-bold text-[#4E6E49]",children:[N.net.toFixed(0)," ₽"]})]}),s.jsxs("div",{className:"grid grid-cols-2 gap-2 mt-2 text-xs text-gray-500",children:[s.jsxs("div",{children:["Пул: ",N.pool.toFixed(0)," ₽"]}),s.jsxs("div",{children:["Гросс: ",N.gross.toFixed(0)," ₽"]})]}),s.jsxs("div",{className:"mt-2",children:[s.jsx("p",{className:"text-[11px] uppercase tracking-wide text-gray-500 mb-1",children:"Топ участники"}),s.jsx("div",{className:"flex flex-wrap gap-1.5",children:N.topParticipants.length===0?s.jsx("span",{className:"text-[11px] text-gray-500",children:"Нет записей"}):N.topParticipants.map(([de,V])=>s.jsxs("span",{className:`px-2 py-1 rounded-full text-[11px] font-semibold ${r==="dark"?"bg-gray-800 text-gray-100":"bg-gray-100 text-gray-800"}`,children:[z(de)," · ",V.toFixed(0)," ₽"]},de))})]})]},N.key)})})]}),s.jsxs("div",{className:`rounded-2xl p-5 ${v} border ${r==="dark"?"border-white/10":"border-gray-200"} shadow-lg`,children:[s.jsx("div",{className:"flex items-center justify-between mb-4",children:s.jsxs("div",{children:[s.jsx("p",{className:`text-sm font-semibold ${r==="dark"?"text-gray-200":"text-gray-800"}`,children:"Лидеры по доходу"}),s.jsx("p",{className:"text-xs text-gray-500",children:"Кто приносит больше всего чистыми"})]})}),s.jsxs("div",{className:"space-y-3",children:[w.slice(0,3).map((N,f)=>s.jsxs("div",{className:`flex items-center justify-between p-3 rounded-xl border ${r==="dark"?"border-gray-800 bg-gray-900/70":"border-gray-200 bg-white"}`,children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("span",{className:`w-7 h-7 rounded-full flex items-center justify-center text-sm font-bold ${r==="dark"?"bg-gray-800 text-gray-100":"bg-gray-100 text-gray-800"}`,children:f+1}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-semibold",children:N.name}),s.jsxs("p",{className:"text-[11px] text-gray-500",children:["Пул: ",N.poolShare.toFixed(0)," ₽"]})]})]}),s.jsxs("div",{className:"text-right",children:[s.jsxs("p",{className:"text-base font-bold text-[#4E6E49]",children:[N.net.toFixed(0)," ₽"]}),s.jsx("p",{className:"text-[11px] text-gray-500",children:"чистыми"})]})]},N.id)),w.length===0&&s.jsx("p",{className:"text-sm text-gray-500",children:"Нет данных по заработку"})]})]})]}),s.jsx("div",{className:"hidden sm:flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between pt-4 border-t border-gray-800/50 dark:border-gray-800",children:s.jsx("h2",{className:`text-base sm:text-lg md:text-xl font-semibold ${r==="dark"?"text-white":"text-gray-900"}`,children:"Управление заработком"})})]}),c?s.jsx("div",{className:`rounded-xl p-8 text-center border-2 ${r==="dark"?"bg-[#1a1a1a] border-gray-800":"bg-white border-gray-200"} shadow-md`,children:s.jsxs("div",{className:"flex flex-col items-center gap-3",children:[s.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-[#4E6E49]"}),s.jsx("p",{className:r==="dark"?"text-gray-400":"text-gray-600",children:"Загрузка данных..."})]})}):s.jsxs(s.Fragment,{children:[s.jsxs("div",{id:"earn-history",className:"space-y-6",children:[s.jsx(Q_,{earnings:i}),s.jsx(X_,{earnings:i,onEdit:H,onDelete:I})]}),s.jsxs("div",{id:"earn-insights",className:`rounded-2xl p-6 ${v} border ${r==="dark"?"border-white/10":"border-gray-200"} shadow-lg space-y-4`,children:[s.jsx("div",{className:"flex items-center justify-between",children:s.jsxs("div",{children:[s.jsx("p",{className:`text-sm font-semibold ${r==="dark"?"text-gray-300":"text-gray-700"}`,children:"Инсайты"}),s.jsx("p",{className:`text-xs ${r==="dark"?"text-gray-400":"text-gray-500"}`,children:"Где мы зарабатываем больше всего"})]})}),s.jsx("div",{className:"grid sm:grid-cols-2 lg:grid-cols-4 gap-3",children:[{label:"Топ категория",value:k?`${Ts[k.key].label} · ${k.net.toFixed(0)} ₽`:"Нет данных",tone:"bg-blue-500/10 text-blue-600 dark:text-blue-200"},{label:"Лидер команды",value:j?`${j.name} · ${j.net.toFixed(0)} ₽`:"Нет данных",tone:"bg-purple-500/10 text-purple-600 dark:text-purple-200"},{label:"Доля пула (мес.)",value:h.monthTotal?`${Math.round(h.monthPool/h.monthTotal*100)}%`:"45%",tone:"bg-emerald-500/10 text-emerald-600 dark:text-emerald-200"},{label:"Средняя выплата",value:i.length?`${(i.reduce((N,f)=>N+C(f),0)/i.length).toFixed(0)} ₽`:"0 ₽",tone:"bg-orange-500/10 text-orange-600 dark:text-orange-200"}].map(N=>s.jsxs("div",{className:`p-3 rounded-xl ${N.tone} border ${r==="dark"?"border-white/10":"border-transparent"} shadow-sm`,children:[s.jsx("p",{className:"text-[11px] uppercase tracking-wide opacity-70",children:N.label}),s.jsx("p",{className:"text-xl font-extrabold",children:N.value})]},N.label))})]})]}),e&&s.jsx(Y_,{onClose:G,onSave:E,editingEarning:n})]})})},Z_=({rating:r,place:e})=>{const{theme:t}=it(),[n,a]=D.useState(null),i=Se.find(I=>I.id===r.userId),o=t==="dark"?"text-white":"text-gray-900",c=t==="dark"?"text-gray-400":"text-gray-600",d=t==="dark"?"bg-[#0f0f0f]":"bg-white",h=t==="dark"?"border-white/10":"border-gray-200",g=t==="dark"?"hover:bg-white/5":"hover:bg-gray-50",x=t==="dark"?"bg-white/5":"bg-gray-50/80",p=r.rating<=0?"4%":`${Math.min(r.rating,100)}%`,v=r.rating>=80?"bg-emerald-500":r.rating>=60?"bg-blue-500":r.rating>=40?"bg-amber-500":"bg-rose-500",A=r.rating>=80?"#10b981":r.rating>=60?"#3b82f6":r.rating>=40?"#f59e0b":"#f43f5e",T={1:{bg:t==="dark"?"bg-emerald-500/10":"bg-emerald-50",border:t==="dark"?"border-emerald-400/30":"border-emerald-200",text:t==="dark"?"text-emerald-100":"text-emerald-900",icon:t==="dark"?"text-emerald-200":"text-emerald-600",soft:t==="dark"?"bg-emerald-500/8":"bg-emerald-50"},2:{bg:t==="dark"?"bg-sky-500/10":"bg-sky-50",border:t==="dark"?"border-sky-400/30":"border-sky-200",text:t==="dark"?"text-sky-100":"text-sky-900",icon:t==="dark"?"text-sky-200":"text-sky-600",soft:t==="dark"?"bg-sky-500/8":"bg-sky-50"},3:{bg:t==="dark"?"bg-purple-500/10":"bg-purple-50",border:t==="dark"?"border-purple-400/30":"border-purple-200",text:t==="dark"?"text-purple-100":"text-purple-900",icon:t==="dark"?"text-purple-200":"text-purple-600",soft:t==="dark"?"bg-purple-500/8":"bg-purple-50"},4:{bg:t==="dark"?"bg-amber-500/10":"bg-amber-50",border:t==="dark"?"border-amber-400/30":"border-amber-200",text:t==="dark"?"text-amber-100":"text-amber-900",icon:t==="dark"?"text-amber-200":"text-amber-600",soft:t==="dark"?"bg-amber-500/8":"bg-amber-50"},5:{bg:t==="dark"?"bg-rose-500/10":"bg-rose-50",border:t==="dark"?"border-rose-400/30":"border-rose-200",text:t==="dark"?"text-rose-100":"text-rose-900",icon:t==="dark"?"text-rose-200":"text-rose-600",soft:t==="dark"?"bg-rose-500/8":"bg-rose-50"},default:{bg:t==="dark"?"bg-white/5":"bg-gray-50",border:t==="dark"?"border-white/10":"border-gray-200",text:t==="dark"?"text-white":"text-gray-900",icon:t==="dark"?"text-white":"text-gray-700",soft:t==="dark"?"bg-white/5":"bg-gray-50"}}[(i==null?void 0:i.id)||"default"],z=r.breakdown?[{icon:s.jsx(Ur,{className:"w-5 h-5"}),label:"Выходные",value:`${r.breakdown.daysOff} день`,points:r.breakdown.daysOffPoints,maxPoints:10,explanation:"0-2 выходных в неделю = 10% к рейтингу. Более 2 выходных = 0%. Показывает стабильность присутствия.",threshold:"0-2 дня",color:"bg-amber-200 text-amber-900"},{icon:s.jsx(Op,{className:"w-5 h-5"}),label:"Больничные",value:`${r.breakdown.sickDays} дней`,points:r.breakdown.sickDaysPoints,maxPoints:10,explanation:"До 7 дней больничного в месяц = 10% к рейтингу. Более 7 дней = 0%. Учитывается за последние 30 дней.",threshold:"≤7 дней",color:"bg-purple-200 text-purple-900"},{icon:s.jsx(Qp,{className:"w-5 h-5"}),label:"Отпуск",value:`${r.breakdown.vacationDays} дней`,points:r.breakdown.vacationDaysPoints,maxPoints:10,explanation:"До 7 дней отпуска в месяц = 10% к рейтингу. Более 7 дней = 0%. Учитывается за последние 30 дней.",threshold:"≤7 дней",color:"bg-orange-200 text-orange-900"},{icon:s.jsx(Ps,{className:"w-5 h-5"}),label:"Часы работы",value:$_(r.breakdown.weeklyHours),points:r.breakdown.weeklyHoursPoints,maxPoints:25,explanation:"20+ часов в неделю = 25% к рейтингу. 15-19 часов = 15%. Менее 15 часов = 0%. Показывает объем работы за неделю.",threshold:"≥20ч: 25% | ≥15ч: 15%",color:"bg-blue-200 text-blue-900"},{icon:s.jsx(Fi,{className:"w-5 h-5"}),label:"Заработок",value:`${r.breakdown.weeklyEarnings.toFixed(2)} ₽`,points:r.breakdown.weeklyEarningsPoints,maxPoints:30,explanation:"6000+ ₽ в неделю = 30% к рейтингу. 3000-5999 ₽ = 15%. Менее 3000 ₽ = 0%. Основной показатель эффективности.",threshold:"≥6000₽: 30% | ≥3000₽: 15%",color:"bg-emerald-200 text-emerald-900"},{icon:s.jsx(bn,{className:"w-5 h-5"}),label:"Рефералы",value:`${r.breakdown.referrals} чел.`,points:r.breakdown.referralsPoints,maxPoints:30,explanation:"5% к рейтингу за каждого реферала. Максимум 30% (6 рефералов). Учитываются за последние 30 дней. Показывает активность по привлечению новых участников.",threshold:"5% за каждого (макс 30%)",color:"bg-pink-200 text-pink-900"},{icon:s.jsx(Ys,{className:"w-5 h-5"}),label:"Сообщения",value:`${r.breakdown.weeklyMessages} сообщений`,points:r.breakdown.weeklyMessagesPoints,maxPoints:15,explanation:"Более 50 сообщений в неделю в группе = 15% к рейтингу. Менее 50 = 0%. Учитываются все типы сообщений (текст, фото, стикеры и т.д.). Показывает активность в общении.",threshold:">50 сообщений",color:"bg-indigo-200 text-indigo-900"}]:[],$=z.reduce((I,H)=>I+H.points,0),S=(()=>{if(!e)return null;const I=e.rank,H=I===1?{bg:"from-amber-400 to-amber-600",ring:"ring-amber-300/50",icon:"🥇"}:I===2?{bg:"from-slate-300 to-slate-500",ring:"ring-slate-300/50",icon:"🥈"}:I===3?{bg:"from-amber-200 to-amber-500",ring:"ring-amber-200/40",icon:"🥉"}:{bg:"from-gray-200 to-gray-400",ring:"ring-gray-200/40",icon:I.toString()};return s.jsx("div",{className:"absolute top-3 right-3",children:s.jsx("div",{className:`w-10 h-10 rounded-full bg-gradient-to-br ${H.bg} ring-4 ${H.ring} shadow-lg grid place-items-center text-lg font-semibold`,children:H.icon})})})();return s.jsxs("div",{className:`relative rounded-2xl p-6 ${d} shadow-sm border ${h} transition-colors`,children:[S,s.jsxs("div",{className:"mb-5 flex flex-col gap-3",children:[s.jsx("div",{className:"flex items-start justify-between gap-3",children:s.jsxs("div",{className:"min-w-0",children:[s.jsx("p",{className:`text-[11px] uppercase tracking-[0.12em] ${c}`,children:"Участник"}),s.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[s.jsxs("h3",{className:`text-2xl font-bold ${o} truncate`,children:["@",(i==null?void 0:i.login)||"unknown"]}),(i==null?void 0:i.name)&&s.jsx("span",{className:`text-xs ${c}`,children:i.name})]}),s.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[s.jsxs("span",{className:`px-2.5 py-1 rounded-lg text-xs font-semibold border ${T.border} ${T.bg} ${T.text} flex items-center gap-1`,children:[s.jsx("span",{className:`text-lg leading-none ${T.icon}`,children:"●"}),s.jsx("span",{children:"Ник"})]}),s.jsx("div",{className:"flex items-center gap-2",children:s.jsxs("span",{className:"text-lg font-bold",style:{color:A},children:[r.rating.toFixed(1),"%"]})})]})]})}),s.jsxs("div",{children:[s.jsx("div",{className:"w-full bg-gray-200/70 dark:bg-gray-800 rounded-full h-6 overflow-hidden shadow-inner",children:s.jsx("div",{className:`h-full transition-all duration-500 flex items-center justify-center text-sm font-semibold text-white ${v}`,style:{width:p,minWidth:r.rating<=0?"40px":void 0},children:r.rating>=8&&s.jsxs("span",{children:[r.rating.toFixed(0),"%"]})})}),s.jsxs("div",{className:"flex justify-between mt-1",children:[s.jsx("span",{className:`text-xs ${c}`,children:"Общий рейтинг"}),s.jsxs("span",{className:`text-xs font-semibold ${c}`,children:[$,"/100 баллов"]})]})]})]}),r.breakdown&&s.jsxs("div",{className:"space-y-3 mb-6",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[s.jsx(Ms,{className:`w-5 h-5 ${c}`}),s.jsx("h4",{className:`text-lg font-semibold ${o}`,children:"Детальный разбор рейтинга"})]}),z.map((I,H)=>{const G=I.maxPoints>0?I.points/I.maxPoints*100:0,E=n===H;return s.jsxs("div",{className:`rounded-lg border ${h} overflow-hidden transition-all ${E?"shadow-md":""}`,children:[s.jsx("button",{onClick:()=>a(E?null:H),className:`w-full p-4 flex items-center justify-between ${g} transition-colors`,children:s.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[s.jsx("div",{className:`p-2 rounded-lg ${I.color} flex-shrink-0`,children:I.icon}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsxs("div",{className:"flex items-center justify-between mb-1",children:[s.jsx("span",{className:`font-semibold ${o} truncate`,children:I.label}),s.jsxs("span",{className:`font-bold ml-2 ${I.points>0?"text-[#4E6E49]":"text-red-500"}`,children:[I.points,"/",I.maxPoints]})]}),s.jsx("div",{className:"w-full bg-gray-200 dark:bg-gray-800 rounded-full h-2 overflow-hidden",children:s.jsx("div",{className:`h-full transition-all duration-300 ${I.color}`,style:{width:`${G}%`}})}),s.jsxs("div",{className:"flex items-center justify-between mt-1",children:[s.jsx("span",{className:`text-xs ${c} truncate mr-2`,children:I.value}),s.jsx("span",{className:`text-xs ${c} whitespace-nowrap`,children:I.threshold})]})]}),s.jsx(ln,{className:`w-4 h-4 flex-shrink-0 ml-2 ${c} transition-transform ${E?"rotate-180":""}`})]})}),E&&s.jsx("div",{className:`px-4 pb-4 pt-2 border-t ${h} ${x}`,children:s.jsx("p",{className:`text-sm ${c} leading-relaxed`,children:I.explanation})})]},H)})]}),s.jsxs("div",{className:`pt-4 border-t ${h}`,children:[s.jsx("h4",{className:`text-sm font-semibold mb-3 ${o}`,children:"Дополнительная статистика"}),s.jsxs("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[s.jsxs("div",{className:`p-3 rounded-lg ${x}`,children:[s.jsx("div",{className:`text-xs ${c} mb-1`,children:"Заработок (месяц)"}),s.jsxs("div",{className:`text-lg font-bold ${o}`,children:[r.earnings.toFixed(0)," ₽"]})]}),s.jsxs("div",{className:`p-3 rounded-lg ${x}`,children:[s.jsx("div",{className:`text-xs ${c} mb-1`,children:"В пул"}),s.jsxs("div",{className:`text-lg font-bold ${o}`,children:[r.poolAmount.toFixed(0)," ₽"]})]})]})]})]})},qo=()=>`REF-${Math.random().toString(36).slice(2,8).toUpperCase()}`,eN=({referral:r,onClose:e,onSave:t})=>{const{user:n}=kt(),{isAdmin:a}=Tt(),{theme:i}=it(),[o,c]=D.useState(""),[d,h]=D.useState(""),[g,x]=D.useState(""),[p,v]=D.useState(qo()),[A,C]=D.useState(""),[T,z]=D.useState(!1),[$,S]=D.useState(!1);D.useEffect(()=>{r?(c(r.name),h(String(r.age)),v(r.referralId),x(r.comment||"")):(c(""),h(""),x(""),v(qo()))},[r]);const I=!!r,H=I?"Редактировать реферала":"Добавить реферала",G=i==="dark"?"bg-gray-700 hover:bg-gray-600 text-white":"bg-gray-200 hover:bg-gray-300 text-gray-900",E=i==="dark"?"text-gray-300":"text-gray-700",y=i==="dark"?"text-white":"text-gray-900",w=async()=>{if(!r){if(!n){C("Пользователь не найден. Для добавления реферала необходимо войти как участник.");return}}if(!o.trim()||!d.trim()){C("Заполните имя и возраст");return}const j=Number(d);if(Number.isNaN(j)||j<16){C("Возраст должен быть числом не меньше 16");return}z(!0),C("");const N={referralId:p,ownerId:(r==null?void 0:r.ownerId)||n.id,name:o.trim(),age:j,createdAt:(r==null?void 0:r.createdAt)||new Date().toISOString(),...g.trim()&&{comment:g.trim()}};try{r?a?await Gg(r.id,N):await bt({entity:"referral",action:"update",authorId:(n==null?void 0:n.id)||r.ownerId,targetUserId:r.ownerId,before:r,after:{id:r.id,...N}}):a?await zg(N):await bt({entity:"referral",action:"create",authorId:n.id,targetUserId:n.id,before:null,after:{id:"",...N}}),t()}catch(f){console.error("Error saving referral:",f);const de=f.message||f.code||"Не удалось сохранить реферала";C(de)}finally{z(!1)}},k=async()=>{if(r&&confirm(`Удалить реферала ${r.name}?`)){S(!0);try{a?await vc(r.id):await bt({entity:"referral",action:"delete",authorId:(n==null?void 0:n.id)||r.ownerId,targetUserId:r.ownerId,before:r,after:null}),t()}catch(j){console.error("Error deleting referral:",j);const N=j.message||j.code||"Не удалось удалить реферала";C(N)}finally{S(!1)}}};return s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-start sm:items-center justify-center z-[70] p-4 sm:py-0 overflow-y-auto overflow-x-hidden overscroll-contain modal-scroll",children:s.jsxs("div",{className:`w-full max-w-md rounded-lg shadow-xl ${i==="dark"?"bg-[#1a1a1a]":"bg-white"} max-h-[90vh] flex flex-col overflow-hidden`,children:[s.jsx("div",{className:"flex-shrink-0 p-6 pb-4",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("h3",{className:`text-xl font-bold ${y}`,children:H}),s.jsx("button",{onClick:e,className:`p-2 rounded-lg flex-shrink-0 ${G}`,"aria-label":"Закрыть",children:s.jsx(Jt,{className:"w-5 h-5"})})]})}),s.jsx("div",{className:"flex-1 min-h-0 overflow-y-auto overflow-x-hidden overscroll-contain modal-scroll px-6 pb-6",children:s.jsxs("div",{className:"space-y-4 min-w-0",children:[s.jsxs("div",{children:[s.jsx("label",{className:`block text-sm font-medium mb-2 ${E}`,children:"Имя"}),s.jsx("input",{type:"text",value:o,onChange:j=>c(j.target.value),className:`w-full px-4 py-2 rounded-lg border ${i==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`,placeholder:"Введите имя"})]}),s.jsxs("div",{children:[s.jsx("label",{className:`block text-sm font-medium mb-2 ${E}`,children:"Возраст"}),s.jsx("input",{type:"number",value:d,onChange:j=>h(j.target.value),className:`w-full px-4 py-2 rounded-lg border ${i==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`,placeholder:"18",min:16})]}),s.jsxs("div",{children:[s.jsx("label",{className:`block text-sm font-medium mb-2 ${E}`,children:"Комментарий"}),s.jsx("textarea",{value:g,onChange:j=>x(j.target.value),rows:3,className:`w-full px-4 py-2 rounded-lg border ${i==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`,placeholder:"Например, источник лида или статус"})]}),s.jsxs("div",{children:[s.jsx("label",{className:`block text-sm font-medium mb-2 ${E}`,children:"ID реферала"}),s.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[s.jsx("input",{type:"text",value:p,readOnly:I,onChange:j=>v(j.target.value),className:`flex-1 px-4 py-2 rounded-lg border ${i==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49] ${I?"opacity-80 cursor-not-allowed":""}`}),!I&&s.jsxs("button",{type:"button",onClick:()=>v(qo()),className:"px-3 py-2 bg-[#4E6E49] hover:bg-[#4E6E49] text-white rounded-lg transition-colors flex items-center justify-center gap-1 text-sm",children:[s.jsx(Jp,{className:"w-4 h-4"}),"Новый"]})]}),s.jsx("p",{className:`text-xs mt-1 ${i==="dark"?"text-gray-400":"text-gray-500"}`,children:"ID генерируется автоматически и используется для учета."})]}),A&&s.jsx("div",{className:"p-3 bg-red-500 text-white rounded-lg text-sm",children:A}),s.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[I&&s.jsxs("button",{onClick:k,disabled:$,className:"flex-1 px-4 py-2 bg-red-500 hover:bg-red-600 disabled:bg-red-300 text-white rounded-lg transition-colors flex items-center justify-center gap-2",children:[s.jsx(Pt,{className:"w-4 h-4"}),$?"Удаление...":"Удалить"]}),s.jsx("button",{onClick:w,disabled:T,className:"flex-1 px-4 py-2 bg-[#4E6E49] hover:bg-[#4E6E49] disabled:bg-gray-400 disabled:cursor-not-allowed text-white rounded-lg transition-colors",children:T?"Сохранение...":"Сохранить"}),s.jsx("button",{onClick:e,className:`px-4 py-2 rounded-lg transition-colors ${G}`,children:"Отмена"})]})]})})]})})},l0=(r,e=0,t=0,n=0)=>{let a=0;(r.daysOff===0||r.daysOff<=2)&&(a+=10),r.sickDays<=7&&(a+=10),r.vacationDays<=7&&(a+=10),e>=20?a+=25:e>=15&&(a+=15),t>=6e3?a+=30:t>=3e3&&(a+=15);const i=Math.min(r.referrals*5,30);return a+=i,n>50&&(a+=15),Math.min(a,100)},c0=(r,e=0,t=0,n=0)=>{const a=r.daysOff===0||r.daysOff<=2?10:0,i=r.sickDays<=7?10:0,o=r.vacationDays<=7?10:0;let c=0;e>=20?c=25:e>=15&&(c=15);let d=0;t>=6e3?d=30:t>=3e3&&(d=15);const h=Math.min(r.referrals*5,30),g=n>50?15:0,x=Math.min(a+i+o+c+d+h+g,100);return{daysOff:r.daysOff,daysOffPoints:a,sickDays:r.sickDays,sickDaysPoints:i,vacationDays:r.vacationDays,vacationDaysPoints:o,weeklyHours:e,weeklyHoursPoints:c,weeklyEarnings:t,weeklyEarningsPoints:d,referrals:r.referrals,referralsPoints:h,weeklyMessages:n,weeklyMessagesPoints:g,totalRating:x}},tN=()=>{var Z,oe;const{theme:r}=it(),{user:e}=kt(),{isAdmin:t}=Tt(),[n,a]=D.useState([]),[i,o]=D.useState(!0),[c,d]=D.useState([]),[h,g]=D.useState(!1),[x,p]=D.useState(null);D.useEffect(()=>{v()},[]);const v=async()=>{o(!0);try{const F=Ca(),L=ce(F.start,"yyyy-MM-dd"),M=ce(F.end,"yyyy-MM-dd"),re=a0(30),me=ce(re.start,"yyyy-MM-dd"),W=ce(re.end,"yyyy-MM-dd"),ie=re.start.toISOString(),Q=re.end.toISOString(),B=await Hg(void 0,ie,Q);d(B);const ue=[];for(const O of Se){const Ee=(await ma(O.id,L,M)).reduce((we,ke)=>{const $e=ke.participants&&ke.participants.length>0?ke.participants.length:1;return we+ke.amount/$e},0),Y=await ma(O.id,me,W),fe=Y.reduce((we,ke)=>{const $e=ke.participants&&ke.participants.length>0?ke.participants.length:1;return we+ke.amount/$e},0),pe=Y.reduce((we,ke)=>{const $e=ke.participants&&ke.participants.length>0?ke.participants.length:1;return we+ke.poolAmount/$e},0),qe=(await yr(O.id)).filter(we=>{const ke=we.date,$e=we.endDate||we.date;return ke<=W&&$e>=me}),Je=qe.filter(we=>we.type==="dayoff").reduce((we,ke)=>we+an(ke.date,ke.endDate,me,W),0),q=qe.filter(we=>we.type==="sick").reduce((we,ke)=>we+an(ke.date,ke.endDate,me,W),0),ae=qe.filter(we=>we.type==="vacation").reduce((we,ke)=>we+an(ke.date,ke.endDate,me,W),0),Me=(await Kr(O.id)).filter(we=>we.date>=L&&we.date<=M).reduce((we,ke)=>we+ho(ke.slots),0),Ue=await qg(O.id,L,M),_=(await Wg(O.id))[0]||{userId:O.id,earnings:0,messages:0,initiatives:0,signals:0,profitableSignals:0,referrals:0,daysOff:0,sickDays:0,vacationDays:0,poolAmount:0,rating:0,lastUpdated:new Date().toISOString()},be=B.filter(we=>we.ownerId===O.id).length,Ne={userId:O.id,earnings:fe,messages:_.messages||0,initiatives:_.initiatives||0,signals:_.signals||0,profitableSignals:_.profitableSignals||0,referrals:be,daysOff:Je,sickDays:q,vacationDays:ae,poolAmount:pe,lastUpdated:new Date().toISOString()},Ie=l0(Ne,Me,Ee,Ue),ne=c0(Ne,Me,Ee,Ue);ue.push({...Ne,rating:Ie,breakdown:ne})}ue.sort((O,ge)=>ge.rating-O.rating),a(ue)}catch(F){console.error("Error loading ratings:",F)}finally{o(!1)}},A=n.reduce((F,L)=>F+L.rating,0)/(n.length||1),C=r==="dark"?"text-gray-400":"text-gray-600",T=r==="dark"?"text-white":"text-gray-900",z="bg-[#10141c]",$="border-[#48a35e]/60",S="shadow-[0_24px_80px_rgba(0,0,0,0.45)]",I=r==="dark"?"text-white/70":"text-slate-600",H=r==="dark"?"text-white":"text-slate-900",G=[{label:"80-100%",title:"Эталон",desc:"Стабильный вклад, примеры для команды",tone:"text-emerald-700 dark:text-emerald-100",bg:"bg-emerald-50 dark:bg-emerald-900/40 border-emerald-200/60 dark:border-emerald-700/60"},{label:"60-79%",title:"Уверенно",desc:"Держат темп, есть потенциал роста",tone:"text-blue-700 dark:text-blue-100",bg:"bg-blue-50 dark:bg-blue-900/40 border-blue-200/60 dark:border-blue-700/60"},{label:"40-59%",title:"В пути",desc:"Нужна точечная поддержка и фокус",tone:"text-amber-700 dark:text-amber-100",bg:"bg-amber-50 dark:bg-amber-900/40 border-amber-200/60 dark:border-amber-700/60"},{label:"0-39%",title:"Зона роста",desc:"Запускаем план восстановления",tone:"text-rose-700 dark:text-rose-100",bg:"bg-rose-50 dark:bg-rose-900/40 border-rose-200/60 dark:border-rose-700/60"}],E=F=>{if(!F.breakdown)return["Недостаточно данных — обновите статистику."];const L=[];return F.breakdown.weeklyHoursPoints<25&&L.push("Дотяни рабочие часы до 20+ в неделю (25%)."),F.breakdown.weeklyEarningsPoints<30&&L.push("Увеличь недельный доход до 6000+ ₽ (30%)."),F.breakdown.referralsPoints<30&&L.push("Добавь рефералов: до +30% (6 человек)."),F.breakdown.weeklyMessagesPoints<15&&L.push("Сообщения: >50 в неделю для +15%."),F.breakdown.daysOffPoints<10&&L.push("Сократи выходные до 0–2 за неделю."),F.breakdown.sickDaysPoints<10&&L.push("Больничные держи ≤7 дней в месяц."),F.breakdown.vacationDaysPoints<10&&L.push("Отпуск ≤7 дней в месяц."),L.length?L:["Отлично! Держи текущий темп."]},y=D.useMemo(()=>[...n].sort((F,L)=>L.rating-F.rating),[n]),w=D.useMemo(()=>{var me,W;if(!n.length)return{top:0,median:0,count:0,high:0};const F=[...n].sort((ie,Q)=>Q.rating-ie.rating),L=((me=F[0])==null?void 0:me.rating)||0,M=((W=F[Math.floor((F.length-1)/2)])==null?void 0:W.rating)||L,re=F.filter(ie=>ie.rating>=80).length;return{top:L,median:M,count:F.length,high:re}},[n]),k=y[0],j=k&&((Z=Se.find(F=>F.id===k.userId))==null?void 0:Z.name)||"—",N=new Date().toLocaleDateString("ru-RU"),f=[{label:"Средний рейтинг",value:`${A.toFixed(1)}%`,meta:"по команде за неделю",tone:"emerald"},{label:"Лидер недели",value:j,meta:k?`${k.rating.toFixed(1)}%`:"—",tone:"amber"},{label:"80%+ участников",value:`${w.high}`,meta:"стабильно высоко",tone:"blue"},{label:"Всего участников",value:`${n.length}`,meta:"в рейтинге",tone:"slate"},{label:"Медиана",value:`${w.median.toFixed(1)}%`,meta:"ровный темп",tone:"purple"},{label:"Рефералы 30д",value:`${c.length}`,meta:"активность команды",tone:"pink"},{label:"Обновление",value:N,meta:"автообновление данных",tone:"indigo"},{label:"КПД недели",value:`${A.toFixed(1)}%`,meta:"ключевой ориентир",tone:"emerald"}],de=F=>F==="emerald"?r==="dark"?"bg-emerald-500/15 border-emerald-400/30 text-emerald-50":"bg-emerald-50 border-emerald-200 text-emerald-900":F==="amber"?r==="dark"?"bg-amber-500/15 border-amber-400/30 text-amber-50":"bg-amber-50 border-amber-200 text-amber-900":F==="blue"?r==="dark"?"bg-sky-500/15 border-sky-400/30 text-sky-50":"bg-sky-50 border-sky-200 text-sky-900":F==="purple"?r==="dark"?"bg-indigo-500/15 border-indigo-400/30 text-indigo-50":"bg-indigo-50 border-indigo-200 text-indigo-900":F==="pink"?r==="dark"?"bg-rose-500/15 border-rose-400/30 text-rose-50":"bg-rose-50 border-rose-200 text-rose-900":F==="indigo"?r==="dark"?"bg-indigo-500/15 border-indigo-400/30 text-indigo-50":"bg-indigo-50 border-indigo-200 text-indigo-900":r==="dark"?"bg-white/5 border-white/15 text-white":"bg-gray-50 border-gray-200 text-gray-900",V=F=>{var L;return((L=Se.find(M=>M.id===F))==null?void 0:L.name)||"—"},X=()=>{p(null),g(!0)},R=F=>{p(F),g(!0)},te=async F=>{(t||F.ownerId===(e==null?void 0:e.id))&&(t?await vc(F.id):await bt({entity:"referral",action:"delete",authorId:(e==null?void 0:e.id)||F.ownerId,targetUserId:F.ownerId,before:F,after:null}),await v())};return s.jsxs(cr,{children:[s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"relative overflow-hidden rounded-3xl border border-[#48a35e]/60 shadow-[0_24px_80px_rgba(0,0,0,0.45)] bg-[#10141c]",children:[s.jsxs("div",{className:"absolute inset-0 pointer-events-none",children:[s.jsx("div",{className:"absolute -left-16 -bottom-10 w-80 h-80 bg-emerald-500/18 blur-3xl"}),s.jsx("div",{className:"absolute inset-0 bg-[radial-gradient(circle_at_50%_0%,rgba(255,255,255,0.08),transparent_45%)]"})]}),s.jsxs("div",{className:"relative p-6 sm:p-8 space-y-6",children:[s.jsxs("div",{className:"flex flex-col gap-4 lg:flex-row lg:items-start lg:justify-between",children:[s.jsx("div",{className:"space-y-3 max-w-3xl",children:s.jsxs("div",{className:"flex items-start gap-3",children:[s.jsx("div",{className:"p-3 rounded-2xl bg-white/10 border border-white/20 text-white shadow-inner",children:s.jsxs("svg",{width:"26",height:"26",viewBox:"0 0 24 24",fill:"none",className:"text-emerald-300",children:[s.jsx("path",{d:"M4 13.5V20h4v-6.5H4Z",stroke:"currentColor",strokeWidth:"1.6",strokeLinecap:"round",strokeLinejoin:"round"}),s.jsx("path",{d:"M10 10v10h4V10h-4Z",stroke:"currentColor",strokeWidth:"1.6",strokeLinecap:"round",strokeLinejoin:"round"}),s.jsx("path",{d:"M16 4v16h4V4h-4Z",stroke:"currentColor",strokeWidth:"1.6",strokeLinecap:"round",strokeLinejoin:"round"}),s.jsx("path",{d:"M4 16.5 9.5 11l3 3 7-7",stroke:"currentColor",strokeWidth:"1.6",strokeLinecap:"round",strokeLinejoin:"round"})]})}),s.jsxs("div",{className:"space-y-2",children:[s.jsx("h1",{className:"text-3xl sm:text-4xl font-black text-white leading-tight",children:"Рейтинг команды"}),s.jsx("p",{className:"text-sm text-white/70",children:"Данные за текущую неделю + последние 30 дней. В фокусе KPI команды, динамика и реферальная активность — как на дашборде задач."}),s.jsx("div",{className:"flex flex-wrap gap-2",children:["КПД недели","Рейтинг 30д","Рефералы","Сообщения"].map((F,L)=>s.jsx("span",{className:`px-4 py-1.5 rounded-full text-xs font-semibold border ${L===0?"bg-emerald-500 text-white border-emerald-300/60 shadow-md":"bg-white/10 text-white border-white/20"}`,children:F},F))})]})]})}),s.jsx("div",{className:"flex flex-col items-start lg:items-end gap-2 text-white"})]}),s.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-4 gap-3",children:f.map(F=>s.jsxs("div",{className:`relative overflow-hidden rounded-2xl border ${de(F.tone)} p-4 backdrop-blur-sm`,children:[s.jsx("div",{className:"absolute right-3 top-3 text-xl opacity-20",children:"•"}),s.jsx("div",{className:`text-xs uppercase tracking-[0.1em] font-semibold ${I}`,children:F.label}),s.jsx("div",{className:`mt-2 text-2xl font-bold ${H}`,children:F.value}),s.jsx("div",{className:`text-sm ${I}`,children:F.meta})]},F.label))})]})]}),s.jsxs("div",{className:`rounded-2xl p-6 sm:p-7 ${z} ${S} border ${$}`,children:[s.jsxs("div",{className:"flex flex-col gap-2 mb-4",children:[s.jsx("p",{className:`text-xs uppercase tracking-[0.12em] ${C}`,children:"Методика"}),s.jsx("h3",{className:`text-2xl font-bold ${T}`,children:"Как мы строим эффективность команды?"}),s.jsx("p",{className:`text-sm ${C}`,children:"Четыре зоны, которые показывают, где сейчас участник и что делать дальше."})]}),s.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-4 gap-3",children:G.map(F=>s.jsxs("div",{className:`rounded-xl border ${F.bg} p-3 transition`,children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("span",{className:`text-xs font-semibold ${C}`,children:F.label}),s.jsx("span",{className:"text-lg",children:"•"})]}),s.jsx("p",{className:`text-base font-semibold ${F.tone}`,children:F.title}),s.jsx("p",{className:`text-sm ${C}`,children:F.desc})]},F.label))})]}),s.jsxs("div",{className:`rounded-2xl p-6 sm:p-7 ${z} ${S} border ${$}`,children:[s.jsxs("div",{className:"flex flex-col gap-2 mb-4",children:[s.jsx("p",{className:`text-xs uppercase tracking-[0.12em] ${C}`,children:"Рекомендации"}),s.jsx("h3",{className:`text-2xl font-bold ${T}`,children:"Что улучшить каждому"}),s.jsx("p",{className:`text-sm ${C}`,children:"Динамические подсказки на основе текущих метрик рейтинга."})]}),s.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-3",children:y.map(F=>{const L=E(F),M=V(F.userId),re=F.rating>=80?"bg-emerald-500":F.rating>=60?"bg-blue-500":F.rating>=40?"bg-amber-500":"bg-rose-500",me=F.rating>=80?"Эталон":F.rating>=60?"Уверенно":F.rating>=40?"В пути":"Зона роста";return s.jsxs("div",{className:"rounded-xl border border-white/10 bg-white/5 p-4 space-y-3",children:[s.jsxs("div",{className:"flex items-center justify-between gap-2",children:[s.jsxs("div",{className:"min-w-0",children:[s.jsx("p",{className:`text-xs uppercase tracking-[0.12em] ${C}`,children:me}),s.jsx("h4",{className:`text-lg font-bold ${T} truncate`,children:M})]}),s.jsx("div",{className:"text-right",children:s.jsxs("div",{className:"text-2xl font-bold text-white",children:[F.rating.toFixed(1),"%"]})})]}),s.jsx("div",{className:"w-full bg-white/5 rounded-full h-3 overflow-hidden border border-white/10",children:s.jsx("div",{className:`h-full ${re}`,style:{width:`${Math.min(F.rating,100)}%`}})}),s.jsx("ul",{className:"space-y-1 text-sm text-white/80",children:L.map((W,ie)=>s.jsxs("li",{className:"flex items-start gap-2",children:[s.jsx("span",{className:"text-xs mt-0.5",children:"•"}),s.jsx("span",{children:W})]},ie))})]},F.userId)})})]}),s.jsxs("div",{id:"rating-ref",className:`rounded-2xl p-6 sm:p-7 ${z} ${S} border ${$}`,children:[s.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between mb-4",children:[s.jsxs("div",{className:"space-y-1",children:[s.jsx("p",{className:`text-xs uppercase tracking-[0.12em] ${C}`,children:"Рефералы · 30 дней"}),s.jsx("h3",{className:`text-2xl font-bold ${T}`,children:"Привлеченные участники"}),s.jsxs("p",{className:`text-sm ${C}`,children:["Всего добавлено: ",s.jsx("span",{className:"font-semibold",children:c.length})]})]}),s.jsxs("button",{onClick:X,className:"px-4 py-3 rounded-xl transition-all duration-200 flex items-center justify-center gap-2 font-semibold shadow-md w-full sm:w-auto border border-indigo-200/70 bg-indigo-50 text-indigo-900 hover:bg-indigo-100 dark:bg-indigo-500/15 dark:border-indigo-400/30 dark:text-indigo-50",children:[s.jsx("span",{className:"text-xl",children:"➕"}),s.jsx("span",{children:"Добавить реферала"})]})]}),c.length?s.jsx("div",{className:"overflow-auto rounded-xl border border-white/10 bg-white/5",children:s.jsxs("table",{className:"min-w-[820px] w-full text-sm text-white/90",children:[s.jsx("thead",{className:"bg-white/5 text-white/70 text-left",children:s.jsxs("tr",{children:[s.jsx("th",{className:"py-3 px-4 font-semibold",children:"Кто привел"}),s.jsx("th",{className:"py-3 px-4 font-semibold",children:"Код"}),s.jsx("th",{className:"py-3 px-4 font-semibold",children:"Имя"}),s.jsx("th",{className:"py-3 px-4 font-semibold",children:"Комментарий"}),s.jsx("th",{className:"py-3 px-4 font-semibold text-right",children:"Действия"})]})}),s.jsx("tbody",{children:c.map(F=>{const L=V(F.ownerId),M=t||F.ownerId===(e==null?void 0:e.id);return s.jsxs("tr",{className:"border-t border-white/10 hover:bg-white/5 transition-colors",children:[s.jsx("td",{className:"py-3 px-4 font-semibold text-white whitespace-nowrap",children:L}),s.jsx("td",{className:"py-3 px-4 text-white/80 whitespace-nowrap",children:F.referralId}),s.jsx("td",{className:"py-3 px-4 text-white/80",children:F.name}),s.jsx("td",{className:"py-3 px-4 text-white/70",children:F.comment||"—"}),s.jsxs("td",{className:"py-3 px-4 text-right whitespace-nowrap flex items-center justify-end gap-2",children:[s.jsx("button",{onClick:()=>M&&R(F),className:`px-3 py-1.5 rounded-lg text-xs font-semibold border border-white/20 bg-white/10 text-white transition ${M?"hover:bg-white/20":"opacity-40 cursor-not-allowed"}`,disabled:!M,children:"Редактировать"}),s.jsx("button",{onClick:()=>M&&te(F),className:`px-3 py-1.5 rounded-lg text-xs font-semibold border border-rose-300/60 bg-rose-500/20 text-rose-50 transition ${M?"hover:bg-rose-500/30":"opacity-40 cursor-not-allowed"}`,disabled:!M,children:"Удалить"})]})]},F.id)})})]})}):s.jsx("div",{className:"rounded-xl border border-white/10 bg-white/5 p-4 text-white/70",children:"Пока нет рефералов."})]}),s.jsxs("div",{id:"rating-method",className:`rounded-2xl p-6 sm:p-7 ${z} ${S} border ${$}`,children:[s.jsx("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between mb-4",children:s.jsxs("div",{className:"space-y-1",children:[s.jsx("p",{className:`text-xs uppercase tracking-[0.12em] ${C}`,children:"Карточки участников"}),s.jsx("h3",{className:`text-2xl font-bold ${T}`,children:"Детальная статистика"})]})}),i?s.jsxs("div",{className:`rounded-xl p-12 text-center ${r==="dark"?"bg-white/5":"bg-gray-50"} border ${$}`,children:[s.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-4 border-emerald-500 border-t-transparent mx-auto mb-4"}),s.jsx("p",{className:`text-lg font-semibold ${T}`,children:"Загрузка рейтинга..."}),s.jsx("p",{className:`text-sm ${C} mt-2`,children:"Подождите, собираем статистику"})]}):s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3 mb-6",children:[{label:"Топ-1",value:(oe=y[0])!=null&&oe.rating?`${y[0].rating.toFixed(1)}%`:"—"},{label:"Средний рейтинг",value:`${A.toFixed(1)}%`},{label:"Медиана",value:`${w.median.toFixed(1)}%`},{label:"Участников",value:y.length}].map(F=>s.jsxs("div",{className:`rounded-xl border ${$} ${r==="dark"?"bg-white/5":"bg-gray-50"} px-4 py-3`,children:[s.jsx("p",{className:`text-[11px] uppercase tracking-wide ${C}`,children:F.label}),s.jsx("p",{className:`text-2xl font-extrabold ${T}`,children:F.value})]},F.label))}),s.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-2 gap-6",children:y.map((F,L)=>s.jsx("div",{children:s.jsx(Z_,{rating:F,place:{rank:L+1}})},F.userId))})]})]})]}),h&&s.jsx(eN,{referral:x,onClose:()=>{g(!1),p(null)},onSave:()=>{g(!1),p(null),v()}})]})},mo={trading:Ep,learning:ta,technical:Sp,stream:Xp,research:Pp,organization:Tp},rN=({onClose:r,onSave:e,editingTask:t})=>{var W,ie;const{user:n}=kt(),{theme:a}=it(),i=!!t,o=a==="dark"?"text-white":"text-gray-900",c=a==="dark"?"bg-[#1a1a1a]":"bg-white",d=a==="dark"?"bg-gray-800":"bg-gray-50",h=a==="dark"?"border-gray-800":"border-gray-300",[g,x]=D.useState((t==null?void 0:t.title)||""),[p,v]=D.useState((t==null?void 0:t.description)||""),[A,C]=D.useState((t==null?void 0:t.category)||"trading"),[T,z]=D.useState((t==null?void 0:t.priority)||"medium"),[$,S]=D.useState((t==null?void 0:t.expectedResult)||""),[I,H]=D.useState((t==null?void 0:t.dueDate)||ce(new Date,"yyyy-MM-dd")),[G,E]=D.useState((t==null?void 0:t.dueTime)||"12:00"),y=Q=>({...Q,assignees:Q.assignees||[],approvals:Q.approvals||[],requiresApproval:Q.requiresApproval??!0,stagePriority:Q.stagePriority||"medium",status:Q.status||"pending"}),[w,k]=D.useState((W=t==null?void 0:t.stages)!=null&&W.length?t.stages.map(y):[y({id:"stage-1",name:"Этап 1",description:"",responsible:"all",assignees:[],approvals:[],stagePriority:"medium",requiresApproval:!0,status:"pending"})]),[j,N]=D.useState((t==null?void 0:t.currentStageId)||((ie=w[0])==null?void 0:ie.id)||"stage-1"),[f,de]=D.useState(""),[V,X]=D.useState(!1);In();const R=[{value:"urgent",label:"Экстренный",desc:"Нужно прямо сейчас",tone:a==="dark"?"bg-rose-600/20 border-rose-500/50 text-rose-100":"bg-rose-50 border-rose-200 text-rose-700"},{value:"high",label:"Высокий",desc:"Быстрый старт",tone:a==="dark"?"bg-red-500/15 border-red-500/40 text-red-100":"bg-red-50 border-red-200 text-red-700"},{value:"medium",label:"Средний",desc:"Плановый слот",tone:a==="dark"?"bg-amber-500/15 border-amber-500/40 text-amber-100":"bg-amber-50 border-amber-200 text-amber-700"},{value:"low",label:"Низкий",desc:"Фон",tone:a==="dark"?"bg-gray-500/15 border-gray-500/40 text-gray-100":"bg-gray-50 border-gray-200 text-gray-700"}],te=(Q,B)=>{k(ue=>ue.map(O=>O.id===Q?{...O,...B}:O))},Z=(Q,B)=>{k(ue=>ue.map(O=>O.id!==Q?O:O.assignees.find(Ee=>Ee.userId===B)?{...O,assignees:O.assignees.filter(Ee=>Ee.userId!==B)}:O.assignees.length>=10?O:{...O,assignees:[...O.assignees,{userId:B,priority:"medium"}]}))},oe=(Q,B,ue,O)=>{k(ge=>ge.map(Ee=>{if(Ee.id!==Q)return Ee;const Y=Ee.assignees.map(fe=>fe.userId===B?{...fe,[ue]:O}:fe);return{...Ee,assignees:Y}}))},F=()=>{const Q=y({id:`stage-${Date.now()}`,name:`Этап ${w.length+1}`,description:"",responsible:"all",assignees:[],approvals:[],stagePriority:"medium",requiresApproval:!0,status:"pending"});k(B=>[...B,Q]),j||N(Q.id)},L=Q=>{var ue;if(w.length===1)return;const B=w.filter(O=>O.id!==Q);k(B),j===Q&&N(((ue=B[0])==null?void 0:ue.id)||"")},M=()=>g.trim()?!I||!G?"Укажите дедлайн (дата и время)":new Set(w.flatMap(B=>B.assignees.map(ue=>ue.userId))).size===0?"Добавьте исполнителей в этапах":"":"Введите название задачи",re=(Q,B)=>{const ue=Q.assignees,O=ue.map(Ee=>Ee.userId),ge=O.map(Ee=>{const Y=ue.find(fe=>fe.userId===Ee);return{userId:Ee,status:"pending",updatedAt:B,...Y!=null&&Y.comment?{comment:Y.comment}:{}}});return{id:Q.id,name:Q.name,description:Q.description,responsible:O,assignees:ue,stagePriority:Q.stagePriority||"medium",requiresApproval:!0,approvals:ge,comments:Q.comments||[],status:"pending"}},me=async()=>{var ue;const Q=M();if(Q){de(Q);return}if(!n){de("Пользователь не найден");return}de(""),X(!0);const B=new Date().toISOString();try{const O=w.map(fe=>re(fe,B)),ge=Array.from(new Set(O.flatMap(fe=>{var pe;return((pe=fe.assignees)==null?void 0:pe.map(Ae=>Ae.userId))||[]}))),Ee=ge.map(fe=>({userId:fe,status:"pending",updatedAt:B})),Y={title:g.trim(),description:p.trim()||void 0,category:A,priority:T,assignedTo:ge,assignees:ge.map(fe=>({userId:fe,priority:"medium"})),approvals:Ee,stages:O,currentStageId:j||((ue=O[0])==null?void 0:ue.id),dueDate:I,dueTime:G,expectedResult:$.trim()||void 0,updatedAt:B};if(i&&t)await Mr(t.id,Y);else{const fe={...Y,status:"in_progress",createdBy:n.id,createdAt:B};await I2(fe)}e()}catch(O){console.error("Error saving task:",O),de("Ошибка при сохранении задачи")}finally{X(!1)}};return s.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-start sm:items-center justify-center z-[70] p-4 overflow-y-auto overscroll-contain modal-scroll touch-pan-y",children:s.jsx("div",{className:`${c} rounded-xl sm:rounded-2xl shadow-2xl w-full max-w-2xl max-h-[calc(100vh-48px)] sm:max-h-[calc(100vh-64px)] overflow-y-auto border-2 touch-pan-y ${a==="dark"?"border-[#4E6E49]/30 bg-gradient-to-br from-[#1a1a1a] via-[#1a1a1a] to-[#0A0A0A]":"border-green-200 bg-gradient-to-br from-white via-green-50/30 to-white"} relative`,children:s.jsxs("div",{className:"flex flex-col h-full min-h-0",children:[s.jsxs("div",{className:`sticky top-0 ${c} border-b ${h} p-4 sm:p-6 flex items-center justify-between z-10`,children:[s.jsxs("h2",{className:`text-xl sm:text-2xl font-bold ${o} flex items-center gap-2`,children:[s.jsx(Rp,{className:"w-5 h-5 sm:w-6 sm:h-6"}),i?"Редактировать задачу":"Новая задача"]}),s.jsx("button",{onClick:r,className:`p-2 rounded-lg transition-colors ${a==="dark"?"hover:bg-gray-700":"hover:bg-gray-100"}`,children:s.jsx(Jt,{className:"w-5 h-5"})})]}),s.jsxs("div",{className:"p-4 sm:p-6 space-y-4 sm:space-y-6 flex-1 min-h-0 overflow-y-auto overscroll-contain modal-scroll touch-pan-y pb-10",children:[f&&s.jsxs("div",{className:"p-3 rounded-lg bg-red-500/10 border border-red-500/30 flex items-center gap-2 text-red-500",children:[s.jsx(zp,{className:"w-5 h-5 flex-shrink-0"}),s.jsx("span",{className:"text-sm",children:f})]}),s.jsxs("div",{children:[s.jsx("label",{className:`block text-sm font-medium mb-2 ${o}`,children:"Название *"}),s.jsx("input",{value:g,onChange:Q=>x(Q.target.value),className:`w-full px-4 py-2.5 rounded-lg border ${h} ${d} ${o} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]/50`,placeholder:"Введите название задачи"})]}),s.jsxs("div",{children:[s.jsx("label",{className:`block text-sm font-medium mb-2 ${o}`,children:"Описание"}),s.jsx("textarea",{value:p,onChange:Q=>v(Q.target.value),rows:4,className:`w-full px-4 py-2.5 rounded-lg border ${h} ${d} ${o} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]/50`,placeholder:"Кратко опишите задачу"})]}),s.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[s.jsxs("div",{className:"space-y-3",children:[s.jsxs("label",{className:`block text-sm font-medium ${o} flex items-center gap-2`,children:[s.jsx(sf,{className:"w-4 h-4"}),"Категория"]}),s.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2 sm:gap-3",children:Object.entries(ea).map(([Q,{label:B}])=>{const ue=mo[Q],O=A===Q;return s.jsxs("button",{type:"button",onClick:()=>C(Q),className:`p-3 rounded-lg border-2 text-sm font-semibold transition-all text-center ${O?a==="dark"?"border-[#4E6E49] bg-[#4E6E49]/15 text-[#4E6E49]":"border-[#4E6E49] bg-green-50 text-[#4E6E49]":a==="dark"?"border-gray-800 bg-gray-900 text-gray-200 hover:border-[#4E6E49]/40":"border-gray-200 bg-white text-gray-800 hover:border-[#4E6E49]/40"} flex items-center justify-center gap-2`,children:[s.jsx(ue,{className:"w-4 h-4"}),s.jsx("span",{children:B})]},Q)})})]}),s.jsxs("div",{className:"space-y-3",children:[s.jsxs("label",{className:`block text-sm font-medium ${o} flex items-center gap-2`,children:[s.jsx(Yt,{className:"w-4 h-4"}),"Приоритет"]}),s.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2",children:R.map(Q=>s.jsxs("button",{type:"button",onClick:()=>z(Q.value),className:`p-3 rounded-lg border-2 text-left transition-all ${Q.tone} ${T===Q.value?"ring-2 ring-offset-2 ring-[#4E6E49] dark:ring-offset-[#1a1a1a]":""}`,children:[s.jsxs("div",{className:"flex items-center justify-between gap-2",children:[s.jsx("span",{className:"font-semibold text-sm",children:Q.label}),T===Q.value&&s.jsx("span",{className:"text-xs font-semibold",children:"выбрано"})]}),s.jsx("p",{className:"text-xs mt-1 opacity-80",children:Q.desc})]},Q.value))})]})]}),s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("label",{className:`block text-sm font-medium ${o}`,children:"Этапы и исполнители"}),s.jsxs("button",{type:"button",onClick:F,className:`px-3 py-1.5 rounded-lg text-xs font-semibold ${a==="dark"?"bg-gray-700 hover:bg-gray-600 text-gray-200":"bg-gray-200 hover:bg-gray-300 text-gray-800"}`,children:[s.jsx(ra,{className:"w-4 h-4 inline"})," Добавить этап"]})]}),s.jsx("div",{className:"space-y-3",children:w.map((Q,B)=>s.jsxs("div",{className:`p-3 rounded-lg border-2 ${h} ${d}`,children:[s.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[s.jsx("input",{value:Q.name,onChange:ue=>te(Q.id,{name:ue.target.value}),className:`flex-1 px-3 py-2 rounded-lg border ${h} ${a==="dark"?"bg-[#0f0f0f] text-gray-100":"bg-white text-gray-800"}`,placeholder:`Этап ${B+1}`}),w.length>1&&s.jsx("button",{onClick:()=>L(Q.id),className:`p-2 rounded-lg ${a==="dark"?"bg-red-500/20 text-red-200":"bg-red-100 text-red-700"}`,children:s.jsx(af,{className:"w-4 h-4"})})]}),s.jsx("textarea",{value:Q.description||"",onChange:ue=>te(Q.id,{description:ue.target.value}),rows:2,className:`w-full px-3 py-2 rounded-lg border ${h} ${a==="dark"?"bg-[#0f0f0f] text-gray-100":"bg-white text-gray-800"}`,placeholder:"Описание этапа (опционально)"}),s.jsxs("div",{className:"mt-3 space-y-2",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("label",{className:`text-sm font-medium ${o} flex items-center gap-2`,children:[s.jsx(bn,{className:"w-4 h-4"}),"Исполнители этапа"]}),s.jsxs("span",{className:"text-[11px] text-gray-500",children:[Q.assignees.length,"/10"]})]}),s.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-2",children:Se.map(ue=>{const O=Q.assignees.some(ge=>ge.userId===ue.id);return s.jsx("button",{type:"button",onClick:()=>Z(Q.id,ue.id),className:`p-2 rounded-lg border text-left text-sm transition-all ${O?a==="dark"?"border-[#4E6E49] bg-[#4E6E49]/20":"border-[#4E6E49] bg-green-50":`${h} ${d}`}`,children:s.jsx("span",{className:O?"text-[#4E6E49]":o,children:ue.name})},ue.id)})}),Q.assignees.length>0&&s.jsx("div",{className:"space-y-2",children:Q.assignees.map(ue=>{const O=Se.find(ge=>ge.id===ue.userId);return s.jsxs("div",{className:`p-2 rounded-lg border ${h} ${a==="dark"?"bg-[#0f0f0f]":"bg-white"}`,children:[s.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2",children:[s.jsx("div",{className:"text-sm font-medium",children:(O==null?void 0:O.name)||ue.userId}),s.jsxs("select",{value:ue.priority,onChange:ge=>oe(Q.id,ue.userId,"priority",ge.target.value),className:`px-3 py-1.5 rounded-lg border ${h} ${a==="dark"?"bg-[#1a1a1a] text-gray-100":"bg-white text-gray-700"}`,children:[s.jsx("option",{value:"urgent",children:"Экстренный"}),s.jsx("option",{value:"high",children:"Высокий"}),s.jsx("option",{value:"medium",children:"Средний"}),s.jsx("option",{value:"low",children:"Низкий"})]})]}),s.jsx("textarea",{value:ue.comment||"",onChange:ge=>oe(Q.id,ue.userId,"comment",ge.target.value),rows:2,className:`mt-2 w-full px-3 py-2 rounded-lg border ${h} ${a==="dark"?"bg-[#1a1a1a] text-gray-100":"bg-white text-gray-700"}`,placeholder:"Комментарий для исполнителя (опционально)"})]},ue.userId)})})]})]},Q.id))})]}),s.jsxs("div",{children:[s.jsxs("label",{className:`block text-sm font-medium mb-2 ${o} flex items-center gap-2`,children:[s.jsx(ns,{className:"w-4 h-4"}),"Какой результат должен быть"]}),s.jsx("textarea",{value:$,onChange:Q=>S(Q.target.value),rows:3,className:`w-full px-4 py-2.5 rounded-lg border ${h} ${d} ${o} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]/50`,placeholder:"Опишите ожидаемый итог"})]}),s.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[s.jsxs("div",{className:"space-y-1",children:[s.jsxs("label",{className:`text-sm font-medium ${o} flex items-center gap-2`,children:[s.jsx(Ur,{className:"w-4 h-4"}),"Дата дедлайна *"]}),s.jsx("input",{type:"date",value:I,onChange:Q=>H(Q.target.value),min:ce(new Date,"yyyy-MM-dd"),className:`w-full px-4 py-2.5 rounded-lg border ${h} ${d} ${o} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]/50`})]}),s.jsxs("div",{className:"space-y-1",children:[s.jsxs("label",{className:`text-sm font-medium ${o} flex items-center gap-2`,children:[s.jsx(Ps,{className:"w-4 h-4"}),"Время дедлайна *"]}),s.jsx("input",{type:"time",value:G,onChange:Q=>E(Q.target.value),className:`w-full px-4 py-2.5 rounded-lg border ${h} ${d} ${o} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]/50`})]})]}),s.jsxs("div",{className:`flex flex-col sm:flex-row gap-3 pt-4 border-t ${h}`,children:[s.jsx("button",{onClick:me,disabled:V,className:`flex-1 px-6 py-3 rounded-lg font-semibold transition-all ${V?"bg-gray-400 cursor-not-allowed":"bg-gradient-to-r from-[#4E6E49] to-emerald-700 hover:from-[#4E6E49] hover:to-emerald-700 text-white shadow-lg hover:shadow-xl transform hover:scale-[1.02]"}`,children:V?"Сохранение...":i?"Сохранить":"Создать задачу"}),s.jsx("button",{onClick:r,className:`px-6 py-3 rounded-lg font-semibold transition-colors ${a==="dark"?"bg-gray-700 hover:bg-gray-600 text-gray-300":"bg-gray-200 hover:bg-gray-300 text-gray-700"}`,children:"Отмена"})]})]})]})})})},_c=60*1e3,ga=60*_c,Zu=24*ga,sN=r=>{if(r<=0)return"Просрочено";const e=Math.floor(r/Zu),t=Math.floor(r%Zu/ga),n=Math.floor(r%ga/_c);return e>0?`${e}д ${t}ч`:t>0?`${t}ч ${n}м`:`${Math.max(n,1)}м`},nN=r=>r<=0?"overdue":r<=ga?"urgent":r<=6*ga?"soon":"on_track",zo=(r,e)=>{if(!r||!e)return{label:"—",status:"unknown",isOverdue:!1};const n=new Date(`${r}T${e}`).getTime()-Date.now();if(Number.isNaN(n))return{label:"—",status:"unknown",isOverdue:!1};const a=nN(n);return{label:sN(n),status:a,isOverdue:a==="overdue"}},aN=(r,e)=>{const t=D.useMemo(()=>zo(r,e),[r,e]),[n,a]=D.useState(t);return D.useEffect(()=>{a(zo(r,e));const i=setInterval(()=>{a(zo(r,e))},_c);return()=>clearInterval(i)},[r,e]),n},iN=(r,e)=>e==="dark"?{overdue:"bg-red-500/10 border-red-500/40 text-red-300",urgent:"bg-orange-500/10 border-orange-500/40 text-orange-200",soon:"bg-yellow-500/10 border-yellow-500/40 text-yellow-200",on_track:"bg-[#4E6E49]/10 border-[#4E6E49]/40 text-green-200",unknown:"bg-gray-600/30 border-gray-500/40 text-gray-200"}[r]:{overdue:"bg-red-50 border-red-200 text-red-600",urgent:"bg-orange-50 border-orange-200 text-orange-600",soon:"bg-yellow-50 border-yellow-200 text-yellow-700",on_track:"bg-green-50 border-green-200 text-[#4E6E49]",unknown:"bg-gray-100 border-gray-200 text-gray-600"}[r],d0=({dueDate:r,dueTime:e,theme:t,size:n="default"})=>{const{label:a,status:i}=aN(r,e),o=iN(i,t),c=n==="compact"?"px-2 py-0.5 text-[11px]":"px-2.5 py-1 text-xs sm:text-sm",d=n==="compact"?"w-3 h-3":"w-4 h-4";return s.jsxs("span",{className:`inline-flex items-center gap-1 rounded-full border font-medium ${c} ${o}`,children:[s.jsx(Ps,{className:d}),a]})},oN=({task:r,onEdit:e,onDelete:t,onUpdate:n})=>{const{user:a}=kt(),{isAdmin:i}=Tt(),{theme:o}=it(),[c,d]=D.useState(!1),[h,g]=D.useState(!1),[x,p]=D.useState(""),v=o==="dark"?"text-white":"text-gray-900",A=o==="dark"?"bg-[#1a1a1a]":"bg-white",C=o==="dark"?"border-gray-800":"border-gray-300",T=ea[r.category],z=Ss[r.status],$=mo[r.category],S=Se.find(M=>M.id===r.createdBy),I=r.assignees&&r.assignees.length>0?r.assignees:r.assignedTo.map(M=>({userId:M,priority:"medium"})),H=I.map(M=>M.userId),G=I.map(M=>{const re=Se.find(me=>me.id===M.userId);return re?{...M,member:re}:null}).filter(Boolean),E=i||(a==null?void 0:a.id)===r.createdBy||r.mainExecutor===(a==null?void 0:a.id),y=()=>{const M=new Date().toISOString(),me=(r.approvals||[]).filter(ie=>H.includes(ie.userId)).map(ie=>({userId:ie.userId,status:ie.status==="approved"?"approved":"pending",updatedAt:ie.updatedAt||M,...ie.comment?{comment:ie.comment}:{}})),W=H.filter(ie=>!me.some(Q=>Q.userId===ie)).map(ie=>({userId:ie,status:"pending",updatedAt:M}));return[...me,...W]},w=()=>!!a&&H.includes(a.id),k=()=>i||(a==null?void 0:a.id)===r.createdBy,j=()=>{const M=y(),re=M.filter(me=>me.status==="approved").length;return{approvals:M,approved:re,total:H.length}},{approvals:N,approved:f,total:de}=j(),V=N.find(M=>M.userId===(a==null?void 0:a.id)),X=w()&&r.status==="in_progress"&&(!V||V.status!=="approved"),R=k()&&r.status==="completed",te=async()=>{if(!(!a||r.status!=="in_progress"||!w())){d(!0);try{const M=new Date().toISOString(),re=y().map(ie=>ie.userId===a.id?{...ie,status:"approved",updatedAt:M}:ie),me=H.length>0&&H.every(ie=>re.find(Q=>Q.userId===ie&&Q.status==="approved")),W={approvals:re,updatedAt:M};me&&(W.status="completed",W.completedAt=M,W.completedBy=a.id),await Mr(r.id,W),n()}catch(M){console.error("Error confirming task:",M)}finally{d(!1)}}},Z=async()=>{if(!(!k()||r.status!=="completed")){d(!0);try{const M=new Date().toISOString();await Mr(r.id,{status:"closed",closedAt:M,updatedAt:M}),n()}catch(M){console.error("Error closing task:",M)}finally{d(!1)}}},oe=async()=>{if(!k())return;const M=(x||"").trim();if(M){d(!0);try{const re=new Date().toISOString(),me=H.map(ie=>({userId:ie,status:"pending",updatedAt:re})),W={id:`c-${Date.now()}`,userId:(a==null?void 0:a.id)||"system",text:M,createdAt:re};await Mr(r.id,{status:"in_progress",approvals:me,completedAt:void 0,completedBy:void 0,closedAt:void 0,comments:[...r.comments||[],W],updatedAt:re}),g(!1),p(""),n()}catch(re){console.error("Error returning task:",re)}finally{d(!1)}}},F=()=>({in_progress:o==="dark"?"bg-blue-500/20 border-blue-500/50 text-blue-400":"bg-blue-50 border-blue-200 text-blue-700",completed:o==="dark"?"bg-[#4E6E49]/20 border-[#4E6E49]/50 text-[#4E6E49]":"bg-green-50 border-green-200 text-[#4E6E49]",closed:o==="dark"?"bg-gray-500/20 border-gray-500/50 text-gray-400":"bg-gray-50 border-gray-200 text-gray-700"})[r.status],L=()=>{const M={green:{bg:o==="dark"?"bg-[#4E6E49]/20":"bg-green-50",text:"text-[#4E6E49]"},blue:{bg:o==="dark"?"bg-blue-500/20":"bg-blue-50",text:o==="dark"?"text-blue-400":"text-blue-700"},purple:{bg:o==="dark"?"bg-purple-500/20":"bg-purple-50",text:o==="dark"?"text-purple-400":"text-purple-700"},red:{bg:o==="dark"?"bg-red-500/20":"bg-red-50",text:o==="dark"?"text-red-400":"text-red-700"},yellow:{bg:o==="dark"?"bg-yellow-500/20":"bg-yellow-50",text:o==="dark"?"text-yellow-400":"text-yellow-700"},indigo:{bg:o==="dark"?"bg-indigo-500/20":"bg-indigo-50",text:o==="dark"?"text-indigo-400":"text-indigo-700"}};return M[T.color]||M.green};return s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:`${A} rounded-xl border-2 ${C} p-4 sm:p-6 shadow-lg hover:shadow-xl transition-all ${o==="dark"?"hover:border-[#4E6E49]/50":"hover:border-[#4E6E49]"}`,children:[s.jsxs("div",{className:"flex items-start justify-between gap-3 mb-3",children:[s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsx("div",{className:"flex items-center gap-2 mb-2",children:s.jsx("h3",{className:`text-lg sm:text-xl font-bold ${v} truncate`,children:r.title})}),s.jsxs("div",{className:"flex flex-wrap items-center gap-2 sm:gap-3",children:[s.jsxs("span",{className:`px-2.5 py-1 rounded-lg text-xs sm:text-sm font-medium ${L().bg} ${L().text} inline-flex items-center gap-1.5`,children:[s.jsx($,{className:"w-4 h-4"}),T.label]}),s.jsx("span",{className:`px-2.5 py-1 rounded-lg text-xs sm:text-sm font-medium border ${F()}`,children:z.label}),s.jsx("span",{className:`px-2.5 py-1 rounded-lg text-xs sm:text-sm font-medium border ${o==="dark"?"border-yellow-500/40 text-yellow-200 bg-yellow-500/10":"border-yellow-200 text-yellow-700 bg-yellow-50"}`,children:r.priority==="urgent"?"Экстренный приоритет":r.priority==="high"?"Высокий приоритет":r.priority==="medium"?"Средний приоритет":"Низкий приоритет"})]})]}),E&&s.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[s.jsx("button",{onClick:()=>e(r),className:`p-2 rounded-lg transition-colors ${o==="dark"?"hover:bg-gray-700":"hover:bg-gray-100"}`,title:"Редактировать",children:s.jsx(tr,{className:"w-4 h-4"})}),s.jsx("button",{onClick:()=>t(r.id),className:`p-2 rounded-lg transition-colors ${o==="dark"?"hover:bg-red-500/20 text-red-400":"hover:bg-red-50 text-red-600"}`,title:"Удалить",children:s.jsx(Pt,{className:"w-4 h-4"})})]})]}),r.description&&s.jsx("p",{className:`text-sm ${o==="dark"?"text-gray-300":"text-gray-600"} mb-4 line-clamp-2`,children:r.description}),s.jsxs("div",{className:"space-y-2 mb-4",children:[s.jsxs("div",{className:"flex flex-col gap-3",children:[s.jsxs("div",{className:"flex items-center gap-2 text-xs sm:text-sm",children:[s.jsx(cn,{className:`w-4 h-4 ${o==="dark"?"text-blue-400":"text-blue-600"}`}),s.jsx("span",{className:`font-medium ${o==="dark"?"text-gray-300":"text-gray-700"}`,children:"Автор:"}),s.jsx("span",{className:o==="dark"?"text-gray-400":"text-gray-600",children:(S==null?void 0:S.name)||"Неизвестно"})]}),s.jsxs("div",{children:[s.jsxs("div",{className:"flex items-center gap-2 text-xs sm:text-sm",children:[s.jsx(bn,{className:"w-4 h-4 text-[#4E6E49]"}),s.jsx("span",{className:`font-medium ${o==="dark"?"text-gray-300":"text-gray-700"}`,children:"Исполнители:"})]}),G.length>0?s.jsx("div",{className:"mt-2 space-y-1",children:G.map(M=>s.jsx("div",{className:`text-sm ${o==="dark"?"text-gray-100":"text-gray-800"}`,children:M.member.name},M.member.id))}):s.jsx("span",{className:"text-gray-500",children:"Не назначены"})]})]}),s.jsxs("div",{className:"flex items-center gap-3 flex-wrap text-xs sm:text-sm",children:[s.jsxs("span",{className:"inline-flex items-center gap-1",children:[s.jsx(Ur,{className:`w-4 h-4 ${o==="dark"?"text-gray-400":"text-gray-500"}`}),s.jsxs("span",{className:o==="dark"?"text-gray-400":"text-gray-600",children:["Дедлайн: ",ce(new Date(r.dueDate),"dd.MM.yyyy")," ",r.dueTime]})]}),s.jsx(d0,{dueDate:r.dueDate,dueTime:r.dueTime,theme:o})]}),de>0&&s.jsxs("div",{className:"flex items-center gap-2 text-xs sm:text-sm",children:[s.jsx(gh,{className:`w-4 h-4 ${o==="dark"?"text-yellow-400":"text-yellow-600"}`}),s.jsxs("span",{className:o==="dark"?"text-yellow-400":"text-yellow-600",children:["Подтвердили: ",f,"/",de]})]})]}),s.jsxs("div",{className:`mt-4 p-3 rounded-lg border ${C} ${o==="dark"?"bg-[#1a1a1a]/70":"bg-gray-50"}`,children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsx("span",{className:"text-sm font-semibold",children:"Подтверждения исполнителей"}),s.jsxs("span",{className:"text-xs text-gray-500",children:[f,"/",de]})]}),N.length>0&&s.jsx("div",{className:"space-y-1 text-xs",children:N.map(M=>{const re=Se.find(W=>W.id===M.userId),me=M.status==="approved"?"подтвердил":"ожидает";return s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("span",{className:"flex items-center gap-1",children:[s.jsx("span",{className:"font-medium",children:(re==null?void 0:re.name)||M.userId}),s.jsxs("span",{className:"text-gray-500",children:["(",me,")"]})]}),M.comment&&s.jsx("span",{className:"text-gray-500 truncate max-w-[140px]",children:M.comment})]},M.userId)})})]}),s.jsxs("div",{className:`flex flex-wrap gap-2 pt-4 border-t ${C}`,children:[X&&s.jsxs("button",{onClick:te,disabled:c,className:"flex-1 sm:flex-none px-4 py-2 bg-[#4E6E49] hover:bg-[#4E6E49] text-white rounded-lg text-sm font-medium transition-colors flex items-center justify-center gap-2 disabled:opacity-50",children:[s.jsx(Rs,{className:"w-4 h-4"}),"Подтвердить"]}),R&&s.jsxs(s.Fragment,{children:[s.jsxs("button",{onClick:Z,disabled:c,className:"flex-1 sm:flex-none px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg text-sm font-medium transition-colors flex items-center justify-center gap-2 disabled:opacity-50",children:[s.jsx(Ds,{className:"w-4 h-4"}),"Закрыто"]}),s.jsxs("button",{onClick:()=>g(!0),disabled:c,className:"flex-1 sm:flex-none px-4 py-2 bg-red-500 hover:bg-red-600 text-white rounded-lg text-sm font-medium transition-colors flex items-center justify-center gap-2 disabled:opacity-50",children:[s.jsx(Jt,{className:"w-4 h-4"}),"Не выполнено"]})]}),r.status==="completed"&&!R&&s.jsx("span",{className:`text-xs ${o==="dark"?"text-gray-400":"text-gray-600"}`,children:"Ожидает подтверждения автора"})]})]}),h&&s.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-start sm:items-center justify-center z-[70] p-4 overflow-y-auto overscroll-contain modal-scroll",children:s.jsxs("div",{className:`${A} rounded-xl p-6 max-w-md w-full border-2 ${C}`,children:[s.jsx("h3",{className:`text-lg font-bold mb-4 ${v}`,children:"Не выполнено"}),s.jsx("textarea",{value:x,onChange:M=>p(M.target.value),placeholder:"Опишите, что нужно доработать",rows:3,className:`w-full px-4 py-2 rounded-lg border ${C} ${o==="dark"?"bg-gray-700":"bg-gray-50"} ${v} mb-4 focus:outline-none focus:ring-2 focus:ring-[#4E6E49]/50`}),s.jsxs("div",{className:"flex gap-3",children:[s.jsx("button",{onClick:oe,disabled:c||!x.trim(),className:"flex-1 px-4 py-2 rounded-lg font-medium transition-colors bg-red-500 hover:bg-red-600 text-white disabled:opacity-50",children:"Отправить на доработку"}),s.jsx("button",{onClick:()=>{g(!1),p("")},className:`px-4 py-2 rounded-lg font-medium transition-colors ${o==="dark"?"bg-gray-700 hover:bg-gray-600":"bg-gray-200 hover:bg-gray-300"}`,children:"Отмена"})]})]})})]})},lN=({selectedCategory:r,selectedStatus:e,selectedUsers:t,onCategoryChange:n,onStatusChange:a,onUsersChange:i,onClear:o})=>{const{theme:c}=it(),d=c==="dark"?"text-white":"text-gray-900",h=c==="dark"?"bg-[#1a1a1a]":"bg-white",g=c==="dark"?"border-gray-800":"border-gray-300",x=r!=="all"||e!=="all"||t.length>0,p=Se.filter(C=>t.includes(C.id)).map(C=>C.name),v=[{href:"#filter-status",label:"Статусы"},{href:"#filter-category",label:"Категории"},{href:"#filter-people",label:"Исполнители"}],A={in_progress:s.jsx(Hn,{className:"w-4 h-4"}),completed:s.jsx(Ds,{className:"w-4 h-4"}),closed:s.jsx(kp,{className:"w-4 h-4"})};return s.jsxs("div",{className:`${h} rounded-xl border-2 ${g} p-4 sm:p-6 shadow-lg sticky top-4 space-y-4`,children:[s.jsxs("div",{className:"flex items-start justify-between gap-3",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:`p-2 rounded-lg ${c==="dark"?"bg-[#4E6E49]/20":"bg-green-50"}`,children:s.jsx(ph,{className:"w-5 h-5 text-[#4E6E49]"})}),s.jsxs("div",{children:[s.jsx("h3",{className:`text-lg font-bold ${d}`,children:"Фильтры"}),s.jsx("p",{className:`text-xs ${c==="dark"?"text-gray-400":"text-gray-500"}`,children:"Быстрая навигация по статусам, категориям и участникам"})]})]}),x&&s.jsxs("button",{onClick:o,className:`px-3 py-1.5 rounded-lg text-sm transition-all flex items-center gap-2 ${c==="dark"?"bg-red-500/20 hover:bg-red-500/30 text-red-300 border border-red-500/50":"bg-red-50 hover:bg-red-100 text-red-600 border border-red-200"}`,children:[s.jsx(Jt,{className:"w-4 h-4"}),s.jsx("span",{className:"hidden sm:inline",children:"Сбросить всё"})]})]}),s.jsx("div",{className:"flex flex-wrap gap-2",children:v.map(C=>s.jsxs("a",{href:C.href,className:`px-3 py-1.5 rounded-lg text-xs font-semibold border transition flex items-center gap-2 ${c==="dark"?"border-white/10 bg-white/5 text-gray-100 hover:border-[#4E6E49]/50":"border-gray-200 bg-white text-gray-800 hover:border-[#4E6E49]/50 hover:text-[#4E6E49]"}`,children:[s.jsx(bd,{className:"w-4 h-4"}),C.label]},C.href))}),s.jsxs("div",{className:`rounded-lg border ${g} ${c==="dark"?"bg-[#1f1f1f]":"bg-gray-50"} p-3 space-y-2`,children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(Kp,{className:"w-4 h-4 text-[#4E6E49]"}),s.jsx("p",{className:`text-sm font-semibold ${d}`,children:"Текущая подборка"})]}),s.jsx("div",{className:"flex flex-wrap gap-2",children:x?s.jsxs(s.Fragment,{children:[r!=="all"&&s.jsx("span",{className:"px-2.5 py-1 rounded-full text-xs font-semibold bg-emerald-500/10 text-emerald-700 dark:text-emerald-200 border border-emerald-500/30",children:ea[r].label}),e!=="all"&&s.jsx("span",{className:"px-2.5 py-1 rounded-full text-xs font-semibold bg-sky-500/10 text-sky-700 dark:text-sky-200 border border-sky-500/30",children:Ss[e].label}),t.length>0&&s.jsx("span",{className:"px-2.5 py-1 rounded-full text-xs font-semibold bg-purple-500/10 text-purple-700 dark:text-purple-200 border border-purple-500/30",children:p.join(", ")})]}):s.jsx("span",{className:`text-xs ${c==="dark"?"text-gray-400":"text-gray-500"}`,children:"Фильтры не заданы"})})]}),s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{id:"filter-status",className:"space-y-3",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(Fp,{className:"w-4 h-4 text-yellow-500"}),s.jsx("label",{className:`block text-sm font-semibold ${d}`,children:"Статусы"})]}),s.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[s.jsxs("button",{onClick:()=>a("all"),className:`px-3 py-2 rounded-lg text-sm font-semibold transition-all border-2 ${e==="all"?c==="dark"?"bg-[#4E6E49]/20 border-[#4E6E49] text-[#4E6E49]":"bg-green-50 border-[#4E6E49] text-[#4E6E49]":`${c==="dark"?"bg-gray-800 border-gray-800 text-gray-200 hover:bg-gray-700":"bg-white border-gray-200 text-gray-700 hover:border-[#4E6E49]/40"}`} flex items-center gap-2 justify-start text-left w-full`,children:[s.jsx(ri,{className:"w-4 h-4"}),"Целиком"]}),Object.entries(Ss).map(([C,{label:T,color:z}])=>{const $={yellow:c==="dark"?"bg-yellow-500/10 border-yellow-500/50 text-yellow-300":"bg-yellow-50 border-yellow-500/40 text-yellow-700",blue:c==="dark"?"bg-blue-500/10 border-blue-500/50 text-blue-300":"bg-blue-50 border-blue-500/40 text-blue-700",purple:c==="dark"?"bg-purple-500/10 border-purple-500/50 text-purple-200":"bg-purple-50 border-purple-500/40 text-purple-700",green:c==="dark"?"bg-emerald-500/10 border-emerald-500/50 text-emerald-200":"bg-emerald-50 border-emerald-500/40 text-emerald-700",gray:c==="dark"?"bg-gray-500/10 border-gray-500/50 text-gray-300":"bg-gray-50 border-gray-400/60 text-gray-700",red:c==="dark"?"bg-red-500/10 border-red-500/50 text-red-300":"bg-red-50 border-red-500/40 text-red-700"},S=$[z]||$.gray,I=A[C];return s.jsx("button",{onClick:()=>a(C),className:`px-3 py-2 rounded-lg text-sm font-semibold transition-all border-2 flex items-center justify-start gap-3 text-left ${e===C?S:c==="dark"?"bg-gray-900 border-gray-800 text-gray-200 hover:border-[#4E6E49]/40":"bg-white border-gray-200 text-gray-700 hover:border-[#4E6E49]/40"}`,children:s.jsxs("span",{className:"flex items-center gap-2",children:[I,T]})},C)})]})]}),s.jsxs("div",{id:"filter-category",className:"space-y-3",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(Yt,{className:"w-4 h-4 text-purple-500"}),s.jsx("label",{className:`block text-sm font-semibold ${d}`,children:"Категории"})]}),s.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2",children:[s.jsxs("button",{onClick:()=>n("all"),className:`px-3 py-3 rounded-lg text-sm font-semibold transition-all border-2 flex items-center gap-2 justify-start text-left w-full ${r==="all"?c==="dark"?"bg-[#4E6E49]/20 border-[#4E6E49] text-[#4E6E49]":"bg-green-50 border-[#4E6E49] text-[#4E6E49]":`${c==="dark"?"bg-gray-900 border-gray-800 text-gray-200 hover:border-[#4E6E49]/40":"bg-white border-gray-200 text-gray-700 hover:border-[#4E6E49]/40"}`}`,children:[s.jsx(bd,{className:"w-4 h-4"}),"Всё"]}),Object.entries(ea).map(([C,{label:T}])=>{const z=mo[C],$=r===C;return s.jsx("button",{onClick:()=>n(C),className:`px-3 py-3 rounded-lg text-sm font-semibold transition-all border-2 flex flex-col items-start gap-2 text-left leading-tight whitespace-normal ${$?c==="dark"?"bg-[#4E6E49]/20 border-[#4E6E49] text-[#4E6E49]":"bg-green-50 border-[#4E6E49] text-[#4E6E49]":`${c==="dark"?"bg-gray-900 border-gray-800 text-gray-200 hover:border-[#4E6E49]/40":"bg-white border-gray-200 text-gray-700 hover:border-[#4E6E49]/40"}`}`,children:s.jsxs("span",{className:"flex items-center gap-2 justify-start",children:[s.jsx(z,{className:"w-4 h-4"}),s.jsx("span",{className:"break-words",children:T})]})},C)})]})]}),s.jsxs("div",{id:"filter-people",className:"space-y-3",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(bn,{className:"w-4 h-4 text-sky-500"}),s.jsx("label",{className:`block text-sm font-semibold ${d}`,children:"Исполнители"})]}),s.jsxs("div",{className:"flex flex-wrap gap-2",children:[s.jsx("button",{onClick:()=>i([]),className:`px-3 py-2 rounded-lg text-sm font-semibold transition-all border-2 ${t.length===0?c==="dark"?"bg-[#4E6E49]/20 border-[#4E6E49] text-[#4E6E49]":"bg-green-50 border-[#4E6E49] text-[#4E6E49]":`${c==="dark"?"bg-gray-900 border-gray-800 text-gray-200 hover:border-[#4E6E49]/40":"bg-white border-gray-200 text-gray-700 hover:border-[#4E6E49]/40"}`}`,children:"Все"}),Se.map(C=>{const T=t.includes(C.id);return s.jsxs("button",{onClick:()=>{i(T?t.filter(z=>z!==C.id):[...t,C.id])},className:`px-3 py-2 rounded-lg text-sm font-semibold transition-all border-2 flex items-center gap-2 ${T?c==="dark"?"bg-[#4E6E49]/20 border-[#4E6E49] text-[#4E6E49]":"bg-green-50 border-[#4E6E49] text-[#4E6E49]":`${c==="dark"?"bg-gray-900 border-gray-800 text-gray-200 hover:border-[#4E6E49]/40":"bg-white border-gray-200 text-gray-700 hover:border-[#4E6E49]/40"}`}`,children:[s.jsx(Ip,{className:`w-3 h-3 ${T?"text-[#4E6E49]":"text-gray-400"}`}),C.name]},C.id)})]})]})]})]})},cN=({tasks:r,onUpdate:e,onEdit:t,onDelete:n})=>{var qe,Je;const{theme:a}=it(),{user:i}=kt(),{isAdmin:o}=Tt(),[c,d]=D.useState(null),[h,g]=D.useState(null),[x,p]=D.useState(null),[v,A]=D.useState(""),[C,T]=D.useState(null),[z,$]=D.useState(null),[S,I]=D.useState(null),[H,G]=D.useState(null),E=a==="dark"?"text-white":"text-gray-900",y=a==="dark"?"bg-[#1a1a1a]":"bg-white",w=a==="dark"?"border-gray-800":"border-gray-300",k=["in_progress","completed","closed"],j=q=>q.assignees&&q.assignees.length>0?q.assignees:q.assignedTo.map(ae=>({userId:ae,priority:"medium"})),N=q=>j(q).map(ae=>ae.userId),f=q=>{if(q.stages&&q.stages.length>0){const ae=q.awaitingStageId||q.currentStageId||q.stages[0].id;return q.stages.find(De=>De.id===ae)||q.stages[0]}return{id:"legacy-stage",name:"Этап",responsible:"all",approvals:q.approvals||[],status:"pending",comments:[]}},de=q=>!!i&&q.createdBy===i.id,V=q=>!!i&&q.mainExecutor===i.id,X=q=>!!i&&(q.leadExecutor===i.id||(q.leads||[]).includes(i.id)),R=q=>o||de(q)||V(q)||X(q),te=(q,ae)=>ae===q.createdBy?"A":ae===q.mainExecutor?"ГИ":ae===q.leadExecutor||(q.leads||[]).includes(ae)?"ВИ":"",Z=q=>r.filter(ae=>ae.status===q),oe=(q,ae)=>{if(C||!R(ae)){q.preventDefault();return}d(ae),q.dataTransfer.effectAllowed="move",q.dataTransfer.setData("text/plain",ae.id)},F=q=>{q.preventDefault(),q.dataTransfer.dropEffect="move"},L=()=>{d(null)},M=(q,ae)=>{if(C||!R(ae))return;const De=q.touches[0];$({x:De.clientX,y:De.clientY,task:ae})},re=q=>{if(!z)return;q.preventDefault();const ae=q.touches[0],De=document.elementFromPoint(ae.clientX,ae.clientY);if(De){const ee=De.closest("[data-status]");if(ee){const Me=ee.getAttribute("data-status");Me&&I(Me)}}},me=async(q,ae)=>{if(!z)return;const De=q.changedTouches[0],ee=document.elementFromPoint(De.clientX,De.clientY);if(ee){const Me=ee.closest("[data-status]");if(Me){const Ue=Me.getAttribute("data-status");Ue&&Ue!==ae&&await O(z.task,Ue)}}$(null),I(null)},W=q=>{const ae=N(q),De=new Date().toISOString(),Me=(q.approvals||[]).filter(P=>ae.includes(P.userId)).map(P=>({userId:P.userId,status:P.status==="approved"?"approved":"pending",updatedAt:P.updatedAt||De,...P.comment?{comment:P.comment}:{}})),Ue=ae.filter(P=>!Me.some(_=>_.userId===P)).map(P=>({userId:P,status:"pending",updatedAt:De}));return[...Me,...Ue]},ie=q=>{const ae=W(q),De=N(q).length,ee=ae.filter(Me=>Me.status==="approved").length;return{approvals:ae,approved:ee,total:De}},Q=q=>!!i&&N(q).includes(i.id),B=q=>o||de(q),ue=async(q,ae)=>{if(q.preventDefault(),q.stopPropagation(),!c||c.status===ae||C||!R(c)){d(null);return}const{approvals:De,approved:ee,total:Me}=ie(c),Ue=new Date().toISOString();if(ae==="completed"&&(Me===0||ee<Me)){d(null);return}if(ae==="closed"&&(!B(c)||c.status!=="completed")){d(null);return}const P={status:ae,updatedAt:Ue};ae==="completed"?(P.completedAt=Ue,P.completedBy=(i==null?void 0:i.id)||"system",P.approvals=De):ae==="closed"?P.closedAt=Ue:ae==="in_progress"&&(P.approvals=N(c).map(_=>({userId:_,status:"pending",updatedAt:Ue})),P.completedAt=void 0,P.completedBy=void 0,P.closedAt=void 0),T(c.id);try{await Mr(c.id,P),e()}catch(_){console.error("Error updating task status:",_)}finally{T(null),d(null)}},O=async(q,ae)=>{if(q.status===ae||C===q.id||!R(q)){g(null);return}const{approvals:De,approved:ee,total:Me}=ie(q),Ue=new Date().toISOString();if(ae==="completed"&&(Me===0||ee<Me)){g(null);return}if(ae==="closed"&&(!B(q)||q.status!=="completed")){g(null);return}const P={status:ae,updatedAt:Ue};ae==="completed"?(P.completedAt=Ue,P.completedBy=(i==null?void 0:i.id)||"system",P.approvals=De):ae==="closed"?P.closedAt=Ue:ae==="in_progress"&&(P.approvals=N(q).map(_=>({userId:_,status:"pending",updatedAt:Ue})),P.completedAt=void 0,P.completedBy=void 0,P.closedAt=void 0),T(q.id);try{await Mr(q.id,P),e(),g(null)}catch(_){console.error("Error updating task status:",_)}finally{T(null)}},ge=async q=>{if(!(!i||q.status!=="in_progress"||!Q(q))){T(q.id);try{const ae=new Date().toISOString(),De=W(q).map(P=>P.userId===i.id?{...P,status:"approved",updatedAt:ae}:P),ee=N(q),Me=ee.length>0&&ee.every(P=>De.find(_=>_.userId===P&&_.status==="approved")),Ue={approvals:De,updatedAt:ae};Me&&(Ue.status="completed",Ue.completedAt=ae,Ue.completedBy=i.id),await Mr(q.id,Ue),e()}catch(ae){console.error("Error confirming task:",ae)}finally{T(null)}}},Ee=async q=>{if(!(!B(q)||q.status!=="completed")){T(q.id);try{const ae=new Date().toISOString();await Mr(q.id,{status:"closed",closedAt:ae,updatedAt:ae}),e()}catch(ae){console.error("Error closing task:",ae)}finally{T(null)}}},Y=async(q,ae)=>{if(!B(q))return;const De=(ae||"").trim();if(De){T(q.id);try{const ee=new Date().toISOString(),Me=N(q).map(P=>({userId:P,status:"pending",updatedAt:ee})),Ue={id:`c-${Date.now()}`,userId:(i==null?void 0:i.id)||"system",text:De,createdAt:ee};await Mr(q.id,{status:"in_progress",approvals:Me,completedAt:void 0,completedBy:void 0,closedAt:void 0,comments:[...q.comments||[],Ue],updatedAt:ee}),e(),p(null),A("")}catch(ee){console.error("Error returning task to work:",ee)}finally{T(null)}}},fe=q=>({in_progress:a==="dark"?"bg-blue-500/20 border-blue-500/50":"bg-blue-50 border-blue-200",completed:a==="dark"?"bg-[#4E6E49]/20 border-[#4E6E49]/50":"bg-green-50 border-green-200",closed:a==="dark"?"bg-gray-500/20 border-gray-500/50":"bg-gray-50 border-gray-200"})[q],pe=q=>({in_progress:a==="dark"?"text-blue-400":"text-blue-700",completed:"text-[#4E6E49]",closed:a==="dark"?"text-gray-400":"text-gray-700"})[q],Ae=q=>{const ae=new Date;return new Date(`${q.dueDate}T${q.dueTime}`)<ae&&q.status!=="completed"&&q.status!=="closed"};return s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"overflow-x-auto pb-4 -mx-4 px-4",children:s.jsx("div",{className:"flex gap-3 sm:gap-4 min-w-max",children:k.map(q=>{const ae=Z(q),De=Ss[q];return s.jsxs("div",{"data-status":q,className:`flex-shrink-0 w-[280px] sm:w-80 ${y} rounded-xl border-2 ${w} p-3 sm:p-4 ${S===q?"border-[#4E6E49]":""}`,onDragOver:F,onDrop:ee=>ue(ee,q),onTouchMove:re,children:[s.jsx("div",{className:`mb-3 sm:mb-4 pb-2 sm:pb-3 border-b ${w}`,children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("h3",{className:`text-base sm:text-lg font-bold ${pe(q)}`,children:De.label}),s.jsx("span",{className:`px-2 py-1 rounded-lg text-xs sm:text-sm font-medium ${fe(q)} ${pe(q)}`,children:ae.length})]})}),s.jsxs("div",{className:"space-y-2 sm:space-y-3 max-h-[calc(100vh-280px)] sm:max-h-[calc(100vh-300px)] overflow-y-auto",children:[ae.map(ee=>{var rt,gt,_t;const Me=Ae(ee),Ue=o||(i==null?void 0:i.id)===ee.createdBy||ee.mainExecutor===(i==null?void 0:i.id),P=f(ee),be=j(ee).map(Ce=>{const at=Se.find(ye=>ye.id===Ce.userId);return at?{...Ce,member:at}:null}).filter(Boolean),{approvals:Ne,approved:Ie,total:ne}=ie(ee),we=Ne.find(Ce=>Ce.userId===(i==null?void 0:i.id)),ke=Q(ee)&&ee.status==="in_progress"&&(!we||we.status!=="approved"),$e=B(ee)&&ee.status==="completed";return s.jsxs("div",{draggable:!C&&R(ee),onDragStart:Ce=>oe(Ce,ee),onDragEnd:L,onTouchStart:Ce=>M(Ce,ee),onTouchEnd:Ce=>me(Ce,q),className:`${y} rounded-lg border-2 ${w} p-2.5 sm:p-3 cursor-move hover:shadow-lg transition-all ${(c==null?void 0:c.id)===ee.id||(z==null?void 0:z.task.id)===ee.id?"opacity-50":""} ${Me?"border-red-500":""} ${C===ee.id?"opacity-50 pointer-events-none":""}`,children:[s.jsxs("div",{className:"flex items-start justify-between gap-2 mb-2",children:[s.jsx("h4",{className:`font-semibold text-xs sm:text-sm ${E} flex-1`,children:ee.title}),s.jsx("div",{className:"flex items-center gap-1 flex-shrink-0",children:s.jsxs("div",{className:"relative lg:hidden",children:[s.jsx("button",{onClick:()=>g((h==null?void 0:h.id)===ee.id?null:ee),className:`p-1 rounded ${a==="dark"?"hover:bg-gray-700":"hover:bg-gray-100"}`,children:s.jsx(Hp,{className:"w-4 h-4"})}),(h==null?void 0:h.id)===ee.id&&s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"fixed inset-0 z-40",onClick:()=>g(null)}),s.jsx("div",{className:`absolute right-0 top-8 z-50 ${y} rounded-lg shadow-xl border-2 ${w} min-w-[200px]`,children:s.jsxs("div",{className:"p-2",children:[s.jsx("div",{className:`text-xs font-medium mb-2 px-2 py-1 ${a==="dark"?"text-gray-400":"text-gray-600"}`,children:"Изменить статус:"}),k.map(Ce=>s.jsx("button",{onClick:()=>O(ee,Ce),disabled:ee.status===Ce||C===ee.id||!R(ee),className:`w-full text-left px-3 py-2 rounded-lg text-sm transition-colors mb-1 ${ee.status===Ce?fe(Ce):a==="dark"?"hover:bg-gray-700":"hover:bg-gray-100"} ${ee.status===Ce?pe(Ce):E} disabled:opacity-50`,children:Ss[Ce].label},Ce)),Ue&&s.jsxs(s.Fragment,{children:[s.jsx("div",{className:`border-t ${w} my-2`}),s.jsx("button",{onClick:()=>{g(null),t(ee)},className:`w-full text-left px-3 py-2 rounded-lg text-sm transition-colors mb-1 ${a==="dark"?"hover:bg-gray-700":"hover:bg-gray-100"} ${E}`,children:"Редактировать"}),s.jsx("button",{onClick:()=>{g(null),G(ee)},className:`w-full text-left px-3 py-2 rounded-lg text-sm transition-colors mb-1 ${a==="dark"?"hover:bg-gray-700":"hover:bg-gray-100"} ${E}`,children:"Всё о задаче"}),s.jsx("button",{onClick:()=>{g(null),n(ee.id)},className:`w-full text-left px-3 py-2 rounded-lg text-sm transition-colors ${a==="dark"?"hover:bg-red-500/20 text-red-400":"hover:bg-red-50 text-red-600"}`,children:"Удалить"})]})]})})]})]})})]}),s.jsxs("div",{className:"space-y-1.5 text-xs mb-2",children:[s.jsxs("div",{className:"space-y-1",children:[s.jsxs("div",{className:`flex items-center gap-1 ${a==="dark"?"text-blue-400":"text-blue-600"}`,children:[s.jsx("span",{className:"font-medium",children:"Автор:"}),s.jsx("span",{className:a==="dark"?"text-gray-400":"text-gray-600",children:((rt=Se.find(Ce=>Ce.id===ee.createdBy))==null?void 0:rt.name)||"Неизвестно"})]}),s.jsxs("div",{className:"flex flex-col gap-1",children:[s.jsx("div",{className:"flex items-center gap-1 text-[#4E6E49]",children:s.jsx("span",{className:"font-medium",children:"Исполнители:"})}),be.length>0?be.map(Ce=>s.jsx("div",{className:`text-[11px] sm:text-xs ${a==="dark"?"text-gray-300":"text-gray-700"} flex flex-wrap gap-1`,children:s.jsx("span",{className:"font-medium",children:Ce.member.name})},Ce.member.id)):s.jsx("span",{className:"text-gray-500",children:"Не назначены"})]})]}),s.jsxs("div",{className:`flex items-center gap-2 flex-wrap ${a==="dark"?"text-gray-400":"text-gray-600"}`,children:[s.jsxs("span",{className:"inline-flex items-center gap-1",children:[s.jsx(Go,{className:"w-3.5 h-3.5"}),ce(new Date(ee.dueDate),"dd.MM.yyyy")]}),s.jsxs("span",{className:"inline-flex items-center gap-1",children:[s.jsx(Hn,{className:"w-3.5 h-3.5"}),ee.dueTime]}),s.jsx(d0,{dueDate:ee.dueDate,dueTime:ee.dueTime,theme:a,size:"compact"})]}),s.jsx("div",{className:"flex items-center gap-1 text-[11px]",children:s.jsx("span",{className:`px-2 py-0.5 rounded-full border ${a==="dark"?"border-yellow-500/40 text-yellow-200 bg-yellow-500/10":"border-yellow-200 text-yellow-700 bg-yellow-50"}`,children:ee.priority==="urgent"?"Экстренный приоритет":ee.priority==="high"?"Высокий приоритет":ee.priority==="medium"?"Средний приоритет":"Низкий приоритет"})}),ne>0&&s.jsxs("div",{className:`flex items-center justify-between gap-2 ${a==="dark"?"text-yellow-300":"text-yellow-700"}`,children:[s.jsxs("span",{className:"inline-flex items-center gap-1",children:[s.jsx(gh,{className:"w-3 h-3"}),"Подтверждения исполнителей"]}),s.jsxs("span",{className:"text-[11px] font-semibold",children:[Ie,"/",ne]})]}),ee.description&&s.jsx("p",{className:`line-clamp-2 ${a==="dark"?"text-gray-300":"text-gray-600"}`,children:ee.description}),Ne.length>0&&s.jsx("div",{className:`mt-1 space-y-1 ${a==="dark"?"text-gray-300":"text-gray-700"}`,children:Ne.map(Ce=>{const at=Se.find(_e=>_e.id===Ce.userId),ye=Ce.status==="approved"?"подтвердил":"в ожидании";return s.jsxs("div",{className:"flex items-center justify-between text-[11px]",children:[s.jsxs("span",{className:"flex items-center gap-1",children:[s.jsxs("span",{className:"font-medium",children:[(at==null?void 0:at.name)||Ce.userId,te(ee,Ce.userId)&&s.jsx("span",{className:"ml-1 text-[10px] px-1 rounded bg-gray-200 dark:bg-gray-800",children:te(ee,Ce.userId)})]}),s.jsxs("span",{className:"text-gray-500",children:["(",ye,")"]})]}),Ce.comment&&s.jsx("span",{className:"truncate max-w-[140px] text-gray-500",children:Ce.comment})]},Ce.userId)})}),(((gt=ee.comments)==null?void 0:gt.length)||((_t=P.comments)==null?void 0:_t.length))&&s.jsx("div",{className:"mt-2 space-y-1",children:[...ee.comments||[],...P.comments||[]].map(Ce=>{const at=Se.find(ye=>ye.id===Ce.userId);return s.jsxs("div",{className:`text-[11px] ${a==="dark"?"text-gray-300":"text-gray-700"}`,children:[s.jsx("span",{className:"font-semibold",children:(at==null?void 0:at.name)||Ce.userId})," ",s.jsx("span",{className:"text-gray-500",children:Ce.stageId?"(этап)":"(задача)"}),": ",Ce.text]},Ce.id)})}),s.jsx("div",{className:"flex items-center gap-2 flex-wrap",children:s.jsx("span",{className:`px-1.5 py-0.5 rounded text-xs inline-flex items-center gap-1 ${fe(q)} ${pe(q)}`,children:(()=>{const Ce=mo[ee.category];return s.jsx(Ce,{className:"w-3.5 h-3.5"})})()})})]}),s.jsx("div",{className:"flex justify-end mt-1",children:s.jsx("button",{onClick:()=>G(ee),className:`text-[11px] underline ${a==="dark"?"text-gray-300":"text-gray-600"} hover:text-[#4E6E49]`,children:"Всё о задаче"})}),s.jsxs("div",{className:`flex flex-col gap-2 mt-2 pt-2 border-t ${w}`,children:[ke&&s.jsxs("button",{onClick:()=>ge(ee),disabled:C===ee.id,className:"w-full px-2 py-1.5 bg-[#4E6E49] hover:bg-emerald-700 text-white rounded-lg text-xs font-medium transition-colors flex items-center justify-center gap-1 disabled:opacity-50",children:[s.jsx(Rs,{className:"w-3 h-3"}),"Подтвердить"]}),$e&&s.jsxs("div",{className:"flex gap-2",children:[s.jsxs("button",{onClick:()=>Ee(ee),disabled:C===ee.id,className:"flex-1 px-2 py-1.5 bg-blue-600 hover:bg-blue-700 text-white rounded-lg text-xs font-medium transition-colors flex items-center justify-center gap-1 disabled:opacity-50",children:[s.jsx(Rs,{className:"w-3 h-3"}),"Закрыто"]}),s.jsxs("button",{onClick:()=>{p({task:ee}),A("")},disabled:C===ee.id,className:"flex-1 px-2 py-1.5 bg-red-500 hover:bg-red-600 text-white rounded-lg text-xs font-medium transition-colors flex items-center justify-center gap-1 disabled:opacity-50",children:[s.jsx(Jt,{className:"w-3 h-3"}),"Не выполнено"]})]}),ee.status==="completed"&&!$e&&s.jsx("p",{className:`text-[11px] ${a==="dark"?"text-gray-400":"text-gray-500"}`,children:"Ожидает подтверждения автора"})]})]},ee.id)}),ae.length===0&&s.jsxs("div",{className:`text-center py-6 sm:py-8 ${a==="dark"?"text-gray-500":"text-gray-400"}`,children:[s.jsx(Lr,{className:"w-6 h-6 sm:w-8 sm:h-8 mx-auto mb-2 opacity-50"}),s.jsx("p",{className:"text-xs sm:text-sm",children:"Нет задач"})]})]})]},q)})})}),x&&s.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-start sm:items-center justify-center z-[70] p-4 overflow-y-auto overscroll-contain modal-scroll",children:s.jsxs("div",{className:`${y} rounded-xl p-6 max-w-md w-full border-2 ${w}`,children:[s.jsx("h3",{className:`text-lg font-bold mb-4 ${E}`,children:"Не выполнено"}),s.jsx("textarea",{value:v,onChange:q=>A(q.target.value),placeholder:"Опишите, что нужно доработать",rows:3,className:`w-full px-4 py-2 rounded-lg border ${w} ${a==="dark"?"bg-gray-700":"bg-gray-50"} ${E} mb-4 focus:outline-none focus:ring-2 focus:ring-[#4E6E49]/50`}),s.jsxs("div",{className:"flex gap-3",children:[s.jsx("button",{onClick:()=>x.task&&Y(x.task,v),disabled:C===x.task.id||!v.trim(),className:"flex-1 px-4 py-2 rounded-lg font-medium transition-colors bg-red-500 hover:bg-red-600 text-white disabled:opacity-50",children:"Отправить на доработку"}),s.jsx("button",{onClick:()=>{p(null),A("")},className:`px-4 py-2 rounded-lg font-medium transition-colors ${a==="dark"?"bg-gray-700 hover:bg-gray-600":"bg-gray-200 hover:bg-gray-300"}`,children:"Отмена"})]})]})}),H&&s.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-start sm:items-center justify-center z-[70] p-4 overflow-y-auto overscroll-contain modal-scroll",children:s.jsxs("div",{className:`${y} rounded-xl p-6 max-w-2xl w-full border-2 ${w}`,children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsx("h3",{className:`text-lg font-bold ${E}`,children:"Всё о задаче"}),s.jsx("button",{onClick:()=>G(null),className:`p-2 rounded-lg ${a==="dark"?"hover:bg-gray-700":"hover:bg-gray-100"}`,children:s.jsx(Jt,{className:"w-4 h-4"})})]}),s.jsxs("div",{className:"space-y-4 text-sm",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-xs text-gray-500",children:"Название"}),s.jsx("p",{className:`font-semibold ${E}`,children:H.title})]}),H.description&&s.jsxs("div",{children:[s.jsx("p",{className:"text-xs text-gray-500",children:"Описание"}),s.jsx("p",{className:a==="dark"?"text-gray-300":"text-gray-700",children:H.description})]}),H.expectedResult&&s.jsxs("div",{children:[s.jsx("p",{className:"text-xs text-gray-500",children:"Ожидаемый результат"}),s.jsx("p",{className:a==="dark"?"text-gray-300":"text-gray-700",children:H.expectedResult})]}),s.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-xs text-gray-500",children:"Автор"}),s.jsx("p",{className:E,children:((qe=Se.find(q=>q.id===H.createdBy))==null?void 0:qe.name)||H.createdBy})]}),s.jsxs("div",{children:[s.jsx("p",{className:"text-xs text-gray-500",children:"Категория"}),s.jsx("p",{className:E,children:((Je=ea[H.category])==null?void 0:Je.label)||H.category})]}),s.jsxs("div",{children:[s.jsx("p",{className:"text-xs text-gray-500",children:"Приоритет"}),s.jsx("p",{className:E,children:H.priority==="urgent"?"Экстренный":H.priority==="high"?"Высокий":H.priority==="medium"?"Средний":"Низкий"})]}),s.jsxs("div",{children:[s.jsx("p",{className:"text-xs text-gray-500",children:"Дедлайн"}),s.jsxs("p",{className:E,children:[ce(new Date(H.dueDate),"dd.MM.yyyy")," · ",H.dueTime]})]})]}),s.jsxs("div",{children:[s.jsx("p",{className:"text-xs text-gray-500",children:"Статус"}),s.jsx("p",{className:`${E} font-semibold`,children:Ss[H.status].label})]}),H.stages&&H.stages.length>0&&s.jsxs("div",{className:"space-y-2",children:[s.jsx("p",{className:"text-xs text-gray-500",children:"Этапы"}),H.stages.map(q=>{var ae,De;return s.jsxs("div",{className:`p-3 rounded border ${w} space-y-2`,children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("p",{className:`font-semibold ${E}`,children:q.name}),s.jsxs("p",{className:"text-xs text-gray-500",children:[((ae=q.approvals)==null?void 0:ae.filter(ee=>ee.status==="approved").length)||0,"/",((De=q.approvals)==null?void 0:De.length)||0," подтверждений"]})]}),q.assignees&&q.assignees.length>0&&s.jsx("div",{className:"space-y-1 text-xs",children:q.assignees.map(ee=>{const Me=Se.find(Ue=>Ue.id===ee.userId);return s.jsx("div",{className:"flex items-start justify-between gap-2",children:s.jsx("span",{className:"font-medium",children:(Me==null?void 0:Me.name)||ee.userId})},ee.userId)})})]},q.id)})]})]})]})})]})},dN=()=>{var Q;const{theme:r}=it(),{user:e}=kt(),[t,n]=D.useState(!1),[a,i]=D.useState(null),[o,c]=D.useState([]),[d,h]=D.useState(!0),[g,x]=D.useState("all"),[p,v]=D.useState("all"),[A,C]=D.useState([]),[T,z]=D.useState("kanban"),$=r==="dark"?"text-white":"text-gray-900",S=r==="dark"?"bg-[#1a1a1a]":"bg-white";D.useEffect(()=>{I()},[e]),D.useEffect(()=>{I()},[g,p,A]);const I=async()=>{h(!0);try{const B={};g!=="all"&&(B.category=g),p!=="all"&&(B.status=p),A.length>0&&(B.assignedTo=A);const ue=await Yg(B);c(ue)}catch(B){console.error("Error loading tasks:",B)}finally{h(!1)}},H=B=>{i(B),n(!0)},G=async B=>{if(confirm("Вы уверены, что хотите удалить эту задачу?"))try{await Qg(B),I()}catch(ue){console.error("Error deleting task:",ue)}},E=()=>{n(!1),i(null)},y=()=>{n(!1),i(null),I()},w=()=>{x("all"),v("all"),C([])},k=o.filter(B=>!(g!=="all"&&B.category!==g||p!=="all"&&B.status!==p||A.length>0&&!A.some(ue=>B.assignedTo.includes(ue)))),j={inProgress:o.filter(B=>B.status==="in_progress").length,completed:o.filter(B=>B.status==="completed").length,closed:o.filter(B=>B.status==="closed").length},N=new Date,f=ce(N,"yyyy-MM-dd"),de=new Date(N);de.setDate(N.getDate()-7);const V=new Date(N);V.setDate(N.getDate()-30);const X=o.filter(B=>new Date(B.createdAt)>=de).length,R=o.filter(B=>new Date(B.createdAt)>=V).length,te=o.filter(B=>B.completedAt&&B.completedAt.startsWith(f)).length,Z=e?o.filter(B=>B.mainExecutor===e.id||B.leadExecutor===e.id||(B.assignedTo||[]).includes(e.id)||(B.coExecutors||[]).includes(e.id)):[],oe=Z.length,F=o.length,L=F?Math.round(j.inProgress/F*100):0,M=(()=>{var O;const B={};return o.forEach(ge=>{[ge.mainExecutor,ge.leadExecutor,...ge.assignedTo||[],...ge.coExecutors||[]].filter(Boolean).forEach(Y=>{B[Y]=(B[Y]||0)+1})}),((O=Object.entries(B).sort((ge,Ee)=>Ee[1]-ge[1])[0])==null?void 0:O[0])||""})(),re=M?((Q=Se.find(B=>B.id===M))==null?void 0:Q.name)||M:"—",me=o.filter(B=>B.status!=="completed"&&B.status!=="closed").sort((B,ue)=>new Date(`${B.dueDate}T${B.dueTime}`).getTime()-new Date(`${ue.dueDate}T${ue.dueTime}`).getTime())[0],W=[{label:"Всего задач на неделе",value:X,sub:"последние 7 дней",tone:"sky"},{label:"Всего задач на месяце",value:R,sub:"последние 30 дней",tone:"emerald"},{label:"Задач в работе",value:j.inProgress,sub:`${L}% от всех`,tone:"blue"},{label:"Отмечено исполнителями",value:j.completed,sub:"ожидают проверки автора",tone:"amber"},{label:"Самый активный исполнитель",value:re,sub:"по числу назначений",tone:"purple"},{label:"Закрыто автором",value:j.closed,sub:"финально подтверждено",tone:"slate"},{label:"Ближайший дедлайн",value:me?me.title:"Нет активных",sub:me?`${ce(new Date(me.dueDate),"dd.MM.yyyy")} · ${me.dueTime}`:"Свободное окно",tone:"pink"},{label:"Сделано задач за сегодня",value:te,sub:f,tone:"green"}],ie=[{href:"#tasks-board",label:"Все задачи"},{href:"#my-tasks",label:"Мои задачи",action:()=>e&&C([e.id])},{href:"#tasks-stats",label:"Статистика"}];return s.jsx(cr,{children:s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:`rounded-xl sm:rounded-2xl p-4 sm:p-6 md:p-8 ${S} shadow-xl border-2 ${r==="dark"?"border-[#4E6E49]/30 bg-gradient-to-br from-[#1a1a1a] via-[#1a1a1a] to-[#0A0A0A]":"border-green-200 bg-gradient-to-br from-white via-green-50/30 to-white"} relative overflow-hidden`,children:[s.jsx("div",{className:"absolute top-0 right-0 w-32 h-32 sm:w-64 sm:h-64 bg-gradient-to-br from-[#4E6E49]/10 to-emerald-700/10 rounded-full blur-3xl -mr-16 sm:-mr-32 -mt-16 sm:-mt-32"}),s.jsx("div",{className:"absolute bottom-0 left-0 w-24 h-24 sm:w-48 sm:h-48 bg-gradient-to-tr from-yellow-500/10 to-orange-500/10 rounded-full blur-2xl -ml-12 sm:-ml-24 -mb-12 sm:-mb-24"}),s.jsxs("div",{className:"relative z-10",children:[s.jsx("div",{className:"flex flex-col gap-4 sm:gap-6 lg:flex-row lg:items-start lg:justify-between mb-4 sm:mb-6",children:s.jsxs("div",{className:"flex-1",children:[s.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 mb-2",children:[s.jsx(Lr,{className:"w-6 h-6 sm:w-8 sm:h-8 text-[#4E6E49]"}),s.jsxs("h1",{className:`text-2xl sm:text-3xl md:text-4xl font-extrabold ${$} flex items-center gap-2`,children:["Task Team",s.jsx(Yt,{className:`w-5 h-5 sm:w-6 sm:h-6 ${r==="dark"?"text-yellow-400":"text-yellow-600"}`})]})]}),s.jsx("p",{className:`text-sm sm:text-base ${r==="dark"?"text-gray-300":"text-gray-600"}`,children:"Управление задачами и заданиями команды"}),s.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:ie.map(B=>s.jsx("a",{href:B.href,onClick:()=>{var ue;return(ue=B.action)==null?void 0:ue.call(B)},className:`px-3 py-1.5 rounded-lg text-xs font-semibold border transition ${r==="dark"?"border-white/10 bg-white/5 text-white hover:border-[#4E6E49]/50":"border-gray-200 bg-white text-gray-800 hover:border-[#4E6E49]/50 hover:text-[#4E6E49]"}`,children:B.label},B.href))})]})}),s.jsx("div",{id:"tasks-stats",className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3 sm:gap-4",children:W.map(B=>{const O={emerald:{bg:r==="dark"?"bg-emerald-500/10":"bg-emerald-50",text:r==="dark"?"text-emerald-100":"text-emerald-800",border:r==="dark"?"border-emerald-500/30":"border-emerald-200"},sky:{bg:r==="dark"?"bg-sky-500/10":"bg-sky-50",text:r==="dark"?"text-sky-100":"text-sky-800",border:r==="dark"?"border-sky-500/30":"border-sky-200"},amber:{bg:r==="dark"?"bg-amber-500/10":"bg-amber-50",text:r==="dark"?"text-amber-100":"text-amber-800",border:r==="dark"?"border-amber-500/30":"border-amber-200"},blue:{bg:r==="dark"?"bg-blue-500/10":"bg-blue-50",text:r==="dark"?"text-blue-100":"text-blue-800",border:r==="dark"?"border-blue-500/30":"border-blue-200"},purple:{bg:r==="dark"?"bg-purple-500/10":"bg-purple-50",text:r==="dark"?"text-purple-100":"text-purple-800",border:r==="dark"?"border-purple-500/30":"border-purple-200"},slate:{bg:r==="dark"?"bg-gray-500/10":"bg-gray-50",text:r==="dark"?"text-gray-100":"text-gray-800",border:r==="dark"?"border-gray-500/30":"border-gray-200"},pink:{bg:r==="dark"?"bg-pink-500/10":"bg-pink-50",text:r==="dark"?"text-pink-100":"text-pink-800",border:r==="dark"?"border-pink-500/30":"border-pink-200"},green:{bg:r==="dark"?"bg-green-500/10":"bg-green-50",text:r==="dark"?"text-green-100":"text-green-800",border:r==="dark"?"border-green-500/30":"border-green-200"}}[B.tone];return s.jsxs("div",{className:`p-4 rounded-xl border ${O.border} ${O.bg} shadow-sm space-y-1`,children:[s.jsx("p",{className:`text-xs font-semibold uppercase ${O.text}`,children:B.label}),s.jsx("p",{className:`text-2xl font-extrabold ${$} truncate`,children:B.value}),s.jsx("p",{className:`text-xs ${r==="dark"?"text-gray-400":"text-gray-600"}`,children:B.sub})]},B.label)})})]})]}),e&&s.jsxs("div",{id:"my-tasks",className:`rounded-xl sm:rounded-2xl p-4 sm:p-6 ${S} border-2 ${r==="dark"?"border-white/10":"border-gray-200"}`,children:[s.jsxs("div",{className:"flex items-center justify-between gap-3 mb-3",children:[s.jsxs("div",{children:[s.jsx("p",{className:`text-xs uppercase font-semibold ${r==="dark"?"text-gray-400":"text-gray-500"}`,children:"Мои задачи"}),s.jsx("p",{className:`text-xl font-bold ${$}`,children:oe})]}),s.jsx("a",{href:"#tasks-board",className:`px-3 py-2 rounded-lg text-xs font-semibold border ${r==="dark"?"border-white/10 bg-white/5 text-white hover:border-[#4E6E49]/50":"border-gray-200 bg-white text-gray-800 hover:border-[#4E6E49]/50 hover:text-[#4E6E49]"}`,children:"Перейти на доску"})]}),Z.length===0?s.jsx("p",{className:r==="dark"?"text-gray-400":"text-gray-600",children:"Нет назначенных задач"}):s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:Z.slice(0,4).map(B=>s.jsxs("div",{className:`p-3 rounded-lg border ${r==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white"}`,children:[s.jsx("p",{className:`text-sm font-semibold ${$} truncate`,children:B.title}),s.jsxs("p",{className:`text-xs ${r==="dark"?"text-gray-400":"text-gray-600"}`,children:[ce(new Date(B.dueDate),"dd.MM.yyyy")," · ",B.dueTime]}),s.jsx("p",{className:"text-xs mt-1",children:s.jsx("span",{className:`px-2 py-0.5 rounded-full ${r==="dark"?"bg-gray-800 text-gray-200":"bg-gray-100 text-gray-700"}`,children:Ss[B.status].label})})]},B.id))})]}),s.jsxs("div",{className:"flex flex-col lg:flex-row gap-4 sm:gap-6",id:"tasks-board",children:[s.jsx("div",{className:"lg:w-80 flex-shrink-0",children:s.jsx(lN,{selectedCategory:g,selectedStatus:p,selectedUsers:A,onCategoryChange:x,onStatusChange:v,onUsersChange:C,onClear:w})}),s.jsxs("div",{className:"flex-1",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4 gap-3",children:[s.jsxs("h2",{className:`text-xl font-bold ${$}`,children:["Задачи (",k.length,")"]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsxs("div",{className:`flex rounded-lg border-2 ${r==="dark"?"border-gray-800":"border-gray-300"} overflow-hidden`,children:[s.jsx("button",{onClick:()=>z("kanban"),className:`px-3 py-2 transition-colors ${T==="kanban"?"bg-[#4E6E49] text-white":r==="dark"?"bg-[#1a1a1a] text-gray-300 hover:bg-gray-700":"bg-white text-gray-700 hover:bg-gray-50"}`,title:"Kanban доска",children:s.jsx(Up,{className:"w-4 h-4"})}),s.jsx("button",{onClick:()=>z("list"),className:`px-3 py-2 transition-colors ${T==="list"?"bg-[#4E6E49] text-white":r==="dark"?"bg-[#1a1a1a] text-gray-300 hover:bg-gray-700":"bg-white text-gray-700 hover:bg-gray-50"}`,title:"Список",children:s.jsx(Bp,{className:"w-4 h-4"})})]}),s.jsxs("button",{onClick:()=>n(!0),className:"px-4 py-2 bg-gradient-to-r from-[#4E6E49] to-emerald-700 hover:from-[#4E6E49] hover:to-emerald-700 text-white rounded-lg font-semibold transition-all shadow-lg hover:shadow-xl transform hover:scale-105 flex items-center gap-2",children:[s.jsx(ra,{className:"w-5 h-5"}),s.jsx("span",{className:"hidden sm:inline",children:"Новая задача"}),s.jsx("span",{className:"sm:hidden",children:"Добавить"})]})]})]}),d?s.jsx("div",{className:`${S} rounded-xl p-8 text-center ${$}`,children:s.jsx("div",{className:"animate-pulse",children:"Загрузка..."})}):k.length===0?s.jsxs("div",{className:`${S} rounded-xl p-8 text-center border-2 ${r==="dark"?"border-gray-800":"border-gray-300"}`,children:[s.jsx(Lr,{className:`w-12 h-12 mx-auto mb-4 ${r==="dark"?"text-gray-600":"text-gray-400"}`}),s.jsx("p",{className:`text-lg font-medium ${$} mb-2`,children:"Нет задач"}),s.jsx("p",{className:`text-sm ${r==="dark"?"text-gray-400":"text-gray-600"}`,children:g!=="all"||p!=="all"||A.length>0?"Попробуйте изменить фильтры":"Создайте первую задачу"})]}):T==="kanban"?s.jsx(cN,{tasks:k,onUpdate:I,onEdit:H,onDelete:G}):s.jsx("div",{className:"grid grid-cols-1 gap-4 sm:gap-6",children:k.map(B=>s.jsx(oN,{task:B,onEdit:H,onDelete:G,onUpdate:I},B.id))})]})]}),t&&s.jsx(rN,{onClose:E,onSave:y,editingTask:a})]})})},uN=()=>{const{theme:r}=it(),{isAdmin:e}=Tt(),t=r==="dark"?"text-white":"text-gray-900",n=r==="dark"?"text-gray-300":"text-gray-700",a=r==="dark"?"bg-[#1a1a1a]":"bg-white";return e?s.jsx(cr,{children:s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:`rounded-2xl p-6 ${a} shadow-lg border-2 ${r==="dark"?"border-purple-500/30 bg-gradient-to-br from-[#1a1a1a] to-[#1a1a1a]/90":"border-purple-200 bg-gradient-to-br from-white to-purple-50/30"}`,children:[s.jsxs("div",{className:"flex items-start gap-4 mb-6",children:[s.jsx("div",{className:`p-3 rounded-xl ${r==="dark"?"bg-purple-500/20":"bg-purple-100"}`,children:s.jsx(zt,{className:`w-8 h-8 ${r==="dark"?"text-purple-400":"text-purple-600"}`})}),s.jsxs("div",{className:"flex-1",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[s.jsx("h1",{className:`text-3xl font-bold bg-gradient-to-r ${r==="dark"?"from-purple-400 to-pink-400 text-transparent bg-clip-text":"from-purple-600 to-pink-600 text-transparent bg-clip-text"}`,children:"Панель администратора"}),s.jsx(Yt,{className:`w-5 h-5 ${r==="dark"?"text-yellow-400":"text-yellow-500"} animate-pulse`})]}),s.jsxs("p",{className:`${n} text-sm flex items-center gap-2`,children:[s.jsx(pi,{className:"w-4 h-4"}),"Управление системой и командой ApeVault"]})]})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-6",children:[s.jsxs("div",{className:`p-4 rounded-xl border-2 ${r==="dark"?"bg-blue-500/10 border-blue-500/30":"bg-blue-50 border-blue-200"}`,children:[s.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[s.jsx("div",{className:`p-2 rounded-lg ${r==="dark"?"bg-blue-500/20":"bg-blue-100"}`,children:s.jsx(zt,{className:`w-5 h-5 ${r==="dark"?"text-blue-400":"text-blue-600"}`})}),s.jsx("h3",{className:`font-semibold ${t}`,children:"Доступ к функциям"})]}),s.jsx("p",{className:`text-sm ${n}`,children:"В режиме администратора вы можете управлять слотами, статусами и заработком всех участников команды"})]}),s.jsxs("div",{className:"p-4 rounded-xl border-2 bg-[#4E6E49]/10 border-[#4E6E49]/30",children:[s.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[s.jsx("div",{className:`p-2 rounded-lg ${r==="dark"?"bg-[#4E6E49]/20":"bg-green-100"}`,children:s.jsx(Lp,{className:"w-5 h-5 text-[#4E6E49]"})}),s.jsx("h3",{className:`font-semibold ${t}`,children:"Безопасность"})]}),s.jsx("p",{className:`text-sm ${n}`,children:"Режим администратора требует ввода пароля. Не делитесь паролем с другими участниками"})]})]}),s.jsx("div",{className:`pt-4 border-t ${r==="dark"?"border-gray-800":"border-gray-200"}`,children:s.jsxs("div",{className:`flex items-center gap-3 p-4 rounded-xl ${r==="dark"?"bg-[#4E6E49]/20 border-2 border-[#4E6E49]/50":"bg-green-50 border-2 border-green-200"}`,children:[s.jsx("div",{className:`p-2 rounded-lg ${r==="dark"?"bg-[#4E6E49]/30":"bg-green-100"}`,children:s.jsx(zt,{className:"w-6 h-6 text-[#4E6E49]"})}),s.jsxs("div",{children:[s.jsx("h3",{className:`font-semibold mb-1 ${t}`,children:"Режим администратора активен"}),s.jsx("p",{className:`text-sm ${n}`,children:"Вы вошли в систему как администратор. Все административные функции доступны."})]})]})})]}),s.jsxs("div",{className:`rounded-2xl p-6 ${a} shadow-lg border-2 ${r==="dark"?"border-gray-800":"border-gray-200"}`,children:[s.jsx("h2",{className:`text-xl font-semibold mb-4 ${t}`,children:"Возможности администратора"}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsxs("div",{className:`p-4 rounded-xl border ${r==="dark"?"border-gray-800 bg-gray-700/30":"border-gray-200 bg-gray-50"}`,children:[s.jsx("h3",{className:`font-semibold mb-2 ${t}`,children:"📅 Управление слотами"}),s.jsxs("ul",{className:`text-sm space-y-1 ${n} list-disc list-inside`,children:[s.jsx("li",{children:"Создание слотов для любого участника"}),s.jsx("li",{children:"Массовое создание слотов"}),s.jsx("li",{children:"Удаление слотов любого участника"}),s.jsx("li",{children:"Массовое удаление слотов"})]})]}),s.jsxs("div",{className:`p-4 rounded-xl border ${r==="dark"?"border-gray-800 bg-gray-700/30":"border-gray-200 bg-gray-50"}`,children:[s.jsx("h3",{className:`font-semibold mb-2 ${t}`,children:"📋 Управление статусами"}),s.jsxs("ul",{className:`text-sm space-y-1 ${n} list-disc list-inside`,children:[s.jsx("li",{children:"Установка выходных, больничных и отпуск"}),s.jsx("li",{children:"Массовое управление статусами"}),s.jsx("li",{children:"Удаление статусов любого участника"})]})]}),s.jsxs("div",{className:`p-4 rounded-xl border ${r==="dark"?"border-gray-800 bg-gray-700/30":"border-gray-200 bg-gray-50"}`,children:[s.jsx("h3",{className:`font-semibold mb-2 ${t}`,children:"💰 Управление заработком"}),s.jsxs("ul",{className:`text-sm space-y-1 ${n} list-disc list-inside`,children:[s.jsx("li",{children:"Добавление заработка за любую дату"}),s.jsx("li",{children:"Редактирование записей о заработке"}),s.jsx("li",{children:"Удаление записей о заработке"})]})]}),s.jsxs("div",{className:`p-4 rounded-xl border ${r==="dark"?"border-gray-800 bg-gray-700/30":"border-gray-200 bg-gray-50"}`,children:[s.jsx("h3",{className:`font-semibold mb-2 ${t}`,children:"📊 Дополнительно"}),s.jsxs("ul",{className:`text-sm space-y-1 ${n} list-disc list-inside`,children:[s.jsx("li",{children:"Удаление сообщений из подсчета"}),s.jsx("li",{children:"Полный доступ ко всем функциям"}),s.jsx("li",{children:"Просмотр и управление данными команды"})]})]})]})]})]})}):s.jsx(cr,{children:s.jsx("div",{className:`rounded-2xl p-8 ${a} shadow-xl border-2 ${r==="dark"?"border-red-500/30 bg-gradient-to-br from-[#1a1a1a] to-[#0A0A0A]":"border-red-200 bg-gradient-to-br from-white to-red-50/20"} relative overflow-hidden`,children:s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:`inline-flex p-4 rounded-2xl mb-4 ${r==="dark"?"bg-red-500/20":"bg-red-100"}`,children:s.jsx(pi,{className:`w-12 h-12 ${r==="dark"?"text-red-400":"text-red-600"}`})}),s.jsx("h2",{className:`text-2xl font-bold mb-2 ${t}`,children:"Доступ запрещен"}),s.jsx("p",{className:n,children:'Эта страница доступна только администраторам. Для входа используйте режим "Админ" на странице входа.'})]})})})},hN=()=>{var me;const{theme:r}=it(),{user:e,logout:t}=kt(),{isAdmin:n,deactivateAdmin:a}=Tt(),i=nh(),[o,c]=D.useState(!1),[d,h]=D.useState(!1),[g,x]=D.useState([]),[p,v]=D.useState(null),[A,C]=D.useState(null),[T,z]=D.useState(null),[$,S]=D.useState([]),[I,H]=D.useState({id:"",userId:"",title:"",text:"",priority:"medium",createdAt:"",updatedAt:""}),[G,E]=D.useState(!0),[y,w]=D.useState(!1),k=e||(n?{name:"Администратор",login:"admin",password:hh}:null),j=e!=null&&e.id?(me=Se.find(W=>W.id===e.id))==null?void 0:me.avatar:void 0,N=k!=null&&k.name?k.name.charAt(0).toUpperCase():"A",f=r==="dark"?"text-white":"text-gray-900";D.useEffect(()=>{(e||n)&&de()},[e,n]);const de=async()=>{if(!(!e&&!n)){E(!0);try{const W=(e==null?void 0:e.id)||"admin",ie=await Yg({assignedTo:W});if(x(ie),e){const Q=Ca(),B=ce(Q.start,"yyyy-MM-dd"),ue=ce(Q.end,"yyyy-MM-dd"),O=a0(30),ge=ce(O.start,"yyyy-MM-dd"),Ee=ce(O.end,"yyyy-MM-dd"),Y=O.start.toISOString(),fe=O.end.toISOString(),pe=await ma(W,B,ue),Ae=pe.reduce((ye,_e)=>{const Qe=_e.participants&&_e.participants.length>0?_e.participants.length:1;return ye+_e.amount/Qe},0),qe=pe.reduce((ye,_e)=>{const Qe=_e.participants&&_e.participants.length>0?_e.participants.length:1;return ye+_e.poolAmount/Qe},0),Je=await ma(W,ge,Ee),q=Je.reduce((ye,_e)=>{const Qe=_e.participants&&_e.participants.length>0?_e.participants.length:1;return ye+_e.amount/Qe},0),ae=Je.reduce((ye,_e)=>{const Qe=_e.participants&&_e.participants.length>0?_e.participants.length:1;return ye+_e.poolAmount/Qe},0),ee=(await yr(W)).filter(ye=>{const _e=ye.date,Qe=ye.endDate||ye.date;return _e<=Ee&&Qe>=ge}),Me=ee.filter(ye=>ye.type==="dayoff").reduce((ye,_e)=>ye+an(_e.date,_e.endDate,ge,Ee),0),Ue=ee.filter(ye=>ye.type==="sick").reduce((ye,_e)=>ye+an(_e.date,_e.endDate,ge,Ee),0),P=ee.filter(ye=>ye.type==="vacation").reduce((ye,_e)=>ye+an(_e.date,_e.endDate,ge,Ee),0),Ne=(await Kr(W)).filter(ye=>ye.date>=B&&ye.date<=ue).reduce((ye,_e)=>ye+ho(_e.slots),0),Ie=await qg(W,B,ue),we=(await Wg(W))[0]||{userId:W,earnings:0,messages:0,initiatives:0,signals:0,profitableSignals:0,referrals:0,daysOff:0,sickDays:0,vacationDays:0,poolAmount:0,rating:0,lastUpdated:new Date().toISOString()},$e=(await Hg(void 0,Y,fe)).filter(ye=>ye.ownerId===W).length,rt={userId:W,earnings:q,messages:we.messages||0,initiatives:we.initiatives||0,signals:we.signals||0,profitableSignals:we.profitableSignals||0,referrals:$e,daysOff:Me,sickDays:Ue,vacationDays:P,poolAmount:ae,lastUpdated:new Date().toISOString()},gt=l0(rt,Ne,Ae,Ie),_t=c0(rt,Ne,Ae,Ie);v({...rt,rating:gt}),C(_t),z({total:q,pool:ae,net:Math.max(0,q-ae),weekly:{gross:Ae,pool:qe,net:Math.max(0,Ae-qe)}});const Ce=e!=null&&e.id?`notes-cache-${e.id}`:null,at=ye=>{if(Ce)try{localStorage.setItem(Ce,JSON.stringify(ye))}catch(_e){console.error("Error caching notes locally",_e)}};try{if(e){const ye=await Fu(e.id,n);S(ye),at(ye)}else if(n){const ye=await Fu(void 0,!0);S(ye),at(ye)}}catch(ye){if(console.error("Error loading notes",ye),Ce)try{const _e=localStorage.getItem(Ce);if(_e){const Qe=JSON.parse(_e);S(Qe)}}catch(_e){console.error("Error loading cached notes",_e)}}}}catch(W){console.error("Error loading profile data:",W)}finally{E(!1)}}},V=async()=>{if(!(e!=null&&e.id)||!I.title.trim()&&!I.text.trim())return;const W=e!=null&&e.id?`notes-cache-${e.id}`:null,ie=Q=>{if(W)try{localStorage.setItem(W,JSON.stringify(Q))}catch(B){console.error("Error caching notes locally",B)}};try{if(I.id){await S2(I.id,{title:I.title,text:I.text,priority:I.priority});const Q=$.map(B=>B.id===I.id?{...B,title:I.title,text:I.text,priority:I.priority,updatedAt:new Date().toISOString()}:B);S(Q),ie(Q)}else{const Q=await T2({userId:e.id,title:I.title,text:I.text,priority:I.priority}),B=new Date().toISOString(),ue=[{id:Q,userId:e.id,title:I.title,text:I.text,priority:I.priority,createdAt:B,updatedAt:B},...$];S(ue),ie(ue)}}catch(Q){console.error("Error saving note",Q)}finally{H({id:"",userId:"",title:"",text:"",priority:"medium",createdAt:"",updatedAt:""})}},X=W=>{const ie=$.find(Q=>Q.id===W);ie&&H(ie)},R=async W=>{const ie=e!=null&&e.id?`notes-cache-${e.id}`:null,Q=B=>{if(ie)try{localStorage.setItem(ie,JSON.stringify(B))}catch(ue){console.error("Error caching notes locally",ue)}};try{await A2(W);const B=$.filter(ue=>ue.id!==W);S(B),Q(B),I.id===W&&H({id:"",userId:"",title:"",text:"",priority:"medium",createdAt:"",updatedAt:""})}catch(B){console.error("Error deleting note",B)}},te=()=>{n&&a(),t(),i("/login")},Z=()=>{e!=null&&e.password&&(navigator.clipboard.writeText(e.password),h(!0),setTimeout(()=>h(!1),2e3))},oe=()=>{k!=null&&k.login&&(navigator.clipboard.writeText(k.login),w(!0),setTimeout(()=>w(!1),2e3))},F=g.filter(W=>W.status==="in_progress").length,L=g.filter(W=>W.status==="completed").length,M=g.filter(W=>W.status==="closed").length,re={in_progress:{label:"В работе",classes:r==="dark"?"bg-blue-500/15 text-blue-100 border-blue-500/30":"bg-blue-50 text-blue-900 border-blue-200"},completed:{label:"Выполнена",classes:r==="dark"?"bg-emerald-500/15 text-emerald-50 border-emerald-500/30":"bg-emerald-50 text-emerald-900 border-emerald-200"},closed:{label:"Закрыта",classes:r==="dark"?"bg-gray-600/20 text-gray-100 border-gray-500/40":"bg-gray-50 text-gray-800 border-gray-200"}};return k?s.jsx(cr,{children:s.jsxs("div",{className:"space-y-6",children:[s.jsx("div",{className:`rounded-2xl p-6 border ${r==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white"} shadow-lg`,children:s.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"relative w-12 h-12 rounded-xl overflow-hidden shadow-lg border border-white/50 dark:border-white/10 bg-gradient-to-br from-[#4E6E49]/15 to-emerald-200/40 flex items-center justify-center",children:j?s.jsx("img",{src:j,alt:k.name,className:"w-full h-full object-cover",onError:W=>{const ie=W.target;ie.style.display="none"}}):s.jsx("span",{className:"text-lg font-extrabold text-[#4E6E49]",children:N})}),s.jsxs("div",{children:[s.jsx("p",{className:`text-xs uppercase tracking-[0.14em] ${r==="dark"?"text-gray-400":"text-gray-500"}`,children:"ApeVault Black Ops"}),s.jsx("h1",{className:`text-2xl sm:text-3xl font-extrabold ${f}`,children:"Личный кабинет"}),s.jsx("p",{className:`text-sm ${r==="dark"?"text-gray-300":"text-gray-600"}`,children:"Закрытый контур. Ваши данные и показатели."})]})]}),s.jsxs("div",{className:"flex flex-wrap gap-2",children:[s.jsxs("div",{className:"pill","data-active":"true",children:[s.jsx(cn,{className:"w-4 h-4"}),s.jsx("span",{children:k.name})]}),n&&s.jsxs("div",{className:"pill","data-active":"true",children:[s.jsx(zt,{className:"w-4 h-4"}),s.jsx("span",{children:"Администратор"})]}),s.jsxs("div",{className:"pill","data-active":"false",children:[s.jsx(Lr,{className:"w-4 h-4"}),s.jsxs("span",{children:[g.length," задач"]})]}),p&&s.jsxs("div",{className:"pill","data-active":"false",children:[s.jsx(Ms,{className:"w-4 h-4"}),s.jsxs("span",{children:[p.rating.toFixed(1),"%"]})]}),s.jsxs(Gt,{to:"/rules",className:"inline-flex items-center gap-2 px-3 py-2 rounded-xl bg-gradient-to-r from-[#4E6E49] to-emerald-600 text-white text-sm font-semibold shadow-md hover:shadow-lg hover:-translate-y-0.5 transition-all",children:[s.jsx(ta,{className:"w-4 h-4"}),"Ознакомиться с правилами"]})]})]})}),G?s.jsx("div",{className:`rounded-xl p-8 text-center ${r==="dark"?"bg-white/5 text-white":"bg-white text-gray-800"} shadow`,children:"Загрузка..."}):s.jsxs("div",{className:"space-y-5",children:[s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-[1.05fr_0.95fr] gap-4 items-stretch",children:[s.jsxs("div",{className:"space-y-4 flex flex-col",children:[s.jsxs("div",{className:`rounded-2xl p-5 border ${r==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white"} shadow flex-1`,children:[s.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[s.jsx("div",{className:`p-2.5 rounded-xl ${r==="dark"?"bg-blue-500/15 text-blue-200":"bg-blue-50 text-blue-700"}`,children:s.jsx(cn,{className:"w-5 h-5"})}),s.jsxs("div",{children:[s.jsx("h2",{className:`text-lg font-bold ${f}`,children:"Профиль"}),s.jsx("p",{className:`text-xs ${r==="dark"?"text-gray-400":"text-gray-500"}`,children:"Доступ и учетные данные"})]})]}),s.jsxs("div",{className:"grid sm:grid-cols-2 gap-3",children:[s.jsxs("div",{className:`p-4 rounded-xl border ${r==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white"} shadow-sm`,children:[s.jsx("p",{className:`text-xs font-semibold uppercase tracking-wide ${r==="dark"?"text-gray-400":"text-gray-500"}`,children:"Имя"}),s.jsx("p",{className:`mt-1 text-lg font-bold ${f}`,children:k.name})]}),s.jsxs("div",{className:`p-4 rounded-xl border ${r==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white"} shadow-sm`,children:[s.jsx("p",{className:`text-xs font-semibold uppercase tracking-wide ${r==="dark"?"text-gray-400":"text-gray-500"}`,children:"Логин"}),s.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[s.jsx("p",{className:`text-lg font-bold ${f}`,children:k.login}),s.jsx("button",{onClick:oe,className:`p-2 rounded-lg border transition ${y?"bg-[#4E6E49] text-white border-[#4E6E49]":r==="dark"?"border-white/10 bg-white/5 hover:border-white/30":"border-gray-200 bg-white hover:border-gray-300"}`,title:"Скопировать логин",children:y?s.jsx(Rs,{className:"w-4 h-4"}):s.jsx(gi,{className:"w-4 h-4"})})]})]})]}),s.jsxs("div",{className:"mt-4 space-y-2",children:[s.jsx("label",{className:`text-sm font-semibold ${r==="dark"?"text-gray-300":"text-gray-700"} block`,children:"Пароль"}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("div",{className:`flex-1 px-4 py-3 rounded-lg border ${r==="dark"?"border-white/10 bg-white/5 text-white":"border-gray-200 bg-white text-gray-900"} font-mono text-sm`,children:o?k.password:"•".repeat(k.password.length)}),s.jsx("button",{onClick:()=>c(!o),className:`p-3 rounded-lg border ${r==="dark"?"border-white/10 bg-white/5 hover:border-white/30":"border-gray-200 bg-white hover:border-gray-300"} transition`,title:o?"Скрыть пароль":"Показать пароль",children:o?s.jsx(Ap,{className:"w-5 h-5"}):s.jsx(Cp,{className:"w-5 h-5"})}),s.jsx("button",{onClick:Z,className:`p-3 rounded-lg border transition ${d?"bg-[#4E6E49] text-white border-[#4E6E49]":r==="dark"?"border-white/10 bg-white/5 hover:border-white/30":"border-gray-200 bg-white hover:border-gray-300"}`,title:"Скопировать пароль",children:d?s.jsx(Rs,{className:"w-5 h-5"}):s.jsx(gi,{className:"w-5 h-5"})})]})]}),s.jsx("div",{className:"mt-4 grid gap-3 sm:grid-cols-1",children:s.jsxs("div",{className:`p-4 rounded-xl border ${r==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white"} shadow-sm`,children:[s.jsx("p",{className:`text-xs font-semibold uppercase tracking-wide ${r==="dark"?"text-gray-400":"text-gray-500"}`,children:"Учебная панель (преподаватель)"}),s.jsxs("div",{className:"mt-2 space-y-2 text-sm",children:[s.jsxs("div",{className:`${r==="dark"?"text-gray-300":"text-gray-700"}`,children:[s.jsx("span",{className:"font-semibold",children:"Имя: "}),s.jsx("span",{className:"font-medium",children:"в разработке"})]}),s.jsxs("div",{className:`${r==="dark"?"text-gray-300":"text-gray-700"}`,children:[s.jsx("span",{className:"font-semibold",children:"Логин: "}),s.jsx("span",{className:"font-medium",children:"в разработке"})]}),s.jsxs("div",{className:`${r==="dark"?"text-gray-300":"text-gray-700"}`,children:[s.jsx("span",{className:"font-semibold",children:"Пароль: "}),s.jsx("span",{className:"font-medium",children:"в разработке"})]})]})]})})]}),s.jsxs("div",{className:`rounded-2xl p-5 border ${r==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white"} shadow flex-1`,children:[s.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[s.jsx("div",{className:`p-2.5 rounded-xl ${r==="dark"?"bg-green-500/15 text-green-200":"bg-green-50 text-[#4E6E49]"}`,children:s.jsx(Lr,{className:"w-5 h-5"})}),s.jsxs("div",{children:[s.jsx("h2",{className:`text-lg font-bold ${f}`,children:"Мои задачи"}),s.jsx("p",{className:`text-xs ${r==="dark"?"text-gray-400":"text-gray-500"}`,children:"Сводка по статусам"})]})]}),s.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-3 mb-4",children:[{label:"В работе",value:F,classes:r==="dark"?"bg-blue-500/15 border-blue-500/30 text-blue-100":"bg-blue-50 border-blue-200 text-blue-900"},{label:"Выполнено",value:L,classes:r==="dark"?"bg-emerald-500/15 border-emerald-500/30 text-emerald-50":"bg-emerald-50 border-emerald-200 text-emerald-900"},{label:"Закрыто",value:M,classes:r==="dark"?"bg-gray-600/20 border-gray-500/40 text-gray-100":"bg-gray-50 border-gray-200 text-gray-800"},{label:"Всего",value:g.length,classes:r==="dark"?"bg-gray-600/20 border-gray-500/40 text-gray-100":"bg-gray-50 border-gray-200 text-gray-800"}].map(({label:W,value:ie,classes:Q})=>s.jsxs("div",{className:`p-4 rounded-xl border shadow-sm transition-all hover:translate-y-[-2px] ${Q}`,children:[s.jsx("div",{className:"text-xs font-semibold mb-2 opacity-80",children:W}),s.jsx("div",{className:`text-3xl font-extrabold ${f}`,children:ie})]},W))}),g.length>0&&s.jsxs("div",{className:"space-y-2 mb-4",children:[s.jsx("p",{className:`text-sm font-semibold ${r==="dark"?"text-gray-200":"text-gray-800"}`,children:"Активные задачи"}),s.jsx("div",{className:"space-y-2",children:g.slice(0,3).map(W=>s.jsxs("div",{className:`p-3 rounded-lg border ${r==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-gray-50"} shadow-sm`,children:[s.jsxs("div",{className:"flex items-start justify-between gap-2",children:[s.jsxs("div",{className:"min-w-0",children:[s.jsx("p",{className:`text-sm font-semibold ${f} truncate`,children:W.title}),s.jsxs("p",{className:`text-xs ${r==="dark"?"text-gray-400":"text-gray-600"}`,children:["Дедлайн: ",W.dueDate?ce(new Date(W.dueDate),"dd.MM.yyyy"):"—"," ",W.dueTime||""]})]}),s.jsx("span",{className:`text-[11px] px-2 py-1 rounded-full border ${re[W.status].classes}`,children:re[W.status].label})]}),W.description&&s.jsx("p",{className:`text-xs mt-2 ${r==="dark"?"text-gray-300":"text-gray-600"} line-clamp-2`,children:W.description})]},W.id))})]}),s.jsxs("div",{className:"mt-4 space-y-3",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(tf,{className:"w-4 h-4 text-[#4E6E49]"}),s.jsx("p",{className:`text-sm font-semibold ${f}`,children:"Мои заметки"})]}),s.jsxs("div",{className:"grid gap-2 sm:grid-cols-2",children:[s.jsx("input",{type:"text",value:I.title,onChange:W=>H({...I,title:W.target.value}),placeholder:"Заголовок",className:`px-3 py-2 rounded-lg border ${r==="dark"?"border-white/10 bg-white/5 text-white":"border-gray-200 bg-white text-gray-900"} text-sm`}),s.jsx("div",{className:"flex gap-2",children:["low","medium","high"].map(W=>s.jsx("button",{onClick:()=>H({...I,priority:W}),className:`px-3 py-2 rounded-lg border text-sm flex-1 ${I.priority===W?"border-[#4E6E49] bg-[#4E6E49]/10 text-[#4E6E49]":r==="dark"?"border-white/10 bg-white/5 text-white":"border-gray-200 bg-white text-gray-800"}`,children:W==="low"?"Низкий":W==="medium"?"Средний":"Высокий"},W))})]}),s.jsx("textarea",{value:I.text,onChange:W=>H({...I,text:W.target.value}),rows:3,placeholder:"Текст заметки",className:`w-full px-3 py-2 rounded-lg border ${r==="dark"?"border-white/10 bg-white/5 text-white":"border-gray-200 bg-white text-gray-900"} text-sm`}),s.jsxs("div",{className:"flex gap-2",children:[s.jsxs("button",{onClick:V,className:`px-4 py-2 rounded-lg font-semibold flex items-center gap-2 ${e!=null&&e.id?r==="dark"?"bg-[#4E6E49]/20 text-[#4E6E49] border border-[#4E6E49]/40":"bg-gradient-to-r from-[#4E6E49] to-emerald-500 text-white":"bg-gray-300 text-gray-600 cursor-not-allowed"}`,disabled:!(e!=null&&e.id),children:[s.jsx(pd,{className:"w-4 h-4"}),I.id?"Сохранить":"Добавить"]}),I.id&&s.jsx("button",{onClick:()=>H({id:"",userId:"",title:"",text:"",priority:"medium",createdAt:"",updatedAt:""}),className:`px-4 py-2 rounded-lg font-semibold border ${r==="dark"?"border-white/15 text-gray-200":"border-gray-200 text-gray-700"}`,children:"Отмена"})]}),$.length>0&&s.jsx("div",{className:"space-y-2",children:$.map(W=>s.jsx("div",{className:`p-3 rounded-lg border ${r==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-gray-50"} flex flex-col gap-1`,children:s.jsxs("div",{className:"flex items-start justify-between gap-2",children:[s.jsxs("div",{className:"min-w-0",children:[s.jsx("p",{className:`text-sm font-semibold ${f} truncate`,children:W.title||"Без названия"}),s.jsx("p",{className:`text-xs ${r==="dark"?"text-gray-400":"text-gray-600"} whitespace-pre-line`,children:W.text})]}),s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx("span",{className:`text-[11px] px-2 py-1 rounded-full border ${W.priority==="high"?"border-rose-200 bg-rose-50 text-rose-700 dark:border-rose-500/40 dark:bg-rose-500/15 dark:text-rose-50":W.priority==="medium"?"border-amber-200 bg-amber-50 text-amber-700 dark:border-amber-500/40 dark:bg-amber-500/15 dark:text-amber-50":"border-emerald-200 bg-emerald-50 text-emerald-700 dark:border-emerald-500/40 dark:bg-emerald-500/15 dark:text-emerald-50"}`,children:W.priority==="high"?"Высокий":W.priority==="medium"?"Средний":"Низкий"}),s.jsx("button",{onClick:()=>X(W.id),className:`p-1 rounded border ${r==="dark"?"border-white/10 text-gray-200":"border-gray-200 text-gray-700"}`,title:"Редактировать",children:s.jsx(pd,{className:"w-4 h-4"})}),s.jsx("button",{onClick:()=>R(W.id),className:`p-1 rounded border ${r==="dark"?"border-white/10 text-red-200":"border-gray-200 text-red-600"}`,title:"Удалить",children:s.jsx(Pt,{className:"w-4 h-4"})})]})]})},W.id))})]}),s.jsx("div",{className:"mt-4",children:s.jsxs("button",{onClick:()=>i("/tasks"),className:`w-full px-4 py-3 rounded-lg font-semibold transition-all flex items-center justify-center gap-2 ${r==="dark"?"bg-gradient-to-r from-[#4E6E49]/20 to-emerald-700/20 text-[#4E6E49] border border-[#4E6E49]/40":"bg-gradient-to-r from-green-50 to-emerald-50 text-[#4E6E49] border border-green-200"}`,children:[s.jsx(Lr,{className:"w-4 h-4"}),"Перейти к задачам"]})})]})]}),s.jsxs("div",{className:"space-y-4 flex flex-col",children:[T&&s.jsxs("div",{className:`rounded-2xl p-5 border ${r==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white"} shadow flex-1`,children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:`p-2.5 rounded-xl ${r==="dark"?"bg-emerald-500/20 text-emerald-200":"bg-emerald-50 text-emerald-700"}`,children:s.jsx(Fi,{className:"w-5 h-5"})}),s.jsxs("div",{children:[s.jsx("h2",{className:`text-lg font-bold ${f}`,children:"Мой заработок"}),s.jsx("p",{className:`text-xs ${r==="dark"?"text-gray-400":"text-gray-500"}`,children:"Суммы с учётом долей"})]})]}),s.jsx("div",{className:`px-3 py-1.5 rounded-full text-xs font-semibold border ${T.weekly.net>=1e4?"border-emerald-200 bg-emerald-50 text-emerald-800 dark:border-emerald-500/30 dark:bg-emerald-500/15 dark:text-emerald-100":"border-amber-200 bg-amber-50 text-amber-800 dark:border-amber-500/30 dark:bg-amber-500/15 dark:text-amber-100"}`,children:T.weekly.net>=1e4?"Вывод доступен":"Минимум 10 000 для вывода"})]}),s.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3 mb-4",children:[{label:"Всего заработано",value:T.total},{label:"Отправлено в пул",value:T.pool},{label:"Чистыми",value:T.net}].map(W=>s.jsxs("div",{className:`p-4 rounded-xl border shadow-sm ${r==="dark"?"border-white/10 bg-white/5":"border-gray-100 bg-gray-50"}`,children:[s.jsx("p",{className:"text-xs uppercase tracking-wide opacity-70",children:W.label}),s.jsxs("p",{className:`text-2xl font-extrabold ${f}`,children:[Math.round(W.value).toLocaleString("ru-RU")," ₽"]})]},W.label))}),s.jsxs("div",{className:`p-4 rounded-xl border ${r==="dark"?"border-white/10 bg-white/5":"border-emerald-50 bg-emerald-50/70"} flex flex-col gap-2`,children:[s.jsxs("div",{className:"flex items-center justify-between gap-2 flex-wrap",children:[s.jsxs("div",{children:[s.jsx("p",{className:`text-sm font-semibold ${f}`,children:"Активная неделя"}),s.jsx("p",{className:`text-xs ${r==="dark"?"text-gray-400":"text-gray-600"}`,children:"Понедельник, среда, пятница, суббота — дни вывода"})]}),s.jsx("span",{className:`text-xs px-3 py-1 rounded-full border ${T.weekly.net>=1e4?"border-emerald-200 bg-emerald-100 text-emerald-800 dark:border-emerald-500/40 dark:bg-emerald-500/15 dark:text-emerald-50":"border-amber-200 bg-amber-100 text-amber-800 dark:border-amber-500/40 dark:bg-amber-500/15 dark:text-amber-50"}`,children:T.weekly.net>=1e4?"Доступно к выводу":"Перенос на следующую неделю"})]}),s.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3",children:[{label:"Заработано за неделю",value:T.weekly.gross},{label:"В пул за неделю",value:T.weekly.pool},{label:"Чистыми за неделю",value:T.weekly.net}].map(W=>s.jsxs("div",{className:`p-3 rounded-lg border ${r==="dark"?"border-white/10 bg-white/5":"border-white/80 bg-white/80"} shadow-sm`,children:[s.jsx("p",{className:"text-[11px] uppercase tracking-wide opacity-70",children:W.label}),s.jsxs("p",{className:`text-lg font-bold ${f}`,children:[Math.round(W.value).toLocaleString("ru-RU")," ₽"]})]},W.label))}),T.weekly.net<1e4&&s.jsx("p",{className:`text-xs ${r==="dark"?"text-amber-200":"text-amber-700"}`,children:"Менее 10 000 ₽ чистыми за активную неделю — вывод недоступен, сумма переносится на следующую неделю."})]})]}),p&&A&&s.jsxs("div",{className:`rounded-2xl p-5 border ${r==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white"} shadow flex-1`,children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:`p-2.5 rounded-xl ${r==="dark"?"bg-purple-500/20 text-purple-200":"bg-purple-50 text-purple-700"}`,children:s.jsx(Ms,{className:"w-5 h-5"})}),s.jsxs("div",{children:[s.jsx("h2",{className:`text-lg font-bold ${f}`,children:"Рейтинг"}),s.jsx("p",{className:`text-xs ${r==="dark"?"text-gray-400":"text-gray-500"}`,children:"Еженедельная оценка"})]})]}),s.jsx("div",{className:"pill","data-active":"true",children:s.jsxs("span",{className:"font-bold",children:[p.rating.toFixed(1),"%"]})})]}),s.jsxs("div",{className:`p-4 rounded-xl border ${r==="dark"?"border-white/10 bg-white/5":"border-gray-100 bg-gray-50"} mb-4`,children:[s.jsxs("div",{className:`text-4xl font-extrabold ${f}`,children:[p.rating.toFixed(1),"%"]}),s.jsx("p",{className:`text-xs mt-1 ${r==="dark"?"text-gray-400":"text-gray-600"}`,children:p.rating>=70?"Отличный результат":p.rating>=50?"Хороший темп":"Требуется усиление показателей"})]}),s.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[{label:"Выходные",value:`${p.daysOff} дн`,pts:A.daysOffPoints,classes:r==="dark"?"bg-slate-700/40 border-slate-600/60":"bg-slate-50 border-slate-200"},{label:"Больничные",value:`${p.sickDays} дн`,pts:A.sickDaysPoints,classes:r==="dark"?"bg-amber-500/15 border-amber-500/30":"bg-amber-50 border-amber-200"},{label:"Отпуск",value:`${p.vacationDays} дн`,pts:A.vacationDaysPoints,classes:r==="dark"?"bg-orange-500/15 border-orange-500/30":"bg-orange-50 border-orange-200"},{label:"Часы",value:`${A.weeklyHours.toFixed(1)} ч/нед`,pts:A.weeklyHoursPoints,classes:r==="dark"?"bg-blue-500/15 border-blue-500/30":"bg-blue-50 border-blue-200"},{label:"Заработок",value:`${A.weeklyEarnings.toFixed(0)} ₽/нед`,pts:A.weeklyEarningsPoints,classes:r==="dark"?"bg-emerald-500/15 border-emerald-500/30":"bg-emerald-50 border-emerald-200"},{label:"Рефералы",value:`${p.referrals}`,pts:A.referralsPoints,classes:r==="dark"?"bg-purple-500/15 border-purple-500/30":"bg-purple-50 border-purple-200"},{label:"Сообщения",value:`${A.weeklyMessages} сообщ/нед`,pts:A.weeklyMessagesPoints,classes:r==="dark"?"bg-pink-500/15 border-pink-500/30":"bg-pink-50 border-pink-200"}].map(W=>s.jsxs("div",{className:`p-3 rounded-xl border shadow-sm ${W.classes}`,children:[s.jsx("div",{className:"text-xs font-semibold uppercase opacity-80",children:W.label}),s.jsx("div",{className:`text-lg font-bold ${f}`,children:W.value}),s.jsxs("div",{className:`text-sm ${r==="dark"?"text-gray-100":"text-gray-800"}`,children:[W.pts.toFixed(1),"%"]})]},W.label))}),s.jsxs("div",{className:`mt-4 p-4 rounded-xl border ${r==="dark"?"border-white/10 bg-white/5":"border-gray-100 bg-gray-50"}`,children:[s.jsxs("h3",{className:`text-sm font-bold ${f} mb-2 flex items-center gap-2`,children:[s.jsx(ln,{className:"w-4 h-4"}),"Как считается рейтинг"]}),s.jsx("p",{className:`text-xs ${r==="dark"?"text-gray-300":"text-gray-700"}`,children:"7 параметров: выходные, больничные, отпуск (месяц), часы, доход, рефералы, сообщения (неделя). Максимум 100%."})]})]})]})]}),s.jsx("div",{className:`rounded-2xl p-5 border ${r==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white"} shadow`,children:s.jsxs("button",{onClick:te,className:`w-full px-6 py-3.5 rounded-lg font-semibold transition-all flex items-center justify-center gap-2 ${r==="dark"?"bg-gradient-to-r from-red-500/20 to-pink-500/20 text-red-300 border border-red-500/50":"bg-gradient-to-r from-red-50 to-pink-50 text-red-700 border border-red-200"}`,children:[s.jsx(Wp,{className:"w-5 h-5"}),"Выйти из аккаунта"]})})]})]})}):s.jsx(cr,{children:s.jsx("div",{className:"text-center py-12",children:s.jsx("p",{className:f,children:"Необходима авторизация"})})})},mN="/assets/image-779ddbd9-e512-4bda-8983-af1ab9237b7c-B_v6l7J0.png",gN=()=>{const{theme:r}=it(),e=r==="dark"?"text-white":"text-gray-900",t=r==="dark"?"text-gray-400":"text-gray-600",n=[{title:"Финансовая грамотность",note:"Учимся управлять рисками, понимать токеномику и принимать решения на основе анализа, а не эмоций.",accent:"from-emerald-200 to-teal-200"},{title:"Приватность превыше всего",note:"Уважаем личные границы и используем инструменты, защищающие цифровую идентичность.",accent:"from-sky-200 to-blue-200"},{title:"Образование и развитие",note:"Учимся от основ блокчейна до продвинутых DeFi-стратегий и делимся знаниями.",accent:"from-amber-200 to-orange-200"},{title:"Честность и прозрачность",note:"Внутри клуба — открытость, честные сделки и уважение. Доверие строим действиями.",accent:"from-purple-200 to-indigo-200"},{title:"Инновации и эксперименты",note:"Тестируем новые протоколы, участвуем в DAO, не боимся быть первыми в трендах.",accent:"from-pink-200 to-rose-200"},{title:"Критическое мышление",note:"Не следуем слепо за хайпом: анализируем, проверяем источники и опираемся на здравый смысл.",accent:"from-cyan-200 to-teal-200"},{title:"Глобальное мышление",note:"Открыты к сотрудничеству с людьми из разных стран ради цифровой и финансовой свободы в рамках закона.",accent:"from-lime-200 to-green-200"},{title:"Свобода и ответственность",note:"Ценим свободу крипты и понимаем её цену: зрелость, самоконтроль и ответственность за решения.",accent:"from-gray-200 to-slate-200"}],a=[{label:"Что такое ApeVault?",value:"Клуб криптоэнтузиастов, где знания превращаются в действие."},{label:"Цель",value:"Объединить инвесторов и трейдеров ради роста дохода и безопасности входа в рынок."}];return s.jsx(cr,{children:s.jsxs("div",{className:"space-y-7 sm:space-y-8",children:[s.jsxs("div",{className:"section-card rounded-3xl p-6 sm:p-8 border border-white/60 dark:border-white/10 shadow-2xl relative overflow-hidden",children:[s.jsx("div",{className:"accent-dots"}),s.jsx("div",{className:"absolute inset-y-0 right-0 w-1/3 pointer-events-none bg-gradient-to-l from-[#4E6E49]/10 to-transparent blur-2xl"}),s.jsxs("div",{className:"relative z-10 flex flex-col gap-5 lg:flex-row lg:items-center lg:justify-between",children:[s.jsxs("div",{className:"space-y-3 max-w-3xl",children:[s.jsxs("div",{className:"inline-flex items-center gap-2 px-3 py-1.5 rounded-full border border-white/50 dark:border-white/10 bg-white/70 dark:bg-white/5 text-xs font-semibold uppercase tracking-[0.16em]",children:[s.jsx(ln,{className:"w-4 h-4 text-[#4E6E49]"}),"ApeVault Community"]}),s.jsx("h1",{className:`text-3xl sm:text-4xl lg:text-5xl font-extrabold leading-tight ${e}`,children:"О нас и нашем сообществе"}),s.jsx("p",{className:`text-sm sm:text-base ${t} max-w-2xl`,children:"ApeVault — это пространство, где опытные криптоэнтузиасты объединяют знания и проверенные стратегии, чтобы безопасно заходить в рынок и расти вместе."}),s.jsx("div",{className:"flex flex-wrap gap-2",children:["Командные сессии","Проверенные стратегии","Прозрачные регламенты"].map(i=>s.jsx("span",{className:`px-3 py-1.5 rounded-full text-xs font-semibold border ${r==="dark"?"border-white/10 bg-white/5 text-white":"border-gray-200 bg-white text-gray-900"}`,children:i},i))})]}),s.jsx("div",{className:"grid grid-cols-2 gap-3 w-full max-w-xs lg:max-w-sm",children:[{label:"Участников",value:"50+"},{label:"Сессий / неделю",value:"10+"},{label:"Уроков",value:"100+"},{label:"Фокуса",value:"100% качество"}].map(i=>s.jsxs("div",{className:`rounded-2xl border p-3 sm:p-4 shadow-sm ${r==="dark"?"border-white/10 bg-white/5 text-white":"border-gray-200 bg-white text-gray-900"}`,children:[s.jsx("p",{className:"text-[11px] uppercase tracking-wide opacity-70",children:i.label}),s.jsx("p",{className:"text-xl font-extrabold leading-tight mt-1",children:i.value})]},i.label))})]})]}),s.jsxs("div",{className:"section-card rounded-3xl p-6 sm:p-7 border border-white/60 dark:border-white/10 shadow-xl relative overflow-hidden",children:[s.jsx("div",{className:"absolute top-0 right-0 w-40 h-40 bg-gradient-to-br from-emerald-500/10 to-blue-500/10 rounded-full blur-3xl -mr-16 -mt-16"}),s.jsxs("div",{className:"relative z-10 space-y-4",children:[s.jsxs("h2",{className:`text-2xl sm:text-3xl font-extrabold ${e} flex items-center gap-2`,children:[s.jsx(Yt,{className:"w-6 h-6 text-[#4E6E49]"}),"Что такое ApeVault?"]}),s.jsx("div",{className:"grid gap-4 sm:grid-cols-2",children:a.map(i=>s.jsxs("div",{className:`rounded-2xl border p-4 sm:p-5 flex gap-3 items-start ${r==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white"}`,children:[s.jsx("div",{className:"p-2 rounded-xl bg-gradient-to-br from-[#4E6E49] to-emerald-600 text-white shadow-lg",children:s.jsx(Nt,{className:"w-4 h-4"})}),s.jsxs("div",{className:"space-y-1",children:[s.jsx("p",{className:"text-xs uppercase tracking-wide text-[#4E6E49] font-semibold",children:i.label}),s.jsx("p",{className:`text-sm sm:text-base leading-relaxed ${e}`,children:i.value})]})]},i.label))})]})]}),s.jsxs("div",{className:"section-card rounded-3xl p-6 sm:p-7 border border-white/60 dark:border-white/10 shadow-xl relative overflow-hidden",children:[s.jsx("div",{className:"absolute -left-10 top-0 w-52 h-52 bg-gradient-to-br from-amber-400/10 to-rose-400/10 rounded-full blur-3xl"}),s.jsx("div",{className:"absolute -right-10 bottom-0 w-52 h-52 bg-gradient-to-br from-blue-400/10 to-emerald-400/10 rounded-full blur-3xl"}),s.jsxs("div",{className:"relative z-10 space-y-5",children:[s.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-3",children:[s.jsx("h2",{className:`text-2xl sm:text-3xl font-extrabold ${e}`,children:"Принципы, которые держат нас на вершине"}),s.jsxs("div",{className:"flex gap-2",children:[s.jsxs(Gt,{to:"/rules",className:"pill justify-center text-center","data-active":"false",children:["Ознакомиться с правилами",s.jsx(Nt,{className:"w-4 h-4"})]}),s.jsxs("a",{href:"#contacts",className:"pill","data-active":"false",children:["Контакты",s.jsx(Nt,{className:"w-4 h-4"})]})]})]}),s.jsxs("div",{className:"grid lg:grid-cols-[1fr_420px_1fr] gap-6 items-center",children:[s.jsx("div",{className:"space-y-3",children:n.slice(0,4).map(i=>s.jsxs("div",{className:`rounded-2xl border px-4 py-3 flex items-start gap-3 ${r==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white/90"}`,children:[s.jsx("div",{className:`p-2 rounded-xl text-gray-900 bg-gradient-to-br ${i.accent}`,children:s.jsx(Nt,{className:"w-4 h-4"})}),s.jsxs("div",{className:"space-y-1",children:[s.jsx("p",{className:`text-sm sm:text-base font-semibold ${e}`,children:i.title}),i.note&&s.jsx("p",{className:`text-xs ${t}`,children:i.note})]})]},i.title))}),s.jsxs("div",{className:`rounded-3xl border shadow-xl overflow-hidden relative ${r==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white/95"}`,children:[s.jsx("img",{src:mN,alt:"Принципы ApeVault",className:"w-full h-full object-contain"}),s.jsx("div",{className:"absolute inset-0 pointer-events-none bg-gradient-to-b from-transparent via-transparent to-white/0"})]}),s.jsx("div",{className:"space-y-3",children:n.slice(4).map(i=>s.jsxs("div",{className:`rounded-2xl border px-4 py-3 flex items-start gap-3 ${r==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white/90"}`,children:[s.jsx("div",{className:`p-2 rounded-xl text-gray-900 bg-gradient-to-br ${i.accent}`,children:s.jsx(Nt,{className:"w-4 h-4"})}),s.jsxs("div",{className:"space-y-1",children:[s.jsx("p",{className:`text-sm sm:text-base font-semibold ${e}`,children:i.title}),i.note&&s.jsx("p",{className:`text-xs ${t}`,children:i.note})]})]},i.title))})]})]})]}),s.jsxs("div",{id:"rules",className:"section-card rounded-3xl p-6 sm:p-7 border border-white/60 dark:border-white/10 shadow-xl relative overflow-hidden",children:[s.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-indigo-100/50 via-white/40 to-purple-100/40 dark:from-indigo-900/30 dark:via-transparent dark:to-purple-900/20"}),s.jsxs("div",{className:"relative z-10 grid gap-5 sm:grid-cols-[1.15fr_0.85fr] items-center",children:[s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{className:"inline-flex items-center gap-2 px-3 py-1.5 rounded-full bg-white/80 dark:bg-white/10 border border-white/60 dark:border-white/10 text-xs font-semibold tracking-wide text-indigo-700 dark:text-white",children:[s.jsx(ta,{className:"w-4 h-4"}),"Правила сообщества"]}),s.jsx("h2",{className:`text-2xl sm:text-3xl font-extrabold ${e}`,children:"Простой регламент, чтобы оставаться на одной волне"}),s.jsx("p",{className:`text-sm sm:text-base ${t}`,children:"Подробно описали процессы, безопасность и взаимодействие, чтобы каждый чувствовал прозрачность и поддержку."}),s.jsx("div",{className:"flex flex-wrap gap-2",children:["Безопасность","Честные сделки","Уважение","Прозрачность"].map(i=>s.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-semibold border ${r==="dark"?"border-white/10 bg-white/5 text-white":"border-indigo-100 bg-white text-indigo-900"}`,children:i},i))}),s.jsxs(Gt,{to:"/rules",className:"inline-flex items-center gap-2 px-5 py-3 rounded-xl bg-gradient-to-r from-indigo-500 to-purple-500 text-white font-semibold shadow-lg hover:shadow-xl hover:-translate-y-0.5 transition-all",children:[s.jsx(ta,{className:"w-5 h-5"}),s.jsx("span",{children:"Ознакомиться с правилами"}),s.jsx(Nt,{className:"w-4 h-4"})]})]}),s.jsx("div",{className:`rounded-2xl border p-4 sm:p-5 shadow-lg ${r==="dark"?"border-white/10 bg-white/5":"border-white/80 bg-white/90"}`,children:s.jsx("div",{className:"space-y-3",children:["Короткие правила для быстрых решений","Фокус на безопасности и приватности","Прозрачные роли и ответственность","Действуем в рамках законодательства"].map(i=>s.jsxs("div",{className:"flex items-start gap-2",children:[s.jsx("div",{className:"w-2 h-2 rounded-full bg-indigo-500 mt-2"}),s.jsx("p",{className:`text-sm ${e}`,children:i})]},i))})})]})]}),s.jsxs("div",{id:"contacts",className:"section-card rounded-3xl p-6 sm:p-7 border border-white/60 dark:border-white/10 shadow-xl relative overflow-hidden",children:[s.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-rose-100/50 via-white/40 to-amber-100/40 dark:from-rose-900/25 dark:via-transparent dark:to-amber-900/20"}),s.jsxs("div",{className:"relative z-10 grid gap-5 sm:grid-cols-[0.9fr_1.1fr] items-center",children:[s.jsxs("div",{className:`p-4 rounded-2xl shadow-lg inline-flex items-center gap-3 ${r==="dark"?"bg-gradient-to-br from-rose-600 to-amber-600 text-white":"bg-gradient-to-br from-rose-500 to-amber-500 text-white"}`,children:[s.jsx(qp,{className:"w-7 h-7"}),s.jsxs("div",{children:[s.jsx("p",{className:"text-xs uppercase tracking-wide",children:"Контакты клуба"}),s.jsx("p",{className:"text-base font-semibold",children:"Свяжитесь с нами"})]})]}),s.jsxs("div",{className:"grid gap-3 sm:grid-cols-2",children:[s.jsxs("div",{className:`rounded-2xl border p-4 shadow-md flex flex-col gap-2 ${r==="dark"?"border-white/10 bg-white/5":"border-white/80 bg-white/90"}`,children:[s.jsx("p",{className:"text-xs uppercase tracking-wide text-rose-600 dark:text-rose-200 font-semibold",children:"Администратор"}),s.jsx("p",{className:`text-lg font-extrabold ${e}`,children:"@artyommedoed"}),s.jsx("p",{className:`text-sm ${t}`,children:"По вопросам правил, доступов и регламентов."})]}),s.jsxs("div",{className:`rounded-2xl border p-4 shadow-md flex flex-col gap-2 ${r==="dark"?"border-white/10 bg-white/5":"border-white/80 bg-white/90"}`,children:[s.jsx("p",{className:"text-xs uppercase tracking-wide text-amber-600 dark:text-amber-200 font-semibold",children:"Обратная связь"}),s.jsx("p",{className:`text-lg font-extrabold ${e}`,children:"Командный чат"}),s.jsx("p",{className:`text-sm ${t}`,children:"Оперативные вопросы по продуктам и сессиям."}),s.jsxs("a",{href:"https://t.me/+vPZdPwPaaKI1MjAy",target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-2 text-sm font-semibold text-[#4E6E49] hover:text-emerald-600",children:["Присоединиться",s.jsx(Nt,{className:"w-4 h-4"})]})]})]})]})]})]})})},Cr=({title:r,description:e,children:t})=>{const{theme:n}=it(),a=n==="dark"?"text-white":"text-gray-900",i=n==="dark"?"text-gray-400":"text-gray-600";return s.jsx("div",{className:"section-card rounded-3xl p-6 sm:p-7 border border-white/60 dark:border-white/10 shadow-xl relative overflow-hidden",children:s.jsxs("div",{className:"relative z-10 space-y-4",children:[s.jsxs("div",{className:"flex items-start gap-3",children:[s.jsx("div",{className:"p-2 rounded-xl bg-gradient-to-br from-[#4E6E49]/20 to-emerald-500/15 text-[#4E6E49]",children:s.jsx(ta,{className:"w-5 h-5"})}),s.jsxs("div",{className:"space-y-1",children:[s.jsx("h2",{className:`text-xl sm:text-2xl font-extrabold ${a}`,children:r}),e&&s.jsx("p",{className:`text-sm ${i}`,children:e})]})]}),t]})})},pN=()=>{const{theme:r}=it(),e=r==="dark"?"text-white":"text-gray-900",t=r==="dark"?"text-gray-400":"text-gray-600",n=["последовательной эскалации","объективности и равного применения","недопустимости злоупотребления полномочиями","исключения спорных трактовок и субъективности"],a=["единичные опоздания (не более 1 раза за календарную неделю)","некорректное выполнение инструкций без последствий вследствие заболевания или сбоев в ПО","нарушение регламента общения, не приводящее к конфликту"],i=["повторяющиеся нарушения регламента","несоблюдение правил торговой сессии","недостаточная подготовка к сессии","игнорирование инструкций ведущего","нарушение процедур безопасности данных или доступа"],o=["оскорбления участников","провокации и попытки вызвать конфликт","манипуляции и мошеннические действия","действия, создающие финансовые, репутационные или организационные риски","подрыв дисциплины и порядка в сообществе"],c=[{term:"Нарушение",text:"любое действие или бездействие, противоречащее регламентам ApeVault"},{term:"Предупреждение",text:"официальное уведомление о нарушении"},{term:"Выговор",text:"фиксируемая мера повышенной строгости при повторных нарушениях"},{term:"Ведущий торговой сессии",text:"управляет процессом и следит за соблюдением регламента на сессии"},{term:"Ответственный за сообщество",text:"назначенное лицо, управляющее дисциплиной и коммуникацией"},{term:"Повторное нарушение",text:"нарушение в течение 30 календарных дней после предыдущего"}];return s.jsx(cr,{children:s.jsxs("div",{className:"space-y-7 sm:space-y-8",children:[s.jsxs("div",{className:"section-card rounded-3xl p-6 sm:p-8 border border-white/60 dark:border-white/10 shadow-2xl relative overflow-hidden",children:[s.jsx("div",{className:"accent-dots"}),s.jsx("div",{className:"absolute inset-y-0 right-0 w-1/3 pointer-events-none bg-gradient-to-l from-[#4E6E49]/12 to-transparent blur-3xl"}),s.jsxs("div",{className:"relative z-10 flex flex-col gap-5 lg:flex-row lg:items-center lg:justify-between",children:[s.jsxs("div",{className:"space-y-4 max-w-3xl",children:[s.jsx("div",{className:"inline-flex items-center gap-2 px-3 py-1.5 rounded-full border border-white/50 dark:border-white/10 bg-white/70 dark:bg-white/5 text-xs font-semibold uppercase tracking-[0.16em] text-[#4E6E49]",children:"ApeVault Standard Operating Code — ASOC"}),s.jsx("h1",{className:`text-3xl sm:text-4xl lg:text-5xl font-extrabold leading-tight ${e}`,children:"Кодекс операционных процедур и регламентов платформы ApeVault"}),s.jsx("p",{className:`text-sm sm:text-base ${t}`,children:"Единые правила ответственности, дисциплинарных мер и прозрачных процедур для команды ApeVault."}),s.jsx("div",{className:"flex flex-wrap gap-2",children:["Ответственность","Прозрачность","Безопасность","Справедливость"].map(d=>s.jsx("span",{className:`px-3 py-1.5 rounded-full text-xs font-semibold border ${r==="dark"?"border-white/10 bg-white/5 text-white":"border-gray-200 bg-white text-gray-900"}`,children:d},d))})]}),s.jsxs("div",{className:`rounded-3xl border shadow-xl p-4 sm:p-5 w-full lg:max-w-sm ${r==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white"}`,children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"p-3 rounded-2xl bg-gradient-to-br from-[#4E6E49] to-emerald-600 text-white shadow-lg",children:s.jsx(Ui,{className:"w-6 h-6"})}),s.jsxs("div",{children:[s.jsx("p",{className:"text-xs uppercase tracking-wide text-[#4E6E49] font-semibold",children:"Назначение раздела"}),s.jsx("p",{className:`text-base font-semibold ${e}`,children:"Поддержание порядка и профессионализма команды"})]})]}),s.jsxs("div",{className:"mt-4 space-y-2",children:[s.jsxs("div",{className:"flex items-center gap-2 text-sm font-semibold text-[#4E6E49]",children:[s.jsx(Nt,{className:"w-4 h-4"}),"Публичная версия правил доступна на сайте"]}),s.jsx("p",{className:`text-xs ${t}`,children:"Используйте кнопку «Правила» в навигации или в профиле, чтобы быстро открыть этот раздел."})]})]})]})]}),s.jsxs(Cr,{title:"Политика ответственности и меры дисциплинарного воздействия",description:"Единый порядок применения мер для поддержания порядка, прозрачности и профессионального уровня.",children:[s.jsxs("div",{className:`grid gap-4 sm:grid-cols-2 ${r==="dark"?"text-gray-200":"text-gray-900"}`,children:[s.jsxs("div",{className:`rounded-2xl border p-4 sm:p-5 ${r==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white"}`,children:[s.jsxs("div",{className:"flex items-center gap-2 text-sm font-semibold text-[#4E6E49]",children:[s.jsx(md,{className:"w-4 h-4"}),"Цели дисциплинарной политики"]}),s.jsx("p",{className:`text-sm mt-2 ${t}`,children:"Обеспечить соблюдение регламентов, процедур и рабочих стандартов команды."})]}),s.jsxs("div",{className:`rounded-2xl border p-4 sm:p-5 ${r==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white"}`,children:[s.jsxs("div",{className:"flex items-center gap-2 text-sm font-semibold text-[#4E6E49]",children:[s.jsx(Zp,{className:"w-4 h-4"}),"Принципы применения мер"]}),s.jsx("ul",{className:`text-sm mt-2 space-y-1 ${t}`,children:n.map(d=>s.jsxs("li",{children:["• ",d]},d))})]})]}),s.jsx("div",{className:`mt-3 text-sm ${t}`,children:"Меры ответственности применяются в зависимости от тяжести, регулярности и последствий нарушения."})]}),s.jsx(Cr,{title:"Унифицированный регламент торговой деятельности ApeVault",description:"Нормы поведения на торговых сессиях, полномочия ведущего, перерывы, записи и конфиденциальность.",children:s.jsxs("div",{className:`space-y-4 text-sm ${t}`,children:[s.jsxs("div",{className:`rounded-2xl border p-4 sm:p-5 ${r==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white"}`,children:[s.jsx("p",{className:"text-base font-semibold text-[#4E6E49]",children:"1. Общие положения"}),s.jsxs("ul",{className:"mt-2 space-y-1",children:[s.jsx("li",{children:"• Регламент задаёт нормы участия, дисциплину, полномочия ведущего и ответственность."}),s.jsx("li",{children:"• Все участники обязаны ознакомиться с разделом до начала торговой деятельности."})]})]}),s.jsxs("div",{className:`rounded-2xl border p-4 sm:p-5 ${r==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white"}`,children:[s.jsx("p",{className:"text-base font-semibold text-[#4E6E49]",children:"2. Права и полномочия ведущего"}),s.jsx("p",{className:"mt-2 font-semibold text-[#4E6E49]",children:"Полномочия:"}),s.jsxs("ul",{className:"mt-1 space-y-1",children:[s.jsx("li",{children:"• Давать обязательные распоряжения по порядку, действиям, стратегии и дисциплине."}),s.jsx("li",{children:"• Требовать соблюдения тайминга, регламента и корректного поведения."}),s.jsx("li",{children:"• Приостанавливать участие нарушающих участников."}),s.jsx("li",{children:"• Объявлять перерывы и завершение сессии."}),s.jsx("li",{children:"• Фиксировать нарушения, выдавать предупреждения/выговоры, вводить временный запрет на участие."})]}),s.jsx("p",{className:"mt-3 font-semibold text-[#4E6E49]",children:"Ограничения:"}),s.jsxs("ul",{className:"mt-1 space-y-1",children:[s.jsx("li",{children:"• Не изменяет дисциплинарные меры, установленные регламентом."}),s.jsx("li",{children:"• Не принимает решения об исключении из команды (решает ответственный за команду)."}),s.jsx("li",{children:"• Не меняет торговую стратегию вне утверждённой методологии или плана сессии."})]})]}),s.jsxs("div",{className:`rounded-2xl border p-4 sm:p-5 space-y-3 ${r==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white"}`,children:[s.jsx("p",{className:"text-base font-semibold text-[#4E6E49]",children:"3. Порядок проведения сессии"}),s.jsxs("div",{children:[s.jsx("p",{className:"font-semibold",children:"Начало и окончание:"}),s.jsxs("ul",{className:"mt-1 space-y-1",children:[s.jsx("li",{children:"• Старт строго по времени слота."}),s.jsx("li",{children:"• Подключение за 3–5 минут до старта обязательно."}),s.jsx("li",{children:"• Окончание объявляет ведущий, не позднее 30 минут после окончания слота."})]})]}),s.jsxs("div",{children:[s.jsx("p",{className:"font-semibold",children:"Поведение во время торгов:"}),s.jsx("p",{className:"text-xs uppercase tracking-wide opacity-70 mt-1",children:"Запрещено:"}),s.jsxs("ul",{className:"space-y-1",children:[s.jsx("li",{children:"• Перебивать ведущего или участников."}),s.jsx("li",{children:"• Отвлекать команду сторонними вопросами."}),s.jsx("li",{children:"• Включать микрофон без необходимости, создавать шум."}),s.jsx("li",{children:"• Саботировать процесс или предлагать несогласованные решения."}),s.jsx("li",{children:"• Коммуницировать с кем-либо вне участников сессии."})]}),s.jsx("p",{className:"text-xs uppercase tracking-wide opacity-70 mt-2",children:"Обязано:"}),s.jsxs("ul",{className:"space-y-1",children:[s.jsx("li",{children:"• Следовать инструкциям ведущего и оперативно исполнять распоряжения."}),s.jsx("li",{children:"• Сохранять корректность и нейтральность в коммуникации."}),s.jsx("li",{children:"• Обеспечивать техническую готовность: связь, устройство, ПО."})]})]})]}),s.jsxs("div",{className:`rounded-2xl border p-4 sm:p-5 space-y-2 ${r==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white"}`,children:[s.jsx("p",{className:"text-base font-semibold text-[#4E6E49]",children:"4. Политика перерывов"}),s.jsxs("ul",{className:"space-y-1",children:[s.jsx("li",{children:"• Краткий перерыв — до 10 минут каждые 45 минут."}),s.jsx("li",{children:"• Большой перерыв — до 45 минут каждые 3 часа активной торговли."}),s.jsx("li",{children:"• Все перерывы объявляет ведущий."}),s.jsx("li",{children:"• Самовольные перерывы запрещены; нарушение дисциплины, если не согласовано в трекере слотов и с ответственным."})]})]}),s.jsxs("div",{className:`rounded-2xl border p-4 sm:p-5 space-y-2 ${r==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white"}`,children:[s.jsx("p",{className:"text-base font-semibold text-[#4E6E49]",children:"5. Правила записи сессий"}),s.jsxs("ul",{className:"space-y-1",children:[s.jsx("li",{children:"• Запись включает только ведущий или ответственный за сообщество."}),s.jsx("li",{children:"• Хранение — в закрытом архиве команды; доступ: ведущий, управляющий сообществом, ответственные аналитики."}),s.jsx("li",{children:"• Распространение вне команды запрещено."}),s.jsx("li",{children:"• Срок хранения определяет ведущий: до 3 лет, но ≥14 календарных дней."})]})]}),s.jsxs("div",{className:`rounded-2xl border p-4 sm:p-5 space-y-2 ${r==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white"}`,children:[s.jsx("p",{className:"text-base font-semibold text-[#4E6E49]",children:"6. Конфликт интересов"}),s.jsxs("ul",{className:"space-y-1",children:[s.jsx("li",{children:"• Запрещено действовать в интересах сторонних групп/конкурентов."}),s.jsx("li",{children:"• Запрещено передавать стратегию, аналитику, материалы, алгоритмы, сигналы и методики ApeVault третьим лицам."}),s.jsx("li",{children:"• Запрещено получать вознаграждение за внешние консультации, использующие опыт или данные ApeVault."}),s.jsx("li",{children:"• Запрещено участвовать в параллельных торговых группах, если это создаёт риск конфликта или утечки информации."})]})]}),s.jsxs("div",{className:`rounded-2xl border p-4 sm:p-5 space-y-2 ${r==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white"}`,children:[s.jsx("p",{className:"text-base font-semibold text-[#4E6E49]",children:"7. Конфиденциальность"}),s.jsxs("ul",{className:"space-y-1",children:[s.jsx("li",{children:"• Все материалы, данные, аналитика, торговые решения и внутренняя коммуникация — интеллектуальная собственность ApeVault."}),s.jsx("li",{children:"• Запрещено копировать, распространять или передавать информацию третьим лицам."}),s.jsx("li",{children:"• Запрещено создавать производные материалы без согласования с ответственным."}),s.jsx("li",{children:"• Запрещено публиковать скриншоты, отчёты или содержимое сессий в открытых источниках (кроме чата команды)."}),s.jsx("li",{children:"• Требование к среде: наушники и отсутствие посторонних рядом; не допускать, чтобы экран/звук были доступны третьим лицам."}),s.jsx("li",{className:"font-semibold text-[#4E6E49]",children:"Нарушение положений конфиденциальности — основание для немедленного исключения."})]})]})]})}),s.jsx(Cr,{title:"Классификация нарушений",description:"Три уровня тяжести определяют, как быстро применяются ограничения.",children:s.jsxs("div",{className:"grid gap-4 lg:grid-cols-3",children:[s.jsxs("div",{className:`rounded-2xl border p-4 sm:p-5 ${r==="dark"?"border-white/10 bg-white/5":"border-amber-100 bg-white/95"}`,children:[s.jsxs("div",{className:"flex items-center gap-2 text-sm font-semibold text-amber-600 dark:text-amber-300",children:[s.jsx(ln,{className:"w-4 h-4"}),"Незначительные"]}),s.jsx("ul",{className:`text-sm mt-2 space-y-1 ${t}`,children:a.map(d=>s.jsxs("li",{children:["• ",d]},d))})]}),s.jsxs("div",{className:`rounded-2xl border p-4 sm:p-5 ${r==="dark"?"border-white/10 bg-white/5":"border-orange-100 bg-white/95"}`,children:[s.jsxs("div",{className:"flex items-center gap-2 text-sm font-semibold text-orange-600 dark:text-orange-300",children:[s.jsx(Rr,{className:"w-4 h-4"}),"Средние"]}),s.jsx("ul",{className:`text-sm mt-2 space-y-1 ${t}`,children:i.map(d=>s.jsxs("li",{children:["• ",d]},d))})]}),s.jsxs("div",{className:`rounded-2xl border p-4 sm:p-5 ${r==="dark"?"border-white/10 bg-white/5":"border-rose-100 bg-white/95"}`,children:[s.jsxs("div",{className:"flex items-center gap-2 text-sm font-semibold text-rose-600 dark:text-rose-300",children:[s.jsx(pi,{className:"w-4 h-4"}),"Грубые"]}),s.jsx("ul",{className:`text-sm mt-2 space-y-1 ${t}`,children:o.map(d=>s.jsxs("li",{children:["• ",d]},d))})]})]})}),s.jsx(Cr,{title:"Меры дисциплинарного воздействия и ограничения",description:"Применяются последовательно, кроме случаев грубых нарушений.",children:s.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[s.jsxs("div",{className:`rounded-2xl border p-4 sm:p-5 space-y-2 ${r==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white"}`,children:[s.jsxs("div",{className:"flex items-center gap-2 text-sm font-semibold text-[#4E6E49]",children:[s.jsx(md,{className:"w-4 h-4"}),"Порядок эскалации"]}),s.jsxs("ul",{className:`text-sm space-y-1 ${t}`,children:[s.jsx("li",{children:"• Напоминания — не более 1 в неделю, без последствий."}),s.jsx("li",{children:"• Предупреждения — не более 2 в неделю, при повторении незначительных или единичном среднем нарушении."}),s.jsx("li",{children:"• Выговоры — не более 2 в неделю, назначаются ведущим сессии или ответственным за сообщество."})]})]}),s.jsxs("div",{className:`rounded-2xl border p-4 sm:p-5 space-y-2 ${r==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white"}`,children:[s.jsxs("div",{className:"flex items-center gap-2 text-sm font-semibold text-[#4E6E49]",children:[s.jsx(pi,{className:"w-4 h-4"}),"Ограничительные меры"]}),s.jsxs("ul",{className:`text-sm space-y-1 ${t}`,children:[s.jsx("li",{children:"• Ограничение доступа к торговым сессиям: 1-е — ≥3 дней; повторное — 1 неделя; систематическое — 2 недели; дальше — исключение без восстановления."}),s.jsx("li",{children:"• Немедленное исключение без эскалации за грубое нарушение, оскорбления, провокации или угрозу финансам/безопасности/репутации."})]})]})]})}),s.jsx(Cr,{title:"Финансовые последствия",description:"Что происходит при систематических нарушениях и невыполнении мер.",children:s.jsx("div",{className:`rounded-2xl border p-4 sm:p-5 space-y-2 ${r==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white"}`,children:s.jsxs("ul",{className:`text-sm space-y-2 ${t}`,children:[s.jsx("li",{children:"• При систематических нарушениях и игнорировании мер может быть отказано в удовлетворении заявки на вывод средств, включая заработок за успешные сессии."}),s.jsx("li",{children:"• Перераспределение заработка: удержанные средства делятся между участниками, кроме тех, кто допустил два и более нарушений в неделю или более 6 нарушений в месяц."}),s.jsx("li",{children:"• Добровольно внесённые в пул или кошелёк команды средства не возвращаются при досрочном выходе или исключении за нарушения."})]})})}),s.jsx(Cr,{title:"Фиксация нарушений и апелляции",description:"Прозрачный процесс учёта нарушений и возможность обжаловать решение.",children:s.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[s.jsxs("div",{className:`rounded-2xl border p-4 sm:p-5 space-y-2 ${r==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white"}`,children:[s.jsxs("div",{className:"flex items-center gap-2 text-sm font-semibold text-[#4E6E49]",children:[s.jsx(ss,{className:"w-4 h-4"}),"Порядок фиксации"]}),s.jsxs("ul",{className:`text-sm space-y-1 ${t}`,children:[s.jsx("li",{children:"• Все нарушения фиксируются ответственным за сообщество в отдельной ветви командного чата Telegram."}),s.jsx("li",{children:"• Обязательная фиксация: дата и время, тип нарушения, краткое описание ситуации, применённая мера."})]})]}),s.jsxs("div",{className:`rounded-2xl border p-4 sm:p-5 space-y-2 ${r==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white"}`,children:[s.jsxs("div",{className:"flex items-center gap-2 text-sm font-semibold text-[#4E6E49]",children:[s.jsx(Ps,{className:"w-4 h-4"}),"Процедура апелляции"]}),s.jsxs("ul",{className:`text-sm space-y-1 ${t}`,children:[s.jsx("li",{children:"• Апелляция подаётся в течение 24 часов с момента уведомления о мере."}),s.jsx("li",{children:"• Подача: ответственному за сообщество или назначенному куратору."}),s.jsx("li",{children:"• Рассмотрение: до 60 часов; решение окончательное."})]})]})]})}),s.jsx(Cr,{title:"Принцип равного применения",description:"Меры действуют одинаково для всех участников.",children:s.jsx("div",{className:`rounded-2xl border p-4 sm:p-5 space-y-1 ${r==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white"}`,children:s.jsx("p",{className:`text-sm ${t}`,children:"Дисциплинарные меры применяются ко всем участникам независимо от стажа, роли в проекте, вклада, личных отношений или результатов торговых сессий. Привилегии и исключения не допускаются."})})}),s.jsx(Cr,{title:"Определения",description:"Ключевые термины, чтобы избежать двусмысленностей.",children:s.jsx("div",{className:"grid gap-4 md:grid-cols-2",children:c.map(d=>s.jsxs("div",{className:`rounded-2xl border p-4 sm:p-5 space-y-1 ${r==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white"}`,children:[s.jsx("p",{className:"text-sm font-semibold text-[#4E6E49]",children:d.term}),s.jsx("p",{className:`text-sm ${t}`,children:d.text})]},d.term))})}),s.jsx(Cr,{title:"Заключительные положения",description:"Кто может обновлять раздел и обязанность ознакомления.",children:s.jsx("div",{className:`rounded-2xl border p-4 sm:p-5 space-y-2 ${r==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white"}`,children:s.jsxs("ul",{className:`text-sm space-y-1 ${t}`,children:[s.jsx("li",{children:"• Ответственный за сообщество или исполняющий обязанности оставляет за собой право корректировать и обновлять раздел при изменении процессов или структуры платформы."}),s.jsx("li",{children:"• Все участники обязаны ознакомиться с настоящей политикой и соблюдать её безусловно."})]})})})]})})},fN={create:"Создание",update:"Изменение",delete:"Удаление"},xN={slot:"Слот",status:"Статус",earning:"Заработок",referral:"Реферал"},yN={pending:"bg-amber-50 text-amber-900 border border-amber-200 shadow-inner dark:bg-amber-900/25 dark:text-amber-50 dark:border-amber-700",approved:"bg-emerald-50 text-emerald-900 border border-emerald-200 shadow-inner dark:bg-emerald-900/25 dark:text-emerald-50 dark:border-emerald-700",rejected:"bg-rose-50 text-rose-900 border border-rose-200 shadow-inner dark:bg-rose-900/25 dark:text-rose-50 dark:border-rose-700"},bN={pending:s.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-semibold bg-amber-100 text-amber-900 dark:bg-amber-900/40 dark:text-amber-100",children:[s.jsx(Ps,{className:"w-3 h-3"})," На согласовании"]}),approved:s.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-semibold bg-emerald-100 text-emerald-900 dark:bg-emerald-900/40 dark:text-emerald-100",children:[s.jsx(Ds,{className:"w-3 h-3"})," Принято"]}),rejected:s.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-semibold bg-rose-100 text-rose-900 dark:bg-rose-900/40 dark:text-rose-100",children:[s.jsx(nf,{className:"w-3 h-3"})," Отклонено"]})},eh=r=>{var e;return((e=Se.find(t=>t.id===r))==null?void 0:e.name)||r},pa=r=>{if(!r)return"—";try{return ce(r,"dd.MM.yyyy")}catch{return"—"}},th=r=>{var t,n;if(!r)return"—";const e=(n=(t=r.slots)==null?void 0:t.map(a=>`${a.start}-${a.end}${a.endDate?` (до ${pa(a.endDate)})`:""}`))==null?void 0:n.join(", ");return`${pa(r.date)}${e?` · ${e}`:""}`},rh=r=>{if(!r)return"—";const e=r.type==="dayoff"?"Выходной":r.type==="sick"?"Больничный":"Отпуск",t=r.endDate?` (${pa(r.endDate)})`:"";return`${pa(r.date)} · ${e}${t}`},vN=()=>{const{user:r}=kt(),[e,t]=D.useState([]),[n,a]=D.useState(!0),[i,o]=D.useState(null),[c,d]=D.useState(!1),[h,g]=D.useState([]),[x,p]=D.useState(null),v=async()=>{a(!0),p(null);try{const I=await Lg();t(I)}catch(I){console.error("Не удалось загрузить заявки на согласование",I),p("Не удалось загрузить заявки")}finally{a(!1)}};D.useEffect(()=>{v()},[]);const A=async I=>{if(!i){o(I),p(null);try{await Lu(I,(r==null?void 0:r.id)||"admin"),await v(),g(H=>H.filter(G=>G!==I))}catch(H){console.error("Ошибка при подтверждении",H),p(`Не удалось подтвердить заявку: ${(H==null?void 0:H.message)||H}`),await v()}finally{o(null)}}},C=async I=>{if(i)return;const H=prompt("Комментарий для отклонения заявки","Уточните детали")||"Отклонено без комментария";o(I),p(null);try{await _2(I,(r==null?void 0:r.id)||"admin",H),await v()}catch(G){console.error("Ошибка при отклонении",G),p("Не удалось отклонить заявку")}finally{o(null)}},T=async()=>{if(!(c||i||h.length===0)){d(!0),p(null);try{for(const I of h)await Lu(I,(r==null?void 0:r.id)||"admin");await v(),g([])}catch(I){console.error("Ошибка при подтверждении выбранных",I),p(`Не удалось подтвердить выбранные заявки: ${(I==null?void 0:I.message)||I}`),await v()}finally{d(!1)}}},z=I=>{g(H=>H.includes(I)?H.filter(G=>G!==I):[...H,I])},$=()=>{const I=e.filter(G=>G.status==="pending").map(G=>G.id),H=I.every(G=>h.includes(G));g(H?[]:I)},S=I=>{if(I.entity==="slot"){const E=I.before,y=I.after;return`${th(E)} → ${th(y)}`}const H=I.before,G=I.after;return`${rh(H)} → ${rh(G)}`};return n?s.jsx("div",{className:"rounded-xl border border-gray-200 dark:border-gray-800 p-6 text-center text-sm text-gray-600 dark:text-gray-300",children:"Загружаем заявки..."}):s.jsxs("div",{className:"rounded-xl border border-gray-200 dark:border-gray-800 overflow-hidden shadow-sm",children:[s.jsxs("div",{className:"p-4 sm:p-5 border-b border-gray-200 dark:border-gray-800 flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-lg font-semibold",children:"Согласования"}),s.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Заявки на изменение слотов и статусов"})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("button",{onClick:T,disabled:c||i!==null||h.length===0,className:"text-sm px-3 py-2 rounded-lg bg-emerald-600 hover:bg-emerald-700 disabled:bg-emerald-400 text-white font-semibold",children:c?"Подтверждаем...":`Принять выбранные (${h.length})`}),s.jsx("button",{onClick:v,className:"text-sm px-3 py-2 rounded-lg bg-gray-100 hover:bg-gray-200 dark:bg-gray-800 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-200",children:"Обновить"})]})]}),x&&s.jsx("div",{className:"px-4 py-3 bg-rose-100 text-rose-900 dark:bg-rose-900/30 dark:text-rose-100 text-sm",children:x}),s.jsx("div",{className:"overflow-x-auto",children:s.jsxs("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-800 text-sm",children:[s.jsx("thead",{className:"bg-gray-50 dark:bg-gray-900/40",children:s.jsxs("tr",{children:[s.jsx("th",{className:"px-4 py-3 text-left font-semibold text-gray-700 dark:text-gray-200",children:"Статус"}),s.jsx("th",{className:"px-4 py-3 text-left font-semibold text-gray-700 dark:text-gray-200",children:"Тип"}),s.jsx("th",{className:"px-4 py-3 text-left font-semibold text-gray-700 dark:text-gray-200",children:"Действие"}),s.jsx("th",{className:"px-4 py-3 text-left font-semibold text-gray-700 dark:text-gray-200",children:"Кто"}),s.jsx("th",{className:"px-4 py-3 text-left font-semibold text-gray-700 dark:text-gray-200",children:"Изменение"}),s.jsx("th",{className:"px-4 py-3 text-left font-semibold text-gray-700 dark:text-gray-200",children:"Комментарий"}),s.jsx("th",{className:"px-4 py-3 text-left font-semibold text-gray-700 dark:text-gray-200",children:"Действия"}),s.jsx("th",{className:"px-4 py-3 text-left font-semibold text-gray-700 dark:text-gray-200",children:s.jsx("button",{onClick:$,className:"inline-flex items-center gap-1 text-sm text-[#4E6E49] hover:text-emerald-700",title:"Выбрать все на согласовании",children:e.some(I=>I.status==="pending")?s.jsxs(s.Fragment,{children:[e.filter(I=>I.status==="pending").every(I=>h.includes(I.id))?s.jsx(Lr,{className:"w-4 h-4"}):s.jsx(So,{className:"w-4 h-4"})," Все"]}):s.jsx(So,{className:"w-4 h-4 opacity-50"})})})]})}),s.jsxs("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-800",children:[e.map(I=>s.jsxs("tr",{className:`bg-white dark:bg-[#0f1624] ${yN[I.status]}`,children:[s.jsx("td",{className:"px-4 py-3 align-top",children:bN[I.status]}),s.jsx("td",{className:"px-4 py-3 align-top font-semibold",children:xN[I.entity]}),s.jsx("td",{className:"px-4 py-3 align-top",children:fN[I.action]}),s.jsx("td",{className:"px-4 py-3 align-top",children:s.jsxs("div",{className:"flex flex-col gap-1",children:[s.jsx("span",{className:"font-semibold",children:eh(I.targetUserId)}),s.jsxs("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:["Автор: ",eh(I.authorId)]}),s.jsxs("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:["Создано: ",pa(I.createdAt)," "]})]})}),s.jsxs("td",{className:"px-4 py-3 align-top",children:[s.jsx("div",{className:"text-xs sm:text-sm font-medium",children:S(I)}),I.after&&I.entity==="slot"&&I.after.comment&&s.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:["Комментарий слота: ",I.after.comment]}),I.after&&I.entity==="status"&&I.after.comment&&s.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:["Комментарий статуса: ",I.after.comment]})]}),s.jsxs("td",{className:"px-4 py-3 align-top",children:[s.jsx("div",{className:"text-xs sm:text-sm text-gray-700 dark:text-gray-200 whitespace-pre-wrap",children:I.comment||"—"}),I.adminComment&&s.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:["Ответ админа: ",I.adminComment]})]}),s.jsx("td",{className:"px-4 py-3 align-top",children:I.status==="pending"?s.jsxs("div",{className:"flex flex-col gap-2",children:[s.jsx("button",{onClick:()=>A(I.id),disabled:!!i,className:"px-3 py-2 rounded-lg bg-emerald-600 hover:bg-emerald-700 disabled:bg-emerald-400 text-white text-xs sm:text-sm font-semibold",children:i===I.id?"Применяем...":"Подтвердить и применить"}),s.jsx("button",{onClick:()=>C(I.id),disabled:!!i,className:"px-3 py-2 rounded-lg bg-rose-600 hover:bg-rose-700 disabled:bg-rose-400 text-white text-xs sm:text-sm font-semibold",children:i===I.id?"Отклоняем...":"Отклонить"})]}):s.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Действие выполнено"})}),s.jsx("td",{className:"px-4 py-3 align-top",children:I.status==="pending"?s.jsxs("button",{onClick:()=>z(I.id),className:"inline-flex items-center gap-1 text-sm text-[#4E6E49] hover:text-emerald-700",children:[h.includes(I.id)?s.jsx(Lr,{className:"w-4 h-4"}):s.jsx(So,{className:"w-4 h-4"}),s.jsx("span",{className:"sr-only",children:"Выбрать заявку"})]}):s.jsx("span",{className:"text-xs text-gray-400",children:"—"})})]},I.id)),e.length===0&&s.jsx("tr",{children:s.jsx("td",{colSpan:7,className:"px-4 py-6 text-center text-sm text-gray-500 dark:text-gray-400",children:"Нет заявок на согласование"})})]})]})})]})},wN=()=>{const{isAdmin:r}=Tt();return r?s.jsx(cr,{children:s.jsxs("div",{className:"max-w-6xl mx-auto px-4 sm:px-6 py-6 sm:py-8 space-y-6",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Администрирование"}),s.jsx("h1",{className:"text-2xl sm:text-3xl font-bold",children:"Согласования изменений"}),s.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Подтверждайте или отклоняйте изменения слотов, перерывов и статусов участников."})]}),s.jsx(vN,{})]})}):s.jsx(mi,{to:"/management",replace:!0})},Dr=({children:r})=>{const{isAuthenticated:e}=kt(),{isAdmin:t}=Tt();return!e&&!t?s.jsx(mi,{to:"/login",replace:!0}):s.jsx(s.Fragment,{children:r})};function kN(){const{isAuthenticated:r}=kt(),{isAdmin:e}=Tt(),{theme:t}=it();return D.useEffect(()=>{document.body.classList.toggle("dark",t==="dark")},[t]),D.useEffect(()=>{y2().catch(n=>console.error("Cleanup failed",n))},[]),s.jsx(P0,{children:s.jsxs(M0,{children:[s.jsx(ar,{path:"/login",element:!r&&!e?s.jsx(cf,{}):s.jsx(mi,{to:"/management",replace:!0})}),s.jsx(ar,{path:"/call",element:s.jsx(Dr,{children:s.jsx(B_,{})})}),s.jsx(ar,{path:"/management",element:s.jsx(Dr,{children:s.jsx(K_,{})})}),s.jsx(ar,{path:"/earnings",element:s.jsx(Dr,{children:s.jsx(J_,{})})}),s.jsx(ar,{path:"/rating",element:s.jsx(Dr,{children:s.jsx(tN,{})})}),s.jsx(ar,{path:"/tasks",element:s.jsx(Dr,{children:s.jsx(dN,{})})}),s.jsx(ar,{path:"/about",element:s.jsx(Dr,{children:s.jsx(gN,{})})}),s.jsx(ar,{path:"/rules",element:s.jsx(pN,{})}),s.jsx(ar,{path:"/approvals",element:s.jsx(Dr,{children:s.jsx(wN,{})})}),s.jsx(ar,{path:"/admin",element:s.jsx(Dr,{children:s.jsx(uN,{})})}),s.jsx(ar,{path:"/profile",element:s.jsx(Dr,{children:s.jsx(hN,{})})}),s.jsx(ar,{path:"/",element:s.jsx(mi,{to:r||e?"/management":"/login",replace:!0})})]})})}Ho.createRoot(document.getElementById("root")).render(s.jsx(sh.StrictMode,{children:s.jsx(kN,{})}));
