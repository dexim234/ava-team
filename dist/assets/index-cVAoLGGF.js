import{r as A,a as h0,g as m0,R as Hu,u as Gu,b as g0,c as p0,L as Ir,N as Po,B as f0,d as x0,e as tr}from"./react-vendor-Dou2_yf_.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))n(a);new MutationObserver(a=>{for(const i of a)if(i.type==="childList")for(const l of i.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&n(l)}).observe(document,{childList:!0,subtree:!0});function t(a){const i={};return a.integrity&&(i.integrity=a.integrity),a.referrerPolicy&&(i.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?i.credentials="include":a.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(a){if(a.ep)return;a.ep=!0;const i=t(a);fetch(a.href,i)}})();var Ku={exports:{}},Ci={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var y0=A,b0=Symbol.for("react.element"),v0=Symbol.for("react.fragment"),w0=Object.prototype.hasOwnProperty,_0=y0.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,k0={key:!0,ref:!0,__self:!0,__source:!0};function Qu(r,e,t){var n,a={},i=null,l=null;t!==void 0&&(i=""+t),e.key!==void 0&&(i=""+e.key),e.ref!==void 0&&(l=e.ref);for(n in e)w0.call(e,n)&&!k0.hasOwnProperty(n)&&(a[n]=e[n]);if(r&&r.defaultProps)for(n in e=r.defaultProps,e)a[n]===void 0&&(a[n]=e[n]);return{$$typeof:b0,type:r,key:i,ref:l,props:a,_owner:_0.current}}Ci.Fragment=v0;Ci.jsx=Qu;Ci.jsxs=Qu;Ku.exports=Ci;var s=Ku.exports,$o={},td=h0;$o.createRoot=td.createRoot,$o.hydrateRoot=td.hydrateRoot;const N0={},rd=r=>{let e;const t=new Set,n=(g,x)=>{const p=typeof g=="function"?g(e):g;if(!Object.is(p,e)){const E=e;e=x??(typeof p!="object"||p===null)?p:Object.assign({},e,p),t.forEach(j=>j(e,E))}},a=()=>e,d={setState:n,getState:a,getInitialState:()=>h,subscribe:g=>(t.add(g),()=>t.delete(g)),destroy:()=>{(N0?"production":void 0)!=="production"&&console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),t.clear()}},h=e=r(n,a,d);return d},E0=r=>r?rd(r):rd;var Yu={exports:{}},Xu={},Ju={exports:{}},Zu={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Zs=A;function j0(r,e){return r===e&&(r!==0||1/r===1/e)||r!==r&&e!==e}var I0=typeof Object.is=="function"?Object.is:j0,T0=Zs.useState,S0=Zs.useEffect,A0=Zs.useLayoutEffect,C0=Zs.useDebugValue;function R0(r,e){var t=e(),n=T0({inst:{value:t,getSnapshot:e}}),a=n[0].inst,i=n[1];return A0(function(){a.value=t,a.getSnapshot=e,po(a)&&i({inst:a})},[r,t,e]),S0(function(){return po(a)&&i({inst:a}),r(function(){po(a)&&i({inst:a})})},[r]),C0(t),t}function po(r){var e=r.getSnapshot;r=r.value;try{var t=e();return!I0(r,t)}catch{return!0}}function D0(r,e){return e()}var P0=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?D0:R0;Zu.useSyncExternalStore=Zs.useSyncExternalStore!==void 0?Zs.useSyncExternalStore:P0;Ju.exports=Zu;var $0=Ju.exports;/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ri=A,M0=$0;function O0(r,e){return r===e&&(r!==0||1/r===1/e)||r!==r&&e!==e}var V0=typeof Object.is=="function"?Object.is:O0,L0=M0.useSyncExternalStore,F0=Ri.useRef,U0=Ri.useEffect,B0=Ri.useMemo,q0=Ri.useDebugValue;Xu.useSyncExternalStoreWithSelector=function(r,e,t,n,a){var i=F0(null);if(i.current===null){var l={hasValue:!1,value:null};i.current=l}else l=i.current;i=B0(function(){function d(E){if(!h){if(h=!0,g=E,E=n(E),a!==void 0&&l.hasValue){var j=l.value;if(a(j,E))return x=j}return x=E}if(j=x,V0(g,E))return j;var S=n(E);return a!==void 0&&a(j,S)?(g=E,j):(g=E,x=S)}var h=!1,g,x,p=t===void 0?null:t;return[function(){return d(e())},p===null?void 0:function(){return d(p())}]},[e,t,n,a]);var c=L0(r,i[0],i[1]);return U0(function(){l.hasValue=!0,l.value=c},[c]),q0(c),c};Yu.exports=Xu;var W0=Yu.exports;const z0=m0(W0),eh={},{useDebugValue:H0}=Hu,{useSyncExternalStoreWithSelector:G0}=z0;let sd=!1;const K0=r=>r;function Q0(r,e=K0,t){(eh?"production":void 0)!=="production"&&t&&!sd&&(console.warn("[DEPRECATED] Use `createWithEqualityFn` instead of `create` or use `useStoreWithEqualityFn` instead of `useStore`. They can be imported from 'zustand/traditional'. https://github.com/pmndrs/zustand/discussions/1937"),sd=!0);const n=G0(r.subscribe,r.getState,r.getServerState||r.getInitialState,e,t);return H0(n),n}const Y0=r=>{(eh?"production":void 0)!=="production"&&typeof r!="function"&&console.warn("[DEPRECATED] Passing a vanilla store will be unsupported in a future version. Instead use `import { useStore } from 'zustand'`.");const e=typeof r=="function"?E0(r):r,t=(n,a)=>Q0(e,n,a);return Object.assign(t,e),t},dl=r=>Y0,X0={};function J0(r,e){let t;try{t=r()}catch{return}return{getItem:a=>{var i;const l=d=>d===null?null:JSON.parse(d,void 0),c=(i=t.getItem(a))!=null?i:null;return c instanceof Promise?c.then(l):l(c)},setItem:(a,i)=>t.setItem(a,JSON.stringify(i,void 0)),removeItem:a=>t.removeItem(a)}}const zn=r=>e=>{try{const t=r(e);return t instanceof Promise?t:{then(n){return zn(n)(t)},catch(n){return this}}}catch(t){return{then(n){return this},catch(n){return zn(n)(t)}}}},Z0=(r,e)=>(t,n,a)=>{let i={getStorage:()=>localStorage,serialize:JSON.stringify,deserialize:JSON.parse,partialize:k=>k,version:0,merge:(k,L)=>({...L,...k}),...e},l=!1;const c=new Set,d=new Set;let h;try{h=i.getStorage()}catch{}if(!h)return r((...k)=>{console.warn(`[zustand persist middleware] Unable to update item '${i.name}', the given storage is currently unavailable.`),t(...k)},n,a);const g=zn(i.serialize),x=()=>{const k=i.partialize({...n()});let L;const M=g({state:k,version:i.version}).then(T=>h.setItem(i.name,T)).catch(T=>{L=T});if(L)throw L;return M},p=a.setState;a.setState=(k,L)=>{p(k,L),x()};const E=r((...k)=>{t(...k),x()},n,a);let j;const S=()=>{var k;if(!h)return;l=!1,c.forEach(M=>M(n()));const L=((k=i.onRehydrateStorage)==null?void 0:k.call(i,n()))||void 0;return zn(h.getItem.bind(h))(i.name).then(M=>{if(M)return i.deserialize(M)}).then(M=>{if(M)if(typeof M.version=="number"&&M.version!==i.version){if(i.migrate)return i.migrate(M.state,M.version);console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return M.state}).then(M=>{var T;return j=i.merge(M,(T=n())!=null?T:E),t(j,!0),x()}).then(()=>{L==null||L(j,void 0),l=!0,d.forEach(M=>M(j))}).catch(M=>{L==null||L(void 0,M)})};return a.persist={setOptions:k=>{i={...i,...k},k.getStorage&&(h=k.getStorage())},clearStorage:()=>{h==null||h.removeItem(i.name)},getOptions:()=>i,rehydrate:()=>S(),hasHydrated:()=>l,onHydrate:k=>(c.add(k),()=>{c.delete(k)}),onFinishHydration:k=>(d.add(k),()=>{d.delete(k)})},S(),j||E},ep=(r,e)=>(t,n,a)=>{let i={storage:J0(()=>localStorage),partialize:S=>S,version:0,merge:(S,k)=>({...k,...S}),...e},l=!1;const c=new Set,d=new Set;let h=i.storage;if(!h)return r((...S)=>{console.warn(`[zustand persist middleware] Unable to update item '${i.name}', the given storage is currently unavailable.`),t(...S)},n,a);const g=()=>{const S=i.partialize({...n()});return h.setItem(i.name,{state:S,version:i.version})},x=a.setState;a.setState=(S,k)=>{x(S,k),g()};const p=r((...S)=>{t(...S),g()},n,a);a.getInitialState=()=>p;let E;const j=()=>{var S,k;if(!h)return;l=!1,c.forEach(M=>{var T;return M((T=n())!=null?T:p)});const L=((k=i.onRehydrateStorage)==null?void 0:k.call(i,(S=n())!=null?S:p))||void 0;return zn(h.getItem.bind(h))(i.name).then(M=>{if(M)if(typeof M.version=="number"&&M.version!==i.version){if(i.migrate)return[!0,i.migrate(M.state,M.version)];console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return[!1,M.state];return[!1,void 0]}).then(M=>{var T;const[O,ne]=M;if(E=i.merge(ne,(T=n())!=null?T:p),t(E,!0),O)return g()}).then(()=>{L==null||L(E,void 0),E=n(),l=!0,d.forEach(M=>M(E))}).catch(M=>{L==null||L(void 0,M)})};return a.persist={setOptions:S=>{i={...i,...S},S.storage&&(h=S.storage)},clearStorage:()=>{h==null||h.removeItem(i.name)},getOptions:()=>i,rehydrate:()=>j(),hasHydrated:()=>l,onHydrate:S=>(c.add(S),()=>{c.delete(S)}),onFinishHydration:S=>(d.add(S),()=>{d.delete(S)})},i.skipHydration||j(),E||p},tp=(r,e)=>"getStorage"in e||"serialize"in e||"deserialize"in e?((X0?"production":void 0)!=="production"&&console.warn("[DEPRECATED] `getStorage`, `serialize` and `deserialize` options are deprecated. Use `storage` option instead."),Z0(r,e)):ep(r,e),ul=tp,ws={memecoins:{label:"Мемкоины",accent:"emerald",icon:"rocket"},futures:{label:"Фьючерсы",accent:"blue",icon:"line"},nft:{label:"NFT",accent:"purple",icon:"image"},spot:{label:"Спот",accent:"amber",icon:"coins"},polymarket:{label:"PolyMarket",accent:"pink",icon:"barchart"},staking:{label:"Стейкинг",accent:"indigo",icon:"shield"},other:{label:"Другое",accent:"gray",icon:"sparkles"}},Ee=[{id:"1",name:"Артём",login:"artyom03",password:"248artdex",avatar:"/avatars/artyom.jpg"},{id:"2",name:"Адель",login:"adel05",password:"058adeldex",avatar:"/avatars/adel.jpg"},{id:"3",name:"Ксения",login:"ksen03",password:"907ksendex",avatar:"/avatars/kseniya.jpg"},{id:"4",name:"Ольга",login:"olga04",password:"638olgadex",avatar:"/avatars/olga.jpg"},{id:"5",name:"Анастасия",login:"anastasia05",password:"638anastadex",avatar:"/avatars/anastasia.jpg"}],ai={trading:{label:"Торговля",icon:"candles",color:"green"},learning:{label:"Обучение",icon:"book",color:"blue"},technical:{label:"ТЧ",icon:"cpu",color:"purple"},stream:{label:"Стрим",icon:"broadcast",color:"red"},research:{label:"Изучение",icon:"flask",color:"yellow"},organization:{label:"Ресёрч",icon:"clipboard",color:"indigo"}},_s={pending:{label:"Проверка",color:"yellow"},in_progress:{label:"В работе",color:"blue"},approval:{label:"Апрув",color:"purple"},completed:{label:"Выполнено",color:"green"},closed:{label:"Закрыто",color:"gray"},rejected:{label:"Отклонена",color:"red"}},Dt=dl()(ul(r=>({user:null,isAuthenticated:!1,login:(e,t)=>{const n=Ee.find(a=>a.login===e&&a.password===t);return n?(r({user:n,isAuthenticated:!0}),!0):!1},logout:()=>r({user:null,isAuthenticated:!1})}),{name:"apevault-auth"})),rp="9119ApeVault",Bt=dl()(ul(r=>({isAdmin:!1,activateAdmin:e=>e===rp?(r({isAdmin:!0}),!0):!1,deactivateAdmin:()=>r({isAdmin:!1})}),{name:"apevault-admin"})),ct=dl()(ul(r=>({theme:"light",toggleTheme:()=>r(e=>{const t=e.theme==="light"?"dark":"light";return document.body.classList.toggle("dark",t==="dark"),{theme:t}}),setTheme:e=>r(()=>(document.body.classList.toggle("dark",e==="dark"),{theme:e}))}),{name:"apevault-theme"}));/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var sp={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const np=r=>r.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().trim(),de=(r,e)=>{const t=A.forwardRef(({color:n="currentColor",size:a=24,strokeWidth:i=2,absoluteStrokeWidth:l,className:c="",children:d,...h},g)=>A.createElement("svg",{ref:g,...sp,width:a,height:a,stroke:n,strokeWidth:l?Number(i)*24/Number(a):i,className:["lucide",`lucide-${np(r)}`,c].join(" "),...h},[...e.map(([x,p])=>A.createElement(x,p)),...Array.isArray(d)?d:[d]]));return t.displayName=`${r}`,t};/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const th=de("Activity",[["path",{d:"M22 12h-4l-3 9L9 3l-3 9H2",key:"d5dnw9"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hl=de("AlarmClock",[["circle",{cx:"12",cy:"13",r:"8",key:"3y4lt7"}],["path",{d:"M12 9v4l2 2",key:"1c63tq"}],["path",{d:"M5 3 2 6",key:"18tl5t"}],["path",{d:"m22 6-3-3",key:"1opdir"}],["path",{d:"M6.38 18.7 4 21",key:"17xu3x"}],["path",{d:"M17.64 18.67 20 21",key:"kv2oe2"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ml=de("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zr=de("AlertTriangle",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z",key:"c3ski4"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ap=de("Archive",[["rect",{width:"20",height:"5",x:"2",y:"3",rx:"1",key:"1wp1u1"}],["path",{d:"M4 8v11a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8",key:"1s80jp"}],["path",{d:"M10 12h4",key:"a56b0p"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ip=de("ArrowDownRight",[["path",{d:"m7 7 10 10",key:"1fmybs"}],["path",{d:"M17 7v10H7",key:"6fjiku"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kt=de("ArrowUpRight",[["path",{d:"M7 7h10v10",key:"1tivn9"}],["path",{d:"M7 17 17 7",key:"1vkiza"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gl=de("BarChart3",[["path",{d:"M3 3v18h18",key:"1s2lah"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ii=de("BookOpen",[["path",{d:"M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z",key:"vv98re"}],["path",{d:"M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z",key:"1cyq3y"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nd=de("Building2",[["path",{d:"M6 22V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v18Z",key:"1b4qmf"}],["path",{d:"M6 12H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h2",key:"i71pzd"}],["path",{d:"M18 9h2a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2h-2",key:"10jefs"}],["path",{d:"M10 6h4",key:"1itunk"}],["path",{d:"M10 10h4",key:"tcdvrf"}],["path",{d:"M10 14h4",key:"kelpxr"}],["path",{d:"M10 18h4",key:"1ulq68"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fo=de("CalendarCheck",[["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",ry:"2",key:"eu3xkr"}],["line",{x1:"16",x2:"16",y1:"2",y2:"6",key:"m3sa8f"}],["line",{x1:"8",x2:"8",y1:"2",y2:"6",key:"18kwsl"}],["line",{x1:"3",x2:"21",y1:"10",y2:"10",key:"xt86sb"}],["path",{d:"m9 16 2 2 4-4",key:"19s6y9"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Mo=de("CalendarClock",[["path",{d:"M21 7.5V6a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h3.5",key:"1osxxc"}],["path",{d:"M16 2v4",key:"4m81vk"}],["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M3 10h5",key:"r794hk"}],["path",{d:"M17.5 17.5 16 16.25V14",key:"re2vv1"}],["path",{d:"M22 16a6 6 0 1 1-12 0 6 6 0 0 1 12 0Z",key:"ame013"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const br=de("Calendar",[["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",ry:"2",key:"eu3xkr"}],["line",{x1:"16",x2:"16",y1:"2",y2:"6",key:"m3sa8f"}],["line",{x1:"8",x2:"8",y1:"2",y2:"6",key:"18kwsl"}],["line",{x1:"3",x2:"21",y1:"10",y2:"10",key:"xt86sb"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const op=de("CandlestickChart",[["path",{d:"M9 5v4",key:"14uxtq"}],["rect",{width:"4",height:"6",x:"7",y:"9",rx:"1",key:"f4fvz0"}],["path",{d:"M9 15v2",key:"r5rk32"}],["path",{d:"M17 3v2",key:"1l2re6"}],["rect",{width:"4",height:"8",x:"15",y:"5",rx:"1",key:"z38je5"}],["path",{d:"M17 13v3",key:"5l0wba"}],["path",{d:"M3 3v18h18",key:"1s2lah"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Di=de("CheckCircle2",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ss=de("CheckSquare",[["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}],["path",{d:"M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11",key:"1jnkn4"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Dr=de("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Dn=de("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ad=de("CircleDot",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lp=de("ClipboardList",[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}],["path",{d:"M12 11h4",key:"1jrz19"}],["path",{d:"M12 16h4",key:"n85exb"}],["path",{d:"M8 11h.01",key:"1dfujw"}],["path",{d:"M8 16h.01",key:"18s6g9"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const On=de("Clock3",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16.5 12",key:"1aq6pp"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const en=de("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ur=de("Coins",[["circle",{cx:"8",cy:"8",r:"6",key:"3yglwk"}],["path",{d:"M18.09 10.37A6 6 0 1 1 10.34 18",key:"t5s6rm"}],["path",{d:"M7 6h1v4",key:"1obek4"}],["path",{d:"m16.71 13.88.7.71-2.82 2.82",key:"1rbuyh"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oi=de("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cp=de("Cpu",[["rect",{x:"4",y:"4",width:"16",height:"16",rx:"2",key:"1vbyd7"}],["rect",{x:"9",y:"9",width:"6",height:"6",key:"o3kz5p"}],["path",{d:"M15 2v2",key:"13l42r"}],["path",{d:"M15 20v2",key:"15mkzm"}],["path",{d:"M2 15h2",key:"1gxd5l"}],["path",{d:"M2 9h2",key:"1bbxkp"}],["path",{d:"M20 15h2",key:"19e6y8"}],["path",{d:"M20 9h2",key:"19tzq7"}],["path",{d:"M9 2v2",key:"165o2o"}],["path",{d:"M9 20v2",key:"i2bqo8"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const na=de("DollarSign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dp=de("EyeOff",[["path",{d:"M9.88 9.88a3 3 0 1 0 4.24 4.24",key:"1jxqfv"}],["path",{d:"M10.73 5.08A10.43 10.43 0 0 1 12 5c7 0 10 7 10 7a13.16 13.16 0 0 1-1.67 2.68",key:"9wicm4"}],["path",{d:"M6.61 6.61A13.526 13.526 0 0 0 2 12s3 7 10 7a9.74 9.74 0 0 0 5.39-1.61",key:"1jreej"}],["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pl=de("Eye",[["path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",key:"rwhkz3"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const up=de("Feather",[["path",{d:"M20.24 12.24a6 6 0 0 0-8.49-8.49L5 10.5V19h8.5z",key:"u4sw5n"}],["line",{x1:"16",x2:"2",y1:"8",y2:"22",key:"1c47m2"}],["line",{x1:"17.5",x2:"9",y1:"15",y2:"15",key:"2fj3pr"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hp=de("FileCode",[["path",{d:"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z",key:"1nnpy2"}],["polyline",{points:"14 2 14 8 20 8",key:"1ew0cm"}],["path",{d:"m10 13-2 2 2 2",key:"17smn8"}],["path",{d:"m14 17 2-2-2-2",key:"14mezr"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fl=de("FileText",[["path",{d:"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z",key:"1nnpy2"}],["polyline",{points:"14 2 14 8 20 8",key:"1ew0cm"}],["line",{x1:"16",x2:"8",y1:"13",y2:"13",key:"14keom"}],["line",{x1:"16",x2:"8",y1:"17",y2:"17",key:"17nazh"}],["line",{x1:"10",x2:"8",y1:"9",y2:"9",key:"1a5vjj"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rh=de("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mp=de("Flag",[["path",{d:"M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z",key:"i9b6wo"}],["line",{x1:"4",x2:"4",y1:"22",y2:"15",key:"1cm3nv"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gp=de("Flame",[["path",{d:"M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 0 0 2.5 2.5z",key:"96xj49"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pp=de("FlaskConical",[["path",{d:"M10 2v7.527a2 2 0 0 1-.211.896L4.72 20.55a1 1 0 0 0 .9 1.45h12.76a1 1 0 0 0 .9-1.45l-5.069-10.127A2 2 0 0 1 14 9.527V2",key:"pzvekw"}],["path",{d:"M8.5 2h7",key:"csnxdl"}],["path",{d:"M7 16h10",key:"wp8him"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vn=de("Gauge",[["path",{d:"m12 14 4-4",key:"9kzdfg"}],["path",{d:"M3.34 19a10 10 0 1 1 17.32 0",key:"19p75a"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fp=de("Globe2",[["path",{d:"M21.54 15H17a2 2 0 0 0-2 2v4.54",key:"1djwo0"}],["path",{d:"M7 3.34V5a3 3 0 0 0 3 3v0a2 2 0 0 1 2 2v0c0 1.1.9 2 2 2v0a2 2 0 0 0 2-2v0c0-1.1.9-2 2-2h3.17",key:"1fi5u6"}],["path",{d:"M11 21.95V18a2 2 0 0 0-2-2v0a2 2 0 0 1-2-2v-1a2 2 0 0 0-2-2H2.05",key:"xsiumc"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xp=de("Hash",[["line",{x1:"4",x2:"20",y1:"9",y2:"9",key:"4lhtct"}],["line",{x1:"4",x2:"20",y1:"15",y2:"15",key:"vyu0kd"}],["line",{x1:"10",x2:"8",y1:"3",y2:"21",key:"1ggp8o"}],["line",{x1:"16",x2:"14",y1:"3",y2:"21",key:"weycgp"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yp=de("HeartPulse",[["path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z",key:"c3ymky"}],["path",{d:"M3.22 12H9.5l.5-1 2 4.5 2-7 1.5 3.5h5.27",key:"1uw2ng"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bp=de("Heart",[["path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z",key:"c3ymky"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sh=de("HelpCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vp=de("Hourglass",[["path",{d:"M5 22h14",key:"ehvnwv"}],["path",{d:"M5 2h14",key:"pdyrp9"}],["path",{d:"M17 22v-4.172a2 2 0 0 0-.586-1.414L12 12l-4.414 4.414A2 2 0 0 0 7 17.828V22",key:"1d314k"}],["path",{d:"M7 2v4.172a2 2 0 0 0 .586 1.414L12 12l4.414-4.414A2 2 0 0 0 17 6.172V2",key:"1vvvr6"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const aa=de("Image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rr=de("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wp=de("Key",[["circle",{cx:"7.5",cy:"15.5",r:"5.5",key:"yqb3hr"}],["path",{d:"m21 2-9.6 9.6",key:"1j0ho8"}],["path",{d:"m15.5 7.5 3 3L22 7l-3-3",key:"1rn1fs"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _p=de("Layers",[["path",{d:"m12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83Z",key:"8b97xw"}],["path",{d:"m22 17.65-9.17 4.16a2 2 0 0 1-1.66 0L2 17.65",key:"dd6zsq"}],["path",{d:"m22 12.65-9.17 4.16a2 2 0 0 1-1.66 0L2 12.65",key:"ep9fru"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kp=de("LayoutGrid",[["rect",{width:"7",height:"7",x:"3",y:"3",rx:"1",key:"1g98yp"}],["rect",{width:"7",height:"7",x:"14",y:"3",rx:"1",key:"6d4xhi"}],["rect",{width:"7",height:"7",x:"14",y:"14",rx:"1",key:"nxv5o0"}],["rect",{width:"7",height:"7",x:"3",y:"14",rx:"1",key:"1bb6yr"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ia=de("LineChart",[["path",{d:"M3 3v18h18",key:"1s2lah"}],["path",{d:"m19 9-5 5-4-4-3 3",key:"2osh9i"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const id=de("Link2",[["path",{d:"M9 17H7A5 5 0 0 1 7 7h2",key:"8i5ue5"}],["path",{d:"M15 7h2a5 5 0 1 1 0 10h-2",key:"1b9ql8"}],["line",{x1:"8",x2:"16",y1:"12",y2:"12",key:"1jonct"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Np=de("List",[["line",{x1:"8",x2:"21",y1:"6",y2:"6",key:"7ey8pc"}],["line",{x1:"8",x2:"21",y1:"12",y2:"12",key:"rjfblc"}],["line",{x1:"8",x2:"21",y1:"18",y2:"18",key:"c3b1m8"}],["line",{x1:"3",x2:"3.01",y1:"6",y2:"6",key:"1g7gq3"}],["line",{x1:"3",x2:"3.01",y1:"12",y2:"12",key:"1pjlvk"}],["line",{x1:"3",x2:"3.01",y1:"18",y2:"18",key:"28t2mc"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const od=de("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nh=de("LogIn",[["path",{d:"M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4",key:"u53s6r"}],["polyline",{points:"10 17 15 12 10 7",key:"1ail0h"}],["line",{x1:"15",x2:"3",y1:"12",y2:"12",key:"v6grx8"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ep=de("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jp=de("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ma=de("MapPin",[["path",{d:"M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z",key:"2oe9fu"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qr=de("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xl=de("Moon",[["path",{d:"M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z",key:"a7tn18"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ip=de("MoreVertical",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Tp=de("Network",[["rect",{x:"16",y:"16",width:"6",height:"6",rx:"1",key:"4q2zg0"}],["rect",{x:"2",y:"16",width:"6",height:"6",rx:"1",key:"8cvhb9"}],["rect",{x:"9",y:"2",width:"6",height:"6",rx:"1",key:"1egb70"}],["path",{d:"M5 16v-3a1 1 0 0 1 1-1h12a1 1 0 0 1 1 1v3",key:"1jsf9p"}],["path",{d:"M12 12V8",key:"2874zd"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xo=de("Octagon",[["polygon",{points:"7.86 2 16.14 2 22 7.86 22 16.14 16.14 22 7.86 22 2 16.14 2 7.86 7.86 2",key:"h1p8hx"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Sp=de("Palette",[["circle",{cx:"13.5",cy:"6.5",r:".5",key:"1xcu5"}],["circle",{cx:"17.5",cy:"10.5",r:".5",key:"736e4u"}],["circle",{cx:"8.5",cy:"7.5",r:".5",key:"clrty"}],["circle",{cx:"6.5",cy:"12.5",r:".5",key:"1s4xz9"}],["path",{d:"M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10c.926 0 1.648-.746 1.648-1.688 0-.437-.18-.835-.437-1.125-.29-.289-.438-.652-.438-1.125a1.64 1.64 0 0 1 1.668-1.668h1.996c3.051 0 5.555-2.503 5.555-5.554C21.965 6.012 17.461 2 12 2z",key:"12rzf8"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ld=de("PenLine",[["path",{d:"M12 20h9",key:"t2du7b"}],["path",{d:"M16.5 3.5a2.12 2.12 0 0 1 3 3L7 19l-4 1 1-4Z",key:"ymcmye"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gt=de("PenSquare",[["path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1qinfi"}],["path",{d:"M18.5 2.5a2.12 2.12 0 0 1 3 3L12 15l-4 1 1-4Z",key:"w2jsv5"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cd=de("Pen",[["path",{d:"M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z",key:"5qss01"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Oa=de("Percent",[["line",{x1:"19",x2:"5",y1:"5",y2:"19",key:"1x9vlm"}],["circle",{cx:"6.5",cy:"6.5",r:"2.5",key:"4mh3h7"}],["circle",{cx:"17.5",cy:"17.5",r:"2.5",key:"1mdrzq"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ap=de("PieChart",[["path",{d:"M21.21 15.89A10 10 0 1 1 8 2.83",key:"k2fpak"}],["path",{d:"M22 12A10 10 0 0 0 12 2v10z",key:"1rfc4y"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dd=de("PiggyBank",[["path",{d:"M19 5c-1.5 0-2.8 1.4-3 2-3.5-1.5-11-.3-11 5 0 1.8 0 3 2 4.5V20h4v-2h3v2h4v-4c1-.5 1.7-1 2-2h2v-4h-2c0-1-.5-1.5-1-2h0V5z",key:"uf6l00"}],["path",{d:"M2 9v1c0 1.1.9 2 2 2h1",key:"nm575m"}],["path",{d:"M16 11h0",key:"k2aug8"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ah=de("Plane",[["path",{d:"M17.8 19.2 16 11l3.5-3.5C21 6 21.5 4 21 3c-1-.5-3 0-4.5 1.5L13 8 4.8 6.2c-.5-.1-.9.1-1.1.5l-.3.5c-.2.5-.1 1 .3 1.3L9 12l-2 3H4l-1 1 3 2 2 3 1-1v-3l3-2 3.5 5.3c.3.4.8.5 1.3.3l.5-.2c.4-.3.6-.7.5-1.2z",key:"1v9wt8"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ih=de("PlusCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}],["path",{d:"M12 8v8",key:"napkw2"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const li=de("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oh=de("Radio",[["path",{d:"M4.9 19.1C1 15.2 1 8.8 4.9 4.9",key:"1vaf9d"}],["path",{d:"M7.8 16.2c-2.3-2.3-2.3-6.1 0-8.5",key:"u1ii0m"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}],["path",{d:"M16.2 7.8c2.3 2.3 2.3 6.1 0 8.5",key:"1j5fej"}],["path",{d:"M19.1 4.9C23 8.8 23 15.1 19.1 19",key:"10b0cb"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Cp=de("RefreshCcw",[["path",{d:"M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"14sxne"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16",key:"1hlbsb"}],["path",{d:"M16 16h5v5",key:"ccwih5"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oa=de("Rocket",[["path",{d:"M4.5 16.5c-1.5 1.26-2 5-2 5s3.74-.5 5-2c.71-.84.7-2.13-.09-2.91a2.18 2.18 0 0 0-2.91-.09z",key:"m3kijz"}],["path",{d:"m12 15-3-3a22 22 0 0 1 2-3.95A12.88 12.88 0 0 1 22 2c0 2.72-.78 7.5-6 11a22.35 22.35 0 0 1-4 2z",key:"1fmvmk"}],["path",{d:"M9 12H4s.55-3.03 2-4c1.62-1.08 5 0 5 0",key:"1f8sc4"}],["path",{d:"M12 15v5s3.03-.55 4-2c1.08-1.62 0-5 0-5",key:"qeys4"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Rp=de("RotateCcw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xs=de("ScrollText",[["path",{d:"M8 21h12a2 2 0 0 0 2-2v-2H10v2a2 2 0 1 1-4 0V5a2 2 0 1 0-4 0v3h4",key:"13a6an"}],["path",{d:"M19 17V5a2 2 0 0 0-2-2H4",key:"zz82l3"}],["path",{d:"M15 8h-5",key:"1khuty"}],["path",{d:"M15 12h-5",key:"r7krc0"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Dp=de("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ud=de("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const In=de("ShieldAlert",[["path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10",key:"1irkt0"}],["path",{d:"M12 8v4",key:"1got3b"}],["path",{d:"M12 16h.01",key:"1drbdi"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pi=de("ShieldCheck",[["path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10",key:"1irkt0"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Lt=de("Shield",[["path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10",key:"1irkt0"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hd=de("SlidersHorizontal",[["line",{x1:"21",x2:"14",y1:"4",y2:"4",key:"obuewd"}],["line",{x1:"10",x2:"3",y1:"4",y2:"4",key:"1q6298"}],["line",{x1:"21",x2:"12",y1:"12",y2:"12",key:"1iu8h1"}],["line",{x1:"8",x2:"3",y1:"12",y2:"12",key:"ntss68"}],["line",{x1:"21",x2:"16",y1:"20",y2:"20",key:"14d8ph"}],["line",{x1:"12",x2:"3",y1:"20",y2:"20",key:"m0wm8r"}],["line",{x1:"14",x2:"14",y1:"2",y2:"6",key:"14e1ph"}],["line",{x1:"8",x2:"8",y1:"10",y2:"14",key:"1i6ji0"}],["line",{x1:"16",x2:"16",y1:"18",y2:"22",key:"1lctlv"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zt=de("Sparkles",[["path",{d:"m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z",key:"17u4zn"}],["path",{d:"M5 3v4",key:"bklmnn"}],["path",{d:"M19 17v4",key:"iiml17"}],["path",{d:"M3 5h4",key:"nem4j1"}],["path",{d:"M17 19h4",key:"lbex7p"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pp=de("StickyNote",[["path",{d:"M15.5 3H5a2 2 0 0 0-2 2v14c0 1.1.9 2 2 2h14a2 2 0 0 0 2-2V8.5L15.5 3Z",key:"1wis1t"}],["path",{d:"M15 3v6h6",key:"edgan2"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lh=de("Sun",[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"m4.93 4.93 1.41 1.41",key:"149t6j"}],["path",{d:"m17.66 17.66 1.41 1.41",key:"ptbguv"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"m6.34 17.66-1.41 1.41",key:"1m8zz5"}],["path",{d:"m19.07 4.93-1.41 1.41",key:"1shlcs"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $p=de("Table2",[["path",{d:"M9 3H5a2 2 0 0 0-2 2v4m6-6h10a2 2 0 0 1 2 2v4M9 3v18m0 0h10a2 2 0 0 0 2-2V9M9 21H5a2 2 0 0 1-2-2V9m0 0h18",key:"gugj83"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Mp=de("Tag",[["path",{d:"M12 2H2v10l9.29 9.29c.94.94 2.48.94 3.42 0l6.58-6.58c.94-.94.94-2.48 0-3.42L12 2Z",key:"14b2ls"}],["path",{d:"M7 7h.01",key:"7u93v4"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Yr=de("Target",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ch=de("Timer",[["line",{x1:"10",x2:"14",y1:"2",y2:"2",key:"14vaq8"}],["line",{x1:"12",x2:"15",y1:"14",y2:"11",key:"17fdiu"}],["circle",{cx:"12",cy:"14",r:"8",key:"1e1u0o"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const At=de("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pr=de("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tn=de("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Cs=de("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Op=de("Wallet2",[["path",{d:"M17 14h.01",key:"7oqj8z"}],["path",{d:"M7 7h12a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h14",key:"u1rqew"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vp=de("Wallet",[["path",{d:"M21 12V7H5a2 2 0 0 1 0-4h14v4",key:"195gfw"}],["path",{d:"M3 5v14a2 2 0 0 0 2 2h16v-5",key:"195n9w"}],["path",{d:"M18 12a2 2 0 0 0 0 4h4v-4Z",key:"vllfpd"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yo=de("Wand2",[["path",{d:"m21.64 3.64-1.28-1.28a1.21 1.21 0 0 0-1.72 0L2.36 18.64a1.21 1.21 0 0 0 0 1.72l1.28 1.28a1.2 1.2 0 0 0 1.72 0L21.64 5.36a1.2 1.2 0 0 0 0-1.72Z",key:"1bcowg"}],["path",{d:"m14 7 3 3",key:"1r5n42"}],["path",{d:"M5 6v4",key:"ilb8ba"}],["path",{d:"M19 14v4",key:"blhpug"}],["path",{d:"M10 2v2",key:"7u0qdc"}],["path",{d:"M7 8H3",key:"zfb6yr"}],["path",{d:"M21 16h-4",key:"1cnmox"}],["path",{d:"M11 3H9",key:"1obp7u"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dh=de("XCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qt=de("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ci=de("Zap",[["polygon",{points:"13 2 3 14 12 14 11 22 21 10 12 10 13 2",key:"45s27k"}]]),uh="/assets/logo-D0_tMQfC.png",Lp=()=>{const[r,e]=A.useState("member"),[t,n]=A.useState(""),[a,i]=A.useState(""),[l,c]=A.useState(""),{login:d,user:h,isAuthenticated:g}=Dt(),{theme:x,toggleTheme:p}=ct(),{activateAdmin:E}=Bt(),j=Gu(),[S]=g0();A.useEffect(()=>{document.body.classList.toggle("dark",x==="dark")},[x]),A.useEffect(()=>{var M,T,O;if(g&&h){j("/management");return}if((M=window.Telegram)!=null&&M.WebApp){window.Telegram.WebApp.ready(),window.Telegram.WebApp.expand();const ie=S.get("tgWebAppData")||window.Telegram.WebApp.initData,I=S.get("login"),N=S.get("password");if(I&&N&&d(I,N)){j("/management");return}if(ie)try{const w=new URLSearchParams(ie).get("user");if(w){const y=JSON.parse(decodeURIComponent(w)).id;sessionStorage.setItem("telegram_user_id",String(y));const G=localStorage.getItem("apevault-auth");if(G)try{const V=JSON.parse(G);if((T=V.state)!=null&&T.user){const F=V.state.user;if(d(F.login,F.password)){j("/management");return}}}catch(V){console.error("Error parsing saved auth:",V)}console.log("Telegram Mini App detected, user ID:",y)}}catch(f){console.error("Error parsing Telegram initData:",f)}const b=(O=window.Telegram.WebApp.initDataUnsafe)==null?void 0:O.user;b&&(sessionStorage.setItem("telegram_user_id",String(b.id)),console.log("Telegram user detected:",b.first_name))}},[S,g,h,j,d]);const k=M=>{if(M.preventDefault(),c(""),!a){c("Пожалуйста, введите пароль");return}if(r==="admin")E(a)?j("/management"):c("Неверный пароль администратора");else{if(!t){c("Пожалуйста, введите логин");return}d(t,a)?j("/management"):c("Неверный логин или пароль")}},L=()=>{p()};return s.jsxs("div",{className:`min-h-screen relative overflow-hidden ${x==="dark"?"bg-[#0b0f17]":"bg-gradient-to-br from-slate-50 via-white to-slate-100"}`,children:[s.jsxs("div",{className:"absolute inset-0 pointer-events-none",children:[s.jsx("div",{className:"absolute -top-24 -left-24 w-[620px] h-[620px] bg-gradient-to-br from-[#4E6E49]/35 via-emerald-400/22 to-transparent blur-[110px]"}),s.jsx("div",{className:"absolute top-[-120px] right-[-180px] w-[780px] h-[780px] bg-gradient-to-bl from-blue-500/24 via-purple-500/22 to-transparent blur-[140px]"}),s.jsx("div",{className:"absolute bottom-[-200px] right-[-80px] w-[620px] h-[620px] bg-gradient-to-tr from-amber-400/18 via-[#4E6E49]/18 to-transparent blur-[120px]"}),s.jsx("div",{className:"floating-grid opacity-75 dark:opacity-45"})]}),s.jsx("div",{className:"relative z-10 max-w-6xl mx-auto px-4 lg:px-6 min-h-screen flex items-center justify-center py-10",children:s.jsxs("div",{className:"glass-panel rounded-[28px] p-4 sm:p-6 md:p-8 border border-white/70 dark:border-white/10 shadow-2xl overflow-hidden w-full",children:[s.jsx("div",{className:"accent-dots"}),s.jsxs("div",{className:"relative z-10 grid md:grid-cols-[1.05fr_0.95fr] gap-6 lg:gap-8 items-stretch",children:[s.jsxs("div",{className:"section-card rounded-2xl p-6 lg:p-7 border border-white/60 dark:border-white/10 shadow-xl flex flex-col items-center text-center gap-4",children:[s.jsx("div",{className:"p-4 rounded-2xl bg-white/80 dark:bg-white/5 border border-white/50 dark:border-white/10 shadow-lg",children:s.jsx("img",{src:uh,alt:"ApeVault Logo",className:"w-16 h-16 object-contain"})}),s.jsxs("div",{className:"space-y-1",children:[s.jsx("p",{className:`text-xs uppercase tracking-[0.16em] ${x==="dark"?"text-gray-400":"text-gray-500"}`,children:"ApeVault Black Ops"}),s.jsx("h1",{className:`text-3xl lg:text-4xl font-extrabold ${x==="dark"?"text-white":"text-gray-900"}`,children:"Командная панель"})]}),s.jsxs("div",{className:"inline-flex items-center gap-2 px-3 py-1 rounded-full bg-gradient-to-r from-[#4E6E49]/15 to-emerald-500/10 text-[#4E6E49] text-xs font-semibold",children:[s.jsx(Lt,{className:"w-4 h-4"}),"Защищенный доступ"]}),s.jsxs("div",{className:`w-full mt-4 rounded-xl border ${x==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white/80"} p-4 text-left space-y-3`,children:[s.jsxs("div",{className:"flex items-center gap-2 text-sm font-semibold",children:[s.jsx(Lt,{className:"w-4 h-4 text-[#4E6E49]"}),s.jsx("span",{className:x==="dark"?"text-white":"text-gray-900",children:"Правила и доступ"})]}),s.jsxs("ul",{className:`text-xs leading-relaxed space-y-1 ${x==="dark"?"text-gray-300":"text-gray-700"}`,children:[s.jsx("li",{children:"• Пользуемся данными из бота: логин + пароль."}),s.jsx("li",{children:"• Админ пароль: только для доверенных (режим администратора)."}),s.jsxs("li",{children:["• Правила: ",s.jsx("a",{className:"text-[#4E6E49] font-semibold",href:"https://telegra.ph/Reglament-provedeniya-torgovyh-sessij-pravila-soobshchestva-ApeVault-dlya-trejderov-i-kollerov-11-20",target:"_blank",rel:"noreferrer",children:"читать"}),"."]})]}),s.jsxs("div",{className:`text-xs ${x==="dark"?"text-gray-400":"text-gray-600"}`,children:["Администратор: ",s.jsx("span",{className:"font-semibold",children:"@artyommedoed"})]})]})]}),s.jsxs("div",{className:"section-card rounded-2xl p-6 lg:p-7 border border-white/60 dark:border-white/10 shadow-xl",children:[s.jsxs("div",{className:"flex items-center justify-between mb-6",children:[s.jsxs("div",{children:[s.jsx("p",{className:`text-xs uppercase tracking-[0.12em] ${x==="dark"?"text-gray-400":"text-gray-500"}`,children:"Доступ"}),s.jsx("h2",{className:`text-2xl font-extrabold ${x==="dark"?"text-white":"text-gray-900"}`,children:"Вход в систему"})]}),s.jsx("button",{onClick:L,className:"nav-chip px-3 py-2","data-active":"false","aria-label":"Toggle theme",children:x==="dark"?s.jsx(lh,{className:"w-5 h-5 text-amber-300"}):s.jsx(xl,{className:"w-5 h-5 text-gray-700"})})]}),s.jsxs("form",{onSubmit:k,className:"space-y-5",children:[s.jsxs("div",{children:[s.jsx("label",{className:`block text-sm font-semibold mb-3 ${x==="dark"?"text-gray-300":"text-gray-700"}`,children:"Тип пользователя"}),s.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[s.jsxs("button",{type:"button",onClick:()=>{e("member"),n(""),i(""),c("")},className:"pill justify-center","data-active":r==="member",children:[s.jsx(Cs,{className:"w-5 h-5"}),s.jsx("span",{children:"Участник"})]}),s.jsxs("button",{type:"button",onClick:()=>{e("admin"),n(""),i(""),c("")},className:"pill justify-center","data-active":r==="admin",children:[s.jsx(Lt,{className:"w-5 h-5"}),s.jsx("span",{children:"Админ"})]})]})]}),r==="member"&&s.jsxs("div",{children:[s.jsxs("label",{htmlFor:"login",className:`block text-sm font-semibold mb-2 ${x==="dark"?"text-gray-300":"text-gray-700"}`,children:[s.jsx(tn,{className:"w-4 h-4 inline mr-2"}),"Логин"]}),s.jsx("div",{className:"flex items-center gap-2",children:s.jsx("input",{id:"login",type:"text",value:t,onChange:M=>n(M.target.value),className:`w-full px-4 py-3 rounded-xl border transition-all ${x==="dark"?"bg-white/5 border-white/10 text-white placeholder-gray-500 focus:border-[#4E6E49]":"bg-white border-gray-300 text-gray-900 placeholder-gray-400 focus:border-[#4E6E49]"} focus:outline-none focus:ring-4 focus:ring-[#4E6E49]/20`,placeholder:"Введите ваш логин",autoComplete:"username"})})]}),s.jsxs("div",{children:[s.jsxs("label",{htmlFor:"password",className:`block text-sm font-semibold mb-2 ${x==="dark"?"text-gray-300":"text-gray-700"}`,children:[s.jsx(Lt,{className:"w-4 h-4 inline mr-2"}),"Пароль"]}),s.jsx("input",{id:"password",type:"password",value:a,onChange:M=>i(M.target.value),className:`w-full px-4 py-3 rounded-xl border transition-all ${x==="dark"?"bg-white/5 border-white/10 text-white placeholder-gray-500 focus:border-[#4E6E49]":"bg-white border-gray-300 text-gray-900 placeholder-gray-400 focus:border-[#4E6E49]"} focus:outline-none focus:ring-4 focus:ring-[#4E6E49]/20`,placeholder:r==="admin"?"Введите пароль администратора":"Введите ваш пароль",autoComplete:r==="admin"?"off":"current-password"}),r==="admin"&&s.jsx("p",{className:`mt-2 text-xs ${x==="dark"?"text-gray-400":"text-gray-500"}`,children:"Для входа в режим администратора требуется специальный пароль"})]}),l&&s.jsx("div",{className:`p-4 rounded-xl border ${x==="dark"?"bg-red-500/15 border-red-500/40 text-red-300":"bg-red-50 border-red-300 text-red-700"} text-sm font-semibold animate-shake`,children:l}),s.jsx("button",{type:"submit",className:"w-full py-3 px-4 rounded-xl font-bold text-lg shadow-lg hover:shadow-xl transform hover:-translate-y-0.5 transition-all bg-gradient-to-r from-[#4E6E49] to-[#4E6E49] text-white",children:"Войти в систему"})]}),s.jsxs("div",{className:`mt-6 pt-6 border-t ${x==="dark"?"border-white/10":"border-gray-200"} flex items-center justify-between gap-3 flex-wrap`,children:[s.jsx("div",{className:`text-xs ${x==="dark"?"text-gray-400":"text-gray-600"}`,children:"Защищенная система для команды ApeVault"}),s.jsxs("button",{type:"button",onClick:()=>j("/faq"),className:"inline-flex items-center gap-2 px-3 py-2 rounded-lg text-xs font-semibold border border-transparent bg-white/70 hover:bg-white shadow-sm transition-colors dark:bg-white/10 dark:hover:bg-white/20 dark:text-white text-gray-800",children:[s.jsx(sh,{className:"w-4 h-4"}),"FAQ",s.jsx(kt,{className:"w-3.5 h-3.5 opacity-80"})]})]})]})]})]})})]})},ir=({children:r})=>{const{theme:e,toggleTheme:t}=ct(),{isAdmin:n}=Bt(),a=p0(),[i,l]=A.useState(!1),[c,d]=A.useState(!1),h=[{path:"/management",label:"Расписание",icon:br},{path:"/earnings",label:"Заработок",icon:na},{path:"/tasks",label:"Задачи",icon:ss},{path:"/rating",label:"Рейтинг",icon:Pr}],g=[{path:"/faq",label:"FAQ",icon:rr},{path:"/about",label:"О сообществе",icon:rr}],x=h.some(j=>a.pathname===j.path),p=j=>a.pathname===j,E=g.some(j=>a.pathname===j.path);return A.useEffect(()=>{l(!1),d(!1)},[a.pathname]),s.jsxs("div",{className:"app-shell",children:[s.jsxs("div",{className:"absolute inset-0 pointer-events-none -z-10 overflow-hidden",children:[s.jsx("div",{className:"absolute -top-24 -left-12 w-80 h-80 bg-gradient-to-br from-[#4E6E49]/25 via-transparent to-transparent blur-3xl"}),s.jsx("div",{className:"absolute top-8 right-0 w-[520px] h-[520px] bg-gradient-to-bl from-blue-500/12 via-purple-500/10 to-transparent blur-3xl"}),s.jsx("div",{className:"absolute bottom-[-120px] left-12 w-96 h-96 bg-gradient-to-tr from-amber-400/10 to-[#4E6E49]/12 blur-3xl"}),s.jsx("div",{className:"floating-grid"})]}),s.jsx("header",{className:"sticky top-0 z-50 backdrop-blur-md",children:s.jsx("div",{className:"max-w-7xl mx-auto px-4 lg:px-6 pt-4 pb-2",children:s.jsxs("div",{className:"glass-panel rounded-2xl px-4 lg:px-6 py-3 flex items-center gap-4 shadow-2xl",children:[s.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[s.jsxs("div",{className:"relative w-12 h-12 rounded-2xl bg-white/80 dark:bg-white/5 border border-white/50 dark:border-white/10 shadow-lg overflow-hidden flex items-center justify-center",children:[s.jsx("img",{src:uh,alt:"ApeVault Logo",className:"w-10 h-10 object-contain"}),s.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-white/20 to-transparent dark:from-white/5"})]}),s.jsxs("div",{className:"leading-tight",children:[s.jsx("p",{className:`text-xs uppercase tracking-[0.16em] ${e==="dark"?"text-gray-400":"text-gray-500"}`,children:"ApeVault Black Ops"}),s.jsx("p",{className:`text-xl font-extrabold ${e==="dark"?"text-white":"text-gray-900"}`,children:"Панель команды"})]})]}),s.jsxs("nav",{className:"hidden lg:flex items-center gap-2 flex-1 justify-center",children:[s.jsxs(Ir,{to:"/call","data-active":a.pathname==="/call",className:"nav-chip",children:[s.jsx(ci,{className:"w-4 h-4"}),s.jsx("span",{children:"HUB"}),s.jsx(kt,{className:"w-4 h-4 opacity-70"})]}),s.jsxs("div",{className:"relative",children:[s.jsxs("button",{onClick:()=>{l(!i),d(!1)},"data-active":x,className:"nav-chip",children:[s.jsx(ud,{className:"w-4 h-4"}),s.jsx("span",{children:"Функционал"}),s.jsx(Dn,{className:`w-4 h-4 transition-transform ${i?"rotate-180":""}`})]}),i&&s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"fixed inset-0 z-40",onClick:()=>l(!1)}),s.jsxs("div",{className:"absolute top-[calc(100%+12px)] left-0 min-w-[220px] glass-panel rounded-2xl border border-white/40 dark:border-white/10 shadow-2xl z-50 overflow-hidden",children:[s.jsx("div",{className:"accent-dots"}),s.jsx("div",{className:"relative z-10 divide-y divide-gray-100/60 dark:divide-white/5",children:h.map(j=>s.jsxs(Ir,{to:j.path,onClick:()=>l(!1),className:`flex items-center gap-3 px-4 py-3 transition-colors ${p(j.path)?"bg-gradient-to-r from-[#4E6E49]/15 to-[#4E6E49]/5 text-[#4E6E49] dark:from-[#4E6E49]/20 dark:text-[#4E6E49]":e==="dark"?"hover:bg-white/5 text-gray-200":"hover:bg-gray-50 text-gray-800"}`,children:[s.jsx(j.icon,{className:"w-4 h-4 flex-shrink-0"}),s.jsx("span",{className:"font-semibold flex-1",children:j.label}),s.jsx(kt,{className:"w-4 h-4 opacity-70"})]},j.path))})]})]})]}),s.jsxs("div",{className:"relative",children:[s.jsxs("button",{onClick:()=>{d(!c),l(!1)},"data-active":E,className:"nav-chip",children:[s.jsx(rr,{className:"w-4 h-4"}),s.jsx("span",{children:"О нас"}),s.jsx(Dn,{className:`w-4 h-4 transition-transform ${c?"rotate-180":""}`})]}),c&&s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"fixed inset-0 z-40",onClick:()=>d(!1)}),s.jsxs("div",{className:"absolute top-[calc(100%+12px)] left-0 min-w-[220px] glass-panel rounded-2xl border border-white/40 dark:border-white/10 shadow-2xl z-50 overflow-hidden",children:[s.jsx("div",{className:"accent-dots"}),s.jsx("div",{className:"relative z-10 divide-y divide-gray-100/60 dark:divide-white/5",children:g.map(j=>s.jsxs(Ir,{to:j.path,onClick:()=>d(!1),className:`flex items-center gap-3 px-4 py-3 transition-colors ${a.pathname===j.path?"bg-gradient-to-r from-[#4E6E49]/15 to-[#4E6E49]/5 text-[#4E6E49] dark:from-[#4E6E49]/20 dark:text-[#4E6E49]":e==="dark"?"hover:bg-white/5 text-gray-200":"hover:bg-gray-50 text-gray-800"}`,children:[j.icon&&s.jsx(j.icon,{className:"w-4 h-4 flex-shrink-0"}),s.jsx("span",{className:"font-semibold flex-1",children:j.label}),s.jsx(kt,{className:"w-4 h-4 opacity-70"})]},j.path))})]})]})]}),s.jsxs(Ir,{to:"/profile","data-active":a.pathname==="/profile",className:"nav-chip",children:[s.jsx(tn,{className:"w-4 h-4"}),s.jsx("span",{children:"ЛК"}),s.jsx(kt,{className:"w-4 h-4 opacity-70"})]}),n&&s.jsxs(Ir,{to:"/admin","data-active":a.pathname==="/admin",className:"nav-chip",children:[s.jsx(Lt,{className:"w-4 h-4"}),s.jsx("span",{children:"Админ"}),s.jsx(kt,{className:"w-4 h-4 opacity-70"})]})]}),s.jsxs("div",{className:"flex items-center gap-3 ml-auto",children:[n&&s.jsxs("div",{className:"badge-glow px-3 py-2 rounded-xl bg-gradient-to-r from-purple-600 to-blue-600 text-white font-semibold shadow-lg hidden md:inline-flex items-center gap-2",children:[s.jsx(Lt,{className:"w-4 h-4"}),s.jsx("span",{className:"text-sm",children:"Админ"})]}),s.jsx("button",{onClick:t,className:"nav-chip px-3 py-2","data-active":"false","aria-label":"Toggle theme",children:e==="dark"?s.jsx(lh,{className:"w-5 h-5 text-amber-300"}):s.jsx(xl,{className:"w-5 h-5 text-gray-700"})})]})]})})}),s.jsx("main",{className:"page-shell",children:r}),s.jsx("nav",{className:"lg:hidden fixed bottom-4 left-0 right-0 px-3 z-50",children:s.jsx("div",{className:"max-w-5xl mx-auto",children:s.jsx("div",{className:"glass-panel rounded-2xl shadow-2xl border border-white/60 dark:border-white/10",children:s.jsxs("div",{className:"grid grid-cols-4 divide-x divide-white/40 dark:divide-white/5",children:[s.jsxs(Ir,{to:"/call",className:`flex flex-col items-center justify-center gap-1 py-3 ${a.pathname==="/call"?"text-[#4E6E49]":e==="dark"?"text-gray-300":"text-gray-700"}`,children:[s.jsx(ci,{className:"w-5 h-5"}),s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx("span",{className:"text-[11px] font-semibold",children:"HUB"}),s.jsx(kt,{className:"w-3 h-3 opacity-70"})]})]}),s.jsxs("button",{onClick:()=>{l(!i),d(!1)},className:`flex flex-col items-center justify-center gap-1 py-3 ${x?"text-[#4E6E49]":e==="dark"?"text-gray-300":"text-gray-700"}`,children:[s.jsx(ud,{className:"w-5 h-5"}),s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx("span",{className:"text-[11px] font-semibold",children:"Функционал"}),s.jsx(Dn,{className:"w-3 h-3 opacity-70"})]})]}),s.jsxs("button",{onClick:()=>{d(!c),l(!1)},className:`flex flex-col items-center justify-center gap-1 py-3 ${E?"text-[#4E6E49]":e==="dark"?"text-gray-300":"text-gray-700"}`,children:[s.jsx(rr,{className:"w-5 h-5"}),s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx("span",{className:"text-[11px] font-semibold",children:"О нас"}),s.jsx(Dn,{className:"w-3 h-3 opacity-70"})]})]}),s.jsxs(Ir,{to:"/profile",className:`flex flex-col items-center justify-center gap-1 py-3 ${a.pathname==="/profile"?"text-[#4E6E49]":e==="dark"?"text-gray-300":"text-gray-700"}`,children:[s.jsx(tn,{className:"w-5 h-5"}),s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx("span",{className:"text-[11px] font-semibold",children:"ЛК"}),s.jsx(kt,{className:"w-3 h-3 opacity-70"})]})]})]})})})}),i&&s.jsx("div",{className:"lg:hidden fixed inset-0 z-40 bg-black/40 backdrop-blur-sm",onClick:()=>l(!1),children:s.jsxs("div",{className:"absolute bottom-24 left-1/2 -translate-x-1/2 w-[88%] max-w-sm glass-panel rounded-2xl shadow-2xl border border-white/50 dark:border-white/10 overflow-hidden",children:[s.jsx("div",{className:"accent-dots"}),s.jsx("div",{className:"relative z-10 divide-y divide-gray-100/60 dark:divide-white/5",children:h.map(j=>s.jsxs(Ir,{to:j.path,onClick:()=>l(!1),className:`flex items-center gap-3 px-4 py-3 transition-colors ${p(j.path)?"bg-gradient-to-r from-[#4E6E49]/15 to-[#4E6E49]/5 text-[#4E6E49] dark:from-[#4E6E49]/20 dark:text-[#4E6E49]":e==="dark"?"hover:bg-white/5 text-gray-200":"hover:bg-gray-50 text-gray-800"}`,children:[s.jsx(j.icon,{className:"w-4 h-4 flex-shrink-0"}),s.jsx("span",{className:"font-semibold flex-1",children:j.label}),s.jsx(kt,{className:"w-4 h-4 opacity-70"})]},j.path))})]})}),c&&s.jsx("div",{className:"lg:hidden fixed inset-0 z-40 bg-black/40 backdrop-blur-sm",onClick:()=>d(!1),children:s.jsxs("div",{className:"absolute bottom-24 left-1/2 -translate-x-1/2 w-[88%] max-w-sm glass-panel rounded-2xl shadow-2xl border border-white/50 dark:border-white/10 overflow-hidden",children:[s.jsx("div",{className:"accent-dots"}),s.jsx("div",{className:"relative z-10 divide-y divide-gray-100/60 dark:divide-white/5",children:g.map(j=>s.jsxs(Ir,{to:j.path,onClick:()=>d(!1),className:`flex items-center gap-3 px-4 py-3 transition-colors ${a.pathname===j.path?"bg-gradient-to-r from-[#4E6E49]/15 to-[#4E6E49]/5 text-[#4E6E49] dark:from-[#4E6E49]/20 dark:text-[#4E6E49]":e==="dark"?"hover:bg-white/5 text-gray-200":"hover:bg-gray-50 text-gray-800"}`,children:[j.icon&&s.jsx(j.icon,{className:"w-4 h-4 flex-shrink-0"}),s.jsx("span",{className:"font-semibold flex-1",children:j.label}),s.jsx(kt,{className:"w-4 h-4 opacity-70"})]},j.path))})]})})]})};var md={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hh=function(r){const e=[];let t=0;for(let n=0;n<r.length;n++){let a=r.charCodeAt(n);a<128?e[t++]=a:a<2048?(e[t++]=a>>6|192,e[t++]=a&63|128):(a&64512)===55296&&n+1<r.length&&(r.charCodeAt(n+1)&64512)===56320?(a=65536+((a&1023)<<10)+(r.charCodeAt(++n)&1023),e[t++]=a>>18|240,e[t++]=a>>12&63|128,e[t++]=a>>6&63|128,e[t++]=a&63|128):(e[t++]=a>>12|224,e[t++]=a>>6&63|128,e[t++]=a&63|128)}return e},Fp=function(r){const e=[];let t=0,n=0;for(;t<r.length;){const a=r[t++];if(a<128)e[n++]=String.fromCharCode(a);else if(a>191&&a<224){const i=r[t++];e[n++]=String.fromCharCode((a&31)<<6|i&63)}else if(a>239&&a<365){const i=r[t++],l=r[t++],c=r[t++],d=((a&7)<<18|(i&63)<<12|(l&63)<<6|c&63)-65536;e[n++]=String.fromCharCode(55296+(d>>10)),e[n++]=String.fromCharCode(56320+(d&1023))}else{const i=r[t++],l=r[t++];e[n++]=String.fromCharCode((a&15)<<12|(i&63)<<6|l&63)}}return e.join("")},mh={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(r,e){if(!Array.isArray(r))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,n=[];for(let a=0;a<r.length;a+=3){const i=r[a],l=a+1<r.length,c=l?r[a+1]:0,d=a+2<r.length,h=d?r[a+2]:0,g=i>>2,x=(i&3)<<4|c>>4;let p=(c&15)<<2|h>>6,E=h&63;d||(E=64,l||(p=64)),n.push(t[g],t[x],t[p],t[E])}return n.join("")},encodeString(r,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(r):this.encodeByteArray(hh(r),e)},decodeString(r,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(r):Fp(this.decodeStringToByteArray(r,e))},decodeStringToByteArray(r,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,n=[];for(let a=0;a<r.length;){const i=t[r.charAt(a++)],c=a<r.length?t[r.charAt(a)]:0;++a;const h=a<r.length?t[r.charAt(a)]:64;++a;const x=a<r.length?t[r.charAt(a)]:64;if(++a,i==null||c==null||h==null||x==null)throw new Up;const p=i<<2|c>>4;if(n.push(p),h!==64){const E=c<<4&240|h>>2;if(n.push(E),x!==64){const j=h<<6&192|x;n.push(j)}}}return n},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let r=0;r<this.ENCODED_VALS.length;r++)this.byteToCharMap_[r]=this.ENCODED_VALS.charAt(r),this.charToByteMap_[this.byteToCharMap_[r]]=r,this.byteToCharMapWebSafe_[r]=this.ENCODED_VALS_WEBSAFE.charAt(r),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[r]]=r,r>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(r)]=r,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(r)]=r)}}};class Up extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const Bp=function(r){const e=hh(r);return mh.encodeByteArray(e,!0)},di=function(r){return Bp(r).replace(/\./g,"")},gh=function(r){try{return mh.decodeString(r,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qp(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Wp=()=>qp().__FIREBASE_DEFAULTS__,zp=()=>{if(typeof process>"u"||typeof md>"u")return;const r=md.__FIREBASE_DEFAULTS__;if(r)return JSON.parse(r)},Hp=()=>{if(typeof document>"u")return;let r;try{r=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=r&&gh(r[1]);return e&&JSON.parse(e)},$i=()=>{try{return Wp()||zp()||Hp()}catch(r){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${r}`);return}},ph=r=>{var e,t;return(t=(e=$i())===null||e===void 0?void 0:e.emulatorHosts)===null||t===void 0?void 0:t[r]},fh=r=>{const e=ph(r);if(!e)return;const t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const n=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),n]:[e.substring(0,t),n]},xh=()=>{var r;return(r=$i())===null||r===void 0?void 0:r.config},yh=r=>{var e;return(e=$i())===null||e===void 0?void 0:e[`_${r}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gp{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,n)=>{t?this.reject(t):this.resolve(n),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,n))}}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bh(r,e){if(r.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const t={alg:"none",type:"JWT"},n=e||"demo-project",a=r.iat||0,i=r.sub||r.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const l=Object.assign({iss:`https://securetoken.google.com/${n}`,aud:n,iat:a,exp:a+3600,auth_time:a,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}}},r);return[di(JSON.stringify(t)),di(JSON.stringify(l)),""].join(".")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ft(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function Kp(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Ft())}function Qp(){var r;const e=(r=$i())===null||r===void 0?void 0:r.forceEnvironment;if(e==="node")return!0;if(e==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function Yp(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function Xp(){const r=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof r=="object"&&r.id!==void 0}function Jp(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function Zp(){const r=Ft();return r.indexOf("MSIE ")>=0||r.indexOf("Trident/")>=0}function ef(){return!Qp()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function tf(){try{return typeof indexedDB=="object"}catch{return!1}}function rf(){return new Promise((r,e)=>{try{let t=!0;const n="validate-browser-context-for-indexeddb-analytics-module",a=self.indexedDB.open(n);a.onsuccess=()=>{a.result.close(),t||self.indexedDB.deleteDatabase(n),r(!0)},a.onupgradeneeded=()=>{t=!1},a.onerror=()=>{var i;e(((i=a.error)===null||i===void 0?void 0:i.message)||"")}}catch(t){e(t)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sf="FirebaseError";class kr extends Error{constructor(e,t,n){super(t),this.code=e,this.customData=n,this.name=sf,Object.setPrototypeOf(this,kr.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,la.prototype.create)}}class la{constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(e,...t){const n=t[0]||{},a=`${this.service}/${e}`,i=this.errors[e],l=i?nf(i,n):"Error",c=`${this.serviceName}: ${l} (${a}).`;return new kr(a,c,n)}}function nf(r,e){return r.replace(af,(t,n)=>{const a=e[n];return a!=null?String(a):`<${n}?>`})}const af=/\{\$([^}]+)}/g;function of(r){for(const e in r)if(Object.prototype.hasOwnProperty.call(r,e))return!1;return!0}function ui(r,e){if(r===e)return!0;const t=Object.keys(r),n=Object.keys(e);for(const a of t){if(!n.includes(a))return!1;const i=r[a],l=e[a];if(gd(i)&&gd(l)){if(!ui(i,l))return!1}else if(i!==l)return!1}for(const a of n)if(!t.includes(a))return!1;return!0}function gd(r){return r!==null&&typeof r=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ca(r){const e=[];for(const[t,n]of Object.entries(r))Array.isArray(n)?n.forEach(a=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(a))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(n));return e.length?"&"+e.join("&"):""}function lf(r,e){const t=new cf(r,e);return t.subscribe.bind(t)}class cf{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(n=>{this.error(n)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,n){let a;if(e===void 0&&t===void 0&&n===void 0)throw new Error("Missing Observer.");df(e,["next","error","complete"])?a=e:a={next:e,error:t,complete:n},a.next===void 0&&(a.next=bo),a.error===void 0&&(a.error=bo),a.complete===void 0&&(a.complete=bo);const i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?a.error(this.finalError):a.complete()}catch{}}),this.observers.push(a),i}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(n){typeof console<"u"&&console.error&&console.error(n)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function df(r,e){if(typeof r!="object"||r===null)return!1;for(const t of e)if(t in r&&typeof r[t]=="function")return!0;return!1}function bo(){}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ut(r){return r&&r._delegate?r._delegate:r}class ls{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ys="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uf{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const n=new Gp;if(this.instancesDeferred.set(t,n),this.isInitialized(t)||this.shouldAutoInitialize())try{const a=this.getOrInitializeService({instanceIdentifier:t});a&&n.resolve(a)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const n=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),a=(t=e==null?void 0:e.optional)!==null&&t!==void 0?t:!1;if(this.isInitialized(n)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:n})}catch(i){if(a)return null;throw i}else{if(a)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(mf(e))try{this.getOrInitializeService({instanceIdentifier:ys})}catch{}for(const[t,n]of this.instancesDeferred.entries()){const a=this.normalizeInstanceIdentifier(t);try{const i=this.getOrInitializeService({instanceIdentifier:a});n.resolve(i)}catch{}}}}clearInstance(e=ys){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=ys){return this.instances.has(e)}getOptions(e=ys){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,n=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const a=this.getOrInitializeService({instanceIdentifier:n,options:t});for(const[i,l]of this.instancesDeferred.entries()){const c=this.normalizeInstanceIdentifier(i);n===c&&l.resolve(a)}return a}onInit(e,t){var n;const a=this.normalizeInstanceIdentifier(t),i=(n=this.onInitCallbacks.get(a))!==null&&n!==void 0?n:new Set;i.add(e),this.onInitCallbacks.set(a,i);const l=this.instances.get(a);return l&&e(l,a),()=>{i.delete(e)}}invokeOnInitCallbacks(e,t){const n=this.onInitCallbacks.get(t);if(n)for(const a of n)try{a(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let n=this.instances.get(e);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:hf(e),options:t}),this.instances.set(e,n),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(n,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,n)}catch{}return n||null}normalizeInstanceIdentifier(e=ys){return this.component?this.component.multipleInstances?e:ys:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function hf(r){return r===ys?void 0:r}function mf(r){return r.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gf{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new uf(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Je;(function(r){r[r.DEBUG=0]="DEBUG",r[r.VERBOSE=1]="VERBOSE",r[r.INFO=2]="INFO",r[r.WARN=3]="WARN",r[r.ERROR=4]="ERROR",r[r.SILENT=5]="SILENT"})(Je||(Je={}));const pf={debug:Je.DEBUG,verbose:Je.VERBOSE,info:Je.INFO,warn:Je.WARN,error:Je.ERROR,silent:Je.SILENT},ff=Je.INFO,xf={[Je.DEBUG]:"log",[Je.VERBOSE]:"log",[Je.INFO]:"info",[Je.WARN]:"warn",[Je.ERROR]:"error"},yf=(r,e,...t)=>{if(e<r.logLevel)return;const n=new Date().toISOString(),a=xf[e];if(a)console[a](`[${n}]  ${r.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class yl{constructor(e){this.name=e,this._logLevel=ff,this._logHandler=yf,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in Je))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?pf[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,Je.DEBUG,...e),this._logHandler(this,Je.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,Je.VERBOSE,...e),this._logHandler(this,Je.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,Je.INFO,...e),this._logHandler(this,Je.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,Je.WARN,...e),this._logHandler(this,Je.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,Je.ERROR,...e),this._logHandler(this,Je.ERROR,...e)}}const bf=(r,e)=>e.some(t=>r instanceof t);let pd,fd;function vf(){return pd||(pd=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function wf(){return fd||(fd=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const vh=new WeakMap,Oo=new WeakMap,wh=new WeakMap,vo=new WeakMap,bl=new WeakMap;function _f(r){const e=new Promise((t,n)=>{const a=()=>{r.removeEventListener("success",i),r.removeEventListener("error",l)},i=()=>{t(ns(r.result)),a()},l=()=>{n(r.error),a()};r.addEventListener("success",i),r.addEventListener("error",l)});return e.then(t=>{t instanceof IDBCursor&&vh.set(t,r)}).catch(()=>{}),bl.set(e,r),e}function kf(r){if(Oo.has(r))return;const e=new Promise((t,n)=>{const a=()=>{r.removeEventListener("complete",i),r.removeEventListener("error",l),r.removeEventListener("abort",l)},i=()=>{t(),a()},l=()=>{n(r.error||new DOMException("AbortError","AbortError")),a()};r.addEventListener("complete",i),r.addEventListener("error",l),r.addEventListener("abort",l)});Oo.set(r,e)}let Vo={get(r,e,t){if(r instanceof IDBTransaction){if(e==="done")return Oo.get(r);if(e==="objectStoreNames")return r.objectStoreNames||wh.get(r);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return ns(r[e])},set(r,e,t){return r[e]=t,!0},has(r,e){return r instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in r}};function Nf(r){Vo=r(Vo)}function Ef(r){return r===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const n=r.call(wo(this),e,...t);return wh.set(n,e.sort?e.sort():[e]),ns(n)}:wf().includes(r)?function(...e){return r.apply(wo(this),e),ns(vh.get(this))}:function(...e){return ns(r.apply(wo(this),e))}}function jf(r){return typeof r=="function"?Ef(r):(r instanceof IDBTransaction&&kf(r),bf(r,vf())?new Proxy(r,Vo):r)}function ns(r){if(r instanceof IDBRequest)return _f(r);if(vo.has(r))return vo.get(r);const e=jf(r);return e!==r&&(vo.set(r,e),bl.set(e,r)),e}const wo=r=>bl.get(r);function If(r,e,{blocked:t,upgrade:n,blocking:a,terminated:i}={}){const l=indexedDB.open(r,e),c=ns(l);return n&&l.addEventListener("upgradeneeded",d=>{n(ns(l.result),d.oldVersion,d.newVersion,ns(l.transaction),d)}),t&&l.addEventListener("blocked",d=>t(d.oldVersion,d.newVersion,d)),c.then(d=>{i&&d.addEventListener("close",()=>i()),a&&d.addEventListener("versionchange",h=>a(h.oldVersion,h.newVersion,h))}).catch(()=>{}),c}const Tf=["get","getKey","getAll","getAllKeys","count"],Sf=["put","add","delete","clear"],_o=new Map;function xd(r,e){if(!(r instanceof IDBDatabase&&!(e in r)&&typeof e=="string"))return;if(_o.get(e))return _o.get(e);const t=e.replace(/FromIndex$/,""),n=e!==t,a=Sf.includes(t);if(!(t in(n?IDBIndex:IDBObjectStore).prototype)||!(a||Tf.includes(t)))return;const i=async function(l,...c){const d=this.transaction(l,a?"readwrite":"readonly");let h=d.store;return n&&(h=h.index(c.shift())),(await Promise.all([h[t](...c),a&&d.done]))[0]};return _o.set(e,i),i}Nf(r=>({...r,get:(e,t,n)=>xd(e,t)||r.get(e,t,n),has:(e,t)=>!!xd(e,t)||r.has(e,t)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Af{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(Cf(t)){const n=t.getImmediate();return`${n.library}/${n.version}`}else return null}).filter(t=>t).join(" ")}}function Cf(r){const e=r.getComponent();return(e==null?void 0:e.type)==="VERSION"}const Lo="@firebase/app",yd="0.10.13";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $r=new yl("@firebase/app"),Rf="@firebase/app-compat",Df="@firebase/analytics-compat",Pf="@firebase/analytics",$f="@firebase/app-check-compat",Mf="@firebase/app-check",Of="@firebase/auth",Vf="@firebase/auth-compat",Lf="@firebase/database",Ff="@firebase/data-connect",Uf="@firebase/database-compat",Bf="@firebase/functions",qf="@firebase/functions-compat",Wf="@firebase/installations",zf="@firebase/installations-compat",Hf="@firebase/messaging",Gf="@firebase/messaging-compat",Kf="@firebase/performance",Qf="@firebase/performance-compat",Yf="@firebase/remote-config",Xf="@firebase/remote-config-compat",Jf="@firebase/storage",Zf="@firebase/storage-compat",ex="@firebase/firestore",tx="@firebase/vertexai-preview",rx="@firebase/firestore-compat",sx="firebase",nx="10.14.1";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Fo="[DEFAULT]",ax={[Lo]:"fire-core",[Rf]:"fire-core-compat",[Pf]:"fire-analytics",[Df]:"fire-analytics-compat",[Mf]:"fire-app-check",[$f]:"fire-app-check-compat",[Of]:"fire-auth",[Vf]:"fire-auth-compat",[Lf]:"fire-rtdb",[Ff]:"fire-data-connect",[Uf]:"fire-rtdb-compat",[Bf]:"fire-fn",[qf]:"fire-fn-compat",[Wf]:"fire-iid",[zf]:"fire-iid-compat",[Hf]:"fire-fcm",[Gf]:"fire-fcm-compat",[Kf]:"fire-perf",[Qf]:"fire-perf-compat",[Yf]:"fire-rc",[Xf]:"fire-rc-compat",[Jf]:"fire-gcs",[Zf]:"fire-gcs-compat",[ex]:"fire-fst",[rx]:"fire-fst-compat",[tx]:"fire-vertex","fire-js":"fire-js",[sx]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hi=new Map,ix=new Map,Uo=new Map;function bd(r,e){try{r.container.addComponent(e)}catch(t){$r.debug(`Component ${e.name} failed to register with FirebaseApp ${r.name}`,t)}}function Es(r){const e=r.name;if(Uo.has(e))return $r.debug(`There were multiple attempts to register component ${e}.`),!1;Uo.set(e,r);for(const t of hi.values())bd(t,r);for(const t of ix.values())bd(t,r);return!0}function Mi(r,e){const t=r.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),r.container.getProvider(e)}function ts(r){return r.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ox={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},as=new la("app","Firebase",ox);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lx{constructor(e,t,n){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new ls("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw as.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Rs=nx;function _h(r,e={}){let t=r;typeof e!="object"&&(e={name:e});const n=Object.assign({name:Fo,automaticDataCollectionEnabled:!1},e),a=n.name;if(typeof a!="string"||!a)throw as.create("bad-app-name",{appName:String(a)});if(t||(t=xh()),!t)throw as.create("no-options");const i=hi.get(a);if(i){if(ui(t,i.options)&&ui(n,i.config))return i;throw as.create("duplicate-app",{appName:a})}const l=new gf(a);for(const d of Uo.values())l.addComponent(d);const c=new lx(t,n,l);return hi.set(a,c),c}function vl(r=Fo){const e=hi.get(r);if(!e&&r===Fo&&xh())return _h();if(!e)throw as.create("no-app",{appName:r});return e}function gr(r,e,t){var n;let a=(n=ax[r])!==null&&n!==void 0?n:r;t&&(a+=`-${t}`);const i=a.match(/\s|\//),l=e.match(/\s|\//);if(i||l){const c=[`Unable to register library "${a}" with version "${e}":`];i&&c.push(`library name "${a}" contains illegal characters (whitespace or "/")`),i&&l&&c.push("and"),l&&c.push(`version name "${e}" contains illegal characters (whitespace or "/")`),$r.warn(c.join(" "));return}Es(new ls(`${a}-version`,()=>({library:a,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cx="firebase-heartbeat-database",dx=1,Hn="firebase-heartbeat-store";let ko=null;function kh(){return ko||(ko=If(cx,dx,{upgrade:(r,e)=>{switch(e){case 0:try{r.createObjectStore(Hn)}catch(t){console.warn(t)}}}}).catch(r=>{throw as.create("idb-open",{originalErrorMessage:r.message})})),ko}async function ux(r){try{const t=(await kh()).transaction(Hn),n=await t.objectStore(Hn).get(Nh(r));return await t.done,n}catch(e){if(e instanceof kr)$r.warn(e.message);else{const t=as.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});$r.warn(t.message)}}}async function vd(r,e){try{const n=(await kh()).transaction(Hn,"readwrite");await n.objectStore(Hn).put(e,Nh(r)),await n.done}catch(t){if(t instanceof kr)$r.warn(t.message);else{const n=as.create("idb-set",{originalErrorMessage:t==null?void 0:t.message});$r.warn(n.message)}}}function Nh(r){return`${r.name}!${r.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hx=1024,mx=30*24*60*60*1e3;class gx{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new fx(t),this._heartbeatsCachePromise=this._storage.read().then(n=>(this._heartbeatsCache=n,n))}async triggerHeartbeat(){var e,t;try{const a=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),i=wd();return((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===i||this._heartbeatsCache.heartbeats.some(l=>l.date===i)?void 0:(this._heartbeatsCache.heartbeats.push({date:i,agent:a}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(l=>{const c=new Date(l.date).valueOf();return Date.now()-c<=mx}),this._storage.overwrite(this._heartbeatsCache))}catch(n){$r.warn(n)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const t=wd(),{heartbeatsToSend:n,unsentEntries:a}=px(this._heartbeatsCache.heartbeats),i=di(JSON.stringify({version:2,heartbeats:n}));return this._heartbeatsCache.lastSentHeartbeatDate=t,a.length>0?(this._heartbeatsCache.heartbeats=a,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(t){return $r.warn(t),""}}}function wd(){return new Date().toISOString().substring(0,10)}function px(r,e=hx){const t=[];let n=r.slice();for(const a of r){const i=t.find(l=>l.agent===a.agent);if(i){if(i.dates.push(a.date),_d(t)>e){i.dates.pop();break}}else if(t.push({agent:a.agent,dates:[a.date]}),_d(t)>e){t.pop();break}n=n.slice(1)}return{heartbeatsToSend:t,unsentEntries:n}}class fx{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return tf()?rf().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const t=await ux(this.app);return t!=null&&t.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){const a=await this.read();return vd(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:a.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){var t;if(await this._canUseIndexedDBPromise){const a=await this.read();return vd(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:a.lastSentHeartbeatDate,heartbeats:[...a.heartbeats,...e.heartbeats]})}else return}}function _d(r){return di(JSON.stringify({version:2,heartbeats:r})).length}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xx(r){Es(new ls("platform-logger",e=>new Af(e),"PRIVATE")),Es(new ls("heartbeat",e=>new gx(e),"PRIVATE")),gr(Lo,yd,r),gr(Lo,yd,"esm2017"),gr("fire-js","")}xx("");var kd=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var ks,Eh;(function(){var r;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(I,N){function b(){}b.prototype=N.prototype,I.D=N.prototype,I.prototype=new b,I.prototype.constructor=I,I.C=function(f,w,_){for(var y=Array(arguments.length-2),G=2;G<arguments.length;G++)y[G-2]=arguments[G];return N.prototype[w].apply(f,y)}}function t(){this.blockSize=-1}function n(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(n,t),n.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function a(I,N,b){b||(b=0);var f=Array(16);if(typeof N=="string")for(var w=0;16>w;++w)f[w]=N.charCodeAt(b++)|N.charCodeAt(b++)<<8|N.charCodeAt(b++)<<16|N.charCodeAt(b++)<<24;else for(w=0;16>w;++w)f[w]=N[b++]|N[b++]<<8|N[b++]<<16|N[b++]<<24;N=I.g[0],b=I.g[1],w=I.g[2];var _=I.g[3],y=N+(_^b&(w^_))+f[0]+3614090360&4294967295;N=b+(y<<7&4294967295|y>>>25),y=_+(w^N&(b^w))+f[1]+3905402710&4294967295,_=N+(y<<12&4294967295|y>>>20),y=w+(b^_&(N^b))+f[2]+606105819&4294967295,w=_+(y<<17&4294967295|y>>>15),y=b+(N^w&(_^N))+f[3]+3250441966&4294967295,b=w+(y<<22&4294967295|y>>>10),y=N+(_^b&(w^_))+f[4]+4118548399&4294967295,N=b+(y<<7&4294967295|y>>>25),y=_+(w^N&(b^w))+f[5]+1200080426&4294967295,_=N+(y<<12&4294967295|y>>>20),y=w+(b^_&(N^b))+f[6]+2821735955&4294967295,w=_+(y<<17&4294967295|y>>>15),y=b+(N^w&(_^N))+f[7]+4249261313&4294967295,b=w+(y<<22&4294967295|y>>>10),y=N+(_^b&(w^_))+f[8]+1770035416&4294967295,N=b+(y<<7&4294967295|y>>>25),y=_+(w^N&(b^w))+f[9]+2336552879&4294967295,_=N+(y<<12&4294967295|y>>>20),y=w+(b^_&(N^b))+f[10]+4294925233&4294967295,w=_+(y<<17&4294967295|y>>>15),y=b+(N^w&(_^N))+f[11]+2304563134&4294967295,b=w+(y<<22&4294967295|y>>>10),y=N+(_^b&(w^_))+f[12]+1804603682&4294967295,N=b+(y<<7&4294967295|y>>>25),y=_+(w^N&(b^w))+f[13]+4254626195&4294967295,_=N+(y<<12&4294967295|y>>>20),y=w+(b^_&(N^b))+f[14]+2792965006&4294967295,w=_+(y<<17&4294967295|y>>>15),y=b+(N^w&(_^N))+f[15]+1236535329&4294967295,b=w+(y<<22&4294967295|y>>>10),y=N+(w^_&(b^w))+f[1]+4129170786&4294967295,N=b+(y<<5&4294967295|y>>>27),y=_+(b^w&(N^b))+f[6]+3225465664&4294967295,_=N+(y<<9&4294967295|y>>>23),y=w+(N^b&(_^N))+f[11]+643717713&4294967295,w=_+(y<<14&4294967295|y>>>18),y=b+(_^N&(w^_))+f[0]+3921069994&4294967295,b=w+(y<<20&4294967295|y>>>12),y=N+(w^_&(b^w))+f[5]+3593408605&4294967295,N=b+(y<<5&4294967295|y>>>27),y=_+(b^w&(N^b))+f[10]+38016083&4294967295,_=N+(y<<9&4294967295|y>>>23),y=w+(N^b&(_^N))+f[15]+3634488961&4294967295,w=_+(y<<14&4294967295|y>>>18),y=b+(_^N&(w^_))+f[4]+3889429448&4294967295,b=w+(y<<20&4294967295|y>>>12),y=N+(w^_&(b^w))+f[9]+568446438&4294967295,N=b+(y<<5&4294967295|y>>>27),y=_+(b^w&(N^b))+f[14]+3275163606&4294967295,_=N+(y<<9&4294967295|y>>>23),y=w+(N^b&(_^N))+f[3]+4107603335&4294967295,w=_+(y<<14&4294967295|y>>>18),y=b+(_^N&(w^_))+f[8]+1163531501&4294967295,b=w+(y<<20&4294967295|y>>>12),y=N+(w^_&(b^w))+f[13]+2850285829&4294967295,N=b+(y<<5&4294967295|y>>>27),y=_+(b^w&(N^b))+f[2]+4243563512&4294967295,_=N+(y<<9&4294967295|y>>>23),y=w+(N^b&(_^N))+f[7]+1735328473&4294967295,w=_+(y<<14&4294967295|y>>>18),y=b+(_^N&(w^_))+f[12]+2368359562&4294967295,b=w+(y<<20&4294967295|y>>>12),y=N+(b^w^_)+f[5]+4294588738&4294967295,N=b+(y<<4&4294967295|y>>>28),y=_+(N^b^w)+f[8]+2272392833&4294967295,_=N+(y<<11&4294967295|y>>>21),y=w+(_^N^b)+f[11]+1839030562&4294967295,w=_+(y<<16&4294967295|y>>>16),y=b+(w^_^N)+f[14]+4259657740&4294967295,b=w+(y<<23&4294967295|y>>>9),y=N+(b^w^_)+f[1]+2763975236&4294967295,N=b+(y<<4&4294967295|y>>>28),y=_+(N^b^w)+f[4]+1272893353&4294967295,_=N+(y<<11&4294967295|y>>>21),y=w+(_^N^b)+f[7]+4139469664&4294967295,w=_+(y<<16&4294967295|y>>>16),y=b+(w^_^N)+f[10]+3200236656&4294967295,b=w+(y<<23&4294967295|y>>>9),y=N+(b^w^_)+f[13]+681279174&4294967295,N=b+(y<<4&4294967295|y>>>28),y=_+(N^b^w)+f[0]+3936430074&4294967295,_=N+(y<<11&4294967295|y>>>21),y=w+(_^N^b)+f[3]+3572445317&4294967295,w=_+(y<<16&4294967295|y>>>16),y=b+(w^_^N)+f[6]+76029189&4294967295,b=w+(y<<23&4294967295|y>>>9),y=N+(b^w^_)+f[9]+3654602809&4294967295,N=b+(y<<4&4294967295|y>>>28),y=_+(N^b^w)+f[12]+3873151461&4294967295,_=N+(y<<11&4294967295|y>>>21),y=w+(_^N^b)+f[15]+530742520&4294967295,w=_+(y<<16&4294967295|y>>>16),y=b+(w^_^N)+f[2]+3299628645&4294967295,b=w+(y<<23&4294967295|y>>>9),y=N+(w^(b|~_))+f[0]+4096336452&4294967295,N=b+(y<<6&4294967295|y>>>26),y=_+(b^(N|~w))+f[7]+1126891415&4294967295,_=N+(y<<10&4294967295|y>>>22),y=w+(N^(_|~b))+f[14]+2878612391&4294967295,w=_+(y<<15&4294967295|y>>>17),y=b+(_^(w|~N))+f[5]+4237533241&4294967295,b=w+(y<<21&4294967295|y>>>11),y=N+(w^(b|~_))+f[12]+1700485571&4294967295,N=b+(y<<6&4294967295|y>>>26),y=_+(b^(N|~w))+f[3]+2399980690&4294967295,_=N+(y<<10&4294967295|y>>>22),y=w+(N^(_|~b))+f[10]+4293915773&4294967295,w=_+(y<<15&4294967295|y>>>17),y=b+(_^(w|~N))+f[1]+2240044497&4294967295,b=w+(y<<21&4294967295|y>>>11),y=N+(w^(b|~_))+f[8]+1873313359&4294967295,N=b+(y<<6&4294967295|y>>>26),y=_+(b^(N|~w))+f[15]+4264355552&4294967295,_=N+(y<<10&4294967295|y>>>22),y=w+(N^(_|~b))+f[6]+2734768916&4294967295,w=_+(y<<15&4294967295|y>>>17),y=b+(_^(w|~N))+f[13]+1309151649&4294967295,b=w+(y<<21&4294967295|y>>>11),y=N+(w^(b|~_))+f[4]+4149444226&4294967295,N=b+(y<<6&4294967295|y>>>26),y=_+(b^(N|~w))+f[11]+3174756917&4294967295,_=N+(y<<10&4294967295|y>>>22),y=w+(N^(_|~b))+f[2]+718787259&4294967295,w=_+(y<<15&4294967295|y>>>17),y=b+(_^(w|~N))+f[9]+3951481745&4294967295,I.g[0]=I.g[0]+N&4294967295,I.g[1]=I.g[1]+(w+(y<<21&4294967295|y>>>11))&4294967295,I.g[2]=I.g[2]+w&4294967295,I.g[3]=I.g[3]+_&4294967295}n.prototype.u=function(I,N){N===void 0&&(N=I.length);for(var b=N-this.blockSize,f=this.B,w=this.h,_=0;_<N;){if(w==0)for(;_<=b;)a(this,I,_),_+=this.blockSize;if(typeof I=="string"){for(;_<N;)if(f[w++]=I.charCodeAt(_++),w==this.blockSize){a(this,f),w=0;break}}else for(;_<N;)if(f[w++]=I[_++],w==this.blockSize){a(this,f),w=0;break}}this.h=w,this.o+=N},n.prototype.v=function(){var I=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);I[0]=128;for(var N=1;N<I.length-8;++N)I[N]=0;var b=8*this.o;for(N=I.length-8;N<I.length;++N)I[N]=b&255,b/=256;for(this.u(I),I=Array(16),N=b=0;4>N;++N)for(var f=0;32>f;f+=8)I[b++]=this.g[N]>>>f&255;return I};function i(I,N){var b=c;return Object.prototype.hasOwnProperty.call(b,I)?b[I]:b[I]=N(I)}function l(I,N){this.h=N;for(var b=[],f=!0,w=I.length-1;0<=w;w--){var _=I[w]|0;f&&_==N||(b[w]=_,f=!1)}this.g=b}var c={};function d(I){return-128<=I&&128>I?i(I,function(N){return new l([N|0],0>N?-1:0)}):new l([I|0],0>I?-1:0)}function h(I){if(isNaN(I)||!isFinite(I))return x;if(0>I)return k(h(-I));for(var N=[],b=1,f=0;I>=b;f++)N[f]=I/b|0,b*=4294967296;return new l(N,0)}function g(I,N){if(I.length==0)throw Error("number format error: empty string");if(N=N||10,2>N||36<N)throw Error("radix out of range: "+N);if(I.charAt(0)=="-")return k(g(I.substring(1),N));if(0<=I.indexOf("-"))throw Error('number format error: interior "-" character');for(var b=h(Math.pow(N,8)),f=x,w=0;w<I.length;w+=8){var _=Math.min(8,I.length-w),y=parseInt(I.substring(w,w+_),N);8>_?(_=h(Math.pow(N,_)),f=f.j(_).add(h(y))):(f=f.j(b),f=f.add(h(y)))}return f}var x=d(0),p=d(1),E=d(16777216);r=l.prototype,r.m=function(){if(S(this))return-k(this).m();for(var I=0,N=1,b=0;b<this.g.length;b++){var f=this.i(b);I+=(0<=f?f:4294967296+f)*N,N*=4294967296}return I},r.toString=function(I){if(I=I||10,2>I||36<I)throw Error("radix out of range: "+I);if(j(this))return"0";if(S(this))return"-"+k(this).toString(I);for(var N=h(Math.pow(I,6)),b=this,f="";;){var w=O(b,N).g;b=L(b,w.j(N));var _=((0<b.g.length?b.g[0]:b.h)>>>0).toString(I);if(b=w,j(b))return _+f;for(;6>_.length;)_="0"+_;f=_+f}},r.i=function(I){return 0>I?0:I<this.g.length?this.g[I]:this.h};function j(I){if(I.h!=0)return!1;for(var N=0;N<I.g.length;N++)if(I.g[N]!=0)return!1;return!0}function S(I){return I.h==-1}r.l=function(I){return I=L(this,I),S(I)?-1:j(I)?0:1};function k(I){for(var N=I.g.length,b=[],f=0;f<N;f++)b[f]=~I.g[f];return new l(b,~I.h).add(p)}r.abs=function(){return S(this)?k(this):this},r.add=function(I){for(var N=Math.max(this.g.length,I.g.length),b=[],f=0,w=0;w<=N;w++){var _=f+(this.i(w)&65535)+(I.i(w)&65535),y=(_>>>16)+(this.i(w)>>>16)+(I.i(w)>>>16);f=y>>>16,_&=65535,y&=65535,b[w]=y<<16|_}return new l(b,b[b.length-1]&-2147483648?-1:0)};function L(I,N){return I.add(k(N))}r.j=function(I){if(j(this)||j(I))return x;if(S(this))return S(I)?k(this).j(k(I)):k(k(this).j(I));if(S(I))return k(this.j(k(I)));if(0>this.l(E)&&0>I.l(E))return h(this.m()*I.m());for(var N=this.g.length+I.g.length,b=[],f=0;f<2*N;f++)b[f]=0;for(f=0;f<this.g.length;f++)for(var w=0;w<I.g.length;w++){var _=this.i(f)>>>16,y=this.i(f)&65535,G=I.i(w)>>>16,V=I.i(w)&65535;b[2*f+2*w]+=y*V,M(b,2*f+2*w),b[2*f+2*w+1]+=_*V,M(b,2*f+2*w+1),b[2*f+2*w+1]+=y*G,M(b,2*f+2*w+1),b[2*f+2*w+2]+=_*G,M(b,2*f+2*w+2)}for(f=0;f<N;f++)b[f]=b[2*f+1]<<16|b[2*f];for(f=N;f<2*N;f++)b[f]=0;return new l(b,0)};function M(I,N){for(;(I[N]&65535)!=I[N];)I[N+1]+=I[N]>>>16,I[N]&=65535,N++}function T(I,N){this.g=I,this.h=N}function O(I,N){if(j(N))throw Error("division by zero");if(j(I))return new T(x,x);if(S(I))return N=O(k(I),N),new T(k(N.g),k(N.h));if(S(N))return N=O(I,k(N)),new T(k(N.g),N.h);if(30<I.g.length){if(S(I)||S(N))throw Error("slowDivide_ only works with positive integers.");for(var b=p,f=N;0>=f.l(I);)b=ne(b),f=ne(f);var w=ie(b,1),_=ie(f,1);for(f=ie(f,2),b=ie(b,2);!j(f);){var y=_.add(f);0>=y.l(I)&&(w=w.add(b),_=y),f=ie(f,1),b=ie(b,1)}return N=L(I,w.j(N)),new T(w,N)}for(w=x;0<=I.l(N);){for(b=Math.max(1,Math.floor(I.m()/N.m())),f=Math.ceil(Math.log(b)/Math.LN2),f=48>=f?1:Math.pow(2,f-48),_=h(b),y=_.j(N);S(y)||0<y.l(I);)b-=f,_=h(b),y=_.j(N);j(_)&&(_=p),w=w.add(_),I=L(I,y)}return new T(w,I)}r.A=function(I){return O(this,I).h},r.and=function(I){for(var N=Math.max(this.g.length,I.g.length),b=[],f=0;f<N;f++)b[f]=this.i(f)&I.i(f);return new l(b,this.h&I.h)},r.or=function(I){for(var N=Math.max(this.g.length,I.g.length),b=[],f=0;f<N;f++)b[f]=this.i(f)|I.i(f);return new l(b,this.h|I.h)},r.xor=function(I){for(var N=Math.max(this.g.length,I.g.length),b=[],f=0;f<N;f++)b[f]=this.i(f)^I.i(f);return new l(b,this.h^I.h)};function ne(I){for(var N=I.g.length+1,b=[],f=0;f<N;f++)b[f]=I.i(f)<<1|I.i(f-1)>>>31;return new l(b,I.h)}function ie(I,N){var b=N>>5;N%=32;for(var f=I.g.length-b,w=[],_=0;_<f;_++)w[_]=0<N?I.i(_+b)>>>N|I.i(_+b+1)<<32-N:I.i(_+b);return new l(w,I.h)}n.prototype.digest=n.prototype.v,n.prototype.reset=n.prototype.s,n.prototype.update=n.prototype.u,Eh=n,l.prototype.add=l.prototype.add,l.prototype.multiply=l.prototype.j,l.prototype.modulo=l.prototype.A,l.prototype.compare=l.prototype.l,l.prototype.toNumber=l.prototype.m,l.prototype.toString=l.prototype.toString,l.prototype.getBits=l.prototype.i,l.fromNumber=h,l.fromString=g,ks=l}).apply(typeof kd<"u"?kd:typeof self<"u"?self:typeof window<"u"?window:{});var Va=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var jh,Pn,Ih,Qa,Bo,Th,Sh,Ah;(function(){var r,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(o,u,m){return o==Array.prototype||o==Object.prototype||(o[u]=m.value),o};function t(o){o=[typeof globalThis=="object"&&globalThis,o,typeof window=="object"&&window,typeof self=="object"&&self,typeof Va=="object"&&Va];for(var u=0;u<o.length;++u){var m=o[u];if(m&&m.Math==Math)return m}throw Error("Cannot find global object")}var n=t(this);function a(o,u){if(u)e:{var m=n;o=o.split(".");for(var v=0;v<o.length-1;v++){var B=o[v];if(!(B in m))break e;m=m[B]}o=o[o.length-1],v=m[o],u=u(v),u!=v&&u!=null&&e(m,o,{configurable:!0,writable:!0,value:u})}}function i(o,u){o instanceof String&&(o+="");var m=0,v=!1,B={next:function(){if(!v&&m<o.length){var Q=m++;return{value:u(Q,o[Q]),done:!1}}return v=!0,{done:!0,value:void 0}}};return B[Symbol.iterator]=function(){return B},B}a("Array.prototype.values",function(o){return o||function(){return i(this,function(u,m){return m})}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var l=l||{},c=this||self;function d(o){var u=typeof o;return u=u!="object"?u:o?Array.isArray(o)?"array":u:"null",u=="array"||u=="object"&&typeof o.length=="number"}function h(o){var u=typeof o;return u=="object"&&o!=null||u=="function"}function g(o,u,m){return o.call.apply(o.bind,arguments)}function x(o,u,m){if(!o)throw Error();if(2<arguments.length){var v=Array.prototype.slice.call(arguments,2);return function(){var B=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(B,v),o.apply(u,B)}}return function(){return o.apply(u,arguments)}}function p(o,u,m){return p=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?g:x,p.apply(null,arguments)}function E(o,u){var m=Array.prototype.slice.call(arguments,1);return function(){var v=m.slice();return v.push.apply(v,arguments),o.apply(this,v)}}function j(o,u){function m(){}m.prototype=u.prototype,o.aa=u.prototype,o.prototype=new m,o.prototype.constructor=o,o.Qb=function(v,B,Q){for(var ve=Array(arguments.length-2),lt=2;lt<arguments.length;lt++)ve[lt-2]=arguments[lt];return u.prototype[B].apply(v,ve)}}function S(o){const u=o.length;if(0<u){const m=Array(u);for(let v=0;v<u;v++)m[v]=o[v];return m}return[]}function k(o,u){for(let m=1;m<arguments.length;m++){const v=arguments[m];if(d(v)){const B=o.length||0,Q=v.length||0;o.length=B+Q;for(let ve=0;ve<Q;ve++)o[B+ve]=v[ve]}else o.push(v)}}class L{constructor(u,m){this.i=u,this.j=m,this.h=0,this.g=null}get(){let u;return 0<this.h?(this.h--,u=this.g,this.g=u.next,u.next=null):u=this.i(),u}}function M(o){return/^[\s\xa0]*$/.test(o)}function T(){var o=c.navigator;return o&&(o=o.userAgent)?o:""}function O(o){return O[" "](o),o}O[" "]=function(){};var ne=T().indexOf("Gecko")!=-1&&!(T().toLowerCase().indexOf("webkit")!=-1&&T().indexOf("Edge")==-1)&&!(T().indexOf("Trident")!=-1||T().indexOf("MSIE")!=-1)&&T().indexOf("Edge")==-1;function ie(o,u,m){for(const v in o)u.call(m,o[v],v,o)}function I(o,u){for(const m in o)u.call(void 0,o[m],m,o)}function N(o){const u={};for(const m in o)u[m]=o[m];return u}const b="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function f(o,u){let m,v;for(let B=1;B<arguments.length;B++){v=arguments[B];for(m in v)o[m]=v[m];for(let Q=0;Q<b.length;Q++)m=b[Q],Object.prototype.hasOwnProperty.call(v,m)&&(o[m]=v[m])}}function w(o){var u=1;o=o.split(":");const m=[];for(;0<u&&o.length;)m.push(o.shift()),u--;return o.length&&m.push(o.join(":")),m}function _(o){c.setTimeout(()=>{throw o},0)}function y(){var o=re;let u=null;return o.g&&(u=o.g,o.g=o.g.next,o.g||(o.h=null),u.next=null),u}class G{constructor(){this.h=this.g=null}add(u,m){const v=V.get();v.set(u,m),this.h?this.h.next=v:this.g=v,this.h=v}}var V=new L(()=>new F,o=>o.reset());class F{constructor(){this.next=this.g=this.h=null}set(u,m){this.h=u,this.g=m,this.next=null}reset(){this.next=this.g=this.h=null}}let z,ee=!1,re=new G,oe=()=>{const o=c.Promise.resolve(void 0);z=()=>{o.then(ke)}};var ke=()=>{for(var o;o=y();){try{o.h.call(o.g)}catch(m){_(m)}var u=V;u.j(o),100>u.h&&(u.h++,o.next=u.g,u.g=o)}ee=!1};function ye(){this.s=this.s,this.C=this.C}ye.prototype.s=!1,ye.prototype.ma=function(){this.s||(this.s=!0,this.N())},ye.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function K(o,u){this.type=o,this.g=this.target=u,this.defaultPrevented=!1}K.prototype.h=function(){this.defaultPrevented=!0};var he=function(){if(!c.addEventListener||!Object.defineProperty)return!1;var o=!1,u=Object.defineProperty({},"passive",{get:function(){o=!0}});try{const m=()=>{};c.addEventListener("test",m,u),c.removeEventListener("test",m,u)}catch{}return o}();function Ce(o,u){if(K.call(this,o?o.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,o){var m=this.type=o.type,v=o.changedTouches&&o.changedTouches.length?o.changedTouches[0]:null;if(this.target=o.target||o.srcElement,this.g=u,u=o.relatedTarget){if(ne){e:{try{O(u.nodeName);var B=!0;break e}catch{}B=!1}B||(u=null)}}else m=="mouseover"?u=o.fromElement:m=="mouseout"&&(u=o.toElement);this.relatedTarget=u,v?(this.clientX=v.clientX!==void 0?v.clientX:v.pageX,this.clientY=v.clientY!==void 0?v.clientY:v.pageY,this.screenX=v.screenX||0,this.screenY=v.screenY||0):(this.clientX=o.clientX!==void 0?o.clientX:o.pageX,this.clientY=o.clientY!==void 0?o.clientY:o.pageY,this.screenX=o.screenX||0,this.screenY=o.screenY||0),this.button=o.button,this.key=o.key||"",this.ctrlKey=o.ctrlKey,this.altKey=o.altKey,this.shiftKey=o.shiftKey,this.metaKey=o.metaKey,this.pointerId=o.pointerId||0,this.pointerType=typeof o.pointerType=="string"?o.pointerType:H[o.pointerType]||"",this.state=o.state,this.i=o,o.defaultPrevented&&Ce.aa.h.call(this)}}j(Ce,K);var H={2:"touch",3:"pen",4:"mouse"};Ce.prototype.h=function(){Ce.aa.h.call(this);var o=this.i;o.preventDefault?o.preventDefault():o.returnValue=!1};var Se="closure_listenable_"+(1e6*Math.random()|0),Ne=0;function Z(o,u,m,v,B){this.listener=o,this.proxy=null,this.src=u,this.type=m,this.capture=!!v,this.ha=B,this.key=++Ne,this.da=this.fa=!1}function Re(o){o.da=!0,o.listener=null,o.proxy=null,o.src=null,o.ha=null}function J(o){this.src=o,this.g={},this.h=0}J.prototype.add=function(o,u,m,v,B){var Q=o.toString();o=this.g[Q],o||(o=this.g[Q]=[],this.h++);var ve=q(o,u,v,B);return-1<ve?(u=o[ve],m||(u.fa=!1)):(u=new Z(u,this.src,Q,!!v,B),u.fa=m,o.push(u)),u};function se(o,u){var m=u.type;if(m in o.g){var v=o.g[m],B=Array.prototype.indexOf.call(v,u,void 0),Q;(Q=0<=B)&&Array.prototype.splice.call(v,B,1),Q&&(Re(u),o.g[m].length==0&&(delete o.g[m],o.h--))}}function q(o,u,m,v){for(var B=0;B<o.length;++B){var Q=o[B];if(!Q.da&&Q.listener==u&&Q.capture==!!m&&Q.ha==v)return B}return-1}var te="closure_lm_"+(1e6*Math.random()|0),ge={};function W(o,u,m,v,B){if(Array.isArray(u)){for(var Q=0;Q<u.length;Q++)W(o,u[Q],m,v,B);return null}return m=et(m),o&&o[Se]?o.K(u,m,h(v)?!!v.capture:!1,B):ue(o,u,m,!1,v,B)}function ue(o,u,m,v,B,Q){if(!u)throw Error("Invalid event type");var ve=h(B)?!!B.capture:!!B,lt=Le(o);if(lt||(o[te]=lt=new J(o)),m=lt.add(u,m,v,ve,Q),m.proxy)return m;if(v=ze(),m.proxy=v,v.src=o,v.listener=m,o.addEventListener)he||(B=ve),B===void 0&&(B=!1),o.addEventListener(u.toString(),v,B);else if(o.attachEvent)o.attachEvent(je(u.toString()),v);else if(o.addListener&&o.removeListener)o.addListener(v);else throw Error("addEventListener and attachEvent are unavailable.");return m}function ze(){function o(m){return u.call(o.src,o.listener,m)}const u=_e;return o}function We(o,u,m,v,B){if(Array.isArray(u))for(var Q=0;Q<u.length;Q++)We(o,u[Q],m,v,B);else v=h(v)?!!v.capture:!!v,m=et(m),o&&o[Se]?(o=o.i,u=String(u).toString(),u in o.g&&(Q=o.g[u],m=q(Q,m,v,B),-1<m&&(Re(Q[m]),Array.prototype.splice.call(Q,m,1),Q.length==0&&(delete o.g[u],o.h--)))):o&&(o=Le(o))&&(u=o.g[u.toString()],o=-1,u&&(o=q(u,m,v,B)),(m=-1<o?u[o]:null)&&Pe(m))}function Pe(o){if(typeof o!="number"&&o&&!o.da){var u=o.src;if(u&&u[Se])se(u.i,o);else{var m=o.type,v=o.proxy;u.removeEventListener?u.removeEventListener(m,v,o.capture):u.detachEvent?u.detachEvent(je(m),v):u.addListener&&u.removeListener&&u.removeListener(v),(m=Le(u))?(se(m,o),m.h==0&&(m.src=null,u[te]=null)):Re(o)}}}function je(o){return o in ge?ge[o]:ge[o]="on"+o}function _e(o,u){if(o.da)o=!0;else{u=new Ce(u,this);var m=o.listener,v=o.ha||o.src;o.fa&&Pe(o),o=m.call(v,u)}return o}function Le(o){return o=o[te],o instanceof J?o:null}var nt="__closure_events_fn_"+(1e9*Math.random()>>>0);function et(o){return typeof o=="function"?o:(o[nt]||(o[nt]=function(u){return o.handleEvent(u)}),o[nt])}function U(){ye.call(this),this.i=new J(this),this.M=this,this.F=null}j(U,ye),U.prototype[Se]=!0,U.prototype.removeEventListener=function(o,u,m,v){We(this,o,u,m,v)};function D(o,u){var m,v=o.F;if(v)for(m=[];v;v=v.F)m.push(v);if(o=o.M,v=u.type||u,typeof u=="string")u=new K(u,o);else if(u instanceof K)u.target=u.target||o;else{var B=u;u=new K(v,o),f(u,B)}if(B=!0,m)for(var Q=m.length-1;0<=Q;Q--){var ve=u.g=m[Q];B=P(ve,v,!0,u)&&B}if(ve=u.g=o,B=P(ve,v,!0,u)&&B,B=P(ve,v,!1,u)&&B,m)for(Q=0;Q<m.length;Q++)ve=u.g=m[Q],B=P(ve,v,!1,u)&&B}U.prototype.N=function(){if(U.aa.N.call(this),this.i){var o=this.i,u;for(u in o.g){for(var m=o.g[u],v=0;v<m.length;v++)Re(m[v]);delete o.g[u],o.h--}}this.F=null},U.prototype.K=function(o,u,m,v){return this.i.add(String(o),u,!1,m,v)},U.prototype.L=function(o,u,m,v){return this.i.add(String(o),u,!0,m,v)};function P(o,u,m,v){if(u=o.i.g[String(u)],!u)return!0;u=u.concat();for(var B=!0,Q=0;Q<u.length;++Q){var ve=u[Q];if(ve&&!ve.da&&ve.capture==m){var lt=ve.listener,It=ve.ha||ve.src;ve.fa&&se(o.i,ve),B=lt.call(It,v)!==!1&&B}}return B&&!v.defaultPrevented}function Y(o,u,m){if(typeof o=="function")m&&(o=p(o,m));else if(o&&typeof o.handleEvent=="function")o=p(o.handleEvent,o);else throw Error("Invalid listener argument");return 2147483647<Number(u)?-1:c.setTimeout(o,u||0)}function pe(o){o.g=Y(()=>{o.g=null,o.i&&(o.i=!1,pe(o))},o.l);const u=o.h;o.h=null,o.m.apply(null,u)}class C extends ye{constructor(u,m){super(),this.m=u,this.l=m,this.h=null,this.i=!1,this.g=null}j(u){this.h=arguments,this.g?this.i=!0:pe(this)}N(){super.N(),this.g&&(c.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function De(o){ye.call(this),this.h=o,this.g={}}j(De,ye);var $=[];function le(o){ie(o.g,function(u,m){this.g.hasOwnProperty(m)&&Pe(u)},o),o.g={}}De.prototype.N=function(){De.aa.N.call(this),le(this)},De.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var we=c.JSON.stringify,me=c.JSON.parse,Me=class{stringify(o){return c.JSON.stringify(o,void 0)}parse(o){return c.JSON.parse(o,void 0)}};function Oe(){}Oe.prototype.h=null;function Ye(o){return o.h||(o.h=o.i())}function R(){}var X={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function be(){K.call(this,"d")}j(be,K);function Ve(){K.call(this,"c")}j(Ve,K);var He={},Ie=null;function ht(){return Ie=Ie||new U}He.La="serverreachability";function Ge(o){K.call(this,He.La,o)}j(Ge,K);function Xe(o){const u=ht();D(u,new Ge(u))}He.STAT_EVENT="statevent";function ft(o,u){K.call(this,He.STAT_EVENT,o),this.stat=u}j(ft,K);function fe(o){const u=ht();D(u,new ft(u,o))}He.Ma="timingevent";function tt(o,u){K.call(this,He.Ma,o),this.size=u}j(tt,K);function at(o,u){if(typeof o!="function")throw Error("Fn must not be null and must be a function");return c.setTimeout(function(){o()},u)}function wt(){this.g=!0}wt.prototype.xa=function(){this.g=!1};function Ur(o,u,m,v,B,Q){o.info(function(){if(o.g)if(Q)for(var ve="",lt=Q.split("&"),It=0;It<lt.length;It++){var rt=lt[It].split("=");if(1<rt.length){var Pt=rt[0];rt=rt[1];var $t=Pt.split("_");ve=2<=$t.length&&$t[1]=="type"?ve+(Pt+"="+rt+"&"):ve+(Pt+"=redacted&")}}else ve=null;else ve=Q;return"XMLHTTP REQ ("+v+") [attempt "+B+"]: "+u+`
`+m+`
`+ve})}function Vs(o,u,m,v,B,Q,ve){o.info(function(){return"XMLHTTP RESP ("+v+") [ attempt "+B+"]: "+u+`
`+m+`
`+Q+" "+ve})}function cr(o,u,m,v){o.info(function(){return"XMLHTTP TEXT ("+u+"): "+Hg(o,m)+(v?" "+v:"")})}function zg(o,u){o.info(function(){return"TIMEOUT: "+u})}wt.prototype.info=function(){};function Hg(o,u){if(!o.g)return u;if(!u)return null;try{var m=JSON.parse(u);if(m){for(o=0;o<m.length;o++)if(Array.isArray(m[o])){var v=m[o];if(!(2>v.length)){var B=v[1];if(Array.isArray(B)&&!(1>B.length)){var Q=B[0];if(Q!="noop"&&Q!="stop"&&Q!="close")for(var ve=1;ve<B.length;ve++)B[ve]=""}}}}return we(m)}catch{return u}}var _a={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},fc={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},ro;function ka(){}j(ka,Oe),ka.prototype.g=function(){return new XMLHttpRequest},ka.prototype.i=function(){return{}},ro=new ka;function Br(o,u,m,v){this.j=o,this.i=u,this.l=m,this.R=v||1,this.U=new De(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new xc}function xc(){this.i=null,this.g="",this.h=!1}var yc={},so={};function no(o,u,m){o.L=1,o.v=Ia(Er(u)),o.m=m,o.P=!0,bc(o,null)}function bc(o,u){o.F=Date.now(),Na(o),o.A=Er(o.v);var m=o.A,v=o.R;Array.isArray(v)||(v=[String(v)]),Dc(m.i,"t",v),o.C=0,m=o.j.J,o.h=new xc,o.g=Xc(o.j,m?u:null,!o.m),0<o.O&&(o.M=new C(p(o.Y,o,o.g),o.O)),u=o.U,m=o.g,v=o.ca;var B="readystatechange";Array.isArray(B)||(B&&($[0]=B.toString()),B=$);for(var Q=0;Q<B.length;Q++){var ve=W(m,B[Q],v||u.handleEvent,!1,u.h||u);if(!ve)break;u.g[ve.key]=ve}u=o.H?N(o.H):{},o.m?(o.u||(o.u="POST"),u["Content-Type"]="application/x-www-form-urlencoded",o.g.ea(o.A,o.u,o.m,u)):(o.u="GET",o.g.ea(o.A,o.u,null,u)),Xe(),Ur(o.i,o.u,o.A,o.l,o.R,o.m)}Br.prototype.ca=function(o){o=o.target;const u=this.M;u&&jr(o)==3?u.j():this.Y(o)},Br.prototype.Y=function(o){try{if(o==this.g)e:{const $t=jr(this.g);var u=this.g.Ba();const Us=this.g.Z();if(!(3>$t)&&($t!=3||this.g&&(this.h.h||this.g.oa()||Fc(this.g)))){this.J||$t!=4||u==7||(u==8||0>=Us?Xe(3):Xe(2)),ao(this);var m=this.g.Z();this.X=m;t:if(vc(this)){var v=Fc(this.g);o="";var B=v.length,Q=jr(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){gs(this),bn(this);var ve="";break t}this.h.i=new c.TextDecoder}for(u=0;u<B;u++)this.h.h=!0,o+=this.h.i.decode(v[u],{stream:!(Q&&u==B-1)});v.length=0,this.h.g+=o,this.C=0,ve=this.h.g}else ve=this.g.oa();if(this.o=m==200,Vs(this.i,this.u,this.A,this.l,this.R,$t,m),this.o){if(this.T&&!this.K){t:{if(this.g){var lt,It=this.g;if((lt=It.g?It.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!M(lt)){var rt=lt;break t}}rt=null}if(m=rt)cr(this.i,this.l,m,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,io(this,m);else{this.o=!1,this.s=3,fe(12),gs(this),bn(this);break e}}if(this.P){m=!0;let er;for(;!this.J&&this.C<ve.length;)if(er=Gg(this,ve),er==so){$t==4&&(this.s=4,fe(14),m=!1),cr(this.i,this.l,null,"[Incomplete Response]");break}else if(er==yc){this.s=4,fe(15),cr(this.i,this.l,ve,"[Invalid Chunk]"),m=!1;break}else cr(this.i,this.l,er,null),io(this,er);if(vc(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),$t!=4||ve.length!=0||this.h.h||(this.s=1,fe(16),m=!1),this.o=this.o&&m,!m)cr(this.i,this.l,ve,"[Invalid Chunked Response]"),gs(this),bn(this);else if(0<ve.length&&!this.W){this.W=!0;var Pt=this.j;Pt.g==this&&Pt.ba&&!Pt.M&&(Pt.j.info("Great, no buffering proxy detected. Bytes received: "+ve.length),mo(Pt),Pt.M=!0,fe(11))}}else cr(this.i,this.l,ve,null),io(this,ve);$t==4&&gs(this),this.o&&!this.J&&($t==4?Gc(this.j,this):(this.o=!1,Na(this)))}else d0(this.g),m==400&&0<ve.indexOf("Unknown SID")?(this.s=3,fe(12)):(this.s=0,fe(13)),gs(this),bn(this)}}}catch{}finally{}};function vc(o){return o.g?o.u=="GET"&&o.L!=2&&o.j.Ca:!1}function Gg(o,u){var m=o.C,v=u.indexOf(`
`,m);return v==-1?so:(m=Number(u.substring(m,v)),isNaN(m)?yc:(v+=1,v+m>u.length?so:(u=u.slice(v,v+m),o.C=v+m,u)))}Br.prototype.cancel=function(){this.J=!0,gs(this)};function Na(o){o.S=Date.now()+o.I,wc(o,o.I)}function wc(o,u){if(o.B!=null)throw Error("WatchDog timer not null");o.B=at(p(o.ba,o),u)}function ao(o){o.B&&(c.clearTimeout(o.B),o.B=null)}Br.prototype.ba=function(){this.B=null;const o=Date.now();0<=o-this.S?(zg(this.i,this.A),this.L!=2&&(Xe(),fe(17)),gs(this),this.s=2,bn(this)):wc(this,this.S-o)};function bn(o){o.j.G==0||o.J||Gc(o.j,o)}function gs(o){ao(o);var u=o.M;u&&typeof u.ma=="function"&&u.ma(),o.M=null,le(o.U),o.g&&(u=o.g,o.g=null,u.abort(),u.ma())}function io(o,u){try{var m=o.j;if(m.G!=0&&(m.g==o||oo(m.h,o))){if(!o.K&&oo(m.h,o)&&m.G==3){try{var v=m.Da.g.parse(u)}catch{v=null}if(Array.isArray(v)&&v.length==3){var B=v;if(B[0]==0){e:if(!m.u){if(m.g)if(m.g.F+3e3<o.F)Da(m),Ca(m);else break e;ho(m),fe(18)}}else m.za=B[1],0<m.za-m.T&&37500>B[2]&&m.F&&m.v==0&&!m.C&&(m.C=at(p(m.Za,m),6e3));if(1>=Nc(m.h)&&m.ca){try{m.ca()}catch{}m.ca=void 0}}else fs(m,11)}else if((o.K||m.g==o)&&Da(m),!M(u))for(B=m.Da.g.parse(u),u=0;u<B.length;u++){let rt=B[u];if(m.T=rt[0],rt=rt[1],m.G==2)if(rt[0]=="c"){m.K=rt[1],m.ia=rt[2];const Pt=rt[3];Pt!=null&&(m.la=Pt,m.j.info("VER="+m.la));const $t=rt[4];$t!=null&&(m.Aa=$t,m.j.info("SVER="+m.Aa));const Us=rt[5];Us!=null&&typeof Us=="number"&&0<Us&&(v=1.5*Us,m.L=v,m.j.info("backChannelRequestTimeoutMs_="+v)),v=m;const er=o.g;if(er){const $a=er.g?er.g.getResponseHeader("X-Client-Wire-Protocol"):null;if($a){var Q=v.h;Q.g||$a.indexOf("spdy")==-1&&$a.indexOf("quic")==-1&&$a.indexOf("h2")==-1||(Q.j=Q.l,Q.g=new Set,Q.h&&(lo(Q,Q.h),Q.h=null))}if(v.D){const go=er.g?er.g.getResponseHeader("X-HTTP-Session-Id"):null;go&&(v.ya=go,dt(v.I,v.D,go))}}m.G=3,m.l&&m.l.ua(),m.ba&&(m.R=Date.now()-o.F,m.j.info("Handshake RTT: "+m.R+"ms")),v=m;var ve=o;if(v.qa=Yc(v,v.J?v.ia:null,v.W),ve.K){Ec(v.h,ve);var lt=ve,It=v.L;It&&(lt.I=It),lt.B&&(ao(lt),Na(lt)),v.g=ve}else zc(v);0<m.i.length&&Ra(m)}else rt[0]!="stop"&&rt[0]!="close"||fs(m,7);else m.G==3&&(rt[0]=="stop"||rt[0]=="close"?rt[0]=="stop"?fs(m,7):uo(m):rt[0]!="noop"&&m.l&&m.l.ta(rt),m.v=0)}}Xe(4)}catch{}}var Kg=class{constructor(o,u){this.g=o,this.map=u}};function _c(o){this.l=o||10,c.PerformanceNavigationTiming?(o=c.performance.getEntriesByType("navigation"),o=0<o.length&&(o[0].nextHopProtocol=="hq"||o[0].nextHopProtocol=="h2")):o=!!(c.chrome&&c.chrome.loadTimes&&c.chrome.loadTimes()&&c.chrome.loadTimes().wasFetchedViaSpdy),this.j=o?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function kc(o){return o.h?!0:o.g?o.g.size>=o.j:!1}function Nc(o){return o.h?1:o.g?o.g.size:0}function oo(o,u){return o.h?o.h==u:o.g?o.g.has(u):!1}function lo(o,u){o.g?o.g.add(u):o.h=u}function Ec(o,u){o.h&&o.h==u?o.h=null:o.g&&o.g.has(u)&&o.g.delete(u)}_c.prototype.cancel=function(){if(this.i=jc(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const o of this.g.values())o.cancel();this.g.clear()}};function jc(o){if(o.h!=null)return o.i.concat(o.h.D);if(o.g!=null&&o.g.size!==0){let u=o.i;for(const m of o.g.values())u=u.concat(m.D);return u}return S(o.i)}function Qg(o){if(o.V&&typeof o.V=="function")return o.V();if(typeof Map<"u"&&o instanceof Map||typeof Set<"u"&&o instanceof Set)return Array.from(o.values());if(typeof o=="string")return o.split("");if(d(o)){for(var u=[],m=o.length,v=0;v<m;v++)u.push(o[v]);return u}u=[],m=0;for(v in o)u[m++]=o[v];return u}function Yg(o){if(o.na&&typeof o.na=="function")return o.na();if(!o.V||typeof o.V!="function"){if(typeof Map<"u"&&o instanceof Map)return Array.from(o.keys());if(!(typeof Set<"u"&&o instanceof Set)){if(d(o)||typeof o=="string"){var u=[];o=o.length;for(var m=0;m<o;m++)u.push(m);return u}u=[],m=0;for(const v in o)u[m++]=v;return u}}}function Ic(o,u){if(o.forEach&&typeof o.forEach=="function")o.forEach(u,void 0);else if(d(o)||typeof o=="string")Array.prototype.forEach.call(o,u,void 0);else for(var m=Yg(o),v=Qg(o),B=v.length,Q=0;Q<B;Q++)u.call(void 0,v[Q],m&&m[Q],o)}var Tc=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Xg(o,u){if(o){o=o.split("&");for(var m=0;m<o.length;m++){var v=o[m].indexOf("="),B=null;if(0<=v){var Q=o[m].substring(0,v);B=o[m].substring(v+1)}else Q=o[m];u(Q,B?decodeURIComponent(B.replace(/\+/g," ")):"")}}}function ps(o){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,o instanceof ps){this.h=o.h,Ea(this,o.j),this.o=o.o,this.g=o.g,ja(this,o.s),this.l=o.l;var u=o.i,m=new _n;m.i=u.i,u.g&&(m.g=new Map(u.g),m.h=u.h),Sc(this,m),this.m=o.m}else o&&(u=String(o).match(Tc))?(this.h=!1,Ea(this,u[1]||"",!0),this.o=vn(u[2]||""),this.g=vn(u[3]||"",!0),ja(this,u[4]),this.l=vn(u[5]||"",!0),Sc(this,u[6]||"",!0),this.m=vn(u[7]||"")):(this.h=!1,this.i=new _n(null,this.h))}ps.prototype.toString=function(){var o=[],u=this.j;u&&o.push(wn(u,Ac,!0),":");var m=this.g;return(m||u=="file")&&(o.push("//"),(u=this.o)&&o.push(wn(u,Ac,!0),"@"),o.push(encodeURIComponent(String(m)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),m=this.s,m!=null&&o.push(":",String(m))),(m=this.l)&&(this.g&&m.charAt(0)!="/"&&o.push("/"),o.push(wn(m,m.charAt(0)=="/"?e0:Zg,!0))),(m=this.i.toString())&&o.push("?",m),(m=this.m)&&o.push("#",wn(m,r0)),o.join("")};function Er(o){return new ps(o)}function Ea(o,u,m){o.j=m?vn(u,!0):u,o.j&&(o.j=o.j.replace(/:$/,""))}function ja(o,u){if(u){if(u=Number(u),isNaN(u)||0>u)throw Error("Bad port number "+u);o.s=u}else o.s=null}function Sc(o,u,m){u instanceof _n?(o.i=u,s0(o.i,o.h)):(m||(u=wn(u,t0)),o.i=new _n(u,o.h))}function dt(o,u,m){o.i.set(u,m)}function Ia(o){return dt(o,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),o}function vn(o,u){return o?u?decodeURI(o.replace(/%25/g,"%2525")):decodeURIComponent(o):""}function wn(o,u,m){return typeof o=="string"?(o=encodeURI(o).replace(u,Jg),m&&(o=o.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),o):null}function Jg(o){return o=o.charCodeAt(0),"%"+(o>>4&15).toString(16)+(o&15).toString(16)}var Ac=/[#\/\?@]/g,Zg=/[#\?:]/g,e0=/[#\?]/g,t0=/[#\?@]/g,r0=/#/g;function _n(o,u){this.h=this.g=null,this.i=o||null,this.j=!!u}function qr(o){o.g||(o.g=new Map,o.h=0,o.i&&Xg(o.i,function(u,m){o.add(decodeURIComponent(u.replace(/\+/g," ")),m)}))}r=_n.prototype,r.add=function(o,u){qr(this),this.i=null,o=Ls(this,o);var m=this.g.get(o);return m||this.g.set(o,m=[]),m.push(u),this.h+=1,this};function Cc(o,u){qr(o),u=Ls(o,u),o.g.has(u)&&(o.i=null,o.h-=o.g.get(u).length,o.g.delete(u))}function Rc(o,u){return qr(o),u=Ls(o,u),o.g.has(u)}r.forEach=function(o,u){qr(this),this.g.forEach(function(m,v){m.forEach(function(B){o.call(u,B,v,this)},this)},this)},r.na=function(){qr(this);const o=Array.from(this.g.values()),u=Array.from(this.g.keys()),m=[];for(let v=0;v<u.length;v++){const B=o[v];for(let Q=0;Q<B.length;Q++)m.push(u[v])}return m},r.V=function(o){qr(this);let u=[];if(typeof o=="string")Rc(this,o)&&(u=u.concat(this.g.get(Ls(this,o))));else{o=Array.from(this.g.values());for(let m=0;m<o.length;m++)u=u.concat(o[m])}return u},r.set=function(o,u){return qr(this),this.i=null,o=Ls(this,o),Rc(this,o)&&(this.h-=this.g.get(o).length),this.g.set(o,[u]),this.h+=1,this},r.get=function(o,u){return o?(o=this.V(o),0<o.length?String(o[0]):u):u};function Dc(o,u,m){Cc(o,u),0<m.length&&(o.i=null,o.g.set(Ls(o,u),S(m)),o.h+=m.length)}r.toString=function(){if(this.i)return this.i;if(!this.g)return"";const o=[],u=Array.from(this.g.keys());for(var m=0;m<u.length;m++){var v=u[m];const Q=encodeURIComponent(String(v)),ve=this.V(v);for(v=0;v<ve.length;v++){var B=Q;ve[v]!==""&&(B+="="+encodeURIComponent(String(ve[v]))),o.push(B)}}return this.i=o.join("&")};function Ls(o,u){return u=String(u),o.j&&(u=u.toLowerCase()),u}function s0(o,u){u&&!o.j&&(qr(o),o.i=null,o.g.forEach(function(m,v){var B=v.toLowerCase();v!=B&&(Cc(this,v),Dc(this,B,m))},o)),o.j=u}function n0(o,u){const m=new wt;if(c.Image){const v=new Image;v.onload=E(Wr,m,"TestLoadImage: loaded",!0,u,v),v.onerror=E(Wr,m,"TestLoadImage: error",!1,u,v),v.onabort=E(Wr,m,"TestLoadImage: abort",!1,u,v),v.ontimeout=E(Wr,m,"TestLoadImage: timeout",!1,u,v),c.setTimeout(function(){v.ontimeout&&v.ontimeout()},1e4),v.src=o}else u(!1)}function a0(o,u){const m=new wt,v=new AbortController,B=setTimeout(()=>{v.abort(),Wr(m,"TestPingServer: timeout",!1,u)},1e4);fetch(o,{signal:v.signal}).then(Q=>{clearTimeout(B),Q.ok?Wr(m,"TestPingServer: ok",!0,u):Wr(m,"TestPingServer: server error",!1,u)}).catch(()=>{clearTimeout(B),Wr(m,"TestPingServer: error",!1,u)})}function Wr(o,u,m,v,B){try{B&&(B.onload=null,B.onerror=null,B.onabort=null,B.ontimeout=null),v(m)}catch{}}function i0(){this.g=new Me}function o0(o,u,m){const v=m||"";try{Ic(o,function(B,Q){let ve=B;h(B)&&(ve=we(B)),u.push(v+Q+"="+encodeURIComponent(ve))})}catch(B){throw u.push(v+"type="+encodeURIComponent("_badmap")),B}}function Ta(o){this.l=o.Ub||null,this.j=o.eb||!1}j(Ta,Oe),Ta.prototype.g=function(){return new Sa(this.l,this.j)},Ta.prototype.i=function(o){return function(){return o}}({});function Sa(o,u){U.call(this),this.D=o,this.o=u,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}j(Sa,U),r=Sa.prototype,r.open=function(o,u){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=o,this.A=u,this.readyState=1,Nn(this)},r.send=function(o){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const u={headers:this.u,method:this.B,credentials:this.m,cache:void 0};o&&(u.body=o),(this.D||c).fetch(new Request(this.A,u)).then(this.Sa.bind(this),this.ga.bind(this))},r.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,kn(this)),this.readyState=0},r.Sa=function(o){if(this.g&&(this.l=o,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=o.headers,this.readyState=2,Nn(this)),this.g&&(this.readyState=3,Nn(this),this.g)))if(this.responseType==="arraybuffer")o.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof c.ReadableStream<"u"&&"body"in o){if(this.j=o.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;Pc(this)}else o.text().then(this.Ra.bind(this),this.ga.bind(this))};function Pc(o){o.j.read().then(o.Pa.bind(o)).catch(o.ga.bind(o))}r.Pa=function(o){if(this.g){if(this.o&&o.value)this.response.push(o.value);else if(!this.o){var u=o.value?o.value:new Uint8Array(0);(u=this.v.decode(u,{stream:!o.done}))&&(this.response=this.responseText+=u)}o.done?kn(this):Nn(this),this.readyState==3&&Pc(this)}},r.Ra=function(o){this.g&&(this.response=this.responseText=o,kn(this))},r.Qa=function(o){this.g&&(this.response=o,kn(this))},r.ga=function(){this.g&&kn(this)};function kn(o){o.readyState=4,o.l=null,o.j=null,o.v=null,Nn(o)}r.setRequestHeader=function(o,u){this.u.append(o,u)},r.getResponseHeader=function(o){return this.h&&this.h.get(o.toLowerCase())||""},r.getAllResponseHeaders=function(){if(!this.h)return"";const o=[],u=this.h.entries();for(var m=u.next();!m.done;)m=m.value,o.push(m[0]+": "+m[1]),m=u.next();return o.join(`\r
`)};function Nn(o){o.onreadystatechange&&o.onreadystatechange.call(o)}Object.defineProperty(Sa.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(o){this.m=o?"include":"same-origin"}});function $c(o){let u="";return ie(o,function(m,v){u+=v,u+=":",u+=m,u+=`\r
`}),u}function co(o,u,m){e:{for(v in m){var v=!1;break e}v=!0}v||(m=$c(m),typeof o=="string"?m!=null&&encodeURIComponent(String(m)):dt(o,u,m))}function pt(o){U.call(this),this.headers=new Map,this.o=o||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}j(pt,U);var l0=/^https?$/i,c0=["POST","PUT"];r=pt.prototype,r.Ha=function(o){this.J=o},r.ea=function(o,u,m,v){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+o);u=u?u.toUpperCase():"GET",this.D=o,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():ro.g(),this.v=this.o?Ye(this.o):Ye(ro),this.g.onreadystatechange=p(this.Ea,this);try{this.B=!0,this.g.open(u,String(o),!0),this.B=!1}catch(Q){Mc(this,Q);return}if(o=m||"",m=new Map(this.headers),v)if(Object.getPrototypeOf(v)===Object.prototype)for(var B in v)m.set(B,v[B]);else if(typeof v.keys=="function"&&typeof v.get=="function")for(const Q of v.keys())m.set(Q,v.get(Q));else throw Error("Unknown input type for opt_headers: "+String(v));v=Array.from(m.keys()).find(Q=>Q.toLowerCase()=="content-type"),B=c.FormData&&o instanceof c.FormData,!(0<=Array.prototype.indexOf.call(c0,u,void 0))||v||B||m.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[Q,ve]of m)this.g.setRequestHeader(Q,ve);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{Lc(this),this.u=!0,this.g.send(o),this.u=!1}catch(Q){Mc(this,Q)}};function Mc(o,u){o.h=!1,o.g&&(o.j=!0,o.g.abort(),o.j=!1),o.l=u,o.m=5,Oc(o),Aa(o)}function Oc(o){o.A||(o.A=!0,D(o,"complete"),D(o,"error"))}r.abort=function(o){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=o||7,D(this,"complete"),D(this,"abort"),Aa(this))},r.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Aa(this,!0)),pt.aa.N.call(this)},r.Ea=function(){this.s||(this.B||this.u||this.j?Vc(this):this.bb())},r.bb=function(){Vc(this)};function Vc(o){if(o.h&&typeof l<"u"&&(!o.v[1]||jr(o)!=4||o.Z()!=2)){if(o.u&&jr(o)==4)Y(o.Ea,0,o);else if(D(o,"readystatechange"),jr(o)==4){o.h=!1;try{const ve=o.Z();e:switch(ve){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var u=!0;break e;default:u=!1}var m;if(!(m=u)){var v;if(v=ve===0){var B=String(o.D).match(Tc)[1]||null;!B&&c.self&&c.self.location&&(B=c.self.location.protocol.slice(0,-1)),v=!l0.test(B?B.toLowerCase():"")}m=v}if(m)D(o,"complete"),D(o,"success");else{o.m=6;try{var Q=2<jr(o)?o.g.statusText:""}catch{Q=""}o.l=Q+" ["+o.Z()+"]",Oc(o)}}finally{Aa(o)}}}}function Aa(o,u){if(o.g){Lc(o);const m=o.g,v=o.v[0]?()=>{}:null;o.g=null,o.v=null,u||D(o,"ready");try{m.onreadystatechange=v}catch{}}}function Lc(o){o.I&&(c.clearTimeout(o.I),o.I=null)}r.isActive=function(){return!!this.g};function jr(o){return o.g?o.g.readyState:0}r.Z=function(){try{return 2<jr(this)?this.g.status:-1}catch{return-1}},r.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},r.Oa=function(o){if(this.g){var u=this.g.responseText;return o&&u.indexOf(o)==0&&(u=u.substring(o.length)),me(u)}};function Fc(o){try{if(!o.g)return null;if("response"in o.g)return o.g.response;switch(o.H){case"":case"text":return o.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in o.g)return o.g.mozResponseArrayBuffer}return null}catch{return null}}function d0(o){const u={};o=(o.g&&2<=jr(o)&&o.g.getAllResponseHeaders()||"").split(`\r
`);for(let v=0;v<o.length;v++){if(M(o[v]))continue;var m=w(o[v]);const B=m[0];if(m=m[1],typeof m!="string")continue;m=m.trim();const Q=u[B]||[];u[B]=Q,Q.push(m)}I(u,function(v){return v.join(", ")})}r.Ba=function(){return this.m},r.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function En(o,u,m){return m&&m.internalChannelParams&&m.internalChannelParams[o]||u}function Uc(o){this.Aa=0,this.i=[],this.j=new wt,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=En("failFast",!1,o),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=En("baseRetryDelayMs",5e3,o),this.cb=En("retryDelaySeedMs",1e4,o),this.Wa=En("forwardChannelMaxRetries",2,o),this.wa=En("forwardChannelRequestTimeoutMs",2e4,o),this.pa=o&&o.xmlHttpFactory||void 0,this.Xa=o&&o.Tb||void 0,this.Ca=o&&o.useFetchStreams||!1,this.L=void 0,this.J=o&&o.supportsCrossDomainXhr||!1,this.K="",this.h=new _c(o&&o.concurrentRequestLimit),this.Da=new i0,this.P=o&&o.fastHandshake||!1,this.O=o&&o.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=o&&o.Rb||!1,o&&o.xa&&this.j.xa(),o&&o.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&o&&o.detectBufferingProxy||!1,this.ja=void 0,o&&o.longPollingTimeout&&0<o.longPollingTimeout&&(this.ja=o.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}r=Uc.prototype,r.la=8,r.G=1,r.connect=function(o,u,m,v){fe(0),this.W=o,this.H=u||{},m&&v!==void 0&&(this.H.OSID=m,this.H.OAID=v),this.F=this.X,this.I=Yc(this,null,this.W),Ra(this)};function uo(o){if(Bc(o),o.G==3){var u=o.U++,m=Er(o.I);if(dt(m,"SID",o.K),dt(m,"RID",u),dt(m,"TYPE","terminate"),jn(o,m),u=new Br(o,o.j,u),u.L=2,u.v=Ia(Er(m)),m=!1,c.navigator&&c.navigator.sendBeacon)try{m=c.navigator.sendBeacon(u.v.toString(),"")}catch{}!m&&c.Image&&(new Image().src=u.v,m=!0),m||(u.g=Xc(u.j,null),u.g.ea(u.v)),u.F=Date.now(),Na(u)}Qc(o)}function Ca(o){o.g&&(mo(o),o.g.cancel(),o.g=null)}function Bc(o){Ca(o),o.u&&(c.clearTimeout(o.u),o.u=null),Da(o),o.h.cancel(),o.s&&(typeof o.s=="number"&&c.clearTimeout(o.s),o.s=null)}function Ra(o){if(!kc(o.h)&&!o.s){o.s=!0;var u=o.Ga;z||oe(),ee||(z(),ee=!0),re.add(u,o),o.B=0}}function u0(o,u){return Nc(o.h)>=o.h.j-(o.s?1:0)?!1:o.s?(o.i=u.D.concat(o.i),!0):o.G==1||o.G==2||o.B>=(o.Va?0:o.Wa)?!1:(o.s=at(p(o.Ga,o,u),Kc(o,o.B)),o.B++,!0)}r.Ga=function(o){if(this.s)if(this.s=null,this.G==1){if(!o){this.U=Math.floor(1e5*Math.random()),o=this.U++;const B=new Br(this,this.j,o);let Q=this.o;if(this.S&&(Q?(Q=N(Q),f(Q,this.S)):Q=this.S),this.m!==null||this.O||(B.H=Q,Q=null),this.P)e:{for(var u=0,m=0;m<this.i.length;m++){t:{var v=this.i[m];if("__data__"in v.map&&(v=v.map.__data__,typeof v=="string")){v=v.length;break t}v=void 0}if(v===void 0)break;if(u+=v,4096<u){u=m;break e}if(u===4096||m===this.i.length-1){u=m+1;break e}}u=1e3}else u=1e3;u=Wc(this,B,u),m=Er(this.I),dt(m,"RID",o),dt(m,"CVER",22),this.D&&dt(m,"X-HTTP-Session-Id",this.D),jn(this,m),Q&&(this.O?u="headers="+encodeURIComponent(String($c(Q)))+"&"+u:this.m&&co(m,this.m,Q)),lo(this.h,B),this.Ua&&dt(m,"TYPE","init"),this.P?(dt(m,"$req",u),dt(m,"SID","null"),B.T=!0,no(B,m,null)):no(B,m,u),this.G=2}}else this.G==3&&(o?qc(this,o):this.i.length==0||kc(this.h)||qc(this))};function qc(o,u){var m;u?m=u.l:m=o.U++;const v=Er(o.I);dt(v,"SID",o.K),dt(v,"RID",m),dt(v,"AID",o.T),jn(o,v),o.m&&o.o&&co(v,o.m,o.o),m=new Br(o,o.j,m,o.B+1),o.m===null&&(m.H=o.o),u&&(o.i=u.D.concat(o.i)),u=Wc(o,m,1e3),m.I=Math.round(.5*o.wa)+Math.round(.5*o.wa*Math.random()),lo(o.h,m),no(m,v,u)}function jn(o,u){o.H&&ie(o.H,function(m,v){dt(u,v,m)}),o.l&&Ic({},function(m,v){dt(u,v,m)})}function Wc(o,u,m){m=Math.min(o.i.length,m);var v=o.l?p(o.l.Na,o.l,o):null;e:{var B=o.i;let Q=-1;for(;;){const ve=["count="+m];Q==-1?0<m?(Q=B[0].g,ve.push("ofs="+Q)):Q=0:ve.push("ofs="+Q);let lt=!0;for(let It=0;It<m;It++){let rt=B[It].g;const Pt=B[It].map;if(rt-=Q,0>rt)Q=Math.max(0,B[It].g-100),lt=!1;else try{o0(Pt,ve,"req"+rt+"_")}catch{v&&v(Pt)}}if(lt){v=ve.join("&");break e}}}return o=o.i.splice(0,m),u.D=o,v}function zc(o){if(!o.g&&!o.u){o.Y=1;var u=o.Fa;z||oe(),ee||(z(),ee=!0),re.add(u,o),o.v=0}}function ho(o){return o.g||o.u||3<=o.v?!1:(o.Y++,o.u=at(p(o.Fa,o),Kc(o,o.v)),o.v++,!0)}r.Fa=function(){if(this.u=null,Hc(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var o=2*this.R;this.j.info("BP detection timer enabled: "+o),this.A=at(p(this.ab,this),o)}},r.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,fe(10),Ca(this),Hc(this))};function mo(o){o.A!=null&&(c.clearTimeout(o.A),o.A=null)}function Hc(o){o.g=new Br(o,o.j,"rpc",o.Y),o.m===null&&(o.g.H=o.o),o.g.O=0;var u=Er(o.qa);dt(u,"RID","rpc"),dt(u,"SID",o.K),dt(u,"AID",o.T),dt(u,"CI",o.F?"0":"1"),!o.F&&o.ja&&dt(u,"TO",o.ja),dt(u,"TYPE","xmlhttp"),jn(o,u),o.m&&o.o&&co(u,o.m,o.o),o.L&&(o.g.I=o.L);var m=o.g;o=o.ia,m.L=1,m.v=Ia(Er(u)),m.m=null,m.P=!0,bc(m,o)}r.Za=function(){this.C!=null&&(this.C=null,Ca(this),ho(this),fe(19))};function Da(o){o.C!=null&&(c.clearTimeout(o.C),o.C=null)}function Gc(o,u){var m=null;if(o.g==u){Da(o),mo(o),o.g=null;var v=2}else if(oo(o.h,u))m=u.D,Ec(o.h,u),v=1;else return;if(o.G!=0){if(u.o)if(v==1){m=u.m?u.m.length:0,u=Date.now()-u.F;var B=o.B;v=ht(),D(v,new tt(v,m)),Ra(o)}else zc(o);else if(B=u.s,B==3||B==0&&0<u.X||!(v==1&&u0(o,u)||v==2&&ho(o)))switch(m&&0<m.length&&(u=o.h,u.i=u.i.concat(m)),B){case 1:fs(o,5);break;case 4:fs(o,10);break;case 3:fs(o,6);break;default:fs(o,2)}}}function Kc(o,u){let m=o.Ta+Math.floor(Math.random()*o.cb);return o.isActive()||(m*=2),m*u}function fs(o,u){if(o.j.info("Error code "+u),u==2){var m=p(o.fb,o),v=o.Xa;const B=!v;v=new ps(v||"//www.google.com/images/cleardot.gif"),c.location&&c.location.protocol=="http"||Ea(v,"https"),Ia(v),B?n0(v.toString(),m):a0(v.toString(),m)}else fe(2);o.G=0,o.l&&o.l.sa(u),Qc(o),Bc(o)}r.fb=function(o){o?(this.j.info("Successfully pinged google.com"),fe(2)):(this.j.info("Failed to ping google.com"),fe(1))};function Qc(o){if(o.G=0,o.ka=[],o.l){const u=jc(o.h);(u.length!=0||o.i.length!=0)&&(k(o.ka,u),k(o.ka,o.i),o.h.i.length=0,S(o.i),o.i.length=0),o.l.ra()}}function Yc(o,u,m){var v=m instanceof ps?Er(m):new ps(m);if(v.g!="")u&&(v.g=u+"."+v.g),ja(v,v.s);else{var B=c.location;v=B.protocol,u=u?u+"."+B.hostname:B.hostname,B=+B.port;var Q=new ps(null);v&&Ea(Q,v),u&&(Q.g=u),B&&ja(Q,B),m&&(Q.l=m),v=Q}return m=o.D,u=o.ya,m&&u&&dt(v,m,u),dt(v,"VER",o.la),jn(o,v),v}function Xc(o,u,m){if(u&&!o.J)throw Error("Can't create secondary domain capable XhrIo object.");return u=o.Ca&&!o.pa?new pt(new Ta({eb:m})):new pt(o.pa),u.Ha(o.J),u}r.isActive=function(){return!!this.l&&this.l.isActive(this)};function Jc(){}r=Jc.prototype,r.ua=function(){},r.ta=function(){},r.sa=function(){},r.ra=function(){},r.isActive=function(){return!0},r.Na=function(){};function Pa(){}Pa.prototype.g=function(o,u){return new Yt(o,u)};function Yt(o,u){U.call(this),this.g=new Uc(u),this.l=o,this.h=u&&u.messageUrlParams||null,o=u&&u.messageHeaders||null,u&&u.clientProtocolHeaderRequired&&(o?o["X-Client-Protocol"]="webchannel":o={"X-Client-Protocol":"webchannel"}),this.g.o=o,o=u&&u.initMessageHeaders||null,u&&u.messageContentType&&(o?o["X-WebChannel-Content-Type"]=u.messageContentType:o={"X-WebChannel-Content-Type":u.messageContentType}),u&&u.va&&(o?o["X-WebChannel-Client-Profile"]=u.va:o={"X-WebChannel-Client-Profile":u.va}),this.g.S=o,(o=u&&u.Sb)&&!M(o)&&(this.g.m=o),this.v=u&&u.supportsCrossDomainXhr||!1,this.u=u&&u.sendRawJson||!1,(u=u&&u.httpSessionIdParam)&&!M(u)&&(this.g.D=u,o=this.h,o!==null&&u in o&&(o=this.h,u in o&&delete o[u])),this.j=new Fs(this)}j(Yt,U),Yt.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},Yt.prototype.close=function(){uo(this.g)},Yt.prototype.o=function(o){var u=this.g;if(typeof o=="string"){var m={};m.__data__=o,o=m}else this.u&&(m={},m.__data__=we(o),o=m);u.i.push(new Kg(u.Ya++,o)),u.G==3&&Ra(u)},Yt.prototype.N=function(){this.g.l=null,delete this.j,uo(this.g),delete this.g,Yt.aa.N.call(this)};function Zc(o){be.call(this),o.__headers__&&(this.headers=o.__headers__,this.statusCode=o.__status__,delete o.__headers__,delete o.__status__);var u=o.__sm__;if(u){e:{for(const m in u){o=m;break e}o=void 0}(this.i=o)&&(o=this.i,u=u!==null&&o in u?u[o]:void 0),this.data=u}else this.data=o}j(Zc,be);function ed(){Ve.call(this),this.status=1}j(ed,Ve);function Fs(o){this.g=o}j(Fs,Jc),Fs.prototype.ua=function(){D(this.g,"a")},Fs.prototype.ta=function(o){D(this.g,new Zc(o))},Fs.prototype.sa=function(o){D(this.g,new ed)},Fs.prototype.ra=function(){D(this.g,"b")},Pa.prototype.createWebChannel=Pa.prototype.g,Yt.prototype.send=Yt.prototype.o,Yt.prototype.open=Yt.prototype.m,Yt.prototype.close=Yt.prototype.close,Ah=function(){return new Pa},Sh=function(){return ht()},Th=He,Bo={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},_a.NO_ERROR=0,_a.TIMEOUT=8,_a.HTTP_ERROR=6,Qa=_a,fc.COMPLETE="complete",Ih=fc,R.EventType=X,X.OPEN="a",X.CLOSE="b",X.ERROR="c",X.MESSAGE="d",U.prototype.listen=U.prototype.K,Pn=R,pt.prototype.listenOnce=pt.prototype.L,pt.prototype.getLastError=pt.prototype.Ka,pt.prototype.getLastErrorCode=pt.prototype.Ba,pt.prototype.getStatus=pt.prototype.Z,pt.prototype.getResponseJson=pt.prototype.Oa,pt.prototype.getResponseText=pt.prototype.oa,pt.prototype.send=pt.prototype.ea,pt.prototype.setWithCredentials=pt.prototype.Ha,jh=pt}).apply(typeof Va<"u"?Va:typeof self<"u"?self:typeof window<"u"?window:{});const Nd="@firebase/firestore";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ot{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}Ot.UNAUTHENTICATED=new Ot(null),Ot.GOOGLE_CREDENTIALS=new Ot("google-credentials-uid"),Ot.FIRST_PARTY=new Ot("first-party-uid"),Ot.MOCK_USER=new Ot("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let hn="10.14.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const js=new yl("@firebase/firestore");function Tn(){return js.logLevel}function Ae(r,...e){if(js.logLevel<=Je.DEBUG){const t=e.map(wl);js.debug(`Firestore (${hn}): ${r}`,...t)}}function Mr(r,...e){if(js.logLevel<=Je.ERROR){const t=e.map(wl);js.error(`Firestore (${hn}): ${r}`,...t)}}function rn(r,...e){if(js.logLevel<=Je.WARN){const t=e.map(wl);js.warn(`Firestore (${hn}): ${r}`,...t)}}function wl(r){if(typeof r=="string")return r;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return function(t){return JSON.stringify(t)}(r)}catch{return r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ue(r="Unexpected state"){const e=`FIRESTORE (${hn}) INTERNAL ASSERTION FAILED: `+r;throw Mr(e),new Error(e)}function ot(r,e){r||Ue()}function qe(r,e){return r}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ae={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Te extends kr{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class is{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ch{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class yx{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(Ot.UNAUTHENTICATED))}shutdown(){}}class bx{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class vx{constructor(e){this.t=e,this.currentUser=Ot.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){ot(this.o===void 0);let n=this.i;const a=d=>this.i!==n?(n=this.i,t(d)):Promise.resolve();let i=new is;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new is,e.enqueueRetryable(()=>a(this.currentUser))};const l=()=>{const d=i;e.enqueueRetryable(async()=>{await d.promise,await a(this.currentUser)})},c=d=>{Ae("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=d,this.o&&(this.auth.addAuthTokenListener(this.o),l())};this.t.onInit(d=>c(d)),setTimeout(()=>{if(!this.auth){const d=this.t.getImmediate({optional:!0});d?c(d):(Ae("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new is)}},0),l()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(n=>this.i!==e?(Ae("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):n?(ot(typeof n.accessToken=="string"),new Ch(n.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return ot(e===null||typeof e=="string"),new Ot(e)}}class wx{constructor(e,t,n){this.l=e,this.h=t,this.P=n,this.type="FirstParty",this.user=Ot.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);const e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class _x{constructor(e,t,n){this.l=e,this.h=t,this.P=n}getToken(){return Promise.resolve(new wx(this.l,this.h,this.P))}start(e,t){e.enqueueRetryable(()=>t(Ot.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class kx{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class Nx{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,t){ot(this.o===void 0);const n=i=>{i.error!=null&&Ae("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${i.error.message}`);const l=i.token!==this.R;return this.R=i.token,Ae("FirebaseAppCheckTokenProvider",`Received ${l?"new":"existing"} token.`),l?t(i.token):Promise.resolve()};this.o=i=>{e.enqueueRetryable(()=>n(i))};const a=i=>{Ae("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=i,this.o&&this.appCheck.addTokenListener(this.o)};this.A.onInit(i=>a(i)),setTimeout(()=>{if(!this.appCheck){const i=this.A.getImmediate({optional:!0});i?a(i):Ae("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(ot(typeof t.token=="string"),this.R=t.token,new kx(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ex(r){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(r);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let n=0;n<r;n++)t[n]=Math.floor(256*Math.random());return t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rh{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length;let n="";for(;n.length<20;){const a=Ex(40);for(let i=0;i<a.length;++i)n.length<20&&a[i]<t&&(n+=e.charAt(a[i]%e.length))}return n}}function st(r,e){return r<e?-1:r>e?1:0}function sn(r,e,t){return r.length===e.length&&r.every((n,a)=>t(n,e[a]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _t{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new Te(ae.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new Te(ae.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new Te(ae.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new Te(ae.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return _t.fromMillis(Date.now())}static fromDate(e){return _t.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),n=Math.floor(1e6*(e-1e3*t));return new _t(t,n)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?st(this.nanoseconds,e.nanoseconds):st(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Be{constructor(e){this.timestamp=e}static fromTimestamp(e){return new Be(e)}static min(){return new Be(new _t(0,0))}static max(){return new Be(new _t(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gn{constructor(e,t,n){t===void 0?t=0:t>e.length&&Ue(),n===void 0?n=e.length-t:n>e.length-t&&Ue(),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return Gn.comparator(this,e)===0}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof Gn?e.forEach(n=>{t.push(n)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const n=Math.min(e.length,t.length);for(let a=0;a<n;a++){const i=e.get(a),l=t.get(a);if(i<l)return-1;if(i>l)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class ut extends Gn{construct(e,t,n){return new ut(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const n of e){if(n.indexOf("//")>=0)throw new Te(ae.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter(a=>a.length>0))}return new ut(t)}static emptyPath(){return new ut([])}}const jx=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class St extends Gn{construct(e,t,n){return new St(e,t,n)}static isValidIdentifier(e){return jx.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),St.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new St(["__name__"])}static fromServerFormat(e){const t=[];let n="",a=0;const i=()=>{if(n.length===0)throw new Te(ae.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""};let l=!1;for(;a<e.length;){const c=e[a];if(c==="\\"){if(a+1===e.length)throw new Te(ae.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const d=e[a+1];if(d!=="\\"&&d!=="."&&d!=="`")throw new Te(ae.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=d,a+=2}else c==="`"?(l=!l,a++):c!=="."||l?(n+=c,a++):(i(),a++)}if(i(),l)throw new Te(ae.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new St(t)}static emptyPath(){return new St([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $e{constructor(e){this.path=e}static fromPath(e){return new $e(ut.fromString(e))}static fromName(e){return new $e(ut.fromString(e).popFirst(5))}static empty(){return new $e(ut.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&ut.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return ut.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new $e(new ut(e.slice()))}}function Ix(r,e){const t=r.toTimestamp().seconds,n=r.toTimestamp().nanoseconds+1,a=Be.fromTimestamp(n===1e9?new _t(t+1,0):new _t(t,n));return new cs(a,$e.empty(),e)}function Tx(r){return new cs(r.readTime,r.key,-1)}class cs{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new cs(Be.min(),$e.empty(),-1)}static max(){return new cs(Be.max(),$e.empty(),-1)}}function Sx(r,e){let t=r.readTime.compareTo(e.readTime);return t!==0?t:(t=$e.comparator(r.documentKey,e.documentKey),t!==0?t:st(r.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ax="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class Cx{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function da(r){if(r.code!==ae.FAILED_PRECONDITION||r.message!==Ax)throw r;Ae("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ce{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&Ue(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new ce((n,a)=>{this.nextCallback=i=>{this.wrapSuccess(e,i).next(n,a)},this.catchCallback=i=>{this.wrapFailure(t,i).next(n,a)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof ce?t:ce.resolve(t)}catch(t){return ce.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):ce.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):ce.reject(t)}static resolve(e){return new ce((t,n)=>{t(e)})}static reject(e){return new ce((t,n)=>{n(e)})}static waitFor(e){return new ce((t,n)=>{let a=0,i=0,l=!1;e.forEach(c=>{++a,c.next(()=>{++i,l&&i===a&&t()},d=>n(d))}),l=!0,i===a&&t()})}static or(e){let t=ce.resolve(!1);for(const n of e)t=t.next(a=>a?ce.resolve(a):n());return t}static forEach(e,t){const n=[];return e.forEach((a,i)=>{n.push(t.call(this,a,i))}),this.waitFor(n)}static mapArray(e,t){return new ce((n,a)=>{const i=e.length,l=new Array(i);let c=0;for(let d=0;d<i;d++){const h=d;t(e[h]).next(g=>{l[h]=g,++c,c===i&&n(l)},g=>a(g))}})}static doWhile(e,t){return new ce((n,a)=>{const i=()=>{e()===!0?t().next(()=>{i()},a):n()};i()})}}function Rx(r){const e=r.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}function ua(r){return r.name==="IndexedDbTransactionError"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _l{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=n=>this.ie(n),this.se=n=>t.writeSequenceNumber(n))}ie(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.se&&this.se(e),e}}_l.oe=-1;function Oi(r){return r==null}function mi(r){return r===0&&1/r==-1/0}function Dx(r){return typeof r=="number"&&Number.isInteger(r)&&!mi(r)&&r<=Number.MAX_SAFE_INTEGER&&r>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ed(r){let e=0;for(const t in r)Object.prototype.hasOwnProperty.call(r,t)&&e++;return e}function Ds(r,e){for(const t in r)Object.prototype.hasOwnProperty.call(r,t)&&e(t,r[t])}function Dh(r){for(const e in r)if(Object.prototype.hasOwnProperty.call(r,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mt{constructor(e,t){this.comparator=e,this.root=t||Tt.EMPTY}insert(e,t){return new mt(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Tt.BLACK,null,null))}remove(e){return new mt(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Tt.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const n=this.comparator(e,t.key);if(n===0)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){const a=this.comparator(e,n.key);if(a===0)return t+n.left.size;a<0?n=n.left:(t+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,n)=>(e(t,n),!1))}toString(){const e=[];return this.inorderTraversal((t,n)=>(e.push(`${t}:${n}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new La(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new La(this.root,e,this.comparator,!1)}getReverseIterator(){return new La(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new La(this.root,e,this.comparator,!0)}}class La{constructor(e,t,n,a){this.isReverse=a,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?n(e.key,t):1,t&&a&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(i===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Tt{constructor(e,t,n,a,i){this.key=e,this.value=t,this.color=n??Tt.RED,this.left=a??Tt.EMPTY,this.right=i??Tt.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,a,i){return new Tt(e??this.key,t??this.value,n??this.color,a??this.left,i??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let a=this;const i=n(e,a.key);return a=i<0?a.copy(null,null,null,a.left.insert(e,t,n),null):i===0?a.copy(null,t,null,null,null):a.copy(null,null,null,null,a.right.insert(e,t,n)),a.fixUp()}removeMin(){if(this.left.isEmpty())return Tt.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let n,a=this;if(t(e,a.key)<0)a.left.isEmpty()||a.left.isRed()||a.left.left.isRed()||(a=a.moveRedLeft()),a=a.copy(null,null,null,a.left.remove(e,t),null);else{if(a.left.isRed()&&(a=a.rotateRight()),a.right.isEmpty()||a.right.isRed()||a.right.left.isRed()||(a=a.moveRedRight()),t(e,a.key)===0){if(a.right.isEmpty())return Tt.EMPTY;n=a.right.min(),a=a.copy(n.key,n.value,null,null,a.right.removeMin())}a=a.copy(null,null,null,null,a.right.remove(e,t))}return a.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Tt.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Tt.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw Ue();const e=this.left.check();if(e!==this.right.check())throw Ue();return e+(this.isRed()?0:1)}}Tt.EMPTY=null,Tt.RED=!0,Tt.BLACK=!1;Tt.EMPTY=new class{constructor(){this.size=0}get key(){throw Ue()}get value(){throw Ue()}get color(){throw Ue()}get left(){throw Ue()}get right(){throw Ue()}copy(e,t,n,a,i){return this}insert(e,t,n){return new Tt(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ct{constructor(e){this.comparator=e,this.data=new mt(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,n)=>(e(t),!1))}forEachInRange(e,t){const n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){const a=n.getNext();if(this.comparator(a.key,e[1])>=0)return;t(a.key)}}forEachWhile(e,t){let n;for(n=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new jd(this.data.getIterator())}getIteratorFrom(e){return new jd(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(n=>{t=t.add(n)}),t}isEqual(e){if(!(e instanceof Ct)||this.size!==e.size)return!1;const t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){const a=t.getNext().key,i=n.getNext().key;if(this.comparator(a,i)!==0)return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new Ct(this.comparator);return t.data=e,t}}class jd{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xt{constructor(e){this.fields=e,e.sort(St.comparator)}static empty(){return new Xt([])}unionWith(e){let t=new Ct(St.comparator);for(const n of this.fields)t=t.add(n);for(const n of e)t=t.add(n);return new Xt(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return sn(this.fields,e.fields,(t,n)=>t.isEqual(n))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ph extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rt{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(a){try{return atob(a)}catch(i){throw typeof DOMException<"u"&&i instanceof DOMException?new Ph("Invalid base64 string: "+i):i}}(e);return new Rt(t)}static fromUint8Array(e){const t=function(a){let i="";for(let l=0;l<a.length;++l)i+=String.fromCharCode(a[l]);return i}(e);return new Rt(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(t){return btoa(t)}(this.binaryString)}toUint8Array(){return function(t){const n=new Uint8Array(t.length);for(let a=0;a<t.length;a++)n[a]=t.charCodeAt(a);return n}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return st(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Rt.EMPTY_BYTE_STRING=new Rt("");const Px=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function ds(r){if(ot(!!r),typeof r=="string"){let e=0;const t=Px.exec(r);if(ot(!!t),t[1]){let a=t[1];a=(a+"000000000").substr(0,9),e=Number(a)}const n=new Date(r);return{seconds:Math.floor(n.getTime()/1e3),nanos:e}}return{seconds:xt(r.seconds),nanos:xt(r.nanos)}}function xt(r){return typeof r=="number"?r:typeof r=="string"?Number(r):0}function Is(r){return typeof r=="string"?Rt.fromBase64String(r):Rt.fromUint8Array(r)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function kl(r){var e,t;return((t=(((e=r==null?void 0:r.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||t===void 0?void 0:t.stringValue)==="server_timestamp"}function Nl(r){const e=r.mapValue.fields.__previous_value__;return kl(e)?Nl(e):e}function Kn(r){const e=ds(r.mapValue.fields.__local_write_time__.timestampValue);return new _t(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $x{constructor(e,t,n,a,i,l,c,d,h){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=a,this.ssl=i,this.forceLongPolling=l,this.autoDetectLongPolling=c,this.longPollingOptions=d,this.useFetchStreams=h}}class Qn{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new Qn("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(e){return e instanceof Qn&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Fa={mapValue:{}};function Ts(r){return"nullValue"in r?0:"booleanValue"in r?1:"integerValue"in r||"doubleValue"in r?2:"timestampValue"in r?3:"stringValue"in r?5:"bytesValue"in r?6:"referenceValue"in r?7:"geoPointValue"in r?8:"arrayValue"in r?9:"mapValue"in r?kl(r)?4:Ox(r)?9007199254740991:Mx(r)?10:11:Ue()}function vr(r,e){if(r===e)return!0;const t=Ts(r);if(t!==Ts(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return r.booleanValue===e.booleanValue;case 4:return Kn(r).isEqual(Kn(e));case 3:return function(a,i){if(typeof a.timestampValue=="string"&&typeof i.timestampValue=="string"&&a.timestampValue.length===i.timestampValue.length)return a.timestampValue===i.timestampValue;const l=ds(a.timestampValue),c=ds(i.timestampValue);return l.seconds===c.seconds&&l.nanos===c.nanos}(r,e);case 5:return r.stringValue===e.stringValue;case 6:return function(a,i){return Is(a.bytesValue).isEqual(Is(i.bytesValue))}(r,e);case 7:return r.referenceValue===e.referenceValue;case 8:return function(a,i){return xt(a.geoPointValue.latitude)===xt(i.geoPointValue.latitude)&&xt(a.geoPointValue.longitude)===xt(i.geoPointValue.longitude)}(r,e);case 2:return function(a,i){if("integerValue"in a&&"integerValue"in i)return xt(a.integerValue)===xt(i.integerValue);if("doubleValue"in a&&"doubleValue"in i){const l=xt(a.doubleValue),c=xt(i.doubleValue);return l===c?mi(l)===mi(c):isNaN(l)&&isNaN(c)}return!1}(r,e);case 9:return sn(r.arrayValue.values||[],e.arrayValue.values||[],vr);case 10:case 11:return function(a,i){const l=a.mapValue.fields||{},c=i.mapValue.fields||{};if(Ed(l)!==Ed(c))return!1;for(const d in l)if(l.hasOwnProperty(d)&&(c[d]===void 0||!vr(l[d],c[d])))return!1;return!0}(r,e);default:return Ue()}}function Yn(r,e){return(r.values||[]).find(t=>vr(t,e))!==void 0}function nn(r,e){if(r===e)return 0;const t=Ts(r),n=Ts(e);if(t!==n)return st(t,n);switch(t){case 0:case 9007199254740991:return 0;case 1:return st(r.booleanValue,e.booleanValue);case 2:return function(i,l){const c=xt(i.integerValue||i.doubleValue),d=xt(l.integerValue||l.doubleValue);return c<d?-1:c>d?1:c===d?0:isNaN(c)?isNaN(d)?0:-1:1}(r,e);case 3:return Id(r.timestampValue,e.timestampValue);case 4:return Id(Kn(r),Kn(e));case 5:return st(r.stringValue,e.stringValue);case 6:return function(i,l){const c=Is(i),d=Is(l);return c.compareTo(d)}(r.bytesValue,e.bytesValue);case 7:return function(i,l){const c=i.split("/"),d=l.split("/");for(let h=0;h<c.length&&h<d.length;h++){const g=st(c[h],d[h]);if(g!==0)return g}return st(c.length,d.length)}(r.referenceValue,e.referenceValue);case 8:return function(i,l){const c=st(xt(i.latitude),xt(l.latitude));return c!==0?c:st(xt(i.longitude),xt(l.longitude))}(r.geoPointValue,e.geoPointValue);case 9:return Td(r.arrayValue,e.arrayValue);case 10:return function(i,l){var c,d,h,g;const x=i.fields||{},p=l.fields||{},E=(c=x.value)===null||c===void 0?void 0:c.arrayValue,j=(d=p.value)===null||d===void 0?void 0:d.arrayValue,S=st(((h=E==null?void 0:E.values)===null||h===void 0?void 0:h.length)||0,((g=j==null?void 0:j.values)===null||g===void 0?void 0:g.length)||0);return S!==0?S:Td(E,j)}(r.mapValue,e.mapValue);case 11:return function(i,l){if(i===Fa.mapValue&&l===Fa.mapValue)return 0;if(i===Fa.mapValue)return 1;if(l===Fa.mapValue)return-1;const c=i.fields||{},d=Object.keys(c),h=l.fields||{},g=Object.keys(h);d.sort(),g.sort();for(let x=0;x<d.length&&x<g.length;++x){const p=st(d[x],g[x]);if(p!==0)return p;const E=nn(c[d[x]],h[g[x]]);if(E!==0)return E}return st(d.length,g.length)}(r.mapValue,e.mapValue);default:throw Ue()}}function Id(r,e){if(typeof r=="string"&&typeof e=="string"&&r.length===e.length)return st(r,e);const t=ds(r),n=ds(e),a=st(t.seconds,n.seconds);return a!==0?a:st(t.nanos,n.nanos)}function Td(r,e){const t=r.values||[],n=e.values||[];for(let a=0;a<t.length&&a<n.length;++a){const i=nn(t[a],n[a]);if(i)return i}return st(t.length,n.length)}function an(r){return qo(r)}function qo(r){return"nullValue"in r?"null":"booleanValue"in r?""+r.booleanValue:"integerValue"in r?""+r.integerValue:"doubleValue"in r?""+r.doubleValue:"timestampValue"in r?function(t){const n=ds(t);return`time(${n.seconds},${n.nanos})`}(r.timestampValue):"stringValue"in r?r.stringValue:"bytesValue"in r?function(t){return Is(t).toBase64()}(r.bytesValue):"referenceValue"in r?function(t){return $e.fromName(t).toString()}(r.referenceValue):"geoPointValue"in r?function(t){return`geo(${t.latitude},${t.longitude})`}(r.geoPointValue):"arrayValue"in r?function(t){let n="[",a=!0;for(const i of t.values||[])a?a=!1:n+=",",n+=qo(i);return n+"]"}(r.arrayValue):"mapValue"in r?function(t){const n=Object.keys(t.fields||{}).sort();let a="{",i=!0;for(const l of n)i?i=!1:a+=",",a+=`${l}:${qo(t.fields[l])}`;return a+"}"}(r.mapValue):Ue()}function Sd(r,e){return{referenceValue:`projects/${r.projectId}/databases/${r.database}/documents/${e.path.canonicalString()}`}}function Wo(r){return!!r&&"integerValue"in r}function El(r){return!!r&&"arrayValue"in r}function Ad(r){return!!r&&"nullValue"in r}function Cd(r){return!!r&&"doubleValue"in r&&isNaN(Number(r.doubleValue))}function Ya(r){return!!r&&"mapValue"in r}function Mx(r){var e,t;return((t=(((e=r==null?void 0:r.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||t===void 0?void 0:t.stringValue)==="__vector__"}function Ln(r){if(r.geoPointValue)return{geoPointValue:Object.assign({},r.geoPointValue)};if(r.timestampValue&&typeof r.timestampValue=="object")return{timestampValue:Object.assign({},r.timestampValue)};if(r.mapValue){const e={mapValue:{fields:{}}};return Ds(r.mapValue.fields,(t,n)=>e.mapValue.fields[t]=Ln(n)),e}if(r.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(r.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=Ln(r.arrayValue.values[t]);return e}return Object.assign({},r)}function Ox(r){return(((r.mapValue||{}).fields||{}).__type__||{}).stringValue==="__max__"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ht{constructor(e){this.value=e}static empty(){return new Ht({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(t=(t.mapValue.fields||{})[e.get(n)],!Ya(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Ln(t)}setAll(e){let t=St.emptyPath(),n={},a=[];e.forEach((l,c)=>{if(!t.isImmediateParentOf(c)){const d=this.getFieldsMap(t);this.applyChanges(d,n,a),n={},a=[],t=c.popLast()}l?n[c.lastSegment()]=Ln(l):a.push(c.lastSegment())});const i=this.getFieldsMap(t);this.applyChanges(i,n,a)}delete(e){const t=this.field(e.popLast());Ya(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return vr(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let a=t.mapValue.fields[e.get(n)];Ya(a)&&a.mapValue.fields||(a={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=a),t=a}return t.mapValue.fields}applyChanges(e,t,n){Ds(t,(a,i)=>e[a]=i);for(const a of n)delete e[a]}clone(){return new Ht(Ln(this.value))}}function $h(r){const e=[];return Ds(r.fields,(t,n)=>{const a=new St([t]);if(Ya(n)){const i=$h(n.mapValue).fields;if(i.length===0)e.push(a);else for(const l of i)e.push(a.child(l))}else e.push(a)}),new Xt(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vt{constructor(e,t,n,a,i,l,c){this.key=e,this.documentType=t,this.version=n,this.readTime=a,this.createTime=i,this.data=l,this.documentState=c}static newInvalidDocument(e){return new Vt(e,0,Be.min(),Be.min(),Be.min(),Ht.empty(),0)}static newFoundDocument(e,t,n,a){return new Vt(e,1,t,Be.min(),n,a,0)}static newNoDocument(e,t){return new Vt(e,2,t,Be.min(),Be.min(),Ht.empty(),0)}static newUnknownDocument(e,t){return new Vt(e,3,t,Be.min(),Be.min(),Ht.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(Be.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Ht.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Ht.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=Be.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof Vt&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new Vt(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gi{constructor(e,t){this.position=e,this.inclusive=t}}function Rd(r,e,t){let n=0;for(let a=0;a<r.position.length;a++){const i=e[a],l=r.position[a];if(i.field.isKeyField()?n=$e.comparator($e.fromName(l.referenceValue),t.key):n=nn(l,t.data.field(i.field)),i.dir==="desc"&&(n*=-1),n!==0)break}return n}function Dd(r,e){if(r===null)return e===null;if(e===null||r.inclusive!==e.inclusive||r.position.length!==e.position.length)return!1;for(let t=0;t<r.position.length;t++)if(!vr(r.position[t],e.position[t]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xn{constructor(e,t="asc"){this.field=e,this.dir=t}}function Vx(r,e){return r.dir===e.dir&&r.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mh{}class vt extends Mh{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,n):new Fx(e,t,n):t==="array-contains"?new qx(e,n):t==="in"?new Wx(e,n):t==="not-in"?new zx(e,n):t==="array-contains-any"?new Hx(e,n):new vt(e,t,n)}static createKeyFieldInFilter(e,t,n){return t==="in"?new Ux(e,n):new Bx(e,n)}matches(e){const t=e.data.field(this.field);return this.op==="!="?t!==null&&this.matchesComparison(nn(t,this.value)):t!==null&&Ts(this.value)===Ts(t)&&this.matchesComparison(nn(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return Ue()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class or extends Mh{constructor(e,t){super(),this.filters=e,this.op=t,this.ae=null}static create(e,t){return new or(e,t)}matches(e){return Oh(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.ae!==null||(this.ae=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.ae}getFilters(){return Object.assign([],this.filters)}}function Oh(r){return r.op==="and"}function Vh(r){return Lx(r)&&Oh(r)}function Lx(r){for(const e of r.filters)if(e instanceof or)return!1;return!0}function zo(r){if(r instanceof vt)return r.field.canonicalString()+r.op.toString()+an(r.value);if(Vh(r))return r.filters.map(e=>zo(e)).join(",");{const e=r.filters.map(t=>zo(t)).join(",");return`${r.op}(${e})`}}function Lh(r,e){return r instanceof vt?function(n,a){return a instanceof vt&&n.op===a.op&&n.field.isEqual(a.field)&&vr(n.value,a.value)}(r,e):r instanceof or?function(n,a){return a instanceof or&&n.op===a.op&&n.filters.length===a.filters.length?n.filters.reduce((i,l,c)=>i&&Lh(l,a.filters[c]),!0):!1}(r,e):void Ue()}function Fh(r){return r instanceof vt?function(t){return`${t.field.canonicalString()} ${t.op} ${an(t.value)}`}(r):r instanceof or?function(t){return t.op.toString()+" {"+t.getFilters().map(Fh).join(" ,")+"}"}(r):"Filter"}class Fx extends vt{constructor(e,t,n){super(e,t,n),this.key=$e.fromName(n.referenceValue)}matches(e){const t=$e.comparator(e.key,this.key);return this.matchesComparison(t)}}class Ux extends vt{constructor(e,t){super(e,"in",t),this.keys=Uh("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class Bx extends vt{constructor(e,t){super(e,"not-in",t),this.keys=Uh("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function Uh(r,e){var t;return(((t=e.arrayValue)===null||t===void 0?void 0:t.values)||[]).map(n=>$e.fromName(n.referenceValue))}class qx extends vt{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return El(t)&&Yn(t.arrayValue,this.value)}}class Wx extends vt{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return t!==null&&Yn(this.value.arrayValue,t)}}class zx extends vt{constructor(e,t){super(e,"not-in",t)}matches(e){if(Yn(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return t!==null&&!Yn(this.value.arrayValue,t)}}class Hx extends vt{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!El(t)||!t.arrayValue.values)&&t.arrayValue.values.some(n=>Yn(this.value.arrayValue,n))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gx{constructor(e,t=null,n=[],a=[],i=null,l=null,c=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=a,this.limit=i,this.startAt=l,this.endAt=c,this.ue=null}}function Pd(r,e=null,t=[],n=[],a=null,i=null,l=null){return new Gx(r,e,t,n,a,i,l)}function jl(r){const e=qe(r);if(e.ue===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(n=>zo(n)).join(","),t+="|ob:",t+=e.orderBy.map(n=>function(i){return i.field.canonicalString()+i.dir}(n)).join(","),Oi(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(n=>an(n)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(n=>an(n)).join(",")),e.ue=t}return e.ue}function Il(r,e){if(r.limit!==e.limit||r.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<r.orderBy.length;t++)if(!Vx(r.orderBy[t],e.orderBy[t]))return!1;if(r.filters.length!==e.filters.length)return!1;for(let t=0;t<r.filters.length;t++)if(!Lh(r.filters[t],e.filters[t]))return!1;return r.collectionGroup===e.collectionGroup&&!!r.path.isEqual(e.path)&&!!Dd(r.startAt,e.startAt)&&Dd(r.endAt,e.endAt)}function Ho(r){return $e.isDocumentKey(r.path)&&r.collectionGroup===null&&r.filters.length===0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mn{constructor(e,t=null,n=[],a=[],i=null,l="F",c=null,d=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=a,this.limit=i,this.limitType=l,this.startAt=c,this.endAt=d,this.ce=null,this.le=null,this.he=null,this.startAt,this.endAt}}function Kx(r,e,t,n,a,i,l,c){return new mn(r,e,t,n,a,i,l,c)}function Bh(r){return new mn(r)}function $d(r){return r.filters.length===0&&r.limit===null&&r.startAt==null&&r.endAt==null&&(r.explicitOrderBy.length===0||r.explicitOrderBy.length===1&&r.explicitOrderBy[0].field.isKeyField())}function qh(r){return r.collectionGroup!==null}function Fn(r){const e=qe(r);if(e.ce===null){e.ce=[];const t=new Set;for(const i of e.explicitOrderBy)e.ce.push(i),t.add(i.field.canonicalString());const n=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(l){let c=new Ct(St.comparator);return l.filters.forEach(d=>{d.getFlattenedFilters().forEach(h=>{h.isInequality()&&(c=c.add(h.field))})}),c})(e).forEach(i=>{t.has(i.canonicalString())||i.isKeyField()||e.ce.push(new Xn(i,n))}),t.has(St.keyField().canonicalString())||e.ce.push(new Xn(St.keyField(),n))}return e.ce}function pr(r){const e=qe(r);return e.le||(e.le=Qx(e,Fn(r))),e.le}function Qx(r,e){if(r.limitType==="F")return Pd(r.path,r.collectionGroup,e,r.filters,r.limit,r.startAt,r.endAt);{e=e.map(a=>{const i=a.dir==="desc"?"asc":"desc";return new Xn(a.field,i)});const t=r.endAt?new gi(r.endAt.position,r.endAt.inclusive):null,n=r.startAt?new gi(r.startAt.position,r.startAt.inclusive):null;return Pd(r.path,r.collectionGroup,e,r.filters,r.limit,t,n)}}function Go(r,e){const t=r.filters.concat([e]);return new mn(r.path,r.collectionGroup,r.explicitOrderBy.slice(),t,r.limit,r.limitType,r.startAt,r.endAt)}function Ko(r,e,t){return new mn(r.path,r.collectionGroup,r.explicitOrderBy.slice(),r.filters.slice(),e,t,r.startAt,r.endAt)}function Vi(r,e){return Il(pr(r),pr(e))&&r.limitType===e.limitType}function Wh(r){return`${jl(pr(r))}|lt:${r.limitType}`}function qs(r){return`Query(target=${function(t){let n=t.path.canonicalString();return t.collectionGroup!==null&&(n+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(n+=`, filters: [${t.filters.map(a=>Fh(a)).join(", ")}]`),Oi(t.limit)||(n+=", limit: "+t.limit),t.orderBy.length>0&&(n+=`, orderBy: [${t.orderBy.map(a=>function(l){return`${l.field.canonicalString()} (${l.dir})`}(a)).join(", ")}]`),t.startAt&&(n+=", startAt: ",n+=t.startAt.inclusive?"b:":"a:",n+=t.startAt.position.map(a=>an(a)).join(",")),t.endAt&&(n+=", endAt: ",n+=t.endAt.inclusive?"a:":"b:",n+=t.endAt.position.map(a=>an(a)).join(",")),`Target(${n})`}(pr(r))}; limitType=${r.limitType})`}function Li(r,e){return e.isFoundDocument()&&function(n,a){const i=a.key.path;return n.collectionGroup!==null?a.key.hasCollectionId(n.collectionGroup)&&n.path.isPrefixOf(i):$e.isDocumentKey(n.path)?n.path.isEqual(i):n.path.isImmediateParentOf(i)}(r,e)&&function(n,a){for(const i of Fn(n))if(!i.field.isKeyField()&&a.data.field(i.field)===null)return!1;return!0}(r,e)&&function(n,a){for(const i of n.filters)if(!i.matches(a))return!1;return!0}(r,e)&&function(n,a){return!(n.startAt&&!function(l,c,d){const h=Rd(l,c,d);return l.inclusive?h<=0:h<0}(n.startAt,Fn(n),a)||n.endAt&&!function(l,c,d){const h=Rd(l,c,d);return l.inclusive?h>=0:h>0}(n.endAt,Fn(n),a))}(r,e)}function Yx(r){return r.collectionGroup||(r.path.length%2==1?r.path.lastSegment():r.path.get(r.path.length-2))}function zh(r){return(e,t)=>{let n=!1;for(const a of Fn(r)){const i=Xx(a,e,t);if(i!==0)return i;n=n||a.field.isKeyField()}return 0}}function Xx(r,e,t){const n=r.field.isKeyField()?$e.comparator(e.key,t.key):function(i,l,c){const d=l.data.field(i),h=c.data.field(i);return d!==null&&h!==null?nn(d,h):Ue()}(r.field,e,t);switch(r.dir){case"asc":return n;case"desc":return-1*n;default:return Ue()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gn{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),n=this.inner[t];if(n!==void 0){for(const[a,i]of n)if(this.equalsFn(a,e))return i}}has(e){return this.get(e)!==void 0}set(e,t){const n=this.mapKeyFn(e),a=this.inner[n];if(a===void 0)return this.inner[n]=[[e,t]],void this.innerSize++;for(let i=0;i<a.length;i++)if(this.equalsFn(a[i][0],e))return void(a[i]=[e,t]);a.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),n=this.inner[t];if(n===void 0)return!1;for(let a=0;a<n.length;a++)if(this.equalsFn(n[a][0],e))return n.length===1?delete this.inner[t]:n.splice(a,1),this.innerSize--,!0;return!1}forEach(e){Ds(this.inner,(t,n)=>{for(const[a,i]of n)e(a,i)})}isEmpty(){return Dh(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Jx=new mt($e.comparator);function Or(){return Jx}const Hh=new mt($e.comparator);function $n(...r){let e=Hh;for(const t of r)e=e.insert(t.key,t);return e}function Gh(r){let e=Hh;return r.forEach((t,n)=>e=e.insert(t,n.overlayedDocument)),e}function vs(){return Un()}function Kh(){return Un()}function Un(){return new gn(r=>r.toString(),(r,e)=>r.isEqual(e))}const Zx=new mt($e.comparator),ey=new Ct($e.comparator);function Ke(...r){let e=ey;for(const t of r)e=e.add(t);return e}const ty=new Ct(st);function ry(){return ty}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Tl(r,e){if(r.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:mi(e)?"-0":e}}function Qh(r){return{integerValue:""+r}}function sy(r,e){return Dx(e)?Qh(e):Tl(r,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fi{constructor(){this._=void 0}}function ny(r,e,t){return r instanceof pi?function(a,i){const l={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:a.seconds,nanos:a.nanoseconds}}}};return i&&kl(i)&&(i=Nl(i)),i&&(l.fields.__previous_value__=i),{mapValue:l}}(t,e):r instanceof Jn?Xh(r,e):r instanceof Zn?Jh(r,e):function(a,i){const l=Yh(a,i),c=Md(l)+Md(a.Pe);return Wo(l)&&Wo(a.Pe)?Qh(c):Tl(a.serializer,c)}(r,e)}function ay(r,e,t){return r instanceof Jn?Xh(r,e):r instanceof Zn?Jh(r,e):t}function Yh(r,e){return r instanceof fi?function(n){return Wo(n)||function(i){return!!i&&"doubleValue"in i}(n)}(e)?e:{integerValue:0}:null}class pi extends Fi{}class Jn extends Fi{constructor(e){super(),this.elements=e}}function Xh(r,e){const t=Zh(e);for(const n of r.elements)t.some(a=>vr(a,n))||t.push(n);return{arrayValue:{values:t}}}class Zn extends Fi{constructor(e){super(),this.elements=e}}function Jh(r,e){let t=Zh(e);for(const n of r.elements)t=t.filter(a=>!vr(a,n));return{arrayValue:{values:t}}}class fi extends Fi{constructor(e,t){super(),this.serializer=e,this.Pe=t}}function Md(r){return xt(r.integerValue||r.doubleValue)}function Zh(r){return El(r)&&r.arrayValue.values?r.arrayValue.values.slice():[]}function iy(r,e){return r.field.isEqual(e.field)&&function(n,a){return n instanceof Jn&&a instanceof Jn||n instanceof Zn&&a instanceof Zn?sn(n.elements,a.elements,vr):n instanceof fi&&a instanceof fi?vr(n.Pe,a.Pe):n instanceof pi&&a instanceof pi}(r.transform,e.transform)}class oy{constructor(e,t){this.version=e,this.transformResults=t}}class ar{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new ar}static exists(e){return new ar(void 0,e)}static updateTime(e){return new ar(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Xa(r,e){return r.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(r.updateTime):r.exists===void 0||r.exists===e.isFoundDocument()}class Ui{}function em(r,e){if(!r.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return r.isNoDocument()?new Sl(r.key,ar.none()):new ha(r.key,r.data,ar.none());{const t=r.data,n=Ht.empty();let a=new Ct(St.comparator);for(let i of e.fields)if(!a.has(i)){let l=t.field(i);l===null&&i.length>1&&(i=i.popLast(),l=t.field(i)),l===null?n.delete(i):n.set(i,l),a=a.add(i)}return new hs(r.key,n,new Xt(a.toArray()),ar.none())}}function ly(r,e,t){r instanceof ha?function(a,i,l){const c=a.value.clone(),d=Vd(a.fieldTransforms,i,l.transformResults);c.setAll(d),i.convertToFoundDocument(l.version,c).setHasCommittedMutations()}(r,e,t):r instanceof hs?function(a,i,l){if(!Xa(a.precondition,i))return void i.convertToUnknownDocument(l.version);const c=Vd(a.fieldTransforms,i,l.transformResults),d=i.data;d.setAll(tm(a)),d.setAll(c),i.convertToFoundDocument(l.version,d).setHasCommittedMutations()}(r,e,t):function(a,i,l){i.convertToNoDocument(l.version).setHasCommittedMutations()}(0,e,t)}function Bn(r,e,t,n){return r instanceof ha?function(i,l,c,d){if(!Xa(i.precondition,l))return c;const h=i.value.clone(),g=Ld(i.fieldTransforms,d,l);return h.setAll(g),l.convertToFoundDocument(l.version,h).setHasLocalMutations(),null}(r,e,t,n):r instanceof hs?function(i,l,c,d){if(!Xa(i.precondition,l))return c;const h=Ld(i.fieldTransforms,d,l),g=l.data;return g.setAll(tm(i)),g.setAll(h),l.convertToFoundDocument(l.version,g).setHasLocalMutations(),c===null?null:c.unionWith(i.fieldMask.fields).unionWith(i.fieldTransforms.map(x=>x.field))}(r,e,t,n):function(i,l,c){return Xa(i.precondition,l)?(l.convertToNoDocument(l.version).setHasLocalMutations(),null):c}(r,e,t)}function cy(r,e){let t=null;for(const n of r.fieldTransforms){const a=e.data.field(n.field),i=Yh(n.transform,a||null);i!=null&&(t===null&&(t=Ht.empty()),t.set(n.field,i))}return t||null}function Od(r,e){return r.type===e.type&&!!r.key.isEqual(e.key)&&!!r.precondition.isEqual(e.precondition)&&!!function(n,a){return n===void 0&&a===void 0||!(!n||!a)&&sn(n,a,(i,l)=>iy(i,l))}(r.fieldTransforms,e.fieldTransforms)&&(r.type===0?r.value.isEqual(e.value):r.type!==1||r.data.isEqual(e.data)&&r.fieldMask.isEqual(e.fieldMask))}class ha extends Ui{constructor(e,t,n,a=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=a,this.type=0}getFieldMask(){return null}}class hs extends Ui{constructor(e,t,n,a,i=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=a,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function tm(r){const e=new Map;return r.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){const n=r.data.field(t);e.set(t,n)}}),e}function Vd(r,e,t){const n=new Map;ot(r.length===t.length);for(let a=0;a<t.length;a++){const i=r[a],l=i.transform,c=e.data.field(i.field);n.set(i.field,ay(l,c,t[a]))}return n}function Ld(r,e,t){const n=new Map;for(const a of r){const i=a.transform,l=t.data.field(a.field);n.set(a.field,ny(i,l,e))}return n}class Sl extends Ui{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class dy extends Ui{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uy{constructor(e,t,n,a){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=a}applyToRemoteDocument(e,t){const n=t.mutationResults;for(let a=0;a<this.mutations.length;a++){const i=this.mutations[a];i.key.isEqual(e.key)&&ly(i,e,n[a])}}applyToLocalView(e,t){for(const n of this.baseMutations)n.key.isEqual(e.key)&&(t=Bn(n,e,t,this.localWriteTime));for(const n of this.mutations)n.key.isEqual(e.key)&&(t=Bn(n,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const n=Kh();return this.mutations.forEach(a=>{const i=e.get(a.key),l=i.overlayedDocument;let c=this.applyToLocalView(l,i.mutatedFields);c=t.has(a.key)?null:c;const d=em(l,c);d!==null&&n.set(a.key,d),l.isValidDocument()||l.convertToNoDocument(Be.min())}),n}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),Ke())}isEqual(e){return this.batchId===e.batchId&&sn(this.mutations,e.mutations,(t,n)=>Od(t,n))&&sn(this.baseMutations,e.baseMutations,(t,n)=>Od(t,n))}}class Al{constructor(e,t,n,a){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=a}static from(e,t,n){ot(e.mutations.length===n.length);let a=function(){return Zx}();const i=e.mutations;for(let l=0;l<i.length;l++)a=a.insert(i[l].key,n[l].version);return new Al(e,t,n,a)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hy{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class my{constructor(e,t){this.count=e,this.unchangedNames=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var bt,Ze;function gy(r){switch(r){default:return Ue();case ae.CANCELLED:case ae.UNKNOWN:case ae.DEADLINE_EXCEEDED:case ae.RESOURCE_EXHAUSTED:case ae.INTERNAL:case ae.UNAVAILABLE:case ae.UNAUTHENTICATED:return!1;case ae.INVALID_ARGUMENT:case ae.NOT_FOUND:case ae.ALREADY_EXISTS:case ae.PERMISSION_DENIED:case ae.FAILED_PRECONDITION:case ae.ABORTED:case ae.OUT_OF_RANGE:case ae.UNIMPLEMENTED:case ae.DATA_LOSS:return!0}}function rm(r){if(r===void 0)return Mr("GRPC error has no .code"),ae.UNKNOWN;switch(r){case bt.OK:return ae.OK;case bt.CANCELLED:return ae.CANCELLED;case bt.UNKNOWN:return ae.UNKNOWN;case bt.DEADLINE_EXCEEDED:return ae.DEADLINE_EXCEEDED;case bt.RESOURCE_EXHAUSTED:return ae.RESOURCE_EXHAUSTED;case bt.INTERNAL:return ae.INTERNAL;case bt.UNAVAILABLE:return ae.UNAVAILABLE;case bt.UNAUTHENTICATED:return ae.UNAUTHENTICATED;case bt.INVALID_ARGUMENT:return ae.INVALID_ARGUMENT;case bt.NOT_FOUND:return ae.NOT_FOUND;case bt.ALREADY_EXISTS:return ae.ALREADY_EXISTS;case bt.PERMISSION_DENIED:return ae.PERMISSION_DENIED;case bt.FAILED_PRECONDITION:return ae.FAILED_PRECONDITION;case bt.ABORTED:return ae.ABORTED;case bt.OUT_OF_RANGE:return ae.OUT_OF_RANGE;case bt.UNIMPLEMENTED:return ae.UNIMPLEMENTED;case bt.DATA_LOSS:return ae.DATA_LOSS;default:return Ue()}}(Ze=bt||(bt={}))[Ze.OK=0]="OK",Ze[Ze.CANCELLED=1]="CANCELLED",Ze[Ze.UNKNOWN=2]="UNKNOWN",Ze[Ze.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Ze[Ze.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Ze[Ze.NOT_FOUND=5]="NOT_FOUND",Ze[Ze.ALREADY_EXISTS=6]="ALREADY_EXISTS",Ze[Ze.PERMISSION_DENIED=7]="PERMISSION_DENIED",Ze[Ze.UNAUTHENTICATED=16]="UNAUTHENTICATED",Ze[Ze.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Ze[Ze.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Ze[Ze.ABORTED=10]="ABORTED",Ze[Ze.OUT_OF_RANGE=11]="OUT_OF_RANGE",Ze[Ze.UNIMPLEMENTED=12]="UNIMPLEMENTED",Ze[Ze.INTERNAL=13]="INTERNAL",Ze[Ze.UNAVAILABLE=14]="UNAVAILABLE",Ze[Ze.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function py(){return new TextEncoder}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fy=new ks([4294967295,4294967295],0);function Fd(r){const e=py().encode(r),t=new Eh;return t.update(e),new Uint8Array(t.digest())}function Ud(r){const e=new DataView(r.buffer),t=e.getUint32(0,!0),n=e.getUint32(4,!0),a=e.getUint32(8,!0),i=e.getUint32(12,!0);return[new ks([t,n],0),new ks([a,i],0)]}class Cl{constructor(e,t,n){if(this.bitmap=e,this.padding=t,this.hashCount=n,t<0||t>=8)throw new Mn(`Invalid padding: ${t}`);if(n<0)throw new Mn(`Invalid hash count: ${n}`);if(e.length>0&&this.hashCount===0)throw new Mn(`Invalid hash count: ${n}`);if(e.length===0&&t!==0)throw new Mn(`Invalid padding when bitmap length is 0: ${t}`);this.Ie=8*e.length-t,this.Te=ks.fromNumber(this.Ie)}Ee(e,t,n){let a=e.add(t.multiply(ks.fromNumber(n)));return a.compare(fy)===1&&(a=new ks([a.getBits(0),a.getBits(1)],0)),a.modulo(this.Te).toNumber()}de(e){return(this.bitmap[Math.floor(e/8)]&1<<e%8)!=0}mightContain(e){if(this.Ie===0)return!1;const t=Fd(e),[n,a]=Ud(t);for(let i=0;i<this.hashCount;i++){const l=this.Ee(n,a,i);if(!this.de(l))return!1}return!0}static create(e,t,n){const a=e%8==0?0:8-e%8,i=new Uint8Array(Math.ceil(e/8)),l=new Cl(i,a,t);return n.forEach(c=>l.insert(c)),l}insert(e){if(this.Ie===0)return;const t=Fd(e),[n,a]=Ud(t);for(let i=0;i<this.hashCount;i++){const l=this.Ee(n,a,i);this.Ae(l)}}Ae(e){const t=Math.floor(e/8),n=e%8;this.bitmap[t]|=1<<n}}class Mn extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bi{constructor(e,t,n,a,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=a,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,n){const a=new Map;return a.set(e,ma.createSynthesizedTargetChangeForCurrentChange(e,t,n)),new Bi(Be.min(),a,new mt(st),Or(),Ke())}}class ma{constructor(e,t,n,a,i){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=a,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,n){return new ma(n,t,Ke(),Ke(),Ke())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ja{constructor(e,t,n,a){this.Re=e,this.removedTargetIds=t,this.key=n,this.Ve=a}}class sm{constructor(e,t){this.targetId=e,this.me=t}}class nm{constructor(e,t,n=Rt.EMPTY_BYTE_STRING,a=null){this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=a}}class Bd{constructor(){this.fe=0,this.ge=Wd(),this.pe=Rt.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return this.fe!==0}get be(){return this.we}De(e){e.approximateByteSize()>0&&(this.we=!0,this.pe=e)}ve(){let e=Ke(),t=Ke(),n=Ke();return this.ge.forEach((a,i)=>{switch(i){case 0:e=e.add(a);break;case 2:t=t.add(a);break;case 1:n=n.add(a);break;default:Ue()}}),new ma(this.pe,this.ye,e,t,n)}Ce(){this.we=!1,this.ge=Wd()}Fe(e,t){this.we=!0,this.ge=this.ge.insert(e,t)}Me(e){this.we=!0,this.ge=this.ge.remove(e)}xe(){this.fe+=1}Oe(){this.fe-=1,ot(this.fe>=0)}Ne(){this.we=!0,this.ye=!0}}class xy{constructor(e){this.Le=e,this.Be=new Map,this.ke=Or(),this.qe=qd(),this.Qe=new mt(st)}Ke(e){for(const t of e.Re)e.Ve&&e.Ve.isFoundDocument()?this.$e(t,e.Ve):this.Ue(t,e.key,e.Ve);for(const t of e.removedTargetIds)this.Ue(t,e.key,e.Ve)}We(e){this.forEachTarget(e,t=>{const n=this.Ge(t);switch(e.state){case 0:this.ze(t)&&n.De(e.resumeToken);break;case 1:n.Oe(),n.Se||n.Ce(),n.De(e.resumeToken);break;case 2:n.Oe(),n.Se||this.removeTarget(t);break;case 3:this.ze(t)&&(n.Ne(),n.De(e.resumeToken));break;case 4:this.ze(t)&&(this.je(t),n.De(e.resumeToken));break;default:Ue()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Be.forEach((n,a)=>{this.ze(a)&&t(a)})}He(e){const t=e.targetId,n=e.me.count,a=this.Je(t);if(a){const i=a.target;if(Ho(i))if(n===0){const l=new $e(i.path);this.Ue(t,l,Vt.newNoDocument(l,Be.min()))}else ot(n===1);else{const l=this.Ye(t);if(l!==n){const c=this.Ze(e),d=c?this.Xe(c,e,l):1;if(d!==0){this.je(t);const h=d===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Qe=this.Qe.insert(t,h)}}}}}Ze(e){const t=e.me.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:n="",padding:a=0},hashCount:i=0}=t;let l,c;try{l=Is(n).toUint8Array()}catch(d){if(d instanceof Ph)return rn("Decoding the base64 bloom filter in existence filter failed ("+d.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw d}try{c=new Cl(l,a,i)}catch(d){return rn(d instanceof Mn?"BloomFilter error: ":"Applying bloom filter failed: ",d),null}return c.Ie===0?null:c}Xe(e,t,n){return t.me.count===n-this.nt(e,t.targetId)?0:2}nt(e,t){const n=this.Le.getRemoteKeysForTarget(t);let a=0;return n.forEach(i=>{const l=this.Le.tt(),c=`projects/${l.projectId}/databases/${l.database}/documents/${i.path.canonicalString()}`;e.mightContain(c)||(this.Ue(t,i,null),a++)}),a}rt(e){const t=new Map;this.Be.forEach((i,l)=>{const c=this.Je(l);if(c){if(i.current&&Ho(c.target)){const d=new $e(c.target.path);this.ke.get(d)!==null||this.it(l,d)||this.Ue(l,d,Vt.newNoDocument(d,e))}i.be&&(t.set(l,i.ve()),i.Ce())}});let n=Ke();this.qe.forEach((i,l)=>{let c=!0;l.forEachWhile(d=>{const h=this.Je(d);return!h||h.purpose==="TargetPurposeLimboResolution"||(c=!1,!1)}),c&&(n=n.add(i))}),this.ke.forEach((i,l)=>l.setReadTime(e));const a=new Bi(e,t,this.Qe,this.ke,n);return this.ke=Or(),this.qe=qd(),this.Qe=new mt(st),a}$e(e,t){if(!this.ze(e))return;const n=this.it(e,t.key)?2:0;this.Ge(e).Fe(t.key,n),this.ke=this.ke.insert(t.key,t),this.qe=this.qe.insert(t.key,this.st(t.key).add(e))}Ue(e,t,n){if(!this.ze(e))return;const a=this.Ge(e);this.it(e,t)?a.Fe(t,1):a.Me(t),this.qe=this.qe.insert(t,this.st(t).delete(e)),n&&(this.ke=this.ke.insert(t,n))}removeTarget(e){this.Be.delete(e)}Ye(e){const t=this.Ge(e).ve();return this.Le.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}xe(e){this.Ge(e).xe()}Ge(e){let t=this.Be.get(e);return t||(t=new Bd,this.Be.set(e,t)),t}st(e){let t=this.qe.get(e);return t||(t=new Ct(st),this.qe=this.qe.insert(e,t)),t}ze(e){const t=this.Je(e)!==null;return t||Ae("WatchChangeAggregator","Detected inactive target",e),t}Je(e){const t=this.Be.get(e);return t&&t.Se?null:this.Le.ot(e)}je(e){this.Be.set(e,new Bd),this.Le.getRemoteKeysForTarget(e).forEach(t=>{this.Ue(e,t,null)})}it(e,t){return this.Le.getRemoteKeysForTarget(e).has(t)}}function qd(){return new mt($e.comparator)}function Wd(){return new mt($e.comparator)}const yy={asc:"ASCENDING",desc:"DESCENDING"},by={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},vy={and:"AND",or:"OR"};class wy{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function Qo(r,e){return r.useProto3Json||Oi(e)?e:{value:e}}function xi(r,e){return r.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function am(r,e){return r.useProto3Json?e.toBase64():e.toUint8Array()}function _y(r,e){return xi(r,e.toTimestamp())}function fr(r){return ot(!!r),Be.fromTimestamp(function(t){const n=ds(t);return new _t(n.seconds,n.nanos)}(r))}function Rl(r,e){return Yo(r,e).canonicalString()}function Yo(r,e){const t=function(a){return new ut(["projects",a.projectId,"databases",a.database])}(r).child("documents");return e===void 0?t:t.child(e)}function im(r){const e=ut.fromString(r);return ot(um(e)),e}function Xo(r,e){return Rl(r.databaseId,e.path)}function No(r,e){const t=im(e);if(t.get(1)!==r.databaseId.projectId)throw new Te(ae.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+r.databaseId.projectId);if(t.get(3)!==r.databaseId.database)throw new Te(ae.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+r.databaseId.database);return new $e(lm(t))}function om(r,e){return Rl(r.databaseId,e)}function ky(r){const e=im(r);return e.length===4?ut.emptyPath():lm(e)}function Jo(r){return new ut(["projects",r.databaseId.projectId,"databases",r.databaseId.database]).canonicalString()}function lm(r){return ot(r.length>4&&r.get(4)==="documents"),r.popFirst(5)}function zd(r,e,t){return{name:Xo(r,e),fields:t.value.mapValue.fields}}function Ny(r,e){let t;if("targetChange"in e){e.targetChange;const n=function(h){return h==="NO_CHANGE"?0:h==="ADD"?1:h==="REMOVE"?2:h==="CURRENT"?3:h==="RESET"?4:Ue()}(e.targetChange.targetChangeType||"NO_CHANGE"),a=e.targetChange.targetIds||[],i=function(h,g){return h.useProto3Json?(ot(g===void 0||typeof g=="string"),Rt.fromBase64String(g||"")):(ot(g===void 0||g instanceof Buffer||g instanceof Uint8Array),Rt.fromUint8Array(g||new Uint8Array))}(r,e.targetChange.resumeToken),l=e.targetChange.cause,c=l&&function(h){const g=h.code===void 0?ae.UNKNOWN:rm(h.code);return new Te(g,h.message||"")}(l);t=new nm(n,a,i,c||null)}else if("documentChange"in e){e.documentChange;const n=e.documentChange;n.document,n.document.name,n.document.updateTime;const a=No(r,n.document.name),i=fr(n.document.updateTime),l=n.document.createTime?fr(n.document.createTime):Be.min(),c=new Ht({mapValue:{fields:n.document.fields}}),d=Vt.newFoundDocument(a,i,l,c),h=n.targetIds||[],g=n.removedTargetIds||[];t=new Ja(h,g,d.key,d)}else if("documentDelete"in e){e.documentDelete;const n=e.documentDelete;n.document;const a=No(r,n.document),i=n.readTime?fr(n.readTime):Be.min(),l=Vt.newNoDocument(a,i),c=n.removedTargetIds||[];t=new Ja([],c,l.key,l)}else if("documentRemove"in e){e.documentRemove;const n=e.documentRemove;n.document;const a=No(r,n.document),i=n.removedTargetIds||[];t=new Ja([],i,a,null)}else{if(!("filter"in e))return Ue();{e.filter;const n=e.filter;n.targetId;const{count:a=0,unchangedNames:i}=n,l=new my(a,i),c=n.targetId;t=new sm(c,l)}}return t}function Ey(r,e){let t;if(e instanceof ha)t={update:zd(r,e.key,e.value)};else if(e instanceof Sl)t={delete:Xo(r,e.key)};else if(e instanceof hs)t={update:zd(r,e.key,e.data),updateMask:Py(e.fieldMask)};else{if(!(e instanceof dy))return Ue();t={verify:Xo(r,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(n=>function(i,l){const c=l.transform;if(c instanceof pi)return{fieldPath:l.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(c instanceof Jn)return{fieldPath:l.field.canonicalString(),appendMissingElements:{values:c.elements}};if(c instanceof Zn)return{fieldPath:l.field.canonicalString(),removeAllFromArray:{values:c.elements}};if(c instanceof fi)return{fieldPath:l.field.canonicalString(),increment:c.Pe};throw Ue()}(0,n))),e.precondition.isNone||(t.currentDocument=function(a,i){return i.updateTime!==void 0?{updateTime:_y(a,i.updateTime)}:i.exists!==void 0?{exists:i.exists}:Ue()}(r,e.precondition)),t}function jy(r,e){return r&&r.length>0?(ot(e!==void 0),r.map(t=>function(a,i){let l=a.updateTime?fr(a.updateTime):fr(i);return l.isEqual(Be.min())&&(l=fr(i)),new oy(l,a.transformResults||[])}(t,e))):[]}function Iy(r,e){return{documents:[om(r,e.path)]}}function Ty(r,e){const t={structuredQuery:{}},n=e.path;let a;e.collectionGroup!==null?(a=n,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(a=n.popLast(),t.structuredQuery.from=[{collectionId:n.lastSegment()}]),t.parent=om(r,a);const i=function(h){if(h.length!==0)return dm(or.create(h,"and"))}(e.filters);i&&(t.structuredQuery.where=i);const l=function(h){if(h.length!==0)return h.map(g=>function(p){return{field:Ws(p.field),direction:Cy(p.dir)}}(g))}(e.orderBy);l&&(t.structuredQuery.orderBy=l);const c=Qo(r,e.limit);return c!==null&&(t.structuredQuery.limit=c),e.startAt&&(t.structuredQuery.startAt=function(h){return{before:h.inclusive,values:h.position}}(e.startAt)),e.endAt&&(t.structuredQuery.endAt=function(h){return{before:!h.inclusive,values:h.position}}(e.endAt)),{_t:t,parent:a}}function Sy(r){let e=ky(r.parent);const t=r.structuredQuery,n=t.from?t.from.length:0;let a=null;if(n>0){ot(n===1);const g=t.from[0];g.allDescendants?a=g.collectionId:e=e.child(g.collectionId)}let i=[];t.where&&(i=function(x){const p=cm(x);return p instanceof or&&Vh(p)?p.getFilters():[p]}(t.where));let l=[];t.orderBy&&(l=function(x){return x.map(p=>function(j){return new Xn(zs(j.field),function(k){switch(k){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(j.direction))}(p))}(t.orderBy));let c=null;t.limit&&(c=function(x){let p;return p=typeof x=="object"?x.value:x,Oi(p)?null:p}(t.limit));let d=null;t.startAt&&(d=function(x){const p=!!x.before,E=x.values||[];return new gi(E,p)}(t.startAt));let h=null;return t.endAt&&(h=function(x){const p=!x.before,E=x.values||[];return new gi(E,p)}(t.endAt)),Kx(e,a,l,i,c,"F",d,h)}function Ay(r,e){const t=function(a){switch(a){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return Ue()}}(e.purpose);return t==null?null:{"goog-listen-tags":t}}function cm(r){return r.unaryFilter!==void 0?function(t){switch(t.unaryFilter.op){case"IS_NAN":const n=zs(t.unaryFilter.field);return vt.create(n,"==",{doubleValue:NaN});case"IS_NULL":const a=zs(t.unaryFilter.field);return vt.create(a,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const i=zs(t.unaryFilter.field);return vt.create(i,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const l=zs(t.unaryFilter.field);return vt.create(l,"!=",{nullValue:"NULL_VALUE"});default:return Ue()}}(r):r.fieldFilter!==void 0?function(t){return vt.create(zs(t.fieldFilter.field),function(a){switch(a){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return Ue()}}(t.fieldFilter.op),t.fieldFilter.value)}(r):r.compositeFilter!==void 0?function(t){return or.create(t.compositeFilter.filters.map(n=>cm(n)),function(a){switch(a){case"AND":return"and";case"OR":return"or";default:return Ue()}}(t.compositeFilter.op))}(r):Ue()}function Cy(r){return yy[r]}function Ry(r){return by[r]}function Dy(r){return vy[r]}function Ws(r){return{fieldPath:r.canonicalString()}}function zs(r){return St.fromServerFormat(r.fieldPath)}function dm(r){return r instanceof vt?function(t){if(t.op==="=="){if(Cd(t.value))return{unaryFilter:{field:Ws(t.field),op:"IS_NAN"}};if(Ad(t.value))return{unaryFilter:{field:Ws(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(Cd(t.value))return{unaryFilter:{field:Ws(t.field),op:"IS_NOT_NAN"}};if(Ad(t.value))return{unaryFilter:{field:Ws(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Ws(t.field),op:Ry(t.op),value:t.value}}}(r):r instanceof or?function(t){const n=t.getFilters().map(a=>dm(a));return n.length===1?n[0]:{compositeFilter:{op:Dy(t.op),filters:n}}}(r):Ue()}function Py(r){const e=[];return r.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function um(r){return r.length>=4&&r.get(0)==="projects"&&r.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rs{constructor(e,t,n,a,i=Be.min(),l=Be.min(),c=Rt.EMPTY_BYTE_STRING,d=null){this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=a,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=l,this.resumeToken=c,this.expectedCount=d}withSequenceNumber(e){return new rs(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new rs(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new rs(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new rs(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $y{constructor(e){this.ct=e}}function My(r){const e=Sy({parent:r.parent,structuredQuery:r.structuredQuery});return r.limitType==="LAST"?Ko(e,e.limit,"L"):e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Oy{constructor(){this.un=new Vy}addToCollectionParentIndex(e,t){return this.un.add(t),ce.resolve()}getCollectionParents(e,t){return ce.resolve(this.un.getEntries(t))}addFieldIndex(e,t){return ce.resolve()}deleteFieldIndex(e,t){return ce.resolve()}deleteAllFieldIndexes(e){return ce.resolve()}createTargetIndexes(e,t){return ce.resolve()}getDocumentsMatchingTarget(e,t){return ce.resolve(null)}getIndexType(e,t){return ce.resolve(0)}getFieldIndexes(e,t){return ce.resolve([])}getNextCollectionGroupToUpdate(e){return ce.resolve(null)}getMinOffset(e,t){return ce.resolve(cs.min())}getMinOffsetFromCollectionGroup(e,t){return ce.resolve(cs.min())}updateCollectionGroup(e,t,n){return ce.resolve()}updateIndexEntries(e,t){return ce.resolve()}}class Vy{constructor(){this.index={}}add(e){const t=e.lastSegment(),n=e.popLast(),a=this.index[t]||new Ct(ut.comparator),i=!a.has(n);return this.index[t]=a.add(n),i}has(e){const t=e.lastSegment(),n=e.popLast(),a=this.index[t];return a&&a.has(n)}getEntries(e){return(this.index[e]||new Ct(ut.comparator)).toArray()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class on{constructor(e){this.Ln=e}next(){return this.Ln+=2,this.Ln}static Bn(){return new on(0)}static kn(){return new on(-1)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ly{constructor(){this.changes=new gn(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,Vt.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const n=this.changes.get(t);return n!==void 0?ce.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fy{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Uy{constructor(e,t,n,a){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=a}getDocument(e,t){let n=null;return this.documentOverlayCache.getOverlay(e,t).next(a=>(n=a,this.remoteDocumentCache.getEntry(e,t))).next(a=>(n!==null&&Bn(n.mutation,a,Xt.empty(),_t.now()),a))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(n=>this.getLocalViewOfDocuments(e,n,Ke()).next(()=>n))}getLocalViewOfDocuments(e,t,n=Ke()){const a=vs();return this.populateOverlays(e,a,t).next(()=>this.computeViews(e,t,a,n).next(i=>{let l=$n();return i.forEach((c,d)=>{l=l.insert(c,d.overlayedDocument)}),l}))}getOverlayedDocuments(e,t){const n=vs();return this.populateOverlays(e,n,t).next(()=>this.computeViews(e,t,n,Ke()))}populateOverlays(e,t,n){const a=[];return n.forEach(i=>{t.has(i)||a.push(i)}),this.documentOverlayCache.getOverlays(e,a).next(i=>{i.forEach((l,c)=>{t.set(l,c)})})}computeViews(e,t,n,a){let i=Or();const l=Un(),c=function(){return Un()}();return t.forEach((d,h)=>{const g=n.get(h.key);a.has(h.key)&&(g===void 0||g.mutation instanceof hs)?i=i.insert(h.key,h):g!==void 0?(l.set(h.key,g.mutation.getFieldMask()),Bn(g.mutation,h,g.mutation.getFieldMask(),_t.now())):l.set(h.key,Xt.empty())}),this.recalculateAndSaveOverlays(e,i).next(d=>(d.forEach((h,g)=>l.set(h,g)),t.forEach((h,g)=>{var x;return c.set(h,new Fy(g,(x=l.get(h))!==null&&x!==void 0?x:null))}),c))}recalculateAndSaveOverlays(e,t){const n=Un();let a=new mt((l,c)=>l-c),i=Ke();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(l=>{for(const c of l)c.keys().forEach(d=>{const h=t.get(d);if(h===null)return;let g=n.get(d)||Xt.empty();g=c.applyToLocalView(h,g),n.set(d,g);const x=(a.get(c.batchId)||Ke()).add(d);a=a.insert(c.batchId,x)})}).next(()=>{const l=[],c=a.getReverseIterator();for(;c.hasNext();){const d=c.getNext(),h=d.key,g=d.value,x=Kh();g.forEach(p=>{if(!i.has(p)){const E=em(t.get(p),n.get(p));E!==null&&x.set(p,E),i=i.add(p)}}),l.push(this.documentOverlayCache.saveOverlays(e,h,x))}return ce.waitFor(l)}).next(()=>n)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(n=>this.recalculateAndSaveOverlays(e,n))}getDocumentsMatchingQuery(e,t,n,a){return function(l){return $e.isDocumentKey(l.path)&&l.collectionGroup===null&&l.filters.length===0}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):qh(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n,a):this.getDocumentsMatchingCollectionQuery(e,t,n,a)}getNextDocuments(e,t,n,a){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,n,a).next(i=>{const l=a-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,n.largestBatchId,a-i.size):ce.resolve(vs());let c=-1,d=i;return l.next(h=>ce.forEach(h,(g,x)=>(c<x.largestBatchId&&(c=x.largestBatchId),i.get(g)?ce.resolve():this.remoteDocumentCache.getEntry(e,g).next(p=>{d=d.insert(g,p)}))).next(()=>this.populateOverlays(e,h,i)).next(()=>this.computeViews(e,d,h,Ke())).next(g=>({batchId:c,changes:Gh(g)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new $e(t)).next(n=>{let a=$n();return n.isFoundDocument()&&(a=a.insert(n.key,n)),a})}getDocumentsMatchingCollectionGroupQuery(e,t,n,a){const i=t.collectionGroup;let l=$n();return this.indexManager.getCollectionParents(e,i).next(c=>ce.forEach(c,d=>{const h=function(x,p){return new mn(p,null,x.explicitOrderBy.slice(),x.filters.slice(),x.limit,x.limitType,x.startAt,x.endAt)}(t,d.child(i));return this.getDocumentsMatchingCollectionQuery(e,h,n,a).next(g=>{g.forEach((x,p)=>{l=l.insert(x,p)})})}).next(()=>l))}getDocumentsMatchingCollectionQuery(e,t,n,a){let i;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,n.largestBatchId).next(l=>(i=l,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,n,i,a))).next(l=>{i.forEach((d,h)=>{const g=h.getKey();l.get(g)===null&&(l=l.insert(g,Vt.newInvalidDocument(g)))});let c=$n();return l.forEach((d,h)=>{const g=i.get(d);g!==void 0&&Bn(g.mutation,h,Xt.empty(),_t.now()),Li(t,h)&&(c=c.insert(d,h))}),c})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class By{constructor(e){this.serializer=e,this.hr=new Map,this.Pr=new Map}getBundleMetadata(e,t){return ce.resolve(this.hr.get(t))}saveBundleMetadata(e,t){return this.hr.set(t.id,function(a){return{id:a.id,version:a.version,createTime:fr(a.createTime)}}(t)),ce.resolve()}getNamedQuery(e,t){return ce.resolve(this.Pr.get(t))}saveNamedQuery(e,t){return this.Pr.set(t.name,function(a){return{name:a.name,query:My(a.bundledQuery),readTime:fr(a.readTime)}}(t)),ce.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qy{constructor(){this.overlays=new mt($e.comparator),this.Ir=new Map}getOverlay(e,t){return ce.resolve(this.overlays.get(t))}getOverlays(e,t){const n=vs();return ce.forEach(t,a=>this.getOverlay(e,a).next(i=>{i!==null&&n.set(a,i)})).next(()=>n)}saveOverlays(e,t,n){return n.forEach((a,i)=>{this.ht(e,t,i)}),ce.resolve()}removeOverlaysForBatchId(e,t,n){const a=this.Ir.get(n);return a!==void 0&&(a.forEach(i=>this.overlays=this.overlays.remove(i)),this.Ir.delete(n)),ce.resolve()}getOverlaysForCollection(e,t,n){const a=vs(),i=t.length+1,l=new $e(t.child("")),c=this.overlays.getIteratorFrom(l);for(;c.hasNext();){const d=c.getNext().value,h=d.getKey();if(!t.isPrefixOf(h.path))break;h.path.length===i&&d.largestBatchId>n&&a.set(d.getKey(),d)}return ce.resolve(a)}getOverlaysForCollectionGroup(e,t,n,a){let i=new mt((h,g)=>h-g);const l=this.overlays.getIterator();for(;l.hasNext();){const h=l.getNext().value;if(h.getKey().getCollectionGroup()===t&&h.largestBatchId>n){let g=i.get(h.largestBatchId);g===null&&(g=vs(),i=i.insert(h.largestBatchId,g)),g.set(h.getKey(),h)}}const c=vs(),d=i.getIterator();for(;d.hasNext()&&(d.getNext().value.forEach((h,g)=>c.set(h,g)),!(c.size()>=a)););return ce.resolve(c)}ht(e,t,n){const a=this.overlays.get(n.key);if(a!==null){const l=this.Ir.get(a.largestBatchId).delete(n.key);this.Ir.set(a.largestBatchId,l)}this.overlays=this.overlays.insert(n.key,new hy(t,n));let i=this.Ir.get(t);i===void 0&&(i=Ke(),this.Ir.set(t,i)),this.Ir.set(t,i.add(n.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wy{constructor(){this.sessionToken=Rt.EMPTY_BYTE_STRING}getSessionToken(e){return ce.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,ce.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dl{constructor(){this.Tr=new Ct(Nt.Er),this.dr=new Ct(Nt.Ar)}isEmpty(){return this.Tr.isEmpty()}addReference(e,t){const n=new Nt(e,t);this.Tr=this.Tr.add(n),this.dr=this.dr.add(n)}Rr(e,t){e.forEach(n=>this.addReference(n,t))}removeReference(e,t){this.Vr(new Nt(e,t))}mr(e,t){e.forEach(n=>this.removeReference(n,t))}gr(e){const t=new $e(new ut([])),n=new Nt(t,e),a=new Nt(t,e+1),i=[];return this.dr.forEachInRange([n,a],l=>{this.Vr(l),i.push(l.key)}),i}pr(){this.Tr.forEach(e=>this.Vr(e))}Vr(e){this.Tr=this.Tr.delete(e),this.dr=this.dr.delete(e)}yr(e){const t=new $e(new ut([])),n=new Nt(t,e),a=new Nt(t,e+1);let i=Ke();return this.dr.forEachInRange([n,a],l=>{i=i.add(l.key)}),i}containsKey(e){const t=new Nt(e,0),n=this.Tr.firstAfterOrEqual(t);return n!==null&&e.isEqual(n.key)}}class Nt{constructor(e,t){this.key=e,this.wr=t}static Er(e,t){return $e.comparator(e.key,t.key)||st(e.wr,t.wr)}static Ar(e,t){return st(e.wr,t.wr)||$e.comparator(e.key,t.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zy{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.Sr=1,this.br=new Ct(Nt.Er)}checkEmpty(e){return ce.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,n,a){const i=this.Sr;this.Sr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const l=new uy(i,t,n,a);this.mutationQueue.push(l);for(const c of a)this.br=this.br.add(new Nt(c.key,i)),this.indexManager.addToCollectionParentIndex(e,c.key.path.popLast());return ce.resolve(l)}lookupMutationBatch(e,t){return ce.resolve(this.Dr(t))}getNextMutationBatchAfterBatchId(e,t){const n=t+1,a=this.vr(n),i=a<0?0:a;return ce.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return ce.resolve(this.mutationQueue.length===0?-1:this.Sr-1)}getAllMutationBatches(e){return ce.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const n=new Nt(t,0),a=new Nt(t,Number.POSITIVE_INFINITY),i=[];return this.br.forEachInRange([n,a],l=>{const c=this.Dr(l.wr);i.push(c)}),ce.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new Ct(st);return t.forEach(a=>{const i=new Nt(a,0),l=new Nt(a,Number.POSITIVE_INFINITY);this.br.forEachInRange([i,l],c=>{n=n.add(c.wr)})}),ce.resolve(this.Cr(n))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,a=n.length+1;let i=n;$e.isDocumentKey(i)||(i=i.child(""));const l=new Nt(new $e(i),0);let c=new Ct(st);return this.br.forEachWhile(d=>{const h=d.key.path;return!!n.isPrefixOf(h)&&(h.length===a&&(c=c.add(d.wr)),!0)},l),ce.resolve(this.Cr(c))}Cr(e){const t=[];return e.forEach(n=>{const a=this.Dr(n);a!==null&&t.push(a)}),t}removeMutationBatch(e,t){ot(this.Fr(t.batchId,"removed")===0),this.mutationQueue.shift();let n=this.br;return ce.forEach(t.mutations,a=>{const i=new Nt(a.key,t.batchId);return n=n.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,a.key)}).next(()=>{this.br=n})}On(e){}containsKey(e,t){const n=new Nt(t,0),a=this.br.firstAfterOrEqual(n);return ce.resolve(t.isEqual(a&&a.key))}performConsistencyCheck(e){return this.mutationQueue.length,ce.resolve()}Fr(e,t){return this.vr(e)}vr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Dr(e){const t=this.vr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hy{constructor(e){this.Mr=e,this.docs=function(){return new mt($e.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const n=t.key,a=this.docs.get(n),i=a?a.size:0,l=this.Mr(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:l}),this.size+=l-i,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const n=this.docs.get(t);return ce.resolve(n?n.document.mutableCopy():Vt.newInvalidDocument(t))}getEntries(e,t){let n=Or();return t.forEach(a=>{const i=this.docs.get(a);n=n.insert(a,i?i.document.mutableCopy():Vt.newInvalidDocument(a))}),ce.resolve(n)}getDocumentsMatchingQuery(e,t,n,a){let i=Or();const l=t.path,c=new $e(l.child("")),d=this.docs.getIteratorFrom(c);for(;d.hasNext();){const{key:h,value:{document:g}}=d.getNext();if(!l.isPrefixOf(h.path))break;h.path.length>l.length+1||Sx(Tx(g),n)<=0||(a.has(g.key)||Li(t,g))&&(i=i.insert(g.key,g.mutableCopy()))}return ce.resolve(i)}getAllFromCollectionGroup(e,t,n,a){Ue()}Or(e,t){return ce.forEach(this.docs,n=>t(n))}newChangeBuffer(e){return new Gy(this)}getSize(e){return ce.resolve(this.size)}}class Gy extends Ly{constructor(e){super(),this.cr=e}applyChanges(e){const t=[];return this.changes.forEach((n,a)=>{a.isValidDocument()?t.push(this.cr.addEntry(e,a)):this.cr.removeEntry(n)}),ce.waitFor(t)}getFromCache(e,t){return this.cr.getEntry(e,t)}getAllFromCache(e,t){return this.cr.getEntries(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ky{constructor(e){this.persistence=e,this.Nr=new gn(t=>jl(t),Il),this.lastRemoteSnapshotVersion=Be.min(),this.highestTargetId=0,this.Lr=0,this.Br=new Dl,this.targetCount=0,this.kr=on.Bn()}forEachTarget(e,t){return this.Nr.forEach((n,a)=>t(a)),ce.resolve()}getLastRemoteSnapshotVersion(e){return ce.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return ce.resolve(this.Lr)}allocateTargetId(e){return this.highestTargetId=this.kr.next(),ce.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.Lr&&(this.Lr=t),ce.resolve()}Kn(e){this.Nr.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.kr=new on(t),this.highestTargetId=t),e.sequenceNumber>this.Lr&&(this.Lr=e.sequenceNumber)}addTargetData(e,t){return this.Kn(t),this.targetCount+=1,ce.resolve()}updateTargetData(e,t){return this.Kn(t),ce.resolve()}removeTargetData(e,t){return this.Nr.delete(t.target),this.Br.gr(t.targetId),this.targetCount-=1,ce.resolve()}removeTargets(e,t,n){let a=0;const i=[];return this.Nr.forEach((l,c)=>{c.sequenceNumber<=t&&n.get(c.targetId)===null&&(this.Nr.delete(l),i.push(this.removeMatchingKeysForTargetId(e,c.targetId)),a++)}),ce.waitFor(i).next(()=>a)}getTargetCount(e){return ce.resolve(this.targetCount)}getTargetData(e,t){const n=this.Nr.get(t)||null;return ce.resolve(n)}addMatchingKeys(e,t,n){return this.Br.Rr(t,n),ce.resolve()}removeMatchingKeys(e,t,n){this.Br.mr(t,n);const a=this.persistence.referenceDelegate,i=[];return a&&t.forEach(l=>{i.push(a.markPotentiallyOrphaned(e,l))}),ce.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this.Br.gr(t),ce.resolve()}getMatchingKeysForTargetId(e,t){const n=this.Br.yr(t);return ce.resolve(n)}containsKey(e,t){return ce.resolve(this.Br.containsKey(t))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qy{constructor(e,t){this.qr={},this.overlays={},this.Qr=new _l(0),this.Kr=!1,this.Kr=!0,this.$r=new Wy,this.referenceDelegate=e(this),this.Ur=new Ky(this),this.indexManager=new Oy,this.remoteDocumentCache=function(a){return new Hy(a)}(n=>this.referenceDelegate.Wr(n)),this.serializer=new $y(t),this.Gr=new By(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Kr=!1,Promise.resolve()}get started(){return this.Kr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new qy,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this.qr[e.toKey()];return n||(n=new zy(t,this.referenceDelegate),this.qr[e.toKey()]=n),n}getGlobalsCache(){return this.$r}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Gr}runTransaction(e,t,n){Ae("MemoryPersistence","Starting transaction:",e);const a=new Yy(this.Qr.next());return this.referenceDelegate.zr(),n(a).next(i=>this.referenceDelegate.jr(a).next(()=>i)).toPromise().then(i=>(a.raiseOnCommittedEvent(),i))}Hr(e,t){return ce.or(Object.values(this.qr).map(n=>()=>n.containsKey(e,t)))}}class Yy extends Cx{constructor(e){super(),this.currentSequenceNumber=e}}class Pl{constructor(e){this.persistence=e,this.Jr=new Dl,this.Yr=null}static Zr(e){return new Pl(e)}get Xr(){if(this.Yr)return this.Yr;throw Ue()}addReference(e,t,n){return this.Jr.addReference(n,t),this.Xr.delete(n.toString()),ce.resolve()}removeReference(e,t,n){return this.Jr.removeReference(n,t),this.Xr.add(n.toString()),ce.resolve()}markPotentiallyOrphaned(e,t){return this.Xr.add(t.toString()),ce.resolve()}removeTarget(e,t){this.Jr.gr(t.targetId).forEach(a=>this.Xr.add(a.toString()));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next(a=>{a.forEach(i=>this.Xr.add(i.toString()))}).next(()=>n.removeTargetData(e,t))}zr(){this.Yr=new Set}jr(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return ce.forEach(this.Xr,n=>{const a=$e.fromPath(n);return this.ei(e,a).next(i=>{i||t.removeEntry(a,Be.min())})}).next(()=>(this.Yr=null,t.apply(e)))}updateLimboDocument(e,t){return this.ei(e,t).next(n=>{n?this.Xr.delete(t.toString()):this.Xr.add(t.toString())})}Wr(e){return 0}ei(e,t){return ce.or([()=>ce.resolve(this.Jr.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Hr(e,t)])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $l{constructor(e,t,n,a){this.targetId=e,this.fromCache=t,this.$i=n,this.Ui=a}static Wi(e,t){let n=Ke(),a=Ke();for(const i of t.docChanges)switch(i.type){case 0:n=n.add(i.doc.key);break;case 1:a=a.add(i.doc.key)}return new $l(e,t.fromCache,n,a)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xy{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jy{constructor(){this.Gi=!1,this.zi=!1,this.ji=100,this.Hi=function(){return ef()?8:Rx(Ft())>0?6:4}()}initialize(e,t){this.Ji=e,this.indexManager=t,this.Gi=!0}getDocumentsMatchingQuery(e,t,n,a){const i={result:null};return this.Yi(e,t).next(l=>{i.result=l}).next(()=>{if(!i.result)return this.Zi(e,t,a,n).next(l=>{i.result=l})}).next(()=>{if(i.result)return;const l=new Xy;return this.Xi(e,t,l).next(c=>{if(i.result=c,this.zi)return this.es(e,t,l,c.size)})}).next(()=>i.result)}es(e,t,n,a){return n.documentReadCount<this.ji?(Tn()<=Je.DEBUG&&Ae("QueryEngine","SDK will not create cache indexes for query:",qs(t),"since it only creates cache indexes for collection contains","more than or equal to",this.ji,"documents"),ce.resolve()):(Tn()<=Je.DEBUG&&Ae("QueryEngine","Query:",qs(t),"scans",n.documentReadCount,"local documents and returns",a,"documents as results."),n.documentReadCount>this.Hi*a?(Tn()<=Je.DEBUG&&Ae("QueryEngine","The SDK decides to create cache indexes for query:",qs(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,pr(t))):ce.resolve())}Yi(e,t){if($d(t))return ce.resolve(null);let n=pr(t);return this.indexManager.getIndexType(e,n).next(a=>a===0?null:(t.limit!==null&&a===1&&(t=Ko(t,null,"F"),n=pr(t)),this.indexManager.getDocumentsMatchingTarget(e,n).next(i=>{const l=Ke(...i);return this.Ji.getDocuments(e,l).next(c=>this.indexManager.getMinOffset(e,n).next(d=>{const h=this.ts(t,c);return this.ns(t,h,l,d.readTime)?this.Yi(e,Ko(t,null,"F")):this.rs(e,h,t,d)}))})))}Zi(e,t,n,a){return $d(t)||a.isEqual(Be.min())?ce.resolve(null):this.Ji.getDocuments(e,n).next(i=>{const l=this.ts(t,i);return this.ns(t,l,n,a)?ce.resolve(null):(Tn()<=Je.DEBUG&&Ae("QueryEngine","Re-using previous result from %s to execute query: %s",a.toString(),qs(t)),this.rs(e,l,t,Ix(a,-1)).next(c=>c))})}ts(e,t){let n=new Ct(zh(e));return t.forEach((a,i)=>{Li(e,i)&&(n=n.add(i))}),n}ns(e,t,n,a){if(e.limit===null)return!1;if(n.size!==t.size)return!0;const i=e.limitType==="F"?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(a)>0)}Xi(e,t,n){return Tn()<=Je.DEBUG&&Ae("QueryEngine","Using full collection scan to execute query:",qs(t)),this.Ji.getDocumentsMatchingQuery(e,t,cs.min(),n)}rs(e,t,n,a){return this.Ji.getDocumentsMatchingQuery(e,n,a).next(i=>(t.forEach(l=>{i=i.insert(l.key,l)}),i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zy{constructor(e,t,n,a){this.persistence=e,this.ss=t,this.serializer=a,this.os=new mt(st),this._s=new gn(i=>jl(i),Il),this.us=new Map,this.cs=e.getRemoteDocumentCache(),this.Ur=e.getTargetCache(),this.Gr=e.getBundleCache(),this.ls(n)}ls(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new Uy(this.cs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.cs.setIndexManager(this.indexManager),this.ss.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.os))}}function eb(r,e,t,n){return new Zy(r,e,t,n)}async function hm(r,e){const t=qe(r);return await t.persistence.runTransaction("Handle user change","readonly",n=>{let a;return t.mutationQueue.getAllMutationBatches(n).next(i=>(a=i,t.ls(e),t.mutationQueue.getAllMutationBatches(n))).next(i=>{const l=[],c=[];let d=Ke();for(const h of a){l.push(h.batchId);for(const g of h.mutations)d=d.add(g.key)}for(const h of i){c.push(h.batchId);for(const g of h.mutations)d=d.add(g.key)}return t.localDocuments.getDocuments(n,d).next(h=>({hs:h,removedBatchIds:l,addedBatchIds:c}))})})}function tb(r,e){const t=qe(r);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",n=>{const a=e.batch.keys(),i=t.cs.newChangeBuffer({trackRemovals:!0});return function(c,d,h,g){const x=h.batch,p=x.keys();let E=ce.resolve();return p.forEach(j=>{E=E.next(()=>g.getEntry(d,j)).next(S=>{const k=h.docVersions.get(j);ot(k!==null),S.version.compareTo(k)<0&&(x.applyToRemoteDocument(S,h),S.isValidDocument()&&(S.setReadTime(h.commitVersion),g.addEntry(S)))})}),E.next(()=>c.mutationQueue.removeMutationBatch(d,x))}(t,n,e,i).next(()=>i.apply(n)).next(()=>t.mutationQueue.performConsistencyCheck(n)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(n,a,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(n,function(c){let d=Ke();for(let h=0;h<c.mutationResults.length;++h)c.mutationResults[h].transformResults.length>0&&(d=d.add(c.batch.mutations[h].key));return d}(e))).next(()=>t.localDocuments.getDocuments(n,a))})}function mm(r){const e=qe(r);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Ur.getLastRemoteSnapshotVersion(t))}function rb(r,e){const t=qe(r),n=e.snapshotVersion;let a=t.os;return t.persistence.runTransaction("Apply remote event","readwrite-primary",i=>{const l=t.cs.newChangeBuffer({trackRemovals:!0});a=t.os;const c=[];e.targetChanges.forEach((g,x)=>{const p=a.get(x);if(!p)return;c.push(t.Ur.removeMatchingKeys(i,g.removedDocuments,x).next(()=>t.Ur.addMatchingKeys(i,g.addedDocuments,x)));let E=p.withSequenceNumber(i.currentSequenceNumber);e.targetMismatches.get(x)!==null?E=E.withResumeToken(Rt.EMPTY_BYTE_STRING,Be.min()).withLastLimboFreeSnapshotVersion(Be.min()):g.resumeToken.approximateByteSize()>0&&(E=E.withResumeToken(g.resumeToken,n)),a=a.insert(x,E),function(S,k,L){return S.resumeToken.approximateByteSize()===0||k.snapshotVersion.toMicroseconds()-S.snapshotVersion.toMicroseconds()>=3e8?!0:L.addedDocuments.size+L.modifiedDocuments.size+L.removedDocuments.size>0}(p,E,g)&&c.push(t.Ur.updateTargetData(i,E))});let d=Or(),h=Ke();if(e.documentUpdates.forEach(g=>{e.resolvedLimboDocuments.has(g)&&c.push(t.persistence.referenceDelegate.updateLimboDocument(i,g))}),c.push(sb(i,l,e.documentUpdates).next(g=>{d=g.Ps,h=g.Is})),!n.isEqual(Be.min())){const g=t.Ur.getLastRemoteSnapshotVersion(i).next(x=>t.Ur.setTargetsMetadata(i,i.currentSequenceNumber,n));c.push(g)}return ce.waitFor(c).next(()=>l.apply(i)).next(()=>t.localDocuments.getLocalViewOfDocuments(i,d,h)).next(()=>d)}).then(i=>(t.os=a,i))}function sb(r,e,t){let n=Ke(),a=Ke();return t.forEach(i=>n=n.add(i)),e.getEntries(r,n).next(i=>{let l=Or();return t.forEach((c,d)=>{const h=i.get(c);d.isFoundDocument()!==h.isFoundDocument()&&(a=a.add(c)),d.isNoDocument()&&d.version.isEqual(Be.min())?(e.removeEntry(c,d.readTime),l=l.insert(c,d)):!h.isValidDocument()||d.version.compareTo(h.version)>0||d.version.compareTo(h.version)===0&&h.hasPendingWrites?(e.addEntry(d),l=l.insert(c,d)):Ae("LocalStore","Ignoring outdated watch update for ",c,". Current version:",h.version," Watch version:",d.version)}),{Ps:l,Is:a}})}function nb(r,e){const t=qe(r);return t.persistence.runTransaction("Get next mutation batch","readonly",n=>(e===void 0&&(e=-1),t.mutationQueue.getNextMutationBatchAfterBatchId(n,e)))}function ab(r,e){const t=qe(r);return t.persistence.runTransaction("Allocate target","readwrite",n=>{let a;return t.Ur.getTargetData(n,e).next(i=>i?(a=i,ce.resolve(a)):t.Ur.allocateTargetId(n).next(l=>(a=new rs(e,l,"TargetPurposeListen",n.currentSequenceNumber),t.Ur.addTargetData(n,a).next(()=>a))))}).then(n=>{const a=t.os.get(n.targetId);return(a===null||n.snapshotVersion.compareTo(a.snapshotVersion)>0)&&(t.os=t.os.insert(n.targetId,n),t._s.set(e,n.targetId)),n})}async function Zo(r,e,t){const n=qe(r),a=n.os.get(e),i=t?"readwrite":"readwrite-primary";try{t||await n.persistence.runTransaction("Release target",i,l=>n.persistence.referenceDelegate.removeTarget(l,a))}catch(l){if(!ua(l))throw l;Ae("LocalStore",`Failed to update sequence numbers for target ${e}: ${l}`)}n.os=n.os.remove(e),n._s.delete(a.target)}function Hd(r,e,t){const n=qe(r);let a=Be.min(),i=Ke();return n.persistence.runTransaction("Execute query","readwrite",l=>function(d,h,g){const x=qe(d),p=x._s.get(g);return p!==void 0?ce.resolve(x.os.get(p)):x.Ur.getTargetData(h,g)}(n,l,pr(e)).next(c=>{if(c)return a=c.lastLimboFreeSnapshotVersion,n.Ur.getMatchingKeysForTargetId(l,c.targetId).next(d=>{i=d})}).next(()=>n.ss.getDocumentsMatchingQuery(l,e,t?a:Be.min(),t?i:Ke())).next(c=>(ib(n,Yx(e),c),{documents:c,Ts:i})))}function ib(r,e,t){let n=r.us.get(e)||Be.min();t.forEach((a,i)=>{i.readTime.compareTo(n)>0&&(n=i.readTime)}),r.us.set(e,n)}class Gd{constructor(){this.activeTargetIds=ry()}fs(e){this.activeTargetIds=this.activeTargetIds.add(e)}gs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Vs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class ob{constructor(){this.so=new Gd,this.oo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e,t=!0){return t&&this.so.fs(e),this.oo[e]||"not-current"}updateQueryState(e,t,n){this.oo[e]=t}removeLocalQueryTarget(e){this.so.gs(e)}isLocalQueryTarget(e){return this.so.activeTargetIds.has(e)}clearQueryState(e){delete this.oo[e]}getAllActiveQueryTargets(){return this.so.activeTargetIds}isActiveQueryTarget(e){return this.so.activeTargetIds.has(e)}start(){return this.so=new Gd,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lb{_o(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kd{constructor(){this.ao=()=>this.uo(),this.co=()=>this.lo(),this.ho=[],this.Po()}_o(e){this.ho.push(e)}shutdown(){window.removeEventListener("online",this.ao),window.removeEventListener("offline",this.co)}Po(){window.addEventListener("online",this.ao),window.addEventListener("offline",this.co)}uo(){Ae("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.ho)e(0)}lo(){Ae("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.ho)e(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Ua=null;function Eo(){return Ua===null?Ua=function(){return 268435456+Math.round(2147483648*Math.random())}():Ua++,"0x"+Ua.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cb={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class db{constructor(e){this.Io=e.Io,this.To=e.To}Eo(e){this.Ao=e}Ro(e){this.Vo=e}mo(e){this.fo=e}onMessage(e){this.po=e}close(){this.To()}send(e){this.Io(e)}yo(){this.Ao()}wo(){this.Vo()}So(e){this.fo(e)}bo(e){this.po(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Mt="WebChannelConnection";class ub extends class{constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const n=t.ssl?"https":"http",a=encodeURIComponent(this.databaseId.projectId),i=encodeURIComponent(this.databaseId.database);this.Do=n+"://"+t.host,this.vo=`projects/${a}/databases/${i}`,this.Co=this.databaseId.database==="(default)"?`project_id=${a}`:`project_id=${a}&database_id=${i}`}get Fo(){return!1}Mo(t,n,a,i,l){const c=Eo(),d=this.xo(t,n.toUriEncodedString());Ae("RestConnection",`Sending RPC '${t}' ${c}:`,d,a);const h={"google-cloud-resource-prefix":this.vo,"x-goog-request-params":this.Co};return this.Oo(h,i,l),this.No(t,d,h,a).then(g=>(Ae("RestConnection",`Received RPC '${t}' ${c}: `,g),g),g=>{throw rn("RestConnection",`RPC '${t}' ${c} failed with error: `,g,"url: ",d,"request:",a),g})}Lo(t,n,a,i,l,c){return this.Mo(t,n,a,i,l)}Oo(t,n,a){t["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+hn}(),t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),n&&n.headers.forEach((i,l)=>t[l]=i),a&&a.headers.forEach((i,l)=>t[l]=i)}xo(t,n){const a=cb[t];return`${this.Do}/v1/${n}:${a}`}terminate(){}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}No(e,t,n,a){const i=Eo();return new Promise((l,c)=>{const d=new jh;d.setWithCredentials(!0),d.listenOnce(Ih.COMPLETE,()=>{try{switch(d.getLastErrorCode()){case Qa.NO_ERROR:const g=d.getResponseJson();Ae(Mt,`XHR for RPC '${e}' ${i} received:`,JSON.stringify(g)),l(g);break;case Qa.TIMEOUT:Ae(Mt,`RPC '${e}' ${i} timed out`),c(new Te(ae.DEADLINE_EXCEEDED,"Request time out"));break;case Qa.HTTP_ERROR:const x=d.getStatus();if(Ae(Mt,`RPC '${e}' ${i} failed with status:`,x,"response text:",d.getResponseText()),x>0){let p=d.getResponseJson();Array.isArray(p)&&(p=p[0]);const E=p==null?void 0:p.error;if(E&&E.status&&E.message){const j=function(k){const L=k.toLowerCase().replace(/_/g,"-");return Object.values(ae).indexOf(L)>=0?L:ae.UNKNOWN}(E.status);c(new Te(j,E.message))}else c(new Te(ae.UNKNOWN,"Server responded with status "+d.getStatus()))}else c(new Te(ae.UNAVAILABLE,"Connection failed."));break;default:Ue()}}finally{Ae(Mt,`RPC '${e}' ${i} completed.`)}});const h=JSON.stringify(a);Ae(Mt,`RPC '${e}' ${i} sending request:`,a),d.send(t,"POST",h,n,15)})}Bo(e,t,n){const a=Eo(),i=[this.Do,"/","google.firestore.v1.Firestore","/",e,"/channel"],l=Ah(),c=Sh(),d={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},h=this.longPollingOptions.timeoutSeconds;h!==void 0&&(d.longPollingTimeout=Math.round(1e3*h)),this.useFetchStreams&&(d.useFetchStreams=!0),this.Oo(d.initMessageHeaders,t,n),d.encodeInitMessageHeaders=!0;const g=i.join("");Ae(Mt,`Creating RPC '${e}' stream ${a}: ${g}`,d);const x=l.createWebChannel(g,d);let p=!1,E=!1;const j=new db({Io:k=>{E?Ae(Mt,`Not sending because RPC '${e}' stream ${a} is closed:`,k):(p||(Ae(Mt,`Opening RPC '${e}' stream ${a} transport.`),x.open(),p=!0),Ae(Mt,`RPC '${e}' stream ${a} sending:`,k),x.send(k))},To:()=>x.close()}),S=(k,L,M)=>{k.listen(L,T=>{try{M(T)}catch(O){setTimeout(()=>{throw O},0)}})};return S(x,Pn.EventType.OPEN,()=>{E||(Ae(Mt,`RPC '${e}' stream ${a} transport opened.`),j.yo())}),S(x,Pn.EventType.CLOSE,()=>{E||(E=!0,Ae(Mt,`RPC '${e}' stream ${a} transport closed`),j.So())}),S(x,Pn.EventType.ERROR,k=>{E||(E=!0,rn(Mt,`RPC '${e}' stream ${a} transport errored:`,k),j.So(new Te(ae.UNAVAILABLE,"The operation could not be completed")))}),S(x,Pn.EventType.MESSAGE,k=>{var L;if(!E){const M=k.data[0];ot(!!M);const T=M,O=T.error||((L=T[0])===null||L===void 0?void 0:L.error);if(O){Ae(Mt,`RPC '${e}' stream ${a} received error:`,O);const ne=O.status;let ie=function(b){const f=bt[b];if(f!==void 0)return rm(f)}(ne),I=O.message;ie===void 0&&(ie=ae.INTERNAL,I="Unknown error status: "+ne+" with message "+O.message),E=!0,j.So(new Te(ie,I)),x.close()}else Ae(Mt,`RPC '${e}' stream ${a} received:`,M),j.bo(M)}}),S(c,Th.STAT_EVENT,k=>{k.stat===Bo.PROXY?Ae(Mt,`RPC '${e}' stream ${a} detected buffering proxy`):k.stat===Bo.NOPROXY&&Ae(Mt,`RPC '${e}' stream ${a} detected no buffering proxy`)}),setTimeout(()=>{j.wo()},0),j}}function jo(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qi(r){return new wy(r,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gm{constructor(e,t,n=1e3,a=1.5,i=6e4){this.ui=e,this.timerId=t,this.ko=n,this.qo=a,this.Qo=i,this.Ko=0,this.$o=null,this.Uo=Date.now(),this.reset()}reset(){this.Ko=0}Wo(){this.Ko=this.Qo}Go(e){this.cancel();const t=Math.floor(this.Ko+this.zo()),n=Math.max(0,Date.now()-this.Uo),a=Math.max(0,t-n);a>0&&Ae("ExponentialBackoff",`Backing off for ${a} ms (base delay: ${this.Ko} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.$o=this.ui.enqueueAfterDelay(this.timerId,a,()=>(this.Uo=Date.now(),e())),this.Ko*=this.qo,this.Ko<this.ko&&(this.Ko=this.ko),this.Ko>this.Qo&&(this.Ko=this.Qo)}jo(){this.$o!==null&&(this.$o.skipDelay(),this.$o=null)}cancel(){this.$o!==null&&(this.$o.cancel(),this.$o=null)}zo(){return(Math.random()-.5)*this.Ko}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pm{constructor(e,t,n,a,i,l,c,d){this.ui=e,this.Ho=n,this.Jo=a,this.connection=i,this.authCredentialsProvider=l,this.appCheckCredentialsProvider=c,this.listener=d,this.state=0,this.Yo=0,this.Zo=null,this.Xo=null,this.stream=null,this.e_=0,this.t_=new gm(e,t)}n_(){return this.state===1||this.state===5||this.r_()}r_(){return this.state===2||this.state===3}start(){this.e_=0,this.state!==4?this.auth():this.i_()}async stop(){this.n_()&&await this.close(0)}s_(){this.state=0,this.t_.reset()}o_(){this.r_()&&this.Zo===null&&(this.Zo=this.ui.enqueueAfterDelay(this.Ho,6e4,()=>this.__()))}a_(e){this.u_(),this.stream.send(e)}async __(){if(this.r_())return this.close(0)}u_(){this.Zo&&(this.Zo.cancel(),this.Zo=null)}c_(){this.Xo&&(this.Xo.cancel(),this.Xo=null)}async close(e,t){this.u_(),this.c_(),this.t_.cancel(),this.Yo++,e!==4?this.t_.reset():t&&t.code===ae.RESOURCE_EXHAUSTED?(Mr(t.toString()),Mr("Using maximum backoff delay to prevent overloading the backend."),this.t_.Wo()):t&&t.code===ae.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.l_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.mo(t)}l_(){}auth(){this.state=1;const e=this.h_(this.Yo),t=this.Yo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([n,a])=>{this.Yo===t&&this.P_(n,a)},n=>{e(()=>{const a=new Te(ae.UNKNOWN,"Fetching auth token failed: "+n.message);return this.I_(a)})})}P_(e,t){const n=this.h_(this.Yo);this.stream=this.T_(e,t),this.stream.Eo(()=>{n(()=>this.listener.Eo())}),this.stream.Ro(()=>{n(()=>(this.state=2,this.Xo=this.ui.enqueueAfterDelay(this.Jo,1e4,()=>(this.r_()&&(this.state=3),Promise.resolve())),this.listener.Ro()))}),this.stream.mo(a=>{n(()=>this.I_(a))}),this.stream.onMessage(a=>{n(()=>++this.e_==1?this.E_(a):this.onNext(a))})}i_(){this.state=5,this.t_.Go(async()=>{this.state=0,this.start()})}I_(e){return Ae("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}h_(e){return t=>{this.ui.enqueueAndForget(()=>this.Yo===e?t():(Ae("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class hb extends pm{constructor(e,t,n,a,i,l){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,a,l),this.serializer=i}T_(e,t){return this.connection.Bo("Listen",e,t)}E_(e){return this.onNext(e)}onNext(e){this.t_.reset();const t=Ny(this.serializer,e),n=function(i){if(!("targetChange"in i))return Be.min();const l=i.targetChange;return l.targetIds&&l.targetIds.length?Be.min():l.readTime?fr(l.readTime):Be.min()}(e);return this.listener.d_(t,n)}A_(e){const t={};t.database=Jo(this.serializer),t.addTarget=function(i,l){let c;const d=l.target;if(c=Ho(d)?{documents:Iy(i,d)}:{query:Ty(i,d)._t},c.targetId=l.targetId,l.resumeToken.approximateByteSize()>0){c.resumeToken=am(i,l.resumeToken);const h=Qo(i,l.expectedCount);h!==null&&(c.expectedCount=h)}else if(l.snapshotVersion.compareTo(Be.min())>0){c.readTime=xi(i,l.snapshotVersion.toTimestamp());const h=Qo(i,l.expectedCount);h!==null&&(c.expectedCount=h)}return c}(this.serializer,e);const n=Ay(this.serializer,e);n&&(t.labels=n),this.a_(t)}R_(e){const t={};t.database=Jo(this.serializer),t.removeTarget=e,this.a_(t)}}class mb extends pm{constructor(e,t,n,a,i,l){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,a,l),this.serializer=i}get V_(){return this.e_>0}start(){this.lastStreamToken=void 0,super.start()}l_(){this.V_&&this.m_([])}T_(e,t){return this.connection.Bo("Write",e,t)}E_(e){return ot(!!e.streamToken),this.lastStreamToken=e.streamToken,ot(!e.writeResults||e.writeResults.length===0),this.listener.f_()}onNext(e){ot(!!e.streamToken),this.lastStreamToken=e.streamToken,this.t_.reset();const t=jy(e.writeResults,e.commitTime),n=fr(e.commitTime);return this.listener.g_(n,t)}p_(){const e={};e.database=Jo(this.serializer),this.a_(e)}m_(e){const t={streamToken:this.lastStreamToken,writes:e.map(n=>Ey(this.serializer,n))};this.a_(t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gb extends class{}{constructor(e,t,n,a){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=n,this.serializer=a,this.y_=!1}w_(){if(this.y_)throw new Te(ae.FAILED_PRECONDITION,"The client has already been terminated.")}Mo(e,t,n,a){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,l])=>this.connection.Mo(e,Yo(t,n),a,i,l)).catch(i=>{throw i.name==="FirebaseError"?(i.code===ae.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),i):new Te(ae.UNKNOWN,i.toString())})}Lo(e,t,n,a,i){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([l,c])=>this.connection.Lo(e,Yo(t,n),a,l,c,i)).catch(l=>{throw l.name==="FirebaseError"?(l.code===ae.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),l):new Te(ae.UNKNOWN,l.toString())})}terminate(){this.y_=!0,this.connection.terminate()}}class pb{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.S_=0,this.b_=null,this.D_=!0}v_(){this.S_===0&&(this.C_("Unknown"),this.b_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.b_=null,this.F_("Backend didn't respond within 10 seconds."),this.C_("Offline"),Promise.resolve())))}M_(e){this.state==="Online"?this.C_("Unknown"):(this.S_++,this.S_>=1&&(this.x_(),this.F_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.C_("Offline")))}set(e){this.x_(),this.S_=0,e==="Online"&&(this.D_=!1),this.C_(e)}C_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}F_(e){const t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.D_?(Mr(t),this.D_=!1):Ae("OnlineStateTracker",t)}x_(){this.b_!==null&&(this.b_.cancel(),this.b_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fb{constructor(e,t,n,a,i){this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.O_=[],this.N_=new Map,this.L_=new Set,this.B_=[],this.k_=i,this.k_._o(l=>{n.enqueueAndForget(async()=>{Ps(this)&&(Ae("RemoteStore","Restarting streams for network reachability change."),await async function(d){const h=qe(d);h.L_.add(4),await ga(h),h.q_.set("Unknown"),h.L_.delete(4),await Wi(h)}(this))})}),this.q_=new pb(n,a)}}async function Wi(r){if(Ps(r))for(const e of r.B_)await e(!0)}async function ga(r){for(const e of r.B_)await e(!1)}function fm(r,e){const t=qe(r);t.N_.has(e.targetId)||(t.N_.set(e.targetId,e),Ll(t)?Vl(t):pn(t).r_()&&Ol(t,e))}function Ml(r,e){const t=qe(r),n=pn(t);t.N_.delete(e),n.r_()&&xm(t,e),t.N_.size===0&&(n.r_()?n.o_():Ps(t)&&t.q_.set("Unknown"))}function Ol(r,e){if(r.Q_.xe(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(Be.min())>0){const t=r.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}pn(r).A_(e)}function xm(r,e){r.Q_.xe(e),pn(r).R_(e)}function Vl(r){r.Q_=new xy({getRemoteKeysForTarget:e=>r.remoteSyncer.getRemoteKeysForTarget(e),ot:e=>r.N_.get(e)||null,tt:()=>r.datastore.serializer.databaseId}),pn(r).start(),r.q_.v_()}function Ll(r){return Ps(r)&&!pn(r).n_()&&r.N_.size>0}function Ps(r){return qe(r).L_.size===0}function ym(r){r.Q_=void 0}async function xb(r){r.q_.set("Online")}async function yb(r){r.N_.forEach((e,t)=>{Ol(r,e)})}async function bb(r,e){ym(r),Ll(r)?(r.q_.M_(e),Vl(r)):r.q_.set("Unknown")}async function vb(r,e,t){if(r.q_.set("Online"),e instanceof nm&&e.state===2&&e.cause)try{await async function(a,i){const l=i.cause;for(const c of i.targetIds)a.N_.has(c)&&(await a.remoteSyncer.rejectListen(c,l),a.N_.delete(c),a.Q_.removeTarget(c))}(r,e)}catch(n){Ae("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),n),await yi(r,n)}else if(e instanceof Ja?r.Q_.Ke(e):e instanceof sm?r.Q_.He(e):r.Q_.We(e),!t.isEqual(Be.min()))try{const n=await mm(r.localStore);t.compareTo(n)>=0&&await function(i,l){const c=i.Q_.rt(l);return c.targetChanges.forEach((d,h)=>{if(d.resumeToken.approximateByteSize()>0){const g=i.N_.get(h);g&&i.N_.set(h,g.withResumeToken(d.resumeToken,l))}}),c.targetMismatches.forEach((d,h)=>{const g=i.N_.get(d);if(!g)return;i.N_.set(d,g.withResumeToken(Rt.EMPTY_BYTE_STRING,g.snapshotVersion)),xm(i,d);const x=new rs(g.target,d,h,g.sequenceNumber);Ol(i,x)}),i.remoteSyncer.applyRemoteEvent(c)}(r,t)}catch(n){Ae("RemoteStore","Failed to raise snapshot:",n),await yi(r,n)}}async function yi(r,e,t){if(!ua(e))throw e;r.L_.add(1),await ga(r),r.q_.set("Offline"),t||(t=()=>mm(r.localStore)),r.asyncQueue.enqueueRetryable(async()=>{Ae("RemoteStore","Retrying IndexedDB access"),await t(),r.L_.delete(1),await Wi(r)})}function bm(r,e){return e().catch(t=>yi(r,t,e))}async function zi(r){const e=qe(r),t=us(e);let n=e.O_.length>0?e.O_[e.O_.length-1].batchId:-1;for(;wb(e);)try{const a=await nb(e.localStore,n);if(a===null){e.O_.length===0&&t.o_();break}n=a.batchId,_b(e,a)}catch(a){await yi(e,a)}vm(e)&&wm(e)}function wb(r){return Ps(r)&&r.O_.length<10}function _b(r,e){r.O_.push(e);const t=us(r);t.r_()&&t.V_&&t.m_(e.mutations)}function vm(r){return Ps(r)&&!us(r).n_()&&r.O_.length>0}function wm(r){us(r).start()}async function kb(r){us(r).p_()}async function Nb(r){const e=us(r);for(const t of r.O_)e.m_(t.mutations)}async function Eb(r,e,t){const n=r.O_.shift(),a=Al.from(n,e,t);await bm(r,()=>r.remoteSyncer.applySuccessfulWrite(a)),await zi(r)}async function jb(r,e){e&&us(r).V_&&await async function(n,a){if(function(l){return gy(l)&&l!==ae.ABORTED}(a.code)){const i=n.O_.shift();us(n).s_(),await bm(n,()=>n.remoteSyncer.rejectFailedWrite(i.batchId,a)),await zi(n)}}(r,e),vm(r)&&wm(r)}async function Qd(r,e){const t=qe(r);t.asyncQueue.verifyOperationInProgress(),Ae("RemoteStore","RemoteStore received new credentials");const n=Ps(t);t.L_.add(3),await ga(t),n&&t.q_.set("Unknown"),await t.remoteSyncer.handleCredentialChange(e),t.L_.delete(3),await Wi(t)}async function Ib(r,e){const t=qe(r);e?(t.L_.delete(2),await Wi(t)):e||(t.L_.add(2),await ga(t),t.q_.set("Unknown"))}function pn(r){return r.K_||(r.K_=function(t,n,a){const i=qe(t);return i.w_(),new hb(n,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,a)}(r.datastore,r.asyncQueue,{Eo:xb.bind(null,r),Ro:yb.bind(null,r),mo:bb.bind(null,r),d_:vb.bind(null,r)}),r.B_.push(async e=>{e?(r.K_.s_(),Ll(r)?Vl(r):r.q_.set("Unknown")):(await r.K_.stop(),ym(r))})),r.K_}function us(r){return r.U_||(r.U_=function(t,n,a){const i=qe(t);return i.w_(),new mb(n,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,a)}(r.datastore,r.asyncQueue,{Eo:()=>Promise.resolve(),Ro:kb.bind(null,r),mo:jb.bind(null,r),f_:Nb.bind(null,r),g_:Eb.bind(null,r)}),r.B_.push(async e=>{e?(r.U_.s_(),await zi(r)):(await r.U_.stop(),r.O_.length>0&&(Ae("RemoteStore",`Stopping write stream with ${r.O_.length} pending writes`),r.O_=[]))})),r.U_}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fl{constructor(e,t,n,a,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=a,this.removalCallback=i,this.deferred=new is,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(l=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,n,a,i){const l=Date.now()+n,c=new Fl(e,t,l,a,i);return c.start(n),c}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new Te(ae.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Ul(r,e){if(Mr("AsyncQueue",`${e}: ${r}`),ua(r))return new Te(ae.UNAVAILABLE,`${e}: ${r}`);throw r}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gs{constructor(e){this.comparator=e?(t,n)=>e(t,n)||$e.comparator(t.key,n.key):(t,n)=>$e.comparator(t.key,n.key),this.keyedMap=$n(),this.sortedSet=new mt(this.comparator)}static emptySet(e){return new Gs(e.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,n)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof Gs)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){const a=t.getNext().key,i=n.getNext().key;if(!a.isEqual(i))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){const n=new Gs;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yd{constructor(){this.W_=new mt($e.comparator)}track(e){const t=e.doc.key,n=this.W_.get(t);n?e.type!==0&&n.type===3?this.W_=this.W_.insert(t,e):e.type===3&&n.type!==1?this.W_=this.W_.insert(t,{type:n.type,doc:e.doc}):e.type===2&&n.type===2?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):e.type===2&&n.type===0?this.W_=this.W_.insert(t,{type:0,doc:e.doc}):e.type===1&&n.type===0?this.W_=this.W_.remove(t):e.type===1&&n.type===2?this.W_=this.W_.insert(t,{type:1,doc:n.doc}):e.type===0&&n.type===1?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):Ue():this.W_=this.W_.insert(t,e)}G_(){const e=[];return this.W_.inorderTraversal((t,n)=>{e.push(n)}),e}}class ln{constructor(e,t,n,a,i,l,c,d,h){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=a,this.mutatedKeys=i,this.fromCache=l,this.syncStateChanged=c,this.excludesMetadataChanges=d,this.hasCachedResults=h}static fromInitialDocuments(e,t,n,a,i){const l=[];return t.forEach(c=>{l.push({type:0,doc:c})}),new ln(e,t,Gs.emptySet(t),l,n,a,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Vi(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let a=0;a<t.length;a++)if(t[a].type!==n[a].type||!t[a].doc.isEqual(n[a].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tb{constructor(){this.z_=void 0,this.j_=[]}H_(){return this.j_.some(e=>e.J_())}}class Sb{constructor(){this.queries=Xd(),this.onlineState="Unknown",this.Y_=new Set}terminate(){(function(t,n){const a=qe(t),i=a.queries;a.queries=Xd(),i.forEach((l,c)=>{for(const d of c.j_)d.onError(n)})})(this,new Te(ae.ABORTED,"Firestore shutting down"))}}function Xd(){return new gn(r=>Wh(r),Vi)}async function Ab(r,e){const t=qe(r);let n=3;const a=e.query;let i=t.queries.get(a);i?!i.H_()&&e.J_()&&(n=2):(i=new Tb,n=e.J_()?0:1);try{switch(n){case 0:i.z_=await t.onListen(a,!0);break;case 1:i.z_=await t.onListen(a,!1);break;case 2:await t.onFirstRemoteStoreListen(a)}}catch(l){const c=Ul(l,`Initialization of query '${qs(e.query)}' failed`);return void e.onError(c)}t.queries.set(a,i),i.j_.push(e),e.Z_(t.onlineState),i.z_&&e.X_(i.z_)&&Bl(t)}async function Cb(r,e){const t=qe(r),n=e.query;let a=3;const i=t.queries.get(n);if(i){const l=i.j_.indexOf(e);l>=0&&(i.j_.splice(l,1),i.j_.length===0?a=e.J_()?0:1:!i.H_()&&e.J_()&&(a=2))}switch(a){case 0:return t.queries.delete(n),t.onUnlisten(n,!0);case 1:return t.queries.delete(n),t.onUnlisten(n,!1);case 2:return t.onLastRemoteStoreUnlisten(n);default:return}}function Rb(r,e){const t=qe(r);let n=!1;for(const a of e){const i=a.query,l=t.queries.get(i);if(l){for(const c of l.j_)c.X_(a)&&(n=!0);l.z_=a}}n&&Bl(t)}function Db(r,e,t){const n=qe(r),a=n.queries.get(e);if(a)for(const i of a.j_)i.onError(t);n.queries.delete(e)}function Bl(r){r.Y_.forEach(e=>{e.next()})}var el,Jd;(Jd=el||(el={})).ea="default",Jd.Cache="cache";class Pb{constructor(e,t,n){this.query=e,this.ta=t,this.na=!1,this.ra=null,this.onlineState="Unknown",this.options=n||{}}X_(e){if(!this.options.includeMetadataChanges){const n=[];for(const a of e.docChanges)a.type!==3&&n.push(a);e=new ln(e.query,e.docs,e.oldDocs,n,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.na?this.ia(e)&&(this.ta.next(e),t=!0):this.sa(e,this.onlineState)&&(this.oa(e),t=!0),this.ra=e,t}onError(e){this.ta.error(e)}Z_(e){this.onlineState=e;let t=!1;return this.ra&&!this.na&&this.sa(this.ra,e)&&(this.oa(this.ra),t=!0),t}sa(e,t){if(!e.fromCache||!this.J_())return!0;const n=t!=="Offline";return(!this.options._a||!n)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}ia(e){if(e.docChanges.length>0)return!0;const t=this.ra&&this.ra.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}oa(e){e=ln.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.na=!0,this.ta.next(e)}J_(){return this.options.source!==el.Cache}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _m{constructor(e){this.key=e}}class km{constructor(e){this.key=e}}class $b{constructor(e,t){this.query=e,this.Ta=t,this.Ea=null,this.hasCachedResults=!1,this.current=!1,this.da=Ke(),this.mutatedKeys=Ke(),this.Aa=zh(e),this.Ra=new Gs(this.Aa)}get Va(){return this.Ta}ma(e,t){const n=t?t.fa:new Yd,a=t?t.Ra:this.Ra;let i=t?t.mutatedKeys:this.mutatedKeys,l=a,c=!1;const d=this.query.limitType==="F"&&a.size===this.query.limit?a.last():null,h=this.query.limitType==="L"&&a.size===this.query.limit?a.first():null;if(e.inorderTraversal((g,x)=>{const p=a.get(g),E=Li(this.query,x)?x:null,j=!!p&&this.mutatedKeys.has(p.key),S=!!E&&(E.hasLocalMutations||this.mutatedKeys.has(E.key)&&E.hasCommittedMutations);let k=!1;p&&E?p.data.isEqual(E.data)?j!==S&&(n.track({type:3,doc:E}),k=!0):this.ga(p,E)||(n.track({type:2,doc:E}),k=!0,(d&&this.Aa(E,d)>0||h&&this.Aa(E,h)<0)&&(c=!0)):!p&&E?(n.track({type:0,doc:E}),k=!0):p&&!E&&(n.track({type:1,doc:p}),k=!0,(d||h)&&(c=!0)),k&&(E?(l=l.add(E),i=S?i.add(g):i.delete(g)):(l=l.delete(g),i=i.delete(g)))}),this.query.limit!==null)for(;l.size>this.query.limit;){const g=this.query.limitType==="F"?l.last():l.first();l=l.delete(g.key),i=i.delete(g.key),n.track({type:1,doc:g})}return{Ra:l,fa:n,ns:c,mutatedKeys:i}}ga(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n,a){const i=this.Ra;this.Ra=e.Ra,this.mutatedKeys=e.mutatedKeys;const l=e.fa.G_();l.sort((g,x)=>function(E,j){const S=k=>{switch(k){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Ue()}};return S(E)-S(j)}(g.type,x.type)||this.Aa(g.doc,x.doc)),this.pa(n),a=a!=null&&a;const c=t&&!a?this.ya():[],d=this.da.size===0&&this.current&&!a?1:0,h=d!==this.Ea;return this.Ea=d,l.length!==0||h?{snapshot:new ln(this.query,e.Ra,i,l,e.mutatedKeys,d===0,h,!1,!!n&&n.resumeToken.approximateByteSize()>0),wa:c}:{wa:c}}Z_(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({Ra:this.Ra,fa:new Yd,mutatedKeys:this.mutatedKeys,ns:!1},!1)):{wa:[]}}Sa(e){return!this.Ta.has(e)&&!!this.Ra.has(e)&&!this.Ra.get(e).hasLocalMutations}pa(e){e&&(e.addedDocuments.forEach(t=>this.Ta=this.Ta.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.Ta=this.Ta.delete(t)),this.current=e.current)}ya(){if(!this.current)return[];const e=this.da;this.da=Ke(),this.Ra.forEach(n=>{this.Sa(n.key)&&(this.da=this.da.add(n.key))});const t=[];return e.forEach(n=>{this.da.has(n)||t.push(new km(n))}),this.da.forEach(n=>{e.has(n)||t.push(new _m(n))}),t}ba(e){this.Ta=e.Ts,this.da=Ke();const t=this.ma(e.documents);return this.applyChanges(t,!0)}Da(){return ln.fromInitialDocuments(this.query,this.Ra,this.mutatedKeys,this.Ea===0,this.hasCachedResults)}}class Mb{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}}class Ob{constructor(e){this.key=e,this.va=!1}}class Vb{constructor(e,t,n,a,i,l){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=a,this.currentUser=i,this.maxConcurrentLimboResolutions=l,this.Ca={},this.Fa=new gn(c=>Wh(c),Vi),this.Ma=new Map,this.xa=new Set,this.Oa=new mt($e.comparator),this.Na=new Map,this.La=new Dl,this.Ba={},this.ka=new Map,this.qa=on.kn(),this.onlineState="Unknown",this.Qa=void 0}get isPrimaryClient(){return this.Qa===!0}}async function Lb(r,e,t=!0){const n=Sm(r);let a;const i=n.Fa.get(e);return i?(n.sharedClientState.addLocalQueryTarget(i.targetId),a=i.view.Da()):a=await Nm(n,e,t,!0),a}async function Fb(r,e){const t=Sm(r);await Nm(t,e,!0,!1)}async function Nm(r,e,t,n){const a=await ab(r.localStore,pr(e)),i=a.targetId,l=r.sharedClientState.addLocalQueryTarget(i,t);let c;return n&&(c=await Ub(r,e,i,l==="current",a.resumeToken)),r.isPrimaryClient&&t&&fm(r.remoteStore,a),c}async function Ub(r,e,t,n,a){r.Ka=(x,p,E)=>async function(S,k,L,M){let T=k.view.ma(L);T.ns&&(T=await Hd(S.localStore,k.query,!1).then(({documents:I})=>k.view.ma(I,T)));const O=M&&M.targetChanges.get(k.targetId),ne=M&&M.targetMismatches.get(k.targetId)!=null,ie=k.view.applyChanges(T,S.isPrimaryClient,O,ne);return eu(S,k.targetId,ie.wa),ie.snapshot}(r,x,p,E);const i=await Hd(r.localStore,e,!0),l=new $b(e,i.Ts),c=l.ma(i.documents),d=ma.createSynthesizedTargetChangeForCurrentChange(t,n&&r.onlineState!=="Offline",a),h=l.applyChanges(c,r.isPrimaryClient,d);eu(r,t,h.wa);const g=new Mb(e,t,l);return r.Fa.set(e,g),r.Ma.has(t)?r.Ma.get(t).push(e):r.Ma.set(t,[e]),h.snapshot}async function Bb(r,e,t){const n=qe(r),a=n.Fa.get(e),i=n.Ma.get(a.targetId);if(i.length>1)return n.Ma.set(a.targetId,i.filter(l=>!Vi(l,e))),void n.Fa.delete(e);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(a.targetId),n.sharedClientState.isActiveQueryTarget(a.targetId)||await Zo(n.localStore,a.targetId,!1).then(()=>{n.sharedClientState.clearQueryState(a.targetId),t&&Ml(n.remoteStore,a.targetId),tl(n,a.targetId)}).catch(da)):(tl(n,a.targetId),await Zo(n.localStore,a.targetId,!0))}async function qb(r,e){const t=qe(r),n=t.Fa.get(e),a=t.Ma.get(n.targetId);t.isPrimaryClient&&a.length===1&&(t.sharedClientState.removeLocalQueryTarget(n.targetId),Ml(t.remoteStore,n.targetId))}async function Wb(r,e,t){const n=Xb(r);try{const a=await function(l,c){const d=qe(l),h=_t.now(),g=c.reduce((E,j)=>E.add(j.key),Ke());let x,p;return d.persistence.runTransaction("Locally write mutations","readwrite",E=>{let j=Or(),S=Ke();return d.cs.getEntries(E,g).next(k=>{j=k,j.forEach((L,M)=>{M.isValidDocument()||(S=S.add(L))})}).next(()=>d.localDocuments.getOverlayedDocuments(E,j)).next(k=>{x=k;const L=[];for(const M of c){const T=cy(M,x.get(M.key).overlayedDocument);T!=null&&L.push(new hs(M.key,T,$h(T.value.mapValue),ar.exists(!0)))}return d.mutationQueue.addMutationBatch(E,h,L,c)}).next(k=>{p=k;const L=k.applyToLocalDocumentSet(x,S);return d.documentOverlayCache.saveOverlays(E,k.batchId,L)})}).then(()=>({batchId:p.batchId,changes:Gh(x)}))}(n.localStore,e);n.sharedClientState.addPendingMutation(a.batchId),function(l,c,d){let h=l.Ba[l.currentUser.toKey()];h||(h=new mt(st)),h=h.insert(c,d),l.Ba[l.currentUser.toKey()]=h}(n,a.batchId,t),await pa(n,a.changes),await zi(n.remoteStore)}catch(a){const i=Ul(a,"Failed to persist write");t.reject(i)}}async function Em(r,e){const t=qe(r);try{const n=await rb(t.localStore,e);e.targetChanges.forEach((a,i)=>{const l=t.Na.get(i);l&&(ot(a.addedDocuments.size+a.modifiedDocuments.size+a.removedDocuments.size<=1),a.addedDocuments.size>0?l.va=!0:a.modifiedDocuments.size>0?ot(l.va):a.removedDocuments.size>0&&(ot(l.va),l.va=!1))}),await pa(t,n,e)}catch(n){await da(n)}}function Zd(r,e,t){const n=qe(r);if(n.isPrimaryClient&&t===0||!n.isPrimaryClient&&t===1){const a=[];n.Fa.forEach((i,l)=>{const c=l.view.Z_(e);c.snapshot&&a.push(c.snapshot)}),function(l,c){const d=qe(l);d.onlineState=c;let h=!1;d.queries.forEach((g,x)=>{for(const p of x.j_)p.Z_(c)&&(h=!0)}),h&&Bl(d)}(n.eventManager,e),a.length&&n.Ca.d_(a),n.onlineState=e,n.isPrimaryClient&&n.sharedClientState.setOnlineState(e)}}async function zb(r,e,t){const n=qe(r);n.sharedClientState.updateQueryState(e,"rejected",t);const a=n.Na.get(e),i=a&&a.key;if(i){let l=new mt($e.comparator);l=l.insert(i,Vt.newNoDocument(i,Be.min()));const c=Ke().add(i),d=new Bi(Be.min(),new Map,new mt(st),l,c);await Em(n,d),n.Oa=n.Oa.remove(i),n.Na.delete(e),ql(n)}else await Zo(n.localStore,e,!1).then(()=>tl(n,e,t)).catch(da)}async function Hb(r,e){const t=qe(r),n=e.batch.batchId;try{const a=await tb(t.localStore,e);Im(t,n,null),jm(t,n),t.sharedClientState.updateMutationState(n,"acknowledged"),await pa(t,a)}catch(a){await da(a)}}async function Gb(r,e,t){const n=qe(r);try{const a=await function(l,c){const d=qe(l);return d.persistence.runTransaction("Reject batch","readwrite-primary",h=>{let g;return d.mutationQueue.lookupMutationBatch(h,c).next(x=>(ot(x!==null),g=x.keys(),d.mutationQueue.removeMutationBatch(h,x))).next(()=>d.mutationQueue.performConsistencyCheck(h)).next(()=>d.documentOverlayCache.removeOverlaysForBatchId(h,g,c)).next(()=>d.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(h,g)).next(()=>d.localDocuments.getDocuments(h,g))})}(n.localStore,e);Im(n,e,t),jm(n,e),n.sharedClientState.updateMutationState(e,"rejected",t),await pa(n,a)}catch(a){await da(a)}}function jm(r,e){(r.ka.get(e)||[]).forEach(t=>{t.resolve()}),r.ka.delete(e)}function Im(r,e,t){const n=qe(r);let a=n.Ba[n.currentUser.toKey()];if(a){const i=a.get(e);i&&(t?i.reject(t):i.resolve(),a=a.remove(e)),n.Ba[n.currentUser.toKey()]=a}}function tl(r,e,t=null){r.sharedClientState.removeLocalQueryTarget(e);for(const n of r.Ma.get(e))r.Fa.delete(n),t&&r.Ca.$a(n,t);r.Ma.delete(e),r.isPrimaryClient&&r.La.gr(e).forEach(n=>{r.La.containsKey(n)||Tm(r,n)})}function Tm(r,e){r.xa.delete(e.path.canonicalString());const t=r.Oa.get(e);t!==null&&(Ml(r.remoteStore,t),r.Oa=r.Oa.remove(e),r.Na.delete(t),ql(r))}function eu(r,e,t){for(const n of t)n instanceof _m?(r.La.addReference(n.key,e),Kb(r,n)):n instanceof km?(Ae("SyncEngine","Document no longer in limbo: "+n.key),r.La.removeReference(n.key,e),r.La.containsKey(n.key)||Tm(r,n.key)):Ue()}function Kb(r,e){const t=e.key,n=t.path.canonicalString();r.Oa.get(t)||r.xa.has(n)||(Ae("SyncEngine","New document in limbo: "+t),r.xa.add(n),ql(r))}function ql(r){for(;r.xa.size>0&&r.Oa.size<r.maxConcurrentLimboResolutions;){const e=r.xa.values().next().value;r.xa.delete(e);const t=new $e(ut.fromString(e)),n=r.qa.next();r.Na.set(n,new Ob(t)),r.Oa=r.Oa.insert(t,n),fm(r.remoteStore,new rs(pr(Bh(t.path)),n,"TargetPurposeLimboResolution",_l.oe))}}async function pa(r,e,t){const n=qe(r),a=[],i=[],l=[];n.Fa.isEmpty()||(n.Fa.forEach((c,d)=>{l.push(n.Ka(d,e,t).then(h=>{var g;if((h||t)&&n.isPrimaryClient){const x=h?!h.fromCache:(g=t==null?void 0:t.targetChanges.get(d.targetId))===null||g===void 0?void 0:g.current;n.sharedClientState.updateQueryState(d.targetId,x?"current":"not-current")}if(h){a.push(h);const x=$l.Wi(d.targetId,h);i.push(x)}}))}),await Promise.all(l),n.Ca.d_(a),await async function(d,h){const g=qe(d);try{await g.persistence.runTransaction("notifyLocalViewChanges","readwrite",x=>ce.forEach(h,p=>ce.forEach(p.$i,E=>g.persistence.referenceDelegate.addReference(x,p.targetId,E)).next(()=>ce.forEach(p.Ui,E=>g.persistence.referenceDelegate.removeReference(x,p.targetId,E)))))}catch(x){if(!ua(x))throw x;Ae("LocalStore","Failed to update sequence numbers: "+x)}for(const x of h){const p=x.targetId;if(!x.fromCache){const E=g.os.get(p),j=E.snapshotVersion,S=E.withLastLimboFreeSnapshotVersion(j);g.os=g.os.insert(p,S)}}}(n.localStore,i))}async function Qb(r,e){const t=qe(r);if(!t.currentUser.isEqual(e)){Ae("SyncEngine","User change. New user:",e.toKey());const n=await hm(t.localStore,e);t.currentUser=e,function(i,l){i.ka.forEach(c=>{c.forEach(d=>{d.reject(new Te(ae.CANCELLED,l))})}),i.ka.clear()}(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,n.removedBatchIds,n.addedBatchIds),await pa(t,n.hs)}}function Yb(r,e){const t=qe(r),n=t.Na.get(e);if(n&&n.va)return Ke().add(n.key);{let a=Ke();const i=t.Ma.get(e);if(!i)return a;for(const l of i){const c=t.Fa.get(l);a=a.unionWith(c.view.Va)}return a}}function Sm(r){const e=qe(r);return e.remoteStore.remoteSyncer.applyRemoteEvent=Em.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=Yb.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=zb.bind(null,e),e.Ca.d_=Rb.bind(null,e.eventManager),e.Ca.$a=Db.bind(null,e.eventManager),e}function Xb(r){const e=qe(r);return e.remoteStore.remoteSyncer.applySuccessfulWrite=Hb.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=Gb.bind(null,e),e}class bi{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=qi(e.databaseInfo.databaseId),this.sharedClientState=this.Wa(e),this.persistence=this.Ga(e),await this.persistence.start(),this.localStore=this.za(e),this.gcScheduler=this.ja(e,this.localStore),this.indexBackfillerScheduler=this.Ha(e,this.localStore)}ja(e,t){return null}Ha(e,t){return null}za(e){return eb(this.persistence,new Jy,e.initialUser,this.serializer)}Ga(e){return new Qy(Pl.Zr,this.serializer)}Wa(e){return new ob}async terminate(){var e,t;(e=this.gcScheduler)===null||e===void 0||e.stop(),(t=this.indexBackfillerScheduler)===null||t===void 0||t.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}bi.provider={build:()=>new bi};class rl{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=n=>Zd(this.syncEngine,n,1),this.remoteStore.remoteSyncer.handleCredentialChange=Qb.bind(null,this.syncEngine),await Ib(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return function(){return new Sb}()}createDatastore(e){const t=qi(e.databaseInfo.databaseId),n=function(i){return new ub(i)}(e.databaseInfo);return function(i,l,c,d){return new gb(i,l,c,d)}(e.authCredentials,e.appCheckCredentials,n,t)}createRemoteStore(e){return function(n,a,i,l,c){return new fb(n,a,i,l,c)}(this.localStore,this.datastore,e.asyncQueue,t=>Zd(this.syncEngine,t,0),function(){return Kd.D()?new Kd:new lb}())}createSyncEngine(e,t){return function(a,i,l,c,d,h,g){const x=new Vb(a,i,l,c,d,h);return g&&(x.Qa=!0),x}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){var e,t;await async function(a){const i=qe(a);Ae("RemoteStore","RemoteStore shutting down."),i.L_.add(5),await ga(i),i.k_.shutdown(),i.q_.set("Unknown")}(this.remoteStore),(e=this.datastore)===null||e===void 0||e.terminate(),(t=this.eventManager)===null||t===void 0||t.terminate()}}rl.provider={build:()=>new rl};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jb{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ya(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ya(this.observer.error,e):Mr("Uncaught Error in snapshot listener:",e.toString()))}Za(){this.muted=!0}Ya(e,t){setTimeout(()=>{this.muted||e(t)},0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zb{constructor(e,t,n,a,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=a,this.user=Ot.UNAUTHENTICATED,this.clientId=Rh.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(n,async l=>{Ae("FirestoreClient","Received user=",l.uid),await this.authCredentialListener(l),this.user=l}),this.appCheckCredentials.start(n,l=>(Ae("FirestoreClient","Received new app check token=",l),this.appCheckCredentialListener(l,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new is;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const n=Ul(t,"Failed to shutdown persistence");e.reject(n)}}),e.promise}}async function Io(r,e){r.asyncQueue.verifyOperationInProgress(),Ae("FirestoreClient","Initializing OfflineComponentProvider");const t=r.configuration;await e.initialize(t);let n=t.initialUser;r.setCredentialChangeListener(async a=>{n.isEqual(a)||(await hm(e.localStore,a),n=a)}),e.persistence.setDatabaseDeletedListener(()=>r.terminate()),r._offlineComponents=e}async function tu(r,e){r.asyncQueue.verifyOperationInProgress();const t=await ev(r);Ae("FirestoreClient","Initializing OnlineComponentProvider"),await e.initialize(t,r.configuration),r.setCredentialChangeListener(n=>Qd(e.remoteStore,n)),r.setAppCheckTokenChangeListener((n,a)=>Qd(e.remoteStore,a)),r._onlineComponents=e}async function ev(r){if(!r._offlineComponents)if(r._uninitializedComponentsProvider){Ae("FirestoreClient","Using user provided OfflineComponentProvider");try{await Io(r,r._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!function(a){return a.name==="FirebaseError"?a.code===ae.FAILED_PRECONDITION||a.code===ae.UNIMPLEMENTED:!(typeof DOMException<"u"&&a instanceof DOMException)||a.code===22||a.code===20||a.code===11}(t))throw t;rn("Error using user provided cache. Falling back to memory cache: "+t),await Io(r,new bi)}}else Ae("FirestoreClient","Using default OfflineComponentProvider"),await Io(r,new bi);return r._offlineComponents}async function Am(r){return r._onlineComponents||(r._uninitializedComponentsProvider?(Ae("FirestoreClient","Using user provided OnlineComponentProvider"),await tu(r,r._uninitializedComponentsProvider._online)):(Ae("FirestoreClient","Using default OnlineComponentProvider"),await tu(r,new rl))),r._onlineComponents}function tv(r){return Am(r).then(e=>e.syncEngine)}async function rv(r){const e=await Am(r),t=e.eventManager;return t.onListen=Lb.bind(null,e.syncEngine),t.onUnlisten=Bb.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=Fb.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=qb.bind(null,e.syncEngine),t}function sv(r,e,t={}){const n=new is;return r.asyncQueue.enqueueAndForget(async()=>function(i,l,c,d,h){const g=new Jb({next:p=>{g.Za(),l.enqueueAndForget(()=>Cb(i,x)),p.fromCache&&d.source==="server"?h.reject(new Te(ae.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):h.resolve(p)},error:p=>h.reject(p)}),x=new Pb(c,g,{includeMetadataChanges:!0,_a:!0});return Ab(i,x)}(await rv(r),r.asyncQueue,e,t,n)),n.promise}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Cm(r){const e={};return r.timeoutSeconds!==void 0&&(e.timeoutSeconds=r.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ru=new Map;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Rm(r,e,t){if(!t)throw new Te(ae.INVALID_ARGUMENT,`Function ${r}() cannot be called with an empty ${e}.`)}function nv(r,e,t,n){if(e===!0&&n===!0)throw new Te(ae.INVALID_ARGUMENT,`${r} and ${t} cannot be used together.`)}function su(r){if(!$e.isDocumentKey(r))throw new Te(ae.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${r} has ${r.length}.`)}function nu(r){if($e.isDocumentKey(r))throw new Te(ae.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${r} has ${r.length}.`)}function Hi(r){if(r===void 0)return"undefined";if(r===null)return"null";if(typeof r=="string")return r.length>20&&(r=`${r.substring(0,20)}...`),JSON.stringify(r);if(typeof r=="number"||typeof r=="boolean")return""+r;if(typeof r=="object"){if(r instanceof Array)return"an array";{const e=function(n){return n.constructor?n.constructor.name:null}(r);return e?`a custom ${e} object`:"an object"}}return typeof r=="function"?"a function":Ue()}function Ss(r,e){if("_delegate"in r&&(r=r._delegate),!(r instanceof e)){if(e.name===r.constructor.name)throw new Te(ae.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=Hi(r);throw new Te(ae.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return r}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class au{constructor(e){var t,n;if(e.host===void 0){if(e.ssl!==void 0)throw new Te(ae.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=(t=e.ssl)===null||t===void 0||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new Te(ae.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}nv("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=Cm((n=e.experimentalLongPollingOptions)!==null&&n!==void 0?n:{}),function(i){if(i.timeoutSeconds!==void 0){if(isNaN(i.timeoutSeconds))throw new Te(ae.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (must not be NaN)`);if(i.timeoutSeconds<5)throw new Te(ae.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (minimum allowed value is 5)`);if(i.timeoutSeconds>30)throw new Te(ae.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(n,a){return n.timeoutSeconds===a.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class Gi{constructor(e,t,n,a){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=a,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new au({}),this._settingsFrozen=!1,this._terminateTask="notTerminated"}get app(){if(!this._app)throw new Te(ae.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new Te(ae.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new au(e),e.credentials!==void 0&&(this._authCredentials=function(n){if(!n)return new yx;switch(n.type){case"firstParty":return new _x(n.sessionIndex||"0",n.iamToken||null,n.authTokenFactory||null);case"provider":return n.client;default:throw new Te(ae.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const n=ru.get(t);n&&(Ae("ComponentProvider","Removing Datastore"),ru.delete(t),n.terminate())}(this),Promise.resolve()}}function av(r,e,t,n={}){var a;const i=(r=Ss(r,Gi))._getSettings(),l=`${e}:${t}`;if(i.host!=="firestore.googleapis.com"&&i.host!==l&&rn("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),r._setSettings(Object.assign(Object.assign({},i),{host:l,ssl:!1})),n.mockUserToken){let c,d;if(typeof n.mockUserToken=="string")c=n.mockUserToken,d=Ot.MOCK_USER;else{c=bh(n.mockUserToken,(a=r._app)===null||a===void 0?void 0:a.options.projectId);const h=n.mockUserToken.sub||n.mockUserToken.user_id;if(!h)throw new Te(ae.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");d=new Ot(h)}r._authCredentials=new bx(new Ch(c,d))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $s{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new $s(this.firestore,e,this._query)}}class Jt{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new os(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Jt(this.firestore,e,this._key)}}class os extends $s{constructor(e,t,n){super(e,t,Bh(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Jt(this.firestore,null,new $e(e))}withConverter(e){return new os(this.firestore,e,this._path)}}function jt(r,e,...t){if(r=Ut(r),Rm("collection","path",e),r instanceof Gi){const n=ut.fromString(e,...t);return nu(n),new os(r,null,n)}{if(!(r instanceof Jt||r instanceof os))throw new Te(ae.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const n=r._path.child(ut.fromString(e,...t));return nu(n),new os(r.firestore,null,n)}}function qt(r,e,...t){if(r=Ut(r),arguments.length===1&&(e=Rh.newId()),Rm("doc","path",e),r instanceof Gi){const n=ut.fromString(e,...t);return su(n),new Jt(r,null,new $e(n))}{if(!(r instanceof Jt||r instanceof os))throw new Te(ae.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const n=r._path.child(ut.fromString(e,...t));return su(n),new Jt(r.firestore,r instanceof os?r.converter:null,new $e(n))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iu{constructor(e=Promise.resolve()){this.Pu=[],this.Iu=!1,this.Tu=[],this.Eu=null,this.du=!1,this.Au=!1,this.Ru=[],this.t_=new gm(this,"async_queue_retry"),this.Vu=()=>{const n=jo();n&&Ae("AsyncQueue","Visibility state changed to "+n.visibilityState),this.t_.jo()},this.mu=e;const t=jo();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this.Vu)}get isShuttingDown(){return this.Iu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.fu(),this.gu(e)}enterRestrictedMode(e){if(!this.Iu){this.Iu=!0,this.Au=e||!1;const t=jo();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this.Vu)}}enqueue(e){if(this.fu(),this.Iu)return new Promise(()=>{});const t=new is;return this.gu(()=>this.Iu&&this.Au?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Pu.push(e),this.pu()))}async pu(){if(this.Pu.length!==0){try{await this.Pu[0](),this.Pu.shift(),this.t_.reset()}catch(e){if(!ua(e))throw e;Ae("AsyncQueue","Operation failed with retryable error: "+e)}this.Pu.length>0&&this.t_.Go(()=>this.pu())}}gu(e){const t=this.mu.then(()=>(this.du=!0,e().catch(n=>{this.Eu=n,this.du=!1;const a=function(l){let c=l.message||"";return l.stack&&(c=l.stack.includes(l.message)?l.stack:l.message+`
`+l.stack),c}(n);throw Mr("INTERNAL UNHANDLED ERROR: ",a),n}).then(n=>(this.du=!1,n))));return this.mu=t,t}enqueueAfterDelay(e,t,n){this.fu(),this.Ru.indexOf(e)>-1&&(t=0);const a=Fl.createAndSchedule(this,e,t,n,i=>this.yu(i));return this.Tu.push(a),a}fu(){this.Eu&&Ue()}verifyOperationInProgress(){}async wu(){let e;do e=this.mu,await e;while(e!==this.mu)}Su(e){for(const t of this.Tu)if(t.timerId===e)return!0;return!1}bu(e){return this.wu().then(()=>{this.Tu.sort((t,n)=>t.targetTimeMs-n.targetTimeMs);for(const t of this.Tu)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.wu()})}Du(e){this.Ru.push(e)}yu(e){const t=this.Tu.indexOf(e);this.Tu.splice(t,1)}}class fa extends Gi{constructor(e,t,n,a){super(e,t,n,a),this.type="firestore",this._queue=new iu,this._persistenceKey=(a==null?void 0:a.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new iu(e),this._firestoreClient=void 0,await e}}}function iv(r,e){const t=typeof r=="object"?r:vl(),n=typeof r=="string"?r:"(default)",a=Mi(t,"firestore").getImmediate({identifier:n});if(!a._initialized){const i=fh("firestore");i&&av(a,...i)}return a}function Dm(r){if(r._terminated)throw new Te(ae.FAILED_PRECONDITION,"The client has already been terminated.");return r._firestoreClient||ov(r),r._firestoreClient}function ov(r){var e,t,n;const a=r._freezeSettings(),i=function(c,d,h,g){return new $x(c,d,h,g.host,g.ssl,g.experimentalForceLongPolling,g.experimentalAutoDetectLongPolling,Cm(g.experimentalLongPollingOptions),g.useFetchStreams)}(r._databaseId,((e=r._app)===null||e===void 0?void 0:e.options.appId)||"",r._persistenceKey,a);r._componentsProvider||!((t=a.localCache)===null||t===void 0)&&t._offlineComponentProvider&&(!((n=a.localCache)===null||n===void 0)&&n._onlineComponentProvider)&&(r._componentsProvider={_offline:a.localCache._offlineComponentProvider,_online:a.localCache._onlineComponentProvider}),r._firestoreClient=new Zb(r._authCredentials,r._appCheckCredentials,r._queue,i,r._componentsProvider&&function(c){const d=c==null?void 0:c._online.build();return{_offline:c==null?void 0:c._offline.build(d),_online:d}}(r._componentsProvider))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cn{constructor(e){this._byteString=e}static fromBase64String(e){try{return new cn(Rt.fromBase64String(e))}catch(t){throw new Te(ae.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new cn(Rt.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ki{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new Te(ae.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new St(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wl{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zl{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new Te(ae.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new Te(ae.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return st(this._lat,e._lat)||st(this._long,e._long)}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hl{constructor(e){this._values=(e||[]).map(t=>t)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(n,a){if(n.length!==a.length)return!1;for(let i=0;i<n.length;++i)if(n[i]!==a[i])return!1;return!0}(this._values,e._values)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lv=/^__.*__$/;class cv{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return this.fieldMask!==null?new hs(e,this.data,this.fieldMask,t,this.fieldTransforms):new ha(e,this.data,t,this.fieldTransforms)}}class Pm{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return new hs(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function $m(r){switch(r){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Ue()}}class Gl{constructor(e,t,n,a,i,l){this.settings=e,this.databaseId=t,this.serializer=n,this.ignoreUndefinedProperties=a,i===void 0&&this.vu(),this.fieldTransforms=i||[],this.fieldMask=l||[]}get path(){return this.settings.path}get Cu(){return this.settings.Cu}Fu(e){return new Gl(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Mu(e){var t;const n=(t=this.path)===null||t===void 0?void 0:t.child(e),a=this.Fu({path:n,xu:!1});return a.Ou(e),a}Nu(e){var t;const n=(t=this.path)===null||t===void 0?void 0:t.child(e),a=this.Fu({path:n,xu:!1});return a.vu(),a}Lu(e){return this.Fu({path:void 0,xu:!0})}Bu(e){return vi(e,this.settings.methodName,this.settings.ku||!1,this.path,this.settings.qu)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}vu(){if(this.path)for(let e=0;e<this.path.length;e++)this.Ou(this.path.get(e))}Ou(e){if(e.length===0)throw this.Bu("Document fields must not be empty");if($m(this.Cu)&&lv.test(e))throw this.Bu('Document fields cannot begin and end with "__"')}}class dv{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=n||qi(e)}Qu(e,t,n,a=!1){return new Gl({Cu:e,methodName:t,qu:n,path:St.emptyPath(),xu:!1,ku:a},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function Kl(r){const e=r._freezeSettings(),t=qi(r._databaseId);return new dv(r._databaseId,!!e.ignoreUndefinedProperties,t)}function uv(r,e,t,n,a,i={}){const l=r.Qu(i.merge||i.mergeFields?2:0,e,t,a);Ql("Data must be an object, but it was:",l,n);const c=Mm(n,l);let d,h;if(i.merge)d=new Xt(l.fieldMask),h=l.fieldTransforms;else if(i.mergeFields){const g=[];for(const x of i.mergeFields){const p=sl(e,x,t);if(!l.contains(p))throw new Te(ae.INVALID_ARGUMENT,`Field '${p}' is specified in your field mask but missing from your input data.`);Vm(g,p)||g.push(p)}d=new Xt(g),h=l.fieldTransforms.filter(x=>d.covers(x.field))}else d=null,h=l.fieldTransforms;return new cv(new Ht(c),d,h)}class Qi extends Wl{_toFieldTransform(e){if(e.Cu!==2)throw e.Cu===1?e.Bu(`${this._methodName}() can only appear at the top level of your update data`):e.Bu(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof Qi}}function hv(r,e,t,n){const a=r.Qu(1,e,t);Ql("Data must be an object, but it was:",a,n);const i=[],l=Ht.empty();Ds(n,(d,h)=>{const g=Yl(e,d,t);h=Ut(h);const x=a.Nu(g);if(h instanceof Qi)i.push(g);else{const p=xa(h,x);p!=null&&(i.push(g),l.set(g,p))}});const c=new Xt(i);return new Pm(l,c,a.fieldTransforms)}function mv(r,e,t,n,a,i){const l=r.Qu(1,e,t),c=[sl(e,n,t)],d=[a];if(i.length%2!=0)throw new Te(ae.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let p=0;p<i.length;p+=2)c.push(sl(e,i[p])),d.push(i[p+1]);const h=[],g=Ht.empty();for(let p=c.length-1;p>=0;--p)if(!Vm(h,c[p])){const E=c[p];let j=d[p];j=Ut(j);const S=l.Nu(E);if(j instanceof Qi)h.push(E);else{const k=xa(j,S);k!=null&&(h.push(E),g.set(E,k))}}const x=new Xt(h);return new Pm(g,x,l.fieldTransforms)}function gv(r,e,t,n=!1){return xa(t,r.Qu(n?4:3,e))}function xa(r,e){if(Om(r=Ut(r)))return Ql("Unsupported field value:",e,r),Mm(r,e);if(r instanceof Wl)return function(n,a){if(!$m(a.Cu))throw a.Bu(`${n._methodName}() can only be used with update() and set()`);if(!a.path)throw a.Bu(`${n._methodName}() is not currently supported inside arrays`);const i=n._toFieldTransform(a);i&&a.fieldTransforms.push(i)}(r,e),null;if(r===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),r instanceof Array){if(e.settings.xu&&e.Cu!==4)throw e.Bu("Nested arrays are not supported");return function(n,a){const i=[];let l=0;for(const c of n){let d=xa(c,a.Lu(l));d==null&&(d={nullValue:"NULL_VALUE"}),i.push(d),l++}return{arrayValue:{values:i}}}(r,e)}return function(n,a){if((n=Ut(n))===null)return{nullValue:"NULL_VALUE"};if(typeof n=="number")return sy(a.serializer,n);if(typeof n=="boolean")return{booleanValue:n};if(typeof n=="string")return{stringValue:n};if(n instanceof Date){const i=_t.fromDate(n);return{timestampValue:xi(a.serializer,i)}}if(n instanceof _t){const i=new _t(n.seconds,1e3*Math.floor(n.nanoseconds/1e3));return{timestampValue:xi(a.serializer,i)}}if(n instanceof zl)return{geoPointValue:{latitude:n.latitude,longitude:n.longitude}};if(n instanceof cn)return{bytesValue:am(a.serializer,n._byteString)};if(n instanceof Jt){const i=a.databaseId,l=n.firestore._databaseId;if(!l.isEqual(i))throw a.Bu(`Document reference is for database ${l.projectId}/${l.database} but should be for database ${i.projectId}/${i.database}`);return{referenceValue:Rl(n.firestore._databaseId||a.databaseId,n._key.path)}}if(n instanceof Hl)return function(l,c){return{mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{values:l.toArray().map(d=>{if(typeof d!="number")throw c.Bu("VectorValues must only contain numeric values.");return Tl(c.serializer,d)})}}}}}}(n,a);throw a.Bu(`Unsupported field value: ${Hi(n)}`)}(r,e)}function Mm(r,e){const t={};return Dh(r)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Ds(r,(n,a)=>{const i=xa(a,e.Mu(n));i!=null&&(t[n]=i)}),{mapValue:{fields:t}}}function Om(r){return!(typeof r!="object"||r===null||r instanceof Array||r instanceof Date||r instanceof _t||r instanceof zl||r instanceof cn||r instanceof Jt||r instanceof Wl||r instanceof Hl)}function Ql(r,e,t){if(!Om(t)||!function(a){return typeof a=="object"&&a!==null&&(Object.getPrototypeOf(a)===Object.prototype||Object.getPrototypeOf(a)===null)}(t)){const n=Hi(t);throw n==="an object"?e.Bu(r+" a custom object"):e.Bu(r+" "+n)}}function sl(r,e,t){if((e=Ut(e))instanceof Ki)return e._internalPath;if(typeof e=="string")return Yl(r,e);throw vi("Field path arguments must be of type string or ",r,!1,void 0,t)}const pv=new RegExp("[~\\*/\\[\\]]");function Yl(r,e,t){if(e.search(pv)>=0)throw vi(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,r,!1,void 0,t);try{return new Ki(...e.split("."))._internalPath}catch{throw vi(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,r,!1,void 0,t)}}function vi(r,e,t,n,a){const i=n&&!n.isEmpty(),l=a!==void 0;let c=`Function ${e}() called with invalid data`;t&&(c+=" (via `toFirestore()`)"),c+=". ";let d="";return(i||l)&&(d+=" (found",i&&(d+=` in field ${n}`),l&&(d+=` in document ${a}`),d+=")"),new Te(ae.INVALID_ARGUMENT,c+r+d)}function Vm(r,e){return r.some(t=>t.isEqual(e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lm{constructor(e,t,n,a,i){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=a,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new Jt(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new fv(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(Yi("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}}class fv extends Lm{data(){return super.data()}}function Yi(r,e){return typeof e=="string"?Yl(r,e):e instanceof Ki?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xv(r){if(r.limitType==="L"&&r.explicitOrderBy.length===0)throw new Te(ae.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class Xl{}class Fm extends Xl{}function yt(r,e,...t){let n=[];e instanceof Xl&&n.push(e),n=n.concat(t),function(i){const l=i.filter(d=>d instanceof Jl).length,c=i.filter(d=>d instanceof Xi).length;if(l>1||l>0&&c>0)throw new Te(ae.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(n);for(const a of n)r=a._apply(r);return r}class Xi extends Fm{constructor(e,t,n){super(),this._field=e,this._op=t,this._value=n,this.type="where"}static _create(e,t,n){return new Xi(e,t,n)}_apply(e){const t=this._parse(e);return Um(e._query,t),new $s(e.firestore,e.converter,Go(e._query,t))}_parse(e){const t=Kl(e.firestore);return function(i,l,c,d,h,g,x){let p;if(h.isKeyField()){if(g==="array-contains"||g==="array-contains-any")throw new Te(ae.INVALID_ARGUMENT,`Invalid Query. You can't perform '${g}' queries on documentId().`);if(g==="in"||g==="not-in"){lu(x,g);const E=[];for(const j of x)E.push(ou(d,i,j));p={arrayValue:{values:E}}}else p=ou(d,i,x)}else g!=="in"&&g!=="not-in"&&g!=="array-contains-any"||lu(x,g),p=gv(c,l,x,g==="in"||g==="not-in");return vt.create(h,g,p)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}}function Kt(r,e,t){const n=e,a=Yi("where",r);return Xi._create(a,n,t)}class Jl extends Xl{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new Jl(e,t)}_parse(e){const t=this._queryConstraints.map(n=>n._parse(e)).filter(n=>n.getFilters().length>0);return t.length===1?t[0]:or.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return t.getFilters().length===0?e:(function(a,i){let l=a;const c=i.getFlattenedFilters();for(const d of c)Um(l,d),l=Go(l,d)}(e._query,t),new $s(e.firestore,e.converter,Go(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}class Zl extends Fm{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new Zl(e,t)}_apply(e){const t=function(a,i,l){if(a.startAt!==null)throw new Te(ae.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(a.endAt!==null)throw new Te(ae.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new Xn(i,l)}(e._query,this._field,this._direction);return new $s(e.firestore,e.converter,function(a,i){const l=a.explicitOrderBy.concat([i]);return new mn(a.path,a.collectionGroup,l,a.filters.slice(),a.limit,a.limitType,a.startAt,a.endAt)}(e._query,t))}}function ea(r,e="asc"){const t=e,n=Yi("orderBy",r);return Zl._create(n,t)}function ou(r,e,t){if(typeof(t=Ut(t))=="string"){if(t==="")throw new Te(ae.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!qh(e)&&t.indexOf("/")!==-1)throw new Te(ae.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);const n=e.path.child(ut.fromString(t));if(!$e.isDocumentKey(n))throw new Te(ae.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${n}' is not because it has an odd number of segments (${n.length}).`);return Sd(r,new $e(n))}if(t instanceof Jt)return Sd(r,t._key);throw new Te(ae.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Hi(t)}.`)}function lu(r,e){if(!Array.isArray(r)||r.length===0)throw new Te(ae.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function Um(r,e){const t=function(a,i){for(const l of a)for(const c of l.getFlattenedFilters())if(i.indexOf(c.op)>=0)return c.op;return null}(r.filters,function(a){switch(a){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(t!==null)throw t===e.op?new Te(ae.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new Te(ae.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}class yv{convertValue(e,t="none"){switch(Ts(e)){case 0:return null;case 1:return e.booleanValue;case 2:return xt(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Is(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw Ue()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const n={};return Ds(e,(a,i)=>{n[a]=this.convertValue(i,t)}),n}convertVectorValue(e){var t,n,a;const i=(a=(n=(t=e.fields)===null||t===void 0?void 0:t.value.arrayValue)===null||n===void 0?void 0:n.values)===null||a===void 0?void 0:a.map(l=>xt(l.doubleValue));return new Hl(i)}convertGeoPoint(e){return new zl(xt(e.latitude),xt(e.longitude))}convertArray(e,t){return(e.values||[]).map(n=>this.convertValue(n,t))}convertServerTimestamp(e,t){switch(t){case"previous":const n=Nl(e);return n==null?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(Kn(e));default:return null}}convertTimestamp(e){const t=ds(e);return new _t(t.seconds,t.nanos)}convertDocumentKey(e,t){const n=ut.fromString(e);ot(um(n));const a=new Qn(n.get(1),n.get(3)),i=new $e(n.popFirst(5));return a.isEqual(t)||Mr(`Document ${i} contains a document reference within a different database (${a.projectId}/${a.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bv(r,e,t){let n;return n=r?r.toFirestore(e):e,n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ba{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class vv extends Lm{constructor(e,t,n,a,i,l){super(e,t,n,a,l),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new Za(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const n=this._document.data.field(Yi("DocumentSnapshot.get",e));if(n!==null)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}}class Za extends vv{data(e={}){return super.data(e)}}class wv{constructor(e,t,n,a){this._firestore=e,this._userDataWriter=t,this._snapshot=a,this.metadata=new Ba(a.hasPendingWrites,a.fromCache),this.query=n}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(n=>{e.call(t,new Za(this._firestore,this._userDataWriter,n.key,n,new Ba(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new Te(ae.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(a,i){if(a._snapshot.oldDocs.isEmpty()){let l=0;return a._snapshot.docChanges.map(c=>{const d=new Za(a._firestore,a._userDataWriter,c.doc.key,c.doc,new Ba(a._snapshot.mutatedKeys.has(c.doc.key),a._snapshot.fromCache),a.query.converter);return c.doc,{type:"added",doc:d,oldIndex:-1,newIndex:l++}})}{let l=a._snapshot.oldDocs;return a._snapshot.docChanges.filter(c=>i||c.type!==3).map(c=>{const d=new Za(a._firestore,a._userDataWriter,c.doc.key,c.doc,new Ba(a._snapshot.mutatedKeys.has(c.doc.key),a._snapshot.fromCache),a.query.converter);let h=-1,g=-1;return c.type!==0&&(h=l.indexOf(c.doc.key),l=l.delete(c.doc.key)),c.type!==1&&(l=l.add(c.doc),g=l.indexOf(c.doc.key)),{type:_v(c.type),doc:d,oldIndex:h,newIndex:g}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function _v(r){switch(r){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Ue()}}class kv extends yv{constructor(e){super(),this.firestore=e}convertBytes(e){return new cn(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Jt(this.firestore,null,t)}}function lr(r){r=Ss(r,$s);const e=Ss(r.firestore,fa),t=Dm(e),n=new kv(e);return xv(r._query),sv(t,r._query).then(a=>new wv(e,n,r,a))}function Ms(r,e,t,...n){r=Ss(r,Jt);const a=Ss(r.firestore,fa),i=Kl(a);let l;return l=typeof(e=Ut(e))=="string"||e instanceof Ki?mv(i,"updateDoc",r._key,e,t,n):hv(i,"updateDoc",r._key,e),ec(a,[l.toMutation(r._key,ar.exists(!0))])}function ms(r){return ec(Ss(r.firestore,fa),[new Sl(r._key,ar.none())])}function Os(r,e){const t=Ss(r.firestore,fa),n=qt(r),a=bv(r.converter,e);return ec(t,[uv(Kl(r.firestore),"addDoc",n._key,a,r.converter!==null,{}).toMutation(n._key,ar.exists(!1))]).then(()=>n)}function ec(r,e){return function(n,a){const i=new is;return n.asyncQueue.enqueueAndForget(async()=>Wb(await tv(n),a,i)),i.promise}(Dm(r),e)}(function(e,t=!0){(function(a){hn=a})(Rs),Es(new ls("firestore",(n,{instanceIdentifier:a,options:i})=>{const l=n.getProvider("app").getImmediate(),c=new fa(new vx(n.getProvider("auth-internal")),new Nx(n.getProvider("app-check-internal")),function(h,g){if(!Object.prototype.hasOwnProperty.apply(h.options,["projectId"]))throw new Te(ae.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Qn(h.options.projectId,g)}(l,a),l);return i=Object.assign({useFetchStreams:t},i),c._setSettings(i),c},"PUBLIC").setMultipleInstances(!0)),gr(Nd,"4.7.3",e),gr(Nd,"4.7.3","esm2017")})();var Nv="firebase",Ev="10.14.1";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */gr(Nv,Ev,"app");function tc(r,e){var t={};for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&e.indexOf(n)<0&&(t[n]=r[n]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var a=0,n=Object.getOwnPropertySymbols(r);a<n.length;a++)e.indexOf(n[a])<0&&Object.prototype.propertyIsEnumerable.call(r,n[a])&&(t[n[a]]=r[n[a]]);return t}function Bm(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const jv=Bm,qm=new la("auth","Firebase",Bm());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wi=new yl("@firebase/auth");function Iv(r,...e){wi.logLevel<=Je.WARN&&wi.warn(`Auth (${Rs}): ${r}`,...e)}function ei(r,...e){wi.logLevel<=Je.ERROR&&wi.error(`Auth (${Rs}): ${r}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Vr(r,...e){throw rc(r,...e)}function xr(r,...e){return rc(r,...e)}function Wm(r,e,t){const n=Object.assign(Object.assign({},jv()),{[e]:t});return new la("auth","Firebase",n).create(e,{appName:r.name})}function Ns(r){return Wm(r,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function rc(r,...e){if(typeof r!="string"){const t=e[0],n=[...e.slice(1)];return n[0]&&(n[0].appName=r.name),r._errorFactory.create(t,...n)}return qm.create(r,...e)}function Fe(r,e,...t){if(!r)throw rc(e,...t)}function Sr(r){const e="INTERNAL ASSERTION FAILED: "+r;throw ei(e),new Error(e)}function Lr(r,e){r||Sr(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nl(){var r;return typeof self<"u"&&((r=self.location)===null||r===void 0?void 0:r.href)||""}function Tv(){return cu()==="http:"||cu()==="https:"}function cu(){var r;return typeof self<"u"&&((r=self.location)===null||r===void 0?void 0:r.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Sv(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(Tv()||Xp()||"connection"in navigator)?navigator.onLine:!0}function Av(){if(typeof navigator>"u")return null;const r=navigator;return r.languages&&r.languages[0]||r.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ya{constructor(e,t){this.shortDelay=e,this.longDelay=t,Lr(t>e,"Short delay should be less than long delay!"),this.isMobile=Kp()||Jp()}get(){return Sv()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sc(r,e){Lr(r.emulator,"Emulator should always be set here");const{url:t}=r.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zm{static initialize(e,t,n){this.fetchImpl=e,t&&(this.headersImpl=t),n&&(this.responseImpl=n)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;Sr("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;Sr("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;Sr("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Cv={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Rv=new ya(3e4,6e4);function nc(r,e){return r.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:r.tenantId}):e}async function fn(r,e,t,n,a={}){return Hm(r,a,async()=>{let i={},l={};n&&(e==="GET"?l=n:i={body:JSON.stringify(n)});const c=ca(Object.assign({key:r.config.apiKey},l)).slice(1),d=await r._getAdditionalHeaders();d["Content-Type"]="application/json",r.languageCode&&(d["X-Firebase-Locale"]=r.languageCode);const h=Object.assign({method:e,headers:d},i);return Yp()||(h.referrerPolicy="no-referrer"),zm.fetch()(Gm(r,r.config.apiHost,t,c),h)})}async function Hm(r,e,t){r._canInitEmulator=!1;const n=Object.assign(Object.assign({},Cv),e);try{const a=new Pv(r),i=await Promise.race([t(),a.promise]);a.clearNetworkTimeout();const l=await i.json();if("needConfirmation"in l)throw qa(r,"account-exists-with-different-credential",l);if(i.ok&&!("errorMessage"in l))return l;{const c=i.ok?l.errorMessage:l.error.message,[d,h]=c.split(" : ");if(d==="FEDERATED_USER_ID_ALREADY_LINKED")throw qa(r,"credential-already-in-use",l);if(d==="EMAIL_EXISTS")throw qa(r,"email-already-in-use",l);if(d==="USER_DISABLED")throw qa(r,"user-disabled",l);const g=n[d]||d.toLowerCase().replace(/[_\s]+/g,"-");if(h)throw Wm(r,g,h);Vr(r,g)}}catch(a){if(a instanceof kr)throw a;Vr(r,"network-request-failed",{message:String(a)})}}async function Dv(r,e,t,n,a={}){const i=await fn(r,e,t,n,a);return"mfaPendingCredential"in i&&Vr(r,"multi-factor-auth-required",{_serverResponse:i}),i}function Gm(r,e,t,n){const a=`${e}${t}?${n}`;return r.config.emulator?sc(r.config,a):`${r.config.apiScheme}://${a}`}class Pv{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,n)=>{this.timer=setTimeout(()=>n(xr(this.auth,"network-request-failed")),Rv.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function qa(r,e,t){const n={appName:r.name};t.email&&(n.email=t.email),t.phoneNumber&&(n.phoneNumber=t.phoneNumber);const a=xr(r,e,n);return a.customData._tokenResponse=t,a}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function $v(r,e){return fn(r,"POST","/v1/accounts:delete",e)}async function Km(r,e){return fn(r,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qn(r){if(r)try{const e=new Date(Number(r));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function Mv(r,e=!1){const t=Ut(r),n=await t.getIdToken(e),a=ac(n);Fe(a&&a.exp&&a.auth_time&&a.iat,t.auth,"internal-error");const i=typeof a.firebase=="object"?a.firebase:void 0,l=i==null?void 0:i.sign_in_provider;return{claims:a,token:n,authTime:qn(To(a.auth_time)),issuedAtTime:qn(To(a.iat)),expirationTime:qn(To(a.exp)),signInProvider:l||null,signInSecondFactor:(i==null?void 0:i.sign_in_second_factor)||null}}function To(r){return Number(r)*1e3}function ac(r){const[e,t,n]=r.split(".");if(e===void 0||t===void 0||n===void 0)return ei("JWT malformed, contained fewer than 3 sections"),null;try{const a=gh(t);return a?JSON.parse(a):(ei("Failed to decode base64 JWT payload"),null)}catch(a){return ei("Caught error parsing JWT payload as JSON",a==null?void 0:a.toString()),null}}function du(r){const e=ac(r);return Fe(e,"internal-error"),Fe(typeof e.exp<"u","internal-error"),Fe(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function ta(r,e,t=!1){if(t)return e;try{return await e}catch(n){throw n instanceof kr&&Ov(n)&&r.auth.currentUser===r&&await r.auth.signOut(),n}}function Ov({code:r}){return r==="auth/user-disabled"||r==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vv{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){const n=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),n}else{this.errorBackoff=3e4;const a=((t=this.user.stsTokenManager.expirationTime)!==null&&t!==void 0?t:0)-Date.now()-3e5;return Math.max(0,a)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(e==null?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class al{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=qn(this.lastLoginAt),this.creationTime=qn(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function _i(r){var e;const t=r.auth,n=await r.getIdToken(),a=await ta(r,Km(t,{idToken:n}));Fe(a==null?void 0:a.users.length,t,"internal-error");const i=a.users[0];r._notifyReloadListener(i);const l=!((e=i.providerUserInfo)===null||e===void 0)&&e.length?Qm(i.providerUserInfo):[],c=Fv(r.providerData,l),d=r.isAnonymous,h=!(r.email&&i.passwordHash)&&!(c!=null&&c.length),g=d?h:!1,x={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:c,metadata:new al(i.createdAt,i.lastLoginAt),isAnonymous:g};Object.assign(r,x)}async function Lv(r){const e=Ut(r);await _i(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function Fv(r,e){return[...r.filter(n=>!e.some(a=>a.providerId===n.providerId)),...e]}function Qm(r){return r.map(e=>{var{providerId:t}=e,n=tc(e,["providerId"]);return{providerId:t,uid:n.rawId||"",displayName:n.displayName||null,email:n.email||null,phoneNumber:n.phoneNumber||null,photoURL:n.photoUrl||null}})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Uv(r,e){const t=await Hm(r,{},async()=>{const n=ca({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:a,apiKey:i}=r.config,l=Gm(r,a,"/v1/token",`key=${i}`),c=await r._getAdditionalHeaders();return c["Content-Type"]="application/x-www-form-urlencoded",zm.fetch()(l,{method:"POST",headers:c,body:n})});return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}}async function Bv(r,e){return fn(r,"POST","/v2/accounts:revokeToken",nc(r,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ks{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){Fe(e.idToken,"internal-error"),Fe(typeof e.idToken<"u","internal-error"),Fe(typeof e.refreshToken<"u","internal-error");const t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):du(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){Fe(e.length!==0,"internal-error");const t=du(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return!t&&this.accessToken&&!this.isExpired?this.accessToken:(Fe(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:n,refreshToken:a,expiresIn:i}=await Uv(e,t);this.updateTokensAndExpiration(n,a,Number(i))}updateTokensAndExpiration(e,t,n){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+n*1e3}static fromJSON(e,t){const{refreshToken:n,accessToken:a,expirationTime:i}=t,l=new Ks;return n&&(Fe(typeof n=="string","internal-error",{appName:e}),l.refreshToken=n),a&&(Fe(typeof a=="string","internal-error",{appName:e}),l.accessToken=a),i&&(Fe(typeof i=="number","internal-error",{appName:e}),l.expirationTime=i),l}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new Ks,this.toJSON())}_performRefresh(){return Sr("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Hr(r,e){Fe(typeof r=="string"||typeof r>"u","internal-error",{appName:e})}class Ar{constructor(e){var{uid:t,auth:n,stsTokenManager:a}=e,i=tc(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new Vv(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=n,this.stsTokenManager=a,this.accessToken=a.accessToken,this.displayName=i.displayName||null,this.email=i.email||null,this.emailVerified=i.emailVerified||!1,this.phoneNumber=i.phoneNumber||null,this.photoURL=i.photoURL||null,this.isAnonymous=i.isAnonymous||!1,this.tenantId=i.tenantId||null,this.providerData=i.providerData?[...i.providerData]:[],this.metadata=new al(i.createdAt||void 0,i.lastLoginAt||void 0)}async getIdToken(e){const t=await ta(this,this.stsTokenManager.getToken(this.auth,e));return Fe(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return Mv(this,e)}reload(){return Lv(this)}_assign(e){this!==e&&(Fe(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>Object.assign({},t)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new Ar(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){Fe(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let n=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),n=!0),t&&await _i(this),await this.auth._persistUserIfCurrent(this),n&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(ts(this.auth.app))return Promise.reject(Ns(this.auth));const e=await this.getIdToken();return await ta(this,$v(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var n,a,i,l,c,d,h,g;const x=(n=t.displayName)!==null&&n!==void 0?n:void 0,p=(a=t.email)!==null&&a!==void 0?a:void 0,E=(i=t.phoneNumber)!==null&&i!==void 0?i:void 0,j=(l=t.photoURL)!==null&&l!==void 0?l:void 0,S=(c=t.tenantId)!==null&&c!==void 0?c:void 0,k=(d=t._redirectEventId)!==null&&d!==void 0?d:void 0,L=(h=t.createdAt)!==null&&h!==void 0?h:void 0,M=(g=t.lastLoginAt)!==null&&g!==void 0?g:void 0,{uid:T,emailVerified:O,isAnonymous:ne,providerData:ie,stsTokenManager:I}=t;Fe(T&&I,e,"internal-error");const N=Ks.fromJSON(this.name,I);Fe(typeof T=="string",e,"internal-error"),Hr(x,e.name),Hr(p,e.name),Fe(typeof O=="boolean",e,"internal-error"),Fe(typeof ne=="boolean",e,"internal-error"),Hr(E,e.name),Hr(j,e.name),Hr(S,e.name),Hr(k,e.name),Hr(L,e.name),Hr(M,e.name);const b=new Ar({uid:T,auth:e,email:p,emailVerified:O,displayName:x,isAnonymous:ne,photoURL:j,phoneNumber:E,tenantId:S,stsTokenManager:N,createdAt:L,lastLoginAt:M});return ie&&Array.isArray(ie)&&(b.providerData=ie.map(f=>Object.assign({},f))),k&&(b._redirectEventId=k),b}static async _fromIdTokenResponse(e,t,n=!1){const a=new Ks;a.updateFromServerResponse(t);const i=new Ar({uid:t.localId,auth:e,stsTokenManager:a,isAnonymous:n});return await _i(i),i}static async _fromGetAccountInfoResponse(e,t,n){const a=t.users[0];Fe(a.localId!==void 0,"internal-error");const i=a.providerUserInfo!==void 0?Qm(a.providerUserInfo):[],l=!(a.email&&a.passwordHash)&&!(i!=null&&i.length),c=new Ks;c.updateFromIdToken(n);const d=new Ar({uid:a.localId,auth:e,stsTokenManager:c,isAnonymous:l}),h={uid:a.localId,displayName:a.displayName||null,photoURL:a.photoUrl||null,email:a.email||null,emailVerified:a.emailVerified||!1,phoneNumber:a.phoneNumber||null,tenantId:a.tenantId||null,providerData:i,metadata:new al(a.createdAt,a.lastLoginAt),isAnonymous:!(a.email&&a.passwordHash)&&!(i!=null&&i.length)};return Object.assign(d,h),d}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const uu=new Map;function Cr(r){Lr(r instanceof Function,"Expected a class definition");let e=uu.get(r);return e?(Lr(e instanceof r,"Instance stored in cache mismatched with class"),e):(e=new r,uu.set(r,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ym{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return t===void 0?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}Ym.type="NONE";const hu=Ym;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ti(r,e,t){return`firebase:${r}:${e}:${t}`}class Qs{constructor(e,t,n){this.persistence=e,this.auth=t,this.userKey=n;const{config:a,name:i}=this.auth;this.fullUserKey=ti(this.userKey,a.apiKey,i),this.fullPersistenceKey=ti("persistence",a.apiKey,i),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);return e?Ar._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,n="authUser"){if(!t.length)return new Qs(Cr(hu),e,n);const a=(await Promise.all(t.map(async h=>{if(await h._isAvailable())return h}))).filter(h=>h);let i=a[0]||Cr(hu);const l=ti(n,e.config.apiKey,e.name);let c=null;for(const h of t)try{const g=await h._get(l);if(g){const x=Ar._fromJSON(e,g);h!==i&&(c=x),i=h;break}}catch{}const d=a.filter(h=>h._shouldAllowMigration);return!i._shouldAllowMigration||!d.length?new Qs(i,e,n):(i=d[0],c&&await i._set(l,c.toJSON()),await Promise.all(t.map(async h=>{if(h!==i)try{await h._remove(l)}catch{}})),new Qs(i,e,n))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mu(r){const e=r.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(eg(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(Xm(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(rg(e))return"Blackberry";if(sg(e))return"Webos";if(Jm(e))return"Safari";if((e.includes("chrome/")||Zm(e))&&!e.includes("edge/"))return"Chrome";if(tg(e))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,n=r.match(t);if((n==null?void 0:n.length)===2)return n[1]}return"Other"}function Xm(r=Ft()){return/firefox\//i.test(r)}function Jm(r=Ft()){const e=r.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function Zm(r=Ft()){return/crios\//i.test(r)}function eg(r=Ft()){return/iemobile/i.test(r)}function tg(r=Ft()){return/android/i.test(r)}function rg(r=Ft()){return/blackberry/i.test(r)}function sg(r=Ft()){return/webos/i.test(r)}function ic(r=Ft()){return/iphone|ipad|ipod/i.test(r)||/macintosh/i.test(r)&&/mobile/i.test(r)}function qv(r=Ft()){var e;return ic(r)&&!!(!((e=window.navigator)===null||e===void 0)&&e.standalone)}function Wv(){return Zp()&&document.documentMode===10}function ng(r=Ft()){return ic(r)||tg(r)||sg(r)||rg(r)||/windows phone/i.test(r)||eg(r)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ag(r,e=[]){let t;switch(r){case"Browser":t=mu(Ft());break;case"Worker":t=`${mu(Ft())}-${r}`;break;default:t=r}const n=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${Rs}/${n}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zv{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const n=i=>new Promise((l,c)=>{try{const d=e(i);l(d)}catch(d){c(d)}});n.onAbort=t,this.queue.push(n);const a=this.queue.length-1;return()=>{this.queue[a]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const n of this.queue)await n(e),n.onAbort&&t.push(n.onAbort)}catch(n){t.reverse();for(const a of t)try{a()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:n==null?void 0:n.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Hv(r,e={}){return fn(r,"GET","/v2/passwordPolicy",nc(r,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Gv=6;class Kv{constructor(e){var t,n,a,i;const l=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(t=l.minPasswordLength)!==null&&t!==void 0?t:Gv,l.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=l.maxPasswordLength),l.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=l.containsLowercaseCharacter),l.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=l.containsUppercaseCharacter),l.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=l.containsNumericCharacter),l.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=l.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(a=(n=e.allowedNonAlphanumericCharacters)===null||n===void 0?void 0:n.join(""))!==null&&a!==void 0?a:"",this.forceUpgradeOnSignin=(i=e.forceUpgradeOnSignin)!==null&&i!==void 0?i:!1,this.schemaVersion=e.schemaVersion}validatePassword(e){var t,n,a,i,l,c;const d={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,d),this.validatePasswordCharacterOptions(e,d),d.isValid&&(d.isValid=(t=d.meetsMinPasswordLength)!==null&&t!==void 0?t:!0),d.isValid&&(d.isValid=(n=d.meetsMaxPasswordLength)!==null&&n!==void 0?n:!0),d.isValid&&(d.isValid=(a=d.containsLowercaseLetter)!==null&&a!==void 0?a:!0),d.isValid&&(d.isValid=(i=d.containsUppercaseLetter)!==null&&i!==void 0?i:!0),d.isValid&&(d.isValid=(l=d.containsNumericCharacter)!==null&&l!==void 0?l:!0),d.isValid&&(d.isValid=(c=d.containsNonAlphanumericCharacter)!==null&&c!==void 0?c:!0),d}validatePasswordLengthOptions(e,t){const n=this.customStrengthOptions.minPasswordLength,a=this.customStrengthOptions.maxPasswordLength;n&&(t.meetsMinPasswordLength=e.length>=n),a&&(t.meetsMaxPasswordLength=e.length<=a)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let n;for(let a=0;a<e.length;a++)n=e.charAt(a),this.updatePasswordCharacterOptionsStatuses(t,n>="a"&&n<="z",n>="A"&&n<="Z",n>="0"&&n<="9",this.allowedNonAlphanumericCharacters.includes(n))}updatePasswordCharacterOptionsStatuses(e,t,n,a,i){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=n)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=a)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qv{constructor(e,t,n,a){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=n,this.config=a,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new gu(this),this.idTokenSubscription=new gu(this),this.beforeStateQueue=new zv(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=qm,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=a.sdkClientVersion}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=Cr(t)),this._initializationPromise=this.queue(async()=>{var n,a;if(!this._deleted&&(this.persistenceManager=await Qs.create(this,e),!this._deleted)){if(!((n=this._popupRedirectResolver)===null||n===void 0)&&n._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(t),this.lastNotifiedUid=((a=this.currentUser)===null||a===void 0?void 0:a.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const t=await Km(this,{idToken:e}),n=await Ar._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(n)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var t;if(ts(this.app)){const l=this.app.settings.authIdToken;return l?new Promise(c=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(l).then(c,c))}):this.directlySetCurrentUser(null)}const n=await this.assertedPersistence.getCurrentUser();let a=n,i=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const l=(t=this.redirectUser)===null||t===void 0?void 0:t._redirectEventId,c=a==null?void 0:a._redirectEventId,d=await this.tryRedirectSignIn(e);(!l||l===c)&&(d!=null&&d.user)&&(a=d.user,i=!0)}if(!a)return this.directlySetCurrentUser(null);if(!a._redirectEventId){if(i)try{await this.beforeStateQueue.runMiddleware(a)}catch(l){a=n,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(l))}return a?this.reloadAndSetCurrentUserOrClear(a):this.directlySetCurrentUser(null)}return Fe(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===a._redirectEventId?this.directlySetCurrentUser(a):this.reloadAndSetCurrentUserOrClear(a)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await _i(e)}catch(t){if((t==null?void 0:t.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=Av()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(ts(this.app))return Promise.reject(Ns(this));const t=e?Ut(e):null;return t&&Fe(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&Fe(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return ts(this.app)?Promise.reject(Ns(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return ts(this.app)?Promise.reject(Ns(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(Cr(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await Hv(this),t=new Kv(e);this.tenantId===null?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new la("auth","Firebase",e())}onAuthStateChanged(e,t,n){return this.registerStateListener(this.authStateSubscription,e,t,n)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,n){return this.registerStateListener(this.idTokenSubscription,e,t,n)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const n=this.onAuthStateChanged(()=>{n(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){const t=await this.currentUser.getIdToken(),n={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};this.tenantId!=null&&(n.tenantId=this.tenantId),await Bv(this,n)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)===null||e===void 0?void 0:e.toJSON()}}async _setRedirectUser(e,t){const n=await this.getOrInitRedirectPersistenceManager(t);return e===null?n.removeCurrentUser():n.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&Cr(e)||this._popupRedirectResolver;Fe(t,this,"argument-error"),this.redirectPersistenceManager=await Qs.create(this,[Cr(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,n;return this._isInitialized&&await this.queue(async()=>{}),((t=this._currentUser)===null||t===void 0?void 0:t._redirectEventId)===e?this._currentUser:((n=this.redirectUser)===null||n===void 0?void 0:n._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const n=(t=(e=this.currentUser)===null||e===void 0?void 0:e.uid)!==null&&t!==void 0?t:null;this.lastNotifiedUid!==n&&(this.lastNotifiedUid=n,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,n,a){if(this._deleted)return()=>{};const i=typeof t=="function"?t:t.next.bind(t);let l=!1;const c=this._isInitialized?Promise.resolve():this._initializationPromise;if(Fe(c,this,"internal-error"),c.then(()=>{l||i(this.currentUser)}),typeof t=="function"){const d=e.addObserver(t,n,a);return()=>{l=!0,d()}}else{const d=e.addObserver(t);return()=>{l=!0,d()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return Fe(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=ag(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);const n=await((e=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getHeartbeatsHeader());n&&(t["X-Firebase-Client"]=n);const a=await this._getAppCheckToken();return a&&(t["X-Firebase-AppCheck"]=a),t}async _getAppCheckToken(){var e;const t=await((e=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getToken());return t!=null&&t.error&&Iv(`Error while retrieving App Check token: ${t.error}`),t==null?void 0:t.token}}function oc(r){return Ut(r)}class gu{constructor(e){this.auth=e,this.observer=null,this.addObserver=lf(t=>this.observer=t)}get next(){return Fe(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let lc={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function Yv(r){lc=r}function Xv(r){return lc.loadJS(r)}function Jv(){return lc.gapiScript}function Zv(r){return`__${r}${Math.floor(Math.random()*1e6)}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ew(r,e){const t=Mi(r,"auth");if(t.isInitialized()){const a=t.getImmediate(),i=t.getOptions();if(ui(i,e??{}))return a;Vr(a,"already-initialized")}return t.initialize({options:e})}function tw(r,e){const t=(e==null?void 0:e.persistence)||[],n=(Array.isArray(t)?t:[t]).map(Cr);e!=null&&e.errorMap&&r._updateErrorMap(e.errorMap),r._initializeWithPersistence(n,e==null?void 0:e.popupRedirectResolver)}function rw(r,e,t){const n=oc(r);Fe(n._canInitEmulator,n,"emulator-config-failed"),Fe(/^https?:\/\//.test(e),n,"invalid-emulator-scheme");const a=!1,i=ig(e),{host:l,port:c}=sw(e),d=c===null?"":`:${c}`;n.config.emulator={url:`${i}//${l}${d}/`},n.settings.appVerificationDisabledForTesting=!0,n.emulatorConfig=Object.freeze({host:l,port:c,protocol:i.replace(":",""),options:Object.freeze({disableWarnings:a})}),nw()}function ig(r){const e=r.indexOf(":");return e<0?"":r.substr(0,e+1)}function sw(r){const e=ig(r),t=/(\/\/)?([^?#/]+)/.exec(r.substr(e.length));if(!t)return{host:"",port:null};const n=t[2].split("@").pop()||"",a=/^(\[[^\]]+\])(:|$)/.exec(n);if(a){const i=a[1];return{host:i,port:pu(n.substr(i.length+1))}}else{const[i,l]=n.split(":");return{host:i,port:pu(l)}}}function pu(r){if(!r)return null;const e=Number(r);return isNaN(e)?null:e}function nw(){function r(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",r):r())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class og{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return Sr("not implemented")}_getIdTokenResponse(e){return Sr("not implemented")}_linkToIdToken(e,t){return Sr("not implemented")}_getReauthenticationResolver(e){return Sr("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Ys(r,e){return Dv(r,"POST","/v1/accounts:signInWithIdp",nc(r,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const aw="http://localhost";class As extends og{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new As(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):Vr("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:n,signInMethod:a}=t,i=tc(t,["providerId","signInMethod"]);if(!n||!a)return null;const l=new As(n,a);return l.idToken=i.idToken||void 0,l.accessToken=i.accessToken||void 0,l.secret=i.secret,l.nonce=i.nonce,l.pendingToken=i.pendingToken||null,l}_getIdTokenResponse(e){const t=this.buildRequest();return Ys(e,t)}_linkToIdToken(e,t){const n=this.buildRequest();return n.idToken=t,Ys(e,n)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,Ys(e,t)}buildRequest(){const e={requestUri:aw,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=ca(t)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lg{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ba extends lg{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xr extends ba{constructor(){super("facebook.com")}static credential(e){return As._fromParams({providerId:Xr.PROVIDER_ID,signInMethod:Xr.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Xr.credentialFromTaggedObject(e)}static credentialFromError(e){return Xr.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Xr.credential(e.oauthAccessToken)}catch{return null}}}Xr.FACEBOOK_SIGN_IN_METHOD="facebook.com";Xr.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jr extends ba{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return As._fromParams({providerId:Jr.PROVIDER_ID,signInMethod:Jr.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return Jr.credentialFromTaggedObject(e)}static credentialFromError(e){return Jr.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:n}=e;if(!t&&!n)return null;try{return Jr.credential(t,n)}catch{return null}}}Jr.GOOGLE_SIGN_IN_METHOD="google.com";Jr.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zr extends ba{constructor(){super("github.com")}static credential(e){return As._fromParams({providerId:Zr.PROVIDER_ID,signInMethod:Zr.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Zr.credentialFromTaggedObject(e)}static credentialFromError(e){return Zr.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Zr.credential(e.oauthAccessToken)}catch{return null}}}Zr.GITHUB_SIGN_IN_METHOD="github.com";Zr.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class es extends ba{constructor(){super("twitter.com")}static credential(e,t){return As._fromParams({providerId:es.PROVIDER_ID,signInMethod:es.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return es.credentialFromTaggedObject(e)}static credentialFromError(e){return es.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:n}=e;if(!t||!n)return null;try{return es.credential(t,n)}catch{return null}}}es.TWITTER_SIGN_IN_METHOD="twitter.com";es.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dn{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,n,a=!1){const i=await Ar._fromIdTokenResponse(e,n,a),l=fu(n);return new dn({user:i,providerId:l,_tokenResponse:n,operationType:t})}static async _forOperation(e,t,n){await e._updateTokensIfNecessary(n,!0);const a=fu(n);return new dn({user:e,providerId:a,_tokenResponse:n,operationType:t})}}function fu(r){return r.providerId?r.providerId:"phoneNumber"in r?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ki extends kr{constructor(e,t,n,a){var i;super(t.code,t.message),this.operationType=n,this.user=a,Object.setPrototypeOf(this,ki.prototype),this.customData={appName:e.name,tenantId:(i=e.tenantId)!==null&&i!==void 0?i:void 0,_serverResponse:t.customData._serverResponse,operationType:n}}static _fromErrorAndOperation(e,t,n,a){return new ki(e,t,n,a)}}function cg(r,e,t,n){return(e==="reauthenticate"?t._getReauthenticationResolver(r):t._getIdTokenResponse(r)).catch(i=>{throw i.code==="auth/multi-factor-auth-required"?ki._fromErrorAndOperation(r,i,e,n):i})}async function iw(r,e,t=!1){const n=await ta(r,e._linkToIdToken(r.auth,await r.getIdToken()),t);return dn._forOperation(r,"link",n)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function ow(r,e,t=!1){const{auth:n}=r;if(ts(n.app))return Promise.reject(Ns(n));const a="reauthenticate";try{const i=await ta(r,cg(n,a,e,r),t);Fe(i.idToken,n,"internal-error");const l=ac(i.idToken);Fe(l,n,"internal-error");const{sub:c}=l;return Fe(r.uid===c,n,"user-mismatch"),dn._forOperation(r,a,i)}catch(i){throw(i==null?void 0:i.code)==="auth/user-not-found"&&Vr(n,"user-mismatch"),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function lw(r,e,t=!1){if(ts(r.app))return Promise.reject(Ns(r));const n="signIn",a=await cg(r,n,e),i=await dn._fromIdTokenResponse(r,n,a);return t||await r._updateCurrentUser(i.user),i}function cw(r,e,t,n){return Ut(r).onIdTokenChanged(e,t,n)}function dw(r,e,t){return Ut(r).beforeAuthStateChanged(e,t)}const Ni="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dg{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(Ni,"1"),this.storage.removeItem(Ni),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const uw=1e3,hw=10;class ug extends dg{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=ng(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const n=this.storage.getItem(t),a=this.localCache[t];n!==a&&e(t,a,n)}}onStorageEvent(e,t=!1){if(!e.key){this.forAllChangedKeys((l,c,d)=>{this.notifyListeners(l,d)});return}const n=e.key;t?this.detachListener():this.stopPolling();const a=()=>{const l=this.storage.getItem(n);!t&&this.localCache[n]===l||this.notifyListeners(n,l)},i=this.storage.getItem(n);Wv()&&i!==e.newValue&&e.newValue!==e.oldValue?setTimeout(a,hw):a()}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const a of Array.from(n))a(t&&JSON.parse(t))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,n)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:n}),!0)})},uw)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}ug.type="LOCAL";const mw=ug;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hg extends dg{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}hg.type="SESSION";const mg=hg;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gw(r){return Promise.all(r.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ji{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(a=>a.isListeningto(e));if(t)return t;const n=new Ji(e);return this.receivers.push(n),n}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:n,eventType:a,data:i}=t.data,l=this.handlersMap[a];if(!(l!=null&&l.size))return;t.ports[0].postMessage({status:"ack",eventId:n,eventType:a});const c=Array.from(l).map(async h=>h(t.origin,i)),d=await gw(c);t.ports[0].postMessage({status:"done",eventId:n,eventType:a,response:d})}_subscribe(e,t){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),(!t||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}Ji.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function cc(r="",e=10){let t="";for(let n=0;n<e;n++)t+=Math.floor(Math.random()*10);return r+t}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pw{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,n=50){const a=typeof MessageChannel<"u"?new MessageChannel:null;if(!a)throw new Error("connection_unavailable");let i,l;return new Promise((c,d)=>{const h=cc("",20);a.port1.start();const g=setTimeout(()=>{d(new Error("unsupported_event"))},n);l={messageChannel:a,onMessage(x){const p=x;if(p.data.eventId===h)switch(p.data.status){case"ack":clearTimeout(g),i=setTimeout(()=>{d(new Error("timeout"))},3e3);break;case"done":clearTimeout(i),c(p.data.response);break;default:clearTimeout(g),clearTimeout(i),d(new Error("invalid_response"));break}}},this.handlers.add(l),a.port1.addEventListener("message",l.onMessage),this.target.postMessage({eventType:e,eventId:h,data:t},[a.port2])}).finally(()=>{l&&this.removeMessageHandler(l)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yr(){return window}function fw(r){yr().location.href=r}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gg(){return typeof yr().WorkerGlobalScope<"u"&&typeof yr().importScripts=="function"}async function xw(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function yw(){var r;return((r=navigator==null?void 0:navigator.serviceWorker)===null||r===void 0?void 0:r.controller)||null}function bw(){return gg()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pg="firebaseLocalStorageDb",vw=1,Ei="firebaseLocalStorage",fg="fbase_key";class va{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function Zi(r,e){return r.transaction([Ei],e?"readwrite":"readonly").objectStore(Ei)}function ww(){const r=indexedDB.deleteDatabase(pg);return new va(r).toPromise()}function il(){const r=indexedDB.open(pg,vw);return new Promise((e,t)=>{r.addEventListener("error",()=>{t(r.error)}),r.addEventListener("upgradeneeded",()=>{const n=r.result;try{n.createObjectStore(Ei,{keyPath:fg})}catch(a){t(a)}}),r.addEventListener("success",async()=>{const n=r.result;n.objectStoreNames.contains(Ei)?e(n):(n.close(),await ww(),e(await il()))})})}async function xu(r,e,t){const n=Zi(r,!0).put({[fg]:e,value:t});return new va(n).toPromise()}async function _w(r,e){const t=Zi(r,!1).get(e),n=await new va(t).toPromise();return n===void 0?null:n.value}function yu(r,e){const t=Zi(r,!0).delete(e);return new va(t).toPromise()}const kw=800,Nw=3;class xg{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await il(),this.db)}async _withRetries(e){let t=0;for(;;)try{const n=await this._openDb();return await e(n)}catch(n){if(t++>Nw)throw n;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return gg()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=Ji._getInstance(bw()),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){var e,t;if(this.activeServiceWorker=await xw(),!this.activeServiceWorker)return;this.sender=new pw(this.activeServiceWorker);const n=await this.sender._send("ping",{},800);n&&!((e=n[0])===null||e===void 0)&&e.fulfilled&&!((t=n[0])===null||t===void 0)&&t.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||yw()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await il();return await xu(e,Ni,"1"),await yu(e,Ni),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(n=>xu(n,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(n=>_w(n,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>yu(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(a=>{const i=Zi(a,!1).getAll();return new va(i).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const t=[],n=new Set;if(e.length!==0)for(const{fbase_key:a,value:i}of e)n.add(a),JSON.stringify(this.localCache[a])!==JSON.stringify(i)&&(this.notifyListeners(a,i),t.push(a));for(const a of Object.keys(this.localCache))this.localCache[a]&&!n.has(a)&&(this.notifyListeners(a,null),t.push(a));return t}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const a of Array.from(n))a(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),kw)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}xg.type="LOCAL";const Ew=xg;new ya(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jw(r,e){return e?Cr(e):(Fe(r._popupRedirectResolver,r,"argument-error"),r._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dc extends og{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return Ys(e,this._buildIdpRequest())}_linkToIdToken(e,t){return Ys(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return Ys(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function Iw(r){return lw(r.auth,new dc(r),r.bypassAuthState)}function Tw(r){const{auth:e,user:t}=r;return Fe(t,e,"internal-error"),ow(t,new dc(r),r.bypassAuthState)}async function Sw(r){const{auth:e,user:t}=r;return Fe(t,e,"internal-error"),iw(t,new dc(r),r.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yg{constructor(e,t,n,a,i=!1){this.auth=e,this.resolver=n,this.user=a,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(n){this.reject(n)}})}async onAuthEvent(e){const{urlResponse:t,sessionId:n,postBody:a,tenantId:i,error:l,type:c}=e;if(l){this.reject(l);return}const d={auth:this.auth,requestUri:t,sessionId:n,tenantId:i||void 0,postBody:a||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(c)(d))}catch(h){this.reject(h)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return Iw;case"linkViaPopup":case"linkViaRedirect":return Sw;case"reauthViaPopup":case"reauthViaRedirect":return Tw;default:Vr(this.auth,"internal-error")}}resolve(e){Lr(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){Lr(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Aw=new ya(2e3,1e4);class Hs extends yg{constructor(e,t,n,a,i){super(e,t,a,i),this.provider=n,this.authWindow=null,this.pollId=null,Hs.currentPopupAction&&Hs.currentPopupAction.cancel(),Hs.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return Fe(e,this.auth,"internal-error"),e}async onExecution(){Lr(this.filter.length===1,"Popup operations only handle one event");const e=cc();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(t=>{this.reject(t)}),this.resolver._isIframeWebStorageSupported(this.auth,t=>{t||this.reject(xr(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)===null||e===void 0?void 0:e.associatedEvent)||null}cancel(){this.reject(xr(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Hs.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,n;if(!((n=(t=this.authWindow)===null||t===void 0?void 0:t.window)===null||n===void 0)&&n.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(xr(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,Aw.get())};e()}}Hs.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Cw="pendingRedirect",ri=new Map;class Rw extends yg{constructor(e,t,n=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,n),this.eventId=null}async execute(){let e=ri.get(this.auth._key());if(!e){try{const n=await Dw(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(n)}catch(t){e=()=>Promise.reject(t)}ri.set(this.auth._key(),e)}return this.bypassAuthState||ri.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function Dw(r,e){const t=Mw(e),n=$w(r);if(!await n._isAvailable())return!1;const a=await n._get(t)==="true";return await n._remove(t),a}function Pw(r,e){ri.set(r._key(),e)}function $w(r){return Cr(r._redirectPersistence)}function Mw(r){return ti(Cw,r.config.apiKey,r.name)}async function Ow(r,e,t=!1){if(ts(r.app))return Promise.reject(Ns(r));const n=oc(r),a=jw(n,e),l=await new Rw(n,a,t).execute();return l&&!t&&(delete l.user._redirectEventId,await n._persistUserIfCurrent(l.user),await n._setRedirectUser(null,e)),l}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Vw=10*60*1e3;class Lw{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(n=>{this.isEventForConsumer(e,n)&&(t=!0,this.sendToConsumer(e,n),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!Fw(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var n;if(e.error&&!bg(e)){const a=((n=e.error.code)===null||n===void 0?void 0:n.split("auth/")[1])||"internal-error";t.onError(xr(this.auth,a))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const n=t.eventId===null||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&n}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=Vw&&this.cachedEventUids.clear(),this.cachedEventUids.has(bu(e))}saveEventToCache(e){this.cachedEventUids.add(bu(e)),this.lastProcessedEventTime=Date.now()}}function bu(r){return[r.type,r.eventId,r.sessionId,r.tenantId].filter(e=>e).join("-")}function bg({type:r,error:e}){return r==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function Fw(r){switch(r.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return bg(r);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Uw(r,e={}){return fn(r,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Bw=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,qw=/^https?/;async function Ww(r){if(r.config.emulator)return;const{authorizedDomains:e}=await Uw(r);for(const t of e)try{if(zw(t))return}catch{}Vr(r,"unauthorized-domain")}function zw(r){const e=nl(),{protocol:t,hostname:n}=new URL(e);if(r.startsWith("chrome-extension://")){const l=new URL(r);return l.hostname===""&&n===""?t==="chrome-extension:"&&r.replace("chrome-extension://","")===e.replace("chrome-extension://",""):t==="chrome-extension:"&&l.hostname===n}if(!qw.test(t))return!1;if(Bw.test(r))return n===r;const a=r.replace(/\./g,"\\.");return new RegExp("^(.+\\."+a+"|"+a+")$","i").test(n)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Hw=new ya(3e4,6e4);function vu(){const r=yr().___jsl;if(r!=null&&r.H){for(const e of Object.keys(r.H))if(r.H[e].r=r.H[e].r||[],r.H[e].L=r.H[e].L||[],r.H[e].r=[...r.H[e].L],r.CP)for(let t=0;t<r.CP.length;t++)r.CP[t]=null}}function Gw(r){return new Promise((e,t)=>{var n,a,i;function l(){vu(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{vu(),t(xr(r,"network-request-failed"))},timeout:Hw.get()})}if(!((a=(n=yr().gapi)===null||n===void 0?void 0:n.iframes)===null||a===void 0)&&a.Iframe)e(gapi.iframes.getContext());else if(!((i=yr().gapi)===null||i===void 0)&&i.load)l();else{const c=Zv("iframefcb");return yr()[c]=()=>{gapi.load?l():t(xr(r,"network-request-failed"))},Xv(`${Jv()}?onload=${c}`).catch(d=>t(d))}}).catch(e=>{throw si=null,e})}let si=null;function Kw(r){return si=si||Gw(r),si}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Qw=new ya(5e3,15e3),Yw="__/auth/iframe",Xw="emulator/auth/iframe",Jw={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},Zw=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function e1(r){const e=r.config;Fe(e.authDomain,r,"auth-domain-config-required");const t=e.emulator?sc(e,Xw):`https://${r.config.authDomain}/${Yw}`,n={apiKey:e.apiKey,appName:r.name,v:Rs},a=Zw.get(r.config.apiHost);a&&(n.eid=a);const i=r._getFrameworks();return i.length&&(n.fw=i.join(",")),`${t}?${ca(n).slice(1)}`}async function t1(r){const e=await Kw(r),t=yr().gapi;return Fe(t,r,"internal-error"),e.open({where:document.body,url:e1(r),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:Jw,dontclear:!0},n=>new Promise(async(a,i)=>{await n.restyle({setHideOnLeave:!1});const l=xr(r,"network-request-failed"),c=yr().setTimeout(()=>{i(l)},Qw.get());function d(){yr().clearTimeout(c),a(n)}n.ping(d).then(d,()=>{i(l)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const r1={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},s1=500,n1=600,a1="_blank",i1="http://localhost";class wu{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function o1(r,e,t,n=s1,a=n1){const i=Math.max((window.screen.availHeight-a)/2,0).toString(),l=Math.max((window.screen.availWidth-n)/2,0).toString();let c="";const d=Object.assign(Object.assign({},r1),{width:n.toString(),height:a.toString(),top:i,left:l}),h=Ft().toLowerCase();t&&(c=Zm(h)?a1:t),Xm(h)&&(e=e||i1,d.scrollbars="yes");const g=Object.entries(d).reduce((p,[E,j])=>`${p}${E}=${j},`,"");if(qv(h)&&c!=="_self")return l1(e||"",c),new wu(null);const x=window.open(e||"",c,g);Fe(x,r,"popup-blocked");try{x.focus()}catch{}return new wu(x)}function l1(r,e){const t=document.createElement("a");t.href=r,t.target=e;const n=document.createEvent("MouseEvent");n.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),t.dispatchEvent(n)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const c1="__/auth/handler",d1="emulator/auth/handler",u1=encodeURIComponent("fac");async function _u(r,e,t,n,a,i){Fe(r.config.authDomain,r,"auth-domain-config-required"),Fe(r.config.apiKey,r,"invalid-api-key");const l={apiKey:r.config.apiKey,appName:r.name,authType:t,redirectUrl:n,v:Rs,eventId:a};if(e instanceof lg){e.setDefaultLanguage(r.languageCode),l.providerId=e.providerId||"",of(e.getCustomParameters())||(l.customParameters=JSON.stringify(e.getCustomParameters()));for(const[g,x]of Object.entries({}))l[g]=x}if(e instanceof ba){const g=e.getScopes().filter(x=>x!=="");g.length>0&&(l.scopes=g.join(","))}r.tenantId&&(l.tid=r.tenantId);const c=l;for(const g of Object.keys(c))c[g]===void 0&&delete c[g];const d=await r._getAppCheckToken(),h=d?`#${u1}=${encodeURIComponent(d)}`:"";return`${h1(r)}?${ca(c).slice(1)}${h}`}function h1({config:r}){return r.emulator?sc(r,d1):`https://${r.authDomain}/${c1}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const So="webStorageSupport";class m1{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=mg,this._completeRedirectFn=Ow,this._overrideRedirectResult=Pw}async _openPopup(e,t,n,a){var i;Lr((i=this.eventManagers[e._key()])===null||i===void 0?void 0:i.manager,"_initialize() not called before _openPopup()");const l=await _u(e,t,n,nl(),a);return o1(e,l,cc())}async _openRedirect(e,t,n,a){await this._originValidation(e);const i=await _u(e,t,n,nl(),a);return fw(i),new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:a,promise:i}=this.eventManagers[t];return a?Promise.resolve(a):(Lr(i,"If manager is not set, promise should be"),i)}const n=this.initAndGetManager(e);return this.eventManagers[t]={promise:n},n.catch(()=>{delete this.eventManagers[t]}),n}async initAndGetManager(e){const t=await t1(e),n=new Lw(e);return t.register("authEvent",a=>(Fe(a==null?void 0:a.authEvent,e,"invalid-auth-event"),{status:n.onEvent(a.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:n},this.iframes[e._key()]=t,n}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(So,{type:So},a=>{var i;const l=(i=a==null?void 0:a[0])===null||i===void 0?void 0:i[So];l!==void 0&&t(!!l),Vr(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=Ww(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return ng()||Jm()||ic()}}const g1=m1;var ku="@firebase/auth",Nu="1.7.9";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class p1{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)===null||e===void 0?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(n=>{e((n==null?void 0:n.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){Fe(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function f1(r){switch(r){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function x1(r){Es(new ls("auth",(e,{options:t})=>{const n=e.getProvider("app").getImmediate(),a=e.getProvider("heartbeat"),i=e.getProvider("app-check-internal"),{apiKey:l,authDomain:c}=n.options;Fe(l&&!l.includes(":"),"invalid-api-key",{appName:n.name});const d={apiKey:l,authDomain:c,clientPlatform:r,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:ag(r)},h=new Qv(n,a,i,d);return tw(h,t),h},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,n)=>{e.getProvider("auth-internal").initialize()})),Es(new ls("auth-internal",e=>{const t=oc(e.getProvider("auth").getImmediate());return(n=>new p1(n))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),gr(ku,Nu,f1(r)),gr(ku,Nu,"esm2017")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const y1=5*60,b1=yh("authIdTokenMaxAge")||y1;let Eu=null;const v1=r=>async e=>{const t=e&&await e.getIdTokenResult(),n=t&&(new Date().getTime()-Date.parse(t.issuedAtTime))/1e3;if(n&&n>b1)return;const a=t==null?void 0:t.token;Eu!==a&&(Eu=a,await fetch(r,{method:a?"POST":"DELETE",headers:a?{Authorization:`Bearer ${a}`}:{}}))};function w1(r=vl()){const e=Mi(r,"auth");if(e.isInitialized())return e.getImmediate();const t=ew(r,{popupRedirectResolver:g1,persistence:[Ew,mw,mg]}),n=yh("authTokenSyncURL");if(n&&typeof isSecureContext=="boolean"&&isSecureContext){const i=new URL(n,location.origin);if(location.origin===i.origin){const l=v1(i.toString());dw(t,l,()=>l(t.currentUser)),cw(t,c=>l(c))}}const a=ph("auth");return a&&rw(t,`http://${a}`),t}function _1(){var r,e;return(e=(r=document.getElementsByTagName("head"))===null||r===void 0?void 0:r[0])!==null&&e!==void 0?e:document}Yv({loadJS(r){return new Promise((e,t)=>{const n=document.createElement("script");n.setAttribute("src",r),n.onload=e,n.onerror=a=>{const i=xr("internal-error");i.customData=a,t(i)},n.type="text/javascript",n.charset="UTF-8",_1().appendChild(n)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});x1("Browser");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vg="firebasestorage.googleapis.com",k1="storageBucket",N1=2*60*1e3,E1=10*60*1e3;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nr extends kr{constructor(e,t,n=0){super(Ao(e),`Firebase Storage: ${t} (${Ao(e)})`),this.status_=n,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,Nr.prototype)}get status(){return this.status_}set status(e){this.status_=e}_codeEquals(e){return Ao(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message=`${this._baseMessage}
${this.customData.serverResponse}`:this.message=this._baseMessage}}var wr;(function(r){r.UNKNOWN="unknown",r.OBJECT_NOT_FOUND="object-not-found",r.BUCKET_NOT_FOUND="bucket-not-found",r.PROJECT_NOT_FOUND="project-not-found",r.QUOTA_EXCEEDED="quota-exceeded",r.UNAUTHENTICATED="unauthenticated",r.UNAUTHORIZED="unauthorized",r.UNAUTHORIZED_APP="unauthorized-app",r.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",r.INVALID_CHECKSUM="invalid-checksum",r.CANCELED="canceled",r.INVALID_EVENT_NAME="invalid-event-name",r.INVALID_URL="invalid-url",r.INVALID_DEFAULT_BUCKET="invalid-default-bucket",r.NO_DEFAULT_BUCKET="no-default-bucket",r.CANNOT_SLICE_BLOB="cannot-slice-blob",r.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",r.NO_DOWNLOAD_URL="no-download-url",r.INVALID_ARGUMENT="invalid-argument",r.INVALID_ARGUMENT_COUNT="invalid-argument-count",r.APP_DELETED="app-deleted",r.INVALID_ROOT_OPERATION="invalid-root-operation",r.INVALID_FORMAT="invalid-format",r.INTERNAL_ERROR="internal-error",r.UNSUPPORTED_ENVIRONMENT="unsupported-environment"})(wr||(wr={}));function Ao(r){return"storage/"+r}function j1(){const r="An unknown error occurred, please check the error payload for server response.";return new Nr(wr.UNKNOWN,r)}function I1(){return new Nr(wr.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function T1(){return new Nr(wr.CANCELED,"User canceled the upload/download.")}function S1(r){return new Nr(wr.INVALID_URL,"Invalid URL '"+r+"'.")}function A1(r){return new Nr(wr.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+r+"'.")}function ju(r){return new Nr(wr.INVALID_ARGUMENT,r)}function wg(){return new Nr(wr.APP_DELETED,"The Firebase app was deleted.")}function C1(r){return new Nr(wr.INVALID_ROOT_OPERATION,"The operation '"+r+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sr{constructor(e,t){this.bucket=e,this.path_=t}get path(){return this.path_}get isRoot(){return this.path.length===0}fullServerUrl(){const e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(e,t){let n;try{n=sr.makeFromUrl(e,t)}catch{return new sr(e,"")}if(n.path==="")return n;throw A1(e)}static makeFromUrl(e,t){let n=null;const a="([A-Za-z0-9.\\-_]+)";function i(O){O.path.charAt(O.path.length-1)==="/"&&(O.path_=O.path_.slice(0,-1))}const l="(/(.*))?$",c=new RegExp("^gs://"+a+l,"i"),d={bucket:1,path:3};function h(O){O.path_=decodeURIComponent(O.path)}const g="v[A-Za-z0-9_]+",x=t.replace(/[.]/g,"\\."),p="(/([^?#]*).*)?$",E=new RegExp(`^https?://${x}/${g}/b/${a}/o${p}`,"i"),j={bucket:1,path:3},S=t===vg?"(?:storage.googleapis.com|storage.cloud.google.com)":t,k="([^?#]*)",L=new RegExp(`^https?://${S}/${a}/${k}`,"i"),T=[{regex:c,indices:d,postModify:i},{regex:E,indices:j,postModify:h},{regex:L,indices:{bucket:1,path:2},postModify:h}];for(let O=0;O<T.length;O++){const ne=T[O],ie=ne.regex.exec(e);if(ie){const I=ie[ne.indices.bucket];let N=ie[ne.indices.path];N||(N=""),n=new sr(I,N),ne.postModify(n);break}}if(n==null)throw S1(e);return n}}class R1{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(e=!1){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function D1(r,e,t){let n=1,a=null,i=null,l=!1,c=0;function d(){return c===2}let h=!1;function g(...k){h||(h=!0,e.apply(null,k))}function x(k){a=setTimeout(()=>{a=null,r(E,d())},k)}function p(){i&&clearTimeout(i)}function E(k,...L){if(h){p();return}if(k){p(),g.call(null,k,...L);return}if(d()||l){p(),g.call(null,k,...L);return}n<64&&(n*=2);let T;c===1?(c=2,T=0):T=(n+Math.random())*1e3,x(T)}let j=!1;function S(k){j||(j=!0,p(),!h&&(a!==null?(k||(c=2),clearTimeout(a),x(0)):k||(c=1)))}return x(0),i=setTimeout(()=>{l=!0,S(!0)},t),S}function P1(r){r(!1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $1(r){return r!==void 0}function Iu(r,e,t,n){if(n<e)throw ju(`Invalid value for '${r}'. Expected ${e} or greater.`);if(n>t)throw ju(`Invalid value for '${r}'. Expected ${t} or less.`)}function M1(r){const e=encodeURIComponent;let t="?";for(const n in r)if(r.hasOwnProperty(n)){const a=e(n)+"="+e(r[n]);t=t+a+"&"}return t=t.slice(0,-1),t}var ji;(function(r){r[r.NO_ERROR=0]="NO_ERROR",r[r.NETWORK_ERROR=1]="NETWORK_ERROR",r[r.ABORT=2]="ABORT"})(ji||(ji={}));/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function O1(r,e){const t=r>=500&&r<600,a=[408,429].indexOf(r)!==-1,i=e.indexOf(r)!==-1;return t||a||i}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class V1{constructor(e,t,n,a,i,l,c,d,h,g,x,p=!0){this.url_=e,this.method_=t,this.headers_=n,this.body_=a,this.successCodes_=i,this.additionalRetryCodes_=l,this.callback_=c,this.errorCallback_=d,this.timeout_=h,this.progressCallback_=g,this.connectionFactory_=x,this.retry=p,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((E,j)=>{this.resolve_=E,this.reject_=j,this.start_()})}start_(){const e=(n,a)=>{if(a){n(!1,new Wa(!1,null,!0));return}const i=this.connectionFactory_();this.pendingConnection_=i;const l=c=>{const d=c.loaded,h=c.lengthComputable?c.total:-1;this.progressCallback_!==null&&this.progressCallback_(d,h)};this.progressCallback_!==null&&i.addUploadProgressListener(l),i.send(this.url_,this.method_,this.body_,this.headers_).then(()=>{this.progressCallback_!==null&&i.removeUploadProgressListener(l),this.pendingConnection_=null;const c=i.getErrorCode()===ji.NO_ERROR,d=i.getStatus();if(!c||O1(d,this.additionalRetryCodes_)&&this.retry){const g=i.getErrorCode()===ji.ABORT;n(!1,new Wa(!1,null,g));return}const h=this.successCodes_.indexOf(d)!==-1;n(!0,new Wa(h,i))})},t=(n,a)=>{const i=this.resolve_,l=this.reject_,c=a.connection;if(a.wasSuccessCode)try{const d=this.callback_(c,c.getResponse());$1(d)?i(d):i()}catch(d){l(d)}else if(c!==null){const d=j1();d.serverResponse=c.getErrorText(),this.errorCallback_?l(this.errorCallback_(c,d)):l(d)}else if(a.canceled){const d=this.appDelete_?wg():T1();l(d)}else{const d=I1();l(d)}};this.canceled_?t(!1,new Wa(!1,null,!0)):this.backoffId_=D1(e,t,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,this.backoffId_!==null&&P1(this.backoffId_),this.pendingConnection_!==null&&this.pendingConnection_.abort()}}class Wa{constructor(e,t,n){this.wasSuccessCode=e,this.connection=t,this.canceled=!!n}}function L1(r,e){e!==null&&e.length>0&&(r.Authorization="Firebase "+e)}function F1(r,e){r["X-Firebase-Storage-Version"]="webjs/"+(e??"AppManager")}function U1(r,e){e&&(r["X-Firebase-GMPID"]=e)}function B1(r,e){e!==null&&(r["X-Firebase-AppCheck"]=e)}function q1(r,e,t,n,a,i,l=!0){const c=M1(r.urlParams),d=r.url+c,h=Object.assign({},r.headers);return U1(h,e),L1(h,t),F1(h,i),B1(h,n),new V1(d,r.method,h,r.body,r.successCodes,r.additionalRetryCodes,r.handler,r.errorHandler,r.timeout,r.progressCallback,a,l)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function W1(r){if(r.length===0)return null;const e=r.lastIndexOf("/");return e===-1?"":r.slice(0,e)}function z1(r){const e=r.lastIndexOf("/",r.length-2);return e===-1?r:r.slice(e+1)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ii{constructor(e,t){this._service=e,t instanceof sr?this._location=t:this._location=sr.makeFromUrl(t,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,t){return new Ii(e,t)}get root(){const e=new sr(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return z1(this._location.path)}get storage(){return this._service}get parent(){const e=W1(this._location.path);if(e===null)return null;const t=new sr(this._location.bucket,e);return new Ii(this._service,t)}_throwIfRoot(e){if(this._location.path==="")throw C1(e)}}function Tu(r,e){const t=e==null?void 0:e[k1];return t==null?null:sr.makeFromBucketSpec(t,r)}function H1(r,e,t,n={}){r.host=`${e}:${t}`,r._protocol="http";const{mockUserToken:a}=n;a&&(r._overrideAuthToken=typeof a=="string"?a:bh(a,r.app.options.projectId))}class G1{constructor(e,t,n,a,i){this.app=e,this._authProvider=t,this._appCheckProvider=n,this._url=a,this._firebaseVersion=i,this._bucket=null,this._host=vg,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=N1,this._maxUploadRetryTime=E1,this._requests=new Set,a!=null?this._bucket=sr.makeFromBucketSpec(a,this._host):this._bucket=Tu(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,this._url!=null?this._bucket=sr.makeFromBucketSpec(this._url,e):this._bucket=Tu(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){Iu("time",0,Number.POSITIVE_INFINITY,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){Iu("time",0,Number.POSITIVE_INFINITY,e),this._maxOperationRetryTime=e}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const e=this._authProvider.getImmediate({optional:!0});if(e){const t=await e.getToken();if(t!==null)return t.accessToken}return null}async _getAppCheckToken(){const e=this._appCheckProvider.getImmediate({optional:!0});return e?(await e.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(e=>e.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new Ii(this,e)}_makeRequest(e,t,n,a,i=!0){if(this._deleted)return new R1(wg());{const l=q1(e,this._appId,n,a,t,this._firebaseVersion,i);return this._requests.add(l),l.getPromise().then(()=>this._requests.delete(l),()=>this._requests.delete(l)),l}}async makeRequestWithTokens(e,t){const[n,a]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,t,n,a).getPromise()}}const Su="@firebase/storage",Au="0.13.2";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _g="storage";function K1(r=vl(),e){r=Ut(r);const n=Mi(r,_g).getImmediate({identifier:e}),a=fh("storage");return a&&Q1(n,...a),n}function Q1(r,e,t,n={}){H1(r,e,t,n)}function Y1(r,{instanceIdentifier:e}){const t=r.getProvider("app").getImmediate(),n=r.getProvider("auth-internal"),a=r.getProvider("app-check-internal");return new G1(t,n,a,e,Rs)}function X1(){Es(new ls(_g,Y1,"PUBLIC").setMultipleInstances(!0)),gr(Su,Au,""),gr(Su,Au,"esm2017")}X1();const Tr={apiKey:"your-api-key",authDomain:"your-auth-domain",projectId:"your-project-id",storageBucket:"your-storage-bucket",messagingSenderId:"your-messaging-sender-id",appId:"your-app-id"};console.log("Firebase config check:",{hasApiKey:!!Tr.apiKey&&Tr.apiKey!=="your-api-key",authDomain:Tr.authDomain,projectId:Tr.projectId,hasStorageBucket:!!Tr.storageBucket&&Tr.storageBucket!=="your-storage-bucket",hasAppId:!!Tr.appId&&Tr.appId!=="your-app-id"});console.log("Raw env values:",{VITE_FIREBASE_API_KEY:void 0,VITE_FIREBASE_AUTH_DOMAIN:void 0,VITE_FIREBASE_PROJECT_ID:void 0,VITE_FIREBASE_STORAGE_BUCKET:void 0});const uc=_h(Tr);w1(uc);const Qe=iv(uc);K1(uc);console.log("Firestore db initialized:",!!Qe);const J1=30,Cu=r=>r.toString().padStart(2,"0"),Z1=()=>{const r=new Date;return r.setDate(r.getDate()-J1),{dateOnly:`${r.getFullYear()}-${Cu(r.getMonth()+1)}-${Cu(r.getDate())}`,iso:r.toISOString()}},za=async(r,e,t)=>{const n=jt(Qe,r),a=yt(n,Kt(e,"<",t)),i=await lr(a);await Promise.all(i.docs.map(l=>ms(qt(Qe,r,l.id))))},kg=async()=>{try{const{dateOnly:r,iso:e}=Z1();await Promise.all([za("workSlots","date",r),za("dayStatuses","date",r),za("earnings","date",r),za("referrals","createdAt",e)])}catch(r){console.error("Failed to cleanup old data",r)}},Fr=async(r,e)=>{const t=jt(Qe,"workSlots");let n;r&&e||r?n=yt(t,Kt("userId","==",r)):e?n=yt(t,Kt("date","==",e)):n=yt(t);let i=(await lr(n)).docs.map(l=>{const c=l.data(),d=((c==null?void 0:c.slots)||[]).map(h=>h.break&&!h.breaks?{...h,breaks:[h.break],break:void 0}:h);return{id:l.id,userId:(c==null?void 0:c.userId)||"",date:(c==null?void 0:c.date)||"",slots:d,participants:(c==null?void 0:c.participants)||[],...(c==null?void 0:c.comment)&&{comment:c.comment}}});return r&&e&&(i=i.filter(l=>l.date===e)),i.sort((l,c)=>l.date.localeCompare(c.date)),i},e2=async r=>{try{console.log("addWorkSlot: Starting, db initialized:",!!Qe);const e=jt(Qe,"workSlots");console.log("addWorkSlot: Collection reference created");const t=Object.fromEntries(Object.entries(r).filter(([a,i])=>i!==void 0));console.log("addWorkSlot: Clean slot prepared:",t),console.log("addWorkSlot: Calling addDoc...");const n=await Os(e,t);return console.log("addWorkSlot: Work slot added successfully:",n.id),n}catch(e){throw console.error("addWorkSlot: Error caught:",e),console.error("addWorkSlot: Error code:",e==null?void 0:e.code),console.error("addWorkSlot: Error message:",e==null?void 0:e.message),console.error("addWorkSlot: Full error:",JSON.stringify(e,null,2)),e}},t2=async(r,e)=>{const t=qt(Qe,"workSlots",r),n=Object.fromEntries(Object.entries(e).filter(([a,i])=>i!==void 0));await Ms(t,n)},hc=async r=>{const e=qt(Qe,"workSlots",r);await ms(e)},Rr=async(r,e)=>{const t=jt(Qe,"dayStatuses");let n;r?n=yt(t,Kt("userId","==",r)):n=yt(t);let i=(await lr(n)).docs.map(l=>{const c=l.data();return{id:l.id,userId:(c==null?void 0:c.userId)||"",date:(c==null?void 0:c.date)||"",type:(c==null?void 0:c.type)||"dayoff",...(c==null?void 0:c.comment)&&{comment:c.comment},...(c==null?void 0:c.endDate)&&{endDate:c.endDate}}});return i.sort((l,c)=>l.date.localeCompare(c.date)),i},Ng=async r=>{try{const e=jt(Qe,"dayStatuses"),t=Object.fromEntries(Object.entries(r).filter(([a,i])=>i!==void 0));console.log("Adding day status:",t);const n=await Os(e,t);return console.log("Day status added successfully:",n.id),n}catch(e){throw console.error("Error in addDayStatus:",e),e}},ni=async(r,e)=>{const t=qt(Qe,"dayStatuses",r),n=Object.fromEntries(Object.entries(e).filter(([a,i])=>i!==void 0));await Ms(t,n)},Eg=async r=>{const e=qt(Qe,"dayStatuses",r);await ms(e)},ra=async(r,e,t)=>{const n=jt(Qe,"earnings");let a;r?a=yt(n):e&&t?a=yt(n,Kt("date",">=",e),Kt("date","<=",t)):a=yt(n);let l=(await lr(a)).docs.map(c=>{const d=c.data();return{id:c.id,userId:(d==null?void 0:d.userId)||"",date:(d==null?void 0:d.date)||"",amount:(d==null?void 0:d.amount)||0,poolAmount:(d==null?void 0:d.poolAmount)||0,slotId:(d==null?void 0:d.slotId)||"",extraWalletsCount:(d==null?void 0:d.extraWalletsCount)||0,extraWalletsAmount:(d==null?void 0:d.extraWalletsAmount)||0,category:(d==null?void 0:d.category)||"other",participants:(d==null?void 0:d.participants)||[]}});return r&&(l=l.filter(c=>(c.participants&&c.participants.length>0?[...c.participants,c.userId]:[c.userId]).includes(r))),r&&e&&t?l=l.filter(c=>c.date>=e&&c.date<=t):!r&&e&&t&&(l=l.filter(c=>c.date>=e&&c.date<=t)),l.sort((c,d)=>d.date.localeCompare(c.date)),l},r2=async r=>{try{const e=jt(Qe,"earnings"),t=Object.fromEntries(Object.entries(r).filter(([a,i])=>i!==void 0));console.log("Adding earnings:",t);const n=await Os(e,t);return console.log("Earnings added successfully:",n.id),n}catch(e){throw console.error("Error in addEarnings:",e),e}},s2=async(r,e)=>{const t=qt(Qe,"earnings",r),n=Object.fromEntries(Object.entries(e).filter(([a,i])=>i!==void 0));await Ms(t,n)},n2=async r=>{const e=qt(Qe,"earnings",r);await ms(e)},jg=async r=>{const e=jt(Qe,"ratings");let t=yt(e);return r&&(t=yt(t,Kt("userId","==",r))),(await lr(t)).docs.map(a=>{const i=a.data();return{id:a.id,userId:i.userId||"",earnings:i.earnings||0,messages:i.messages||0,initiatives:i.initiatives||0,signals:i.signals||0,profitableSignals:i.profitableSignals||0,referrals:i.referrals||0,daysOff:i.daysOff||0,sickDays:i.sickDays||0,vacationDays:i.vacationDays||0,poolAmount:i.poolAmount||0,rating:i.rating||0,lastUpdated:i.lastUpdated||new Date().toISOString()}})},Ig=async(r,e,t)=>{try{const n=jt(Qe,"messages"),a=yt(n,Kt("userId","==",r));return(await lr(a)).docs.filter(c=>{const h=c.data().date||"";return h>=e&&h<=t}).length}catch(n){console.error("Error getting weekly messages:",n);const a=jt(Qe,"ratings"),i=yt(a,Kt("userId","==",r)),l=await lr(i);return l.empty?0:l.docs[0].data().messages||0}},a2=async r=>{try{const e=jt(Qe,"referrals"),t=Object.fromEntries(Object.entries(r).filter(([a,i])=>i!==void 0));console.log("Adding referral:",t);const n=await Os(e,t);return console.log("Referral added successfully:",n.id),n}catch(e){throw console.error("Error in addReferral:",e),e}},Tg=async(r,e,t)=>{const n=jt(Qe,"referrals");let a;a=yt(n,ea("createdAt","desc"));let l=(await lr(a)).docs.map(c=>{const d=c.data();return{id:c.id,referralId:d.referralId,ownerId:d.ownerId,name:d.name,age:d.age,createdAt:d.createdAt,comment:d.comment}});return e&&t&&(l=l.filter(c=>c.createdAt>=e&&c.createdAt<=t)),l.sort((c,d)=>c.createdAt<d.createdAt?1:-1)},i2=async(r,e)=>{const t=qt(Qe,"referrals",r),n=Object.fromEntries(Object.entries(e).filter(([a,i])=>i!==void 0));await Ms(t,n)},o2=async r=>{const e=qt(Qe,"referrals",r);await ms(e)},l2=async r=>{if(console.log("📝 Service site: Creating call:",{category:r.category,userId:r.userId,status:r.status,createdAt:r.createdAt}),!Qe)throw console.error("❌ Service site: Firestore db is not initialized"),new Error("Firestore database is not initialized");const e=jt(Qe,"calls"),t=await Os(e,r);return console.log("✅ Service site: Call created successfully with ID:",t.id),console.log("📊 Service site: Call data saved to Firestore:",r),t.id},c2=async r=>{const e=jt(Qe,"calls"),t=[];t.push(ea("createdAt","desc"));let n;return t.length>0?n=yt(e,...t):n=yt(e,ea("createdAt","desc")),(await lr(n)).docs.map(l=>{var E,j,S,k,L,M,T,O;const c=l.data(),d=c.category||"memecoins",h=!c.details&&c.ticker?{memecoins:{coinName:c.pair||c.ticker,ticker:c.ticker||"",network:c.network||"solana",contract:c.contract,signalType:c.sentiment||"buy",reason:c.comment||c.risks||"",entryCap:c.entryPoint||"",targets:c.target||"",stopLoss:c.cancelConditions,riskLevel:c.riskLevel||"medium",risks:c.risks||"",holdPlan:"short",liquidityLocked:!1,traderComment:c.comment}}:{},g=c.details||h||{},x=c.riskLevel||((E=g.memecoins)==null?void 0:E.riskLevel)||((j=g.polymarket)==null?void 0:j.riskLevel)||((S=g.staking)==null?void 0:S.protocolRisk)||((k=g.spot)==null?void 0:k.riskLevel)||((L=g.futures)==null?void 0:L.riskLevel),p=c.sentiment||((M=g.memecoins)==null?void 0:M.signalType)||(((T=g.futures)==null?void 0:T.direction)==="long"?"buy":((O=g.futures)==null?void 0:O.direction)==="short"?"sell":void 0);return{id:l.id,userId:c.userId||"",category:d,details:g,sentiment:p,riskLevel:x,comment:c.comment,createdAt:c.createdAt||new Date().toISOString(),status:c.status||"active",maxProfit:c.maxProfit,currentPnL:c.currentPnL,currentMarketCap:c.currentMarketCap,signalMarketCap:c.signalMarketCap,currentPrice:c.currentPrice,entryPrice:c.entryPrice,tags:c.tags||[]}})},Sg=async(r,e)=>{const t=qt(Qe,"calls",r);await Ms(t,e)},d2=async r=>{const e=qt(Qe,"calls",r);await ms(e)},u2=async r=>{const e=jt(Qe,"tasks");return(await Os(e,r)).id},Ag=async r=>{const e=jt(Qe,"tasks"),t=[];r!=null&&r.status&&t.push(Kt("status","==",r.status)),r!=null&&r.category&&t.push(Kt("category","==",r.category)),r!=null&&r.createdBy&&t.push(Kt("createdBy","==",r.createdBy)),t.push(ea("createdAt","desc"));let n;t.length>0?n=yt(e,...t):n=yt(e,ea("createdAt","desc"));const a=await lr(n),i=x=>x==="high"||x==="low"||x==="urgent"?x:"medium",l=(x=[])=>x.filter(p=>p==null?void 0:p.userId).slice(0,10).map(p=>({userId:p.userId,priority:i(p.priority),comment:p.comment,instruction:p.instruction}));let c=a.docs.map(x=>{const p=x.data(),j=((Array.isArray(p.assignees)?p.assignees:(p.assignedTo||[]).map(M=>({userId:M,priority:"medium"})))||[]).map(M=>({userId:M.userId||"",priority:i(M.priority),comment:M.comment})).filter(M=>!!M.userId),S=j.map(M=>M.userId),k=Array.isArray(p.coExecutors)?p.coExecutors:Array.isArray(p.executors)?p.executors:[],L=(p.stages||[]).map(M=>({id:M.id||`stage-${Date.now()}`,name:M.name||"Этап",description:M.description,responsible:M.responsible==="all"?"all":Array.isArray(M.responsible)?M.responsible:(M.assignees||[]).map(T=>T.userId),assignees:l(M.assignees),stagePriority:i(M.stagePriority),requiresApproval:M.requiresApproval??!0,approvals:M.approvals||[],comments:M.comments||[],status:M.status||"pending"}));return{id:x.id,title:p.title||"",description:p.description,category:p.category||"trading",status:p.status||"pending",createdBy:p.createdBy||"",assignedTo:S,assignees:j,approvals:p.approvals||[],createdAt:p.createdAt||new Date().toISOString(),updatedAt:p.updatedAt||new Date().toISOString(),completedAt:p.completedAt,closedAt:p.closedAt,completedBy:p.completedBy,priority:i(p.priority),dueDate:p.dueDate||new Date().toISOString().split("T")[0],dueTime:p.dueTime||"12:00",startTime:p.startTime,mainExecutor:p.mainExecutor,leadExecutor:p.leadExecutor,deputies:p.deputies||[],coExecutors:k,executors:p.executors||[],curators:p.curators||[],leads:p.leads||[],stages:L,currentStageId:p.currentStageId,awaitingStageId:p.awaitingStageId,comments:p.comments||[],expectedResult:p.expectedResult,requiresApproval:p.requiresApproval??!0}});const d=new Date,h=new Date(d.getTime()-12*60*60*1e3),g=c.filter(x=>x.status==="closed"&&x.closedAt?new Date(x.closedAt)<h:!1);if(g.length>0&&(await Promise.all(g.map(x=>Cg(x.id))),c=c.filter(x=>!g.find(p=>p.id===x.id))),r!=null&&r.assignedTo)if(Array.isArray(r.assignedTo)){const x=r.assignedTo;x.length>0&&(c=c.filter(p=>x.some(E=>p.assignedTo.includes(E))))}else c=c.filter(x=>x.assignedTo.includes(r.assignedTo));return c},dr=async(r,e)=>{const t=qt(Qe,"tasks",r),n=Object.fromEntries(Object.entries({...e,updatedAt:new Date().toISOString()}).filter(([a,i])=>i!==void 0));await Ms(t,n)},Cg=async r=>{const e=qt(Qe,"tasks",r);await ms(e)},Ru=async(r,e=!1)=>{const t=jt(Qe,"notes");let n;!e&&r?n=yt(t,Kt("userId","==",r)):n=yt(t);const i=(await lr(n)).docs.map(l=>{const c=l.data();return{id:l.id,userId:c.userId||"",title:c.title||"",text:c.text||"",priority:c.priority==="low"||c.priority==="high"?c.priority:"medium",createdAt:c.createdAt||new Date().toISOString(),updatedAt:c.updatedAt||new Date().toISOString()}});return i.sort((l,c)=>(c.updatedAt||"").localeCompare(l.updatedAt||"")),r&&!e?i.filter(l=>l.userId===r):i},h2=async r=>{const e=jt(Qe,"notes"),t={...r,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};return(await Os(e,t)).id},m2=async(r,e)=>{const t=qt(Qe,"notes",r),n=Object.fromEntries(Object.entries({...e,updatedAt:new Date().toISOString()}).filter(([a,i])=>i!==void 0));await Ms(t,n)},g2=async r=>{const e=qt(Qe,"notes",r);await ms(e)},Du=[{value:"solana",label:"Solana"},{value:"ethereum",label:"ETH"},{value:"bsc",label:"BSC"},{value:"ton",label:"TON"},{value:"base",label:"Base"},{value:"sui",label:"SUI"},{value:"monad",label:"Monad"},{value:"polygon",label:"Polygon"}],p2={memecoins:{label:"Мемкоины",gradient:"from-emerald-300 to-teal-400",icon:s.jsx(oa,{className:"w-5 h-5"}),pastelBg:"bg-emerald-50",pastelBorder:"border-emerald-100",pastelText:"text-emerald-800"},futures:{label:"Фьючерсы",gradient:"from-sky-300 to-indigo-400",icon:s.jsx(ia,{className:"w-5 h-5"}),pastelBg:"bg-sky-50",pastelBorder:"border-sky-100",pastelText:"text-sky-800"},nft:{label:"NFT",gradient:"from-purple-300 to-pink-300",icon:s.jsx(aa,{className:"w-5 h-5"}),pastelBg:"bg-purple-50",pastelBorder:"border-purple-100",pastelText:"text-purple-800"},spot:{label:"Спот",gradient:"from-amber-300 to-orange-300",icon:s.jsx(ur,{className:"w-5 h-5"}),pastelBg:"bg-amber-50",pastelBorder:"border-amber-100",pastelText:"text-amber-800"},polymarket:{label:"Polymarket",gradient:"from-rose-300 to-red-300",icon:s.jsx(Yr,{className:"w-5 h-5"}),pastelBg:"bg-rose-50",pastelBorder:"border-rose-100",pastelText:"text-rose-800"},staking:{label:"Стейкинг",gradient:"from-cyan-300 to-blue-300",icon:s.jsx(Lt,{className:"w-5 h-5"}),pastelBg:"bg-cyan-50",pastelBorder:"border-cyan-100",pastelText:"text-cyan-800"}},f2={memecoins:[{key:"coinName",label:"Название монеты",placeholder:"PEPE"},{key:"ticker",label:"Тикер",placeholder:"PEPE"},{key:"network",label:"Сеть",type:"select",options:Du},{key:"contract",label:"Контракт",placeholder:"0x..."},{key:"signalType",label:"Тип сигнала",type:"select",options:[{value:"buy",label:"Buy"},{value:"sell",label:"Sell"},{value:"hold",label:"Hold"},{value:"alert",label:"Alert"}]},{key:"reason",label:"Причина входа",placeholder:"Хайп, крупные покупки..."},{key:"entryCap",label:"Зона входа в капитализации",placeholder:"10M-15M"},{key:"targets",label:"Цели (TP1/TP2/TP3)",placeholder:"20M / 30M / 50M"},{key:"stopLoss",label:"Стоп-лосс (если применим)",placeholder:"5M или 15%"},{key:"riskLevel",label:"Риск-уровень",type:"select",options:[{value:"low",label:"Низкий"},{value:"medium",label:"Средний"},{value:"high",label:"Высокий"},{value:"ultra",label:"Ультра-высокий"}]},{key:"risks",label:"Риски",placeholder:"Разворот тренда, низкая ликвидность",type:"textarea"},{key:"holdPlan",label:"План удержания",type:"select",options:[{value:"flip",label:"Флип"},{value:"short",label:"Краткосрок"},{value:"medium",label:"Среднесрок"},{value:"long",label:"Дальнесрок"}]},{key:"liquidityLocked",label:"Залочена ли ликвидность",type:"checkbox"},{key:"traderComment",label:"Комментарий трейдера",type:"textarea",placeholder:"Доп. наблюдения, планы"}],futures:[{key:"pair",label:"Пара",placeholder:"BTC/USDT"},{key:"direction",label:"Направление",type:"select",options:[{value:"long",label:"Long"},{value:"short",label:"Short"}]},{key:"leverage",label:"Рекомендованное плечо",placeholder:"x3 - x10"},{key:"entryPrice",label:"Цена входа",placeholder:"69500"},{key:"entryZone",label:"Зоны входа (min-max)",placeholder:"69000 - 70000"},{key:"targets",label:"Цели (TP1/TP2/TP3)",placeholder:"71000 / 72500 / 74000"},{key:"stopLoss",label:"SL уровень",placeholder:"68000"},{key:"signalStyle",label:"Тип сигнала",type:"select",options:[{value:"breakout",label:"Breakout"},{value:"retest",label:"Retest"},{value:"range",label:"Range"},{value:"scalping",label:"Scalping"},{value:"swing",label:"Swing"}]},{key:"positionSize",label:"Размер позиции (% от депо)",placeholder:"2-5%"},{key:"reason",label:"Причина входа (анализ)",placeholder:"Тренд, объемы, дивергенция...",type:"textarea"},{key:"timeframe",label:"Таймфрейм анализа",type:"select",options:[{value:"1m",label:"1m"},{value:"5m",label:"5m"},{value:"15m",label:"15m"},{value:"1h",label:"1h"},{value:"4h",label:"4h"}]},{key:"risks",label:"Риски",placeholder:"Резкий вброс, низкая волатильность",type:"textarea"},{key:"riskLevel",label:"Риск-уровень",type:"select",options:[{value:"low",label:"Низкий"},{value:"medium",label:"Средний"},{value:"high",label:"Высокий"},{value:"ultra",label:"Ультра-высокий"}]}],nft:[{key:"collectionLink",label:"Коллекция (ссылка)",placeholder:"https://..."},{key:"nftLink",label:"NFT (ссылка)",placeholder:"https://.../item"},{key:"marketplace",label:"Маркетплейс",placeholder:"OpenSea / Magic Eden"},{key:"network",label:"Сеть",type:"select",options:Du},{key:"entryPrice",label:"Рекомендованная цена входа",placeholder:"1.2 ETH"},{key:"rarity",label:"Редкость / атрибуты",placeholder:"Rank < 5% или редкий фон"},{key:"signalType",label:"Тип сигнала",type:"select",options:[{value:"buy",label:"Buy"},{value:"sell",label:"Sell"},{value:"mint",label:"Mint"}]},{key:"reason",label:"Причина входа",placeholder:"Новый минт, хайп, инсайд",type:"textarea"},{key:"holdingHorizon",label:"Срок удержания",type:"select",options:[{value:"flip",label:"Скоростной флип"},{value:"short",label:"Краткосрок"},{value:"medium",label:"Среднесрок"},{value:"long",label:"Долгосрок"}]},{key:"minLiquidity",label:"Минимальная ликвидность (floor + объём)",placeholder:"Floor 2 ETH, объём 120 ETH"},{key:"targetPrice",label:"Цель продажи / Target price",placeholder:"3 ETH"},{key:"traderComment",label:"Комментарий трейдера",type:"textarea",placeholder:"Что смотрим, когда фиксируем"},{key:"risks",label:"Риски",type:"textarea",placeholder:"Падение спроса, фальшивый объём"}],spot:[{key:"coin",label:"Монета",placeholder:"BTC"},{key:"entryCap",label:"Капитализация входа",placeholder:"500M"},{key:"targets",label:"Цели (TP1/TP2/TP3)",placeholder:"550M / 650M / 750M"},{key:"stopLoss",label:"SL",placeholder:"-10%"},{key:"holdingHorizon",label:"Горизонт удержания",type:"select",options:[{value:"short",label:"Краткосрок"},{value:"medium",label:"Среднесрок"},{value:"long",label:"Долгосрок"}]},{key:"reason",label:"Причина входа",placeholder:"Фундаментал, хайп, запуск",type:"textarea"},{key:"positionSize",label:"Размер позиции",placeholder:"5-10% портфеля"},{key:"risks",label:"Риски",placeholder:"Регуляторика, конкуренты",type:"textarea"},{key:"traderComment",label:"Комментарий",type:"textarea",placeholder:"Условия фиксации, обновления"},{key:"riskLevel",label:"Риск-уровень",type:"select",options:[{value:"low",label:"Низкий"},{value:"medium",label:"Средний"},{value:"high",label:"Высокий"},{value:"ultra",label:"Ультра-высокий"}]}],polymarket:[{key:"event",label:"Событие",placeholder:"Trump wins 2025"},{key:"positionType",label:"Тип позиции",type:"select",options:[{value:"yes",label:"Yes"},{value:"no",label:"No"}]},{key:"entryPrice",label:"Цена входа (%)",placeholder:"42%"},{key:"expectedProbability",label:"Ожидаемая вероятность (%)",placeholder:"65%"},{key:"reason",label:"Причина входа",placeholder:"Аналитика, инсайд, тренд новостей",type:"textarea"},{key:"eventDeadline",label:"Срок исхода события",placeholder:"31.12.2025"},{key:"riskLevel",label:"Риск",type:"select",options:[{value:"low",label:"Низкий"},{value:"medium",label:"Средний"},{value:"high",label:"Высокий"},{value:"ultra",label:"Ультра-высокий"}]},{key:"maxStake",label:"Максимальный объём ставки",placeholder:"до $5k"},{key:"risks",label:"Риски",placeholder:"Неопределённость новостей, низкая ликвидность",type:"textarea"},{key:"targetPlan",label:"Цель",placeholder:"Продажа до события или удержание"}],staking:[{key:"coin",label:"Монета",placeholder:"SOL"},{key:"platform",label:"Платформа",placeholder:"Jito, Lido..."},{key:"term",label:"Срок стейкинга",type:"select",options:[{value:"flexible",label:"Гибкий"},{value:"30d",label:"30 дней"},{value:"90d",label:"90 дней"},{value:"fixed",label:"Фиксированный"}]},{key:"apy",label:"APY",placeholder:"12-18%"},{key:"minDeposit",label:"Минимальный депозит",placeholder:"100 USDT"},{key:"protocolRisk",label:"Риски протокола",type:"select",options:[{value:"low",label:"Низкие"},{value:"medium",label:"Средние"},{value:"high",label:"Высокие"},{value:"ultra",label:"Ультра"}]},{key:"action",label:"Тип сигнала",type:"select",options:[{value:"enter",label:"Вход"},{value:"exit",label:"Выход"},{value:"rebalance",label:"Перераспределение"}]},{key:"reason",label:"Причина",placeholder:"Рост доходности, снижение рисков...",type:"textarea"},{key:"risks",label:"Риски",placeholder:"Смарт-контракт, ликвидность",type:"textarea"},{key:"traderComment",label:"Комментарий трейдера",type:"textarea",placeholder:"Тактика выхода, дополнительные условия"}]},Pu=()=>({memecoins:{coinName:"",ticker:"",network:"solana",contract:"",signalType:"buy",reason:"",entryCap:"",targets:"",stopLoss:"",riskLevel:"medium",risks:"",holdPlan:"short",liquidityLocked:!1,traderComment:""},futures:{pair:"",direction:"long",leverage:"",entryPrice:"",entryZone:"",targets:"",stopLoss:"",signalStyle:"breakout",positionSize:"",reason:"",timeframe:"1h",risks:"",riskLevel:"medium"},nft:{collectionLink:"",nftLink:"",marketplace:"",network:"ethereum",entryPrice:"",rarity:"",signalType:"buy",reason:"",holdingHorizon:"short",minLiquidity:"",targetPrice:"",traderComment:"",risks:""},spot:{coin:"",entryCap:"",targets:"",stopLoss:"",holdingHorizon:"medium",reason:"",positionSize:"",risks:"",traderComment:"",riskLevel:"medium"},polymarket:{event:"",positionType:"yes",entryPrice:"",expectedProbability:"",reason:"",eventDeadline:"",riskLevel:"medium",maxStake:"",risks:"",targetPlan:""},staking:{coin:"",platform:"",term:"flexible",apy:"",minDeposit:"",protocolRisk:"medium",action:"enter",reason:"",risks:"",traderComment:""}}),$u=(r,e)=>({memecoins:{...r.memecoins,...(e==null?void 0:e.memecoins)||{}},futures:{...r.futures,...(e==null?void 0:e.futures)||{}},nft:{...r.nft,...(e==null?void 0:e.nft)||{}},spot:{...r.spot,...(e==null?void 0:e.spot)||{}},polymarket:{...r.polymarket,...(e==null?void 0:e.polymarket)||{}},staking:{...r.staking,...(e==null?void 0:e.staking)||{}}}),x2=({onSuccess:r,onCancel:e,callToEdit:t,initialCategory:n})=>{const{theme:a}=ct(),{user:i}=Dt(),[l,c]=A.useState(!1),[d,h]=A.useState(""),g=$u(Pu(),t==null?void 0:t.details),[x,p]=A.useState((t==null?void 0:t.category)||n||"memecoins"),[E,j]=A.useState((t==null?void 0:t.comment)||""),[S,k]=A.useState(g);A.useEffect(()=>{const f=$u(Pu(),t==null?void 0:t.details);k(f),p((t==null?void 0:t.category)||n||"memecoins"),j((t==null?void 0:t.comment)||"")},[t,n]);const L=a==="dark"?"text-white":"text-gray-900",M=a==="dark"?"border-gray-800":"border-gray-200",T=a==="dark"?"bg-gray-700/60":"bg-gray-50",O=a==="dark"?"text-gray-400":"text-gray-500",ne=(f,w)=>{k(_=>({..._,[x]:{..._[x],[f]:w}}))},ie=f=>(f==null?void 0:f.riskLevel)||(f==null?void 0:f.protocolRisk)||void 0,I=f=>{if(f!=null&&f.signalType)return f.signalType;if((f==null?void 0:f.direction)==="long")return"buy";if((f==null?void 0:f.direction)==="short")return"sell"},N=async f=>{f.preventDefault(),h(""),c(!0);try{const w=S[x],_={...t==null?void 0:t.details,[x]:w},G={userId:(t==null?void 0:t.userId)||(i==null?void 0:i.id)||"unknown",category:x,details:_,createdAt:(t==null?void 0:t.createdAt)||new Date().toISOString(),status:(t==null?void 0:t.status)||"active",tags:(t==null?void 0:t.tags)||[]},V=E==null?void 0:E.trim();V&&(G.comment=V);const F=I(w);F&&(G.sentiment=F);const z=ie(w);z&&(G.riskLevel=z),(t==null?void 0:t.maxProfit)!==void 0&&(G.maxProfit=t.maxProfit),(t==null?void 0:t.currentPnL)!==void 0&&(G.currentPnL=t.currentPnL),(t==null?void 0:t.currentMarketCap)!==void 0&&(G.currentMarketCap=t.currentMarketCap),(t==null?void 0:t.signalMarketCap)!==void 0&&(G.signalMarketCap=t.signalMarketCap),(t==null?void 0:t.currentPrice)!==void 0&&(G.currentPrice=t.currentPrice),(t==null?void 0:t.entryPrice)!==void 0&&(G.entryPrice=t.entryPrice),t?await Sg(t.id,G):await l2(G),r==null||r()}catch(w){console.error("Error creating call:",w);const _=(w==null?void 0:w.message)||(w==null?void 0:w.code)||"Ошибка при сохранении сигнала";h(_)}finally{c(!1)}},b=f=>{var G;const _=(S[x]||{})[f.key],y=`w-full px-4 py-2 rounded-lg border ${M} ${T} ${L} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`;return f.type==="textarea"?s.jsx("textarea",{value:_||"",onChange:V=>ne(f.key,V.target.value),className:`${y} min-h-[100px] resize-y`,placeholder:f.placeholder}):f.type==="select"&&f.options?s.jsx("select",{value:_||((G=f.options[0])==null?void 0:G.value)||"",onChange:V=>ne(f.key,V.target.value),className:`${y} appearance-none`,children:f.options.map(V=>s.jsx("option",{value:V.value,children:V.label},V.value))}):f.type==="checkbox"?s.jsxs("label",{className:"inline-flex items-center gap-2 cursor-pointer select-none",children:[s.jsx("input",{type:"checkbox",checked:!!_,onChange:V=>ne(f.key,V.target.checked),className:"accent-[#4E6E49] w-4 h-4"}),s.jsx("span",{className:L,children:f.label})]}):s.jsx("input",{type:"text",value:_||"",onChange:V=>ne(f.key,V.target.value),className:y,placeholder:f.placeholder})};return s.jsxs("form",{onSubmit:N,className:"space-y-6",children:[d&&s.jsx("div",{className:`p-4 rounded-lg ${a==="dark"?"bg-red-900/30 border border-red-700 text-red-300":"bg-red-50 border border-red-200 text-red-800"}`,children:d}),s.jsxs("div",{className:`rounded-2xl border ${M} ${a==="dark"?"bg-gray-800/60":"bg-white"} p-4 sm:p-6 space-y-4`,children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("div",{className:"w-10 h-10 rounded-xl flex items-center justify-center text-white shadow-lg",style:{background:"linear-gradient(135deg, #4E6E49, #3b8d5a)"},children:s.jsx(zt,{className:"w-5 h-5"})}),s.jsxs("div",{children:[s.jsx("p",{className:`text-lg font-bold ${L}`,children:p2[x].label}),s.jsx("p",{className:`text-xs ${O}`,children:"Добавьте любые детали по этому типу сигнала"})]})]}),s.jsx("div",{className:"grid grid-cols-1 gap-4",children:f2[x].map(f=>s.jsxs("div",{className:"space-y-2",children:[f.type!=="checkbox"&&s.jsxs("div",{className:"flex items-center justify-between gap-2",children:[s.jsx("label",{className:`text-sm font-semibold ${L}`,children:f.label}),f.helper&&s.jsx("span",{className:`text-[11px] ${O}`,children:f.helper})]}),b(f)]},f.key))})]}),s.jsxs("div",{children:[s.jsx("label",{className:`block text-sm font-medium ${L} mb-2`,children:"Общий комментарий или доп. заметки"}),s.jsx("textarea",{value:E,onChange:f=>j(f.target.value),className:`w-full px-4 py-3 rounded-lg border ${M} ${T} ${L} focus:outline-none focus:ring-2 focus:ring-[#4E6E49] min-h-[90px] resize-y`,placeholder:"Здесь можно оставить чеклист для апдейтов, условия выхода, алерты."})]}),s.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[s.jsx("button",{type:"submit",disabled:l,className:`flex-1 py-3 rounded-lg font-semibold transition-all shadow-md ${a==="dark"?"bg-gradient-to-r from-[#4E6E49] to-emerald-700 text-white hover:scale-[1.01] disabled:bg-gray-700":"bg-gradient-to-r from-[#4E6E49] to-emerald-600 text-white hover:shadow-lg disabled:bg-gray-300 disabled:text-gray-600"}`,children:l?"Сохраняем...":t?"Обновить сигнал":"Создать сигнал"}),e&&s.jsx("button",{type:"button",onClick:e,className:`px-6 py-3 rounded-lg font-semibold border ${M} ${a==="dark"?"text-white hover:bg-gray-800":"text-gray-800 hover:bg-gray-100"}`,children:"Отмена"})]})]})},Ti="modal-open";let Wn=0;const y2=()=>{typeof document>"u"||(Wn===0&&(document.body.classList.add(Ti),document.documentElement.classList.add(Ti)),Wn+=1)},b2=()=>{typeof document>"u"||(Wn=Math.max(Wn-1,0),Wn===0&&(document.body.classList.remove(Ti),document.documentElement.classList.remove(Ti)))},xn=(r=!0)=>{A.useEffect(()=>{if(r)return y2(),()=>{b2()}},[r])},Sn={memecoins:{label:"Мемкоины",gradient:"from-emerald-400 to-teal-500",chip:"bg-emerald-500/10 text-emerald-600",icon:s.jsx(oa,{className:"w-4 h-4"})},futures:{label:"Фьючерсы",gradient:"from-blue-400 to-indigo-500",chip:"bg-blue-500/10 text-blue-600",icon:s.jsx(ia,{className:"w-4 h-4"})},nft:{label:"NFT",gradient:"from-purple-400 to-pink-500",chip:"bg-purple-500/10 text-purple-600",icon:s.jsx(aa,{className:"w-4 h-4"})},spot:{label:"Спот",gradient:"from-amber-400 to-orange-500",chip:"bg-amber-500/10 text-amber-600",icon:s.jsx(ur,{className:"w-4 h-4"})},polymarket:{label:"Polymarket",gradient:"from-rose-400 to-red-500",chip:"bg-rose-500/10 text-rose-600",icon:s.jsx(Yr,{className:"w-4 h-4"})},staking:{label:"Стейкинг",gradient:"from-cyan-400 to-blue-500",chip:"bg-cyan-500/10 text-cyan-600",icon:s.jsx(Lt,{className:"w-4 h-4"})}},Ha={all:{label:"Все",className:""},active:{label:"Активен",className:"bg-emerald-500/15 text-emerald-500 border border-emerald-500/20"},completed:{label:"Завершен",className:"bg-blue-500/15 text-blue-500 border border-blue-500/20"},cancelled:{label:"Отменен",className:"bg-red-500/15 text-red-500 border border-red-500/20"},reviewed:{label:"На рассмотрении",className:"bg-gray-500/15 text-gray-500 border border-gray-500/20"}},Mu={low:"bg-emerald-500/10 text-emerald-600 border border-emerald-500/20",medium:"bg-blue-500/10 text-blue-600 border border-blue-500/20",high:"bg-amber-500/10 text-amber-600 border border-amber-500/20",ultra:"bg-red-500/10 text-red-600 border border-red-500/20"},v2=()=>{const{theme:r}=ct(),[e,t]=A.useState([]),[n,a]=A.useState(!0),[i,l]=A.useState(!1),[c,d]=A.useState(!1),[h,g]=A.useState(null),[x,p]=A.useState(null),[E,j]=A.useState(null),[S,k]=A.useState("memecoins"),[L,M]=A.useState(null),[T,O]=A.useState(""),[ne,ie]=A.useState("all"),[I,N]=A.useState("all"),[b,f]=A.useState("all"),[w,_]=A.useState("all");xn(i||c||!!x),A.useEffect(()=>{y()},[]);const y=async()=>{a(!0);try{const U=await c2();t(U)}catch(U){console.error("Error loading calls:",U),t([])}finally{a(!1)}},G=r==="dark"?"bg-[#121212]":"bg-white",V=r==="dark"?"text-white":"text-gray-900",F=r==="dark"?"text-gray-400":"text-gray-600",z=r==="dark"?"border-gray-800":"border-gray-200",ee={memecoins:{bg:r==="dark"?"bg-emerald-500/10":"bg-emerald-50",text:r==="dark"?"text-emerald-100":"text-emerald-800",border:r==="dark"?"border-emerald-500/30":"border-emerald-200",chipBg:r==="dark"?"bg-emerald-500/20":"bg-emerald-500/10"},futures:{bg:r==="dark"?"bg-sky-500/10":"bg-sky-50",text:r==="dark"?"text-sky-100":"text-sky-800",border:r==="dark"?"border-sky-500/30":"border-sky-200",chipBg:r==="dark"?"bg-sky-500/20":"bg-sky-500/10"},nft:{bg:r==="dark"?"bg-purple-500/10":"bg-purple-50",text:r==="dark"?"text-purple-100":"text-purple-800",border:r==="dark"?"border-purple-500/30":"border-purple-200",chipBg:r==="dark"?"bg-purple-500/20":"bg-purple-500/10"},spot:{bg:r==="dark"?"bg-amber-500/10":"bg-amber-50",text:r==="dark"?"text-amber-100":"text-amber-800",border:r==="dark"?"border-amber-500/30":"border-amber-200",chipBg:r==="dark"?"bg-amber-500/20":"bg-amber-500/10"},polymarket:{bg:r==="dark"?"bg-rose-500/10":"bg-rose-50",text:r==="dark"?"text-rose-100":"text-rose-800",border:r==="dark"?"border-rose-500/30":"border-rose-200",chipBg:r==="dark"?"bg-rose-500/20":"bg-rose-500/10"},staking:{bg:r==="dark"?"bg-cyan-500/10":"bg-cyan-50",text:r==="dark"?"text-cyan-100":"text-cyan-800",border:r==="dark"?"border-cyan-500/30":"border-cyan-200",chipBg:r==="dark"?"bg-cyan-500/20":"bg-cyan-500/10"}},re=()=>{l(!1),j(null),y()},oe=()=>{l(!1),j(null)},ke=U=>{j(U),k(U.category),l(!0)},ye=U=>{g(U),d(!0)},K=async()=>{if(h)try{await d2(h),d(!1),g(null),y()}catch(U){console.error("Error deleting call:",U),alert("Ошибка при удалении сигнала")}},he=async()=>{if(x)try{await Sg(x,{status:"cancelled"}),p(null),y()}catch(U){console.error("Error cancelling call:",U),alert("Ошибка при отмене сигнала")}},Ce=async U=>{try{await navigator.clipboard.writeText(U),M(U),setTimeout(()=>M(null),1800)}catch(D){console.error("Failed to copy:",D)}},H=U=>{var D;return((D=U.details)==null?void 0:D[U.category])||{}},Se=U=>{const D=H(U);switch(U.category){case"memecoins":return D.coinName||D.ticker||"Мемкоин";case"futures":return D.pair||"Фьючерс";case"nft":return D.collectionLink||"NFT коллекция";case"spot":return D.coin||"Спот";case"polymarket":return D.event||"Polymarket событие";case"staking":return D.coin||"Стейкинг";default:return"Сигнал"}},Ne=U=>{const D=H(U);switch(U.category){case"memecoins":return`${D.ticker||""} ${D.network?`• ${String(D.network).toUpperCase()}`:""}`.trim();case"futures":return`${D.direction==="long"?"Long":"Short"} • ${D.timeframe||""}`;case"nft":return`${D.marketplace||""}${D.network?` • ${String(D.network).toUpperCase()}`:""}`;case"spot":return D.holdingHorizon?`Горизонт: ${D.holdingHorizon}`:"";case"polymarket":return`${D.positionType==="yes"?"YES":"NO"} • ${D.entryPrice||""}`;case"staking":return`${D.platform||""}${D.term?` • ${D.term}`:""}`;default:return""}},Z=U=>U.riskLevel||H(U).riskLevel||H(U).protocolRisk||"medium",Re=U=>{const D=H(U);return[U.category,U.status,U.comment,D.coinName,D.ticker,D.pair,D.reason,D.targets,D.event,D.marketplace,D.platform,D.entryCap,D.entryZone,D.network].filter(Boolean).join(" ").toLowerCase()},J=e.filter(U=>ne!=="all"&&U.status!==ne||I!=="all"&&U.category!==I||b!=="all"&&Z(U)!==b||w!=="all"&&U.userId!==w?!1:T.trim()?Re(U).includes(T.toLowerCase()):!0),se=A.useMemo(()=>e.reduce((U,D)=>(U[D.category]||(U[D.category]={total:0,active:0}),U[D.category].total+=1,D.status==="active"&&(U[D.category].active+=1),U),{memecoins:{total:0,active:0},futures:{total:0,active:0},nft:{total:0,active:0},spot:{total:0,active:0},polymarket:{total:0,active:0},staking:{total:0,active:0}}),[e]),q=A.useMemo(()=>({total:e.length,active:e.filter(U=>U.status==="active").length,completed:e.filter(U=>U.status==="completed").length,highRisk:e.filter(U=>Z(U)==="high"||Z(U)==="ultra").length}),[e]),te=r==="dark"?"bg-gray-800 text-gray-200 border border-gray-700":"bg-white text-gray-700 border border-gray-200",ge="bg-gradient-to-r from-emerald-400 to-teal-500 text-white shadow-md shadow-emerald-300/30",W=(U,D,P)=>s.jsxs("div",{className:`p-4 rounded-xl border ${z} ${r==="dark"?"bg-gray-800/70":"bg-gray-50"}`,children:[s.jsx("p",{className:`text-xs uppercase tracking-wider ${F}`,children:U}),s.jsx("p",{className:`text-2xl font-bold ${P}`,children:D})]}),ue={low:"Низкий",medium:"Средний",high:"Высокий",ultra:"Ультра"},ze={flip:"Flip",short:"Короткий",medium:"Средний",long:"Длинный"},We={flexible:"Гибкий","30d":"30 дней","90d":"90 дней",fixed:"Фикс."},Pe={enter:"Вход",exit:"Выход",rebalance:"Ребаланс"},je={yes:"YES",no:"NO"},_e=(U,D=28)=>{if(!U)return"";if(U.length<=D)return U;const P=U.slice(0,Math.floor(D/2)),Y=U.slice(-6);return`${P}...${Y}`},Le=U=>U?U.includes("%")?U:`${U}%`:"",nt=U=>{if(!U)return"";const D=new Date(U);if(Number.isNaN(D.getTime()))return U;const P=new Date,Y=D.getTime()-P.getTime(),pe=D.toLocaleString("ru-RU",{day:"2-digit",month:"short",hour:"2-digit",minute:"2-digit"});if(Y<=0)return`${pe} (истек)`;const C=Math.max(0,Math.floor(Y/(1e3*60))),De=Math.floor(C/(60*24)),$=Math.floor(C%(60*24)/60),le=C%60,we=[De>0?`${De}д`:null,$>0?`${$}ч`:null,le>0?`${le}м`:null].filter(Boolean).slice(0,2).join(" ");return`${pe} (через ${we||"минуты"})`},et=U=>{const D=H(U),P=Z(U),Y=ee[U.category],pe=[],C=($,le,we,me)=>{le&&pe.push({label:$,value:le,icon:we,copyValue:me??le})};switch(U.category){case"memecoins":C("Монета",D.coinName,s.jsx(ur,{className:"w-4 h-4"})),C("Тикер",D.ticker,s.jsx(xp,{className:"w-4 h-4"}),D.ticker),C("Сеть",D.network?String(D.network).toUpperCase():"",s.jsx(fp,{className:"w-4 h-4"})),C("Контракт",_e(D.contract),s.jsx(hp,{className:"w-4 h-4"}),D.contract),C("Тип сигнала",D.signalType?D.signalType.toUpperCase():"",s.jsx(yo,{className:"w-4 h-4"})),C("Зона входа",D.entryCap,s.jsx(Ma,{className:"w-4 h-4"})),C("Цели",D.targets,s.jsx(Yr,{className:"w-4 h-4"})),C("SL",D.stopLoss,s.jsx(xo,{className:"w-4 h-4"})),C("План",ze[D.holdPlan]||D.holdPlan,s.jsx(On,{className:"w-4 h-4"})),C("Ликвидность",D.liquidityLocked?"Залочена":"",s.jsx(Lt,{className:"w-4 h-4"})),C("Риск",ue[P]||P,s.jsx(In,{className:"w-4 h-4"})),C("Риски",D.risks,s.jsx(zr,{className:"w-4 h-4"})),C("Комментарий",D.traderComment,s.jsx(Qr,{className:"w-4 h-4"})),C("Причина входа",D.reason,s.jsx(xs,{className:"w-4 h-4"}));break;case"futures":C("Пара",D.pair,s.jsx(th,{className:"w-4 h-4"}),D.pair),C("Направление",D.direction?D.direction.toUpperCase():"",s.jsx(Pr,{className:"w-4 h-4"})),C("Плечо",D.leverage,s.jsx(Vn,{className:"w-4 h-4"})),C("Зона входа",D.entryZone||D.entryPrice,s.jsx(Ma,{className:"w-4 h-4"})),C("Цели",D.targets,s.jsx(Yr,{className:"w-4 h-4"})),C("SL",D.stopLoss,s.jsx(xo,{className:"w-4 h-4"})),C("Стиль",D.signalStyle,s.jsx(yo,{className:"w-4 h-4"})),C("Размер позиции",D.positionSize,s.jsx(Oa,{className:"w-4 h-4"})),C("Таймфрейм",D.timeframe,s.jsx(ch,{className:"w-4 h-4"})),C("Риск",ue[P]||P,s.jsx(In,{className:"w-4 h-4"})),C("Риски",D.risks,s.jsx(zr,{className:"w-4 h-4"})),C("Причина входа",D.reason,s.jsx(xs,{className:"w-4 h-4"}));break;case"nft":C("Коллекция",_e(D.collectionLink),s.jsx(id,{className:"w-4 h-4"}),D.collectionLink),C("NFT",_e(D.nftLink),s.jsx(id,{className:"w-4 h-4"}),D.nftLink),C("Маркетплейс",D.marketplace,s.jsx(nd,{className:"w-4 h-4"})),C("Сеть",D.network?String(D.network).toUpperCase():"",s.jsx(Tp,{className:"w-4 h-4"})),C("Вход",D.entryPrice,s.jsx(Ma,{className:"w-4 h-4"})),C("Редкость",D.rarity,s.jsx(zt,{className:"w-4 h-4"})),C("Тип сигнала",D.signalType?D.signalType.toUpperCase():"",s.jsx(yo,{className:"w-4 h-4"})),C("Срок удержания",ze[D.holdingHorizon]||D.holdingHorizon,s.jsx(On,{className:"w-4 h-4"})),C("Мин. ликвидность",D.minLiquidity,s.jsx(Vn,{className:"w-4 h-4"})),C("Target",D.targetPrice,s.jsx(Yr,{className:"w-4 h-4"})),C("Риски",D.risks,s.jsx(zr,{className:"w-4 h-4"})),C("Комментарий",D.traderComment,s.jsx(Qr,{className:"w-4 h-4"})),C("Причина входа",D.reason,s.jsx(xs,{className:"w-4 h-4"}));break;case"spot":C("Монета",D.coin,s.jsx(ur,{className:"w-4 h-4"})),C("Зона входа",D.entryCap,s.jsx(Ma,{className:"w-4 h-4"})),C("Цели",D.targets,s.jsx(Yr,{className:"w-4 h-4"})),C("SL",D.stopLoss,s.jsx(xo,{className:"w-4 h-4"})),C("Горизонт",ze[D.holdingHorizon]||D.holdingHorizon,s.jsx(On,{className:"w-4 h-4"})),C("Размер",D.positionSize,s.jsx(Oa,{className:"w-4 h-4"})),C("Риск",D.riskLevel?ue[D.riskLevel]:void 0,s.jsx(In,{className:"w-4 h-4"})),C("Риски",D.risks,s.jsx(zr,{className:"w-4 h-4"})),C("Комментарий",D.traderComment,s.jsx(Qr,{className:"w-4 h-4"})),C("Причина входа",D.reason,s.jsx(xs,{className:"w-4 h-4"}));break;case"polymarket":const $=D.positionType;C("Событие",D.event,s.jsx(xs,{className:"w-4 h-4"})),C("Тип",$?je[$]:"",s.jsx(Lt,{className:"w-4 h-4"})),C("Вход %",Le(D.entryPrice),s.jsx(Oa,{className:"w-4 h-4"})),C("Ожидание %",Le(D.expectedProbability),s.jsx(Vn,{className:"w-4 h-4"})),C("Цель",D.targetPlan,s.jsx(Yr,{className:"w-4 h-4"})),C("Макс ставка",D.maxStake,s.jsx(ur,{className:"w-4 h-4"})),C("Срок исхода",nt(D.eventDeadline),s.jsx(Mo,{className:"w-4 h-4"})),C("Риск",ue[P]||P,s.jsx(In,{className:"w-4 h-4"})),C("Риски",D.risks,s.jsx(zr,{className:"w-4 h-4"})),C("Комментарий",D.traderComment,s.jsx(Qr,{className:"w-4 h-4"})),C("Причина входа",D.reason,s.jsx(xs,{className:"w-4 h-4"}));break;case"staking":C("Монета",D.coin,s.jsx(ur,{className:"w-4 h-4"})),C("Платформа",D.platform,s.jsx(nd,{className:"w-4 h-4"})),C("Срок",We[D.term]||D.term,s.jsx(Mo,{className:"w-4 h-4"})),C("APY",Le(D.apy),s.jsx(Oa,{className:"w-4 h-4"})),C("Мин. депозит",D.minDeposit,s.jsx(ur,{className:"w-4 h-4"})),C("Тип сигнала",Pe[D.action]||D.action,s.jsx(Lt,{className:"w-4 h-4"})),C("Риск протокола",D.protocolRisk?ue[D.protocolRisk]:void 0,s.jsx(In,{className:"w-4 h-4"})),C("Риски",D.risks,s.jsx(zr,{className:"w-4 h-4"})),C("Комментарий",D.traderComment,s.jsx(Qr,{className:"w-4 h-4"})),C("Причина входа",D.reason,s.jsx(xs,{className:"w-4 h-4"}));break}const De=pe.filter($=>$.value);return De.length?s.jsxs("div",{className:`rounded-2xl border ${z} ${r==="dark"?"bg-gray-900/60":"bg-white"}`,children:[s.jsxs("div",{className:`flex items-center gap-2 px-4 py-3 border-b ${z} ${r==="dark"?"bg-white/5":"bg-gray-50"}`,children:[s.jsx(zt,{className:"w-4 h-4 text-amber-500"}),s.jsx("p",{className:`text-sm font-semibold ${V}`,children:"Ключевые метрики"}),s.jsxs("span",{className:`ml-auto text-[11px] font-semibold px-3 py-1 rounded-full ${Mu[P]}`,children:["Риск: ",ue[P]||P]})]}),s.jsx("div",{className:"divide-y divide-gray-200/70 dark:divide-white/10",children:De.map($=>s.jsxs("div",{className:"flex items-center justify-between gap-3 px-4 py-3",children:[s.jsxs("div",{className:"flex items-start gap-3",children:[s.jsx("div",{className:`p-2 rounded-xl border ${Y.border} ${Y.bg} ${Y.text}`,children:$.icon}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsx("p",{className:`text-xs uppercase tracking-wide ${F}`,children:$.label}),s.jsx("p",{className:`${V} font-semibold whitespace-pre-wrap break-words`,children:$.value})]})]}),$.copyValue&&s.jsxs("button",{onClick:()=>Ce($.copyValue),className:`px-3 py-2 rounded-lg border ${z} ${r==="dark"?"hover:bg-gray-800 bg-white/5":"hover:bg-gray-100 bg-white"} text-xs font-semibold flex items-center gap-2 shrink-0`,children:[L===$.copyValue?s.jsx(Dr,{className:"w-4 h-4 text-emerald-500"}):s.jsx(oi,{className:"w-4 h-4"}),L===$.copyValue?"Скопировано":"Копировать"]})]},$.label))})]}):null};return s.jsx(ir,{children:s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:`relative overflow-hidden rounded-2xl p-6 sm:p-7 md:p-8 border-2 shadow-2xl ${r==="dark"?"bg-gradient-to-br from-[#151c2a] via-[#0f1623] to-[#0a101b] border-[#4E6E49]/35":"bg-gradient-to-br from-white via-emerald-50/25 to-white border-emerald-200"}`,children:[s.jsxs("div",{className:"absolute inset-0 pointer-events-none",children:[s.jsx("div",{className:"absolute -top-24 -left-16 w-64 h-64 bg-gradient-to-br from-[#4E6E49]/18 via-transparent to-transparent blur-3xl"}),s.jsx("div",{className:"absolute top-0 right-0 w-72 h-72 bg-gradient-to-bl from-sky-400/14 via-emerald-400/12 to-transparent blur-3xl"}),s.jsx("div",{className:"absolute bottom-[-120px] left-12 w-64 h-64 bg-gradient-to-tr from-amber-300/14 via-[#4E6E49]/12 to-transparent blur-3xl"})]}),s.jsxs("div",{className:"relative z-10 flex flex-col gap-4 lg:flex-row lg:items-center lg:justify-between",children:[s.jsx("div",{className:"space-y-3",children:s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"p-3 rounded-2xl bg-gradient-to-br from-[#4E6E49] via-emerald-500 to-sky-500 text-white shadow-lg shadow-emerald-500/30",children:s.jsx(ci,{className:"w-6 h-6"})}),s.jsx("div",{className:"flex flex-col justify-center",children:s.jsx("h1",{className:"text-2xl sm:text-3xl font-extrabold text-white drop-shadow-lg leading-tight",children:"Signals HUB"})})]})}),s.jsx("div",{className:"flex flex-wrap items-center gap-3"})]})]}),s.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-3 gap-4",children:Object.keys(Sn).map(U=>{const D=Sn[U],P=se[U],Y=ee[U];return s.jsxs("button",{onClick:()=>{k(U),j(null),l(!0)},className:`p-4 rounded-xl border ${Y.border} ${Y.bg} text-left shadow-sm hover:shadow-lg transition-all hover:-translate-y-0.5 space-y-2`,children:[s.jsxs("div",{className:"flex items-start justify-between gap-3",children:[s.jsxs("div",{className:`flex items-center gap-2 px-3 py-1 rounded-full text-[11px] font-semibold border border-transparent ${Y.text}`,children:[D.icon,s.jsx("span",{children:D.label})]}),s.jsx("span",{className:`px-3 py-1 rounded-full text-[11px] font-semibold border ${Y.border} ${Y.text} ${r==="dark"?"bg-white/5":"bg-white/80"}`,children:"Добавить"})]}),s.jsxs("div",{children:[s.jsx("p",{className:`text-2xl font-extrabold ${V}`,children:(P==null?void 0:P.total)||0}),s.jsxs("p",{className:`text-xs ${F}`,children:["Всего сигналов • Активных ",(P==null?void 0:P.active)||0]})]})]},U)})}),s.jsx("div",{className:`rounded-2xl border ${z} ${r==="dark"?"bg-gray-900/70":"bg-white"} p-5 space-y-4`,children:s.jsxs("div",{className:"flex flex-col gap-3",children:[s.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[s.jsxs("div",{className:"flex items-center gap-2 text-sm font-semibold",children:[s.jsx(rh,{className:`w-4 h-4 ${F}`}),s.jsx("span",{className:V,children:"Фильтры"})]}),s.jsx("div",{className:"flex flex-wrap gap-2",children:Object.keys(Ha).map(U=>s.jsx("button",{onClick:()=>ie(U),className:`px-3 py-1.5 rounded-xl text-sm font-semibold transition-all ${ne===U?ge:te}`,children:Ha[U].label},U))})]}),s.jsxs("div",{className:"flex flex-col gap-2",children:[s.jsxs("label",{className:`text-xs uppercase tracking-wider ${F} flex items-center gap-2`,children:[s.jsx(Dp,{className:"w-4 h-4"}),"Поиск по всем сферам ",s.jsxs("span",{className:"text-[11px] text-gray-500 dark:text-gray-400",children:[J.length,"/",e.length]})]}),s.jsx("input",{value:T,onChange:U=>O(U.target.value),placeholder:"тикер, событие, сеть, причина...",className:`w-full px-3 py-2 rounded-xl border ${z} ${r==="dark"?"bg-gray-800":"bg-gray-50"} ${V} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]/60`})]}),s.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[s.jsx("span",{className:`text-xs ${F} uppercase tracking-wider`,children:"Сфера:"}),s.jsx("button",{onClick:()=>N("all"),className:`px-3 py-1.5 rounded-full text-sm font-semibold border ${I==="all"?ge:te}`,children:"Все"}),Object.keys(Sn).map(U=>s.jsx("button",{onClick:()=>N(I===U?"all":U),className:`px-3 py-1.5 rounded-full text-sm font-semibold border ${I===U?ge:te}`,children:Sn[U].label},U))]}),s.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[s.jsx("span",{className:`text-xs ${F} uppercase tracking-wider`,children:"Риск:"}),["all","low","medium","high","ultra"].map(U=>s.jsx("button",{onClick:()=>f(U),className:`px-3 py-1.5 rounded-full text-sm font-semibold border ${b===U?ge:te}`,children:U==="all"?"Все":U},U))]}),s.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[s.jsx("span",{className:`text-xs ${F} uppercase tracking-wider`,children:"Трейдер:"}),s.jsxs("select",{value:w,onChange:U=>_(U.target.value),className:`px-3 py-2 rounded-lg border ${z} ${r==="dark"?"bg-gray-800 text-white":"bg-gray-50 text-gray-900"} text-sm focus:outline-none focus:ring-2 focus:ring-emerald-500/50`,children:[s.jsx("option",{value:"all",children:"Все трейдеры"}),Ee.map(U=>s.jsx("option",{value:U.id,children:U.name},U.id))]})]}),s.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:[W("Всего сигналов",q.total,V),W("Активных",q.active,"text-emerald-500"),W("Завершено",q.completed,"text-blue-500"),W("High risk",q.highRisk,"text-amber-500")]})]})}),i&&s.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-[70] flex items-start sm:items-center justify-center p-4 overflow-y-auto",children:s.jsx("div",{className:`${G} rounded-2xl shadow-2xl border ${z} max-w-3xl w-full max-h-[90vh] overflow-hidden`,children:s.jsxs("div",{className:"flex flex-col h-full",children:[s.jsxs("div",{className:`p-6 flex items-center justify-between sticky top-0 z-20 ${G} border-b ${z} shadow-sm`,children:[s.jsx("h2",{className:`text-2xl font-bold ${V}`,children:E?"Редактировать сигнал":"Создать сигнал"}),s.jsx("button",{onClick:oe,className:`p-2 rounded-xl ${r==="dark"?"hover:bg-gray-800":"hover:bg-gray-100"}`,children:s.jsx(Qt,{className:`w-5 h-5 ${F}`})})]}),s.jsx("div",{className:"px-6 pb-6 pt-2 overflow-y-auto flex-1 max-h-[75vh]",children:s.jsx(x2,{callToEdit:E,onSuccess:re,onCancel:oe,initialCategory:S})})]})})}),c&&s.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-[70] flex items-start sm:items-center justify-center p-4 overflow-y-auto overscroll-contain",children:s.jsx("div",{className:`${G} rounded-2xl shadow-2xl border ${z} max-w-md w-full`,children:s.jsxs("div",{className:"p-6 space-y-4",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx(zr,{className:"w-6 h-6 text-red-500"}),s.jsxs("div",{children:[s.jsx("h3",{className:`text-xl font-bold ${V}`,children:"Удалить сигнал?"}),s.jsx("p",{className:F,children:"Это действие нельзя отменить"})]})]}),s.jsxs("div",{className:"flex gap-3",children:[s.jsx("button",{onClick:()=>{d(!1),g(null)},className:`flex-1 px-4 py-3 rounded-xl border ${z} ${r==="dark"?"text-white":"text-gray-800"}`,children:"Отмена"}),s.jsx("button",{onClick:K,className:"flex-1 px-4 py-3 rounded-xl bg-red-600 text-white font-semibold hover:bg-red-700",children:"Удалить"})]})]})})}),x&&s.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-[70] flex items-start sm:items-center justify-center p-4 overflow-y-auto overscroll-contain",children:s.jsx("div",{className:`${G} rounded-2xl shadow-2xl border ${z} max-w-md w-full`,children:s.jsxs("div",{className:"p-6 space-y-4",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx(zr,{className:"w-6 h-6 text-amber-500"}),s.jsxs("div",{children:[s.jsx("h3",{className:`text-xl font-bold ${V}`,children:"Отменить сигнал?"}),s.jsx("p",{className:F,children:"Статус станет «Отменен», запись останется в списке."})]})]}),s.jsxs("div",{className:"flex gap-3",children:[s.jsx("button",{onClick:()=>p(null),className:`flex-1 px-4 py-3 rounded-xl border ${z} ${r==="dark"?"text-white":"text-gray-800"}`,children:"Отмена"}),s.jsx("button",{onClick:he,className:"flex-1 px-4 py-3 rounded-xl bg-amber-500 text-white font-semibold hover:bg-amber-600",children:"Отменить"})]})]})})}),!i&&s.jsx(s.Fragment,{children:n?s.jsxs("div",{className:`${G} rounded-2xl p-12 text-center ${z} border shadow-xl`,children:[s.jsx("div",{className:"animate-spin rounded-full h-14 w-14 border-4 border-[#4E6E49] border-t-transparent mx-auto mb-4"}),s.jsx("p",{className:`${F} text-lg`,children:"Загрузка сигналов..."})]}):e.length===0?s.jsxs("div",{className:`${G} rounded-2xl p-12 text-center ${z} border shadow-xl`,children:[s.jsx(zt,{className:`w-16 h-16 mx-auto mb-4 ${F}`}),s.jsx("p",{className:`text-xl font-bold ${V}`,children:"Пока пусто"}),s.jsx("p",{className:F,children:"Создайте первый сигнал в новой структуре"})]}):J.length===0?s.jsxs("div",{className:`${G} rounded-2xl p-12 text-center ${z} border shadow-xl`,children:[s.jsx(zt,{className:`w-16 h-16 mx-auto mb-4 ${F}`}),s.jsx("p",{className:`text-xl font-bold ${V}`,children:"Нет совпадений"}),s.jsxs("p",{className:F,children:["Сигналы есть (",e.length,"), но фильтр ничего не нашел."]})]}):s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-5",children:J.map(U=>{const D=Sn[U.category],P=Ha[U.status]||Ha.active,Y=Z(U),pe=H(U),C=Ee.find(we=>we.id===U.userId),De=pe.ticker||pe.pair||pe.coin||Se(U),$=new Date(U.createdAt).toLocaleDateString("ru-RU",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"}),le=ee[U.category];return s.jsxs("div",{className:`rounded-3xl border-2 shadow-xl overflow-hidden transition-all hover:-translate-y-1 ${le.border} ${le.bg}`,children:[s.jsxs("div",{className:`px-5 py-4 flex flex-wrap items-center justify-between gap-3 border-b ${r==="dark"?"border-white/10 bg-white/5":"border-white/70 bg-white/70"}`,children:[s.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[s.jsxs("span",{className:`flex items-center gap-2 px-3 py-1.5 rounded-full text-sm font-semibold border ${le.border} ${le.chipBg||""} ${le.text}`,children:[D.icon,D.label]}),s.jsx("span",{className:`px-3 py-1.5 rounded-full text-xs font-semibold ${P.className}`,children:P.label}),s.jsxs("span",{className:`px-3 py-1.5 rounded-full text-xs font-semibold ${Mu[Y]}`,children:["Риск: ",Y]})]}),s.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[s.jsxs("div",{className:`px-3 py-1.5 rounded-xl text-xs font-semibold border ${r==="dark"?"bg-gray-800/70 text-gray-200 border-white/10":"bg-white text-gray-700 border-gray-200"}`,children:[s.jsx("span",{className:"opacity-70",children:"Создано "}),$]}),C&&s.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 rounded-xl border border-white/10 bg-black/5 dark:bg-white/5",children:[s.jsx("div",{className:"w-8 h-8 rounded-full bg-gradient-to-r from-[#4E6E49] to-emerald-600 text-white flex items-center justify-center text-sm font-bold",children:C.name[0]}),s.jsx("span",{className:`text-xs ${F}`,children:C.name})]}),s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx("button",{onClick:()=>ke(U),className:`p-2 rounded-lg ${r==="dark"?"hover:bg-gray-800":"hover:bg-gray-100"}`,children:s.jsx(Gt,{className:"w-4 h-4"})}),U.status!=="cancelled"&&s.jsx("button",{onClick:()=>p(U.id),className:`p-2 rounded-lg ${r==="dark"?"hover:bg-gray-800":"hover:bg-gray-100"}`,children:s.jsx(Qt,{className:"w-4 h-4 text-amber-500"})}),s.jsx("button",{onClick:()=>ye(U.id),className:`p-2 rounded-lg ${r==="dark"?"hover:bg-gray-800":"hover:bg-gray-100"}`,children:s.jsx(At,{className:"w-4 h-4 text-red-500"})})]})]})]}),s.jsxs("div",{className:"p-5 space-y-5",children:[s.jsxs("div",{className:"grid md:grid-cols-[1.15fr_auto] gap-4 items-start",children:[s.jsxs("div",{className:"space-y-1",children:[s.jsx("p",{className:`text-2xl font-bold ${V}`,children:Se(U)}),s.jsx("p",{className:`text-sm ${F}`,children:Ne(U)})]}),s.jsx("div",{className:"flex flex-wrap gap-2 justify-end",children:s.jsxs("button",{onClick:()=>Ce(De),className:`px-3 py-2 rounded-xl border ${z} ${r==="dark"?"hover:bg-gray-800 bg-white/5":"hover:bg-gray-100 bg-white"} text-sm font-semibold flex items-center gap-2`,children:[L===De?s.jsx(Dr,{className:"w-4 h-4 text-emerald-500"}):s.jsx(oi,{className:"w-4 h-4"}),L===De?"Скопировано":"Скопировать"]})})]}),et(U)]})]},U.id)})})})]})})};function Si(r){"@babel/helpers - typeof";return Si=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Si(r)}function _r(r){if(r===null||r===!0||r===!1)return NaN;var e=Number(r);return isNaN(e)?e:e<0?Math.ceil(e):Math.floor(e)}function gt(r,e){if(e.length<r)throw new TypeError(r+" argument"+(r>1?"s":"")+" required, but only "+e.length+" present")}function Et(r){gt(1,arguments);var e=Object.prototype.toString.call(r);return r instanceof Date||Si(r)==="object"&&e==="[object Date]"?new Date(r.getTime()):typeof r=="number"||e==="[object Number]"?new Date(r):((typeof r=="string"||e==="[object String]")&&typeof console<"u"&&(console.warn("Starting with v2.0.0-beta.1 date-fns doesn't accept strings as date arguments. Please use `parseISO` to parse strings. See: https://github.com/date-fns/date-fns/blob/master/docs/upgradeGuide.md#string-arguments"),console.warn(new Error().stack)),new Date(NaN))}function w2(r,e){gt(2,arguments);var t=Et(r).getTime(),n=_r(e);return new Date(t+n)}var _2={};function yn(){return _2}function k2(r,e){var t,n,a,i,l,c,d,h;gt(1,arguments);var g=yn(),x=_r((t=(n=(a=(i=e==null?void 0:e.weekStartsOn)!==null&&i!==void 0?i:e==null||(l=e.locale)===null||l===void 0||(c=l.options)===null||c===void 0?void 0:c.weekStartsOn)!==null&&a!==void 0?a:g.weekStartsOn)!==null&&n!==void 0?n:(d=g.locale)===null||d===void 0||(h=d.options)===null||h===void 0?void 0:h.weekStartsOn)!==null&&t!==void 0?t:0);if(!(x>=0&&x<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");var p=Et(r),E=p.getDay(),j=(E<x?7:0)+E-x;return p.setDate(p.getDate()-j),p.setHours(0,0,0,0),p}function N2(r){var e=new Date(Date.UTC(r.getFullYear(),r.getMonth(),r.getDate(),r.getHours(),r.getMinutes(),r.getSeconds(),r.getMilliseconds()));return e.setUTCFullYear(r.getFullYear()),r.getTime()-e.getTime()}function Ou(r){gt(1,arguments);var e=Et(r);return e.setHours(0,0,0,0),e}var Rg=6e4,Dg=36e5;function E2(r,e){gt(2,arguments);var t=Ou(r),n=Ou(e);return t.getTime()===n.getTime()}function j2(r){return gt(1,arguments),r instanceof Date||Si(r)==="object"&&Object.prototype.toString.call(r)==="[object Date]"}function I2(r){if(gt(1,arguments),!j2(r)&&typeof r!="number")return!1;var e=Et(r);return!isNaN(Number(e))}function T2(r,e){var t;gt(1,arguments);var n=r||{},a=Et(n.start),i=Et(n.end),l=i.getTime();if(!(a.getTime()<=l))throw new RangeError("Invalid interval");var c=[],d=a;d.setHours(0,0,0,0);var h=Number((t=void 0)!==null&&t!==void 0?t:1);if(h<1||isNaN(h))throw new RangeError("`options.step` must be a number greater than 1");for(;d.getTime()<=l;)c.push(Et(d)),d.setDate(d.getDate()+h),d.setHours(0,0,0,0);return c}function S2(r,e){var t,n,a,i,l,c,d,h;gt(1,arguments);var g=yn(),x=_r((t=(n=(a=(i=e==null?void 0:e.weekStartsOn)!==null&&i!==void 0?i:e==null||(l=e.locale)===null||l===void 0||(c=l.options)===null||c===void 0?void 0:c.weekStartsOn)!==null&&a!==void 0?a:g.weekStartsOn)!==null&&n!==void 0?n:(d=g.locale)===null||d===void 0||(h=d.options)===null||h===void 0?void 0:h.weekStartsOn)!==null&&t!==void 0?t:0);if(!(x>=0&&x<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");var p=Et(r),E=p.getDay(),j=(E<x?-7:0)+6-(E-x);return p.setDate(p.getDate()+j),p.setHours(23,59,59,999),p}function A2(r,e){gt(2,arguments);var t=_r(e);return w2(r,-t)}var C2=864e5;function R2(r){gt(1,arguments);var e=Et(r),t=e.getTime();e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0);var n=e.getTime(),a=t-n;return Math.floor(a/C2)+1}function Ai(r){gt(1,arguments);var e=1,t=Et(r),n=t.getUTCDay(),a=(n<e?7:0)+n-e;return t.setUTCDate(t.getUTCDate()-a),t.setUTCHours(0,0,0,0),t}function Pg(r){gt(1,arguments);var e=Et(r),t=e.getUTCFullYear(),n=new Date(0);n.setUTCFullYear(t+1,0,4),n.setUTCHours(0,0,0,0);var a=Ai(n),i=new Date(0);i.setUTCFullYear(t,0,4),i.setUTCHours(0,0,0,0);var l=Ai(i);return e.getTime()>=a.getTime()?t+1:e.getTime()>=l.getTime()?t:t-1}function D2(r){gt(1,arguments);var e=Pg(r),t=new Date(0);t.setUTCFullYear(e,0,4),t.setUTCHours(0,0,0,0);var n=Ai(t);return n}var P2=6048e5;function $2(r){gt(1,arguments);var e=Et(r),t=Ai(e).getTime()-D2(e).getTime();return Math.round(t/P2)+1}function un(r,e){var t,n,a,i,l,c,d,h;gt(1,arguments);var g=yn(),x=_r((t=(n=(a=(i=e==null?void 0:e.weekStartsOn)!==null&&i!==void 0?i:e==null||(l=e.locale)===null||l===void 0||(c=l.options)===null||c===void 0?void 0:c.weekStartsOn)!==null&&a!==void 0?a:g.weekStartsOn)!==null&&n!==void 0?n:(d=g.locale)===null||d===void 0||(h=d.options)===null||h===void 0?void 0:h.weekStartsOn)!==null&&t!==void 0?t:0);if(!(x>=0&&x<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");var p=Et(r),E=p.getUTCDay(),j=(E<x?7:0)+E-x;return p.setUTCDate(p.getUTCDate()-j),p.setUTCHours(0,0,0,0),p}function $g(r,e){var t,n,a,i,l,c,d,h;gt(1,arguments);var g=Et(r),x=g.getUTCFullYear(),p=yn(),E=_r((t=(n=(a=(i=e==null?void 0:e.firstWeekContainsDate)!==null&&i!==void 0?i:e==null||(l=e.locale)===null||l===void 0||(c=l.options)===null||c===void 0?void 0:c.firstWeekContainsDate)!==null&&a!==void 0?a:p.firstWeekContainsDate)!==null&&n!==void 0?n:(d=p.locale)===null||d===void 0||(h=d.options)===null||h===void 0?void 0:h.firstWeekContainsDate)!==null&&t!==void 0?t:1);if(!(E>=1&&E<=7))throw new RangeError("firstWeekContainsDate must be between 1 and 7 inclusively");var j=new Date(0);j.setUTCFullYear(x+1,0,E),j.setUTCHours(0,0,0,0);var S=un(j,e),k=new Date(0);k.setUTCFullYear(x,0,E),k.setUTCHours(0,0,0,0);var L=un(k,e);return g.getTime()>=S.getTime()?x+1:g.getTime()>=L.getTime()?x:x-1}function M2(r,e){var t,n,a,i,l,c,d,h;gt(1,arguments);var g=yn(),x=_r((t=(n=(a=(i=e==null?void 0:e.firstWeekContainsDate)!==null&&i!==void 0?i:e==null||(l=e.locale)===null||l===void 0||(c=l.options)===null||c===void 0?void 0:c.firstWeekContainsDate)!==null&&a!==void 0?a:g.firstWeekContainsDate)!==null&&n!==void 0?n:(d=g.locale)===null||d===void 0||(h=d.options)===null||h===void 0?void 0:h.firstWeekContainsDate)!==null&&t!==void 0?t:1),p=$g(r,e),E=new Date(0);E.setUTCFullYear(p,0,x),E.setUTCHours(0,0,0,0);var j=un(E,e);return j}var O2=6048e5;function V2(r,e){gt(1,arguments);var t=Et(r),n=un(t,e).getTime()-M2(t,e).getTime();return Math.round(n/O2)+1}function it(r,e){for(var t=r<0?"-":"",n=Math.abs(r).toString();n.length<e;)n="0"+n;return t+n}var Gr={y:function(e,t){var n=e.getUTCFullYear(),a=n>0?n:1-n;return it(t==="yy"?a%100:a,t.length)},M:function(e,t){var n=e.getUTCMonth();return t==="M"?String(n+1):it(n+1,2)},d:function(e,t){return it(e.getUTCDate(),t.length)},a:function(e,t){var n=e.getUTCHours()/12>=1?"pm":"am";switch(t){case"a":case"aa":return n.toUpperCase();case"aaa":return n;case"aaaaa":return n[0];case"aaaa":default:return n==="am"?"a.m.":"p.m."}},h:function(e,t){return it(e.getUTCHours()%12||12,t.length)},H:function(e,t){return it(e.getUTCHours(),t.length)},m:function(e,t){return it(e.getUTCMinutes(),t.length)},s:function(e,t){return it(e.getUTCSeconds(),t.length)},S:function(e,t){var n=t.length,a=e.getUTCMilliseconds(),i=Math.floor(a*Math.pow(10,n-3));return it(i,t.length)}},Bs={midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},L2={G:function(e,t,n){var a=e.getUTCFullYear()>0?1:0;switch(t){case"G":case"GG":case"GGG":return n.era(a,{width:"abbreviated"});case"GGGGG":return n.era(a,{width:"narrow"});case"GGGG":default:return n.era(a,{width:"wide"})}},y:function(e,t,n){if(t==="yo"){var a=e.getUTCFullYear(),i=a>0?a:1-a;return n.ordinalNumber(i,{unit:"year"})}return Gr.y(e,t)},Y:function(e,t,n,a){var i=$g(e,a),l=i>0?i:1-i;if(t==="YY"){var c=l%100;return it(c,2)}return t==="Yo"?n.ordinalNumber(l,{unit:"year"}):it(l,t.length)},R:function(e,t){var n=Pg(e);return it(n,t.length)},u:function(e,t){var n=e.getUTCFullYear();return it(n,t.length)},Q:function(e,t,n){var a=Math.ceil((e.getUTCMonth()+1)/3);switch(t){case"Q":return String(a);case"QQ":return it(a,2);case"Qo":return n.ordinalNumber(a,{unit:"quarter"});case"QQQ":return n.quarter(a,{width:"abbreviated",context:"formatting"});case"QQQQQ":return n.quarter(a,{width:"narrow",context:"formatting"});case"QQQQ":default:return n.quarter(a,{width:"wide",context:"formatting"})}},q:function(e,t,n){var a=Math.ceil((e.getUTCMonth()+1)/3);switch(t){case"q":return String(a);case"qq":return it(a,2);case"qo":return n.ordinalNumber(a,{unit:"quarter"});case"qqq":return n.quarter(a,{width:"abbreviated",context:"standalone"});case"qqqqq":return n.quarter(a,{width:"narrow",context:"standalone"});case"qqqq":default:return n.quarter(a,{width:"wide",context:"standalone"})}},M:function(e,t,n){var a=e.getUTCMonth();switch(t){case"M":case"MM":return Gr.M(e,t);case"Mo":return n.ordinalNumber(a+1,{unit:"month"});case"MMM":return n.month(a,{width:"abbreviated",context:"formatting"});case"MMMMM":return n.month(a,{width:"narrow",context:"formatting"});case"MMMM":default:return n.month(a,{width:"wide",context:"formatting"})}},L:function(e,t,n){var a=e.getUTCMonth();switch(t){case"L":return String(a+1);case"LL":return it(a+1,2);case"Lo":return n.ordinalNumber(a+1,{unit:"month"});case"LLL":return n.month(a,{width:"abbreviated",context:"standalone"});case"LLLLL":return n.month(a,{width:"narrow",context:"standalone"});case"LLLL":default:return n.month(a,{width:"wide",context:"standalone"})}},w:function(e,t,n,a){var i=V2(e,a);return t==="wo"?n.ordinalNumber(i,{unit:"week"}):it(i,t.length)},I:function(e,t,n){var a=$2(e);return t==="Io"?n.ordinalNumber(a,{unit:"week"}):it(a,t.length)},d:function(e,t,n){return t==="do"?n.ordinalNumber(e.getUTCDate(),{unit:"date"}):Gr.d(e,t)},D:function(e,t,n){var a=R2(e);return t==="Do"?n.ordinalNumber(a,{unit:"dayOfYear"}):it(a,t.length)},E:function(e,t,n){var a=e.getUTCDay();switch(t){case"E":case"EE":case"EEE":return n.day(a,{width:"abbreviated",context:"formatting"});case"EEEEE":return n.day(a,{width:"narrow",context:"formatting"});case"EEEEEE":return n.day(a,{width:"short",context:"formatting"});case"EEEE":default:return n.day(a,{width:"wide",context:"formatting"})}},e:function(e,t,n,a){var i=e.getUTCDay(),l=(i-a.weekStartsOn+8)%7||7;switch(t){case"e":return String(l);case"ee":return it(l,2);case"eo":return n.ordinalNumber(l,{unit:"day"});case"eee":return n.day(i,{width:"abbreviated",context:"formatting"});case"eeeee":return n.day(i,{width:"narrow",context:"formatting"});case"eeeeee":return n.day(i,{width:"short",context:"formatting"});case"eeee":default:return n.day(i,{width:"wide",context:"formatting"})}},c:function(e,t,n,a){var i=e.getUTCDay(),l=(i-a.weekStartsOn+8)%7||7;switch(t){case"c":return String(l);case"cc":return it(l,t.length);case"co":return n.ordinalNumber(l,{unit:"day"});case"ccc":return n.day(i,{width:"abbreviated",context:"standalone"});case"ccccc":return n.day(i,{width:"narrow",context:"standalone"});case"cccccc":return n.day(i,{width:"short",context:"standalone"});case"cccc":default:return n.day(i,{width:"wide",context:"standalone"})}},i:function(e,t,n){var a=e.getUTCDay(),i=a===0?7:a;switch(t){case"i":return String(i);case"ii":return it(i,t.length);case"io":return n.ordinalNumber(i,{unit:"day"});case"iii":return n.day(a,{width:"abbreviated",context:"formatting"});case"iiiii":return n.day(a,{width:"narrow",context:"formatting"});case"iiiiii":return n.day(a,{width:"short",context:"formatting"});case"iiii":default:return n.day(a,{width:"wide",context:"formatting"})}},a:function(e,t,n){var a=e.getUTCHours(),i=a/12>=1?"pm":"am";switch(t){case"a":case"aa":return n.dayPeriod(i,{width:"abbreviated",context:"formatting"});case"aaa":return n.dayPeriod(i,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return n.dayPeriod(i,{width:"narrow",context:"formatting"});case"aaaa":default:return n.dayPeriod(i,{width:"wide",context:"formatting"})}},b:function(e,t,n){var a=e.getUTCHours(),i;switch(a===12?i=Bs.noon:a===0?i=Bs.midnight:i=a/12>=1?"pm":"am",t){case"b":case"bb":return n.dayPeriod(i,{width:"abbreviated",context:"formatting"});case"bbb":return n.dayPeriod(i,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return n.dayPeriod(i,{width:"narrow",context:"formatting"});case"bbbb":default:return n.dayPeriod(i,{width:"wide",context:"formatting"})}},B:function(e,t,n){var a=e.getUTCHours(),i;switch(a>=17?i=Bs.evening:a>=12?i=Bs.afternoon:a>=4?i=Bs.morning:i=Bs.night,t){case"B":case"BB":case"BBB":return n.dayPeriod(i,{width:"abbreviated",context:"formatting"});case"BBBBB":return n.dayPeriod(i,{width:"narrow",context:"formatting"});case"BBBB":default:return n.dayPeriod(i,{width:"wide",context:"formatting"})}},h:function(e,t,n){if(t==="ho"){var a=e.getUTCHours()%12;return a===0&&(a=12),n.ordinalNumber(a,{unit:"hour"})}return Gr.h(e,t)},H:function(e,t,n){return t==="Ho"?n.ordinalNumber(e.getUTCHours(),{unit:"hour"}):Gr.H(e,t)},K:function(e,t,n){var a=e.getUTCHours()%12;return t==="Ko"?n.ordinalNumber(a,{unit:"hour"}):it(a,t.length)},k:function(e,t,n){var a=e.getUTCHours();return a===0&&(a=24),t==="ko"?n.ordinalNumber(a,{unit:"hour"}):it(a,t.length)},m:function(e,t,n){return t==="mo"?n.ordinalNumber(e.getUTCMinutes(),{unit:"minute"}):Gr.m(e,t)},s:function(e,t,n){return t==="so"?n.ordinalNumber(e.getUTCSeconds(),{unit:"second"}):Gr.s(e,t)},S:function(e,t){return Gr.S(e,t)},X:function(e,t,n,a){var i=a._originalDate||e,l=i.getTimezoneOffset();if(l===0)return"Z";switch(t){case"X":return Lu(l);case"XXXX":case"XX":return bs(l);case"XXXXX":case"XXX":default:return bs(l,":")}},x:function(e,t,n,a){var i=a._originalDate||e,l=i.getTimezoneOffset();switch(t){case"x":return Lu(l);case"xxxx":case"xx":return bs(l);case"xxxxx":case"xxx":default:return bs(l,":")}},O:function(e,t,n,a){var i=a._originalDate||e,l=i.getTimezoneOffset();switch(t){case"O":case"OO":case"OOO":return"GMT"+Vu(l,":");case"OOOO":default:return"GMT"+bs(l,":")}},z:function(e,t,n,a){var i=a._originalDate||e,l=i.getTimezoneOffset();switch(t){case"z":case"zz":case"zzz":return"GMT"+Vu(l,":");case"zzzz":default:return"GMT"+bs(l,":")}},t:function(e,t,n,a){var i=a._originalDate||e,l=Math.floor(i.getTime()/1e3);return it(l,t.length)},T:function(e,t,n,a){var i=a._originalDate||e,l=i.getTime();return it(l,t.length)}};function Vu(r,e){var t=r>0?"-":"+",n=Math.abs(r),a=Math.floor(n/60),i=n%60;if(i===0)return t+String(a);var l=e;return t+String(a)+l+it(i,2)}function Lu(r,e){if(r%60===0){var t=r>0?"-":"+";return t+it(Math.abs(r)/60,2)}return bs(r,e)}function bs(r,e){var t=e||"",n=r>0?"-":"+",a=Math.abs(r),i=it(Math.floor(a/60),2),l=it(a%60,2);return n+i+t+l}var Fu=function(e,t){switch(e){case"P":return t.date({width:"short"});case"PP":return t.date({width:"medium"});case"PPP":return t.date({width:"long"});case"PPPP":default:return t.date({width:"full"})}},Mg=function(e,t){switch(e){case"p":return t.time({width:"short"});case"pp":return t.time({width:"medium"});case"ppp":return t.time({width:"long"});case"pppp":default:return t.time({width:"full"})}},F2=function(e,t){var n=e.match(/(P+)(p+)?/)||[],a=n[1],i=n[2];if(!i)return Fu(e,t);var l;switch(a){case"P":l=t.dateTime({width:"short"});break;case"PP":l=t.dateTime({width:"medium"});break;case"PPP":l=t.dateTime({width:"long"});break;case"PPPP":default:l=t.dateTime({width:"full"});break}return l.replace("{{date}}",Fu(a,t)).replace("{{time}}",Mg(i,t))},U2={p:Mg,P:F2},B2=["D","DD"],q2=["YY","YYYY"];function W2(r){return B2.indexOf(r)!==-1}function z2(r){return q2.indexOf(r)!==-1}function Uu(r,e,t){if(r==="YYYY")throw new RangeError("Use `yyyy` instead of `YYYY` (in `".concat(e,"`) for formatting years to the input `").concat(t,"`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md"));if(r==="YY")throw new RangeError("Use `yy` instead of `YY` (in `".concat(e,"`) for formatting years to the input `").concat(t,"`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md"));if(r==="D")throw new RangeError("Use `d` instead of `D` (in `".concat(e,"`) for formatting days of the month to the input `").concat(t,"`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md"));if(r==="DD")throw new RangeError("Use `dd` instead of `DD` (in `".concat(e,"`) for formatting days of the month to the input `").concat(t,"`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md"))}var H2={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},G2=function(e,t,n){var a,i=H2[e];return typeof i=="string"?a=i:t===1?a=i.one:a=i.other.replace("{{count}}",t.toString()),n!=null&&n.addSuffix?n.comparison&&n.comparison>0?"in "+a:a+" ago":a};function Xs(r){return function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=e.width?String(e.width):r.defaultWidth,n=r.formats[t]||r.formats[r.defaultWidth];return n}}var K2={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},Q2={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},Y2={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},X2={date:Xs({formats:K2,defaultWidth:"full"}),time:Xs({formats:Q2,defaultWidth:"full"}),dateTime:Xs({formats:Y2,defaultWidth:"full"})},J2={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},Z2=function(e,t,n,a){return J2[e]};function hr(r){return function(e,t){var n=t!=null&&t.context?String(t.context):"standalone",a;if(n==="formatting"&&r.formattingValues){var i=r.defaultFormattingWidth||r.defaultWidth,l=t!=null&&t.width?String(t.width):i;a=r.formattingValues[l]||r.formattingValues[i]}else{var c=r.defaultWidth,d=t!=null&&t.width?String(t.width):r.defaultWidth;a=r.values[d]||r.values[c]}var h=r.argumentCallback?r.argumentCallback(e):e;return a[h]}}var e_={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},t_={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},r_={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},s_={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},n_={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},a_={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},i_=function(e,t){var n=Number(e),a=n%100;if(a>20||a<10)switch(a%10){case 1:return n+"st";case 2:return n+"nd";case 3:return n+"rd"}return n+"th"},o_={ordinalNumber:i_,era:hr({values:e_,defaultWidth:"wide"}),quarter:hr({values:t_,defaultWidth:"wide",argumentCallback:function(e){return e-1}}),month:hr({values:r_,defaultWidth:"wide"}),day:hr({values:s_,defaultWidth:"wide"}),dayPeriod:hr({values:n_,defaultWidth:"wide",formattingValues:a_,defaultFormattingWidth:"wide"})};function mr(r){return function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=t.width,a=n&&r.matchPatterns[n]||r.matchPatterns[r.defaultMatchWidth],i=e.match(a);if(!i)return null;var l=i[0],c=n&&r.parsePatterns[n]||r.parsePatterns[r.defaultParseWidth],d=Array.isArray(c)?c_(c,function(x){return x.test(l)}):l_(c,function(x){return x.test(l)}),h;h=r.valueCallback?r.valueCallback(d):d,h=t.valueCallback?t.valueCallback(h):h;var g=e.slice(l.length);return{value:h,rest:g}}}function l_(r,e){for(var t in r)if(r.hasOwnProperty(t)&&e(r[t]))return t}function c_(r,e){for(var t=0;t<r.length;t++)if(e(r[t]))return t}function Og(r){return function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=e.match(r.matchPattern);if(!n)return null;var a=n[0],i=e.match(r.parsePattern);if(!i)return null;var l=r.valueCallback?r.valueCallback(i[0]):i[0];l=t.valueCallback?t.valueCallback(l):l;var c=e.slice(a.length);return{value:l,rest:c}}}var d_=/^(\d+)(th|st|nd|rd)?/i,u_=/\d+/i,h_={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},m_={any:[/^b/i,/^(a|c)/i]},g_={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},p_={any:[/1/i,/2/i,/3/i,/4/i]},f_={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},x_={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},y_={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},b_={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},v_={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},w_={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},__={ordinalNumber:Og({matchPattern:d_,parsePattern:u_,valueCallback:function(e){return parseInt(e,10)}}),era:mr({matchPatterns:h_,defaultMatchWidth:"wide",parsePatterns:m_,defaultParseWidth:"any"}),quarter:mr({matchPatterns:g_,defaultMatchWidth:"wide",parsePatterns:p_,defaultParseWidth:"any",valueCallback:function(e){return e+1}}),month:mr({matchPatterns:f_,defaultMatchWidth:"wide",parsePatterns:x_,defaultParseWidth:"any"}),day:mr({matchPatterns:y_,defaultMatchWidth:"wide",parsePatterns:b_,defaultParseWidth:"any"}),dayPeriod:mr({matchPatterns:v_,defaultMatchWidth:"any",parsePatterns:w_,defaultParseWidth:"any"})},k_={code:"en-US",formatDistance:G2,formatLong:X2,formatRelative:Z2,localize:o_,match:__,options:{weekStartsOn:0,firstWeekContainsDate:1}},N_=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,E_=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,j_=/^'([^]*?)'?$/,I_=/''/g,T_=/[a-zA-Z]/;function Vg(r,e,t){var n,a,i,l,c,d,h,g,x,p,E,j,S,k,L,M,T,O;gt(2,arguments);var ne=String(e),ie=yn(),I=(n=(a=t==null?void 0:t.locale)!==null&&a!==void 0?a:ie.locale)!==null&&n!==void 0?n:k_,N=_r((i=(l=(c=(d=t==null?void 0:t.firstWeekContainsDate)!==null&&d!==void 0?d:t==null||(h=t.locale)===null||h===void 0||(g=h.options)===null||g===void 0?void 0:g.firstWeekContainsDate)!==null&&c!==void 0?c:ie.firstWeekContainsDate)!==null&&l!==void 0?l:(x=ie.locale)===null||x===void 0||(p=x.options)===null||p===void 0?void 0:p.firstWeekContainsDate)!==null&&i!==void 0?i:1);if(!(N>=1&&N<=7))throw new RangeError("firstWeekContainsDate must be between 1 and 7 inclusively");var b=_r((E=(j=(S=(k=t==null?void 0:t.weekStartsOn)!==null&&k!==void 0?k:t==null||(L=t.locale)===null||L===void 0||(M=L.options)===null||M===void 0?void 0:M.weekStartsOn)!==null&&S!==void 0?S:ie.weekStartsOn)!==null&&j!==void 0?j:(T=ie.locale)===null||T===void 0||(O=T.options)===null||O===void 0?void 0:O.weekStartsOn)!==null&&E!==void 0?E:0);if(!(b>=0&&b<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");if(!I.localize)throw new RangeError("locale must contain localize property");if(!I.formatLong)throw new RangeError("locale must contain formatLong property");var f=Et(r);if(!I2(f))throw new RangeError("Invalid time value");var w=N2(f),_=A2(f,w),y={firstWeekContainsDate:N,weekStartsOn:b,locale:I,_originalDate:f},G=ne.match(E_).map(function(V){var F=V[0];if(F==="p"||F==="P"){var z=U2[F];return z(V,I.formatLong)}return V}).join("").match(N_).map(function(V){if(V==="''")return"'";var F=V[0];if(F==="'")return S_(V);var z=L2[F];if(z)return!(t!=null&&t.useAdditionalWeekYearTokens)&&z2(V)&&Uu(V,e,String(r)),!(t!=null&&t.useAdditionalDayOfYearTokens)&&W2(V)&&Uu(V,e,String(r)),z(_,V,I.localize,y);if(F.match(T_))throw new RangeError("Format string contains an unescaped latin alphabet character `"+F+"`");return V}).join("");return G}function S_(r){var e=r.match(j_);return e?e[1].replace(I_,"'"):r}function A_(r,e){gt(2,arguments);var t=Et(r),n=Et(e);return t.getTime()<n.getTime()}function nr(r,e){var t;gt(1,arguments);var n=_r((t=void 0)!==null&&t!==void 0?t:2);if(n!==2&&n!==1&&n!==0)throw new RangeError("additionalDigits must be 0, 1 or 2");if(!(typeof r=="string"||Object.prototype.toString.call(r)==="[object String]"))return new Date(NaN);var a=P_(r),i;if(a.date){var l=$_(a.date,n);i=M_(l.restDateString,l.year)}if(!i||isNaN(i.getTime()))return new Date(NaN);var c=i.getTime(),d=0,h;if(a.time&&(d=O_(a.time),isNaN(d)))return new Date(NaN);if(a.timezone){if(h=V_(a.timezone),isNaN(h))return new Date(NaN)}else{var g=new Date(c+d),x=new Date(0);return x.setFullYear(g.getUTCFullYear(),g.getUTCMonth(),g.getUTCDate()),x.setHours(g.getUTCHours(),g.getUTCMinutes(),g.getUTCSeconds(),g.getUTCMilliseconds()),x}return new Date(c+d+h)}var Ga={dateTimeDelimiter:/[T ]/,timeZoneDelimiter:/[Z ]/i,timezone:/([Z+-].*)$/},C_=/^-?(?:(\d{3})|(\d{2})(?:-?(\d{2}))?|W(\d{2})(?:-?(\d{1}))?|)$/,R_=/^(\d{2}(?:[.,]\d*)?)(?::?(\d{2}(?:[.,]\d*)?))?(?::?(\d{2}(?:[.,]\d*)?))?$/,D_=/^([+-])(\d{2})(?::?(\d{2}))?$/;function P_(r){var e={},t=r.split(Ga.dateTimeDelimiter),n;if(t.length>2)return e;if(/:/.test(t[0])?n=t[0]:(e.date=t[0],n=t[1],Ga.timeZoneDelimiter.test(e.date)&&(e.date=r.split(Ga.timeZoneDelimiter)[0],n=r.substr(e.date.length,r.length))),n){var a=Ga.timezone.exec(n);a?(e.time=n.replace(a[1],""),e.timezone=a[1]):e.time=n}return e}function $_(r,e){var t=new RegExp("^(?:(\\d{4}|[+-]\\d{"+(4+e)+"})|(\\d{2}|[+-]\\d{"+(2+e)+"})$)"),n=r.match(t);if(!n)return{year:NaN,restDateString:""};var a=n[1]?parseInt(n[1]):null,i=n[2]?parseInt(n[2]):null;return{year:i===null?a:i*100,restDateString:r.slice((n[1]||n[2]).length)}}function M_(r,e){if(e===null)return new Date(NaN);var t=r.match(C_);if(!t)return new Date(NaN);var n=!!t[4],a=An(t[1]),i=An(t[2])-1,l=An(t[3]),c=An(t[4]),d=An(t[5])-1;if(n)return q_(e,c,d)?L_(e,c,d):new Date(NaN);var h=new Date(0);return!U_(e,i,l)||!B_(e,a)?new Date(NaN):(h.setUTCFullYear(e,i,Math.max(a,l)),h)}function An(r){return r?parseInt(r):1}function O_(r){var e=r.match(R_);if(!e)return NaN;var t=Co(e[1]),n=Co(e[2]),a=Co(e[3]);return W_(t,n,a)?t*Dg+n*Rg+a*1e3:NaN}function Co(r){return r&&parseFloat(r.replace(",","."))||0}function V_(r){if(r==="Z")return 0;var e=r.match(D_);if(!e)return 0;var t=e[1]==="+"?-1:1,n=parseInt(e[2]),a=e[3]&&parseInt(e[3])||0;return z_(n,a)?t*(n*Dg+a*Rg):NaN}function L_(r,e,t){var n=new Date(0);n.setUTCFullYear(r,0,4);var a=n.getUTCDay()||7,i=(e-1)*7+t+1-a;return n.setUTCDate(n.getUTCDate()+i),n}var F_=[31,null,31,30,31,30,31,31,30,31,30,31];function Lg(r){return r%400===0||r%4===0&&r%100!==0}function U_(r,e,t){return e>=0&&e<=11&&t>=1&&t<=(F_[e]||(Lg(r)?29:28))}function B_(r,e){return e>=1&&e<=(Lg(r)?366:365)}function q_(r,e,t){return e>=1&&e<=53&&t>=0&&t<=6}function W_(r,e,t){return r===24?e===0&&t===0:t>=0&&t<60&&e>=0&&e<60&&r>=0&&r<25}function z_(r,e){return e>=0&&e<=59}function Bu(r,e,t){gt(2,arguments);var n=un(r,t),a=un(e,t);return n.getTime()===a.getTime()}function Cn(r,e){if(r.one!==void 0&&e===1)return r.one;var t=e%10,n=e%100;return t===1&&n!==11?r.singularNominative.replace("{{count}}",String(e)):t>=2&&t<=4&&(n<10||n>20)?r.singularGenitive.replace("{{count}}",String(e)):r.pluralGenitive.replace("{{count}}",String(e))}function Wt(r){return function(e,t){return t!=null&&t.addSuffix?t.comparison&&t.comparison>0?r.future?Cn(r.future,e):"через "+Cn(r.regular,e):r.past?Cn(r.past,e):Cn(r.regular,e)+" назад":Cn(r.regular,e)}}var H_={lessThanXSeconds:Wt({regular:{one:"меньше секунды",singularNominative:"меньше {{count}} секунды",singularGenitive:"меньше {{count}} секунд",pluralGenitive:"меньше {{count}} секунд"},future:{one:"меньше, чем через секунду",singularNominative:"меньше, чем через {{count}} секунду",singularGenitive:"меньше, чем через {{count}} секунды",pluralGenitive:"меньше, чем через {{count}} секунд"}}),xSeconds:Wt({regular:{singularNominative:"{{count}} секунда",singularGenitive:"{{count}} секунды",pluralGenitive:"{{count}} секунд"},past:{singularNominative:"{{count}} секунду назад",singularGenitive:"{{count}} секунды назад",pluralGenitive:"{{count}} секунд назад"},future:{singularNominative:"через {{count}} секунду",singularGenitive:"через {{count}} секунды",pluralGenitive:"через {{count}} секунд"}}),halfAMinute:function(e,t){return t!=null&&t.addSuffix?t.comparison&&t.comparison>0?"через полминуты":"полминуты назад":"полминуты"},lessThanXMinutes:Wt({regular:{one:"меньше минуты",singularNominative:"меньше {{count}} минуты",singularGenitive:"меньше {{count}} минут",pluralGenitive:"меньше {{count}} минут"},future:{one:"меньше, чем через минуту",singularNominative:"меньше, чем через {{count}} минуту",singularGenitive:"меньше, чем через {{count}} минуты",pluralGenitive:"меньше, чем через {{count}} минут"}}),xMinutes:Wt({regular:{singularNominative:"{{count}} минута",singularGenitive:"{{count}} минуты",pluralGenitive:"{{count}} минут"},past:{singularNominative:"{{count}} минуту назад",singularGenitive:"{{count}} минуты назад",pluralGenitive:"{{count}} минут назад"},future:{singularNominative:"через {{count}} минуту",singularGenitive:"через {{count}} минуты",pluralGenitive:"через {{count}} минут"}}),aboutXHours:Wt({regular:{singularNominative:"около {{count}} часа",singularGenitive:"около {{count}} часов",pluralGenitive:"около {{count}} часов"},future:{singularNominative:"приблизительно через {{count}} час",singularGenitive:"приблизительно через {{count}} часа",pluralGenitive:"приблизительно через {{count}} часов"}}),xHours:Wt({regular:{singularNominative:"{{count}} час",singularGenitive:"{{count}} часа",pluralGenitive:"{{count}} часов"}}),xDays:Wt({regular:{singularNominative:"{{count}} день",singularGenitive:"{{count}} дня",pluralGenitive:"{{count}} дней"}}),aboutXWeeks:Wt({regular:{singularNominative:"около {{count}} недели",singularGenitive:"около {{count}} недель",pluralGenitive:"около {{count}} недель"},future:{singularNominative:"приблизительно через {{count}} неделю",singularGenitive:"приблизительно через {{count}} недели",pluralGenitive:"приблизительно через {{count}} недель"}}),xWeeks:Wt({regular:{singularNominative:"{{count}} неделя",singularGenitive:"{{count}} недели",pluralGenitive:"{{count}} недель"}}),aboutXMonths:Wt({regular:{singularNominative:"около {{count}} месяца",singularGenitive:"около {{count}} месяцев",pluralGenitive:"около {{count}} месяцев"},future:{singularNominative:"приблизительно через {{count}} месяц",singularGenitive:"приблизительно через {{count}} месяца",pluralGenitive:"приблизительно через {{count}} месяцев"}}),xMonths:Wt({regular:{singularNominative:"{{count}} месяц",singularGenitive:"{{count}} месяца",pluralGenitive:"{{count}} месяцев"}}),aboutXYears:Wt({regular:{singularNominative:"около {{count}} года",singularGenitive:"около {{count}} лет",pluralGenitive:"около {{count}} лет"},future:{singularNominative:"приблизительно через {{count}} год",singularGenitive:"приблизительно через {{count}} года",pluralGenitive:"приблизительно через {{count}} лет"}}),xYears:Wt({regular:{singularNominative:"{{count}} год",singularGenitive:"{{count}} года",pluralGenitive:"{{count}} лет"}}),overXYears:Wt({regular:{singularNominative:"больше {{count}} года",singularGenitive:"больше {{count}} лет",pluralGenitive:"больше {{count}} лет"},future:{singularNominative:"больше, чем через {{count}} год",singularGenitive:"больше, чем через {{count}} года",pluralGenitive:"больше, чем через {{count}} лет"}}),almostXYears:Wt({regular:{singularNominative:"почти {{count}} год",singularGenitive:"почти {{count}} года",pluralGenitive:"почти {{count}} лет"},future:{singularNominative:"почти через {{count}} год",singularGenitive:"почти через {{count}} года",pluralGenitive:"почти через {{count}} лет"}})},G_=function(e,t,n){return H_[e](t,n)},K_={full:"EEEE, d MMMM y 'г.'",long:"d MMMM y 'г.'",medium:"d MMM y 'г.'",short:"dd.MM.y"},Q_={full:"H:mm:ss zzzz",long:"H:mm:ss z",medium:"H:mm:ss",short:"H:mm"},Y_={any:"{{date}}, {{time}}"},X_={date:Xs({formats:K_,defaultWidth:"full"}),time:Xs({formats:Q_,defaultWidth:"full"}),dateTime:Xs({formats:Y_,defaultWidth:"any"})},mc=["воскресенье","понедельник","вторник","среду","четверг","пятницу","субботу"];function J_(r){var e=mc[r];switch(r){case 0:return"'в прошлое "+e+" в' p";case 1:case 2:case 4:return"'в прошлый "+e+" в' p";case 3:case 5:case 6:return"'в прошлую "+e+" в' p"}}function qu(r){var e=mc[r];return r===2?"'во "+e+" в' p":"'в "+e+" в' p"}function Z_(r){var e=mc[r];switch(r){case 0:return"'в следующее "+e+" в' p";case 1:case 2:case 4:return"'в следующий "+e+" в' p";case 3:case 5:case 6:return"'в следующую "+e+" в' p"}}var ek={lastWeek:function(e,t,n){var a=e.getUTCDay();return Bu(e,t,n)?qu(a):J_(a)},yesterday:"'вчера в' p",today:"'сегодня в' p",tomorrow:"'завтра в' p",nextWeek:function(e,t,n){var a=e.getUTCDay();return Bu(e,t,n)?qu(a):Z_(a)},other:"P"},tk=function(e,t,n,a){var i=ek[e];return typeof i=="function"?i(t,n,a):i},rk={narrow:["до н.э.","н.э."],abbreviated:["до н. э.","н. э."],wide:["до нашей эры","нашей эры"]},sk={narrow:["1","2","3","4"],abbreviated:["1-й кв.","2-й кв.","3-й кв.","4-й кв."],wide:["1-й квартал","2-й квартал","3-й квартал","4-й квартал"]},nk={narrow:["Я","Ф","М","А","М","И","И","А","С","О","Н","Д"],abbreviated:["янв.","фев.","март","апр.","май","июнь","июль","авг.","сент.","окт.","нояб.","дек."],wide:["январь","февраль","март","апрель","май","июнь","июль","август","сентябрь","октябрь","ноябрь","декабрь"]},ak={narrow:["Я","Ф","М","А","М","И","И","А","С","О","Н","Д"],abbreviated:["янв.","фев.","мар.","апр.","мая","июн.","июл.","авг.","сент.","окт.","нояб.","дек."],wide:["января","февраля","марта","апреля","мая","июня","июля","августа","сентября","октября","ноября","декабря"]},ik={narrow:["В","П","В","С","Ч","П","С"],short:["вс","пн","вт","ср","чт","пт","сб"],abbreviated:["вск","пнд","втр","срд","чтв","птн","суб"],wide:["воскресенье","понедельник","вторник","среда","четверг","пятница","суббота"]},ok={narrow:{am:"ДП",pm:"ПП",midnight:"полн.",noon:"полд.",morning:"утро",afternoon:"день",evening:"веч.",night:"ночь"},abbreviated:{am:"ДП",pm:"ПП",midnight:"полн.",noon:"полд.",morning:"утро",afternoon:"день",evening:"веч.",night:"ночь"},wide:{am:"ДП",pm:"ПП",midnight:"полночь",noon:"полдень",morning:"утро",afternoon:"день",evening:"вечер",night:"ночь"}},lk={narrow:{am:"ДП",pm:"ПП",midnight:"полн.",noon:"полд.",morning:"утра",afternoon:"дня",evening:"веч.",night:"ночи"},abbreviated:{am:"ДП",pm:"ПП",midnight:"полн.",noon:"полд.",morning:"утра",afternoon:"дня",evening:"веч.",night:"ночи"},wide:{am:"ДП",pm:"ПП",midnight:"полночь",noon:"полдень",morning:"утра",afternoon:"дня",evening:"вечера",night:"ночи"}},ck=function(e,t){var n=Number(e),a=t==null?void 0:t.unit,i;return a==="date"?i="-е":a==="week"||a==="minute"||a==="second"?i="-я":i="-й",n+i},dk={ordinalNumber:ck,era:hr({values:rk,defaultWidth:"wide"}),quarter:hr({values:sk,defaultWidth:"wide",argumentCallback:function(e){return e-1}}),month:hr({values:nk,defaultWidth:"wide",formattingValues:ak,defaultFormattingWidth:"wide"}),day:hr({values:ik,defaultWidth:"wide"}),dayPeriod:hr({values:ok,defaultWidth:"any",formattingValues:lk,defaultFormattingWidth:"wide"})},uk=/^(\d+)(-?(е|я|й|ое|ье|ая|ья|ый|ой|ий|ый))?/i,hk=/\d+/i,mk={narrow:/^((до )?н\.?\s?э\.?)/i,abbreviated:/^((до )?н\.?\s?э\.?)/i,wide:/^(до нашей эры|нашей эры|наша эра)/i},gk={any:[/^д/i,/^н/i]},pk={narrow:/^[1234]/i,abbreviated:/^[1234](-?[ыои]?й?)? кв.?/i,wide:/^[1234](-?[ыои]?й?)? квартал/i},fk={any:[/1/i,/2/i,/3/i,/4/i]},xk={narrow:/^[яфмаисонд]/i,abbreviated:/^(янв|фев|март?|апр|ма[йя]|июн[ья]?|июл[ья]?|авг|сент?|окт|нояб?|дек)\.?/i,wide:/^(январ[ья]|феврал[ья]|марта?|апрел[ья]|ма[йя]|июн[ья]|июл[ья]|августа?|сентябр[ья]|октябр[ья]|октябр[ья]|ноябр[ья]|декабр[ья])/i},yk={narrow:[/^я/i,/^ф/i,/^м/i,/^а/i,/^м/i,/^и/i,/^и/i,/^а/i,/^с/i,/^о/i,/^н/i,/^я/i],any:[/^я/i,/^ф/i,/^мар/i,/^ап/i,/^ма[йя]/i,/^июн/i,/^июл/i,/^ав/i,/^с/i,/^о/i,/^н/i,/^д/i]},bk={narrow:/^[впсч]/i,short:/^(вс|во|пн|по|вт|ср|чт|че|пт|пя|сб|су)\.?/i,abbreviated:/^(вск|вос|пнд|пон|втр|вто|срд|сре|чтв|чет|птн|пят|суб).?/i,wide:/^(воскресень[ея]|понедельника?|вторника?|сред[аы]|четверга?|пятниц[аы]|суббот[аы])/i},vk={narrow:[/^в/i,/^п/i,/^в/i,/^с/i,/^ч/i,/^п/i,/^с/i],any:[/^в[ос]/i,/^п[он]/i,/^в/i,/^ср/i,/^ч/i,/^п[ят]/i,/^с[уб]/i]},wk={narrow:/^([дп]п|полн\.?|полд\.?|утр[оа]|день|дня|веч\.?|ноч[ьи])/i,abbreviated:/^([дп]п|полн\.?|полд\.?|утр[оа]|день|дня|веч\.?|ноч[ьи])/i,wide:/^([дп]п|полночь|полдень|утр[оа]|день|дня|вечера?|ноч[ьи])/i},_k={any:{am:/^дп/i,pm:/^пп/i,midnight:/^полн/i,noon:/^полд/i,morning:/^у/i,afternoon:/^д[ен]/i,evening:/^в/i,night:/^н/i}},kk={ordinalNumber:Og({matchPattern:uk,parsePattern:hk,valueCallback:function(e){return parseInt(e,10)}}),era:mr({matchPatterns:mk,defaultMatchWidth:"wide",parsePatterns:gk,defaultParseWidth:"any"}),quarter:mr({matchPatterns:pk,defaultMatchWidth:"wide",parsePatterns:fk,defaultParseWidth:"any",valueCallback:function(e){return e+1}}),month:mr({matchPatterns:xk,defaultMatchWidth:"wide",parsePatterns:yk,defaultParseWidth:"any"}),day:mr({matchPatterns:bk,defaultMatchWidth:"wide",parsePatterns:vk,defaultParseWidth:"any"}),dayPeriod:mr({matchPatterns:wk,defaultMatchWidth:"wide",parsePatterns:_k,defaultParseWidth:"any"})},Nk={code:"ru",formatDistance:G_,formatLong:X_,formatRelative:tk,localize:dk,match:kk,options:{weekStartsOn:1,firstWeekContainsDate:1}};const xe=(r,e="dd.MM.yyyy")=>{const t=typeof r=="string"?nr(r):r;return Vg(t,e,{locale:Nk})},wa=(r=new Date)=>{const e=k2(r,{weekStartsOn:1}),t=S2(r,{weekStartsOn:1});return{start:e,end:t}},gc=(r=new Date)=>{const{start:e,end:t}=wa(r);return T2({start:e,end:t})},Fg=r=>{const e=new Date,t=new Date(e);t.setHours(0,0,0,0),t.setDate(t.getDate()-(r-1));const n=new Date(e);return n.setHours(23,59,59,999),{start:t,end:n}},Ek=(r,e)=>{const t=typeof r=="string"?nr(r):r,n=typeof e=="string"?nr(e):e;return E2(t,n)},eo=r=>r.reduce((e,t)=>{const[n,a]=t.start.split(":").map(Number),[i,l]=t.end.split(":").map(Number),c=n*60+a;let h=(i*60+l-c)/60;if((h<0||t.endDate)&&(h+=24),t.breaks&&t.breaks.length>0){const g=t.breaks.reduce((x,p)=>{const[E,j]=p.start.split(":").map(Number),[S,k]=p.end.split(":").map(Number),L=E*60+j;let T=(S*60+k-L)/60;return T<0&&(T+=24),x+T},0);h-=g}return e+h},0),Zt=r=>{const[e,t]=r.split(":").map(Number);return e*60+t},ol=(r,e)=>{if(!r||!e)return[];const t=nr(r),n=nr(e);if(A_(n,t))return[];const a=[],i=new Date(t);for(;i<=n;)a.push(xe(i,"yyyy-MM-dd")),i.setDate(i.getDate()+1);return a},Ug=r=>{const e=Array.from(new Set(r.filter(Boolean)));return e.sort(),e},jk=(r,e)=>{const t=Zt(r.start),n=Zt(r.end),a=Zt(e.start),i=Zt(e.end);return t<i&&n>a},ll=()=>{const r=new Date,e=3*60,t=r.getTimezoneOffset();return new Date(r.getTime()+(e+t)*60*1e3)},Wu=(r,e=ll())=>{const t=e.getHours(),n=new Date(`${Vg(e,"yyyy-MM-dd")}T${r}:00`);return t>=21||e>n},Ik=r=>{const e=Math.floor(r),t=Math.round((r-e)*60);return e===0&&t===0?"0ч":e===0?`${t}м`:t===0?`${e}ч`:`${e}ч ${t}м`},Js=(r,e,t,n)=>{const a=r,i=e||r;if(i<t||a>n)return 0;const l=a>t?a:t,c=i<n?i:n,d=nr(l),g=nr(c).getTime()-d.getTime();return Math.floor(g/(1e3*60*60*24))+1},Tk=({selectedUserId:r,slotFilter:e,onEditSlot:t,onEditStatus:n,refreshKey:a})=>{const{theme:i}=ct(),{user:l}=Dt(),{isAdmin:c}=Bt(),[d,h]=A.useState([]),[g,x]=A.useState([]),[p,E]=A.useState(new Date),[j,S]=A.useState(!0),k={1:"Dex",2:"Merc",3:"Xenia",4:"Olenka",5:"Sydney"},L={artyom:"1",adel:"2",kseniya:"3",olga:"4",anastasia:"5"},M=F=>{const z=Ee.find(ee=>ee.id===F)||Ee.find(ee=>L[F]===ee.id);return k[(z==null?void 0:z.id)||F]||(z==null?void 0:z.name)||F},T=gc(p),O=r?Ee.filter(F=>F.id===r):Ee;A.useEffect(()=>{ne()},[r,p,a]),A.useEffect(()=>{const F=()=>{ne()};return window.addEventListener("focus",F),()=>window.removeEventListener("focus",F)},[]);const ne=async()=>{S(!0);try{const F=new Date(T[0]);F.setHours(0,0,0,0);const z=new Date(T[6]);z.setHours(23,59,59,999);const ee=xe(F,"yyyy-MM-dd"),re=xe(z,"yyyy-MM-dd"),[oe,ke]=await Promise.all([Fr(),Rr()]),ye=oe.filter(H=>H.date>=ee&&H.date<=re),K=ke.filter(H=>{const Se=H.date,Ne=H.endDate||H.date;return Se<=re&&Ne>=ee}),he=r?ye.filter(H=>H.userId===r):ye,Ce=r?K.filter(H=>H.userId===r):K;console.log("Loaded slots:",{weekStart:ee,weekEnd:re,allSlotsCount:oe.length,weekSlotsCount:ye.length,filteredSlotsCount:he.length,selectedUserId:r}),h(he),x(Ce)}catch(F){console.error("Error loading data:",F)}finally{S(!1)}},ie=async F=>{var z;if(!c&&(l==null?void 0:l.id)!==((z=d.find(ee=>ee.id===F))==null?void 0:z.userId)){alert("Только администратор может удалять чужие слоты");return}confirm("Удалить слот?")&&(await hc(F),ne())},I=async F=>{var z;if(!c&&(l==null?void 0:l.id)!==((z=g.find(ee=>ee.id===F))==null?void 0:z.userId)){alert("Только администратор может удалять чужие статусы");return}confirm("Удалить статус?")&&(await Eg(F),ne())},N=F=>{const z=new Date;z.setHours(0,0,0,0);const ee=new Date(F.date);if(ee.setHours(0,0,0,0),ee>z)return!0;if(ee.getTime()===z.getTime()){const oe=new Date,ke=oe.getHours()*60+oe.getMinutes();return F.slots.some(ye=>{if(ye.endDate){const H=new Date(ye.endDate);if(H.setHours(0,0,0,0),new Date(z).setHours(23,59,59),H>z)return!0;if(H.getTime()===z.getTime()){const[Ne,Z]=ye.end.split(":").map(Number);return Ne*60+Z>ke}return!1}const[K,he]=ye.end.split(":").map(Number);return K*60+he>ke})}return F.slots.some(oe=>{if(oe.endDate){const ke=new Date(oe.endDate);return ke.setHours(0,0,0,0),ke>=z}return!1})},b=(F,z)=>{const ee=d.find(re=>re.userId===F&&re.date===z)||null;if(ee&&e!=="all"){const re=N(ee);if(e==="upcoming"&&!re||e==="completed"&&re)return null}return ee},f=(F,z)=>g.find(ee=>ee.userId!==F?!1:ee.endDate?ee.date<=z&&ee.endDate>=z:ee.date===z)||null,w=F=>{const ee=d.filter(K=>K.userId===F).reduce((K,he)=>K+eo(he.slots),0),re=g.filter(K=>K.userId===F),oe=re.filter(K=>K.type==="dayoff").length,ke=re.filter(K=>K.type==="sick").length,ye=re.filter(K=>K.type==="vacation").length;return{totalHours:ee,daysOff:oe,sickDays:ke,vacationDays:ye}},_=F=>{const z=new Date(p);F==="prev"?z.setDate(z.getDate()-7):z.setDate(z.getDate()+7),E(z)};if(j)return s.jsx("div",{className:`rounded-lg p-8 text-center ${i==="dark"?"bg-[#1a1a1a]":"bg-white"}`,children:s.jsx("p",{className:i==="dark"?"text-gray-400":"text-gray-600",children:"Загрузка..."})});const y=i==="dark"?"text-white":"text-gray-900",G=i==="dark"?"text-gray-300":"text-gray-600",V={dayoff:"bg-amber-50 text-amber-900 border border-amber-200 shadow-inner dark:bg-amber-900/30 dark:text-amber-50 dark:border-amber-700",sick:"bg-orange-50 text-orange-900 border border-orange-200 shadow-inner dark:bg-orange-900/30 dark:text-orange-50 dark:border-orange-700",vacation:"bg-sky-50 text-sky-900 border border-sky-200 shadow-inner dark:bg-sky-900/30 dark:text-sky-50 dark:border-sky-700"};return s.jsxs("div",{className:`rounded-lg ${i==="dark"?"bg-[#1a1a1a]":"bg-white"} shadow-md overflow-hidden`,children:[s.jsxs("div",{className:`p-4 border-b ${i==="dark"?"border-gray-800":"border-gray-200"} flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between`,children:[s.jsxs("button",{onClick:()=>_("prev"),className:`w-full sm:w-auto px-3 py-2 text-sm sm:text-base rounded-lg transition-colors flex items-center justify-center gap-2 whitespace-nowrap ${i==="dark"?"border border-gray-700 bg-gray-900/60 hover:border-[#4E6E49]/50 hover:bg-gray-900":"border border-gray-200 bg-white hover:border-[#4E6E49]/40 hover:bg-gray-50"}`,children:[s.jsx("span",{children:"←"}),s.jsx("span",{children:"Предыдущая неделя"})]}),s.jsxs("span",{className:`${y} font-semibold text-center text-sm sm:text-base whitespace-nowrap`,children:[xe(T[0],"dd.MM.yyyy")," - ",xe(T[6],"dd.MM.yyyy")]}),s.jsxs("button",{onClick:()=>_("next"),className:`w-full sm:w-auto px-3 py-2 text-sm sm:text-base rounded-lg transition-colors flex items-center justify-center gap-2 whitespace-nowrap ${i==="dark"?"border border-gray-700 bg-gray-900/60 hover:border-[#4E6E49]/50 hover:bg-gray-900":"border border-gray-200 bg-white hover:border-[#4E6E49]/40 hover:bg-gray-50"}`,children:[s.jsx("span",{children:"Следующая неделя"}),s.jsx("span",{children:"→"})]})]}),s.jsx("div",{className:"overflow-x-auto -mx-3 sm:-mx-4 md:-mx-6 lg:-mx-8 px-3 sm:px-4 md:px-6 lg:px-8",children:s.jsx("div",{className:"min-w-full inline-block align-middle",children:s.jsxs("table",{className:"w-full",children:[s.jsx("thead",{className:"sticky top-0 z-30",children:s.jsxs("tr",{className:`${i==="dark"?"bg-[#0f172a]":"bg-gray-50"} shadow-sm`,children:[s.jsx("th",{className:`px-2 sm:px-3 md:px-4 py-3 text-left text-xs sm:text-sm font-semibold ${y} sticky left-0 z-30 ${i==="dark"?"bg-[#0f172a]":"bg-gray-50"}`,children:"Members"}),T.map(F=>s.jsx("th",{className:"px-1.5 sm:px-2 md:px-3 lg:px-4 py-3",children:s.jsxs("div",{className:`mx-auto w-full max-w-[110px] rounded-xl border ${i==="dark"?"border-white/10 bg-white/5 text-white":"border-gray-200 bg-white text-gray-900"} shadow-sm text-center`,children:[s.jsx("div",{className:"text-[10px] sm:text-xs opacity-70",children:xe(F,"EEE")}),s.jsx("div",{className:"text-sm font-semibold",children:xe(F,"dd.MM")})]})},F.toISOString())),s.jsx("th",{className:`px-2 sm:px-3 md:px-4 py-3 text-center text-xs sm:text-sm font-bold ${y} whitespace-nowrap`,children:"Итог"})]})}),s.jsx("tbody",{children:O.map((F,z)=>{const ee=w(F.id),re=z%2===0;return s.jsxs("tr",{className:`
                    group border-b transition-all duration-300 relative
                    ${i==="dark"?"border-gray-800/30":"border-gray-200/30"}
                    ${re?i==="dark"?"bg-gradient-to-r from-[#1a1a1a]/40 via-[#1a1a1a]/20 to-transparent hover:from-[#1a1a1a]/70 hover:via-[#1a1a1a]/50 hover:shadow-lg hover:shadow-#4E6E49/10":"bg-gradient-to-r from-gray-50/70 via-gray-50/40 to-transparent hover:from-gray-100/90 hover:via-gray-100/70 hover:shadow-lg hover:shadow-#4E6E49/5":i==="dark"?"bg-gradient-to-r from-[#1a1a1a]/10 via-[#1a1a1a]/5 to-transparent hover:from-[#1a1a1a]/50 hover:via-[#1a1a1a]/30 hover:shadow-lg hover:shadow-#4E6E49/10":"bg-gradient-to-r from-white via-gray-50/30 to-transparent hover:from-gray-50 hover:via-gray-50/60 hover:shadow-lg hover:shadow-#4E6E49/5"}
                    hover:scale-[1.01] hover:-translate-y-0.5
                  `,children:[s.jsx("td",{className:`px-2 sm:px-3 md:px-4 py-2 sm:py-3 md:py-4 font-semibold text-xs sm:text-sm ${y} sticky left-0 z-10 transition-all duration-300 backdrop-blur-sm min-w-[120px] sm:min-w-[140px] ${re?i==="dark"?"bg-gradient-to-r from-[#1a1a1a]/40 via-[#1a1a1a]/20 to-transparent group-hover:from-[#1a1a1a]/70 group-hover:via-[#1a1a1a]/50":"bg-gradient-to-r from-gray-50/70 via-gray-50/40 to-transparent group-hover:from-gray-100/90 group-hover:via-gray-100/70":i==="dark"?"bg-gradient-to-r from-[#1a1a1a]/10 via-[#1a1a1a]/5 to-transparent group-hover:from-[#1a1a1a]/50 group-hover:via-[#1a1a1a]/30":"bg-gradient-to-r from-white via-gray-50/30 to-transparent group-hover:from-gray-50 group-hover:via-gray-50/60"}`,children:s.jsxs("div",{className:"flex items-center gap-2 sm:gap-3",children:[s.jsxs("div",{className:"relative flex-shrink-0 group/avatar",children:[F.avatar?s.jsx("img",{src:F.avatar,alt:M(F.id),className:"w-8 h-8 sm:w-10 sm:h-10 md:w-11 md:h-11 rounded-full object-cover border-2 shadow-lg transition-all duration-300 group-hover:scale-110 group-hover:shadow-xl group-hover:shadow-#4E6E49/30 ring-2 ring-transparent group-hover:ring-#4E6E49/50",style:{borderColor:i==="dark"?"rgba(34, 197, 94, 0.6)":"rgba(34, 197, 94, 0.4)"},onError:oe=>{const ke=oe.target;ke.style.display="none";const ye=ke.nextElementSibling;ye&&(ye.style.display="flex")}}):null,s.jsx("div",{className:`w-8 h-8 sm:w-10 sm:h-10 md:w-11 md:h-11 rounded-full flex items-center justify-center font-bold text-xs sm:text-sm transition-all duration-300 shadow-lg ring-2 ring-transparent group-hover/avatar:scale-110 group-hover/avatar:shadow-xl group-hover/avatar:ring-#4E6E49/50 ${i==="dark"?"bg-gradient-to-br from-[#4E6E49] via-[#4E6E49] to-blue-500 text-white group-hover/avatar:shadow-#4E6E49/40":"bg-gradient-to-br from-[#4E6E49] via-[#4E6E49] to-blue-400 text-white group-hover/avatar:shadow-#4E6E49/40"} ${F.avatar?"absolute inset-0 hidden":""}`,children:M(F.id).charAt(0).toUpperCase()}),s.jsx("div",{className:"absolute -bottom-0.5 -right-0.5 w-2.5 h-2.5 sm:w-3 sm:h-3 md:w-3.5 md:h-3.5 bg-[#4E6E49] rounded-full border border-white sm:border-2 shadow-lg animate-pulse opacity-0 group-hover/avatar:opacity-100 transition-opacity duration-300"})]}),s.jsx("span",{className:"font-semibold group-hover:text-[#4E6E49] transition-colors duration-300 truncate hidden sm:inline",children:M(F.id)}),s.jsx("span",{className:"font-semibold group-hover:text-[#4E6E49] transition-colors duration-300 sm:hidden",children:(M(F.id).split(" ")[0]||M(F.id)).substring(0,8)})]})}),T.map(oe=>{const ke=xe(oe,"yyyy-MM-dd"),ye=b(F.id,ke),K=f(F.id,ke);return s.jsx("td",{className:"px-1 sm:px-2 py-2 sm:py-3 text-center border-l border-r border-transparent hover:border-blue-500/20 transition-colors min-w-[80px] sm:min-w-[100px]",children:ye?s.jsxs("div",{className:"space-y-2",children:[(()=>{const he=N(ye),Ce=he?"bg-gradient-to-r from-emerald-500 to-teal-600":"bg-gradient-to-r from-slate-500 to-slate-700",Se=he?br:Di;return ye.slots.map((Ne,Z)=>s.jsxs("div",{className:"space-y-1",children:[s.jsx("div",{className:`${Ce} text-white rounded-md sm:rounded-lg px-2 sm:px-3 py-1 sm:py-1.5 text-[10px] sm:text-xs font-semibold shadow-lg transition-all duration-300 hover:scale-105 hover:shadow-xl ${he?"hover:shadow-emerald-500/40 ring-2 ring-emerald-400/40":"hover:shadow-slate-500/40 ring-2 ring-slate-400/40"}`,children:s.jsxs("div",{className:"flex items-center justify-center gap-0.5 sm:gap-1 flex-wrap",children:[s.jsx(Se,{className:"w-2.5 h-2.5 sm:w-3 sm:h-3 animate-pulse flex-shrink-0"}),s.jsxs("span",{className:"whitespace-nowrap",children:[Ne.start," - ",Ne.end]}),Ne.endDate&&s.jsxs("span",{className:"text-[9px] sm:text-[10px] opacity-90 whitespace-nowrap",children:["(до ",xe(new Date(Ne.endDate),"dd.MM"),")"]})]})}),Ne.breaks&&Ne.breaks.length>0&&s.jsxs("div",{className:"space-y-1",children:[s.jsx("div",{className:`text-[10px] ${i==="dark"?"text-gray-400":"text-gray-600"} font-medium`,children:"Перерывы:"}),Ne.breaks.map((Re,J)=>s.jsx("div",{className:`${i==="dark"?"bg-gray-700/90":"bg-white"} ${i==="dark"?"text-gray-200":"text-gray-900"} border-2 ${i==="dark"?"border-orange-500/50":"border-orange-300"} rounded-md sm:rounded-lg px-1.5 sm:px-2 py-0.5 sm:py-1 text-[9px] sm:text-[10px] font-medium shadow-md transition-all duration-300 hover:scale-105 hover:shadow-lg ${i==="dark"?"hover:border-orange-400/70 hover:shadow-orange-500/20":"hover:border-orange-400 hover:shadow-orange-400/20"}`,children:s.jsxs("span",{className:"flex items-center gap-0.5 sm:gap-1 justify-center flex-wrap",children:[s.jsx("span",{className:"w-0.5 h-0.5 sm:w-1 sm:h-1 rounded-full bg-orange-500 flex-shrink-0"}),s.jsxs("span",{className:"whitespace-nowrap",children:[Re.start," - ",Re.end]})]})},J))]})]},Z))})(),ye.comment&&s.jsxs("div",{className:"flex items-center justify-center group/slot-comment relative",children:[s.jsx(rr,{className:"w-4 h-4 text-gray-400 cursor-help"}),s.jsx("div",{className:"pointer-events-none absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-2 py-1 bg-[#0A0A0A] text-white text-xs rounded opacity-0 group-hover/slot-comment:opacity-100 transition-opacity whitespace-nowrap z-10",children:ye.comment})]}),s.jsx("div",{className:"flex gap-1 justify-center",children:c||(F==null?void 0:F.id)===ye.userId?s.jsxs(s.Fragment,{children:[s.jsx("button",{onClick:()=>t(ye),className:"p-1 text-blue-500 hover:bg-blue-500 hover:text-white rounded",children:s.jsx(Gt,{className:"w-3 h-3"})}),s.jsx("button",{onClick:()=>ie(ye.id),className:"p-1 text-red-500 hover:bg-red-500 hover:text-white rounded",children:s.jsx(At,{className:"w-3 h-3"})})]}):s.jsxs(s.Fragment,{children:[s.jsx("button",{disabled:!0,className:"p-1 text-gray-400 cursor-not-allowed rounded",title:"Вы можете редактировать только свои слоты",children:s.jsx(Gt,{className:"w-3 h-3"})}),s.jsx("button",{disabled:!0,className:"p-1 text-gray-400 cursor-not-allowed rounded",title:"Вы можете удалять только свои слоты",children:s.jsx(At,{className:"w-3 h-3"})})]})})]}):K?s.jsxs("div",{className:"space-y-1",children:[s.jsx("div",{className:`rounded-lg px-3 py-2 text-xs font-semibold ring-1 ring-inset ring-black/5 dark:ring-white/10 ${V[K.type]}`,children:K.type==="dayoff"?"Выходной":K.type==="sick"?"Больничный":"Отпуск"}),K.comment&&s.jsxs("div",{className:"flex items-center justify-center group/status-comment relative",children:[s.jsx(rr,{className:"w-4 h-4 text-gray-400 cursor-help"}),s.jsx("div",{className:"pointer-events-none absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-2 py-1 bg-[#0A0A0A] text-white text-xs rounded opacity-0 group-hover/status-comment:opacity-100 transition-opacity whitespace-nowrap z-10",children:K.comment})]}),s.jsx("div",{className:"flex gap-1 justify-center",children:c||(F==null?void 0:F.id)===K.userId?s.jsxs(s.Fragment,{children:[s.jsx("button",{onClick:()=>n(K),className:"p-1 text-blue-500 hover:bg-blue-500 hover:text-white rounded",children:s.jsx(Gt,{className:"w-3 h-3"})}),s.jsx("button",{onClick:()=>I(K.id),className:"p-1 text-red-500 hover:bg-red-500 hover:text-white rounded",children:s.jsx(At,{className:"w-3 h-3"})})]}):s.jsxs(s.Fragment,{children:[s.jsx("button",{disabled:!0,className:"p-1 text-gray-400 cursor-not-allowed rounded",title:"Вы можете редактировать только свои статусы",children:s.jsx(Gt,{className:"w-3 h-3"})}),s.jsx("button",{disabled:!0,className:"p-1 text-gray-400 cursor-not-allowed rounded",title:"Вы можете удалять только свои статусы",children:s.jsx(At,{className:"w-3 h-3"})})]})})]}):s.jsx("span",{className:`text-sm ${G}`,children:"—"})},ke)}),s.jsx("td",{className:`px-4 py-3 text-sm ${y} text-center`,children:s.jsxs("div",{className:"space-y-1",children:[s.jsxs("div",{children:["Часов: ",ee.totalHours.toFixed(1)]}),s.jsxs("div",{children:["Выходных: ",ee.daysOff]}),s.jsxs("div",{children:["Больничных: ",ee.sickDays]}),s.jsxs("div",{children:["Отпусков: ",ee.vacationDays]})]})})]},F.id)})})]})})})]})},Sk=({selectedUserId:r,slotFilter:e,onEditSlot:t,onEditStatus:n,refreshKey:a})=>{const{theme:i}=ct(),{user:l}=Dt(),{isAdmin:c}=Bt(),[d,h]=A.useState([]),[g,x]=A.useState([]),[p,E]=A.useState(new Date),[j,S]=A.useState(!0),k={1:"Dex",2:"Merc",3:"Xenia",4:"Olenka",5:"Sydney"},L={artyom:"1",adel:"2",kseniya:"3",olga:"4",anastasia:"5"},M=G=>{const V=Ee.find(F=>F.id===G)||Ee.find(F=>L[G]===F.id);return{member:V,displayName:k[(V==null?void 0:V.id)||G]||(V==null?void 0:V.name)||G}},T=gc(p);A.useEffect(()=>{O()},[r,p,a]),A.useEffect(()=>{const G=()=>{O()};return window.addEventListener("focus",G),()=>window.removeEventListener("focus",G)},[]);const O=async()=>{S(!0);try{const G=new Date(T[0]);G.setHours(0,0,0,0);const V=new Date(T[6]);V.setHours(23,59,59,999);const F=xe(G,"yyyy-MM-dd"),z=xe(V,"yyyy-MM-dd"),[ee,re]=await Promise.all([Fr(),Rr()]),oe=ee.filter(he=>he.date>=F&&he.date<=z),ke=re.filter(he=>{const Ce=he.date,H=he.endDate||he.date;return Ce<=z&&H>=F}),ye=r?oe.filter(he=>he.userId===r):oe,K=r?ke.filter(he=>he.userId===r):ke;console.log("Loaded slots (week view):",{weekStart:F,weekEnd:z,allSlotsCount:ee.length,weekSlotsCount:oe.length,filteredSlotsCount:ye.length,selectedUserId:r}),h(ye),x(K)}catch(G){console.error("Error loading data:",G)}finally{S(!1)}},ne=async G=>{var V;if(!c&&(l==null?void 0:l.id)!==((V=d.find(F=>F.id===G))==null?void 0:V.userId)){alert("Только администратор может удалять чужие слоты");return}confirm("Удалить слот?")&&(await hc(G),O())},ie=async(G,V)=>{if(!c&&(l==null?void 0:l.id)!==G.userId){alert("Только администратор может удалять чужие статусы");return}if(G.endDate&&V){const F=G.date,z=G.endDate;if(V===F){if(confirm("Удалить первый день диапазона? Остальные дни останутся.")){const ee=new Date(nr(F));ee.setDate(ee.getDate()+1);const re=xe(ee,"yyyy-MM-dd");await ni(G.id,{...G,date:re}),O()}return}if(V===z){if(confirm("Удалить последний день диапазона? Остальные дни останутся.")){const ee=new Date(nr(z));ee.setDate(ee.getDate()-1);const re=xe(ee,"yyyy-MM-dd");await ni(G.id,{...G,endDate:re}),O()}return}if(V>F&&V<z){if(confirm("Удалить этот день из диапазона? Диапазон будет разбит на две части.")){const ee=new Date(nr(V));ee.setDate(ee.getDate()-1);const re=xe(ee,"yyyy-MM-dd");await ni(G.id,{...G,endDate:re});const oe=new Date(nr(V));oe.setDate(oe.getDate()+1);const ke=xe(oe,"yyyy-MM-dd");await Ng({userId:G.userId,date:ke,endDate:z,type:G.type,comment:G.comment}),O()}return}}confirm("Удалить статус?")&&(await Eg(G.id),O())},I=G=>{const V=new Date;V.setHours(0,0,0,0);const F=new Date(G.date);if(F.setHours(0,0,0,0),F>V)return!0;if(F.getTime()===V.getTime()){const ee=new Date,re=ee.getHours()*60+ee.getMinutes();return G.slots.some(oe=>{if(oe.endDate){const he=new Date(oe.endDate);if(he.setHours(0,0,0,0),new Date(V).setHours(23,59,59),he>V)return!0;if(he.getTime()===V.getTime()){const[H,Se]=oe.end.split(":").map(Number);return H*60+Se>re}return!1}const[ke,ye]=oe.end.split(":").map(Number);return ke*60+ye>re})}return G.slots.some(ee=>{if(ee.endDate){const re=new Date(ee.endDate);return re.setHours(0,0,0,0),re>=V}return!1})},N=G=>{let V=d.filter(F=>F.date===G);return e!=="all"&&(V=V.filter(F=>{const z=I(F);return e==="upcoming"?z:e==="completed"?!z:!0})),V},b=G=>g.filter(V=>V.endDate?V.date<=G&&V.endDate>=G:V.date===G),f=G=>{const V=new Date(p);G==="prev"?V.setDate(V.getDate()-7):V.setDate(V.getDate()+7),E(V)};if(j)return s.jsx("div",{className:`rounded-lg p-8 text-center ${i==="dark"?"bg-[#1a1a1a]":"bg-white"}`,children:s.jsx("p",{className:i==="dark"?"text-gray-400":"text-gray-600",children:"Загрузка..."})});const w=i==="dark"?"text-white":"text-gray-900",_=i==="dark"?"text-gray-400":"text-gray-600",y={dayoff:"bg-amber-50 text-amber-900 border border-amber-200 shadow-inner dark:bg-amber-900/25 dark:text-amber-50 dark:border-amber-700",sick:"bg-orange-50 text-orange-900 border border-orange-200 shadow-inner dark:bg-orange-900/25 dark:text-orange-50 dark:border-orange-700",vacation:"bg-sky-50 text-sky-900 border border-sky-200 shadow-inner dark:bg-sky-900/25 dark:text-sky-50 dark:border-sky-700"};return s.jsxs("div",{className:`rounded-lg ${i==="dark"?"bg-[#1a1a1a]":"bg-white"} shadow-md overflow-hidden`,children:[s.jsxs("div",{className:`p-3 sm:p-4 border-b ${i==="dark"?"border-gray-800":"border-gray-200"} flex flex-col gap-2 sm:gap-3 sm:flex-row sm:items-center sm:justify-between`,children:[s.jsxs("button",{onClick:()=>f("prev"),className:`w-full sm:w-auto px-3 sm:px-4 py-2 text-xs sm:text-sm md:text-base rounded-lg transition-colors touch-manipulation active:scale-95 flex items-center justify-center gap-2 whitespace-nowrap ${i==="dark"?"border border-gray-700 bg-gray-900/60 hover:border-[#4E6E49]/50 hover:bg-gray-900":"border border-gray-200 bg-white hover:border-[#4E6E49]/40 hover:bg-gray-50"}`,children:[s.jsx("span",{children:"←"}),s.jsx("span",{children:"Предыдущая неделя"})]}),s.jsxs("span",{className:`${w} font-semibold text-center text-xs sm:text-sm md:text-base whitespace-nowrap`,children:[xe(T[0],"dd.MM.yyyy")," - ",xe(T[6],"dd.MM.yyyy")]}),s.jsxs("button",{onClick:()=>f("next"),className:`w-full sm:w-auto px-3 sm:px-4 py-2 text-xs sm:text-sm md:text-base rounded-lg transition-colors touch-manipulation active:scale-95 flex items-center justify-center gap-2 whitespace-nowrap ${i==="dark"?"border border-gray-700 bg-gray-900/60 hover:border-[#4E6E49]/50 hover:bg-gray-900":"border border-gray-200 bg-white hover:border-[#4E6E49]/40 hover:bg-gray-50"}`,children:[s.jsx("span",{children:"Следующая неделя"}),s.jsx("span",{children:"→"})]})]}),s.jsx("div",{className:"p-3 sm:p-4 space-y-3 sm:space-y-4",children:T.map(G=>{const V=xe(G,"yyyy-MM-dd"),F=N(V),z=b(V);return s.jsxs("div",{className:`rounded-xl p-4 sm:p-5 border ${i==="dark"?"bg-gray-800/70 border-gray-700":"bg-gray-50 border-gray-200"}`,children:[s.jsx("h3",{className:`text-lg font-semibold mb-3 ${w}`,children:xe(G,"dd.MM.yyyy")}),s.jsxs("div",{className:"space-y-3 sm:space-y-4",children:[z.map(ee=>{const{displayName:re}=M(ee.userId);return s.jsxs("div",{className:`relative flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 p-4 rounded-2xl border-2 transition-all duration-300 hover:shadow-xl backdrop-blur text-center sm:text-left ring-1 ring-inset ring-black/5 dark:ring-white/5 ${y[ee.type]}`,children:[s.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2 justify-center sm:justify-start w-full",children:[s.jsx("span",{className:"font-semibold text-base sm:text-lg",children:re}),s.jsx("span",{className:"inline-flex items-center gap-2 px-3 py-1 rounded-full bg-white/70 dark:bg-white/10 text-xs sm:text-sm font-semibold",children:ee.type==="dayoff"?"Выходной":ee.type==="sick"?"Больничный":"Отпуск"}),ee.comment&&s.jsxs("div",{className:"relative group/status-comment self-center sm:self-auto",children:[s.jsx(rr,{className:"w-4 h-4 text-current cursor-help"}),s.jsx("div",{className:"pointer-events-none absolute bottom-full left-1/2 sm:left-0 -translate-x-1/2 sm:translate-x-0 mb-2 p-2 bg-[#0A0A0A] text-white text-xs rounded-lg opacity-0 group-hover/status-comment:opacity-100 transition-opacity z-10 whitespace-nowrap",children:ee.comment})]})]}),s.jsx("div",{className:"flex gap-2 justify-center sm:justify-end w-full",children:c||(l==null?void 0:l.id)===ee.userId?s.jsxs(s.Fragment,{children:[s.jsx("button",{onClick:()=>n(ee),className:`p-1 rounded transition-colors ${i==="dark"?"bg-white/10 hover:bg-white/20 text-white":"bg-white border border-gray-200 text-gray-700 hover:bg-gray-100"}`,children:s.jsx(Gt,{className:"w-4 h-4 text-current"})}),s.jsx("button",{onClick:()=>ie(ee,V),className:`p-1 rounded transition-colors ${i==="dark"?"bg-white/10 hover:bg-white/20 text-white":"bg-white border border-gray-200 text-gray-700 hover:bg-gray-100"}`,children:s.jsx(At,{className:"w-4 h-4 text-current"})})]}):s.jsxs(s.Fragment,{children:[s.jsx("button",{disabled:!0,className:`p-1 cursor-not-allowed rounded ${i==="dark"?"bg-white/5 text-white/60":"bg-gray-100 text-gray-400 border border-gray-200"}`,title:"Вы можете редактировать только свои статусы",children:s.jsx(Gt,{className:"w-4 h-4 text-current opacity-60"})}),s.jsx("button",{disabled:!0,className:`p-1 cursor-not-allowed rounded ${i==="dark"?"bg-white/5 text-white/60":"bg-gray-100 text-gray-400 border border-gray-200"}`,title:"Вы можете удалять только свои статусы",children:s.jsx(At,{className:"w-4 h-4 text-current opacity-60"})})]})})]},ee.id)}),F.map(ee=>{const{member:re,displayName:oe}=M(ee.userId),ke=I(ee),ye=ke?"bg-gradient-to-r from-emerald-500 to-teal-600 border-emerald-300/40":"bg-gradient-to-r from-slate-500 to-slate-700 border-slate-300/40",K=ke?br:Di;return s.jsxs("div",{className:`group relative space-y-2 sm:space-y-3 p-3 sm:p-4 ${ye} rounded-lg sm:rounded-xl shadow-xl border-2 transition-all duration-300 hover:shadow-2xl active:scale-[0.98] sm:hover:scale-[1.03] mb-2 sm:mb-3 ${ke?"hover:border-emerald-200/80 ring-2 ring-emerald-200/40 hover:ring-4 hover:ring-emerald-200/60":"hover:border-slate-200/80 ring-2 ring-slate-200/40 hover:ring-4 hover:ring-slate-200/60"}`,children:[s.jsxs("div",{className:"flex items-center justify-between border-b border-white/20 pb-2 sm:pb-3",children:[s.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 min-w-0 flex-1",children:[s.jsxs("div",{className:"relative flex-shrink-0 group/avatar",children:[re!=null&&re.avatar?s.jsx("img",{src:re.avatar,alt:oe,className:`w-8 h-8 sm:w-9 sm:h-9 md:w-10 md:h-10 lg:w-11 lg:h-11 rounded-full object-cover border-2 shadow-xl transition-all duration-300 group-hover/avatar:scale-110 group-hover/avatar:shadow-2xl ${ke?"border-white/50 ring-2 ring-white/40 ring-offset-2 ring-offset-emerald-400/30 group-hover/avatar:ring-4 group-hover/avatar:ring-white/60":"border-white/40 ring-2 ring-white/30 ring-offset-2 ring-offset-slate-400/30 group-hover/avatar:ring-4 group-hover/avatar:ring-white/50"}`,onError:he=>{const Ce=he.target;Ce.style.display="none";const H=Ce.nextElementSibling;H&&(H.style.display="flex")}}):null,s.jsx("div",{className:`w-8 h-8 sm:w-9 sm:h-9 md:w-10 md:h-10 lg:w-11 lg:h-11 rounded-full flex items-center justify-center font-bold text-xs sm:text-sm transition-all duration-300 shadow-xl group-hover/avatar:scale-110 group-hover/avatar:shadow-2xl ${ke?"bg-white/25 backdrop-blur-md border-2 border-white/40 ring-2 ring-white/30 group-hover/avatar:ring-4 group-hover/avatar:ring-white/60":"bg-white/15 backdrop-blur-md border-2 border-white/30 ring-2 ring-white/20 group-hover/avatar:ring-4 group-hover/avatar:ring-white/50"} ${re!=null&&re.avatar?"absolute inset-0 hidden":""}`,children:oe.charAt(0).toUpperCase()}),s.jsx("div",{className:`absolute -bottom-0.5 -right-0.5 w-2.5 h-2.5 sm:w-3 sm:h-3 md:w-3.5 md:h-3.5 rounded-full border border-white sm:border-2 shadow-lg animate-pulse opacity-0 group-hover/avatar:opacity-100 transition-opacity duration-300 ${ke?"bg-emerald-300":"bg-slate-400"}`})]}),s.jsx("span",{className:"text-white font-bold text-sm sm:text-base group-hover:scale-105 transition-transform duration-300 truncate",children:oe})]}),s.jsx("div",{className:"flex gap-2",children:c||(l==null?void 0:l.id)===ee.userId?s.jsxs(s.Fragment,{children:[s.jsx("button",{onClick:()=>t(ee),className:"p-1.5 bg-white/20 hover:bg-white/30 rounded-lg transition-colors",children:s.jsx(Gt,{className:"w-4 h-4 text-white"})}),s.jsx("button",{onClick:()=>ne(ee.id),className:"p-1.5 bg-white/20 hover:bg-white/30 rounded-lg transition-colors",children:s.jsx(At,{className:"w-4 h-4 text-white"})})]}):s.jsxs(s.Fragment,{children:[s.jsx("button",{disabled:!0,className:"p-1.5 bg-white/10 cursor-not-allowed rounded-lg",title:"Вы можете редактировать только свои слоты",children:s.jsx(Gt,{className:"w-4 h-4 text-white/50"})}),s.jsx("button",{disabled:!0,className:"p-1.5 bg-white/10 cursor-not-allowed rounded-lg",title:"Вы можете удалять только свои слоты",children:s.jsx(At,{className:"w-4 h-4 text-white/50"})})]})})]}),s.jsxs("div",{className:"space-y-2",children:[ee.slots.map((he,Ce)=>s.jsxs("div",{className:"space-y-1.5",children:[s.jsx("div",{className:`bg-white/25 backdrop-blur-md rounded-md sm:rounded-lg px-2 sm:px-3 py-1.5 sm:py-2 border-2 transition-all duration-300 hover:scale-105 hover:shadow-xl ${ke?"border-white/40 ring-2 ring-white/20 hover:border-white/60 hover:ring-4 hover:ring-white/40":"border-white/30 ring-2 ring-white/10 hover:border-white/50 hover:ring-4 hover:ring-white/30"}`,children:s.jsxs("div",{className:"flex items-center gap-1.5 sm:gap-2 flex-wrap",children:[s.jsx(K,{className:`w-3.5 h-3.5 sm:w-4 sm:h-4 text-white flex-shrink-0 ${ke?"animate-pulse":""}`}),s.jsxs("span",{className:"text-white font-bold text-xs sm:text-sm whitespace-nowrap",children:[he.start," - ",he.end]}),he.endDate&&s.jsxs("span",{className:"text-white/80 font-medium text-[10px] sm:text-xs whitespace-nowrap",children:["(до ",xe(new Date(he.endDate),"dd.MM"),")"]})]})}),he.breaks&&he.breaks.length>0&&s.jsxs("div",{className:"space-y-1 w-full",children:[s.jsx("div",{className:`text-[10px] ${i==="dark"?"text-gray-300":"text-gray-700"} font-medium text-center sm:text-left`,children:"Перерывы:"}),he.breaks.map((H,Se)=>s.jsx("div",{className:`${i==="dark"?"bg-gray-700/95":"bg-white"} ${i==="dark"?"text-gray-200":"text-gray-900"} border-2 ${i==="dark"?"border-orange-500/60":"border-orange-300"} rounded-md sm:rounded-lg px-2 sm:px-3 py-1 sm:py-1.5 text-[10px] sm:text-xs font-semibold shadow-lg transition-all duration-300 hover:scale-105 hover:shadow-xl ${i==="dark"?"hover:border-orange-400/80 hover:shadow-orange-500/30 ring-2 ring-orange-500/20 hover:ring-4 hover:ring-orange-400/40":"hover:border-orange-400 hover:shadow-orange-400/30 ring-2 ring-orange-300/20 hover:ring-4 hover:ring-orange-300/40"} w-full`,children:s.jsxs("span",{className:"flex items-center gap-1 sm:gap-1.5 justify-center flex-wrap w-full",children:[s.jsx("span",{className:`w-1 h-1 sm:w-1.5 sm:h-1.5 rounded-full ${i==="dark"?"bg-orange-400":"bg-orange-500"} animate-pulse flex-shrink-0`}),s.jsxs("span",{className:"whitespace-nowrap",children:[H.start," - ",H.end]})]})},Se))]})]},Ce)),ee.comment&&s.jsxs("div",{className:"relative group/slot-comment flex items-center gap-2 pt-2",children:[s.jsx(rr,{className:"w-4 h-4 text-white cursor-help"}),s.jsx("div",{className:"pointer-events-none absolute bottom-full left-0 mb-2 p-2 bg-[#0A0A0A] text-white text-xs rounded-lg opacity-0 group-hover/slot-comment:opacity-100 transition-opacity z-10 whitespace-nowrap",children:ee.comment})]})]})]},ee.id)}),F.length===0&&z.length===0&&s.jsx("p",{className:`text-sm ${_}`,children:"Нет данных"})]})]},V)})})]})},Ak=({slot:r,onClose:e,onSave:t})=>{var Ye;const{user:n}=Dt(),{theme:a}=ct(),{isAdmin:i}=Bt(),l=a==="dark"?"text-white":"text-gray-900",c=(r==null?void 0:r.date)||xe(new Date,"yyyy-MM-dd"),[d,h]=A.useState(c),[g,x]=A.useState(r!=null&&r.userId?[r.userId]:n!=null&&n.id?[n.id]:[]),[p,E]=A.useState(((Ye=r==null?void 0:r.slots)==null?void 0:Ye.map(R=>{const X=R;return X.break&&!X.breaks?{...R,breaks:[X.break]}:R}))||[]),[j,S]=A.useState(""),[k,L]=A.useState(""),[M,T]=A.useState(!1),[O,ne]=A.useState(""),[ie,I]=A.useState(""),[N,b]=A.useState(null),[f,w]=A.useState(null),[_,y]=A.useState(null),[G,V]=A.useState(null),[F,z]=A.useState((r==null?void 0:r.comment)||""),[ee,re]=A.useState(!1),[oe,ke]=A.useState([]),[ye,K]=A.useState("single"),[he,Ce]=A.useState(c),[H,Se]=A.useState(c),[Ne,Z]=A.useState(c),[Re,J]=A.useState([]),[se,q]=A.useState(""),[te,ge]=A.useState(!1);xn();const W=["Пн","Вт","Ср","Чт","Пт","Сб","Вс"],ue=i&&!r;A.useEffect(()=>{console.log("SlotForm mounted, user:",n==null?void 0:n.name,"slots count:",p.length)},[]),A.useEffect(()=>{if(ee&&d){const R=new Date(d),X=R.getDay()===0?6:R.getDay()-1;ke([X])}},[ee,d]),A.useEffect(()=>{ye!=="single"&&(re(!1),ke([]))},[ye]);const ze=()=>{var He;if(!j||!k){q("Заполните время начала и окончания");return}const R=M&&j>=k;if(!R&&j>=k){q('Время окончания должно быть позже времени начала. Включите "Переходит через полночь" для слотов, переходящих на следующий день.');return}let X;if(R&&d){const Ie=new Date(d);Ie.setDate(Ie.getDate()+1),X=xe(Ie,"yyyy-MM-dd")}const be=N!==null?((He=p[N])==null?void 0:He.breaks)||[]:[],Ve={start:j,end:k,...X&&{endDate:X},breaks:be};if(N!==null){const Ie=[...p];Ie[N]=Ve,E(Ie)}else E([...p,Ve]);S(""),L(""),T(!1),ne(""),I(""),b(null),w(null),q("")},We=R=>{const X=p[R];if(!X)return;const be=!!X.endDate||Zt(X.end)<=Zt(X.start);S(X.start),L(X.end),T(be),b(R),w(null),y(null),V(null),ne(""),I(""),q("")},Pe=()=>{b(null),S(""),L(""),T(!1),q("")},je=R=>{if(!O||!ie){q("Заполните время начала и окончания перерыва");return}const X=p[R];if(!X)return;if(O>=ie){q("Время окончания перерыва должно быть позже времени начала");return}const be=Zt(O),Ve=Zt(ie),He=Zt(X.start),Ie=Zt(X.end),ht=X.endDate||Ie<=He;let Ge=!1;if(ht){const at=be>=He&&be<1440&&Ve>be&&Ve<=1440&&Ve>be,wt=be>=0&&be<=Ie&&Ve>be&&Ve<=Ie,Ur=be>=He&&be<1440&&Ve>0&&Ve<=Ie&&be>Ve;Ge=at||wt||Ur}else Ge=be>=He&&Ve<=Ie&&Ve>be;if(!Ge){q(`Перерыв должен быть в пределах времени слота (${X.start} - ${X.end})`);return}const Xe=X.breaks||[];for(let tt=0;tt<Xe.length;tt++){if(_===R&&G===tt)continue;const at=Xe[tt];if(O>=at.start&&O<at.end||ie>at.start&&ie<=at.end||O<=at.start&&ie>=at.end){q("Перерывы не должны пересекаться");return}}let ft;_===R&&G!==null?(ft=[...Xe],ft[G]={start:O,end:ie},ft.sort((tt,at)=>tt.start.localeCompare(at.start))):ft=[...Xe,{start:O,end:ie}].sort((tt,at)=>tt.start.localeCompare(at.start));const fe=[...p];fe[R]={...X,breaks:ft},E(fe),ne(""),I(""),w(null),y(null),V(null),q("")},_e=(R,X)=>{const be=p[R];if(!be||!be.breaks||!be.breaks[X])return;const Ve=be.breaks[X];y(R),V(X),w(R),ne(Ve.start),I(Ve.end),q("")},Le=()=>{ne(""),I(""),w(null),y(null),V(null),q("")},nt=(R,X)=>{const be=p[R];if(!be||!be.breaks)return;const Ve=be.breaks.filter((Ie,ht)=>ht!==X),He=[...p];He[R]={...be,breaks:Ve.length>0?Ve:void 0},E(He)},et=R=>{E(p.filter((X,be)=>be!==R)),N===R&&Pe()},U=R=>{oe.includes(R)?ke(oe.filter(X=>X!==R)):ke([...oe,R])},D=R=>{x(X=>X.includes(R)?X.filter(be=>be!==R):[...X,R])},P=()=>{g.length===Ee.length?x([]):x(Ee.map(R=>R.id))},Y=()=>{if(!Ne)return;const R=Ug([...Re,Ne]);J(R),Z("")},pe=R=>{J(X=>X.filter(be=>be!==R))},C=()=>{if(ue){if(ye==="range")return ol(he,H);if(ye==="multiple")return Re}return[d]},De=()=>r?[r.userId]:ue?g:i&&!n?g.length>0?g:[]:n!=null&&n.id?[n.id]:[],$=R=>{var X;return((X=Ee.find(be=>be.id===R))==null?void 0:X.name)||R},le=async(R,X)=>{const Ve=(await Fr(void 0,R)).filter(He=>He.id!==(r==null?void 0:r.id));for(const He of X)for(const Ie of Ve)if(jk(He,Ie.slots[0])&&Ie.participants.length>=3)return`Слот ${He.start}-${He.end} уже занят максимальным количеством участников (3)`;return null},we=async()=>{if(console.log("handleSave called"),!i&&!n){console.log("No user found"),q("Пользователь не найден");return}if(p.length===0){q("Добавьте хотя бы один временной интервал");return}if(r&&!i&&n&&r.userId!==n.id){q("Вы можете редактировать только свои слоты"),ge(!1);return}const R=De();if(R.length===0){q("Выберите хотя бы одного участника");return}const X=C();if(X.length===0){q("Выберите даты");return}const be=new Date;be.setHours(0,0,0,0);const Ve=xe(be,"yyyy-MM-dd"),He=Ge=>Ge<Ve,Ie=(Ge,Xe)=>{const ft=new Date(Ge),fe=new Date(Xe);return ft.setHours(0,0,0,0),fe.setHours(0,0,0,0),Math.round((fe.getTime()-ft.getTime())/(1e3*60*60*24))},ht=async(Ge,Xe,ft=[Ge])=>{const fe=p.map(wt=>{const Ur=!wt.endDate&&Zt(wt.end)<=Zt(wt.start),Vs=wt.endDate?Ie(d,wt.endDate):Ur?1:0;if(Vs>0){const cr=new Date(Xe);return cr.setDate(cr.getDate()+Vs),{...wt,endDate:xe(cr,"yyyy-MM-dd")}}return{...wt,...wt.endDate?{endDate:wt.endDate}:{}}}),tt=await le(Xe,fe);if(tt)throw new Error(`[${$(Ge)} • ${xe(new Date(Xe),"dd.MM.yyyy")}] ${tt}`);const at={userId:Ge,date:Xe,slots:fe,...F&&{comment:F},participants:ft};r?await t2(r.id,at):await e2(at)};console.log("Starting save process..."),q(""),ge(!0);try{if(r){await ht(r.userId,d,r.participants||[r.userId]),t();return}if(ee&&oe.length>0){const Ge=new Date(d),Xe=Ge.getMonth(),ft=Ge.getFullYear(),fe=new Date(ft,Xe+1,0).getDate();for(let tt=1;tt<=fe;tt++){const at=new Date(ft,Xe,tt),wt=at.getDay()===0?6:at.getDay()-1;if(oe.includes(wt)){const Ur=xe(at,"yyyy-MM-dd");if(He(Ur))continue;for(const Vs of R)await ht(Vs,Ur)}}}else if(ue&&ye!=="single")for(const Ge of X)for(const Xe of R)await ht(Xe,Ge);else for(const Ge of R)await ht(Ge,d);try{await kg()}catch(Ge){console.error("Cleanup after slot save failed:",Ge)}t()}catch(Ge){console.error("Error saving slot:",Ge);const Xe=Ge.message||Ge.code||"Ошибка при сохранении";q(Xe)}finally{ge(!1)}},me=ue?C():[d],Me=g.map(R=>$(R)).join(", "),Oe=p.map(R=>`${R.start}–${R.end}${R.endDate?" (+1)":""}`);return s.jsx("div",{className:"fixed inset-0 bg-slate-950/75 backdrop-blur-xl flex items-start sm:items-center justify-center z-[70] p-4 sm:p-6 touch-manipulation overflow-y-auto",children:s.jsx("div",{className:`w-full max-w-5xl rounded-3xl shadow-[0_24px_80px_rgba(0,0,0,0.45)] border ${a==="dark"?"bg-gradient-to-br from-[#0c1320] via-[#0b1220] to-[#08111b] border-white/10":"bg-gradient-to-br from-white via-slate-50 to-white border-slate-200"} max-h-[90vh] overflow-y-auto`,children:s.jsxs("div",{className:"p-4 sm:p-6 lg:p-7 flex flex-col h-full min-h-0 overflow-y-auto",children:[s.jsxs("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between",children:[s.jsxs("div",{className:"space-y-1",children:[s.jsx("div",{className:"flex items-center gap-2 text-xs font-semibold text-[#4E6E49] tracking-tight",children:s.jsx("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full bg-[#4E6E49]/10 text-[#4E6E49] border border-[#4E6E49]/30",children:r?"Редактирование слота":"Создание слота"})}),s.jsx("h3",{className:`text-2xl sm:text-3xl font-bold ${l}`,children:r?"Редактировать слот":"Добавить слот"})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsxs("div",{className:`px-3 py-2 rounded-xl border text-xs sm:text-sm ${a==="dark"?"border-white/10 bg-white/5 text-gray-200":"border-slate-200 bg-slate-50 text-slate-700"}`,children:[r?"Редактирование":"Создание"," · ",p.length||0," интервал(ов)"]}),s.jsx("button",{onClick:e,className:`p-2.5 rounded-full border ${a==="dark"?"border-white/10 text-gray-200 hover:bg-white/5":"border-slate-200 text-slate-600 hover:bg-slate-100"} transition-colors touch-manipulation`,"aria-label":"Закрыть",children:s.jsx(Qt,{className:"w-4 h-4 sm:w-5 sm:h-5"})})]})]}),s.jsxs("div",{className:"mt-5 grid lg:grid-cols-[0.9fr_1.6fr] gap-4 lg:gap-6 flex-1 min-h-0",children:[s.jsxs("aside",{className:`rounded-2xl border ${a==="dark"?"border-white/10 bg-white/5":"border-slate-200 bg-white"} p-4 sm:p-5 space-y-4 sticky top-0 self-start max-h-full overflow-y-auto`,children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("p",{className:"text-sm font-semibold",children:"Навигация"}),s.jsx("span",{className:"text-[11px] uppercase tracking-wide text-[#4E6E49] font-semibold",children:"4 шага"})]}),s.jsx("div",{className:"space-y-2",children:[{label:"Участники",detail:Me||"Не выбрано",done:g.length>0||!!r},{label:"Даты",detail:me.slice(0,2).map(R=>xe(R,"dd.MM")).join(", ")||"Выберите дату",done:me.length>0},{label:"Время",detail:Oe.slice(0,2).join(" · ")||"Добавьте интервал",done:p.length>0},{label:"Комментарий",detail:F?"Заполнен":"Необязателен",done:!!F}].map((R,X)=>s.jsxs("div",{className:`flex items-start gap-3 rounded-xl border px-3 py-3 ${a==="dark"?"border-white/10 bg-white/5":"border-slate-200 bg-slate-50"}`,children:[s.jsx("span",{className:`mt-0.5 inline-flex h-6 w-6 items-center justify-center rounded-full text-xs font-bold ${R.done?"bg-[#4E6E49] text-white":a==="dark"?"bg-slate-800 text-gray-300":"bg-slate-200 text-slate-700"}`,children:X+1}),s.jsxs("div",{className:"flex-1",children:[s.jsx("p",{className:"text-sm font-semibold",children:R.label}),s.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 truncate",children:R.detail})]})]},R.label))})]}),s.jsxs("div",{className:"space-y-4 overflow-y-auto overscroll-contain pr-1 pb-6 flex-1 min-h-0",children:[ue&&s.jsxs("div",{children:[s.jsx("label",{className:`block text-xs sm:text-sm font-medium mb-2 ${a==="dark"?"text-gray-300":"text-gray-700"}`,children:"Участники"}),s.jsxs("div",{className:"space-y-3",children:[s.jsx("div",{className:"flex flex-wrap gap-2",children:Ee.map(R=>s.jsxs("label",{className:`px-3 py-1.5 rounded-full border cursor-pointer text-sm flex items-center gap-2 ${g.includes(R.id)?"bg-[#4E6E49] border-[#4E6E49] text-white":a==="dark"?"bg-gray-700 border-gray-800 text-gray-200":"bg-gray-100 border-gray-300 text-gray-700"}`,children:[s.jsx("input",{type:"checkbox",checked:g.includes(R.id),onChange:()=>D(R.id),className:"hidden"}),R.name]},R.id))}),s.jsx("button",{type:"button",onClick:P,className:"text-sm text-[#4E6E49] hover:text-[#4E6E49]",children:g.length===Ee.length?"Снять выделение":"Выбрать всех"})]})]}),ue&&s.jsxs("div",{children:[s.jsx("p",{className:`text-xs sm:text-sm font-medium mb-2 ${a==="dark"?"text-gray-300":"text-gray-700"}`,children:"Формат выбора дат"}),s.jsx("div",{className:"flex flex-wrap gap-4",children:[{value:"single",label:"Один день"},{value:"range",label:"Диапазон дат"},{value:"multiple",label:"Конкретные даты"}].map(R=>s.jsxs("label",{className:"flex items-center gap-2 text-sm cursor-pointer",children:[s.jsx("input",{type:"radio",value:R.value,checked:ye===R.value,onChange:X=>K(X.target.value)}),s.jsx("span",{className:a==="dark"?"text-gray-200":"text-gray-700",children:R.label})]},R.value))})]}),(!ue||ye==="single")&&s.jsxs("div",{children:[s.jsx("label",{className:`block text-xs sm:text-sm font-medium mb-2 ${a==="dark"?"text-gray-300":"text-gray-700"}`,children:"Дата"}),s.jsx("input",{type:"date",value:d,onChange:R=>h(R.target.value),className:`w-full px-3 sm:px-4 py-2 sm:py-2.5 text-sm sm:text-base rounded-lg border touch-manipulation ${a==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`})]}),ue&&ye==="range"&&s.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:`block text-xs sm:text-sm font-medium mb-2 ${a==="dark"?"text-gray-300":"text-gray-700"}`,children:"Начало диапазона"}),s.jsx("input",{type:"date",value:he,onChange:R=>Ce(R.target.value),className:`w-full px-3 sm:px-4 py-2 sm:py-2.5 text-sm sm:text-base rounded-lg border touch-manipulation ${a==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`})]}),s.jsxs("div",{children:[s.jsx("label",{className:`block text-xs sm:text-sm font-medium mb-2 ${a==="dark"?"text-gray-300":"text-gray-700"}`,children:"Конец диапазона"}),s.jsx("input",{type:"date",value:H,min:he,onChange:R=>Se(R.target.value),className:`w-full px-3 sm:px-4 py-2 sm:py-2.5 text-sm sm:text-base rounded-lg border touch-manipulation ${a==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`})]})]}),ue&&ye==="multiple"&&s.jsxs("div",{children:[s.jsx("label",{className:`block text-xs sm:text-sm font-medium mb-2 ${a==="dark"?"text-gray-300":"text-gray-700"}`,children:"Выбранные даты"}),s.jsxs("div",{className:"flex flex-col gap-3",children:[s.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[s.jsx("input",{type:"date",value:Ne,onChange:R=>Z(R.target.value),className:`flex-1 px-3 sm:px-4 py-2 sm:py-2.5 text-sm sm:text-base rounded-lg border touch-manipulation ${a==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`}),s.jsx("button",{type:"button",onClick:Y,className:"px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg transition-colors",children:"Добавить"})]}),Re.length>0?s.jsx("div",{className:"flex flex-wrap gap-2",children:Re.map(R=>s.jsxs("span",{className:"inline-flex items-center gap-2 px-3 py-1.5 rounded-full bg-gray-100 text-gray-800 text-sm",children:[xe(R,"dd.MM.yyyy"),s.jsx("button",{type:"button",onClick:()=>pe(R),className:"text-red-500 hover:text-red-600",children:"x"})]},R))}):s.jsx("p",{className:"text-sm text-gray-500",children:"Пока не выбрано ни одной даты"})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:`block text-xs sm:text-sm font-medium mb-2 ${a==="dark"?"text-gray-300":"text-gray-700"}`,children:"Временные слоты"}),s.jsxs("div",{className:"space-y-2 mb-2",children:[s.jsx("div",{className:"flex flex-col sm:flex-row gap-2",children:s.jsxs("div",{className:"flex gap-2 flex-1",children:[s.jsx("input",{type:"time",value:j,onChange:R=>S(R.target.value),className:`flex-1 px-3 sm:px-4 py-2 sm:py-2.5 text-sm sm:text-base rounded-lg border touch-manipulation ${a==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`,placeholder:"Начало"}),s.jsx("span",{className:"mx-1 sm:mx-2 text-gray-500 text-sm sm:text-base flex items-center",children:"—"}),s.jsx("input",{type:"time",value:k,onChange:R=>L(R.target.value),className:`flex-1 px-3 sm:px-4 py-2 sm:py-2.5 text-sm sm:text-base rounded-lg border touch-manipulation ${a==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`,placeholder:"Окончание"})]})}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("input",{type:"checkbox",id:"crossMidnight",checked:M,onChange:R=>{T(R.target.checked)},className:`w-4 h-4 rounded border-2 ${a==="dark"?"border-gray-800 bg-gray-700 checked:bg-[#4E6E49] checked:border-[#4E6E49]":"border-gray-300 bg-white checked:bg-[#4E6E49] checked:border-[#4E6E49]"} focus:ring-2 focus:ring-[#4E6E49] cursor-pointer touch-manipulation`}),s.jsx("label",{htmlFor:"crossMidnight",className:`text-xs sm:text-sm font-medium cursor-pointer ${a==="dark"?"text-gray-300":"text-gray-700"}`,children:"Переходит через полночь (на следующий день)"})]}),s.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[s.jsx("button",{onClick:ze,className:"w-full px-4 py-2 bg-[#4E6E49] hover:bg-[#4E6E49] text-white rounded-lg transition-colors flex items-center justify-center gap-2",children:N!==null?s.jsxs(s.Fragment,{children:[s.jsx(Gt,{className:"w-4 h-4"}),"Сохранить слот"]}):s.jsxs(s.Fragment,{children:[s.jsx(li,{className:"w-4 h-4"}),"Добавить слот"]})}),N!==null&&s.jsx("button",{onClick:Pe,className:`w-full sm:w-auto px-4 py-2 rounded-lg border ${a==="dark"?"border-gray-700 text-gray-200 hover:bg-gray-700":"border-gray-300 text-gray-800 hover:bg-gray-100"}`,children:"Отмена"})]})]}),s.jsx("div",{className:"space-y-3",children:p.map((R,X)=>s.jsxs("div",{className:`flex flex-col gap-2 p-3 rounded-lg ${a==="dark"?"bg-gray-700":"bg-gray-100"}`,children:[s.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-2",children:[s.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[s.jsxs("span",{className:l,children:[R.start," - ",R.end]}),R.endDate&&s.jsxs("span",{className:`text-xs px-2 py-0.5 rounded-full ${a==="dark"?"bg-blue-500/20 text-blue-400 border border-blue-500/30":"bg-blue-100 text-blue-700 border border-blue-300"}`,children:["до ",xe(new Date(R.endDate),"dd.MM.yyyy")]})]}),s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx("button",{onClick:()=>We(X),className:"p-1 text-blue-500 hover:bg-blue-500 hover:text-white rounded transition-colors flex-shrink-0",title:"Редактировать слот",children:s.jsx(Gt,{className:"w-4 h-4"})}),s.jsx("button",{onClick:()=>et(X),className:"p-1 text-red-500 hover:bg-red-500 hover:text-white rounded transition-colors flex-shrink-0",title:"Удалить слот",children:s.jsx(At,{className:"w-4 h-4"})})]})]}),R.breaks&&R.breaks.length>0&&s.jsxs("div",{className:"ml-4 space-y-1",children:[s.jsx("span",{className:`text-xs ${a==="dark"?"text-gray-400":"text-gray-600"}`,children:"Перерывы:"}),R.breaks.map((be,Ve)=>_===X&&G===Ve?null:s.jsxs("div",{className:"flex items-center justify-between gap-2",children:[s.jsxs("span",{className:`text-sm ${a==="dark"?"text-gray-300":"text-gray-700"}`,children:[be.start," - ",be.end]}),s.jsxs("div",{className:"flex gap-1",children:[s.jsx("button",{onClick:()=>_e(X,Ve),className:"p-1 text-blue-400 hover:bg-blue-400 hover:text-white rounded transition-colors",title:"Редактировать перерыв",children:s.jsx(Gt,{className:"w-3 h-3"})}),s.jsx("button",{onClick:()=>nt(X,Ve),className:"p-1 text-red-400 hover:bg-red-400 hover:text-white rounded transition-colors",title:"Удалить перерыв",children:s.jsx(Qt,{className:"w-3 h-3"})})]})]},Ve))]}),s.jsx("div",{className:"ml-4 space-y-2 border-t pt-2 border-gray-500 border-opacity-30",children:f===X?s.jsxs("div",{className:"space-y-2",children:[s.jsxs("div",{className:"flex gap-2",children:[s.jsx("input",{type:"time",value:O,onChange:be=>ne(be.target.value),className:`flex-1 px-3 py-1.5 text-sm rounded-lg border ${a==="dark"?"bg-gray-600 border-gray-500 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`,placeholder:"Начало"}),s.jsx("input",{type:"time",value:ie,onChange:be=>I(be.target.value),className:`flex-1 px-3 py-1.5 text-sm rounded-lg border ${a==="dark"?"bg-gray-600 border-gray-500 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`,placeholder:"Конец"})]}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx("button",{onClick:()=>je(X),className:"flex-1 px-3 py-1.5 text-sm bg-[#4E6E49] hover:bg-[#4E6E49] text-white rounded-lg transition-colors",children:_===X&&G!==null?"Сохранить":"Добавить перерыв"}),s.jsx("button",{onClick:Le,className:"px-3 py-1.5 text-sm bg-gray-500 hover:bg-gray-600 text-white rounded-lg transition-colors",children:"Отмена"})]})]}):s.jsxs("button",{onClick:()=>{w(X),ne(""),I(""),y(null),V(null),q("")},className:"w-full px-3 py-1.5 text-sm bg-blue-500 hover:bg-blue-600 text-white rounded-lg transition-colors flex items-center justify-center gap-1",children:[s.jsx(li,{className:"w-3 h-3"}),"Добавить перерыв"]})})]},X))}),p.length>0&&s.jsxs("p",{className:`text-sm mt-2 ${a==="dark"?"text-gray-400":"text-gray-600"}`,children:["Всего часов: ",eo(p).toFixed(1)]})]}),(!ue||ye==="single")&&s.jsxs("div",{className:"space-y-3",children:[s.jsxs("label",{className:"flex items-center gap-2",children:[s.jsx("input",{type:"checkbox",checked:ee,onChange:R=>{re(R.target.checked),q("")},className:"w-4 h-4"}),s.jsx("span",{className:`${a==="dark"?"text-gray-300":"text-gray-700"}`,children:"Добавить слоты на месяц вперед по дням"})]}),ee&&s.jsxs("div",{className:"ml-6",children:[s.jsx("p",{className:`text-sm mb-2 ${a==="dark"?"text-gray-400":"text-gray-600"}`,children:"Выберите день недели:"}),s.jsx("div",{className:"flex gap-2 flex-wrap",children:W.map((R,X)=>s.jsx("button",{onClick:()=>U(X),className:`px-3 py-1 rounded-lg transition-colors ${oe.includes(X)?"bg-[#4E6E49] text-white":a==="dark"?"bg-gray-700 text-gray-300":"bg-gray-200 text-gray-700"}`,children:R},X))})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:`block text-xs sm:text-sm font-medium mb-2 ${a==="dark"?"text-gray-300":"text-gray-700"}`,children:"Комментарий"}),s.jsx("textarea",{value:F,onChange:R=>z(R.target.value),rows:3,className:`w-full px-3 sm:px-4 py-2 sm:py-2.5 text-sm sm:text-base rounded-lg border touch-manipulation resize-y ${a==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`,placeholder:"Добавьте комментарий (необязательно)"})]}),se&&s.jsx("div",{className:"p-3 bg-red-500 text-white rounded-lg text-sm",children:se}),s.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 sm:gap-3 pt-2",children:[s.jsx("button",{onClick:R=>{console.log("Save button clicked!",{loading:te,slotsCount:p.length,disabled:te||p.length===0}),R.preventDefault(),we()},disabled:te||p.length===0,className:"flex-1 px-4 py-2.5 sm:py-2 bg-[#4E6E49] hover:bg-[#4E6E49] disabled:bg-gray-400 disabled:cursor-not-allowed text-white rounded-lg sm:rounded-xl transition-colors text-sm sm:text-base font-medium touch-manipulation active:scale-95 disabled:active:scale-100",children:te?"Сохранение...":"Сохранить"}),s.jsx("button",{onClick:e,className:`px-4 py-2.5 sm:py-2 rounded-lg sm:rounded-xl transition-colors text-sm sm:text-base font-medium touch-manipulation active:scale-95 ${a==="dark"?"bg-gray-700 hover:bg-gray-600 active:bg-gray-500":"bg-gray-200 hover:bg-gray-300 active:bg-gray-400"}`,children:"Отмена"})]})]})]})]})})})},Ck=({type:r,status:e,onClose:t,onSave:n})=>{const{user:a}=Dt(),{theme:i}=ct(),{isAdmin:l}=Bt(),c=i==="dark"?"text-white":"text-gray-900",d=(e==null?void 0:e.date)||xe(new Date,"yyyy-MM-dd"),[h,g]=A.useState(e!=null&&e.userId?[e.userId]:a!=null&&a.id?[a.id]:[]),[x,p]=A.useState(d),[E,j]=A.useState((e==null?void 0:e.endDate)||d),[S,k]=A.useState(!!(e!=null&&e.endDate)),[L,M]=A.useState((e==null?void 0:e.comment)||""),[T,O]=A.useState(""),[ne,ie]=A.useState(!1),[I,N]=A.useState("single"),[b,f]=A.useState(d),[w,_]=A.useState(d),[y,G]=A.useState(d),[V,F]=A.useState([]),z=l&&!e;xn(),A.useEffect(()=>{S||j(x)},[S,x]),A.useEffect(()=>{z&&I!=="single"&&k(!1)},[z,I]);const ee=W=>{g(ue=>ue.includes(W)?ue.filter(ze=>ze!==W):[...ue,W])},re=()=>{h.length===Ee.length?g([]):g(Ee.map(W=>W.id))},oe=()=>{if(!y)return;const W=Ug([...V,y]);F(W),G("")},ke=W=>{F(ue=>ue.filter(ze=>ze!==W))},ye=()=>e?[e.userId]:z?h:l&&!a?h.length>0?h:[]:a!=null&&a.id?[a.id]:[],K=W=>{var ue;return Ne[W]||((ue=Ee.find(ze=>ze.id===W))==null?void 0:ue.name)||W},he=()=>{if(z){if(I==="range")return r==="dayoff"?ol(b,w).map(ue=>({date:ue})):b&&w?[{date:b,endDate:w}]:[];if(I==="multiple")return r==="dayoff"?V.map(ue=>({date:ue})):V.map(ue=>({date:ue,endDate:ue}))}else if(r==="dayoff"){if(I==="range")return ol(b,w).map(ue=>({date:ue}));if(I==="multiple")return V.map(ue=>({date:ue}))}const W={date:x};return r!=="dayoff"&&(S||e!=null&&e.endDate)&&(W.endDate=E),[W]},Ce=async(W,ue,ze)=>{if(!l&&!a)return"Пользователь не найден";const We=new Date,Pe=new Date(ue),je=new Date(ze||ue);if(r==="dayoff"&&Ek(Pe,We))return"Нельзя установить выходной на сегодня. Выберите смену или возьмите больничный.";if(r==="sick"){const _e=new Date;_e.setHours(0,0,0,0);const Le=new Date(_e);Le.setDate(Le.getDate()+2);const nt=new Date(ue);if(nt.setHours(0,0,0,0),nt<_e||nt>Le)return"Больничный можно взять только на актуальную дату и + 2 суток. Нельзя выбрать заранее.";const et=Math.ceil((je.getTime()-Pe.getTime())/(1e3*60*60*24))+1;if(et<1)return"Больничный должен быть минимум на 1 день";if(et>14)return"Больничный может длиться не более 14 календарных дней в месяце";const U=new Date(Pe.getFullYear(),Pe.getMonth(),1),D=new Date(Pe.getFullYear(),Pe.getMonth()+1,0);if((await Rr(W)).filter(pe=>pe.type==="sick"&&pe.date>=xe(U,"yyyy-MM-dd")&&pe.date<=xe(D,"yyyy-MM-dd")).length+et>14)return"Больничный ограничен 14 днями в месяц"}if(r==="vacation"){if(Math.ceil((je.getTime()-Pe.getTime())/864e5)+1>14)return"Отпуск не может быть больше 14 дней в месяце";const Le=new Date(Pe.getFullYear(),0,1),nt=new Date(Pe.getFullYear(),11,31);if((await Rr(W)).filter(D=>D.type==="vacation"&&D.date>=xe(Le,"yyyy-MM-dd")&&D.date<=xe(nt,"yyyy-MM-dd")).length>=6)return"Не более 6 отпусков в год"}if(r==="dayoff"){const _e=new Date(Pe);_e.setDate(_e.getDate()-_e.getDay()+1);const Le=new Date(_e);Le.setDate(_e.getDate()+6);let et=(await Rr(W)).filter(Y=>Y.type==="dayoff"&&Y.date>=xe(_e,"yyyy-MM-dd")&&Y.date<=xe(Le,"yyyy-MM-dd"));if(e&&(et=et.filter(Y=>Y.id!==e.id)),et.length>=2)return"Выходные на неделе ограничены максимум 2 днями";const D=(await Rr()).filter(Y=>Y.type==="dayoff"&&Y.date===ue),P=new Set(D.map(Y=>Y.userId));if(e&&e.type==="dayoff"&&e.date===ue&&P.delete(e.userId),P.size>=3)return"На этот день уже установлено максимальное количество выходных (3 человека). Выберите другую дату."}return null},H=async()=>{if(console.log("handleSave called (DayStatusForm)"),!l&&!a){console.log("No user found"),O("Пользователь не найден");return}if(e&&!l&&a&&e.userId!==a.id){O("Вы можете редактировать только свои статусы"),ie(!1);return}const W=ye();if(W.length===0){O("Выберите хотя бы одного участника");return}const ue=he();if(ue.length===0){O("Выберите даты");return}const ze=async(We,Pe)=>{const je=await Ce(We,Pe.date,Pe.endDate);if(je)throw new Error(`[${K(We)} • ${xe(Pe.date,"dd.MM.yyyy")}] ${je}`);const _e={userId:We,date:Pe.date,type:r,...Pe.endDate&&{endDate:Pe.endDate},...L&&{comment:L}};e?await ni(e.id,_e):await Ng(_e)};console.log("Starting save process..."),O(""),ie(!0);try{if(e){const We={date:x};r!=="dayoff"&&(S||e.endDate)&&(We.endDate=E),await ze(e.userId,We),n();return}for(const We of W)for(const Pe of ue)await ze(We,Pe);n()}catch(We){console.error("Error saving day status:",We);const Pe=We.message||We.code||"Ошибка при сохранении";O(Pe)}finally{ie(!1)}},Se={dayoff:"bg-yellow-500",sick:"bg-purple-500",vacation:"bg-orange-500"},Ne={1:"Dex",2:"Merc",3:"Xenia",4:"Olenka",5:"Sydney"},Z=z&&I==="range"?[`${xe(b,"dd.MM")}–${xe(w,"dd.MM")}`]:z&&I==="multiple"?V.map(W=>xe(W,"dd.MM")):[xe(x,"dd.MM")],Re=h.map(W=>K(W)).join(", "),J=[{label:"Members",detail:Re||"Не выбрано",done:h.length>0||!!e,anchor:"#members"},{label:"Даты",detail:Z.slice(0,2).join(" · "),done:Z.length>0,anchor:"#dates"},{label:"Комментарий",detail:L?"Заполнен":"Необязателен",done:!!L,anchor:"#notes"}],se=Math.round(J.filter(W=>W.done).length/J.length*100),q=[{value:"single",label:"Один день",hint:"Быстрая отметка",icon:"•"},{value:"range",label:r==="dayoff"?"Диапазон (каждый день)":"Диапазон дат",hint:"Поток дней",icon:"⎯⎯"},{value:"multiple",label:"Конкретные даты",hint:"Точечный выбор",icon:"◎"}],ge=`${e?"Редактировать":"Добавить"} ${{dayoff:"выходной",sick:"больничный",vacation:"отпуск"}[r]}`;return s.jsx("div",{className:"fixed inset-0 bg-slate-950/80 backdrop-blur-xl flex items-start sm:items-center justify-center z-[70] p-4 sm:p-6 touch-manipulation overflow-y-auto overscroll-contain modal-scroll",children:s.jsx("div",{className:`w-full max-w-[52rem] rounded-3xl shadow-[0_28px_80px_rgba(0,0,0,0.55)] border ${i==="dark"?"bg-[#0b1222] border-white/10":"bg-white border-slate-200"} max-h-[85dvh] sm:max-h-[calc(100dvh-96px)] overflow-y-auto relative`,children:s.jsxs("div",{className:"relative p-4 sm:p-6 lg:p-7 flex flex-col h-full min-h-0 overflow-y-auto modal-scroll",children:[s.jsxs("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-start sm:justify-between",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsx("h3",{className:`text-2xl sm:text-3xl font-bold ${c}`,children:ge}),s.jsx("div",{className:"flex flex-wrap gap-2",children:J.map((W,ue)=>s.jsxs("a",{href:W.anchor,className:`inline-flex items-center gap-2 px-3 py-1.5 rounded-full border text-xs transition ${W.done?"bg-[#4E6E49] border-[#4E6E49] text-white shadow-sm":i==="dark"?"border-white/15 bg-white/5 text-gray-200 hover:border-white/30":"border-slate-200 bg-white text-gray-700 hover:border-slate-300"}`,children:[s.jsx("span",{className:"font-semibold",children:ue+1}),s.jsx("span",{className:"whitespace-nowrap",children:W.label})]},W.label))}),r==="dayoff"&&s.jsx("div",{className:"flex flex-wrap gap-2 text-xs sm:text-sm",children:["Один выходной","Диапазон дней","Несколько дат"].map(W=>s.jsx("span",{className:`px-3 py-1.5 rounded-full border ${i==="dark"?"border-white/10 text-gray-200 bg-white/5":"border-slate-200 text-gray-700 bg-slate-50"}`,children:W},W))})]}),s.jsx("button",{onClick:t,className:`p-2.5 rounded-full border shadow-sm transition hover:-translate-y-0.5 active:translate-y-0 ${i==="dark"?"border-white/10 text-gray-200 hover:bg-white/5":"border-slate-200 text-slate-600 hover:bg-slate-100"}`,children:s.jsx(Qt,{className:"w-5 h-5"})})]}),s.jsx("div",{className:`mt-5 rounded-2xl border ${i==="dark"?"border-white/10 bg-white/5":"border-slate-200 bg-white"} p-4 sm:p-5 shadow-inner`,children:s.jsxs("div",{className:"grid md:grid-cols-3 gap-3 md:gap-4",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"h-10 w-10 rounded-2xl bg-gradient-to-br from-emerald-500/20 to-emerald-400/10 flex items-center justify-center text-emerald-600 dark:text-emerald-300 text-lg font-semibold border border-emerald-500/30",children:"👥"}),s.jsxs("div",{children:[s.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Members"}),s.jsx("p",{className:"text-sm font-semibold text-gray-900 dark:text-gray-100 line-clamp-2",children:Re||"Не выбрано"})]})]}),s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"h-10 w-10 rounded-2xl bg-gradient-to-br from-blue-500/20 to-indigo-500/10 flex items-center justify-center text-blue-600 dark:text-blue-300 text-lg font-semibold border border-blue-500/30",children:"📅"}),s.jsxs("div",{children:[s.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Даты"}),s.jsx("p",{className:"text-sm font-semibold text-gray-900 dark:text-gray-100 line-clamp-2",children:Z.length>0?Z.join(" · "):"Не выбрано"})]})]}),s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"h-10 w-10 rounded-2xl bg-gradient-to-br from-amber-500/20 to-orange-500/10 flex items-center justify-center text-amber-600 dark:text-amber-300 text-lg font-semibold border border-amber-500/30",children:"✏️"}),s.jsxs("div",{children:[s.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Комментарий"}),s.jsx("p",{className:"text-sm font-semibold text-gray-900 dark:text-gray-100 line-clamp-2",children:L||"Необязателен"})]})]})]})}),s.jsxs("div",{className:"mt-5 grid lg:grid-cols-[0.9fr_1.4fr] gap-4 lg:gap-6 flex-1 overflow-hidden",children:[s.jsxs("aside",{className:`rounded-2xl border ${i==="dark"?"border-white/10 bg-white/5":"border-slate-200 bg-white"} p-4 sm:p-5 space-y-4 sticky top-2 self-start max-h-full overflow-y-auto`,children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("p",{className:"text-sm font-semibold",children:"Навигация"}),s.jsxs("span",{className:"text-[11px] uppercase tracking-wide text-[#4E6E49] font-semibold",children:[J.length," шага"]})]}),s.jsx("div",{className:"h-1.5 rounded-full bg-slate-200 dark:bg-white/10 overflow-hidden",children:s.jsx("div",{className:"h-full rounded-full bg-gradient-to-r from-[#4E6E49] via-emerald-500 to-lime-400 transition-all",style:{width:`${se}%`}})}),s.jsx("div",{className:"space-y-2",children:J.map((W,ue)=>s.jsxs("a",{href:W.anchor,className:`flex items-start gap-3 rounded-xl border px-3 py-3 transition ${i==="dark"?"border-white/10 bg-white/5 hover:border-white/30":"border-slate-200 bg-slate-50 hover:border-slate-300"}`,children:[s.jsx("span",{className:`mt-0.5 inline-flex h-7 w-7 items-center justify-center rounded-full text-xs font-bold ${W.done?"bg-[#4E6E49] text-white shadow-sm":i==="dark"?"bg-slate-800 text-gray-300":"bg-slate-200 text-slate-700"}`,children:ue+1}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsx("p",{className:"text-sm font-semibold",children:W.label}),s.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 truncate",children:W.detail||"—"})]}),s.jsx("span",{className:"text-[11px] text-gray-400",children:W.done?"✓":""})]},W.label))})]}),s.jsxs("div",{className:"space-y-5 overflow-y-auto overscroll-contain pr-1 pb-6 flex-1 min-h-0",children:[z&&s.jsxs("div",{id:"members",className:"scroll-mt-20",children:[s.jsx("label",{className:`block text-xs sm:text-sm font-medium mb-2 ${i==="dark"?"text-gray-300":"text-gray-700"}`,children:"Members"}),s.jsxs("div",{className:"space-y-3 rounded-2xl border border-dashed border-[#4E6E49]/30 p-3 sm:p-4 bg-[#4E6E49]/5 dark:bg-[#4E6E49]/10",children:[s.jsx("div",{className:"flex flex-wrap gap-2",children:Ee.map(W=>{const ue=h.includes(W.id);return s.jsxs("label",{className:`px-3 py-1.5 rounded-full border cursor-pointer text-sm flex items-center gap-2 transition ${ue?"bg-[#4E6E49] border-[#4E6E49] text-white shadow-sm":i==="dark"?"bg-gray-800/60 border-gray-800 text-gray-200 hover:border-gray-600":"bg-gray-100 border-gray-300 text-gray-700 hover:border-gray-400"}`,children:[s.jsx("input",{type:"checkbox",checked:ue,onChange:()=>ee(W.id),className:"hidden"}),Ne[W.id]||W.name]},W.id)})}),s.jsxs("div",{className:"flex items-center justify-between text-sm",children:[s.jsx("span",{className:`${i==="dark"?"text-gray-300":"text-gray-700"}`,children:"Быстрый выбор"}),s.jsx("button",{type:"button",onClick:re,className:"text-sm text-[#4E6E49] hover:text-[#4E6E49] font-semibold",children:h.length===Ee.length?"Снять выделение":"Выбрать всех"})]})]})]}),z&&s.jsxs("div",{id:"dates",className:"scroll-mt-20",children:[s.jsx("p",{className:`text-xs sm:text-sm font-medium mb-2 ${i==="dark"?"text-gray-300":"text-gray-700"}`,children:"Формат выбора дат"}),s.jsx("div",{className:"grid sm:grid-cols-3 gap-2",children:q.map(W=>{const ue=I===W.value;return s.jsxs("button",{type:"button",onClick:()=>N(W.value),className:`w-full text-left px-3 py-3 rounded-xl border transition flex flex-col gap-1 ${ue?"border-[#4E6E49] bg-[#4E6E49]/10 text-[#4E6E49] shadow-sm":i==="dark"?"border-white/10 bg-white/5 text-gray-200 hover:border-white/30":"border-slate-200 bg-white text-gray-800 hover:border-slate-300"}`,children:[s.jsx("span",{className:"text-lg leading-none",children:W.icon}),s.jsx("span",{className:"text-sm font-semibold",children:W.label}),s.jsx("span",{className:"text-[11px] text-gray-500 dark:text-gray-400",children:W.hint})]},W.value)})})]}),!z&&r==="dayoff"&&s.jsxs("div",{id:"dates",className:"scroll-mt-20",children:[s.jsx("p",{className:`text-xs sm:text-sm font-medium mb-2 ${i==="dark"?"text-gray-300":"text-gray-700"}`,children:"Формат выбора дат"}),s.jsx("div",{className:"grid sm:grid-cols-3 gap-2",children:q.map(W=>{const ue=I===W.value;return s.jsxs("button",{type:"button",onClick:()=>N(W.value),className:`w-full text-left px-3 py-3 rounded-xl border transition flex flex-col gap-1 ${ue?"border-[#4E6E49] bg-[#4E6E49]/10 text-[#4E6E49] shadow-sm":i==="dark"?"border-white/10 bg-white/5 text-gray-200 hover:border-white/30":"border-slate-200 bg-white text-gray-800 hover:border-slate-300"}`,children:[s.jsx("span",{className:"text-lg leading-none",children:W.icon}),s.jsx("span",{className:"text-sm font-semibold",children:W.label}),s.jsx("span",{className:"text-[11px] text-gray-500 dark:text-gray-400",children:W.hint})]},W.value)})})]}),(!z||I==="single")&&s.jsxs("div",{children:[s.jsx("label",{className:`block text-xs sm:text-sm font-medium mb-2 ${i==="dark"?"text-gray-300":"text-gray-700"}`,children:"Дата начала"}),s.jsx("input",{type:"date",value:x,onChange:W=>p(W.target.value),className:`w-full px-3 sm:px-4 py-2 sm:py-2.5 text-sm sm:text-base rounded-lg border touch-manipulation ${i==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`})]}),z&&I==="range"&&s.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:`block text-xs sm:text-sm font-medium mb-2 ${i==="dark"?"text-gray-300":"text-gray-700"}`,children:"Начало"}),s.jsx("input",{type:"date",value:b,onChange:W=>f(W.target.value),className:`w-full px-3 sm:px-4 py-2 sm:py-2.5 text-sm sm:text-base rounded-lg border touch-manipulation ${i==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`})]}),s.jsxs("div",{children:[s.jsx("label",{className:`block text-xs sm:text-sm font-medium mb-2 ${i==="dark"?"text-gray-300":"text-gray-700"}`,children:"Конец"}),s.jsx("input",{type:"date",value:w,min:b,onChange:W=>_(W.target.value),className:`w-full px-3 sm:px-4 py-2 sm:py-2.5 text-sm sm:text-base rounded-lg border touch-manipulation ${i==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`})]})]}),!z&&r==="dayoff"&&I==="range"&&s.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:`block text-xs sm:text-sm font-medium mb-2 ${i==="dark"?"text-gray-300":"text-gray-700"}`,children:"Начало"}),s.jsx("input",{type:"date",value:b,onChange:W=>f(W.target.value),className:`w-full px-3 sm:px-4 py-2 sm:py-2.5 text-sm sm:text-base rounded-lg border touch-manipulation ${i==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`})]}),s.jsxs("div",{children:[s.jsx("label",{className:`block text-xs sm:text-sm font-medium mb-2 ${i==="dark"?"text-gray-300":"text-gray-700"}`,children:"Конец"}),s.jsx("input",{type:"date",value:w,min:b,onChange:W=>_(W.target.value),className:`w-full px-3 sm:px-4 py-2 sm:py-2.5 text-sm sm:text-base rounded-lg border touch-manipulation ${i==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`})]})]}),z&&I==="multiple"&&s.jsxs("div",{children:[s.jsx("label",{className:`block text-xs sm:text-sm font-medium mb-2 ${i==="dark"?"text-gray-300":"text-gray-700"}`,children:"Выбранные даты"}),s.jsxs("div",{className:"flex flex-col gap-3",children:[s.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[s.jsx("input",{type:"date",value:y,onChange:W=>G(W.target.value),className:`flex-1 px-3 sm:px-4 py-2 sm:py-2.5 text-sm sm:text-base rounded-lg border touch-manipulation ${i==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`}),s.jsx("button",{type:"button",onClick:oe,className:"px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg transition-colors",children:"Добавить"})]}),V.length>0?s.jsx("div",{className:"flex flex-wrap gap-2",children:V.map(W=>s.jsxs("span",{className:"inline-flex items-center gap-2 px-3 py-1.5 rounded-full bg-gray-100 text-gray-800 text-sm",children:[xe(W,"dd.MM.yyyy"),s.jsx("button",{type:"button",onClick:()=>ke(W),className:"text-red-500 hover:text-red-600",children:"x"})]},W))}):s.jsx("p",{className:"text-sm text-gray-500",children:"Пока не выбрано ни одной даты"})]})]}),!z&&r==="dayoff"&&I==="multiple"&&s.jsxs("div",{children:[s.jsx("label",{className:`block text-xs sm:text-sm font-medium mb-2 ${i==="dark"?"text-gray-300":"text-gray-700"}`,children:"Выбранные даты"}),s.jsxs("div",{className:"flex flex-col gap-3",children:[s.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[s.jsx("input",{type:"date",value:y,onChange:W=>G(W.target.value),className:`flex-1 px-3 sm:px-4 py-2 sm:py-2.5 text-sm sm:text-base rounded-lg border touch-manipulation ${i==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`}),s.jsx("button",{type:"button",onClick:oe,className:"px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg transition-colors",children:"Добавить"})]}),V.length>0?s.jsx("div",{className:"flex flex-wrap gap-2",children:V.map(W=>s.jsxs("span",{className:"inline-flex items-center gap-2 px-3 py-1.5 rounded-full bg-gray-100 text-gray-800 text-sm",children:[xe(W,"dd.MM.yyyy"),s.jsx("button",{type:"button",onClick:()=>ke(W),className:"text-red-500 hover:text-red-600",children:"x"})]},W))}):s.jsx("p",{className:"text-sm text-gray-500",children:"Пока не выбрано ни одной даты"})]})]}),(r==="sick"||r==="vacation")&&(!z||I==="single")&&s.jsxs("label",{className:"flex items-center gap-2",children:[s.jsx("input",{type:"checkbox",checked:S,onChange:W=>k(W.target.checked),className:"w-4 h-4"}),s.jsx("span",{className:`${i==="dark"?"text-gray-300":"text-gray-700"}`,children:"Несколько дней"})]}),S&&s.jsxs("div",{children:[s.jsx("label",{className:`block text-xs sm:text-sm font-medium mb-2 ${i==="dark"?"text-gray-300":"text-gray-700"}`,children:"Дата окончания"}),s.jsx("input",{type:"date",value:E,onChange:W=>j(W.target.value),min:x,className:`w-full px-3 sm:px-4 py-2 sm:py-2.5 text-sm sm:text-base rounded-lg border touch-manipulation ${i==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`})]}),s.jsxs("div",{children:[s.jsx("label",{className:`block text-xs sm:text-sm font-medium mb-2 ${i==="dark"?"text-gray-300":"text-gray-700"}`,children:"Комментарий"}),s.jsx("textarea",{value:L,onChange:W=>M(W.target.value),rows:3,className:`w-full px-3 sm:px-4 py-2 sm:py-2.5 text-sm sm:text-base rounded-lg border touch-manipulation resize-y ${i==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`,placeholder:"Добавьте комментарий (необязательно)"})]}),T&&s.jsx("div",{className:"p-3 bg-red-500 text-white rounded-lg text-sm",children:T}),s.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 sm:gap-3 pt-2",children:[s.jsx("button",{onClick:H,disabled:ne,className:`flex-1 px-4 py-2.5 sm:py-2 ${Se[r]} hover:opacity-90 disabled:opacity-50 disabled:cursor-not-allowed text-white rounded-lg sm:rounded-xl transition-colors text-sm sm:text-base font-medium touch-manipulation active:scale-95 disabled:active:scale-100`,children:ne?"Сохранение...":"Сохранить"}),s.jsx("button",{onClick:t,className:`px-4 py-2.5 sm:py-2 rounded-lg sm:rounded-xl transition-colors text-sm sm:text-base font-medium touch-manipulation active:scale-95 ${i==="dark"?"bg-gray-700 hover:bg-gray-600 active:bg-gray-500":"bg-gray-200 hover:bg-gray-300 active:bg-gray-400"}`,children:"Отмена"})]})]})]})]})})})},Rk=({onClose:r,onSave:e})=>{const{user:t}=Dt(),{theme:n}=ct(),{isAdmin:a}=Bt(),i=n==="dark"?"text-white":"text-gray-900",[l,c]=A.useState(a?[]:t!=null&&t.id?[t.id]:[]),[d,h]=A.useState(!1),[g,x]=A.useState(!1),[p,E]=A.useState(!1),[j,S]=A.useState([]),[k,L]=A.useState([]),[M,T]=A.useState(""),[O,ne]=A.useState(""),[ie,I]=A.useState(""),[N,b]=A.useState(""),[f,w]=A.useState(!1);xn();const _=["Пн","Вт","Ср","Чт","Пт","Сб","Вс"],y=d?"По дню недели":g?"По датам":p?"Диапазон":"Не выбран",G=d?j.length>0?j.map(K=>_[K]).join(", "):"Дни недели":g?k[0]?`${xe(k[0],"dd.MM")} +${Math.max(k.length-1,0)}`:"Добавьте даты":p?O&&ie?`${xe(O,"dd.MM")}–${xe(ie,"dd.MM")}`:"Укажите диапазон":"Выберите режим",V=l.map(K=>{var he;return((he=Ee.find(Ce=>Ce.id===K))==null?void 0:he.name)||K}).join(", "),F=K=>{if(K){if(g||p){b("Снимите галочку с другой функции, чтобы активировать эту");return}h(!0),b("")}else h(!1),S([])},z=K=>{if(K){if(d||p){b("Снимите галочку с другой функции, чтобы активировать эту");return}x(!0),b("")}else x(!1),L([]),T("")},ee=K=>{if(K){if(d||g){b("Снимите галочку с другой функции, чтобы активировать эту");return}E(!0),b("")}else E(!1),ne(""),I("")},re=K=>{l.includes(K)?c(l.filter(he=>he!==K)):c([...l,K])},oe=()=>{if(!M){b("Выберите дату");return}if(k.includes(M)){b("Эта дата уже добавлена");return}L([...k,M].sort()),T(""),b("")},ke=K=>{L(k.filter(he=>he!==K))},ye=async()=>{var he;if(!a&&!t){b("Пользователь не найден");return}const K=a?l:t?[t.id]:[];if(K.length===0){b("Выберите хотя бы одного участника");return}if(!d&&!g&&!p){b("Выберите способ удаления слотов");return}if(d&&j.length===0){b("Выберите день недели");return}if(g&&k.length===0){b("Добавьте хотя бы одну дату");return}if(p){if(!O||!ie){b("Укажите начальную и конечную дату диапазона");return}if(O>ie){b("Начальная дата должна быть раньше конечной");return}}b(""),w(!0);try{const Ce=K.map(se=>Fr(se)),Se=(await Promise.all(Ce)).flat();let Ne=[];if(d?Ne=Se.filter(se=>{const q=new Date(se.date+"T00:00:00"),te=q.getDay()===0?6:q.getDay()-1;return j.includes(te)}).map(se=>se.id):g?Ne=Se.filter(se=>k.includes(se.date)).map(se=>se.id):p&&(Ne=Se.filter(se=>se.date>=O&&se.date<=ie).map(se=>se.id)),Ne.length===0){b("Слоты для удаления не найдены"),w(!1);return}const Z=K.length>1?`${K.length} участников`:((he=Ee.find(se=>se.id===K[0]))==null?void 0:he.name)||"участника",Re=j.map(se=>_[se]).join(", "),J=d?`Удалить все слоты ${Z} на ${Re}? (${Ne.length} слотов)`:p?`Удалить все слоты ${Z} с ${xe(O,"dd.MM.yyyy")} по ${xe(ie,"dd.MM.yyyy")}? (${Ne.length} слотов)`:`Удалить слоты ${Z} на выбранные даты? (${Ne.length} слотов)`;if(!confirm(J)){w(!1);return}await Promise.all(Ne.map(se=>hc(se))),e()}catch(Ce){console.error("Error deleting slots:",Ce);const H=Ce.message||Ce.code||"Ошибка при удалении слотов";b(H)}finally{w(!1)}};return s.jsx("div",{className:"fixed inset-0 bg-slate-950/75 backdrop-blur-xl flex items-start sm:items-center justify-center z-[70] p-4 sm:p-6 overflow-y-auto overscroll-contain modal-scroll",children:s.jsx("div",{className:`w-full max-w-5xl rounded-3xl shadow-[0_24px_80px_rgba(0,0,0,0.45)] border ${n==="dark"?"bg-gradient-to-br from-[#0c1320] via-[#0b1220] to-[#08111b] border-white/10":"bg-gradient-to-br from-white via-slate-50 to-white border-slate-200"} max-h-[85dvh] sm:max-h-[calc(100dvh-96px)] overflow-y-auto`,children:s.jsxs("div",{className:"p-5 sm:p-6 lg:p-7 flex flex-col h-full min-h-0 overflow-y-auto modal-scroll",children:[s.jsxs("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between",children:[s.jsxs("div",{className:"space-y-1",children:[s.jsx("div",{className:"flex items-center gap-2 text-xs font-semibold text-[#4E6E49] tracking-tight",children:s.jsx("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full bg-[#4E6E49]/10 text-[#4E6E49] border border-[#4E6E49]/30",children:"Очистка слотов"})}),s.jsx("h3",{className:`text-2xl sm:text-3xl font-bold ${i}`,children:"Удаление слотов"})]}),s.jsx("button",{onClick:r,className:`p-2.5 rounded-full border ${n==="dark"?"border-white/10 text-gray-200 hover:bg-white/5":"border-slate-200 text-slate-600 hover:bg-slate-100"}`,children:s.jsx(Qt,{className:"w-5 h-5"})})]}),s.jsxs("div",{className:"mt-5 grid lg:grid-cols-[0.95fr_1.45fr] gap-4 lg:gap-6 flex-1 overflow-hidden",children:[s.jsxs("aside",{className:`rounded-2xl border ${n==="dark"?"border-white/10 bg-white/5":"border-slate-200 bg-white"} p-4 sm:p-5 space-y-4 sticky top-0 self-start max-h-full overflow-y-auto`,children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("p",{className:"text-sm font-semibold",children:"Навигация"}),s.jsx("span",{className:"text-[11px] uppercase tracking-wide text-[#4E6E49] font-semibold",children:"3 шага"})]}),s.jsx("div",{className:"space-y-2",children:[{label:"Участники",detail:V||"Не выбрано",done:l.length>0||!a},{label:"Режим",detail:y,done:y!=="Не выбран"},{label:"Параметры",detail:G,done:G!=="Выберите режим"}].map((K,he)=>s.jsxs("div",{className:`flex items-start gap-3 rounded-xl border px-3 py-3 ${n==="dark"?"border-white/10 bg-white/5":"border-slate-200 bg-slate-50"}`,children:[s.jsx("span",{className:`mt-0.5 inline-flex h-6 w-6 items-center justify-center rounded-full text-xs font-bold ${K.done?"bg-[#4E6E49] text-white":n==="dark"?"bg-slate-800 text-gray-300":"bg-slate-200 text-slate-700"}`,children:he+1}),s.jsxs("div",{className:"flex-1",children:[s.jsx("p",{className:"text-sm font-semibold",children:K.label}),s.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 truncate",children:K.detail||"—"})]})]},K.label))}),s.jsxs("div",{className:`rounded-xl border px-3 py-3 space-y-2 ${n==="dark"?"border-emerald-900/50 bg-emerald-900/20":"border-emerald-100 bg-emerald-50"}`,children:[s.jsx("p",{className:"text-xs uppercase tracking-wide text-emerald-600 font-semibold",children:"Подсказка"}),s.jsx("p",{className:"text-sm text-emerald-700 dark:text-emerald-200",children:"Выберите только один способ удаления: по дню, по списку дат или по диапазону."})]})]}),s.jsxs("div",{className:"space-y-4 overflow-y-auto overscroll-contain pr-1 pb-6 flex-1 min-h-0",children:[a&&s.jsxs("div",{children:[s.jsxs("label",{className:`block text-sm font-medium mb-2 ${n==="dark"?"text-gray-300":"text-gray-700"}`,children:["Участники ",l.length>0&&`(${l.length} выбрано)`]}),s.jsx("div",{className:"flex flex-wrap gap-2",children:Ee.map(K=>{const he=l.includes(K.id);return s.jsx("button",{onClick:()=>re(K.id),className:`px-3 py-1.5 rounded-lg transition-colors ${he?"bg-red-500 text-white":n==="dark"?"bg-gray-700 text-gray-300 hover:bg-gray-600":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:K.name},K.id)})})]}),s.jsxs("label",{className:"flex items-center gap-2",children:[s.jsx("input",{type:"checkbox",checked:d,onChange:K=>F(K.target.checked),className:"w-4 h-4"}),s.jsx("span",{className:`${n==="dark"?"text-gray-300":"text-gray-700"}`,children:"Удалить по дню недели"})]}),d&&s.jsxs("div",{className:"ml-6",children:[s.jsx("p",{className:`text-sm mb-2 ${n==="dark"?"text-gray-400":"text-gray-600"}`,children:"Выберите дни недели:"}),s.jsx("div",{className:"flex gap-2 flex-wrap",children:_.map((K,he)=>{const Ce=j.includes(he);return s.jsx("button",{onClick:()=>{S(H=>H.includes(he)?H.filter(Se=>Se!==he):[...H,he])},className:`px-3 py-1 rounded-lg transition-colors ${Ce?"bg-red-500 text-white":n==="dark"?"bg-gray-700 text-gray-300":"bg-gray-200 text-gray-700"}`,children:K},he)})})]}),s.jsxs("label",{className:"flex items-center gap-2",children:[s.jsx("input",{type:"checkbox",checked:g,onChange:K=>z(K.target.checked),className:"w-4 h-4"}),s.jsx("span",{className:`${n==="dark"?"text-gray-300":"text-gray-700"}`,children:"Удалить по конкретным датам"})]}),g&&s.jsxs("div",{className:"ml-6 space-y-3",children:[s.jsxs("div",{className:"flex gap-2",children:[s.jsx("input",{type:"date",value:M,onChange:K=>T(K.target.value),className:`flex-1 px-4 py-2 rounded-lg border ${n==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-red-500`}),s.jsx("button",{onClick:oe,className:"px-4 py-2 bg-[#4E6E49] hover:bg-[#4E6E49] text-white rounded-lg transition-colors",children:"Добавить"})]}),k.length>0&&s.jsxs("div",{className:"space-y-2",children:[s.jsxs("p",{className:`text-sm ${n==="dark"?"text-gray-400":"text-gray-600"}`,children:["Выбранные даты (",k.length,"):"]}),s.jsx("div",{className:"flex flex-wrap gap-2",children:k.map(K=>s.jsxs("div",{className:`flex items-center gap-2 px-3 py-1 rounded-lg ${n==="dark"?"bg-gray-700":"bg-gray-100"}`,children:[s.jsx("span",{className:i,children:xe(K,"dd.MM.yyyy")}),s.jsx("button",{onClick:()=>ke(K),className:"p-1 text-red-500 hover:bg-red-500 hover:text-white rounded transition-colors",children:s.jsx(Qt,{className:"w-3 h-3"})})]},K))})]})]}),s.jsxs("label",{className:"flex items-center gap-2",children:[s.jsx("input",{type:"checkbox",checked:p,onChange:K=>ee(K.target.checked),className:"w-4 h-4"}),s.jsx("span",{className:`${n==="dark"?"text-gray-300":"text-gray-700"}`,children:"Удалить по диапазону дат"})]}),p&&s.jsxs("div",{className:"ml-6 space-y-3",children:[s.jsxs("div",{className:"flex gap-2",children:[s.jsxs("div",{className:"flex-1",children:[s.jsx("label",{className:`block text-xs mb-1 ${n==="dark"?"text-gray-400":"text-gray-600"}`,children:"Начальная дата"}),s.jsx("input",{type:"date",value:O,onChange:K=>ne(K.target.value),className:`w-full px-4 py-2 rounded-lg border ${n==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-red-500`})]}),s.jsxs("div",{className:"flex-1",children:[s.jsx("label",{className:`block text-xs mb-1 ${n==="dark"?"text-gray-400":"text-gray-600"}`,children:"Конечная дата"}),s.jsx("input",{type:"date",value:ie,onChange:K=>I(K.target.value),min:O,className:`w-full px-4 py-2 rounded-lg border ${n==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-red-500`})]})]}),O&&ie&&s.jsxs("p",{className:`text-sm ${n==="dark"?"text-gray-400":"text-gray-600"}`,children:["Будет удалено: с ",xe(O,"dd.MM.yyyy")," по ",xe(ie,"dd.MM.yyyy")]})]}),N&&s.jsx("div",{className:"p-3 bg-red-500 text-white rounded-lg text-sm",children:N}),s.jsxs("div",{className:"flex gap-3",children:[s.jsxs("button",{onClick:ye,disabled:f||!d&&!g&&!p,className:"flex-1 px-4 py-2 bg-red-500 hover:bg-red-600 disabled:bg-gray-400 disabled:cursor-not-allowed text-white rounded-lg transition-colors flex items-center justify-center gap-2",children:[s.jsx(At,{className:"w-4 h-4"}),f?"Удаление...":"Удалить слоты"]}),s.jsx("button",{onClick:r,className:`px-4 py-2 rounded-lg transition-colors ${n==="dark"?"bg-gray-700 hover:bg-gray-600":"bg-gray-200 hover:bg-gray-300"}`,children:"Отмена"})]})]})]})]})})})},Dk=()=>{const{theme:r}=ct(),[e,t]=A.useState("week"),[n,a]=A.useState("all"),[i,l]=A.useState(!1),[c,d]=A.useState(!1),[h,g]=A.useState(!1),[x,p]=A.useState(null),[E,j]=A.useState(null),[S,k]=A.useState(null),[L,M]=A.useState(null),[T,O]=A.useState("add-slot"),[ne,ie]=A.useState(0),[I,N]=A.useState({slotsThisWeek:0,activeMembers:0,upcomingSlots:0,completedSlots:0,recommendedWeek:0,recommendedDay:0,mostActive:"",leastActive:[],remainingSlots:0,todaySlots:0}),[b,f]=A.useState({nextStart:null,activeEnd:null}),[w,_]=A.useState({nextStart:"—",activeRemaining:"—"});A.useEffect(()=>{z()},[]),A.useEffect(()=>{const te=(ue,ze)=>{if(!ue)return"—";const We=ue.getTime()-Date.now();if(We<=0)return ze?"Слот завершён":"Уже начался";const Pe=Math.floor(We/6e4),je=Math.floor(Pe/(60*24)),_e=Math.floor(Pe%(60*24)/60),Le=Pe%60;return je>0?`${je}д ${_e}ч`:_e>0?`${_e}ч ${Le}м`:`${Math.max(Le,1)}м`},ge=()=>{_({nextStart:te(b.nextStart,!1),activeRemaining:te(b.activeEnd,!0)})};ge();const W=setInterval(ge,6e4);return()=>clearInterval(W)},[b]);const y=te=>{const ge=new Date;ge.setHours(0,0,0,0);const W=new Date(te.date);if(W.setHours(0,0,0,0),W>ge)return!0;if(W.getTime()===ge.getTime()){const ze=new Date,We=ze.getHours()*60+ze.getMinutes();return te.slots.some(Pe=>{if(Pe.endDate){const nt=new Date(Pe.endDate);if(nt.setHours(0,0,0,0),nt>ge)return!0;if(nt.getTime()===ge.getTime()){const[et,U]=Pe.end.split(":").map(Number);return et*60+U>We}return!1}const[je,_e]=Pe.end.split(":").map(Number);return je*60+_e>We})}return te.slots.some(ze=>{if(ze.endDate){const We=new Date(ze.endDate);return We.setHours(0,0,0,0),We>=ge}return!1})},G={1:"Dex",2:"Merc",3:"Xenia",4:"Olenka",5:"Sydney"},V={artyom:"1",adel:"2",kseniya:"3",olga:"4",anastasia:"5"},F=te=>{const ge=Ee.find(W=>W.id===te)||Ee.find(W=>V[te]===W.id);return G[(ge==null?void 0:ge.id)||te]||(ge==null?void 0:ge.name)||te},z=async()=>{var te,ge;try{const W=new Date,ue=gc(W),ze=xe(ue[0],"yyyy-MM-dd"),We=xe(ue[6],"yyyy-MM-dd"),Pe=xe(W,"yyyy-MM-dd"),[je,_e]=await Promise.all([Fr(),Rr()]),Le=je.filter(R=>R.date>=ze&&R.date<=We),nt=je.filter(R=>R.date===Pe),et=new Set([...Le.flatMap(R=>[R.userId,...R.participants||[]]),..._e.map(R=>R.userId)]),U=Le.filter(y).length,D=Le.length-U,P=Math.max(0,15-Le.length),Y=Math.max(0,3-nt.length),pe={};Ee.forEach(R=>{pe[R.id]=0}),Le.forEach(R=>{new Set([R.userId,...R.participants||[]]).forEach(be=>{pe[be]!==void 0&&(pe[be]=(pe[be]||0)+1)})});const C=Object.entries(pe).sort((R,X)=>X[1]-R[1]),De=(te=C[0])!=null&&te[1]?F(C[0][0]):"Нет данных",$=Math.min(...Object.values(pe)),le=Object.entries(pe).filter(([,R])=>R===$).map(([R])=>F(R)).slice(0,3),we=je.flatMap(R=>{const X=R.date;return(R.slots||[]).map(be=>{const Ve=new Date(`${X}T${be.start}`);let He=be.endDate?new Date(`${be.endDate}T${be.end}`):new Date(`${X}T${be.end}`);if(!be.endDate&&He.getTime()<=Ve.getTime()){const Ie=new Date(X);Ie.setDate(Ie.getDate()+1),He=new Date(`${xe(Ie,"yyyy-MM-dd")}T${be.end}`)}return{start:Ve,end:He}})}),me=we.filter(R=>W>=R.start&&W<=R.end),Me=me.length?new Date(Math.min(...me.map(R=>R.end.getTime()))):null,Ye=((ge=we.filter(R=>R.start>W).sort((R,X)=>R.start.getTime()-X.start.getTime())[0])==null?void 0:ge.start)||null;N({slotsThisWeek:Le.length,activeMembers:et.size,upcomingSlots:U,completedSlots:D,recommendedWeek:P,recommendedDay:Y,mostActive:De,leastActive:le,remainingSlots:U,todaySlots:nt.length}),f({nextStart:Ye,activeEnd:Me})}catch(W){console.error("Error loading stats:",W)}},ee=()=>{k(null),l(!0)},re=te=>{k(te),l(!0)},oe=te=>{p(te),M(null),g(!0)},ke=te=>{M(te),p(te.type),g(!0)},ye=()=>{d(!0)},K=()=>{l(!1),d(!1),g(!1),p(null),k(null),M(null),z(),ie(te=>te+1)},he=r==="dark"?"text-white":"text-gray-900",Ce=r==="dark"?"text-gray-300":"text-gray-700",H=r==="dark"?"border-[#4E6E49]/30 bg-gradient-to-br from-[#1a1a1a] via-[#1a1a1a] to-[#0A0A0A]":"border-green-200 bg-gradient-to-br from-white via-green-50/30 to-white",Se=`rounded-2xl p-4 sm:p-6 md:p-8 border-2 ${H}`,Ne=`rounded-2xl border ${r==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white"}`,Z=r==="dark"?"text-gray-400":"text-gray-600",Re=`rounded-2xl p-4 sm:p-5 border-2 ${H}`,J={emerald:{bg:r==="dark"?"bg-emerald-500/10":"bg-emerald-50",text:r==="dark"?"text-emerald-100":"text-emerald-800",border:r==="dark"?"border-emerald-500/30":"border-emerald-200"},purple:{bg:r==="dark"?"bg-purple-500/10":"bg-purple-50",text:r==="dark"?"text-purple-100":"text-purple-800",border:r==="dark"?"border-purple-500/30":"border-purple-200"},amber:{bg:r==="dark"?"bg-amber-500/10":"bg-amber-50",text:r==="dark"?"text-amber-100":"text-amber-800",border:r==="dark"?"border-amber-500/30":"border-amber-200"},slate:{bg:r==="dark"?"bg-gray-500/10":"bg-gray-50",text:r==="dark"?"text-gray-100":"text-gray-800",border:r==="dark"?"border-gray-500/30":"border-gray-200"},blue:{bg:r==="dark"?"bg-blue-500/10":"bg-blue-50",text:r==="dark"?"text-blue-100":"text-blue-800",border:r==="dark"?"border-blue-500/30":"border-blue-200"},green:{bg:r==="dark"?"bg-green-500/10":"bg-green-50",text:r==="dark"?"text-green-100":"text-green-800",border:r==="dark"?"border-green-500/30":"border-green-200"},sky:{bg:r==="dark"?"bg-sky-500/10":"bg-sky-50",text:r==="dark"?"text-sky-100":"text-sky-800",border:r==="dark"?"border-sky-500/30":"border-sky-200"},pink:{bg:r==="dark"?"bg-pink-500/10":"bg-pink-50",text:r==="dark"?"text-pink-100":"text-pink-800",border:r==="dark"?"border-pink-500/30":"border-pink-200"}},se=te=>{t(te)},q=[{label:"Сколько ещё добавить слотов",value:`${Math.max(I.recommendedDay,0)} в день`,note:`Неделя: ${Math.max(I.recommendedWeek,0)} до цели 15`,icon:s.jsx(kt,{className:"w-4 h-4"}),tone:"emerald"},{label:"Активные члены",value:I.activeMembers,note:"за неделю",icon:s.jsx(Cs,{className:"w-4 h-4"}),tone:"purple"},{label:"Самый активный член недели",value:I.mostActive||"Нет данных",note:"по слотам",icon:s.jsx(th,{className:"w-4 h-4"}),tone:"amber"},{label:"Самые неактивные члены недели",value:I.leastActive.length?I.leastActive.join(", "):"Нет данных",note:"минимум слотов",icon:s.jsx(ip,{className:"w-4 h-4"}),tone:"slate"},{label:"Осталось слотов на неделе",value:I.remainingSlots,note:"предстоящие",icon:s.jsx(vp,{className:"w-4 h-4"}),tone:"blue"},{label:"Завершено слотов на неделе",value:I.completedSlots,note:"факт",icon:s.jsx(fo,{className:"w-4 h-4"}),tone:"green"},{label:"Таймер ближайшего слота",value:w.nextStart,note:"до старта",icon:s.jsx(ch,{className:"w-4 h-4"}),tone:"sky"},{label:"До окончания активного слота",value:w.activeRemaining,note:"если слот идёт",icon:s.jsx(en,{className:"w-4 h-4"}),tone:"pink"}];return s.jsx(ir,{children:s.jsxs("div",{className:"space-y-5 sm:space-y-7",children:[s.jsxs("div",{id:"schedule-overview",className:`relative overflow-hidden ${Se} p-5 sm:p-6 md:p-8 ${r==="dark"?"bg-gradient-to-br from-[#0e1b2c] via-[#0c1827] to-[#0a1420]":"bg-gradient-to-br from-white via-emerald-50/40 to-sky-50"}`,children:[s.jsxs("div",{className:"absolute inset-0 pointer-events-none",children:[s.jsx("div",{className:"absolute -top-32 -left-16 w-80 h-80 bg-gradient-to-br from-[#4E6E49]/18 via-sky-500/8 to-transparent blur-3xl"}),s.jsx("div",{className:"absolute top-0 right-0 w-[26rem] h-[26rem] bg-gradient-to-bl from-sky-400/14 via-emerald-400/12 to-transparent blur-3xl"}),s.jsx("div",{className:"absolute bottom-[-140px] left-14 w-80 h-80 bg-gradient-to-tr from-sky-300/12 via-[#4E6E49]/12 to-transparent blur-3xl"})]}),s.jsx("div",{className:"relative z-10 grid grid-cols-1 gap-5",children:s.jsxs("div",{className:`${Ne} backdrop-blur p-4 sm:p-5 space-y-4`,children:[s.jsx("div",{className:"flex flex-col gap-4 sm:gap-5 lg:flex-row lg:items-center lg:justify-between",children:s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"p-3 rounded-2xl bg-white/80 dark:bg-white/5 border border-white/40 dark:border-white/10 shadow-lg",children:s.jsx(fo,{className:"w-6 h-6 text-[#4E6E49]"})}),s.jsx("div",{className:"flex items-center",children:s.jsxs("h1",{className:`text-xl sm:text-3xl font-extrabold leading-tight ${r==="dark"?"text-white":"text-gray-900"}`,children:[s.jsx("span",{className:"sm:inline hidden",children:"Расписание команды"}),s.jsx("span",{className:"sm:hidden inline",children:"Расписание"})]})})]})}),s.jsx("div",{className:"grid sm:grid-cols-2 lg:grid-cols-4 gap-3",children:q.map(te=>{const ge=J[te.tone];return s.jsxs("div",{className:`p-4 rounded-xl border-2 ${ge.border} ${ge.bg} shadow-sm space-y-2`,children:[s.jsxs("div",{className:"flex items-start justify-between gap-3",children:[s.jsx("p",{className:`text-[11px] sm:text-xs font-semibold uppercase tracking-wide ${ge.text}`,children:te.label}),s.jsx("span",{className:`inline-flex items-center gap-1 px-2 py-1 rounded-lg text-[11px] font-semibold border ${ge.border} ${ge.text} ${r==="dark"?"bg-white/5":"bg-white/80"}`,children:te.icon})]}),s.jsx("p",{className:`text-lg sm:text-2xl font-extrabold ${he}`,children:te.value}),s.jsx("p",{className:`text-xs ${Z}`,children:te.note})]},te.label)})})]})})]}),s.jsxs("div",{id:"schedule-actions",className:`${Se} p-4 sm:p-5 space-y-5`,children:[s.jsx("div",{className:"space-y-3",children:s.jsxs("div",{className:"flex flex-wrap items-center gap-3 lg:justify-between",children:[s.jsxs("div",{className:`flex items-center gap-2 rounded-xl border ${r==="dark"?"border-gray-800 bg-gray-900/70":"border-gray-200 bg-gray-50"} px-1.5 py-1 shrink-0`,children:[s.jsxs("button",{onClick:()=>se("table"),className:`px-3 sm:px-4 py-2 text-sm font-semibold flex items-center gap-2 transition-all rounded-lg ${e==="table"?"bg-[#4E6E49] text-white shadow-lg":r==="dark"?"text-gray-300 hover:bg-gray-800":"text-gray-700 hover:bg-white"}`,children:[s.jsx($p,{className:"w-4 h-4"}),"Таблица"]}),s.jsxs("button",{onClick:()=>se("week"),className:`px-3 sm:px-4 py-2 text-sm font-semibold flex items-center gap-2 transition-all rounded-lg ${e==="week"?"bg-[#4E6E49] text-white shadow-lg":r==="dark"?"text-gray-300 hover:bg-gray-800":"text-gray-700 hover:bg-white"}`,children:[s.jsx(br,{className:"w-4 h-4"}),"Неделя"]})]}),s.jsx("div",{className:"flex flex-wrap gap-2 shrink",children:[{key:"all",label:"Все",icon:s.jsx(br,{className:"w-4 h-4"})},{key:"upcoming",label:"Предстоящие",icon:s.jsx(en,{className:"w-4 h-4"})},{key:"completed",label:"Завершённые",icon:s.jsx(fo,{className:"w-4 h-4"})}].map(te=>s.jsxs("button",{onClick:()=>a(te.key),className:`px-3 py-2 rounded-xl text-sm font-semibold flex items-center gap-2 transition-all border ${n===te.key?"bg-gradient-to-r from-[#4E6E49] to-emerald-600 text-white border-transparent shadow-lg":r==="dark"?"border-gray-800 bg-gray-900/70 text-gray-200 hover:border-[#4E6E49]/40":"border-gray-200 bg-gray-50 text-gray-700 hover:border-[#4E6E49]/40"}`,children:[te.icon,te.label]},te.key))})]})}),s.jsxs("div",{className:`${Ne} p-3 sm:p-4 space-y-3`,children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("p",{className:`text-sm font-semibold ${he}`,children:"Действие"}),s.jsx("span",{className:"text-[11px] uppercase tracking-wide text-gray-500 dark:text-gray-400",children:"выбор задачи"})]}),s.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-2",children:[{key:"add-slot",label:"Добавить слот",desc:"Разовое или серия",icon:s.jsx(ih,{className:"w-5 h-5"}),tone:"bg-emerald-100 text-emerald-800 border-emerald-200 dark:bg-emerald-900/30 dark:text-emerald-100 dark:border-emerald-800",action:ee},{key:"delete-slots",label:"Удалить слоты",desc:"Очистить интервалы",icon:s.jsx(At,{className:"w-5 h-5"}),tone:"bg-rose-100 text-rose-800 border-rose-200 dark:bg-rose-900/30 dark:text-rose-100 dark:border-rose-800",action:ye},{key:"dayoff",label:"Выходной",desc:"Отметить отдых",icon:s.jsx(xl,{className:"w-5 h-5"}),tone:"bg-teal-100 text-teal-800 border-teal-200 dark:bg-teal-900/30 dark:text-teal-100 dark:border-teal-800",action:()=>oe("dayoff")},{key:"sick",label:"Больничный",desc:"Подтвердить отсутствие",icon:s.jsx(yp,{className:"w-5 h-5"}),tone:"bg-amber-100 text-amber-800 border-amber-200 dark:bg-amber-900/30 dark:text-amber-100 dark:border-amber-700",action:()=>oe("sick")},{key:"vacation",label:"Отпуск",desc:"Запланировать отпуск",icon:s.jsx(ah,{className:"w-5 h-5"}),tone:"bg-sky-100 text-sky-800 border-sky-200 dark:bg-sky-900/30 dark:text-sky-100 dark:border-sky-800",action:()=>oe("vacation")}].map(te=>s.jsxs("button",{onClick:()=>{O(te.key),te.action()},className:`text-left rounded-xl border px-3 py-3 transition-all shadow-sm flex items-start gap-3 h-full ${T===te.key?`${te.tone} ring-2 ring-[#4E6E49]/50 shadow-lg`:`${r==="dark"?"border-gray-800 bg-gray-950/60 text-gray-100":"border-gray-200 bg-white text-gray-900"} hover:-translate-y-0.5 hover:shadow-md`}`,children:[s.jsx("span",{className:`p-2 rounded-lg ${T===te.key?"bg-white/30":r==="dark"?"bg-gray-800":"bg-gray-100"}`,children:te.icon}),s.jsxs("span",{className:"flex flex-col whitespace-normal leading-snug gap-0.5 w-full",children:[s.jsx("span",{className:"text-[13px] sm:text-sm font-semibold break-words leading-tight",children:te.label}),s.jsx("span",{className:"text-[11px] sm:text-xs text-gray-500 dark:text-gray-400 break-words leading-tight",children:te.desc})]})]},te.key))})]}),s.jsxs("div",{className:`${Ne} p-3 sm:p-4 space-y-2`,children:[s.jsx("p",{className:`text-sm font-semibold ${he}`,children:"Members"}),s.jsxs("div",{className:"flex gap-2 overflow-x-auto pb-1",children:[s.jsx("button",{onClick:()=>j(null),className:`px-3 py-2 rounded-xl text-sm font-semibold whitespace-nowrap border transition ${E===null?"bg-gradient-to-r from-[#4E6E49] to-[#4E6E49] text-white border-transparent shadow-lg":r==="dark"?"bg-gray-900/70 border-gray-800 text-gray-200 hover:border-[#4E6E49]/40":"bg-gray-50 border-gray-200 text-gray-700 hover:border-[#4E6E49]/40"}`,children:"Все Members"}),Ee.map(te=>s.jsxs("button",{onClick:()=>j(te.id),className:`px-3 py-2 rounded-xl text-sm font-semibold whitespace-nowrap border transition flex items-center gap-2 ${E===te.id?"bg-gradient-to-r from-[#4E6E49] to-[#4E6E49] text-white border-transparent shadow-lg":r==="dark"?"bg-gray-900/70 border-gray-800 text-gray-200 hover:border-[#4E6E49]/40":"bg-gray-50 border-gray-200 text-gray-700 hover:border-[#4E6E49]/40"}`,children:[s.jsx("span",{className:"inline-flex items-center justify-center w-7 h-7 rounded-full bg-gradient-to-br from-[#4E6E49]/30 to-blue-500/30 text-xs font-bold",children:(G[te.id]||te.name).charAt(0)}),G[te.id]||te.name]},te.id))]})]})]}),s.jsx("div",{id:"schedule-view",className:Re,children:s.jsxs("div",{className:`${Ne} p-4 sm:p-5 flex flex-col gap-4`,children:[s.jsx("div",{className:"flex items-center justify-between flex-wrap gap-2 text-left",children:s.jsxs("div",{className:"text-left",children:[s.jsx("p",{className:`text-sm sm:text-base font-semibold ${he}`,children:"Расписание"}),s.jsx("p",{className:`text-xs sm:text-sm ${Ce}`,children:"Слоты и статусы за выбранную неделю"})]})}),e==="table"?s.jsx(Sk,{selectedUserId:E,slotFilter:n,refreshKey:ne,onEditSlot:re,onEditStatus:ke}):s.jsx(Tk,{selectedUserId:E,slotFilter:n,refreshKey:ne,onEditSlot:re,onEditStatus:ke})]})}),i&&s.jsx(Ak,{slot:S,onClose:K,onSave:K}),c&&s.jsx(Rk,{onClose:K,onSave:K}),h&&x&&s.jsx(Ck,{type:x,status:L,onClose:K,onSave:K})]})})},Rn=.45,Pk=({onClose:r,onSave:e,editingEarning:t})=>{var Z,Re;const{user:n}=Dt(),{isAdmin:a}=Bt(),{theme:i}=ct(),l=i==="dark"?"text-white":"text-gray-900",c=!!t,[d,h]=A.useState((t==null?void 0:t.date)||xe(new Date,"yyyy-MM-dd")),[g,x]=A.useState((t==null?void 0:t.slotId)||""),[p,E]=A.useState((t==null?void 0:t.amount.toString())||""),[j,S]=A.useState(((Z=t==null?void 0:t.extraWalletsCount)==null?void 0:Z.toString())||""),[k,L]=A.useState(((Re=t==null?void 0:t.extraWalletsAmount)==null?void 0:Re.toString())||""),[M,T]=A.useState((t==null?void 0:t.category)||"memecoins"),[O,ne]=A.useState(t?t.participants.length>1:!1),[ie,I]=A.useState(t?t.participants.filter(J=>J!==t.userId):[]),[N,b]=A.useState([]),[f,w]=A.useState([]),[_,y]=A.useState(""),[G,V]=A.useState(!1);xn();const F=(J,se="w-4 h-4")=>{switch(J){case"memecoins":return s.jsx(oa,{className:se});case"futures":return s.jsx(ia,{className:se});case"nft":return s.jsx(aa,{className:se});case"spot":return s.jsx(ur,{className:se});case"polymarket":return s.jsx(gl,{className:se});case"staking":return s.jsx(Pi,{className:se});default:return s.jsx(zt,{className:se})}},z=()=>{var J;return c&&t?(J=t.participants)!=null&&J.length?t.participants:[t.userId]:a&&!n?ie:n?O?Array.from(new Set([n.id,...ie])):[n.id]:[]},ee=z(),re=ee.length,oe=re||1,ke=J=>{const se=parseFloat(J.replace(",","."));return Number.isFinite(se)?se:0},ye=A.useMemo(()=>{const J=ke(p),se=ke(k),q=Math.max(J+se,0),te=q>0?parseFloat((q*Rn).toFixed(2)):0,ge=Math.max(q-te,0),W=oe>0?parseFloat((ge/oe).toFixed(2)):0;return{gross:q,pool:te,net:ge,share:W}},[p,k,oe]);A.useEffect(()=>{K()},[d,n,c]);const K=async()=>{if(!(!a&&!n&&!c))try{const J=c||a?await Fr(void 0,d):await Fr(n.id,d),se=ll(),q=xe(se,"yyyy-MM-dd"),te=c?J:J.filter(ge=>{if(d!==q)return a;const W=ge.slots[ge.slots.length-1];return Wu(W.end,se)||a});b(te)}catch(J){console.error("Error loading slots:",J)}},he=J=>{ie.includes(J)?I(ie.filter(se=>se!==J)):I([...ie,J])},Ce=()=>{const J=ke(p),se=ke(k),q=parseInt(j||"0",10);if(!J&&!se)return y("Укажите сумму заработка (основную или по доп. кошелькам)"),null;if(J<0||se<0)return y("Суммы не могут быть отрицательными"),null;if(!M)return y("Выберите сферу заработка"),null;const te=z();if(te.length===0)return y("Выберите хотя бы одного участника"),null;const ge=J+se;return{id:crypto.randomUUID?crypto.randomUUID():`${Date.now()}-${Math.random()}`,category:M,amount:ge,extraWalletsAmount:se,extraWalletsCount:Number.isFinite(q)?q:0,participants:te}},H=()=>{y("");const J=Ce();J&&(w([...f,J]),E(""),L(""),S(""),I([]),ne(!1))},Se=J=>{w(se=>se.filter(q=>q.id!==J))},Ne=async()=>{if(!a&&!n&&!c){y("Пользователь не найден");return}y(""),V(!0);try{if(!g){y("Выберите слот"),V(!1);return}const J=N.find(se=>se.id===g);if(!J&&!c){y("Выбранный слот не найден"),V(!1);return}if(!a&&!c){const se=ll(),q=xe(se,"yyyy-MM-dd");if(d!==q){y("Можно добавить заработок только за сегодня"),V(!1);return}if(J){const te=J.slots[J.slots.length-1];if(!Wu(te.end,se)){y("Слот еще идет или еще не начат. Можно добавить заработок после 21:00 МСК или после окончания слота"),V(!1);return}}}if(c&&t){const se=Ce();if(!se){V(!1);return}await s2(t.id,{date:d,amount:se.amount,poolAmount:parseFloat((se.amount*Rn).toFixed(2)),slotId:g,category:se.category,participants:se.participants,extraWalletsAmount:se.extraWalletsAmount,extraWalletsCount:se.extraWalletsCount})}else{let se=f;if(se.length===0){const q=Ce();if(!q){V(!1);return}se=[q]}for(const q of se)await r2({userId:q.participants[0],date:d,amount:q.amount,poolAmount:parseFloat((q.amount*Rn).toFixed(2)),slotId:g,category:q.category,participants:q.participants,extraWalletsAmount:q.extraWalletsAmount,extraWalletsCount:q.extraWalletsCount})}e()}catch(J){console.error("Error saving earnings:",J);const se=J.message||J.code||"Ошибка при сохранении";y(se)}finally{V(!1)}};return s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-start sm:items-center justify-center z-[70] p-4 sm:p-6 touch-manipulation overflow-y-auto overflow-x-hidden overscroll-contain modal-scroll",children:s.jsxs("div",{className:`w-full max-w-[540px] sm:max-w-3xl rounded-2xl sm:rounded-3xl shadow-xl ${i==="dark"?"bg-[#1a1a1a]":"bg-white"} max-h-[85dvh] sm:max-h-[calc(100dvh-96px)] flex flex-col overflow-hidden`,children:[s.jsx("div",{className:"flex-shrink-0 p-4 sm:p-6",children:s.jsxs("div",{className:"flex items-center justify-between mb-4 sm:mb-6",children:[s.jsx("h3",{className:`text-lg sm:text-xl font-bold ${l} pr-2`,children:c?"Редактировать заработок":"Добавить заработок"}),s.jsx("button",{onClick:r,className:`p-1.5 sm:p-2 rounded-lg flex-shrink-0 ${i==="dark"?"hover:bg-gray-700 active:bg-gray-600 text-gray-200":"hover:bg-gray-100 active:bg-gray-200 text-gray-700"} transition-colors touch-manipulation`,"aria-label":"Закрыть",children:s.jsx(Qt,{className:"w-4 h-4 sm:w-5 sm:h-5"})})]})}),s.jsx("div",{className:"flex-1 min-h-0 overflow-y-auto overflow-x-hidden overscroll-contain modal-scroll px-4 sm:px-6",children:s.jsxs("div",{className:"space-y-3 sm:space-y-4 pb-8 min-w-0",children:[s.jsxs("div",{children:[s.jsxs("label",{className:`flex flex-col sm:flex-row sm:items-center sm:justify-between text-xs sm:text-sm font-medium mb-2 gap-1 sm:gap-2 ${i==="dark"?"text-gray-300":"text-gray-700"}`,children:[s.jsx("span",{children:"Дата"}),!a&&!c&&s.jsx("span",{className:"text-[10px] sm:text-xs text-gray-400 whitespace-nowrap",children:"Доступна только текущая дата"})]}),s.jsx("input",{type:"date",value:d,onChange:J=>h(J.target.value),disabled:!a&&!c,className:`w-full px-3 sm:px-4 py-2 sm:py-2.5 text-sm sm:text-base rounded-lg border touch-manipulation ${i==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49] disabled:opacity-50 disabled:cursor-not-allowed`}),c&&!a&&s.jsx("p",{className:`mt-1 text-xs ${i==="dark"?"text-gray-400":"text-gray-500"}`,children:"Только администратор может изменить дату"})]}),s.jsxs("div",{children:[s.jsx("label",{className:`block text-xs sm:text-sm font-medium mb-2 ${i==="dark"?"text-gray-300":"text-gray-700"}`,children:"Слот"}),s.jsxs("select",{value:g,onChange:J=>x(J.target.value),className:`w-full px-3 sm:px-4 py-2 sm:py-2.5 text-sm sm:text-base rounded-lg border touch-manipulation ${i==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`,children:[s.jsx("option",{value:"",children:"Выберите слот"}),N.map(J=>s.jsx("option",{value:J.id,children:J.slots.map(se=>`${se.start}-${se.end}`).join(", ")},J.id)),c&&t&&!N.find(J=>J.id===t.slotId)&&s.jsx("option",{value:t.slotId,disabled:!0,children:"[Текущий слот - не найден]"})]}),c&&t&&!N.find(J=>J.id===t.slotId)&&s.jsx("p",{className:`mt-1 text-xs ${i==="dark"?"text-gray-400":"text-gray-500"}`,children:"Текущий слот не найден в списке. Выберите другой слот или оставьте текущий."})]}),s.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[s.jsxs("div",{children:[s.jsx("label",{className:`block text-xs sm:text-sm font-medium mb-2 ${i==="dark"?"text-gray-300":"text-gray-700"}`,children:"Сумма заработка (руб.)"}),s.jsx("input",{type:"number",value:p,onChange:J=>E(J.target.value),className:`w-full px-3 sm:px-4 py-2 sm:py-2.5 text-sm sm:text-base rounded-lg border touch-manipulation ${i==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`,placeholder:"0",min:"0",step:"100"})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[s.jsxs("div",{children:[s.jsx("label",{className:`block text-xs sm:text-sm font-medium mb-2 ${i==="dark"?"text-gray-300":"text-gray-700"}`,children:"Кол-во доп. кошельков"}),s.jsx("input",{type:"number",value:j,onChange:J=>S(J.target.value),className:`w-full px-3 sm:px-4 py-2 sm:py-2.5 text-sm sm:text-base rounded-lg border touch-manipulation ${i==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`,placeholder:"0",min:"0",step:"1"})]}),s.jsxs("div",{children:[s.jsx("label",{className:`block text-xs sm:text-sm font-medium mb-2 ${i==="dark"?"text-gray-300":"text-gray-700"}`,children:"Доп. кошельки (руб.)"}),s.jsx("input",{type:"number",value:k,onChange:J=>L(J.target.value),className:`w-full px-3 sm:px-4 py-2 sm:py-2.5 text-sm sm:text-base rounded-lg border touch-manipulation ${i==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`,placeholder:"0",min:"0",step:"100"})]})]}),s.jsx("div",{className:"space-y-1 text-[11px] text-gray-500",children:s.jsx("p",{children:"Общая сумма = основная + доп. кошельки. Пул 45% считается с общей суммы."})})]})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsxs("div",{className:"flex items-center justify-between gap-2",children:[s.jsx("label",{className:`text-xs sm:text-sm font-medium ${i==="dark"?"text-gray-300":"text-gray-700"}`,children:"Сфера заработка"}),s.jsx("span",{className:"text-[10px] sm:text-xs text-gray-400",children:"Влияет на статистику"})]}),s.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-2",children:Object.entries(ws).map(([J,se])=>s.jsxs("button",{type:"button",onClick:()=>T(J),className:`flex items-center gap-2 px-3 py-2 rounded-lg border text-left transition-all ${M===J?"border-[#4E6E49] bg-[#4E6E49]/10 text-[#4E6E49]":i==="dark"?"border-gray-800 bg-gray-800/60 text-gray-200 hover:border-[#4E6E49]/40":"border-gray-200 bg-white text-gray-800 hover:border-[#4E6E49]/40"}`,children:[s.jsx("span",{className:"p-1.5 rounded-lg bg-gray-100 dark:bg-gray-800/80",children:F(J,"w-4 h-4")}),s.jsxs("div",{className:"flex flex-col leading-tight",children:[s.jsx("span",{className:"text-sm font-semibold",children:se.label}),s.jsx("span",{className:"text-[11px] text-gray-500",children:"45% пул / 55% чистыми"})]})]},J))})]}),s.jsxs(s.Fragment,{children:[s.jsxs("label",{className:"flex items-center gap-2",children:[s.jsx("input",{type:"checkbox",checked:O,onChange:J=>ne(J.target.checked),className:"w-4 h-4"}),s.jsx("span",{className:`${i==="dark"?"text-gray-300":"text-gray-700"}`,children:"Отметить несколько участников"})]}),(O||a&&!n)&&s.jsx("div",{className:"ml-0 sm:ml-2 grid grid-cols-2 sm:grid-cols-3 gap-2",children:Ee.filter(J=>!n||J.id!==n.id).map(J=>s.jsxs("label",{className:"flex items-center gap-2 rounded-lg px-2 py-1 border border-gray-200 dark:border-gray-800",children:[s.jsx("input",{type:"checkbox",checked:ie.includes(J.id),onChange:()=>he(J.id),className:"w-4 h-4"}),s.jsx("span",{className:i==="dark"?"text-gray-300":"text-gray-700",children:J.name})]},J.id))})]}),s.jsxs("div",{className:`p-4 rounded-xl border ${i==="dark"?"border-gray-800 bg-gray-900/60":"border-gray-200 bg-gray-50"}`,children:[s.jsxs("div",{className:"flex items-center justify-between gap-2 mb-3",children:[s.jsxs("div",{children:[s.jsx("p",{className:`text-xs font-semibold ${i==="dark"?"text-gray-200":"text-gray-800"}`,children:"Авторасчет"}),s.jsx("p",{className:"text-[11px] text-gray-500",children:"Пул 45% + деление между участниками"})]}),s.jsxs("span",{className:"text-[11px] px-2 py-1 rounded-full bg-[#4E6E49]/10 text-[#4E6E49] font-semibold",children:[re||0," участн."]})]}),s.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-2 mb-3",children:[s.jsxs("div",{className:`p-3 rounded-lg ${i==="dark"?"bg-gray-800/70":"bg-white"}`,children:[s.jsx("p",{className:"text-[11px] text-gray-500",children:"Пул (45%)"}),s.jsxs("p",{className:"text-lg font-bold text-purple-500",children:[ye.pool.toFixed(2)," ₽"]})]}),s.jsxs("div",{className:`p-3 rounded-lg ${i==="dark"?"bg-gray-800/70":"bg-white"}`,children:[s.jsx("p",{className:"text-[11px] text-gray-500",children:"Чистыми после пула"}),s.jsxs("p",{className:"text-lg font-bold text-emerald-500",children:[ye.net.toFixed(2)," ₽"]})]}),s.jsxs("div",{className:`p-3 rounded-lg ${i==="dark"?"bg-gray-800/70":"bg-white"}`,children:[s.jsx("p",{className:"text-[11px] text-gray-500",children:"На каждого"}),s.jsxs("p",{className:"text-lg font-bold text-[#4E6E49]",children:[ye.share.toFixed(2)," ₽"]})]})]}),s.jsxs("div",{className:`text-xs ${i==="dark"?"text-gray-400":"text-gray-600"} mb-1`,children:["Отмеченные участники получат по ",ye.share.toFixed(2)," ₽"]}),s.jsx("div",{className:"flex flex-wrap gap-2",children:ee.length===0?s.jsx("span",{className:"text-xs text-gray-400",children:"Нет выбранных участников"}):ee.map(J=>{var se;return s.jsx("span",{className:`px-2.5 py-1 rounded-full text-xs font-semibold border ${i==="dark"?"border-gray-800 bg-gray-800/70 text-gray-100":"border-gray-200 bg-white text-gray-800"}`,children:((se=Ee.find(q=>q.id===J))==null?void 0:se.name)||J},J)})})]}),!c&&f.length>0&&s.jsxs("div",{className:`rounded-xl border ${i==="dark"?"border-gray-800 bg-gray-900/70":"border-gray-200 bg-gray-50"} p-3 sm:p-4 space-y-3`,children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("p",{className:`text-sm font-semibold ${i==="dark"?"text-gray-200":"text-gray-800"}`,children:"Добавленные записи"}),s.jsxs("span",{className:"text-xs text-gray-500",children:[f.length," шт."]})]}),s.jsx("div",{className:"space-y-2 max-h-64 overflow-y-auto pr-1",children:f.map(J=>s.jsxs("div",{className:`flex flex-col sm:flex-row sm:items-center justify-between gap-3 p-3 rounded-lg border ${i==="dark"?"border-gray-800 bg-gray-800/60":"border-gray-200 bg-white"}`,children:[s.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[s.jsx("div",{className:"p-2 rounded-lg bg-gray-100 dark:bg-gray-900/70",children:F(J.category,"w-4 h-4")}),s.jsxs("div",{className:"min-w-0",children:[s.jsxs("p",{className:"text-sm font-semibold flex items-center gap-2",children:[ws[J.category].label,s.jsxs("span",{className:"text-[11px] text-gray-500",children:["(",J.participants.length," уч.)"]})]}),s.jsxs("p",{className:"text-xs text-gray-500 whitespace-normal break-words",children:["Гросс ",J.amount.toFixed(0)," ₽ • Пул ",(J.amount*Rn).toFixed(0)," ₽ • Чистыми ",(J.amount-J.amount*Rn).toFixed(0)," ₽"]}),J.extraWalletsAmount>0&&s.jsxs("p",{className:"text-[11px] text-gray-500",children:["Доп. кошельки: ",J.extraWalletsCount," на ",J.extraWalletsAmount.toFixed(0)," ₽"]})]})]}),s.jsx("button",{type:"button",onClick:()=>Se(J.id),className:`self-start sm:self-center p-2 rounded-lg ${i==="dark"?"hover:bg-gray-700 text-red-400":"hover:bg-gray-100 text-red-600"}`,"aria-label":"Удалить запись",children:s.jsx(At,{className:"w-4 h-4"})})]},J.id))})]}),_&&s.jsx("div",{className:"p-3 bg-red-500 text-white rounded-lg text-sm",children:_}),s.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 sm:gap-3 pt-2",children:[!c&&s.jsxs("button",{type:"button",onClick:H,disabled:G,className:"flex-1 sm:flex-none sm:px-4 px-4 py-2.5 sm:py-2 border border-[#4E6E49] text-[#4E6E49] rounded-lg sm:rounded-xl font-medium flex items-center justify-center gap-2 hover:bg-[#4E6E49]/10 active:scale-95 transition-colors",children:[s.jsx(ih,{className:"w-4 h-4"}),"Добавить в список"]}),s.jsx("button",{onClick:Ne,disabled:G,className:"flex-1 px-4 py-2.5 sm:py-2 bg-[#4E6E49] hover:bg-[#4E6E49] disabled:bg-gray-400 disabled:cursor-not-allowed text-white rounded-lg sm:rounded-xl transition-colors text-sm sm:text-base font-medium touch-manipulation active:scale-95 disabled:active:scale-100",children:G?"Сохранение...":c?"Сохранить":"Сохранить все"}),s.jsx("button",{type:"button",onClick:r,className:`flex-1 px-4 py-2.5 sm:py-2 rounded-lg sm:rounded-xl border text-sm sm:text-base font-medium transition-colors touch-manipulation active:scale-95 ${i==="dark"?"border-gray-700 text-gray-200 hover:bg-gray-800":"border-gray-300 text-gray-800 hover:bg-gray-100"}`,children:"Отмена"})]})]})})]})})},$k=({earnings:r})=>{const{theme:e}=ct(),t=.45,n=wa(),a=xe(n.start,"yyyy-MM-dd"),i=xe(n.end,"yyyy-MM-dd"),l=xe(new Date(new Date().getFullYear(),new Date().getMonth(),1),"yyyy-MM-dd"),c=xe(new Date(new Date().getFullYear(),new Date().getMonth()+1,0),"yyyy-MM-dd"),d=(E,j,S)=>{const k=r.filter(T=>(T.participants&&T.participants.length>0?[...T.participants,T.userId]:[T.userId]).includes(E)&&T.date>=j&&T.date<=S),L=k.reduce((T,O)=>{const ne=O.participants&&O.participants.length>0?O.participants.length:1,ie=O.poolAmount||O.amount*t,I=Math.max(O.amount-ie,0);return T+I/ne},0),M=k.reduce((T,O)=>{const ne=O.participants&&O.participants.length>0?O.participants.length:1,ie=O.poolAmount||O.amount*t;return T+ie/ne},0);return{totalEarnings:L,totalPool:M,count:k.length}},h=Ee.reduce((E,j)=>{const S=d(j.id,a,i);return E+S.totalEarnings},0),g=Ee.reduce((E,j)=>{const S=d(j.id,a,i);return E+S.totalPool},0),x=Ee.reduce((E,j)=>{const S=d(j.id,l,c);return E+S.totalEarnings},0),p=Ee.reduce((E,j)=>{const S=d(j.id,l,c);return E+S.totalPool},0);return s.jsx("div",{className:`rounded-2xl ${e==="dark"?"bg-[#1a1a1a]":"bg-white"} shadow-lg border-2 ${e==="dark"?"border-gray-800":"border-gray-200"} overflow-hidden`,children:s.jsxs("div",{className:"p-6",children:[s.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[s.jsx("div",{className:`p-2 rounded-lg ${e==="dark"?"bg-blue-500/20":"bg-blue-100"}`,children:s.jsx(Pr,{className:`w-5 h-5 ${e==="dark"?"text-blue-400":"text-blue-600"}`})}),s.jsx("h3",{className:`text-xl font-bold ${e==="dark"?"text-white":"text-gray-900"}`,children:"Статистика заработка"})]}),s.jsxs("div",{className:"mb-6",children:[s.jsx("h4",{className:`text-lg font-semibold mb-4 px-2 ${e==="dark"?"text-white":"text-gray-900"}`,children:"За неделю"}),s.jsx("div",{className:"overflow-x-auto rounded-xl border-2 border-gray-800/50 dark:border-gray-800",children:s.jsxs("table",{className:"w-full",children:[s.jsx("thead",{children:s.jsxs("tr",{className:`${e==="dark"?"bg-gray-700/50":"bg-gray-100"}`,children:[s.jsx("th",{className:`px-4 py-3 text-left text-sm font-semibold ${e==="dark"?"text-white":"text-gray-900"}`,children:"Участник"}),s.jsx("th",{className:`px-4 py-3 text-right text-sm font-semibold ${e==="dark"?"text-white":"text-gray-900"}`,children:"Чистыми"}),s.jsx("th",{className:`px-4 py-3 text-right text-sm font-semibold ${e==="dark"?"text-white":"text-gray-900"}`,children:"Пул 45%"})]})}),s.jsxs("tbody",{children:[Ee.map(E=>{const j=d(E.id,a,i);return s.jsxs("tr",{className:`border-b border-gray-800/30 dark:border-gray-800 transition-colors ${e==="dark"?"hover:bg-gray-700/30":"hover:bg-gray-50"}`,children:[s.jsx("td",{className:`px-4 py-3 font-medium ${e==="dark"?"text-white":"text-gray-900"}`,children:E.name}),s.jsxs("td",{className:"px-4 py-3 text-right font-semibold text-[#4E6E49]",children:[j.totalEarnings.toFixed(2)," ₽"]}),s.jsxs("td",{className:`px-4 py-3 text-right font-semibold ${e==="dark"?"text-purple-400":"text-purple-600"}`,children:[j.totalPool.toFixed(2)," ₽"]})]},E.id)}),s.jsxs("tr",{className:`${e==="dark"?"bg-gray-700/70":"bg-gray-100"} font-bold border-t-2 border-gray-800/50 dark:border-gray-800`,children:[s.jsx("td",{className:`px-4 py-3 ${e==="dark"?"text-white":"text-gray-900"}`,children:"Итого команды"}),s.jsxs("td",{className:"px-4 py-3 text-right text-[#4E6E49]",children:[h.toFixed(2)," ₽"]}),s.jsxs("td",{className:`px-4 py-3 text-right ${e==="dark"?"text-purple-400":"text-purple-600"}`,children:[g.toFixed(2)," ₽"]})]})]})]})})]}),s.jsxs("div",{children:[s.jsx("h4",{className:`text-lg font-semibold mb-4 px-2 ${e==="dark"?"text-white":"text-gray-900"}`,children:"За месяц"}),s.jsx("div",{className:"overflow-x-auto rounded-xl border-2 border-gray-800/50 dark:border-gray-800",children:s.jsxs("table",{className:"w-full",children:[s.jsx("thead",{children:s.jsxs("tr",{className:`${e==="dark"?"bg-gray-700/50":"bg-gray-100"}`,children:[s.jsx("th",{className:`px-4 py-3 text-left text-sm font-semibold ${e==="dark"?"text-white":"text-gray-900"}`,children:"Участник"}),s.jsx("th",{className:`px-4 py-3 text-right text-sm font-semibold ${e==="dark"?"text-white":"text-gray-900"}`,children:"Чистыми"}),s.jsx("th",{className:`px-4 py-3 text-right text-sm font-semibold ${e==="dark"?"text-white":"text-gray-900"}`,children:"Пул 45%"})]})}),s.jsxs("tbody",{children:[Ee.map(E=>{const j=d(E.id,l,c);return s.jsxs("tr",{className:`border-b border-gray-800/30 dark:border-gray-800 transition-colors ${e==="dark"?"hover:bg-gray-700/30":"hover:bg-gray-50"}`,children:[s.jsx("td",{className:`px-4 py-3 font-medium ${e==="dark"?"text-white":"text-gray-900"}`,children:E.name}),s.jsxs("td",{className:"px-4 py-3 text-right font-semibold text-[#4E6E49]",children:[j.totalEarnings.toFixed(2)," ₽"]}),s.jsxs("td",{className:`px-4 py-3 text-right font-semibold ${e==="dark"?"text-purple-400":"text-purple-600"}`,children:[j.totalPool.toFixed(2)," ₽"]})]},E.id)}),s.jsxs("tr",{className:`${e==="dark"?"bg-gray-700/70":"bg-gray-100"} font-bold border-t-2 border-gray-800/50 dark:border-gray-800`,children:[s.jsx("td",{className:`px-4 py-3 ${e==="dark"?"text-white":"text-gray-900"}`,children:"Итого команды"}),s.jsxs("td",{className:"px-4 py-3 text-right text-[#4E6E49]",children:[x.toFixed(2)," ₽"]}),s.jsxs("td",{className:`px-4 py-3 text-right ${e==="dark"?"text-purple-400":"text-purple-600"}`,children:[p.toFixed(2)," ₽"]})]})]})]})})]})]})})},Mk=({earnings:r,onEdit:e,onDelete:t})=>{const{theme:n}=ct(),{user:a}=Dt(),{isAdmin:i}=Bt(),[l,c]=A.useState(null),d=.45,h=(T,O="w-4 h-4")=>{switch(T){case"memecoins":return s.jsx(oa,{className:O});case"futures":return s.jsx(ia,{className:O});case"nft":return s.jsx(aa,{className:O});case"spot":return s.jsx(ur,{className:O});case"polymarket":return s.jsx(gl,{className:O});case"staking":return s.jsx(Pi,{className:O});default:return s.jsx(zt,{className:O})}},g=async T=>{if(confirm("Вы уверены, что хотите удалить эту запись о заработке?")){c(T);try{await n2(T),t()}catch(O){console.error("Error deleting earnings:",O),alert("Ошибка при удалении записи")}finally{c(null)}}},x=T=>T.participants&&T.participants.length>0?T.participants:[T.userId],p=T=>T.poolAmount||T.amount*d,E=T=>Math.max(T.amount-p(T),0),j=T=>{const O=x(T);return O.length?E(T)/O.length:E(T)},S=T=>ws[T]||ws.other,k=T=>{var O;return((O=Ee.find(ne=>ne.id===T))==null?void 0:O.name)||T},L=T=>i||T.userId===(a==null?void 0:a.id),M=[...r].sort((T,O)=>O.date.localeCompare(T.date));return M.length===0?s.jsxs("div",{className:`rounded-2xl p-8 text-center border-2 ${n==="dark"?"bg-[#1a1a1a] border-gray-800":"bg-white border-gray-200"} shadow-md`,children:[s.jsx("p",{className:`${n==="dark"?"text-gray-400":"text-gray-600"} text-lg`,children:"Пока нет записей о заработке"}),s.jsx("p",{className:"text-gray-500 text-sm mt-2",children:"Добавьте первую запись, чтобы начать отслеживать доходы команды"})]}):s.jsx("div",{className:`rounded-2xl ${n==="dark"?"bg-[#1a1a1a]":"bg-white"} shadow-lg border-2 ${n==="dark"?"border-gray-800":"border-gray-200"} overflow-hidden`,children:s.jsxs("div",{className:"p-6",children:[s.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[s.jsx("div",{className:`p-2 rounded-lg ${n==="dark"?"bg-blue-500/20":"bg-blue-100"}`,children:s.jsx(cd,{className:`w-5 h-5 ${n==="dark"?"text-blue-400":"text-blue-600"}`})}),s.jsx("h3",{className:`text-xl font-bold ${n==="dark"?"text-white":"text-gray-900"}`,children:"Все записи о заработке"})]}),s.jsx("div",{className:"overflow-x-auto rounded-xl border-2 border-gray-800/50 dark:border-gray-800",children:s.jsxs("table",{className:"w-full",children:[s.jsx("thead",{children:s.jsxs("tr",{className:`${n==="dark"?"bg-gray-700/50":"bg-gray-100"}`,children:[s.jsx("th",{className:`px-4 py-3 text-left text-sm font-semibold ${n==="dark"?"text-white":"text-gray-900"}`,children:"Дата"}),s.jsx("th",{className:`px-4 py-3 text-left text-sm font-semibold ${n==="dark"?"text-white":"text-gray-900"}`,children:"Сфера"}),s.jsx("th",{className:`px-4 py-3 text-left text-sm font-semibold ${n==="dark"?"text-white":"text-gray-900"}`,children:"Участники"}),s.jsx("th",{className:`px-4 py-3 text-right text-sm font-semibold ${n==="dark"?"text-white":"text-gray-900"}`,children:"Чистыми"}),s.jsx("th",{className:`px-4 py-3 text-right text-sm font-semibold ${n==="dark"?"text-white":"text-gray-900"}`,children:"Пул 45%"}),s.jsx("th",{className:`px-4 py-3 text-center text-sm font-semibold ${n==="dark"?"text-white":"text-gray-900"}`,children:"Действия"})]})}),s.jsx("tbody",{children:M.map(T=>{const O=x(T),ne=S(T.category),ie=E(T),I=j(T),N=L(T);return s.jsxs("tr",{className:`border-b border-gray-800/30 dark:border-gray-800 transition-colors ${n==="dark"?"hover:bg-gray-700/30":"hover:bg-gray-50"}`,children:[s.jsx("td",{className:`px-4 py-3 font-medium ${n==="dark"?"text-white":"text-gray-900"}`,children:xe(new Date(T.date+"T00:00:00"),"dd.MM.yyyy")}),s.jsx("td",{className:"px-4 py-3",children:s.jsxs("span",{className:`inline-flex items-center gap-2 px-2.5 py-1 rounded-full text-xs font-semibold ${n==="dark"?"bg-gray-800 text-gray-100":"bg-gray-100 text-gray-900"}`,children:[h(T.category,"w-4 h-4"),ne.label]})}),s.jsx("td",{className:"px-4 py-3",children:s.jsx("div",{className:"flex flex-wrap gap-2",children:O.map(b=>s.jsx("span",{className:`px-2.5 py-1 rounded-full text-xs font-semibold border ${n==="dark"?"border-gray-800 bg-gray-800/70 text-gray-100":"border-gray-200 bg-white text-gray-800"}`,children:k(b)},b))})}),s.jsxs("td",{className:"px-4 py-3 text-right font-semibold text-[#4E6E49]",children:[s.jsxs("div",{children:[ie.toFixed(2)," ₽"]}),s.jsxs("div",{className:"text-xs text-gray-500",children:["по ",I.toFixed(2)," ₽"]}),T.extraWalletsAmount?s.jsxs("div",{className:"text-[11px] text-gray-500 flex items-center gap-1 mt-1",children:[s.jsx(Op,{className:"w-3 h-3"}),T.extraWalletsCount||0," / ",T.extraWalletsAmount.toFixed(0)," ₽"]}):null]}),s.jsxs("td",{className:`px-4 py-3 text-right font-semibold ${n==="dark"?"text-purple-400":"text-purple-600"}`,children:[p(T).toFixed(2)," ₽"]}),s.jsx("td",{className:"px-4 py-3 text-center",children:N?s.jsxs("div",{className:"flex items-center justify-center gap-2",children:[s.jsx("button",{onClick:()=>e(T),className:`p-2 rounded-lg transition-colors ${n==="dark"?"hover:bg-gray-600 text-blue-400":"hover:bg-gray-200 text-blue-600"}`,title:"Редактировать",children:s.jsx(cd,{className:"w-4 h-4"})}),s.jsx("button",{onClick:()=>g(T.id),disabled:l===T.id,className:`p-2 rounded-lg transition-colors ${n==="dark"?"hover:bg-gray-600 text-red-400":"hover:bg-gray-200 text-red-600"} disabled:opacity-50 disabled:cursor-not-allowed`,title:"Удалить",children:s.jsx(At,{className:"w-4 h-4"})})]}):s.jsx("span",{className:`text-sm ${n==="dark"?"text-gray-500":"text-gray-400"}`,children:"—"})})]},T.id)})})]})})]})})},Ok=()=>{const{theme:r}=ct(),[e,t]=A.useState(!1),[n,a]=A.useState(null),[i,l]=A.useState([]),[c,d]=A.useState(!0),[h,g]=A.useState({weekTotal:0,weekPool:0,weekNet:0,monthTotal:0,monthPool:0,monthNet:0}),x=.45,p=Object.keys(ws),E=r==="dark"?"bg-[#1a1a1a]":"bg-white",j=_=>_.poolAmount||_.amount*x,S=_=>Math.max(_.amount-j(_),0),k=_=>{var y;return(y=_.participants)!=null&&y.length?_.participants:[_.userId]},L=_=>{var y;return((y=Ee.find(G=>G.id===_))==null?void 0:y.name)||_},M=(_,y="w-4 h-4")=>{switch(_){case"memecoins":return s.jsx(oa,{className:y});case"futures":return s.jsx(ia,{className:y});case"nft":return s.jsx(aa,{className:y});case"spot":return s.jsx(ur,{className:y});case"polymarket":return s.jsx(gl,{className:y});case"staking":return s.jsx(Pi,{className:y});default:return s.jsx(zt,{className:y})}},T=()=>{const _=wa(),y=xe(_.start,"yyyy-MM-dd"),G=xe(_.end,"yyyy-MM-dd"),V=xe(new Date(new Date().getFullYear(),new Date().getMonth(),1),"yyyy-MM-dd"),F=xe(new Date(new Date().getFullYear(),new Date().getMonth()+1,0),"yyyy-MM-dd"),z=i.filter(re=>re.date>=y&&re.date<=G),ee=i.filter(re=>re.date>=V&&re.date<=F);g({weekTotal:z.reduce((re,oe)=>re+oe.amount,0),weekPool:z.reduce((re,oe)=>re+j(oe),0),weekNet:z.reduce((re,oe)=>re+S(oe),0),monthTotal:ee.reduce((re,oe)=>re+oe.amount,0),monthPool:ee.reduce((re,oe)=>re+j(oe),0),monthNet:ee.reduce((re,oe)=>re+S(oe),0)})};A.useEffect(()=>{O()},[]),A.useEffect(()=>{T()},[i]);const O=async()=>{d(!0);try{const _=await ra();l(_)}catch(_){console.error("Error loading earnings:",_)}finally{d(!1)}},ne=_=>{a(_),t(!0)},ie=()=>{t(!1),a(null)},I=()=>{t(!1),a(null),O()},N=p.map(_=>{const y=i.filter(re=>re.category===_),G=y.reduce((re,oe)=>re+oe.amount,0),V=y.reduce((re,oe)=>re+j(oe),0),F=y.reduce((re,oe)=>re+S(oe),0),z=new Map;y.forEach(re=>{const oe=k(re),ke=S(re)/Math.max(oe.length,1);oe.forEach(ye=>{z.set(ye,(z.get(ye)||0)+ke)})});const ee=Array.from(z.entries()).sort((re,oe)=>oe[1]-re[1]).slice(0,2);return{key:_,gross:G,pool:V,net:F,count:y.length,topParticipants:ee}}),b=Ee.map(_=>{const y=i.filter(F=>k(F).includes(_.id)),G=y.reduce((F,z)=>{const ee=S(z)/Math.max(k(z).length,1);return F+ee},0),V=y.reduce((F,z)=>{const ee=j(z)/Math.max(k(z).length,1);return F+ee},0);return{..._,net:G,poolShare:V}}).sort((_,y)=>y.net-_.net),f=[...N].sort((_,y)=>y.net-_.net)[0],w=b[0];return s.jsx(ir,{children:s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:`rounded-xl sm:rounded-2xl p-4 sm:p-6 md:p-8 ${E} shadow-xl border-2 ${r==="dark"?"border-[#4E6E49]/30 bg-gradient-to-br from-[#1a1a1a] via-[#1a1a1a] to-[#0A0A0A]":"border-green-200 bg-gradient-to-br from-white via-green-50/30 to-white"} relative overflow-hidden`,children:[s.jsx("div",{className:"absolute top-0 right-0 w-32 h-32 sm:w-64 sm:h-64 bg-gradient-to-br from-[#4E6E49]/10 to-emerald-700/10 rounded-full blur-3xl -mr-16 sm:-mr-32 -mt-16 sm:-mt-32"}),s.jsx("div",{className:"absolute bottom-0 left-0 w-24 h-24 sm:w-48 sm:h-48 bg-gradient-to-tr from-yellow-500/10 to-orange-500/10 rounded-full blur-2xl -ml-12 sm:-ml-24 -mb-12 sm:-mb-24"}),s.jsx("div",{className:"relative z-10",children:s.jsxs("div",{className:"flex flex-col gap-4 sm:gap-6 lg:flex-row lg:items-start lg:justify-between mb-4 sm:mb-6",children:[s.jsxs("div",{className:"flex-1 min-w-0 space-y-3 sm:space-y-4",children:[s.jsxs("div",{className:"flex items-center gap-3 sm:gap-4",children:[s.jsx("div",{className:"p-3 sm:p-4 rounded-xl sm:rounded-2xl shadow-lg flex-shrink-0 bg-gradient-to-br from-[#4E6E49] to-emerald-700 text-white transform transition-transform active:scale-95 sm:hover:scale-110",children:s.jsx(na,{className:"w-5 h-5 sm:w-7 sm:h-7"})}),s.jsx("div",{className:"flex-1 min-w-0",children:s.jsxs("h1",{className:"text-2xl sm:text-3xl md:text-4xl font-extrabold text-white flex items-center gap-2 sm:gap-3 drop-shadow-lg",children:[s.jsx("span",{children:"Заработок команды"}),s.jsx(zt,{className:`w-5 h-5 sm:w-6 sm:h-6 flex-shrink-0 ${r==="dark"?"text-yellow-300":"text-yellow-500"} animate-pulse`})]})})]}),s.jsx("p",{className:`text-sm sm:text-base font-medium ${r==="dark"?"text-gray-400":"text-gray-600"}`,children:"Отслеживайте доходы и вклад каждого участника в общий успех"}),s.jsx("div",{className:"flex flex-wrap gap-2",children:[{href:"#earn-stats",label:"Обзор"},{href:"#earn-history",label:"История"},{href:"#earn-insights",label:"Инсайты"}].map(_=>s.jsx("a",{href:_.href,className:`px-3 py-1.5 rounded-lg text-xs font-semibold border transition ${r==="dark"?"border-white/10 bg-white/5 text-white hover:border-[#4E6E49]/50":"border-gray-200 bg-white text-gray-800 hover:border-[#4E6E49]/50 hover:text-[#4E6E49]"}`,children:_.label},_.href))})]}),s.jsxs("button",{onClick:()=>t(!0),className:"w-full lg:w-auto px-4 sm:px-6 py-3 sm:py-4 bg-gradient-to-r from-[#4E6E49] to-[#4E6E49] hover:from-[#4E6E49] hover:to-[#4E6E49] text-white rounded-lg sm:rounded-xl transition-all duration-200 flex items-center justify-center gap-2 text-sm sm:text-base font-semibold shadow-lg hover:shadow-xl active:scale-95 sm:hover:scale-105 transform touch-manipulation",children:[s.jsx(li,{className:"w-4 h-4 sm:w-5 sm:h-5 flex-shrink-0"}),s.jsx("span",{className:"whitespace-nowrap",children:"Добавить заработок"})]})]})}),s.jsxs("div",{id:"earn-stats",className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-6",children:[s.jsxs("div",{className:`p-4 rounded-xl border-2 ${r==="dark"?"bg-blue-500/10 border-blue-500/30":"bg-blue-50 border-blue-200"}`,children:[s.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[s.jsx("div",{className:`p-2 rounded-lg ${r==="dark"?"bg-blue-500/20":"bg-blue-100"}`,children:s.jsx(Pr,{className:`w-5 h-5 ${r==="dark"?"text-blue-400":"text-blue-600"}`})}),s.jsx("p",{className:`text-xs ${r==="dark"?"text-gray-400":"text-gray-600"}`,children:"Неделя (чистыми)"})]}),s.jsxs("p",{className:`text-2xl font-bold ${r==="dark"?"text-blue-400":"text-blue-600"}`,children:[h.weekNet.toFixed(2)," ₽"]}),s.jsxs("p",{className:"text-[11px] text-gray-500 mt-1",children:["Гросс: ",h.weekTotal.toFixed(2)," ₽"]})]}),s.jsxs("div",{className:`p-4 rounded-xl border-2 ${r==="dark"?"bg-purple-500/10 border-purple-500/30":"bg-purple-50 border-purple-200"}`,children:[s.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[s.jsx("div",{className:`p-2 rounded-lg ${r==="dark"?"bg-purple-500/20":"bg-purple-100"}`,children:s.jsx(dd,{className:`w-5 h-5 ${r==="dark"?"text-purple-400":"text-purple-600"}`})}),s.jsx("p",{className:`text-xs ${r==="dark"?"text-gray-400":"text-gray-600"}`,children:"Пул за неделю"})]}),s.jsxs("p",{className:`text-2xl font-bold ${r==="dark"?"text-purple-400":"text-purple-600"}`,children:[h.weekPool.toFixed(2)," ₽"]})]}),s.jsxs("div",{className:`p-4 rounded-xl border-2 ${r==="dark"?"bg-[#4E6E49]/10 border-[#4E6E49]/30":"bg-green-50 border-green-200"}`,children:[s.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[s.jsx("div",{className:`p-2 rounded-lg ${r==="dark"?"bg-[#4E6E49]/20":"bg-green-100"}`,children:s.jsx(Vp,{className:"w-5 h-5 text-[#4E6E49]"})}),s.jsx("p",{className:`text-xs ${r==="dark"?"text-gray-400":"text-gray-600"}`,children:"Месяц (чистыми)"})]}),s.jsxs("p",{className:"text-2xl font-bold text-[#4E6E49]",children:[h.monthNet.toFixed(2)," ₽"]}),s.jsxs("p",{className:"text-[11px] text-gray-500 mt-1",children:["Гросс: ",h.monthTotal.toFixed(2)," ₽"]})]}),s.jsxs("div",{className:`p-4 rounded-xl border-2 ${r==="dark"?"bg-orange-500/10 border-orange-500/30":"bg-orange-50 border-orange-200"}`,children:[s.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[s.jsx("div",{className:`p-2 rounded-lg ${r==="dark"?"bg-orange-500/20":"bg-orange-100"}`,children:s.jsx(dd,{className:`w-5 h-5 ${r==="dark"?"text-orange-400":"text-orange-600"}`})}),s.jsx("p",{className:`text-xs ${r==="dark"?"text-gray-400":"text-gray-600"}`,children:"Пул за месяц"})]}),s.jsxs("p",{className:`text-2xl font-bold ${r==="dark"?"text-orange-400":"text-orange-600"}`,children:[h.monthPool.toFixed(2)," ₽"]})]})]}),s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4 mb-4",children:[s.jsxs("div",{className:`lg:col-span-2 rounded-2xl p-5 ${E} border ${r==="dark"?"border-white/10":"border-gray-200"} shadow-lg`,children:[s.jsx("div",{className:"flex items-center justify-between mb-4",children:s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:`p-2 rounded-lg ${r==="dark"?"bg-[#4E6E49]/20":"bg-green-100"}`,children:s.jsx(Ap,{className:"w-5 h-5 text-[#4E6E49]"})}),s.jsxs("div",{children:[s.jsx("p",{className:`text-sm font-semibold ${r==="dark"?"text-gray-200":"text-gray-800"}`,children:"Сферы заработка"}),s.jsx("p",{className:"text-xs text-gray-500",children:"Сколько приносит каждый поток"})]})]})}),s.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3",children:N.map(_=>{const y=ws[_.key];return s.jsxs("div",{className:`p-3 rounded-xl border ${r==="dark"?"border-gray-800 bg-gray-900/70":"border-gray-200 bg-white"} shadow-sm`,children:[s.jsxs("div",{className:"flex items-start justify-between gap-2",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("span",{className:"p-2 rounded-lg bg-gray-100 dark:bg-gray-800/80 flex items-center justify-center",children:M(_.key,"w-4 h-4")}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-semibold",children:y.label}),s.jsxs("p",{className:"text-[11px] text-gray-500",children:[_.count," записей"]})]})]}),s.jsxs("span",{className:"text-sm font-bold text-[#4E6E49]",children:[_.net.toFixed(0)," ₽"]})]}),s.jsxs("div",{className:"grid grid-cols-2 gap-2 mt-2 text-xs text-gray-500",children:[s.jsxs("div",{children:["Пул: ",_.pool.toFixed(0)," ₽"]}),s.jsxs("div",{children:["Гросс: ",_.gross.toFixed(0)," ₽"]})]}),s.jsxs("div",{className:"mt-2",children:[s.jsx("p",{className:"text-[11px] uppercase tracking-wide text-gray-500 mb-1",children:"Топ участники"}),s.jsx("div",{className:"flex flex-wrap gap-1.5",children:_.topParticipants.length===0?s.jsx("span",{className:"text-[11px] text-gray-500",children:"Нет записей"}):_.topParticipants.map(([G,V])=>s.jsxs("span",{className:`px-2 py-1 rounded-full text-[11px] font-semibold ${r==="dark"?"bg-gray-800 text-gray-100":"bg-gray-100 text-gray-800"}`,children:[L(G)," · ",V.toFixed(0)," ₽"]},G))})]})]},_.key)})})]}),s.jsxs("div",{className:`rounded-2xl p-5 ${E} border ${r==="dark"?"border-white/10":"border-gray-200"} shadow-lg`,children:[s.jsx("div",{className:"flex items-center justify-between mb-4",children:s.jsxs("div",{children:[s.jsx("p",{className:`text-sm font-semibold ${r==="dark"?"text-gray-200":"text-gray-800"}`,children:"Лидеры по доходу"}),s.jsx("p",{className:"text-xs text-gray-500",children:"Кто приносит больше всего чистыми"})]})}),s.jsxs("div",{className:"space-y-3",children:[b.slice(0,3).map((_,y)=>s.jsxs("div",{className:`flex items-center justify-between p-3 rounded-xl border ${r==="dark"?"border-gray-800 bg-gray-900/70":"border-gray-200 bg-white"}`,children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("span",{className:`w-7 h-7 rounded-full flex items-center justify-center text-sm font-bold ${r==="dark"?"bg-gray-800 text-gray-100":"bg-gray-100 text-gray-800"}`,children:y+1}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-semibold",children:_.name}),s.jsxs("p",{className:"text-[11px] text-gray-500",children:["Пул: ",_.poolShare.toFixed(0)," ₽"]})]})]}),s.jsxs("div",{className:"text-right",children:[s.jsxs("p",{className:"text-base font-bold text-[#4E6E49]",children:[_.net.toFixed(0)," ₽"]}),s.jsx("p",{className:"text-[11px] text-gray-500",children:"чистыми"})]})]},_.id)),b.length===0&&s.jsx("p",{className:"text-sm text-gray-500",children:"Нет данных по заработку"})]})]})]}),s.jsx("div",{className:"hidden sm:flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between pt-4 border-t border-gray-800/50 dark:border-gray-800",children:s.jsx("h2",{className:`text-base sm:text-lg md:text-xl font-semibold ${r==="dark"?"text-white":"text-gray-900"}`,children:"Управление заработком"})})]}),c?s.jsx("div",{className:`rounded-xl p-8 text-center border-2 ${r==="dark"?"bg-[#1a1a1a] border-gray-800":"bg-white border-gray-200"} shadow-md`,children:s.jsxs("div",{className:"flex flex-col items-center gap-3",children:[s.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-[#4E6E49]"}),s.jsx("p",{className:r==="dark"?"text-gray-400":"text-gray-600",children:"Загрузка данных..."})]})}):s.jsxs(s.Fragment,{children:[s.jsxs("div",{id:"earn-history",className:"space-y-6",children:[s.jsx($k,{earnings:i}),s.jsx(Mk,{earnings:i,onEdit:ne,onDelete:O})]}),s.jsxs("div",{id:"earn-insights",className:`rounded-2xl p-6 ${E} border ${r==="dark"?"border-white/10":"border-gray-200"} shadow-lg space-y-4`,children:[s.jsx("div",{className:"flex items-center justify-between",children:s.jsxs("div",{children:[s.jsx("p",{className:`text-sm font-semibold ${r==="dark"?"text-gray-300":"text-gray-700"}`,children:"Инсайты"}),s.jsx("p",{className:`text-xs ${r==="dark"?"text-gray-400":"text-gray-500"}`,children:"Где мы зарабатываем больше всего"})]})}),s.jsx("div",{className:"grid sm:grid-cols-2 lg:grid-cols-4 gap-3",children:[{label:"Топ категория",value:f?`${ws[f.key].label} · ${f.net.toFixed(0)} ₽`:"Нет данных",tone:"bg-blue-500/10 text-blue-600 dark:text-blue-200"},{label:"Лидер команды",value:w?`${w.name} · ${w.net.toFixed(0)} ₽`:"Нет данных",tone:"bg-purple-500/10 text-purple-600 dark:text-purple-200"},{label:"Доля пула (мес.)",value:h.monthTotal?`${Math.round(h.monthPool/h.monthTotal*100)}%`:"45%",tone:"bg-emerald-500/10 text-emerald-600 dark:text-emerald-200"},{label:"Средняя выплата",value:i.length?`${(i.reduce((_,y)=>_+S(y),0)/i.length).toFixed(0)} ₽`:"0 ₽",tone:"bg-orange-500/10 text-orange-600 dark:text-orange-200"}].map(_=>s.jsxs("div",{className:`p-3 rounded-xl ${_.tone} border ${r==="dark"?"border-white/10":"border-transparent"} shadow-sm`,children:[s.jsx("p",{className:"text-[11px] uppercase tracking-wide opacity-70",children:_.label}),s.jsx("p",{className:"text-xl font-extrabold",children:_.value})]},_.label))})]})]}),e&&s.jsx(Pk,{onClose:ie,onSave:I,editingEarning:n})]})})},Bg=(r,e=0,t=0,n=0)=>{let a=0;(r.daysOff===0||r.daysOff<=2)&&(a+=10),r.sickDays<=7&&(a+=10),r.vacationDays<=7&&(a+=10),e>=20?a+=25:e>=15&&(a+=15),t>=6e3?a+=30:t>=3e3&&(a+=15);const i=Math.min(r.referrals*5,30);return a+=i,n>50&&(a+=15),Math.min(a,100)},qg=(r,e=0,t=0,n=0)=>{const a=r.daysOff===0||r.daysOff<=2?10:0,i=r.sickDays<=7?10:0,l=r.vacationDays<=7?10:0;let c=0;e>=20?c=25:e>=15&&(c=15);let d=0;t>=6e3?d=30:t>=3e3&&(d=15);const h=Math.min(r.referrals*5,30),g=n>50?15:0,x=Math.min(a+i+l+c+d+h+g,100);return{daysOff:r.daysOff,daysOffPoints:a,sickDays:r.sickDays,sickDaysPoints:i,vacationDays:r.vacationDays,vacationDaysPoints:l,weeklyHours:e,weeklyHoursPoints:c,weeklyEarnings:t,weeklyEarningsPoints:d,referrals:r.referrals,referralsPoints:h,weeklyMessages:n,weeklyMessagesPoints:g,totalRating:x}},Vk=r=>r>=1&&r<=10?"#ef4444":r>=11&&r<=30?"#f97316":r>=31&&r<=59?"#eab308":r>=60&&r<=80?"#3b82f6":r>=81&&r<=100?"#10b981":"#6b7280",Lk=({rating:r})=>{const{theme:e}=ct(),[t,n]=A.useState(null),a=Ee.find(T=>T.id===r.userId),i=Vk(r.rating),l=e==="dark"?"text-white":"text-gray-900",c=e==="dark"?"text-gray-400":"text-gray-600",d=e==="dark"?"bg-[#0f0f0f]":"bg-white",h=e==="dark"?"border-white/10":"border-gray-200",g=e==="dark"?"hover:bg-white/5":"hover:bg-gray-50",x=e==="dark"?"bg-white/5":"bg-gray-50/80",p=r.rating<=0?"4%":`${Math.min(r.rating,100)}%`,E=r.lastUpdated?new Date(r.lastUpdated):null,S={1:{bg:e==="dark"?"bg-emerald-500/10":"bg-emerald-50",border:e==="dark"?"border-emerald-400/30":"border-emerald-200",text:e==="dark"?"text-emerald-100":"text-emerald-900",icon:e==="dark"?"text-emerald-200":"text-emerald-600",soft:e==="dark"?"bg-emerald-500/8":"bg-emerald-50"},2:{bg:e==="dark"?"bg-sky-500/10":"bg-sky-50",border:e==="dark"?"border-sky-400/30":"border-sky-200",text:e==="dark"?"text-sky-100":"text-sky-900",icon:e==="dark"?"text-sky-200":"text-sky-600",soft:e==="dark"?"bg-sky-500/8":"bg-sky-50"},3:{bg:e==="dark"?"bg-purple-500/10":"bg-purple-50",border:e==="dark"?"border-purple-400/30":"border-purple-200",text:e==="dark"?"text-purple-100":"text-purple-900",icon:e==="dark"?"text-purple-200":"text-purple-600",soft:e==="dark"?"bg-purple-500/8":"bg-purple-50"},4:{bg:e==="dark"?"bg-amber-500/10":"bg-amber-50",border:e==="dark"?"border-amber-400/30":"border-amber-200",text:e==="dark"?"text-amber-100":"text-amber-900",icon:e==="dark"?"text-amber-200":"text-amber-600",soft:e==="dark"?"bg-amber-500/8":"bg-amber-50"},5:{bg:e==="dark"?"bg-rose-500/10":"bg-rose-50",border:e==="dark"?"border-rose-400/30":"border-rose-200",text:e==="dark"?"text-rose-100":"text-rose-900",icon:e==="dark"?"text-rose-200":"text-rose-600",soft:e==="dark"?"bg-rose-500/8":"bg-rose-50"},default:{bg:e==="dark"?"bg-white/5":"bg-gray-50",border:e==="dark"?"border-white/10":"border-gray-200",text:e==="dark"?"text-white":"text-gray-900",icon:e==="dark"?"text-white":"text-gray-700",soft:e==="dark"?"bg-white/5":"bg-gray-50"}}[(a==null?void 0:a.id)||"default"],k=T=>T>=81?"🏆":T>=60?"⭐":T>=31?"📊":T>=11?"📈":T>=1?"⚠️":"❌",L=r.breakdown?[{icon:s.jsx(br,{className:"w-5 h-5"}),label:"Выходные",value:`${r.breakdown.daysOff} день`,points:r.breakdown.daysOffPoints,maxPoints:10,explanation:"0-2 выходных в неделю = 10% к рейтингу. Более 2 выходных = 0%. Показывает стабильность присутствия.",threshold:"0-2 дня",color:"bg-amber-200 text-amber-900"},{icon:s.jsx(bp,{className:"w-5 h-5"}),label:"Больничные",value:`${r.breakdown.sickDays} дней`,points:r.breakdown.sickDaysPoints,maxPoints:10,explanation:"До 7 дней больничного в месяц = 10% к рейтингу. Более 7 дней = 0%. Учитывается за последние 30 дней.",threshold:"≤7 дней",color:"bg-purple-200 text-purple-900"},{icon:s.jsx(ah,{className:"w-5 h-5"}),label:"Отпуск",value:`${r.breakdown.vacationDays} дней`,points:r.breakdown.vacationDaysPoints,maxPoints:10,explanation:"До 7 дней отпуска в месяц = 10% к рейтингу. Более 7 дней = 0%. Учитывается за последние 30 дней.",threshold:"≤7 дней",color:"bg-orange-200 text-orange-900"},{icon:s.jsx(en,{className:"w-5 h-5"}),label:"Часы работы",value:Ik(r.breakdown.weeklyHours),points:r.breakdown.weeklyHoursPoints,maxPoints:25,explanation:"20+ часов в неделю = 25% к рейтингу. 15-19 часов = 15%. Менее 15 часов = 0%. Показывает объем работы за неделю.",threshold:"≥20ч: 25% | ≥15ч: 15%",color:"bg-blue-200 text-blue-900"},{icon:s.jsx(na,{className:"w-5 h-5"}),label:"Заработок",value:`${r.breakdown.weeklyEarnings.toFixed(2)} ₽`,points:r.breakdown.weeklyEarningsPoints,maxPoints:30,explanation:"6000+ ₽ в неделю = 30% к рейтингу. 3000-5999 ₽ = 15%. Менее 3000 ₽ = 0%. Основной показатель эффективности.",threshold:"≥6000₽: 30% | ≥3000₽: 15%",color:"bg-emerald-200 text-emerald-900"},{icon:s.jsx(Cs,{className:"w-5 h-5"}),label:"Рефералы",value:`${r.breakdown.referrals} чел.`,points:r.breakdown.referralsPoints,maxPoints:30,explanation:"5% к рейтингу за каждого реферала. Максимум 30% (6 рефералов). Учитываются за последние 30 дней. Показывает активность по привлечению новых участников.",threshold:"5% за каждого (макс 30%)",color:"bg-pink-200 text-pink-900"},{icon:s.jsx(Qr,{className:"w-5 h-5"}),label:"Сообщения",value:`${r.breakdown.weeklyMessages} сообщений`,points:r.breakdown.weeklyMessagesPoints,maxPoints:15,explanation:"Более 50 сообщений в неделю в группе = 15% к рейтингу. Менее 50 = 0%. Учитываются все типы сообщений (текст, фото, стикеры и т.д.). Показывает активность в общении.",threshold:">50 сообщений",color:"bg-indigo-200 text-indigo-900"}]:[],M=L.reduce((T,O)=>T+O.points,0);return s.jsxs("div",{className:`rounded-2xl p-6 ${d} shadow-sm border ${h} transition-colors`,children:[s.jsxs("div",{className:"mb-5 flex flex-col gap-3",children:[s.jsxs("div",{className:"flex items-start justify-between gap-3",children:[s.jsxs("div",{className:"min-w-0",children:[s.jsx("p",{className:`text-[11px] uppercase tracking-[0.12em] ${c}`,children:"Участник"}),s.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[s.jsxs("h3",{className:`text-2xl font-bold ${l} truncate`,children:["@",(a==null?void 0:a.login)||"unknown"]}),(a==null?void 0:a.name)&&s.jsx("span",{className:`text-xs ${c}`,children:a.name})]}),s.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[s.jsxs("span",{className:`px-2.5 py-1 rounded-lg text-xs font-semibold border ${S.border} ${S.bg} ${S.text} flex items-center gap-1`,children:[s.jsx("span",{className:`text-lg leading-none ${S.icon}`,children:"●"}),s.jsx("span",{children:"Ник"})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsxs("span",{className:"text-lg font-bold",style:{color:i},children:[r.rating.toFixed(1),"%"]}),s.jsx("span",{className:"text-xl",children:k(r.rating)})]})]})]}),s.jsxs("div",{className:`px-3 py-2 rounded-lg text-xs font-semibold ${x} border ${h}`,children:["Последнее обновление",s.jsx("br",{}),s.jsx("span",{className:`${c}`,children:E?E.toLocaleDateString("ru-RU"):"—"})]})]}),s.jsxs("div",{children:[s.jsx("div",{className:"w-full bg-gray-200/70 dark:bg-gray-800 rounded-full h-6 overflow-hidden shadow-inner",children:s.jsx("div",{className:"h-full transition-all duration-500 flex items-center justify-center text-sm font-semibold text-white",style:{width:p,backgroundColor:i,minWidth:r.rating<=0?"40px":void 0},children:r.rating>=8&&s.jsxs("span",{children:[r.rating.toFixed(0),"%"]})})}),s.jsxs("div",{className:"flex justify-between mt-1",children:[s.jsx("span",{className:`text-xs ${c}`,children:"Общий рейтинг"}),s.jsxs("span",{className:`text-xs font-semibold ${c}`,children:[M,"/100 баллов"]})]})]})]}),r.breakdown&&s.jsxs("div",{className:"space-y-3 mb-6",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[s.jsx(Pr,{className:`w-5 h-5 ${c}`}),s.jsx("h4",{className:`text-lg font-semibold ${l}`,children:"Детальный разбор рейтинга"})]}),L.map((T,O)=>{const ne=T.maxPoints>0?T.points/T.maxPoints*100:0,ie=t===O;return s.jsxs("div",{className:`rounded-lg border ${h} overflow-hidden transition-all ${ie?"shadow-md":""}`,children:[s.jsx("button",{onClick:()=>n(ie?null:O),className:`w-full p-4 flex items-center justify-between ${g} transition-colors`,children:s.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[s.jsx("div",{className:`p-2 rounded-lg ${T.color} flex-shrink-0`,children:T.icon}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsxs("div",{className:"flex items-center justify-between mb-1",children:[s.jsx("span",{className:`font-semibold ${l} truncate`,children:T.label}),s.jsxs("span",{className:`font-bold ml-2 ${T.points>0?"text-[#4E6E49]":"text-red-500"}`,children:[T.points,"/",T.maxPoints]})]}),s.jsx("div",{className:"w-full bg-gray-200 dark:bg-gray-800 rounded-full h-2 overflow-hidden",children:s.jsx("div",{className:`h-full transition-all duration-300 ${T.color}`,style:{width:`${ne}%`}})}),s.jsxs("div",{className:"flex items-center justify-between mt-1",children:[s.jsx("span",{className:`text-xs ${c} truncate mr-2`,children:T.value}),s.jsx("span",{className:`text-xs ${c} whitespace-nowrap`,children:T.threshold})]})]}),s.jsx(rr,{className:`w-4 h-4 flex-shrink-0 ml-2 ${c} transition-transform ${ie?"rotate-180":""}`})]})}),ie&&s.jsx("div",{className:`px-4 pb-4 pt-2 border-t ${h} ${x}`,children:s.jsx("p",{className:`text-sm ${c} leading-relaxed`,children:T.explanation})})]},O)})]}),s.jsxs("div",{className:`pt-4 border-t ${h}`,children:[s.jsx("h4",{className:`text-sm font-semibold mb-3 ${l}`,children:"Дополнительная статистика"}),s.jsxs("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[s.jsxs("div",{className:`p-3 rounded-lg ${x}`,children:[s.jsx("div",{className:`text-xs ${c} mb-1`,children:"Заработок (месяц)"}),s.jsxs("div",{className:`text-lg font-bold ${l}`,children:[r.earnings.toFixed(0)," ₽"]})]}),s.jsxs("div",{className:`p-3 rounded-lg ${x}`,children:[s.jsx("div",{className:`text-xs ${c} mb-1`,children:"В пул"}),s.jsxs("div",{className:`text-lg font-bold ${l}`,children:[r.poolAmount.toFixed(0)," ₽"]})]})]})]})]})},Ro=()=>`REF-${Math.random().toString(36).slice(2,8).toUpperCase()}`,Fk=({referral:r,onClose:e,onSave:t})=>{const{user:n}=Dt(),{theme:a}=ct(),[i,l]=A.useState(""),[c,d]=A.useState(""),[h,g]=A.useState(""),[x,p]=A.useState(Ro()),[E,j]=A.useState(""),[S,k]=A.useState(!1),[L,M]=A.useState(!1);A.useEffect(()=>{r?(l(r.name),d(String(r.age)),p(r.referralId),g(r.comment||"")):(l(""),d(""),g(""),p(Ro()))},[r]);const T=!!r,O=T?"Редактировать реферала":"Добавить реферала",ne=a==="dark"?"bg-gray-700 hover:bg-gray-600 text-white":"bg-gray-200 hover:bg-gray-300 text-gray-900",ie=a==="dark"?"text-gray-300":"text-gray-700",I=a==="dark"?"text-white":"text-gray-900",N=async()=>{if(!r){if(!n){j("Пользователь не найден. Для добавления реферала необходимо войти как участник.");return}}if(!i.trim()||!c.trim()){j("Заполните имя и возраст");return}const f=Number(c);if(Number.isNaN(f)||f<16){j("Возраст должен быть числом не меньше 16");return}k(!0),j("");const w={referralId:x,ownerId:(r==null?void 0:r.ownerId)||n.id,name:i.trim(),age:f,createdAt:(r==null?void 0:r.createdAt)||new Date().toISOString(),...h.trim()&&{comment:h.trim()}};try{r?await i2(r.id,w):await a2(w),t()}catch(_){console.error("Error saving referral:",_);const y=_.message||_.code||"Не удалось сохранить реферала";j(y)}finally{k(!1)}},b=async()=>{if(r&&confirm(`Удалить реферала ${r.name}?`)){M(!0);try{await o2(r.id),t()}catch(f){console.error("Error deleting referral:",f);const w=f.message||f.code||"Не удалось удалить реферала";j(w)}finally{M(!1)}}};return s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-start sm:items-center justify-center z-[70] p-4 sm:py-0 overflow-y-auto overflow-x-hidden overscroll-contain modal-scroll",children:s.jsxs("div",{className:`w-full max-w-md rounded-lg shadow-xl ${a==="dark"?"bg-[#1a1a1a]":"bg-white"} max-h-[90vh] flex flex-col overflow-hidden`,children:[s.jsx("div",{className:"flex-shrink-0 p-6 pb-4",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("h3",{className:`text-xl font-bold ${I}`,children:O}),s.jsx("button",{onClick:e,className:`p-2 rounded-lg flex-shrink-0 ${ne}`,"aria-label":"Закрыть",children:s.jsx(Qt,{className:"w-5 h-5"})})]})}),s.jsx("div",{className:"flex-1 min-h-0 overflow-y-auto overflow-x-hidden overscroll-contain modal-scroll px-6 pb-6",children:s.jsxs("div",{className:"space-y-4 min-w-0",children:[s.jsxs("div",{children:[s.jsx("label",{className:`block text-sm font-medium mb-2 ${ie}`,children:"Имя"}),s.jsx("input",{type:"text",value:i,onChange:f=>l(f.target.value),className:`w-full px-4 py-2 rounded-lg border ${a==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`,placeholder:"Введите имя"})]}),s.jsxs("div",{children:[s.jsx("label",{className:`block text-sm font-medium mb-2 ${ie}`,children:"Возраст"}),s.jsx("input",{type:"number",value:c,onChange:f=>d(f.target.value),className:`w-full px-4 py-2 rounded-lg border ${a==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`,placeholder:"18",min:16})]}),s.jsxs("div",{children:[s.jsx("label",{className:`block text-sm font-medium mb-2 ${ie}`,children:"Комментарий"}),s.jsx("textarea",{value:h,onChange:f=>g(f.target.value),rows:3,className:`w-full px-4 py-2 rounded-lg border ${a==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`,placeholder:"Например, источник лида или статус"})]}),s.jsxs("div",{children:[s.jsx("label",{className:`block text-sm font-medium mb-2 ${ie}`,children:"ID реферала"}),s.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[s.jsx("input",{type:"text",value:x,readOnly:T,onChange:f=>p(f.target.value),className:`flex-1 px-4 py-2 rounded-lg border ${a==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49] ${T?"opacity-80 cursor-not-allowed":""}`}),!T&&s.jsxs("button",{type:"button",onClick:()=>p(Ro()),className:"px-3 py-2 bg-[#4E6E49] hover:bg-[#4E6E49] text-white rounded-lg transition-colors flex items-center justify-center gap-1 text-sm",children:[s.jsx(Cp,{className:"w-4 h-4"}),"Новый"]})]}),s.jsx("p",{className:`text-xs mt-1 ${a==="dark"?"text-gray-400":"text-gray-500"}`,children:"ID генерируется автоматически и используется для учета."})]}),E&&s.jsx("div",{className:"p-3 bg-red-500 text-white rounded-lg text-sm",children:E}),s.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[T&&s.jsxs("button",{onClick:b,disabled:L,className:"flex-1 px-4 py-2 bg-red-500 hover:bg-red-600 disabled:bg-red-300 text-white rounded-lg transition-colors flex items-center justify-center gap-2",children:[s.jsx(At,{className:"w-4 h-4"}),L?"Удаление...":"Удалить"]}),s.jsx("button",{onClick:N,disabled:S,className:"flex-1 px-4 py-2 bg-[#4E6E49] hover:bg-[#4E6E49] disabled:bg-gray-400 disabled:cursor-not-allowed text-white rounded-lg transition-colors",children:S?"Сохранение...":"Сохранить"}),s.jsx("button",{onClick:e,className:`px-4 py-2 rounded-lg transition-colors ${ne}`,children:"Отмена"})]})]})})]})})},Uk=()=>{var b;const{theme:r}=ct(),[e,t]=A.useState([]),[n,a]=A.useState(!0),[i,l]=A.useState([]),[c,d]=A.useState(!1),[h,g]=A.useState(null);A.useEffect(()=>{x()},[]);const x=async()=>{a(!0);try{const f=wa(),w=xe(f.start,"yyyy-MM-dd"),_=xe(f.end,"yyyy-MM-dd"),y=Fg(30),G=xe(y.start,"yyyy-MM-dd"),V=xe(y.end,"yyyy-MM-dd"),F=y.start.toISOString(),z=y.end.toISOString(),ee=await Tg(void 0,F,z);l(ee);const re=[];for(const oe of Ee){const ye=(await ra(oe.id,w,_)).reduce((je,_e)=>{const Le=_e.participants&&_e.participants.length>0?_e.participants.length:1;return je+_e.amount/Le},0),K=await ra(oe.id,G,V),he=K.reduce((je,_e)=>{const Le=_e.participants&&_e.participants.length>0?_e.participants.length:1;return je+_e.amount/Le},0),Ce=K.reduce((je,_e)=>{const Le=_e.participants&&_e.participants.length>0?_e.participants.length:1;return je+_e.poolAmount/Le},0),Se=(await Rr(oe.id)).filter(je=>{const _e=je.date,Le=je.endDate||je.date;return _e<=V&&Le>=G}),Ne=Se.filter(je=>je.type==="dayoff").reduce((je,_e)=>je+Js(_e.date,_e.endDate,G,V),0),Z=Se.filter(je=>je.type==="sick").reduce((je,_e)=>je+Js(_e.date,_e.endDate,G,V),0),Re=Se.filter(je=>je.type==="vacation").reduce((je,_e)=>je+Js(_e.date,_e.endDate,G,V),0),q=(await Fr(oe.id)).filter(je=>je.date>=w&&je.date<=_).reduce((je,_e)=>je+eo(_e.slots),0),te=await Ig(oe.id,w,_),W=(await jg(oe.id))[0]||{userId:oe.id,earnings:0,messages:0,initiatives:0,signals:0,profitableSignals:0,referrals:0,daysOff:0,sickDays:0,vacationDays:0,poolAmount:0,rating:0,lastUpdated:new Date().toISOString()},ue=ee.filter(je=>je.ownerId===oe.id).length,ze={userId:oe.id,earnings:he,messages:W.messages||0,initiatives:W.initiatives||0,signals:W.signals||0,profitableSignals:W.profitableSignals||0,referrals:ue,daysOff:Ne,sickDays:Z,vacationDays:Re,poolAmount:Ce,lastUpdated:new Date().toISOString()},We=Bg(ze,q,ye,te),Pe=qg(ze,q,ye,te);re.push({...ze,rating:We,breakdown:Pe})}re.sort((oe,ke)=>ke.rating-oe.rating),t(re)}catch(f){console.error("Error loading ratings:",f)}finally{a(!1)}},p=e.reduce((f,w)=>f+w.rating,0)/(e.length||1),E=r==="dark"?"text-gray-400":"text-gray-600",j=r==="dark"?"text-white":"text-gray-900",S=r==="dark"?"bg-[#151c2a]":"bg-white",k=r==="dark"?"border-white/10":"border-gray-200",L=r==="dark"?"bg-white/5":"bg-gray-50",M=[{href:"#rating-team",label:"Команда",icon:"🌿"},{href:"#rating-ref",label:"Рефералы",icon:"🧲"},{href:"#rating-method",label:"Карточки",icon:"📇"}],T=[{label:"80-100%",title:"Эталон",desc:"Стабильный вклад, примеры для команды",tone:"text-emerald-700 dark:text-emerald-100",bg:"bg-emerald-50 dark:bg-emerald-900/40 border-emerald-200/60 dark:border-emerald-700/60"},{label:"60-79%",title:"Уверенно",desc:"Держат темп, есть потенциал роста",tone:"text-blue-700 dark:text-blue-100",bg:"bg-blue-50 dark:bg-blue-900/40 border-blue-200/60 dark:border-blue-700/60"},{label:"40-59%",title:"В пути",desc:"Нужна точечная поддержка и фокус",tone:"text-amber-700 dark:text-amber-100",bg:"bg-amber-50 dark:bg-amber-900/40 border-amber-200/60 dark:border-amber-700/60"},{label:"0-39%",title:"Зона роста",desc:"Запускаем план восстановления",tone:"text-rose-700 dark:text-rose-100",bg:"bg-rose-50 dark:bg-rose-900/40 border-rose-200/60 dark:border-rose-700/60"}],O=A.useMemo(()=>[...e].sort((f,w)=>w.rating-f.rating),[e]),ne=A.useMemo(()=>{var G,V;if(!e.length)return{top:0,median:0,count:0,high:0};const f=[...e].sort((F,z)=>z.rating-F.rating),w=((G=f[0])==null?void 0:G.rating)||0,_=((V=f[Math.floor((f.length-1)/2)])==null?void 0:V.rating)||w,y=f.filter(F=>F.rating>=80).length;return{top:w,median:_,count:f.length,high:y}},[e]),ie=[{label:"Топ-1",value:`${ne.top.toFixed(1)}%`,note:"лидер недели",tone:"emerald"},{label:"Медиана",value:`${ne.median.toFixed(1)}%`,note:"ровный темп",tone:"sky"},{label:"80%+",value:ne.high,note:"устойчивые лидеры",tone:"amber"},{label:"Участников",value:e.length,note:"в рейтинге",tone:"slate"}],I=()=>{g(null),d(!0)},N=f=>{g(f),d(!0)};return s.jsxs(ir,{children:[s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:`rounded-2xl p-6 sm:p-7 ${S} shadow-lg border ${k} space-y-5`,children:[s.jsxs("div",{className:"flex flex-col gap-4 lg:flex-row lg:items-center lg:justify-between",children:[s.jsxs("div",{className:"flex items-start gap-3",children:[s.jsx("div",{className:"p-3 rounded-2xl bg-emerald-100 text-emerald-900 dark:bg-emerald-500/15 dark:text-emerald-50 border border-emerald-200 dark:border-emerald-400/40",children:s.jsx("span",{className:"text-xl",children:"📊"})}),s.jsxs("div",{className:"space-y-2",children:[s.jsxs("div",{children:[s.jsx("p",{className:`text-xs uppercase tracking-[0.12em] ${E}`,children:"Рейтинг"}),s.jsx("h1",{className:`text-2xl sm:text-3xl font-extrabold ${j} leading-tight`,children:"Командный лидерборд"})]}),s.jsx("p",{className:`text-sm ${E}`,children:"Данные за неделю + последние 30 дней, аккуратно по ключевым метрикам."}),s.jsx("div",{className:"flex flex-wrap gap-2",children:["КПД недели","Доход + пул","Рефералы","Сообщения"].map(f=>s.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-semibold border ${k} ${L}`,children:f},f))})]})]}),s.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-3 w-full lg:w-auto",children:ie.map(f=>{const w=f.tone==="emerald"?r==="dark"?"bg-emerald-500/10 border-emerald-400/30 text-emerald-100":"bg-emerald-50 border-emerald-200 text-emerald-900":f.tone==="sky"?r==="dark"?"bg-sky-500/10 border-sky-400/30 text-sky-100":"bg-sky-50 border-sky-200 text-sky-900":f.tone==="amber"?r==="dark"?"bg-amber-500/10 border-amber-400/30 text-amber-100":"bg-amber-50 border-amber-200 text-amber-900":r==="dark"?"bg-white/5 border-white/10 text-white":"bg-gray-50 border-gray-200 text-gray-900";return s.jsxs("div",{className:`rounded-xl border p-4 flex flex-col gap-1 shadow-sm ${w}`,children:[s.jsx("span",{className:`text-[11px] uppercase tracking-wide ${E}`,children:f.label}),s.jsx("span",{className:`text-2xl font-extrabold ${j}`,children:f.value}),s.jsx("span",{className:`text-xs ${E}`,children:f.note})]},f.label)})})]}),s.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-4 gap-3",children:T.map(f=>s.jsxs("div",{className:`rounded-xl border ${f.bg} p-3 transition`,children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("span",{className:`text-xs font-semibold ${E}`,children:f.label}),s.jsx("span",{className:"text-lg",children:"•"})]}),s.jsx("p",{className:`text-base font-semibold ${f.tone}`,children:f.title}),s.jsx("p",{className:`text-sm ${E}`,children:f.desc})]},f.label))}),s.jsxs("div",{className:"flex flex-col gap-3 lg:flex-row lg:items-center lg:justify-between",children:[s.jsx("div",{className:"flex flex-wrap gap-2",children:M.map(f=>s.jsxs("a",{href:f.href,className:`px-3 py-2 rounded-full text-sm font-semibold border ${k} transition flex items-center gap-2 ${r==="dark"?"bg-white/5 hover:bg-white/10 text-white":"bg-white hover:bg-gray-50 text-gray-800"}`,children:[s.jsx("span",{children:f.icon}),f.label]},f.href))}),s.jsx("div",{className:"flex flex-wrap gap-2 text-xs",children:["Выходные","Больничные","Отпуск","Часы","Заработок","Рефералы","Сообщения"].map(f=>s.jsx("span",{className:`px-3 py-1 rounded-full border ${k} ${L}`,children:f},f))}),s.jsxs("button",{onClick:I,className:"px-4 py-3 bg-emerald-600 hover:bg-emerald-700 text-white rounded-xl transition-all duration-200 flex items-center justify-center gap-2 font-semibold shadow-md w-full lg:w-auto",children:[s.jsx("span",{className:"text-xl",children:"➕"}),s.jsx("span",{children:"Добавить реферала"})]})]})]}),s.jsxs("div",{id:"rating-team",className:`rounded-2xl p-6 sm:p-7 ${S} shadow-lg border ${k}`,children:[s.jsxs("div",{className:"flex flex-col gap-6 md:flex-row md:items-center md:justify-between",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsx("p",{className:`text-xs uppercase tracking-[0.12em] ${E}`,children:"Команда"}),s.jsx("h3",{className:`text-2xl font-bold ${j}`,children:"Средний КПД за неделю"}),s.jsx("p",{className:`text-sm ${E}`,children:"Плавный прогресс-бар показывает динамику всей команды."})]}),s.jsxs("div",{className:"text-right",children:[s.jsxs("div",{className:"text-5xl font-extrabold text-emerald-600 dark:text-emerald-300",children:[p.toFixed(1),"%"]}),s.jsx("p",{className:`text-xs ${E}`,children:"из 100%"})]})]}),s.jsx("div",{className:"mt-6",children:s.jsx("div",{className:"w-full bg-gray-200 dark:bg-gray-800 rounded-full h-10 overflow-hidden border border-gray-200 dark:border-gray-700 shadow-inner",children:s.jsx("div",{className:`h-full transition-all duration-500 flex items-center px-3 text-sm font-semibold text-white ${p>=80?"bg-emerald-600":p>=50?"bg-amber-500":"bg-blue-500"}`,style:{width:`${Math.min(p,100)}%`},children:p>=5&&s.jsxs("span",{children:[p.toFixed(1),"%"]})})})})]}),s.jsxs("div",{id:"rating-ref",className:`rounded-2xl p-6 sm:p-7 ${S} shadow-lg border ${k}`,children:[s.jsx("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between mb-4",children:s.jsxs("div",{className:"space-y-1",children:[s.jsx("p",{className:`text-xs uppercase tracking-[0.12em] ${E}`,children:"Рефералы · 30 дней"}),s.jsx("h3",{className:`text-2xl font-bold ${j}`,children:"Привлеченные участники"}),s.jsxs("p",{className:`text-sm ${E}`,children:["Всего добавлено: ",s.jsx("span",{className:"font-semibold",children:i.length})]})]})}),s.jsx("div",{className:"grid gap-3 md:grid-cols-2",children:Ee.map(f=>{const w=i.filter(_=>_.ownerId===f.id);return s.jsxs("div",{className:`p-4 rounded-xl border ${k} ${r==="dark"?"bg-white/5":"bg-gray-50"}`,children:[s.jsxs("div",{className:"flex items-center justify-between mb-3",children:[s.jsx("span",{className:`${j} font-semibold`,children:f.name}),s.jsxs("span",{className:`px-3 py-1 rounded-full text-sm font-bold ${w.length>0?r==="dark"?"bg-emerald-600/70 text-white":"bg-emerald-100 text-emerald-800":r==="dark"?"bg-white/5 text-gray-400":"bg-gray-100 text-gray-600"}`,children:[w.length," ",w.length===1?"реферал":w.length<5?"реферала":"рефералов"]})]}),w.length>0&&s.jsx("div",{className:"space-y-2",children:w.map(_=>s.jsxs("div",{className:`rounded-lg border ${k} ${r==="dark"?"bg-[#0f0f0f]":"bg-white"} p-3 flex flex-col gap-2 transition-all hover:shadow-sm`,children:[s.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2",children:[s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsx("p",{className:`text-sm font-semibold ${j} truncate`,children:_.name}),s.jsxs("div",{className:"flex flex-wrap gap-2 text-xs",children:[s.jsxs("span",{className:`px-2 py-1 rounded ${r==="dark"?"bg-white/5":"bg-gray-100"} ${E}`,children:["ID: ",_.referralId]}),_.age&&s.jsxs("span",{className:`px-2 py-1 rounded ${r==="dark"?"bg-white/5":"bg-gray-100"} ${E}`,children:[_.age," лет"]}),s.jsx("span",{className:`px-2 py-1 rounded ${r==="dark"?"bg-white/5":"bg-gray-100"} ${E}`,children:new Date(_.createdAt).toLocaleDateString("ru-RU")})]})]}),s.jsx("button",{onClick:()=>N(_),className:"self-start sm:self-auto px-3 py-1.5 text-sm bg-emerald-600 hover:bg-emerald-700 text-white rounded-lg transition-colors font-semibold",children:"Редактировать"})]}),_.comment&&s.jsx("div",{className:`mt-1 pt-2 border-t ${k}`,children:s.jsxs("p",{className:`text-xs ${E} italic`,children:["💬 ",_.comment]})})]},_.id))})]},f.id)})})]}),s.jsxs("div",{id:"rating-method",className:`rounded-2xl p-6 sm:p-7 ${S} shadow-lg border ${k}`,children:[s.jsx("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between mb-4",children:s.jsxs("div",{className:"space-y-1",children:[s.jsx("p",{className:`text-xs uppercase tracking-[0.12em] ${E}`,children:"Карточки участников"}),s.jsx("h3",{className:`text-2xl font-bold ${j}`,children:"Детальная статистика"})]})}),n?s.jsxs("div",{className:`rounded-xl p-12 text-center ${r==="dark"?"bg-white/5":"bg-gray-50"} border ${k}`,children:[s.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-4 border-emerald-500 border-t-transparent mx-auto mb-4"}),s.jsx("p",{className:`text-lg font-semibold ${j}`,children:"Загрузка рейтинга..."}),s.jsx("p",{className:`text-sm ${E} mt-2`,children:"Подождите, собираем статистику"})]}):s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3 mb-6",children:[{label:"Топ-1",value:(b=O[0])!=null&&b.rating?`${O[0].rating.toFixed(1)}%`:"—"},{label:"Средний рейтинг",value:`${p.toFixed(1)}%`},{label:"Медиана",value:`${ne.median.toFixed(1)}%`},{label:"Участников",value:O.length}].map(f=>s.jsxs("div",{className:`rounded-xl border ${k} ${r==="dark"?"bg-white/5":"bg-gray-50"} px-4 py-3`,children:[s.jsx("p",{className:`text-[11px] uppercase tracking-wide ${E}`,children:f.label}),s.jsx("p",{className:`text-2xl font-extrabold ${j}`,children:f.value})]},f.label))}),s.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-2 2xl:grid-cols-2 gap-6",children:O.map((f,w)=>{const _=w===0?{text:"1 место",tone:"emerald",emoji:"🥇"}:w===1?{text:"2 место",tone:"blue",emoji:"🥈"}:w===2?{text:"3 место",tone:"amber",emoji:"🥉"}:{text:`${w+1} место`,tone:"slate",emoji:"🎯"},G={emerald:r==="dark"?{chip:"bg-emerald-500/15 text-emerald-50 border-emerald-400/40",circle:"bg-emerald-500/25 text-emerald-50 border-emerald-400/40"}:{chip:"bg-emerald-50 text-emerald-900 border-emerald-200",circle:"bg-emerald-100 text-emerald-800 border-emerald-200"},blue:r==="dark"?{chip:"bg-blue-500/15 text-blue-50 border-blue-400/40",circle:"bg-blue-500/25 text-blue-50 border-blue-400/40"}:{chip:"bg-blue-50 text-blue-900 border-blue-200",circle:"bg-blue-100 text-blue-800 border-blue-200"},amber:r==="dark"?{chip:"bg-amber-500/15 text-amber-50 border-amber-400/40",circle:"bg-amber-500/25 text-amber-50 border-amber-400/40"}:{chip:"bg-amber-50 text-amber-900 border-amber-200",circle:"bg-amber-100 text-amber-800 border-amber-200"},slate:r==="dark"?{chip:"bg-white/5 text-white border-white/10",circle:"bg-white/10 text-white border-white/15"}:{chip:"bg-gray-50 text-gray-800 border-gray-200",circle:"bg-gray-100 text-gray-800 border-gray-200"}}[_.tone];return s.jsxs("div",{className:"relative pt-7",children:[s.jsxs("div",{className:"absolute -top-3 left-4 flex items-center gap-2",children:[s.jsx("div",{className:`w-10 h-10 rounded-full border text-sm font-bold grid place-items-center shadow-sm ${G.circle}`,children:w+1}),s.jsxs("div",{className:`px-3 py-1 rounded-xl text-xs font-semibold border shadow-sm flex items-center gap-1 ${G.chip}`,children:[s.jsx("span",{children:_.emoji}),s.jsx("span",{children:_.text})]})]}),s.jsx(Lk,{rating:f})]},f.userId)})})]})]})]}),c&&s.jsx(Fk,{referral:h,onClose:()=>{d(!1),g(null)},onSave:()=>{d(!1),g(null),x()}})]})},to={trading:op,learning:ii,technical:cp,stream:oh,research:pp,organization:lp},Bk=({onClose:r,onSave:e,editingTask:t})=>{var De;const{user:n}=Dt(),{isAdmin:a}=Bt(),{theme:i}=ct(),l=!!t,c=i==="dark"?"text-white":"text-gray-900",d=i==="dark"?"bg-[#1a1a1a]":"bg-white",h=i==="dark"?"bg-gray-700":"bg-gray-50",g=i==="dark"?"border-gray-800":"border-gray-300",[x,p]=A.useState((t==null?void 0:t.title)||""),[E,j]=A.useState((t==null?void 0:t.description)||""),[S,k]=A.useState((t==null?void 0:t.category)||"trading"),[L,M]=A.useState((t==null?void 0:t.priority)||"medium"),[T,O]=A.useState((t==null?void 0:t.expectedResult)||""),[ne,ie]=A.useState((t==null?void 0:t.requiresApproval)??!0),[I,N]=A.useState((t==null?void 0:t.dueDate)||xe(new Date,"yyyy-MM-dd")),[b,f]=A.useState((t==null?void 0:t.dueTime)||"12:00"),[w,_]=A.useState((t==null?void 0:t.startTime)||"09:00"),[y,G]=A.useState((t==null?void 0:t.mainExecutor)||""),[V,F]=A.useState((t==null?void 0:t.leadExecutor)||""),[z,ee]=A.useState((t==null?void 0:t.deputies)||[]),[re,oe]=A.useState((t==null?void 0:t.coExecutors)||(t==null?void 0:t.executors)||[]),[ke]=A.useState((t==null?void 0:t.executors)||[]),[ye,K]=A.useState((t==null?void 0:t.curators)||[]),[he]=A.useState((t==null?void 0:t.leads)||[]),Ce={id:"stage-1",name:"Этап 1",responsible:"all",assignees:[],stagePriority:"medium",requiresApproval:ne,approvals:(t==null?void 0:t.approvals)||[],status:"pending"},H=$=>{const we=$.assignees&&$.assignees.length>0||$.responsible==="all"?$.assignees||[]:Array.isArray($.responsible)?$.responsible.map(me=>({userId:me,priority:"medium"})):[];return{...$,assignees:we,stagePriority:$.stagePriority||"medium",requiresApproval:$.requiresApproval??!0}},[Se,Ne]=A.useState(t!=null&&t.stages&&t.stages.length>0?t.stages.map(H):[H(Ce)]),[Z,Re]=A.useState((t==null?void 0:t.currentStageId)||((De=Se[0])==null?void 0:De.id)||"stage-1"),J=t&&t.assignees&&t.assignees.length>0?t.assignees:t?t.assignedTo.map($=>({userId:$,priority:"medium"})):[],[se,q]=A.useState(J),[te,ge]=A.useState(""),[W,ue]=A.useState(!1);xn();const ze=[{value:"urgent",label:"Экстренный",desc:"Нужно прямо сейчас, максимальный приоритет",tone:i==="dark"?"bg-rose-600/20 border-rose-500/50 text-rose-100":"bg-rose-50 border-rose-200 text-rose-700"},{value:"high",label:"Высокий",desc:"Нужен приоритет и быстрый старт",tone:i==="dark"?"bg-red-500/15 border-red-500/40 text-red-100":"bg-red-50 border-red-200 text-red-700"},{value:"medium",label:"Средний",desc:"Стандартный приоритет, плановый слот",tone:i==="dark"?"bg-amber-500/15 border-amber-500/40 text-amber-100":"bg-amber-50 border-amber-200 text-amber-700"},{value:"low",label:"Низкий",desc:"Можно параллельно с другими задачами",tone:i==="dark"?"bg-gray-500/15 border-gray-500/40 text-gray-100":"bg-gray-50 border-gray-200 text-gray-700"}],We=$=>{se.find(le=>le.userId===$)?q(le=>le.filter(we=>we.userId!==$)):q(le=>[...le,{userId:$,priority:"medium"}])},Pe=()=>{se.length===Ee.length?q([]):q(Ee.map($=>({userId:$.id,priority:"medium"})))},je=($,le)=>{q(we=>we.map(me=>me.userId===$?{...me,priority:le}:me))},_e=($,le)=>{q(we=>we.map(me=>me.userId===$?{...me,comment:le}:me))},Le=($,le,we)=>{le.includes($)?we(le.filter(me=>me!==$)):we([...le,$])},nt=$=>{re.includes($)?oe(re.filter(le=>le!==$)):re.length<30&&oe([...re,$])},et=($,le)=>{Ne(we=>we.map(me=>me.id===$?{...me,...le}:me))},U=($,le)=>{Ne(we=>we.map(me=>{if(me.id!==$)return me;const Me=me.assignees||[];return Me.find(Ye=>Ye.userId===le)?{...me,assignees:Me.filter(Ye=>Ye.userId!==le)}:Me.length>=10?me:{...me,assignees:[...Me,{userId:le,priority:"medium"}],responsible:Array.isArray(me.responsible)?[...me.responsible,le]:Me.map(Ye=>Ye.userId).concat(le)}}))},D=($,le,we,me)=>{Ne(Me=>Me.map(Oe=>{if(Oe.id!==$)return Oe;const Ye=(Oe.assignees||[]).map(R=>R.userId===le?{...R,[we]:me}:R);return{...Oe,assignees:Ye}}))},P=($,le)=>{Ne(we=>we.map(me=>me.id===$?{...me,stagePriority:le}:me))},Y=()=>{const $={id:`stage-${Date.now()}`,name:`Этап ${Se.length+1}`,responsible:"all",assignees:[],stagePriority:"medium",requiresApproval:ne,approvals:[],status:"pending"};Ne(le=>[...le,$]),Z||Re($.id)},pe=$=>{var we;if(Se.length===1)return;const le=Se.filter(me=>me.id!==$);Ne(le),Z===$&&Re(((we=le[0])==null?void 0:we.id)||"")},C=async()=>{if(!a&&!n){ge("Пользователь не найден");return}ge(""),ue(!0);try{if(!x.trim()){ge("Введите название задачи"),ue(!1);return}if(se.length===0&&!y){ge("Выберите хотя бы одного участника"),ue(!1);return}if(!I){ge("Укажите дату дедлайна"),ue(!1);return}if(!w){ge("Укажите время начала"),ue(!1);return}if(!b){ge("Укажите время дедлайна"),ue(!1);return}if(!y){ge("Выберите главного исполнителя"),ue(!1);return}if(re.length>30){ge("Соисполнителей может быть не более 30"),ue(!1);return}const $=new Date().toISOString(),le=(n==null?void 0:n.id)||"admin",we=Array.from(new Set([...se.map(R=>R.userId),...y?[y]:[],...V?[V]:[],...z.map(R=>R.userId),...re,...ke,...ye,...he])),me=R=>{const X=R.requiresApproval??ne,be=(R.assignees||[]).slice(0,10),Ve=be.length>0?be.map(Ie=>Ie.userId):R.responsible==="all"?we:R.responsible||[],He=X===!1?Ve.map(Ie=>({userId:Ie,status:"approved",updatedAt:$,forAll:!0})):Ve.map(Ie=>{var Ge;return((Ge=R.approvals)==null?void 0:Ge.find(Xe=>Xe.userId===Ie))||{userId:Ie,status:"pending",updatedAt:$}});return{...R,assignees:be,responsible:R.responsible==="all"?"all":Ve,stagePriority:R.stagePriority||"medium",requiresApproval:X,approvals:He,status:X===!1?"approved":R.status||"pending"}},Me=Se.map(me),Oe=Me[0],Ye=Z||(Oe==null?void 0:Oe.id)||"stage-1";if(l&&t){const R={title:x.trim(),description:E.trim()||void 0,category:S,priority:L,assignedTo:we,assignees:se,approvals:Oe?Oe.approvals:[],stages:Me,currentStageId:Ye,mainExecutor:y||void 0,leadExecutor:V||void 0,coExecutors:re,deputies:z,executors:ke,curators:ye,leads:he,dueDate:I,dueTime:b,startTime:w,expectedResult:T.trim()||void 0,requiresApproval:ne,updatedAt:$};!ne&&t.status==="pending"&&(R.status="in_progress"),await dr(t.id,R)}else{const R={title:x.trim(),description:E.trim()||void 0,category:S,status:ne?"pending":"in_progress",createdBy:le,assignedTo:we,assignees:se,approvals:Oe?Oe.approvals:[],stages:Me,currentStageId:Ye,mainExecutor:y||void 0,leadExecutor:V||void 0,coExecutors:re,deputies:z,executors:ke,curators:ye,leads:he,createdAt:$,updatedAt:$,priority:L,dueDate:I,dueTime:b,startTime:w,expectedResult:T.trim()||void 0,requiresApproval:ne};await u2(R)}e()}catch($){console.error("Error saving task:",$),ge("Ошибка при сохранении задачи"),ue(!1)}};return s.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-start sm:items-center justify-center z-[70] p-4 overflow-y-auto overscroll-contain modal-scroll touch-pan-y",children:s.jsx("div",{className:`${d} rounded-xl sm:rounded-2xl shadow-2xl w-full max-w-2xl max-h-[calc(100vh-48px)] sm:max-h-[calc(100vh-64px)] overflow-y-auto border-2 touch-pan-y ${i==="dark"?"border-[#4E6E49]/30 bg-gradient-to-br from-[#1a1a1a] via-[#1a1a1a] to-[#0A0A0A]":"border-green-200 bg-gradient-to-br from-white via-green-50/30 to-white"} relative`,children:s.jsxs("div",{className:"flex flex-col h-full min-h-0",children:[s.jsxs("div",{className:`sticky top-0 ${d} border-b ${g} p-4 sm:p-6 flex items-center justify-between z-10`,children:[s.jsxs("h2",{className:`text-xl sm:text-2xl font-bold ${c} flex items-center gap-2`,children:[s.jsx(fl,{className:"w-5 h-5 sm:w-6 sm:h-6"}),l?"Редактировать задачу":"Новая задача"]}),s.jsx("button",{onClick:r,className:`p-2 rounded-lg transition-colors ${i==="dark"?"hover:bg-gray-700":"hover:bg-gray-100"}`,children:s.jsx(Qt,{className:"w-5 h-5"})})]}),s.jsxs("div",{className:"p-4 sm:p-6 space-y-4 sm:space-y-6 flex-1 min-h-0 overflow-y-auto overscroll-contain modal-scroll touch-pan-y pb-10",children:[te&&s.jsxs("div",{className:"p-3 rounded-lg bg-red-500/10 border border-red-500/30 flex items-center gap-2 text-red-500",children:[s.jsx(ml,{className:"w-5 h-5 flex-shrink-0"}),s.jsx("span",{className:"text-sm",children:te})]}),s.jsxs("div",{children:[s.jsx("label",{className:`block text-sm font-medium mb-2 ${c}`,children:"Название задачи *"}),s.jsx("input",{type:"text",value:x,onChange:$=>p($.target.value),className:`w-full px-4 py-2.5 rounded-lg border ${g} ${h} ${c} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]/50 transition-all`,placeholder:"Введите название задачи"})]}),se.length>0&&s.jsxs("div",{className:"space-y-3",children:[s.jsx("label",{className:`block text-sm font-medium ${c}`,children:"Приоритеты и комментарии"}),s.jsx("div",{className:"space-y-3",children:se.map($=>{const le=Ee.find(we=>we.id===$.userId);return s.jsxs("div",{className:`p-3 rounded-lg border ${g} ${h} space-y-2`,children:[s.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2",children:[s.jsxs("div",{className:"text-sm font-medium",children:[(le==null?void 0:le.name)||"Участник"," ",s.jsxs("span",{className:"text-xs text-gray-500",children:["(",(le==null?void 0:le.login)||(le==null?void 0:le.id)||"—",")"]})]}),s.jsxs("select",{value:$.priority,onChange:we=>je($.userId,we.target.value),className:`px-3 py-1.5 rounded-lg border ${g} ${i==="dark"?"bg-[#1a1a1a] text-gray-100":"bg-white text-gray-700"}`,children:[s.jsx("option",{value:"low",children:"Низкий приоритет"}),s.jsx("option",{value:"medium",children:"Средний приоритет"}),s.jsx("option",{value:"high",children:"Высокий приоритет"})]})]}),s.jsx("textarea",{value:$.comment||"",onChange:we=>_e($.userId,we.target.value),rows:2,className:`w-full px-3 py-2 rounded-lg border ${g} ${i==="dark"?"bg-[#1a1a1a] text-gray-100":"bg-white text-gray-700"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]/50`,placeholder:"Комментарий для исполнителя (необязательно)"})]},$.userId)})})]}),s.jsxs("div",{children:[s.jsx("label",{className:`block text-sm font-medium mb-2 ${c}`,children:"Описание"}),s.jsx("textarea",{value:E,onChange:$=>j($.target.value),rows:4,className:`w-full px-4 py-2.5 rounded-lg border ${g} ${h} ${c} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]/50 transition-all resize-none`,placeholder:"Добавьте описание задачи (необязательно)"})]}),s.jsxs("div",{children:[s.jsxs("label",{className:`block text-sm font-medium mb-2 ${c} flex items-center gap-2`,children:[s.jsx(Yr,{className:"w-4 h-4"}),"Какой должен быть результат"]}),s.jsx("textarea",{value:T,onChange:$=>O($.target.value),rows:3,className:`w-full px-4 py-2.5 rounded-lg border ${g} ${h} ${c} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]/50 transition-all resize-none`,placeholder:"Опишите ожидаемый итог задачи"})]}),s.jsxs("div",{className:"grid grid-cols-1 gap-4 sm:gap-6",children:[s.jsxs("div",{className:"space-y-3",children:[s.jsx("div",{className:"flex items-center justify-between",children:s.jsxs("label",{className:`block text-sm font-medium ${c} flex items-center gap-2`,children:[s.jsx(Mp,{className:"w-4 h-4"}),"Категория"]})}),s.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2 sm:gap-3",children:Object.entries(ai).map(([$,{label:le}])=>{const we=to[$],me=S===$;return s.jsx("button",{type:"button",onClick:()=>k($),className:`p-3 rounded-lg border-2 text-sm font-semibold transition-all text-center leading-tight whitespace-normal ${me?i==="dark"?"border-[#4E6E49] bg-[#4E6E49]/15 text-[#4E6E49]":"border-[#4E6E49] bg-green-50 text-[#4E6E49]":i==="dark"?"border-gray-800 bg-gray-900 text-gray-200 hover:border-[#4E6E49]/40":"border-gray-200 bg-white text-gray-800 hover:border-[#4E6E49]/40"} flex flex-col items-center gap-2`,children:s.jsxs("span",{className:"flex items-center gap-2 justify-center",children:[s.jsx(we,{className:"w-4 h-4"}),s.jsx("span",{className:"break-words",children:le})]})},$)})})]}),s.jsxs("div",{className:"space-y-3",children:[s.jsx("div",{className:"flex items-center justify-between",children:s.jsxs("label",{className:`block text-sm font-medium ${c} flex items-center gap-2`,children:[s.jsx(zt,{className:"w-4 h-4"}),"Приоритет"]})}),s.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-2 sm:gap-3",children:ze.map($=>s.jsxs("button",{type:"button",onClick:()=>M($.value),className:`p-3 rounded-lg border-2 text-left transition-all ${$.tone} ${L===$.value?"ring-2 ring-offset-2 ring-[#4E6E49] dark:ring-offset-[#1a1a1a]":""}`,children:[s.jsxs("div",{className:"flex items-center justify-between gap-2",children:[s.jsx("span",{className:"font-semibold text-sm",children:$.label}),L===$.value&&s.jsx("span",{className:"text-xs font-semibold",children:"выбрано"})]}),s.jsx("p",{className:"text-xs mt-1 leading-snug opacity-80",children:$.desc})]},$.value))})]}),s.jsxs("div",{className:"p-3 rounded-lg border-2 flex items-center justify-between gap-3 transition-all bg-white/60 dark:bg-[#1a1a1a]/60",style:{borderColor:i==="dark"?"#2f2f2f":"#e5e7eb"},children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(Pi,{className:"w-4 h-4 text-emerald-500"}),s.jsxs("div",{children:[s.jsx("p",{className:`text-sm font-medium ${c}`,children:"Требуется согласование"}),s.jsx("p",{className:"text-[11px] text-gray-500 dark:text-gray-400",children:"Если выключить — задача сразу уходит в работу"})]})]}),s.jsxs("label",{className:"inline-flex items-center cursor-pointer gap-2",children:[s.jsx("span",{className:`text-xs ${i==="dark"?"text-gray-300":"text-gray-700"}`,children:ne?"Да":"Нет"}),s.jsx("input",{type:"checkbox",checked:ne,onChange:$=>ie($.target.checked),className:"accent-[#4E6E49]"})]})]})]}),s.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[s.jsxs("div",{className:"p-3 rounded-lg border-2 flex flex-col gap-2 transition-all shadow-sm bg-white/60 dark:bg-[#1a1a1a]/60 w-full max-w-[360px] sm:max-w-none",style:{borderColor:i==="dark"?"#2f2f2f":"#e5e7eb"},children:[s.jsxs("label",{className:`text-sm font-medium ${c} flex items-center gap-2`,children:[s.jsx(hl,{className:"w-4 h-4"}),"Время начала *"]}),s.jsx("input",{type:"time",value:w,onChange:$=>_($.target.value),required:!0,className:`w-full px-4 py-2.5 rounded-lg border ${g} ${h} ${c} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]/50 transition-all`}),s.jsx("p",{className:`text-[11px] leading-snug ${i==="dark"?"text-gray-400":"text-gray-500"}`,children:"Помогает планировать последовательность задач и уведомлений."})]}),s.jsxs("div",{className:"p-3 rounded-lg border-2 flex flex-col gap-2 transition-all shadow-sm bg-white/60 dark:bg-[#1a1a1a]/60 w-full max-w-[360px] sm:max-w-none",style:{borderColor:i==="dark"?"#2f2f2f":"#e5e7eb"},children:[s.jsxs("label",{className:`text-sm font-medium ${c} flex items-center gap-2`,children:[s.jsx(br,{className:"w-4 h-4"}),"Дата дедлайна *"]}),s.jsx("input",{type:"date",value:I,onChange:$=>N($.target.value),min:xe(new Date,"yyyy-MM-dd"),required:!0,className:`w-full px-4 py-2.5 rounded-lg border ${g} ${h} ${c} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]/50 transition-all`}),s.jsx("p",{className:`text-[11px] leading-snug ${i==="dark"?"text-gray-400":"text-gray-500"}`,children:"Ограничение по датам учитывает сегодняшнюю дату автоматически."})]}),s.jsxs("div",{className:"p-3 rounded-lg border-2 flex flex-col gap-2 transition-all shadow-sm bg-white/60 dark:bg-[#1a1a1a]/60 w-full max-w-[360px] sm:max-w-none",style:{borderColor:i==="dark"?"#2f2f2f":"#e5e7eb"},children:[s.jsxs("label",{className:`text-sm font-medium ${c} flex items-center gap-2`,children:[s.jsx(en,{className:"w-4 h-4"}),"Время дедлайна *"]}),s.jsx("input",{type:"time",value:b,onChange:$=>f($.target.value),required:!0,className:`w-full px-4 py-2.5 rounded-lg border ${g} ${h} ${c} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]/50 transition-all`}),s.jsx("p",{className:`text-[11px] leading-snug ${i==="dark"?"text-gray-400":"text-gray-500"}`,children:"Добавьте время, чтобы вся команда понимала, когда итог должен быть готов."})]})]}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:`block text-sm font-medium mb-2 ${c}`,children:"Главный исполнитель *"}),s.jsxs("select",{value:y,onChange:$=>G($.target.value),className:`w-full px-4 py-2.5 rounded-lg border ${g} ${h} ${c} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]/50`,children:[s.jsx("option",{value:"",children:"Выберите главного"}),Ee.map($=>s.jsxs("option",{value:$.id,children:[$.name," (",$.login,")"]},$.id))]})]}),s.jsxs("div",{children:[s.jsx("label",{className:`block text-sm font-medium mb-2 ${c}`,children:"Ведущий исполнитель"}),s.jsxs("select",{value:V,onChange:$=>F($.target.value),className:`w-full px-4 py-2.5 rounded-lg border ${g} ${h} ${c} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]/50`,children:[s.jsx("option",{value:"",children:"Выберите ведущего (опционально)"}),Ee.map($=>s.jsxs("option",{value:$.id,children:[$.name," (",$.login,")"]},$.id))]})]}),s.jsxs("div",{className:"space-y-3",children:[s.jsx("div",{className:"flex items-center justify-between",children:s.jsx("label",{className:`block text-sm font-medium ${c}`,children:"Замы (несколько)"})}),s.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-2 sm:gap-3",children:Ee.map($=>{const le=z.some(we=>we.userId===$.id);return s.jsx("button",{type:"button",onClick:()=>{ee(le?we=>we.filter(me=>me.userId!==$.id):we=>[...we,{userId:$.id,responsibility:""}])},className:`p-3 rounded-lg border-2 transition-all text-left ${le?i==="dark"?"border-[#4E6E49] bg-[#4E6E49]/20":"border-[#4E6E49] bg-green-50":`${g} ${h}`}`,children:s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("div",{className:`w-2 h-2 rounded-full ${le?"bg-[#4E6E49]":"bg-gray-400"}`}),s.jsx("span",{className:`text-sm font-medium ${le?"text-[#4E6E49]":c}`,children:$.name})]})},$.id)})})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("label",{className:`text-sm font-medium ${c}`,children:"Соисполнители (до 30)"}),s.jsxs("span",{className:"text-[11px] text-gray-500",children:[re.length,"/30"]})]}),s.jsx("div",{className:"grid grid-cols-2 gap-2",children:Ee.map($=>{const le=re.includes($.id);return s.jsx("button",{type:"button",onClick:()=>nt($.id),className:`p-2 rounded-lg border text-left text-sm transition-all ${le?i==="dark"?"border-[#4E6E49] bg-[#4E6E49]/20":"border-[#4E6E49] bg-green-50":`${g} ${h}`}`,children:s.jsx("span",{className:le?"text-[#4E6E49]":c,children:$.name})},$.id)})})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx("div",{className:"flex items-center justify-between",children:s.jsx("label",{className:`text-sm font-medium ${c}`,children:"Кураторы"})}),s.jsx("div",{className:"grid grid-cols-2 gap-2",children:Ee.map($=>{const le=ye.includes($.id);return s.jsx("button",{type:"button",onClick:()=>Le($.id,ye,K),className:`p-2 rounded-lg border text-left text-sm transition-all ${le?i==="dark"?"border-[#4E6E49] bg-[#4E6E49]/20":"border-[#4E6E49] bg-green-50":`${g} ${h}`}`,children:s.jsx("span",{className:le?"text-[#4E6E49]":c,children:$.name})},$.id)})})]})]})]}),s.jsxs("div",{children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsxs("label",{className:`block text-sm font-medium ${c} flex items-center gap-2`,children:[s.jsx(Cs,{className:"w-4 h-4"}),"Участники *"]}),s.jsx("button",{type:"button",onClick:Pe,className:`text-xs sm:text-sm px-3 py-1 rounded-lg transition-colors ${i==="dark"?"bg-gray-700 hover:bg-gray-600 text-gray-300":"bg-gray-200 hover:bg-gray-300 text-gray-700"}`,children:se.length===Ee.length?"Снять выделение":"Выбрать всех"})]}),s.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-2 sm:gap-3",children:Ee.map($=>{const le=se.some(we=>we.userId===$.id);return s.jsx("button",{type:"button",onClick:()=>We($.id),className:`p-3 rounded-lg border-2 transition-all text-left ${le?i==="dark"?"border-[#4E6E49] bg-[#4E6E49]/20":"border-[#4E6E49] bg-green-50":`${g} ${h}`}`,children:s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("div",{className:`w-2 h-2 rounded-full ${le?"bg-[#4E6E49]":"bg-gray-400"}`}),s.jsx("span",{className:`text-sm font-medium ${le?"text-[#4E6E49]":c}`,children:$.name})]})},$.id)})})]}),s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("label",{className:`block text-sm font-medium ${c}`,children:"Этапы согласования"}),s.jsx("button",{type:"button",onClick:Y,className:`px-3 py-1.5 rounded-lg text-xs font-semibold ${i==="dark"?"bg-gray-700 hover:bg-gray-600 text-gray-200":"bg-gray-200 hover:bg-gray-300 text-gray-800"}`,children:"Добавить этап"})]}),s.jsx("div",{className:"space-y-3",children:Se.map(($,le)=>{var we;return s.jsxs("div",{className:`p-3 rounded-lg border-2 ${g} ${h}`,children:[s.jsxs("div",{className:"flex items-center justify-between gap-2",children:[s.jsx("input",{value:$.name,onChange:me=>et($.id,{name:me.target.value}),className:`flex-1 px-3 py-2 rounded-lg border ${g} ${i==="dark"?"bg-[#1a1a1a] text-gray-100":"bg-white text-gray-700"}`,placeholder:`Этап ${le+1}`}),Se.length>1&&s.jsx("button",{type:"button",onClick:()=>pe($.id),className:`px-2 py-1 text-xs rounded-lg ${i==="dark"?"bg-red-500/20 text-red-300 hover:bg-red-500/30":"bg-red-100 text-red-700 hover:bg-red-200"}`,children:"Удалить"})]}),s.jsx("textarea",{value:$.description||"",onChange:me=>et($.id,{description:me.target.value}),rows:2,className:`mt-2 w-full px-3 py-2 rounded-lg border ${g} ${i==="dark"?"bg-[#1a1a1a] text-gray-100":"bg-white text-gray-700"}`,placeholder:"Описание этапа (опционально)"}),s.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 mt-3",children:[s.jsxs("div",{className:"space-y-1",children:[s.jsxs("label",{className:`text-sm font-medium ${c} flex items-center gap-2`,children:[s.jsx(mp,{className:"w-4 h-4"}),"Приоритет этапа"]}),s.jsxs("select",{value:$.stagePriority||"medium",onChange:me=>P($.id,me.target.value),className:`w-full px-3 py-2 rounded-lg border ${g} ${i==="dark"?"bg-[#1a1a1a] text-gray-100":"bg-white text-gray-700"}`,children:[s.jsx("option",{value:"urgent",children:"Экстренный"}),s.jsx("option",{value:"high",children:"Высокий"}),s.jsx("option",{value:"medium",children:"Средний"}),s.jsx("option",{value:"low",children:"Низкий"})]})]}),s.jsxs("div",{className:"space-y-1",children:[s.jsx("label",{className:`text-sm font-medium ${c}`,children:"Нужно согласование этапа?"}),s.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[s.jsx("input",{type:"checkbox",checked:$.requiresApproval??!0,onChange:me=>et($.id,{requiresApproval:me.target.checked}),className:"accent-[#4E6E49]"}),s.jsx("span",{className:i==="dark"?"text-gray-300":"text-gray-700",children:$.requiresApproval?"Да, ждем подтверждения":"Нет, этап сразу считается выполненным"})]})]})]}),s.jsxs("div",{className:"mt-3 space-y-2",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("label",{className:`text-sm font-medium ${c}`,children:"Ответственные (до 10)"}),s.jsxs("label",{className:"inline-flex items-center gap-2 text-xs",children:[s.jsx("input",{type:"checkbox",checked:$.responsible==="all",onChange:me=>et($.id,{responsible:me.target.checked?"all":($.assignees||[]).map(Me=>Me.userId)})}),"Все участники задачи"]})]}),s.jsxs("span",{className:"text-[11px] text-gray-500",children:[((we=$.assignees)==null?void 0:we.length)||0,"/10"]})]}),$.responsible!=="all"&&s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-2",children:Ee.map(me=>{const Oe=($.assignees||[]).some(Ye=>Ye.userId===me.id);return s.jsx("button",{type:"button",onClick:()=>U($.id,me.id),className:`p-2 rounded-lg border text-left text-sm transition-all ${Oe?i==="dark"?"border-[#4E6E49] bg-[#4E6E49]/20":"border-[#4E6E49] bg-green-50":`${g} ${h}`}`,children:s.jsx("span",{className:Oe?"text-[#4E6E49]":c,children:me.name})},me.id)})}),$.assignees&&$.assignees.length>0&&s.jsx("div",{className:"space-y-2",children:$.assignees.map(me=>{const Me=Ee.find(Oe=>Oe.id===me.userId);return s.jsxs("div",{className:`p-2 rounded-lg border ${g} ${i==="dark"?"bg-[#1a1a1a]":"bg-white"}`,children:[s.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2",children:[s.jsx("div",{className:"text-sm font-medium",children:(Me==null?void 0:Me.name)||me.userId}),s.jsxs("select",{value:me.priority,onChange:Oe=>D($.id,me.userId,"priority",Oe.target.value),className:`px-3 py-1.5 rounded-lg border ${g} ${i==="dark"?"bg-[#1a1a1a] text-gray-100":"bg-white text-gray-700"}`,children:[s.jsx("option",{value:"urgent",children:"Экстренный"}),s.jsx("option",{value:"high",children:"Высокий"}),s.jsx("option",{value:"medium",children:"Средний"}),s.jsx("option",{value:"low",children:"Низкий"})]})]}),s.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2 mt-2",children:[s.jsx("input",{value:me.instruction||"",onChange:Oe=>D($.id,me.userId,"instruction",Oe.target.value),className:`w-full px-3 py-2 rounded-lg border ${g} ${i==="dark"?"bg-[#1a1a1a] text-gray-100":"bg-white text-gray-700"}`,placeholder:"Инструкция по этапу"}),s.jsx("input",{value:me.comment||"",onChange:Oe=>D($.id,me.userId,"comment",Oe.target.value),className:`w-full px-3 py-2 rounded-lg border ${g} ${i==="dark"?"bg-[#1a1a1a] text-gray-100":"bg-white text-gray-700"}`,placeholder:"Комментарий для исполнителя"})]})]},me.userId)})})]}),$.responsible==="all"&&s.jsx("p",{className:`text-xs ${i==="dark"?"text-gray-400":"text-gray-600"}`,children:"Этап доступен всем участникам задачи"})]})]},$.id)})})]}),s.jsxs("div",{className:`flex flex-col sm:flex-row gap-3 pt-4 border-t ${g}`,children:[s.jsx("button",{onClick:C,disabled:W,className:`flex-1 px-6 py-3 rounded-lg font-semibold transition-all ${W?"bg-gray-400 cursor-not-allowed":"bg-gradient-to-r from-[#4E6E49] to-emerald-700 hover:from-[#4E6E49] hover:to-emerald-700 text-white shadow-lg hover:shadow-xl transform hover:scale-[1.02]"}`,children:W?"Сохранение...":l?"Сохранить изменения":"Создать задачу"}),s.jsx("button",{onClick:r,className:`px-6 py-3 rounded-lg font-semibold transition-colors ${i==="dark"?"bg-gray-700 hover:bg-gray-600 text-gray-300":"bg-gray-200 hover:bg-gray-300 text-gray-700"}`,children:"Отмена"})]})]})]})})})},pc=60*1e3,sa=60*pc,zu=24*sa,qk=r=>{if(r<=0)return"Просрочено";const e=Math.floor(r/zu),t=Math.floor(r%zu/sa),n=Math.floor(r%sa/pc);return e>0?`${e}д ${t}ч`:t>0?`${t}ч ${n}м`:`${Math.max(n,1)}м`},Wk=r=>r<=0?"overdue":r<=sa?"urgent":r<=6*sa?"soon":"on_track",Do=(r,e)=>{if(!r||!e)return{label:"—",status:"unknown",isOverdue:!1};const n=new Date(`${r}T${e}`).getTime()-Date.now();if(Number.isNaN(n))return{label:"—",status:"unknown",isOverdue:!1};const a=Wk(n);return{label:qk(n),status:a,isOverdue:a==="overdue"}},zk=(r,e)=>{const t=A.useMemo(()=>Do(r,e),[r,e]),[n,a]=A.useState(t);return A.useEffect(()=>{a(Do(r,e));const i=setInterval(()=>{a(Do(r,e))},pc);return()=>clearInterval(i)},[r,e]),n},Hk=(r,e)=>e==="dark"?{overdue:"bg-red-500/10 border-red-500/40 text-red-300",urgent:"bg-orange-500/10 border-orange-500/40 text-orange-200",soon:"bg-yellow-500/10 border-yellow-500/40 text-yellow-200",on_track:"bg-[#4E6E49]/10 border-[#4E6E49]/40 text-green-200",unknown:"bg-gray-600/30 border-gray-500/40 text-gray-200"}[r]:{overdue:"bg-red-50 border-red-200 text-red-600",urgent:"bg-orange-50 border-orange-200 text-orange-600",soon:"bg-yellow-50 border-yellow-200 text-yellow-700",on_track:"bg-green-50 border-green-200 text-[#4E6E49]",unknown:"bg-gray-100 border-gray-200 text-gray-600"}[r],Wg=({dueDate:r,dueTime:e,theme:t,size:n="default"})=>{const{label:a,status:i}=zk(r,e),l=Hk(i,t),c=n==="compact"?"px-2 py-0.5 text-[11px]":"px-2.5 py-1 text-xs sm:text-sm",d=n==="compact"?"w-3 h-3":"w-4 h-4";return s.jsxs("span",{className:`inline-flex items-center gap-1 rounded-full border font-medium ${c} ${l}`,children:[s.jsx(en,{className:d}),a]})},Gk=({task:r,onEdit:e,onDelete:t,onUpdate:n})=>{var J,se;const{user:a}=Dt(),{isAdmin:i}=Bt(),{theme:l}=ct(),[c,d]=A.useState(!1),[h,g]=A.useState(!1),[x,p]=A.useState(""),[E,j]=A.useState(""),[S,k]=A.useState("stage"),L=l==="dark"?"text-white":"text-gray-900",M=l==="dark"?"bg-[#1a1a1a]":"bg-white",T=l==="dark"?"border-gray-800":"border-gray-300",O=ai[r.category],ne=_s[r.status],ie=to[r.category],I=Ee.find(q=>q.id===r.createdBy),N=r.assignees&&r.assignees.length>0?r.assignees:r.assignedTo.map(q=>({userId:q,priority:"medium"})),b=N.map(q=>q.userId),f=N.map(q=>{const te=Ee.find(ge=>ge.id===q.userId);return te?{...q,member:te}:null}).filter(Boolean),w=i||(a==null?void 0:a.id)===r.createdBy||r.mainExecutor===(a==null?void 0:a.id),_=i||(a==null?void 0:a.id)===r.createdBy||r.mainExecutor===(a==null?void 0:a.id)||r.leadExecutor===(a==null?void 0:a.id),y=()=>{var te;const q=[r.mainExecutor,...((te=r.deputies)==null?void 0:te.map(ge=>ge.userId))||[],...r.executors||[],...r.curators||[],...r.leads||[]].filter(Boolean);return Array.from(new Set([...r.assignedTo||[],...q]))},V=(()=>{if(r.stages&&r.stages.length>0){const q=r.currentStageId||r.stages[0].id;return r.stages.find(te=>te.id===q)||r.stages[0]}return{id:"legacy-stage",name:"Этап",responsible:"all",approvals:r.approvals||[],status:r.status==="rejected"?"rejected":"pending"}})(),F=V.approvals||[],z=F.filter(q=>q.status==="approved").length,ee=F.length,re=r.status!=="closed"&&r.status!=="completed"&&!!a&&(V.responsible==="all"?y():V.responsible).includes(a.id),oe=F.find(q=>q.userId===(a==null?void 0:a.id)),ke=!!a&&(a.id===r.mainExecutor||a.id===r.createdBy||r.leadExecutor===a.id||i),ye=()=>!r.stages||r.stages.length===0?F.every(q=>q.status==="approved"):r.stages.every(q=>q.status==="approved"),K=ye(),he=async q=>{if(_){d(!0);try{const te=new Date().toISOString(),ge={status:q,updatedAt:te};if(q==="completed")ge.completedAt=te,ge.completedBy=(a==null?void 0:a.id)||"admin";else if(q==="closed")ge.closedAt=te;else if(q==="in_progress"&&!ye()){d(!1);return}await dr(r.id,ge),n()}catch(te){console.error("Error updating task status:",te)}finally{d(!1)}}},Ce=async(q,te)=>{if(a){d(!0);try{const ge=new Date().toISOString(),W=q==="approve"?"approved":"rejected",ue=q==="reject"?(x||"").trim():"",ze=y(),We=V.responsible==="all"?ze:V.responsible,Pe=F,je=te?We.map(D=>({...Pe.find(pe=>pe.userId===D)||{userId:D,status:"pending",updatedAt:ge},status:W,updatedAt:ge,forAll:!0,...ue?{comment:ue}:{}})):Pe.map(D=>D.userId===a.id?{...D,status:W,updatedAt:ge,...ue?{comment:ue}:{comment:D.comment}}:D);if(!te&&!Pe.find(D=>D.userId===a.id)){const D={userId:a.id,status:W,updatedAt:ge};je.push(ue?{...D,comment:ue}:D)}let _e=r.stages||[];_e.length>0&&(_e=_e.map(D=>D.id===V.id?{...D,approvals:je,status:je.some(P=>P.status==="rejected")?"rejected":je.every(P=>P.status==="approved")?"approved":"pending"}:D));const Le=je.every(D=>D.status==="approved"),nt=je.some(D=>D.status==="rejected");let et=r.currentStageId;if(Le&&!nt&&_e.length>0){const D=_e.findIndex(Y=>Y.id===V.id);if(D>=0&&D<_e.length-1){const Y=_e[D+1],pe=Y.responsible==="all"?ze:Y.responsible;_e[D+1]={...Y,approvals:pe.map(C=>({userId:C,status:"pending",updatedAt:ge})),status:"pending"},et=Y.id}}const U={approvals:je,stages:_e.length>0?_e:void 0,currentStageId:et,updatedAt:ge};q==="reject"||nt?(U.status="rejected",U.awaitingStageId=void 0):Le&&!nt&&(U.status="approval",U.awaitingStageId=V.id),await dr(r.id,U),q==="reject"&&(g(!1),p("")),n()}catch(ge){console.error("Error approving task:",ge)}finally{d(!1)}}},H=async()=>{if(a&&E.trim()){d(!0);try{const q=new Date().toISOString(),te={id:`c-${Date.now()}`,userId:a.id,text:E.trim(),createdAt:q,stageId:S==="stage"?V.id:void 0},ge={comments:[...r.comments||[],te],updatedAt:q};te.stageId&&r.stages&&r.stages.length>0&&(ge.stages=r.stages.map(W=>W.id===te.stageId?{...W,comments:[...W.comments||[],te]}:W)),await dr(r.id,ge),j(""),n()}catch(q){console.error("Error adding comment:",q)}finally{d(!1)}}},Se=()=>{switch(r.priority){case"urgent":return l==="dark"?"text-rose-300":"text-rose-600";case"high":return l==="dark"?"text-red-400":"text-red-600";case"medium":return l==="dark"?"text-yellow-400":"text-yellow-600";default:return l==="dark"?"text-gray-400":"text-gray-600"}},Ne=q=>({urgent:{label:"Экстренный",classes:l==="dark"?"bg-rose-600/20 text-rose-100 border-rose-500/50":"bg-rose-50 text-rose-700 border-rose-200"},high:{label:"Высокий",classes:l==="dark"?"bg-red-500/20 text-red-300 border-red-500/40":"bg-red-50 text-red-600 border-red-200"},medium:{label:"Средний",classes:l==="dark"?"bg-yellow-500/20 text-yellow-300 border-yellow-500/40":"bg-yellow-50 text-yellow-700 border-yellow-200"},low:{label:"Низкий",classes:l==="dark"?"bg-gray-500/20 text-gray-300 border-gray-500/40":"bg-gray-50 text-gray-700 border-gray-200"}})[q],Z=()=>({pending:l==="dark"?"bg-yellow-500/20 border-yellow-500/50 text-yellow-400":"bg-yellow-50 border-yellow-200 text-yellow-700",in_progress:l==="dark"?"bg-blue-500/20 border-blue-500/50 text-blue-400":"bg-blue-50 border-blue-200 text-blue-700",approval:l==="dark"?"bg-purple-500/20 border-purple-500/50 text-purple-300":"bg-purple-50 border-purple-200 text-purple-700",completed:l==="dark"?"bg-[#4E6E49]/20 border-[#4E6E49]/50 text-[#4E6E49]":"bg-green-50 border-green-200 text-[#4E6E49]",closed:l==="dark"?"bg-gray-500/20 border-gray-500/50 text-gray-400":"bg-gray-50 border-gray-200 text-gray-700",rejected:l==="dark"?"bg-red-500/20 border-red-500/50 text-red-400":"bg-red-50 border-red-200 text-red-700"})[r.status],Re=()=>{const q={green:{bg:l==="dark"?"bg-[#4E6E49]/20":"bg-green-50",text:"text-[#4E6E49]"},blue:{bg:l==="dark"?"bg-blue-500/20":"bg-blue-50",text:l==="dark"?"text-blue-400":"text-blue-700"},purple:{bg:l==="dark"?"bg-purple-500/20":"bg-purple-50",text:l==="dark"?"text-purple-400":"text-purple-700"},red:{bg:l==="dark"?"bg-red-500/20":"bg-red-50",text:l==="dark"?"text-red-400":"text-red-700"},yellow:{bg:l==="dark"?"bg-yellow-500/20":"bg-yellow-50",text:l==="dark"?"text-yellow-400":"text-yellow-700"},indigo:{bg:l==="dark"?"bg-indigo-500/20":"bg-indigo-50",text:l==="dark"?"text-indigo-400":"text-indigo-700"}};return q[O.color]||q.green};return s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:`${M} rounded-xl border-2 ${T} p-4 sm:p-6 shadow-lg hover:shadow-xl transition-all ${l==="dark"?"hover:border-[#4E6E49]/50":"hover:border-[#4E6E49]"}`,children:[s.jsxs("div",{className:"flex items-start justify-between gap-3 mb-3",children:[s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsx("div",{className:"flex items-center gap-2 mb-2",children:s.jsx("h3",{className:`text-lg sm:text-xl font-bold ${L} truncate`,children:r.title})}),s.jsxs("div",{className:"flex flex-wrap items-center gap-2 sm:gap-3",children:[s.jsxs("span",{className:`px-2.5 py-1 rounded-lg text-xs sm:text-sm font-medium ${Re().bg} ${Re().text} inline-flex items-center gap-1.5`,children:[s.jsx(ie,{className:"w-4 h-4"}),O.label]}),s.jsx("span",{className:`px-2.5 py-1 rounded-lg text-xs sm:text-sm font-medium border ${Z()}`,children:ne.label}),s.jsxs("span",{className:`text-xs sm:text-sm font-medium inline-flex items-center gap-1.5 ${Se()}`,children:[r.priority==="urgent"||r.priority==="high"?s.jsx(gp,{className:"w-4 h-4"}):r.priority==="medium"?s.jsx(oh,{className:"w-4 h-4"}):s.jsx(up,{className:"w-4 h-4"}),r.priority==="urgent"?"Экстренный":r.priority==="high"?"Высокий":r.priority==="medium"?"Средний":"Низкий"]})]})]}),w&&s.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[s.jsx("button",{onClick:()=>e(r),className:`p-2 rounded-lg transition-colors ${l==="dark"?"hover:bg-gray-700":"hover:bg-gray-100"}`,title:"Редактировать",children:s.jsx(Gt,{className:"w-4 h-4"})}),s.jsx("button",{onClick:()=>t(r.id),className:`p-2 rounded-lg transition-colors ${l==="dark"?"hover:bg-red-500/20 text-red-400":"hover:bg-red-50 text-red-600"}`,title:"Удалить",children:s.jsx(At,{className:"w-4 h-4"})})]})]}),r.description&&s.jsx("p",{className:`text-sm ${l==="dark"?"text-gray-300":"text-gray-600"} mb-4 line-clamp-2`,children:r.description}),s.jsxs("div",{className:"space-y-2 mb-4",children:[s.jsxs("div",{className:"flex flex-col gap-3",children:[s.jsxs("div",{className:"flex items-center gap-2 text-xs sm:text-sm",children:[s.jsx(tn,{className:`w-4 h-4 ${l==="dark"?"text-blue-400":"text-blue-600"}`}),s.jsx("span",{className:`font-medium ${l==="dark"?"text-gray-300":"text-gray-700"}`,children:"Автор:"}),s.jsx("span",{className:l==="dark"?"text-gray-400":"text-gray-600",children:(I==null?void 0:I.name)||"Неизвестно"})]}),s.jsxs("div",{className:"flex items-center gap-2 text-xs sm:text-sm",children:[s.jsx("span",{className:"font-medium text-[#4E6E49]",children:"ГИ:"}),s.jsx("span",{className:l==="dark"?"text-gray-300":"text-gray-700",children:r.mainExecutor?((J=Ee.find(q=>q.id===r.mainExecutor))==null?void 0:J.name)||r.mainExecutor:"—"})]}),s.jsxs("div",{className:"flex items-center gap-2 text-xs sm:text-sm",children:[s.jsx("span",{className:"font-medium text-[#4E6E49]",children:"ВИ:"}),s.jsx("span",{className:l==="dark"?"text-gray-300":"text-gray-700",children:r.leadExecutor?((se=Ee.find(q=>q.id===r.leadExecutor))==null?void 0:se.name)||r.leadExecutor:"—"})]}),s.jsxs("div",{children:[s.jsxs("div",{className:"flex items-center gap-2 text-xs sm:text-sm",children:[s.jsx(Cs,{className:"w-4 h-4 text-[#4E6E49]"}),s.jsx("span",{className:`font-medium ${l==="dark"?"text-gray-300":"text-gray-700"}`,children:"Исполнители:"})]}),f.length>0?s.jsx("div",{className:"mt-2 space-y-2",children:f.map(q=>{const te=Ne(q.priority);return s.jsxs("div",{className:`p-3 rounded-lg border ${T} ${l==="dark"?"bg-[#1a1a1a]/70":"bg-gray-50"}`,children:[s.jsxs("div",{className:"flex items-center justify-between gap-2",children:[s.jsx("span",{className:`text-sm font-medium ${l==="dark"?"text-gray-100":"text-gray-800"}`,children:q.member.name}),s.jsx("span",{className:`text-[11px] px-2 py-0.5 rounded-full border ${te.classes}`,children:te.label})]}),q.comment&&s.jsx("p",{className:`text-xs mt-1 ${l==="dark"?"text-gray-400":"text-gray-600"}`,children:q.comment})]},q.member.id)})}):s.jsx("span",{className:"text-gray-500",children:"Не назначены"})]})]}),s.jsxs("div",{className:"flex items-center gap-3 flex-wrap text-xs sm:text-sm",children:[s.jsxs("span",{className:"inline-flex items-center gap-1",children:[s.jsx(hl,{className:`w-4 h-4 ${l==="dark"?"text-gray-400":"text-gray-500"}`}),s.jsxs("span",{className:l==="dark"?"text-gray-300":"text-gray-700",children:["Старт: ",r.startTime||"—"]})]}),s.jsxs("span",{className:"inline-flex items-center gap-1",children:[s.jsx(br,{className:`w-4 h-4 ${l==="dark"?"text-gray-400":"text-gray-500"}`}),s.jsxs("span",{className:l==="dark"?"text-gray-400":"text-gray-600",children:["Дедлайн: ",xe(new Date(r.dueDate),"dd.MM.yyyy")," ",r.dueTime]})]}),s.jsx(Wg,{dueDate:r.dueDate,dueTime:r.dueTime,theme:l})]}),r.status==="pending"&&r.approvals.length>0&&s.jsxs("div",{className:"flex items-center gap-2 text-xs sm:text-sm",children:[s.jsx(ml,{className:`w-4 h-4 ${l==="dark"?"text-yellow-400":"text-yellow-600"}`}),s.jsxs("span",{className:l==="dark"?"text-yellow-400":"text-yellow-600",children:["Согласований: ",r.approvals.filter(q=>q.status==="approved").length,"/",r.approvals.length]})]})]}),s.jsxs("div",{className:`mt-4 p-3 rounded-lg border ${T} ${l==="dark"?"bg-[#1a1a1a]/70":"bg-gray-50"}`,children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsxs("span",{className:"text-sm font-semibold",children:["Этап: ",V.name]}),s.jsxs("span",{className:"text-xs text-gray-500",children:[z,"/",ee," согласований"]})]}),F.length>0&&s.jsx("div",{className:"space-y-1 text-xs",children:F.map(q=>{const te=Ee.find(ge=>ge.id===q.userId);return s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("span",{className:"flex items-center gap-1",children:[s.jsx("span",{className:"font-medium",children:(te==null?void 0:te.name)||q.userId}),s.jsxs("span",{className:"text-gray-500",children:["(",q.status==="approved"?"ok":q.status==="rejected"?"отклонено":"ожидание",")"]})]}),q.comment&&s.jsx("span",{className:"text-gray-500 truncate max-w-[140px]",children:q.comment})]},q.userId)})}),a&&s.jsxs("div",{className:"mt-3 space-y-2",children:[s.jsx("textarea",{value:E,onChange:q=>j(q.target.value),rows:2,className:`w-full px-3 py-2 rounded-lg border ${T} ${l==="dark"?"bg-[#0f0f0f] text-gray-100":"bg-white text-gray-700"}`,placeholder:"Комментарий к задаче или этапу"}),s.jsxs("div",{className:"flex items-center justify-between gap-2 text-xs",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsxs("label",{className:"inline-flex items-center gap-1",children:[s.jsx("input",{type:"radio",checked:S==="stage",onChange:()=>k("stage")}),"Этап"]}),s.jsxs("label",{className:"inline-flex items-center gap-1",children:[s.jsx("input",{type:"radio",checked:S==="task",onChange:()=>k("task")}),"Задача"]})]}),s.jsx("button",{onClick:H,disabled:c||!E.trim(),className:`px-3 py-1 rounded-lg font-semibold ${l==="dark"?"bg-[#4E6E49] text-white hover:bg-[#4E6E49]/80":"bg-[#4E6E49] text-white hover:bg-emerald-700"} disabled:opacity-50`,children:"Добавить"})]})]})]}),s.jsxs("div",{className:`flex flex-wrap gap-2 pt-4 border-t ${T}`,children:[re&&(!oe||oe.status==="pending")&&s.jsxs("button",{onClick:()=>Ce("approve"),className:"flex-1 sm:flex-none px-4 py-2 bg-[#4E6E49] hover:bg-[#4E6E49] text-white rounded-lg text-sm font-medium transition-colors flex items-center justify-center gap-2",children:[s.jsx(Dr,{className:"w-4 h-4"}),"Согласовать"]}),re&&(!oe||oe.status==="pending")&&s.jsxs("button",{onClick:()=>g(!0),className:"flex-1 sm:flex-none px-4 py-2 bg-red-500 hover:bg-red-600 text-white rounded-lg text-sm font-medium transition-colors flex items-center justify-center gap-2",children:[s.jsx(Qt,{className:"w-4 h-4"}),"Отклонить"]}),ke&&s.jsxs("button",{onClick:()=>Ce("approve",!0),disabled:c,className:"flex-1 sm:flex-none px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg text-sm font-medium transition-colors flex items-center justify-center gap-2 disabled:opacity-50",children:[s.jsx(Dr,{className:"w-4 h-4"}),"Согласовать за всех"]}),r.status==="pending"&&K&&(w||re)&&s.jsxs("button",{onClick:()=>he("in_progress"),disabled:c,className:"flex-1 sm:flex-none px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg text-sm font-medium transition-colors flex items-center justify-center gap-2 disabled:opacity-50",children:[s.jsx(en,{className:"w-4 h-4"}),"В работу"]}),r.status==="in_progress"&&(w||b.includes((a==null?void 0:a.id)||""))&&s.jsxs("button",{onClick:()=>he("completed"),disabled:c,className:"flex-1 sm:flex-none px-4 py-2 bg-[#4E6E49] hover:bg-[#4E6E49] text-white rounded-lg text-sm font-medium transition-colors flex items-center justify-center gap-2 disabled:opacity-50",children:[s.jsx(Di,{className:"w-4 h-4"}),"Выполнена"]}),r.status==="completed"&&w&&s.jsxs("button",{onClick:()=>he("closed"),disabled:c,className:"flex-1 sm:flex-none px-4 py-2 bg-gray-500 hover:bg-gray-600 text-white rounded-lg text-sm font-medium transition-colors flex items-center justify-center gap-2 disabled:opacity-50",children:[s.jsx(dh,{className:"w-4 h-4"}),"Закрыть"]})]})]}),h&&s.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-start sm:items-center justify-center z-[70] p-4 overflow-y-auto overscroll-contain modal-scroll",children:s.jsxs("div",{className:`${M} rounded-xl p-6 max-w-md w-full border-2 ${T}`,children:[s.jsx("h3",{className:`text-lg font-bold mb-4 ${L}`,children:"Отклонить задачу"}),s.jsx("textarea",{value:x,onChange:q=>p(q.target.value),placeholder:"Укажите причину отклонения",rows:3,className:`w-full px-4 py-2 rounded-lg border ${T} ${l==="dark"?"bg-gray-700":"bg-gray-50"} ${L} mb-4 focus:outline-none focus:ring-2 focus:ring-[#4E6E49]/50`}),s.jsxs("div",{className:"flex gap-3",children:[s.jsx("button",{onClick:()=>Ce("reject"),disabled:c||!x.trim(),className:"flex-1 px-4 py-2 rounded-lg font-medium transition-colors bg-red-500 hover:bg-red-600 text-white disabled:opacity-50",children:"Отклонить"}),s.jsx("button",{onClick:()=>{g(!1),p("")},className:`px-4 py-2 rounded-lg font-medium transition-colors ${l==="dark"?"bg-gray-700 hover:bg-gray-600":"bg-gray-200 hover:bg-gray-300"}`,children:"Отмена"})]})]})})]})},Kk=({selectedCategory:r,selectedStatus:e,selectedUsers:t,onCategoryChange:n,onStatusChange:a,onUsersChange:i,onClear:l})=>{const{theme:c}=ct(),d=c==="dark"?"text-white":"text-gray-900",h=c==="dark"?"bg-[#1a1a1a]":"bg-white",g=c==="dark"?"border-gray-800":"border-gray-300",x=r!=="all"||e!=="all"||t.length>0,p=Ee.filter(S=>t.includes(S.id)).map(S=>S.name),E=[{href:"#filter-status",label:"Статусы"},{href:"#filter-category",label:"Категории"},{href:"#filter-people",label:"Исполнители"}],j={pending:s.jsx(ad,{className:"w-4 h-4"}),in_progress:s.jsx(On,{className:"w-4 h-4"}),approval:s.jsx(Vn,{className:"w-4 h-4"}),completed:s.jsx(Di,{className:"w-4 h-4"}),closed:s.jsx(ap,{className:"w-4 h-4"}),rejected:s.jsx(dh,{className:"w-4 h-4"})};return s.jsxs("div",{className:`${h} rounded-xl border-2 ${g} p-4 sm:p-6 shadow-lg sticky top-4 space-y-4`,children:[s.jsxs("div",{className:"flex items-start justify-between gap-3",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:`p-2 rounded-lg ${c==="dark"?"bg-[#4E6E49]/20":"bg-green-50"}`,children:s.jsx(rh,{className:"w-5 h-5 text-[#4E6E49]"})}),s.jsxs("div",{children:[s.jsx("h3",{className:`text-lg font-bold ${d}`,children:"Фильтры"}),s.jsx("p",{className:`text-xs ${c==="dark"?"text-gray-400":"text-gray-500"}`,children:"Быстрая навигация по статусам, категориям и участникам"})]})]}),x&&s.jsxs("button",{onClick:l,className:`px-3 py-1.5 rounded-lg text-sm transition-all flex items-center gap-2 ${c==="dark"?"bg-red-500/20 hover:bg-red-500/30 text-red-300 border border-red-500/50":"bg-red-50 hover:bg-red-100 text-red-600 border border-red-200"}`,children:[s.jsx(Qt,{className:"w-4 h-4"}),s.jsx("span",{className:"hidden sm:inline",children:"Сбросить всё"})]})]}),s.jsx("div",{className:"flex flex-wrap gap-2",children:E.map(S=>s.jsxs("a",{href:S.href,className:`px-3 py-1.5 rounded-lg text-xs font-semibold border transition flex items-center gap-2 ${c==="dark"?"border-white/10 bg-white/5 text-gray-100 hover:border-[#4E6E49]/50":"border-gray-200 bg-white text-gray-800 hover:border-[#4E6E49]/50 hover:text-[#4E6E49]"}`,children:[s.jsx(hd,{className:"w-4 h-4"}),S.label]},S.href))}),s.jsxs("div",{className:`rounded-lg border ${g} ${c==="dark"?"bg-[#1f1f1f]":"bg-gray-50"} p-3 space-y-2`,children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(Sp,{className:"w-4 h-4 text-[#4E6E49]"}),s.jsx("p",{className:`text-sm font-semibold ${d}`,children:"Текущая подборка"})]}),s.jsx("div",{className:"flex flex-wrap gap-2",children:x?s.jsxs(s.Fragment,{children:[r!=="all"&&s.jsx("span",{className:"px-2.5 py-1 rounded-full text-xs font-semibold bg-emerald-500/10 text-emerald-700 dark:text-emerald-200 border border-emerald-500/30",children:ai[r].label}),e!=="all"&&s.jsx("span",{className:"px-2.5 py-1 rounded-full text-xs font-semibold bg-sky-500/10 text-sky-700 dark:text-sky-200 border border-sky-500/30",children:_s[e].label}),t.length>0&&s.jsx("span",{className:"px-2.5 py-1 rounded-full text-xs font-semibold bg-purple-500/10 text-purple-700 dark:text-purple-200 border border-purple-500/30",children:p.join(", ")})]}):s.jsx("span",{className:`text-xs ${c==="dark"?"text-gray-400":"text-gray-500"}`,children:"Фильтры не заданы"})})]}),s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{id:"filter-status",className:"space-y-3",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(_p,{className:"w-4 h-4 text-yellow-500"}),s.jsx("label",{className:`block text-sm font-semibold ${d}`,children:"Статусы"})]}),s.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[s.jsxs("button",{onClick:()=>a("all"),className:`px-3 py-2 rounded-lg text-sm font-semibold transition-all border-2 ${e==="all"?c==="dark"?"bg-[#4E6E49]/20 border-[#4E6E49] text-[#4E6E49]":"bg-green-50 border-[#4E6E49] text-[#4E6E49]":`${c==="dark"?"bg-gray-800 border-gray-800 text-gray-200 hover:bg-gray-700":"bg-white border-gray-200 text-gray-700 hover:border-[#4E6E49]/40"}`} flex items-center gap-2 justify-start text-left w-full`,children:[s.jsx(Vn,{className:"w-4 h-4"}),"Целиком"]}),Object.entries(_s).map(([S,{label:k,color:L}])=>{const M={yellow:c==="dark"?"bg-yellow-500/10 border-yellow-500/50 text-yellow-300":"bg-yellow-50 border-yellow-500/40 text-yellow-700",blue:c==="dark"?"bg-blue-500/10 border-blue-500/50 text-blue-300":"bg-blue-50 border-blue-500/40 text-blue-700",purple:c==="dark"?"bg-purple-500/10 border-purple-500/50 text-purple-200":"bg-purple-50 border-purple-500/40 text-purple-700",green:c==="dark"?"bg-emerald-500/10 border-emerald-500/50 text-emerald-200":"bg-emerald-50 border-emerald-500/40 text-emerald-700",gray:c==="dark"?"bg-gray-500/10 border-gray-500/50 text-gray-300":"bg-gray-50 border-gray-400/60 text-gray-700",red:c==="dark"?"bg-red-500/10 border-red-500/50 text-red-300":"bg-red-50 border-red-500/40 text-red-700"},T=M[L]||M.gray,O=j[S];return s.jsx("button",{onClick:()=>a(S),className:`px-3 py-2 rounded-lg text-sm font-semibold transition-all border-2 flex items-center justify-start gap-3 text-left ${e===S?T:c==="dark"?"bg-gray-900 border-gray-800 text-gray-200 hover:border-[#4E6E49]/40":"bg-white border-gray-200 text-gray-700 hover:border-[#4E6E49]/40"}`,children:s.jsxs("span",{className:"flex items-center gap-2",children:[O,k]})},S)})]})]}),s.jsxs("div",{id:"filter-category",className:"space-y-3",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(zt,{className:"w-4 h-4 text-purple-500"}),s.jsx("label",{className:`block text-sm font-semibold ${d}`,children:"Категории"})]}),s.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2",children:[s.jsxs("button",{onClick:()=>n("all"),className:`px-3 py-3 rounded-lg text-sm font-semibold transition-all border-2 flex items-center gap-2 justify-start text-left w-full ${r==="all"?c==="dark"?"bg-[#4E6E49]/20 border-[#4E6E49] text-[#4E6E49]":"bg-green-50 border-[#4E6E49] text-[#4E6E49]":`${c==="dark"?"bg-gray-900 border-gray-800 text-gray-200 hover:border-[#4E6E49]/40":"bg-white border-gray-200 text-gray-700 hover:border-[#4E6E49]/40"}`}`,children:[s.jsx(hd,{className:"w-4 h-4"}),"Всё"]}),Object.entries(ai).map(([S,{label:k}])=>{const L=to[S],M=r===S;return s.jsx("button",{onClick:()=>n(S),className:`px-3 py-3 rounded-lg text-sm font-semibold transition-all border-2 flex flex-col items-start gap-2 text-left leading-tight whitespace-normal ${M?c==="dark"?"bg-[#4E6E49]/20 border-[#4E6E49] text-[#4E6E49]":"bg-green-50 border-[#4E6E49] text-[#4E6E49]":`${c==="dark"?"bg-gray-900 border-gray-800 text-gray-200 hover:border-[#4E6E49]/40":"bg-white border-gray-200 text-gray-700 hover:border-[#4E6E49]/40"}`}`,children:s.jsxs("span",{className:"flex items-center gap-2 justify-start",children:[s.jsx(L,{className:"w-4 h-4"}),s.jsx("span",{className:"break-words",children:k})]})},S)})]})]}),s.jsxs("div",{id:"filter-people",className:"space-y-3",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(Cs,{className:"w-4 h-4 text-sky-500"}),s.jsx("label",{className:`block text-sm font-semibold ${d}`,children:"Исполнители"})]}),s.jsxs("div",{className:"flex flex-wrap gap-2",children:[s.jsx("button",{onClick:()=>i([]),className:`px-3 py-2 rounded-lg text-sm font-semibold transition-all border-2 ${t.length===0?c==="dark"?"bg-[#4E6E49]/20 border-[#4E6E49] text-[#4E6E49]":"bg-green-50 border-[#4E6E49] text-[#4E6E49]":`${c==="dark"?"bg-gray-900 border-gray-800 text-gray-200 hover:border-[#4E6E49]/40":"bg-white border-gray-200 text-gray-700 hover:border-[#4E6E49]/40"}`}`,children:"Все"}),Ee.map(S=>{const k=t.includes(S.id);return s.jsxs("button",{onClick:()=>{i(k?t.filter(L=>L!==S.id):[...t,S.id])},className:`px-3 py-2 rounded-lg text-sm font-semibold transition-all border-2 flex items-center gap-2 ${k?c==="dark"?"bg-[#4E6E49]/20 border-[#4E6E49] text-[#4E6E49]":"bg-green-50 border-[#4E6E49] text-[#4E6E49]":`${c==="dark"?"bg-gray-900 border-gray-800 text-gray-200 hover:border-[#4E6E49]/40":"bg-white border-gray-200 text-gray-700 hover:border-[#4E6E49]/40"}`}`,children:[s.jsx(ad,{className:`w-3 h-3 ${k?"text-[#4E6E49]":"text-gray-400"}`}),S.name]},S.id)})]})]})]})]})},Qk=({tasks:r,onUpdate:e,onEdit:t,onDelete:n})=>{var et,U,D;const{theme:a}=ct(),{user:i}=Dt(),{isAdmin:l}=Bt(),[c,d]=A.useState(null),[h,g]=A.useState(null),[x,p]=A.useState(null),[E,j]=A.useState(""),[S,k]=A.useState(null),[L,M]=A.useState(null),[T,O]=A.useState(null),[ne,ie]=A.useState({}),[I,N]=A.useState({}),[b,f]=A.useState(null),w=a==="dark"?"text-white":"text-gray-900",_=a==="dark"?"bg-[#1a1a1a]":"bg-white",y=a==="dark"?"border-gray-800":"border-gray-300",G=a==="dark"?"bg-gray-800":"bg-white",V=["pending","in_progress","approval","completed","closed","rejected"],F=P=>P.assignees&&P.assignees.length>0?P.assignees:P.assignedTo.map(Y=>({userId:Y,priority:"medium"})),z=P=>F(P).map(Y=>Y.userId),ee=P=>{var pe;const Y=[P.mainExecutor,P.leadExecutor,...((pe=P.deputies)==null?void 0:pe.map(C=>C.userId))||[],...P.coExecutors||[],...P.executors||[],...P.curators||[],...P.leads||[]].filter(Boolean);return Array.from(new Set([...P.assignedTo||[],...Y]))},re=P=>{if(P.stages&&P.stages.length>0){const Y=P.awaitingStageId||P.currentStageId||P.stages[0].id;return P.stages.find(pe=>pe.id===Y)||P.stages[0]}return{id:"legacy-stage",name:"Этап",responsible:"all",approvals:P.approvals||[],status:P.status==="rejected"?"rejected":"pending",comments:[]}},oe=P=>!!i&&P.createdBy===i.id,ke=P=>!!i&&P.mainExecutor===i.id,ye=P=>!!i&&(P.leadExecutor===i.id||(P.leads||[]).includes(i.id)),K=P=>l||oe(P)||ke(P)||ye(P),he=P=>l||oe(P)||ke(P),Ce=(P,Y)=>Y===P.createdBy?"A":Y===P.mainExecutor?"ГИ":Y===P.leadExecutor||(P.leads||[]).includes(Y)?"ВИ":"",H=P=>r.filter(Y=>Y.status===P),Se=(P,Y)=>{if(S||!K(Y)){P.preventDefault();return}d(Y),P.dataTransfer.effectAllowed="move",P.dataTransfer.setData("text/plain",Y.id)},Ne=P=>{P.preventDefault(),P.dataTransfer.dropEffect="move"},Z=()=>{d(null)},Re=(P,Y)=>{if(S||Y.status==="rejected"||!K(Y))return;const pe=P.touches[0];M({x:pe.clientX,y:pe.clientY,task:Y})},J=P=>{if(!L)return;P.preventDefault();const Y=P.touches[0],pe=document.elementFromPoint(Y.clientX,Y.clientY);if(pe){const C=pe.closest("[data-status]");if(C){const De=C.getAttribute("data-status");De&&O(De)}}},se=async(P,Y)=>{if(!L)return;const pe=P.changedTouches[0],C=document.elementFromPoint(pe.clientX,pe.clientY);if(C){const De=C.closest("[data-status]");if(De){const $=De.getAttribute("data-status");$&&$!==Y&&L.task.status!=="rejected"&&await ge(L.task,$)}}M(null),O(null)},q=P=>!P.stages||P.stages.length===0?P.approvals.every(Y=>Y.status==="approved"):P.stages.every(Y=>Y.status==="approved"),te=async(P,Y)=>{if(P.preventDefault(),P.stopPropagation(),!c||c.status===Y||S||!K(c)){d(null);return}if(c.status==="rejected"&&Y!=="pending"){d(null);return}if(Y==="rejected"){d(null);return}k(c.id);try{const pe=new Date().toISOString(),C={status:Y,updatedAt:pe};Y==="completed"?(C.completedAt=pe,C.completedBy=(i==null?void 0:i.id)||"admin"):Y==="closed"?C.closedAt=pe:Y==="pending"&&c.status==="rejected"&&(C.approvals=z(c).map(De=>({userId:De,status:"pending",updatedAt:pe}))),await dr(c.id,C),e()}catch(pe){console.error("Error updating task status:",pe)}finally{k(null),d(null)}},ge=async(P,Y)=>{if(P.status===Y||S===P.id||!K(P)){g(null);return}k(P.id);try{const pe=new Date().toISOString(),C={status:Y,updatedAt:pe};if(Y==="completed")C.completedAt=pe,C.completedBy=(i==null?void 0:i.id)||"admin";else if(Y==="closed")C.closedAt=pe;else if(Y==="in_progress"){if(!q(P)){k(null),g(null);return}}else Y==="pending"&&P.status==="rejected"&&(C.approvals=z(P).map(De=>({userId:De,status:"pending",updatedAt:pe})));await dr(P.id,C),e(),g(null)}catch(pe){console.error("Error updating task status:",pe)}finally{k(null)}},W=async(P,Y,pe)=>{if(i){k(P.id);try{const C=new Date().toISOString(),De=Y==="approve"?"approved":"rejected",$=Y==="reject"?(E||"").trim():"",le=re(P),we=le.responsible==="all"?ee(P):le.responsible,me=le.approvals||[],Me=Ie=>{const ht={...Ie,status:De,updatedAt:C,forAll:pe?!0:void 0};if($)return{...ht,comment:$};const{comment:Ge,...Xe}=ht;return Xe},Oe=pe?we.map(Ie=>({...me.find(Xe=>Xe.userId===Ie)||{userId:Ie,status:"pending",updatedAt:C},status:De,updatedAt:C,forAll:!0,...$?{comment:$}:{}})):me.map(Ie=>Ie.userId===i.id?Me(Ie):Ie);if(!pe&&!me.find(Ie=>Ie.userId===i.id)){const Ie={userId:i.id,status:De,updatedAt:C};Oe.push($?{...Ie,comment:$}:Ie)}const Ye=(P.stages||[]).map(Ie=>Ie.id===le.id?{...Ie,approvals:Oe}:Ie),R=Oe.length>0&&Oe.every(Ie=>Ie.status==="approved"),X=Oe.some(Ie=>Ie.status==="rejected");let be=P.currentStageId,Ve=Ye;if(P.stages&&P.stages.length>0&&(Ve=Ye.map(Ie=>Ie.id!==le.id?Ie:{...Ie,status:X?"rejected":R?"approved":"pending"}),R&&!X)){const Ie=Ve.findIndex(Ge=>Ge.id===le.id);if(Ie>=0&&Ie<Ve.length-1){be=Ve[Ie+1].id;const Ge=Ve[Ie+1],Xe=Ge.responsible==="all"?ee(P):Ge.responsible;Ve[Ie+1]={...Ge,approvals:Xe.map(ft=>({userId:ft,status:"pending",updatedAt:C}))}}}const He={approvals:Oe,stages:Ve,currentStageId:be,updatedAt:C};Y==="reject"||X?(He.status="rejected",He.awaitingStageId=void 0):R&&!X&&(He.status="approval",He.awaitingStageId=le.id),await dr(P.id,He),e(),Y==="reject"&&(p(null),j(""))}catch(C){console.error("Error approving task:",C)}finally{k(null)}}},ue=async P=>{var Y,pe;if(!(!i||P.createdBy!==i.id)){k(P.id);try{const C=new Date().toISOString(),De=ee(P);let $=P.stages||[];$.length===0&&($=[{id:"stage-1",name:"Этап",responsible:"all",approvals:[],status:"pending"}]);const le=$.map(we=>{const me=we.responsible==="all"?De:we.responsible;return{...we,approvals:me.map(Me=>({userId:Me,status:"pending",updatedAt:C})),status:"pending"}});await dr(P.id,{status:"pending",approvals:((Y=le[0])==null?void 0:Y.approvals)||[],stages:le,currentStageId:(pe=le[0])==null?void 0:pe.id,awaitingStageId:void 0,updatedAt:C}),e()}catch(C){console.error("Error resubmitting task:",C)}finally{k(null)}}},ze=async P=>{if(he(P)){k(P.id);try{const Y=new Date().toISOString(),pe=re(P),C=P.stages||[];let De={updatedAt:Y,awaitingStageId:void 0};if(C.length>0){const $=C.findIndex(Me=>Me.id===pe.id),le=ee(P),we=C.map(Me=>{const Oe=Me.id===pe.id?"approved":Me.status==="approved"||Me.status==="rejected"?Me.status:"pending";return{...Me,status:Oe}});if($>=0&&$<we.length-1){const Me=we[$+1],Oe=(Me.assignees&&Me.assignees.length>0?Me.assignees.map(Ye=>Ye.userId):Me.responsible==="all"?le:Me.responsible)||[];we[$+1]={...Me,approvals:Me.requiresApproval===!1?Oe.map(Ye=>({userId:Ye,status:"approved",updatedAt:Y})):Oe.map(Ye=>({userId:Ye,status:"pending",updatedAt:Y})),status:Me.requiresApproval===!1?"approved":"pending"},De={...De,stages:we,currentStageId:Me.id,status:"in_progress"}}else De={...De,stages:we,status:"completed",completedAt:Y,completedBy:(i==null?void 0:i.id)||"admin"}}else De.status="completed",De.completedAt=Y,De.completedBy=(i==null?void 0:i.id)||"admin";await dr(P.id,De),e()}catch(Y){console.error("Error confirming stage:",Y)}finally{k(null)}}},We=async P=>{if(!i)return;const Y=ne[P.id]||"";if(Y.trim()){k(P.id);try{const pe=new Date().toISOString(),C={id:`c-${Date.now()}`,userId:i.id,text:Y.trim(),createdAt:pe,stageId:(I[P.id]||"stage")==="stage"?re(P).id:void 0},De={comments:[...P.comments||[],C],updatedAt:pe};C.stageId&&P.stages&&P.stages.length>0&&(De.stages=P.stages.map($=>$.id===C.stageId?{...$,comments:[...$.comments||[],C]}:$)),await dr(P.id,De),ie($=>({...$,[P.id]:""})),e()}catch(pe){console.error("Error adding comment:",pe)}finally{k(null)}}},Pe=P=>({pending:a==="dark"?"bg-yellow-500/20 border-yellow-500/50":"bg-yellow-50 border-yellow-200",in_progress:a==="dark"?"bg-blue-500/20 border-blue-500/50":"bg-blue-50 border-blue-200",approval:a==="dark"?"bg-purple-500/20 border-purple-500/50":"bg-purple-50 border-purple-200",completed:a==="dark"?"bg-[#4E6E49]/20 border-[#4E6E49]/50":"bg-green-50 border-green-200",closed:a==="dark"?"bg-gray-500/20 border-gray-500/50":"bg-gray-50 border-gray-200",rejected:a==="dark"?"bg-red-500/20 border-red-500/50":"bg-red-50 border-red-200"})[P],je=P=>({pending:a==="dark"?"text-yellow-400":"text-yellow-700",in_progress:a==="dark"?"text-blue-400":"text-blue-700",approval:a==="dark"?"text-purple-300":"text-purple-700",completed:"text-[#4E6E49]",closed:a==="dark"?"text-gray-400":"text-gray-700",rejected:a==="dark"?"text-red-400":"text-red-700"})[P],_e=P=>{const Y=new Date;return new Date(`${P.dueDate}T${P.dueTime}`)<Y&&P.status!=="completed"&&P.status!=="closed"&&P.status!=="rejected"},Le=P=>{if(P.status==="closed"||P.status==="completed"||!i)return!1;const Y=re(P);if(!(Y.responsible==="all"?ee(P):Y.responsible).includes(i.id))return!1;const C=(Y.approvals||[]).find(De=>De.userId===i.id);return!C||C.status==="pending"},nt=P=>P.status!=="rejected"||!i?!1:P.createdBy===i.id||l;return s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"overflow-x-auto pb-4 -mx-4 px-4",children:s.jsx("div",{className:"flex gap-3 sm:gap-4 min-w-max",children:V.map(P=>{const Y=H(P),pe=_s[P];return s.jsxs("div",{"data-status":P,className:`flex-shrink-0 w-[280px] sm:w-80 ${_} rounded-xl border-2 ${y} p-3 sm:p-4 ${T===P?"border-[#4E6E49]":""}`,onDragOver:Ne,onDrop:C=>te(C,P),onTouchMove:J,children:[s.jsx("div",{className:`mb-3 sm:mb-4 pb-2 sm:pb-3 border-b ${y}`,children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("h3",{className:`text-base sm:text-lg font-bold ${je(P)}`,children:pe.label}),s.jsx("span",{className:`px-2 py-1 rounded-lg text-xs sm:text-sm font-medium ${Pe(P)} ${je(P)}`,children:Y.length})]})}),s.jsxs("div",{className:"space-y-2 sm:space-y-3 max-h-[calc(100vh-280px)] sm:max-h-[calc(100vh-300px)] overflow-y-auto",children:[Y.map(C=>{var He,Ie,ht,Ge,Xe,ft;const De=_e(C),$=l||(i==null?void 0:i.id)===C.createdBy||C.mainExecutor===(i==null?void 0:i.id),le=Le(C),we=nt(C),me=re(C),Me=me.approvals||[],Oe=Me.filter(fe=>fe.status==="approved").length,Ye=Me.length,R=!!i&&(i.id===C.mainExecutor||i.id===C.createdBy||C.leadExecutor===i.id||l),be=F(C).map(fe=>{const tt=Ee.find(at=>at.id===fe.userId);return tt?{...fe,member:tt}:null}).filter(Boolean),Ve=C.stages&&C.stages.length>0?C.stages.findIndex(fe=>fe.id===me.id)<(((He=C.stages)==null?void 0:He.length)||1)-1:!1;return s.jsxs("div",{draggable:!S&&C.status!=="rejected"&&K(C),onDragStart:fe=>Se(fe,C),onDragEnd:Z,onTouchStart:fe=>Re(fe,C),onTouchEnd:fe=>se(fe,P),className:`${_} rounded-lg border-2 ${y} p-2.5 sm:p-3 cursor-move hover:shadow-lg transition-all ${(c==null?void 0:c.id)===C.id||(L==null?void 0:L.task.id)===C.id?"opacity-50":""} ${De?"border-red-500":""} ${S===C.id?"opacity-50 pointer-events-none":""} ${C.status==="rejected"?"opacity-75":""}`,children:[s.jsxs("div",{className:"flex items-start justify-between gap-2 mb-2",children:[s.jsx("h4",{className:`font-semibold text-xs sm:text-sm ${w} flex-1`,children:C.title}),s.jsx("div",{className:"flex items-center gap-1 flex-shrink-0",children:s.jsxs("div",{className:"relative lg:hidden",children:[s.jsx("button",{onClick:()=>g((h==null?void 0:h.id)===C.id?null:C),className:`p-1 rounded ${a==="dark"?"hover:bg-gray-700":"hover:bg-gray-100"}`,children:s.jsx(Ip,{className:"w-4 h-4"})}),(h==null?void 0:h.id)===C.id&&s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"fixed inset-0 z-40",onClick:()=>g(null)}),s.jsx("div",{className:`absolute right-0 top-8 z-50 ${_} rounded-lg shadow-xl border-2 ${y} min-w-[200px]`,children:s.jsxs("div",{className:"p-2",children:[s.jsx("div",{className:`text-xs font-medium mb-2 px-2 py-1 ${a==="dark"?"text-gray-400":"text-gray-600"}`,children:"Изменить статус:"}),V.filter(fe=>fe!=="rejected"||C.status==="rejected").map(fe=>s.jsx("button",{onClick:()=>ge(C,fe),disabled:C.status===fe||S===C.id||!K(C),className:`w-full text-left px-3 py-2 rounded-lg text-sm transition-colors mb-1 ${C.status===fe?Pe(fe):a==="dark"?"hover:bg-gray-700":"hover:bg-gray-100"} ${C.status===fe?je(fe):w} disabled:opacity-50`,children:_s[fe].label},fe)),$&&s.jsxs(s.Fragment,{children:[s.jsx("div",{className:`border-t ${y} my-2`}),s.jsx("button",{onClick:()=>{g(null),t(C)},className:`w-full text-left px-3 py-2 rounded-lg text-sm transition-colors mb-1 ${a==="dark"?"hover:bg-gray-700":"hover:bg-gray-100"} ${w}`,children:"Редактировать"}),s.jsx("button",{onClick:()=>{g(null),f(C)},className:`w-full text-left px-3 py-2 rounded-lg text-sm transition-colors mb-1 ${a==="dark"?"hover:bg-gray-700":"hover:bg-gray-100"} ${w}`,children:"Всё о задаче"}),s.jsx("button",{onClick:()=>{g(null),n(C.id)},className:`w-full text-left px-3 py-2 rounded-lg text-sm transition-colors ${a==="dark"?"hover:bg-red-500/20 text-red-400":"hover:bg-red-50 text-red-600"}`,children:"Удалить"})]})]})})]})]})})]}),s.jsxs("div",{className:"space-y-1.5 text-xs mb-2",children:[s.jsxs("div",{className:"space-y-1",children:[s.jsxs("div",{className:`flex items-center gap-1 ${a==="dark"?"text-blue-400":"text-blue-600"}`,children:[s.jsx("span",{className:"font-medium",children:"Автор:"}),s.jsx("span",{className:a==="dark"?"text-gray-400":"text-gray-600",children:((Ie=Ee.find(fe=>fe.id===C.createdBy))==null?void 0:Ie.name)||"Неизвестно"})]}),s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx("span",{className:"font-medium text-[#4E6E49]",children:"ГИ:"}),s.jsx("span",{className:a==="dark"?"text-gray-300":"text-gray-700",children:C.mainExecutor?((ht=Ee.find(fe=>fe.id===C.mainExecutor))==null?void 0:ht.name)||C.mainExecutor:"—"})]}),s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx("span",{className:"font-medium text-[#4E6E49]",children:"ВИ:"}),s.jsx("span",{className:a==="dark"?"text-gray-300":"text-gray-700",children:C.leadExecutor?((Ge=Ee.find(fe=>fe.id===C.leadExecutor))==null?void 0:Ge.name)||C.leadExecutor:"—"})]}),s.jsxs("div",{className:"flex flex-col gap-1",children:[s.jsx("div",{className:"flex items-center gap-1 text-[#4E6E49]",children:s.jsx("span",{className:"font-medium",children:"Исполнители:"})}),be.length>0?be.map(fe=>s.jsxs("div",{className:`text-[11px] sm:text-xs ${a==="dark"?"text-gray-300":"text-gray-700"} flex flex-wrap gap-1`,children:[s.jsx("span",{className:"font-medium",children:fe.member.name}),s.jsx("span",{children:"•"}),s.jsx("span",{children:fe.priority==="high"?"Высокий":fe.priority==="medium"?"Средний":"Низкий"}),fe.comment&&s.jsxs(s.Fragment,{children:[s.jsx("span",{children:"•"}),s.jsx("span",{className:"truncate max-w-[140px] sm:max-w-[180px]",children:fe.comment})]})]},fe.member.id)):s.jsx("span",{className:"text-gray-500",children:"Не назначены"})]})]}),s.jsxs("div",{className:`flex items-center gap-2 flex-wrap ${a==="dark"?"text-gray-400":"text-gray-600"}`,children:[C.startTime&&s.jsxs("span",{className:"inline-flex items-center gap-1",children:[s.jsx(hl,{className:"w-3.5 h-3.5"}),C.startTime]}),s.jsxs("span",{className:"inline-flex items-center gap-1",children:[s.jsx(Mo,{className:"w-3.5 h-3.5"}),xe(new Date(C.dueDate),"dd.MM.yyyy")]}),s.jsxs("span",{className:"inline-flex items-center gap-1",children:[s.jsx(On,{className:"w-3.5 h-3.5"}),C.dueTime]}),s.jsx(Wg,{dueDate:C.dueDate,dueTime:C.dueTime,theme:a,size:"compact"})]}),Ye>0&&s.jsxs("div",{className:`flex items-center justify-between gap-2 ${a==="dark"?"text-yellow-300":"text-yellow-700"}`,children:[s.jsxs("span",{className:"inline-flex items-center gap-1",children:[s.jsx(ml,{className:"w-3 h-3"}),"Этап: ",me.name]}),s.jsxs("span",{className:"text-[11px] font-semibold",children:[Oe,"/",Ye]})]}),C.description&&s.jsx("p",{className:`line-clamp-2 ${a==="dark"?"text-gray-300":"text-gray-600"}`,children:C.description}),Me.length>0&&s.jsx("div",{className:`mt-1 space-y-1 ${a==="dark"?"text-gray-300":"text-gray-700"}`,children:Me.map(fe=>{const tt=Ee.find(at=>at.id===fe.userId);return s.jsxs("div",{className:"flex items-center justify-between text-[11px]",children:[s.jsxs("span",{className:"flex items-center gap-1",children:[s.jsxs("span",{className:"font-medium",children:[(tt==null?void 0:tt.name)||fe.userId,Ce(C,fe.userId)&&s.jsx("span",{className:"ml-1 text-[10px] px-1 rounded bg-gray-200 dark:bg-gray-800",children:Ce(C,fe.userId)})]}),s.jsxs("span",{className:"text-gray-500",children:["(",fe.status==="approved"?"ok":fe.status==="rejected"?"отклонено":"ожидание",")"]})]}),fe.comment&&s.jsx("span",{className:"truncate max-w-[140px] text-gray-500",children:fe.comment})]},fe.userId)})}),(((Xe=C.comments)==null?void 0:Xe.length)||((ft=me.comments)==null?void 0:ft.length))&&s.jsx("div",{className:"mt-2 space-y-1",children:[...C.comments||[],...me.comments||[]].map(fe=>{const tt=Ee.find(at=>at.id===fe.userId);return s.jsxs("div",{className:`text-[11px] ${a==="dark"?"text-gray-300":"text-gray-700"}`,children:[s.jsx("span",{className:"font-semibold",children:(tt==null?void 0:tt.name)||fe.userId})," ",s.jsx("span",{className:"text-gray-500",children:fe.stageId?"(этап)":"(задача)"}),": ",fe.text]},fe.id)})}),i&&s.jsxs("div",{className:`mt-2 p-2 rounded-lg border ${y} ${G}`,children:[s.jsx("textarea",{value:ne[C.id]||"",onChange:fe=>ie(tt=>({...tt,[C.id]:fe.target.value})),rows:2,className:`w-full px-2 py-1 rounded border ${y} ${a==="dark"?"bg-[#1a1a1a] text-gray-100":"bg-white text-gray-700"}`,placeholder:"Комментарий к задаче или этапу"}),s.jsxs("div",{className:"flex items-center justify-between mt-2 gap-2",children:[s.jsxs("div",{className:"flex items-center gap-2 text-[11px]",children:[s.jsxs("label",{className:"inline-flex items-center gap-1",children:[s.jsx("input",{type:"radio",name:`comment-target-${C.id}`,checked:(I[C.id]||"stage")==="stage",onChange:()=>N(fe=>({...fe,[C.id]:"stage"}))}),"Этап"]}),s.jsxs("label",{className:"inline-flex items-center gap-1",children:[s.jsx("input",{type:"radio",name:`comment-target-${C.id}`,checked:I[C.id]==="task",onChange:()=>N(fe=>({...fe,[C.id]:"task"}))}),"Задача"]})]}),s.jsx("button",{onClick:()=>We(C),disabled:S===C.id||!(ne[C.id]||"").trim(),className:`px-3 py-1 text-xs rounded-lg font-medium ${a==="dark"?"bg-[#4E6E49] text-white hover:bg-[#4E6E49]/80":"bg-[#4E6E49] text-white hover:bg-emerald-700"} disabled:opacity-50`,children:"Добавить"})]})]}),s.jsx("div",{className:"flex items-center gap-2 flex-wrap",children:s.jsx("span",{className:`px-1.5 py-0.5 rounded text-xs inline-flex items-center gap-1 ${Pe(P)} ${je(P)}`,children:(()=>{const fe=to[C.category];return s.jsx(fe,{className:"w-3.5 h-3.5"})})()})})]}),s.jsx("div",{className:"flex justify-end mt-1",children:s.jsx("button",{onClick:()=>f(C),className:`text-[11px] underline ${a==="dark"?"text-gray-300":"text-gray-600"} hover:text-[#4E6E49]`,children:"Всё о задаче"})}),C.status==="approval"&&he(C)&&s.jsx("div",{className:`mt-2 pt-2 border-t ${y}`,children:s.jsxs("button",{onClick:()=>ze(C),disabled:S===C.id,className:"w-full px-2 py-1.5 bg-purple-600 hover:bg-purple-700 text-white rounded-lg text-xs font-medium transition-colors flex items-center justify-center gap-1 disabled:opacity-50",children:[s.jsx(Dr,{className:"w-3 h-3"}),Ve?"Подтвердить этап и продолжить":"Подтвердить и завершить"]})}),(le||R)&&s.jsxs("div",{className:`flex flex-col gap-2 mt-2 pt-2 border-t ${y}`,children:[s.jsxs("div",{className:"flex gap-2",children:[le&&s.jsxs("button",{onClick:()=>W(C,"approve"),className:"flex-1 px-2 py-1.5 bg-[#4E6E49] hover:bg-[#4E6E49] text-white rounded-lg text-xs font-medium transition-colors flex items-center justify-center gap-1",children:[s.jsx(Dr,{className:"w-3 h-3"}),"Согласовать"]}),s.jsxs("button",{onClick:()=>{p({task:C}),j("")},className:"flex-1 px-2 py-1.5 bg-red-500 hover:bg-red-600 text-white rounded-lg text-xs font-medium transition-colors flex items-center justify-center gap-1",children:[s.jsx(Qt,{className:"w-3 h-3"}),"Отклонить"]})]}),R&&s.jsxs("button",{onClick:()=>W(C,"approve",!0),className:"px-2 py-1.5 bg-blue-600 hover:bg-blue-700 text-white rounded-lg text-xs font-medium transition-colors flex items-center justify-center gap-1",children:[s.jsx(Dr,{className:"w-3 h-3"}),"Согласовать за всех этап"]})]}),we&&s.jsx("div",{className:`mt-2 pt-2 border-t ${y}`,children:s.jsxs("button",{onClick:()=>ue(C),disabled:S===C.id,className:"w-full px-2 py-1.5 bg-blue-500 hover:bg-blue-600 text-white rounded-lg text-xs font-medium transition-colors flex items-center justify-center gap-1 disabled:opacity-50",children:[s.jsx(Rp,{className:"w-3 h-3"}),"Отправить на согласование"]})})]},C.id)}),Y.length===0&&s.jsxs("div",{className:`text-center py-6 sm:py-8 ${a==="dark"?"text-gray-500":"text-gray-400"}`,children:[s.jsx(ss,{className:"w-6 h-6 sm:w-8 sm:h-8 mx-auto mb-2 opacity-50"}),s.jsx("p",{className:"text-xs sm:text-sm",children:"Нет задач"})]})]})]},P)})})}),x&&s.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-start sm:items-center justify-center z-[70] p-4 overflow-y-auto overscroll-contain modal-scroll",children:s.jsxs("div",{className:`${_} rounded-xl p-6 max-w-md w-full border-2 ${y}`,children:[s.jsx("h3",{className:`text-lg font-bold mb-4 ${w}`,children:"Отклонить задачу"}),s.jsx("textarea",{value:E,onChange:P=>j(P.target.value),placeholder:"Укажите причину отклонения",rows:3,className:`w-full px-4 py-2 rounded-lg border ${y} ${a==="dark"?"bg-gray-700":"bg-gray-50"} ${w} mb-4 focus:outline-none focus:ring-2 focus:ring-[#4E6E49]/50`}),s.jsxs("div",{className:"flex gap-3",children:[s.jsx("button",{onClick:()=>x.task&&W(x.task,"reject"),disabled:S===x.task.id||!E.trim(),className:"flex-1 px-4 py-2 rounded-lg font-medium transition-colors bg-red-500 hover:bg-red-600 text-white disabled:opacity-50",children:"Отклонить"}),s.jsx("button",{onClick:()=>{p(null),j("")},className:`px-4 py-2 rounded-lg font-medium transition-colors ${a==="dark"?"bg-gray-700 hover:bg-gray-600":"bg-gray-200 hover:bg-gray-300"}`,children:"Отмена"})]})]})}),b&&s.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-start sm:items-center justify-center z-[70] p-4 overflow-y-auto overscroll-contain modal-scroll",children:s.jsxs("div",{className:`${_} rounded-xl p-6 max-w-2xl w-full border-2 ${y}`,children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsx("h3",{className:`text-lg font-bold ${w}`,children:"Всё о задаче"}),s.jsx("button",{onClick:()=>f(null),className:`p-2 rounded-lg ${a==="dark"?"hover:bg-gray-700":"hover:bg-gray-100"}`,children:s.jsx(Qt,{className:"w-4 h-4"})})]}),s.jsxs("div",{className:"space-y-3 text-sm",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-xs text-gray-500",children:"Название"}),s.jsx("p",{className:`font-semibold ${w}`,children:b.title})]}),b.description&&s.jsxs("div",{children:[s.jsx("p",{className:"text-xs text-gray-500",children:"Описание"}),s.jsx("p",{className:a==="dark"?"text-gray-300":"text-gray-700",children:b.description})]}),b.expectedResult&&s.jsxs("div",{children:[s.jsx("p",{className:"text-xs text-gray-500",children:"Ожидаемый результат"}),s.jsx("p",{className:a==="dark"?"text-gray-300":"text-gray-700",children:b.expectedResult})]}),s.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-xs text-gray-500",children:"Автор"}),s.jsx("p",{className:w,children:((et=Ee.find(P=>P.id===b.createdBy))==null?void 0:et.name)||b.createdBy})]}),s.jsxs("div",{children:[s.jsx("p",{className:"text-xs text-gray-500",children:"Главный исполнитель"}),s.jsx("p",{className:w,children:((U=Ee.find(P=>P.id===b.mainExecutor))==null?void 0:U.name)||"—"})]}),s.jsxs("div",{children:[s.jsx("p",{className:"text-xs text-gray-500",children:"Ведущий исполнитель"}),s.jsx("p",{className:w,children:((D=Ee.find(P=>P.id===b.leadExecutor))==null?void 0:D.name)||"—"})]}),s.jsxs("div",{children:[s.jsx("p",{className:"text-xs text-gray-500",children:"Соисполнители"}),s.jsx("p",{className:w,children:(b.coExecutors||[]).map(P=>{var Y;return((Y=Ee.find(pe=>pe.id===P))==null?void 0:Y.name)||P}).join(", ")||"—"})]})]}),s.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-xs text-gray-500",children:"Дедлайн"}),s.jsxs("p",{className:w,children:[xe(new Date(b.dueDate),"dd.MM.yyyy")," · ",b.dueTime]})]}),s.jsxs("div",{children:[s.jsx("p",{className:"text-xs text-gray-500",children:"Старт"}),s.jsx("p",{className:w,children:b.startTime||"—"})]})]}),s.jsxs("div",{children:[s.jsx("p",{className:"text-xs text-gray-500",children:"Статус"}),s.jsx("p",{className:`${w} font-semibold`,children:_s[b.status].label})]}),b.stages&&b.stages.length>0&&s.jsxs("div",{className:"space-y-1",children:[s.jsx("p",{className:"text-xs text-gray-500",children:"Этапы"}),b.stages.map(P=>{var Y,pe;return s.jsxs("div",{className:`p-2 rounded border ${y}`,children:[s.jsx("p",{className:`font-semibold ${w}`,children:P.name}),s.jsxs("p",{className:"text-xs text-gray-500",children:[((Y=P.approvals)==null?void 0:Y.filter(C=>C.status==="approved").length)||0,"/",((pe=P.approvals)==null?void 0:pe.length)||0," согласовано"]})]},P.id)})]})]})]})})]})},Yk=()=>{var Ne;const{theme:r}=ct(),{user:e}=Dt(),[t,n]=A.useState(!1),[a,i]=A.useState(null),[l,c]=A.useState([]),[d,h]=A.useState(!0),[g,x]=A.useState("all"),[p,E]=A.useState("all"),[j,S]=A.useState([]),[k,L]=A.useState("kanban"),M=r==="dark"?"text-white":"text-gray-900",T=r==="dark"?"bg-[#1a1a1a]":"bg-white";A.useEffect(()=>{O()},[e]),A.useEffect(()=>{O()},[g,p,j]);const O=async()=>{h(!0);try{const Z={};g!=="all"&&(Z.category=g),p!=="all"&&(Z.status=p),j.length>0&&(Z.assignedTo=j);const Re=await Ag(Z);c(Re)}catch(Z){console.error("Error loading tasks:",Z)}finally{h(!1)}},ne=Z=>{i(Z),n(!0)},ie=async Z=>{if(confirm("Вы уверены, что хотите удалить эту задачу?"))try{await Cg(Z),O()}catch(Re){console.error("Error deleting task:",Re)}},I=()=>{n(!1),i(null)},N=()=>{n(!1),i(null),O()},b=()=>{x("all"),E("all"),S([])},f=l.filter(Z=>!(g!=="all"&&Z.category!==g||p!=="all"&&Z.status!==p||j.length>0&&!j.some(Re=>Z.assignedTo.includes(Re)))),w={pending:l.filter(Z=>Z.status==="pending").length,inProgress:l.filter(Z=>Z.status==="in_progress").length,onApproval:l.filter(Z=>Z.status==="approval").length,completed:l.filter(Z=>Z.status==="completed").length,closed:l.filter(Z=>Z.status==="closed").length},_=new Date,y=xe(_,"yyyy-MM-dd"),G=new Date(_);G.setDate(_.getDate()-7);const V=new Date(_);V.setDate(_.getDate()-30);const F=l.filter(Z=>new Date(Z.createdAt)>=G).length,z=l.filter(Z=>new Date(Z.createdAt)>=V).length,ee=l.filter(Z=>Z.completedAt&&Z.completedAt.startsWith(y)).length,re=e?l.filter(Z=>Z.mainExecutor===e.id||Z.leadExecutor===e.id||(Z.assignedTo||[]).includes(e.id)||(Z.coExecutors||[]).includes(e.id)):[],oe=re.length,ke=l.length,ye=ke?Math.round(w.inProgress/ke*100):0,K=(()=>{var J;const Z={};return l.forEach(se=>{[se.mainExecutor,se.leadExecutor,...se.assignedTo||[],...se.coExecutors||[]].filter(Boolean).forEach(te=>{Z[te]=(Z[te]||0)+1})}),((J=Object.entries(Z).sort((se,q)=>q[1]-se[1])[0])==null?void 0:J[0])||""})(),he=K?((Ne=Ee.find(Z=>Z.id===K))==null?void 0:Ne.name)||K:"—",Ce=l.filter(Z=>Z.status!=="completed"&&Z.status!=="closed").sort((Z,Re)=>new Date(`${Z.dueDate}T${Z.dueTime}`).getTime()-new Date(`${Re.dueDate}T${Re.dueTime}`).getTime())[0],H=[{label:"Всего задач на неделе",value:F,sub:"последние 7 дней",tone:"sky"},{label:"Всего задач на месяце",value:z,sub:"последние 30 дней",tone:"emerald"},{label:"Задач на проверке",value:w.pending+w.onApproval,sub:`${w.pending} на старте · ${w.onApproval} на согласовании`,tone:"amber"},{label:"Задач в работе",value:w.inProgress,sub:`${ye}% от всех`,tone:"blue"},{label:"Самый активный исполнитель",value:he,sub:"по числу назначений",tone:"purple"},{label:"Закрыто задач",value:w.completed+w.closed,sub:"выполнено и закрыто",tone:"slate"},{label:"Ближайший дедлайн",value:Ce?Ce.title:"Нет активных",sub:Ce?`${xe(new Date(Ce.dueDate),"dd.MM.yyyy")} · ${Ce.dueTime}`:"Свободное окно",tone:"pink"},{label:"Сделано задач за сегодня",value:ee,sub:y,tone:"green"}],Se=[{href:"#tasks-board",label:"Все задачи"},{href:"#my-tasks",label:"Мои задачи",action:()=>e&&S([e.id])},{href:"#tasks-stats",label:"Статистика"}];return s.jsx(ir,{children:s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:`rounded-xl sm:rounded-2xl p-4 sm:p-6 md:p-8 ${T} shadow-xl border-2 ${r==="dark"?"border-[#4E6E49]/30 bg-gradient-to-br from-[#1a1a1a] via-[#1a1a1a] to-[#0A0A0A]":"border-green-200 bg-gradient-to-br from-white via-green-50/30 to-white"} relative overflow-hidden`,children:[s.jsx("div",{className:"absolute top-0 right-0 w-32 h-32 sm:w-64 sm:h-64 bg-gradient-to-br from-[#4E6E49]/10 to-emerald-700/10 rounded-full blur-3xl -mr-16 sm:-mr-32 -mt-16 sm:-mt-32"}),s.jsx("div",{className:"absolute bottom-0 left-0 w-24 h-24 sm:w-48 sm:h-48 bg-gradient-to-tr from-yellow-500/10 to-orange-500/10 rounded-full blur-2xl -ml-12 sm:-ml-24 -mb-12 sm:-mb-24"}),s.jsxs("div",{className:"relative z-10",children:[s.jsx("div",{className:"flex flex-col gap-4 sm:gap-6 lg:flex-row lg:items-start lg:justify-between mb-4 sm:mb-6",children:s.jsxs("div",{className:"flex-1",children:[s.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 mb-2",children:[s.jsx(ss,{className:"w-6 h-6 sm:w-8 sm:h-8 text-[#4E6E49]"}),s.jsxs("h1",{className:`text-2xl sm:text-3xl md:text-4xl font-extrabold ${M} flex items-center gap-2`,children:["Task Team",s.jsx(zt,{className:`w-5 h-5 sm:w-6 sm:h-6 ${r==="dark"?"text-yellow-400":"text-yellow-600"}`})]})]}),s.jsx("p",{className:`text-sm sm:text-base ${r==="dark"?"text-gray-300":"text-gray-600"}`,children:"Управление задачами и заданиями команды"}),s.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:Se.map(Z=>s.jsx("a",{href:Z.href,onClick:()=>{var Re;return(Re=Z.action)==null?void 0:Re.call(Z)},className:`px-3 py-1.5 rounded-lg text-xs font-semibold border transition ${r==="dark"?"border-white/10 bg-white/5 text-white hover:border-[#4E6E49]/50":"border-gray-200 bg-white text-gray-800 hover:border-[#4E6E49]/50 hover:text-[#4E6E49]"}`,children:Z.label},Z.href))})]})}),s.jsx("div",{id:"tasks-stats",className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3 sm:gap-4",children:H.map(Z=>{const J={emerald:{bg:r==="dark"?"bg-emerald-500/10":"bg-emerald-50",text:r==="dark"?"text-emerald-100":"text-emerald-800",border:r==="dark"?"border-emerald-500/30":"border-emerald-200"},sky:{bg:r==="dark"?"bg-sky-500/10":"bg-sky-50",text:r==="dark"?"text-sky-100":"text-sky-800",border:r==="dark"?"border-sky-500/30":"border-sky-200"},amber:{bg:r==="dark"?"bg-amber-500/10":"bg-amber-50",text:r==="dark"?"text-amber-100":"text-amber-800",border:r==="dark"?"border-amber-500/30":"border-amber-200"},blue:{bg:r==="dark"?"bg-blue-500/10":"bg-blue-50",text:r==="dark"?"text-blue-100":"text-blue-800",border:r==="dark"?"border-blue-500/30":"border-blue-200"},purple:{bg:r==="dark"?"bg-purple-500/10":"bg-purple-50",text:r==="dark"?"text-purple-100":"text-purple-800",border:r==="dark"?"border-purple-500/30":"border-purple-200"},slate:{bg:r==="dark"?"bg-gray-500/10":"bg-gray-50",text:r==="dark"?"text-gray-100":"text-gray-800",border:r==="dark"?"border-gray-500/30":"border-gray-200"},pink:{bg:r==="dark"?"bg-pink-500/10":"bg-pink-50",text:r==="dark"?"text-pink-100":"text-pink-800",border:r==="dark"?"border-pink-500/30":"border-pink-200"},green:{bg:r==="dark"?"bg-green-500/10":"bg-green-50",text:r==="dark"?"text-green-100":"text-green-800",border:r==="dark"?"border-green-500/30":"border-green-200"}}[Z.tone];return s.jsxs("div",{className:`p-4 rounded-xl border ${J.border} ${J.bg} shadow-sm space-y-1`,children:[s.jsx("p",{className:`text-xs font-semibold uppercase ${J.text}`,children:Z.label}),s.jsx("p",{className:`text-2xl font-extrabold ${M} truncate`,children:Z.value}),s.jsx("p",{className:`text-xs ${r==="dark"?"text-gray-400":"text-gray-600"}`,children:Z.sub})]},Z.label)})})]})]}),e&&s.jsxs("div",{id:"my-tasks",className:`rounded-xl sm:rounded-2xl p-4 sm:p-6 ${T} border-2 ${r==="dark"?"border-white/10":"border-gray-200"}`,children:[s.jsxs("div",{className:"flex items-center justify-between gap-3 mb-3",children:[s.jsxs("div",{children:[s.jsx("p",{className:`text-xs uppercase font-semibold ${r==="dark"?"text-gray-400":"text-gray-500"}`,children:"Мои задачи"}),s.jsx("p",{className:`text-xl font-bold ${M}`,children:oe})]}),s.jsx("a",{href:"#tasks-board",className:`px-3 py-2 rounded-lg text-xs font-semibold border ${r==="dark"?"border-white/10 bg-white/5 text-white hover:border-[#4E6E49]/50":"border-gray-200 bg-white text-gray-800 hover:border-[#4E6E49]/50 hover:text-[#4E6E49]"}`,children:"Перейти на доску"})]}),re.length===0?s.jsx("p",{className:r==="dark"?"text-gray-400":"text-gray-600",children:"Нет назначенных задач"}):s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:re.slice(0,4).map(Z=>s.jsxs("div",{className:`p-3 rounded-lg border ${r==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white"}`,children:[s.jsx("p",{className:`text-sm font-semibold ${M} truncate`,children:Z.title}),s.jsxs("p",{className:`text-xs ${r==="dark"?"text-gray-400":"text-gray-600"}`,children:[xe(new Date(Z.dueDate),"dd.MM.yyyy")," · ",Z.dueTime]}),s.jsx("p",{className:"text-xs mt-1",children:s.jsx("span",{className:`px-2 py-0.5 rounded-full ${r==="dark"?"bg-gray-800 text-gray-200":"bg-gray-100 text-gray-700"}`,children:_s[Z.status].label})})]},Z.id))})]}),s.jsxs("div",{className:"flex flex-col lg:flex-row gap-4 sm:gap-6",id:"tasks-board",children:[s.jsx("div",{className:"lg:w-80 flex-shrink-0",children:s.jsx(Kk,{selectedCategory:g,selectedStatus:p,selectedUsers:j,onCategoryChange:x,onStatusChange:E,onUsersChange:S,onClear:b})}),s.jsxs("div",{className:"flex-1",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4 gap-3",children:[s.jsxs("h2",{className:`text-xl font-bold ${M}`,children:["Задачи (",f.length,")"]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsxs("div",{className:`flex rounded-lg border-2 ${r==="dark"?"border-gray-800":"border-gray-300"} overflow-hidden`,children:[s.jsx("button",{onClick:()=>L("kanban"),className:`px-3 py-2 transition-colors ${k==="kanban"?"bg-[#4E6E49] text-white":r==="dark"?"bg-[#1a1a1a] text-gray-300 hover:bg-gray-700":"bg-white text-gray-700 hover:bg-gray-50"}`,title:"Kanban доска",children:s.jsx(kp,{className:"w-4 h-4"})}),s.jsx("button",{onClick:()=>L("list"),className:`px-3 py-2 transition-colors ${k==="list"?"bg-[#4E6E49] text-white":r==="dark"?"bg-[#1a1a1a] text-gray-300 hover:bg-gray-700":"bg-white text-gray-700 hover:bg-gray-50"}`,title:"Список",children:s.jsx(Np,{className:"w-4 h-4"})})]}),s.jsxs("button",{onClick:()=>n(!0),className:"px-4 py-2 bg-gradient-to-r from-[#4E6E49] to-emerald-700 hover:from-[#4E6E49] hover:to-emerald-700 text-white rounded-lg font-semibold transition-all shadow-lg hover:shadow-xl transform hover:scale-105 flex items-center gap-2",children:[s.jsx(li,{className:"w-5 h-5"}),s.jsx("span",{className:"hidden sm:inline",children:"Новая задача"}),s.jsx("span",{className:"sm:hidden",children:"Добавить"})]})]})]}),d?s.jsx("div",{className:`${T} rounded-xl p-8 text-center ${M}`,children:s.jsx("div",{className:"animate-pulse",children:"Загрузка..."})}):f.length===0?s.jsxs("div",{className:`${T} rounded-xl p-8 text-center border-2 ${r==="dark"?"border-gray-800":"border-gray-300"}`,children:[s.jsx(ss,{className:`w-12 h-12 mx-auto mb-4 ${r==="dark"?"text-gray-600":"text-gray-400"}`}),s.jsx("p",{className:`text-lg font-medium ${M} mb-2`,children:"Нет задач"}),s.jsx("p",{className:`text-sm ${r==="dark"?"text-gray-400":"text-gray-600"}`,children:g!=="all"||p!=="all"||j.length>0?"Попробуйте изменить фильтры":"Создайте первую задачу"})]}):k==="kanban"?s.jsx(Qk,{tasks:f,onUpdate:O,onEdit:ne,onDelete:ie}):s.jsx("div",{className:"grid grid-cols-1 gap-4 sm:gap-6",children:f.map(Z=>s.jsx(Gk,{task:Z,onEdit:ne,onDelete:ie,onUpdate:O},Z.id))})]})]}),t&&s.jsx(Bk,{onClose:I,onSave:N,editingTask:a})]})})},Ka=[{id:"all",name:"Все вопросы",icon:s.jsx(sh,{className:"w-5 h-5"}),color:"text-blue-600",darkColor:"text-blue-400"},{id:"auth",name:"Авторизация",icon:s.jsx(nh,{className:"w-5 h-5"}),color:"text-purple-600",darkColor:"text-purple-400"},{id:"slots",name:"Рабочие слоты",icon:s.jsx(br,{className:"w-5 h-5"}),color:"text-[#4E6E49]",darkColor:"text-[#4E6E49]"},{id:"status",name:"Статусы",icon:s.jsx(fl,{className:"w-5 h-5"}),color:"text-orange-600",darkColor:"text-orange-400"},{id:"rating",name:"Рейтинг",icon:s.jsx(Pr,{className:"w-5 h-5"}),color:"text-red-600",darkColor:"text-red-400"},{id:"earnings",name:"Заработок",icon:s.jsx(na,{className:"w-5 h-5"}),color:"text-yellow-600",darkColor:"text-yellow-400"},{id:"calls",name:"Торговые сигналы",icon:s.jsx(ci,{className:"w-5 h-5"}),color:"text-emerald-700",darkColor:"text-emerald-500"},{id:"tasks",name:"Задачи",icon:s.jsx(ss,{className:"w-5 h-5"}),color:"text-lime-600",darkColor:"text-lime-400"},{id:"admin",name:"Администратор",icon:s.jsx(Lt,{className:"w-5 h-5"}),color:"text-indigo-600",darkColor:"text-indigo-400"},{id:"messages",name:"Сообщения",icon:s.jsx(Qr,{className:"w-5 h-5"}),color:"text-cyan-600",darkColor:"text-cyan-400"},{id:"referrals",name:"Рефералы",icon:s.jsx(Cs,{className:"w-5 h-5"}),color:"text-pink-600",darkColor:"text-pink-400"},{id:"edit",name:"Редактирование",icon:s.jsx(Gt,{className:"w-5 h-5"}),color:"text-teal-600",darkColor:"text-teal-400"},{id:"interface",name:"Интерфейс сайта",icon:s.jsx(pl,{className:"w-5 h-5"}),color:"text-violet-600",darkColor:"text-violet-400"}],Xk=[{title:"Вход и роль",description:"Авторизуйтесь на сайте, выберите роль участника или администратора и подтвердите вход.",icon:s.jsx(nh,{className:"w-4 h-4"}),lightGradient:"from-sky-50 via-white to-indigo-50",darkGradient:"from-white/8 via-white/0 to-sky-400/14",lightAccent:"text-sky-700",darkAccent:"text-sky-200",tags:["Вход на сайт"]},{title:"Изучите правила",description:"Откройте регламент сообщества, чтобы понимать ограничения по слотам, статусам и требованиям к рейтингу.",icon:s.jsx(fl,{className:"w-4 h-4"}),lightGradient:"from-amber-50 via-white to-orange-50",darkGradient:"from-white/8 via-white/0 to-amber-400/14",lightAccent:"text-amber-700",darkAccent:"text-amber-200",tags:["Регламент","Прозрачность"]},{title:"Настройте интерфейс",description:"Выберите тему, закрепите удобную навигацию и откройте нужные разделы — все настройки сохраняются автоматически.",icon:s.jsx(pl,{className:"w-4 h-4"}),lightGradient:"from-emerald-50 via-white to-green-50",darkGradient:"from-white/8 via-white/0 to-emerald-400/14",lightAccent:"text-emerald-700",darkAccent:"text-emerald-200",tags:["Тема","Навигация"]},{title:"Заполните расписание",description:"Добавьте рабочие слоты, выходные, больничные или отпуск в Management, чтобы команда видела актуальное расписание.",icon:s.jsx(br,{className:"w-4 h-4"}),lightGradient:"from-blue-50 via-white to-cyan-50",darkGradient:"from-white/8 via-white/0 to-cyan-400/14",lightAccent:"text-blue-700",darkAccent:"text-blue-200",tags:["Management","Слоты"]},{title:"Следите за результатами",description:"Отмечайте заработок, просматривайте рейтинг и аналитику по сигналам, чтобы видеть прогресс и точки роста.",icon:s.jsx(Pr,{className:"w-4 h-4"}),lightGradient:"from-violet-50 via-white to-fuchsia-50",darkGradient:"from-white/8 via-white/0 to-violet-400/14",lightAccent:"text-violet-700",darkAccent:"text-violet-200",tags:["Earnings","Rating"]},{title:"Оставайтесь на связи",description:"Используйте чат и уведомления по задачам, чтобы договориться о правках, подтвердить статусы и держать команду в курсе.",icon:s.jsx(Qr,{className:"w-4 h-4"}),lightGradient:"from-rose-50 via-white to-pink-50",darkGradient:"from-white/8 via-white/0 to-rose-400/14",lightAccent:"text-rose-700",darkAccent:"text-rose-200",tags:["Коммуникация","Уведомления"]}];let cl=[{question:"Как начать работу с системой?",answer:`1. Откройте сайт и войдите по логину/паролю
2. Выберите роль: участник или админ (пароль админа)
3. Сразу откройте FAQ и регламент — ссылки в шапке
4. Настройте тему (светлая/темная) — сохраняется в браузере
5. Перейдите в Call, Management, Earnings и Rating: все ключевые разделы доступны на сайте`,category:"auth"},{question:"Как работает авторизация?",answer:`ВХОД НА САЙТ:
1. Откройте страницу логина
2. Выберите тип пользователя: "Участник" или "Админ"
3. Для участника: введите логин и пароль
4. Для админа: введите только пароль администратора
5. Настройте тему (светлая/темная) — сохраняется в профиле
6. Нажмите "Войти"

ВЫХОД:
• Кнопка выхода в правом верхнем углу

ВАЖНО:
• Не передавайте логин и пароль
• Если забыли данные, обратитесь к администратору: @artyommedoed`,category:"auth"},{question:"Как войти в режим администратора на сайте?",answer:`АКТИВАЦИЯ РЕЖИМА АДМИНИСТРАТОРА НА САЙТЕ:
1. Откройте страницу входа на сайте
2. Выберите тип пользователя "Админ" (кнопка справа)
3. Введите пароль администратора
4. Нажмите "Войти"
5. После успешного входа режим администратора будет активен

ОТЛИЧИЯ ОТ ВХОДА УЧАСТНИКА:
• При входе как "Админ" не нужно вводить логин - только пароль
• Режим администратора активируется автоматически
• Все административные функции становятся доступными

ЧТО МОЖЕТ АДМИНИСТРАТОР:
• Управлять слотами и статусами всех участников
• Массовое создание/удаление слотов
• Добавлять заработок за любую дату
• Удалять сообщения из подсчета
• Просматривать и редактировать данные всех участников

ДЕАКТИВАЦИЯ:
• Выйдите из системы (кнопка выхода в правом верхнем углу)
• При следующем входе выберите "Участник" для обычного доступа

ВАЖНО:
• Пароль администратора не передавайте третьим лицам
• Режим администратора дает полный доступ к системе`,category:"admin"},{question:"Как добавить торговый сигнал?",answer:`1. Перейдите в раздел "Call"
2. Выберите категорию мини-карточкой и нажмите "Добавить"
3. Заполните форму: сеть/пара, вход, цели, SL, риск, комментарий, статус
4. Сохраните — сигнал появится в списке и аналитике`,category:"calls"},{question:"Как просмотреть торговые сигналы?",answer:`На сайте в разделе "Call":
• Поиск по тикеру, паре, сети и комментарию
• Фильтры по статусу, категории, риску и трейдеру
• Аналитика: активные/завершенные/отмененные, средний PNL, лучшие сделки
• Кнопки редактировать, отменить или удалить доступны автору и администратору`,category:"calls"},{question:"Что означают параметры торгового сигнала?",answer:`ПОЛНЫЙ СПИСОК ПАРАМЕТРОВ:

1. СЕТЬ:
• Solana, BSC, Ethereum, Base, Ton, Tron, SUI или CEX биржа
• Определяет блокчейн, на котором торгуется токен

2. ТИКЕР ТОКЕНА (№ТИКЕР):
• Идентификатор токена (например: №PEPE)
• Символ № указывает, что это тикер
• Можно скопировать для поиска на биржах

3. ПАРА ТОКЕНА:
• Торговая пара (например: PEPE/USDT)
• Показывает, с какой валютой торгуется токен

4. ТОЧКА ВХОДА:
• Указывается в формате КАПИТАЛИЗАЦИИ (не цены)
• Может быть одно значение или диапазон
• Пример: 1000000 или 1000000-1500000

5. ЦЕЛЬ:
• Цели по прибыли в формате КАПИТАЛИЗАЦИИ
• Можно указать несколько целей через запятую
• Пример: 2000000, 3000000, 5000000

6. СТРАТЕГИЯ:
• Флип - краткосрочная торговля (часы-дни)
• Среднесрок - среднесрочная торговля (дни-недели)
• Долгосрок - долгосрочная торговля (недели-месяцы)

7. РИСКИ:
• Описание рисков, связанных с торговлей этим токеном
• Важно для понимания потенциальных потерь

8. УСЛОВИЯ ОТМЕНЫ:
• При каких условиях сигнал должен быть отменен
• Может быть изменен или пересмотрен

9. КОММЕНТАРИЙ:
• Дополнительная информация о сигнале
• Аналитика или особенности токена

ВАЖНО:
• Точка входа и цель указываются в КАПИТАЛИЗАЦИИ, а не в цене
• Это помогает учитывать изменения ликвидности и общую оценку проекта`,category:"calls"},{question:"Как работает раздел Management на сайте?",answer:`ОСНОВНЫЕ ВОЗМОЖНОСТИ:

ПРЕДСТАВЛЕНИЯ:
1. ТАБЛИЦА:
   • Отображает участников в строках, дни недели - в колонках
   • Компактный вид для быстрого обзора
   • Аватары участников в первом столбце
   • Подсветка строк при наведении
   • Чередующаяся подсветка для лучшей читаемости

2. НЕДЕЛЯ:
   • Отображает каждый день недели отдельно
   • Карточки со слотами и статусами
   • Визуальное разделение по участникам
   • Удобно для просмотра расписания по дням

ФИЛЬТРЫ СЛОТОВ:
• Все - показывает все слоты
• Предстоящие - только будущие и текущие активные слоты
• Завершенные - только прошедшие слоты

ВИЗУАЛЬНОЕ РАЗДЕЛЕНИЕ:
• Предстоящие слоты: синий градиент с иконкой календаря
• Завершенные слоты: серый градиент с иконкой галочки
• Перерывы: белый фон (светлая тема) или темно-серый (темная тема)
• Аватары участников для быстрой идентификации

СТАТИСТИКА:
• Общее количество слотов за неделю
• Количество предстоящих и завершенных слотов
• Количество активных участников

НАВИГАЦИЯ:
• Кнопки "Предыдущая неделя" и "Следующая неделя"
• Автоматическое отображение текущей недели

БЫСТРЫЕ ДЕЙСТВИЯ:
• Добавление слотов, выходных, больничных, отпуска
• Массовое управление (для администраторов)
• Фильтрация по участникам`,category:"interface"},{question:"Как работают аватары участников?",answer:`ЧТО ТАКОЕ АВАТАРЫ:
• Фотографии участников команды, отображаемые вместо букв
• Круглые изображения для визуальной идентификации
• Помогают быстро найти нужного участника

ГДЕ ОТОБРАЖАЮТСЯ:
• Раздел Management (таблица и неделя)
• Первая колонка в таблице
• Карточки участников в недельном виде
• Рейтинг участников

КАК ДОБАВИТЬ ФОТО:
1. Поместите фотографии в папку public/avatars/
2. Назовите файлы по имени участника:
   • artyom.jpg - для Артёма
   • adel.jpg - для Адели
   • kseniya.jpg - для Ксении
   • olga.jpg - для Ольги
   • anastasia.jpg - для Анастасии

ТРЕБОВАНИЯ К ФОТО:
• Формат: JPG, PNG или другой веб-формат
• Рекомендуемый размер: 200x200 пикселей или больше
• Изображение автоматически обрезается до круга
• Оптимальное соотношение сторон: 1:1 (квадрат)

FALLBACK:
• Если фотография не загружена или не найдена:
  - Отображается первая буква имени
  - Круглая иконка с градиентным фоном
  - Автоматическое переключение при ошибке загрузки

ПРОБЛЕМЫ:
• Проверьте путь к файлу (public/avatars/)
• Убедитесь, что имя файла совпадает с настройками
• Перезагрузите страницу после добавления фото`,category:"interface"},{question:"Как выбрать тему оформления?",answer:`ВЫБОР ТЕМЫ:

НА СТРАНИЦЕ ВХОДА:
1. Откройте сайт
2. На странице входа найдите кнопку переключения темы в правом верхнем углу
3. Нажмите на кнопку:
   • 🌙 (Луна) - включить темную тему
   • ☀️ (Солнце) - включить светлую тему
4. Тема сохранится и будет применяться ко всему сайту после входа

ПОСЛЕ ВХОДА:
• Кнопка переключения темы в правом верхнем углу навигации
• Тема переключается мгновенно
• Сохраняется в браузере между сессиями

ЧТО МЕНЯЕТСЯ:

СВЕТЛАЯ ТЕМА:
• Светлый фон страниц
• Темный текст
• Яркие цвета элементов
• Оптимизирована для работы днем

ТЕМНАЯ ТЕМА:
• Темный фон страниц
• Светлый текст
• Приглушенные цвета элементов
• Оптимизирована для работы вечером/ночью
• Меньше нагрузки на глаза

СОХРАНЕНИЕ:
• Тема сохраняется автоматически в браузере
• При следующем входе тема будет автоматически применена
• Можно изменить в любой момент`,category:"interface"},{question:"Как отличаются предстоящие и завершенные слоты?",answer:`ВИЗУАЛЬНОЕ РАЗДЕЛЕНИЕ:

ПРЕДСТОЯЩИЕ СЛОТЫ:
• Синий градиентный фон (от blue-500 до blue-600)
• Иконка календаря 📅
• Белый текст
• Отображаются для:
  - Будущих дат
  - Текущего дня, если время окончания еще не прошло

ЗАВЕРШЕННЫЕ СЛОТЫ:
• Серый градиентный фон (от gray-500 до gray-600)
• Иконка галочки ✓
• Белый текст
• Отображаются для:
  - Прошедших дат
  - Текущего дня, если время окончания уже прошло

ПЕРЕРЫВЫ:
• Белый фон в светлой теме
• Темно-серый фон (gray-700) в темной теме
• Рамка с оранжевым цветом
• Отображаются под основным слотом

ФИЛЬТРЫ:
• "Все" - показывает все слоты
• "Предстоящие" - только будущие и активные
• "Завершенные" - только прошедшие

ЗАЧЕМ ЭТО НУЖНО:
• Быстро увидеть, какие слоты еще предстоят
• Отличить актуальные слоты от прошлых
• Планировать дальнейшую работу
• Анализировать выполненную работу`,category:"slots"},{question:"Как добавить рабочий слот?",answer:`1. Перейдите в раздел Management
2. Нажмите "Добавить слот"
3. Заполните форму: дата, время начала/окончания, при необходимости перерывы и комментарий
4. Админ может выбрать участника и массово добавить слоты на несколько дат
5. Сохраните — слот появится в таблице и недельном представлении`,category:"slots"},{question:"Как работают перекрытия слотов?",answer:`Система разрешает перекрытие слотов при определенных условиях:

✅ РАЗРЕШЕНО:
- Если новый слот начинается после начала существующего. Например, если есть слот 19:00-21:00, можно создать слот 20:00-22:00
- Перекрытие может быть частичным или полным, если начало нового слота совпадает с началом или происходит после начала существующего

❌ ЗАПРЕЩЕНО:
- Если новый слот начинается до начала существующего и перекрывается с ним
- Максимум 3 участника могут иметь перекрывающиеся слоты одновременно

Примеры:
• Слот 19:00-21:00 и слот 20:00-22:00 ✅ РАЗРЕШЕНО
• Слот 19:00-21:00 и слот 18:00-20:00 ❌ ЗАПРЕЩЕНО
• Слот 19:00-21:00 и слот 21:30-23:00 ✅ РАЗРЕШЕНО`,category:"slots"},{question:"Как посмотреть расписание?",answer:`1. Перейдите в раздел Management — сразу открывается актуальная неделя
2. Переключайтесь стрелками по неделям
3. Включайте фильтр по участникам и видам статусов
4. Форматы отображения: таблица и недельные карточки
5. Цвета: 🟢 слоты, 🟡 выходные, 🟣 больничные, 🟠 отпуск`,category:"slots"},{question:"Как добавить выходной?",answer:`1. Перейдите в Management и нажмите "Добавить выходной"
2. Выберите дату (для админа — и участника)
3. Добавьте комментарий при необходимости
4. Сохраните

Ограничения: максимум 2 выходных в неделю, не более 3 человек на одну дату, нельзя ставить выходной на сегодня.`,category:"status"},{question:"Как добавить больничный?",answer:`1. В Management нажмите "Добавить больничный"
2. Выберите дату начала и при необходимости дату окончания
3. Добавьте комментарий и сохраните

Ограничения: обычные пользователи могут выбрать сегодня + 2 дня вперед, админ — любые даты, максимум 14 дней в месяц.`,category:"status"},{question:"Как добавить отпуск?",answer:`1. В Management нажмите "Добавить отпуск"
2. Укажите дату начала и окончания
3. Добавьте комментарий и сохраните

Ограничения: до 14 дней в месяц и не более 6 отпусков в год. Отпуск создается на весь диапазон.`,category:"status"},{question:"Как работает система рейтинга?",answer:`Рейтинг в процентах (до 100%) считается каждую неделю по 7 параметрам:

1. ВЫХОДНЫЕ (10%)
   • 0-2 выходных в неделю = 10%
   • Более 2 выходных = 0%

2. БОЛЬНИЧНЫЕ (10%)
   • До 7 дней за месяц = 10%
   • Более 7 дней = 0%

3. ОТПУСК (10%)
   • До 7 дней за месяц = 10%
   • Более 7 дней = 0%

4. ЧАСЫ РАБОТЫ (до 25%)
   • 30+ часов в неделю = 25%
   • 20-29 часов = 15%
   • Менее 20 часов = 0%

5. ЗАРАБОТОК (до 30%)
   • 6000+ ₽ в неделю = 30%
   • 3000-5999 ₽ = 15%
   • Менее 3000 ₽ = 0%

6. РЕФЕРАЛЫ (до 30%)
   • 5% за каждого реферала, максимум 30%

7. СООБЩЕНИЯ (15%)
   • 50+ сообщений в неделю = 15%

Смотреть и разбирать рейтинг можно в разделе "Rating" на сайте: общий процент и детализация по параметрам.`,category:"rating"},{question:"Какие есть ограничения и правила?",answer:`ОСНОВНЫЕ ОГРАНИЧЕНИЯ:

📅 ВЫХОДНЫЕ:
• Максимум 2 выходных в неделю
• Не более 3 человек одновременно на одну дату
• Нельзя установить выходной на сегодня

🏥 БОЛЬНИЧНЫЕ:
• Обычные пользователи: только сегодня + 2 дня вперед
• Максимум 14 дней в месяц
• Администраторы могут добавлять на любые даты

🏖️ ОТПУСК:
• Максимум 14 дней в месяц
• Не более 6 отпусков в год

⏰ СЛОТЫ:
• Можно перекрывать, если новый слот начинается после начала существующего
• Максимум 3 участника на перекрывающиеся слоты

💰 ЗАРАБОТОК:
• Обычные пользователи: только за сегодня
• Администраторы: за любую дату

📊 РЕЙТИНГ:
• Минимум 20 часов в неделю для получения баллов
• Минимум 50 сообщений в неделю для получения баллов
• Минимум 3000₽ в неделю для получения баллов

📖 ПОЛНЫЕ ПРАВИЛА:
Ознакомьтесь с регламентом торговых сессий по ссылке, которая отправляется после авторизации.`,category:"rating"},{question:"Как добавить заработок?",answer:`1. Перейдите в раздел Earnings
2. Нажмите "Добавить заработок"
3. Выберите дату (или введите "сегодня"), сумму заработка и пула
4. При необходимости выберите участников для распределения
5. Сохраните — запись попадет в статистику дня и недели

Обычные пользователи создают записи за сегодня, админ — за любую дату.`,category:"earnings"},{question:"Как добавить в пул команды?",answer:`1. В разделе Earnings нажмите "Добавить в пул"
2. Выберите завершенный слот из списка
3. Укажите сумму пула и сохраните

Добавлять можно только по завершенным слотам. Пул попадает в статистику дня и недели.`,category:"earnings"},{question:"Как работает режим администратора?",answer:`АКТИВАЦИЯ НА САЙТЕ:
1. На странице входа выберите тип пользователя "Админ"
2. Введите пароль администратора — режим включится автоматически

ВОЗМОЖНОСТИ АДМИНА:
• Слоты и статусы: создавать, редактировать, удалять, массово управлять
• Заработок и пул: добавлять за любую дату, редактировать, удалять
• Сигналы: редактировать/удалять любые записи, видеть полную аналитику
• Сообщения: очищать счетчик в разделе Admin (для корректной статистики)

ДЕАКТИВАЦИЯ:
• Кнопка выхода в правом верхнем углу
• Для обычного режима войдите как "Участник"

БЕЗОПАСНОСТЬ:
• Храните пароль админа в секрете — он дает полный доступ к данным`,category:"admin"},{question:"Как редактировать и удалять торговые сигналы?",answer:`РЕДАКТИРОВАНИЕ:

НА САЙТЕ:
1. Перейдите в раздел "Call"
2. Найдите нужный сигнал в списке
3. Нажмите кнопку редактирования (иконка карандаша)
4. Внесите изменения в форме
5. Нажмите "Сохранить"

УДАЛЕНИЕ:

НА САЙТЕ:
1. Перейдите в раздел "Call"
2. Найдите нужный сигнал
3. Нажмите кнопку удаления (иконка корзины)
4. Подтвердите удаление

ПРАВА ДОСТУПА:
• Обычные пользователи могут редактировать/удалять только свои сигналы
• Администраторы могут редактировать/удалять любые сигналы
• При попытке редактировать чужой сигнал кнопки будут неактивны

ЧТО МОЖНО ИЗМЕНИТЬ:
• Все параметры сигнала:
  - Сеть
  - Тикер токена
  - Пару
  - Точку входа
  - Цель
  - Стратегию
  - Риски
  - Условия отмены
  - Комментарий
  - Статус (Активен/Завершен/Отменен)

ВАЖНО:
• После редактирования изменения сохраняются сразу
• Статус сигнала влияет на отображение в списках
• Завершенные и отмененные сигналы не показываются в "активных"`,category:"calls"},{question:"Как работает аналитика в разделе Call?",answer:`ОБЩАЯ СТАТИСТИКА КОМАНДЫ:
• Общее количество сигналов
• Активные / Завершенные / Отмененные
• Средний PNL и лучший сигнал по прибыли

СТАТИСТИКА ПО ТРЕЙДЕРАМ:
• Количество сигналов каждого трейдера
• Разбивка по статусам
• Средний и суммарный PNL
• MAX прибыль по сигналу

ОТОБРАЖЕНИЕ:
• Обновляется автоматически при любых изменениях сигнала
• Доступно только участникам команды
• Данные PNL и капитализации тянутся из аналитики

ЗАЧЕМ:
• Видеть динамику, сравнивать стратегии и контролировать качество сигналов`,category:"calls"},{question:"Как работает подсчет сообщений?",answer:`Система автоматически считает сообщения в группе:

✅ УЧИТЫВАЮТСЯ:
• Все типы сообщений авторизованных пользователей за неделю

❌ НЕ УЧИТЫВАЮТСЯ:
• Команды и сообщения неавторизованных пользователей
• Личные чаты

Важно:
• Для рейтинга нужно >50 сообщений в неделю (15%)
• Если сообщение нужно исключить, это делает администратор через раздел Admin — счетчик обновится автоматически

Проверка количества сообщений: в разделе "Rating" на сайте в личной карточке.`,category:"messages"},{question:"Что делать, если сообщение удалено из группы?",answer:`Если сообщение удалили, его все еще нужно убрать из статистики:

1. Администратор открывает раздел Admin
2. Находит запись сообщения в списке и удаляет ее из подсчета
3. Счетчик в рейтинге обновляется автоматически

Только администраторы могут чистить сообщения из статистики.`,category:"messages"},{question:"Как работают рефералы?",answer:`Рефералы добавляют до 30% к рейтингу.

Как добавить:
1. Перейдите в раздел Rating
2. Нажмите "Добавить реферала"
3. Заполните имя, контакт и комментарий (при необходимости)

Начисление:
• 5% за каждого реферала, максимум 6 (30%)
• Учитываются последние 30 дней

Управление:
• В разделе Rating можно редактировать и удалять рефералов в один клик`,category:"referrals"},{question:"Как редактировать и удалять записи?",answer:`На сайте:
• В разделах Management, Earnings, Call и Rating на карточках есть кнопки редактирования и удаления
• В сигналах добавлена кнопка "Отменить" — меняет статус без удаления записи
• Массовое удаление слотов и статусов доступно админу в Management

Что можно править:
• Слоты: время, перерывы, комментарии, участники
• Статусы: даты и комментарии
• Заработок: дата, суммы, участники, пул
• Сигналы: все параметры и статус
• Рефералы: имя, контакт, комментарий

Права доступа: обычные пользователи управляют своими данными, администратор — всеми.`,category:"edit"},{question:"Как использовать фильтры и поиск на сайте?",answer:`ФИЛЬТРЫ В РАЗДЕЛЕ MANAGEMENT:

ФИЛЬТР СЛОТОВ:
• "Все" - показывает все слоты независимо от статуса
• "Предстоящие" - только будущие и активные слоты
• "Завершенные" - только прошедшие слоты

ФИЛЬТР ПО УЧАСТНИКАМ:
• Выберите конкретного участника из списка
• "Все участники команды" - показывает всех
• Применяется к обоим представлениям (таблица и неделя)

ПРЕДСТАВЛЕНИЯ:
• "Таблица" - компактный вид с участниками в строках
• "Неделя" - детальный вид по дням недели
• Переключение кнопками в верхней части страницы

ПОИСК В РАЗДЕЛЕ CALL:
• Поле поиска в верхней части страницы
• Поиск по:
  - Тикеру токена (например: PEPE)
  - Паре токена (например: PEPE/USDT)
  - Сети (например: Solana)
• Поиск работает в реальном времени
• Автоматически фильтрует список сигналов

КАК ИСПОЛЬЗОВАТЬ:
1. Выберите нужный фильтр
2. Результаты обновятся автоматически
3. Несколько фильтров можно применять одновременно
4. Для сброса выберите "Все" или очистите поле поиска`,category:"interface"},{question:"Как работает статистика на сайте?",answer:`РАЗДЕЛ MANAGEMENT:

СТАТИСТИКА СЛОТОВ:
• Общее количество слотов за неделю
• Количество предстоящих слотов (синий индикатор)
• Количество завершенных слотов (серый индикатор)
• Количество активных участников за неделю

СТАТИСТИКА ПО УЧАСТНИКУ:
• Количество слотов участника
• Общее количество часов работы
• Отображается в последней колонке таблицы

РАЗДЕЛ EARNINGS:

СТАТИСТИКА ЗАРАБОТКА:
• Заработок за неделю
• Пул команды за неделю
• Заработок за месяц
• Пул команды за месяц

РАЗДЕЛ RATING:

РЕЙТИНГ УЧАСТНИКОВ:
• Процент эффективности каждого участника
• Детальный разбор по параметрам:
  - Выходные (10%)
  - Больничные (10%)
  - Отпуск (10%)
  - Часы работы (до 25%)
  - Заработок (до 30%)
  - Рефералы (до 30%)
  - Сообщения (15%)

СРЕДНИЙ РЕЙТИНГ КОМАНДЫ:
• Общий процент эффективности команды
• Визуальный индикатор с цветовыми зонами:
  - Зеленая: 70%+
  - Желтая: 50-70%
  - Синяя: менее 50%

РАЗДЕЛ CALL:

СТАТИСТИКА СИГНАЛОВ:
• Общее количество сигналов
• Активные/завершенные/отмененные
• Средний PNL команды
• Лучший сигнал по прибыли
• Статистика по каждому трейдеру

ОБНОВЛЕНИЕ:
• Статистика обновляется автоматически
• При изменении данных статистика пересчитывается
• Данные загружаются из базы данных в реальном времени`,category:"interface"},{question:"Как работает навигация на сайте?",answer:`СТРУКТУРА МЕНЮ:

НА ПК (верхнее меню):
• Call - управление торговыми сигналами
• Функционал - выпадающее меню с подразделами:
  - Расписание (Management)
  - Заработок (Earnings)
  - Задачи (Tasks)
  - Рейтинг (Rating)
• О сообществе - информация о команде
• FAQ - часто задаваемые вопросы
• ЛК - личный кабинет
• Админ - только для администраторов

НА МОБИЛЬНЫХ (нижнее меню):
• Фиксированное меню внизу экрана для удобной навигации
• Те же разделы, что и на ПК
• Подменю "Функционал" открывается вверх от кнопки
• Иконки и подписи для быстрого доступа

ОСНОВНЫЕ РАЗДЕЛЫ:

CALL:
• Управление торговыми сигналами
• Создание, редактирование, удаление сигналов
• Аналитика по сигналам и трейдерам
• Поиск и фильтрация сигналов

ФУНКЦИОНАЛ:

Расписание (Management):
• Управление рабочими слотами
• Установка выходных, больничных, отпуска
• Просмотр расписания команды
• Два представления: таблица и неделя
• Фильтры по статусу и участникам

Заработок (Earnings):
• Добавление заработка
• Добавление в пул команды
• Статистика заработка (неделя/месяц)
• Просмотр истории заработка

Задачи (Tasks):
• Управление задачами и заданиями команды
• Kanban доска с drag & drop
• Список задач
• Система согласования задач
• Фильтрация по категориям, статусам и участникам
• Уведомления о новых задачах и изменениях

Рейтинг (Rating):
• Рейтинг всех участников
• Детальный разбор по параметрам
• Средний рейтинг команды
• Управление рефералами

О СООБЩЕСТВЕ:
• Информация о команде ApeVault
• Возможности и принципы работы
• Ссылка на правила сообщества
• Контактная информация

FAQ:
• Ответы на частые вопросы
• Инструкции по работе с системой
• Категории для удобной навигации

ЛК (ЛИЧНЫЙ КАБИНЕТ):
• Личные данные: имя, логин, пароль
• Рейтинг и эффективность
• Статистика задач
• Уведомления
• Выход из аккаунта

АДМИН (только для администраторов):
• Информация о режиме администратора
• Список возможностей
• Доступен только при активном режиме админа`,category:"interface"},{question:"Что такое личный кабинет (ЛК)?",answer:`ЛИЧНЫЙ КАБИНЕТ - это раздел с вашими персональными данными и статистикой:

ЛИЧНЫЕ ДАННЫЕ:
• Имя - ваше имя в системе
• Логин - ваш логин для входа
• Пароль - ваш пароль (с возможностью показать/скрыть и копировать)

РЕЙТИНГ:
• Процент эффективности (максимум 100%)
• Детальный разбор по параметрам:
  - Выходные (10%)
  - Больничные (10%)
  - Отпуск (10%)
  - Часы работы (до 25%)
  - Заработок (до 30%)
  - Рефералы (до 30%)
  - Сообщения (15%)
• Цветовая индикация:
  - Зеленая: 70%+
  - Желтая: 50-70%
  - Синяя: менее 50%

МОИ ЗАДАЧИ:
• Статистика по статусам:
  - На согласовании
  - В работе
  - Выполнена
  - Всего задач
• Кнопка перехода к задачам

УВЕДОМЛЕНИЯ:
• Количество непрочитанных уведомлений
• Общее количество уведомлений
• Кнопка перехода к уведомлениям

ВЫХОД ИЗ АККАУНТА:
• Кнопка "Выйти из аккаунта" внизу страницы
• При выходе:
  - Деактивируется режим администратора (если был активен)
  - Выполняется выход из системы
  - Перенаправление на страницу входа

КАК ОТКРЫТЬ:
• Нажмите "ЛК" в меню навигации
• Или перейдите по адресу /profile

ВАЖНО:
• Все данные обновляются автоматически
• Рейтинг рассчитывается на основе последних данных
• Задачи и уведомления загружаются в реальном времени`,category:"interface"},{question:"Как работает раздел Tasks (Задачи)?",answer:`РАЗДЕЛ ЗАДАЧ - это система управления заданиями для команды:

ОСНОВНЫЕ ВОЗМОЖНОСТИ:

СОЗДАНИЕ ЗАДАЧ:
1. Нажмите кнопку "Новая задача"
2. Заполните форму:
   • Название задачи (обязательно)
   • Описание (необязательно)
   • Категория: торговля, обучение, техническая часть, стрим, изучение нового, поиск и систематизация информации
   • Приоритет: низкий, средний, высокий
   • Срок выполнения (необязательно)
   • Участники (выберите одного или нескольких)
3. Нажмите "Создать задачу"

СТАТУСЫ ЗАДАЧ:

1. НА СОГЛАСОВАНИИ:
   • Все новые задачи начинаются с этого статуса
   • Все назначенные участники должны согласовать задачу
   • Участники могут одобрить или отклонить с комментарием
   • После согласования всеми участниками задача автоматически переходит в "В работе"

2. В РАБОТЕ:
   • Задача выполняется участниками
   • Можно переместить в "Выполнена" когда работа завершена

3. ВЫПОЛНЕНА:
   • Задача завершена
   • Если в задаче несколько участников, они получают уведомление для подтверждения
   • Создатель задачи может закрыть задачу

4. ЗАКРЫТА:
   • Задача окончательно закрыта
   • Не участвует в активной работе

ФИЛЬТРЫ:
• По категориям: торговля, обучение, техническая часть, стрим, изучение нового, поиск и систематизация информации
• По статусам: на согласовании, в работе, выполнена, закрыта
• По участникам: фильтр по конкретному участнику или все

УВЕДОМЛЕНИЯ:
• При создании задачи все назначенные участники получают уведомление
• При изменении статуса задачи (если несколько участников) отправляются уведомления
• При завершении задачи участники получают запрос на подтверждение
• Индикатор непрочитанных уведомлений на карточке задачи
• Кнопка "Отметить все прочитанными" для быстрой очистки

СТАТИСТИКА:
• Количество задач по каждому статусу
• Общее количество задач
• Быстрый обзор активности команды

УПРАВЛЕНИЕ:
• Редактирование задач (только создатель или администратор)
• Удаление задач (только создатель или администратор)
• Изменение статуса задач
• Согласование/отклонение задач`,category:"tasks"},{question:"Как создать задачу и назначить участников?",answer:`СОЗДАНИЕ ЗАДАЧИ:

1. Перейдите в раздел "Задачи"
2. Нажмите кнопку "Новая задача"
3. Заполните форму:

ОБЯЗАТЕЛЬНЫЕ ПОЛЯ:
• Название задачи - краткое описание задания
• Участники - выберите одного или нескольких участников команды

НЕОБЯЗАТЕЛЬНЫЕ ПОЛЯ:
• Описание - детальное описание задачи
• Категория - выберите из списка:
  📈 Торговля
  📚 Обучение
  ⚙️ Техническая часть
  📺 Стрим
  🔬 Изучение нового
  📋 Поиск и систематизация информации
• Приоритет - низкий, средний или высокий
• Срок выполнения - выберите дату (необязательно)

ВЫБОР УЧАСТНИКОВ:
• Нажмите на карточку участника для выбора
• Можно выбрать нескольких участников
• Кнопка "Выбрать всех" для массового выбора
• Кнопка "Снять выделение" для сброса

СОЗДАНИЕ:
• После заполнения нажмите "Создать задачу"
• Задача будет создана со статусом "На согласовании"
• Все назначенные участники получат уведомление

ВАЖНО:
• Задача должна иметь хотя бы одного участника
• После создания задачи все участники должны согласовать ее
• Только после согласования всеми участниками задача перейдет в "В работе"`,category:"tasks"},{question:"Как работает система согласования задач?",answer:`СОГЛАСОВАНИЕ ЗАДАЧ:

КОГДА НУЖНО СОГЛАСОВАТЬ:
• Все новые задачи начинаются со статуса "На согласовании"
• Все назначенные участники должны согласовать задачу
• Пока не все согласовали, задача остается в статусе "На согласовании"

КАК СОГЛАСОВАТЬ:
1. Найдите задачу со статусом "На согласовании"
2. Если вы назначены участником, увидите кнопки "Согласовать" и "Отклонить"
3. Нажмите "Согласовать"
4. При необходимости добавьте комментарий
5. Нажмите "Согласовать" в диалоге

КАК ОТКЛОНИТЬ:
1. Нажмите кнопку "Отклонить"
2. Обязательно укажите причину отклонения в комментарии
3. Нажмите "Отклонить"

ЧТО ПРОИСХОДИТ ПОСЛЕ СОГЛАСОВАНИЯ:
• Ваше согласование сохраняется
• Отображается количество согласований (например: "Согласований: 2/3")
• Когда все участники согласуют, задача автоматически переходит в статус "В работе"
• Кнопка "В работу" появляется только после согласования всеми

ПРОСМОТР СТАТУСА:
• На карточке задачи отображается количество согласований
• Видно, кто уже согласовал, а кто еще нет
• Если вы еще не согласовали, кнопки будут активны

ВАЖНО:
• Комментарий при отклонении обязателен
• После согласования всеми участниками задача автоматически переходит в работу
• Если хотя бы один участник отклонил, задача остается на согласовании`,category:"tasks"},{question:"Как работают уведомления в задачах?",answer:`СИСТЕМА УВЕДОМЛЕНИЙ:

КОГДА ПОЯВЛЯЮТСЯ УВЕДОМЛЕНИЯ:

1. ПРИ СОЗДАНИИ ЗАДАЧИ:
   • Все назначенные участники получают уведомление
   • Текст: "Новая задача [название] добавлена. Просмотрите и согласуйте."
   • Появляется индикатор на карточке задачи

2. ПРИ ИЗМЕНЕНИИ СТАТУСА:
   • Если в задаче несколько участников, все остальные получают уведомление
   • При перемещении в "В работе": "Задача [название] перемещена в работу пользователем [имя]"
   • При перемещении в "Закрыта": "Задача [название] закрыта пользователем [имя]"

3. ПРИ ЗАВЕРШЕНИИ ЗАДАЧИ:
   • Если в задаче несколько участников, они получают уведомление
   • Текст: "Задача [название] выполнена. Подтвердите выполнение."
   • Участники могут подтвердить выполнение

ИНДИКАТОРЫ:
• Значок колокольчика на карточке задачи
• Красный бейдж с количеством непрочитанных уведомлений
• Отображается только если есть непрочитанные уведомления

УПРАВЛЕНИЕ УВЕДОМЛЕНИЯМИ:
• Кнопка "Отметить все прочитанными" в верхней части страницы
• Показывает количество непрочитанных уведомлений
• После нажатия все уведомления помечаются как прочитанные

ВАЖНО:
• Уведомления появляются только для задач с несколькими участниками
• Если в задаче один участник, уведомления не создаются
• Уведомления помогают отслеживать изменения в задачах`,category:"tasks"},{question:"Как фильтровать задачи?",answer:`ФИЛЬТРАЦИЯ ЗАДАЧ:

ФИЛЬТР ПО КАТЕГОРИЯМ:
• Все - показывает задачи всех категорий
• Торговля 📈
• Обучение 📚
• Техническая часть ⚙️
• Стрим 📺
• Изучение нового 🔬
• Поиск и систематизация информации 📋

ФИЛЬТР ПО СТАТУСАМ:
• Все - показывает задачи всех статусов
• На согласовании - задачи, ожидающие согласования
• В работе - активные задачи
• Выполнена - завершенные задачи
• Закрыта - окончательно закрытые задачи

ФИЛЬТР ПО УЧАСТНИКАМ:
• Все - показывает задачи всех участников
• Конкретный участник - фильтрует задачи, где участник назначен

КАК ИСПОЛЬЗОВАТЬ:
1. В левой части страницы находится панель фильтров
2. Выберите нужные фильтры
3. Список задач автоматически обновится
4. Можно применять несколько фильтров одновременно
5. Кнопка "Сбросить" для очистки всех фильтров

СТАТИСТИКА:
• В верхней части страницы отображается статистика по статусам
• Показывает количество задач в каждом статусе
• Обновляется автоматически при изменении фильтров`,category:"tasks"}];cl=[{question:"Как начать работу с системой?",answer:"1) Войдите на сайт (роль: участник или админ). 2) Настройте тему — сохраняется. 3) Откройте HUB, Расписание, Заработок, Задачи, Рейтинг. 4) FAQ и регламент — в шапке.",category:"auth"},{question:"Как авторизоваться и выйти?",answer:"Участник: логин + пароль. Админ: только пароль админа. Тема применяется ко всем разделам. Выход — кнопка в правом верхнем углу.",category:"auth"},{question:"Режим администратора",answer:"Вход как “Админ” на странице логина. Возможности: слоты/статусы (вкл. массово), заработок и пул за любую дату, сигналы (редактировать/отменять/удалять), чистка сообщений, полная аналитика. Выход — кнопка выхода.",category:"admin"},{question:"Где искать нужный раздел?",answer:"HUB — сигналы и аналитика. Расписание — слоты и статусы (таблица/неделя). Заработок — доходы и пул. Задачи — канбан и согласование. Рейтинг — эффективность, рефералы, сообщения. FAQ и О сообществе — справка. ЛК — личные данные и метрики. Админ — только для админа.",category:"interface"},{question:"Как добавить сигнал в HUB?",answer:"1) В HUB нажмите “Добавить” у категории. 2) Заполните: сеть/пара, вход, цели, SL, риск, комментарий, статус. 3) Сохраните — сигнал появится в списке и аналитике.",category:"calls"},{question:"Как просматривать и управлять сигналами?",answer:"Фильтры: статус, категория, риск, трейдер. Поиск по тикеру/паре/сети/комментарию. Карточка: копировать тикер, редактировать, отменить (статус “Отменен”), удалить.",category:"calls"},{question:"Какие поля есть у сигнала?",answer:"Общие: категория, сеть/пара, вход, цели, SL, риск, комментарий, статус, PNL/макс. прибыль. Доп. поля зависят от категории (мемы, фьючерсы, NFT, спот, Polymarket, стейкинг).",category:"calls"},{question:"Аналитика HUB",answer:"Команда: количество сигналов, активные/завершенные/отмененные, средний PNL, лучший сигнал. По трейдерам: счетчик сигналов, разбивка по статусам, средний/суммарный PNL, MAX прибыль. Обновляется автоматически.",category:"calls"},{question:"Как работать с расписанием?",answer:"Раздел “Расписание”: виды таблица/неделя, фильтры по участникам и статусам. Добавление слотов, выходных, больничных, отпусков. Админ ставит массово на несколько дат и участников.",category:"slots"},{question:"Выходной, больничный, отпуск",answer:"В “Расписании” выберите тип: выходной (до 2/нед, не более 3 человек в день), больничный (обычные: сегодня+2, админ: любые даты, до 14 дней/мес), отпуск (до 14 дней/мес, до 6 раз/год).",category:"status"},{question:"Как добавить заработок и пул?",answer:"“Заработок”: “Добавить заработок” — дата, сумма, пул, участники. Пул: “Добавить в пул” для завершенного слота. Обычные — только за сегодня, админ — за любую дату.",category:"earnings"},{question:"Как считается рейтинг?",answer:"Рейтинг (до 100%) раз в неделю: выходные, больничные, отпуск, часы, заработок, рефералы, сообщения. Детализация и цветовые зоны — в “Рейтинг”.",category:"rating"},{question:"Рефералы",answer:"В “Рейтинг” → “Добавить реферала”: имя, контакт, комментарий. Начисление: 5% за каждого, максимум 30% (6 шт.), учитываются 30 дней. Там же редактирование и удаление.",category:"referrals"},{question:"Сообщения и статистика",answer:"Сообщения считаются автоматически. Для рейтинга нужно >50 за неделю. Если запись нужно убрать — админ чистит в “Админ”, счетчик обновится.",category:"messages"},{question:"Задачи и согласование",answer:"Раздел “Задачи”: канбан + список. Создание с участниками, категориями и сроками. Статусы: на согласовании → в работе → выполнена → закрыта. Уведомления для задач с несколькими участниками. Фильтры по статусу, категории и участникам.",category:"tasks"},{question:"Фильтры и поиск",answer:"HUB: статус, категория, риск, трейдер + поиск. Расписание: участники, статусы, виды (таблица/неделя). Задачи: статус, категория, участники. Рейтинг: список участников и детализация. Поиск в реальном времени.",category:"interface"},{question:"Тема и персонализация",answer:"Переключатель темы в шапке и на логине: светлая/темная. Сохраняется между сессиями и применяется ко всем разделам.",category:"interface"}];const Jk=()=>{const{theme:r}=ct(),[e,t]=A.useState("all"),[n,a]=A.useState({}),i=r==="dark"?"text-white":"text-gray-900",l=r==="dark"?"text-gray-400":"text-gray-600",c=r==="dark"?"text-gray-300":"text-gray-700",d=r==="dark"?"bg-[#1a1a1a]":"bg-white",h=r==="dark"?"border-gray-800":"border-gray-200",g=e==="all"?cl:cl.filter(k=>k.category===e),x=Ka.find(k=>k.id===e),p=g.reduce((k,L)=>(k[L.category]=k[L.category]?[...k[L.category],L]:[L],k),{}),E=e==="all"?Ka.filter(k=>k.id!=="all"):Ka.filter(k=>k.id===e),j=k=>{const L=k.split(`
`);return s.jsx("div",{className:"space-y-2",children:L.map((M,T)=>s.jsx("p",{className:`text-sm leading-relaxed ${c}`,children:M.trim()===""?" ":M},T))})},S=k=>{a(L=>({...L,[k]:!L[k]}))};return A.useEffect(()=>{a({})},[e]),s.jsx(ir,{children:s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"section-card rounded-2xl p-5 sm:p-6 md:p-7 border border-white/60 dark:border-white/10 shadow-xl relative overflow-hidden mb-4 sm:mb-6",children:[s.jsx("div",{className:"absolute top-0 right-0 w-32 h-32 sm:w-64 sm:h-64 bg-gradient-to-br from-blue-500/10 to-purple-500/10 rounded-full blur-3xl -mr-16 sm:-mr-32 -mt-16 sm:-mt-32"}),s.jsx("div",{className:"absolute bottom-0 left-0 w-24 h-24 sm:w-48 sm:h-48 bg-gradient-to-tr from-[#4E6E49]/10 to-yellow-500/10 rounded-full blur-2xl -ml-12 sm:-ml-24 -mb-12 sm:-mb-24"}),s.jsxs("div",{className:"relative z-10 text-center space-y-3 sm:space-y-4",children:[s.jsx("div",{className:"flex flex-col items-center justify-center gap-3 sm:gap-4",children:s.jsx("h1",{className:`text-2xl sm:text-3xl md:text-4xl font-extrabold ${i} flex flex-wrap items-center justify-center gap-2 sm:gap-3`,children:s.jsx("span",{className:"bg-gradient-to-r from-blue-600 via-purple-600 to-pink-600 text-transparent bg-clip-text",children:"FAQ ApeVault Black Ops"})})}),s.jsx("p",{className:`text-sm sm:text-base font-medium ${l}`,children:"Найдите ответы на популярные вопросы о работе системы"})]})]}),s.jsxs("div",{className:"section-card rounded-2xl p-5 sm:p-6 border border-white/60 dark:border-white/10 shadow-lg",children:[s.jsxs("div",{className:"flex items-start sm:items-center justify-between gap-3 flex-wrap mb-4",children:[s.jsxs("div",{children:[s.jsx("h2",{className:`text-xl sm:text-2xl font-bold ${i}`,children:"Этапы работы в ApeVault"}),s.jsx("p",{className:`text-sm ${l}`,children:"Короткий маршрут от входа до уверенной работы, оформленный в карточках"})]}),s.jsxs("div",{className:`inline-flex items-center gap-2 px-3 py-2 rounded-xl text-xs font-semibold ${r==="dark"?"bg-white/5 text-gray-200 border border-white/10":"bg-blue-50 text-blue-700 border border-blue-100"}`,children:[s.jsx(zt,{className:"w-4 h-4"}),s.jsx("span",{children:"Практические шаги"})]})]}),s.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-5",children:Xk.map((k,L)=>s.jsxs("div",{className:`relative overflow-hidden rounded-2xl border ${r==="dark"?"bg-[#0f1115] border-white/10 shadow-[0_12px_40px_-24px_rgba(0,0,0,0.8)]":"bg-white border-gray-100 shadow-[0_12px_32px_-20px_rgba(15,23,42,0.25)]"}`,children:[s.jsx("div",{className:`absolute inset-0 bg-gradient-to-br ${r==="dark"?k.darkGradient:k.lightGradient}`}),s.jsxs("div",{className:"relative z-10 flex flex-col gap-3 p-5",children:[s.jsx("div",{className:"flex items-center justify-between gap-3",children:s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("span",{className:`w-10 h-10 rounded-full flex items-center justify-center text-sm font-bold ${r==="dark"?"bg-white/10 text-white border border-white/10":"bg-white/90 text-gray-900 border border-white shadow-sm"}`,children:String(L+1).padStart(2,"0")}),s.jsxs("div",{className:"flex items-center gap-2 text-xs sm:text-sm font-semibold",children:[k.icon,s.jsx("span",{className:i,children:k.title})]})]})}),s.jsx("p",{className:`text-sm leading-relaxed ${c}`,children:k.description}),k.tags&&k.tags.length>0&&s.jsx("div",{className:"flex flex-wrap gap-2",children:k.tags.map(M=>s.jsx("span",{className:`text-[11px] px-3 py-1 rounded-full font-semibold ${r==="dark"?"bg-white/10 text-white/90 border border-white/10":"bg-white/80 text-gray-800 border border-gray-100 shadow-sm"}`,children:M},M))})]})]},k.title))})]}),s.jsx("div",{className:"mb-6 section-card rounded-2xl p-4 sm:p-5 border border-white/60 dark:border-white/10 shadow",children:s.jsx("div",{className:"flex flex-wrap gap-2 justify-center",children:Ka.map(k=>s.jsxs("button",{onClick:()=>{t(k.id)},className:`flex items-center gap-2 px-4 py-2 rounded-xl font-medium transition-all duration-200 ${e===k.id?r==="dark"?"bg-blue-600 text-white shadow-lg shadow-blue-500/50 scale-105":"bg-blue-600 text-white shadow-lg scale-105":r==="dark"?"bg-[#1a1a1a] text-gray-300 border border-gray-800 hover:bg-gray-700 hover:border-gray-800":"bg-white text-gray-700 border border-gray-300 hover:bg-gray-50 hover:border-gray-400"}`,children:[s.jsx("span",{className:e===k.id?"text-white":r==="dark"?k.darkColor:k.color,children:k.icon}),s.jsx("span",{children:k.name})]},k.id))})}),x&&e!=="all"&&s.jsx("div",{className:`${d} rounded-xl p-4 border-2 ${r==="dark"?"border-blue-500/30 bg-blue-500/5":"border-blue-200 bg-blue-50"} mb-6`,children:s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("span",{className:r==="dark"?x.darkColor:x.color,children:x.icon}),s.jsxs("div",{children:[s.jsx("h3",{className:`font-bold text-lg ${r==="dark"?x.darkColor:x.color}`,children:x.name}),s.jsxs("p",{className:`text-sm ${c}`,children:[g.length," ",g.length===1?"вопрос":g.length<5?"вопроса":"вопросов"]})]})]})}),s.jsxs("div",{className:"space-y-4",children:[E.map(k=>{const L=p[k.id]||[];if(L.length===0)return null;const M=r==="dark"?k.darkColor:k.color;return s.jsxs("div",{className:`rounded-2xl border overflow-hidden ${r==="dark"?"bg-[#0f1115] border-white/10 shadow-[0_12px_40px_-24px_rgba(0,0,0,0.8)]":"bg-white border-gray-100 shadow-[0_12px_32px_-20px_rgba(15,23,42,0.25)]"}`,children:[s.jsxs("div",{className:`flex items-center justify-between gap-3 px-4 sm:px-5 py-4 border-b ${r==="dark"?"border-white/10":"border-gray-100"}`,children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("span",{className:M,children:k.icon}),s.jsxs("div",{children:[s.jsx("p",{className:`text-sm font-semibold ${i}`,children:k.name}),s.jsxs("p",{className:`text-xs ${l}`,children:[L.length," ",L.length===1?"вопрос":L.length<5?"вопроса":"вопросов"]})]})]}),s.jsx("span",{className:`text-[11px] px-2 py-1 rounded-lg font-semibold border ${r==="dark"?"border-white/10 bg-white/5 text-white":"border-gray-200 bg-gray-50 text-gray-700"}`,children:"Нажмите, чтобы раскрыть"})]}),s.jsx("div",{className:`divide-y ${r==="dark"?"divide-white/10":"divide-gray-100"}`,children:L.map(T=>{const O=`${k.id}-${T.question}`,ne=!!n[O];return s.jsxs("div",{className:"px-4 sm:px-5 py-3",children:[s.jsxs("button",{type:"button",onClick:()=>S(O),className:"w-full flex items-start justify-between gap-3 text-left","aria-expanded":ne,children:[s.jsx("span",{className:`font-semibold ${i}`,children:T.question}),s.jsx(Dn,{className:`w-4 h-4 shrink-0 transition-transform ${r==="dark"?"text-gray-300":"text-gray-500"} ${ne?"rotate-180":""}`})]}),ne&&s.jsx("div",{className:`mt-3 rounded-xl border px-4 py-3 text-sm leading-relaxed ${r==="dark"?"bg-white/5 text-gray-200 border-white/10":"bg-blue-50/80 text-gray-800 border-blue-100"}`,children:j(T.answer)})]},O)})})]},k.id)}),E.every(k=>(p[k.id]||[]).length===0)&&s.jsx("div",{className:`${d} rounded-xl p-8 text-center border ${h}`,children:s.jsx("p",{className:c,children:"В этой категории пока нет вопросов"})})]}),s.jsxs("div",{className:`${d} rounded-lg shadow-lg p-6 border ${h}`,children:[s.jsx("h2",{className:`text-xl font-semibold mb-4 ${i}`,children:"Нужна дополнительная помощь?"}),s.jsx("p",{className:`${c} mb-4`,children:"Если вы не нашли ответ на свой вопрос, обратитесь к администратору или ознакомьтесь с правилами сообщества."}),s.jsxs("div",{className:"flex flex-wrap gap-4",children:[s.jsxs("a",{href:"https://telegra.ph/Reglament-provedeniya-torgovyh-sessij-pravila-soobshchestva-ApeVault-dlya-trejderov-i-kollerov-11-20",target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center px-4 py-2 bg-[#4E6E49] hover:bg-[#4E6E49] text-white rounded-lg transition-colors",children:[s.jsx(ii,{className:"w-4 h-4 mr-2"}),"Правила сообщества"]}),s.jsx("div",{className:`inline-flex items-center px-4 py-2 rounded-lg ${r==="dark"?"bg-gray-700":"bg-gray-200"}`,children:s.jsxs("span",{className:c,children:["Администратор: ",s.jsx("span",{className:"font-semibold",children:"@artyommedoed"})]})})]})]})]})})},Zk=()=>{const{theme:r}=ct(),{isAdmin:e}=Bt(),t=r==="dark"?"text-white":"text-gray-900",n=r==="dark"?"text-gray-300":"text-gray-700",a=r==="dark"?"bg-[#1a1a1a]":"bg-white";return e?s.jsx(ir,{children:s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:`rounded-2xl p-6 ${a} shadow-lg border-2 ${r==="dark"?"border-purple-500/30 bg-gradient-to-br from-[#1a1a1a] to-[#1a1a1a]/90":"border-purple-200 bg-gradient-to-br from-white to-purple-50/30"}`,children:[s.jsxs("div",{className:"flex items-start gap-4 mb-6",children:[s.jsx("div",{className:`p-3 rounded-xl ${r==="dark"?"bg-purple-500/20":"bg-purple-100"}`,children:s.jsx(Lt,{className:`w-8 h-8 ${r==="dark"?"text-purple-400":"text-purple-600"}`})}),s.jsxs("div",{className:"flex-1",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[s.jsx("h1",{className:`text-3xl font-bold bg-gradient-to-r ${r==="dark"?"from-purple-400 to-pink-400 text-transparent bg-clip-text":"from-purple-600 to-pink-600 text-transparent bg-clip-text"}`,children:"Панель администратора"}),s.jsx(zt,{className:`w-5 h-5 ${r==="dark"?"text-yellow-400":"text-yellow-500"} animate-pulse`})]}),s.jsxs("p",{className:`${n} text-sm flex items-center gap-2`,children:[s.jsx(od,{className:"w-4 h-4"}),"Управление системой и командой ApeVault"]})]})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-6",children:[s.jsxs("div",{className:`p-4 rounded-xl border-2 ${r==="dark"?"bg-blue-500/10 border-blue-500/30":"bg-blue-50 border-blue-200"}`,children:[s.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[s.jsx("div",{className:`p-2 rounded-lg ${r==="dark"?"bg-blue-500/20":"bg-blue-100"}`,children:s.jsx(Lt,{className:`w-5 h-5 ${r==="dark"?"text-blue-400":"text-blue-600"}`})}),s.jsx("h3",{className:`font-semibold ${t}`,children:"Доступ к функциям"})]}),s.jsx("p",{className:`text-sm ${n}`,children:"В режиме администратора вы можете управлять слотами, статусами и заработком всех участников команды"})]}),s.jsxs("div",{className:"p-4 rounded-xl border-2 bg-[#4E6E49]/10 border-[#4E6E49]/30",children:[s.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[s.jsx("div",{className:`p-2 rounded-lg ${r==="dark"?"bg-[#4E6E49]/20":"bg-green-100"}`,children:s.jsx(wp,{className:"w-5 h-5 text-[#4E6E49]"})}),s.jsx("h3",{className:`font-semibold ${t}`,children:"Безопасность"})]}),s.jsx("p",{className:`text-sm ${n}`,children:"Режим администратора требует ввода пароля. Не делитесь паролем с другими участниками"})]})]}),s.jsx("div",{className:`pt-4 border-t ${r==="dark"?"border-gray-800":"border-gray-200"}`,children:s.jsxs("div",{className:`flex items-center gap-3 p-4 rounded-xl ${r==="dark"?"bg-[#4E6E49]/20 border-2 border-[#4E6E49]/50":"bg-green-50 border-2 border-green-200"}`,children:[s.jsx("div",{className:`p-2 rounded-lg ${r==="dark"?"bg-[#4E6E49]/30":"bg-green-100"}`,children:s.jsx(Lt,{className:"w-6 h-6 text-[#4E6E49]"})}),s.jsxs("div",{children:[s.jsx("h3",{className:`font-semibold mb-1 ${t}`,children:"Режим администратора активен"}),s.jsx("p",{className:`text-sm ${n}`,children:"Вы вошли в систему как администратор. Все административные функции доступны."})]})]})})]}),s.jsxs("div",{className:`rounded-2xl p-6 ${a} shadow-lg border-2 ${r==="dark"?"border-gray-800":"border-gray-200"}`,children:[s.jsx("h2",{className:`text-xl font-semibold mb-4 ${t}`,children:"Возможности администратора"}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsxs("div",{className:`p-4 rounded-xl border ${r==="dark"?"border-gray-800 bg-gray-700/30":"border-gray-200 bg-gray-50"}`,children:[s.jsx("h3",{className:`font-semibold mb-2 ${t}`,children:"📅 Управление слотами"}),s.jsxs("ul",{className:`text-sm space-y-1 ${n} list-disc list-inside`,children:[s.jsx("li",{children:"Создание слотов для любого участника"}),s.jsx("li",{children:"Массовое создание слотов"}),s.jsx("li",{children:"Удаление слотов любого участника"}),s.jsx("li",{children:"Массовое удаление слотов"})]})]}),s.jsxs("div",{className:`p-4 rounded-xl border ${r==="dark"?"border-gray-800 bg-gray-700/30":"border-gray-200 bg-gray-50"}`,children:[s.jsx("h3",{className:`font-semibold mb-2 ${t}`,children:"📋 Управление статусами"}),s.jsxs("ul",{className:`text-sm space-y-1 ${n} list-disc list-inside`,children:[s.jsx("li",{children:"Установка выходных, больничных и отпуск"}),s.jsx("li",{children:"Массовое управление статусами"}),s.jsx("li",{children:"Удаление статусов любого участника"})]})]}),s.jsxs("div",{className:`p-4 rounded-xl border ${r==="dark"?"border-gray-800 bg-gray-700/30":"border-gray-200 bg-gray-50"}`,children:[s.jsx("h3",{className:`font-semibold mb-2 ${t}`,children:"💰 Управление заработком"}),s.jsxs("ul",{className:`text-sm space-y-1 ${n} list-disc list-inside`,children:[s.jsx("li",{children:"Добавление заработка за любую дату"}),s.jsx("li",{children:"Редактирование записей о заработке"}),s.jsx("li",{children:"Удаление записей о заработке"})]})]}),s.jsxs("div",{className:`p-4 rounded-xl border ${r==="dark"?"border-gray-800 bg-gray-700/30":"border-gray-200 bg-gray-50"}`,children:[s.jsx("h3",{className:`font-semibold mb-2 ${t}`,children:"📊 Дополнительно"}),s.jsxs("ul",{className:`text-sm space-y-1 ${n} list-disc list-inside`,children:[s.jsx("li",{children:"Удаление сообщений из подсчета"}),s.jsx("li",{children:"Полный доступ ко всем функциям"}),s.jsx("li",{children:"Просмотр и управление данными команды"})]})]})]})]})]})}):s.jsx(ir,{children:s.jsx("div",{className:`rounded-2xl p-8 ${a} shadow-xl border-2 ${r==="dark"?"border-red-500/30 bg-gradient-to-br from-[#1a1a1a] to-[#0A0A0A]":"border-red-200 bg-gradient-to-br from-white to-red-50/20"} relative overflow-hidden`,children:s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:`inline-flex p-4 rounded-2xl mb-4 ${r==="dark"?"bg-red-500/20":"bg-red-100"}`,children:s.jsx(od,{className:`w-12 h-12 ${r==="dark"?"text-red-400":"text-red-600"}`})}),s.jsx("h2",{className:`text-2xl font-bold mb-2 ${t}`,children:"Доступ запрещен"}),s.jsx("p",{className:n,children:'Эта страница доступна только администраторам. Для входа используйте режим "Админ" на странице входа.'})]})})})},eN=()=>{var Ce;const{theme:r}=ct(),{user:e,logout:t}=Dt(),{isAdmin:n,deactivateAdmin:a}=Bt(),i=Gu(),[l,c]=A.useState(!1),[d,h]=A.useState(!1),[g,x]=A.useState([]),[p,E]=A.useState(null),[j,S]=A.useState(null),[k,L]=A.useState(null),[M,T]=A.useState([]),[O,ne]=A.useState({id:"",userId:"",title:"",text:"",priority:"medium",createdAt:"",updatedAt:""}),[ie,I]=A.useState(!0),[N,b]=A.useState(!1),f=e||(n?{name:"Администратор",login:"admin",password:"admin"}:null),w=e!=null&&e.id?(Ce=Ee.find(H=>H.id===e.id))==null?void 0:Ce.avatar:void 0,_=f!=null&&f.name?f.name.charAt(0).toUpperCase():"A",y=r==="dark"?"text-white":"text-gray-900";A.useEffect(()=>{(e||n)&&G()},[e,n]);const G=async()=>{if(!(!e&&!n)){I(!0);try{const H=(e==null?void 0:e.id)||"admin",Se=await Ag({assignedTo:H});if(x(Se),e){const Ne=wa(),Z=xe(Ne.start,"yyyy-MM-dd"),Re=xe(Ne.end,"yyyy-MM-dd"),J=Fg(30),se=xe(J.start,"yyyy-MM-dd"),q=xe(J.end,"yyyy-MM-dd"),te=J.start.toISOString(),ge=J.end.toISOString(),W=await ra(H,Z,Re),ue=W.reduce((R,X)=>{const be=X.participants&&X.participants.length>0?X.participants.length:1;return R+X.amount/be},0),ze=W.reduce((R,X)=>{const be=X.participants&&X.participants.length>0?X.participants.length:1;return R+X.poolAmount/be},0),We=await ra(H,se,q),Pe=We.reduce((R,X)=>{const be=X.participants&&X.participants.length>0?X.participants.length:1;return R+X.amount/be},0),je=We.reduce((R,X)=>{const be=X.participants&&X.participants.length>0?X.participants.length:1;return R+X.poolAmount/be},0),Le=(await Rr(H)).filter(R=>{const X=R.date,be=R.endDate||R.date;return X<=q&&be>=se}),nt=Le.filter(R=>R.type==="dayoff").reduce((R,X)=>R+Js(X.date,X.endDate,se,q),0),et=Le.filter(R=>R.type==="sick").reduce((R,X)=>R+Js(X.date,X.endDate,se,q),0),U=Le.filter(R=>R.type==="vacation").reduce((R,X)=>R+Js(X.date,X.endDate,se,q),0),Y=(await Fr(H)).filter(R=>R.date>=Z&&R.date<=Re).reduce((R,X)=>R+eo(X.slots),0),pe=await Ig(H,Z,Re),De=(await jg(H))[0]||{userId:H,earnings:0,messages:0,initiatives:0,signals:0,profitableSignals:0,referrals:0,daysOff:0,sickDays:0,vacationDays:0,poolAmount:0,rating:0,lastUpdated:new Date().toISOString()},le=(await Tg(void 0,te,ge)).filter(R=>R.ownerId===H).length,we={userId:H,earnings:Pe,messages:De.messages||0,initiatives:De.initiatives||0,signals:De.signals||0,profitableSignals:De.profitableSignals||0,referrals:le,daysOff:nt,sickDays:et,vacationDays:U,poolAmount:je,lastUpdated:new Date().toISOString()},me=Bg(we,Y,ue,pe),Me=qg(we,Y,ue,pe);E({...we,rating:me}),S(Me),L({total:Pe,pool:je,net:Math.max(0,Pe-je),weekly:{gross:ue,pool:ze,net:Math.max(0,ue-ze)}});const Oe=e!=null&&e.id?`notes-cache-${e.id}`:null,Ye=R=>{if(Oe)try{localStorage.setItem(Oe,JSON.stringify(R))}catch(X){console.error("Error caching notes locally",X)}};try{if(e){const R=await Ru(e.id,n);T(R),Ye(R)}else if(n){const R=await Ru(void 0,!0);T(R),Ye(R)}}catch(R){if(console.error("Error loading notes",R),Oe)try{const X=localStorage.getItem(Oe);if(X){const be=JSON.parse(X);T(be)}}catch(X){console.error("Error loading cached notes",X)}}}}catch(H){console.error("Error loading profile data:",H)}finally{I(!1)}}},V=async()=>{if(!(e!=null&&e.id)||!O.title.trim()&&!O.text.trim())return;const H=e!=null&&e.id?`notes-cache-${e.id}`:null,Se=Ne=>{if(H)try{localStorage.setItem(H,JSON.stringify(Ne))}catch(Z){console.error("Error caching notes locally",Z)}};try{if(O.id){await m2(O.id,{title:O.title,text:O.text,priority:O.priority});const Ne=M.map(Z=>Z.id===O.id?{...Z,title:O.title,text:O.text,priority:O.priority,updatedAt:new Date().toISOString()}:Z);T(Ne),Se(Ne)}else{const Ne=await h2({userId:e.id,title:O.title,text:O.text,priority:O.priority}),Z=new Date().toISOString(),Re=[{id:Ne,userId:e.id,title:O.title,text:O.text,priority:O.priority,createdAt:Z,updatedAt:Z},...M];T(Re),Se(Re)}}catch(Ne){console.error("Error saving note",Ne)}finally{ne({id:"",userId:"",title:"",text:"",priority:"medium",createdAt:"",updatedAt:""})}},F=H=>{const Se=M.find(Ne=>Ne.id===H);Se&&ne(Se)},z=async H=>{const Se=e!=null&&e.id?`notes-cache-${e.id}`:null,Ne=Z=>{if(Se)try{localStorage.setItem(Se,JSON.stringify(Z))}catch(Re){console.error("Error caching notes locally",Re)}};try{await g2(H);const Z=M.filter(Re=>Re.id!==H);T(Z),Ne(Z),O.id===H&&ne({id:"",userId:"",title:"",text:"",priority:"medium",createdAt:"",updatedAt:""})}catch(Z){console.error("Error deleting note",Z)}},ee=()=>{n&&a(),t(),i("/login")},re=()=>{e!=null&&e.password&&(navigator.clipboard.writeText(e.password),h(!0),setTimeout(()=>h(!1),2e3))},oe=()=>{f!=null&&f.login&&(navigator.clipboard.writeText(f.login),b(!0),setTimeout(()=>b(!1),2e3))},ke=g.filter(H=>H.status==="pending").length,ye=g.filter(H=>H.status==="in_progress").length,K=g.filter(H=>H.status==="completed").length,he={pending:{label:"Проверка",classes:r==="dark"?"bg-amber-500/15 text-amber-100 border-amber-500/30":"bg-amber-50 text-amber-900 border-amber-200"},in_progress:{label:"В работе",classes:r==="dark"?"bg-blue-500/15 text-blue-100 border-blue-500/30":"bg-blue-50 text-blue-900 border-blue-200"},approval:{label:"Согласование",classes:r==="dark"?"bg-purple-500/15 text-purple-100 border-purple-500/30":"bg-purple-50 text-purple-900 border-purple-200"},completed:{label:"Выполнена",classes:r==="dark"?"bg-emerald-500/15 text-emerald-50 border-emerald-500/30":"bg-emerald-50 text-emerald-900 border-emerald-200"},closed:{label:"Закрыта",classes:r==="dark"?"bg-gray-600/20 text-gray-100 border-gray-500/40":"bg-gray-50 text-gray-800 border-gray-200"},rejected:{label:"Отклонена",classes:r==="dark"?"bg-red-500/20 text-red-100 border-red-500/40":"bg-red-50 text-red-800 border-red-200"}};return f?s.jsx(ir,{children:s.jsxs("div",{className:"space-y-6",children:[s.jsx("div",{className:`rounded-2xl p-6 border ${r==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white"} shadow-lg`,children:s.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"relative w-12 h-12 rounded-xl overflow-hidden shadow-lg border border-white/50 dark:border-white/10 bg-gradient-to-br from-[#4E6E49]/15 to-emerald-200/40 flex items-center justify-center",children:w?s.jsx("img",{src:w,alt:f.name,className:"w-full h-full object-cover",onError:H=>{const Se=H.target;Se.style.display="none"}}):s.jsx("span",{className:"text-lg font-extrabold text-[#4E6E49]",children:_})}),s.jsxs("div",{children:[s.jsx("p",{className:`text-xs uppercase tracking-[0.14em] ${r==="dark"?"text-gray-400":"text-gray-500"}`,children:"ApeVault Black Ops"}),s.jsx("h1",{className:`text-2xl sm:text-3xl font-extrabold ${y}`,children:"Личный кабинет"}),s.jsx("p",{className:`text-sm ${r==="dark"?"text-gray-300":"text-gray-600"}`,children:"Закрытый контур. Ваши данные и показатели."})]})]}),s.jsxs("div",{className:"flex flex-wrap gap-2",children:[s.jsxs("div",{className:"pill","data-active":"true",children:[s.jsx(tn,{className:"w-4 h-4"}),s.jsx("span",{children:f.name})]}),n&&s.jsxs("div",{className:"pill","data-active":"true",children:[s.jsx(Lt,{className:"w-4 h-4"}),s.jsx("span",{children:"Администратор"})]}),s.jsxs("div",{className:"pill","data-active":"false",children:[s.jsx(ss,{className:"w-4 h-4"}),s.jsxs("span",{children:[g.length," задач"]})]}),p&&s.jsxs("div",{className:"pill","data-active":"false",children:[s.jsx(Pr,{className:"w-4 h-4"}),s.jsxs("span",{children:[p.rating.toFixed(1),"%"]})]})]})]})}),ie?s.jsx("div",{className:`rounded-xl p-8 text-center ${r==="dark"?"bg-white/5 text-white":"bg-white text-gray-800"} shadow`,children:"Загрузка..."}):s.jsxs("div",{className:"space-y-5",children:[s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-[1.05fr_0.95fr] gap-4 items-stretch",children:[s.jsxs("div",{className:"space-y-4 flex flex-col",children:[s.jsxs("div",{className:`rounded-2xl p-5 border ${r==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white"} shadow flex-1`,children:[s.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[s.jsx("div",{className:`p-2.5 rounded-xl ${r==="dark"?"bg-blue-500/15 text-blue-200":"bg-blue-50 text-blue-700"}`,children:s.jsx(tn,{className:"w-5 h-5"})}),s.jsxs("div",{children:[s.jsx("h2",{className:`text-lg font-bold ${y}`,children:"Профиль"}),s.jsx("p",{className:`text-xs ${r==="dark"?"text-gray-400":"text-gray-500"}`,children:"Доступ и учетные данные"})]})]}),s.jsxs("div",{className:"grid sm:grid-cols-2 gap-3",children:[s.jsxs("div",{className:`p-4 rounded-xl border ${r==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white"} shadow-sm`,children:[s.jsx("p",{className:`text-xs font-semibold uppercase tracking-wide ${r==="dark"?"text-gray-400":"text-gray-500"}`,children:"Имя"}),s.jsx("p",{className:`mt-1 text-lg font-bold ${y}`,children:f.name})]}),s.jsxs("div",{className:`p-4 rounded-xl border ${r==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white"} shadow-sm`,children:[s.jsx("p",{className:`text-xs font-semibold uppercase tracking-wide ${r==="dark"?"text-gray-400":"text-gray-500"}`,children:"Логин"}),s.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[s.jsx("p",{className:`text-lg font-bold ${y}`,children:f.login}),s.jsx("button",{onClick:oe,className:`p-2 rounded-lg border transition ${N?"bg-[#4E6E49] text-white border-[#4E6E49]":r==="dark"?"border-white/10 bg-white/5 hover:border-white/30":"border-gray-200 bg-white hover:border-gray-300"}`,title:"Скопировать логин",children:N?s.jsx(Dr,{className:"w-4 h-4"}):s.jsx(oi,{className:"w-4 h-4"})})]})]})]}),s.jsxs("div",{className:"mt-4 space-y-2",children:[s.jsx("label",{className:`text-sm font-semibold ${r==="dark"?"text-gray-300":"text-gray-700"} block`,children:"Пароль"}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("div",{className:`flex-1 px-4 py-3 rounded-lg border ${r==="dark"?"border-white/10 bg-white/5 text-white":"border-gray-200 bg-white text-gray-900"} font-mono text-sm`,children:l?f.password:"•".repeat(f.password.length)}),s.jsx("button",{onClick:()=>c(!l),className:`p-3 rounded-lg border ${r==="dark"?"border-white/10 bg-white/5 hover:border-white/30":"border-gray-200 bg-white hover:border-gray-300"} transition`,title:l?"Скрыть пароль":"Показать пароль",children:l?s.jsx(dp,{className:"w-5 h-5"}):s.jsx(pl,{className:"w-5 h-5"})}),s.jsx("button",{onClick:re,className:`p-3 rounded-lg border transition ${d?"bg-[#4E6E49] text-white border-[#4E6E49]":r==="dark"?"border-white/10 bg-white/5 hover:border-white/30":"border-gray-200 bg-white hover:border-gray-300"}`,title:"Скопировать пароль",children:d?s.jsx(Dr,{className:"w-5 h-5"}):s.jsx(oi,{className:"w-5 h-5"})})]})]}),s.jsx("div",{className:"mt-4 grid gap-3 sm:grid-cols-1",children:s.jsxs("div",{className:`p-4 rounded-xl border ${r==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white"} shadow-sm`,children:[s.jsx("p",{className:`text-xs font-semibold uppercase tracking-wide ${r==="dark"?"text-gray-400":"text-gray-500"}`,children:"Учебная панель (преподаватель)"}),s.jsxs("div",{className:"mt-2 space-y-2 text-sm",children:[s.jsxs("div",{className:`${r==="dark"?"text-gray-300":"text-gray-700"}`,children:[s.jsx("span",{className:"font-semibold",children:"Имя: "}),s.jsx("span",{className:"font-medium",children:"в разработке"})]}),s.jsxs("div",{className:`${r==="dark"?"text-gray-300":"text-gray-700"}`,children:[s.jsx("span",{className:"font-semibold",children:"Логин: "}),s.jsx("span",{className:"font-medium",children:"в разработке"})]}),s.jsxs("div",{className:`${r==="dark"?"text-gray-300":"text-gray-700"}`,children:[s.jsx("span",{className:"font-semibold",children:"Пароль: "}),s.jsx("span",{className:"font-medium",children:"в разработке"})]})]})]})})]}),s.jsxs("div",{className:`rounded-2xl p-5 border ${r==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white"} shadow flex-1`,children:[s.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[s.jsx("div",{className:`p-2.5 rounded-xl ${r==="dark"?"bg-green-500/15 text-green-200":"bg-green-50 text-[#4E6E49]"}`,children:s.jsx(ss,{className:"w-5 h-5"})}),s.jsxs("div",{children:[s.jsx("h2",{className:`text-lg font-bold ${y}`,children:"Мои задачи"}),s.jsx("p",{className:`text-xs ${r==="dark"?"text-gray-400":"text-gray-500"}`,children:"Сводка по статусам"})]})]}),s.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-3 mb-4",children:[{label:"Проверка",value:ke,classes:r==="dark"?"bg-amber-500/15 border-amber-500/30 text-amber-100":"bg-amber-50 border-amber-200 text-amber-900"},{label:"В работе",value:ye,classes:r==="dark"?"bg-blue-500/15 border-blue-500/30 text-blue-100":"bg-blue-50 border-blue-200 text-blue-900"},{label:"Выполнена",value:K,classes:r==="dark"?"bg-emerald-500/15 border-emerald-500/30 text-emerald-50":"bg-emerald-50 border-emerald-200 text-emerald-900"},{label:"Всего",value:g.length,classes:r==="dark"?"bg-gray-600/20 border-gray-500/40 text-gray-100":"bg-gray-50 border-gray-200 text-gray-800"}].map(({label:H,value:Se,classes:Ne})=>s.jsxs("div",{className:`p-4 rounded-xl border shadow-sm transition-all hover:translate-y-[-2px] ${Ne}`,children:[s.jsx("div",{className:"text-xs font-semibold mb-2 opacity-80",children:H}),s.jsx("div",{className:`text-3xl font-extrabold ${y}`,children:Se})]},H))}),g.length>0&&s.jsxs("div",{className:"space-y-2 mb-4",children:[s.jsx("p",{className:`text-sm font-semibold ${r==="dark"?"text-gray-200":"text-gray-800"}`,children:"Активные задачи"}),s.jsx("div",{className:"space-y-2",children:g.slice(0,3).map(H=>s.jsxs("div",{className:`p-3 rounded-lg border ${r==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-gray-50"} shadow-sm`,children:[s.jsxs("div",{className:"flex items-start justify-between gap-2",children:[s.jsxs("div",{className:"min-w-0",children:[s.jsx("p",{className:`text-sm font-semibold ${y} truncate`,children:H.title}),s.jsxs("p",{className:`text-xs ${r==="dark"?"text-gray-400":"text-gray-600"}`,children:["Дедлайн: ",H.dueDate?xe(new Date(H.dueDate),"dd.MM.yyyy"):"—"," ",H.dueTime||""]})]}),s.jsx("span",{className:`text-[11px] px-2 py-1 rounded-full border ${he[H.status].classes}`,children:he[H.status].label})]}),H.description&&s.jsx("p",{className:`text-xs mt-2 ${r==="dark"?"text-gray-300":"text-gray-600"} line-clamp-2`,children:H.description})]},H.id))})]}),s.jsxs("div",{className:"mt-4 space-y-3",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(Pp,{className:"w-4 h-4 text-[#4E6E49]"}),s.jsx("p",{className:`text-sm font-semibold ${y}`,children:"Мои заметки"})]}),s.jsxs("div",{className:"grid gap-2 sm:grid-cols-2",children:[s.jsx("input",{type:"text",value:O.title,onChange:H=>ne({...O,title:H.target.value}),placeholder:"Заголовок",className:`px-3 py-2 rounded-lg border ${r==="dark"?"border-white/10 bg-white/5 text-white":"border-gray-200 bg-white text-gray-900"} text-sm`}),s.jsx("div",{className:"flex gap-2",children:["low","medium","high"].map(H=>s.jsx("button",{onClick:()=>ne({...O,priority:H}),className:`px-3 py-2 rounded-lg border text-sm flex-1 ${O.priority===H?"border-[#4E6E49] bg-[#4E6E49]/10 text-[#4E6E49]":r==="dark"?"border-white/10 bg-white/5 text-white":"border-gray-200 bg-white text-gray-800"}`,children:H==="low"?"Низкий":H==="medium"?"Средний":"Высокий"},H))})]}),s.jsx("textarea",{value:O.text,onChange:H=>ne({...O,text:H.target.value}),rows:3,placeholder:"Текст заметки",className:`w-full px-3 py-2 rounded-lg border ${r==="dark"?"border-white/10 bg-white/5 text-white":"border-gray-200 bg-white text-gray-900"} text-sm`}),s.jsxs("div",{className:"flex gap-2",children:[s.jsxs("button",{onClick:V,className:`px-4 py-2 rounded-lg font-semibold flex items-center gap-2 ${e!=null&&e.id?r==="dark"?"bg-[#4E6E49]/20 text-[#4E6E49] border border-[#4E6E49]/40":"bg-gradient-to-r from-[#4E6E49] to-emerald-500 text-white":"bg-gray-300 text-gray-600 cursor-not-allowed"}`,disabled:!(e!=null&&e.id),children:[s.jsx(ld,{className:"w-4 h-4"}),O.id?"Сохранить":"Добавить"]}),O.id&&s.jsx("button",{onClick:()=>ne({id:"",userId:"",title:"",text:"",priority:"medium",createdAt:"",updatedAt:""}),className:`px-4 py-2 rounded-lg font-semibold border ${r==="dark"?"border-white/15 text-gray-200":"border-gray-200 text-gray-700"}`,children:"Отмена"})]}),M.length>0&&s.jsx("div",{className:"space-y-2",children:M.map(H=>s.jsx("div",{className:`p-3 rounded-lg border ${r==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-gray-50"} flex flex-col gap-1`,children:s.jsxs("div",{className:"flex items-start justify-between gap-2",children:[s.jsxs("div",{className:"min-w-0",children:[s.jsx("p",{className:`text-sm font-semibold ${y} truncate`,children:H.title||"Без названия"}),s.jsx("p",{className:`text-xs ${r==="dark"?"text-gray-400":"text-gray-600"} whitespace-pre-line`,children:H.text})]}),s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx("span",{className:`text-[11px] px-2 py-1 rounded-full border ${H.priority==="high"?"border-rose-200 bg-rose-50 text-rose-700 dark:border-rose-500/40 dark:bg-rose-500/15 dark:text-rose-50":H.priority==="medium"?"border-amber-200 bg-amber-50 text-amber-700 dark:border-amber-500/40 dark:bg-amber-500/15 dark:text-amber-50":"border-emerald-200 bg-emerald-50 text-emerald-700 dark:border-emerald-500/40 dark:bg-emerald-500/15 dark:text-emerald-50"}`,children:H.priority==="high"?"Высокий":H.priority==="medium"?"Средний":"Низкий"}),s.jsx("button",{onClick:()=>F(H.id),className:`p-1 rounded border ${r==="dark"?"border-white/10 text-gray-200":"border-gray-200 text-gray-700"}`,title:"Редактировать",children:s.jsx(ld,{className:"w-4 h-4"})}),s.jsx("button",{onClick:()=>z(H.id),className:`p-1 rounded border ${r==="dark"?"border-white/10 text-red-200":"border-gray-200 text-red-600"}`,title:"Удалить",children:s.jsx(At,{className:"w-4 h-4"})})]})]})},H.id))})]}),s.jsx("div",{className:"mt-4",children:s.jsxs("button",{onClick:()=>i("/tasks"),className:`w-full px-4 py-3 rounded-lg font-semibold transition-all flex items-center justify-center gap-2 ${r==="dark"?"bg-gradient-to-r from-[#4E6E49]/20 to-emerald-700/20 text-[#4E6E49] border border-[#4E6E49]/40":"bg-gradient-to-r from-green-50 to-emerald-50 text-[#4E6E49] border border-green-200"}`,children:[s.jsx(ss,{className:"w-4 h-4"}),"Перейти к задачам"]})})]})]}),s.jsxs("div",{className:"space-y-4 flex flex-col",children:[k&&s.jsxs("div",{className:`rounded-2xl p-5 border ${r==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white"} shadow flex-1`,children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:`p-2.5 rounded-xl ${r==="dark"?"bg-emerald-500/20 text-emerald-200":"bg-emerald-50 text-emerald-700"}`,children:s.jsx(na,{className:"w-5 h-5"})}),s.jsxs("div",{children:[s.jsx("h2",{className:`text-lg font-bold ${y}`,children:"Мой заработок"}),s.jsx("p",{className:`text-xs ${r==="dark"?"text-gray-400":"text-gray-500"}`,children:"Суммы с учётом долей"})]})]}),s.jsx("div",{className:`px-3 py-1.5 rounded-full text-xs font-semibold border ${k.weekly.net>=1e4?"border-emerald-200 bg-emerald-50 text-emerald-800 dark:border-emerald-500/30 dark:bg-emerald-500/15 dark:text-emerald-100":"border-amber-200 bg-amber-50 text-amber-800 dark:border-amber-500/30 dark:bg-amber-500/15 dark:text-amber-100"}`,children:k.weekly.net>=1e4?"Вывод доступен":"Минимум 10 000 для вывода"})]}),s.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3 mb-4",children:[{label:"Всего заработано",value:k.total},{label:"Отправлено в пул",value:k.pool},{label:"Чистыми",value:k.net}].map(H=>s.jsxs("div",{className:`p-4 rounded-xl border shadow-sm ${r==="dark"?"border-white/10 bg-white/5":"border-gray-100 bg-gray-50"}`,children:[s.jsx("p",{className:"text-xs uppercase tracking-wide opacity-70",children:H.label}),s.jsxs("p",{className:`text-2xl font-extrabold ${y}`,children:[Math.round(H.value).toLocaleString("ru-RU")," ₽"]})]},H.label))}),s.jsxs("div",{className:`p-4 rounded-xl border ${r==="dark"?"border-white/10 bg-white/5":"border-emerald-50 bg-emerald-50/70"} flex flex-col gap-2`,children:[s.jsxs("div",{className:"flex items-center justify-between gap-2 flex-wrap",children:[s.jsxs("div",{children:[s.jsx("p",{className:`text-sm font-semibold ${y}`,children:"Активная неделя"}),s.jsx("p",{className:`text-xs ${r==="dark"?"text-gray-400":"text-gray-600"}`,children:"Понедельник, среда, пятница, суббота — дни вывода"})]}),s.jsx("span",{className:`text-xs px-3 py-1 rounded-full border ${k.weekly.net>=1e4?"border-emerald-200 bg-emerald-100 text-emerald-800 dark:border-emerald-500/40 dark:bg-emerald-500/15 dark:text-emerald-50":"border-amber-200 bg-amber-100 text-amber-800 dark:border-amber-500/40 dark:bg-amber-500/15 dark:text-amber-50"}`,children:k.weekly.net>=1e4?"Доступно к выводу":"Перенос на следующую неделю"})]}),s.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3",children:[{label:"Заработано за неделю",value:k.weekly.gross},{label:"В пул за неделю",value:k.weekly.pool},{label:"Чистыми за неделю",value:k.weekly.net}].map(H=>s.jsxs("div",{className:`p-3 rounded-lg border ${r==="dark"?"border-white/10 bg-white/5":"border-white/80 bg-white/80"} shadow-sm`,children:[s.jsx("p",{className:"text-[11px] uppercase tracking-wide opacity-70",children:H.label}),s.jsxs("p",{className:`text-lg font-bold ${y}`,children:[Math.round(H.value).toLocaleString("ru-RU")," ₽"]})]},H.label))}),k.weekly.net<1e4&&s.jsx("p",{className:`text-xs ${r==="dark"?"text-amber-200":"text-amber-700"}`,children:"Менее 10 000 ₽ чистыми за активную неделю — вывод недоступен, сумма переносится на следующую неделю."})]})]}),p&&j&&s.jsxs("div",{className:`rounded-2xl p-5 border ${r==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white"} shadow flex-1`,children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:`p-2.5 rounded-xl ${r==="dark"?"bg-purple-500/20 text-purple-200":"bg-purple-50 text-purple-700"}`,children:s.jsx(Pr,{className:"w-5 h-5"})}),s.jsxs("div",{children:[s.jsx("h2",{className:`text-lg font-bold ${y}`,children:"Рейтинг"}),s.jsx("p",{className:`text-xs ${r==="dark"?"text-gray-400":"text-gray-500"}`,children:"Еженедельная оценка"})]})]}),s.jsx("div",{className:"pill","data-active":"true",children:s.jsxs("span",{className:"font-bold",children:[p.rating.toFixed(1),"%"]})})]}),s.jsxs("div",{className:`p-4 rounded-xl border ${r==="dark"?"border-white/10 bg-white/5":"border-gray-100 bg-gray-50"} mb-4`,children:[s.jsxs("div",{className:`text-4xl font-extrabold ${y}`,children:[p.rating.toFixed(1),"%"]}),s.jsx("p",{className:`text-xs mt-1 ${r==="dark"?"text-gray-400":"text-gray-600"}`,children:p.rating>=70?"Отличный результат":p.rating>=50?"Хороший темп":"Требуется усиление показателей"})]}),s.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[{label:"Выходные",value:`${p.daysOff} дн`,pts:j.daysOffPoints,classes:r==="dark"?"bg-slate-700/40 border-slate-600/60":"bg-slate-50 border-slate-200"},{label:"Больничные",value:`${p.sickDays} дн`,pts:j.sickDaysPoints,classes:r==="dark"?"bg-amber-500/15 border-amber-500/30":"bg-amber-50 border-amber-200"},{label:"Отпуск",value:`${p.vacationDays} дн`,pts:j.vacationDaysPoints,classes:r==="dark"?"bg-orange-500/15 border-orange-500/30":"bg-orange-50 border-orange-200"},{label:"Часы",value:`${j.weeklyHours.toFixed(1)} ч/нед`,pts:j.weeklyHoursPoints,classes:r==="dark"?"bg-blue-500/15 border-blue-500/30":"bg-blue-50 border-blue-200"},{label:"Заработок",value:`${j.weeklyEarnings.toFixed(0)} ₽/нед`,pts:j.weeklyEarningsPoints,classes:r==="dark"?"bg-emerald-500/15 border-emerald-500/30":"bg-emerald-50 border-emerald-200"},{label:"Рефералы",value:`${p.referrals}`,pts:j.referralsPoints,classes:r==="dark"?"bg-purple-500/15 border-purple-500/30":"bg-purple-50 border-purple-200"},{label:"Сообщения",value:`${j.weeklyMessages} сообщ/нед`,pts:j.weeklyMessagesPoints,classes:r==="dark"?"bg-pink-500/15 border-pink-500/30":"bg-pink-50 border-pink-200"}].map(H=>s.jsxs("div",{className:`p-3 rounded-xl border shadow-sm ${H.classes}`,children:[s.jsx("div",{className:"text-xs font-semibold uppercase opacity-80",children:H.label}),s.jsx("div",{className:`text-lg font-bold ${y}`,children:H.value}),s.jsxs("div",{className:`text-sm ${r==="dark"?"text-gray-100":"text-gray-800"}`,children:[H.pts.toFixed(1),"%"]})]},H.label))}),s.jsxs("div",{className:`mt-4 p-4 rounded-xl border ${r==="dark"?"border-white/10 bg-white/5":"border-gray-100 bg-gray-50"}`,children:[s.jsxs("h3",{className:`text-sm font-bold ${y} mb-2 flex items-center gap-2`,children:[s.jsx(rr,{className:"w-4 h-4"}),"Как считается рейтинг"]}),s.jsx("p",{className:`text-xs ${r==="dark"?"text-gray-300":"text-gray-700"}`,children:"7 параметров: выходные, больничные, отпуск (месяц), часы, доход, рефералы, сообщения (неделя). Максимум 100%."})]})]})]})]}),s.jsx("div",{className:`rounded-2xl p-5 border ${r==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white"} shadow`,children:s.jsxs("button",{onClick:ee,className:`w-full px-6 py-3.5 rounded-lg font-semibold transition-all flex items-center justify-center gap-2 ${r==="dark"?"bg-gradient-to-r from-red-500/20 to-pink-500/20 text-red-300 border border-red-500/50":"bg-gradient-to-r from-red-50 to-pink-50 text-red-700 border border-red-200"}`,children:[s.jsx(Ep,{className:"w-5 h-5"}),"Выйти из аккаунта"]})})]})]})}):s.jsx(ir,{children:s.jsx("div",{className:"text-center py-12",children:s.jsx("p",{className:y,children:"Необходима авторизация"})})})},tN="/assets/image-779ddbd9-e512-4bda-8983-af1ab9237b7c-B_v6l7J0.png",rN=()=>{const{theme:r}=ct(),e=r==="dark"?"text-white":"text-gray-900",t=r==="dark"?"text-gray-400":"text-gray-600",n=[{title:"Финансовая грамотность",note:"Учимся управлять рисками, понимать токеномику и принимать решения на основе анализа, а не эмоций.",accent:"from-emerald-200 to-teal-200"},{title:"Приватность превыше всего",note:"Уважаем личные границы и используем инструменты, защищающие цифровую идентичность.",accent:"from-sky-200 to-blue-200"},{title:"Образование и развитие",note:"Учимся от основ блокчейна до продвинутых DeFi-стратегий и делимся знаниями.",accent:"from-amber-200 to-orange-200"},{title:"Честность и прозрачность",note:"Внутри клуба — открытость, честные сделки и уважение. Доверие строим действиями.",accent:"from-purple-200 to-indigo-200"},{title:"Инновации и эксперименты",note:"Тестируем новые протоколы, участвуем в DAO, не боимся быть первыми в трендах.",accent:"from-pink-200 to-rose-200"},{title:"Критическое мышление",note:"Не следуем слепо за хайпом: анализируем, проверяем источники и опираемся на здравый смысл.",accent:"from-cyan-200 to-teal-200"},{title:"Глобальное мышление",note:"Открыты к сотрудничеству с людьми из разных стран ради цифровой и финансовой свободы в рамках закона.",accent:"from-lime-200 to-green-200"},{title:"Свобода и ответственность",note:"Ценим свободу крипты и понимаем её цену: зрелость, самоконтроль и ответственность за решения.",accent:"from-gray-200 to-slate-200"}],a=[{label:"Что такое ApeVault?",value:"Клуб криптоэнтузиастов, где знания превращаются в действие."},{label:"Цель",value:"Объединить инвесторов и трейдеров ради роста дохода и безопасности входа в рынок."}];return s.jsx(ir,{children:s.jsxs("div",{className:"space-y-7 sm:space-y-8",children:[s.jsxs("div",{className:"section-card rounded-3xl p-6 sm:p-8 border border-white/60 dark:border-white/10 shadow-2xl relative overflow-hidden",children:[s.jsx("div",{className:"accent-dots"}),s.jsx("div",{className:"absolute inset-y-0 right-0 w-1/3 pointer-events-none bg-gradient-to-l from-[#4E6E49]/10 to-transparent blur-2xl"}),s.jsxs("div",{className:"relative z-10 flex flex-col gap-5 lg:flex-row lg:items-center lg:justify-between",children:[s.jsxs("div",{className:"space-y-3 max-w-3xl",children:[s.jsxs("div",{className:"inline-flex items-center gap-2 px-3 py-1.5 rounded-full border border-white/50 dark:border-white/10 bg-white/70 dark:bg-white/5 text-xs font-semibold uppercase tracking-[0.16em]",children:[s.jsx(rr,{className:"w-4 h-4 text-[#4E6E49]"}),"ApeVault Community"]}),s.jsx("h1",{className:`text-3xl sm:text-4xl lg:text-5xl font-extrabold leading-tight ${e}`,children:"О нас и нашем сообществе"}),s.jsx("p",{className:`text-sm sm:text-base ${t} max-w-2xl`,children:"ApeVault — это пространство, где опытные криптоэнтузиасты объединяют знания и проверенные стратегии, чтобы безопасно заходить в рынок и расти вместе."}),s.jsx("div",{className:"flex flex-wrap gap-2",children:["Командные сессии","Проверенные стратегии","Прозрачные регламенты"].map(i=>s.jsx("span",{className:`px-3 py-1.5 rounded-full text-xs font-semibold border ${r==="dark"?"border-white/10 bg-white/5 text-white":"border-gray-200 bg-white text-gray-900"}`,children:i},i))})]}),s.jsx("div",{className:"grid grid-cols-2 gap-3 w-full max-w-xs lg:max-w-sm",children:[{label:"Участников",value:"50+"},{label:"Сессий / неделю",value:"10+"},{label:"Уроков",value:"100+"},{label:"Фокуса",value:"100% качество"}].map(i=>s.jsxs("div",{className:`rounded-2xl border p-3 sm:p-4 shadow-sm ${r==="dark"?"border-white/10 bg-white/5 text-white":"border-gray-200 bg-white text-gray-900"}`,children:[s.jsx("p",{className:"text-[11px] uppercase tracking-wide opacity-70",children:i.label}),s.jsx("p",{className:"text-xl font-extrabold leading-tight mt-1",children:i.value})]},i.label))})]})]}),s.jsxs("div",{className:"section-card rounded-3xl p-6 sm:p-7 border border-white/60 dark:border-white/10 shadow-xl relative overflow-hidden",children:[s.jsx("div",{className:"absolute top-0 right-0 w-40 h-40 bg-gradient-to-br from-emerald-500/10 to-blue-500/10 rounded-full blur-3xl -mr-16 -mt-16"}),s.jsxs("div",{className:"relative z-10 space-y-4",children:[s.jsxs("h2",{className:`text-2xl sm:text-3xl font-extrabold ${e} flex items-center gap-2`,children:[s.jsx(zt,{className:"w-6 h-6 text-[#4E6E49]"}),"Что такое ApeVault?"]}),s.jsx("div",{className:"grid gap-4 sm:grid-cols-2",children:a.map(i=>s.jsxs("div",{className:`rounded-2xl border p-4 sm:p-5 flex gap-3 items-start ${r==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white"}`,children:[s.jsx("div",{className:"p-2 rounded-xl bg-gradient-to-br from-[#4E6E49] to-emerald-600 text-white shadow-lg",children:s.jsx(kt,{className:"w-4 h-4"})}),s.jsxs("div",{className:"space-y-1",children:[s.jsx("p",{className:"text-xs uppercase tracking-wide text-[#4E6E49] font-semibold",children:i.label}),s.jsx("p",{className:`text-sm sm:text-base leading-relaxed ${e}`,children:i.value})]})]},i.label))})]})]}),s.jsxs("div",{className:"section-card rounded-3xl p-6 sm:p-7 border border-white/60 dark:border-white/10 shadow-xl relative overflow-hidden",children:[s.jsx("div",{className:"absolute -left-10 top-0 w-52 h-52 bg-gradient-to-br from-amber-400/10 to-rose-400/10 rounded-full blur-3xl"}),s.jsx("div",{className:"absolute -right-10 bottom-0 w-52 h-52 bg-gradient-to-br from-blue-400/10 to-emerald-400/10 rounded-full blur-3xl"}),s.jsxs("div",{className:"relative z-10 space-y-5",children:[s.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-3",children:[s.jsx("h2",{className:`text-2xl sm:text-3xl font-extrabold ${e}`,children:"Принципы, которые держат нас на вершине"}),s.jsxs("div",{className:"flex gap-2",children:[s.jsxs("a",{href:"#rules",className:"pill","data-active":"false",children:["Правила",s.jsx(kt,{className:"w-4 h-4"})]}),s.jsxs("a",{href:"#contacts",className:"pill","data-active":"false",children:["Контакты",s.jsx(kt,{className:"w-4 h-4"})]})]})]}),s.jsxs("div",{className:"grid lg:grid-cols-[1fr_420px_1fr] gap-6 items-center",children:[s.jsx("div",{className:"space-y-3",children:n.slice(0,4).map(i=>s.jsxs("div",{className:`rounded-2xl border px-4 py-3 flex items-start gap-3 ${r==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white/90"}`,children:[s.jsx("div",{className:`p-2 rounded-xl text-gray-900 bg-gradient-to-br ${i.accent}`,children:s.jsx(kt,{className:"w-4 h-4"})}),s.jsxs("div",{className:"space-y-1",children:[s.jsx("p",{className:`text-sm sm:text-base font-semibold ${e}`,children:i.title}),i.note&&s.jsx("p",{className:`text-xs ${t}`,children:i.note})]})]},i.title))}),s.jsxs("div",{className:`rounded-3xl border shadow-xl overflow-hidden relative ${r==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white/95"}`,children:[s.jsx("img",{src:tN,alt:"Принципы ApeVault",className:"w-full h-full object-contain"}),s.jsx("div",{className:"absolute inset-0 pointer-events-none bg-gradient-to-b from-transparent via-transparent to-white/0"})]}),s.jsx("div",{className:"space-y-3",children:n.slice(4).map(i=>s.jsxs("div",{className:`rounded-2xl border px-4 py-3 flex items-start gap-3 ${r==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white/90"}`,children:[s.jsx("div",{className:`p-2 rounded-xl text-gray-900 bg-gradient-to-br ${i.accent}`,children:s.jsx(kt,{className:"w-4 h-4"})}),s.jsxs("div",{className:"space-y-1",children:[s.jsx("p",{className:`text-sm sm:text-base font-semibold ${e}`,children:i.title}),i.note&&s.jsx("p",{className:`text-xs ${t}`,children:i.note})]})]},i.title))})]})]})]}),s.jsxs("div",{id:"rules",className:"section-card rounded-3xl p-6 sm:p-7 border border-white/60 dark:border-white/10 shadow-xl relative overflow-hidden",children:[s.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-indigo-100/50 via-white/40 to-purple-100/40 dark:from-indigo-900/30 dark:via-transparent dark:to-purple-900/20"}),s.jsxs("div",{className:"relative z-10 grid gap-5 sm:grid-cols-[1.15fr_0.85fr] items-center",children:[s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{className:"inline-flex items-center gap-2 px-3 py-1.5 rounded-full bg-white/80 dark:bg-white/10 border border-white/60 dark:border-white/10 text-xs font-semibold tracking-wide text-indigo-700 dark:text-white",children:[s.jsx(ii,{className:"w-4 h-4"}),"Правила сообщества"]}),s.jsx("h2",{className:`text-2xl sm:text-3xl font-extrabold ${e}`,children:"Простой регламент, чтобы оставаться на одной волне"}),s.jsx("p",{className:`text-sm sm:text-base ${t}`,children:"Подробно описали процессы, безопасность и взаимодействие, чтобы каждый чувствовал прозрачность и поддержку."}),s.jsx("div",{className:"flex flex-wrap gap-2",children:["Безопасность","Честные сделки","Уважение","Прозрачность"].map(i=>s.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-semibold border ${r==="dark"?"border-white/10 bg-white/5 text-white":"border-indigo-100 bg-white text-indigo-900"}`,children:i},i))}),s.jsxs("a",{href:"https://telegra.ph/Reglament-provedeniya-torgovyh-sessij-pravila-soobshchestva-ApeVault-dlya-trejderov-i-kollerov-11-20",target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-2 px-5 py-3 rounded-xl bg-gradient-to-r from-indigo-500 to-purple-500 text-white font-semibold shadow-lg hover:shadow-xl hover:-translate-y-0.5 transition-all",children:[s.jsx(ii,{className:"w-5 h-5"}),s.jsx("span",{children:"Читать регламент"}),s.jsx(kt,{className:"w-4 h-4"})]})]}),s.jsx("div",{className:`rounded-2xl border p-4 sm:p-5 shadow-lg ${r==="dark"?"border-white/10 bg-white/5":"border-white/80 bg-white/90"}`,children:s.jsx("div",{className:"space-y-3",children:["Короткие правила для быстрых решений","Фокус на безопасности и приватности","Прозрачные роли и ответственность","Действуем в рамках законодательства"].map(i=>s.jsxs("div",{className:"flex items-start gap-2",children:[s.jsx("div",{className:"w-2 h-2 rounded-full bg-indigo-500 mt-2"}),s.jsx("p",{className:`text-sm ${e}`,children:i})]},i))})})]})]}),s.jsxs("div",{id:"contacts",className:"section-card rounded-3xl p-6 sm:p-7 border border-white/60 dark:border-white/10 shadow-xl relative overflow-hidden",children:[s.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-rose-100/50 via-white/40 to-amber-100/40 dark:from-rose-900/25 dark:via-transparent dark:to-amber-900/20"}),s.jsxs("div",{className:"relative z-10 grid gap-5 sm:grid-cols-[0.9fr_1.1fr] items-center",children:[s.jsxs("div",{className:`p-4 rounded-2xl shadow-lg inline-flex items-center gap-3 ${r==="dark"?"bg-gradient-to-br from-rose-600 to-amber-600 text-white":"bg-gradient-to-br from-rose-500 to-amber-500 text-white"}`,children:[s.jsx(jp,{className:"w-7 h-7"}),s.jsxs("div",{children:[s.jsx("p",{className:"text-xs uppercase tracking-wide",children:"Контакты клуба"}),s.jsx("p",{className:"text-base font-semibold",children:"Свяжитесь с нами"})]})]}),s.jsxs("div",{className:"grid gap-3 sm:grid-cols-2",children:[s.jsxs("div",{className:`rounded-2xl border p-4 shadow-md flex flex-col gap-2 ${r==="dark"?"border-white/10 bg-white/5":"border-white/80 bg-white/90"}`,children:[s.jsx("p",{className:"text-xs uppercase tracking-wide text-rose-600 dark:text-rose-200 font-semibold",children:"Администратор"}),s.jsx("p",{className:`text-lg font-extrabold ${e}`,children:"@artyommedoed"}),s.jsx("p",{className:`text-sm ${t}`,children:"По вопросам правил, доступов и регламентов."})]}),s.jsxs("div",{className:`rounded-2xl border p-4 shadow-md flex flex-col gap-2 ${r==="dark"?"border-white/10 bg-white/5":"border-white/80 bg-white/90"}`,children:[s.jsx("p",{className:"text-xs uppercase tracking-wide text-amber-600 dark:text-amber-200 font-semibold",children:"Обратная связь"}),s.jsx("p",{className:`text-lg font-extrabold ${e}`,children:"Командный чат"}),s.jsx("p",{className:`text-sm ${t}`,children:"Оперативные вопросы по продуктам и сессиям."}),s.jsxs("a",{href:"https://t.me/+vPZdPwPaaKI1MjAy",target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-2 text-sm font-semibold text-[#4E6E49] hover:text-emerald-600",children:["Присоединиться",s.jsx(kt,{className:"w-4 h-4"})]})]})]})]})]})]})})},Kr=({children:r})=>{const{isAuthenticated:e}=Dt(),{isAdmin:t}=Bt();return!e&&!t?s.jsx(Po,{to:"/login",replace:!0}):s.jsx(s.Fragment,{children:r})};function sN(){const{isAuthenticated:r}=Dt(),{isAdmin:e}=Bt(),{theme:t}=ct();return A.useEffect(()=>{document.body.classList.toggle("dark",t==="dark")},[t]),A.useEffect(()=>{kg().catch(n=>console.error("Cleanup failed",n))},[]),s.jsx(f0,{children:s.jsxs(x0,{children:[s.jsx(tr,{path:"/login",element:!r&&!e?s.jsx(Lp,{}):s.jsx(Po,{to:"/management",replace:!0})}),s.jsx(tr,{path:"/call",element:s.jsx(Kr,{children:s.jsx(v2,{})})}),s.jsx(tr,{path:"/management",element:s.jsx(Kr,{children:s.jsx(Dk,{})})}),s.jsx(tr,{path:"/earnings",element:s.jsx(Kr,{children:s.jsx(Ok,{})})}),s.jsx(tr,{path:"/rating",element:s.jsx(Kr,{children:s.jsx(Uk,{})})}),s.jsx(tr,{path:"/tasks",element:s.jsx(Kr,{children:s.jsx(Yk,{})})}),s.jsx(tr,{path:"/about",element:s.jsx(Kr,{children:s.jsx(rN,{})})}),s.jsx(tr,{path:"/faq",element:s.jsx(Jk,{})}),s.jsx(tr,{path:"/admin",element:s.jsx(Kr,{children:s.jsx(Zk,{})})}),s.jsx(tr,{path:"/profile",element:s.jsx(Kr,{children:s.jsx(eN,{})})}),s.jsx(tr,{path:"/",element:s.jsx(Po,{to:r||e?"/management":"/login",replace:!0})})]})})}$o.createRoot(document.getElementById("root")).render(s.jsx(Hu.StrictMode,{children:s.jsx(sN,{})}));
