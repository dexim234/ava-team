import{r as E,a as up,g as hp,R as Oh,u as Vh,b as mp,L as $r,N as Ii,c as Lh,O as gp,B as pp,d as xp,e as ar}from"./react-vendor-C1CKHd5q.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))n(a);new MutationObserver(a=>{for(const i of a)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function t(a){const i={};return a.integrity&&(i.integrity=a.integrity),a.referrerPolicy&&(i.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?i.credentials="include":a.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(a){if(a.ep)return;a.ep=!0;const i=t(a);fetch(a.href,i)}})();var Fh={exports:{}},ro={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var fp=E,bp=Symbol.for("react.element"),yp=Symbol.for("react.fragment"),vp=Object.prototype.hasOwnProperty,wp=fp.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,kp={key:!0,ref:!0,__self:!0,__source:!0};function Uh(s,e,t){var n,a={},i=null,o=null;t!==void 0&&(i=""+t),e.key!==void 0&&(i=""+e.key),e.ref!==void 0&&(o=e.ref);for(n in e)vp.call(e,n)&&!kp.hasOwnProperty(n)&&(a[n]=e[n]);if(s&&s.defaultProps)for(n in e=s.defaultProps,e)a[n]===void 0&&(a[n]=e[n]);return{$$typeof:bp,type:s,key:i,ref:o,props:a,_owner:wp.current}}ro.Fragment=yp;ro.jsx=Uh;ro.jsxs=Uh;Fh.exports=ro;var r=Fh.exports,hl={},zd=up;hl.createRoot=zd.createRoot,hl.hydrateRoot=zd.hydrateRoot;const Np={},Wd=s=>{let e;const t=new Set,n=(m,x)=>{const f=typeof m=="function"?m(e):m;if(!Object.is(f,e)){const w=e;e=x??(typeof f!="object"||f===null)?f:Object.assign({},e,f),t.forEach($=>$(e,w))}},a=()=>e,d={setState:n,getState:a,getInitialState:()=>h,subscribe:m=>(t.add(m),()=>t.delete(m)),destroy:()=>{(Np?"production":void 0)!=="production"&&console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),t.clear()}},h=e=s(n,a,d);return d},jp=s=>s?Wd(s):Wd;var Bh={exports:{}},qh={},zh={exports:{}},Wh={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var En=E;function _p(s,e){return s===e&&(s!==0||1/s===1/e)||s!==s&&e!==e}var Ep=typeof Object.is=="function"?Object.is:_p,Ip=En.useState,Tp=En.useEffect,Sp=En.useLayoutEffect,Ap=En.useDebugValue;function Cp(s,e){var t=e(),n=Ip({inst:{value:t,getSnapshot:e}}),a=n[0].inst,i=n[1];return Sp(function(){a.value=t,a.getSnapshot=e,Ho(a)&&i({inst:a})},[s,t,e]),Tp(function(){return Ho(a)&&i({inst:a}),s(function(){Ho(a)&&i({inst:a})})},[s]),Ap(t),t}function Ho(s){var e=s.getSnapshot;s=s.value;try{var t=e();return!Ep(s,t)}catch{return!0}}function Dp(s,e){return e()}var $p=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?Dp:Cp;Wh.useSyncExternalStore=En.useSyncExternalStore!==void 0?En.useSyncExternalStore:$p;zh.exports=Wh;var Rp=zh.exports;/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var so=E,Pp=Rp;function Mp(s,e){return s===e&&(s!==0||1/s===1/e)||s!==s&&e!==e}var Op=typeof Object.is=="function"?Object.is:Mp,Vp=Pp.useSyncExternalStore,Lp=so.useRef,Fp=so.useEffect,Up=so.useMemo,Bp=so.useDebugValue;qh.useSyncExternalStoreWithSelector=function(s,e,t,n,a){var i=Lp(null);if(i.current===null){var o={hasValue:!1,value:null};i.current=o}else o=i.current;i=Up(function(){function d(w){if(!h){if(h=!0,m=w,w=n(w),a!==void 0&&o.hasValue){var $=o.value;if(a($,w))return x=$}return x=w}if($=x,Op(m,w))return $;var A=n(w);return a!==void 0&&a($,A)?(m=w,$):(m=w,x=A)}var h=!1,m,x,f=t===void 0?null:t;return[function(){return d(e())},f===null?void 0:function(){return d(f())}]},[e,t,n,a]);var c=Vp(s,i[0],i[1]);return Fp(function(){o.hasValue=!0,o.value=c},[c]),Bp(c),c};Bh.exports=qh;var qp=Bh.exports;const zp=hp(qp),Hh={},{useDebugValue:Wp}=Oh,{useSyncExternalStoreWithSelector:Hp}=zp;let Hd=!1;const Gp=s=>s;function Kp(s,e=Gp,t){(Hh?"production":void 0)!=="production"&&t&&!Hd&&(console.warn("[DEPRECATED] Use `createWithEqualityFn` instead of `create` or use `useStoreWithEqualityFn` instead of `useStore`. They can be imported from 'zustand/traditional'. https://github.com/pmndrs/zustand/discussions/1937"),Hd=!0);const n=Hp(s.subscribe,s.getState,s.getServerState||s.getInitialState,e,t);return Wp(n),n}const Yp=s=>{(Hh?"production":void 0)!=="production"&&typeof s!="function"&&console.warn("[DEPRECATED] Passing a vanilla store will be unsupported in a future version. Instead use `import { useStore } from 'zustand'`.");const e=typeof s=="function"?jp(s):s,t=(n,a)=>Kp(e,n,a);return Object.assign(t,e),t},Kl=s=>Yp,Qp={};function Xp(s,e){let t;try{t=s()}catch{return}return{getItem:a=>{var i;const o=d=>d===null?null:JSON.parse(d,void 0),c=(i=t.getItem(a))!=null?i:null;return c instanceof Promise?c.then(o):o(c)},setItem:(a,i)=>t.setItem(a,JSON.stringify(i,void 0)),removeItem:a=>t.removeItem(a)}}const ba=s=>e=>{try{const t=s(e);return t instanceof Promise?t:{then(n){return ba(n)(t)},catch(n){return this}}}catch(t){return{then(n){return this},catch(n){return ba(n)(t)}}}},Jp=(s,e)=>(t,n,a)=>{let i={getStorage:()=>localStorage,serialize:JSON.stringify,deserialize:JSON.parse,partialize:T=>T,version:0,merge:(T,K)=>({...K,...T}),...e},o=!1;const c=new Set,d=new Set;let h;try{h=i.getStorage()}catch{}if(!h)return s((...T)=>{console.warn(`[zustand persist middleware] Unable to update item '${i.name}', the given storage is currently unavailable.`),t(...T)},n,a);const m=ba(i.serialize),x=()=>{const T=i.partialize({...n()});let K;const P=m({state:T,version:i.version}).then(S=>h.setItem(i.name,S)).catch(S=>{K=S});if(K)throw K;return P},f=a.setState;a.setState=(T,K)=>{f(T,K),x()};const w=s((...T)=>{t(...T),x()},n,a);let $;const A=()=>{var T;if(!h)return;o=!1,c.forEach(P=>P(n()));const K=((T=i.onRehydrateStorage)==null?void 0:T.call(i,n()))||void 0;return ba(h.getItem.bind(h))(i.name).then(P=>{if(P)return i.deserialize(P)}).then(P=>{if(P)if(typeof P.version=="number"&&P.version!==i.version){if(i.migrate)return i.migrate(P.state,P.version);console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return P.state}).then(P=>{var S;return $=i.merge(P,(S=n())!=null?S:w),t($,!0),x()}).then(()=>{K==null||K($,void 0),o=!0,d.forEach(P=>P($))}).catch(P=>{K==null||K(void 0,P)})};return a.persist={setOptions:T=>{i={...i,...T},T.getStorage&&(h=T.getStorage())},clearStorage:()=>{h==null||h.removeItem(i.name)},getOptions:()=>i,rehydrate:()=>A(),hasHydrated:()=>o,onHydrate:T=>(c.add(T),()=>{c.delete(T)}),onFinishHydration:T=>(d.add(T),()=>{d.delete(T)})},A(),$||w},Zp=(s,e)=>(t,n,a)=>{let i={storage:Xp(()=>localStorage),partialize:A=>A,version:0,merge:(A,T)=>({...T,...A}),...e},o=!1;const c=new Set,d=new Set;let h=i.storage;if(!h)return s((...A)=>{console.warn(`[zustand persist middleware] Unable to update item '${i.name}', the given storage is currently unavailable.`),t(...A)},n,a);const m=()=>{const A=i.partialize({...n()});return h.setItem(i.name,{state:A,version:i.version})},x=a.setState;a.setState=(A,T)=>{x(A,T),m()};const f=s((...A)=>{t(...A),m()},n,a);a.getInitialState=()=>f;let w;const $=()=>{var A,T;if(!h)return;o=!1,c.forEach(P=>{var S;return P((S=n())!=null?S:f)});const K=((T=i.onRehydrateStorage)==null?void 0:T.call(i,(A=n())!=null?A:f))||void 0;return ba(h.getItem.bind(h))(i.name).then(P=>{if(P)if(typeof P.version=="number"&&P.version!==i.version){if(i.migrate)return[!0,i.migrate(P.state,P.version)];console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return[!1,P.state];return[!1,void 0]}).then(P=>{var S;const[L,ee]=P;if(w=i.merge(ee,(S=n())!=null?S:f),t(w,!0),L)return m()}).then(()=>{K==null||K(w,void 0),w=n(),o=!0,d.forEach(P=>P(w))}).catch(P=>{K==null||K(void 0,P)})};return a.persist={setOptions:A=>{i={...i,...A},A.storage&&(h=A.storage)},clearStorage:()=>{h==null||h.removeItem(i.name)},getOptions:()=>i,rehydrate:()=>$(),hasHydrated:()=>o,onHydrate:A=>(c.add(A),()=>{c.delete(A)}),onFinishHydration:A=>(d.add(A),()=>{d.delete(A)})},i.skipHydration||$(),w||f},ex=(s,e)=>"getStorage"in e||"serialize"in e||"deserialize"in e?((Qp?"production":void 0)!=="production"&&console.warn("[DEPRECATED] `getStorage`, `serialize` and `deserialize` options are deprecated. Use `storage` option instead."),Jp(s,e)):Zp(s,e),Yl=ex,bn={memecoins:{label:"Мемкоины",accent:"emerald",icon:"rocket"},futures:{label:"Фьючерсы",accent:"blue",icon:"trending"},nft:{label:"NFT",accent:"purple",icon:"image"},spot:{label:"Спот",accent:"amber",icon:"coins"},airdrop:{label:"AirDrop",accent:"cyan",icon:"gift"},polymarket:{label:"Polymarket",accent:"pink",icon:"barchart"},staking:{label:"Стейкинг",accent:"indigo",icon:"shield"}},Zr={memecoins:{label:"Мемкоины",accent:"emerald",icon:"rocket"},futures:{label:"Фьючерсы",accent:"blue",icon:"line"},nft:{label:"NFT",accent:"purple",icon:"image"},spot:{label:"Спот",accent:"amber",icon:"coins"},polymarket:{label:"PolyMarket",accent:"pink",icon:"barchart"},staking:{label:"Стейкинг",accent:"indigo",icon:"shield"},other:{label:"Другое",accent:"gray",icon:"sparkles"}},$e=[{id:"1",name:"Артём",login:"artyom03",password:"248artdex",avatar:"/avatars/artyom.jpg"},{id:"2",name:"Enowk",login:"adel05",password:"058adeldex",avatar:"/avatars/adel.jpg"},{id:"3",name:"Ксения",login:"ksen03",password:"907ksendex",avatar:"/avatars/kseniya.jpg"},{id:"4",name:"Ольга",login:"olga04",password:"638olgadex",avatar:"/avatars/olga.jpg"},{id:"5",name:"Анастасия",login:"anastasia05",password:"638anastadex",avatar:"/avatars/anastasia.jpg"}],ya={trading:{label:"Торговля",icon:"candles",color:"green"},learning:{label:"Обучение",icon:"book",color:"blue"},technical:{label:"ТЧ",icon:"cpu",color:"purple"},stream:{label:"Стрим",icon:"broadcast",color:"red"},research:{label:"Изучение",icon:"flask",color:"yellow"},organization:{label:"Ресёрч",icon:"clipboard",color:"indigo"}},Gs={in_progress:{label:"В работе",color:"blue"},completed:{label:"Выполнено",color:"green"},closed:{label:"Закрыто",color:"gray"}},bt=Kl()(Yl(s=>({user:null,isAuthenticated:!1,login:(e,t)=>{const n=$e.find(a=>a.login===e&&a.password===t);return n?(s({user:n,isAuthenticated:!0}),!0):!1},logout:()=>s({user:null,isAuthenticated:!1})}),{name:"apevault-auth"})),Ql="4747",_t=Kl()(Yl(s=>({isAdmin:!1,activateAdmin:e=>e===Ql?(s({isAdmin:!0}),!0):!1,deactivateAdmin:()=>s({isAdmin:!1})}),{name:"apevault-admin"})),it=Kl()(Yl(s=>({theme:"light",toggleTheme:()=>s(e=>{const t=e.theme==="light"?"dark":"light";return document.body.classList.toggle("dark",t==="dark"),{theme:t}}),setTheme:e=>s(()=>(document.body.classList.toggle("dark",e==="dark"),{theme:e}))}),{name:"apevault-theme"}));/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var tx={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rx=s=>s.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().trim(),ge=(s,e)=>{const t=E.forwardRef(({color:n="currentColor",size:a=24,strokeWidth:i=2,absoluteStrokeWidth:o,className:c="",children:d,...h},m)=>E.createElement("svg",{ref:m,...tx,width:a,height:a,stroke:n,strokeWidth:o?Number(i)*24/Number(a):i,className:["lucide",`lucide-${rx(s)}`,c].join(" "),...h},[...e.map(([x,f])=>E.createElement(x,f)),...Array.isArray(d)?d:[d]]));return t.displayName=`${s}`,t};/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xl=ge("Activity",[["path",{d:"M22 12h-4l-3 9L9 3l-3 9H2",key:"d5dnw9"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const no=ge("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ut=ge("AlertTriangle",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z",key:"c3ski4"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sx=ge("Archive",[["rect",{width:"20",height:"5",x:"2",y:"3",rx:"1",key:"1wp1u1"}],["path",{d:"M4 8v11a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8",key:"1s80jp"}],["path",{d:"M10 12h4",key:"a56b0p"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nx=ge("ArrowDownRight",[["path",{d:"m7 7 10 10",key:"1fmybs"}],["path",{d:"M17 7v10H7",key:"6fjiku"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Rr=ge("ArrowUpRight",[["path",{d:"M7 7h10v10",key:"1tivn9"}],["path",{d:"M7 17 17 7",key:"1vkiza"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Jl=ge("BarChart3",[["path",{d:"M3 3v18h18",key:"1s2lah"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ax=ge("Bell",[["path",{d:"M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9",key:"1qo2s2"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const In=ge("BookOpen",[["path",{d:"M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z",key:"vv98re"}],["path",{d:"M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z",key:"1cyq3y"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ti=ge("Building2",[["path",{d:"M6 22V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v18Z",key:"1b4qmf"}],["path",{d:"M6 12H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h2",key:"i71pzd"}],["path",{d:"M18 9h2a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2h-2",key:"10jefs"}],["path",{d:"M10 6h4",key:"1itunk"}],["path",{d:"M10 10h4",key:"tcdvrf"}],["path",{d:"M10 14h4",key:"kelpxr"}],["path",{d:"M10 18h4",key:"1ulq68"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ml=ge("CalendarCheck",[["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",ry:"2",key:"eu3xkr"}],["line",{x1:"16",x2:"16",y1:"2",y2:"6",key:"m3sa8f"}],["line",{x1:"8",x2:"8",y1:"2",y2:"6",key:"18kwsl"}],["line",{x1:"3",x2:"21",y1:"10",y2:"10",key:"xt86sb"}],["path",{d:"m9 16 2 2 4-4",key:"19s6y9"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Si=ge("CalendarClock",[["path",{d:"M21 7.5V6a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h3.5",key:"1osxxc"}],["path",{d:"M16 2v4",key:"4m81vk"}],["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M3 10h5",key:"r794hk"}],["path",{d:"M17.5 17.5 16 16.25V14",key:"re2vv1"}],["path",{d:"M22 16a6 6 0 1 1-12 0 6 6 0 0 1 12 0Z",key:"ame013"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ix=ge("CalendarDays",[["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",ry:"2",key:"eu3xkr"}],["line",{x1:"16",x2:"16",y1:"2",y2:"6",key:"m3sa8f"}],["line",{x1:"8",x2:"8",y1:"2",y2:"6",key:"18kwsl"}],["line",{x1:"3",x2:"21",y1:"10",y2:"10",key:"xt86sb"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 18h.01",key:"lrp35t"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M16 18h.01",key:"kzsmim"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gs=ge("Calendar",[["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",ry:"2",key:"eu3xkr"}],["line",{x1:"16",x2:"16",y1:"2",y2:"6",key:"m3sa8f"}],["line",{x1:"8",x2:"8",y1:"2",y2:"6",key:"18kwsl"}],["line",{x1:"3",x2:"21",y1:"10",y2:"10",key:"xt86sb"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ox=ge("CandlestickChart",[["path",{d:"M9 5v4",key:"14uxtq"}],["rect",{width:"4",height:"6",x:"7",y:"9",rx:"1",key:"f4fvz0"}],["path",{d:"M9 15v2",key:"r5rk32"}],["path",{d:"M17 3v2",key:"1l2re6"}],["rect",{width:"4",height:"8",x:"15",y:"5",rx:"1",key:"z38je5"}],["path",{d:"M17 13v3",key:"5l0wba"}],["path",{d:"M3 3v18h18",key:"1s2lah"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ra=ge("CheckCircle2",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lx=ge("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ss=ge("CheckSquare",[["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}],["path",{d:"M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11",key:"1jnkn4"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _r=ge("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ts=ge("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cx=ge("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gh=ge("ChevronUp",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dx=ge("CircleDot",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gd=ge("ClipboardCheck",[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}],["path",{d:"m9 14 2 2 4-4",key:"df797q"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ux=ge("ClipboardList",[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}],["path",{d:"M12 11h4",key:"1jrz19"}],["path",{d:"M12 16h4",key:"n85exb"}],["path",{d:"M8 11h.01",key:"1dfujw"}],["path",{d:"M8 16h.01",key:"18s6g9"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ss=ge("Clock3",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16.5 12",key:"1aq6pp"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Dr=ge("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lr=ge("Coins",[["circle",{cx:"8",cy:"8",r:"6",key:"3yglwk"}],["path",{d:"M18.09 10.37A6 6 0 1 1 10.34 18",key:"t5s6rm"}],["path",{d:"M7 6h1v4",key:"1obek4"}],["path",{d:"m16.71 13.88.7.71-2.82 2.82",key:"1rbuyh"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const va=ge("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hx=ge("Cpu",[["rect",{x:"4",y:"4",width:"16",height:"16",rx:"2",key:"1vbyd7"}],["rect",{x:"9",y:"9",width:"6",height:"6",key:"o3kz5p"}],["path",{d:"M15 2v2",key:"13l42r"}],["path",{d:"M15 20v2",key:"15mkzm"}],["path",{d:"M2 15h2",key:"1gxd5l"}],["path",{d:"M2 9h2",key:"1bbxkp"}],["path",{d:"M20 15h2",key:"19e6y8"}],["path",{d:"M20 9h2",key:"19tzq7"}],["path",{d:"M9 2v2",key:"165o2o"}],["path",{d:"M9 20v2",key:"i2bqo8"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Tn=ge("DollarSign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mx=ge("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Kh=ge("EyeOff",[["path",{d:"M9.88 9.88a3 3 0 1 0 4.24 4.24",key:"1jxqfv"}],["path",{d:"M10.73 5.08A10.43 10.43 0 0 1 12 5c7 0 10 7 10 7a13.16 13.16 0 0 1-1.67 2.68",key:"9wicm4"}],["path",{d:"M6.61 6.61A13.526 13.526 0 0 0 2 12s3 7 10 7a9.74 9.74 0 0 0 5.39-1.61",key:"1jreej"}],["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ai=ge("Eye",[["path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",key:"rwhkz3"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gx=ge("FileCode",[["path",{d:"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z",key:"1nnpy2"}],["polyline",{points:"14 2 14 8 20 8",key:"1ew0cm"}],["path",{d:"m10 13-2 2 2 2",key:"17smn8"}],["path",{d:"m14 17 2-2-2-2",key:"14mezr"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Yh=ge("FileText",[["path",{d:"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z",key:"1nnpy2"}],["polyline",{points:"14 2 14 8 20 8",key:"1ew0cm"}],["line",{x1:"16",x2:"8",y1:"13",y2:"13",key:"14keom"}],["line",{x1:"16",x2:"8",y1:"17",y2:"17",key:"17nazh"}],["line",{x1:"10",x2:"8",y1:"9",y2:"9",key:"1a5vjj"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qh=ge("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const px=ge("FlaskConical",[["path",{d:"M10 2v7.527a2 2 0 0 1-.211.896L4.72 20.55a1 1 0 0 0 .9 1.45h12.76a1 1 0 0 0 .9-1.45l-5.069-10.127A2 2 0 0 1 14 9.527V2",key:"pzvekw"}],["path",{d:"M8.5 2h7",key:"csnxdl"}],["path",{d:"M7 16h10",key:"wp8him"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ks=ge("Gauge",[["path",{d:"m12 14 4-4",key:"9kzdfg"}],["path",{d:"M3.34 19a10 10 0 1 1 17.32 0",key:"19p75a"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xh=ge("Globe2",[["path",{d:"M21.54 15H17a2 2 0 0 0-2 2v4.54",key:"1djwo0"}],["path",{d:"M7 3.34V5a3 3 0 0 0 3 3v0a2 2 0 0 1 2 2v0c0 1.1.9 2 2 2v0a2 2 0 0 0 2-2v0c0-1.1.9-2 2-2h3.17",key:"1fi5u6"}],["path",{d:"M11 21.95V18a2 2 0 0 0-2-2v0a2 2 0 0 1-2-2v-1a2 2 0 0 0-2-2H2.05",key:"xsiumc"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Jh=ge("Hash",[["line",{x1:"4",x2:"20",y1:"9",y2:"9",key:"4lhtct"}],["line",{x1:"4",x2:"20",y1:"15",y2:"15",key:"vyu0kd"}],["line",{x1:"10",x2:"8",y1:"3",y2:"21",key:"1ggp8o"}],["line",{x1:"16",x2:"14",y1:"3",y2:"21",key:"weycgp"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xx=ge("Heart",[["path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z",key:"c3ymky"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fx=ge("Home",[["path",{d:"m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"y5dka4"}],["polyline",{points:"9 22 9 12 15 12 15 22",key:"e2us08"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bx=ge("Hourglass",[["path",{d:"M5 22h14",key:"ehvnwv"}],["path",{d:"M5 2h14",key:"pdyrp9"}],["path",{d:"M17 22v-4.172a2 2 0 0 0-.586-1.414L12 12l-4.414 4.414A2 2 0 0 0 7 17.828V22",key:"1d314k"}],["path",{d:"M7 2v4.172a2 2 0 0 0 .586 1.414L12 12l4.414-4.414A2 2 0 0 0 17 6.172V2",key:"1vvvr6"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ao=ge("Image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Tr=ge("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yx=ge("Key",[["circle",{cx:"7.5",cy:"15.5",r:"5.5",key:"yqb3hr"}],["path",{d:"m21 2-9.6 9.6",key:"1j0ho8"}],["path",{d:"m15.5 7.5 3 3L22 7l-3-3",key:"1rn1fs"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vx=ge("Layers",[["path",{d:"m12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83Z",key:"8b97xw"}],["path",{d:"m22 17.65-9.17 4.16a2 2 0 0 1-1.66 0L2 17.65",key:"dd6zsq"}],["path",{d:"m22 12.65-9.17 4.16a2 2 0 0 1-1.66 0L2 12.65",key:"ep9fru"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wx=ge("LayoutGrid",[["rect",{width:"7",height:"7",x:"3",y:"3",rx:"1",key:"1g98yp"}],["rect",{width:"7",height:"7",x:"14",y:"3",rx:"1",key:"6d4xhi"}],["rect",{width:"7",height:"7",x:"14",y:"14",rx:"1",key:"nxv5o0"}],["rect",{width:"7",height:"7",x:"3",y:"14",rx:"1",key:"1bb6yr"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const io=ge("LineChart",[["path",{d:"M3 3v18h18",key:"1s2lah"}],["path",{d:"m19 9-5 5-4-4-3 3",key:"2osh9i"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gl=ge("Link2",[["path",{d:"M9 17H7A5 5 0 0 1 7 7h2",key:"8i5ue5"}],["path",{d:"M15 7h2a5 5 0 1 1 0 10h-2",key:"1b9ql8"}],["line",{x1:"8",x2:"16",y1:"12",y2:"12",key:"1jonct"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kx=ge("List",[["line",{x1:"8",x2:"21",y1:"6",y2:"6",key:"7ey8pc"}],["line",{x1:"8",x2:"21",y1:"12",y2:"12",key:"rjfblc"}],["line",{x1:"8",x2:"21",y1:"18",y2:"18",key:"c3b1m8"}],["line",{x1:"3",x2:"3.01",y1:"6",y2:"6",key:"1g7gq3"}],["line",{x1:"3",x2:"3.01",y1:"12",y2:"12",key:"1pjlvk"}],["line",{x1:"3",x2:"3.01",y1:"18",y2:"18",key:"28t2mc"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wa=ge("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zh=ge("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Nx=ge("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mr=ge("MapPin",[["path",{d:"M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z",key:"2oe9fu"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jx=ge("MessageCircle",[["path",{d:"m3 21 1.9-5.7a8.5 8.5 0 1 1 3.8 3.8z",key:"v2veuj"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mn=ge("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pl=ge("Moon",[["path",{d:"M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z",key:"a7tn18"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _x=ge("MoreVertical",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const em=ge("Network",[["rect",{x:"16",y:"16",width:"6",height:"6",rx:"1",key:"4q2zg0"}],["rect",{x:"2",y:"16",width:"6",height:"6",rx:"1",key:"8cvhb9"}],["rect",{x:"9",y:"2",width:"6",height:"6",rx:"1",key:"1egb70"}],["path",{d:"M5 16v-3a1 1 0 0 1 1-1h12a1 1 0 0 1 1 1v3",key:"1jsf9p"}],["path",{d:"M12 12V8",key:"2874zd"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yn=ge("Octagon",[["polygon",{points:"7.86 2 16.14 2 22 7.86 22 16.14 16.14 22 7.86 22 2 16.14 2 7.86 7.86 2",key:"h1p8hx"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ex=ge("Palette",[["circle",{cx:"13.5",cy:"6.5",r:".5",key:"1xcu5"}],["circle",{cx:"17.5",cy:"10.5",r:".5",key:"736e4u"}],["circle",{cx:"8.5",cy:"7.5",r:".5",key:"clrty"}],["circle",{cx:"6.5",cy:"12.5",r:".5",key:"1s4xz9"}],["path",{d:"M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10c.926 0 1.648-.746 1.648-1.688 0-.437-.18-.835-.437-1.125-.29-.289-.438-.652-.438-1.125a1.64 1.64 0 0 1 1.668-1.668h1.996c3.051 0 5.555-2.503 5.555-5.554C21.965 6.012 17.461 2 12 2z",key:"12rzf8"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ix=ge("PanelLeftClose",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["path",{d:"M9 3v18",key:"fh3hqa"}],["path",{d:"m16 15-3-3 3-3",key:"14y99z"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Tx=ge("PanelLeftOpen",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["path",{d:"M9 3v18",key:"fh3hqa"}],["path",{d:"m14 9 3 3-3 3",key:"8010ee"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Go=ge("PenLine",[["path",{d:"M12 20h9",key:"t2du7b"}],["path",{d:"M16.5 3.5a2.12 2.12 0 0 1 3 3L7 19l-4 1 1-4Z",key:"ymcmye"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cr=ge("PenSquare",[["path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1qinfi"}],["path",{d:"M18.5 2.5a2.12 2.12 0 0 1 3 3L12 15l-4 1 1-4Z",key:"w2jsv5"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Kd=ge("Pen",[["path",{d:"M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z",key:"5qss01"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _s=ge("Percent",[["line",{x1:"19",x2:"5",y1:"5",y2:"19",key:"1x9vlm"}],["circle",{cx:"6.5",cy:"6.5",r:"2.5",key:"4mh3h7"}],["circle",{cx:"17.5",cy:"17.5",r:"2.5",key:"1mdrzq"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Sx=ge("PieChart",[["path",{d:"M21.21 15.89A10 10 0 1 1 8 2.83",key:"k2fpak"}],["path",{d:"M22 12A10 10 0 0 0 12 2v10z",key:"1rfc4y"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oi=ge("PiggyBank",[["path",{d:"M19 5c-1.5 0-2.8 1.4-3 2-3.5-1.5-11-.3-11 5 0 1.8 0 3 2 4.5V20h4v-2h3v2h4v-4c1-.5 1.7-1 2-2h2v-4h-2c0-1-.5-1.5-1-2h0V5z",key:"uf6l00"}],["path",{d:"M2 9v1c0 1.1.9 2 2 2h1",key:"nm575m"}],["path",{d:"M16 11h0",key:"k2aug8"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ax=ge("Plane",[["path",{d:"M17.8 19.2 16 11l3.5-3.5C21 6 21.5 4 21 3c-1-.5-3 0-4.5 1.5L13 8 4.8 6.2c-.5-.1-.9.1-1.1.5l-.3.5c-.2.5-.1 1 .3 1.3L9 12l-2 3H4l-1 1 3 2 2 3 1-1v-3l3-2 3.5 5.3c.3.4.8.5 1.3.3l.5-.2c.4-.3.6-.7.5-1.2z",key:"1v9wt8"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tm=ge("PlusCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}],["path",{d:"M12 8v8",key:"napkw2"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const os=ge("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rm=ge("Radio",[["path",{d:"M4.9 19.1C1 15.2 1 8.8 4.9 4.9",key:"1vaf9d"}],["path",{d:"M7.8 16.2c-2.3-2.3-2.3-6.1 0-8.5",key:"u1ii0m"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}],["path",{d:"M16.2 7.8c2.3 2.3 2.3 6.1 0 8.5",key:"1j5fej"}],["path",{d:"M19.1 4.9C23 8.8 23 15.1 19.1 19",key:"10b0cb"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Cx=ge("RefreshCcw",[["path",{d:"M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"14sxne"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16",key:"1hlbsb"}],["path",{d:"M16 16h5v5",key:"ccwih5"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pa=ge("Rocket",[["path",{d:"M4.5 16.5c-1.5 1.26-2 5-2 5s3.74-.5 5-2c.71-.84.7-2.13-.09-2.91a2.18 2.18 0 0 0-2.91-.09z",key:"m3kijz"}],["path",{d:"m12 15-3-3a22 22 0 0 1 2-3.95A12.88 12.88 0 0 1 22 2c0 2.72-.78 7.5-6 11a22.35 22.35 0 0 1-4 2z",key:"1fmvmk"}],["path",{d:"M9 12H4s.55-3.03 2-4c1.62-1.08 5 0 5 0",key:"1f8sc4"}],["path",{d:"M12 15v5s3.03-.55 4-2c1.08-1.62 0-5 0-5",key:"qeys4"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zl=ge("Save",[["path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z",key:"1owoqh"}],["polyline",{points:"17 21 17 13 7 13 7 21",key:"1md35c"}],["polyline",{points:"7 3 7 8 15 8",key:"8nz8an"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Dx=ge("Scale",[["path",{d:"m16 16 3-8 3 8c-.87.65-1.92 1-3 1s-2.13-.35-3-1Z",key:"7g6ntu"}],["path",{d:"m2 16 3-8 3 8c-.87.65-1.92 1-3 1s-2.13-.35-3-1Z",key:"ijws7r"}],["path",{d:"M7 21h10",key:"1b0cd5"}],["path",{d:"M12 3v18",key:"108xh3"}],["path",{d:"M3 7h2c2 0 5-1 7-2 2 1 5 2 7 2h2",key:"3gwbw2"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xr=ge("ScrollText",[["path",{d:"M8 21h12a2 2 0 0 0 2-2v-2H10v2a2 2 0 1 1-4 0V5a2 2 0 1 0-4 0v3h4",key:"13a6an"}],["path",{d:"M19 17V5a2 2 0 0 0-2-2H4",key:"zz82l3"}],["path",{d:"M15 8h-5",key:"1khuty"}],["path",{d:"M15 12h-5",key:"r7krc0"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ec=ge("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vs=ge("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ra=ge("ShieldAlert",[["path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10",key:"1irkt0"}],["path",{d:"M12 8v4",key:"1got3b"}],["path",{d:"M12 16h.01",key:"1drbdi"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ma=ge("ShieldCheck",[["path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10",key:"1irkt0"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tc=ge("ShieldX",[["path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10",key:"1irkt0"}],["path",{d:"m14.5 9-5 5",key:"1m49dw"}],["path",{d:"m9.5 9 5 5",key:"wyx7zg"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const At=ge("Shield",[["path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10",key:"1irkt0"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Yd=ge("SlidersHorizontal",[["line",{x1:"21",x2:"14",y1:"4",y2:"4",key:"obuewd"}],["line",{x1:"10",x2:"3",y1:"4",y2:"4",key:"1q6298"}],["line",{x1:"21",x2:"12",y1:"12",y2:"12",key:"1iu8h1"}],["line",{x1:"8",x2:"3",y1:"12",y2:"12",key:"ntss68"}],["line",{x1:"21",x2:"16",y1:"20",y2:"20",key:"14d8ph"}],["line",{x1:"12",x2:"3",y1:"20",y2:"20",key:"m0wm8r"}],["line",{x1:"14",x2:"14",y1:"2",y2:"6",key:"14e1ph"}],["line",{x1:"8",x2:"8",y1:"10",y2:"14",key:"1i6ji0"}],["line",{x1:"16",x2:"16",y1:"18",y2:"22",key:"1lctlv"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pr=ge("Sparkles",[["path",{d:"m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z",key:"17u4zn"}],["path",{d:"M5 3v4",key:"bklmnn"}],["path",{d:"M19 17v4",key:"iiml17"}],["path",{d:"M3 5h4",key:"nem4j1"}],["path",{d:"M17 19h4",key:"lbex7p"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ko=ge("Square",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $x=ge("StickyNote",[["path",{d:"M15.5 3H5a2 2 0 0 0-2 2v14c0 1.1.9 2 2 2h14a2 2 0 0 0 2-2V8.5L15.5 3Z",key:"1wis1t"}],["path",{d:"M15 3v6h6",key:"edgan2"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xl=ge("Sun",[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"m4.93 4.93 1.41 1.41",key:"149t6j"}],["path",{d:"m17.66 17.66 1.41 1.41",key:"ptbguv"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"m6.34 17.66-1.41 1.41",key:"1m8zz5"}],["path",{d:"m19.07 4.93-1.41 1.41",key:"1shlcs"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Rx=ge("Table2",[["path",{d:"M9 3H5a2 2 0 0 0-2 2v4m6-6h10a2 2 0 0 1 2 2v4M9 3v18m0 0h10a2 2 0 0 0 2-2V9M9 21H5a2 2 0 0 1-2-2V9m0 0h18",key:"gugj83"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Px=ge("Table",[["path",{d:"M12 3v18",key:"108xh3"}],["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M3 15h18",key:"5xshup"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Mx=ge("Tag",[["path",{d:"M12 2H2v10l9.29 9.29c.94.94 2.48.94 3.42 0l6.58-6.58c.94-.94.94-2.48 0-3.42L12 2Z",key:"14b2ls"}],["path",{d:"M7 7h.01",key:"7u93v4"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const er=ge("Target",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ox=ge("Terminal",[["polyline",{points:"4 17 10 11 4 5",key:"akl6gq"}],["line",{x1:"12",x2:"20",y1:"19",y2:"19",key:"q2wloq"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vx=ge("ThumbsDown",[["path",{d:"M17 14V2",key:"8ymqnk"}],["path",{d:"M9 18.12 10 14H4.17a2 2 0 0 1-1.92-2.56l2.33-8A2 2 0 0 1 6.5 2H20a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2h-2.76a2 2 0 0 0-1.79 1.11L12 22h0a3.13 3.13 0 0 1-3-3.88Z",key:"s6e0r"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rc=ge("Timer",[["line",{x1:"10",x2:"14",y1:"2",y2:"2",key:"14vaq8"}],["line",{x1:"12",x2:"15",y1:"14",y2:"11",key:"17fdiu"}],["circle",{cx:"12",cy:"14",r:"8",key:"1e1u0o"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pt=ge("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Lx=ge("Trash",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qt=ge("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fl=ge("UserX",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"17",x2:"22",y1:"8",y2:"13",key:"3nzzx3"}],["line",{x1:"22",x2:"17",y1:"8",y2:"13",key:"1swrse"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ys=ge("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ln=ge("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fx=ge("Wallet",[["path",{d:"M21 12V7H5a2 2 0 0 1 0-4h14v4",key:"195gfw"}],["path",{d:"M3 5v14a2 2 0 0 0 2 2h16v-5",key:"195n9w"}],["path",{d:"M18 12a2 2 0 0 0 0 4h4v-4Z",key:"vllfpd"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vn=ge("Wand2",[["path",{d:"m21.64 3.64-1.28-1.28a1.21 1.21 0 0 0-1.72 0L2.36 18.64a1.21 1.21 0 0 0 0 1.72l1.28 1.28a1.2 1.2 0 0 0 1.72 0L21.64 5.36a1.2 1.2 0 0 0 0-1.72Z",key:"1bcowg"}],["path",{d:"m14 7 3 3",key:"1r5n42"}],["path",{d:"M5 6v4",key:"ilb8ba"}],["path",{d:"M19 14v4",key:"blhpug"}],["path",{d:"M10 2v2",key:"7u0qdc"}],["path",{d:"M7 8H3",key:"zfb6yr"}],["path",{d:"M21 16h-4",key:"1cnmox"}],["path",{d:"M11 3H9",key:"1obp7u"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Rt=ge("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ux=ge("ZapOff",[["polyline",{points:"12.41 6.75 13 2 10.57 4.92",key:"122m05"}],["polyline",{points:"18.57 12.91 21 10 15.66 10",key:"16r43o"}],["polyline",{points:"8 8 3 14 12 14 11 22 16 16",key:"tmh4bc"}],["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bx=ge("Zap",[["polygon",{points:"13 2 3 14 12 14 11 22 21 10 12 10 13 2",key:"45s27k"}]]),bl="/assets/logo-CxzOhvKg.png",qx=()=>{const[s,e]=E.useState("member"),[t,n]=E.useState(""),[a,i]=E.useState(""),[o,c]=E.useState(!1),[d,h]=E.useState(!1),[m,x]=E.useState(""),{login:f,user:w,isAuthenticated:$}=bt(),{theme:A,toggleTheme:T}=it(),{activateAdmin:K}=_t(),P=Vh(),[S]=mp();E.useEffect(()=>{document.body.classList.toggle("dark",A==="dark")},[A]),E.useEffect(()=>{const ee=localStorage.getItem("apevault_remembered");if(ee)try{const{login:D,password:k,type:b}=JSON.parse(ee);n(D),i(k),e(b||"member"),h(!0)}catch(D){console.error("Error loading remembered credentials:",D)}},[]),E.useEffect(()=>{var ee,D,k;if($&&w){P("/management");return}if((ee=window.Telegram)!=null&&ee.WebApp){window.Telegram.WebApp.ready(),window.Telegram.WebApp.expand();const v=S.get("tgWebAppData")||window.Telegram.WebApp.initData,j=S.get("login"),N=S.get("password");if(j&&N&&f(j,N)){P("/management");return}if(v)try{const te=new URLSearchParams(v).get("user");if(te){const le=JSON.parse(decodeURIComponent(te)).id;sessionStorage.setItem("telegram_user_id",String(le));const H=localStorage.getItem("apevault-auth");if(H)try{const ne=JSON.parse(H);if((D=ne.state)!=null&&D.user){const ce=ne.state.user;if(f(ce.login,ce.password)){P("/management");return}}}catch(ne){console.error("Error parsing saved auth:",ne)}}}catch(p){console.error("Error parsing Telegram initData:",p)}const y=(k=window.Telegram.WebApp.initDataUnsafe)==null?void 0:k.user;y&&sessionStorage.setItem("telegram_user_id",String(y.id))}},[S,$,w,P,f]);const L=ee=>{if(ee.preventDefault(),x(""),!a){x("Пожалуйста, введите пароль");return}if(s==="admin")K(a)?(d?localStorage.setItem("apevault_remembered",JSON.stringify({login:"",password:a,type:"admin"})):localStorage.removeItem("apevault_remembered"),P("/management")):x("Неверный пароль администратора");else{if(!t){x("Пожалуйста, введите логин");return}f(t,a)?(d?localStorage.setItem("apevault_remembered",JSON.stringify({login:t,password:a,type:"member"})):localStorage.removeItem("apevault_remembered"),P("/management")):x("Неверный логин или пароль")}};return r.jsxs("div",{className:`min-h-screen flex flex-col xl:flex-row ${A==="dark"?"bg-[#0b0f17]":"bg-white"}`,children:[r.jsxs("div",{className:"hidden xl:flex flex-1 relative bg-[#0b0f17] items-center justify-center p-12 overflow-hidden",children:[r.jsxs("div",{className:"absolute inset-0 pointer-events-none",children:[r.jsx("div",{className:"absolute -top-24 -left-24 w-[620px] h-[620px] bg-gradient-to-br from-[#4E6E49]/35 via-emerald-400/22 to-transparent blur-[110px]"}),r.jsx("div",{className:"absolute top-[-120px] right-[-180px] w-[780px] h-[780px] bg-gradient-to-bl from-blue-500/24 via-purple-500/22 to-transparent blur-[140px]"}),r.jsx("div",{className:"floating-grid opacity-30"})]}),r.jsxs("div",{className:"relative z-10 flex flex-col items-center text-center max-w-md",children:[r.jsx("div",{className:"w-24 h-24 sm:w-32 sm:h-32 mb-8 flex items-center justify-center animate-pulse-subtle",children:r.jsx("img",{src:bl,alt:"ApeVault",className:"w-20 h-20 sm:w-24 sm:h-24 object-contain filter drop-shadow-[0_0_15px_rgba(16,185,129,0.4)]"})}),r.jsxs("h1",{className:"text-4xl lg:text-5xl font-black text-white mb-6 tracking-tight",children:["ApeVault ",r.jsx("span",{className:"text-emerald-500",children:"Frontier"})]}),r.jsx("p",{className:"text-lg text-gray-400 font-medium leading-relaxed",children:"Единая командная панель для управления ресурсами, аналитикой и оперативного взаимодействия."}),r.jsx("div",{className:"mt-20 inline-flex items-center gap-2 px-4 py-2 rounded-full bg-white/5 border border-white/10 text-[10px] font-bold text-gray-400 uppercase tracking-widest"})]})]}),r.jsxs("div",{className:`flex-1 flex flex-col min-h-screen relative p-6 sm:p-12 lg:p-20 ${A==="dark"?"bg-[#0b0f17]":"bg-white"}`,children:[r.jsxs("div",{className:"xl:hidden flex items-center justify-between mb-12",children:[r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx("img",{src:bl,alt:"Logo",className:"w-10 h-10 object-contain"}),r.jsx("span",{className:`font-black tracking-tight ${A==="dark"?"text-white":"text-gray-900"}`,children:"ApeVault Frontier"})]}),r.jsx("button",{onClick:T,className:"p-2 rounded-xl bg-gray-100 dark:bg-white/5 text-gray-700 dark:text-amber-300",children:A==="dark"?r.jsx(xl,{className:"w-5 h-5"}):r.jsx(pl,{className:"w-5 h-5"})})]}),r.jsx("div",{className:"hidden xl:flex justify-end absolute top-8 right-8",children:r.jsx("button",{onClick:T,className:`p-3 rounded-full shadow-lg transition-all border ${A==="dark"?"bg-white/5 border-white/10 text-amber-300 hover:bg-white/10":"bg-white border-gray-100 text-gray-700 hover:bg-gray-50"}`,children:A==="dark"?r.jsx(xl,{className:"w-6 h-6"}):r.jsx(pl,{className:"w-6 h-6"})})}),r.jsxs("div",{className:"flex-1 flex flex-col justify-center max-w-md mx-auto w-full",children:[r.jsxs("div",{className:"mb-10 text-center",children:[r.jsx("h2",{className:`text-4xl font-extrabold mb-3 tracking-tight ${A==="dark"?"text-white":"text-gray-900"}`,children:"Добро пожаловать"}),r.jsxs("p",{className:"text-gray-500 dark:text-gray-400 font-medium",children:["Введите данные для входа в ",r.jsx("span",{className:"text-emerald-500 font-bold",children:"ApeVault"})]})]}),r.jsxs("div",{className:"flex p-1 bg-gray-100 dark:bg-white/5 rounded-2xl mb-8",children:[r.jsxs("button",{onClick:()=>e("member"),className:`flex-1 flex items-center justify-center gap-2 py-3 rounded-xl font-bold transition-all ${s==="member"?"bg-white dark:bg-[#4E6E49] text-[#4E6E49] dark:text-white shadow-sm":"text-gray-500 hover:text-gray-700 dark:hover:text-gray-300"}`,children:[r.jsx(Ln,{className:"w-4 h-4"}),r.jsx("span",{children:"Участник"})]}),r.jsxs("button",{onClick:()=>e("admin"),className:`flex-1 flex items-center justify-center gap-2 py-3 rounded-xl font-bold transition-all ${s==="admin"?"bg-white dark:bg-[#4E6E49] text-[#4E6E49] dark:text-white shadow-sm":"text-gray-500 hover:text-gray-700 dark:hover:text-gray-300"}`,children:[r.jsx(At,{className:"w-4 h-4"}),r.jsx("span",{children:"Админ"})]})]}),r.jsxs("form",{onSubmit:L,className:"space-y-6",children:[s==="member"&&r.jsxs("div",{className:"space-y-2",children:[r.jsx("label",{className:`text-sm font-bold block ${A==="dark"?"text-gray-400":"text-gray-600"}`,children:"Логин / Email"}),r.jsxs("div",{className:"relative group",children:[r.jsx("div",{className:"absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none text-gray-400 group-focus-within:text-emerald-500 transition-colors",children:r.jsx(Ys,{className:"w-5 h-5"})}),r.jsx("input",{type:"text",value:t,onChange:ee=>n(ee.target.value),placeholder:"agent@apevault.io",className:`w-full pl-12 pr-4 py-4 rounded-2xl border transition-all focus:outline-none focus:ring-4 focus:ring-emerald-500/10 ${A==="dark"?"bg-white/5 border-white/10 text-white placeholder-gray-600 focus:border-emerald-500":"bg-gray-50 border-gray-200 text-gray-900 placeholder-gray-400 focus:border-emerald-500"}`})]})]}),r.jsxs("div",{className:"space-y-2",children:[r.jsx("label",{className:`text-sm font-bold block ${A==="dark"?"text-gray-400":"text-gray-600"}`,children:"Пароль"}),r.jsxs("div",{className:"relative group",children:[r.jsx("div",{className:"absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none text-gray-400 group-focus-within:text-emerald-500 transition-colors",children:r.jsx(wa,{className:"w-5 h-5"})}),r.jsx("input",{type:o?"text":"password",value:a,onChange:ee=>i(ee.target.value),placeholder:"••••••••",className:`w-full pl-12 pr-12 py-4 rounded-2xl border transition-all focus:outline-none focus:ring-4 focus:ring-emerald-500/10 ${A==="dark"?"bg-white/5 border-white/10 text-white placeholder-gray-600 focus:border-emerald-500":"bg-gray-50 border-gray-200 text-gray-900 placeholder-gray-400 focus:border-emerald-500"}`}),r.jsx("button",{type:"button",onClick:()=>c(!o),className:"absolute inset-y-0 right-0 pr-4 flex items-center text-gray-400 hover:text-emerald-500 transition-colors",children:o?r.jsx(Kh,{className:"w-5 h-5"}):r.jsx(Ai,{className:"w-5 h-5"})})]})]}),r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("label",{className:"flex items-center gap-3 cursor-pointer group",children:[r.jsxs("div",{className:"relative",children:[r.jsx("input",{type:"checkbox",checked:d,onChange:ee=>h(ee.target.checked),className:"sr-only"}),r.jsx("div",{className:`w-5 h-5 rounded border transition-all flex items-center justify-center ${d?"bg-emerald-500 border-emerald-500":"border-gray-300 dark:border-white/20"}`,children:d&&r.jsx("div",{className:"w-2.5 h-2.5 bg-white rounded-sm"})})]}),r.jsx("span",{className:`text-sm font-bold ${A==="dark"?"text-gray-400":"text-gray-500"}`,children:"Запомнить меня"})]}),r.jsx("a",{href:"https://t.me/artyommedoed",target:"_blank",rel:"noopener noreferrer",className:"text-sm font-bold text-emerald-500 hover:text-emerald-600",children:"Забыли пароль?"})]}),m&&r.jsx("div",{className:"p-4 rounded-2xl bg-red-500/10 border border-red-500/20 text-red-500 text-sm font-bold animate-shake",children:m}),r.jsx("button",{type:"submit",className:"w-full py-4 px-6 rounded-2xl bg-emerald-500 hover:bg-emerald-600 text-white font-black text-lg transition-all shadow-lg shadow-emerald-500/20 hover:scale-[1.02] active:scale-[0.98]",children:"Войти в Систему"})]}),r.jsx("div",{className:"mt-12 pt-8 border-t border-gray-100 dark:border-white/5",children:r.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[r.jsxs("a",{href:"https://t.me/artyommedoed",target:"_blank",rel:"noopener noreferrer",className:`flex items-center justify-center gap-2 py-3 px-4 rounded-2xl border transition-all font-bold text-sm ${A==="dark"?"border-white/10 bg-white/5 text-white hover:bg-white/10":"border-gray-200 bg-white text-gray-700 hover:bg-gray-50 shadow-sm"}`,children:[r.jsx(At,{className:"w-4 h-4 text-emerald-500"}),r.jsx("span",{children:"Связаться с Админом"})]}),r.jsxs("a",{href:"/rules.pdf",download:!0,className:`flex items-center justify-center gap-2 py-3 px-4 rounded-2xl border transition-all font-bold text-sm ${A==="dark"?"border-white/10 bg-white/5 text-white hover:bg-white/10":"border-gray-200 bg-white text-gray-700 hover:bg-gray-50 shadow-sm"}`,children:[r.jsx(In,{className:"w-4 h-4 text-emerald-500"}),r.jsx("span",{children:"Правила Команды"})]})]})})]})]})]})};var Qd={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sm=function(s){const e=[];let t=0;for(let n=0;n<s.length;n++){let a=s.charCodeAt(n);a<128?e[t++]=a:a<2048?(e[t++]=a>>6|192,e[t++]=a&63|128):(a&64512)===55296&&n+1<s.length&&(s.charCodeAt(n+1)&64512)===56320?(a=65536+((a&1023)<<10)+(s.charCodeAt(++n)&1023),e[t++]=a>>18|240,e[t++]=a>>12&63|128,e[t++]=a>>6&63|128,e[t++]=a&63|128):(e[t++]=a>>12|224,e[t++]=a>>6&63|128,e[t++]=a&63|128)}return e},zx=function(s){const e=[];let t=0,n=0;for(;t<s.length;){const a=s[t++];if(a<128)e[n++]=String.fromCharCode(a);else if(a>191&&a<224){const i=s[t++];e[n++]=String.fromCharCode((a&31)<<6|i&63)}else if(a>239&&a<365){const i=s[t++],o=s[t++],c=s[t++],d=((a&7)<<18|(i&63)<<12|(o&63)<<6|c&63)-65536;e[n++]=String.fromCharCode(55296+(d>>10)),e[n++]=String.fromCharCode(56320+(d&1023))}else{const i=s[t++],o=s[t++];e[n++]=String.fromCharCode((a&15)<<12|(i&63)<<6|o&63)}}return e.join("")},nm={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(s,e){if(!Array.isArray(s))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,n=[];for(let a=0;a<s.length;a+=3){const i=s[a],o=a+1<s.length,c=o?s[a+1]:0,d=a+2<s.length,h=d?s[a+2]:0,m=i>>2,x=(i&3)<<4|c>>4;let f=(c&15)<<2|h>>6,w=h&63;d||(w=64,o||(f=64)),n.push(t[m],t[x],t[f],t[w])}return n.join("")},encodeString(s,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(s):this.encodeByteArray(sm(s),e)},decodeString(s,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(s):zx(this.decodeStringToByteArray(s,e))},decodeStringToByteArray(s,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,n=[];for(let a=0;a<s.length;){const i=t[s.charAt(a++)],c=a<s.length?t[s.charAt(a)]:0;++a;const h=a<s.length?t[s.charAt(a)]:64;++a;const x=a<s.length?t[s.charAt(a)]:64;if(++a,i==null||c==null||h==null||x==null)throw new Wx;const f=i<<2|c>>4;if(n.push(f),h!==64){const w=c<<4&240|h>>2;if(n.push(w),x!==64){const $=h<<6&192|x;n.push($)}}}return n},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let s=0;s<this.ENCODED_VALS.length;s++)this.byteToCharMap_[s]=this.ENCODED_VALS.charAt(s),this.charToByteMap_[this.byteToCharMap_[s]]=s,this.byteToCharMapWebSafe_[s]=this.ENCODED_VALS_WEBSAFE.charAt(s),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[s]]=s,s>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(s)]=s,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(s)]=s)}}};class Wx extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const Hx=function(s){const e=sm(s);return nm.encodeByteArray(e,!0)},Ci=function(s){return Hx(s).replace(/\./g,"")},am=function(s){try{return nm.decodeString(s,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Gx(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Kx=()=>Gx().__FIREBASE_DEFAULTS__,Yx=()=>{if(typeof process>"u"||typeof Qd>"u")return;const s=Qd.__FIREBASE_DEFAULTS__;if(s)return JSON.parse(s)},Qx=()=>{if(typeof document>"u")return;let s;try{s=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=s&&am(s[1]);return e&&JSON.parse(e)},oo=()=>{try{return Kx()||Yx()||Qx()}catch(s){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${s}`);return}},im=s=>{var e,t;return(t=(e=oo())===null||e===void 0?void 0:e.emulatorHosts)===null||t===void 0?void 0:t[s]},om=s=>{const e=im(s);if(!e)return;const t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const n=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),n]:[e.substring(0,t),n]},lm=()=>{var s;return(s=oo())===null||s===void 0?void 0:s.config},cm=s=>{var e;return(e=oo())===null||e===void 0?void 0:e[`_${s}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xx{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,n)=>{t?this.reject(t):this.resolve(n),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,n))}}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function dm(s,e){if(s.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const t={alg:"none",type:"JWT"},n=e||"demo-project",a=s.iat||0,i=s.sub||s.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o=Object.assign({iss:`https://securetoken.google.com/${n}`,aud:n,iat:a,exp:a+3600,auth_time:a,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}}},s);return[Ci(JSON.stringify(t)),Ci(JSON.stringify(o)),""].join(".")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rr(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function Jx(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(rr())}function Zx(){var s;const e=(s=oo())===null||s===void 0?void 0:s.forceEnvironment;if(e==="node")return!0;if(e==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function ef(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function tf(){const s=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof s=="object"&&s.id!==void 0}function rf(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function sf(){const s=rr();return s.indexOf("MSIE ")>=0||s.indexOf("Trident/")>=0}function nf(){return!Zx()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function af(){try{return typeof indexedDB=="object"}catch{return!1}}function of(){return new Promise((s,e)=>{try{let t=!0;const n="validate-browser-context-for-indexeddb-analytics-module",a=self.indexedDB.open(n);a.onsuccess=()=>{a.result.close(),t||self.indexedDB.deleteDatabase(n),s(!0)},a.onupgradeneeded=()=>{t=!1},a.onerror=()=>{var i;e(((i=a.error)===null||i===void 0?void 0:i.message)||"")}}catch(t){e(t)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lf="FirebaseError";class Wr extends Error{constructor(e,t,n){super(t),this.code=e,this.customData=n,this.name=lf,Object.setPrototypeOf(this,Wr.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Oa.prototype.create)}}class Oa{constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(e,...t){const n=t[0]||{},a=`${this.service}/${e}`,i=this.errors[e],o=i?cf(i,n):"Error",c=`${this.serviceName}: ${o} (${a}).`;return new Wr(a,c,n)}}function cf(s,e){return s.replace(df,(t,n)=>{const a=e[n];return a!=null?String(a):`<${n}?>`})}const df=/\{\$([^}]+)}/g;function uf(s){for(const e in s)if(Object.prototype.hasOwnProperty.call(s,e))return!1;return!0}function Di(s,e){if(s===e)return!0;const t=Object.keys(s),n=Object.keys(e);for(const a of t){if(!n.includes(a))return!1;const i=s[a],o=e[a];if(Xd(i)&&Xd(o)){if(!Di(i,o))return!1}else if(i!==o)return!1}for(const a of n)if(!t.includes(a))return!1;return!0}function Xd(s){return s!==null&&typeof s=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Va(s){const e=[];for(const[t,n]of Object.entries(s))Array.isArray(n)?n.forEach(a=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(a))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(n));return e.length?"&"+e.join("&"):""}function hf(s,e){const t=new mf(s,e);return t.subscribe.bind(t)}class mf{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(n=>{this.error(n)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,n){let a;if(e===void 0&&t===void 0&&n===void 0)throw new Error("Missing Observer.");gf(e,["next","error","complete"])?a=e:a={next:e,error:t,complete:n},a.next===void 0&&(a.next=Yo),a.error===void 0&&(a.error=Yo),a.complete===void 0&&(a.complete=Yo);const i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?a.error(this.finalError):a.complete()}catch{}}),this.observers.push(a),i}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(n){typeof console<"u"&&console.error&&console.error(n)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function gf(s,e){if(typeof s!="object"||s===null)return!1;for(const t of e)if(t in s&&typeof s[t]=="function")return!0;return!1}function Yo(){}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sr(s){return s&&s._delegate?s._delegate:s}class Rs{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zs="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pf{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const n=new Xx;if(this.instancesDeferred.set(t,n),this.isInitialized(t)||this.shouldAutoInitialize())try{const a=this.getOrInitializeService({instanceIdentifier:t});a&&n.resolve(a)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const n=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),a=(t=e==null?void 0:e.optional)!==null&&t!==void 0?t:!1;if(this.isInitialized(n)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:n})}catch(i){if(a)return null;throw i}else{if(a)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(ff(e))try{this.getOrInitializeService({instanceIdentifier:zs})}catch{}for(const[t,n]of this.instancesDeferred.entries()){const a=this.normalizeInstanceIdentifier(t);try{const i=this.getOrInitializeService({instanceIdentifier:a});n.resolve(i)}catch{}}}}clearInstance(e=zs){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=zs){return this.instances.has(e)}getOptions(e=zs){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,n=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const a=this.getOrInitializeService({instanceIdentifier:n,options:t});for(const[i,o]of this.instancesDeferred.entries()){const c=this.normalizeInstanceIdentifier(i);n===c&&o.resolve(a)}return a}onInit(e,t){var n;const a=this.normalizeInstanceIdentifier(t),i=(n=this.onInitCallbacks.get(a))!==null&&n!==void 0?n:new Set;i.add(e),this.onInitCallbacks.set(a,i);const o=this.instances.get(a);return o&&e(o,a),()=>{i.delete(e)}}invokeOnInitCallbacks(e,t){const n=this.onInitCallbacks.get(t);if(n)for(const a of n)try{a(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let n=this.instances.get(e);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:xf(e),options:t}),this.instances.set(e,n),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(n,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,n)}catch{}return n||null}normalizeInstanceIdentifier(e=zs){return this.component?this.component.multipleInstances?e:zs:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function xf(s){return s===zs?void 0:s}function ff(s){return s.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bf{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new pf(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var st;(function(s){s[s.DEBUG=0]="DEBUG",s[s.VERBOSE=1]="VERBOSE",s[s.INFO=2]="INFO",s[s.WARN=3]="WARN",s[s.ERROR=4]="ERROR",s[s.SILENT=5]="SILENT"})(st||(st={}));const yf={debug:st.DEBUG,verbose:st.VERBOSE,info:st.INFO,warn:st.WARN,error:st.ERROR,silent:st.SILENT},vf=st.INFO,wf={[st.DEBUG]:"log",[st.VERBOSE]:"log",[st.INFO]:"info",[st.WARN]:"warn",[st.ERROR]:"error"},kf=(s,e,...t)=>{if(e<s.logLevel)return;const n=new Date().toISOString(),a=wf[e];if(a)console[a](`[${n}]  ${s.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class sc{constructor(e){this.name=e,this._logLevel=vf,this._logHandler=kf,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in st))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?yf[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,st.DEBUG,...e),this._logHandler(this,st.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,st.VERBOSE,...e),this._logHandler(this,st.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,st.INFO,...e),this._logHandler(this,st.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,st.WARN,...e),this._logHandler(this,st.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,st.ERROR,...e),this._logHandler(this,st.ERROR,...e)}}const Nf=(s,e)=>e.some(t=>s instanceof t);let Jd,Zd;function jf(){return Jd||(Jd=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function _f(){return Zd||(Zd=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const um=new WeakMap,yl=new WeakMap,hm=new WeakMap,Qo=new WeakMap,nc=new WeakMap;function Ef(s){const e=new Promise((t,n)=>{const a=()=>{s.removeEventListener("success",i),s.removeEventListener("error",o)},i=()=>{t(As(s.result)),a()},o=()=>{n(s.error),a()};s.addEventListener("success",i),s.addEventListener("error",o)});return e.then(t=>{t instanceof IDBCursor&&um.set(t,s)}).catch(()=>{}),nc.set(e,s),e}function If(s){if(yl.has(s))return;const e=new Promise((t,n)=>{const a=()=>{s.removeEventListener("complete",i),s.removeEventListener("error",o),s.removeEventListener("abort",o)},i=()=>{t(),a()},o=()=>{n(s.error||new DOMException("AbortError","AbortError")),a()};s.addEventListener("complete",i),s.addEventListener("error",o),s.addEventListener("abort",o)});yl.set(s,e)}let vl={get(s,e,t){if(s instanceof IDBTransaction){if(e==="done")return yl.get(s);if(e==="objectStoreNames")return s.objectStoreNames||hm.get(s);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return As(s[e])},set(s,e,t){return s[e]=t,!0},has(s,e){return s instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in s}};function Tf(s){vl=s(vl)}function Sf(s){return s===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const n=s.call(Xo(this),e,...t);return hm.set(n,e.sort?e.sort():[e]),As(n)}:_f().includes(s)?function(...e){return s.apply(Xo(this),e),As(um.get(this))}:function(...e){return As(s.apply(Xo(this),e))}}function Af(s){return typeof s=="function"?Sf(s):(s instanceof IDBTransaction&&If(s),Nf(s,jf())?new Proxy(s,vl):s)}function As(s){if(s instanceof IDBRequest)return Ef(s);if(Qo.has(s))return Qo.get(s);const e=Af(s);return e!==s&&(Qo.set(s,e),nc.set(e,s)),e}const Xo=s=>nc.get(s);function Cf(s,e,{blocked:t,upgrade:n,blocking:a,terminated:i}={}){const o=indexedDB.open(s,e),c=As(o);return n&&o.addEventListener("upgradeneeded",d=>{n(As(o.result),d.oldVersion,d.newVersion,As(o.transaction),d)}),t&&o.addEventListener("blocked",d=>t(d.oldVersion,d.newVersion,d)),c.then(d=>{i&&d.addEventListener("close",()=>i()),a&&d.addEventListener("versionchange",h=>a(h.oldVersion,h.newVersion,h))}).catch(()=>{}),c}const Df=["get","getKey","getAll","getAllKeys","count"],$f=["put","add","delete","clear"],Jo=new Map;function eu(s,e){if(!(s instanceof IDBDatabase&&!(e in s)&&typeof e=="string"))return;if(Jo.get(e))return Jo.get(e);const t=e.replace(/FromIndex$/,""),n=e!==t,a=$f.includes(t);if(!(t in(n?IDBIndex:IDBObjectStore).prototype)||!(a||Df.includes(t)))return;const i=async function(o,...c){const d=this.transaction(o,a?"readwrite":"readonly");let h=d.store;return n&&(h=h.index(c.shift())),(await Promise.all([h[t](...c),a&&d.done]))[0]};return Jo.set(e,i),i}Tf(s=>({...s,get:(e,t,n)=>eu(e,t)||s.get(e,t,n),has:(e,t)=>!!eu(e,t)||s.has(e,t)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rf{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(Pf(t)){const n=t.getImmediate();return`${n.library}/${n.version}`}else return null}).filter(t=>t).join(" ")}}function Pf(s){const e=s.getComponent();return(e==null?void 0:e.type)==="VERSION"}const wl="@firebase/app",tu="0.10.13";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ls=new sc("@firebase/app"),Mf="@firebase/app-compat",Of="@firebase/analytics-compat",Vf="@firebase/analytics",Lf="@firebase/app-check-compat",Ff="@firebase/app-check",Uf="@firebase/auth",Bf="@firebase/auth-compat",qf="@firebase/database",zf="@firebase/data-connect",Wf="@firebase/database-compat",Hf="@firebase/functions",Gf="@firebase/functions-compat",Kf="@firebase/installations",Yf="@firebase/installations-compat",Qf="@firebase/messaging",Xf="@firebase/messaging-compat",Jf="@firebase/performance",Zf="@firebase/performance-compat",eb="@firebase/remote-config",tb="@firebase/remote-config-compat",rb="@firebase/storage",sb="@firebase/storage-compat",nb="@firebase/firestore",ab="@firebase/vertexai-preview",ib="@firebase/firestore-compat",ob="firebase",lb="10.14.1";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kl="[DEFAULT]",cb={[wl]:"fire-core",[Mf]:"fire-core-compat",[Vf]:"fire-analytics",[Of]:"fire-analytics-compat",[Ff]:"fire-app-check",[Lf]:"fire-app-check-compat",[Uf]:"fire-auth",[Bf]:"fire-auth-compat",[qf]:"fire-rtdb",[zf]:"fire-data-connect",[Wf]:"fire-rtdb-compat",[Hf]:"fire-fn",[Gf]:"fire-fn-compat",[Kf]:"fire-iid",[Yf]:"fire-iid-compat",[Qf]:"fire-fcm",[Xf]:"fire-fcm-compat",[Jf]:"fire-perf",[Zf]:"fire-perf-compat",[eb]:"fire-rc",[tb]:"fire-rc-compat",[rb]:"fire-gcs",[sb]:"fire-gcs-compat",[nb]:"fire-fst",[ib]:"fire-fst-compat",[ab]:"fire-vertex","fire-js":"fire-js",[ob]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $i=new Map,db=new Map,Nl=new Map;function ru(s,e){try{s.container.addComponent(e)}catch(t){ls.debug(`Component ${e.name} failed to register with FirebaseApp ${s.name}`,t)}}function Js(s){const e=s.name;if(Nl.has(e))return ls.debug(`There were multiple attempts to register component ${e}.`),!1;Nl.set(e,s);for(const t of $i.values())ru(t,s);for(const t of db.values())ru(t,s);return!0}function lo(s,e){const t=s.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),s.container.getProvider(e)}function Es(s){return s.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ub={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},Cs=new Oa("app","Firebase",ub);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hb{constructor(e,t,n){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new Rs("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Cs.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sn=lb;function mm(s,e={}){let t=s;typeof e!="object"&&(e={name:e});const n=Object.assign({name:kl,automaticDataCollectionEnabled:!1},e),a=n.name;if(typeof a!="string"||!a)throw Cs.create("bad-app-name",{appName:String(a)});if(t||(t=lm()),!t)throw Cs.create("no-options");const i=$i.get(a);if(i){if(Di(t,i.options)&&Di(n,i.config))return i;throw Cs.create("duplicate-app",{appName:a})}const o=new bf(a);for(const d of Nl.values())o.addComponent(d);const c=new hb(t,n,o);return $i.set(a,c),c}function ac(s=kl){const e=$i.get(s);if(!e&&s===kl&&lm())return mm();if(!e)throw Cs.create("no-app",{appName:s});return e}function Or(s,e,t){var n;let a=(n=cb[s])!==null&&n!==void 0?n:s;t&&(a+=`-${t}`);const i=a.match(/\s|\//),o=e.match(/\s|\//);if(i||o){const c=[`Unable to register library "${a}" with version "${e}":`];i&&c.push(`library name "${a}" contains illegal characters (whitespace or "/")`),i&&o&&c.push("and"),o&&c.push(`version name "${e}" contains illegal characters (whitespace or "/")`),ls.warn(c.join(" "));return}Js(new Rs(`${a}-version`,()=>({library:a,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mb="firebase-heartbeat-database",gb=1,ka="firebase-heartbeat-store";let Zo=null;function gm(){return Zo||(Zo=Cf(mb,gb,{upgrade:(s,e)=>{switch(e){case 0:try{s.createObjectStore(ka)}catch(t){console.warn(t)}}}}).catch(s=>{throw Cs.create("idb-open",{originalErrorMessage:s.message})})),Zo}async function pb(s){try{const t=(await gm()).transaction(ka),n=await t.objectStore(ka).get(pm(s));return await t.done,n}catch(e){if(e instanceof Wr)ls.warn(e.message);else{const t=Cs.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});ls.warn(t.message)}}}async function su(s,e){try{const n=(await gm()).transaction(ka,"readwrite");await n.objectStore(ka).put(e,pm(s)),await n.done}catch(t){if(t instanceof Wr)ls.warn(t.message);else{const n=Cs.create("idb-set",{originalErrorMessage:t==null?void 0:t.message});ls.warn(n.message)}}}function pm(s){return`${s.name}!${s.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xb=1024,fb=30*24*60*60*1e3;class bb{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new vb(t),this._heartbeatsCachePromise=this._storage.read().then(n=>(this._heartbeatsCache=n,n))}async triggerHeartbeat(){var e,t;try{const a=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),i=nu();return((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===i||this._heartbeatsCache.heartbeats.some(o=>o.date===i)?void 0:(this._heartbeatsCache.heartbeats.push({date:i,agent:a}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(o=>{const c=new Date(o.date).valueOf();return Date.now()-c<=fb}),this._storage.overwrite(this._heartbeatsCache))}catch(n){ls.warn(n)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const t=nu(),{heartbeatsToSend:n,unsentEntries:a}=yb(this._heartbeatsCache.heartbeats),i=Ci(JSON.stringify({version:2,heartbeats:n}));return this._heartbeatsCache.lastSentHeartbeatDate=t,a.length>0?(this._heartbeatsCache.heartbeats=a,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(t){return ls.warn(t),""}}}function nu(){return new Date().toISOString().substring(0,10)}function yb(s,e=xb){const t=[];let n=s.slice();for(const a of s){const i=t.find(o=>o.agent===a.agent);if(i){if(i.dates.push(a.date),au(t)>e){i.dates.pop();break}}else if(t.push({agent:a.agent,dates:[a.date]}),au(t)>e){t.pop();break}n=n.slice(1)}return{heartbeatsToSend:t,unsentEntries:n}}class vb{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return af()?of().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const t=await pb(this.app);return t!=null&&t.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){const a=await this.read();return su(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:a.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){var t;if(await this._canUseIndexedDBPromise){const a=await this.read();return su(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:a.lastSentHeartbeatDate,heartbeats:[...a.heartbeats,...e.heartbeats]})}else return}}function au(s){return Ci(JSON.stringify({version:2,heartbeats:s})).length}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wb(s){Js(new Rs("platform-logger",e=>new Rf(e),"PRIVATE")),Js(new Rs("heartbeat",e=>new bb(e),"PRIVATE")),Or(wl,tu,s),Or(wl,tu,"esm2017"),Or("fire-js","")}wb("");var iu=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var Qs,xm;(function(){var s;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(k,b){function v(){}v.prototype=b.prototype,k.D=b.prototype,k.prototype=new v,k.prototype.constructor=k,k.C=function(j,N,y){for(var p=Array(arguments.length-2),te=2;te<arguments.length;te++)p[te-2]=arguments[te];return b.prototype[N].apply(j,p)}}function t(){this.blockSize=-1}function n(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(n,t),n.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function a(k,b,v){v||(v=0);var j=Array(16);if(typeof b=="string")for(var N=0;16>N;++N)j[N]=b.charCodeAt(v++)|b.charCodeAt(v++)<<8|b.charCodeAt(v++)<<16|b.charCodeAt(v++)<<24;else for(N=0;16>N;++N)j[N]=b[v++]|b[v++]<<8|b[v++]<<16|b[v++]<<24;b=k.g[0],v=k.g[1],N=k.g[2];var y=k.g[3],p=b+(y^v&(N^y))+j[0]+3614090360&4294967295;b=v+(p<<7&4294967295|p>>>25),p=y+(N^b&(v^N))+j[1]+3905402710&4294967295,y=b+(p<<12&4294967295|p>>>20),p=N+(v^y&(b^v))+j[2]+606105819&4294967295,N=y+(p<<17&4294967295|p>>>15),p=v+(b^N&(y^b))+j[3]+3250441966&4294967295,v=N+(p<<22&4294967295|p>>>10),p=b+(y^v&(N^y))+j[4]+4118548399&4294967295,b=v+(p<<7&4294967295|p>>>25),p=y+(N^b&(v^N))+j[5]+1200080426&4294967295,y=b+(p<<12&4294967295|p>>>20),p=N+(v^y&(b^v))+j[6]+2821735955&4294967295,N=y+(p<<17&4294967295|p>>>15),p=v+(b^N&(y^b))+j[7]+4249261313&4294967295,v=N+(p<<22&4294967295|p>>>10),p=b+(y^v&(N^y))+j[8]+1770035416&4294967295,b=v+(p<<7&4294967295|p>>>25),p=y+(N^b&(v^N))+j[9]+2336552879&4294967295,y=b+(p<<12&4294967295|p>>>20),p=N+(v^y&(b^v))+j[10]+4294925233&4294967295,N=y+(p<<17&4294967295|p>>>15),p=v+(b^N&(y^b))+j[11]+2304563134&4294967295,v=N+(p<<22&4294967295|p>>>10),p=b+(y^v&(N^y))+j[12]+1804603682&4294967295,b=v+(p<<7&4294967295|p>>>25),p=y+(N^b&(v^N))+j[13]+4254626195&4294967295,y=b+(p<<12&4294967295|p>>>20),p=N+(v^y&(b^v))+j[14]+2792965006&4294967295,N=y+(p<<17&4294967295|p>>>15),p=v+(b^N&(y^b))+j[15]+1236535329&4294967295,v=N+(p<<22&4294967295|p>>>10),p=b+(N^y&(v^N))+j[1]+4129170786&4294967295,b=v+(p<<5&4294967295|p>>>27),p=y+(v^N&(b^v))+j[6]+3225465664&4294967295,y=b+(p<<9&4294967295|p>>>23),p=N+(b^v&(y^b))+j[11]+643717713&4294967295,N=y+(p<<14&4294967295|p>>>18),p=v+(y^b&(N^y))+j[0]+3921069994&4294967295,v=N+(p<<20&4294967295|p>>>12),p=b+(N^y&(v^N))+j[5]+3593408605&4294967295,b=v+(p<<5&4294967295|p>>>27),p=y+(v^N&(b^v))+j[10]+38016083&4294967295,y=b+(p<<9&4294967295|p>>>23),p=N+(b^v&(y^b))+j[15]+3634488961&4294967295,N=y+(p<<14&4294967295|p>>>18),p=v+(y^b&(N^y))+j[4]+3889429448&4294967295,v=N+(p<<20&4294967295|p>>>12),p=b+(N^y&(v^N))+j[9]+568446438&4294967295,b=v+(p<<5&4294967295|p>>>27),p=y+(v^N&(b^v))+j[14]+3275163606&4294967295,y=b+(p<<9&4294967295|p>>>23),p=N+(b^v&(y^b))+j[3]+4107603335&4294967295,N=y+(p<<14&4294967295|p>>>18),p=v+(y^b&(N^y))+j[8]+1163531501&4294967295,v=N+(p<<20&4294967295|p>>>12),p=b+(N^y&(v^N))+j[13]+2850285829&4294967295,b=v+(p<<5&4294967295|p>>>27),p=y+(v^N&(b^v))+j[2]+4243563512&4294967295,y=b+(p<<9&4294967295|p>>>23),p=N+(b^v&(y^b))+j[7]+1735328473&4294967295,N=y+(p<<14&4294967295|p>>>18),p=v+(y^b&(N^y))+j[12]+2368359562&4294967295,v=N+(p<<20&4294967295|p>>>12),p=b+(v^N^y)+j[5]+4294588738&4294967295,b=v+(p<<4&4294967295|p>>>28),p=y+(b^v^N)+j[8]+2272392833&4294967295,y=b+(p<<11&4294967295|p>>>21),p=N+(y^b^v)+j[11]+1839030562&4294967295,N=y+(p<<16&4294967295|p>>>16),p=v+(N^y^b)+j[14]+4259657740&4294967295,v=N+(p<<23&4294967295|p>>>9),p=b+(v^N^y)+j[1]+2763975236&4294967295,b=v+(p<<4&4294967295|p>>>28),p=y+(b^v^N)+j[4]+1272893353&4294967295,y=b+(p<<11&4294967295|p>>>21),p=N+(y^b^v)+j[7]+4139469664&4294967295,N=y+(p<<16&4294967295|p>>>16),p=v+(N^y^b)+j[10]+3200236656&4294967295,v=N+(p<<23&4294967295|p>>>9),p=b+(v^N^y)+j[13]+681279174&4294967295,b=v+(p<<4&4294967295|p>>>28),p=y+(b^v^N)+j[0]+3936430074&4294967295,y=b+(p<<11&4294967295|p>>>21),p=N+(y^b^v)+j[3]+3572445317&4294967295,N=y+(p<<16&4294967295|p>>>16),p=v+(N^y^b)+j[6]+76029189&4294967295,v=N+(p<<23&4294967295|p>>>9),p=b+(v^N^y)+j[9]+3654602809&4294967295,b=v+(p<<4&4294967295|p>>>28),p=y+(b^v^N)+j[12]+3873151461&4294967295,y=b+(p<<11&4294967295|p>>>21),p=N+(y^b^v)+j[15]+530742520&4294967295,N=y+(p<<16&4294967295|p>>>16),p=v+(N^y^b)+j[2]+3299628645&4294967295,v=N+(p<<23&4294967295|p>>>9),p=b+(N^(v|~y))+j[0]+4096336452&4294967295,b=v+(p<<6&4294967295|p>>>26),p=y+(v^(b|~N))+j[7]+1126891415&4294967295,y=b+(p<<10&4294967295|p>>>22),p=N+(b^(y|~v))+j[14]+2878612391&4294967295,N=y+(p<<15&4294967295|p>>>17),p=v+(y^(N|~b))+j[5]+4237533241&4294967295,v=N+(p<<21&4294967295|p>>>11),p=b+(N^(v|~y))+j[12]+1700485571&4294967295,b=v+(p<<6&4294967295|p>>>26),p=y+(v^(b|~N))+j[3]+2399980690&4294967295,y=b+(p<<10&4294967295|p>>>22),p=N+(b^(y|~v))+j[10]+4293915773&4294967295,N=y+(p<<15&4294967295|p>>>17),p=v+(y^(N|~b))+j[1]+2240044497&4294967295,v=N+(p<<21&4294967295|p>>>11),p=b+(N^(v|~y))+j[8]+1873313359&4294967295,b=v+(p<<6&4294967295|p>>>26),p=y+(v^(b|~N))+j[15]+4264355552&4294967295,y=b+(p<<10&4294967295|p>>>22),p=N+(b^(y|~v))+j[6]+2734768916&4294967295,N=y+(p<<15&4294967295|p>>>17),p=v+(y^(N|~b))+j[13]+1309151649&4294967295,v=N+(p<<21&4294967295|p>>>11),p=b+(N^(v|~y))+j[4]+4149444226&4294967295,b=v+(p<<6&4294967295|p>>>26),p=y+(v^(b|~N))+j[11]+3174756917&4294967295,y=b+(p<<10&4294967295|p>>>22),p=N+(b^(y|~v))+j[2]+718787259&4294967295,N=y+(p<<15&4294967295|p>>>17),p=v+(y^(N|~b))+j[9]+3951481745&4294967295,k.g[0]=k.g[0]+b&4294967295,k.g[1]=k.g[1]+(N+(p<<21&4294967295|p>>>11))&4294967295,k.g[2]=k.g[2]+N&4294967295,k.g[3]=k.g[3]+y&4294967295}n.prototype.u=function(k,b){b===void 0&&(b=k.length);for(var v=b-this.blockSize,j=this.B,N=this.h,y=0;y<b;){if(N==0)for(;y<=v;)a(this,k,y),y+=this.blockSize;if(typeof k=="string"){for(;y<b;)if(j[N++]=k.charCodeAt(y++),N==this.blockSize){a(this,j),N=0;break}}else for(;y<b;)if(j[N++]=k[y++],N==this.blockSize){a(this,j),N=0;break}}this.h=N,this.o+=b},n.prototype.v=function(){var k=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);k[0]=128;for(var b=1;b<k.length-8;++b)k[b]=0;var v=8*this.o;for(b=k.length-8;b<k.length;++b)k[b]=v&255,v/=256;for(this.u(k),k=Array(16),b=v=0;4>b;++b)for(var j=0;32>j;j+=8)k[v++]=this.g[b]>>>j&255;return k};function i(k,b){var v=c;return Object.prototype.hasOwnProperty.call(v,k)?v[k]:v[k]=b(k)}function o(k,b){this.h=b;for(var v=[],j=!0,N=k.length-1;0<=N;N--){var y=k[N]|0;j&&y==b||(v[N]=y,j=!1)}this.g=v}var c={};function d(k){return-128<=k&&128>k?i(k,function(b){return new o([b|0],0>b?-1:0)}):new o([k|0],0>k?-1:0)}function h(k){if(isNaN(k)||!isFinite(k))return x;if(0>k)return T(h(-k));for(var b=[],v=1,j=0;k>=v;j++)b[j]=k/v|0,v*=4294967296;return new o(b,0)}function m(k,b){if(k.length==0)throw Error("number format error: empty string");if(b=b||10,2>b||36<b)throw Error("radix out of range: "+b);if(k.charAt(0)=="-")return T(m(k.substring(1),b));if(0<=k.indexOf("-"))throw Error('number format error: interior "-" character');for(var v=h(Math.pow(b,8)),j=x,N=0;N<k.length;N+=8){var y=Math.min(8,k.length-N),p=parseInt(k.substring(N,N+y),b);8>y?(y=h(Math.pow(b,y)),j=j.j(y).add(h(p))):(j=j.j(v),j=j.add(h(p)))}return j}var x=d(0),f=d(1),w=d(16777216);s=o.prototype,s.m=function(){if(A(this))return-T(this).m();for(var k=0,b=1,v=0;v<this.g.length;v++){var j=this.i(v);k+=(0<=j?j:4294967296+j)*b,b*=4294967296}return k},s.toString=function(k){if(k=k||10,2>k||36<k)throw Error("radix out of range: "+k);if($(this))return"0";if(A(this))return"-"+T(this).toString(k);for(var b=h(Math.pow(k,6)),v=this,j="";;){var N=L(v,b).g;v=K(v,N.j(b));var y=((0<v.g.length?v.g[0]:v.h)>>>0).toString(k);if(v=N,$(v))return y+j;for(;6>y.length;)y="0"+y;j=y+j}},s.i=function(k){return 0>k?0:k<this.g.length?this.g[k]:this.h};function $(k){if(k.h!=0)return!1;for(var b=0;b<k.g.length;b++)if(k.g[b]!=0)return!1;return!0}function A(k){return k.h==-1}s.l=function(k){return k=K(this,k),A(k)?-1:$(k)?0:1};function T(k){for(var b=k.g.length,v=[],j=0;j<b;j++)v[j]=~k.g[j];return new o(v,~k.h).add(f)}s.abs=function(){return A(this)?T(this):this},s.add=function(k){for(var b=Math.max(this.g.length,k.g.length),v=[],j=0,N=0;N<=b;N++){var y=j+(this.i(N)&65535)+(k.i(N)&65535),p=(y>>>16)+(this.i(N)>>>16)+(k.i(N)>>>16);j=p>>>16,y&=65535,p&=65535,v[N]=p<<16|y}return new o(v,v[v.length-1]&-2147483648?-1:0)};function K(k,b){return k.add(T(b))}s.j=function(k){if($(this)||$(k))return x;if(A(this))return A(k)?T(this).j(T(k)):T(T(this).j(k));if(A(k))return T(this.j(T(k)));if(0>this.l(w)&&0>k.l(w))return h(this.m()*k.m());for(var b=this.g.length+k.g.length,v=[],j=0;j<2*b;j++)v[j]=0;for(j=0;j<this.g.length;j++)for(var N=0;N<k.g.length;N++){var y=this.i(j)>>>16,p=this.i(j)&65535,te=k.i(N)>>>16,ue=k.i(N)&65535;v[2*j+2*N]+=p*ue,P(v,2*j+2*N),v[2*j+2*N+1]+=y*ue,P(v,2*j+2*N+1),v[2*j+2*N+1]+=p*te,P(v,2*j+2*N+1),v[2*j+2*N+2]+=y*te,P(v,2*j+2*N+2)}for(j=0;j<b;j++)v[j]=v[2*j+1]<<16|v[2*j];for(j=b;j<2*b;j++)v[j]=0;return new o(v,0)};function P(k,b){for(;(k[b]&65535)!=k[b];)k[b+1]+=k[b]>>>16,k[b]&=65535,b++}function S(k,b){this.g=k,this.h=b}function L(k,b){if($(b))throw Error("division by zero");if($(k))return new S(x,x);if(A(k))return b=L(T(k),b),new S(T(b.g),T(b.h));if(A(b))return b=L(k,T(b)),new S(T(b.g),b.h);if(30<k.g.length){if(A(k)||A(b))throw Error("slowDivide_ only works with positive integers.");for(var v=f,j=b;0>=j.l(k);)v=ee(v),j=ee(j);var N=D(v,1),y=D(j,1);for(j=D(j,2),v=D(v,2);!$(j);){var p=y.add(j);0>=p.l(k)&&(N=N.add(v),y=p),j=D(j,1),v=D(v,1)}return b=K(k,N.j(b)),new S(N,b)}for(N=x;0<=k.l(b);){for(v=Math.max(1,Math.floor(k.m()/b.m())),j=Math.ceil(Math.log(v)/Math.LN2),j=48>=j?1:Math.pow(2,j-48),y=h(v),p=y.j(b);A(p)||0<p.l(k);)v-=j,y=h(v),p=y.j(b);$(y)&&(y=f),N=N.add(y),k=K(k,p)}return new S(N,k)}s.A=function(k){return L(this,k).h},s.and=function(k){for(var b=Math.max(this.g.length,k.g.length),v=[],j=0;j<b;j++)v[j]=this.i(j)&k.i(j);return new o(v,this.h&k.h)},s.or=function(k){for(var b=Math.max(this.g.length,k.g.length),v=[],j=0;j<b;j++)v[j]=this.i(j)|k.i(j);return new o(v,this.h|k.h)},s.xor=function(k){for(var b=Math.max(this.g.length,k.g.length),v=[],j=0;j<b;j++)v[j]=this.i(j)^k.i(j);return new o(v,this.h^k.h)};function ee(k){for(var b=k.g.length+1,v=[],j=0;j<b;j++)v[j]=k.i(j)<<1|k.i(j-1)>>>31;return new o(v,k.h)}function D(k,b){var v=b>>5;b%=32;for(var j=k.g.length-v,N=[],y=0;y<j;y++)N[y]=0<b?k.i(y+v)>>>b|k.i(y+v+1)<<32-b:k.i(y+v);return new o(N,k.h)}n.prototype.digest=n.prototype.v,n.prototype.reset=n.prototype.s,n.prototype.update=n.prototype.u,xm=n,o.prototype.add=o.prototype.add,o.prototype.multiply=o.prototype.j,o.prototype.modulo=o.prototype.A,o.prototype.compare=o.prototype.l,o.prototype.toNumber=o.prototype.m,o.prototype.toString=o.prototype.toString,o.prototype.getBits=o.prototype.i,o.fromNumber=h,o.fromString=m,Qs=o}).apply(typeof iu<"u"?iu:typeof self<"u"?self:typeof window<"u"?window:{});var li=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var fm,la,bm,bi,jl,ym,vm,wm;(function(){var s,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(l,u,g){return l==Array.prototype||l==Object.prototype||(l[u]=g.value),l};function t(l){l=[typeof globalThis=="object"&&globalThis,l,typeof window=="object"&&window,typeof self=="object"&&self,typeof li=="object"&&li];for(var u=0;u<l.length;++u){var g=l[u];if(g&&g.Math==Math)return g}throw Error("Cannot find global object")}var n=t(this);function a(l,u){if(u)e:{var g=n;l=l.split(".");for(var _=0;_<l.length-1;_++){var X=l[_];if(!(X in g))break e;g=g[X]}l=l[l.length-1],_=g[l],u=u(_),u!=_&&u!=null&&e(g,l,{configurable:!0,writable:!0,value:u})}}function i(l,u){l instanceof String&&(l+="");var g=0,_=!1,X={next:function(){if(!_&&g<l.length){var se=g++;return{value:u(se,l[se]),done:!1}}return _=!0,{done:!0,value:void 0}}};return X[Symbol.iterator]=function(){return X},X}a("Array.prototype.values",function(l){return l||function(){return i(this,function(u,g){return g})}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var o=o||{},c=this||self;function d(l){var u=typeof l;return u=u!="object"?u:l?Array.isArray(l)?"array":u:"null",u=="array"||u=="object"&&typeof l.length=="number"}function h(l){var u=typeof l;return u=="object"&&l!=null||u=="function"}function m(l,u,g){return l.call.apply(l.bind,arguments)}function x(l,u,g){if(!l)throw Error();if(2<arguments.length){var _=Array.prototype.slice.call(arguments,2);return function(){var X=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(X,_),l.apply(u,X)}}return function(){return l.apply(u,arguments)}}function f(l,u,g){return f=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?m:x,f.apply(null,arguments)}function w(l,u){var g=Array.prototype.slice.call(arguments,1);return function(){var _=g.slice();return _.push.apply(_,arguments),l.apply(this,_)}}function $(l,u){function g(){}g.prototype=u.prototype,l.aa=u.prototype,l.prototype=new g,l.prototype.constructor=l,l.Qb=function(_,X,se){for(var ke=Array(arguments.length-2),ft=2;ft<arguments.length;ft++)ke[ft-2]=arguments[ft];return u.prototype[X].apply(_,ke)}}function A(l){const u=l.length;if(0<u){const g=Array(u);for(let _=0;_<u;_++)g[_]=l[_];return g}return[]}function T(l,u){for(let g=1;g<arguments.length;g++){const _=arguments[g];if(d(_)){const X=l.length||0,se=_.length||0;l.length=X+se;for(let ke=0;ke<se;ke++)l[X+ke]=_[ke]}else l.push(_)}}class K{constructor(u,g){this.i=u,this.j=g,this.h=0,this.g=null}get(){let u;return 0<this.h?(this.h--,u=this.g,this.g=u.next,u.next=null):u=this.i(),u}}function P(l){return/^[\s\xa0]*$/.test(l)}function S(){var l=c.navigator;return l&&(l=l.userAgent)?l:""}function L(l){return L[" "](l),l}L[" "]=function(){};var ee=S().indexOf("Gecko")!=-1&&!(S().toLowerCase().indexOf("webkit")!=-1&&S().indexOf("Edge")==-1)&&!(S().indexOf("Trident")!=-1||S().indexOf("MSIE")!=-1)&&S().indexOf("Edge")==-1;function D(l,u,g){for(const _ in l)u.call(g,l[_],_,l)}function k(l,u){for(const g in l)u.call(void 0,l[g],g,l)}function b(l){const u={};for(const g in l)u[g]=l[g];return u}const v="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function j(l,u){let g,_;for(let X=1;X<arguments.length;X++){_=arguments[X];for(g in _)l[g]=_[g];for(let se=0;se<v.length;se++)g=v[se],Object.prototype.hasOwnProperty.call(_,g)&&(l[g]=_[g])}}function N(l){var u=1;l=l.split(":");const g=[];for(;0<u&&l.length;)g.push(l.shift()),u--;return l.length&&g.push(l.join(":")),g}function y(l){c.setTimeout(()=>{throw l},0)}function p(){var l=ce;let u=null;return l.g&&(u=l.g,l.g=l.g.next,l.g||(l.h=null),u.next=null),u}class te{constructor(){this.h=this.g=null}add(u,g){const _=ue.get();_.set(u,g),this.h?this.h.next=_:this.g=_,this.h=_}}var ue=new K(()=>new le,l=>l.reset());class le{constructor(){this.next=this.g=this.h=null}set(u,g){this.h=u,this.g=g,this.next=null}reset(){this.next=this.g=this.h=null}}let H,ne=!1,ce=new te,B=()=>{const l=c.Promise.resolve(void 0);H=()=>{l.then(pe)}};var pe=()=>{for(var l;l=p();){try{l.h.call(l.g)}catch(g){y(g)}var u=ue;u.j(l),100>u.h&&(u.h++,l.next=u.g,u.g=l)}ne=!1};function F(){this.s=this.s,this.C=this.C}F.prototype.s=!1,F.prototype.ma=function(){this.s||(this.s=!0,this.N())},F.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function q(l,u){this.type=l,this.g=this.target=u,this.defaultPrevented=!1}q.prototype.h=function(){this.defaultPrevented=!0};var M=function(){if(!c.addEventListener||!Object.defineProperty)return!1;var l=!1,u=Object.defineProperty({},"passive",{get:function(){l=!0}});try{const g=()=>{};c.addEventListener("test",g,u),c.removeEventListener("test",g,u)}catch{}return l}();function z(l,u){if(q.call(this,l?l.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,l){var g=this.type=l.type,_=l.changedTouches&&l.changedTouches.length?l.changedTouches[0]:null;if(this.target=l.target||l.srcElement,this.g=u,u=l.relatedTarget){if(ee){e:{try{L(u.nodeName);var X=!0;break e}catch{}X=!1}X||(u=null)}}else g=="mouseover"?u=l.fromElement:g=="mouseout"&&(u=l.toElement);this.relatedTarget=u,_?(this.clientX=_.clientX!==void 0?_.clientX:_.pageX,this.clientY=_.clientY!==void 0?_.clientY:_.pageY,this.screenX=_.screenX||0,this.screenY=_.screenY||0):(this.clientX=l.clientX!==void 0?l.clientX:l.pageX,this.clientY=l.clientY!==void 0?l.clientY:l.pageY,this.screenX=l.screenX||0,this.screenY=l.screenY||0),this.button=l.button,this.key=l.key||"",this.ctrlKey=l.ctrlKey,this.altKey=l.altKey,this.shiftKey=l.shiftKey,this.metaKey=l.metaKey,this.pointerId=l.pointerId||0,this.pointerType=typeof l.pointerType=="string"?l.pointerType:I[l.pointerType]||"",this.state=l.state,this.i=l,l.defaultPrevented&&z.aa.h.call(this)}}$(z,q);var I={2:"touch",3:"pen",4:"mouse"};z.prototype.h=function(){z.aa.h.call(this);var l=this.i;l.preventDefault?l.preventDefault():l.returnValue=!1};var R="closure_listenable_"+(1e6*Math.random()|0),O=0;function U(l,u,g,_,X){this.listener=l,this.proxy=null,this.src=u,this.type=g,this.capture=!!_,this.ha=X,this.key=++O,this.da=this.fa=!1}function J(l){l.da=!0,l.listener=null,l.proxy=null,l.src=null,l.ha=null}function C(l){this.src=l,this.g={},this.h=0}C.prototype.add=function(l,u,g,_,X){var se=l.toString();l=this.g[se],l||(l=this.g[se]=[],this.h++);var ke=ae(l,u,_,X);return-1<ke?(u=l[ke],g||(u.fa=!1)):(u=new U(u,this.src,se,!!_,X),u.fa=g,l.push(u)),u};function oe(l,u){var g=u.type;if(g in l.g){var _=l.g[g],X=Array.prototype.indexOf.call(_,u,void 0),se;(se=0<=X)&&Array.prototype.splice.call(_,X,1),se&&(J(u),l.g[g].length==0&&(delete l.g[g],l.h--))}}function ae(l,u,g,_){for(var X=0;X<l.length;++X){var se=l[X];if(!se.da&&se.listener==u&&se.capture==!!g&&se.ha==_)return X}return-1}var V="closure_lm_"+(1e6*Math.random()|0),Z={};function ye(l,u,g,_,X){if(Array.isArray(u)){for(var se=0;se<u.length;se++)ye(l,u[se],g,_,X);return null}return g=Le(g),l&&l[R]?l.K(u,g,h(_)?!!_.capture:!1,X):we(l,u,g,!1,_,X)}function we(l,u,g,_,X,se){if(!u)throw Error("Invalid event type");var ke=h(X)?!!X.capture:!!X,ft=de(l);if(ft||(l[V]=ft=new C(l)),g=ft.add(u,g,_,ke,se),g.proxy)return g;if(_=Ke(),g.proxy=_,_.src=l,_.listener=g,l.addEventListener)M||(X=ke),X===void 0&&(X=!1),l.addEventListener(u.toString(),_,X);else if(l.attachEvent)l.attachEvent(me(u.toString()),_);else if(l.addListener&&l.removeListener)l.addListener(_);else throw Error("addEventListener and attachEvent are unavailable.");return g}function Ke(){function l(g){return u.call(l.src,l.listener,g)}const u=Ie;return l}function We(l,u,g,_,X){if(Array.isArray(u))for(var se=0;se<u.length;se++)We(l,u[se],g,_,X);else _=h(_)?!!_.capture:!!_,g=Le(g),l&&l[R]?(l=l.i,u=String(u).toString(),u in l.g&&(se=l.g[u],g=ae(se,g,_,X),-1<g&&(J(se[g]),Array.prototype.splice.call(se,g,1),se.length==0&&(delete l.g[u],l.h--)))):l&&(l=de(l))&&(u=l.g[u.toString()],l=-1,u&&(l=ae(u,g,_,X)),(g=-1<l?u[l]:null)&&Q(g))}function Q(l){if(typeof l!="number"&&l&&!l.da){var u=l.src;if(u&&u[R])oe(u.i,l);else{var g=l.type,_=l.proxy;u.removeEventListener?u.removeEventListener(g,_,l.capture):u.detachEvent?u.detachEvent(me(g),_):u.addListener&&u.removeListener&&u.removeListener(_),(g=de(u))?(oe(g,l),g.h==0&&(g.src=null,u[V]=null)):J(l)}}}function me(l){return l in Z?Z[l]:Z[l]="on"+l}function Ie(l,u){if(l.da)l=!0;else{u=new z(u,this);var g=l.listener,_=l.ha||l.src;l.fa&&Q(l),l=g.call(_,u)}return l}function de(l){return l=l[V],l instanceof C?l:null}var ze="__closure_events_fn_"+(1e9*Math.random()>>>0);function Le(l){return typeof l=="function"?l:(l[ze]||(l[ze]=function(u){return l.handleEvent(u)}),l[ze])}function W(){F.call(this),this.i=new C(this),this.M=this,this.F=null}$(W,F),W.prototype[R]=!0,W.prototype.removeEventListener=function(l,u,g,_){We(this,l,u,g,_)};function Ne(l,u){var g,_=l.F;if(_)for(g=[];_;_=_.F)g.push(_);if(l=l.M,_=u.type||u,typeof u=="string")u=new q(u,l);else if(u instanceof q)u.target=u.target||l;else{var X=u;u=new q(_,l),j(u,X)}if(X=!0,g)for(var se=g.length-1;0<=se;se--){var ke=u.g=g[se];X=Pe(ke,_,!0,u)&&X}if(ke=u.g=l,X=Pe(ke,_,!0,u)&&X,X=Pe(ke,_,!1,u)&&X,g)for(se=0;se<g.length;se++)ke=u.g=g[se],X=Pe(ke,_,!1,u)&&X}W.prototype.N=function(){if(W.aa.N.call(this),this.i){var l=this.i,u;for(u in l.g){for(var g=l.g[u],_=0;_<g.length;_++)J(g[_]);delete l.g[u],l.h--}}this.F=null},W.prototype.K=function(l,u,g,_){return this.i.add(String(l),u,!1,g,_)},W.prototype.L=function(l,u,g,_){return this.i.add(String(l),u,!0,g,_)};function Pe(l,u,g,_){if(u=l.i.g[String(u)],!u)return!0;u=u.concat();for(var X=!0,se=0;se<u.length;++se){var ke=u[se];if(ke&&!ke.da&&ke.capture==g){var ft=ke.listener,Ft=ke.ha||ke.src;ke.fa&&oe(l.i,ke),X=ft.call(Ft,_)!==!1&&X}}return X&&!_.defaultPrevented}function Y(l,u,g){if(typeof l=="function")g&&(l=f(l,g));else if(l&&typeof l.handleEvent=="function")l=f(l.handleEvent,l);else throw Error("Invalid listener argument");return 2147483647<Number(u)?-1:c.setTimeout(l,u||0)}function G(l){l.g=Y(()=>{l.g=null,l.i&&(l.i=!1,G(l))},l.l);const u=l.h;l.h=null,l.m.apply(null,u)}class Te extends F{constructor(u,g){super(),this.m=u,this.l=g,this.h=null,this.i=!1,this.g=null}j(u){this.h=arguments,this.g?this.i=!0:G(this)}N(){super.N(),this.g&&(c.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Re(l){F.call(this),this.h=l,this.g={}}$(Re,F);var Ue=[];function xe(l){D(l.g,function(u,g){this.g.hasOwnProperty(g)&&Q(u)},l),l.g={}}Re.prototype.N=function(){Re.aa.N.call(this),xe(this)},Re.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var lt=c.JSON.stringify,Qe=c.JSON.parse,ct=class{stringify(l){return c.JSON.stringify(l,void 0)}parse(l){return c.JSON.parse(l,void 0)}};function _e(){}_e.prototype.h=null;function Me(l){return l.h||(l.h=l.i())}function ot(){}var ht={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function br(){q.call(this,"d")}$(br,q);function Kt(){q.call(this,"c")}$(Kt,q);var Yt={},Ce=null;function Oe(){return Ce=Ce||new W}Yt.La="serverreachability";function re(l){q.call(this,Yt.La,l)}$(re,q);function ve(l){const u=Oe();Ne(u,new re(u))}Yt.STAT_EVENT="statevent";function De(l,u){q.call(this,Yt.STAT_EVENT,l),this.stat=u}$(De,q);function Fe(l){const u=Oe();Ne(u,new De(u,l))}Yt.Ma="timingevent";function Je(l,u){q.call(this,Yt.Ma,l),this.size=u}$(Je,q);function Ze(l,u){if(typeof l!="function")throw Error("Fn must not be null and must be a function");return c.setTimeout(function(){l()},u)}function tt(){this.g=!0}tt.prototype.xa=function(){this.g=!1};function Ye(l,u,g,_,X,se){l.info(function(){if(l.g)if(se)for(var ke="",ft=se.split("&"),Ft=0;Ft<ft.length;Ft++){var dt=ft[Ft].split("=");if(1<dt.length){var Qt=dt[0];dt=dt[1];var Xt=Qt.split("_");ke=2<=Xt.length&&Xt[1]=="type"?ke+(Qt+"="+dt+"&"):ke+(Qt+"=redacted&")}}else ke=null;else ke=se;return"XMLHTTP REQ ("+_+") [attempt "+X+"]: "+u+`
`+g+`
`+ke})}function Xe(l,u,g,_,X,se,ke){l.info(function(){return"XMLHTTP RESP ("+_+") [ attempt "+X+"]: "+u+`
`+g+`
`+se+" "+ke})}function be(l,u,g,_){l.info(function(){return"XMLHTTP TEXT ("+u+"): "+rt(l,g)+(_?" "+_:"")})}function je(l,u){l.info(function(){return"TIMEOUT: "+u})}tt.prototype.info=function(){};function rt(l,u){if(!l.g)return u;if(!u)return null;try{var g=JSON.parse(u);if(g){for(l=0;l<g.length;l++)if(Array.isArray(g[l])){var _=g[l];if(!(2>_.length)){var X=_[1];if(Array.isArray(X)&&!(1>X.length)){var se=X[0];if(se!="noop"&&se!="stop"&&se!="close")for(var ke=1;ke<X.length;ke++)X[ke]=""}}}}return lt(g)}catch{return u}}var yt={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},Ct={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},Lt;function ur(){}$(ur,_e),ur.prototype.g=function(){return new XMLHttpRequest},ur.prototype.i=function(){return{}},Lt=new ur;function nr(l,u,g,_){this.j=l,this.i=u,this.l=g,this.R=_||1,this.U=new Re(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new id}function id(){this.i=null,this.g="",this.h=!1}var od={},Po={};function Mo(l,u,g){l.L=1,l.v=Ja(Gr(u)),l.m=g,l.P=!0,ld(l,null)}function ld(l,u){l.F=Date.now(),Ya(l),l.A=Gr(l.v);var g=l.A,_=l.R;Array.isArray(_)||(_=[String(_)]),kd(g.i,"t",_),l.C=0,g=l.j.J,l.h=new id,l.g=Fd(l.j,g?u:null,!l.m),0<l.O&&(l.M=new Te(f(l.Y,l,l.g),l.O)),u=l.U,g=l.g,_=l.ca;var X="readystatechange";Array.isArray(X)||(X&&(Ue[0]=X.toString()),X=Ue);for(var se=0;se<X.length;se++){var ke=ye(g,X[se],_||u.handleEvent,!1,u.h||u);if(!ke)break;u.g[ke.key]=ke}u=l.H?b(l.H):{},l.m?(l.u||(l.u="POST"),u["Content-Type"]="application/x-www-form-urlencoded",l.g.ea(l.A,l.u,l.m,u)):(l.u="GET",l.g.ea(l.A,l.u,null,u)),ve(),Ye(l.i,l.u,l.A,l.l,l.R,l.m)}nr.prototype.ca=function(l){l=l.target;const u=this.M;u&&Kr(l)==3?u.j():this.Y(l)},nr.prototype.Y=function(l){try{if(l==this.g)e:{const Xt=Kr(this.g);var u=this.g.Ba();const dn=this.g.Z();if(!(3>Xt)&&(Xt!=3||this.g&&(this.h.h||this.g.oa()||Sd(this.g)))){this.J||Xt!=4||u==7||(u==8||0>=dn?ve(3):ve(2)),Oo(this);var g=this.g.Z();this.X=g;t:if(cd(this)){var _=Sd(this.g);l="";var X=_.length,se=Kr(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){Us(this),Kn(this);var ke="";break t}this.h.i=new c.TextDecoder}for(u=0;u<X;u++)this.h.h=!0,l+=this.h.i.decode(_[u],{stream:!(se&&u==X-1)});_.length=0,this.h.g+=l,this.C=0,ke=this.h.g}else ke=this.g.oa();if(this.o=g==200,Xe(this.i,this.u,this.A,this.l,this.R,Xt,g),this.o){if(this.T&&!this.K){t:{if(this.g){var ft,Ft=this.g;if((ft=Ft.g?Ft.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!P(ft)){var dt=ft;break t}}dt=null}if(g=dt)be(this.i,this.l,g,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Vo(this,g);else{this.o=!1,this.s=3,Fe(12),Us(this),Kn(this);break e}}if(this.P){g=!0;let Ir;for(;!this.J&&this.C<ke.length;)if(Ir=H0(this,ke),Ir==Po){Xt==4&&(this.s=4,Fe(14),g=!1),be(this.i,this.l,null,"[Incomplete Response]");break}else if(Ir==od){this.s=4,Fe(15),be(this.i,this.l,ke,"[Invalid Chunk]"),g=!1;break}else be(this.i,this.l,Ir,null),Vo(this,Ir);if(cd(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),Xt!=4||ke.length!=0||this.h.h||(this.s=1,Fe(16),g=!1),this.o=this.o&&g,!g)be(this.i,this.l,ke,"[Invalid Chunked Response]"),Us(this),Kn(this);else if(0<ke.length&&!this.W){this.W=!0;var Qt=this.j;Qt.g==this&&Qt.ba&&!Qt.M&&(Qt.j.info("Great, no buffering proxy detected. Bytes received: "+ke.length),zo(Qt),Qt.M=!0,Fe(11))}}else be(this.i,this.l,ke,null),Vo(this,ke);Xt==4&&Us(this),this.o&&!this.J&&(Xt==4?Md(this.j,this):(this.o=!1,Ya(this)))}else cp(this.g),g==400&&0<ke.indexOf("Unknown SID")?(this.s=3,Fe(12)):(this.s=0,Fe(13)),Us(this),Kn(this)}}}catch{}finally{}};function cd(l){return l.g?l.u=="GET"&&l.L!=2&&l.j.Ca:!1}function H0(l,u){var g=l.C,_=u.indexOf(`
`,g);return _==-1?Po:(g=Number(u.substring(g,_)),isNaN(g)?od:(_+=1,_+g>u.length?Po:(u=u.slice(_,_+g),l.C=_+g,u)))}nr.prototype.cancel=function(){this.J=!0,Us(this)};function Ya(l){l.S=Date.now()+l.I,dd(l,l.I)}function dd(l,u){if(l.B!=null)throw Error("WatchDog timer not null");l.B=Ze(f(l.ba,l),u)}function Oo(l){l.B&&(c.clearTimeout(l.B),l.B=null)}nr.prototype.ba=function(){this.B=null;const l=Date.now();0<=l-this.S?(je(this.i,this.A),this.L!=2&&(ve(),Fe(17)),Us(this),this.s=2,Kn(this)):dd(this,this.S-l)};function Kn(l){l.j.G==0||l.J||Md(l.j,l)}function Us(l){Oo(l);var u=l.M;u&&typeof u.ma=="function"&&u.ma(),l.M=null,xe(l.U),l.g&&(u=l.g,l.g=null,u.abort(),u.ma())}function Vo(l,u){try{var g=l.j;if(g.G!=0&&(g.g==l||Lo(g.h,l))){if(!l.K&&Lo(g.h,l)&&g.G==3){try{var _=g.Da.g.parse(u)}catch{_=null}if(Array.isArray(_)&&_.length==3){var X=_;if(X[0]==0){e:if(!g.u){if(g.g)if(g.g.F+3e3<l.F)ni(g),ri(g);else break e;qo(g),Fe(18)}}else g.za=X[1],0<g.za-g.T&&37500>X[2]&&g.F&&g.v==0&&!g.C&&(g.C=Ze(f(g.Za,g),6e3));if(1>=md(g.h)&&g.ca){try{g.ca()}catch{}g.ca=void 0}}else qs(g,11)}else if((l.K||g.g==l)&&ni(g),!P(u))for(X=g.Da.g.parse(u),u=0;u<X.length;u++){let dt=X[u];if(g.T=dt[0],dt=dt[1],g.G==2)if(dt[0]=="c"){g.K=dt[1],g.ia=dt[2];const Qt=dt[3];Qt!=null&&(g.la=Qt,g.j.info("VER="+g.la));const Xt=dt[4];Xt!=null&&(g.Aa=Xt,g.j.info("SVER="+g.Aa));const dn=dt[5];dn!=null&&typeof dn=="number"&&0<dn&&(_=1.5*dn,g.L=_,g.j.info("backChannelRequestTimeoutMs_="+_)),_=g;const Ir=l.g;if(Ir){const ii=Ir.g?Ir.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(ii){var se=_.h;se.g||ii.indexOf("spdy")==-1&&ii.indexOf("quic")==-1&&ii.indexOf("h2")==-1||(se.j=se.l,se.g=new Set,se.h&&(Fo(se,se.h),se.h=null))}if(_.D){const Wo=Ir.g?Ir.g.getResponseHeader("X-HTTP-Session-Id"):null;Wo&&(_.ya=Wo,vt(_.I,_.D,Wo))}}g.G=3,g.l&&g.l.ua(),g.ba&&(g.R=Date.now()-l.F,g.j.info("Handshake RTT: "+g.R+"ms")),_=g;var ke=l;if(_.qa=Ld(_,_.J?_.ia:null,_.W),ke.K){gd(_.h,ke);var ft=ke,Ft=_.L;Ft&&(ft.I=Ft),ft.B&&(Oo(ft),Ya(ft)),_.g=ke}else Rd(_);0<g.i.length&&si(g)}else dt[0]!="stop"&&dt[0]!="close"||qs(g,7);else g.G==3&&(dt[0]=="stop"||dt[0]=="close"?dt[0]=="stop"?qs(g,7):Bo(g):dt[0]!="noop"&&g.l&&g.l.ta(dt),g.v=0)}}ve(4)}catch{}}var G0=class{constructor(l,u){this.g=l,this.map=u}};function ud(l){this.l=l||10,c.PerformanceNavigationTiming?(l=c.performance.getEntriesByType("navigation"),l=0<l.length&&(l[0].nextHopProtocol=="hq"||l[0].nextHopProtocol=="h2")):l=!!(c.chrome&&c.chrome.loadTimes&&c.chrome.loadTimes()&&c.chrome.loadTimes().wasFetchedViaSpdy),this.j=l?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function hd(l){return l.h?!0:l.g?l.g.size>=l.j:!1}function md(l){return l.h?1:l.g?l.g.size:0}function Lo(l,u){return l.h?l.h==u:l.g?l.g.has(u):!1}function Fo(l,u){l.g?l.g.add(u):l.h=u}function gd(l,u){l.h&&l.h==u?l.h=null:l.g&&l.g.has(u)&&l.g.delete(u)}ud.prototype.cancel=function(){if(this.i=pd(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const l of this.g.values())l.cancel();this.g.clear()}};function pd(l){if(l.h!=null)return l.i.concat(l.h.D);if(l.g!=null&&l.g.size!==0){let u=l.i;for(const g of l.g.values())u=u.concat(g.D);return u}return A(l.i)}function K0(l){if(l.V&&typeof l.V=="function")return l.V();if(typeof Map<"u"&&l instanceof Map||typeof Set<"u"&&l instanceof Set)return Array.from(l.values());if(typeof l=="string")return l.split("");if(d(l)){for(var u=[],g=l.length,_=0;_<g;_++)u.push(l[_]);return u}u=[],g=0;for(_ in l)u[g++]=l[_];return u}function Y0(l){if(l.na&&typeof l.na=="function")return l.na();if(!l.V||typeof l.V!="function"){if(typeof Map<"u"&&l instanceof Map)return Array.from(l.keys());if(!(typeof Set<"u"&&l instanceof Set)){if(d(l)||typeof l=="string"){var u=[];l=l.length;for(var g=0;g<l;g++)u.push(g);return u}u=[],g=0;for(const _ in l)u[g++]=_;return u}}}function xd(l,u){if(l.forEach&&typeof l.forEach=="function")l.forEach(u,void 0);else if(d(l)||typeof l=="string")Array.prototype.forEach.call(l,u,void 0);else for(var g=Y0(l),_=K0(l),X=_.length,se=0;se<X;se++)u.call(void 0,_[se],g&&g[se],l)}var fd=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Q0(l,u){if(l){l=l.split("&");for(var g=0;g<l.length;g++){var _=l[g].indexOf("="),X=null;if(0<=_){var se=l[g].substring(0,_);X=l[g].substring(_+1)}else se=l[g];u(se,X?decodeURIComponent(X.replace(/\+/g," ")):"")}}}function Bs(l){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,l instanceof Bs){this.h=l.h,Qa(this,l.j),this.o=l.o,this.g=l.g,Xa(this,l.s),this.l=l.l;var u=l.i,g=new Xn;g.i=u.i,u.g&&(g.g=new Map(u.g),g.h=u.h),bd(this,g),this.m=l.m}else l&&(u=String(l).match(fd))?(this.h=!1,Qa(this,u[1]||"",!0),this.o=Yn(u[2]||""),this.g=Yn(u[3]||"",!0),Xa(this,u[4]),this.l=Yn(u[5]||"",!0),bd(this,u[6]||"",!0),this.m=Yn(u[7]||"")):(this.h=!1,this.i=new Xn(null,this.h))}Bs.prototype.toString=function(){var l=[],u=this.j;u&&l.push(Qn(u,yd,!0),":");var g=this.g;return(g||u=="file")&&(l.push("//"),(u=this.o)&&l.push(Qn(u,yd,!0),"@"),l.push(encodeURIComponent(String(g)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),g=this.s,g!=null&&l.push(":",String(g))),(g=this.l)&&(this.g&&g.charAt(0)!="/"&&l.push("/"),l.push(Qn(g,g.charAt(0)=="/"?Z0:J0,!0))),(g=this.i.toString())&&l.push("?",g),(g=this.m)&&l.push("#",Qn(g,tp)),l.join("")};function Gr(l){return new Bs(l)}function Qa(l,u,g){l.j=g?Yn(u,!0):u,l.j&&(l.j=l.j.replace(/:$/,""))}function Xa(l,u){if(u){if(u=Number(u),isNaN(u)||0>u)throw Error("Bad port number "+u);l.s=u}else l.s=null}function bd(l,u,g){u instanceof Xn?(l.i=u,rp(l.i,l.h)):(g||(u=Qn(u,ep)),l.i=new Xn(u,l.h))}function vt(l,u,g){l.i.set(u,g)}function Ja(l){return vt(l,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),l}function Yn(l,u){return l?u?decodeURI(l.replace(/%25/g,"%2525")):decodeURIComponent(l):""}function Qn(l,u,g){return typeof l=="string"?(l=encodeURI(l).replace(u,X0),g&&(l=l.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),l):null}function X0(l){return l=l.charCodeAt(0),"%"+(l>>4&15).toString(16)+(l&15).toString(16)}var yd=/[#\/\?@]/g,J0=/[#\?:]/g,Z0=/[#\?]/g,ep=/[#\?@]/g,tp=/#/g;function Xn(l,u){this.h=this.g=null,this.i=l||null,this.j=!!u}function xs(l){l.g||(l.g=new Map,l.h=0,l.i&&Q0(l.i,function(u,g){l.add(decodeURIComponent(u.replace(/\+/g," ")),g)}))}s=Xn.prototype,s.add=function(l,u){xs(this),this.i=null,l=ln(this,l);var g=this.g.get(l);return g||this.g.set(l,g=[]),g.push(u),this.h+=1,this};function vd(l,u){xs(l),u=ln(l,u),l.g.has(u)&&(l.i=null,l.h-=l.g.get(u).length,l.g.delete(u))}function wd(l,u){return xs(l),u=ln(l,u),l.g.has(u)}s.forEach=function(l,u){xs(this),this.g.forEach(function(g,_){g.forEach(function(X){l.call(u,X,_,this)},this)},this)},s.na=function(){xs(this);const l=Array.from(this.g.values()),u=Array.from(this.g.keys()),g=[];for(let _=0;_<u.length;_++){const X=l[_];for(let se=0;se<X.length;se++)g.push(u[_])}return g},s.V=function(l){xs(this);let u=[];if(typeof l=="string")wd(this,l)&&(u=u.concat(this.g.get(ln(this,l))));else{l=Array.from(this.g.values());for(let g=0;g<l.length;g++)u=u.concat(l[g])}return u},s.set=function(l,u){return xs(this),this.i=null,l=ln(this,l),wd(this,l)&&(this.h-=this.g.get(l).length),this.g.set(l,[u]),this.h+=1,this},s.get=function(l,u){return l?(l=this.V(l),0<l.length?String(l[0]):u):u};function kd(l,u,g){vd(l,u),0<g.length&&(l.i=null,l.g.set(ln(l,u),A(g)),l.h+=g.length)}s.toString=function(){if(this.i)return this.i;if(!this.g)return"";const l=[],u=Array.from(this.g.keys());for(var g=0;g<u.length;g++){var _=u[g];const se=encodeURIComponent(String(_)),ke=this.V(_);for(_=0;_<ke.length;_++){var X=se;ke[_]!==""&&(X+="="+encodeURIComponent(String(ke[_]))),l.push(X)}}return this.i=l.join("&")};function ln(l,u){return u=String(u),l.j&&(u=u.toLowerCase()),u}function rp(l,u){u&&!l.j&&(xs(l),l.i=null,l.g.forEach(function(g,_){var X=_.toLowerCase();_!=X&&(vd(this,_),kd(this,X,g))},l)),l.j=u}function sp(l,u){const g=new tt;if(c.Image){const _=new Image;_.onload=w(fs,g,"TestLoadImage: loaded",!0,u,_),_.onerror=w(fs,g,"TestLoadImage: error",!1,u,_),_.onabort=w(fs,g,"TestLoadImage: abort",!1,u,_),_.ontimeout=w(fs,g,"TestLoadImage: timeout",!1,u,_),c.setTimeout(function(){_.ontimeout&&_.ontimeout()},1e4),_.src=l}else u(!1)}function np(l,u){const g=new tt,_=new AbortController,X=setTimeout(()=>{_.abort(),fs(g,"TestPingServer: timeout",!1,u)},1e4);fetch(l,{signal:_.signal}).then(se=>{clearTimeout(X),se.ok?fs(g,"TestPingServer: ok",!0,u):fs(g,"TestPingServer: server error",!1,u)}).catch(()=>{clearTimeout(X),fs(g,"TestPingServer: error",!1,u)})}function fs(l,u,g,_,X){try{X&&(X.onload=null,X.onerror=null,X.onabort=null,X.ontimeout=null),_(g)}catch{}}function ap(){this.g=new ct}function ip(l,u,g){const _=g||"";try{xd(l,function(X,se){let ke=X;h(X)&&(ke=lt(X)),u.push(_+se+"="+encodeURIComponent(ke))})}catch(X){throw u.push(_+"type="+encodeURIComponent("_badmap")),X}}function Za(l){this.l=l.Ub||null,this.j=l.eb||!1}$(Za,_e),Za.prototype.g=function(){return new ei(this.l,this.j)},Za.prototype.i=function(l){return function(){return l}}({});function ei(l,u){W.call(this),this.D=l,this.o=u,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}$(ei,W),s=ei.prototype,s.open=function(l,u){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=l,this.A=u,this.readyState=1,Zn(this)},s.send=function(l){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const u={headers:this.u,method:this.B,credentials:this.m,cache:void 0};l&&(u.body=l),(this.D||c).fetch(new Request(this.A,u)).then(this.Sa.bind(this),this.ga.bind(this))},s.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,Jn(this)),this.readyState=0},s.Sa=function(l){if(this.g&&(this.l=l,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=l.headers,this.readyState=2,Zn(this)),this.g&&(this.readyState=3,Zn(this),this.g)))if(this.responseType==="arraybuffer")l.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof c.ReadableStream<"u"&&"body"in l){if(this.j=l.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;Nd(this)}else l.text().then(this.Ra.bind(this),this.ga.bind(this))};function Nd(l){l.j.read().then(l.Pa.bind(l)).catch(l.ga.bind(l))}s.Pa=function(l){if(this.g){if(this.o&&l.value)this.response.push(l.value);else if(!this.o){var u=l.value?l.value:new Uint8Array(0);(u=this.v.decode(u,{stream:!l.done}))&&(this.response=this.responseText+=u)}l.done?Jn(this):Zn(this),this.readyState==3&&Nd(this)}},s.Ra=function(l){this.g&&(this.response=this.responseText=l,Jn(this))},s.Qa=function(l){this.g&&(this.response=l,Jn(this))},s.ga=function(){this.g&&Jn(this)};function Jn(l){l.readyState=4,l.l=null,l.j=null,l.v=null,Zn(l)}s.setRequestHeader=function(l,u){this.u.append(l,u)},s.getResponseHeader=function(l){return this.h&&this.h.get(l.toLowerCase())||""},s.getAllResponseHeaders=function(){if(!this.h)return"";const l=[],u=this.h.entries();for(var g=u.next();!g.done;)g=g.value,l.push(g[0]+": "+g[1]),g=u.next();return l.join(`\r
`)};function Zn(l){l.onreadystatechange&&l.onreadystatechange.call(l)}Object.defineProperty(ei.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(l){this.m=l?"include":"same-origin"}});function jd(l){let u="";return D(l,function(g,_){u+=_,u+=":",u+=g,u+=`\r
`}),u}function Uo(l,u,g){e:{for(_ in g){var _=!1;break e}_=!0}_||(g=jd(g),typeof l=="string"?g!=null&&encodeURIComponent(String(g)):vt(l,u,g))}function It(l){W.call(this),this.headers=new Map,this.o=l||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}$(It,W);var op=/^https?$/i,lp=["POST","PUT"];s=It.prototype,s.Ha=function(l){this.J=l},s.ea=function(l,u,g,_){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+l);u=u?u.toUpperCase():"GET",this.D=l,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():Lt.g(),this.v=this.o?Me(this.o):Me(Lt),this.g.onreadystatechange=f(this.Ea,this);try{this.B=!0,this.g.open(u,String(l),!0),this.B=!1}catch(se){_d(this,se);return}if(l=g||"",g=new Map(this.headers),_)if(Object.getPrototypeOf(_)===Object.prototype)for(var X in _)g.set(X,_[X]);else if(typeof _.keys=="function"&&typeof _.get=="function")for(const se of _.keys())g.set(se,_.get(se));else throw Error("Unknown input type for opt_headers: "+String(_));_=Array.from(g.keys()).find(se=>se.toLowerCase()=="content-type"),X=c.FormData&&l instanceof c.FormData,!(0<=Array.prototype.indexOf.call(lp,u,void 0))||_||X||g.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[se,ke]of g)this.g.setRequestHeader(se,ke);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{Td(this),this.u=!0,this.g.send(l),this.u=!1}catch(se){_d(this,se)}};function _d(l,u){l.h=!1,l.g&&(l.j=!0,l.g.abort(),l.j=!1),l.l=u,l.m=5,Ed(l),ti(l)}function Ed(l){l.A||(l.A=!0,Ne(l,"complete"),Ne(l,"error"))}s.abort=function(l){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=l||7,Ne(this,"complete"),Ne(this,"abort"),ti(this))},s.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),ti(this,!0)),It.aa.N.call(this)},s.Ea=function(){this.s||(this.B||this.u||this.j?Id(this):this.bb())},s.bb=function(){Id(this)};function Id(l){if(l.h&&typeof o<"u"&&(!l.v[1]||Kr(l)!=4||l.Z()!=2)){if(l.u&&Kr(l)==4)Y(l.Ea,0,l);else if(Ne(l,"readystatechange"),Kr(l)==4){l.h=!1;try{const ke=l.Z();e:switch(ke){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var u=!0;break e;default:u=!1}var g;if(!(g=u)){var _;if(_=ke===0){var X=String(l.D).match(fd)[1]||null;!X&&c.self&&c.self.location&&(X=c.self.location.protocol.slice(0,-1)),_=!op.test(X?X.toLowerCase():"")}g=_}if(g)Ne(l,"complete"),Ne(l,"success");else{l.m=6;try{var se=2<Kr(l)?l.g.statusText:""}catch{se=""}l.l=se+" ["+l.Z()+"]",Ed(l)}}finally{ti(l)}}}}function ti(l,u){if(l.g){Td(l);const g=l.g,_=l.v[0]?()=>{}:null;l.g=null,l.v=null,u||Ne(l,"ready");try{g.onreadystatechange=_}catch{}}}function Td(l){l.I&&(c.clearTimeout(l.I),l.I=null)}s.isActive=function(){return!!this.g};function Kr(l){return l.g?l.g.readyState:0}s.Z=function(){try{return 2<Kr(this)?this.g.status:-1}catch{return-1}},s.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},s.Oa=function(l){if(this.g){var u=this.g.responseText;return l&&u.indexOf(l)==0&&(u=u.substring(l.length)),Qe(u)}};function Sd(l){try{if(!l.g)return null;if("response"in l.g)return l.g.response;switch(l.H){case"":case"text":return l.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in l.g)return l.g.mozResponseArrayBuffer}return null}catch{return null}}function cp(l){const u={};l=(l.g&&2<=Kr(l)&&l.g.getAllResponseHeaders()||"").split(`\r
`);for(let _=0;_<l.length;_++){if(P(l[_]))continue;var g=N(l[_]);const X=g[0];if(g=g[1],typeof g!="string")continue;g=g.trim();const se=u[X]||[];u[X]=se,se.push(g)}k(u,function(_){return _.join(", ")})}s.Ba=function(){return this.m},s.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function ea(l,u,g){return g&&g.internalChannelParams&&g.internalChannelParams[l]||u}function Ad(l){this.Aa=0,this.i=[],this.j=new tt,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=ea("failFast",!1,l),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=ea("baseRetryDelayMs",5e3,l),this.cb=ea("retryDelaySeedMs",1e4,l),this.Wa=ea("forwardChannelMaxRetries",2,l),this.wa=ea("forwardChannelRequestTimeoutMs",2e4,l),this.pa=l&&l.xmlHttpFactory||void 0,this.Xa=l&&l.Tb||void 0,this.Ca=l&&l.useFetchStreams||!1,this.L=void 0,this.J=l&&l.supportsCrossDomainXhr||!1,this.K="",this.h=new ud(l&&l.concurrentRequestLimit),this.Da=new ap,this.P=l&&l.fastHandshake||!1,this.O=l&&l.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=l&&l.Rb||!1,l&&l.xa&&this.j.xa(),l&&l.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&l&&l.detectBufferingProxy||!1,this.ja=void 0,l&&l.longPollingTimeout&&0<l.longPollingTimeout&&(this.ja=l.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}s=Ad.prototype,s.la=8,s.G=1,s.connect=function(l,u,g,_){Fe(0),this.W=l,this.H=u||{},g&&_!==void 0&&(this.H.OSID=g,this.H.OAID=_),this.F=this.X,this.I=Ld(this,null,this.W),si(this)};function Bo(l){if(Cd(l),l.G==3){var u=l.U++,g=Gr(l.I);if(vt(g,"SID",l.K),vt(g,"RID",u),vt(g,"TYPE","terminate"),ta(l,g),u=new nr(l,l.j,u),u.L=2,u.v=Ja(Gr(g)),g=!1,c.navigator&&c.navigator.sendBeacon)try{g=c.navigator.sendBeacon(u.v.toString(),"")}catch{}!g&&c.Image&&(new Image().src=u.v,g=!0),g||(u.g=Fd(u.j,null),u.g.ea(u.v)),u.F=Date.now(),Ya(u)}Vd(l)}function ri(l){l.g&&(zo(l),l.g.cancel(),l.g=null)}function Cd(l){ri(l),l.u&&(c.clearTimeout(l.u),l.u=null),ni(l),l.h.cancel(),l.s&&(typeof l.s=="number"&&c.clearTimeout(l.s),l.s=null)}function si(l){if(!hd(l.h)&&!l.s){l.s=!0;var u=l.Ga;H||B(),ne||(H(),ne=!0),ce.add(u,l),l.B=0}}function dp(l,u){return md(l.h)>=l.h.j-(l.s?1:0)?!1:l.s?(l.i=u.D.concat(l.i),!0):l.G==1||l.G==2||l.B>=(l.Va?0:l.Wa)?!1:(l.s=Ze(f(l.Ga,l,u),Od(l,l.B)),l.B++,!0)}s.Ga=function(l){if(this.s)if(this.s=null,this.G==1){if(!l){this.U=Math.floor(1e5*Math.random()),l=this.U++;const X=new nr(this,this.j,l);let se=this.o;if(this.S&&(se?(se=b(se),j(se,this.S)):se=this.S),this.m!==null||this.O||(X.H=se,se=null),this.P)e:{for(var u=0,g=0;g<this.i.length;g++){t:{var _=this.i[g];if("__data__"in _.map&&(_=_.map.__data__,typeof _=="string")){_=_.length;break t}_=void 0}if(_===void 0)break;if(u+=_,4096<u){u=g;break e}if(u===4096||g===this.i.length-1){u=g+1;break e}}u=1e3}else u=1e3;u=$d(this,X,u),g=Gr(this.I),vt(g,"RID",l),vt(g,"CVER",22),this.D&&vt(g,"X-HTTP-Session-Id",this.D),ta(this,g),se&&(this.O?u="headers="+encodeURIComponent(String(jd(se)))+"&"+u:this.m&&Uo(g,this.m,se)),Fo(this.h,X),this.Ua&&vt(g,"TYPE","init"),this.P?(vt(g,"$req",u),vt(g,"SID","null"),X.T=!0,Mo(X,g,null)):Mo(X,g,u),this.G=2}}else this.G==3&&(l?Dd(this,l):this.i.length==0||hd(this.h)||Dd(this))};function Dd(l,u){var g;u?g=u.l:g=l.U++;const _=Gr(l.I);vt(_,"SID",l.K),vt(_,"RID",g),vt(_,"AID",l.T),ta(l,_),l.m&&l.o&&Uo(_,l.m,l.o),g=new nr(l,l.j,g,l.B+1),l.m===null&&(g.H=l.o),u&&(l.i=u.D.concat(l.i)),u=$d(l,g,1e3),g.I=Math.round(.5*l.wa)+Math.round(.5*l.wa*Math.random()),Fo(l.h,g),Mo(g,_,u)}function ta(l,u){l.H&&D(l.H,function(g,_){vt(u,_,g)}),l.l&&xd({},function(g,_){vt(u,_,g)})}function $d(l,u,g){g=Math.min(l.i.length,g);var _=l.l?f(l.l.Na,l.l,l):null;e:{var X=l.i;let se=-1;for(;;){const ke=["count="+g];se==-1?0<g?(se=X[0].g,ke.push("ofs="+se)):se=0:ke.push("ofs="+se);let ft=!0;for(let Ft=0;Ft<g;Ft++){let dt=X[Ft].g;const Qt=X[Ft].map;if(dt-=se,0>dt)se=Math.max(0,X[Ft].g-100),ft=!1;else try{ip(Qt,ke,"req"+dt+"_")}catch{_&&_(Qt)}}if(ft){_=ke.join("&");break e}}}return l=l.i.splice(0,g),u.D=l,_}function Rd(l){if(!l.g&&!l.u){l.Y=1;var u=l.Fa;H||B(),ne||(H(),ne=!0),ce.add(u,l),l.v=0}}function qo(l){return l.g||l.u||3<=l.v?!1:(l.Y++,l.u=Ze(f(l.Fa,l),Od(l,l.v)),l.v++,!0)}s.Fa=function(){if(this.u=null,Pd(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var l=2*this.R;this.j.info("BP detection timer enabled: "+l),this.A=Ze(f(this.ab,this),l)}},s.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,Fe(10),ri(this),Pd(this))};function zo(l){l.A!=null&&(c.clearTimeout(l.A),l.A=null)}function Pd(l){l.g=new nr(l,l.j,"rpc",l.Y),l.m===null&&(l.g.H=l.o),l.g.O=0;var u=Gr(l.qa);vt(u,"RID","rpc"),vt(u,"SID",l.K),vt(u,"AID",l.T),vt(u,"CI",l.F?"0":"1"),!l.F&&l.ja&&vt(u,"TO",l.ja),vt(u,"TYPE","xmlhttp"),ta(l,u),l.m&&l.o&&Uo(u,l.m,l.o),l.L&&(l.g.I=l.L);var g=l.g;l=l.ia,g.L=1,g.v=Ja(Gr(u)),g.m=null,g.P=!0,ld(g,l)}s.Za=function(){this.C!=null&&(this.C=null,ri(this),qo(this),Fe(19))};function ni(l){l.C!=null&&(c.clearTimeout(l.C),l.C=null)}function Md(l,u){var g=null;if(l.g==u){ni(l),zo(l),l.g=null;var _=2}else if(Lo(l.h,u))g=u.D,gd(l.h,u),_=1;else return;if(l.G!=0){if(u.o)if(_==1){g=u.m?u.m.length:0,u=Date.now()-u.F;var X=l.B;_=Oe(),Ne(_,new Je(_,g)),si(l)}else Rd(l);else if(X=u.s,X==3||X==0&&0<u.X||!(_==1&&dp(l,u)||_==2&&qo(l)))switch(g&&0<g.length&&(u=l.h,u.i=u.i.concat(g)),X){case 1:qs(l,5);break;case 4:qs(l,10);break;case 3:qs(l,6);break;default:qs(l,2)}}}function Od(l,u){let g=l.Ta+Math.floor(Math.random()*l.cb);return l.isActive()||(g*=2),g*u}function qs(l,u){if(l.j.info("Error code "+u),u==2){var g=f(l.fb,l),_=l.Xa;const X=!_;_=new Bs(_||"//www.google.com/images/cleardot.gif"),c.location&&c.location.protocol=="http"||Qa(_,"https"),Ja(_),X?sp(_.toString(),g):np(_.toString(),g)}else Fe(2);l.G=0,l.l&&l.l.sa(u),Vd(l),Cd(l)}s.fb=function(l){l?(this.j.info("Successfully pinged google.com"),Fe(2)):(this.j.info("Failed to ping google.com"),Fe(1))};function Vd(l){if(l.G=0,l.ka=[],l.l){const u=pd(l.h);(u.length!=0||l.i.length!=0)&&(T(l.ka,u),T(l.ka,l.i),l.h.i.length=0,A(l.i),l.i.length=0),l.l.ra()}}function Ld(l,u,g){var _=g instanceof Bs?Gr(g):new Bs(g);if(_.g!="")u&&(_.g=u+"."+_.g),Xa(_,_.s);else{var X=c.location;_=X.protocol,u=u?u+"."+X.hostname:X.hostname,X=+X.port;var se=new Bs(null);_&&Qa(se,_),u&&(se.g=u),X&&Xa(se,X),g&&(se.l=g),_=se}return g=l.D,u=l.ya,g&&u&&vt(_,g,u),vt(_,"VER",l.la),ta(l,_),_}function Fd(l,u,g){if(u&&!l.J)throw Error("Can't create secondary domain capable XhrIo object.");return u=l.Ca&&!l.pa?new It(new Za({eb:g})):new It(l.pa),u.Ha(l.J),u}s.isActive=function(){return!!this.l&&this.l.isActive(this)};function Ud(){}s=Ud.prototype,s.ua=function(){},s.ta=function(){},s.sa=function(){},s.ra=function(){},s.isActive=function(){return!0},s.Na=function(){};function ai(){}ai.prototype.g=function(l,u){return new yr(l,u)};function yr(l,u){W.call(this),this.g=new Ad(u),this.l=l,this.h=u&&u.messageUrlParams||null,l=u&&u.messageHeaders||null,u&&u.clientProtocolHeaderRequired&&(l?l["X-Client-Protocol"]="webchannel":l={"X-Client-Protocol":"webchannel"}),this.g.o=l,l=u&&u.initMessageHeaders||null,u&&u.messageContentType&&(l?l["X-WebChannel-Content-Type"]=u.messageContentType:l={"X-WebChannel-Content-Type":u.messageContentType}),u&&u.va&&(l?l["X-WebChannel-Client-Profile"]=u.va:l={"X-WebChannel-Client-Profile":u.va}),this.g.S=l,(l=u&&u.Sb)&&!P(l)&&(this.g.m=l),this.v=u&&u.supportsCrossDomainXhr||!1,this.u=u&&u.sendRawJson||!1,(u=u&&u.httpSessionIdParam)&&!P(u)&&(this.g.D=u,l=this.h,l!==null&&u in l&&(l=this.h,u in l&&delete l[u])),this.j=new cn(this)}$(yr,W),yr.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},yr.prototype.close=function(){Bo(this.g)},yr.prototype.o=function(l){var u=this.g;if(typeof l=="string"){var g={};g.__data__=l,l=g}else this.u&&(g={},g.__data__=lt(l),l=g);u.i.push(new G0(u.Ya++,l)),u.G==3&&si(u)},yr.prototype.N=function(){this.g.l=null,delete this.j,Bo(this.g),delete this.g,yr.aa.N.call(this)};function Bd(l){br.call(this),l.__headers__&&(this.headers=l.__headers__,this.statusCode=l.__status__,delete l.__headers__,delete l.__status__);var u=l.__sm__;if(u){e:{for(const g in u){l=g;break e}l=void 0}(this.i=l)&&(l=this.i,u=u!==null&&l in u?u[l]:void 0),this.data=u}else this.data=l}$(Bd,br);function qd(){Kt.call(this),this.status=1}$(qd,Kt);function cn(l){this.g=l}$(cn,Ud),cn.prototype.ua=function(){Ne(this.g,"a")},cn.prototype.ta=function(l){Ne(this.g,new Bd(l))},cn.prototype.sa=function(l){Ne(this.g,new qd)},cn.prototype.ra=function(){Ne(this.g,"b")},ai.prototype.createWebChannel=ai.prototype.g,yr.prototype.send=yr.prototype.o,yr.prototype.open=yr.prototype.m,yr.prototype.close=yr.prototype.close,wm=function(){return new ai},vm=function(){return Oe()},ym=Yt,jl={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},yt.NO_ERROR=0,yt.TIMEOUT=8,yt.HTTP_ERROR=6,bi=yt,Ct.COMPLETE="complete",bm=Ct,ot.EventType=ht,ht.OPEN="a",ht.CLOSE="b",ht.ERROR="c",ht.MESSAGE="d",W.prototype.listen=W.prototype.K,la=ot,It.prototype.listenOnce=It.prototype.L,It.prototype.getLastError=It.prototype.Ka,It.prototype.getLastErrorCode=It.prototype.Ba,It.prototype.getStatus=It.prototype.Z,It.prototype.getResponseJson=It.prototype.Oa,It.prototype.getResponseText=It.prototype.oa,It.prototype.send=It.prototype.ea,It.prototype.setWithCredentials=It.prototype.Ha,fm=It}).apply(typeof li<"u"?li:typeof self<"u"?self:typeof window<"u"?window:{});const ou="@firebase/firestore";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zt{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}Zt.UNAUTHENTICATED=new Zt(null),Zt.GOOGLE_CREDENTIALS=new Zt("google-credentials-uid"),Zt.FIRST_PARTY=new Zt("first-party-uid"),Zt.MOCK_USER=new Zt("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Fn="10.14.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Zs=new sc("@firebase/firestore");function sa(){return Zs.logLevel}function Se(s,...e){if(Zs.logLevel<=st.DEBUG){const t=e.map(ic);Zs.debug(`Firestore (${Fn}): ${s}`,...t)}}function cs(s,...e){if(Zs.logLevel<=st.ERROR){const t=e.map(ic);Zs.error(`Firestore (${Fn}): ${s}`,...t)}}function Sn(s,...e){if(Zs.logLevel<=st.WARN){const t=e.map(ic);Zs.warn(`Firestore (${Fn}): ${s}`,...t)}}function ic(s){if(typeof s=="string")return s;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return function(t){return JSON.stringify(t)}(s)}catch{return s}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qe(s="Unexpected state"){const e=`FIRESTORE (${Fn}) INTERNAL ASSERTION FAILED: `+s;throw cs(e),new Error(e)}function pt(s,e){s||qe()}function Ge(s,e){return s}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const he={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Ee extends Wr{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ns{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class km{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class kb{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(Zt.UNAUTHENTICATED))}shutdown(){}}class Nb{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class jb{constructor(e){this.t=e,this.currentUser=Zt.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){pt(this.o===void 0);let n=this.i;const a=d=>this.i!==n?(n=this.i,t(d)):Promise.resolve();let i=new ns;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new ns,e.enqueueRetryable(()=>a(this.currentUser))};const o=()=>{const d=i;e.enqueueRetryable(async()=>{await d.promise,await a(this.currentUser)})},c=d=>{Se("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=d,this.o&&(this.auth.addAuthTokenListener(this.o),o())};this.t.onInit(d=>c(d)),setTimeout(()=>{if(!this.auth){const d=this.t.getImmediate({optional:!0});d?c(d):(Se("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new ns)}},0),o()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(n=>this.i!==e?(Se("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):n?(pt(typeof n.accessToken=="string"),new km(n.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return pt(e===null||typeof e=="string"),new Zt(e)}}class _b{constructor(e,t,n){this.l=e,this.h=t,this.P=n,this.type="FirstParty",this.user=Zt.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);const e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class Eb{constructor(e,t,n){this.l=e,this.h=t,this.P=n}getToken(){return Promise.resolve(new _b(this.l,this.h,this.P))}start(e,t){e.enqueueRetryable(()=>t(Zt.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class Ib{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class Tb{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,t){pt(this.o===void 0);const n=i=>{i.error!=null&&Se("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${i.error.message}`);const o=i.token!==this.R;return this.R=i.token,Se("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?t(i.token):Promise.resolve()};this.o=i=>{e.enqueueRetryable(()=>n(i))};const a=i=>{Se("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=i,this.o&&this.appCheck.addTokenListener(this.o)};this.A.onInit(i=>a(i)),setTimeout(()=>{if(!this.appCheck){const i=this.A.getImmediate({optional:!0});i?a(i):Se("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(pt(typeof t.token=="string"),this.R=t.token,new Ib(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Sb(s){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(s);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let n=0;n<s;n++)t[n]=Math.floor(256*Math.random());return t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nm{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length;let n="";for(;n.length<20;){const a=Sb(40);for(let i=0;i<a.length;++i)n.length<20&&a[i]<t&&(n+=e.charAt(a[i]%e.length))}return n}}function ut(s,e){return s<e?-1:s>e?1:0}function An(s,e,t){return s.length===e.length&&s.every((n,a)=>t(n,e[a]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mt{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new Ee(he.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new Ee(he.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new Ee(he.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new Ee(he.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return Mt.fromMillis(Date.now())}static fromDate(e){return Mt.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),n=Math.floor(1e6*(e-1e3*t));return new Mt(t,n)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?ut(this.nanoseconds,e.nanoseconds):ut(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class He{constructor(e){this.timestamp=e}static fromTimestamp(e){return new He(e)}static min(){return new He(new Mt(0,0))}static max(){return new He(new Mt(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Na{constructor(e,t,n){t===void 0?t=0:t>e.length&&qe(),n===void 0?n=e.length-t:n>e.length-t&&qe(),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return Na.comparator(this,e)===0}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof Na?e.forEach(n=>{t.push(n)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const n=Math.min(e.length,t.length);for(let a=0;a<n;a++){const i=e.get(a),o=t.get(a);if(i<o)return-1;if(i>o)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class wt extends Na{construct(e,t,n){return new wt(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const n of e){if(n.indexOf("//")>=0)throw new Ee(he.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter(a=>a.length>0))}return new wt(t)}static emptyPath(){return new wt([])}}const Ab=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class zt extends Na{construct(e,t,n){return new zt(e,t,n)}static isValidIdentifier(e){return Ab.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),zt.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new zt(["__name__"])}static fromServerFormat(e){const t=[];let n="",a=0;const i=()=>{if(n.length===0)throw new Ee(he.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""};let o=!1;for(;a<e.length;){const c=e[a];if(c==="\\"){if(a+1===e.length)throw new Ee(he.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const d=e[a+1];if(d!=="\\"&&d!=="."&&d!=="`")throw new Ee(he.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=d,a+=2}else c==="`"?(o=!o,a++):c!=="."||o?(n+=c,a++):(i(),a++)}if(i(),o)throw new Ee(he.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new zt(t)}static emptyPath(){return new zt([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ve{constructor(e){this.path=e}static fromPath(e){return new Ve(wt.fromString(e))}static fromName(e){return new Ve(wt.fromString(e).popFirst(5))}static empty(){return new Ve(wt.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&wt.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return wt.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new Ve(new wt(e.slice()))}}function Cb(s,e){const t=s.toTimestamp().seconds,n=s.toTimestamp().nanoseconds+1,a=He.fromTimestamp(n===1e9?new Mt(t+1,0):new Mt(t,n));return new Ps(a,Ve.empty(),e)}function Db(s){return new Ps(s.readTime,s.key,-1)}class Ps{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new Ps(He.min(),Ve.empty(),-1)}static max(){return new Ps(He.max(),Ve.empty(),-1)}}function $b(s,e){let t=s.readTime.compareTo(e.readTime);return t!==0?t:(t=Ve.comparator(s.documentKey,e.documentKey),t!==0?t:ut(s.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Rb="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class Pb{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function La(s){if(s.code!==he.FAILED_PRECONDITION||s.message!==Rb)throw s;Se("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fe{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&qe(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new fe((n,a)=>{this.nextCallback=i=>{this.wrapSuccess(e,i).next(n,a)},this.catchCallback=i=>{this.wrapFailure(t,i).next(n,a)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof fe?t:fe.resolve(t)}catch(t){return fe.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):fe.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):fe.reject(t)}static resolve(e){return new fe((t,n)=>{t(e)})}static reject(e){return new fe((t,n)=>{n(e)})}static waitFor(e){return new fe((t,n)=>{let a=0,i=0,o=!1;e.forEach(c=>{++a,c.next(()=>{++i,o&&i===a&&t()},d=>n(d))}),o=!0,i===a&&t()})}static or(e){let t=fe.resolve(!1);for(const n of e)t=t.next(a=>a?fe.resolve(a):n());return t}static forEach(e,t){const n=[];return e.forEach((a,i)=>{n.push(t.call(this,a,i))}),this.waitFor(n)}static mapArray(e,t){return new fe((n,a)=>{const i=e.length,o=new Array(i);let c=0;for(let d=0;d<i;d++){const h=d;t(e[h]).next(m=>{o[h]=m,++c,c===i&&n(o)},m=>a(m))}})}static doWhile(e,t){return new fe((n,a)=>{const i=()=>{e()===!0?t().next(()=>{i()},a):n()};i()})}}function Mb(s){const e=s.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}function Fa(s){return s.name==="IndexedDbTransactionError"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oc{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=n=>this.ie(n),this.se=n=>t.writeSequenceNumber(n))}ie(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.se&&this.se(e),e}}oc.oe=-1;function co(s){return s==null}function Ri(s){return s===0&&1/s==-1/0}function Ob(s){return typeof s=="number"&&Number.isInteger(s)&&!Ri(s)&&s<=Number.MAX_SAFE_INTEGER&&s>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lu(s){let e=0;for(const t in s)Object.prototype.hasOwnProperty.call(s,t)&&e++;return e}function nn(s,e){for(const t in s)Object.prototype.hasOwnProperty.call(s,t)&&e(t,s[t])}function jm(s){for(const e in s)if(Object.prototype.hasOwnProperty.call(s,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jt{constructor(e,t){this.comparator=e,this.root=t||Bt.EMPTY}insert(e,t){return new jt(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Bt.BLACK,null,null))}remove(e){return new jt(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Bt.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const n=this.comparator(e,t.key);if(n===0)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){const a=this.comparator(e,n.key);if(a===0)return t+n.left.size;a<0?n=n.left:(t+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,n)=>(e(t,n),!1))}toString(){const e=[];return this.inorderTraversal((t,n)=>(e.push(`${t}:${n}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new ci(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new ci(this.root,e,this.comparator,!1)}getReverseIterator(){return new ci(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new ci(this.root,e,this.comparator,!0)}}class ci{constructor(e,t,n,a){this.isReverse=a,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?n(e.key,t):1,t&&a&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(i===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Bt{constructor(e,t,n,a,i){this.key=e,this.value=t,this.color=n??Bt.RED,this.left=a??Bt.EMPTY,this.right=i??Bt.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,a,i){return new Bt(e??this.key,t??this.value,n??this.color,a??this.left,i??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let a=this;const i=n(e,a.key);return a=i<0?a.copy(null,null,null,a.left.insert(e,t,n),null):i===0?a.copy(null,t,null,null,null):a.copy(null,null,null,null,a.right.insert(e,t,n)),a.fixUp()}removeMin(){if(this.left.isEmpty())return Bt.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let n,a=this;if(t(e,a.key)<0)a.left.isEmpty()||a.left.isRed()||a.left.left.isRed()||(a=a.moveRedLeft()),a=a.copy(null,null,null,a.left.remove(e,t),null);else{if(a.left.isRed()&&(a=a.rotateRight()),a.right.isEmpty()||a.right.isRed()||a.right.left.isRed()||(a=a.moveRedRight()),t(e,a.key)===0){if(a.right.isEmpty())return Bt.EMPTY;n=a.right.min(),a=a.copy(n.key,n.value,null,null,a.right.removeMin())}a=a.copy(null,null,null,null,a.right.remove(e,t))}return a.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Bt.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Bt.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw qe();const e=this.left.check();if(e!==this.right.check())throw qe();return e+(this.isRed()?0:1)}}Bt.EMPTY=null,Bt.RED=!0,Bt.BLACK=!1;Bt.EMPTY=new class{constructor(){this.size=0}get key(){throw qe()}get value(){throw qe()}get color(){throw qe()}get left(){throw qe()}get right(){throw qe()}copy(e,t,n,a,i){return this}insert(e,t,n){return new Bt(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wt{constructor(e){this.comparator=e,this.data=new jt(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,n)=>(e(t),!1))}forEachInRange(e,t){const n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){const a=n.getNext();if(this.comparator(a.key,e[1])>=0)return;t(a.key)}}forEachWhile(e,t){let n;for(n=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new cu(this.data.getIterator())}getIteratorFrom(e){return new cu(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(n=>{t=t.add(n)}),t}isEqual(e){if(!(e instanceof Wt)||this.size!==e.size)return!1;const t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){const a=t.getNext().key,i=n.getNext().key;if(this.comparator(a,i)!==0)return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new Wt(this.comparator);return t.data=e,t}}class cu{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vr{constructor(e){this.fields=e,e.sort(zt.comparator)}static empty(){return new vr([])}unionWith(e){let t=new Wt(zt.comparator);for(const n of this.fields)t=t.add(n);for(const n of e)t=t.add(n);return new vr(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return An(this.fields,e.fields,(t,n)=>t.isEqual(n))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _m extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ht{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(a){try{return atob(a)}catch(i){throw typeof DOMException<"u"&&i instanceof DOMException?new _m("Invalid base64 string: "+i):i}}(e);return new Ht(t)}static fromUint8Array(e){const t=function(a){let i="";for(let o=0;o<a.length;++o)i+=String.fromCharCode(a[o]);return i}(e);return new Ht(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(t){return btoa(t)}(this.binaryString)}toUint8Array(){return function(t){const n=new Uint8Array(t.length);for(let a=0;a<t.length;a++)n[a]=t.charCodeAt(a);return n}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return ut(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Ht.EMPTY_BYTE_STRING=new Ht("");const Vb=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Ms(s){if(pt(!!s),typeof s=="string"){let e=0;const t=Vb.exec(s);if(pt(!!t),t[1]){let a=t[1];a=(a+"000000000").substr(0,9),e=Number(a)}const n=new Date(s);return{seconds:Math.floor(n.getTime()/1e3),nanos:e}}return{seconds:St(s.seconds),nanos:St(s.nanos)}}function St(s){return typeof s=="number"?s:typeof s=="string"?Number(s):0}function en(s){return typeof s=="string"?Ht.fromBase64String(s):Ht.fromUint8Array(s)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lc(s){var e,t;return((t=(((e=s==null?void 0:s.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||t===void 0?void 0:t.stringValue)==="server_timestamp"}function cc(s){const e=s.mapValue.fields.__previous_value__;return lc(e)?cc(e):e}function ja(s){const e=Ms(s.mapValue.fields.__local_write_time__.timestampValue);return new Mt(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lb{constructor(e,t,n,a,i,o,c,d,h){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=a,this.ssl=i,this.forceLongPolling=o,this.autoDetectLongPolling=c,this.longPollingOptions=d,this.useFetchStreams=h}}class _a{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new _a("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(e){return e instanceof _a&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const di={mapValue:{}};function tn(s){return"nullValue"in s?0:"booleanValue"in s?1:"integerValue"in s||"doubleValue"in s?2:"timestampValue"in s?3:"stringValue"in s?5:"bytesValue"in s?6:"referenceValue"in s?7:"geoPointValue"in s?8:"arrayValue"in s?9:"mapValue"in s?lc(s)?4:Ub(s)?9007199254740991:Fb(s)?10:11:qe()}function Br(s,e){if(s===e)return!0;const t=tn(s);if(t!==tn(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return s.booleanValue===e.booleanValue;case 4:return ja(s).isEqual(ja(e));case 3:return function(a,i){if(typeof a.timestampValue=="string"&&typeof i.timestampValue=="string"&&a.timestampValue.length===i.timestampValue.length)return a.timestampValue===i.timestampValue;const o=Ms(a.timestampValue),c=Ms(i.timestampValue);return o.seconds===c.seconds&&o.nanos===c.nanos}(s,e);case 5:return s.stringValue===e.stringValue;case 6:return function(a,i){return en(a.bytesValue).isEqual(en(i.bytesValue))}(s,e);case 7:return s.referenceValue===e.referenceValue;case 8:return function(a,i){return St(a.geoPointValue.latitude)===St(i.geoPointValue.latitude)&&St(a.geoPointValue.longitude)===St(i.geoPointValue.longitude)}(s,e);case 2:return function(a,i){if("integerValue"in a&&"integerValue"in i)return St(a.integerValue)===St(i.integerValue);if("doubleValue"in a&&"doubleValue"in i){const o=St(a.doubleValue),c=St(i.doubleValue);return o===c?Ri(o)===Ri(c):isNaN(o)&&isNaN(c)}return!1}(s,e);case 9:return An(s.arrayValue.values||[],e.arrayValue.values||[],Br);case 10:case 11:return function(a,i){const o=a.mapValue.fields||{},c=i.mapValue.fields||{};if(lu(o)!==lu(c))return!1;for(const d in o)if(o.hasOwnProperty(d)&&(c[d]===void 0||!Br(o[d],c[d])))return!1;return!0}(s,e);default:return qe()}}function Ea(s,e){return(s.values||[]).find(t=>Br(t,e))!==void 0}function Cn(s,e){if(s===e)return 0;const t=tn(s),n=tn(e);if(t!==n)return ut(t,n);switch(t){case 0:case 9007199254740991:return 0;case 1:return ut(s.booleanValue,e.booleanValue);case 2:return function(i,o){const c=St(i.integerValue||i.doubleValue),d=St(o.integerValue||o.doubleValue);return c<d?-1:c>d?1:c===d?0:isNaN(c)?isNaN(d)?0:-1:1}(s,e);case 3:return du(s.timestampValue,e.timestampValue);case 4:return du(ja(s),ja(e));case 5:return ut(s.stringValue,e.stringValue);case 6:return function(i,o){const c=en(i),d=en(o);return c.compareTo(d)}(s.bytesValue,e.bytesValue);case 7:return function(i,o){const c=i.split("/"),d=o.split("/");for(let h=0;h<c.length&&h<d.length;h++){const m=ut(c[h],d[h]);if(m!==0)return m}return ut(c.length,d.length)}(s.referenceValue,e.referenceValue);case 8:return function(i,o){const c=ut(St(i.latitude),St(o.latitude));return c!==0?c:ut(St(i.longitude),St(o.longitude))}(s.geoPointValue,e.geoPointValue);case 9:return uu(s.arrayValue,e.arrayValue);case 10:return function(i,o){var c,d,h,m;const x=i.fields||{},f=o.fields||{},w=(c=x.value)===null||c===void 0?void 0:c.arrayValue,$=(d=f.value)===null||d===void 0?void 0:d.arrayValue,A=ut(((h=w==null?void 0:w.values)===null||h===void 0?void 0:h.length)||0,((m=$==null?void 0:$.values)===null||m===void 0?void 0:m.length)||0);return A!==0?A:uu(w,$)}(s.mapValue,e.mapValue);case 11:return function(i,o){if(i===di.mapValue&&o===di.mapValue)return 0;if(i===di.mapValue)return 1;if(o===di.mapValue)return-1;const c=i.fields||{},d=Object.keys(c),h=o.fields||{},m=Object.keys(h);d.sort(),m.sort();for(let x=0;x<d.length&&x<m.length;++x){const f=ut(d[x],m[x]);if(f!==0)return f;const w=Cn(c[d[x]],h[m[x]]);if(w!==0)return w}return ut(d.length,m.length)}(s.mapValue,e.mapValue);default:throw qe()}}function du(s,e){if(typeof s=="string"&&typeof e=="string"&&s.length===e.length)return ut(s,e);const t=Ms(s),n=Ms(e),a=ut(t.seconds,n.seconds);return a!==0?a:ut(t.nanos,n.nanos)}function uu(s,e){const t=s.values||[],n=e.values||[];for(let a=0;a<t.length&&a<n.length;++a){const i=Cn(t[a],n[a]);if(i)return i}return ut(t.length,n.length)}function Dn(s){return _l(s)}function _l(s){return"nullValue"in s?"null":"booleanValue"in s?""+s.booleanValue:"integerValue"in s?""+s.integerValue:"doubleValue"in s?""+s.doubleValue:"timestampValue"in s?function(t){const n=Ms(t);return`time(${n.seconds},${n.nanos})`}(s.timestampValue):"stringValue"in s?s.stringValue:"bytesValue"in s?function(t){return en(t).toBase64()}(s.bytesValue):"referenceValue"in s?function(t){return Ve.fromName(t).toString()}(s.referenceValue):"geoPointValue"in s?function(t){return`geo(${t.latitude},${t.longitude})`}(s.geoPointValue):"arrayValue"in s?function(t){let n="[",a=!0;for(const i of t.values||[])a?a=!1:n+=",",n+=_l(i);return n+"]"}(s.arrayValue):"mapValue"in s?function(t){const n=Object.keys(t.fields||{}).sort();let a="{",i=!0;for(const o of n)i?i=!1:a+=",",a+=`${o}:${_l(t.fields[o])}`;return a+"}"}(s.mapValue):qe()}function hu(s,e){return{referenceValue:`projects/${s.projectId}/databases/${s.database}/documents/${e.path.canonicalString()}`}}function El(s){return!!s&&"integerValue"in s}function dc(s){return!!s&&"arrayValue"in s}function mu(s){return!!s&&"nullValue"in s}function gu(s){return!!s&&"doubleValue"in s&&isNaN(Number(s.doubleValue))}function yi(s){return!!s&&"mapValue"in s}function Fb(s){var e,t;return((t=(((e=s==null?void 0:s.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||t===void 0?void 0:t.stringValue)==="__vector__"}function ha(s){if(s.geoPointValue)return{geoPointValue:Object.assign({},s.geoPointValue)};if(s.timestampValue&&typeof s.timestampValue=="object")return{timestampValue:Object.assign({},s.timestampValue)};if(s.mapValue){const e={mapValue:{fields:{}}};return nn(s.mapValue.fields,(t,n)=>e.mapValue.fields[t]=ha(n)),e}if(s.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(s.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=ha(s.arrayValue.values[t]);return e}return Object.assign({},s)}function Ub(s){return(((s.mapValue||{}).fields||{}).__type__||{}).stringValue==="__max__"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gr{constructor(e){this.value=e}static empty(){return new gr({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(t=(t.mapValue.fields||{})[e.get(n)],!yi(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=ha(t)}setAll(e){let t=zt.emptyPath(),n={},a=[];e.forEach((o,c)=>{if(!t.isImmediateParentOf(c)){const d=this.getFieldsMap(t);this.applyChanges(d,n,a),n={},a=[],t=c.popLast()}o?n[c.lastSegment()]=ha(o):a.push(c.lastSegment())});const i=this.getFieldsMap(t);this.applyChanges(i,n,a)}delete(e){const t=this.field(e.popLast());yi(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Br(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let a=t.mapValue.fields[e.get(n)];yi(a)&&a.mapValue.fields||(a={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=a),t=a}return t.mapValue.fields}applyChanges(e,t,n){nn(t,(a,i)=>e[a]=i);for(const a of n)delete e[a]}clone(){return new gr(ha(this.value))}}function Em(s){const e=[];return nn(s.fields,(t,n)=>{const a=new zt([t]);if(yi(n)){const i=Em(n.mapValue).fields;if(i.length===0)e.push(a);else for(const o of i)e.push(a.child(o))}else e.push(a)}),new vr(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tr{constructor(e,t,n,a,i,o,c){this.key=e,this.documentType=t,this.version=n,this.readTime=a,this.createTime=i,this.data=o,this.documentState=c}static newInvalidDocument(e){return new tr(e,0,He.min(),He.min(),He.min(),gr.empty(),0)}static newFoundDocument(e,t,n,a){return new tr(e,1,t,He.min(),n,a,0)}static newNoDocument(e,t){return new tr(e,2,t,He.min(),He.min(),gr.empty(),0)}static newUnknownDocument(e,t){return new tr(e,3,t,He.min(),He.min(),gr.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(He.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=gr.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=gr.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=He.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof tr&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new tr(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pi{constructor(e,t){this.position=e,this.inclusive=t}}function pu(s,e,t){let n=0;for(let a=0;a<s.position.length;a++){const i=e[a],o=s.position[a];if(i.field.isKeyField()?n=Ve.comparator(Ve.fromName(o.referenceValue),t.key):n=Cn(o,t.data.field(i.field)),i.dir==="desc"&&(n*=-1),n!==0)break}return n}function xu(s,e){if(s===null)return e===null;if(e===null||s.inclusive!==e.inclusive||s.position.length!==e.position.length)return!1;for(let t=0;t<s.position.length;t++)if(!Br(s.position[t],e.position[t]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ia{constructor(e,t="asc"){this.field=e,this.dir=t}}function Bb(s,e){return s.dir===e.dir&&s.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Im{}class $t extends Im{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,n):new zb(e,t,n):t==="array-contains"?new Gb(e,n):t==="in"?new Kb(e,n):t==="not-in"?new Yb(e,n):t==="array-contains-any"?new Qb(e,n):new $t(e,t,n)}static createKeyFieldInFilter(e,t,n){return t==="in"?new Wb(e,n):new Hb(e,n)}matches(e){const t=e.data.field(this.field);return this.op==="!="?t!==null&&this.matchesComparison(Cn(t,this.value)):t!==null&&tn(this.value)===tn(t)&&this.matchesComparison(Cn(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return qe()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class Cr extends Im{constructor(e,t){super(),this.filters=e,this.op=t,this.ae=null}static create(e,t){return new Cr(e,t)}matches(e){return Tm(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.ae!==null||(this.ae=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.ae}getFilters(){return Object.assign([],this.filters)}}function Tm(s){return s.op==="and"}function Sm(s){return qb(s)&&Tm(s)}function qb(s){for(const e of s.filters)if(e instanceof Cr)return!1;return!0}function Il(s){if(s instanceof $t)return s.field.canonicalString()+s.op.toString()+Dn(s.value);if(Sm(s))return s.filters.map(e=>Il(e)).join(",");{const e=s.filters.map(t=>Il(t)).join(",");return`${s.op}(${e})`}}function Am(s,e){return s instanceof $t?function(n,a){return a instanceof $t&&n.op===a.op&&n.field.isEqual(a.field)&&Br(n.value,a.value)}(s,e):s instanceof Cr?function(n,a){return a instanceof Cr&&n.op===a.op&&n.filters.length===a.filters.length?n.filters.reduce((i,o,c)=>i&&Am(o,a.filters[c]),!0):!1}(s,e):void qe()}function Cm(s){return s instanceof $t?function(t){return`${t.field.canonicalString()} ${t.op} ${Dn(t.value)}`}(s):s instanceof Cr?function(t){return t.op.toString()+" {"+t.getFilters().map(Cm).join(" ,")+"}"}(s):"Filter"}class zb extends $t{constructor(e,t,n){super(e,t,n),this.key=Ve.fromName(n.referenceValue)}matches(e){const t=Ve.comparator(e.key,this.key);return this.matchesComparison(t)}}class Wb extends $t{constructor(e,t){super(e,"in",t),this.keys=Dm("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class Hb extends $t{constructor(e,t){super(e,"not-in",t),this.keys=Dm("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function Dm(s,e){var t;return(((t=e.arrayValue)===null||t===void 0?void 0:t.values)||[]).map(n=>Ve.fromName(n.referenceValue))}class Gb extends $t{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return dc(t)&&Ea(t.arrayValue,this.value)}}class Kb extends $t{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return t!==null&&Ea(this.value.arrayValue,t)}}class Yb extends $t{constructor(e,t){super(e,"not-in",t)}matches(e){if(Ea(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return t!==null&&!Ea(this.value.arrayValue,t)}}class Qb extends $t{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!dc(t)||!t.arrayValue.values)&&t.arrayValue.values.some(n=>Ea(this.value.arrayValue,n))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xb{constructor(e,t=null,n=[],a=[],i=null,o=null,c=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=a,this.limit=i,this.startAt=o,this.endAt=c,this.ue=null}}function fu(s,e=null,t=[],n=[],a=null,i=null,o=null){return new Xb(s,e,t,n,a,i,o)}function uc(s){const e=Ge(s);if(e.ue===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(n=>Il(n)).join(","),t+="|ob:",t+=e.orderBy.map(n=>function(i){return i.field.canonicalString()+i.dir}(n)).join(","),co(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(n=>Dn(n)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(n=>Dn(n)).join(",")),e.ue=t}return e.ue}function hc(s,e){if(s.limit!==e.limit||s.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<s.orderBy.length;t++)if(!Bb(s.orderBy[t],e.orderBy[t]))return!1;if(s.filters.length!==e.filters.length)return!1;for(let t=0;t<s.filters.length;t++)if(!Am(s.filters[t],e.filters[t]))return!1;return s.collectionGroup===e.collectionGroup&&!!s.path.isEqual(e.path)&&!!xu(s.startAt,e.startAt)&&xu(s.endAt,e.endAt)}function Tl(s){return Ve.isDocumentKey(s.path)&&s.collectionGroup===null&&s.filters.length===0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Un{constructor(e,t=null,n=[],a=[],i=null,o="F",c=null,d=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=a,this.limit=i,this.limitType=o,this.startAt=c,this.endAt=d,this.ce=null,this.le=null,this.he=null,this.startAt,this.endAt}}function Jb(s,e,t,n,a,i,o,c){return new Un(s,e,t,n,a,i,o,c)}function mc(s){return new Un(s)}function bu(s){return s.filters.length===0&&s.limit===null&&s.startAt==null&&s.endAt==null&&(s.explicitOrderBy.length===0||s.explicitOrderBy.length===1&&s.explicitOrderBy[0].field.isKeyField())}function $m(s){return s.collectionGroup!==null}function ma(s){const e=Ge(s);if(e.ce===null){e.ce=[];const t=new Set;for(const i of e.explicitOrderBy)e.ce.push(i),t.add(i.field.canonicalString());const n=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(o){let c=new Wt(zt.comparator);return o.filters.forEach(d=>{d.getFlattenedFilters().forEach(h=>{h.isInequality()&&(c=c.add(h.field))})}),c})(e).forEach(i=>{t.has(i.canonicalString())||i.isKeyField()||e.ce.push(new Ia(i,n))}),t.has(zt.keyField().canonicalString())||e.ce.push(new Ia(zt.keyField(),n))}return e.ce}function Vr(s){const e=Ge(s);return e.le||(e.le=Zb(e,ma(s))),e.le}function Zb(s,e){if(s.limitType==="F")return fu(s.path,s.collectionGroup,e,s.filters,s.limit,s.startAt,s.endAt);{e=e.map(a=>{const i=a.dir==="desc"?"asc":"desc";return new Ia(a.field,i)});const t=s.endAt?new Pi(s.endAt.position,s.endAt.inclusive):null,n=s.startAt?new Pi(s.startAt.position,s.startAt.inclusive):null;return fu(s.path,s.collectionGroup,e,s.filters,s.limit,t,n)}}function Sl(s,e){const t=s.filters.concat([e]);return new Un(s.path,s.collectionGroup,s.explicitOrderBy.slice(),t,s.limit,s.limitType,s.startAt,s.endAt)}function Al(s,e,t){return new Un(s.path,s.collectionGroup,s.explicitOrderBy.slice(),s.filters.slice(),e,t,s.startAt,s.endAt)}function uo(s,e){return hc(Vr(s),Vr(e))&&s.limitType===e.limitType}function Rm(s){return`${uc(Vr(s))}|lt:${s.limitType}`}function gn(s){return`Query(target=${function(t){let n=t.path.canonicalString();return t.collectionGroup!==null&&(n+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(n+=`, filters: [${t.filters.map(a=>Cm(a)).join(", ")}]`),co(t.limit)||(n+=", limit: "+t.limit),t.orderBy.length>0&&(n+=`, orderBy: [${t.orderBy.map(a=>function(o){return`${o.field.canonicalString()} (${o.dir})`}(a)).join(", ")}]`),t.startAt&&(n+=", startAt: ",n+=t.startAt.inclusive?"b:":"a:",n+=t.startAt.position.map(a=>Dn(a)).join(",")),t.endAt&&(n+=", endAt: ",n+=t.endAt.inclusive?"a:":"b:",n+=t.endAt.position.map(a=>Dn(a)).join(",")),`Target(${n})`}(Vr(s))}; limitType=${s.limitType})`}function ho(s,e){return e.isFoundDocument()&&function(n,a){const i=a.key.path;return n.collectionGroup!==null?a.key.hasCollectionId(n.collectionGroup)&&n.path.isPrefixOf(i):Ve.isDocumentKey(n.path)?n.path.isEqual(i):n.path.isImmediateParentOf(i)}(s,e)&&function(n,a){for(const i of ma(n))if(!i.field.isKeyField()&&a.data.field(i.field)===null)return!1;return!0}(s,e)&&function(n,a){for(const i of n.filters)if(!i.matches(a))return!1;return!0}(s,e)&&function(n,a){return!(n.startAt&&!function(o,c,d){const h=pu(o,c,d);return o.inclusive?h<=0:h<0}(n.startAt,ma(n),a)||n.endAt&&!function(o,c,d){const h=pu(o,c,d);return o.inclusive?h>=0:h>0}(n.endAt,ma(n),a))}(s,e)}function ey(s){return s.collectionGroup||(s.path.length%2==1?s.path.lastSegment():s.path.get(s.path.length-2))}function Pm(s){return(e,t)=>{let n=!1;for(const a of ma(s)){const i=ty(a,e,t);if(i!==0)return i;n=n||a.field.isKeyField()}return 0}}function ty(s,e,t){const n=s.field.isKeyField()?Ve.comparator(e.key,t.key):function(i,o,c){const d=o.data.field(i),h=c.data.field(i);return d!==null&&h!==null?Cn(d,h):qe()}(s.field,e,t);switch(s.dir){case"asc":return n;case"desc":return-1*n;default:return qe()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bn{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),n=this.inner[t];if(n!==void 0){for(const[a,i]of n)if(this.equalsFn(a,e))return i}}has(e){return this.get(e)!==void 0}set(e,t){const n=this.mapKeyFn(e),a=this.inner[n];if(a===void 0)return this.inner[n]=[[e,t]],void this.innerSize++;for(let i=0;i<a.length;i++)if(this.equalsFn(a[i][0],e))return void(a[i]=[e,t]);a.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),n=this.inner[t];if(n===void 0)return!1;for(let a=0;a<n.length;a++)if(this.equalsFn(n[a][0],e))return n.length===1?delete this.inner[t]:n.splice(a,1),this.innerSize--,!0;return!1}forEach(e){nn(this.inner,(t,n)=>{for(const[a,i]of n)e(a,i)})}isEmpty(){return jm(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ry=new jt(Ve.comparator);function ds(){return ry}const Mm=new jt(Ve.comparator);function ca(...s){let e=Mm;for(const t of s)e=e.insert(t.key,t);return e}function Om(s){let e=Mm;return s.forEach((t,n)=>e=e.insert(t,n.overlayedDocument)),e}function Hs(){return ga()}function Vm(){return ga()}function ga(){return new Bn(s=>s.toString(),(s,e)=>s.isEqual(e))}const sy=new jt(Ve.comparator),ny=new Wt(Ve.comparator);function et(...s){let e=ny;for(const t of s)e=e.add(t);return e}const ay=new Wt(ut);function iy(){return ay}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gc(s,e){if(s.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Ri(e)?"-0":e}}function Lm(s){return{integerValue:""+s}}function oy(s,e){return Ob(e)?Lm(e):gc(s,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mo{constructor(){this._=void 0}}function ly(s,e,t){return s instanceof Mi?function(a,i){const o={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:a.seconds,nanos:a.nanoseconds}}}};return i&&lc(i)&&(i=cc(i)),i&&(o.fields.__previous_value__=i),{mapValue:o}}(t,e):s instanceof Ta?Um(s,e):s instanceof Sa?Bm(s,e):function(a,i){const o=Fm(a,i),c=yu(o)+yu(a.Pe);return El(o)&&El(a.Pe)?Lm(c):gc(a.serializer,c)}(s,e)}function cy(s,e,t){return s instanceof Ta?Um(s,e):s instanceof Sa?Bm(s,e):t}function Fm(s,e){return s instanceof Oi?function(n){return El(n)||function(i){return!!i&&"doubleValue"in i}(n)}(e)?e:{integerValue:0}:null}class Mi extends mo{}class Ta extends mo{constructor(e){super(),this.elements=e}}function Um(s,e){const t=qm(e);for(const n of s.elements)t.some(a=>Br(a,n))||t.push(n);return{arrayValue:{values:t}}}class Sa extends mo{constructor(e){super(),this.elements=e}}function Bm(s,e){let t=qm(e);for(const n of s.elements)t=t.filter(a=>!Br(a,n));return{arrayValue:{values:t}}}class Oi extends mo{constructor(e,t){super(),this.serializer=e,this.Pe=t}}function yu(s){return St(s.integerValue||s.doubleValue)}function qm(s){return dc(s)&&s.arrayValue.values?s.arrayValue.values.slice():[]}function dy(s,e){return s.field.isEqual(e.field)&&function(n,a){return n instanceof Ta&&a instanceof Ta||n instanceof Sa&&a instanceof Sa?An(n.elements,a.elements,Br):n instanceof Oi&&a instanceof Oi?Br(n.Pe,a.Pe):n instanceof Mi&&a instanceof Mi}(s.transform,e.transform)}class uy{constructor(e,t){this.version=e,this.transformResults=t}}class Ar{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new Ar}static exists(e){return new Ar(void 0,e)}static updateTime(e){return new Ar(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function vi(s,e){return s.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(s.updateTime):s.exists===void 0||s.exists===e.isFoundDocument()}class go{}function zm(s,e){if(!s.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return s.isNoDocument()?new pc(s.key,Ar.none()):new Ua(s.key,s.data,Ar.none());{const t=s.data,n=gr.empty();let a=new Wt(zt.comparator);for(let i of e.fields)if(!a.has(i)){let o=t.field(i);o===null&&i.length>1&&(i=i.popLast(),o=t.field(i)),o===null?n.delete(i):n.set(i,o),a=a.add(i)}return new Fs(s.key,n,new vr(a.toArray()),Ar.none())}}function hy(s,e,t){s instanceof Ua?function(a,i,o){const c=a.value.clone(),d=wu(a.fieldTransforms,i,o.transformResults);c.setAll(d),i.convertToFoundDocument(o.version,c).setHasCommittedMutations()}(s,e,t):s instanceof Fs?function(a,i,o){if(!vi(a.precondition,i))return void i.convertToUnknownDocument(o.version);const c=wu(a.fieldTransforms,i,o.transformResults),d=i.data;d.setAll(Wm(a)),d.setAll(c),i.convertToFoundDocument(o.version,d).setHasCommittedMutations()}(s,e,t):function(a,i,o){i.convertToNoDocument(o.version).setHasCommittedMutations()}(0,e,t)}function pa(s,e,t,n){return s instanceof Ua?function(i,o,c,d){if(!vi(i.precondition,o))return c;const h=i.value.clone(),m=ku(i.fieldTransforms,d,o);return h.setAll(m),o.convertToFoundDocument(o.version,h).setHasLocalMutations(),null}(s,e,t,n):s instanceof Fs?function(i,o,c,d){if(!vi(i.precondition,o))return c;const h=ku(i.fieldTransforms,d,o),m=o.data;return m.setAll(Wm(i)),m.setAll(h),o.convertToFoundDocument(o.version,m).setHasLocalMutations(),c===null?null:c.unionWith(i.fieldMask.fields).unionWith(i.fieldTransforms.map(x=>x.field))}(s,e,t,n):function(i,o,c){return vi(i.precondition,o)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):c}(s,e,t)}function my(s,e){let t=null;for(const n of s.fieldTransforms){const a=e.data.field(n.field),i=Fm(n.transform,a||null);i!=null&&(t===null&&(t=gr.empty()),t.set(n.field,i))}return t||null}function vu(s,e){return s.type===e.type&&!!s.key.isEqual(e.key)&&!!s.precondition.isEqual(e.precondition)&&!!function(n,a){return n===void 0&&a===void 0||!(!n||!a)&&An(n,a,(i,o)=>dy(i,o))}(s.fieldTransforms,e.fieldTransforms)&&(s.type===0?s.value.isEqual(e.value):s.type!==1||s.data.isEqual(e.data)&&s.fieldMask.isEqual(e.fieldMask))}class Ua extends go{constructor(e,t,n,a=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=a,this.type=0}getFieldMask(){return null}}class Fs extends go{constructor(e,t,n,a,i=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=a,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function Wm(s){const e=new Map;return s.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){const n=s.data.field(t);e.set(t,n)}}),e}function wu(s,e,t){const n=new Map;pt(s.length===t.length);for(let a=0;a<t.length;a++){const i=s[a],o=i.transform,c=e.data.field(i.field);n.set(i.field,cy(o,c,t[a]))}return n}function ku(s,e,t){const n=new Map;for(const a of s){const i=a.transform,o=t.data.field(a.field);n.set(a.field,ly(i,o,e))}return n}class pc extends go{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class gy extends go{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class py{constructor(e,t,n,a){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=a}applyToRemoteDocument(e,t){const n=t.mutationResults;for(let a=0;a<this.mutations.length;a++){const i=this.mutations[a];i.key.isEqual(e.key)&&hy(i,e,n[a])}}applyToLocalView(e,t){for(const n of this.baseMutations)n.key.isEqual(e.key)&&(t=pa(n,e,t,this.localWriteTime));for(const n of this.mutations)n.key.isEqual(e.key)&&(t=pa(n,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const n=Vm();return this.mutations.forEach(a=>{const i=e.get(a.key),o=i.overlayedDocument;let c=this.applyToLocalView(o,i.mutatedFields);c=t.has(a.key)?null:c;const d=zm(o,c);d!==null&&n.set(a.key,d),o.isValidDocument()||o.convertToNoDocument(He.min())}),n}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),et())}isEqual(e){return this.batchId===e.batchId&&An(this.mutations,e.mutations,(t,n)=>vu(t,n))&&An(this.baseMutations,e.baseMutations,(t,n)=>vu(t,n))}}class xc{constructor(e,t,n,a){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=a}static from(e,t,n){pt(e.mutations.length===n.length);let a=function(){return sy}();const i=e.mutations;for(let o=0;o<i.length;o++)a=a.insert(i[o].key,n[o].version);return new xc(e,t,n,a)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xy{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fy{constructor(e,t){this.count=e,this.unchangedNames=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Dt,nt;function by(s){switch(s){default:return qe();case he.CANCELLED:case he.UNKNOWN:case he.DEADLINE_EXCEEDED:case he.RESOURCE_EXHAUSTED:case he.INTERNAL:case he.UNAVAILABLE:case he.UNAUTHENTICATED:return!1;case he.INVALID_ARGUMENT:case he.NOT_FOUND:case he.ALREADY_EXISTS:case he.PERMISSION_DENIED:case he.FAILED_PRECONDITION:case he.ABORTED:case he.OUT_OF_RANGE:case he.UNIMPLEMENTED:case he.DATA_LOSS:return!0}}function Hm(s){if(s===void 0)return cs("GRPC error has no .code"),he.UNKNOWN;switch(s){case Dt.OK:return he.OK;case Dt.CANCELLED:return he.CANCELLED;case Dt.UNKNOWN:return he.UNKNOWN;case Dt.DEADLINE_EXCEEDED:return he.DEADLINE_EXCEEDED;case Dt.RESOURCE_EXHAUSTED:return he.RESOURCE_EXHAUSTED;case Dt.INTERNAL:return he.INTERNAL;case Dt.UNAVAILABLE:return he.UNAVAILABLE;case Dt.UNAUTHENTICATED:return he.UNAUTHENTICATED;case Dt.INVALID_ARGUMENT:return he.INVALID_ARGUMENT;case Dt.NOT_FOUND:return he.NOT_FOUND;case Dt.ALREADY_EXISTS:return he.ALREADY_EXISTS;case Dt.PERMISSION_DENIED:return he.PERMISSION_DENIED;case Dt.FAILED_PRECONDITION:return he.FAILED_PRECONDITION;case Dt.ABORTED:return he.ABORTED;case Dt.OUT_OF_RANGE:return he.OUT_OF_RANGE;case Dt.UNIMPLEMENTED:return he.UNIMPLEMENTED;case Dt.DATA_LOSS:return he.DATA_LOSS;default:return qe()}}(nt=Dt||(Dt={}))[nt.OK=0]="OK",nt[nt.CANCELLED=1]="CANCELLED",nt[nt.UNKNOWN=2]="UNKNOWN",nt[nt.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",nt[nt.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",nt[nt.NOT_FOUND=5]="NOT_FOUND",nt[nt.ALREADY_EXISTS=6]="ALREADY_EXISTS",nt[nt.PERMISSION_DENIED=7]="PERMISSION_DENIED",nt[nt.UNAUTHENTICATED=16]="UNAUTHENTICATED",nt[nt.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",nt[nt.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",nt[nt.ABORTED=10]="ABORTED",nt[nt.OUT_OF_RANGE=11]="OUT_OF_RANGE",nt[nt.UNIMPLEMENTED=12]="UNIMPLEMENTED",nt[nt.INTERNAL=13]="INTERNAL",nt[nt.UNAVAILABLE=14]="UNAVAILABLE",nt[nt.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yy(){return new TextEncoder}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vy=new Qs([4294967295,4294967295],0);function Nu(s){const e=yy().encode(s),t=new xm;return t.update(e),new Uint8Array(t.digest())}function ju(s){const e=new DataView(s.buffer),t=e.getUint32(0,!0),n=e.getUint32(4,!0),a=e.getUint32(8,!0),i=e.getUint32(12,!0);return[new Qs([t,n],0),new Qs([a,i],0)]}class fc{constructor(e,t,n){if(this.bitmap=e,this.padding=t,this.hashCount=n,t<0||t>=8)throw new da(`Invalid padding: ${t}`);if(n<0)throw new da(`Invalid hash count: ${n}`);if(e.length>0&&this.hashCount===0)throw new da(`Invalid hash count: ${n}`);if(e.length===0&&t!==0)throw new da(`Invalid padding when bitmap length is 0: ${t}`);this.Ie=8*e.length-t,this.Te=Qs.fromNumber(this.Ie)}Ee(e,t,n){let a=e.add(t.multiply(Qs.fromNumber(n)));return a.compare(vy)===1&&(a=new Qs([a.getBits(0),a.getBits(1)],0)),a.modulo(this.Te).toNumber()}de(e){return(this.bitmap[Math.floor(e/8)]&1<<e%8)!=0}mightContain(e){if(this.Ie===0)return!1;const t=Nu(e),[n,a]=ju(t);for(let i=0;i<this.hashCount;i++){const o=this.Ee(n,a,i);if(!this.de(o))return!1}return!0}static create(e,t,n){const a=e%8==0?0:8-e%8,i=new Uint8Array(Math.ceil(e/8)),o=new fc(i,a,t);return n.forEach(c=>o.insert(c)),o}insert(e){if(this.Ie===0)return;const t=Nu(e),[n,a]=ju(t);for(let i=0;i<this.hashCount;i++){const o=this.Ee(n,a,i);this.Ae(o)}}Ae(e){const t=Math.floor(e/8),n=e%8;this.bitmap[t]|=1<<n}}class da extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class po{constructor(e,t,n,a,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=a,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,n){const a=new Map;return a.set(e,Ba.createSynthesizedTargetChangeForCurrentChange(e,t,n)),new po(He.min(),a,new jt(ut),ds(),et())}}class Ba{constructor(e,t,n,a,i){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=a,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,n){return new Ba(n,t,et(),et(),et())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wi{constructor(e,t,n,a){this.Re=e,this.removedTargetIds=t,this.key=n,this.Ve=a}}class Gm{constructor(e,t){this.targetId=e,this.me=t}}class Km{constructor(e,t,n=Ht.EMPTY_BYTE_STRING,a=null){this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=a}}class _u{constructor(){this.fe=0,this.ge=Iu(),this.pe=Ht.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return this.fe!==0}get be(){return this.we}De(e){e.approximateByteSize()>0&&(this.we=!0,this.pe=e)}ve(){let e=et(),t=et(),n=et();return this.ge.forEach((a,i)=>{switch(i){case 0:e=e.add(a);break;case 2:t=t.add(a);break;case 1:n=n.add(a);break;default:qe()}}),new Ba(this.pe,this.ye,e,t,n)}Ce(){this.we=!1,this.ge=Iu()}Fe(e,t){this.we=!0,this.ge=this.ge.insert(e,t)}Me(e){this.we=!0,this.ge=this.ge.remove(e)}xe(){this.fe+=1}Oe(){this.fe-=1,pt(this.fe>=0)}Ne(){this.we=!0,this.ye=!0}}class wy{constructor(e){this.Le=e,this.Be=new Map,this.ke=ds(),this.qe=Eu(),this.Qe=new jt(ut)}Ke(e){for(const t of e.Re)e.Ve&&e.Ve.isFoundDocument()?this.$e(t,e.Ve):this.Ue(t,e.key,e.Ve);for(const t of e.removedTargetIds)this.Ue(t,e.key,e.Ve)}We(e){this.forEachTarget(e,t=>{const n=this.Ge(t);switch(e.state){case 0:this.ze(t)&&n.De(e.resumeToken);break;case 1:n.Oe(),n.Se||n.Ce(),n.De(e.resumeToken);break;case 2:n.Oe(),n.Se||this.removeTarget(t);break;case 3:this.ze(t)&&(n.Ne(),n.De(e.resumeToken));break;case 4:this.ze(t)&&(this.je(t),n.De(e.resumeToken));break;default:qe()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Be.forEach((n,a)=>{this.ze(a)&&t(a)})}He(e){const t=e.targetId,n=e.me.count,a=this.Je(t);if(a){const i=a.target;if(Tl(i))if(n===0){const o=new Ve(i.path);this.Ue(t,o,tr.newNoDocument(o,He.min()))}else pt(n===1);else{const o=this.Ye(t);if(o!==n){const c=this.Ze(e),d=c?this.Xe(c,e,o):1;if(d!==0){this.je(t);const h=d===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Qe=this.Qe.insert(t,h)}}}}}Ze(e){const t=e.me.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:n="",padding:a=0},hashCount:i=0}=t;let o,c;try{o=en(n).toUint8Array()}catch(d){if(d instanceof _m)return Sn("Decoding the base64 bloom filter in existence filter failed ("+d.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw d}try{c=new fc(o,a,i)}catch(d){return Sn(d instanceof da?"BloomFilter error: ":"Applying bloom filter failed: ",d),null}return c.Ie===0?null:c}Xe(e,t,n){return t.me.count===n-this.nt(e,t.targetId)?0:2}nt(e,t){const n=this.Le.getRemoteKeysForTarget(t);let a=0;return n.forEach(i=>{const o=this.Le.tt(),c=`projects/${o.projectId}/databases/${o.database}/documents/${i.path.canonicalString()}`;e.mightContain(c)||(this.Ue(t,i,null),a++)}),a}rt(e){const t=new Map;this.Be.forEach((i,o)=>{const c=this.Je(o);if(c){if(i.current&&Tl(c.target)){const d=new Ve(c.target.path);this.ke.get(d)!==null||this.it(o,d)||this.Ue(o,d,tr.newNoDocument(d,e))}i.be&&(t.set(o,i.ve()),i.Ce())}});let n=et();this.qe.forEach((i,o)=>{let c=!0;o.forEachWhile(d=>{const h=this.Je(d);return!h||h.purpose==="TargetPurposeLimboResolution"||(c=!1,!1)}),c&&(n=n.add(i))}),this.ke.forEach((i,o)=>o.setReadTime(e));const a=new po(e,t,this.Qe,this.ke,n);return this.ke=ds(),this.qe=Eu(),this.Qe=new jt(ut),a}$e(e,t){if(!this.ze(e))return;const n=this.it(e,t.key)?2:0;this.Ge(e).Fe(t.key,n),this.ke=this.ke.insert(t.key,t),this.qe=this.qe.insert(t.key,this.st(t.key).add(e))}Ue(e,t,n){if(!this.ze(e))return;const a=this.Ge(e);this.it(e,t)?a.Fe(t,1):a.Me(t),this.qe=this.qe.insert(t,this.st(t).delete(e)),n&&(this.ke=this.ke.insert(t,n))}removeTarget(e){this.Be.delete(e)}Ye(e){const t=this.Ge(e).ve();return this.Le.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}xe(e){this.Ge(e).xe()}Ge(e){let t=this.Be.get(e);return t||(t=new _u,this.Be.set(e,t)),t}st(e){let t=this.qe.get(e);return t||(t=new Wt(ut),this.qe=this.qe.insert(e,t)),t}ze(e){const t=this.Je(e)!==null;return t||Se("WatchChangeAggregator","Detected inactive target",e),t}Je(e){const t=this.Be.get(e);return t&&t.Se?null:this.Le.ot(e)}je(e){this.Be.set(e,new _u),this.Le.getRemoteKeysForTarget(e).forEach(t=>{this.Ue(e,t,null)})}it(e,t){return this.Le.getRemoteKeysForTarget(e).has(t)}}function Eu(){return new jt(Ve.comparator)}function Iu(){return new jt(Ve.comparator)}const ky={asc:"ASCENDING",desc:"DESCENDING"},Ny={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},jy={and:"AND",or:"OR"};class _y{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function Cl(s,e){return s.useProto3Json||co(e)?e:{value:e}}function Vi(s,e){return s.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function Ym(s,e){return s.useProto3Json?e.toBase64():e.toUint8Array()}function Ey(s,e){return Vi(s,e.toTimestamp())}function Lr(s){return pt(!!s),He.fromTimestamp(function(t){const n=Ms(t);return new Mt(n.seconds,n.nanos)}(s))}function bc(s,e){return Dl(s,e).canonicalString()}function Dl(s,e){const t=function(a){return new wt(["projects",a.projectId,"databases",a.database])}(s).child("documents");return e===void 0?t:t.child(e)}function Qm(s){const e=wt.fromString(s);return pt(tg(e)),e}function $l(s,e){return bc(s.databaseId,e.path)}function el(s,e){const t=Qm(e);if(t.get(1)!==s.databaseId.projectId)throw new Ee(he.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+s.databaseId.projectId);if(t.get(3)!==s.databaseId.database)throw new Ee(he.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+s.databaseId.database);return new Ve(Jm(t))}function Xm(s,e){return bc(s.databaseId,e)}function Iy(s){const e=Qm(s);return e.length===4?wt.emptyPath():Jm(e)}function Rl(s){return new wt(["projects",s.databaseId.projectId,"databases",s.databaseId.database]).canonicalString()}function Jm(s){return pt(s.length>4&&s.get(4)==="documents"),s.popFirst(5)}function Tu(s,e,t){return{name:$l(s,e),fields:t.value.mapValue.fields}}function Ty(s,e){let t;if("targetChange"in e){e.targetChange;const n=function(h){return h==="NO_CHANGE"?0:h==="ADD"?1:h==="REMOVE"?2:h==="CURRENT"?3:h==="RESET"?4:qe()}(e.targetChange.targetChangeType||"NO_CHANGE"),a=e.targetChange.targetIds||[],i=function(h,m){return h.useProto3Json?(pt(m===void 0||typeof m=="string"),Ht.fromBase64String(m||"")):(pt(m===void 0||m instanceof Buffer||m instanceof Uint8Array),Ht.fromUint8Array(m||new Uint8Array))}(s,e.targetChange.resumeToken),o=e.targetChange.cause,c=o&&function(h){const m=h.code===void 0?he.UNKNOWN:Hm(h.code);return new Ee(m,h.message||"")}(o);t=new Km(n,a,i,c||null)}else if("documentChange"in e){e.documentChange;const n=e.documentChange;n.document,n.document.name,n.document.updateTime;const a=el(s,n.document.name),i=Lr(n.document.updateTime),o=n.document.createTime?Lr(n.document.createTime):He.min(),c=new gr({mapValue:{fields:n.document.fields}}),d=tr.newFoundDocument(a,i,o,c),h=n.targetIds||[],m=n.removedTargetIds||[];t=new wi(h,m,d.key,d)}else if("documentDelete"in e){e.documentDelete;const n=e.documentDelete;n.document;const a=el(s,n.document),i=n.readTime?Lr(n.readTime):He.min(),o=tr.newNoDocument(a,i),c=n.removedTargetIds||[];t=new wi([],c,o.key,o)}else if("documentRemove"in e){e.documentRemove;const n=e.documentRemove;n.document;const a=el(s,n.document),i=n.removedTargetIds||[];t=new wi([],i,a,null)}else{if(!("filter"in e))return qe();{e.filter;const n=e.filter;n.targetId;const{count:a=0,unchangedNames:i}=n,o=new fy(a,i),c=n.targetId;t=new Gm(c,o)}}return t}function Sy(s,e){let t;if(e instanceof Ua)t={update:Tu(s,e.key,e.value)};else if(e instanceof pc)t={delete:$l(s,e.key)};else if(e instanceof Fs)t={update:Tu(s,e.key,e.data),updateMask:Vy(e.fieldMask)};else{if(!(e instanceof gy))return qe();t={verify:$l(s,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(n=>function(i,o){const c=o.transform;if(c instanceof Mi)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(c instanceof Ta)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:c.elements}};if(c instanceof Sa)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:c.elements}};if(c instanceof Oi)return{fieldPath:o.field.canonicalString(),increment:c.Pe};throw qe()}(0,n))),e.precondition.isNone||(t.currentDocument=function(a,i){return i.updateTime!==void 0?{updateTime:Ey(a,i.updateTime)}:i.exists!==void 0?{exists:i.exists}:qe()}(s,e.precondition)),t}function Ay(s,e){return s&&s.length>0?(pt(e!==void 0),s.map(t=>function(a,i){let o=a.updateTime?Lr(a.updateTime):Lr(i);return o.isEqual(He.min())&&(o=Lr(i)),new uy(o,a.transformResults||[])}(t,e))):[]}function Cy(s,e){return{documents:[Xm(s,e.path)]}}function Dy(s,e){const t={structuredQuery:{}},n=e.path;let a;e.collectionGroup!==null?(a=n,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(a=n.popLast(),t.structuredQuery.from=[{collectionId:n.lastSegment()}]),t.parent=Xm(s,a);const i=function(h){if(h.length!==0)return eg(Cr.create(h,"and"))}(e.filters);i&&(t.structuredQuery.where=i);const o=function(h){if(h.length!==0)return h.map(m=>function(f){return{field:pn(f.field),direction:Py(f.dir)}}(m))}(e.orderBy);o&&(t.structuredQuery.orderBy=o);const c=Cl(s,e.limit);return c!==null&&(t.structuredQuery.limit=c),e.startAt&&(t.structuredQuery.startAt=function(h){return{before:h.inclusive,values:h.position}}(e.startAt)),e.endAt&&(t.structuredQuery.endAt=function(h){return{before:!h.inclusive,values:h.position}}(e.endAt)),{_t:t,parent:a}}function $y(s){let e=Iy(s.parent);const t=s.structuredQuery,n=t.from?t.from.length:0;let a=null;if(n>0){pt(n===1);const m=t.from[0];m.allDescendants?a=m.collectionId:e=e.child(m.collectionId)}let i=[];t.where&&(i=function(x){const f=Zm(x);return f instanceof Cr&&Sm(f)?f.getFilters():[f]}(t.where));let o=[];t.orderBy&&(o=function(x){return x.map(f=>function($){return new Ia(xn($.field),function(T){switch(T){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}($.direction))}(f))}(t.orderBy));let c=null;t.limit&&(c=function(x){let f;return f=typeof x=="object"?x.value:x,co(f)?null:f}(t.limit));let d=null;t.startAt&&(d=function(x){const f=!!x.before,w=x.values||[];return new Pi(w,f)}(t.startAt));let h=null;return t.endAt&&(h=function(x){const f=!x.before,w=x.values||[];return new Pi(w,f)}(t.endAt)),Jb(e,a,o,i,c,"F",d,h)}function Ry(s,e){const t=function(a){switch(a){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return qe()}}(e.purpose);return t==null?null:{"goog-listen-tags":t}}function Zm(s){return s.unaryFilter!==void 0?function(t){switch(t.unaryFilter.op){case"IS_NAN":const n=xn(t.unaryFilter.field);return $t.create(n,"==",{doubleValue:NaN});case"IS_NULL":const a=xn(t.unaryFilter.field);return $t.create(a,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const i=xn(t.unaryFilter.field);return $t.create(i,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const o=xn(t.unaryFilter.field);return $t.create(o,"!=",{nullValue:"NULL_VALUE"});default:return qe()}}(s):s.fieldFilter!==void 0?function(t){return $t.create(xn(t.fieldFilter.field),function(a){switch(a){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return qe()}}(t.fieldFilter.op),t.fieldFilter.value)}(s):s.compositeFilter!==void 0?function(t){return Cr.create(t.compositeFilter.filters.map(n=>Zm(n)),function(a){switch(a){case"AND":return"and";case"OR":return"or";default:return qe()}}(t.compositeFilter.op))}(s):qe()}function Py(s){return ky[s]}function My(s){return Ny[s]}function Oy(s){return jy[s]}function pn(s){return{fieldPath:s.canonicalString()}}function xn(s){return zt.fromServerFormat(s.fieldPath)}function eg(s){return s instanceof $t?function(t){if(t.op==="=="){if(gu(t.value))return{unaryFilter:{field:pn(t.field),op:"IS_NAN"}};if(mu(t.value))return{unaryFilter:{field:pn(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(gu(t.value))return{unaryFilter:{field:pn(t.field),op:"IS_NOT_NAN"}};if(mu(t.value))return{unaryFilter:{field:pn(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:pn(t.field),op:My(t.op),value:t.value}}}(s):s instanceof Cr?function(t){const n=t.getFilters().map(a=>eg(a));return n.length===1?n[0]:{compositeFilter:{op:Oy(t.op),filters:n}}}(s):qe()}function Vy(s){const e=[];return s.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function tg(s){return s.length>=4&&s.get(0)==="projects"&&s.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Is{constructor(e,t,n,a,i=He.min(),o=He.min(),c=Ht.EMPTY_BYTE_STRING,d=null){this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=a,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=c,this.expectedCount=d}withSequenceNumber(e){return new Is(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new Is(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new Is(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new Is(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ly{constructor(e){this.ct=e}}function Fy(s){const e=$y({parent:s.parent,structuredQuery:s.structuredQuery});return s.limitType==="LAST"?Al(e,e.limit,"L"):e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Uy{constructor(){this.un=new By}addToCollectionParentIndex(e,t){return this.un.add(t),fe.resolve()}getCollectionParents(e,t){return fe.resolve(this.un.getEntries(t))}addFieldIndex(e,t){return fe.resolve()}deleteFieldIndex(e,t){return fe.resolve()}deleteAllFieldIndexes(e){return fe.resolve()}createTargetIndexes(e,t){return fe.resolve()}getDocumentsMatchingTarget(e,t){return fe.resolve(null)}getIndexType(e,t){return fe.resolve(0)}getFieldIndexes(e,t){return fe.resolve([])}getNextCollectionGroupToUpdate(e){return fe.resolve(null)}getMinOffset(e,t){return fe.resolve(Ps.min())}getMinOffsetFromCollectionGroup(e,t){return fe.resolve(Ps.min())}updateCollectionGroup(e,t,n){return fe.resolve()}updateIndexEntries(e,t){return fe.resolve()}}class By{constructor(){this.index={}}add(e){const t=e.lastSegment(),n=e.popLast(),a=this.index[t]||new Wt(wt.comparator),i=!a.has(n);return this.index[t]=a.add(n),i}has(e){const t=e.lastSegment(),n=e.popLast(),a=this.index[t];return a&&a.has(n)}getEntries(e){return(this.index[e]||new Wt(wt.comparator)).toArray()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $n{constructor(e){this.Ln=e}next(){return this.Ln+=2,this.Ln}static Bn(){return new $n(0)}static kn(){return new $n(-1)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qy{constructor(){this.changes=new Bn(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,tr.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const n=this.changes.get(t);return n!==void 0?fe.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zy{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wy{constructor(e,t,n,a){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=a}getDocument(e,t){let n=null;return this.documentOverlayCache.getOverlay(e,t).next(a=>(n=a,this.remoteDocumentCache.getEntry(e,t))).next(a=>(n!==null&&pa(n.mutation,a,vr.empty(),Mt.now()),a))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(n=>this.getLocalViewOfDocuments(e,n,et()).next(()=>n))}getLocalViewOfDocuments(e,t,n=et()){const a=Hs();return this.populateOverlays(e,a,t).next(()=>this.computeViews(e,t,a,n).next(i=>{let o=ca();return i.forEach((c,d)=>{o=o.insert(c,d.overlayedDocument)}),o}))}getOverlayedDocuments(e,t){const n=Hs();return this.populateOverlays(e,n,t).next(()=>this.computeViews(e,t,n,et()))}populateOverlays(e,t,n){const a=[];return n.forEach(i=>{t.has(i)||a.push(i)}),this.documentOverlayCache.getOverlays(e,a).next(i=>{i.forEach((o,c)=>{t.set(o,c)})})}computeViews(e,t,n,a){let i=ds();const o=ga(),c=function(){return ga()}();return t.forEach((d,h)=>{const m=n.get(h.key);a.has(h.key)&&(m===void 0||m.mutation instanceof Fs)?i=i.insert(h.key,h):m!==void 0?(o.set(h.key,m.mutation.getFieldMask()),pa(m.mutation,h,m.mutation.getFieldMask(),Mt.now())):o.set(h.key,vr.empty())}),this.recalculateAndSaveOverlays(e,i).next(d=>(d.forEach((h,m)=>o.set(h,m)),t.forEach((h,m)=>{var x;return c.set(h,new zy(m,(x=o.get(h))!==null&&x!==void 0?x:null))}),c))}recalculateAndSaveOverlays(e,t){const n=ga();let a=new jt((o,c)=>o-c),i=et();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(o=>{for(const c of o)c.keys().forEach(d=>{const h=t.get(d);if(h===null)return;let m=n.get(d)||vr.empty();m=c.applyToLocalView(h,m),n.set(d,m);const x=(a.get(c.batchId)||et()).add(d);a=a.insert(c.batchId,x)})}).next(()=>{const o=[],c=a.getReverseIterator();for(;c.hasNext();){const d=c.getNext(),h=d.key,m=d.value,x=Vm();m.forEach(f=>{if(!i.has(f)){const w=zm(t.get(f),n.get(f));w!==null&&x.set(f,w),i=i.add(f)}}),o.push(this.documentOverlayCache.saveOverlays(e,h,x))}return fe.waitFor(o)}).next(()=>n)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(n=>this.recalculateAndSaveOverlays(e,n))}getDocumentsMatchingQuery(e,t,n,a){return function(o){return Ve.isDocumentKey(o.path)&&o.collectionGroup===null&&o.filters.length===0}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):$m(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n,a):this.getDocumentsMatchingCollectionQuery(e,t,n,a)}getNextDocuments(e,t,n,a){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,n,a).next(i=>{const o=a-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,n.largestBatchId,a-i.size):fe.resolve(Hs());let c=-1,d=i;return o.next(h=>fe.forEach(h,(m,x)=>(c<x.largestBatchId&&(c=x.largestBatchId),i.get(m)?fe.resolve():this.remoteDocumentCache.getEntry(e,m).next(f=>{d=d.insert(m,f)}))).next(()=>this.populateOverlays(e,h,i)).next(()=>this.computeViews(e,d,h,et())).next(m=>({batchId:c,changes:Om(m)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new Ve(t)).next(n=>{let a=ca();return n.isFoundDocument()&&(a=a.insert(n.key,n)),a})}getDocumentsMatchingCollectionGroupQuery(e,t,n,a){const i=t.collectionGroup;let o=ca();return this.indexManager.getCollectionParents(e,i).next(c=>fe.forEach(c,d=>{const h=function(x,f){return new Un(f,null,x.explicitOrderBy.slice(),x.filters.slice(),x.limit,x.limitType,x.startAt,x.endAt)}(t,d.child(i));return this.getDocumentsMatchingCollectionQuery(e,h,n,a).next(m=>{m.forEach((x,f)=>{o=o.insert(x,f)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(e,t,n,a){let i;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,n.largestBatchId).next(o=>(i=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,n,i,a))).next(o=>{i.forEach((d,h)=>{const m=h.getKey();o.get(m)===null&&(o=o.insert(m,tr.newInvalidDocument(m)))});let c=ca();return o.forEach((d,h)=>{const m=i.get(d);m!==void 0&&pa(m.mutation,h,vr.empty(),Mt.now()),ho(t,h)&&(c=c.insert(d,h))}),c})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hy{constructor(e){this.serializer=e,this.hr=new Map,this.Pr=new Map}getBundleMetadata(e,t){return fe.resolve(this.hr.get(t))}saveBundleMetadata(e,t){return this.hr.set(t.id,function(a){return{id:a.id,version:a.version,createTime:Lr(a.createTime)}}(t)),fe.resolve()}getNamedQuery(e,t){return fe.resolve(this.Pr.get(t))}saveNamedQuery(e,t){return this.Pr.set(t.name,function(a){return{name:a.name,query:Fy(a.bundledQuery),readTime:Lr(a.readTime)}}(t)),fe.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gy{constructor(){this.overlays=new jt(Ve.comparator),this.Ir=new Map}getOverlay(e,t){return fe.resolve(this.overlays.get(t))}getOverlays(e,t){const n=Hs();return fe.forEach(t,a=>this.getOverlay(e,a).next(i=>{i!==null&&n.set(a,i)})).next(()=>n)}saveOverlays(e,t,n){return n.forEach((a,i)=>{this.ht(e,t,i)}),fe.resolve()}removeOverlaysForBatchId(e,t,n){const a=this.Ir.get(n);return a!==void 0&&(a.forEach(i=>this.overlays=this.overlays.remove(i)),this.Ir.delete(n)),fe.resolve()}getOverlaysForCollection(e,t,n){const a=Hs(),i=t.length+1,o=new Ve(t.child("")),c=this.overlays.getIteratorFrom(o);for(;c.hasNext();){const d=c.getNext().value,h=d.getKey();if(!t.isPrefixOf(h.path))break;h.path.length===i&&d.largestBatchId>n&&a.set(d.getKey(),d)}return fe.resolve(a)}getOverlaysForCollectionGroup(e,t,n,a){let i=new jt((h,m)=>h-m);const o=this.overlays.getIterator();for(;o.hasNext();){const h=o.getNext().value;if(h.getKey().getCollectionGroup()===t&&h.largestBatchId>n){let m=i.get(h.largestBatchId);m===null&&(m=Hs(),i=i.insert(h.largestBatchId,m)),m.set(h.getKey(),h)}}const c=Hs(),d=i.getIterator();for(;d.hasNext()&&(d.getNext().value.forEach((h,m)=>c.set(h,m)),!(c.size()>=a)););return fe.resolve(c)}ht(e,t,n){const a=this.overlays.get(n.key);if(a!==null){const o=this.Ir.get(a.largestBatchId).delete(n.key);this.Ir.set(a.largestBatchId,o)}this.overlays=this.overlays.insert(n.key,new xy(t,n));let i=this.Ir.get(t);i===void 0&&(i=et(),this.Ir.set(t,i)),this.Ir.set(t,i.add(n.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ky{constructor(){this.sessionToken=Ht.EMPTY_BYTE_STRING}getSessionToken(e){return fe.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,fe.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yc{constructor(){this.Tr=new Wt(Ot.Er),this.dr=new Wt(Ot.Ar)}isEmpty(){return this.Tr.isEmpty()}addReference(e,t){const n=new Ot(e,t);this.Tr=this.Tr.add(n),this.dr=this.dr.add(n)}Rr(e,t){e.forEach(n=>this.addReference(n,t))}removeReference(e,t){this.Vr(new Ot(e,t))}mr(e,t){e.forEach(n=>this.removeReference(n,t))}gr(e){const t=new Ve(new wt([])),n=new Ot(t,e),a=new Ot(t,e+1),i=[];return this.dr.forEachInRange([n,a],o=>{this.Vr(o),i.push(o.key)}),i}pr(){this.Tr.forEach(e=>this.Vr(e))}Vr(e){this.Tr=this.Tr.delete(e),this.dr=this.dr.delete(e)}yr(e){const t=new Ve(new wt([])),n=new Ot(t,e),a=new Ot(t,e+1);let i=et();return this.dr.forEachInRange([n,a],o=>{i=i.add(o.key)}),i}containsKey(e){const t=new Ot(e,0),n=this.Tr.firstAfterOrEqual(t);return n!==null&&e.isEqual(n.key)}}class Ot{constructor(e,t){this.key=e,this.wr=t}static Er(e,t){return Ve.comparator(e.key,t.key)||ut(e.wr,t.wr)}static Ar(e,t){return ut(e.wr,t.wr)||Ve.comparator(e.key,t.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yy{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.Sr=1,this.br=new Wt(Ot.Er)}checkEmpty(e){return fe.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,n,a){const i=this.Sr;this.Sr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const o=new py(i,t,n,a);this.mutationQueue.push(o);for(const c of a)this.br=this.br.add(new Ot(c.key,i)),this.indexManager.addToCollectionParentIndex(e,c.key.path.popLast());return fe.resolve(o)}lookupMutationBatch(e,t){return fe.resolve(this.Dr(t))}getNextMutationBatchAfterBatchId(e,t){const n=t+1,a=this.vr(n),i=a<0?0:a;return fe.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return fe.resolve(this.mutationQueue.length===0?-1:this.Sr-1)}getAllMutationBatches(e){return fe.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const n=new Ot(t,0),a=new Ot(t,Number.POSITIVE_INFINITY),i=[];return this.br.forEachInRange([n,a],o=>{const c=this.Dr(o.wr);i.push(c)}),fe.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new Wt(ut);return t.forEach(a=>{const i=new Ot(a,0),o=new Ot(a,Number.POSITIVE_INFINITY);this.br.forEachInRange([i,o],c=>{n=n.add(c.wr)})}),fe.resolve(this.Cr(n))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,a=n.length+1;let i=n;Ve.isDocumentKey(i)||(i=i.child(""));const o=new Ot(new Ve(i),0);let c=new Wt(ut);return this.br.forEachWhile(d=>{const h=d.key.path;return!!n.isPrefixOf(h)&&(h.length===a&&(c=c.add(d.wr)),!0)},o),fe.resolve(this.Cr(c))}Cr(e){const t=[];return e.forEach(n=>{const a=this.Dr(n);a!==null&&t.push(a)}),t}removeMutationBatch(e,t){pt(this.Fr(t.batchId,"removed")===0),this.mutationQueue.shift();let n=this.br;return fe.forEach(t.mutations,a=>{const i=new Ot(a.key,t.batchId);return n=n.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,a.key)}).next(()=>{this.br=n})}On(e){}containsKey(e,t){const n=new Ot(t,0),a=this.br.firstAfterOrEqual(n);return fe.resolve(t.isEqual(a&&a.key))}performConsistencyCheck(e){return this.mutationQueue.length,fe.resolve()}Fr(e,t){return this.vr(e)}vr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Dr(e){const t=this.vr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qy{constructor(e){this.Mr=e,this.docs=function(){return new jt(Ve.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const n=t.key,a=this.docs.get(n),i=a?a.size:0,o=this.Mr(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:o}),this.size+=o-i,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const n=this.docs.get(t);return fe.resolve(n?n.document.mutableCopy():tr.newInvalidDocument(t))}getEntries(e,t){let n=ds();return t.forEach(a=>{const i=this.docs.get(a);n=n.insert(a,i?i.document.mutableCopy():tr.newInvalidDocument(a))}),fe.resolve(n)}getDocumentsMatchingQuery(e,t,n,a){let i=ds();const o=t.path,c=new Ve(o.child("")),d=this.docs.getIteratorFrom(c);for(;d.hasNext();){const{key:h,value:{document:m}}=d.getNext();if(!o.isPrefixOf(h.path))break;h.path.length>o.length+1||$b(Db(m),n)<=0||(a.has(m.key)||ho(t,m))&&(i=i.insert(m.key,m.mutableCopy()))}return fe.resolve(i)}getAllFromCollectionGroup(e,t,n,a){qe()}Or(e,t){return fe.forEach(this.docs,n=>t(n))}newChangeBuffer(e){return new Xy(this)}getSize(e){return fe.resolve(this.size)}}class Xy extends qy{constructor(e){super(),this.cr=e}applyChanges(e){const t=[];return this.changes.forEach((n,a)=>{a.isValidDocument()?t.push(this.cr.addEntry(e,a)):this.cr.removeEntry(n)}),fe.waitFor(t)}getFromCache(e,t){return this.cr.getEntry(e,t)}getAllFromCache(e,t){return this.cr.getEntries(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jy{constructor(e){this.persistence=e,this.Nr=new Bn(t=>uc(t),hc),this.lastRemoteSnapshotVersion=He.min(),this.highestTargetId=0,this.Lr=0,this.Br=new yc,this.targetCount=0,this.kr=$n.Bn()}forEachTarget(e,t){return this.Nr.forEach((n,a)=>t(a)),fe.resolve()}getLastRemoteSnapshotVersion(e){return fe.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return fe.resolve(this.Lr)}allocateTargetId(e){return this.highestTargetId=this.kr.next(),fe.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.Lr&&(this.Lr=t),fe.resolve()}Kn(e){this.Nr.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.kr=new $n(t),this.highestTargetId=t),e.sequenceNumber>this.Lr&&(this.Lr=e.sequenceNumber)}addTargetData(e,t){return this.Kn(t),this.targetCount+=1,fe.resolve()}updateTargetData(e,t){return this.Kn(t),fe.resolve()}removeTargetData(e,t){return this.Nr.delete(t.target),this.Br.gr(t.targetId),this.targetCount-=1,fe.resolve()}removeTargets(e,t,n){let a=0;const i=[];return this.Nr.forEach((o,c)=>{c.sequenceNumber<=t&&n.get(c.targetId)===null&&(this.Nr.delete(o),i.push(this.removeMatchingKeysForTargetId(e,c.targetId)),a++)}),fe.waitFor(i).next(()=>a)}getTargetCount(e){return fe.resolve(this.targetCount)}getTargetData(e,t){const n=this.Nr.get(t)||null;return fe.resolve(n)}addMatchingKeys(e,t,n){return this.Br.Rr(t,n),fe.resolve()}removeMatchingKeys(e,t,n){this.Br.mr(t,n);const a=this.persistence.referenceDelegate,i=[];return a&&t.forEach(o=>{i.push(a.markPotentiallyOrphaned(e,o))}),fe.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this.Br.gr(t),fe.resolve()}getMatchingKeysForTargetId(e,t){const n=this.Br.yr(t);return fe.resolve(n)}containsKey(e,t){return fe.resolve(this.Br.containsKey(t))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zy{constructor(e,t){this.qr={},this.overlays={},this.Qr=new oc(0),this.Kr=!1,this.Kr=!0,this.$r=new Ky,this.referenceDelegate=e(this),this.Ur=new Jy(this),this.indexManager=new Uy,this.remoteDocumentCache=function(a){return new Qy(a)}(n=>this.referenceDelegate.Wr(n)),this.serializer=new Ly(t),this.Gr=new Hy(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Kr=!1,Promise.resolve()}get started(){return this.Kr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new Gy,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this.qr[e.toKey()];return n||(n=new Yy(t,this.referenceDelegate),this.qr[e.toKey()]=n),n}getGlobalsCache(){return this.$r}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Gr}runTransaction(e,t,n){Se("MemoryPersistence","Starting transaction:",e);const a=new ev(this.Qr.next());return this.referenceDelegate.zr(),n(a).next(i=>this.referenceDelegate.jr(a).next(()=>i)).toPromise().then(i=>(a.raiseOnCommittedEvent(),i))}Hr(e,t){return fe.or(Object.values(this.qr).map(n=>()=>n.containsKey(e,t)))}}class ev extends Pb{constructor(e){super(),this.currentSequenceNumber=e}}class vc{constructor(e){this.persistence=e,this.Jr=new yc,this.Yr=null}static Zr(e){return new vc(e)}get Xr(){if(this.Yr)return this.Yr;throw qe()}addReference(e,t,n){return this.Jr.addReference(n,t),this.Xr.delete(n.toString()),fe.resolve()}removeReference(e,t,n){return this.Jr.removeReference(n,t),this.Xr.add(n.toString()),fe.resolve()}markPotentiallyOrphaned(e,t){return this.Xr.add(t.toString()),fe.resolve()}removeTarget(e,t){this.Jr.gr(t.targetId).forEach(a=>this.Xr.add(a.toString()));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next(a=>{a.forEach(i=>this.Xr.add(i.toString()))}).next(()=>n.removeTargetData(e,t))}zr(){this.Yr=new Set}jr(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return fe.forEach(this.Xr,n=>{const a=Ve.fromPath(n);return this.ei(e,a).next(i=>{i||t.removeEntry(a,He.min())})}).next(()=>(this.Yr=null,t.apply(e)))}updateLimboDocument(e,t){return this.ei(e,t).next(n=>{n?this.Xr.delete(t.toString()):this.Xr.add(t.toString())})}Wr(e){return 0}ei(e,t){return fe.or([()=>fe.resolve(this.Jr.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Hr(e,t)])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wc{constructor(e,t,n,a){this.targetId=e,this.fromCache=t,this.$i=n,this.Ui=a}static Wi(e,t){let n=et(),a=et();for(const i of t.docChanges)switch(i.type){case 0:n=n.add(i.doc.key);break;case 1:a=a.add(i.doc.key)}return new wc(e,t.fromCache,n,a)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tv{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rv{constructor(){this.Gi=!1,this.zi=!1,this.ji=100,this.Hi=function(){return nf()?8:Mb(rr())>0?6:4}()}initialize(e,t){this.Ji=e,this.indexManager=t,this.Gi=!0}getDocumentsMatchingQuery(e,t,n,a){const i={result:null};return this.Yi(e,t).next(o=>{i.result=o}).next(()=>{if(!i.result)return this.Zi(e,t,a,n).next(o=>{i.result=o})}).next(()=>{if(i.result)return;const o=new tv;return this.Xi(e,t,o).next(c=>{if(i.result=c,this.zi)return this.es(e,t,o,c.size)})}).next(()=>i.result)}es(e,t,n,a){return n.documentReadCount<this.ji?(sa()<=st.DEBUG&&Se("QueryEngine","SDK will not create cache indexes for query:",gn(t),"since it only creates cache indexes for collection contains","more than or equal to",this.ji,"documents"),fe.resolve()):(sa()<=st.DEBUG&&Se("QueryEngine","Query:",gn(t),"scans",n.documentReadCount,"local documents and returns",a,"documents as results."),n.documentReadCount>this.Hi*a?(sa()<=st.DEBUG&&Se("QueryEngine","The SDK decides to create cache indexes for query:",gn(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Vr(t))):fe.resolve())}Yi(e,t){if(bu(t))return fe.resolve(null);let n=Vr(t);return this.indexManager.getIndexType(e,n).next(a=>a===0?null:(t.limit!==null&&a===1&&(t=Al(t,null,"F"),n=Vr(t)),this.indexManager.getDocumentsMatchingTarget(e,n).next(i=>{const o=et(...i);return this.Ji.getDocuments(e,o).next(c=>this.indexManager.getMinOffset(e,n).next(d=>{const h=this.ts(t,c);return this.ns(t,h,o,d.readTime)?this.Yi(e,Al(t,null,"F")):this.rs(e,h,t,d)}))})))}Zi(e,t,n,a){return bu(t)||a.isEqual(He.min())?fe.resolve(null):this.Ji.getDocuments(e,n).next(i=>{const o=this.ts(t,i);return this.ns(t,o,n,a)?fe.resolve(null):(sa()<=st.DEBUG&&Se("QueryEngine","Re-using previous result from %s to execute query: %s",a.toString(),gn(t)),this.rs(e,o,t,Cb(a,-1)).next(c=>c))})}ts(e,t){let n=new Wt(Pm(e));return t.forEach((a,i)=>{ho(e,i)&&(n=n.add(i))}),n}ns(e,t,n,a){if(e.limit===null)return!1;if(n.size!==t.size)return!0;const i=e.limitType==="F"?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(a)>0)}Xi(e,t,n){return sa()<=st.DEBUG&&Se("QueryEngine","Using full collection scan to execute query:",gn(t)),this.Ji.getDocumentsMatchingQuery(e,t,Ps.min(),n)}rs(e,t,n,a){return this.Ji.getDocumentsMatchingQuery(e,n,a).next(i=>(t.forEach(o=>{i=i.insert(o.key,o)}),i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sv{constructor(e,t,n,a){this.persistence=e,this.ss=t,this.serializer=a,this.os=new jt(ut),this._s=new Bn(i=>uc(i),hc),this.us=new Map,this.cs=e.getRemoteDocumentCache(),this.Ur=e.getTargetCache(),this.Gr=e.getBundleCache(),this.ls(n)}ls(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new Wy(this.cs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.cs.setIndexManager(this.indexManager),this.ss.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.os))}}function nv(s,e,t,n){return new sv(s,e,t,n)}async function rg(s,e){const t=Ge(s);return await t.persistence.runTransaction("Handle user change","readonly",n=>{let a;return t.mutationQueue.getAllMutationBatches(n).next(i=>(a=i,t.ls(e),t.mutationQueue.getAllMutationBatches(n))).next(i=>{const o=[],c=[];let d=et();for(const h of a){o.push(h.batchId);for(const m of h.mutations)d=d.add(m.key)}for(const h of i){c.push(h.batchId);for(const m of h.mutations)d=d.add(m.key)}return t.localDocuments.getDocuments(n,d).next(h=>({hs:h,removedBatchIds:o,addedBatchIds:c}))})})}function av(s,e){const t=Ge(s);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",n=>{const a=e.batch.keys(),i=t.cs.newChangeBuffer({trackRemovals:!0});return function(c,d,h,m){const x=h.batch,f=x.keys();let w=fe.resolve();return f.forEach($=>{w=w.next(()=>m.getEntry(d,$)).next(A=>{const T=h.docVersions.get($);pt(T!==null),A.version.compareTo(T)<0&&(x.applyToRemoteDocument(A,h),A.isValidDocument()&&(A.setReadTime(h.commitVersion),m.addEntry(A)))})}),w.next(()=>c.mutationQueue.removeMutationBatch(d,x))}(t,n,e,i).next(()=>i.apply(n)).next(()=>t.mutationQueue.performConsistencyCheck(n)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(n,a,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(n,function(c){let d=et();for(let h=0;h<c.mutationResults.length;++h)c.mutationResults[h].transformResults.length>0&&(d=d.add(c.batch.mutations[h].key));return d}(e))).next(()=>t.localDocuments.getDocuments(n,a))})}function sg(s){const e=Ge(s);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Ur.getLastRemoteSnapshotVersion(t))}function iv(s,e){const t=Ge(s),n=e.snapshotVersion;let a=t.os;return t.persistence.runTransaction("Apply remote event","readwrite-primary",i=>{const o=t.cs.newChangeBuffer({trackRemovals:!0});a=t.os;const c=[];e.targetChanges.forEach((m,x)=>{const f=a.get(x);if(!f)return;c.push(t.Ur.removeMatchingKeys(i,m.removedDocuments,x).next(()=>t.Ur.addMatchingKeys(i,m.addedDocuments,x)));let w=f.withSequenceNumber(i.currentSequenceNumber);e.targetMismatches.get(x)!==null?w=w.withResumeToken(Ht.EMPTY_BYTE_STRING,He.min()).withLastLimboFreeSnapshotVersion(He.min()):m.resumeToken.approximateByteSize()>0&&(w=w.withResumeToken(m.resumeToken,n)),a=a.insert(x,w),function(A,T,K){return A.resumeToken.approximateByteSize()===0||T.snapshotVersion.toMicroseconds()-A.snapshotVersion.toMicroseconds()>=3e8?!0:K.addedDocuments.size+K.modifiedDocuments.size+K.removedDocuments.size>0}(f,w,m)&&c.push(t.Ur.updateTargetData(i,w))});let d=ds(),h=et();if(e.documentUpdates.forEach(m=>{e.resolvedLimboDocuments.has(m)&&c.push(t.persistence.referenceDelegate.updateLimboDocument(i,m))}),c.push(ov(i,o,e.documentUpdates).next(m=>{d=m.Ps,h=m.Is})),!n.isEqual(He.min())){const m=t.Ur.getLastRemoteSnapshotVersion(i).next(x=>t.Ur.setTargetsMetadata(i,i.currentSequenceNumber,n));c.push(m)}return fe.waitFor(c).next(()=>o.apply(i)).next(()=>t.localDocuments.getLocalViewOfDocuments(i,d,h)).next(()=>d)}).then(i=>(t.os=a,i))}function ov(s,e,t){let n=et(),a=et();return t.forEach(i=>n=n.add(i)),e.getEntries(s,n).next(i=>{let o=ds();return t.forEach((c,d)=>{const h=i.get(c);d.isFoundDocument()!==h.isFoundDocument()&&(a=a.add(c)),d.isNoDocument()&&d.version.isEqual(He.min())?(e.removeEntry(c,d.readTime),o=o.insert(c,d)):!h.isValidDocument()||d.version.compareTo(h.version)>0||d.version.compareTo(h.version)===0&&h.hasPendingWrites?(e.addEntry(d),o=o.insert(c,d)):Se("LocalStore","Ignoring outdated watch update for ",c,". Current version:",h.version," Watch version:",d.version)}),{Ps:o,Is:a}})}function lv(s,e){const t=Ge(s);return t.persistence.runTransaction("Get next mutation batch","readonly",n=>(e===void 0&&(e=-1),t.mutationQueue.getNextMutationBatchAfterBatchId(n,e)))}function cv(s,e){const t=Ge(s);return t.persistence.runTransaction("Allocate target","readwrite",n=>{let a;return t.Ur.getTargetData(n,e).next(i=>i?(a=i,fe.resolve(a)):t.Ur.allocateTargetId(n).next(o=>(a=new Is(e,o,"TargetPurposeListen",n.currentSequenceNumber),t.Ur.addTargetData(n,a).next(()=>a))))}).then(n=>{const a=t.os.get(n.targetId);return(a===null||n.snapshotVersion.compareTo(a.snapshotVersion)>0)&&(t.os=t.os.insert(n.targetId,n),t._s.set(e,n.targetId)),n})}async function Pl(s,e,t){const n=Ge(s),a=n.os.get(e),i=t?"readwrite":"readwrite-primary";try{t||await n.persistence.runTransaction("Release target",i,o=>n.persistence.referenceDelegate.removeTarget(o,a))}catch(o){if(!Fa(o))throw o;Se("LocalStore",`Failed to update sequence numbers for target ${e}: ${o}`)}n.os=n.os.remove(e),n._s.delete(a.target)}function Su(s,e,t){const n=Ge(s);let a=He.min(),i=et();return n.persistence.runTransaction("Execute query","readwrite",o=>function(d,h,m){const x=Ge(d),f=x._s.get(m);return f!==void 0?fe.resolve(x.os.get(f)):x.Ur.getTargetData(h,m)}(n,o,Vr(e)).next(c=>{if(c)return a=c.lastLimboFreeSnapshotVersion,n.Ur.getMatchingKeysForTargetId(o,c.targetId).next(d=>{i=d})}).next(()=>n.ss.getDocumentsMatchingQuery(o,e,t?a:He.min(),t?i:et())).next(c=>(dv(n,ey(e),c),{documents:c,Ts:i})))}function dv(s,e,t){let n=s.us.get(e)||He.min();t.forEach((a,i)=>{i.readTime.compareTo(n)>0&&(n=i.readTime)}),s.us.set(e,n)}class Au{constructor(){this.activeTargetIds=iy()}fs(e){this.activeTargetIds=this.activeTargetIds.add(e)}gs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Vs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class uv{constructor(){this.so=new Au,this.oo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e,t=!0){return t&&this.so.fs(e),this.oo[e]||"not-current"}updateQueryState(e,t,n){this.oo[e]=t}removeLocalQueryTarget(e){this.so.gs(e)}isLocalQueryTarget(e){return this.so.activeTargetIds.has(e)}clearQueryState(e){delete this.oo[e]}getAllActiveQueryTargets(){return this.so.activeTargetIds}isActiveQueryTarget(e){return this.so.activeTargetIds.has(e)}start(){return this.so=new Au,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hv{_o(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cu{constructor(){this.ao=()=>this.uo(),this.co=()=>this.lo(),this.ho=[],this.Po()}_o(e){this.ho.push(e)}shutdown(){window.removeEventListener("online",this.ao),window.removeEventListener("offline",this.co)}Po(){window.addEventListener("online",this.ao),window.addEventListener("offline",this.co)}uo(){Se("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.ho)e(0)}lo(){Se("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.ho)e(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let ui=null;function tl(){return ui===null?ui=function(){return 268435456+Math.round(2147483648*Math.random())}():ui++,"0x"+ui.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mv={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gv{constructor(e){this.Io=e.Io,this.To=e.To}Eo(e){this.Ao=e}Ro(e){this.Vo=e}mo(e){this.fo=e}onMessage(e){this.po=e}close(){this.To()}send(e){this.Io(e)}yo(){this.Ao()}wo(){this.Vo()}So(e){this.fo(e)}bo(e){this.po(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Jt="WebChannelConnection";class pv extends class{constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const n=t.ssl?"https":"http",a=encodeURIComponent(this.databaseId.projectId),i=encodeURIComponent(this.databaseId.database);this.Do=n+"://"+t.host,this.vo=`projects/${a}/databases/${i}`,this.Co=this.databaseId.database==="(default)"?`project_id=${a}`:`project_id=${a}&database_id=${i}`}get Fo(){return!1}Mo(t,n,a,i,o){const c=tl(),d=this.xo(t,n.toUriEncodedString());Se("RestConnection",`Sending RPC '${t}' ${c}:`,d,a);const h={"google-cloud-resource-prefix":this.vo,"x-goog-request-params":this.Co};return this.Oo(h,i,o),this.No(t,d,h,a).then(m=>(Se("RestConnection",`Received RPC '${t}' ${c}: `,m),m),m=>{throw Sn("RestConnection",`RPC '${t}' ${c} failed with error: `,m,"url: ",d,"request:",a),m})}Lo(t,n,a,i,o,c){return this.Mo(t,n,a,i,o)}Oo(t,n,a){t["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+Fn}(),t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),n&&n.headers.forEach((i,o)=>t[o]=i),a&&a.headers.forEach((i,o)=>t[o]=i)}xo(t,n){const a=mv[t];return`${this.Do}/v1/${n}:${a}`}terminate(){}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}No(e,t,n,a){const i=tl();return new Promise((o,c)=>{const d=new fm;d.setWithCredentials(!0),d.listenOnce(bm.COMPLETE,()=>{try{switch(d.getLastErrorCode()){case bi.NO_ERROR:const m=d.getResponseJson();Se(Jt,`XHR for RPC '${e}' ${i} received:`,JSON.stringify(m)),o(m);break;case bi.TIMEOUT:Se(Jt,`RPC '${e}' ${i} timed out`),c(new Ee(he.DEADLINE_EXCEEDED,"Request time out"));break;case bi.HTTP_ERROR:const x=d.getStatus();if(Se(Jt,`RPC '${e}' ${i} failed with status:`,x,"response text:",d.getResponseText()),x>0){let f=d.getResponseJson();Array.isArray(f)&&(f=f[0]);const w=f==null?void 0:f.error;if(w&&w.status&&w.message){const $=function(T){const K=T.toLowerCase().replace(/_/g,"-");return Object.values(he).indexOf(K)>=0?K:he.UNKNOWN}(w.status);c(new Ee($,w.message))}else c(new Ee(he.UNKNOWN,"Server responded with status "+d.getStatus()))}else c(new Ee(he.UNAVAILABLE,"Connection failed."));break;default:qe()}}finally{Se(Jt,`RPC '${e}' ${i} completed.`)}});const h=JSON.stringify(a);Se(Jt,`RPC '${e}' ${i} sending request:`,a),d.send(t,"POST",h,n,15)})}Bo(e,t,n){const a=tl(),i=[this.Do,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=wm(),c=vm(),d={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},h=this.longPollingOptions.timeoutSeconds;h!==void 0&&(d.longPollingTimeout=Math.round(1e3*h)),this.useFetchStreams&&(d.useFetchStreams=!0),this.Oo(d.initMessageHeaders,t,n),d.encodeInitMessageHeaders=!0;const m=i.join("");Se(Jt,`Creating RPC '${e}' stream ${a}: ${m}`,d);const x=o.createWebChannel(m,d);let f=!1,w=!1;const $=new gv({Io:T=>{w?Se(Jt,`Not sending because RPC '${e}' stream ${a} is closed:`,T):(f||(Se(Jt,`Opening RPC '${e}' stream ${a} transport.`),x.open(),f=!0),Se(Jt,`RPC '${e}' stream ${a} sending:`,T),x.send(T))},To:()=>x.close()}),A=(T,K,P)=>{T.listen(K,S=>{try{P(S)}catch(L){setTimeout(()=>{throw L},0)}})};return A(x,la.EventType.OPEN,()=>{w||(Se(Jt,`RPC '${e}' stream ${a} transport opened.`),$.yo())}),A(x,la.EventType.CLOSE,()=>{w||(w=!0,Se(Jt,`RPC '${e}' stream ${a} transport closed`),$.So())}),A(x,la.EventType.ERROR,T=>{w||(w=!0,Sn(Jt,`RPC '${e}' stream ${a} transport errored:`,T),$.So(new Ee(he.UNAVAILABLE,"The operation could not be completed")))}),A(x,la.EventType.MESSAGE,T=>{var K;if(!w){const P=T.data[0];pt(!!P);const S=P,L=S.error||((K=S[0])===null||K===void 0?void 0:K.error);if(L){Se(Jt,`RPC '${e}' stream ${a} received error:`,L);const ee=L.status;let D=function(v){const j=Dt[v];if(j!==void 0)return Hm(j)}(ee),k=L.message;D===void 0&&(D=he.INTERNAL,k="Unknown error status: "+ee+" with message "+L.message),w=!0,$.So(new Ee(D,k)),x.close()}else Se(Jt,`RPC '${e}' stream ${a} received:`,P),$.bo(P)}}),A(c,ym.STAT_EVENT,T=>{T.stat===jl.PROXY?Se(Jt,`RPC '${e}' stream ${a} detected buffering proxy`):T.stat===jl.NOPROXY&&Se(Jt,`RPC '${e}' stream ${a} detected no buffering proxy`)}),setTimeout(()=>{$.wo()},0),$}}function rl(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xo(s){return new _y(s,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ng{constructor(e,t,n=1e3,a=1.5,i=6e4){this.ui=e,this.timerId=t,this.ko=n,this.qo=a,this.Qo=i,this.Ko=0,this.$o=null,this.Uo=Date.now(),this.reset()}reset(){this.Ko=0}Wo(){this.Ko=this.Qo}Go(e){this.cancel();const t=Math.floor(this.Ko+this.zo()),n=Math.max(0,Date.now()-this.Uo),a=Math.max(0,t-n);a>0&&Se("ExponentialBackoff",`Backing off for ${a} ms (base delay: ${this.Ko} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.$o=this.ui.enqueueAfterDelay(this.timerId,a,()=>(this.Uo=Date.now(),e())),this.Ko*=this.qo,this.Ko<this.ko&&(this.Ko=this.ko),this.Ko>this.Qo&&(this.Ko=this.Qo)}jo(){this.$o!==null&&(this.$o.skipDelay(),this.$o=null)}cancel(){this.$o!==null&&(this.$o.cancel(),this.$o=null)}zo(){return(Math.random()-.5)*this.Ko}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ag{constructor(e,t,n,a,i,o,c,d){this.ui=e,this.Ho=n,this.Jo=a,this.connection=i,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=c,this.listener=d,this.state=0,this.Yo=0,this.Zo=null,this.Xo=null,this.stream=null,this.e_=0,this.t_=new ng(e,t)}n_(){return this.state===1||this.state===5||this.r_()}r_(){return this.state===2||this.state===3}start(){this.e_=0,this.state!==4?this.auth():this.i_()}async stop(){this.n_()&&await this.close(0)}s_(){this.state=0,this.t_.reset()}o_(){this.r_()&&this.Zo===null&&(this.Zo=this.ui.enqueueAfterDelay(this.Ho,6e4,()=>this.__()))}a_(e){this.u_(),this.stream.send(e)}async __(){if(this.r_())return this.close(0)}u_(){this.Zo&&(this.Zo.cancel(),this.Zo=null)}c_(){this.Xo&&(this.Xo.cancel(),this.Xo=null)}async close(e,t){this.u_(),this.c_(),this.t_.cancel(),this.Yo++,e!==4?this.t_.reset():t&&t.code===he.RESOURCE_EXHAUSTED?(cs(t.toString()),cs("Using maximum backoff delay to prevent overloading the backend."),this.t_.Wo()):t&&t.code===he.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.l_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.mo(t)}l_(){}auth(){this.state=1;const e=this.h_(this.Yo),t=this.Yo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([n,a])=>{this.Yo===t&&this.P_(n,a)},n=>{e(()=>{const a=new Ee(he.UNKNOWN,"Fetching auth token failed: "+n.message);return this.I_(a)})})}P_(e,t){const n=this.h_(this.Yo);this.stream=this.T_(e,t),this.stream.Eo(()=>{n(()=>this.listener.Eo())}),this.stream.Ro(()=>{n(()=>(this.state=2,this.Xo=this.ui.enqueueAfterDelay(this.Jo,1e4,()=>(this.r_()&&(this.state=3),Promise.resolve())),this.listener.Ro()))}),this.stream.mo(a=>{n(()=>this.I_(a))}),this.stream.onMessage(a=>{n(()=>++this.e_==1?this.E_(a):this.onNext(a))})}i_(){this.state=5,this.t_.Go(async()=>{this.state=0,this.start()})}I_(e){return Se("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}h_(e){return t=>{this.ui.enqueueAndForget(()=>this.Yo===e?t():(Se("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class xv extends ag{constructor(e,t,n,a,i,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,a,o),this.serializer=i}T_(e,t){return this.connection.Bo("Listen",e,t)}E_(e){return this.onNext(e)}onNext(e){this.t_.reset();const t=Ty(this.serializer,e),n=function(i){if(!("targetChange"in i))return He.min();const o=i.targetChange;return o.targetIds&&o.targetIds.length?He.min():o.readTime?Lr(o.readTime):He.min()}(e);return this.listener.d_(t,n)}A_(e){const t={};t.database=Rl(this.serializer),t.addTarget=function(i,o){let c;const d=o.target;if(c=Tl(d)?{documents:Cy(i,d)}:{query:Dy(i,d)._t},c.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){c.resumeToken=Ym(i,o.resumeToken);const h=Cl(i,o.expectedCount);h!==null&&(c.expectedCount=h)}else if(o.snapshotVersion.compareTo(He.min())>0){c.readTime=Vi(i,o.snapshotVersion.toTimestamp());const h=Cl(i,o.expectedCount);h!==null&&(c.expectedCount=h)}return c}(this.serializer,e);const n=Ry(this.serializer,e);n&&(t.labels=n),this.a_(t)}R_(e){const t={};t.database=Rl(this.serializer),t.removeTarget=e,this.a_(t)}}class fv extends ag{constructor(e,t,n,a,i,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,a,o),this.serializer=i}get V_(){return this.e_>0}start(){this.lastStreamToken=void 0,super.start()}l_(){this.V_&&this.m_([])}T_(e,t){return this.connection.Bo("Write",e,t)}E_(e){return pt(!!e.streamToken),this.lastStreamToken=e.streamToken,pt(!e.writeResults||e.writeResults.length===0),this.listener.f_()}onNext(e){pt(!!e.streamToken),this.lastStreamToken=e.streamToken,this.t_.reset();const t=Ay(e.writeResults,e.commitTime),n=Lr(e.commitTime);return this.listener.g_(n,t)}p_(){const e={};e.database=Rl(this.serializer),this.a_(e)}m_(e){const t={streamToken:this.lastStreamToken,writes:e.map(n=>Sy(this.serializer,n))};this.a_(t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bv extends class{}{constructor(e,t,n,a){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=n,this.serializer=a,this.y_=!1}w_(){if(this.y_)throw new Ee(he.FAILED_PRECONDITION,"The client has already been terminated.")}Mo(e,t,n,a){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,o])=>this.connection.Mo(e,Dl(t,n),a,i,o)).catch(i=>{throw i.name==="FirebaseError"?(i.code===he.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),i):new Ee(he.UNKNOWN,i.toString())})}Lo(e,t,n,a,i){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,c])=>this.connection.Lo(e,Dl(t,n),a,o,c,i)).catch(o=>{throw o.name==="FirebaseError"?(o.code===he.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new Ee(he.UNKNOWN,o.toString())})}terminate(){this.y_=!0,this.connection.terminate()}}class yv{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.S_=0,this.b_=null,this.D_=!0}v_(){this.S_===0&&(this.C_("Unknown"),this.b_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.b_=null,this.F_("Backend didn't respond within 10 seconds."),this.C_("Offline"),Promise.resolve())))}M_(e){this.state==="Online"?this.C_("Unknown"):(this.S_++,this.S_>=1&&(this.x_(),this.F_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.C_("Offline")))}set(e){this.x_(),this.S_=0,e==="Online"&&(this.D_=!1),this.C_(e)}C_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}F_(e){const t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.D_?(cs(t),this.D_=!1):Se("OnlineStateTracker",t)}x_(){this.b_!==null&&(this.b_.cancel(),this.b_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vv{constructor(e,t,n,a,i){this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.O_=[],this.N_=new Map,this.L_=new Set,this.B_=[],this.k_=i,this.k_._o(o=>{n.enqueueAndForget(async()=>{an(this)&&(Se("RemoteStore","Restarting streams for network reachability change."),await async function(d){const h=Ge(d);h.L_.add(4),await qa(h),h.q_.set("Unknown"),h.L_.delete(4),await fo(h)}(this))})}),this.q_=new yv(n,a)}}async function fo(s){if(an(s))for(const e of s.B_)await e(!0)}async function qa(s){for(const e of s.B_)await e(!1)}function ig(s,e){const t=Ge(s);t.N_.has(e.targetId)||(t.N_.set(e.targetId,e),_c(t)?jc(t):qn(t).r_()&&Nc(t,e))}function kc(s,e){const t=Ge(s),n=qn(t);t.N_.delete(e),n.r_()&&og(t,e),t.N_.size===0&&(n.r_()?n.o_():an(t)&&t.q_.set("Unknown"))}function Nc(s,e){if(s.Q_.xe(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(He.min())>0){const t=s.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}qn(s).A_(e)}function og(s,e){s.Q_.xe(e),qn(s).R_(e)}function jc(s){s.Q_=new wy({getRemoteKeysForTarget:e=>s.remoteSyncer.getRemoteKeysForTarget(e),ot:e=>s.N_.get(e)||null,tt:()=>s.datastore.serializer.databaseId}),qn(s).start(),s.q_.v_()}function _c(s){return an(s)&&!qn(s).n_()&&s.N_.size>0}function an(s){return Ge(s).L_.size===0}function lg(s){s.Q_=void 0}async function wv(s){s.q_.set("Online")}async function kv(s){s.N_.forEach((e,t)=>{Nc(s,e)})}async function Nv(s,e){lg(s),_c(s)?(s.q_.M_(e),jc(s)):s.q_.set("Unknown")}async function jv(s,e,t){if(s.q_.set("Online"),e instanceof Km&&e.state===2&&e.cause)try{await async function(a,i){const o=i.cause;for(const c of i.targetIds)a.N_.has(c)&&(await a.remoteSyncer.rejectListen(c,o),a.N_.delete(c),a.Q_.removeTarget(c))}(s,e)}catch(n){Se("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),n),await Li(s,n)}else if(e instanceof wi?s.Q_.Ke(e):e instanceof Gm?s.Q_.He(e):s.Q_.We(e),!t.isEqual(He.min()))try{const n=await sg(s.localStore);t.compareTo(n)>=0&&await function(i,o){const c=i.Q_.rt(o);return c.targetChanges.forEach((d,h)=>{if(d.resumeToken.approximateByteSize()>0){const m=i.N_.get(h);m&&i.N_.set(h,m.withResumeToken(d.resumeToken,o))}}),c.targetMismatches.forEach((d,h)=>{const m=i.N_.get(d);if(!m)return;i.N_.set(d,m.withResumeToken(Ht.EMPTY_BYTE_STRING,m.snapshotVersion)),og(i,d);const x=new Is(m.target,d,h,m.sequenceNumber);Nc(i,x)}),i.remoteSyncer.applyRemoteEvent(c)}(s,t)}catch(n){Se("RemoteStore","Failed to raise snapshot:",n),await Li(s,n)}}async function Li(s,e,t){if(!Fa(e))throw e;s.L_.add(1),await qa(s),s.q_.set("Offline"),t||(t=()=>sg(s.localStore)),s.asyncQueue.enqueueRetryable(async()=>{Se("RemoteStore","Retrying IndexedDB access"),await t(),s.L_.delete(1),await fo(s)})}function cg(s,e){return e().catch(t=>Li(s,t,e))}async function bo(s){const e=Ge(s),t=Os(e);let n=e.O_.length>0?e.O_[e.O_.length-1].batchId:-1;for(;_v(e);)try{const a=await lv(e.localStore,n);if(a===null){e.O_.length===0&&t.o_();break}n=a.batchId,Ev(e,a)}catch(a){await Li(e,a)}dg(e)&&ug(e)}function _v(s){return an(s)&&s.O_.length<10}function Ev(s,e){s.O_.push(e);const t=Os(s);t.r_()&&t.V_&&t.m_(e.mutations)}function dg(s){return an(s)&&!Os(s).n_()&&s.O_.length>0}function ug(s){Os(s).start()}async function Iv(s){Os(s).p_()}async function Tv(s){const e=Os(s);for(const t of s.O_)e.m_(t.mutations)}async function Sv(s,e,t){const n=s.O_.shift(),a=xc.from(n,e,t);await cg(s,()=>s.remoteSyncer.applySuccessfulWrite(a)),await bo(s)}async function Av(s,e){e&&Os(s).V_&&await async function(n,a){if(function(o){return by(o)&&o!==he.ABORTED}(a.code)){const i=n.O_.shift();Os(n).s_(),await cg(n,()=>n.remoteSyncer.rejectFailedWrite(i.batchId,a)),await bo(n)}}(s,e),dg(s)&&ug(s)}async function Du(s,e){const t=Ge(s);t.asyncQueue.verifyOperationInProgress(),Se("RemoteStore","RemoteStore received new credentials");const n=an(t);t.L_.add(3),await qa(t),n&&t.q_.set("Unknown"),await t.remoteSyncer.handleCredentialChange(e),t.L_.delete(3),await fo(t)}async function Cv(s,e){const t=Ge(s);e?(t.L_.delete(2),await fo(t)):e||(t.L_.add(2),await qa(t),t.q_.set("Unknown"))}function qn(s){return s.K_||(s.K_=function(t,n,a){const i=Ge(t);return i.w_(),new xv(n,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,a)}(s.datastore,s.asyncQueue,{Eo:wv.bind(null,s),Ro:kv.bind(null,s),mo:Nv.bind(null,s),d_:jv.bind(null,s)}),s.B_.push(async e=>{e?(s.K_.s_(),_c(s)?jc(s):s.q_.set("Unknown")):(await s.K_.stop(),lg(s))})),s.K_}function Os(s){return s.U_||(s.U_=function(t,n,a){const i=Ge(t);return i.w_(),new fv(n,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,a)}(s.datastore,s.asyncQueue,{Eo:()=>Promise.resolve(),Ro:Iv.bind(null,s),mo:Av.bind(null,s),f_:Tv.bind(null,s),g_:Sv.bind(null,s)}),s.B_.push(async e=>{e?(s.U_.s_(),await bo(s)):(await s.U_.stop(),s.O_.length>0&&(Se("RemoteStore",`Stopping write stream with ${s.O_.length} pending writes`),s.O_=[]))})),s.U_}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ec{constructor(e,t,n,a,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=a,this.removalCallback=i,this.deferred=new ns,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,n,a,i){const o=Date.now()+n,c=new Ec(e,t,o,a,i);return c.start(n),c}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new Ee(he.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Ic(s,e){if(cs("AsyncQueue",`${e}: ${s}`),Fa(s))return new Ee(he.UNAVAILABLE,`${e}: ${s}`);throw s}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wn{constructor(e){this.comparator=e?(t,n)=>e(t,n)||Ve.comparator(t.key,n.key):(t,n)=>Ve.comparator(t.key,n.key),this.keyedMap=ca(),this.sortedSet=new jt(this.comparator)}static emptySet(e){return new wn(e.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,n)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof wn)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){const a=t.getNext().key,i=n.getNext().key;if(!a.isEqual(i))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){const n=new wn;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $u{constructor(){this.W_=new jt(Ve.comparator)}track(e){const t=e.doc.key,n=this.W_.get(t);n?e.type!==0&&n.type===3?this.W_=this.W_.insert(t,e):e.type===3&&n.type!==1?this.W_=this.W_.insert(t,{type:n.type,doc:e.doc}):e.type===2&&n.type===2?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):e.type===2&&n.type===0?this.W_=this.W_.insert(t,{type:0,doc:e.doc}):e.type===1&&n.type===0?this.W_=this.W_.remove(t):e.type===1&&n.type===2?this.W_=this.W_.insert(t,{type:1,doc:n.doc}):e.type===0&&n.type===1?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):qe():this.W_=this.W_.insert(t,e)}G_(){const e=[];return this.W_.inorderTraversal((t,n)=>{e.push(n)}),e}}class Rn{constructor(e,t,n,a,i,o,c,d,h){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=a,this.mutatedKeys=i,this.fromCache=o,this.syncStateChanged=c,this.excludesMetadataChanges=d,this.hasCachedResults=h}static fromInitialDocuments(e,t,n,a,i){const o=[];return t.forEach(c=>{o.push({type:0,doc:c})}),new Rn(e,t,wn.emptySet(t),o,n,a,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&uo(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let a=0;a<t.length;a++)if(t[a].type!==n[a].type||!t[a].doc.isEqual(n[a].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dv{constructor(){this.z_=void 0,this.j_=[]}H_(){return this.j_.some(e=>e.J_())}}class $v{constructor(){this.queries=Ru(),this.onlineState="Unknown",this.Y_=new Set}terminate(){(function(t,n){const a=Ge(t),i=a.queries;a.queries=Ru(),i.forEach((o,c)=>{for(const d of c.j_)d.onError(n)})})(this,new Ee(he.ABORTED,"Firestore shutting down"))}}function Ru(){return new Bn(s=>Rm(s),uo)}async function hg(s,e){const t=Ge(s);let n=3;const a=e.query;let i=t.queries.get(a);i?!i.H_()&&e.J_()&&(n=2):(i=new Dv,n=e.J_()?0:1);try{switch(n){case 0:i.z_=await t.onListen(a,!0);break;case 1:i.z_=await t.onListen(a,!1);break;case 2:await t.onFirstRemoteStoreListen(a)}}catch(o){const c=Ic(o,`Initialization of query '${gn(e.query)}' failed`);return void e.onError(c)}t.queries.set(a,i),i.j_.push(e),e.Z_(t.onlineState),i.z_&&e.X_(i.z_)&&Tc(t)}async function mg(s,e){const t=Ge(s),n=e.query;let a=3;const i=t.queries.get(n);if(i){const o=i.j_.indexOf(e);o>=0&&(i.j_.splice(o,1),i.j_.length===0?a=e.J_()?0:1:!i.H_()&&e.J_()&&(a=2))}switch(a){case 0:return t.queries.delete(n),t.onUnlisten(n,!0);case 1:return t.queries.delete(n),t.onUnlisten(n,!1);case 2:return t.onLastRemoteStoreUnlisten(n);default:return}}function Rv(s,e){const t=Ge(s);let n=!1;for(const a of e){const i=a.query,o=t.queries.get(i);if(o){for(const c of o.j_)c.X_(a)&&(n=!0);o.z_=a}}n&&Tc(t)}function Pv(s,e,t){const n=Ge(s),a=n.queries.get(e);if(a)for(const i of a.j_)i.onError(t);n.queries.delete(e)}function Tc(s){s.Y_.forEach(e=>{e.next()})}var Ml,Pu;(Pu=Ml||(Ml={})).ea="default",Pu.Cache="cache";class gg{constructor(e,t,n){this.query=e,this.ta=t,this.na=!1,this.ra=null,this.onlineState="Unknown",this.options=n||{}}X_(e){if(!this.options.includeMetadataChanges){const n=[];for(const a of e.docChanges)a.type!==3&&n.push(a);e=new Rn(e.query,e.docs,e.oldDocs,n,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.na?this.ia(e)&&(this.ta.next(e),t=!0):this.sa(e,this.onlineState)&&(this.oa(e),t=!0),this.ra=e,t}onError(e){this.ta.error(e)}Z_(e){this.onlineState=e;let t=!1;return this.ra&&!this.na&&this.sa(this.ra,e)&&(this.oa(this.ra),t=!0),t}sa(e,t){if(!e.fromCache||!this.J_())return!0;const n=t!=="Offline";return(!this.options._a||!n)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}ia(e){if(e.docChanges.length>0)return!0;const t=this.ra&&this.ra.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}oa(e){e=Rn.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.na=!0,this.ta.next(e)}J_(){return this.options.source!==Ml.Cache}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pg{constructor(e){this.key=e}}class xg{constructor(e){this.key=e}}class Mv{constructor(e,t){this.query=e,this.Ta=t,this.Ea=null,this.hasCachedResults=!1,this.current=!1,this.da=et(),this.mutatedKeys=et(),this.Aa=Pm(e),this.Ra=new wn(this.Aa)}get Va(){return this.Ta}ma(e,t){const n=t?t.fa:new $u,a=t?t.Ra:this.Ra;let i=t?t.mutatedKeys:this.mutatedKeys,o=a,c=!1;const d=this.query.limitType==="F"&&a.size===this.query.limit?a.last():null,h=this.query.limitType==="L"&&a.size===this.query.limit?a.first():null;if(e.inorderTraversal((m,x)=>{const f=a.get(m),w=ho(this.query,x)?x:null,$=!!f&&this.mutatedKeys.has(f.key),A=!!w&&(w.hasLocalMutations||this.mutatedKeys.has(w.key)&&w.hasCommittedMutations);let T=!1;f&&w?f.data.isEqual(w.data)?$!==A&&(n.track({type:3,doc:w}),T=!0):this.ga(f,w)||(n.track({type:2,doc:w}),T=!0,(d&&this.Aa(w,d)>0||h&&this.Aa(w,h)<0)&&(c=!0)):!f&&w?(n.track({type:0,doc:w}),T=!0):f&&!w&&(n.track({type:1,doc:f}),T=!0,(d||h)&&(c=!0)),T&&(w?(o=o.add(w),i=A?i.add(m):i.delete(m)):(o=o.delete(m),i=i.delete(m)))}),this.query.limit!==null)for(;o.size>this.query.limit;){const m=this.query.limitType==="F"?o.last():o.first();o=o.delete(m.key),i=i.delete(m.key),n.track({type:1,doc:m})}return{Ra:o,fa:n,ns:c,mutatedKeys:i}}ga(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n,a){const i=this.Ra;this.Ra=e.Ra,this.mutatedKeys=e.mutatedKeys;const o=e.fa.G_();o.sort((m,x)=>function(w,$){const A=T=>{switch(T){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return qe()}};return A(w)-A($)}(m.type,x.type)||this.Aa(m.doc,x.doc)),this.pa(n),a=a!=null&&a;const c=t&&!a?this.ya():[],d=this.da.size===0&&this.current&&!a?1:0,h=d!==this.Ea;return this.Ea=d,o.length!==0||h?{snapshot:new Rn(this.query,e.Ra,i,o,e.mutatedKeys,d===0,h,!1,!!n&&n.resumeToken.approximateByteSize()>0),wa:c}:{wa:c}}Z_(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({Ra:this.Ra,fa:new $u,mutatedKeys:this.mutatedKeys,ns:!1},!1)):{wa:[]}}Sa(e){return!this.Ta.has(e)&&!!this.Ra.has(e)&&!this.Ra.get(e).hasLocalMutations}pa(e){e&&(e.addedDocuments.forEach(t=>this.Ta=this.Ta.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.Ta=this.Ta.delete(t)),this.current=e.current)}ya(){if(!this.current)return[];const e=this.da;this.da=et(),this.Ra.forEach(n=>{this.Sa(n.key)&&(this.da=this.da.add(n.key))});const t=[];return e.forEach(n=>{this.da.has(n)||t.push(new xg(n))}),this.da.forEach(n=>{e.has(n)||t.push(new pg(n))}),t}ba(e){this.Ta=e.Ts,this.da=et();const t=this.ma(e.documents);return this.applyChanges(t,!0)}Da(){return Rn.fromInitialDocuments(this.query,this.Ra,this.mutatedKeys,this.Ea===0,this.hasCachedResults)}}class Ov{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}}class Vv{constructor(e){this.key=e,this.va=!1}}class Lv{constructor(e,t,n,a,i,o){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=a,this.currentUser=i,this.maxConcurrentLimboResolutions=o,this.Ca={},this.Fa=new Bn(c=>Rm(c),uo),this.Ma=new Map,this.xa=new Set,this.Oa=new jt(Ve.comparator),this.Na=new Map,this.La=new yc,this.Ba={},this.ka=new Map,this.qa=$n.kn(),this.onlineState="Unknown",this.Qa=void 0}get isPrimaryClient(){return this.Qa===!0}}async function Fv(s,e,t=!0){const n=kg(s);let a;const i=n.Fa.get(e);return i?(n.sharedClientState.addLocalQueryTarget(i.targetId),a=i.view.Da()):a=await fg(n,e,t,!0),a}async function Uv(s,e){const t=kg(s);await fg(t,e,!0,!1)}async function fg(s,e,t,n){const a=await cv(s.localStore,Vr(e)),i=a.targetId,o=s.sharedClientState.addLocalQueryTarget(i,t);let c;return n&&(c=await Bv(s,e,i,o==="current",a.resumeToken)),s.isPrimaryClient&&t&&ig(s.remoteStore,a),c}async function Bv(s,e,t,n,a){s.Ka=(x,f,w)=>async function(A,T,K,P){let S=T.view.ma(K);S.ns&&(S=await Su(A.localStore,T.query,!1).then(({documents:k})=>T.view.ma(k,S)));const L=P&&P.targetChanges.get(T.targetId),ee=P&&P.targetMismatches.get(T.targetId)!=null,D=T.view.applyChanges(S,A.isPrimaryClient,L,ee);return Ou(A,T.targetId,D.wa),D.snapshot}(s,x,f,w);const i=await Su(s.localStore,e,!0),o=new Mv(e,i.Ts),c=o.ma(i.documents),d=Ba.createSynthesizedTargetChangeForCurrentChange(t,n&&s.onlineState!=="Offline",a),h=o.applyChanges(c,s.isPrimaryClient,d);Ou(s,t,h.wa);const m=new Ov(e,t,o);return s.Fa.set(e,m),s.Ma.has(t)?s.Ma.get(t).push(e):s.Ma.set(t,[e]),h.snapshot}async function qv(s,e,t){const n=Ge(s),a=n.Fa.get(e),i=n.Ma.get(a.targetId);if(i.length>1)return n.Ma.set(a.targetId,i.filter(o=>!uo(o,e))),void n.Fa.delete(e);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(a.targetId),n.sharedClientState.isActiveQueryTarget(a.targetId)||await Pl(n.localStore,a.targetId,!1).then(()=>{n.sharedClientState.clearQueryState(a.targetId),t&&kc(n.remoteStore,a.targetId),Ol(n,a.targetId)}).catch(La)):(Ol(n,a.targetId),await Pl(n.localStore,a.targetId,!0))}async function zv(s,e){const t=Ge(s),n=t.Fa.get(e),a=t.Ma.get(n.targetId);t.isPrimaryClient&&a.length===1&&(t.sharedClientState.removeLocalQueryTarget(n.targetId),kc(t.remoteStore,n.targetId))}async function Wv(s,e,t){const n=Jv(s);try{const a=await function(o,c){const d=Ge(o),h=Mt.now(),m=c.reduce((w,$)=>w.add($.key),et());let x,f;return d.persistence.runTransaction("Locally write mutations","readwrite",w=>{let $=ds(),A=et();return d.cs.getEntries(w,m).next(T=>{$=T,$.forEach((K,P)=>{P.isValidDocument()||(A=A.add(K))})}).next(()=>d.localDocuments.getOverlayedDocuments(w,$)).next(T=>{x=T;const K=[];for(const P of c){const S=my(P,x.get(P.key).overlayedDocument);S!=null&&K.push(new Fs(P.key,S,Em(S.value.mapValue),Ar.exists(!0)))}return d.mutationQueue.addMutationBatch(w,h,K,c)}).next(T=>{f=T;const K=T.applyToLocalDocumentSet(x,A);return d.documentOverlayCache.saveOverlays(w,T.batchId,K)})}).then(()=>({batchId:f.batchId,changes:Om(x)}))}(n.localStore,e);n.sharedClientState.addPendingMutation(a.batchId),function(o,c,d){let h=o.Ba[o.currentUser.toKey()];h||(h=new jt(ut)),h=h.insert(c,d),o.Ba[o.currentUser.toKey()]=h}(n,a.batchId,t),await za(n,a.changes),await bo(n.remoteStore)}catch(a){const i=Ic(a,"Failed to persist write");t.reject(i)}}async function bg(s,e){const t=Ge(s);try{const n=await iv(t.localStore,e);e.targetChanges.forEach((a,i)=>{const o=t.Na.get(i);o&&(pt(a.addedDocuments.size+a.modifiedDocuments.size+a.removedDocuments.size<=1),a.addedDocuments.size>0?o.va=!0:a.modifiedDocuments.size>0?pt(o.va):a.removedDocuments.size>0&&(pt(o.va),o.va=!1))}),await za(t,n,e)}catch(n){await La(n)}}function Mu(s,e,t){const n=Ge(s);if(n.isPrimaryClient&&t===0||!n.isPrimaryClient&&t===1){const a=[];n.Fa.forEach((i,o)=>{const c=o.view.Z_(e);c.snapshot&&a.push(c.snapshot)}),function(o,c){const d=Ge(o);d.onlineState=c;let h=!1;d.queries.forEach((m,x)=>{for(const f of x.j_)f.Z_(c)&&(h=!0)}),h&&Tc(d)}(n.eventManager,e),a.length&&n.Ca.d_(a),n.onlineState=e,n.isPrimaryClient&&n.sharedClientState.setOnlineState(e)}}async function Hv(s,e,t){const n=Ge(s);n.sharedClientState.updateQueryState(e,"rejected",t);const a=n.Na.get(e),i=a&&a.key;if(i){let o=new jt(Ve.comparator);o=o.insert(i,tr.newNoDocument(i,He.min()));const c=et().add(i),d=new po(He.min(),new Map,new jt(ut),o,c);await bg(n,d),n.Oa=n.Oa.remove(i),n.Na.delete(e),Sc(n)}else await Pl(n.localStore,e,!1).then(()=>Ol(n,e,t)).catch(La)}async function Gv(s,e){const t=Ge(s),n=e.batch.batchId;try{const a=await av(t.localStore,e);vg(t,n,null),yg(t,n),t.sharedClientState.updateMutationState(n,"acknowledged"),await za(t,a)}catch(a){await La(a)}}async function Kv(s,e,t){const n=Ge(s);try{const a=await function(o,c){const d=Ge(o);return d.persistence.runTransaction("Reject batch","readwrite-primary",h=>{let m;return d.mutationQueue.lookupMutationBatch(h,c).next(x=>(pt(x!==null),m=x.keys(),d.mutationQueue.removeMutationBatch(h,x))).next(()=>d.mutationQueue.performConsistencyCheck(h)).next(()=>d.documentOverlayCache.removeOverlaysForBatchId(h,m,c)).next(()=>d.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(h,m)).next(()=>d.localDocuments.getDocuments(h,m))})}(n.localStore,e);vg(n,e,t),yg(n,e),n.sharedClientState.updateMutationState(e,"rejected",t),await za(n,a)}catch(a){await La(a)}}function yg(s,e){(s.ka.get(e)||[]).forEach(t=>{t.resolve()}),s.ka.delete(e)}function vg(s,e,t){const n=Ge(s);let a=n.Ba[n.currentUser.toKey()];if(a){const i=a.get(e);i&&(t?i.reject(t):i.resolve(),a=a.remove(e)),n.Ba[n.currentUser.toKey()]=a}}function Ol(s,e,t=null){s.sharedClientState.removeLocalQueryTarget(e);for(const n of s.Ma.get(e))s.Fa.delete(n),t&&s.Ca.$a(n,t);s.Ma.delete(e),s.isPrimaryClient&&s.La.gr(e).forEach(n=>{s.La.containsKey(n)||wg(s,n)})}function wg(s,e){s.xa.delete(e.path.canonicalString());const t=s.Oa.get(e);t!==null&&(kc(s.remoteStore,t),s.Oa=s.Oa.remove(e),s.Na.delete(t),Sc(s))}function Ou(s,e,t){for(const n of t)n instanceof pg?(s.La.addReference(n.key,e),Yv(s,n)):n instanceof xg?(Se("SyncEngine","Document no longer in limbo: "+n.key),s.La.removeReference(n.key,e),s.La.containsKey(n.key)||wg(s,n.key)):qe()}function Yv(s,e){const t=e.key,n=t.path.canonicalString();s.Oa.get(t)||s.xa.has(n)||(Se("SyncEngine","New document in limbo: "+t),s.xa.add(n),Sc(s))}function Sc(s){for(;s.xa.size>0&&s.Oa.size<s.maxConcurrentLimboResolutions;){const e=s.xa.values().next().value;s.xa.delete(e);const t=new Ve(wt.fromString(e)),n=s.qa.next();s.Na.set(n,new Vv(t)),s.Oa=s.Oa.insert(t,n),ig(s.remoteStore,new Is(Vr(mc(t.path)),n,"TargetPurposeLimboResolution",oc.oe))}}async function za(s,e,t){const n=Ge(s),a=[],i=[],o=[];n.Fa.isEmpty()||(n.Fa.forEach((c,d)=>{o.push(n.Ka(d,e,t).then(h=>{var m;if((h||t)&&n.isPrimaryClient){const x=h?!h.fromCache:(m=t==null?void 0:t.targetChanges.get(d.targetId))===null||m===void 0?void 0:m.current;n.sharedClientState.updateQueryState(d.targetId,x?"current":"not-current")}if(h){a.push(h);const x=wc.Wi(d.targetId,h);i.push(x)}}))}),await Promise.all(o),n.Ca.d_(a),await async function(d,h){const m=Ge(d);try{await m.persistence.runTransaction("notifyLocalViewChanges","readwrite",x=>fe.forEach(h,f=>fe.forEach(f.$i,w=>m.persistence.referenceDelegate.addReference(x,f.targetId,w)).next(()=>fe.forEach(f.Ui,w=>m.persistence.referenceDelegate.removeReference(x,f.targetId,w)))))}catch(x){if(!Fa(x))throw x;Se("LocalStore","Failed to update sequence numbers: "+x)}for(const x of h){const f=x.targetId;if(!x.fromCache){const w=m.os.get(f),$=w.snapshotVersion,A=w.withLastLimboFreeSnapshotVersion($);m.os=m.os.insert(f,A)}}}(n.localStore,i))}async function Qv(s,e){const t=Ge(s);if(!t.currentUser.isEqual(e)){Se("SyncEngine","User change. New user:",e.toKey());const n=await rg(t.localStore,e);t.currentUser=e,function(i,o){i.ka.forEach(c=>{c.forEach(d=>{d.reject(new Ee(he.CANCELLED,o))})}),i.ka.clear()}(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,n.removedBatchIds,n.addedBatchIds),await za(t,n.hs)}}function Xv(s,e){const t=Ge(s),n=t.Na.get(e);if(n&&n.va)return et().add(n.key);{let a=et();const i=t.Ma.get(e);if(!i)return a;for(const o of i){const c=t.Fa.get(o);a=a.unionWith(c.view.Va)}return a}}function kg(s){const e=Ge(s);return e.remoteStore.remoteSyncer.applyRemoteEvent=bg.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=Xv.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=Hv.bind(null,e),e.Ca.d_=Rv.bind(null,e.eventManager),e.Ca.$a=Pv.bind(null,e.eventManager),e}function Jv(s){const e=Ge(s);return e.remoteStore.remoteSyncer.applySuccessfulWrite=Gv.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=Kv.bind(null,e),e}class Fi{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=xo(e.databaseInfo.databaseId),this.sharedClientState=this.Wa(e),this.persistence=this.Ga(e),await this.persistence.start(),this.localStore=this.za(e),this.gcScheduler=this.ja(e,this.localStore),this.indexBackfillerScheduler=this.Ha(e,this.localStore)}ja(e,t){return null}Ha(e,t){return null}za(e){return nv(this.persistence,new rv,e.initialUser,this.serializer)}Ga(e){return new Zy(vc.Zr,this.serializer)}Wa(e){return new uv}async terminate(){var e,t;(e=this.gcScheduler)===null||e===void 0||e.stop(),(t=this.indexBackfillerScheduler)===null||t===void 0||t.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}Fi.provider={build:()=>new Fi};class Vl{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=n=>Mu(this.syncEngine,n,1),this.remoteStore.remoteSyncer.handleCredentialChange=Qv.bind(null,this.syncEngine),await Cv(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return function(){return new $v}()}createDatastore(e){const t=xo(e.databaseInfo.databaseId),n=function(i){return new pv(i)}(e.databaseInfo);return function(i,o,c,d){return new bv(i,o,c,d)}(e.authCredentials,e.appCheckCredentials,n,t)}createRemoteStore(e){return function(n,a,i,o,c){return new vv(n,a,i,o,c)}(this.localStore,this.datastore,e.asyncQueue,t=>Mu(this.syncEngine,t,0),function(){return Cu.D()?new Cu:new hv}())}createSyncEngine(e,t){return function(a,i,o,c,d,h,m){const x=new Lv(a,i,o,c,d,h);return m&&(x.Qa=!0),x}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){var e,t;await async function(a){const i=Ge(a);Se("RemoteStore","RemoteStore shutting down."),i.L_.add(5),await qa(i),i.k_.shutdown(),i.q_.set("Unknown")}(this.remoteStore),(e=this.datastore)===null||e===void 0||e.terminate(),(t=this.eventManager)===null||t===void 0||t.terminate()}}Vl.provider={build:()=>new Vl};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ng{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ya(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ya(this.observer.error,e):cs("Uncaught Error in snapshot listener:",e.toString()))}Za(){this.muted=!0}Ya(e,t){setTimeout(()=>{this.muted||e(t)},0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zv{constructor(e,t,n,a,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=a,this.user=Zt.UNAUTHENTICATED,this.clientId=Nm.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(n,async o=>{Se("FirestoreClient","Received user=",o.uid),await this.authCredentialListener(o),this.user=o}),this.appCheckCredentials.start(n,o=>(Se("FirestoreClient","Received new app check token=",o),this.appCheckCredentialListener(o,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new ns;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const n=Ic(t,"Failed to shutdown persistence");e.reject(n)}}),e.promise}}async function sl(s,e){s.asyncQueue.verifyOperationInProgress(),Se("FirestoreClient","Initializing OfflineComponentProvider");const t=s.configuration;await e.initialize(t);let n=t.initialUser;s.setCredentialChangeListener(async a=>{n.isEqual(a)||(await rg(e.localStore,a),n=a)}),e.persistence.setDatabaseDeletedListener(()=>s.terminate()),s._offlineComponents=e}async function Vu(s,e){s.asyncQueue.verifyOperationInProgress();const t=await ew(s);Se("FirestoreClient","Initializing OnlineComponentProvider"),await e.initialize(t,s.configuration),s.setCredentialChangeListener(n=>Du(e.remoteStore,n)),s.setAppCheckTokenChangeListener((n,a)=>Du(e.remoteStore,a)),s._onlineComponents=e}async function ew(s){if(!s._offlineComponents)if(s._uninitializedComponentsProvider){Se("FirestoreClient","Using user provided OfflineComponentProvider");try{await sl(s,s._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!function(a){return a.name==="FirebaseError"?a.code===he.FAILED_PRECONDITION||a.code===he.UNIMPLEMENTED:!(typeof DOMException<"u"&&a instanceof DOMException)||a.code===22||a.code===20||a.code===11}(t))throw t;Sn("Error using user provided cache. Falling back to memory cache: "+t),await sl(s,new Fi)}}else Se("FirestoreClient","Using default OfflineComponentProvider"),await sl(s,new Fi);return s._offlineComponents}async function jg(s){return s._onlineComponents||(s._uninitializedComponentsProvider?(Se("FirestoreClient","Using user provided OnlineComponentProvider"),await Vu(s,s._uninitializedComponentsProvider._online)):(Se("FirestoreClient","Using default OnlineComponentProvider"),await Vu(s,new Vl))),s._onlineComponents}function tw(s){return jg(s).then(e=>e.syncEngine)}async function _g(s){const e=await jg(s),t=e.eventManager;return t.onListen=Fv.bind(null,e.syncEngine),t.onUnlisten=qv.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=Uv.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=zv.bind(null,e.syncEngine),t}function rw(s,e,t={}){const n=new ns;return s.asyncQueue.enqueueAndForget(async()=>function(i,o,c,d,h){const m=new Ng({next:f=>{m.Za(),o.enqueueAndForget(()=>mg(i,x));const w=f.docs.has(c);!w&&f.fromCache?h.reject(new Ee(he.UNAVAILABLE,"Failed to get document because the client is offline.")):w&&f.fromCache&&d&&d.source==="server"?h.reject(new Ee(he.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):h.resolve(f)},error:f=>h.reject(f)}),x=new gg(mc(c.path),m,{includeMetadataChanges:!0,_a:!0});return hg(i,x)}(await _g(s),s.asyncQueue,e,t,n)),n.promise}function sw(s,e,t={}){const n=new ns;return s.asyncQueue.enqueueAndForget(async()=>function(i,o,c,d,h){const m=new Ng({next:f=>{m.Za(),o.enqueueAndForget(()=>mg(i,x)),f.fromCache&&d.source==="server"?h.reject(new Ee(he.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):h.resolve(f)},error:f=>h.reject(f)}),x=new gg(c,m,{includeMetadataChanges:!0,_a:!0});return hg(i,x)}(await _g(s),s.asyncQueue,e,t,n)),n.promise}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Eg(s){const e={};return s.timeoutSeconds!==void 0&&(e.timeoutSeconds=s.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Lu=new Map;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ig(s,e,t){if(!t)throw new Ee(he.INVALID_ARGUMENT,`Function ${s}() cannot be called with an empty ${e}.`)}function nw(s,e,t,n){if(e===!0&&n===!0)throw new Ee(he.INVALID_ARGUMENT,`${s} and ${t} cannot be used together.`)}function Fu(s){if(!Ve.isDocumentKey(s))throw new Ee(he.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${s} has ${s.length}.`)}function Uu(s){if(Ve.isDocumentKey(s))throw new Ee(he.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${s} has ${s.length}.`)}function yo(s){if(s===void 0)return"undefined";if(s===null)return"null";if(typeof s=="string")return s.length>20&&(s=`${s.substring(0,20)}...`),JSON.stringify(s);if(typeof s=="number"||typeof s=="boolean")return""+s;if(typeof s=="object"){if(s instanceof Array)return"an array";{const e=function(n){return n.constructor?n.constructor.name:null}(s);return e?`a custom ${e} object`:"an object"}}return typeof s=="function"?"a function":qe()}function us(s,e){if("_delegate"in s&&(s=s._delegate),!(s instanceof e)){if(e.name===s.constructor.name)throw new Ee(he.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=yo(s);throw new Ee(he.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bu{constructor(e){var t,n;if(e.host===void 0){if(e.ssl!==void 0)throw new Ee(he.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=(t=e.ssl)===null||t===void 0||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new Ee(he.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}nw("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=Eg((n=e.experimentalLongPollingOptions)!==null&&n!==void 0?n:{}),function(i){if(i.timeoutSeconds!==void 0){if(isNaN(i.timeoutSeconds))throw new Ee(he.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (must not be NaN)`);if(i.timeoutSeconds<5)throw new Ee(he.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (minimum allowed value is 5)`);if(i.timeoutSeconds>30)throw new Ee(he.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(n,a){return n.timeoutSeconds===a.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class vo{constructor(e,t,n,a){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=a,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Bu({}),this._settingsFrozen=!1,this._terminateTask="notTerminated"}get app(){if(!this._app)throw new Ee(he.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new Ee(he.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Bu(e),e.credentials!==void 0&&(this._authCredentials=function(n){if(!n)return new kb;switch(n.type){case"firstParty":return new Eb(n.sessionIndex||"0",n.iamToken||null,n.authTokenFactory||null);case"provider":return n.client;default:throw new Ee(he.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const n=Lu.get(t);n&&(Se("ComponentProvider","Removing Datastore"),Lu.delete(t),n.terminate())}(this),Promise.resolve()}}function aw(s,e,t,n={}){var a;const i=(s=us(s,vo))._getSettings(),o=`${e}:${t}`;if(i.host!=="firestore.googleapis.com"&&i.host!==o&&Sn("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),s._setSettings(Object.assign(Object.assign({},i),{host:o,ssl:!1})),n.mockUserToken){let c,d;if(typeof n.mockUserToken=="string")c=n.mockUserToken,d=Zt.MOCK_USER;else{c=dm(n.mockUserToken,(a=s._app)===null||a===void 0?void 0:a.options.projectId);const h=n.mockUserToken.sub||n.mockUserToken.user_id;if(!h)throw new Ee(he.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");d=new Zt(h)}s._authCredentials=new Nb(new km(c,d))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class on{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new on(this.firestore,e,this._query)}}class xr{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Ds(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new xr(this.firestore,e,this._key)}}class Ds extends on{constructor(e,t,n){super(e,t,mc(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new xr(this.firestore,null,new Ve(e))}withConverter(e){return new Ds(this.firestore,e,this._path)}}function mt(s,e,...t){if(s=sr(s),Ig("collection","path",e),s instanceof vo){const n=wt.fromString(e,...t);return Uu(n),new Ds(s,null,n)}{if(!(s instanceof xr||s instanceof Ds))throw new Ee(he.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const n=s._path.child(wt.fromString(e,...t));return Uu(n),new Ds(s.firestore,null,n)}}function xt(s,e,...t){if(s=sr(s),arguments.length===1&&(e=Nm.newId()),Ig("doc","path",e),s instanceof vo){const n=wt.fromString(e,...t);return Fu(n),new xr(s,null,new Ve(n))}{if(!(s instanceof xr||s instanceof Ds))throw new Ee(he.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const n=s._path.child(wt.fromString(e,...t));return Fu(n),new xr(s.firestore,s instanceof Ds?s.converter:null,new Ve(n))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qu{constructor(e=Promise.resolve()){this.Pu=[],this.Iu=!1,this.Tu=[],this.Eu=null,this.du=!1,this.Au=!1,this.Ru=[],this.t_=new ng(this,"async_queue_retry"),this.Vu=()=>{const n=rl();n&&Se("AsyncQueue","Visibility state changed to "+n.visibilityState),this.t_.jo()},this.mu=e;const t=rl();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this.Vu)}get isShuttingDown(){return this.Iu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.fu(),this.gu(e)}enterRestrictedMode(e){if(!this.Iu){this.Iu=!0,this.Au=e||!1;const t=rl();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this.Vu)}}enqueue(e){if(this.fu(),this.Iu)return new Promise(()=>{});const t=new ns;return this.gu(()=>this.Iu&&this.Au?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Pu.push(e),this.pu()))}async pu(){if(this.Pu.length!==0){try{await this.Pu[0](),this.Pu.shift(),this.t_.reset()}catch(e){if(!Fa(e))throw e;Se("AsyncQueue","Operation failed with retryable error: "+e)}this.Pu.length>0&&this.t_.Go(()=>this.pu())}}gu(e){const t=this.mu.then(()=>(this.du=!0,e().catch(n=>{this.Eu=n,this.du=!1;const a=function(o){let c=o.message||"";return o.stack&&(c=o.stack.includes(o.message)?o.stack:o.message+`
`+o.stack),c}(n);throw cs("INTERNAL UNHANDLED ERROR: ",a),n}).then(n=>(this.du=!1,n))));return this.mu=t,t}enqueueAfterDelay(e,t,n){this.fu(),this.Ru.indexOf(e)>-1&&(t=0);const a=Ec.createAndSchedule(this,e,t,n,i=>this.yu(i));return this.Tu.push(a),a}fu(){this.Eu&&qe()}verifyOperationInProgress(){}async wu(){let e;do e=this.mu,await e;while(e!==this.mu)}Su(e){for(const t of this.Tu)if(t.timerId===e)return!0;return!1}bu(e){return this.wu().then(()=>{this.Tu.sort((t,n)=>t.targetTimeMs-n.targetTimeMs);for(const t of this.Tu)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.wu()})}Du(e){this.Ru.push(e)}yu(e){const t=this.Tu.indexOf(e);this.Tu.splice(t,1)}}class zn extends vo{constructor(e,t,n,a){super(e,t,n,a),this.type="firestore",this._queue=new qu,this._persistenceKey=(a==null?void 0:a.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new qu(e),this._firestoreClient=void 0,await e}}}function iw(s,e){const t=typeof s=="object"?s:ac(),n=typeof s=="string"?s:"(default)",a=lo(t,"firestore").getImmediate({identifier:n});if(!a._initialized){const i=om("firestore");i&&aw(a,...i)}return a}function Ac(s){if(s._terminated)throw new Ee(he.FAILED_PRECONDITION,"The client has already been terminated.");return s._firestoreClient||ow(s),s._firestoreClient}function ow(s){var e,t,n;const a=s._freezeSettings(),i=function(c,d,h,m){return new Lb(c,d,h,m.host,m.ssl,m.experimentalForceLongPolling,m.experimentalAutoDetectLongPolling,Eg(m.experimentalLongPollingOptions),m.useFetchStreams)}(s._databaseId,((e=s._app)===null||e===void 0?void 0:e.options.appId)||"",s._persistenceKey,a);s._componentsProvider||!((t=a.localCache)===null||t===void 0)&&t._offlineComponentProvider&&(!((n=a.localCache)===null||n===void 0)&&n._onlineComponentProvider)&&(s._componentsProvider={_offline:a.localCache._offlineComponentProvider,_online:a.localCache._onlineComponentProvider}),s._firestoreClient=new Zv(s._authCredentials,s._appCheckCredentials,s._queue,i,s._componentsProvider&&function(c){const d=c==null?void 0:c._online.build();return{_offline:c==null?void 0:c._offline.build(d),_online:d}}(s._componentsProvider))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pn{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Pn(Ht.fromBase64String(e))}catch(t){throw new Ee(he.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new Pn(Ht.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wo{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new Ee(he.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new zt(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cc{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dc{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new Ee(he.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new Ee(he.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return ut(this._lat,e._lat)||ut(this._long,e._long)}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $c{constructor(e){this._values=(e||[]).map(t=>t)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(n,a){if(n.length!==a.length)return!1;for(let i=0;i<n.length;++i)if(n[i]!==a[i])return!1;return!0}(this._values,e._values)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lw=/^__.*__$/;class cw{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return this.fieldMask!==null?new Fs(e,this.data,this.fieldMask,t,this.fieldTransforms):new Ua(e,this.data,t,this.fieldTransforms)}}class Tg{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return new Fs(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function Sg(s){switch(s){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw qe()}}class Rc{constructor(e,t,n,a,i,o){this.settings=e,this.databaseId=t,this.serializer=n,this.ignoreUndefinedProperties=a,i===void 0&&this.vu(),this.fieldTransforms=i||[],this.fieldMask=o||[]}get path(){return this.settings.path}get Cu(){return this.settings.Cu}Fu(e){return new Rc(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Mu(e){var t;const n=(t=this.path)===null||t===void 0?void 0:t.child(e),a=this.Fu({path:n,xu:!1});return a.Ou(e),a}Nu(e){var t;const n=(t=this.path)===null||t===void 0?void 0:t.child(e),a=this.Fu({path:n,xu:!1});return a.vu(),a}Lu(e){return this.Fu({path:void 0,xu:!0})}Bu(e){return Ui(e,this.settings.methodName,this.settings.ku||!1,this.path,this.settings.qu)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}vu(){if(this.path)for(let e=0;e<this.path.length;e++)this.Ou(this.path.get(e))}Ou(e){if(e.length===0)throw this.Bu("Document fields must not be empty");if(Sg(this.Cu)&&lw.test(e))throw this.Bu('Document fields cannot begin and end with "__"')}}class dw{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=n||xo(e)}Qu(e,t,n,a=!1){return new Rc({Cu:e,methodName:t,qu:n,path:zt.emptyPath(),xu:!1,ku:a},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function Pc(s){const e=s._freezeSettings(),t=xo(s._databaseId);return new dw(s._databaseId,!!e.ignoreUndefinedProperties,t)}function uw(s,e,t,n,a,i={}){const o=s.Qu(i.merge||i.mergeFields?2:0,e,t,a);Mc("Data must be an object, but it was:",o,n);const c=Ag(n,o);let d,h;if(i.merge)d=new vr(o.fieldMask),h=o.fieldTransforms;else if(i.mergeFields){const m=[];for(const x of i.mergeFields){const f=Ll(e,x,t);if(!o.contains(f))throw new Ee(he.INVALID_ARGUMENT,`Field '${f}' is specified in your field mask but missing from your input data.`);Dg(m,f)||m.push(f)}d=new vr(m),h=o.fieldTransforms.filter(x=>d.covers(x.field))}else d=null,h=o.fieldTransforms;return new cw(new gr(c),d,h)}class ko extends Cc{_toFieldTransform(e){if(e.Cu!==2)throw e.Cu===1?e.Bu(`${this._methodName}() can only appear at the top level of your update data`):e.Bu(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof ko}}function hw(s,e,t,n){const a=s.Qu(1,e,t);Mc("Data must be an object, but it was:",a,n);const i=[],o=gr.empty();nn(n,(d,h)=>{const m=Oc(e,d,t);h=sr(h);const x=a.Nu(m);if(h instanceof ko)i.push(m);else{const f=Wa(h,x);f!=null&&(i.push(m),o.set(m,f))}});const c=new vr(i);return new Tg(o,c,a.fieldTransforms)}function mw(s,e,t,n,a,i){const o=s.Qu(1,e,t),c=[Ll(e,n,t)],d=[a];if(i.length%2!=0)throw new Ee(he.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let f=0;f<i.length;f+=2)c.push(Ll(e,i[f])),d.push(i[f+1]);const h=[],m=gr.empty();for(let f=c.length-1;f>=0;--f)if(!Dg(h,c[f])){const w=c[f];let $=d[f];$=sr($);const A=o.Nu(w);if($ instanceof ko)h.push(w);else{const T=Wa($,A);T!=null&&(h.push(w),m.set(w,T))}}const x=new vr(h);return new Tg(m,x,o.fieldTransforms)}function gw(s,e,t,n=!1){return Wa(t,s.Qu(n?4:3,e))}function Wa(s,e){if(Cg(s=sr(s)))return Mc("Unsupported field value:",e,s),Ag(s,e);if(s instanceof Cc)return function(n,a){if(!Sg(a.Cu))throw a.Bu(`${n._methodName}() can only be used with update() and set()`);if(!a.path)throw a.Bu(`${n._methodName}() is not currently supported inside arrays`);const i=n._toFieldTransform(a);i&&a.fieldTransforms.push(i)}(s,e),null;if(s===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),s instanceof Array){if(e.settings.xu&&e.Cu!==4)throw e.Bu("Nested arrays are not supported");return function(n,a){const i=[];let o=0;for(const c of n){let d=Wa(c,a.Lu(o));d==null&&(d={nullValue:"NULL_VALUE"}),i.push(d),o++}return{arrayValue:{values:i}}}(s,e)}return function(n,a){if((n=sr(n))===null)return{nullValue:"NULL_VALUE"};if(typeof n=="number")return oy(a.serializer,n);if(typeof n=="boolean")return{booleanValue:n};if(typeof n=="string")return{stringValue:n};if(n instanceof Date){const i=Mt.fromDate(n);return{timestampValue:Vi(a.serializer,i)}}if(n instanceof Mt){const i=new Mt(n.seconds,1e3*Math.floor(n.nanoseconds/1e3));return{timestampValue:Vi(a.serializer,i)}}if(n instanceof Dc)return{geoPointValue:{latitude:n.latitude,longitude:n.longitude}};if(n instanceof Pn)return{bytesValue:Ym(a.serializer,n._byteString)};if(n instanceof xr){const i=a.databaseId,o=n.firestore._databaseId;if(!o.isEqual(i))throw a.Bu(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${i.projectId}/${i.database}`);return{referenceValue:bc(n.firestore._databaseId||a.databaseId,n._key.path)}}if(n instanceof $c)return function(o,c){return{mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{values:o.toArray().map(d=>{if(typeof d!="number")throw c.Bu("VectorValues must only contain numeric values.");return gc(c.serializer,d)})}}}}}}(n,a);throw a.Bu(`Unsupported field value: ${yo(n)}`)}(s,e)}function Ag(s,e){const t={};return jm(s)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):nn(s,(n,a)=>{const i=Wa(a,e.Mu(n));i!=null&&(t[n]=i)}),{mapValue:{fields:t}}}function Cg(s){return!(typeof s!="object"||s===null||s instanceof Array||s instanceof Date||s instanceof Mt||s instanceof Dc||s instanceof Pn||s instanceof xr||s instanceof Cc||s instanceof $c)}function Mc(s,e,t){if(!Cg(t)||!function(a){return typeof a=="object"&&a!==null&&(Object.getPrototypeOf(a)===Object.prototype||Object.getPrototypeOf(a)===null)}(t)){const n=yo(t);throw n==="an object"?e.Bu(s+" a custom object"):e.Bu(s+" "+n)}}function Ll(s,e,t){if((e=sr(e))instanceof wo)return e._internalPath;if(typeof e=="string")return Oc(s,e);throw Ui("Field path arguments must be of type string or ",s,!1,void 0,t)}const pw=new RegExp("[~\\*/\\[\\]]");function Oc(s,e,t){if(e.search(pw)>=0)throw Ui(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,s,!1,void 0,t);try{return new wo(...e.split("."))._internalPath}catch{throw Ui(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,s,!1,void 0,t)}}function Ui(s,e,t,n,a){const i=n&&!n.isEmpty(),o=a!==void 0;let c=`Function ${e}() called with invalid data`;t&&(c+=" (via `toFirestore()`)"),c+=". ";let d="";return(i||o)&&(d+=" (found",i&&(d+=` in field ${n}`),o&&(d+=` in document ${a}`),d+=")"),new Ee(he.INVALID_ARGUMENT,c+s+d)}function Dg(s,e){return s.some(t=>t.isEqual(e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $g{constructor(e,t,n,a,i){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=a,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new xr(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new xw(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(No("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}}class xw extends $g{data(){return super.data()}}function No(s,e){return typeof e=="string"?Oc(s,e):e instanceof wo?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fw(s){if(s.limitType==="L"&&s.explicitOrderBy.length===0)throw new Ee(he.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class Vc{}class Rg extends Vc{}function at(s,e,...t){let n=[];e instanceof Vc&&n.push(e),n=n.concat(t),function(i){const o=i.filter(d=>d instanceof Lc).length,c=i.filter(d=>d instanceof jo).length;if(o>1||o>0&&c>0)throw new Ee(he.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(n);for(const a of n)s=a._apply(s);return s}class jo extends Rg{constructor(e,t,n){super(),this._field=e,this._op=t,this._value=n,this.type="where"}static _create(e,t,n){return new jo(e,t,n)}_apply(e){const t=this._parse(e);return Pg(e._query,t),new on(e.firestore,e.converter,Sl(e._query,t))}_parse(e){const t=Pc(e.firestore);return function(i,o,c,d,h,m,x){let f;if(h.isKeyField()){if(m==="array-contains"||m==="array-contains-any")throw new Ee(he.INVALID_ARGUMENT,`Invalid Query. You can't perform '${m}' queries on documentId().`);if(m==="in"||m==="not-in"){Wu(x,m);const w=[];for(const $ of x)w.push(zu(d,i,$));f={arrayValue:{values:w}}}else f=zu(d,i,x)}else m!=="in"&&m!=="not-in"&&m!=="array-contains-any"||Wu(x,m),f=gw(c,o,x,m==="in"||m==="not-in");return $t.create(h,m,f)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}}function Tt(s,e,t){const n=e,a=No("where",s);return jo._create(a,n,t)}class Lc extends Vc{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new Lc(e,t)}_parse(e){const t=this._queryConstraints.map(n=>n._parse(e)).filter(n=>n.getFilters().length>0);return t.length===1?t[0]:Cr.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return t.getFilters().length===0?e:(function(a,i){let o=a;const c=i.getFlattenedFilters();for(const d of c)Pg(o,d),o=Sl(o,d)}(e._query,t),new on(e.firestore,e.converter,Sl(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}class Fc extends Rg{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new Fc(e,t)}_apply(e){const t=function(a,i,o){if(a.startAt!==null)throw new Ee(he.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(a.endAt!==null)throw new Ee(he.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new Ia(i,o)}(e._query,this._field,this._direction);return new on(e.firestore,e.converter,function(a,i){const o=a.explicitOrderBy.concat([i]);return new Un(a.path,a.collectionGroup,o,a.filters.slice(),a.limit,a.limitType,a.startAt,a.endAt)}(e._query,t))}}function Vs(s,e="asc"){const t=e,n=No("orderBy",s);return Fc._create(n,t)}function zu(s,e,t){if(typeof(t=sr(t))=="string"){if(t==="")throw new Ee(he.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!$m(e)&&t.indexOf("/")!==-1)throw new Ee(he.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);const n=e.path.child(wt.fromString(t));if(!Ve.isDocumentKey(n))throw new Ee(he.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${n}' is not because it has an odd number of segments (${n.length}).`);return hu(s,new Ve(n))}if(t instanceof xr)return hu(s,t._key);throw new Ee(he.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${yo(t)}.`)}function Wu(s,e){if(!Array.isArray(s)||s.length===0)throw new Ee(he.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function Pg(s,e){const t=function(a,i){for(const o of a)for(const c of o.getFlattenedFilters())if(i.indexOf(c.op)>=0)return c.op;return null}(s.filters,function(a){switch(a){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(t!==null)throw t===e.op?new Ee(he.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new Ee(he.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}class bw{convertValue(e,t="none"){switch(tn(e)){case 0:return null;case 1:return e.booleanValue;case 2:return St(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(en(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw qe()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const n={};return nn(e,(a,i)=>{n[a]=this.convertValue(i,t)}),n}convertVectorValue(e){var t,n,a;const i=(a=(n=(t=e.fields)===null||t===void 0?void 0:t.value.arrayValue)===null||n===void 0?void 0:n.values)===null||a===void 0?void 0:a.map(o=>St(o.doubleValue));return new $c(i)}convertGeoPoint(e){return new Dc(St(e.latitude),St(e.longitude))}convertArray(e,t){return(e.values||[]).map(n=>this.convertValue(n,t))}convertServerTimestamp(e,t){switch(t){case"previous":const n=cc(e);return n==null?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(ja(e));default:return null}}convertTimestamp(e){const t=Ms(e);return new Mt(t.seconds,t.nanos)}convertDocumentKey(e,t){const n=wt.fromString(e);pt(tg(n));const a=new _a(n.get(1),n.get(3)),i=new Ve(n.popFirst(5));return a.isEqual(t)||cs(`Document ${i} contains a document reference within a different database (${a.projectId}/${a.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yw(s,e,t){let n;return n=s?s.toFirestore(e):e,n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ua{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class Mg extends $g{constructor(e,t,n,a,i,o){super(e,t,n,a,o),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new ki(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const n=this._document.data.field(No("DocumentSnapshot.get",e));if(n!==null)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}}class ki extends Mg{data(e={}){return super.data(e)}}class vw{constructor(e,t,n,a){this._firestore=e,this._userDataWriter=t,this._snapshot=a,this.metadata=new ua(a.hasPendingWrites,a.fromCache),this.query=n}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(n=>{e.call(t,new ki(this._firestore,this._userDataWriter,n.key,n,new ua(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new Ee(he.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(a,i){if(a._snapshot.oldDocs.isEmpty()){let o=0;return a._snapshot.docChanges.map(c=>{const d=new ki(a._firestore,a._userDataWriter,c.doc.key,c.doc,new ua(a._snapshot.mutatedKeys.has(c.doc.key),a._snapshot.fromCache),a.query.converter);return c.doc,{type:"added",doc:d,oldIndex:-1,newIndex:o++}})}{let o=a._snapshot.oldDocs;return a._snapshot.docChanges.filter(c=>i||c.type!==3).map(c=>{const d=new ki(a._firestore,a._userDataWriter,c.doc.key,c.doc,new ua(a._snapshot.mutatedKeys.has(c.doc.key),a._snapshot.fromCache),a.query.converter);let h=-1,m=-1;return c.type!==0&&(h=o.indexOf(c.doc.key),o=o.delete(c.doc.key)),c.type!==1&&(o=o.add(c.doc),m=o.indexOf(c.doc.key)),{type:ww(c.type),doc:d,oldIndex:h,newIndex:m}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function ww(s){switch(s){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return qe()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Og(s){s=us(s,xr);const e=us(s.firestore,zn);return rw(Ac(e),s._key).then(t=>kw(e,s,t))}class Vg extends bw{constructor(e){super(),this.firestore=e}convertBytes(e){return new Pn(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new xr(this.firestore,null,t)}}function Gt(s){s=us(s,on);const e=us(s.firestore,zn),t=Ac(e),n=new Vg(e);return fw(s._query),sw(t,s._query).then(a=>new vw(e,n,s,a))}function dr(s,e,t,...n){s=us(s,xr);const a=us(s.firestore,zn),i=Pc(a);let o;return o=typeof(e=sr(e))=="string"||e instanceof wo?mw(i,"updateDoc",s._key,e,t,n):hw(i,"updateDoc",s._key,e),Uc(a,[o.toMutation(s._key,Ar.exists(!0))])}function kr(s){return Uc(us(s.firestore,zn),[new pc(s._key,Ar.none())])}function fr(s,e){const t=us(s.firestore,zn),n=xt(s),a=yw(s.converter,e);return Uc(t,[uw(Pc(s.firestore),"addDoc",n._key,a,s.converter!==null,{}).toMutation(n._key,Ar.exists(!1))]).then(()=>n)}function Uc(s,e){return function(n,a){const i=new ns;return n.asyncQueue.enqueueAndForget(async()=>Wv(await tw(n),a,i)),i.promise}(Ac(s),e)}function kw(s,e,t){const n=t.docs.get(e._key),a=new Vg(s);return new Mg(s,a,e._key,n,new ua(t.hasPendingWrites,t.fromCache),e.converter)}(function(e,t=!0){(function(a){Fn=a})(sn),Js(new Rs("firestore",(n,{instanceIdentifier:a,options:i})=>{const o=n.getProvider("app").getImmediate(),c=new zn(new jb(n.getProvider("auth-internal")),new Tb(n.getProvider("app-check-internal")),function(h,m){if(!Object.prototype.hasOwnProperty.apply(h.options,["projectId"]))throw new Ee(he.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new _a(h.options.projectId,m)}(o,a),o);return i=Object.assign({useFetchStreams:t},i),c._setSettings(i),c},"PUBLIC").setMultipleInstances(!0)),Or(ou,"4.7.3",e),Or(ou,"4.7.3","esm2017")})();var Nw="firebase",jw="10.14.1";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Or(Nw,jw,"app");function Bc(s,e){var t={};for(var n in s)Object.prototype.hasOwnProperty.call(s,n)&&e.indexOf(n)<0&&(t[n]=s[n]);if(s!=null&&typeof Object.getOwnPropertySymbols=="function")for(var a=0,n=Object.getOwnPropertySymbols(s);a<n.length;a++)e.indexOf(n[a])<0&&Object.prototype.propertyIsEnumerable.call(s,n[a])&&(t[n[a]]=s[n[a]]);return t}function Lg(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const _w=Lg,Fg=new Oa("auth","Firebase",Lg());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Bi=new sc("@firebase/auth");function Ew(s,...e){Bi.logLevel<=st.WARN&&Bi.warn(`Auth (${sn}): ${s}`,...e)}function Ni(s,...e){Bi.logLevel<=st.ERROR&&Bi.error(`Auth (${sn}): ${s}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hs(s,...e){throw qc(s,...e)}function Fr(s,...e){return qc(s,...e)}function Ug(s,e,t){const n=Object.assign(Object.assign({},_w()),{[e]:t});return new Oa("auth","Firebase",n).create(e,{appName:s.name})}function Xs(s){return Ug(s,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function qc(s,...e){if(typeof s!="string"){const t=e[0],n=[...e.slice(1)];return n[0]&&(n[0].appName=s.name),s._errorFactory.create(t,...n)}return Fg.create(s,...e)}function Be(s,e,...t){if(!s)throw qc(e,...t)}function es(s){const e="INTERNAL ASSERTION FAILED: "+s;throw Ni(e),new Error(e)}function ms(s,e){s||es(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Fl(){var s;return typeof self<"u"&&((s=self.location)===null||s===void 0?void 0:s.href)||""}function Iw(){return Hu()==="http:"||Hu()==="https:"}function Hu(){var s;return typeof self<"u"&&((s=self.location)===null||s===void 0?void 0:s.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Tw(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(Iw()||tf()||"connection"in navigator)?navigator.onLine:!0}function Sw(){if(typeof navigator>"u")return null;const s=navigator;return s.languages&&s.languages[0]||s.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ha{constructor(e,t){this.shortDelay=e,this.longDelay=t,ms(t>e,"Short delay should be less than long delay!"),this.isMobile=Jx()||rf()}get(){return Tw()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zc(s,e){ms(s.emulator,"Emulator should always be set here");const{url:t}=s.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bg{static initialize(e,t,n){this.fetchImpl=e,t&&(this.headersImpl=t),n&&(this.responseImpl=n)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;es("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;es("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;es("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Aw={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Cw=new Ha(3e4,6e4);function Wc(s,e){return s.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:s.tenantId}):e}async function Wn(s,e,t,n,a={}){return qg(s,a,async()=>{let i={},o={};n&&(e==="GET"?o=n:i={body:JSON.stringify(n)});const c=Va(Object.assign({key:s.config.apiKey},o)).slice(1),d=await s._getAdditionalHeaders();d["Content-Type"]="application/json",s.languageCode&&(d["X-Firebase-Locale"]=s.languageCode);const h=Object.assign({method:e,headers:d},i);return ef()||(h.referrerPolicy="no-referrer"),Bg.fetch()(zg(s,s.config.apiHost,t,c),h)})}async function qg(s,e,t){s._canInitEmulator=!1;const n=Object.assign(Object.assign({},Aw),e);try{const a=new $w(s),i=await Promise.race([t(),a.promise]);a.clearNetworkTimeout();const o=await i.json();if("needConfirmation"in o)throw hi(s,"account-exists-with-different-credential",o);if(i.ok&&!("errorMessage"in o))return o;{const c=i.ok?o.errorMessage:o.error.message,[d,h]=c.split(" : ");if(d==="FEDERATED_USER_ID_ALREADY_LINKED")throw hi(s,"credential-already-in-use",o);if(d==="EMAIL_EXISTS")throw hi(s,"email-already-in-use",o);if(d==="USER_DISABLED")throw hi(s,"user-disabled",o);const m=n[d]||d.toLowerCase().replace(/[_\s]+/g,"-");if(h)throw Ug(s,m,h);hs(s,m)}}catch(a){if(a instanceof Wr)throw a;hs(s,"network-request-failed",{message:String(a)})}}async function Dw(s,e,t,n,a={}){const i=await Wn(s,e,t,n,a);return"mfaPendingCredential"in i&&hs(s,"multi-factor-auth-required",{_serverResponse:i}),i}function zg(s,e,t,n){const a=`${e}${t}?${n}`;return s.config.emulator?zc(s.config,a):`${s.config.apiScheme}://${a}`}class $w{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,n)=>{this.timer=setTimeout(()=>n(Fr(this.auth,"network-request-failed")),Cw.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function hi(s,e,t){const n={appName:s.name};t.email&&(n.email=t.email),t.phoneNumber&&(n.phoneNumber=t.phoneNumber);const a=Fr(s,e,n);return a.customData._tokenResponse=t,a}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Rw(s,e){return Wn(s,"POST","/v1/accounts:delete",e)}async function Wg(s,e){return Wn(s,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xa(s){if(s)try{const e=new Date(Number(s));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function Pw(s,e=!1){const t=sr(s),n=await t.getIdToken(e),a=Hc(n);Be(a&&a.exp&&a.auth_time&&a.iat,t.auth,"internal-error");const i=typeof a.firebase=="object"?a.firebase:void 0,o=i==null?void 0:i.sign_in_provider;return{claims:a,token:n,authTime:xa(nl(a.auth_time)),issuedAtTime:xa(nl(a.iat)),expirationTime:xa(nl(a.exp)),signInProvider:o||null,signInSecondFactor:(i==null?void 0:i.sign_in_second_factor)||null}}function nl(s){return Number(s)*1e3}function Hc(s){const[e,t,n]=s.split(".");if(e===void 0||t===void 0||n===void 0)return Ni("JWT malformed, contained fewer than 3 sections"),null;try{const a=am(t);return a?JSON.parse(a):(Ni("Failed to decode base64 JWT payload"),null)}catch(a){return Ni("Caught error parsing JWT payload as JSON",a==null?void 0:a.toString()),null}}function Gu(s){const e=Hc(s);return Be(e,"internal-error"),Be(typeof e.exp<"u","internal-error"),Be(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Aa(s,e,t=!1){if(t)return e;try{return await e}catch(n){throw n instanceof Wr&&Mw(n)&&s.auth.currentUser===s&&await s.auth.signOut(),n}}function Mw({code:s}){return s==="auth/user-disabled"||s==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ow{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){const n=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),n}else{this.errorBackoff=3e4;const a=((t=this.user.stsTokenManager.expirationTime)!==null&&t!==void 0?t:0)-Date.now()-3e5;return Math.max(0,a)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(e==null?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ul{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=xa(this.lastLoginAt),this.creationTime=xa(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function qi(s){var e;const t=s.auth,n=await s.getIdToken(),a=await Aa(s,Wg(t,{idToken:n}));Be(a==null?void 0:a.users.length,t,"internal-error");const i=a.users[0];s._notifyReloadListener(i);const o=!((e=i.providerUserInfo)===null||e===void 0)&&e.length?Hg(i.providerUserInfo):[],c=Lw(s.providerData,o),d=s.isAnonymous,h=!(s.email&&i.passwordHash)&&!(c!=null&&c.length),m=d?h:!1,x={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:c,metadata:new Ul(i.createdAt,i.lastLoginAt),isAnonymous:m};Object.assign(s,x)}async function Vw(s){const e=sr(s);await qi(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function Lw(s,e){return[...s.filter(n=>!e.some(a=>a.providerId===n.providerId)),...e]}function Hg(s){return s.map(e=>{var{providerId:t}=e,n=Bc(e,["providerId"]);return{providerId:t,uid:n.rawId||"",displayName:n.displayName||null,email:n.email||null,phoneNumber:n.phoneNumber||null,photoURL:n.photoUrl||null}})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Fw(s,e){const t=await qg(s,{},async()=>{const n=Va({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:a,apiKey:i}=s.config,o=zg(s,a,"/v1/token",`key=${i}`),c=await s._getAdditionalHeaders();return c["Content-Type"]="application/x-www-form-urlencoded",Bg.fetch()(o,{method:"POST",headers:c,body:n})});return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}}async function Uw(s,e){return Wn(s,"POST","/v2/accounts:revokeToken",Wc(s,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kn{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){Be(e.idToken,"internal-error"),Be(typeof e.idToken<"u","internal-error"),Be(typeof e.refreshToken<"u","internal-error");const t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):Gu(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){Be(e.length!==0,"internal-error");const t=Gu(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return!t&&this.accessToken&&!this.isExpired?this.accessToken:(Be(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:n,refreshToken:a,expiresIn:i}=await Fw(e,t);this.updateTokensAndExpiration(n,a,Number(i))}updateTokensAndExpiration(e,t,n){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+n*1e3}static fromJSON(e,t){const{refreshToken:n,accessToken:a,expirationTime:i}=t,o=new kn;return n&&(Be(typeof n=="string","internal-error",{appName:e}),o.refreshToken=n),a&&(Be(typeof a=="string","internal-error",{appName:e}),o.accessToken=a),i&&(Be(typeof i=="number","internal-error",{appName:e}),o.expirationTime=i),o}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new kn,this.toJSON())}_performRefresh(){return es("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bs(s,e){Be(typeof s=="string"||typeof s>"u","internal-error",{appName:e})}class ts{constructor(e){var{uid:t,auth:n,stsTokenManager:a}=e,i=Bc(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new Ow(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=n,this.stsTokenManager=a,this.accessToken=a.accessToken,this.displayName=i.displayName||null,this.email=i.email||null,this.emailVerified=i.emailVerified||!1,this.phoneNumber=i.phoneNumber||null,this.photoURL=i.photoURL||null,this.isAnonymous=i.isAnonymous||!1,this.tenantId=i.tenantId||null,this.providerData=i.providerData?[...i.providerData]:[],this.metadata=new Ul(i.createdAt||void 0,i.lastLoginAt||void 0)}async getIdToken(e){const t=await Aa(this,this.stsTokenManager.getToken(this.auth,e));return Be(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return Pw(this,e)}reload(){return Vw(this)}_assign(e){this!==e&&(Be(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>Object.assign({},t)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new ts(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){Be(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let n=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),n=!0),t&&await qi(this),await this.auth._persistUserIfCurrent(this),n&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(Es(this.auth.app))return Promise.reject(Xs(this.auth));const e=await this.getIdToken();return await Aa(this,Rw(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var n,a,i,o,c,d,h,m;const x=(n=t.displayName)!==null&&n!==void 0?n:void 0,f=(a=t.email)!==null&&a!==void 0?a:void 0,w=(i=t.phoneNumber)!==null&&i!==void 0?i:void 0,$=(o=t.photoURL)!==null&&o!==void 0?o:void 0,A=(c=t.tenantId)!==null&&c!==void 0?c:void 0,T=(d=t._redirectEventId)!==null&&d!==void 0?d:void 0,K=(h=t.createdAt)!==null&&h!==void 0?h:void 0,P=(m=t.lastLoginAt)!==null&&m!==void 0?m:void 0,{uid:S,emailVerified:L,isAnonymous:ee,providerData:D,stsTokenManager:k}=t;Be(S&&k,e,"internal-error");const b=kn.fromJSON(this.name,k);Be(typeof S=="string",e,"internal-error"),bs(x,e.name),bs(f,e.name),Be(typeof L=="boolean",e,"internal-error"),Be(typeof ee=="boolean",e,"internal-error"),bs(w,e.name),bs($,e.name),bs(A,e.name),bs(T,e.name),bs(K,e.name),bs(P,e.name);const v=new ts({uid:S,auth:e,email:f,emailVerified:L,displayName:x,isAnonymous:ee,photoURL:$,phoneNumber:w,tenantId:A,stsTokenManager:b,createdAt:K,lastLoginAt:P});return D&&Array.isArray(D)&&(v.providerData=D.map(j=>Object.assign({},j))),T&&(v._redirectEventId=T),v}static async _fromIdTokenResponse(e,t,n=!1){const a=new kn;a.updateFromServerResponse(t);const i=new ts({uid:t.localId,auth:e,stsTokenManager:a,isAnonymous:n});return await qi(i),i}static async _fromGetAccountInfoResponse(e,t,n){const a=t.users[0];Be(a.localId!==void 0,"internal-error");const i=a.providerUserInfo!==void 0?Hg(a.providerUserInfo):[],o=!(a.email&&a.passwordHash)&&!(i!=null&&i.length),c=new kn;c.updateFromIdToken(n);const d=new ts({uid:a.localId,auth:e,stsTokenManager:c,isAnonymous:o}),h={uid:a.localId,displayName:a.displayName||null,photoURL:a.photoUrl||null,email:a.email||null,emailVerified:a.emailVerified||!1,phoneNumber:a.phoneNumber||null,tenantId:a.tenantId||null,providerData:i,metadata:new Ul(a.createdAt,a.lastLoginAt),isAnonymous:!(a.email&&a.passwordHash)&&!(i!=null&&i.length)};return Object.assign(d,h),d}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ku=new Map;function rs(s){ms(s instanceof Function,"Expected a class definition");let e=Ku.get(s);return e?(ms(e instanceof s,"Instance stored in cache mismatched with class"),e):(e=new s,Ku.set(s,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gg{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return t===void 0?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}Gg.type="NONE";const Yu=Gg;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ji(s,e,t){return`firebase:${s}:${e}:${t}`}class Nn{constructor(e,t,n){this.persistence=e,this.auth=t,this.userKey=n;const{config:a,name:i}=this.auth;this.fullUserKey=ji(this.userKey,a.apiKey,i),this.fullPersistenceKey=ji("persistence",a.apiKey,i),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);return e?ts._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,n="authUser"){if(!t.length)return new Nn(rs(Yu),e,n);const a=(await Promise.all(t.map(async h=>{if(await h._isAvailable())return h}))).filter(h=>h);let i=a[0]||rs(Yu);const o=ji(n,e.config.apiKey,e.name);let c=null;for(const h of t)try{const m=await h._get(o);if(m){const x=ts._fromJSON(e,m);h!==i&&(c=x),i=h;break}}catch{}const d=a.filter(h=>h._shouldAllowMigration);return!i._shouldAllowMigration||!d.length?new Nn(i,e,n):(i=d[0],c&&await i._set(o,c.toJSON()),await Promise.all(t.map(async h=>{if(h!==i)try{await h._remove(o)}catch{}})),new Nn(i,e,n))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Qu(s){const e=s.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(Xg(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(Kg(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(Zg(e))return"Blackberry";if(e0(e))return"Webos";if(Yg(e))return"Safari";if((e.includes("chrome/")||Qg(e))&&!e.includes("edge/"))return"Chrome";if(Jg(e))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,n=s.match(t);if((n==null?void 0:n.length)===2)return n[1]}return"Other"}function Kg(s=rr()){return/firefox\//i.test(s)}function Yg(s=rr()){const e=s.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function Qg(s=rr()){return/crios\//i.test(s)}function Xg(s=rr()){return/iemobile/i.test(s)}function Jg(s=rr()){return/android/i.test(s)}function Zg(s=rr()){return/blackberry/i.test(s)}function e0(s=rr()){return/webos/i.test(s)}function Gc(s=rr()){return/iphone|ipad|ipod/i.test(s)||/macintosh/i.test(s)&&/mobile/i.test(s)}function Bw(s=rr()){var e;return Gc(s)&&!!(!((e=window.navigator)===null||e===void 0)&&e.standalone)}function qw(){return sf()&&document.documentMode===10}function t0(s=rr()){return Gc(s)||Jg(s)||e0(s)||Zg(s)||/windows phone/i.test(s)||Xg(s)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function r0(s,e=[]){let t;switch(s){case"Browser":t=Qu(rr());break;case"Worker":t=`${Qu(rr())}-${s}`;break;default:t=s}const n=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${sn}/${n}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zw{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const n=i=>new Promise((o,c)=>{try{const d=e(i);o(d)}catch(d){c(d)}});n.onAbort=t,this.queue.push(n);const a=this.queue.length-1;return()=>{this.queue[a]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const n of this.queue)await n(e),n.onAbort&&t.push(n.onAbort)}catch(n){t.reverse();for(const a of t)try{a()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:n==null?void 0:n.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Ww(s,e={}){return Wn(s,"GET","/v2/passwordPolicy",Wc(s,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Hw=6;class Gw{constructor(e){var t,n,a,i;const o=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(t=o.minPasswordLength)!==null&&t!==void 0?t:Hw,o.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=o.maxPasswordLength),o.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=o.containsLowercaseCharacter),o.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=o.containsUppercaseCharacter),o.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=o.containsNumericCharacter),o.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=o.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(a=(n=e.allowedNonAlphanumericCharacters)===null||n===void 0?void 0:n.join(""))!==null&&a!==void 0?a:"",this.forceUpgradeOnSignin=(i=e.forceUpgradeOnSignin)!==null&&i!==void 0?i:!1,this.schemaVersion=e.schemaVersion}validatePassword(e){var t,n,a,i,o,c;const d={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,d),this.validatePasswordCharacterOptions(e,d),d.isValid&&(d.isValid=(t=d.meetsMinPasswordLength)!==null&&t!==void 0?t:!0),d.isValid&&(d.isValid=(n=d.meetsMaxPasswordLength)!==null&&n!==void 0?n:!0),d.isValid&&(d.isValid=(a=d.containsLowercaseLetter)!==null&&a!==void 0?a:!0),d.isValid&&(d.isValid=(i=d.containsUppercaseLetter)!==null&&i!==void 0?i:!0),d.isValid&&(d.isValid=(o=d.containsNumericCharacter)!==null&&o!==void 0?o:!0),d.isValid&&(d.isValid=(c=d.containsNonAlphanumericCharacter)!==null&&c!==void 0?c:!0),d}validatePasswordLengthOptions(e,t){const n=this.customStrengthOptions.minPasswordLength,a=this.customStrengthOptions.maxPasswordLength;n&&(t.meetsMinPasswordLength=e.length>=n),a&&(t.meetsMaxPasswordLength=e.length<=a)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let n;for(let a=0;a<e.length;a++)n=e.charAt(a),this.updatePasswordCharacterOptionsStatuses(t,n>="a"&&n<="z",n>="A"&&n<="Z",n>="0"&&n<="9",this.allowedNonAlphanumericCharacters.includes(n))}updatePasswordCharacterOptionsStatuses(e,t,n,a,i){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=n)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=a)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kw{constructor(e,t,n,a){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=n,this.config=a,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Xu(this),this.idTokenSubscription=new Xu(this),this.beforeStateQueue=new zw(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=Fg,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=a.sdkClientVersion}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=rs(t)),this._initializationPromise=this.queue(async()=>{var n,a;if(!this._deleted&&(this.persistenceManager=await Nn.create(this,e),!this._deleted)){if(!((n=this._popupRedirectResolver)===null||n===void 0)&&n._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(t),this.lastNotifiedUid=((a=this.currentUser)===null||a===void 0?void 0:a.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const t=await Wg(this,{idToken:e}),n=await ts._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(n)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var t;if(Es(this.app)){const o=this.app.settings.authIdToken;return o?new Promise(c=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(o).then(c,c))}):this.directlySetCurrentUser(null)}const n=await this.assertedPersistence.getCurrentUser();let a=n,i=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const o=(t=this.redirectUser)===null||t===void 0?void 0:t._redirectEventId,c=a==null?void 0:a._redirectEventId,d=await this.tryRedirectSignIn(e);(!o||o===c)&&(d!=null&&d.user)&&(a=d.user,i=!0)}if(!a)return this.directlySetCurrentUser(null);if(!a._redirectEventId){if(i)try{await this.beforeStateQueue.runMiddleware(a)}catch(o){a=n,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(o))}return a?this.reloadAndSetCurrentUserOrClear(a):this.directlySetCurrentUser(null)}return Be(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===a._redirectEventId?this.directlySetCurrentUser(a):this.reloadAndSetCurrentUserOrClear(a)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await qi(e)}catch(t){if((t==null?void 0:t.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=Sw()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(Es(this.app))return Promise.reject(Xs(this));const t=e?sr(e):null;return t&&Be(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&Be(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return Es(this.app)?Promise.reject(Xs(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return Es(this.app)?Promise.reject(Xs(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(rs(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await Ww(this),t=new Gw(e);this.tenantId===null?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new Oa("auth","Firebase",e())}onAuthStateChanged(e,t,n){return this.registerStateListener(this.authStateSubscription,e,t,n)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,n){return this.registerStateListener(this.idTokenSubscription,e,t,n)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const n=this.onAuthStateChanged(()=>{n(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){const t=await this.currentUser.getIdToken(),n={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};this.tenantId!=null&&(n.tenantId=this.tenantId),await Uw(this,n)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)===null||e===void 0?void 0:e.toJSON()}}async _setRedirectUser(e,t){const n=await this.getOrInitRedirectPersistenceManager(t);return e===null?n.removeCurrentUser():n.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&rs(e)||this._popupRedirectResolver;Be(t,this,"argument-error"),this.redirectPersistenceManager=await Nn.create(this,[rs(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,n;return this._isInitialized&&await this.queue(async()=>{}),((t=this._currentUser)===null||t===void 0?void 0:t._redirectEventId)===e?this._currentUser:((n=this.redirectUser)===null||n===void 0?void 0:n._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const n=(t=(e=this.currentUser)===null||e===void 0?void 0:e.uid)!==null&&t!==void 0?t:null;this.lastNotifiedUid!==n&&(this.lastNotifiedUid=n,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,n,a){if(this._deleted)return()=>{};const i=typeof t=="function"?t:t.next.bind(t);let o=!1;const c=this._isInitialized?Promise.resolve():this._initializationPromise;if(Be(c,this,"internal-error"),c.then(()=>{o||i(this.currentUser)}),typeof t=="function"){const d=e.addObserver(t,n,a);return()=>{o=!0,d()}}else{const d=e.addObserver(t);return()=>{o=!0,d()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return Be(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=r0(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);const n=await((e=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getHeartbeatsHeader());n&&(t["X-Firebase-Client"]=n);const a=await this._getAppCheckToken();return a&&(t["X-Firebase-AppCheck"]=a),t}async _getAppCheckToken(){var e;const t=await((e=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getToken());return t!=null&&t.error&&Ew(`Error while retrieving App Check token: ${t.error}`),t==null?void 0:t.token}}function Kc(s){return sr(s)}class Xu{constructor(e){this.auth=e,this.observer=null,this.addObserver=hf(t=>this.observer=t)}get next(){return Be(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Yc={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function Yw(s){Yc=s}function Qw(s){return Yc.loadJS(s)}function Xw(){return Yc.gapiScript}function Jw(s){return`__${s}${Math.floor(Math.random()*1e6)}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Zw(s,e){const t=lo(s,"auth");if(t.isInitialized()){const a=t.getImmediate(),i=t.getOptions();if(Di(i,e??{}))return a;hs(a,"already-initialized")}return t.initialize({options:e})}function e1(s,e){const t=(e==null?void 0:e.persistence)||[],n=(Array.isArray(t)?t:[t]).map(rs);e!=null&&e.errorMap&&s._updateErrorMap(e.errorMap),s._initializeWithPersistence(n,e==null?void 0:e.popupRedirectResolver)}function t1(s,e,t){const n=Kc(s);Be(n._canInitEmulator,n,"emulator-config-failed"),Be(/^https?:\/\//.test(e),n,"invalid-emulator-scheme");const a=!1,i=s0(e),{host:o,port:c}=r1(e),d=c===null?"":`:${c}`;n.config.emulator={url:`${i}//${o}${d}/`},n.settings.appVerificationDisabledForTesting=!0,n.emulatorConfig=Object.freeze({host:o,port:c,protocol:i.replace(":",""),options:Object.freeze({disableWarnings:a})}),s1()}function s0(s){const e=s.indexOf(":");return e<0?"":s.substr(0,e+1)}function r1(s){const e=s0(s),t=/(\/\/)?([^?#/]+)/.exec(s.substr(e.length));if(!t)return{host:"",port:null};const n=t[2].split("@").pop()||"",a=/^(\[[^\]]+\])(:|$)/.exec(n);if(a){const i=a[1];return{host:i,port:Ju(n.substr(i.length+1))}}else{const[i,o]=n.split(":");return{host:i,port:Ju(o)}}}function Ju(s){if(!s)return null;const e=Number(s);return isNaN(e)?null:e}function s1(){function s(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",s):s())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class n0{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return es("not implemented")}_getIdTokenResponse(e){return es("not implemented")}_linkToIdToken(e,t){return es("not implemented")}_getReauthenticationResolver(e){return es("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function jn(s,e){return Dw(s,"POST","/v1/accounts:signInWithIdp",Wc(s,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const n1="http://localhost";class rn extends n0{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new rn(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):hs("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:n,signInMethod:a}=t,i=Bc(t,["providerId","signInMethod"]);if(!n||!a)return null;const o=new rn(n,a);return o.idToken=i.idToken||void 0,o.accessToken=i.accessToken||void 0,o.secret=i.secret,o.nonce=i.nonce,o.pendingToken=i.pendingToken||null,o}_getIdTokenResponse(e){const t=this.buildRequest();return jn(e,t)}_linkToIdToken(e,t){const n=this.buildRequest();return n.idToken=t,jn(e,n)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,jn(e,t)}buildRequest(){const e={requestUri:n1,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=Va(t)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class a0{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ga extends a0{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ws extends Ga{constructor(){super("facebook.com")}static credential(e){return rn._fromParams({providerId:ws.PROVIDER_ID,signInMethod:ws.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return ws.credentialFromTaggedObject(e)}static credentialFromError(e){return ws.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return ws.credential(e.oauthAccessToken)}catch{return null}}}ws.FACEBOOK_SIGN_IN_METHOD="facebook.com";ws.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ks extends Ga{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return rn._fromParams({providerId:ks.PROVIDER_ID,signInMethod:ks.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return ks.credentialFromTaggedObject(e)}static credentialFromError(e){return ks.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:n}=e;if(!t&&!n)return null;try{return ks.credential(t,n)}catch{return null}}}ks.GOOGLE_SIGN_IN_METHOD="google.com";ks.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ns extends Ga{constructor(){super("github.com")}static credential(e){return rn._fromParams({providerId:Ns.PROVIDER_ID,signInMethod:Ns.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Ns.credentialFromTaggedObject(e)}static credentialFromError(e){return Ns.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Ns.credential(e.oauthAccessToken)}catch{return null}}}Ns.GITHUB_SIGN_IN_METHOD="github.com";Ns.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class js extends Ga{constructor(){super("twitter.com")}static credential(e,t){return rn._fromParams({providerId:js.PROVIDER_ID,signInMethod:js.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return js.credentialFromTaggedObject(e)}static credentialFromError(e){return js.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:n}=e;if(!t||!n)return null;try{return js.credential(t,n)}catch{return null}}}js.TWITTER_SIGN_IN_METHOD="twitter.com";js.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mn{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,n,a=!1){const i=await ts._fromIdTokenResponse(e,n,a),o=Zu(n);return new Mn({user:i,providerId:o,_tokenResponse:n,operationType:t})}static async _forOperation(e,t,n){await e._updateTokensIfNecessary(n,!0);const a=Zu(n);return new Mn({user:e,providerId:a,_tokenResponse:n,operationType:t})}}function Zu(s){return s.providerId?s.providerId:"phoneNumber"in s?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zi extends Wr{constructor(e,t,n,a){var i;super(t.code,t.message),this.operationType=n,this.user=a,Object.setPrototypeOf(this,zi.prototype),this.customData={appName:e.name,tenantId:(i=e.tenantId)!==null&&i!==void 0?i:void 0,_serverResponse:t.customData._serverResponse,operationType:n}}static _fromErrorAndOperation(e,t,n,a){return new zi(e,t,n,a)}}function i0(s,e,t,n){return(e==="reauthenticate"?t._getReauthenticationResolver(s):t._getIdTokenResponse(s)).catch(i=>{throw i.code==="auth/multi-factor-auth-required"?zi._fromErrorAndOperation(s,i,e,n):i})}async function a1(s,e,t=!1){const n=await Aa(s,e._linkToIdToken(s.auth,await s.getIdToken()),t);return Mn._forOperation(s,"link",n)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function i1(s,e,t=!1){const{auth:n}=s;if(Es(n.app))return Promise.reject(Xs(n));const a="reauthenticate";try{const i=await Aa(s,i0(n,a,e,s),t);Be(i.idToken,n,"internal-error");const o=Hc(i.idToken);Be(o,n,"internal-error");const{sub:c}=o;return Be(s.uid===c,n,"user-mismatch"),Mn._forOperation(s,a,i)}catch(i){throw(i==null?void 0:i.code)==="auth/user-not-found"&&hs(n,"user-mismatch"),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function o1(s,e,t=!1){if(Es(s.app))return Promise.reject(Xs(s));const n="signIn",a=await i0(s,n,e),i=await Mn._fromIdTokenResponse(s,n,a);return t||await s._updateCurrentUser(i.user),i}function l1(s,e,t,n){return sr(s).onIdTokenChanged(e,t,n)}function c1(s,e,t){return sr(s).beforeAuthStateChanged(e,t)}const Wi="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class o0{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(Wi,"1"),this.storage.removeItem(Wi),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const d1=1e3,u1=10;class l0 extends o0{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=t0(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const n=this.storage.getItem(t),a=this.localCache[t];n!==a&&e(t,a,n)}}onStorageEvent(e,t=!1){if(!e.key){this.forAllChangedKeys((o,c,d)=>{this.notifyListeners(o,d)});return}const n=e.key;t?this.detachListener():this.stopPolling();const a=()=>{const o=this.storage.getItem(n);!t&&this.localCache[n]===o||this.notifyListeners(n,o)},i=this.storage.getItem(n);qw()&&i!==e.newValue&&e.newValue!==e.oldValue?setTimeout(a,u1):a()}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const a of Array.from(n))a(t&&JSON.parse(t))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,n)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:n}),!0)})},d1)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}l0.type="LOCAL";const h1=l0;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class c0 extends o0{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}c0.type="SESSION";const d0=c0;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function m1(s){return Promise.all(s.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _o{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(a=>a.isListeningto(e));if(t)return t;const n=new _o(e);return this.receivers.push(n),n}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:n,eventType:a,data:i}=t.data,o=this.handlersMap[a];if(!(o!=null&&o.size))return;t.ports[0].postMessage({status:"ack",eventId:n,eventType:a});const c=Array.from(o).map(async h=>h(t.origin,i)),d=await m1(c);t.ports[0].postMessage({status:"done",eventId:n,eventType:a,response:d})}_subscribe(e,t){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),(!t||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}_o.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Qc(s="",e=10){let t="";for(let n=0;n<e;n++)t+=Math.floor(Math.random()*10);return s+t}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class g1{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,n=50){const a=typeof MessageChannel<"u"?new MessageChannel:null;if(!a)throw new Error("connection_unavailable");let i,o;return new Promise((c,d)=>{const h=Qc("",20);a.port1.start();const m=setTimeout(()=>{d(new Error("unsupported_event"))},n);o={messageChannel:a,onMessage(x){const f=x;if(f.data.eventId===h)switch(f.data.status){case"ack":clearTimeout(m),i=setTimeout(()=>{d(new Error("timeout"))},3e3);break;case"done":clearTimeout(i),c(f.data.response);break;default:clearTimeout(m),clearTimeout(i),d(new Error("invalid_response"));break}}},this.handlers.add(o),a.port1.addEventListener("message",o.onMessage),this.target.postMessage({eventType:e,eventId:h,data:t},[a.port2])}).finally(()=>{o&&this.removeMessageHandler(o)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ur(){return window}function p1(s){Ur().location.href=s}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function u0(){return typeof Ur().WorkerGlobalScope<"u"&&typeof Ur().importScripts=="function"}async function x1(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function f1(){var s;return((s=navigator==null?void 0:navigator.serviceWorker)===null||s===void 0?void 0:s.controller)||null}function b1(){return u0()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const h0="firebaseLocalStorageDb",y1=1,Hi="firebaseLocalStorage",m0="fbase_key";class Ka{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function Eo(s,e){return s.transaction([Hi],e?"readwrite":"readonly").objectStore(Hi)}function v1(){const s=indexedDB.deleteDatabase(h0);return new Ka(s).toPromise()}function Bl(){const s=indexedDB.open(h0,y1);return new Promise((e,t)=>{s.addEventListener("error",()=>{t(s.error)}),s.addEventListener("upgradeneeded",()=>{const n=s.result;try{n.createObjectStore(Hi,{keyPath:m0})}catch(a){t(a)}}),s.addEventListener("success",async()=>{const n=s.result;n.objectStoreNames.contains(Hi)?e(n):(n.close(),await v1(),e(await Bl()))})})}async function eh(s,e,t){const n=Eo(s,!0).put({[m0]:e,value:t});return new Ka(n).toPromise()}async function w1(s,e){const t=Eo(s,!1).get(e),n=await new Ka(t).toPromise();return n===void 0?null:n.value}function th(s,e){const t=Eo(s,!0).delete(e);return new Ka(t).toPromise()}const k1=800,N1=3;class g0{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await Bl(),this.db)}async _withRetries(e){let t=0;for(;;)try{const n=await this._openDb();return await e(n)}catch(n){if(t++>N1)throw n;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return u0()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=_o._getInstance(b1()),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){var e,t;if(this.activeServiceWorker=await x1(),!this.activeServiceWorker)return;this.sender=new g1(this.activeServiceWorker);const n=await this.sender._send("ping",{},800);n&&!((e=n[0])===null||e===void 0)&&e.fulfilled&&!((t=n[0])===null||t===void 0)&&t.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||f1()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await Bl();return await eh(e,Wi,"1"),await th(e,Wi),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(n=>eh(n,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(n=>w1(n,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>th(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(a=>{const i=Eo(a,!1).getAll();return new Ka(i).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const t=[],n=new Set;if(e.length!==0)for(const{fbase_key:a,value:i}of e)n.add(a),JSON.stringify(this.localCache[a])!==JSON.stringify(i)&&(this.notifyListeners(a,i),t.push(a));for(const a of Object.keys(this.localCache))this.localCache[a]&&!n.has(a)&&(this.notifyListeners(a,null),t.push(a));return t}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const a of Array.from(n))a(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),k1)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}g0.type="LOCAL";const j1=g0;new Ha(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _1(s,e){return e?rs(e):(Be(s._popupRedirectResolver,s,"argument-error"),s._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xc extends n0{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return jn(e,this._buildIdpRequest())}_linkToIdToken(e,t){return jn(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return jn(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function E1(s){return o1(s.auth,new Xc(s),s.bypassAuthState)}function I1(s){const{auth:e,user:t}=s;return Be(t,e,"internal-error"),i1(t,new Xc(s),s.bypassAuthState)}async function T1(s){const{auth:e,user:t}=s;return Be(t,e,"internal-error"),a1(t,new Xc(s),s.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class p0{constructor(e,t,n,a,i=!1){this.auth=e,this.resolver=n,this.user=a,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(n){this.reject(n)}})}async onAuthEvent(e){const{urlResponse:t,sessionId:n,postBody:a,tenantId:i,error:o,type:c}=e;if(o){this.reject(o);return}const d={auth:this.auth,requestUri:t,sessionId:n,tenantId:i||void 0,postBody:a||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(c)(d))}catch(h){this.reject(h)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return E1;case"linkViaPopup":case"linkViaRedirect":return T1;case"reauthViaPopup":case"reauthViaRedirect":return I1;default:hs(this.auth,"internal-error")}}resolve(e){ms(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){ms(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const S1=new Ha(2e3,1e4);class fn extends p0{constructor(e,t,n,a,i){super(e,t,a,i),this.provider=n,this.authWindow=null,this.pollId=null,fn.currentPopupAction&&fn.currentPopupAction.cancel(),fn.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return Be(e,this.auth,"internal-error"),e}async onExecution(){ms(this.filter.length===1,"Popup operations only handle one event");const e=Qc();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(t=>{this.reject(t)}),this.resolver._isIframeWebStorageSupported(this.auth,t=>{t||this.reject(Fr(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)===null||e===void 0?void 0:e.associatedEvent)||null}cancel(){this.reject(Fr(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,fn.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,n;if(!((n=(t=this.authWindow)===null||t===void 0?void 0:t.window)===null||n===void 0)&&n.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(Fr(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,S1.get())};e()}}fn.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const A1="pendingRedirect",_i=new Map;class C1 extends p0{constructor(e,t,n=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,n),this.eventId=null}async execute(){let e=_i.get(this.auth._key());if(!e){try{const n=await D1(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(n)}catch(t){e=()=>Promise.reject(t)}_i.set(this.auth._key(),e)}return this.bypassAuthState||_i.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function D1(s,e){const t=P1(e),n=R1(s);if(!await n._isAvailable())return!1;const a=await n._get(t)==="true";return await n._remove(t),a}function $1(s,e){_i.set(s._key(),e)}function R1(s){return rs(s._redirectPersistence)}function P1(s){return ji(A1,s.config.apiKey,s.name)}async function M1(s,e,t=!1){if(Es(s.app))return Promise.reject(Xs(s));const n=Kc(s),a=_1(n,e),o=await new C1(n,a,t).execute();return o&&!t&&(delete o.user._redirectEventId,await n._persistUserIfCurrent(o.user),await n._setRedirectUser(null,e)),o}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const O1=10*60*1e3;class V1{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(n=>{this.isEventForConsumer(e,n)&&(t=!0,this.sendToConsumer(e,n),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!L1(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var n;if(e.error&&!x0(e)){const a=((n=e.error.code)===null||n===void 0?void 0:n.split("auth/")[1])||"internal-error";t.onError(Fr(this.auth,a))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const n=t.eventId===null||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&n}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=O1&&this.cachedEventUids.clear(),this.cachedEventUids.has(rh(e))}saveEventToCache(e){this.cachedEventUids.add(rh(e)),this.lastProcessedEventTime=Date.now()}}function rh(s){return[s.type,s.eventId,s.sessionId,s.tenantId].filter(e=>e).join("-")}function x0({type:s,error:e}){return s==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function L1(s){switch(s.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return x0(s);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function F1(s,e={}){return Wn(s,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const U1=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,B1=/^https?/;async function q1(s){if(s.config.emulator)return;const{authorizedDomains:e}=await F1(s);for(const t of e)try{if(z1(t))return}catch{}hs(s,"unauthorized-domain")}function z1(s){const e=Fl(),{protocol:t,hostname:n}=new URL(e);if(s.startsWith("chrome-extension://")){const o=new URL(s);return o.hostname===""&&n===""?t==="chrome-extension:"&&s.replace("chrome-extension://","")===e.replace("chrome-extension://",""):t==="chrome-extension:"&&o.hostname===n}if(!B1.test(t))return!1;if(U1.test(s))return n===s;const a=s.replace(/\./g,"\\.");return new RegExp("^(.+\\."+a+"|"+a+")$","i").test(n)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const W1=new Ha(3e4,6e4);function sh(){const s=Ur().___jsl;if(s!=null&&s.H){for(const e of Object.keys(s.H))if(s.H[e].r=s.H[e].r||[],s.H[e].L=s.H[e].L||[],s.H[e].r=[...s.H[e].L],s.CP)for(let t=0;t<s.CP.length;t++)s.CP[t]=null}}function H1(s){return new Promise((e,t)=>{var n,a,i;function o(){sh(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{sh(),t(Fr(s,"network-request-failed"))},timeout:W1.get()})}if(!((a=(n=Ur().gapi)===null||n===void 0?void 0:n.iframes)===null||a===void 0)&&a.Iframe)e(gapi.iframes.getContext());else if(!((i=Ur().gapi)===null||i===void 0)&&i.load)o();else{const c=Jw("iframefcb");return Ur()[c]=()=>{gapi.load?o():t(Fr(s,"network-request-failed"))},Qw(`${Xw()}?onload=${c}`).catch(d=>t(d))}}).catch(e=>{throw Ei=null,e})}let Ei=null;function G1(s){return Ei=Ei||H1(s),Ei}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const K1=new Ha(5e3,15e3),Y1="__/auth/iframe",Q1="emulator/auth/iframe",X1={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},J1=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function Z1(s){const e=s.config;Be(e.authDomain,s,"auth-domain-config-required");const t=e.emulator?zc(e,Q1):`https://${s.config.authDomain}/${Y1}`,n={apiKey:e.apiKey,appName:s.name,v:sn},a=J1.get(s.config.apiHost);a&&(n.eid=a);const i=s._getFrameworks();return i.length&&(n.fw=i.join(",")),`${t}?${Va(n).slice(1)}`}async function ek(s){const e=await G1(s),t=Ur().gapi;return Be(t,s,"internal-error"),e.open({where:document.body,url:Z1(s),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:X1,dontclear:!0},n=>new Promise(async(a,i)=>{await n.restyle({setHideOnLeave:!1});const o=Fr(s,"network-request-failed"),c=Ur().setTimeout(()=>{i(o)},K1.get());function d(){Ur().clearTimeout(c),a(n)}n.ping(d).then(d,()=>{i(o)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tk={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},rk=500,sk=600,nk="_blank",ak="http://localhost";class nh{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function ik(s,e,t,n=rk,a=sk){const i=Math.max((window.screen.availHeight-a)/2,0).toString(),o=Math.max((window.screen.availWidth-n)/2,0).toString();let c="";const d=Object.assign(Object.assign({},tk),{width:n.toString(),height:a.toString(),top:i,left:o}),h=rr().toLowerCase();t&&(c=Qg(h)?nk:t),Kg(h)&&(e=e||ak,d.scrollbars="yes");const m=Object.entries(d).reduce((f,[w,$])=>`${f}${w}=${$},`,"");if(Bw(h)&&c!=="_self")return ok(e||"",c),new nh(null);const x=window.open(e||"",c,m);Be(x,s,"popup-blocked");try{x.focus()}catch{}return new nh(x)}function ok(s,e){const t=document.createElement("a");t.href=s,t.target=e;const n=document.createEvent("MouseEvent");n.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),t.dispatchEvent(n)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lk="__/auth/handler",ck="emulator/auth/handler",dk=encodeURIComponent("fac");async function ah(s,e,t,n,a,i){Be(s.config.authDomain,s,"auth-domain-config-required"),Be(s.config.apiKey,s,"invalid-api-key");const o={apiKey:s.config.apiKey,appName:s.name,authType:t,redirectUrl:n,v:sn,eventId:a};if(e instanceof a0){e.setDefaultLanguage(s.languageCode),o.providerId=e.providerId||"",uf(e.getCustomParameters())||(o.customParameters=JSON.stringify(e.getCustomParameters()));for(const[m,x]of Object.entries({}))o[m]=x}if(e instanceof Ga){const m=e.getScopes().filter(x=>x!=="");m.length>0&&(o.scopes=m.join(","))}s.tenantId&&(o.tid=s.tenantId);const c=o;for(const m of Object.keys(c))c[m]===void 0&&delete c[m];const d=await s._getAppCheckToken(),h=d?`#${dk}=${encodeURIComponent(d)}`:"";return`${uk(s)}?${Va(c).slice(1)}${h}`}function uk({config:s}){return s.emulator?zc(s,ck):`https://${s.authDomain}/${lk}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const al="webStorageSupport";class hk{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=d0,this._completeRedirectFn=M1,this._overrideRedirectResult=$1}async _openPopup(e,t,n,a){var i;ms((i=this.eventManagers[e._key()])===null||i===void 0?void 0:i.manager,"_initialize() not called before _openPopup()");const o=await ah(e,t,n,Fl(),a);return ik(e,o,Qc())}async _openRedirect(e,t,n,a){await this._originValidation(e);const i=await ah(e,t,n,Fl(),a);return p1(i),new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:a,promise:i}=this.eventManagers[t];return a?Promise.resolve(a):(ms(i,"If manager is not set, promise should be"),i)}const n=this.initAndGetManager(e);return this.eventManagers[t]={promise:n},n.catch(()=>{delete this.eventManagers[t]}),n}async initAndGetManager(e){const t=await ek(e),n=new V1(e);return t.register("authEvent",a=>(Be(a==null?void 0:a.authEvent,e,"invalid-auth-event"),{status:n.onEvent(a.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:n},this.iframes[e._key()]=t,n}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(al,{type:al},a=>{var i;const o=(i=a==null?void 0:a[0])===null||i===void 0?void 0:i[al];o!==void 0&&t(!!o),hs(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=q1(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return t0()||Yg()||Gc()}}const mk=hk;var ih="@firebase/auth",oh="1.7.9";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gk{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)===null||e===void 0?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(n=>{e((n==null?void 0:n.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){Be(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function pk(s){switch(s){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function xk(s){Js(new Rs("auth",(e,{options:t})=>{const n=e.getProvider("app").getImmediate(),a=e.getProvider("heartbeat"),i=e.getProvider("app-check-internal"),{apiKey:o,authDomain:c}=n.options;Be(o&&!o.includes(":"),"invalid-api-key",{appName:n.name});const d={apiKey:o,authDomain:c,clientPlatform:s,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:r0(s)},h=new Kw(n,a,i,d);return e1(h,t),h},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,n)=>{e.getProvider("auth-internal").initialize()})),Js(new Rs("auth-internal",e=>{const t=Kc(e.getProvider("auth").getImmediate());return(n=>new gk(n))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),Or(ih,oh,pk(s)),Or(ih,oh,"esm2017")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fk=5*60,bk=cm("authIdTokenMaxAge")||fk;let lh=null;const yk=s=>async e=>{const t=e&&await e.getIdTokenResult(),n=t&&(new Date().getTime()-Date.parse(t.issuedAtTime))/1e3;if(n&&n>bk)return;const a=t==null?void 0:t.token;lh!==a&&(lh=a,await fetch(s,{method:a?"POST":"DELETE",headers:a?{Authorization:`Bearer ${a}`}:{}}))};function vk(s=ac()){const e=lo(s,"auth");if(e.isInitialized())return e.getImmediate();const t=Zw(s,{popupRedirectResolver:mk,persistence:[j1,h1,d0]}),n=cm("authTokenSyncURL");if(n&&typeof isSecureContext=="boolean"&&isSecureContext){const i=new URL(n,location.origin);if(location.origin===i.origin){const o=yk(i.toString());c1(t,o,()=>o(t.currentUser)),l1(t,c=>o(c))}}const a=im("auth");return a&&t1(t,`http://${a}`),t}function wk(){var s,e;return(e=(s=document.getElementsByTagName("head"))===null||s===void 0?void 0:s[0])!==null&&e!==void 0?e:document}Yw({loadJS(s){return new Promise((e,t)=>{const n=document.createElement("script");n.setAttribute("src",s),n.onload=e,n.onerror=a=>{const i=Fr("internal-error");i.customData=a,t(i)},n.type="text/javascript",n.charset="UTF-8",wk().appendChild(n)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});xk("Browser");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const f0="firebasestorage.googleapis.com",kk="storageBucket",Nk=2*60*1e3,jk=10*60*1e3;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hr extends Wr{constructor(e,t,n=0){super(il(e),`Firebase Storage: ${t} (${il(e)})`),this.status_=n,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,Hr.prototype)}get status(){return this.status_}set status(e){this.status_=e}_codeEquals(e){return il(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message=`${this._baseMessage}
${this.customData.serverResponse}`:this.message=this._baseMessage}}var qr;(function(s){s.UNKNOWN="unknown",s.OBJECT_NOT_FOUND="object-not-found",s.BUCKET_NOT_FOUND="bucket-not-found",s.PROJECT_NOT_FOUND="project-not-found",s.QUOTA_EXCEEDED="quota-exceeded",s.UNAUTHENTICATED="unauthenticated",s.UNAUTHORIZED="unauthorized",s.UNAUTHORIZED_APP="unauthorized-app",s.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",s.INVALID_CHECKSUM="invalid-checksum",s.CANCELED="canceled",s.INVALID_EVENT_NAME="invalid-event-name",s.INVALID_URL="invalid-url",s.INVALID_DEFAULT_BUCKET="invalid-default-bucket",s.NO_DEFAULT_BUCKET="no-default-bucket",s.CANNOT_SLICE_BLOB="cannot-slice-blob",s.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",s.NO_DOWNLOAD_URL="no-download-url",s.INVALID_ARGUMENT="invalid-argument",s.INVALID_ARGUMENT_COUNT="invalid-argument-count",s.APP_DELETED="app-deleted",s.INVALID_ROOT_OPERATION="invalid-root-operation",s.INVALID_FORMAT="invalid-format",s.INTERNAL_ERROR="internal-error",s.UNSUPPORTED_ENVIRONMENT="unsupported-environment"})(qr||(qr={}));function il(s){return"storage/"+s}function _k(){const s="An unknown error occurred, please check the error payload for server response.";return new Hr(qr.UNKNOWN,s)}function Ek(){return new Hr(qr.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function Ik(){return new Hr(qr.CANCELED,"User canceled the upload/download.")}function Tk(s){return new Hr(qr.INVALID_URL,"Invalid URL '"+s+"'.")}function Sk(s){return new Hr(qr.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+s+"'.")}function ch(s){return new Hr(qr.INVALID_ARGUMENT,s)}function b0(){return new Hr(qr.APP_DELETED,"The Firebase app was deleted.")}function Ak(s){return new Hr(qr.INVALID_ROOT_OPERATION,"The operation '"+s+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sr{constructor(e,t){this.bucket=e,this.path_=t}get path(){return this.path_}get isRoot(){return this.path.length===0}fullServerUrl(){const e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(e,t){let n;try{n=Sr.makeFromUrl(e,t)}catch{return new Sr(e,"")}if(n.path==="")return n;throw Sk(e)}static makeFromUrl(e,t){let n=null;const a="([A-Za-z0-9.\\-_]+)";function i(L){L.path.charAt(L.path.length-1)==="/"&&(L.path_=L.path_.slice(0,-1))}const o="(/(.*))?$",c=new RegExp("^gs://"+a+o,"i"),d={bucket:1,path:3};function h(L){L.path_=decodeURIComponent(L.path)}const m="v[A-Za-z0-9_]+",x=t.replace(/[.]/g,"\\."),f="(/([^?#]*).*)?$",w=new RegExp(`^https?://${x}/${m}/b/${a}/o${f}`,"i"),$={bucket:1,path:3},A=t===f0?"(?:storage.googleapis.com|storage.cloud.google.com)":t,T="([^?#]*)",K=new RegExp(`^https?://${A}/${a}/${T}`,"i"),S=[{regex:c,indices:d,postModify:i},{regex:w,indices:$,postModify:h},{regex:K,indices:{bucket:1,path:2},postModify:h}];for(let L=0;L<S.length;L++){const ee=S[L],D=ee.regex.exec(e);if(D){const k=D[ee.indices.bucket];let b=D[ee.indices.path];b||(b=""),n=new Sr(k,b),ee.postModify(n);break}}if(n==null)throw Tk(e);return n}}class Ck{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(e=!1){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Dk(s,e,t){let n=1,a=null,i=null,o=!1,c=0;function d(){return c===2}let h=!1;function m(...T){h||(h=!0,e.apply(null,T))}function x(T){a=setTimeout(()=>{a=null,s(w,d())},T)}function f(){i&&clearTimeout(i)}function w(T,...K){if(h){f();return}if(T){f(),m.call(null,T,...K);return}if(d()||o){f(),m.call(null,T,...K);return}n<64&&(n*=2);let S;c===1?(c=2,S=0):S=(n+Math.random())*1e3,x(S)}let $=!1;function A(T){$||($=!0,f(),!h&&(a!==null?(T||(c=2),clearTimeout(a),x(0)):T||(c=1)))}return x(0),i=setTimeout(()=>{o=!0,A(!0)},t),A}function $k(s){s(!1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Rk(s){return s!==void 0}function dh(s,e,t,n){if(n<e)throw ch(`Invalid value for '${s}'. Expected ${e} or greater.`);if(n>t)throw ch(`Invalid value for '${s}'. Expected ${t} or less.`)}function Pk(s){const e=encodeURIComponent;let t="?";for(const n in s)if(s.hasOwnProperty(n)){const a=e(n)+"="+e(s[n]);t=t+a+"&"}return t=t.slice(0,-1),t}var Gi;(function(s){s[s.NO_ERROR=0]="NO_ERROR",s[s.NETWORK_ERROR=1]="NETWORK_ERROR",s[s.ABORT=2]="ABORT"})(Gi||(Gi={}));/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Mk(s,e){const t=s>=500&&s<600,a=[408,429].indexOf(s)!==-1,i=e.indexOf(s)!==-1;return t||a||i}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ok{constructor(e,t,n,a,i,o,c,d,h,m,x,f=!0){this.url_=e,this.method_=t,this.headers_=n,this.body_=a,this.successCodes_=i,this.additionalRetryCodes_=o,this.callback_=c,this.errorCallback_=d,this.timeout_=h,this.progressCallback_=m,this.connectionFactory_=x,this.retry=f,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((w,$)=>{this.resolve_=w,this.reject_=$,this.start_()})}start_(){const e=(n,a)=>{if(a){n(!1,new mi(!1,null,!0));return}const i=this.connectionFactory_();this.pendingConnection_=i;const o=c=>{const d=c.loaded,h=c.lengthComputable?c.total:-1;this.progressCallback_!==null&&this.progressCallback_(d,h)};this.progressCallback_!==null&&i.addUploadProgressListener(o),i.send(this.url_,this.method_,this.body_,this.headers_).then(()=>{this.progressCallback_!==null&&i.removeUploadProgressListener(o),this.pendingConnection_=null;const c=i.getErrorCode()===Gi.NO_ERROR,d=i.getStatus();if(!c||Mk(d,this.additionalRetryCodes_)&&this.retry){const m=i.getErrorCode()===Gi.ABORT;n(!1,new mi(!1,null,m));return}const h=this.successCodes_.indexOf(d)!==-1;n(!0,new mi(h,i))})},t=(n,a)=>{const i=this.resolve_,o=this.reject_,c=a.connection;if(a.wasSuccessCode)try{const d=this.callback_(c,c.getResponse());Rk(d)?i(d):i()}catch(d){o(d)}else if(c!==null){const d=_k();d.serverResponse=c.getErrorText(),this.errorCallback_?o(this.errorCallback_(c,d)):o(d)}else if(a.canceled){const d=this.appDelete_?b0():Ik();o(d)}else{const d=Ek();o(d)}};this.canceled_?t(!1,new mi(!1,null,!0)):this.backoffId_=Dk(e,t,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,this.backoffId_!==null&&$k(this.backoffId_),this.pendingConnection_!==null&&this.pendingConnection_.abort()}}class mi{constructor(e,t,n){this.wasSuccessCode=e,this.connection=t,this.canceled=!!n}}function Vk(s,e){e!==null&&e.length>0&&(s.Authorization="Firebase "+e)}function Lk(s,e){s["X-Firebase-Storage-Version"]="webjs/"+(e??"AppManager")}function Fk(s,e){e&&(s["X-Firebase-GMPID"]=e)}function Uk(s,e){e!==null&&(s["X-Firebase-AppCheck"]=e)}function Bk(s,e,t,n,a,i,o=!0){const c=Pk(s.urlParams),d=s.url+c,h=Object.assign({},s.headers);return Fk(h,e),Vk(h,t),Lk(h,i),Uk(h,n),new Ok(d,s.method,h,s.body,s.successCodes,s.additionalRetryCodes,s.handler,s.errorHandler,s.timeout,s.progressCallback,a,o)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qk(s){if(s.length===0)return null;const e=s.lastIndexOf("/");return e===-1?"":s.slice(0,e)}function zk(s){const e=s.lastIndexOf("/",s.length-2);return e===-1?s:s.slice(e+1)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ki{constructor(e,t){this._service=e,t instanceof Sr?this._location=t:this._location=Sr.makeFromUrl(t,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,t){return new Ki(e,t)}get root(){const e=new Sr(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return zk(this._location.path)}get storage(){return this._service}get parent(){const e=qk(this._location.path);if(e===null)return null;const t=new Sr(this._location.bucket,e);return new Ki(this._service,t)}_throwIfRoot(e){if(this._location.path==="")throw Ak(e)}}function uh(s,e){const t=e==null?void 0:e[kk];return t==null?null:Sr.makeFromBucketSpec(t,s)}function Wk(s,e,t,n={}){s.host=`${e}:${t}`,s._protocol="http";const{mockUserToken:a}=n;a&&(s._overrideAuthToken=typeof a=="string"?a:dm(a,s.app.options.projectId))}class Hk{constructor(e,t,n,a,i){this.app=e,this._authProvider=t,this._appCheckProvider=n,this._url=a,this._firebaseVersion=i,this._bucket=null,this._host=f0,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=Nk,this._maxUploadRetryTime=jk,this._requests=new Set,a!=null?this._bucket=Sr.makeFromBucketSpec(a,this._host):this._bucket=uh(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,this._url!=null?this._bucket=Sr.makeFromBucketSpec(this._url,e):this._bucket=uh(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){dh("time",0,Number.POSITIVE_INFINITY,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){dh("time",0,Number.POSITIVE_INFINITY,e),this._maxOperationRetryTime=e}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const e=this._authProvider.getImmediate({optional:!0});if(e){const t=await e.getToken();if(t!==null)return t.accessToken}return null}async _getAppCheckToken(){const e=this._appCheckProvider.getImmediate({optional:!0});return e?(await e.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(e=>e.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new Ki(this,e)}_makeRequest(e,t,n,a,i=!0){if(this._deleted)return new Ck(b0());{const o=Bk(e,this._appId,n,a,t,this._firebaseVersion,i);return this._requests.add(o),o.getPromise().then(()=>this._requests.delete(o),()=>this._requests.delete(o)),o}}async makeRequestWithTokens(e,t){const[n,a]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,t,n,a).getPromise()}}const hh="@firebase/storage",mh="0.13.2";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const y0="storage";function Gk(s=ac(),e){s=sr(s);const n=lo(s,y0).getImmediate({identifier:e}),a=om("storage");return a&&Kk(n,...a),n}function Kk(s,e,t,n={}){Wk(s,e,t,n)}function Yk(s,{instanceIdentifier:e}){const t=s.getProvider("app").getImmediate(),n=s.getProvider("auth-internal"),a=s.getProvider("app-check-internal");return new Hk(t,n,a,e,sn)}function Qk(){Js(new Rs(y0,Yk,"PUBLIC").setMultipleInstances(!0)),Or(hh,mh,""),Or(hh,mh,"esm2017")}Qk();const Qr={apiKey:"AIzaSyAwXWcGulx8NIxWhi4XubIwh_RDNeCpHr8",authDomain:"apevault-teams.firebaseapp.com",projectId:"apevault-teams",storageBucket:"apevault-teams.firebasestorage.app",messagingSenderId:"515829779788",appId:"1:515829779788:web:d001cd40196ab1995893e9"};console.log("Firebase config check:",{hasApiKey:!!Qr.apiKey&&Qr.apiKey!=="your-api-key",authDomain:Qr.authDomain,projectId:Qr.projectId,hasStorageBucket:!!Qr.storageBucket&&Qr.storageBucket!=="your-storage-bucket",hasAppId:!!Qr.appId&&Qr.appId!=="your-app-id"});console.log("Raw env values:",{VITE_FIREBASE_API_KEY:"AIzaSyAwXWcGulx8NIxWhi4XubIwh_RDNeCpHr8",VITE_FIREBASE_AUTH_DOMAIN:"apevault-teams.firebaseapp.com",VITE_FIREBASE_PROJECT_ID:"apevault-teams",VITE_FIREBASE_STORAGE_BUCKET:"apevault-teams.firebasestorage.app"});const Jc=mm(Qr);vk(Jc);const Ae=iw(Jc);Gk(Jc);console.log("Firestore db initialized:",!!Ae);const ql={1:"Dex",2:"Enowk",3:"Xenia",4:"Olenka",5:"Sydney"},On=new Map,kt=s=>{var t,n;const e=On.get(s);return e!==void 0?e||ql[s]||((t=$e.find(a=>a.id===s))==null?void 0:t.login)||s:ql[s]||((n=$e.find(a=>a.id===s))==null?void 0:n.login)||s},as=async s=>{var e;try{const t=await kj(s);if(t)return On.set(s,t),t;const n=ql[s]||((e=$e.find(a=>a.id===s))==null?void 0:e.login)||s;return On.set(s,null),n}catch(t){return console.error("Error fetching user nickname:",t),kt(s)}},zl=s=>{On.delete(s)},gh=()=>{On.clear()},Io=s=>{const[e,t]=E.useState(()=>kt(s));return E.useEffect(()=>{On.has(s)||as(s).then(a=>t(a));const n=a=>{const i=a,{userId:o}=i.detail||{};(!o||o===s)&&t(kt(s))};return window.addEventListener("nicknameUpdated",n),()=>window.removeEventListener("nicknameUpdated",n)},[s]),e};function Yi(s){"@babel/helpers - typeof";return Yi=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Yi(s)}function zr(s){if(s===null||s===!0||s===!1)return NaN;var e=Number(s);return isNaN(e)?e:e<0?Math.ceil(e):Math.floor(e)}function Et(s,e){if(e.length<s)throw new TypeError(s+" argument"+(s>1?"s":"")+" required, but only "+e.length+" present")}function Vt(s){Et(1,arguments);var e=Object.prototype.toString.call(s);return s instanceof Date||Yi(s)==="object"&&e==="[object Date]"?new Date(s.getTime()):typeof s=="number"||e==="[object Number]"?new Date(s):((typeof s=="string"||e==="[object String]")&&typeof console<"u"&&(console.warn("Starting with v2.0.0-beta.1 date-fns doesn't accept strings as date arguments. Please use `parseISO` to parse strings. See: https://github.com/date-fns/date-fns/blob/master/docs/upgradeGuide.md#string-arguments"),console.warn(new Error().stack)),new Date(NaN))}function Xk(s,e){Et(2,arguments);var t=Vt(s).getTime(),n=zr(e);return new Date(t+n)}var Jk={};function Hn(){return Jk}function Zk(s,e){var t,n,a,i,o,c,d,h;Et(1,arguments);var m=Hn(),x=zr((t=(n=(a=(i=e==null?void 0:e.weekStartsOn)!==null&&i!==void 0?i:e==null||(o=e.locale)===null||o===void 0||(c=o.options)===null||c===void 0?void 0:c.weekStartsOn)!==null&&a!==void 0?a:m.weekStartsOn)!==null&&n!==void 0?n:(d=m.locale)===null||d===void 0||(h=d.options)===null||h===void 0?void 0:h.weekStartsOn)!==null&&t!==void 0?t:0);if(!(x>=0&&x<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");var f=Vt(s),w=f.getDay(),$=(w<x?7:0)+w-x;return f.setDate(f.getDate()-$),f.setHours(0,0,0,0),f}function eN(s){var e=new Date(Date.UTC(s.getFullYear(),s.getMonth(),s.getDate(),s.getHours(),s.getMinutes(),s.getSeconds(),s.getMilliseconds()));return e.setUTCFullYear(s.getFullYear()),s.getTime()-e.getTime()}function ph(s){Et(1,arguments);var e=Vt(s);return e.setHours(0,0,0,0),e}var v0=6e4,w0=36e5;function tN(s,e){Et(2,arguments);var t=ph(s),n=ph(e);return t.getTime()===n.getTime()}function rN(s){return Et(1,arguments),s instanceof Date||Yi(s)==="object"&&Object.prototype.toString.call(s)==="[object Date]"}function sN(s){if(Et(1,arguments),!rN(s)&&typeof s!="number")return!1;var e=Vt(s);return!isNaN(Number(e))}function nN(s,e){var t;Et(1,arguments);var n=s||{},a=Vt(n.start),i=Vt(n.end),o=i.getTime();if(!(a.getTime()<=o))throw new RangeError("Invalid interval");var c=[],d=a;d.setHours(0,0,0,0);var h=Number((t=void 0)!==null&&t!==void 0?t:1);if(h<1||isNaN(h))throw new RangeError("`options.step` must be a number greater than 1");for(;d.getTime()<=o;)c.push(Vt(d)),d.setDate(d.getDate()+h),d.setHours(0,0,0,0);return c}function aN(s,e){var t,n,a,i,o,c,d,h;Et(1,arguments);var m=Hn(),x=zr((t=(n=(a=(i=e==null?void 0:e.weekStartsOn)!==null&&i!==void 0?i:e==null||(o=e.locale)===null||o===void 0||(c=o.options)===null||c===void 0?void 0:c.weekStartsOn)!==null&&a!==void 0?a:m.weekStartsOn)!==null&&n!==void 0?n:(d=m.locale)===null||d===void 0||(h=d.options)===null||h===void 0?void 0:h.weekStartsOn)!==null&&t!==void 0?t:0);if(!(x>=0&&x<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");var f=Vt(s),w=f.getDay(),$=(w<x?-7:0)+6-(w-x);return f.setDate(f.getDate()+$),f.setHours(23,59,59,999),f}function iN(s,e){Et(2,arguments);var t=zr(e);return Xk(s,-t)}var oN=864e5;function lN(s){Et(1,arguments);var e=Vt(s),t=e.getTime();e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0);var n=e.getTime(),a=t-n;return Math.floor(a/oN)+1}function Qi(s){Et(1,arguments);var e=1,t=Vt(s),n=t.getUTCDay(),a=(n<e?7:0)+n-e;return t.setUTCDate(t.getUTCDate()-a),t.setUTCHours(0,0,0,0),t}function k0(s){Et(1,arguments);var e=Vt(s),t=e.getUTCFullYear(),n=new Date(0);n.setUTCFullYear(t+1,0,4),n.setUTCHours(0,0,0,0);var a=Qi(n),i=new Date(0);i.setUTCFullYear(t,0,4),i.setUTCHours(0,0,0,0);var o=Qi(i);return e.getTime()>=a.getTime()?t+1:e.getTime()>=o.getTime()?t:t-1}function cN(s){Et(1,arguments);var e=k0(s),t=new Date(0);t.setUTCFullYear(e,0,4),t.setUTCHours(0,0,0,0);var n=Qi(t);return n}var dN=6048e5;function uN(s){Et(1,arguments);var e=Vt(s),t=Qi(e).getTime()-cN(e).getTime();return Math.round(t/dN)+1}function Vn(s,e){var t,n,a,i,o,c,d,h;Et(1,arguments);var m=Hn(),x=zr((t=(n=(a=(i=e==null?void 0:e.weekStartsOn)!==null&&i!==void 0?i:e==null||(o=e.locale)===null||o===void 0||(c=o.options)===null||c===void 0?void 0:c.weekStartsOn)!==null&&a!==void 0?a:m.weekStartsOn)!==null&&n!==void 0?n:(d=m.locale)===null||d===void 0||(h=d.options)===null||h===void 0?void 0:h.weekStartsOn)!==null&&t!==void 0?t:0);if(!(x>=0&&x<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");var f=Vt(s),w=f.getUTCDay(),$=(w<x?7:0)+w-x;return f.setUTCDate(f.getUTCDate()-$),f.setUTCHours(0,0,0,0),f}function N0(s,e){var t,n,a,i,o,c,d,h;Et(1,arguments);var m=Vt(s),x=m.getUTCFullYear(),f=Hn(),w=zr((t=(n=(a=(i=e==null?void 0:e.firstWeekContainsDate)!==null&&i!==void 0?i:e==null||(o=e.locale)===null||o===void 0||(c=o.options)===null||c===void 0?void 0:c.firstWeekContainsDate)!==null&&a!==void 0?a:f.firstWeekContainsDate)!==null&&n!==void 0?n:(d=f.locale)===null||d===void 0||(h=d.options)===null||h===void 0?void 0:h.firstWeekContainsDate)!==null&&t!==void 0?t:1);if(!(w>=1&&w<=7))throw new RangeError("firstWeekContainsDate must be between 1 and 7 inclusively");var $=new Date(0);$.setUTCFullYear(x+1,0,w),$.setUTCHours(0,0,0,0);var A=Vn($,e),T=new Date(0);T.setUTCFullYear(x,0,w),T.setUTCHours(0,0,0,0);var K=Vn(T,e);return m.getTime()>=A.getTime()?x+1:m.getTime()>=K.getTime()?x:x-1}function hN(s,e){var t,n,a,i,o,c,d,h;Et(1,arguments);var m=Hn(),x=zr((t=(n=(a=(i=e==null?void 0:e.firstWeekContainsDate)!==null&&i!==void 0?i:e==null||(o=e.locale)===null||o===void 0||(c=o.options)===null||c===void 0?void 0:c.firstWeekContainsDate)!==null&&a!==void 0?a:m.firstWeekContainsDate)!==null&&n!==void 0?n:(d=m.locale)===null||d===void 0||(h=d.options)===null||h===void 0?void 0:h.firstWeekContainsDate)!==null&&t!==void 0?t:1),f=N0(s,e),w=new Date(0);w.setUTCFullYear(f,0,x),w.setUTCHours(0,0,0,0);var $=Vn(w,e);return $}var mN=6048e5;function gN(s,e){Et(1,arguments);var t=Vt(s),n=Vn(t,e).getTime()-hN(t,e).getTime();return Math.round(n/mN)+1}function gt(s,e){for(var t=s<0?"-":"",n=Math.abs(s).toString();n.length<e;)n="0"+n;return t+n}var ys={y:function(e,t){var n=e.getUTCFullYear(),a=n>0?n:1-n;return gt(t==="yy"?a%100:a,t.length)},M:function(e,t){var n=e.getUTCMonth();return t==="M"?String(n+1):gt(n+1,2)},d:function(e,t){return gt(e.getUTCDate(),t.length)},a:function(e,t){var n=e.getUTCHours()/12>=1?"pm":"am";switch(t){case"a":case"aa":return n.toUpperCase();case"aaa":return n;case"aaaaa":return n[0];case"aaaa":default:return n==="am"?"a.m.":"p.m."}},h:function(e,t){return gt(e.getUTCHours()%12||12,t.length)},H:function(e,t){return gt(e.getUTCHours(),t.length)},m:function(e,t){return gt(e.getUTCMinutes(),t.length)},s:function(e,t){return gt(e.getUTCSeconds(),t.length)},S:function(e,t){var n=t.length,a=e.getUTCMilliseconds(),i=Math.floor(a*Math.pow(10,n-3));return gt(i,t.length)}},un={midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},pN={G:function(e,t,n){var a=e.getUTCFullYear()>0?1:0;switch(t){case"G":case"GG":case"GGG":return n.era(a,{width:"abbreviated"});case"GGGGG":return n.era(a,{width:"narrow"});case"GGGG":default:return n.era(a,{width:"wide"})}},y:function(e,t,n){if(t==="yo"){var a=e.getUTCFullYear(),i=a>0?a:1-a;return n.ordinalNumber(i,{unit:"year"})}return ys.y(e,t)},Y:function(e,t,n,a){var i=N0(e,a),o=i>0?i:1-i;if(t==="YY"){var c=o%100;return gt(c,2)}return t==="Yo"?n.ordinalNumber(o,{unit:"year"}):gt(o,t.length)},R:function(e,t){var n=k0(e);return gt(n,t.length)},u:function(e,t){var n=e.getUTCFullYear();return gt(n,t.length)},Q:function(e,t,n){var a=Math.ceil((e.getUTCMonth()+1)/3);switch(t){case"Q":return String(a);case"QQ":return gt(a,2);case"Qo":return n.ordinalNumber(a,{unit:"quarter"});case"QQQ":return n.quarter(a,{width:"abbreviated",context:"formatting"});case"QQQQQ":return n.quarter(a,{width:"narrow",context:"formatting"});case"QQQQ":default:return n.quarter(a,{width:"wide",context:"formatting"})}},q:function(e,t,n){var a=Math.ceil((e.getUTCMonth()+1)/3);switch(t){case"q":return String(a);case"qq":return gt(a,2);case"qo":return n.ordinalNumber(a,{unit:"quarter"});case"qqq":return n.quarter(a,{width:"abbreviated",context:"standalone"});case"qqqqq":return n.quarter(a,{width:"narrow",context:"standalone"});case"qqqq":default:return n.quarter(a,{width:"wide",context:"standalone"})}},M:function(e,t,n){var a=e.getUTCMonth();switch(t){case"M":case"MM":return ys.M(e,t);case"Mo":return n.ordinalNumber(a+1,{unit:"month"});case"MMM":return n.month(a,{width:"abbreviated",context:"formatting"});case"MMMMM":return n.month(a,{width:"narrow",context:"formatting"});case"MMMM":default:return n.month(a,{width:"wide",context:"formatting"})}},L:function(e,t,n){var a=e.getUTCMonth();switch(t){case"L":return String(a+1);case"LL":return gt(a+1,2);case"Lo":return n.ordinalNumber(a+1,{unit:"month"});case"LLL":return n.month(a,{width:"abbreviated",context:"standalone"});case"LLLLL":return n.month(a,{width:"narrow",context:"standalone"});case"LLLL":default:return n.month(a,{width:"wide",context:"standalone"})}},w:function(e,t,n,a){var i=gN(e,a);return t==="wo"?n.ordinalNumber(i,{unit:"week"}):gt(i,t.length)},I:function(e,t,n){var a=uN(e);return t==="Io"?n.ordinalNumber(a,{unit:"week"}):gt(a,t.length)},d:function(e,t,n){return t==="do"?n.ordinalNumber(e.getUTCDate(),{unit:"date"}):ys.d(e,t)},D:function(e,t,n){var a=lN(e);return t==="Do"?n.ordinalNumber(a,{unit:"dayOfYear"}):gt(a,t.length)},E:function(e,t,n){var a=e.getUTCDay();switch(t){case"E":case"EE":case"EEE":return n.day(a,{width:"abbreviated",context:"formatting"});case"EEEEE":return n.day(a,{width:"narrow",context:"formatting"});case"EEEEEE":return n.day(a,{width:"short",context:"formatting"});case"EEEE":default:return n.day(a,{width:"wide",context:"formatting"})}},e:function(e,t,n,a){var i=e.getUTCDay(),o=(i-a.weekStartsOn+8)%7||7;switch(t){case"e":return String(o);case"ee":return gt(o,2);case"eo":return n.ordinalNumber(o,{unit:"day"});case"eee":return n.day(i,{width:"abbreviated",context:"formatting"});case"eeeee":return n.day(i,{width:"narrow",context:"formatting"});case"eeeeee":return n.day(i,{width:"short",context:"formatting"});case"eeee":default:return n.day(i,{width:"wide",context:"formatting"})}},c:function(e,t,n,a){var i=e.getUTCDay(),o=(i-a.weekStartsOn+8)%7||7;switch(t){case"c":return String(o);case"cc":return gt(o,t.length);case"co":return n.ordinalNumber(o,{unit:"day"});case"ccc":return n.day(i,{width:"abbreviated",context:"standalone"});case"ccccc":return n.day(i,{width:"narrow",context:"standalone"});case"cccccc":return n.day(i,{width:"short",context:"standalone"});case"cccc":default:return n.day(i,{width:"wide",context:"standalone"})}},i:function(e,t,n){var a=e.getUTCDay(),i=a===0?7:a;switch(t){case"i":return String(i);case"ii":return gt(i,t.length);case"io":return n.ordinalNumber(i,{unit:"day"});case"iii":return n.day(a,{width:"abbreviated",context:"formatting"});case"iiiii":return n.day(a,{width:"narrow",context:"formatting"});case"iiiiii":return n.day(a,{width:"short",context:"formatting"});case"iiii":default:return n.day(a,{width:"wide",context:"formatting"})}},a:function(e,t,n){var a=e.getUTCHours(),i=a/12>=1?"pm":"am";switch(t){case"a":case"aa":return n.dayPeriod(i,{width:"abbreviated",context:"formatting"});case"aaa":return n.dayPeriod(i,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return n.dayPeriod(i,{width:"narrow",context:"formatting"});case"aaaa":default:return n.dayPeriod(i,{width:"wide",context:"formatting"})}},b:function(e,t,n){var a=e.getUTCHours(),i;switch(a===12?i=un.noon:a===0?i=un.midnight:i=a/12>=1?"pm":"am",t){case"b":case"bb":return n.dayPeriod(i,{width:"abbreviated",context:"formatting"});case"bbb":return n.dayPeriod(i,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return n.dayPeriod(i,{width:"narrow",context:"formatting"});case"bbbb":default:return n.dayPeriod(i,{width:"wide",context:"formatting"})}},B:function(e,t,n){var a=e.getUTCHours(),i;switch(a>=17?i=un.evening:a>=12?i=un.afternoon:a>=4?i=un.morning:i=un.night,t){case"B":case"BB":case"BBB":return n.dayPeriod(i,{width:"abbreviated",context:"formatting"});case"BBBBB":return n.dayPeriod(i,{width:"narrow",context:"formatting"});case"BBBB":default:return n.dayPeriod(i,{width:"wide",context:"formatting"})}},h:function(e,t,n){if(t==="ho"){var a=e.getUTCHours()%12;return a===0&&(a=12),n.ordinalNumber(a,{unit:"hour"})}return ys.h(e,t)},H:function(e,t,n){return t==="Ho"?n.ordinalNumber(e.getUTCHours(),{unit:"hour"}):ys.H(e,t)},K:function(e,t,n){var a=e.getUTCHours()%12;return t==="Ko"?n.ordinalNumber(a,{unit:"hour"}):gt(a,t.length)},k:function(e,t,n){var a=e.getUTCHours();return a===0&&(a=24),t==="ko"?n.ordinalNumber(a,{unit:"hour"}):gt(a,t.length)},m:function(e,t,n){return t==="mo"?n.ordinalNumber(e.getUTCMinutes(),{unit:"minute"}):ys.m(e,t)},s:function(e,t,n){return t==="so"?n.ordinalNumber(e.getUTCSeconds(),{unit:"second"}):ys.s(e,t)},S:function(e,t){return ys.S(e,t)},X:function(e,t,n,a){var i=a._originalDate||e,o=i.getTimezoneOffset();if(o===0)return"Z";switch(t){case"X":return fh(o);case"XXXX":case"XX":return Ws(o);case"XXXXX":case"XXX":default:return Ws(o,":")}},x:function(e,t,n,a){var i=a._originalDate||e,o=i.getTimezoneOffset();switch(t){case"x":return fh(o);case"xxxx":case"xx":return Ws(o);case"xxxxx":case"xxx":default:return Ws(o,":")}},O:function(e,t,n,a){var i=a._originalDate||e,o=i.getTimezoneOffset();switch(t){case"O":case"OO":case"OOO":return"GMT"+xh(o,":");case"OOOO":default:return"GMT"+Ws(o,":")}},z:function(e,t,n,a){var i=a._originalDate||e,o=i.getTimezoneOffset();switch(t){case"z":case"zz":case"zzz":return"GMT"+xh(o,":");case"zzzz":default:return"GMT"+Ws(o,":")}},t:function(e,t,n,a){var i=a._originalDate||e,o=Math.floor(i.getTime()/1e3);return gt(o,t.length)},T:function(e,t,n,a){var i=a._originalDate||e,o=i.getTime();return gt(o,t.length)}};function xh(s,e){var t=s>0?"-":"+",n=Math.abs(s),a=Math.floor(n/60),i=n%60;if(i===0)return t+String(a);var o=e;return t+String(a)+o+gt(i,2)}function fh(s,e){if(s%60===0){var t=s>0?"-":"+";return t+gt(Math.abs(s)/60,2)}return Ws(s,e)}function Ws(s,e){var t=e||"",n=s>0?"-":"+",a=Math.abs(s),i=gt(Math.floor(a/60),2),o=gt(a%60,2);return n+i+t+o}var bh=function(e,t){switch(e){case"P":return t.date({width:"short"});case"PP":return t.date({width:"medium"});case"PPP":return t.date({width:"long"});case"PPPP":default:return t.date({width:"full"})}},j0=function(e,t){switch(e){case"p":return t.time({width:"short"});case"pp":return t.time({width:"medium"});case"ppp":return t.time({width:"long"});case"pppp":default:return t.time({width:"full"})}},xN=function(e,t){var n=e.match(/(P+)(p+)?/)||[],a=n[1],i=n[2];if(!i)return bh(e,t);var o;switch(a){case"P":o=t.dateTime({width:"short"});break;case"PP":o=t.dateTime({width:"medium"});break;case"PPP":o=t.dateTime({width:"long"});break;case"PPPP":default:o=t.dateTime({width:"full"});break}return o.replace("{{date}}",bh(a,t)).replace("{{time}}",j0(i,t))},fN={p:j0,P:xN},bN=["D","DD"],yN=["YY","YYYY"];function vN(s){return bN.indexOf(s)!==-1}function wN(s){return yN.indexOf(s)!==-1}function yh(s,e,t){if(s==="YYYY")throw new RangeError("Use `yyyy` instead of `YYYY` (in `".concat(e,"`) for formatting years to the input `").concat(t,"`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md"));if(s==="YY")throw new RangeError("Use `yy` instead of `YY` (in `".concat(e,"`) for formatting years to the input `").concat(t,"`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md"));if(s==="D")throw new RangeError("Use `d` instead of `D` (in `".concat(e,"`) for formatting days of the month to the input `").concat(t,"`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md"));if(s==="DD")throw new RangeError("Use `dd` instead of `DD` (in `".concat(e,"`) for formatting days of the month to the input `").concat(t,"`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md"))}var kN={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},NN=function(e,t,n){var a,i=kN[e];return typeof i=="string"?a=i:t===1?a=i.one:a=i.other.replace("{{count}}",t.toString()),n!=null&&n.addSuffix?n.comparison&&n.comparison>0?"in "+a:a+" ago":a};function _n(s){return function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=e.width?String(e.width):s.defaultWidth,n=s.formats[t]||s.formats[s.defaultWidth];return n}}var jN={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},_N={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},EN={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},IN={date:_n({formats:jN,defaultWidth:"full"}),time:_n({formats:_N,defaultWidth:"full"}),dateTime:_n({formats:EN,defaultWidth:"full"})},TN={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},SN=function(e,t,n,a){return TN[e]};function Pr(s){return function(e,t){var n=t!=null&&t.context?String(t.context):"standalone",a;if(n==="formatting"&&s.formattingValues){var i=s.defaultFormattingWidth||s.defaultWidth,o=t!=null&&t.width?String(t.width):i;a=s.formattingValues[o]||s.formattingValues[i]}else{var c=s.defaultWidth,d=t!=null&&t.width?String(t.width):s.defaultWidth;a=s.values[d]||s.values[c]}var h=s.argumentCallback?s.argumentCallback(e):e;return a[h]}}var AN={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},CN={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},DN={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},$N={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},RN={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},PN={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},MN=function(e,t){var n=Number(e),a=n%100;if(a>20||a<10)switch(a%10){case 1:return n+"st";case 2:return n+"nd";case 3:return n+"rd"}return n+"th"},ON={ordinalNumber:MN,era:Pr({values:AN,defaultWidth:"wide"}),quarter:Pr({values:CN,defaultWidth:"wide",argumentCallback:function(e){return e-1}}),month:Pr({values:DN,defaultWidth:"wide"}),day:Pr({values:$N,defaultWidth:"wide"}),dayPeriod:Pr({values:RN,defaultWidth:"wide",formattingValues:PN,defaultFormattingWidth:"wide"})};function Mr(s){return function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=t.width,a=n&&s.matchPatterns[n]||s.matchPatterns[s.defaultMatchWidth],i=e.match(a);if(!i)return null;var o=i[0],c=n&&s.parsePatterns[n]||s.parsePatterns[s.defaultParseWidth],d=Array.isArray(c)?LN(c,function(x){return x.test(o)}):VN(c,function(x){return x.test(o)}),h;h=s.valueCallback?s.valueCallback(d):d,h=t.valueCallback?t.valueCallback(h):h;var m=e.slice(o.length);return{value:h,rest:m}}}function VN(s,e){for(var t in s)if(s.hasOwnProperty(t)&&e(s[t]))return t}function LN(s,e){for(var t=0;t<s.length;t++)if(e(s[t]))return t}function _0(s){return function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=e.match(s.matchPattern);if(!n)return null;var a=n[0],i=e.match(s.parsePattern);if(!i)return null;var o=s.valueCallback?s.valueCallback(i[0]):i[0];o=t.valueCallback?t.valueCallback(o):o;var c=e.slice(a.length);return{value:o,rest:c}}}var FN=/^(\d+)(th|st|nd|rd)?/i,UN=/\d+/i,BN={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},qN={any:[/^b/i,/^(a|c)/i]},zN={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},WN={any:[/1/i,/2/i,/3/i,/4/i]},HN={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},GN={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},KN={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},YN={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},QN={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},XN={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},JN={ordinalNumber:_0({matchPattern:FN,parsePattern:UN,valueCallback:function(e){return parseInt(e,10)}}),era:Mr({matchPatterns:BN,defaultMatchWidth:"wide",parsePatterns:qN,defaultParseWidth:"any"}),quarter:Mr({matchPatterns:zN,defaultMatchWidth:"wide",parsePatterns:WN,defaultParseWidth:"any",valueCallback:function(e){return e+1}}),month:Mr({matchPatterns:HN,defaultMatchWidth:"wide",parsePatterns:GN,defaultParseWidth:"any"}),day:Mr({matchPatterns:KN,defaultMatchWidth:"wide",parsePatterns:YN,defaultParseWidth:"any"}),dayPeriod:Mr({matchPatterns:QN,defaultMatchWidth:"any",parsePatterns:XN,defaultParseWidth:"any"})},ZN={code:"en-US",formatDistance:NN,formatLong:IN,formatRelative:SN,localize:ON,match:JN,options:{weekStartsOn:0,firstWeekContainsDate:1}},e2=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,t2=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,r2=/^'([^]*?)'?$/,s2=/''/g,n2=/[a-zA-Z]/;function E0(s,e,t){var n,a,i,o,c,d,h,m,x,f,w,$,A,T,K,P,S,L;Et(2,arguments);var ee=String(e),D=Hn(),k=(n=(a=t==null?void 0:t.locale)!==null&&a!==void 0?a:D.locale)!==null&&n!==void 0?n:ZN,b=zr((i=(o=(c=(d=t==null?void 0:t.firstWeekContainsDate)!==null&&d!==void 0?d:t==null||(h=t.locale)===null||h===void 0||(m=h.options)===null||m===void 0?void 0:m.firstWeekContainsDate)!==null&&c!==void 0?c:D.firstWeekContainsDate)!==null&&o!==void 0?o:(x=D.locale)===null||x===void 0||(f=x.options)===null||f===void 0?void 0:f.firstWeekContainsDate)!==null&&i!==void 0?i:1);if(!(b>=1&&b<=7))throw new RangeError("firstWeekContainsDate must be between 1 and 7 inclusively");var v=zr((w=($=(A=(T=t==null?void 0:t.weekStartsOn)!==null&&T!==void 0?T:t==null||(K=t.locale)===null||K===void 0||(P=K.options)===null||P===void 0?void 0:P.weekStartsOn)!==null&&A!==void 0?A:D.weekStartsOn)!==null&&$!==void 0?$:(S=D.locale)===null||S===void 0||(L=S.options)===null||L===void 0?void 0:L.weekStartsOn)!==null&&w!==void 0?w:0);if(!(v>=0&&v<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");if(!k.localize)throw new RangeError("locale must contain localize property");if(!k.formatLong)throw new RangeError("locale must contain formatLong property");var j=Vt(s);if(!sN(j))throw new RangeError("Invalid time value");var N=eN(j),y=iN(j,N),p={firstWeekContainsDate:b,weekStartsOn:v,locale:k,_originalDate:j},te=ee.match(t2).map(function(ue){var le=ue[0];if(le==="p"||le==="P"){var H=fN[le];return H(ue,k.formatLong)}return ue}).join("").match(e2).map(function(ue){if(ue==="''")return"'";var le=ue[0];if(le==="'")return a2(ue);var H=pN[le];if(H)return!(t!=null&&t.useAdditionalWeekYearTokens)&&wN(ue)&&yh(ue,e,String(s)),!(t!=null&&t.useAdditionalDayOfYearTokens)&&vN(ue)&&yh(ue,e,String(s)),H(y,ue,k.localize,p);if(le.match(n2))throw new RangeError("Format string contains an unescaped latin alphabet character `"+le+"`");return ue}).join("");return te}function a2(s){var e=s.match(r2);return e?e[1].replace(s2,"'"):s}function i2(s,e){Et(2,arguments);var t=Vt(s),n=Vt(e);return t.getTime()<n.getTime()}function jr(s,e){var t;Et(1,arguments);var n=zr((t=void 0)!==null&&t!==void 0?t:2);if(n!==2&&n!==1&&n!==0)throw new RangeError("additionalDigits must be 0, 1 or 2");if(!(typeof s=="string"||Object.prototype.toString.call(s)==="[object String]"))return new Date(NaN);var a=d2(s),i;if(a.date){var o=u2(a.date,n);i=h2(o.restDateString,o.year)}if(!i||isNaN(i.getTime()))return new Date(NaN);var c=i.getTime(),d=0,h;if(a.time&&(d=m2(a.time),isNaN(d)))return new Date(NaN);if(a.timezone){if(h=g2(a.timezone),isNaN(h))return new Date(NaN)}else{var m=new Date(c+d),x=new Date(0);return x.setFullYear(m.getUTCFullYear(),m.getUTCMonth(),m.getUTCDate()),x.setHours(m.getUTCHours(),m.getUTCMinutes(),m.getUTCSeconds(),m.getUTCMilliseconds()),x}return new Date(c+d+h)}var gi={dateTimeDelimiter:/[T ]/,timeZoneDelimiter:/[Z ]/i,timezone:/([Z+-].*)$/},o2=/^-?(?:(\d{3})|(\d{2})(?:-?(\d{2}))?|W(\d{2})(?:-?(\d{1}))?|)$/,l2=/^(\d{2}(?:[.,]\d*)?)(?::?(\d{2}(?:[.,]\d*)?))?(?::?(\d{2}(?:[.,]\d*)?))?$/,c2=/^([+-])(\d{2})(?::?(\d{2}))?$/;function d2(s){var e={},t=s.split(gi.dateTimeDelimiter),n;if(t.length>2)return e;if(/:/.test(t[0])?n=t[0]:(e.date=t[0],n=t[1],gi.timeZoneDelimiter.test(e.date)&&(e.date=s.split(gi.timeZoneDelimiter)[0],n=s.substr(e.date.length,s.length))),n){var a=gi.timezone.exec(n);a?(e.time=n.replace(a[1],""),e.timezone=a[1]):e.time=n}return e}function u2(s,e){var t=new RegExp("^(?:(\\d{4}|[+-]\\d{"+(4+e)+"})|(\\d{2}|[+-]\\d{"+(2+e)+"})$)"),n=s.match(t);if(!n)return{year:NaN,restDateString:""};var a=n[1]?parseInt(n[1]):null,i=n[2]?parseInt(n[2]):null;return{year:i===null?a:i*100,restDateString:s.slice((n[1]||n[2]).length)}}function h2(s,e){if(e===null)return new Date(NaN);var t=s.match(o2);if(!t)return new Date(NaN);var n=!!t[4],a=na(t[1]),i=na(t[2])-1,o=na(t[3]),c=na(t[4]),d=na(t[5])-1;if(n)return y2(e,c,d)?p2(e,c,d):new Date(NaN);var h=new Date(0);return!f2(e,i,o)||!b2(e,a)?new Date(NaN):(h.setUTCFullYear(e,i,Math.max(a,o)),h)}function na(s){return s?parseInt(s):1}function m2(s){var e=s.match(l2);if(!e)return NaN;var t=ol(e[1]),n=ol(e[2]),a=ol(e[3]);return v2(t,n,a)?t*w0+n*v0+a*1e3:NaN}function ol(s){return s&&parseFloat(s.replace(",","."))||0}function g2(s){if(s==="Z")return 0;var e=s.match(c2);if(!e)return 0;var t=e[1]==="+"?-1:1,n=parseInt(e[2]),a=e[3]&&parseInt(e[3])||0;return w2(n,a)?t*(n*w0+a*v0):NaN}function p2(s,e,t){var n=new Date(0);n.setUTCFullYear(s,0,4);var a=n.getUTCDay()||7,i=(e-1)*7+t+1-a;return n.setUTCDate(n.getUTCDate()+i),n}var x2=[31,null,31,30,31,30,31,31,30,31,30,31];function I0(s){return s%400===0||s%4===0&&s%100!==0}function f2(s,e,t){return e>=0&&e<=11&&t>=1&&t<=(x2[e]||(I0(s)?29:28))}function b2(s,e){return e>=1&&e<=(I0(s)?366:365)}function y2(s,e,t){return e>=1&&e<=53&&t>=0&&t<=6}function v2(s,e,t){return s===24?e===0&&t===0:t>=0&&t<60&&e>=0&&e<60&&s>=0&&s<25}function w2(s,e){return e>=0&&e<=59}function vh(s,e,t){Et(2,arguments);var n=Vn(s,t),a=Vn(e,t);return n.getTime()===a.getTime()}function aa(s,e){if(s.one!==void 0&&e===1)return s.one;var t=e%10,n=e%100;return t===1&&n!==11?s.singularNominative.replace("{{count}}",String(e)):t>=2&&t<=4&&(n<10||n>20)?s.singularGenitive.replace("{{count}}",String(e)):s.pluralGenitive.replace("{{count}}",String(e))}function ir(s){return function(e,t){return t!=null&&t.addSuffix?t.comparison&&t.comparison>0?s.future?aa(s.future,e):"через "+aa(s.regular,e):s.past?aa(s.past,e):aa(s.regular,e)+" назад":aa(s.regular,e)}}var k2={lessThanXSeconds:ir({regular:{one:"меньше секунды",singularNominative:"меньше {{count}} секунды",singularGenitive:"меньше {{count}} секунд",pluralGenitive:"меньше {{count}} секунд"},future:{one:"меньше, чем через секунду",singularNominative:"меньше, чем через {{count}} секунду",singularGenitive:"меньше, чем через {{count}} секунды",pluralGenitive:"меньше, чем через {{count}} секунд"}}),xSeconds:ir({regular:{singularNominative:"{{count}} секунда",singularGenitive:"{{count}} секунды",pluralGenitive:"{{count}} секунд"},past:{singularNominative:"{{count}} секунду назад",singularGenitive:"{{count}} секунды назад",pluralGenitive:"{{count}} секунд назад"},future:{singularNominative:"через {{count}} секунду",singularGenitive:"через {{count}} секунды",pluralGenitive:"через {{count}} секунд"}}),halfAMinute:function(e,t){return t!=null&&t.addSuffix?t.comparison&&t.comparison>0?"через полминуты":"полминуты назад":"полминуты"},lessThanXMinutes:ir({regular:{one:"меньше минуты",singularNominative:"меньше {{count}} минуты",singularGenitive:"меньше {{count}} минут",pluralGenitive:"меньше {{count}} минут"},future:{one:"меньше, чем через минуту",singularNominative:"меньше, чем через {{count}} минуту",singularGenitive:"меньше, чем через {{count}} минуты",pluralGenitive:"меньше, чем через {{count}} минут"}}),xMinutes:ir({regular:{singularNominative:"{{count}} минута",singularGenitive:"{{count}} минуты",pluralGenitive:"{{count}} минут"},past:{singularNominative:"{{count}} минуту назад",singularGenitive:"{{count}} минуты назад",pluralGenitive:"{{count}} минут назад"},future:{singularNominative:"через {{count}} минуту",singularGenitive:"через {{count}} минуты",pluralGenitive:"через {{count}} минут"}}),aboutXHours:ir({regular:{singularNominative:"около {{count}} часа",singularGenitive:"около {{count}} часов",pluralGenitive:"около {{count}} часов"},future:{singularNominative:"приблизительно через {{count}} час",singularGenitive:"приблизительно через {{count}} часа",pluralGenitive:"приблизительно через {{count}} часов"}}),xHours:ir({regular:{singularNominative:"{{count}} час",singularGenitive:"{{count}} часа",pluralGenitive:"{{count}} часов"}}),xDays:ir({regular:{singularNominative:"{{count}} день",singularGenitive:"{{count}} дня",pluralGenitive:"{{count}} дней"}}),aboutXWeeks:ir({regular:{singularNominative:"около {{count}} недели",singularGenitive:"около {{count}} недель",pluralGenitive:"около {{count}} недель"},future:{singularNominative:"приблизительно через {{count}} неделю",singularGenitive:"приблизительно через {{count}} недели",pluralGenitive:"приблизительно через {{count}} недель"}}),xWeeks:ir({regular:{singularNominative:"{{count}} неделя",singularGenitive:"{{count}} недели",pluralGenitive:"{{count}} недель"}}),aboutXMonths:ir({regular:{singularNominative:"около {{count}} месяца",singularGenitive:"около {{count}} месяцев",pluralGenitive:"около {{count}} месяцев"},future:{singularNominative:"приблизительно через {{count}} месяц",singularGenitive:"приблизительно через {{count}} месяца",pluralGenitive:"приблизительно через {{count}} месяцев"}}),xMonths:ir({regular:{singularNominative:"{{count}} месяц",singularGenitive:"{{count}} месяца",pluralGenitive:"{{count}} месяцев"}}),aboutXYears:ir({regular:{singularNominative:"около {{count}} года",singularGenitive:"около {{count}} лет",pluralGenitive:"около {{count}} лет"},future:{singularNominative:"приблизительно через {{count}} год",singularGenitive:"приблизительно через {{count}} года",pluralGenitive:"приблизительно через {{count}} лет"}}),xYears:ir({regular:{singularNominative:"{{count}} год",singularGenitive:"{{count}} года",pluralGenitive:"{{count}} лет"}}),overXYears:ir({regular:{singularNominative:"больше {{count}} года",singularGenitive:"больше {{count}} лет",pluralGenitive:"больше {{count}} лет"},future:{singularNominative:"больше, чем через {{count}} год",singularGenitive:"больше, чем через {{count}} года",pluralGenitive:"больше, чем через {{count}} лет"}}),almostXYears:ir({regular:{singularNominative:"почти {{count}} год",singularGenitive:"почти {{count}} года",pluralGenitive:"почти {{count}} лет"},future:{singularNominative:"почти через {{count}} год",singularGenitive:"почти через {{count}} года",pluralGenitive:"почти через {{count}} лет"}})},N2=function(e,t,n){return k2[e](t,n)},j2={full:"EEEE, d MMMM y 'г.'",long:"d MMMM y 'г.'",medium:"d MMM y 'г.'",short:"dd.MM.y"},_2={full:"H:mm:ss zzzz",long:"H:mm:ss z",medium:"H:mm:ss",short:"H:mm"},E2={any:"{{date}}, {{time}}"},I2={date:_n({formats:j2,defaultWidth:"full"}),time:_n({formats:_2,defaultWidth:"full"}),dateTime:_n({formats:E2,defaultWidth:"any"})},Zc=["воскресенье","понедельник","вторник","среду","четверг","пятницу","субботу"];function T2(s){var e=Zc[s];switch(s){case 0:return"'в прошлое "+e+" в' p";case 1:case 2:case 4:return"'в прошлый "+e+" в' p";case 3:case 5:case 6:return"'в прошлую "+e+" в' p"}}function wh(s){var e=Zc[s];return s===2?"'во "+e+" в' p":"'в "+e+" в' p"}function S2(s){var e=Zc[s];switch(s){case 0:return"'в следующее "+e+" в' p";case 1:case 2:case 4:return"'в следующий "+e+" в' p";case 3:case 5:case 6:return"'в следующую "+e+" в' p"}}var A2={lastWeek:function(e,t,n){var a=e.getUTCDay();return vh(e,t,n)?wh(a):T2(a)},yesterday:"'вчера в' p",today:"'сегодня в' p",tomorrow:"'завтра в' p",nextWeek:function(e,t,n){var a=e.getUTCDay();return vh(e,t,n)?wh(a):S2(a)},other:"P"},C2=function(e,t,n,a){var i=A2[e];return typeof i=="function"?i(t,n,a):i},D2={narrow:["до н.э.","н.э."],abbreviated:["до н. э.","н. э."],wide:["до нашей эры","нашей эры"]},$2={narrow:["1","2","3","4"],abbreviated:["1-й кв.","2-й кв.","3-й кв.","4-й кв."],wide:["1-й квартал","2-й квартал","3-й квартал","4-й квартал"]},R2={narrow:["Я","Ф","М","А","М","И","И","А","С","О","Н","Д"],abbreviated:["янв.","фев.","март","апр.","май","июнь","июль","авг.","сент.","окт.","нояб.","дек."],wide:["январь","февраль","март","апрель","май","июнь","июль","август","сентябрь","октябрь","ноябрь","декабрь"]},P2={narrow:["Я","Ф","М","А","М","И","И","А","С","О","Н","Д"],abbreviated:["янв.","фев.","мар.","апр.","мая","июн.","июл.","авг.","сент.","окт.","нояб.","дек."],wide:["января","февраля","марта","апреля","мая","июня","июля","августа","сентября","октября","ноября","декабря"]},M2={narrow:["В","П","В","С","Ч","П","С"],short:["вс","пн","вт","ср","чт","пт","сб"],abbreviated:["вск","пнд","втр","срд","чтв","птн","суб"],wide:["воскресенье","понедельник","вторник","среда","четверг","пятница","суббота"]},O2={narrow:{am:"ДП",pm:"ПП",midnight:"полн.",noon:"полд.",morning:"утро",afternoon:"день",evening:"веч.",night:"ночь"},abbreviated:{am:"ДП",pm:"ПП",midnight:"полн.",noon:"полд.",morning:"утро",afternoon:"день",evening:"веч.",night:"ночь"},wide:{am:"ДП",pm:"ПП",midnight:"полночь",noon:"полдень",morning:"утро",afternoon:"день",evening:"вечер",night:"ночь"}},V2={narrow:{am:"ДП",pm:"ПП",midnight:"полн.",noon:"полд.",morning:"утра",afternoon:"дня",evening:"веч.",night:"ночи"},abbreviated:{am:"ДП",pm:"ПП",midnight:"полн.",noon:"полд.",morning:"утра",afternoon:"дня",evening:"веч.",night:"ночи"},wide:{am:"ДП",pm:"ПП",midnight:"полночь",noon:"полдень",morning:"утра",afternoon:"дня",evening:"вечера",night:"ночи"}},L2=function(e,t){var n=Number(e),a=t==null?void 0:t.unit,i;return a==="date"?i="-е":a==="week"||a==="minute"||a==="second"?i="-я":i="-й",n+i},F2={ordinalNumber:L2,era:Pr({values:D2,defaultWidth:"wide"}),quarter:Pr({values:$2,defaultWidth:"wide",argumentCallback:function(e){return e-1}}),month:Pr({values:R2,defaultWidth:"wide",formattingValues:P2,defaultFormattingWidth:"wide"}),day:Pr({values:M2,defaultWidth:"wide"}),dayPeriod:Pr({values:O2,defaultWidth:"any",formattingValues:V2,defaultFormattingWidth:"wide"})},U2=/^(\d+)(-?(е|я|й|ое|ье|ая|ья|ый|ой|ий|ый))?/i,B2=/\d+/i,q2={narrow:/^((до )?н\.?\s?э\.?)/i,abbreviated:/^((до )?н\.?\s?э\.?)/i,wide:/^(до нашей эры|нашей эры|наша эра)/i},z2={any:[/^д/i,/^н/i]},W2={narrow:/^[1234]/i,abbreviated:/^[1234](-?[ыои]?й?)? кв.?/i,wide:/^[1234](-?[ыои]?й?)? квартал/i},H2={any:[/1/i,/2/i,/3/i,/4/i]},G2={narrow:/^[яфмаисонд]/i,abbreviated:/^(янв|фев|март?|апр|ма[йя]|июн[ья]?|июл[ья]?|авг|сент?|окт|нояб?|дек)\.?/i,wide:/^(январ[ья]|феврал[ья]|марта?|апрел[ья]|ма[йя]|июн[ья]|июл[ья]|августа?|сентябр[ья]|октябр[ья]|октябр[ья]|ноябр[ья]|декабр[ья])/i},K2={narrow:[/^я/i,/^ф/i,/^м/i,/^а/i,/^м/i,/^и/i,/^и/i,/^а/i,/^с/i,/^о/i,/^н/i,/^я/i],any:[/^я/i,/^ф/i,/^мар/i,/^ап/i,/^ма[йя]/i,/^июн/i,/^июл/i,/^ав/i,/^с/i,/^о/i,/^н/i,/^д/i]},Y2={narrow:/^[впсч]/i,short:/^(вс|во|пн|по|вт|ср|чт|че|пт|пя|сб|су)\.?/i,abbreviated:/^(вск|вос|пнд|пон|втр|вто|срд|сре|чтв|чет|птн|пят|суб).?/i,wide:/^(воскресень[ея]|понедельника?|вторника?|сред[аы]|четверга?|пятниц[аы]|суббот[аы])/i},Q2={narrow:[/^в/i,/^п/i,/^в/i,/^с/i,/^ч/i,/^п/i,/^с/i],any:[/^в[ос]/i,/^п[он]/i,/^в/i,/^ср/i,/^ч/i,/^п[ят]/i,/^с[уб]/i]},X2={narrow:/^([дп]п|полн\.?|полд\.?|утр[оа]|день|дня|веч\.?|ноч[ьи])/i,abbreviated:/^([дп]п|полн\.?|полд\.?|утр[оа]|день|дня|веч\.?|ноч[ьи])/i,wide:/^([дп]п|полночь|полдень|утр[оа]|день|дня|вечера?|ноч[ьи])/i},J2={any:{am:/^дп/i,pm:/^пп/i,midnight:/^полн/i,noon:/^полд/i,morning:/^у/i,afternoon:/^д[ен]/i,evening:/^в/i,night:/^н/i}},Z2={ordinalNumber:_0({matchPattern:U2,parsePattern:B2,valueCallback:function(e){return parseInt(e,10)}}),era:Mr({matchPatterns:q2,defaultMatchWidth:"wide",parsePatterns:z2,defaultParseWidth:"any"}),quarter:Mr({matchPatterns:W2,defaultMatchWidth:"wide",parsePatterns:H2,defaultParseWidth:"any",valueCallback:function(e){return e+1}}),month:Mr({matchPatterns:G2,defaultMatchWidth:"wide",parsePatterns:K2,defaultParseWidth:"any"}),day:Mr({matchPatterns:Y2,defaultMatchWidth:"wide",parsePatterns:Q2,defaultParseWidth:"any"}),dayPeriod:Mr({matchPatterns:X2,defaultMatchWidth:"wide",parsePatterns:J2,defaultParseWidth:"any"})},ej={code:"ru",formatDistance:N2,formatLong:I2,formatRelative:C2,localize:F2,match:Z2,options:{weekStartsOn:1,firstWeekContainsDate:1}};const ie=(s,e="dd.MM.yyyy")=>{try{const t=typeof s=="string"?jr(s):s;return!t||Number.isNaN(t.getTime())?"":E0(t,e,{locale:ej})}catch{return""}},Gn=(s=new Date)=>{const e=Zk(s,{weekStartsOn:1}),t=aN(s,{weekStartsOn:1});return{start:e,end:t}},ed=(s=new Date)=>{const{start:e,end:t}=Gn(s);return nN({start:e,end:t})},Xi=s=>{const e=new Date,t=new Date(e);t.setHours(0,0,0,0),t.setDate(t.getDate()-(s-1));const n=new Date(e);return n.setHours(23,59,59,999),{start:t,end:n}},T0=(s,e)=>{const t=typeof s=="string"?jr(s):s,n=typeof e=="string"?jr(e):e;return tN(t,n)},To=s=>s.reduce((e,t)=>{const[n,a]=t.start.split(":").map(Number),[i,o]=t.end.split(":").map(Number),c=n*60+a;let h=(i*60+o-c)/60;if(h<0&&(h+=24),t.breaks&&t.breaks.length>0){const m=t.breaks.reduce((x,f)=>{const[w,$]=f.start.split(":").map(Number),[A,T]=f.end.split(":").map(Number),K=w*60+$;let S=(A*60+T-K)/60;return S<0&&(S+=24),x+S},0);h-=m}return e+h},0),hr=s=>{const[e,t]=s.split(":").map(Number);return e*60+t},Ji=(s,e)=>{if(!s||!e)return[];const t=jr(s),n=jr(e);if(i2(n,t))return[];const a=[],i=new Date(t);for(;i<=n;)a.push(ie(i,"yyyy-MM-dd")),i.setDate(i.getDate()+1);return a},S0=s=>{const e=Array.from(new Set(s.filter(Boolean)));return e.sort(),e},pi=(s,e)=>{const t=hr(s.start),n=hr(s.end),a=hr(e.start),i=hr(e.end),o=s.endDate||n<=t,c=e.endDate||i<=a;if(!o&&!c)return t<i&&n>a;const d=24*60,h=o?n+d:n,m=c?i+d:i;return t<m&&h>a},Er=()=>{const s=new Date,e=3*60,t=s.getTimezoneOffset();return new Date(s.getTime()+(e+t)*60*1e3)},kh=(s,e=Er())=>{const t=e.getHours(),n=new Date(`${E0(e,"yyyy-MM-dd")}T${s}:00`);return t>=21||e>n},tj=s=>{const e=Math.floor(s),t=Math.round((s-e)*60);return e===0&&t===0?"0ч":e===0?`${t}м`:t===0?`${e}ч`:`${e}ч ${t}м`},or=(s,e,t,n)=>{const a=s,i=e||s;if(i<t||a>n)return 0;const o=a>t?a:t,c=i<n?i:n,d=jr(o),m=jr(c).getTime()-d.getTime();return Math.floor(m/(1e3*60*60*24))+1},rj=30,Nh=s=>s.toString().padStart(2,"0"),sj=()=>{const s=new Date;return s.setDate(s.getDate()-rj),{dateOnly:`${s.getFullYear()} -${Nh(s.getMonth()+1)} -${Nh(s.getDate())} `,iso:s.toISOString()}},xi=async(s,e,t)=>{const n=mt(Ae,s),a=at(n,Tt(e,"<",t)),i=await Gt(a);await Promise.all(i.docs.map(o=>kr(xt(Ae,s,o.id))))},nj=async()=>{try{const{dateOnly:s,iso:e}=sj();await Promise.all([xi("workSlots","date",s),xi("dayStatuses","date",s),xi("earnings","date",s),xi("referrals","createdAt",e)])}catch(s){console.error("Failed to cleanup old data",s)}},wr=async(s,e)=>{const t=mt(Ae,"workSlots");let n;s&&e||s?n=at(t,Tt("userId","==",s)):e?n=at(t,Tt("date","==",e)):n=at(t);let i=(await Gt(n)).docs.map(o=>{const c=o.data(),d=((c==null?void 0:c.slots)||[]).map(h=>h.break&&!h.breaks?{...h,breaks:[h.break],break:void 0}:h);return{id:o.id,userId:(c==null?void 0:c.userId)||"",date:(c==null?void 0:c.date)||"",slots:d,participants:(c==null?void 0:c.participants)||[],...(c==null?void 0:c.comment)&&{comment:c.comment}}});return s&&e&&(i=i.filter(o=>o.date===e)),i.sort((o,c)=>o.date.localeCompare(c.date)),i},A0=async s=>{try{console.log("addWorkSlot: Starting, db initialized:",!!Ae);const e=mt(Ae,"workSlots");console.log("addWorkSlot: Collection reference created");const t=Object.fromEntries(Object.entries(s).filter(([a,i])=>i!==void 0));console.log("addWorkSlot: Clean slot prepared:",t),console.log("addWorkSlot: Calling addDoc...");const n=await fr(e,t);return console.log("addWorkSlot: Work slot added successfully:",n.id),n}catch(e){throw console.error("addWorkSlot: Error caught:",e),console.error("addWorkSlot: Error code:",e==null?void 0:e.code),console.error("addWorkSlot: Error message:",e==null?void 0:e.message),console.error("addWorkSlot: Full error:",JSON.stringify(e,null,2)),e}},C0=async(s,e)=>{const t=xt(Ae,"workSlots",s),n=Object.fromEntries(Object.entries(e).filter(([a,i])=>i!==void 0));await dr(t,n)},So=async s=>{const e=xt(Ae,"workSlots",s);await kr(e)},is=async(s,e)=>{const t=mt(Ae,"dayStatuses");let n;s?n=at(t,Tt("userId","==",s)):n=at(t);let i=(await Gt(n)).docs.map(o=>{const c=o.data();return{id:o.id,userId:(c==null?void 0:c.userId)||"",date:(c==null?void 0:c.date)||"",type:(c==null?void 0:c.type)||"dayoff",...(c==null?void 0:c.comment)&&{comment:c.comment},...(c==null?void 0:c.endDate)&&{endDate:c.endDate}}});return i.sort((o,c)=>o.date.localeCompare(c.date)),i},Ao=async s=>{try{const e=mt(Ae,"dayStatuses"),t=Object.fromEntries(Object.entries(s).filter(([a,i])=>i!==void 0));console.log("Adding day status:",t);const n=await fr(e,t);return console.log("Day status added successfully:",n.id),n}catch(e){throw console.error("Error in addDayStatus:",e),e}},$s=async(s,e)=>{const t=xt(Ae,"dayStatuses",s),n=Object.fromEntries(Object.entries(e).filter(([a,i])=>i!==void 0));await dr(t,n)},Co=async s=>{const e=xt(Ae,"dayStatuses",s);await kr(e)},Wl=async s=>{const e=mt(Ae,"restrictions");let t;s!==void 0?t=at(e,Tt("isActive","==",s)):t=at(e);const a=(await Gt(t)).docs.map(i=>{const o=i.data();return{id:i.id,type:(o==null?void 0:o.type)||"all",startDate:(o==null?void 0:o.startDate)||"",endDate:o==null?void 0:o.endDate,startTime:o==null?void 0:o.startTime,blockFutureDates:(o==null?void 0:o.blockFutureDates)||!1,comment:o==null?void 0:o.comment,createdBy:(o==null?void 0:o.createdBy)||"",createdAt:(o==null?void 0:o.createdAt)||"",isActive:(o==null?void 0:o.isActive)??!0}});return a.sort((i,o)=>i.startDate.localeCompare(o.startDate)),a},aj=async s=>{try{const e=mt(Ae,"restrictions"),t=Object.fromEntries(Object.entries(s).filter(([a,i])=>i!==void 0));return await fr(e,t)}catch(e){throw console.error("Error adding restriction:",e),e}},ij=async(s,e)=>{const t=xt(Ae,"restrictions",s),n=Object.fromEntries(Object.entries(e).filter(([a,i])=>i!==void 0));await dr(t,n)},oj=async s=>{const e=xt(Ae,"restrictions",s);await kr(e)},Zi=async(s,e,t)=>{try{const n=await Wl(!0),a=new Date;for(const i of n){if(i.type!=="all"&&i.type!==s)continue;const o=new Date(e),c=new Date(`${i.startDate}${i.startTime?`T${i.startTime}`:""} `);if(i.blockFutureDates&&a>=c){const m=new Date(i.startDate),x=new Date(m);if(x.setDate(m.getDate()+1),o.toDateString()===x.toDateString())return{restricted:!0,restriction:i,reason:`После ${ie(c,"dd.MM.yyyy")}${i.startTime?` ${i.startTime}`:""} запрещено создавать ${ll(s)} на следующий день ${ie(x,"dd.MM.yyyy")} `}}const d=new Date(i.startDate);let h=!1;if(i.endDate){const m=new Date(i.endDate);h=o>=d&&o<=m}else h=o.getTime()===d.getTime();if(h){if(!i.startTime)return{restricted:!0,restriction:i,reason:`Запрещено создавать ${ll(s)} на ${ie(o,"dd.MM.yyyy")} `};if(t&&i.startTime){const m=t,x=i.startTime;if(m>=x)return{restricted:!0,restriction:i,reason:`Запрещено создавать ${ll(s)} после ${x} на ${ie(o,"dd.MM.yyyy")} `}}}}return{restricted:!1}}catch(n){return console.error("Error checking restrictions:",n),{restricted:!1}}},ll=s=>({slots:"слоты",dayoff:"выходные",sick:"больничные",vacation:"отпуска",absence:"прогулы",all:"любые записи"})[s],Do="approvalRequests",td=s=>{const e=s.data(),t=new Date().toISOString();return{id:s.id,entity:(e==null?void 0:e.entity)||"slot",action:(e==null?void 0:e.action)||"create",status:(e==null?void 0:e.status)||"pending",authorId:(e==null?void 0:e.authorId)||"",targetUserId:(e==null?void 0:e.targetUserId)||"",before:(e==null?void 0:e.before)??null,after:(e==null?void 0:e.after)??null,comment:e==null?void 0:e.comment,adminComment:e==null?void 0:e.adminComment,reviewedBy:e==null?void 0:e.reviewedBy,createdAt:(e==null?void 0:e.createdAt)||t,updatedAt:(e==null?void 0:e.updatedAt)||(e==null?void 0:e.createdAt)||t}},lj=async s=>{const e=s.before,t=s.after;switch(s.action){case"create":{if(!t)throw new Error("No slot payload for creation");const{id:n,...a}=t;await A0(a);return}case"update":{const n=(t==null?void 0:t.id)||(e==null?void 0:e.id);if(!n||!t)throw new Error("No slot payload for update");const{id:a,...i}=t;await C0(n,i);return}case"delete":{if(!(e!=null&&e.id))throw new Error("No slot id for delete");await So(e.id);return}default:return}},cj=async s=>{const e=s.before,t=s.after;switch(s.action){case"create":{if(!t)throw new Error("No status payload for creation");const{id:n,...a}=t;await Ao(a);return}case"update":{const n=(t==null?void 0:t.id)||(e==null?void 0:e.id);if(!n||!t)throw new Error("No status payload for update");const{id:a,...i}=t;await $s(n,i);return}case"delete":{if(!(e!=null&&e.id))throw new Error("No status id for delete");await Co(e.id);return}default:return}},dj=async s=>{const e=s.before,t=s.after;switch(s.action){case"create":{if(!t)throw new Error("No earning payload for creation");const{id:n,...a}=t;await $0(a);return}case"update":{const n=(t==null?void 0:t.id)||(e==null?void 0:e.id);if(!n||!t)throw new Error("No earning payload for update");const{id:a,...i}=t;await R0(n,i);return}case"delete":{if(!(e!=null&&e.id))throw new Error("No earning id for delete");await P0(e.id);return}default:return}},uj=async s=>{const e=s.before,t=s.after;switch(s.action){case"create":{if(!t)throw new Error("No referral payload for creation");const{id:n,...a}=t;await O0(a);return}case"update":{const n=(t==null?void 0:t.id)||(e==null?void 0:e.id);if(!n||!t)throw new Error("No referral payload for update");const{id:a,...i}=t;await L0(n,i);return}case"delete":{if(!(e!=null&&e.id))throw new Error("No referral id for delete");await rd(e.id);return}default:return}},hj=async s=>{const e=s.after;switch(s.action){case"update":{if(!e||!e.nickname)throw new Error("No nickname payload for update");await Nj(s.targetUserId,e.nickname);return}case"delete":{await jj(s.targetUserId);return}default:return}},Nt=async s=>{const e=mt(Ae,Do),t=new Date().toISOString(),n={...s,status:"pending",createdAt:t,updatedAt:t},a=Object.fromEntries(Object.entries(n).filter(([,o])=>o!==void 0));return await fr(e,a)},D0=async(s,e,t)=>{const n=mt(Ae,Do);let a;a=at(n);let o=(await Gt(a)).docs.map(td);return o.sort((c,d)=>d.createdAt.localeCompare(c.createdAt)),o},jh=async(s,e,t)=>{const n=xt(Ae,Do,s),a=await Og(n);if(!a.exists())return;const i=td(a);if(i.status!=="pending")return;i.entity==="slot"?await lj(i):i.entity==="status"?await cj(i):i.entity==="earning"?await dj(i):i.entity==="referral"?await uj(i):i.entity==="login"&&(await hj(i),zl(i.targetUserId),await as(i.targetUserId));const o={status:"approved",reviewedBy:e,updatedAt:new Date().toISOString()},c=i.adminComment;c!==void 0&&(o.adminComment=c),await dr(n,o)},_h=async(s,e,t)=>{const n=xt(Ae,Do,s),a=await Og(n);!a.exists()||td(a).status!=="pending"||await dr(n,{status:"rejected",adminComment:t,reviewedBy:e,updatedAt:new Date().toISOString()})},Ca=async(s,e,t)=>{const n=mt(Ae,"earnings");let a;s?a=at(n):e&&t?a=at(n,Tt("date",">=",e),Tt("date","<=",t)):a=at(n);let o=(await Gt(a)).docs.map(c=>{const d=c.data();return{id:c.id,userId:(d==null?void 0:d.userId)||"",date:(d==null?void 0:d.date)||"",amount:(d==null?void 0:d.amount)||0,poolAmount:(d==null?void 0:d.poolAmount)||0,slotId:(d==null?void 0:d.slotId)||"",extraWalletsCount:(d==null?void 0:d.extraWalletsCount)||0,extraWalletsAmount:(d==null?void 0:d.extraWalletsAmount)||0,category:(d==null?void 0:d.category)||"other",participants:(d==null?void 0:d.participants)||[]}});return s&&(o=o.filter(c=>(c.participants&&c.participants.length>0?[...c.participants,c.userId]:[c.userId]).includes(s))),s&&e&&t?o=o.filter(c=>c.date>=e&&c.date<=t):!s&&e&&t&&(o=o.filter(c=>c.date>=e&&c.date<=t)),o.sort((c,d)=>d.date.localeCompare(c.date)),o},$0=async s=>{try{const e=mt(Ae,"earnings"),t=Object.fromEntries(Object.entries(s).filter(([a,i])=>i!==void 0));console.log("Adding earnings:",t);const n=await fr(e,t);return console.log("Earnings added successfully:",n.id),n}catch(e){throw console.error("Error in addEarnings:",e),e}},R0=async(s,e)=>{const t=xt(Ae,"earnings",s),n=Object.fromEntries(Object.entries(e).filter(([a,i])=>i!==void 0));await dr(t,n)},P0=async s=>{const e=xt(Ae,"earnings",s);await kr(e)},M0=async s=>{const e=mt(Ae,"ratings");let t=at(e);return s&&(t=at(t,Tt("userId","==",s))),(await Gt(t)).docs.map(a=>{const i=a.data();return{id:a.id,userId:i.userId||"",earnings:i.earnings||0,messages:i.messages||0,initiatives:i.initiatives||0,signals:i.signals||0,profitableSignals:i.profitableSignals||0,referrals:i.referrals||0,daysOff:i.daysOff||0,sickDays:i.sickDays||0,vacationDays:i.vacationDays||0,absenceDays:i.absenceDays||0,poolAmount:i.poolAmount||0,rating:i.rating||0,lastUpdated:i.lastUpdated||new Date().toISOString()}})},O0=async s=>{try{const e=mt(Ae,"referrals"),t=Object.fromEntries(Object.entries(s).filter(([a,i])=>i!==void 0));console.log("Adding referral:",t);const n=await fr(e,t);return console.log("Referral added successfully:",n.id),n}catch(e){throw console.error("Error in addReferral:",e),e}},V0=async(s,e,t)=>{const n=mt(Ae,"referrals");let a;a=at(n,Vs("createdAt","desc"));let o=(await Gt(a)).docs.map(c=>{const d=c.data();return{id:c.id,referralId:d.referralId,ownerId:d.ownerId,name:d.name,age:d.age,createdAt:d.createdAt,comment:d.comment}});return e&&t&&(o=o.filter(c=>c.createdAt>=e&&c.createdAt<=t)),o.sort((c,d)=>c.createdAt<d.createdAt?1:-1)},L0=async(s,e)=>{const t=xt(Ae,"referrals",s),n=Object.fromEntries(Object.entries(e).filter(([a,i])=>i!==void 0));await dr(t,n)},rd=async s=>{const e=xt(Ae,"referrals",s);await kr(e)},mj=async s=>{if(console.log("📝 Service site: Creating call:",{category:s.category,userId:s.userId,status:s.status,createdAt:s.createdAt}),!Ae)throw console.error("❌ Service site: Firestore db is not initialized"),new Error("Firestore database is not initialized");const e=mt(Ae,"calls"),t=await fr(e,s);return console.log("✅ Service site: Call created successfully with ID:",t.id),console.log("📊 Service site: Call data saved to Firestore:",s),t.id},gj=async s=>{const e=mt(Ae,"calls"),t=[];t.push(Vs("createdAt","desc"));let n;return t.length>0?n=at(e,...t):n=at(e,Vs("createdAt","desc")),(await Gt(n)).docs.map(o=>{var w,$,A,T,K,P,S,L;const c=o.data(),d=c.category||"memecoins",h=!c.details&&c.ticker?{memecoins:{coinName:c.pair||c.ticker,ticker:c.ticker||"",network:c.network||"solana",contract:c.contract,signalType:c.sentiment||"buy",reason:c.comment||c.risks||"",entryCap:c.entryPoint||"",targets:c.target||"",stopLoss:c.cancelConditions,riskLevel:c.riskLevel||"medium",risks:c.risks||"",holdPlan:"short",liquidityLocked:!1,traderComment:c.comment}}:{},m=c.details||h||{},x=c.riskLevel||((w=m.memecoins)==null?void 0:w.riskLevel)||(($=m.polymarket)==null?void 0:$.riskLevel)||((A=m.staking)==null?void 0:A.protocolRisk)||((T=m.spot)==null?void 0:T.riskLevel)||((K=m.futures)==null?void 0:K.riskLevel),f=c.sentiment||((P=m.memecoins)==null?void 0:P.signalType)||(((S=m.futures)==null?void 0:S.direction)==="long"?"buy":((L=m.futures)==null?void 0:L.direction)==="short"?"sell":void 0);return{id:o.id,userId:c.userId||"",category:d,details:m,sentiment:f,riskLevel:x,comment:c.comment,createdAt:c.createdAt||new Date().toISOString(),status:c.status||"active",maxProfit:c.maxProfit,currentPnL:c.currentPnL,currentMarketCap:c.currentMarketCap,signalMarketCap:c.signalMarketCap,currentPrice:c.currentPrice,entryPrice:c.entryPrice,tags:c.tags||[]}})},F0=async(s,e)=>{const t=xt(Ae,"calls",s);await dr(t,e)},pj=async s=>{const e=xt(Ae,"calls",s);await kr(e)},xj=async s=>{const e=mt(Ae,"tasks");return(await fr(e,s)).id},sd=async s=>{const e=mt(Ae,"tasks"),t=[];s!=null&&s.status&&t.push(Tt("status","==",s.status)),s!=null&&s.category&&t.push(Tt("category","==",s.category)),s!=null&&s.createdBy&&t.push(Tt("createdBy","==",s.createdBy)),t.push(Vs("createdAt","desc"));let n;t.length>0?n=at(e,...t):n=at(e,Vs("createdAt","desc"));const a=await Gt(n),i=f=>f==="high"||f==="low"||f==="urgent"?f:"medium",o=f=>f==="completed"||f==="closed"?f:"in_progress",c=(f=[])=>f.filter(w=>w==null?void 0:w.userId).slice(0,10).map(w=>({userId:w.userId,priority:i(w.priority),comment:w.comment,instruction:w.instruction}));let d=a.docs.map(f=>{const w=f.data(),A=((Array.isArray(w.assignees)?w.assignees:(w.assignedTo||[]).map(S=>({userId:S,priority:"medium"})))||[]).map(S=>({userId:S.userId||"",priority:i(S.priority),comment:S.comment})).filter(S=>!!S.userId),T=A.map(S=>S.userId),K=Array.isArray(w.coExecutors)?w.coExecutors:Array.isArray(w.executors)?w.executors:[],P=(w.stages||[]).map(S=>({id:S.id||`stage - ${Date.now()} `,name:S.name||"Этап",description:S.description,responsible:S.responsible==="all"?"all":Array.isArray(S.responsible)?S.responsible:(S.assignees||[]).map(L=>L.userId),assignees:c(S.assignees),stagePriority:i(S.stagePriority),requiresApproval:S.requiresApproval??!0,approvals:S.approvals||[],comments:S.comments||[],status:S.status||"pending"}));return{id:f.id,title:w.title||"",description:w.description,category:w.category||"trading",status:o(w.status),createdBy:w.createdBy||"",assignedTo:T,assignees:A,approvals:w.approvals||[],createdAt:w.createdAt||new Date().toISOString(),updatedAt:w.updatedAt||new Date().toISOString(),completedAt:w.completedAt,closedAt:w.closedAt,completedBy:w.completedBy,priority:i(w.priority),dueDate:w.dueDate||new Date().toISOString().split("T")[0],dueTime:w.dueTime||"12:00",startTime:w.startTime,mainExecutor:w.mainExecutor,leadExecutor:w.leadExecutor,deputies:w.deputies||[],coExecutors:K,executors:w.executors||[],curators:w.curators||[],leads:w.leads||[],stages:P,currentStageId:w.currentStageId,awaitingStageId:w.awaitingStageId,comments:w.comments||[],expectedResult:w.expectedResult,requiresApproval:w.requiresApproval??!0}});const h=new Date,m=new Date(h.getTime()-12*60*60*1e3),x=d.filter(f=>f.status==="closed"&&f.closedAt?new Date(f.closedAt)<m:!1);if(x.length>0&&(await Promise.all(x.map(f=>U0(f.id))),d=d.filter(f=>!x.find(w=>w.id===f.id))),s!=null&&s.assignedTo)if(Array.isArray(s.assignedTo)){const f=s.assignedTo;f.length>0&&(d=d.filter(w=>f.some($=>w.assignedTo.includes($))))}else d=d.filter(f=>f.assignedTo.includes(s.assignedTo));return d},Jr=async(s,e)=>{const t=xt(Ae,"tasks",s),n=Object.fromEntries(Object.entries({...e,updatedAt:new Date().toISOString()}).filter(([a,i])=>i!==void 0));await dr(t,n)},U0=async s=>{const e=xt(Ae,"tasks",s);await kr(e)},Eh=async(s,e=!1)=>{const t=mt(Ae,"notes");let n;!e&&s?n=at(t,Tt("userId","==",s)):n=at(t);const i=(await Gt(n)).docs.map(o=>{const c=o.data();return{id:o.id,userId:c.userId||"",title:c.title||"",text:c.text||"",priority:c.priority==="low"||c.priority==="high"?c.priority:"medium",createdAt:c.createdAt||new Date().toISOString(),updatedAt:c.updatedAt||new Date().toISOString()}});return i.sort((o,c)=>(c.updatedAt||"").localeCompare(o.updatedAt||"")),s&&!e?i.filter(o=>o.userId===s):i},fj=async s=>{const e=mt(Ae,"notes"),t={...s,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};return(await fr(e,t)).id},bj=async(s,e)=>{const t=xt(Ae,"notes",s),n=Object.fromEntries(Object.entries({...e,updatedAt:new Date().toISOString()}).filter(([a,i])=>i!==void 0));await dr(t,n)},yj=async s=>{const e=xt(Ae,"notes",s);await kr(e)},vj=async()=>{const s=mt(Ae,"userActivities"),e=at(s,Vs("loginAt","desc")),n=(await Gt(e)).docs.map(i=>{const o=i.data();return{id:i.id,userId:o.userId||"",loginAt:o.loginAt||new Date().toISOString(),logoutAt:o.logoutAt||void 0,browser:o.browser||"Unknown",userAgent:o.userAgent||"",sessionDuration:o.sessionDuration||void 0,isActive:o.isActive!==!1,pageViews:o.pageViews||[]}}),a=new Map;for(const i of n){const o=a.get(i.userId);(!o||new Date(i.loginAt)>new Date(o.loginAt))&&a.set(i.userId,i)}return Array.from(a.values())},wj=async s=>{const e=mt(Ae,"userActivities");return(await fr(e,s)).id},Hl=async(s,e)=>{const t=xt(Ae,"userActivities",s),n=Object.fromEntries(Object.entries(e).filter(([a,i])=>i!==void 0));await dr(t,n)},cl=async(s,e,t)=>{await Hl(s,{logoutAt:e,sessionDuration:t,isActive:!1})},$o=async s=>{const e=mt(Ae,"userNicknames"),t=at(e,Tt("userId","==",s)),n=await Gt(t);if(n.empty)return null;const a=n.docs[0].data();return{id:n.docs[0].id,userId:a.userId||"",nickname:a.nickname||"",createdAt:a.createdAt||new Date().toISOString(),updatedAt:a.updatedAt||new Date().toISOString()}},kj=async s=>{const e=await $o(s);return(e==null?void 0:e.nickname)||null},Nj=async(s,e)=>{const t=mt(Ae,"userNicknames"),n=await $o(s),a=new Date().toISOString();if(n){const i=xt(Ae,"userNicknames",n.id);return await dr(i,{nickname:e,updatedAt:a}),n.id}else return(await fr(t,{userId:s,nickname:e,createdAt:a,updatedAt:a})).id},jj=async s=>{const e=await $o(s);e&&await kr(xt(Ae,"userNicknames",e.id))},_j=async()=>{const s=mt(Ae,"userActivities"),e=new Date,t=new Date(e.getTime()-24*60*60*1e3),n=at(s,Vs("loginAt","desc"));return(await Gt(n)).docs.map(o=>{const c=o.data();return{id:o.id,userId:c.userId||"",loginAt:c.loginAt||new Date().toISOString(),logoutAt:c.logoutAt||void 0,browser:c.browser||"Unknown",userAgent:c.userAgent||"",sessionDuration:c.sessionDuration||void 0,isActive:c.isActive!==!1,pageViews:c.pageViews||[]}}).filter(o=>new Date(o.loginAt)>=t)},B0=async(s,e)=>{const t=mt(Ae,"userConflicts");let n;return s&&e!==void 0?n=at(t,Tt("isActive","==",e),Tt("userId","==",s)):s?n=at(t,Tt("userId","==",s)):e!==void 0?n=at(t,Tt("isActive","==",e)):n=at(t),(await Gt(n)).docs.map(i=>{const o=i.data();return{id:i.id,userId:(o==null?void 0:o.userId)||"",restrictedUserId:(o==null?void 0:o.restrictedUserId)||"",reason:(o==null?void 0:o.reason)||"",createdBy:(o==null?void 0:o.createdBy)||"",createdAt:(o==null?void 0:o.createdAt)||"",isActive:(o==null?void 0:o.isActive)??!0}})},Ej=async s=>{const e=mt(Ae,"userConflicts");return await fr(e,s)},Ih=async(s,e)=>{const t=xt(Ae,"userConflicts",s);await dr(t,e)},Ij=async s=>{const e=xt(Ae,"userConflicts",s);await kr(e)},Gl=async(s,e)=>{const t=mt(Ae,"accessBlocks");let n;return s&&e!==void 0?n=at(t,Tt("isActive","==",e),Tt("userId","==",s)):s?n=at(t,Tt("userId","==",s)):e!==void 0?n=at(t,Tt("isActive","==",e)):n=at(t),(await Gt(n)).docs.map(i=>{const o=i.data();return{id:i.id,userId:o==null?void 0:o.userId,reason:(o==null?void 0:o.reason)||"",createdBy:(o==null?void 0:o.createdBy)||"",createdAt:(o==null?void 0:o.createdAt)||"",expiresAt:o==null?void 0:o.expiresAt,isActive:(o==null?void 0:o.isActive)??!0,blockFeatures:(o==null?void 0:o.blockFeatures)||[]}})},Tj=async s=>{const e=mt(Ae,"accessBlocks");return await fr(e,s)},eo=async(s,e)=>{const t=xt(Ae,"accessBlocks",s);await dr(t,e)},Sj=async s=>{const e=xt(Ae,"accessBlocks",s);await kr(e)},nd=async(s,e)=>{try{const t=await Gl(void 0,!0);for(const a of t)if(!a.userId&&a.blockFeatures.includes("all")||a.blockFeatures.includes(e)){if(a.expiresAt&&new Date(a.expiresAt)<new Date){await eo(a.id,{isActive:!1});continue}return{hasAccess:!1,reason:a.reason,expiresAt:a.expiresAt}}const n=await Gl(s,!0);for(const a of n)if(a.blockFeatures.includes("all")||a.blockFeatures.includes(e)){if(a.expiresAt&&new Date(a.expiresAt)<new Date){await eo(a.id,{isActive:!1});continue}return{hasAccess:!1,reason:a.reason,expiresAt:a.expiresAt}}return{hasAccess:!0,reason:void 0,expiresAt:void 0}}catch(t){return console.error("Error checking user access:",t),{hasAccess:!0,reason:void 0,expiresAt:void 0}}},Aj=async()=>{const s=mt(Ae,"aiAlerts"),e=at(s,Vs("createdAt","desc"));return(await Gt(e)).docs.map(n=>({id:n.id,...n.data()}))},Cj=async s=>{const e=mt(Ae,"aiAlerts"),t=Object.fromEntries(Object.entries(s).filter(([a,i])=>i!==void 0));return await fr(e,t)},Dj=async(s,e)=>{const t=xt(Ae,"aiAlerts",s),n=Object.fromEntries(Object.entries(e).filter(([a,i])=>i!==void 0));await dr(t,n)},$j=async s=>{const e=xt(Ae,"aiAlerts",s);await kr(e)},Th=[{value:"solana",label:"Solana"},{value:"ethereum",label:"ETH"},{value:"bsc",label:"BSC"},{value:"ton",label:"TON"},{value:"base",label:"Base"},{value:"sui",label:"SUI"},{value:"monad",label:"Monad"},{value:"polygon",label:"Polygon"}],hn={memecoins:{label:"Мемкоины",gradient:"from-emerald-300 to-teal-400",icon:r.jsx(Pa,{className:"w-5 h-5"}),pastelBg:"bg-emerald-50",pastelBorder:"border-emerald-100",pastelText:"text-emerald-800"},futures:{label:"Фьючерсы",gradient:"from-sky-300 to-indigo-400",icon:r.jsx(io,{className:"w-5 h-5"}),pastelBg:"bg-sky-50",pastelBorder:"border-sky-100",pastelText:"text-sky-800"},nft:{label:"NFT",gradient:"from-purple-300 to-pink-300",icon:r.jsx(ao,{className:"w-5 h-5"}),pastelBg:"bg-purple-50",pastelBorder:"border-purple-100",pastelText:"text-purple-800"},spot:{label:"Спот",gradient:"from-amber-300 to-orange-300",icon:r.jsx(lr,{className:"w-5 h-5"}),pastelBg:"bg-amber-50",pastelBorder:"border-amber-100",pastelText:"text-amber-800"},polymarket:{label:"Polymarket",gradient:"from-rose-300 to-red-300",icon:r.jsx(er,{className:"w-5 h-5"}),pastelBg:"bg-rose-50",pastelBorder:"border-rose-100",pastelText:"text-rose-800"},staking:{label:"Стейкинг",gradient:"from-cyan-300 to-blue-300",icon:r.jsx(At,{className:"w-5 h-5"}),pastelBg:"bg-cyan-50",pastelBorder:"border-cyan-100",pastelText:"text-cyan-800"}},Rj={memecoins:{basic:{title:"Основная информация",icon:r.jsx(Tr,{className:"w-4 h-4"}),description:"Базовые данные о монете"},entry:{title:"Зоны входа",icon:r.jsx(mr,{className:"w-4 h-4"}),description:"Условия для входа в позицию"},targets:{title:"Цели и риски",icon:r.jsx(qt,{className:"w-4 h-4"}),description:"План прибыли и управления рисками"},additional:{title:"Дополнительно",icon:r.jsx(vs,{className:"w-4 h-4"}),description:"Дополнительные настройки и комментарии"}},futures:{basic:{title:"Основная информация",icon:r.jsx(Tr,{className:"w-4 h-4"}),description:"Данные о паре и направлении"},entry:{title:"Зоны входа",icon:r.jsx(mr,{className:"w-4 h-4"}),description:"Условия входа и размер позиции"},targets:{title:"Цели и риски",icon:r.jsx(qt,{className:"w-4 h-4"}),description:"План прибыли и стоп-лоссы"},strategy:{title:"Стратегия",icon:r.jsx(er,{className:"w-4 h-4"}),description:"Тип сигнала и анализ"},additional:{title:"Дополнительно",icon:r.jsx(vs,{className:"w-4 h-4"}),description:"Комментарии и детали"}},nft:{basic:{title:"Основная информация",icon:r.jsx(Tr,{className:"w-4 h-4"}),description:"Данные о NFT и коллекции"},entry:{title:"Условия входа",icon:r.jsx(mr,{className:"w-4 h-4"}),description:"Цена и условия покупки"},targets:{title:"Цели и риски",icon:r.jsx(qt,{className:"w-4 h-4"}),description:"План продажи и риски"},additional:{title:"Дополнительно",icon:r.jsx(vs,{className:"w-4 h-4"}),description:"Анализ и комментарии"}},spot:{basic:{title:"Основная информация",icon:r.jsx(Tr,{className:"w-4 h-4"}),description:"Данные о монете"},entry:{title:"Зоны входа",icon:r.jsx(mr,{className:"w-4 h-4"}),description:"Условия входа в позицию"},targets:{title:"Цели и риски",icon:r.jsx(qt,{className:"w-4 h-4"}),description:"План прибыли и стоп-лоссы"},additional:{title:"Дополнительно",icon:r.jsx(vs,{className:"w-4 h-4"}),description:"Анализ и комментарии"}},polymarket:{basic:{title:"Основная информация",icon:r.jsx(Tr,{className:"w-4 h-4"}),description:"Данные о событии"},entry:{title:"Условия входа",icon:r.jsx(mr,{className:"w-4 h-4"}),description:"Позиция и цена входа"},targets:{title:"Цели и риски",icon:r.jsx(qt,{className:"w-4 h-4"}),description:"План прибыли и риски"},additional:{title:"Дополнительно",icon:r.jsx(vs,{className:"w-4 h-4"}),description:"Анализ и детали"}},staking:{basic:{title:"Основная информация",icon:r.jsx(Tr,{className:"w-4 h-4"}),description:"Данные о стейкинге"},entry:{title:"Условия входа",icon:r.jsx(mr,{className:"w-4 h-4"}),description:"Платформа и условия"},targets:{title:"Риски и анализ",icon:r.jsx(Ut,{className:"w-4 h-4"}),description:"Оценка рисков"},additional:{title:"Дополнительно",icon:r.jsx(vs,{className:"w-4 h-4"}),description:"Комментарии и детали"}}},Sh={memecoins:[{key:"coinName",label:"Название монеты",placeholder:"PEPE",section:"basic"},{key:"ticker",label:"Тикер",placeholder:"PEPE",section:"basic"},{key:"network",label:"Сеть",type:"select",options:Th,section:"basic"},{key:"contract",label:"Контракт",placeholder:"0x...",section:"basic"},{key:"signalType",label:"Тип сигнала",type:"select",options:[{value:"buy",label:"Buy"},{value:"sell",label:"Sell"},{value:"hold",label:"Hold"},{value:"alert",label:"Alert"}],section:"basic"},{key:"reason",label:"Причина входа",placeholder:"Хайп, крупные покупки, листинг...",type:"textarea",section:"entry"},{key:"entryCap",label:"Зона входа в капитализации",placeholder:"10M-15M",section:"entry"},{key:"targets",label:"Цели (TP1/TP2/TP3)",placeholder:"20M / 30M / 50M",section:"targets"},{key:"stopLoss",label:"Стоп-лосс",placeholder:"5M или -25%",section:"targets"},{key:"riskLevel",label:"Риск-уровень",type:"select",options:[{value:"low",label:"Низкий"},{value:"medium",label:"Средний"},{value:"high",label:"Высокий"},{value:"ultra",label:"Ультра-высокий"}],section:"targets"},{key:"risks",label:"Риски",placeholder:"Разворот тренда, низкая ликвидность",type:"textarea",section:"targets"},{key:"holdPlan",label:"План удержания",type:"select",options:[{value:"flip",label:"Флип"},{value:"short",label:"Краткосрок"},{value:"medium",label:"Среднесрок"},{value:"long",label:"Дальнесрок"}],section:"additional"},{key:"liquidityLocked",label:"Залочена ли ликвидность",type:"checkbox",section:"additional"},{key:"traderComment",label:"Комментарий трейдера",type:"textarea",placeholder:"Доп. наблюдения, планы",section:"additional"}],futures:[{key:"pair",label:"Пара",placeholder:"BTC/USDT",section:"basic"},{key:"direction",label:"Направление",type:"select",options:[{value:"long",label:"Long"},{value:"short",label:"Short"}],section:"basic"},{key:"leverage",label:"Рекомендованное плечо",placeholder:"x3 - x10",section:"entry"},{key:"entryPrice",label:"Цена входа",placeholder:"69500",section:"entry"},{key:"entryZone",label:"Зоны входа (min-max)",placeholder:"69000 - 70000",section:"entry"},{key:"positionSize",label:"Размер позиции (% от депо)",placeholder:"2-5%",section:"entry"},{key:"targets",label:"Цели (TP1/TP2/TP3)",placeholder:"71000 / 72500 / 74000",section:"targets"},{key:"stopLoss",label:"SL уровень",placeholder:"68000",section:"targets"},{key:"riskLevel",label:"Риск-уровень",type:"select",options:[{value:"low",label:"Низкий"},{value:"medium",label:"Средний"},{value:"high",label:"Высокий"},{value:"ultra",label:"Ультра-высокий"}],section:"targets"},{key:"signalStyle",label:"Тип сигнала",type:"select",options:[{value:"breakout",label:"Breakout"},{value:"retest",label:"Retest"},{value:"range",label:"Range"},{value:"scalping",label:"Scalping"},{value:"swing",label:"Swing"}],section:"strategy"},{key:"timeframe",label:"Таймфрейм анализа",type:"select",options:[{value:"1m",label:"1m"},{value:"5m",label:"5m"},{value:"15m",label:"15m"},{value:"1h",label:"1h"},{value:"4h",label:"4h"}],section:"strategy"},{key:"reason",label:"Причина входа (анализ)",placeholder:"Тренд, объемы, дивергенция...",type:"textarea",section:"strategy"},{key:"risks",label:"Риски",placeholder:"Резкий вброс, низкая волатильность",type:"textarea",section:"additional"}],nft:[{key:"collectionLink",label:"Коллекция (ссылка)",placeholder:"https://...",section:"basic"},{key:"nftLink",label:"NFT (ссылка)",placeholder:"https://.../item",section:"basic"},{key:"marketplace",label:"Маркетплейс",placeholder:"OpenSea / Magic Eden",section:"basic"},{key:"network",label:"Сеть",type:"select",options:Th,section:"basic"},{key:"entryPrice",label:"Рекомендованная цена входа",placeholder:"1.2 ETH",section:"entry"},{key:"rarity",label:"Редкость / атрибуты",placeholder:"Rank < 5%",section:"entry"},{key:"minLiquidity",label:"Минимальная ликвидность",placeholder:"Floor 2 ETH, объём 120 ETH",section:"entry"},{key:"signalType",label:"Тип сигнала",type:"select",options:[{value:"buy",label:"Buy"},{value:"sell",label:"Sell"},{value:"mint",label:"Mint"}],section:"entry"},{key:"holdingHorizon",label:"Срок удержания",type:"select",options:[{value:"flip",label:"Скоростной флип"},{value:"short",label:"Краткосрок"},{value:"medium",label:"Среднесрок"},{value:"long",label:"Долгосрок"}],section:"targets"},{key:"targetPrice",label:"Цель продажи / Target price",placeholder:"3 ETH",section:"targets"},{key:"risks",label:"Риски",placeholder:"Падение спроса, фальшивый объём",type:"textarea",section:"targets"},{key:"reason",label:"Причина входа",placeholder:"Минт, хайп, инсайд",type:"textarea",section:"additional"},{key:"traderComment",label:"Комментарий трейдера",type:"textarea",placeholder:"Что смотрим, когда фиксируем",section:"additional"}],spot:[{key:"coin",label:"Монета",placeholder:"BTC",section:"basic"},{key:"entryCap",label:"Капитализация входа",placeholder:"500M",section:"entry"},{key:"positionSize",label:"Размер позиции",placeholder:"5-10% портфеля",section:"entry"},{key:"targets",label:"Цели (TP1/TP2/TP3)",placeholder:"550M / 650M / 750M",section:"targets"},{key:"stopLoss",label:"SL",placeholder:"-10%",section:"targets"},{key:"holdingHorizon",label:"Горизонт удержания",type:"select",options:[{value:"short",label:"Краткосрок"},{value:"medium",label:"Среднесрок"},{value:"long",label:"Долгосрок"}],section:"targets"},{key:"riskLevel",label:"Риск-уровень",type:"select",options:[{value:"low",label:"Низкий"},{value:"medium",label:"Средний"},{value:"high",label:"Высокий"},{value:"ultra",label:"Ультра-высокий"}],section:"targets"},{key:"reason",label:"Причина входа",placeholder:"Фундаментал, хайп",type:"textarea",section:"additional"},{key:"risks",label:"Риски",placeholder:"Регуляторика, конкуренты",type:"textarea",section:"additional"},{key:"traderComment",label:"Комментарий",type:"textarea",placeholder:"Условия фиксации, обновления",section:"additional"}],polymarket:[{key:"event",label:"Событие",placeholder:"Trump wins 2025",section:"basic"},{key:"eventDeadline",label:"Срок исхода события",placeholder:"31.12.2025",section:"basic"},{key:"positionType",label:"Тип позиции",type:"select",options:[{value:"yes",label:"Yes"},{value:"no",label:"No"}],section:"entry"},{key:"entryPrice",label:"Цена входа (%)",placeholder:"42%",section:"entry"},{key:"expectedProbability",label:"Ожидаемая вероятность (%)",placeholder:"65%",section:"entry"},{key:"maxStake",label:"Максимальный объём ставки",placeholder:"до $5k",section:"entry"},{key:"targetPlan",label:"Цель",placeholder:"Продажа до события или удержание",section:"targets"},{key:"riskLevel",label:"Риск",type:"select",options:[{value:"low",label:"Низкий"},{value:"medium",label:"Средний"},{value:"high",label:"Высокий"},{value:"ultra",label:"Ультра-высокий"}],section:"targets"},{key:"risks",label:"Риски",placeholder:"Неопределённость новостей, низкая ликвидность",type:"textarea",section:"targets"},{key:"reason",label:"Причина входа",placeholder:"Аналитика, инсайд",type:"textarea",section:"additional"}],staking:[{key:"coin",label:"Монета",placeholder:"SOL",section:"basic"},{key:"platform",label:"Платформа",placeholder:"Jito, Lido...",section:"entry"},{key:"term",label:"Срок стейкинга",type:"select",options:[{value:"flexible",label:"Гибкий"},{value:"30d",label:"30 дней"},{value:"90d",label:"90 дней"},{value:"fixed",label:"Фиксированный"}],section:"entry"},{key:"apy",label:"APY",placeholder:"12-18%",section:"entry"},{key:"minDeposit",label:"Минимальный депозит",placeholder:"100 USDT",section:"entry"},{key:"action",label:"Тип сигнала",type:"select",options:[{value:"enter",label:"Вход"},{value:"exit",label:"Выход"},{value:"rebalance",label:"Перераспределение"}],section:"entry"},{key:"protocolRisk",label:"Риски протокола",type:"select",options:[{value:"low",label:"Низкие"},{value:"medium",label:"Средние"},{value:"high",label:"Высокие"},{value:"ultra",label:"Ультра"}],section:"targets"},{key:"risks",label:"Риски",placeholder:"Смарт-контракт, ликвидность",type:"textarea",section:"targets"},{key:"reason",label:"Причина",placeholder:"Рост доходности",type:"textarea",section:"additional"},{key:"traderComment",label:"Комментарий трейдера",type:"textarea",placeholder:"Тактика выхода, дополнительные условия",section:"additional"}]},Ah=()=>({memecoins:{coinName:"",ticker:"",network:"solana",contract:"",signalType:"buy",reason:"",entryCap:"",targets:"",stopLoss:"",riskLevel:"medium",risks:"",holdPlan:"short",liquidityLocked:!1,traderComment:""},futures:{pair:"",direction:"long",leverage:"",entryPrice:"",entryZone:"",targets:"",stopLoss:"",signalStyle:"breakout",positionSize:"",reason:"",timeframe:"1h",risks:"",riskLevel:"medium"},nft:{collectionLink:"",nftLink:"",marketplace:"",network:"ethereum",entryPrice:"",rarity:"",signalType:"buy",reason:"",holdingHorizon:"short",minLiquidity:"",targetPrice:"",traderComment:"",risks:""},spot:{coin:"",entryCap:"",targets:"",stopLoss:"",holdingHorizon:"medium",reason:"",positionSize:"",risks:"",traderComment:"",riskLevel:"medium"},polymarket:{event:"",positionType:"yes",entryPrice:"",expectedProbability:"",reason:"",eventDeadline:"",riskLevel:"medium",maxStake:"",risks:"",targetPlan:""},staking:{coin:"",platform:"",term:"flexible",apy:"",minDeposit:"",protocolRisk:"medium",action:"enter",reason:"",risks:"",traderComment:""}}),Ch=(s,e)=>({memecoins:{...s.memecoins,...(e==null?void 0:e.memecoins)||{}},futures:{...s.futures,...(e==null?void 0:e.futures)||{}},nft:{...s.nft,...(e==null?void 0:e.nft)||{}},spot:{...s.spot,...(e==null?void 0:e.spot)||{}},polymarket:{...s.polymarket,...(e==null?void 0:e.polymarket)||{}},staking:{...s.staking,...(e==null?void 0:e.staking)||{}}}),Pj=({onSuccess:s,onCancel:e,callToEdit:t,initialCategory:n})=>{const{theme:a}=it(),{user:i}=bt(),[o,c]=E.useState(!1),[d,h]=E.useState(""),[m,x]=E.useState(!1),f=Ch(Ah(),t==null?void 0:t.details),[w,$]=E.useState((t==null?void 0:t.category)||n||"memecoins"),[A,T]=E.useState((t==null?void 0:t.comment)||""),[K,P]=E.useState(f);E.useEffect(()=>{const I=Ch(Ah(),t==null?void 0:t.details);P(I),$((t==null?void 0:t.category)||n||"memecoins"),T((t==null?void 0:t.comment)||"")},[t,n]);const S=a==="dark"?"text-white":"text-gray-900",L=a==="dark"?"border-gray-800":"border-gray-200",ee=a==="dark"?"bg-gray-700/60":"bg-gray-50",D=a==="dark"?"text-gray-400":"text-gray-500",k=D,b=a==="dark"?"bg-[#121212]":"bg-white",v=(I,R)=>{P(O=>({...O,[w]:{...O[w],[I]:R}}))},j=I=>(I==null?void 0:I.riskLevel)||(I==null?void 0:I.protocolRisk)||void 0,N=I=>{if(I!=null&&I.signalType)return I.signalType;if((I==null?void 0:I.direction)==="long")return"buy";if((I==null?void 0:I.direction)==="short")return"sell"},p=(()=>{const R=Sh[w].filter(J=>J.required),O=K[w]||{};let U=0;return R.forEach(J=>{const C=O[J.key];C!=null&&C!==""&&U++}),{filled:U,total:R.length,percentage:R.length>0?Math.round(U/R.length*100):100}})(),te={low:"bg-emerald-500/10 text-emerald-600 border border-emerald-500/20",medium:"bg-blue-500/10 text-blue-600 border border-blue-500/20",high:"bg-amber-500/10 text-amber-600 border border-amber-500/20",ultra:"bg-red-500/10 text-red-600 border border-red-500/20"},ue={memecoins:{bg:a==="dark"?"bg-emerald-500/10":"bg-emerald-50",text:a==="dark"?"text-emerald-100":"text-emerald-800",border:a==="dark"?"border-emerald-500/30":"border-emerald-200",chipBg:a==="dark"?"bg-emerald-500/20":"bg-emerald-500/10"},futures:{bg:a==="dark"?"bg-sky-500/10":"bg-sky-50",text:a==="dark"?"text-sky-100":"text-sky-800",border:a==="dark"?"border-sky-500/30":"border-sky-200",chipBg:a==="dark"?"bg-sky-500/20":"bg-sky-500/10"},nft:{bg:a==="dark"?"bg-purple-500/10":"bg-purple-50",text:a==="dark"?"text-purple-100":"text-purple-800",border:a==="dark"?"border-purple-500/30":"border-purple-200",chipBg:a==="dark"?"bg-purple-500/20":"bg-purple-500/10"},spot:{bg:a==="dark"?"bg-amber-500/10":"bg-amber-50",text:a==="dark"?"text-amber-100":"text-amber-800",border:a==="dark"?"border-amber-500/30":"border-amber-200",chipBg:a==="dark"?"bg-amber-500/20":"bg-amber-500/10"},polymarket:{bg:a==="dark"?"bg-rose-500/10":"bg-rose-50",text:a==="dark"?"text-rose-100":"text-rose-800",border:a==="dark"?"border-rose-500/30":"border-rose-200",chipBg:a==="dark"?"bg-rose-500/20":"bg-rose-500/10"},staking:{bg:a==="dark"?"bg-cyan-500/10":"bg-cyan-50",text:a==="dark"?"text-cyan-100":"text-cyan-800",border:a==="dark"?"border-cyan-500/30":"border-cyan-200",chipBg:a==="dark"?"bg-cyan-500/20":"bg-cyan-500/10"}},le=I=>{var R;return((R=I.details)==null?void 0:R[I.category])||{}},H=I=>{const R=le(I);switch(I.category){case"memecoins":return R.coinName||R.ticker||"Мемкоин";case"futures":return R.pair||"Фьючерс";case"nft":return R.collectionLink||"NFT коллекция";case"spot":return R.coin||"Спот";case"polymarket":return R.event||"Polymarket событие";case"staking":return R.coin||"Стейкинг";default:return"Сигнал"}},ne=I=>{const R=le(I);switch(I.category){case"memecoins":return`${R.ticker||""} ${R.network?`• ${String(R.network).toUpperCase()}`:""}`.trim();case"futures":return`${R.direction==="long"?"Long":"Short"} • ${R.timeframe||""}`;case"nft":return`${R.marketplace||""}${R.network?` • ${String(R.network).toUpperCase()}`:""}`;case"spot":return R.holdingHorizon?`Горизонт: ${R.holdingHorizon}`:"";case"polymarket":return`${R.positionType==="yes"?"YES":"NO"} • ${R.entryPrice||""}`;case"staking":return`${R.platform||""}${R.term?` • ${R.term}`:""}`;default:return""}},ce=I=>I.riskLevel||le(I).riskLevel||le(I).protocolRisk||"medium",B=(I,R=28)=>{if(!I)return"";if(I.length<=R)return I;const O=I.slice(0,Math.floor(R/2)),U=I.slice(-6);return`${O}...${U}`},pe=I=>{const R=le(I),O=ce(I),U=ue[I.category],J=[],C=(ae,V,Z)=>{V&&J.push({label:ae,value:V,icon:Z})};switch(I.category){case"memecoins":C("Монета",R.coinName,r.jsx(lr,{className:"w-4 h-4"})),C("Тикер",B(R.ticker,8),r.jsx(Jh,{className:"w-4 h-4"})),C("Сеть",R.network?String(R.network).toUpperCase():"",r.jsx(Xh,{className:"w-4 h-4"})),C("Тип сигнала",R.signalType?R.signalType.toUpperCase():"",r.jsx(vn,{className:"w-4 h-4"})),C("Зона входа",R.entryCap,r.jsx(mr,{className:"w-4 h-4"})),C("Цели",R.targets,r.jsx(er,{className:"w-4 h-4"})),C("SL",R.stopLoss,r.jsx(yn,{className:"w-4 h-4"})),C("План",R.holdPlan,r.jsx(Ss,{className:"w-4 h-4"})),C("Ликвидность",R.liquidityLocked?"Залочена":"",r.jsx(At,{className:"w-4 h-4"}));break;case"futures":C("Пара",R.pair,r.jsx(Xl,{className:"w-4 h-4"})),C("Направление",R.direction?R.direction.toUpperCase():"",r.jsx(qt,{className:"w-4 h-4"})),C("Плечо",R.leverage,r.jsx(Ks,{className:"w-4 h-4"})),C("Зона входа",R.entryZone||R.entryPrice,r.jsx(mr,{className:"w-4 h-4"})),C("Цели",R.targets,r.jsx(er,{className:"w-4 h-4"})),C("SL",R.stopLoss,r.jsx(yn,{className:"w-4 h-4"})),C("Стиль",R.signalStyle,r.jsx(vn,{className:"w-4 h-4"})),C("Размер позиции",R.positionSize,r.jsx(_s,{className:"w-4 h-4"})),C("Таймфрейм",R.timeframe,r.jsx(rc,{className:"w-4 h-4"}));break;case"nft":C("Коллекция",R.collectionLink,r.jsx(gl,{className:"w-4 h-4"})),C("Маркетплейс",R.marketplace,r.jsx(Ti,{className:"w-4 h-4"})),C("Сеть",R.network?String(R.network).toUpperCase():"",r.jsx(em,{className:"w-4 h-4"})),C("Вход",R.entryPrice,r.jsx(mr,{className:"w-4 h-4"})),C("Редкость",R.rarity,r.jsx(pr,{className:"w-4 h-4"})),C("Тип сигнала",R.signalType?R.signalType.toUpperCase():"",r.jsx(vn,{className:"w-4 h-4"})),C("Срок удержания",R.holdingHorizon,r.jsx(Ss,{className:"w-4 h-4"})),C("Мин. ликвидность",R.minLiquidity,r.jsx(Ks,{className:"w-4 h-4"})),C("Target",R.targetPrice,r.jsx(er,{className:"w-4 h-4"}));break;case"spot":C("Монета",R.coin,r.jsx(lr,{className:"w-4 h-4"})),C("Зона входа",R.entryCap,r.jsx(mr,{className:"w-4 h-4"})),C("Цели",R.targets,r.jsx(er,{className:"w-4 h-4"})),C("SL",R.stopLoss,r.jsx(yn,{className:"w-4 h-4"})),C("Горизонт",R.holdingHorizon,r.jsx(Ss,{className:"w-4 h-4"})),C("Размер",R.positionSize,r.jsx(_s,{className:"w-4 h-4"}));break;case"polymarket":C("Событие",R.event,r.jsx(Xr,{className:"w-4 h-4"})),C("Тип",R.positionType?R.positionType.toUpperCase():"",r.jsx(At,{className:"w-4 h-4"})),C("Вход %",R.entryPrice,r.jsx(_s,{className:"w-4 h-4"})),C("Ожидание %",R.expectedProbability,r.jsx(Ks,{className:"w-4 h-4"})),C("Цель",R.targetPlan,r.jsx(er,{className:"w-4 h-4"})),C("Макс ставка",R.maxStake,r.jsx(lr,{className:"w-4 h-4"}));break;case"staking":C("Монета",R.coin,r.jsx(lr,{className:"w-4 h-4"})),C("Платформа",R.platform,r.jsx(Ti,{className:"w-4 h-4"})),C("Срок",R.term,r.jsx(Si,{className:"w-4 h-4"})),C("APY",R.apy,r.jsx(_s,{className:"w-4 h-4"})),C("Мин. депозит",R.minDeposit,r.jsx(lr,{className:"w-4 h-4"})),C("Тип сигнала",R.action,r.jsx(At,{className:"w-4 h-4"}));break}const oe=J.filter(ae=>ae.value);return oe.length?r.jsxs("div",{className:`rounded-2xl border ${L} ${a==="dark"?"bg-gray-900/60":"bg-white"}`,children:[r.jsxs("div",{className:`flex items-center gap-2 px-4 py-3 border-b ${L} ${a==="dark"?"bg-white/5":"bg-gray-50"}`,children:[r.jsx(pr,{className:"w-4 h-4 text-amber-500"}),r.jsx("p",{className:`text-sm font-semibold ${S}`,children:"Ключевые метрики"}),r.jsxs("span",{className:`ml-auto text-[11px] font-semibold px-3 py-1 rounded-full ${te[O]}`,children:["Риск: ",O]})]}),r.jsx("div",{className:"divide-y divide-gray-200/70 dark:divide-white/10",children:oe.map(ae=>r.jsx("div",{className:"flex items-center justify-between gap-3 px-4 py-3",children:r.jsxs("div",{className:"flex items-start gap-3",children:[r.jsx("div",{className:`p-2 rounded-xl border ${U.border} ${U.bg} ${U.text}`,children:ae.icon}),r.jsxs("div",{className:"flex-1 min-w-0",children:[r.jsx("p",{className:`text-xs uppercase tracking-wide ${k}`,children:ae.label}),r.jsx("p",{className:`${S} font-semibold whitespace-pre-wrap break-words`,children:ae.value})]})]})},ae.label))})]}):null},F=()=>{const I=K[w],R={[w]:I},O=N(I),U=j(I);return{id:"preview",userId:(i==null?void 0:i.id)||"unknown",category:w,details:R,createdAt:new Date().toISOString(),status:"active",tags:[],sentiment:O,riskLevel:U,comment:A}},q=()=>{x(!0)},M=async I=>{I.preventDefault(),h(""),c(!0);try{const R=K[w],O={...t==null?void 0:t.details,[w]:R},J={userId:(t==null?void 0:t.userId)||(i==null?void 0:i.id)||"unknown",category:w,details:O,createdAt:(t==null?void 0:t.createdAt)||new Date().toISOString(),status:(t==null?void 0:t.status)||"active",tags:(t==null?void 0:t.tags)||[]},C=A==null?void 0:A.trim();C&&(J.comment=C);const oe=N(R);oe&&(J.sentiment=oe);const ae=j(R);ae&&(J.riskLevel=ae),(t==null?void 0:t.maxProfit)!==void 0&&(J.maxProfit=t.maxProfit),(t==null?void 0:t.currentPnL)!==void 0&&(J.currentPnL=t.currentPnL),(t==null?void 0:t.currentMarketCap)!==void 0&&(J.currentMarketCap=t.currentMarketCap),(t==null?void 0:t.signalMarketCap)!==void 0&&(J.signalMarketCap=t.signalMarketCap),(t==null?void 0:t.currentPrice)!==void 0&&(J.currentPrice=t.currentPrice),(t==null?void 0:t.entryPrice)!==void 0&&(J.entryPrice=t.entryPrice),t?await F0(t.id,J):await mj(J),s==null||s()}catch(R){console.error("Error creating call:",R);const O=(R==null?void 0:R.message)||(R==null?void 0:R.code)||"Ошибка при сохранении сигнала";h(O)}finally{c(!1)}},z=I=>{const O=(K[w]||{})[I.key],U=`w-full px-4 py-2 rounded-lg border ${L} ${ee} ${S} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`;if(I.type==="textarea")return r.jsx("textarea",{value:O||"",onChange:J=>v(I.key,J.target.value),className:`${U} min-h-[100px] resize-y`,placeholder:I.placeholder});if(I.type==="select"&&I.options){const J=I.options.length<=3?"grid-cols-1 sm:grid-cols-3":I.options.length<=4?"grid-cols-2 sm:grid-cols-4":"grid-cols-2 sm:grid-cols-3";return r.jsx("div",{className:`grid ${J} gap-2 sm:gap-3`,children:I.options.map(C=>{const oe=O===C.value;return r.jsx("button",{type:"button",onClick:()=>v(I.key,C.value),className:`px-3 py-3 sm:py-2 rounded-lg border-2 text-sm font-medium transition-all duration-300 min-h-[44px] sm:min-h-[40px] hover:shadow-md focus:outline-none focus:ring-2 focus:ring-[#4E6E49]/30 ${oe?"border-[#4E6E49] bg-gradient-to-r from-[#4E6E49] to-emerald-600 text-white shadow-md shadow-emerald-300/30 scale-[1.02] ring-2 ring-[#4E6E49]/20":`border-gray-200 dark:border-gray-700 ${a==="dark"?"text-gray-300 hover:border-gray-600 hover:bg-gray-800":"text-gray-700 hover:border-gray-400 hover:bg-gray-50"} active:scale-95 hover:-translate-y-0.5`}`,children:C.label},C.value)})})}return I.type==="checkbox"?r.jsxs("label",{className:"inline-flex items-center gap-3 cursor-pointer select-none p-3 sm:p-3 rounded-lg border border-gray-200 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-800 hover:border-gray-300 dark:hover:border-gray-600 transition-all duration-200 min-h-[48px] sm:min-h-[44px] hover:shadow-sm",children:[r.jsx("input",{type:"checkbox",checked:!!O,onChange:J=>v(I.key,J.target.checked),className:"accent-[#4E6E49] w-5 h-5 sm:w-4 sm:h-4"}),r.jsx("span",{className:`font-medium ${S} text-sm sm:text-base`,children:I.label})]}):r.jsx("input",{type:"text",value:O||"",onChange:J=>v(I.key,J.target.value),className:U,placeholder:I.placeholder})};return r.jsxs("form",{onSubmit:M,className:"space-y-6",children:[d&&r.jsx("div",{className:`p-4 rounded-lg ${a==="dark"?"bg-red-900/30 border border-red-700 text-red-300":"bg-red-50 border border-red-200 text-red-800"}`,children:d}),r.jsxs("div",{className:`rounded-2xl border ${L} ${a==="dark"?"bg-gray-800/60":"bg-white"} p-4 sm:p-6`,children:[r.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[r.jsx("div",{className:"w-10 h-10 rounded-xl flex items-center justify-center text-white shadow-lg",style:{background:"linear-gradient(135deg, #4E6E49, #3b8d5a)"},children:r.jsx(er,{className:"w-5 h-5"})}),r.jsxs("div",{children:[r.jsx("p",{className:`text-lg font-bold ${S}`,children:"Выберите тип сигнала"}),r.jsx("p",{className:`text-xs ${D}`,children:"Какая категория лучше всего описывает ваш сигнал?"})]})]}),r.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-3 gap-2 sm:gap-3",children:Object.keys(hn).map(I=>{const R=hn[I],O=w===I;return r.jsx("button",{type:"button",onClick:()=>$(I),className:`p-4 rounded-xl border-2 transition-all duration-300 hover:shadow-md hover:-translate-y-0.5 active:scale-95 ${O?"border-[#4E6E49] bg-gradient-to-br from-[#4E6E49]/10 to-emerald-500/10 shadow-md shadow-emerald-300/20 scale-[1.02] ring-2 ring-[#4E6E49]/20":"border-gray-200 dark:border-gray-700 hover:border-gray-300 dark:hover:border-gray-600 hover:shadow-lg"}`,children:r.jsxs("div",{className:"flex flex-col items-center gap-2 text-center",children:[r.jsx("div",{className:`p-2 rounded-lg ${O?"bg-[#4E6E49] text-white":"bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-300"} transition-colors`,children:R.icon}),r.jsx("span",{className:`text-sm font-semibold ${O?"text-[#4E6E49]":S}`,children:R.label})]})},I)})})]}),r.jsxs("div",{className:`rounded-2xl border ${L} ${a==="dark"?"bg-gray-800/60":"bg-white"} p-4 sm:p-6 space-y-4`,children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx("div",{className:"hidden sm:flex w-10 h-10 rounded-xl items-center justify-center text-white shadow-lg",style:{background:"linear-gradient(135deg, #4E6E49, #3b8d5a)"},children:r.jsx("div",{className:"w-5 h-5",children:hn[w].icon})}),r.jsxs("div",{className:"hidden sm:block",children:[r.jsxs("p",{className:`text-lg font-bold ${S}`,children:[hn[w].label," - Детали сигнала"]}),r.jsx("p",{className:`text-xs ${D}`,children:"Заполните все необходимые поля"})]}),r.jsx("div",{className:"sm:hidden",children:r.jsx("p",{className:`text-sm font-bold ${S}`,children:hn[w].label})})]}),p.percentage<100&&r.jsxs("div",{className:"text-right",children:[r.jsx("div",{className:`w-16 h-2 rounded-full overflow-hidden ${a==="dark"?"bg-gray-700":"bg-gray-200"} shadow-inner`,children:r.jsx("div",{className:"h-full rounded-full transition-all duration-500 ease-out bg-gradient-to-r from-[#4E6E49] to-emerald-600",style:{width:`${p.percentage}%`}})}),r.jsxs("p",{className:`text-xs ${D} mt-1`,children:[p.filled,"/",p.total]})]}),p.percentage===100&&r.jsx("div",{className:"text-right",children:r.jsx("div",{className:"w-8 h-8 rounded-full bg-emerald-500 flex items-center justify-center",children:r.jsx(_r,{className:"w-4 h-4 text-white"})})})]}),r.jsx("div",{className:"space-y-6",children:Object.entries(Rj[w]).map(([I,R],O)=>{const U=Sh[w].filter(J=>J.section===I);return U.length===0?null:r.jsxs("div",{className:"space-y-4 animate-in fade-in-0 slide-in-from-bottom-4 duration-500",style:{animationDelay:`${O*100}ms`},children:[r.jsxs("div",{className:"flex items-center gap-2 pb-2 border-b border-gray-200 dark:border-gray-700",children:[r.jsx("div",{className:`p-1.5 rounded-lg transition-colors duration-200 ${a==="dark"?"bg-gray-700 text-gray-300 hover:bg-gray-600":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:R.icon}),r.jsxs("div",{children:[r.jsx("h3",{className:`text-sm font-bold ${S}`,children:R.title}),R.description&&r.jsx("p",{className:`text-xs ${D}`,children:R.description})]})]}),r.jsx("div",{className:"grid grid-cols-1 gap-4",children:U.map(J=>r.jsxs("div",{className:"space-y-2",children:[J.type!=="checkbox"&&r.jsx("label",{className:`text-sm font-semibold ${S}`,children:J.label}),z(J)]},J.key))})]},I)})})]}),r.jsxs("div",{children:[r.jsx("label",{className:`block text-sm font-medium ${S} mb-2`,children:"Общий комментарий или доп. заметки"}),r.jsx("textarea",{value:A,onChange:I=>T(I.target.value),className:`w-full px-4 py-3 rounded-lg border ${L} ${ee} ${S} focus:outline-none focus:ring-2 focus:ring-[#4E6E49] min-h-[90px] resize-y`,placeholder:"Здесь можно оставить чеклист для апдейтов, условия выхода, алерты."})]}),r.jsx("div",{className:"flex flex-col gap-3 sm:gap-4",children:r.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 sm:gap-4",children:[r.jsxs("button",{type:"button",onClick:q,className:`px-6 py-4 sm:py-3 rounded-lg font-semibold border ${L} ${a==="dark"?"text-white hover:bg-gray-800 active:bg-gray-800":"text-gray-800 hover:bg-gray-100 active:bg-gray-200"} transition-colors min-h-[48px] sm:min-h-[44px]`,children:[r.jsx(Ai,{className:"w-4 h-4 inline mr-2"}),"Предпросмотр"]}),r.jsx("button",{type:"submit",disabled:o,className:`flex-1 py-4 sm:py-3 rounded-lg font-semibold transition-all shadow-md min-h-[48px] sm:min-h-[44px] ${a==="dark"?"bg-gradient-to-r from-[#4E6E49] to-emerald-700 text-white hover:scale-[1.01] active:scale-[0.98] disabled:bg-gray-700":"bg-gradient-to-r from-[#4E6E49] to-emerald-600 text-white hover:shadow-lg active:shadow-md disabled:bg-gray-300 disabled:text-gray-600"}`,children:o?"Сохраняем...":t?"Обновить сигнал":"Создать сигнал"}),e&&r.jsx("button",{type:"button",onClick:e,className:`px-6 py-4 sm:py-3 rounded-lg font-semibold border ${L} ${a==="dark"?"text-white hover:bg-gray-800 active:bg-gray-800":"text-gray-800 hover:bg-gray-100 active:bg-gray-200"} min-h-[48px] sm:min-h-[44px]`,children:"Отмена"})]})}),m&&(()=>{const I=F(),R=hn[w],O=$e.find(U=>U.id===I.userId);return r.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-[70] flex items-start sm:items-center justify-center p-4 overflow-y-auto",children:r.jsx("div",{className:`${b} rounded-2xl shadow-2xl border ${L} max-w-4xl w-full max-h-[90vh] overflow-hidden`,children:r.jsxs("div",{className:"flex flex-col h-full",children:[r.jsxs("div",{className:`p-6 flex items-center justify-between sticky top-0 z-20 ${b} border-b ${L} shadow-sm`,children:[r.jsxs("h2",{className:`text-2xl font-bold ${S} flex items-center gap-2`,children:[r.jsx(Ai,{className:"w-5 h-5"}),"Предпросмотр сигнала"]}),r.jsx("button",{onClick:()=>x(!1),className:`p-2 rounded-xl ${a==="dark"?"hover:bg-gray-800":"hover:bg-gray-100"}`,children:r.jsx(Rt,{className:`w-5 h-5 ${k}`})})]}),r.jsxs("div",{className:"px-6 pb-6 pt-2 overflow-y-auto flex-1 max-h-[75vh]",children:[r.jsxs("div",{className:`rounded-3xl border-2 shadow-xl overflow-hidden mb-6 ${ue[w].border} ${ue[w].bg}`,children:[r.jsxs("div",{className:`px-5 py-4 flex flex-wrap items-center justify-between gap-3 border-b ${a==="dark"?"border-white/10 bg-white/5":"border-white/70 bg-white/70"}`,children:[r.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[r.jsxs("span",{className:`flex items-center gap-2 px-3 py-1.5 rounded-full text-sm font-semibold border ${ue[w].border} ${ue[w].chipBg||""} ${ue[w].text}`,children:[R.icon,R.label]}),r.jsx("span",{className:"px-3 py-1.5 rounded-full text-xs font-semibold bg-emerald-500/15 text-emerald-500 border border-emerald-500/20",children:"Активен"}),r.jsxs("span",{className:`px-3 py-1.5 rounded-full text-xs font-semibold ${te[I.riskLevel||"medium"]}`,children:["Риск: ",I.riskLevel||"medium"]})]}),r.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[r.jsx("div",{className:`px-3 py-1.5 rounded-xl text-xs font-semibold border ${a==="dark"?"bg-gray-800/70 text-gray-200 border-white/10":"bg-white text-gray-700 border-gray-200"}`,children:"Создано только что"}),O&&r.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 rounded-xl border border-white/10 bg-black/5 dark:bg-white/5",children:[r.jsx("div",{className:"w-8 h-8 rounded-full bg-gradient-to-r from-[#4E6E49] to-emerald-600 text-white flex items-center justify-center text-sm font-bold",children:O.name[0]}),r.jsx("span",{className:`text-xs ${k}`,children:O.name})]})]})]}),r.jsxs("div",{className:"p-5 space-y-5",children:[r.jsx("div",{className:"grid md:grid-cols-[1.15fr_auto] gap-4 items-start",children:r.jsxs("div",{className:"space-y-1",children:[r.jsx("p",{className:`text-2xl font-bold ${S}`,children:H(I)}),r.jsx("p",{className:`text-sm ${k}`,children:ne(I)})]})}),pe(I),I.comment&&r.jsxs("div",{className:`rounded-xl border ${L} ${a==="dark"?"bg-gray-900/60":"bg-gray-50"} p-4`,children:[r.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[r.jsx(mn,{className:"w-4 h-4 text-amber-500"}),r.jsx("p",{className:`text-sm font-semibold ${S}`,children:"Общий комментарий"})]}),r.jsx("p",{className:`${S} whitespace-pre-wrap`,children:I.comment})]})]})]}),r.jsxs("div",{className:"flex gap-4",children:[r.jsx("button",{onClick:()=>x(!1),className:`flex-1 px-4 py-3 rounded-xl border ${L} ${a==="dark"?"text-white hover:bg-gray-800":"text-gray-800 hover:bg-gray-100"} font-semibold`,children:"Вернуться к редактированию"}),r.jsxs("button",{onClick:()=>{x(!1);const U=document.querySelector("form");U==null||U.requestSubmit()},className:`flex-1 px-4 py-3 rounded-xl font-semibold transition-all ${p.percentage===100?"bg-gradient-to-r from-[#4E6E49] to-emerald-600 text-white shadow-md hover:shadow-lg":"bg-gray-400 text-gray-200 cursor-not-allowed"}`,children:[r.jsx(_r,{className:"w-4 h-4 inline mr-2"}),"Создать сигнал"]})]})]})]})})})})()]})},to="modal-open";let fa=0;const Mj=()=>{typeof document>"u"||(fa===0&&(document.body.classList.add(to),document.documentElement.classList.add(to)),fa+=1)},Oj=()=>{typeof document>"u"||(fa=Math.max(fa-1,0),fa===0&&(document.body.classList.remove(to),document.documentElement.classList.remove(to)))},ps=(s=!0)=>{E.useEffect(()=>{if(s)return Mj(),()=>{Oj()}},[s])},ia={memecoins:{label:"Мемкоины",gradient:"from-emerald-400 to-teal-500",chip:"bg-emerald-500/10 text-emerald-600",icon:r.jsx(Pa,{className:"w-4 h-4"})},futures:{label:"Фьючерсы",gradient:"from-blue-400 to-indigo-500",chip:"bg-blue-500/10 text-blue-600",icon:r.jsx(io,{className:"w-4 h-4"})},nft:{label:"NFT",gradient:"from-purple-400 to-pink-500",chip:"bg-purple-500/10 text-purple-600",icon:r.jsx(ao,{className:"w-4 h-4"})},spot:{label:"Спот",gradient:"from-amber-400 to-orange-500",chip:"bg-amber-500/10 text-amber-600",icon:r.jsx(lr,{className:"w-4 h-4"})},polymarket:{label:"Polymarket",gradient:"from-rose-400 to-red-500",chip:"bg-rose-500/10 text-rose-600",icon:r.jsx(er,{className:"w-4 h-4"})},staking:{label:"Стейкинг",gradient:"from-cyan-400 to-blue-500",chip:"bg-cyan-500/10 text-cyan-600",icon:r.jsx(At,{className:"w-4 h-4"})}},fi={all:{label:"Все",className:""},active:{label:"Активен",className:"bg-emerald-500/15 text-emerald-500 border border-emerald-500/20"},completed:{label:"Завершен",className:"bg-blue-500/15 text-blue-500 border border-blue-500/20"},cancelled:{label:"Отменен",className:"bg-red-500/15 text-red-500 border border-red-500/20"},reviewed:{label:"На рассмотрении",className:"bg-gray-500/15 text-gray-500 border border-gray-500/20"}},Dh={low:"bg-emerald-500/10 text-emerald-600 border border-emerald-500/20",medium:"bg-blue-500/10 text-blue-600 border border-blue-500/20",high:"bg-amber-500/10 text-amber-600 border border-amber-500/20",ultra:"bg-red-500/10 text-red-600 border border-red-500/20"},Vj=()=>{const{theme:s}=it(),[e,t]=E.useState([]),[n,a]=E.useState(!0),[i,o]=E.useState(!1),[c,d]=E.useState(!1),[h,m]=E.useState(null),[x,f]=E.useState(null),[w,$]=E.useState(null),[A,T]=E.useState("memecoins"),[K,P]=E.useState(null),[S,L]=E.useState(""),[ee,D]=E.useState("all"),[k,b]=E.useState("all"),[v,j]=E.useState("all"),[N,y]=E.useState("all");ps(i||c||!!x),E.useEffect(()=>{p()},[]);const p=async()=>{a(!0);try{const Y=await gj();t(Y)}catch(Y){console.error("Error loading calls:",Y),t([])}finally{a(!1)}},te=s==="dark"?"bg-[#121212]":"bg-white",ue=s==="dark"?"text-white":"text-gray-900",le=s==="dark"?"text-gray-400":"text-gray-600",H=s==="dark"?"border-gray-800":"border-gray-200",ce=`rounded-2xl p-4 sm:p-6 md:p-8 border-2 ${s==="dark"?"border-[#4E6E49]/30 bg-gradient-to-br from-[#1a1a1a] via-[#1a1a1a] to-[#0A0A0A]":"border-green-200 bg-gradient-to-br from-white via-green-50/30 to-white"}`,B=`rounded-2xl border ${s==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white"}`,pe={memecoins:{bg:s==="dark"?"bg-emerald-500/10":"bg-emerald-50",text:s==="dark"?"text-emerald-100":"text-emerald-800",border:s==="dark"?"border-emerald-500/30":"border-emerald-200",chipBg:s==="dark"?"bg-emerald-500/20":"bg-emerald-500/10"},futures:{bg:s==="dark"?"bg-sky-500/10":"bg-sky-50",text:s==="dark"?"text-sky-100":"text-sky-800",border:s==="dark"?"border-sky-500/30":"border-sky-200",chipBg:s==="dark"?"bg-sky-500/20":"bg-sky-500/10"},nft:{bg:s==="dark"?"bg-purple-500/10":"bg-purple-50",text:s==="dark"?"text-purple-100":"text-purple-800",border:s==="dark"?"border-purple-500/30":"border-purple-200",chipBg:s==="dark"?"bg-purple-500/20":"bg-purple-500/10"},spot:{bg:s==="dark"?"bg-amber-500/10":"bg-amber-50",text:s==="dark"?"text-amber-100":"text-amber-800",border:s==="dark"?"border-amber-500/30":"border-amber-200",chipBg:s==="dark"?"bg-amber-500/20":"bg-amber-500/10"},polymarket:{bg:s==="dark"?"bg-rose-500/10":"bg-rose-50",text:s==="dark"?"text-rose-100":"text-rose-800",border:s==="dark"?"border-rose-500/30":"border-rose-200",chipBg:s==="dark"?"bg-rose-500/20":"bg-rose-500/10"},staking:{bg:s==="dark"?"bg-cyan-500/10":"bg-cyan-50",text:s==="dark"?"text-cyan-100":"text-cyan-800",border:s==="dark"?"border-cyan-500/30":"border-cyan-200",chipBg:s==="dark"?"bg-cyan-500/20":"bg-cyan-500/10"}},F=()=>{o(!1),$(null),p()},q=()=>{o(!1),$(null)},M=Y=>{$(Y),T(Y.category),o(!0)},z=Y=>{m(Y),d(!0)},I=async()=>{if(h)try{await pj(h),d(!1),m(null),p()}catch(Y){console.error("Error deleting call:",Y),alert("Ошибка при удалении сигнала")}},R=async()=>{if(x)try{await F0(x,{status:"cancelled"}),f(null),p()}catch(Y){console.error("Error cancelling call:",Y),alert("Ошибка при отмене сигнала")}},O=async Y=>{try{await navigator.clipboard.writeText(Y),P(Y),setTimeout(()=>P(null),1800)}catch(G){console.error("Failed to copy:",G)}},U=Y=>{var G;return((G=Y.details)==null?void 0:G[Y.category])||{}},J=Y=>{const G=U(Y);switch(Y.category){case"memecoins":return G.coinName||G.ticker||"Мемкоин";case"futures":return G.pair||"Фьючерс";case"nft":return G.collectionLink||"NFT коллекция";case"spot":return G.coin||"Спот";case"polymarket":return G.event||"Polymarket событие";case"staking":return G.coin||"Стейкинг";default:return"Сигнал"}},C=Y=>{const G=U(Y);switch(Y.category){case"memecoins":return`${G.ticker||""} ${G.network?`• ${String(G.network).toUpperCase()}`:""}`.trim();case"futures":return`${G.direction==="long"?"Long":"Short"} • ${G.timeframe||""}`;case"nft":return`${G.marketplace||""}${G.network?` • ${String(G.network).toUpperCase()}`:""}`;case"spot":return G.holdingHorizon?`Горизонт: ${G.holdingHorizon}`:"";case"polymarket":return`${G.positionType==="yes"?"YES":"NO"} • ${G.entryPrice||""}`;case"staking":return`${G.platform||""}${G.term?` • ${G.term}`:""}`;default:return""}},oe=Y=>Y.riskLevel||U(Y).riskLevel||U(Y).protocolRisk||"medium",ae=Y=>{const G=U(Y);return[Y.category,Y.status,Y.comment,G.coinName,G.ticker,G.pair,G.reason,G.targets,G.event,G.marketplace,G.platform,G.entryCap,G.entryZone,G.network].filter(Boolean).join(" ").toLowerCase()},V=e.filter(Y=>ee!=="all"&&Y.status!==ee||k!=="all"&&Y.category!==k||v!=="all"&&oe(Y)!==v||N!=="all"&&Y.userId!==N?!1:S.trim()?ae(Y).includes(S.toLowerCase()):!0),Z=E.useMemo(()=>e.reduce((Y,G)=>(Y[G.category]||(Y[G.category]={total:0,active:0}),Y[G.category].total+=1,G.status==="active"&&(Y[G.category].active+=1),Y),{memecoins:{total:0,active:0},futures:{total:0,active:0},nft:{total:0,active:0},spot:{total:0,active:0},polymarket:{total:0,active:0},staking:{total:0,active:0}}),[e]),ye=E.useMemo(()=>({total:e.length,active:e.filter(Y=>Y.status==="active").length,completed:e.filter(Y=>Y.status==="completed").length,highRisk:e.filter(Y=>oe(Y)==="high"||oe(Y)==="ultra").length}),[e]),we=s==="dark"?"bg-gray-800 text-gray-200 border border-gray-700":"bg-white text-gray-700 border border-gray-200",Ke="bg-gradient-to-r from-emerald-400 to-teal-500 text-white shadow-md shadow-emerald-300/30",We=(Y,G,Te)=>r.jsxs("div",{className:`p-4 rounded-xl border ${H} ${s==="dark"?"bg-gray-800/70":"bg-gray-50"}`,children:[r.jsx("p",{className:`text-xs uppercase tracking-wider ${le}`,children:Y}),r.jsx("p",{className:`text-2xl font-bold ${Te}`,children:G})]}),Q={low:"Низкий",medium:"Средний",high:"Высокий",ultra:"Ультра"},me={flip:"Flip",short:"Короткий",medium:"Средний",long:"Длинный"},Ie={flexible:"Гибкий","30d":"30 дней","90d":"90 дней",fixed:"Фикс."},de={enter:"Вход",exit:"Выход",rebalance:"Ребаланс"},ze={yes:"YES",no:"NO"},Le=(Y,G=28)=>{if(!Y)return"";if(Y.length<=G)return Y;const Te=Y.slice(0,Math.floor(G/2)),Re=Y.slice(-6);return`${Te}...${Re}`},W=Y=>Y?Y.includes("%")?Y:`${Y}%`:"",Ne=Y=>{if(!Y)return"";const G=new Date(Y);if(Number.isNaN(G.getTime()))return Y;const Te=new Date,Re=G.getTime()-Te.getTime(),Ue=G.toLocaleString("ru-RU",{day:"2-digit",month:"short",hour:"2-digit",minute:"2-digit"});if(Re<=0)return`${Ue} (истек)`;const xe=Math.max(0,Math.floor(Re/(1e3*60))),lt=Math.floor(xe/(60*24)),Qe=Math.floor(xe%(60*24)/60),ct=xe%60,_e=[lt>0?`${lt}д`:null,Qe>0?`${Qe}ч`:null,ct>0?`${ct}м`:null].filter(Boolean).slice(0,2).join(" ");return`${Ue} (через ${_e||"минуты"})`},Pe=Y=>{const G=U(Y),Te=oe(Y),Re=pe[Y.category],Ue=[],xe=(Qe,ct,_e,Me)=>{ct&&Ue.push({label:Qe,value:ct,icon:_e,copyValue:Me??ct})};switch(Y.category){case"memecoins":xe("Монета",G.coinName,r.jsx(lr,{className:"w-4 h-4"})),xe("Тикер",Le(G.ticker,8),r.jsx(Jh,{className:"w-4 h-4"}),G.ticker),xe("Сеть",G.network?String(G.network).toUpperCase():"",r.jsx(Xh,{className:"w-4 h-4"})),xe("Контракт",Le(G.contract,12),r.jsx(gx,{className:"w-4 h-4"}),G.contract),xe("Тип сигнала",G.signalType?G.signalType.toUpperCase():"",r.jsx(vn,{className:"w-4 h-4"})),xe("Зона входа",G.entryCap,r.jsx(mr,{className:"w-4 h-4"})),xe("Цели",G.targets,r.jsx(er,{className:"w-4 h-4"})),xe("SL",G.stopLoss,r.jsx(yn,{className:"w-4 h-4"})),xe("План",me[G.holdPlan]||G.holdPlan,r.jsx(Ss,{className:"w-4 h-4"})),xe("Ликвидность",G.liquidityLocked?"Залочена":"",r.jsx(At,{className:"w-4 h-4"})),xe("Риск",Q[Te]||Te,r.jsx(ra,{className:"w-4 h-4"})),xe("Риски",G.risks,r.jsx(Ut,{className:"w-4 h-4"})),xe("Комментарий",G.traderComment,r.jsx(mn,{className:"w-4 h-4"})),xe("Причина входа",G.reason,r.jsx(Xr,{className:"w-4 h-4"}));break;case"futures":xe("Пара",G.pair,r.jsx(Xl,{className:"w-4 h-4"}),G.pair),xe("Направление",G.direction?G.direction.toUpperCase():"",r.jsx(qt,{className:"w-4 h-4"})),xe("Плечо",G.leverage,r.jsx(Ks,{className:"w-4 h-4"})),xe("Зона входа",G.entryZone||G.entryPrice,r.jsx(mr,{className:"w-4 h-4"})),xe("Цели",G.targets,r.jsx(er,{className:"w-4 h-4"})),xe("SL",G.stopLoss,r.jsx(yn,{className:"w-4 h-4"})),xe("Стиль",G.signalStyle,r.jsx(vn,{className:"w-4 h-4"})),xe("Размер позиции",G.positionSize,r.jsx(_s,{className:"w-4 h-4"})),xe("Таймфрейм",G.timeframe,r.jsx(rc,{className:"w-4 h-4"})),xe("Риск",Q[Te]||Te,r.jsx(ra,{className:"w-4 h-4"})),xe("Риски",G.risks,r.jsx(Ut,{className:"w-4 h-4"})),xe("Причина входа",G.reason,r.jsx(Xr,{className:"w-4 h-4"}));break;case"nft":xe("Коллекция",Le(G.collectionLink),r.jsx(gl,{className:"w-4 h-4"}),G.collectionLink),xe("NFT",Le(G.nftLink),r.jsx(gl,{className:"w-4 h-4"}),G.nftLink),xe("Маркетплейс",G.marketplace,r.jsx(Ti,{className:"w-4 h-4"})),xe("Сеть",G.network?String(G.network).toUpperCase():"",r.jsx(em,{className:"w-4 h-4"})),xe("Вход",G.entryPrice,r.jsx(mr,{className:"w-4 h-4"})),xe("Редкость",G.rarity,r.jsx(pr,{className:"w-4 h-4"})),xe("Тип сигнала",G.signalType?G.signalType.toUpperCase():"",r.jsx(vn,{className:"w-4 h-4"})),xe("Срок удержания",me[G.holdingHorizon]||G.holdingHorizon,r.jsx(Ss,{className:"w-4 h-4"})),xe("Мин. ликвидность",G.minLiquidity,r.jsx(Ks,{className:"w-4 h-4"})),xe("Target",G.targetPrice,r.jsx(er,{className:"w-4 h-4"})),xe("Риски",G.risks,r.jsx(Ut,{className:"w-4 h-4"})),xe("Комментарий",G.traderComment,r.jsx(mn,{className:"w-4 h-4"})),xe("Причина входа",G.reason,r.jsx(Xr,{className:"w-4 h-4"}));break;case"spot":xe("Монета",G.coin,r.jsx(lr,{className:"w-4 h-4"})),xe("Зона входа",G.entryCap,r.jsx(mr,{className:"w-4 h-4"})),xe("Цели",G.targets,r.jsx(er,{className:"w-4 h-4"})),xe("SL",G.stopLoss,r.jsx(yn,{className:"w-4 h-4"})),xe("Горизонт",me[G.holdingHorizon]||G.holdingHorizon,r.jsx(Ss,{className:"w-4 h-4"})),xe("Размер",G.positionSize,r.jsx(_s,{className:"w-4 h-4"})),xe("Риск",G.riskLevel?Q[G.riskLevel]:void 0,r.jsx(ra,{className:"w-4 h-4"})),xe("Риски",G.risks,r.jsx(Ut,{className:"w-4 h-4"})),xe("Комментарий",G.traderComment,r.jsx(mn,{className:"w-4 h-4"})),xe("Причина входа",G.reason,r.jsx(Xr,{className:"w-4 h-4"}));break;case"polymarket":const Qe=G.positionType;xe("Событие",G.event,r.jsx(Xr,{className:"w-4 h-4"})),xe("Тип",Qe?ze[Qe]:"",r.jsx(At,{className:"w-4 h-4"})),xe("Вход %",W(G.entryPrice),r.jsx(_s,{className:"w-4 h-4"})),xe("Ожидание %",W(G.expectedProbability),r.jsx(Ks,{className:"w-4 h-4"})),xe("Цель",G.targetPlan,r.jsx(er,{className:"w-4 h-4"})),xe("Макс ставка",G.maxStake,r.jsx(lr,{className:"w-4 h-4"})),xe("Срок исхода",Ne(G.eventDeadline),r.jsx(Si,{className:"w-4 h-4"})),xe("Риск",Q[Te]||Te,r.jsx(ra,{className:"w-4 h-4"})),xe("Риски",G.risks,r.jsx(Ut,{className:"w-4 h-4"})),xe("Комментарий",G.traderComment,r.jsx(mn,{className:"w-4 h-4"})),xe("Причина входа",G.reason,r.jsx(Xr,{className:"w-4 h-4"}));break;case"staking":xe("Монета",G.coin,r.jsx(lr,{className:"w-4 h-4"})),xe("Платформа",G.platform,r.jsx(Ti,{className:"w-4 h-4"})),xe("Срок",Ie[G.term]||G.term,r.jsx(Si,{className:"w-4 h-4"})),xe("APY",W(G.apy),r.jsx(_s,{className:"w-4 h-4"})),xe("Мин. депозит",G.minDeposit,r.jsx(lr,{className:"w-4 h-4"})),xe("Тип сигнала",de[G.action]||G.action,r.jsx(At,{className:"w-4 h-4"})),xe("Риск протокола",G.protocolRisk?Q[G.protocolRisk]:void 0,r.jsx(ra,{className:"w-4 h-4"})),xe("Риски",G.risks,r.jsx(Ut,{className:"w-4 h-4"})),xe("Комментарий",G.traderComment,r.jsx(mn,{className:"w-4 h-4"})),xe("Причина входа",G.reason,r.jsx(Xr,{className:"w-4 h-4"}));break}const lt=Ue.filter(Qe=>Qe.value);return lt.length?r.jsxs("div",{className:`rounded-2xl border ${H} ${s==="dark"?"bg-gray-900/60":"bg-white"}`,children:[r.jsxs("div",{className:`flex items-center gap-2 px-4 py-3 border-b ${H} ${s==="dark"?"bg-white/5":"bg-gray-50"}`,children:[r.jsx(pr,{className:"w-4 h-4 text-amber-500"}),r.jsx("p",{className:`text-sm font-semibold ${ue}`,children:"Ключевые метрики"}),r.jsxs("span",{className:`ml-auto text-[11px] font-semibold px-3 py-1 rounded-full ${Dh[Te]}`,children:["Риск: ",Q[Te]||Te]})]}),r.jsx("div",{className:"divide-y divide-gray-200/70 dark:divide-white/10",children:lt.map(Qe=>r.jsxs("div",{className:"flex items-center justify-between gap-3 px-4 py-3",children:[r.jsxs("div",{className:"flex items-start gap-3",children:[r.jsx("div",{className:`p-2 rounded-xl border ${Re.border} ${Re.bg} ${Re.text}`,children:Qe.icon}),r.jsxs("div",{className:"flex-1 min-w-0",children:[r.jsx("p",{className:`text-xs uppercase tracking-wide ${le}`,children:Qe.label}),r.jsx("p",{className:`${ue} font-semibold whitespace-pre-wrap break-words`,children:Qe.value})]})]}),Qe.copyValue&&r.jsx("button",{onClick:()=>O(Qe.copyValue),className:`p-2 rounded-lg border ${H} ${s==="dark"?"hover:bg-gray-800 bg-white/5":"hover:bg-gray-100 bg-white"} transition-colors`,title:"Копировать",children:K===Qe.copyValue?r.jsx(_r,{className:"w-4 h-4 text-emerald-500"}):r.jsx(va,{className:"w-4 h-4"})})]},Qe.label))})]}):null};return r.jsxs("div",{className:"space-y-10 pb-20",children:[r.jsxs("div",{className:`relative overflow-hidden ${ce} p-5 sm:p-6 md:p-8 ${s==="dark"?"bg-gradient-to-br from-[#0e1b2c] via-[#0c1827] to-[#0a1420]":"bg-gradient-to-br from-white via-emerald-50/40 to-sky-50"}`,children:[r.jsxs("div",{className:"absolute inset-0 pointer-events-none",children:[r.jsx("div",{className:"absolute -top-32 -left-16 w-80 h-80 bg-gradient-to-br from-[#4E6E49]/18 via-sky-500/8 to-transparent blur-3xl"}),r.jsx("div",{className:"absolute top-0 right-0 w-[26rem] h-[26rem] bg-gradient-to-bl from-sky-400/14 via-emerald-400/12 to-transparent blur-3xl"}),r.jsx("div",{className:"absolute bottom-[-140px] left-14 w-80 h-80 bg-gradient-to-tr from-sky-300/12 via-[#4E6E49]/12 to-transparent blur-3xl"})]}),r.jsx("div",{className:"relative z-10 grid grid-cols-1 gap-5",children:r.jsx("div",{className:`${B} backdrop-blur p-4 sm:p-5 space-y-4`,children:r.jsx("div",{className:"flex flex-col gap-4 sm:gap-5 lg:flex-row lg:items-center lg:justify-between",children:r.jsxs("div",{className:"flex flex-col sm:flex-row items-center gap-3 w-full sm:w-auto",children:[r.jsx("div",{className:"hidden sm:block p-3 rounded-2xl bg-white/80 dark:bg-white/5 border border-white/40 dark:border-white/10 shadow-lg",children:r.jsx(ml,{className:"w-6 h-6 text-[#4E6E49]"})}),r.jsx("div",{className:"flex items-center text-center sm:text-left w-full sm:w-auto justify-center sm:justify-start",children:r.jsx("h1",{className:`text-xl sm:text-3xl font-extrabold leading-tight ${s==="dark"?"text-white":"text-gray-900"}`,children:"Signals HUB"})})]})})})})]}),r.jsxs("div",{className:`${ce} shadow-2xl relative overflow-hidden p-6 sm:p-8`,children:[r.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-white/5 to-transparent pointer-events-none"}),r.jsx("div",{className:"relative z-10 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-5",children:Object.keys(ia).map(Y=>{const G=ia[Y],Te=Z[Y],Re=pe[Y];return r.jsxs("button",{onClick:()=>{T(Y),$(null),o(!0)},className:`p-5 rounded-[1.5rem] border-2 ${Re.border} ${Re.bg} text-left shadow-lg hover:shadow-xl transition-all hover:-translate-y-1 space-y-3 group/card relative overflow-hidden`,children:[r.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-white/10 to-transparent opacity-0 group-hover/card:opacity-100 transition-opacity"}),r.jsxs("div",{className:"flex items-start justify-between gap-3 relative z-10",children:[r.jsxs("div",{className:`flex items-center gap-2 px-3 py-1.5 rounded-full text-[11px] font-bold ${Re.text} bg-white/10 border border-white/10 backdrop-blur-md`,children:[G.icon,r.jsx("span",{children:G.label})]}),r.jsx("span",{className:`px-2.5 py-1 rounded-lg text-[10px] font-bold border ${Re.border} ${Re.text} ${s==="dark"?"bg-black/20":"bg-white/50"} group-hover/card:bg-[#4E6E49] group-hover/card:text-white group-hover/card:border-transparent transition-all`,children:"Добавить"})]}),r.jsxs("div",{className:"pl-1 relative z-10",children:[r.jsx("p",{className:`text-3xl font-black ${ue} leading-none mb-1 group-hover/card:scale-105 transition-transform origin-left`,children:(Te==null?void 0:Te.total)||0}),r.jsxs("p",{className:`text-[10px] uppercase tracking-wider font-bold ${le} opacity-80`,children:["Всего сигналов • Активных ",(Te==null?void 0:Te.active)||0]})]})]},Y)})})]}),r.jsxs("div",{className:`${ce} !p-0 shadow-2xl`,children:[r.jsx("div",{className:"p-6 sm:p-8 space-y-8",children:r.jsxs("div",{className:"flex flex-col gap-3",children:[r.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[r.jsxs("div",{className:"flex items-center gap-2 text-sm font-semibold",children:[r.jsx(Qh,{className:`w-4 h-4 ${le}`}),r.jsx("span",{className:ue,children:"Фильтры"})]}),r.jsx("div",{className:"flex flex-wrap gap-2",children:Object.keys(fi).map(Y=>r.jsx("button",{onClick:()=>D(Y),className:`px-3 py-1.5 rounded-xl text-sm font-semibold transition-all ${ee===Y?Ke:we}`,children:fi[Y].label},Y))})]}),r.jsxs("div",{className:"flex flex-col gap-2",children:[r.jsxs("label",{className:`text-xs uppercase tracking-wider ${le} flex items-center gap-2`,children:[r.jsx(ec,{className:"w-4 h-4"}),"Поиск по всем сферам ",r.jsxs("span",{className:"text-[11px] text-gray-500 dark:text-gray-400",children:[V.length,"/",e.length]})]}),r.jsx("input",{value:S,onChange:Y=>L(Y.target.value),placeholder:"тикер, событие, сеть, причина...",className:`w-full px-3 py-2 rounded-xl border ${H} ${s==="dark"?"bg-gray-800":"bg-gray-50"} ${ue} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]/60`})]}),r.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[r.jsx("span",{className:`text-xs ${le} uppercase tracking-wider`,children:"Сфера:"}),r.jsx("button",{onClick:()=>b("all"),className:`px-3 py-1.5 rounded-full text-sm font-semibold border ${k==="all"?Ke:we}`,children:"Все"}),Object.keys(ia).map(Y=>r.jsx("button",{onClick:()=>b(k===Y?"all":Y),className:`px-3 py-1.5 rounded-full text-sm font-semibold border ${k===Y?Ke:we}`,children:ia[Y].label},Y))]}),r.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[r.jsx("span",{className:`text-xs ${le} uppercase tracking-wider`,children:"Риск:"}),["all","low","medium","high","ultra"].map(Y=>r.jsx("button",{onClick:()=>j(Y),className:`px-3 py-1.5 rounded-full text-sm font-semibold border ${v===Y?Ke:we}`,children:Y==="all"?"Все":Y},Y))]}),r.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[r.jsx("span",{className:`text-xs ${le} uppercase tracking-wider`,children:"Трейдер:"}),r.jsxs("select",{value:N,onChange:Y=>y(Y.target.value),className:`px-3 py-2 rounded-lg border ${H} ${s==="dark"?"bg-gray-800 text-white":"bg-gray-50 text-gray-900"} text-sm focus:outline-none focus:ring-2 focus:ring-emerald-500/50`,children:[r.jsx("option",{value:"all",children:"Все трейдеры"}),$e.map(Y=>r.jsx("option",{value:Y.id,children:Y.name},Y.id))]})]}),r.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:[We("Всего сигналов",ye.total,ue),We("Активных",ye.active,"text-emerald-500"),We("Завершено",ye.completed,"text-blue-500"),We("High risk",ye.highRisk,"text-amber-500")]})]})}),i&&r.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-[70] flex items-start sm:items-center justify-center p-4 overflow-y-auto",children:r.jsx("div",{className:`${te} rounded-2xl shadow-2xl border ${H} max-w-3xl w-full max-h-[90vh] overflow-hidden`,children:r.jsxs("div",{className:"flex flex-col h-full",children:[r.jsxs("div",{className:`p-6 flex items-center justify-between sticky top-0 z-20 ${te} border-b ${H} shadow-sm`,children:[r.jsx("h2",{className:`text-2xl font-bold ${ue}`,children:w?"Редактировать сигнал":"Создать сигнал"}),r.jsx("button",{onClick:q,className:`p-2 rounded-xl ${s==="dark"?"hover:bg-gray-800":"hover:bg-gray-100"}`,children:r.jsx(Rt,{className:`w-5 h-5 ${le}`})})]}),r.jsx("div",{className:"px-6 pb-6 pt-2 overflow-y-auto flex-1 max-h-[75vh]",children:r.jsx(Pj,{callToEdit:w,onSuccess:F,onCancel:q,initialCategory:A})})]})})}),c&&r.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-[70] flex items-start sm:items-center justify-center p-4 overflow-y-auto overscroll-contain",children:r.jsx("div",{className:`${te} rounded-2xl shadow-2xl border ${H} max-w-md w-full`,children:r.jsxs("div",{className:"p-6 space-y-4",children:[r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx(Ut,{className:"w-6 h-6 text-red-500"}),r.jsxs("div",{children:[r.jsx("h3",{className:`text-xl font-bold ${ue}`,children:"Удалить сигнал?"}),r.jsx("p",{className:le,children:"Это действие нельзя отменить"})]})]}),r.jsxs("div",{className:"flex gap-3",children:[r.jsx("button",{onClick:()=>{d(!1),m(null)},className:`flex-1 px-4 py-3 rounded-xl border ${H} ${s==="dark"?"text-white":"text-gray-800"}`,children:"Отмена"}),r.jsx("button",{onClick:I,className:"flex-1 px-4 py-3 rounded-xl bg-red-600 text-white font-semibold hover:bg-red-700",children:"Удалить"})]})]})})}),x&&r.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-[70] flex items-start sm:items-center justify-center p-4 overflow-y-auto overscroll-contain",children:r.jsx("div",{className:`${te} rounded-2xl shadow-2xl border ${H} max-w-md w-full`,children:r.jsxs("div",{className:"p-6 space-y-4",children:[r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx(Ut,{className:"w-6 h-6 text-amber-500"}),r.jsxs("div",{children:[r.jsx("h3",{className:`text-xl font-bold ${ue}`,children:"Отменить сигнал?"}),r.jsx("p",{className:le,children:"Статус станет «Отменен», запись останется в списке."})]})]}),r.jsxs("div",{className:"flex gap-3",children:[r.jsx("button",{onClick:()=>f(null),className:`flex-1 px-4 py-3 rounded-xl border ${H} ${s==="dark"?"text-white":"text-gray-800"}`,children:"Отмена"}),r.jsx("button",{onClick:R,className:"flex-1 px-4 py-3 rounded-xl bg-amber-500 text-white font-semibold hover:bg-amber-600",children:"Отменить"})]})]})})}),!i&&r.jsx(r.Fragment,{children:n?r.jsxs("div",{className:`${te} rounded-2xl p-12 text-center ${H} border shadow-xl`,children:[r.jsx("div",{className:"animate-spin rounded-full h-14 w-14 border-4 border-[#4E6E49] border-t-transparent mx-auto mb-4"}),r.jsx("p",{className:`${le} text-lg`,children:"Загрузка сигналов..."})]}):e.length===0?r.jsxs("div",{className:`${te} rounded-[2rem] p-16 text-center ${H} border-2 shadow-2xl backdrop-blur-sm relative overflow-hidden group`,children:[r.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-[#4E6E49]/5 via-transparent to-emerald-500/5 opacity-0 group-hover:opacity-100 transition-opacity"}),r.jsx(pr,{className:`w-20 h-20 mx-auto mb-6 ${le} animate-pulse`}),r.jsx("p",{className:`text-2xl font-black ${ue} mb-2`,children:"Пока пусто"}),r.jsx("p",{className:`${le} text-lg`,children:"Создайте первый сигнал в новой структуре"})]}):V.length===0?r.jsxs("div",{className:`${te} rounded-2xl p-12 text-center ${H} border shadow-xl`,children:[r.jsx(pr,{className:`w-16 h-16 mx-auto mb-4 ${le}`}),r.jsx("p",{className:`text-xl font-bold ${ue}`,children:"Нет совпадений"}),r.jsxs("p",{className:le,children:["Сигналы есть (",e.length,"), но фильтр ничего не нашел."]})]}):r.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-5 px-4 py-2",children:V.map(Y=>{const G=ia[Y.category],Te=fi[Y.status]||fi.active,Re=oe(Y),Ue=U(Y),xe=$e.find(_e=>_e.id===Y.userId),lt=Ue.ticker||Ue.pair||Ue.coin||J(Y),Qe=new Date(Y.createdAt).toLocaleDateString("ru-RU",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"}),ct=pe[Y.category];return r.jsxs("div",{className:`rounded-3xl border-2 shadow-xl overflow-hidden transition-all hover:-translate-y-1 ${ct.border} ${ct.bg}`,children:[r.jsxs("div",{className:`px-5 py-4 flex flex-wrap items-center justify-between gap-3 border-b ${s==="dark"?"border-white/10 bg-white/5":"border-white/70 bg-white/70"}`,children:[r.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[r.jsxs("span",{className:`flex items-center gap-2 px-3 py-1.5 rounded-full text-sm font-semibold border ${ct.border} ${ct.chipBg||""} ${ct.text}`,children:[G.icon,G.label]}),r.jsx("span",{className:`px-3 py-1.5 rounded-full text-xs font-semibold ${Te.className}`,children:Te.label}),r.jsxs("span",{className:`px-3 py-1.5 rounded-full text-xs font-semibold ${Dh[Re]}`,children:["Риск: ",Re]})]}),r.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[r.jsxs("div",{className:`px-3 py-1.5 rounded-xl text-xs font-semibold border ${s==="dark"?"bg-gray-800/70 text-gray-200 border-white/10":"bg-white text-gray-700 border-gray-200"}`,children:[r.jsx("span",{className:"opacity-70",children:"Создано "}),Qe]}),xe&&r.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 rounded-xl border border-white/10 bg-black/5 dark:bg-white/5",children:[r.jsx("div",{className:"w-8 h-8 rounded-full bg-gradient-to-r from-[#4E6E49] to-emerald-600 text-white flex items-center justify-center text-sm font-bold",children:xe.name[0]}),r.jsx("span",{className:`text-xs ${le}`,children:xe.name})]}),r.jsxs("div",{className:"flex items-center gap-1",children:[r.jsx("button",{onClick:()=>M(Y),className:`p-2 rounded-lg ${s==="dark"?"hover:bg-gray-800":"hover:bg-gray-100"}`,children:r.jsx(cr,{className:"w-4 h-4"})}),Y.status!=="cancelled"&&r.jsx("button",{onClick:()=>f(Y.id),className:`p-2 rounded-lg ${s==="dark"?"hover:bg-gray-800":"hover:bg-gray-100"}`,children:r.jsx(Rt,{className:"w-4 h-4 text-amber-500"})}),r.jsx("button",{onClick:()=>z(Y.id),className:`p-2 rounded-lg ${s==="dark"?"hover:bg-gray-800":"hover:bg-gray-100"}`,children:r.jsx(Pt,{className:"w-4 h-4 text-red-500"})})]})]})]}),r.jsxs("div",{className:"p-5 space-y-5",children:[r.jsxs("div",{className:"grid md:grid-cols-[1.15fr_auto] gap-4 items-start",children:[r.jsxs("div",{className:"space-y-1",children:[r.jsx("p",{className:`text-2xl font-bold ${ue}`,children:J(Y)}),r.jsx("p",{className:`text-sm ${le}`,children:C(Y)})]}),r.jsx("div",{className:"flex flex-wrap gap-2 justify-end",children:r.jsx("button",{onClick:()=>O(lt),className:`p-2 rounded-xl border ${H} ${s==="dark"?"hover:bg-gray-800 bg-white/5":"hover:bg-gray-100 bg-white"} transition-colors`,title:"Копировать",children:K===lt?r.jsx(_r,{className:"w-4 h-4 text-emerald-500"}):r.jsx(va,{className:"w-4 h-4"})})})]}),Pe(Y)]})]},Y.id)})})})]})]})},Ls=({userId:s,className:e="",fallback:t="unknown",formatter:n})=>{const i=Io(s)||t;return r.jsx("span",{className:e,children:n?n(i):i})},Lj=({selectedUserId:s,slotFilter:e,onEditSlot:t,onEditStatus:n,refreshKey:a})=>{const{theme:i}=it(),{user:o}=bt(),{isAdmin:c}=_t(),[d,h]=E.useState([]),[m,x]=E.useState([]),[f,w]=E.useState(new Date),[$,A]=E.useState(!0),[T,K]=E.useState({}),P=ie(new Date,"yyyy-MM-dd"),S={artyom:"1",adel:"2",kseniya:"3",olga:"4",anastasia:"5"},L=B=>{const pe=$e.find(F=>F.id===B)||$e.find(F=>S[B]===F.id);return kt((pe==null?void 0:pe.id)||B)},ee=ed(f),D=s?$e.filter(B=>B.id===s):$e;E.useEffect(()=>{k()},[s,f,a]),E.useEffect(()=>{const B=()=>{k(!0)};return window.addEventListener("focus",B),()=>window.removeEventListener("focus",B)},[]);const k=async(B=!1)=>{B||A(!0);try{const pe=new Date(ee[0]);pe.setHours(0,0,0,0);const F=new Date(ee[6]);F.setHours(23,59,59,999);const q=ie(pe,"yyyy-MM-dd"),M=ie(F,"yyyy-MM-dd"),[z,I]=await Promise.all([wr(),is()]),R=z.filter(C=>C.date>=q&&C.date<=M),O=I.filter(C=>{const oe=C.date,ae=C.endDate||C.date;return oe<=M&&ae>=q}),U=s?R.filter(C=>C.userId===s):R,J=s?O.filter(C=>C.userId===s):O;h(U),x(J)}catch(pe){console.error("Error loading data:",pe)}finally{B||A(!1)}},b=async B=>{if(!c&&(o==null?void 0:o.id)!==B.userId){alert("Только администратор может удалять чужие слоты");return}if(c){confirm("Удалить слот?")&&(await So(B.id),k());return}confirm("Отправить на согласование удаление слота?")&&(await Nt({entity:"slot",action:"delete",authorId:(o==null?void 0:o.id)||B.userId,targetUserId:B.userId,before:B,after:null,comment:B.comment}),k())},v=async(B,pe)=>{if(!c&&(o==null?void 0:o.id)!==B.userId){alert("Только администратор может удалять чужие статусы");return}if(B.endDate&&pe){const F=B.date,q=B.endDate;if(pe===F){if(confirm(c?"Удалить первый день диапазона?":"Отправить на согласование удаление первого дня диапазона?")){const M=new Date(F+"T00:00:00");M.setDate(M.getDate()+1);const z=ie(M,"yyyy-MM-dd");c?await $s(B.id,{...B,date:z}):await Nt({entity:"status",action:"update",authorId:(o==null?void 0:o.id)||B.userId,targetUserId:B.userId,before:B,after:{...B,date:z},comment:B.comment}),k()}return}if(pe===q){if(confirm(c?"Удалить последний день диапазона?":"Отправить на согласование удаление последнего дня диапазона?")){const M=new Date(q+"T00:00:00");M.setDate(M.getDate()-1);const z=ie(M,"yyyy-MM-dd");c?await $s(B.id,{...B,endDate:z}):await Nt({entity:"status",action:"update",authorId:(o==null?void 0:o.id)||B.userId,targetUserId:B.userId,before:B,after:{...B,endDate:z},comment:B.comment}),k()}return}if(pe>F&&pe<q){if(confirm(c?"Удалить этот день? Диапазон будет разбит на две части.":"Отправить на согласование удаление этого дня? Диапазон будет разбит на две части.")){const M=new Date(pe+"T00:00:00");M.setDate(M.getDate()-1);const z=ie(M,"yyyy-MM-dd");if(c){await $s(B.id,{...B,endDate:z});const I=new Date(pe+"T00:00:00");I.setDate(I.getDate()+1);const R=ie(I,"yyyy-MM-dd");await Ao({userId:B.userId,date:R,endDate:q,type:B.type,comment:B.comment})}else{await Nt({entity:"status",action:"update",authorId:(o==null?void 0:o.id)||B.userId,targetUserId:B.userId,before:B,after:{...B,endDate:z},comment:B.comment});const I=new Date(pe+"T00:00:00");I.setDate(I.getDate()+1);const R=ie(I,"yyyy-MM-dd");await Nt({entity:"status",action:"create",authorId:(o==null?void 0:o.id)||B.userId,targetUserId:B.userId,before:null,after:{id:"",userId:B.userId,date:R,endDate:q,type:B.type,comment:B.comment},comment:B.comment})}k()}return}}c?confirm("Удалить статус?")&&(await Co(B.id),k()):confirm("Отправить на согласование удаление статуса?")&&(await Nt({entity:"status",action:"delete",authorId:(o==null?void 0:o.id)||B.userId,targetUserId:B.userId,before:B,after:null,comment:B.comment}),k())},j=B=>{const pe=Er(),F=new Date(pe);F.setHours(0,0,0,0);const q=new Date(B.date);if(q.setHours(0,0,0,0),q>F)return!0;if(q.getTime()===F.getTime()){const R=Er(),O=R.getHours()*60+R.getMinutes();return B.slots.some(U=>{if(U.endDate){const ae=new Date(U.endDate);if(ae.setHours(0,0,0,0),new Date(F).setHours(23,59,59),ae>F)return!0;if(ae.getTime()===F.getTime()){const[Z,ye]=U.end.split(":").map(Number);return Z*60+ye>O}return!1}const[J,C]=U.end.split(":").map(Number);return J*60+C>O})}const M=Er(),z=M.getHours()*60+M.getMinutes();return B.slots.some(R=>{if(R.endDate){const O=new Date(R.endDate);if(O.setHours(0,0,0,0),O>F)return!0;if(O.getTime()===F.getTime()){const[U,J]=R.end.split(":").map(Number);return U*60+J>z}return!1}return!1})},N=(B,pe)=>{const F=d.find(q=>q.userId===B&&q.date===pe)||null;if(F&&e!=="all"){const q=j(F);if(e==="upcoming"&&!q||e==="completed"&&q)return null}return F},y=(B,pe)=>m.find(F=>F.userId!==B?!1:F.endDate?F.date<=pe&&F.endDate>=pe:F.date===pe)||null,p=B=>{const{start:pe,end:F}=Gn(f),q=ie(pe,"yyyy-MM-dd"),M=ie(F,"yyyy-MM-dd"),R=d.filter(V=>V.userId===B).filter(V=>V.date>=q&&V.date<=M).reduce((V,Z)=>V+To(Z.slots),0),O=m.filter(V=>V.userId===B),U=V=>O.filter(Z=>Z.type===V).reduce((Z,ye)=>Z+or(ye.date,ye.endDate,q,M),0),J=U("dayoff"),C=U("sick"),oe=U("vacation"),ae=U("absence");return{totalHours:R,daysOff:J,sickDays:C,vacationDays:oe,absenceDays:ae}},te=B=>{const pe=new Date(f);B==="prev"?pe.setDate(pe.getDate()-7):pe.setDate(pe.getDate()+7),w(pe)},ue=B=>{K(pe=>({...pe,[B]:!pe[B]}))};if($)return r.jsx("div",{className:`rounded-lg p-8 text-center ${i==="dark"?"bg-[#1a1a1a]":"bg-white"}`,children:r.jsx("p",{className:i==="dark"?"text-gray-400":"text-gray-600",children:"Загрузка..."})});const le=i==="dark"?"text-white":"text-gray-900",H=i==="dark"?"text-gray-400":"text-gray-500",ne={dayoff:"bg-amber-500/10 text-amber-500 border border-amber-500/20",sick:"bg-orange-500/10 text-orange-500 border border-orange-500/20",vacation:"bg-sky-500/10 text-sky-500 border border-sky-500/20",absence:"bg-rose-500/10 text-rose-500 border border-rose-500/20"},ce={memecoins:{bg:"bg-emerald-100 dark:bg-emerald-900/40",text:"text-emerald-700 dark:text-emerald-300",border:"border-emerald-300 dark:border-emerald-700"},futures:{bg:"bg-blue-100 dark:bg-blue-900/40",text:"text-blue-700 dark:text-blue-300",border:"border-blue-300 dark:border-blue-700"},nft:{bg:"bg-purple-100 dark:bg-purple-900/40",text:"text-purple-700 dark:text-purple-300",border:"border-purple-300 dark:border-purple-700"},spot:{bg:"bg-amber-100 dark:bg-amber-900/40",text:"text-amber-700 dark:text-amber-300",border:"border-amber-300 dark:border-amber-700"},airdrop:{bg:"bg-cyan-100 dark:bg-cyan-900/40",text:"text-cyan-700 dark:text-cyan-300",border:"border-cyan-300 dark:border-cyan-700"},polymarket:{bg:"bg-pink-100 dark:bg-pink-900/40",text:"text-pink-700 dark:text-pink-300",border:"border-pink-300 dark:border-pink-700"},staking:{bg:"bg-indigo-100 dark:bg-indigo-900/40",text:"text-indigo-700 dark:text-indigo-300",border:"border-indigo-300 dark:border-indigo-700"}};return r.jsxs("div",{className:`rounded-2xl ${i==="dark"?"bg-[#0b1015]":"bg-white"} overflow-visible`,children:[r.jsxs("div",{className:`p-4 border-b ${i==="dark"?"border-white/5":"border-gray-100"} flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between`,children:[r.jsxs("button",{onClick:()=>te("prev"),className:`px-4 py-2 text-sm font-bold rounded-xl transition-all flex items-center gap-2 hover:scale-105 active:scale-95 ${i==="dark"?"bg-[#151a21] text-gray-300 hover:text-white hover:bg-[#1f2937]":"bg-gray-50 text-gray-600 hover:bg-gray-100"}`,children:[r.jsx(Ts,{className:"w-4 h-4 rotate-90"}),r.jsx("span",{children:"Пред. неделя"})]}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(gs,{className:`w-5 h-5 ${i==="dark"?"text-emerald-500":"text-emerald-600"}`}),r.jsxs("span",{className:`${le} font-black text-lg tracking-tight`,children:[ie(ee[0],"d MMMM")," — ",ie(ee[6],"d MMMM yyyy")]})]}),r.jsxs("button",{onClick:()=>te("next"),className:`px-4 py-2 text-sm font-bold rounded-xl transition-all flex items-center gap-2 hover:scale-105 active:scale-95 ${i==="dark"?"bg-[#151a21] text-gray-300 hover:text-white hover:bg-[#1f2937]":"bg-gray-50 text-gray-600 hover:bg-gray-100"}`,children:[r.jsx("span",{children:"След. неделя"}),r.jsx(Ts,{className:"w-4 h-4 -rotate-90"})]})]}),r.jsx("div",{className:"overflow-x-auto",children:r.jsx("div",{className:"min-w-full inline-block align-middle",children:r.jsxs("table",{className:"w-full border-collapse",children:[r.jsx("thead",{className:"sticky top-0 z-30",children:r.jsxs("tr",{className:`${i==="dark"?"bg-[#0b1015]":"bg-white"}`,children:[r.jsx("th",{className:`p-3 text-left text-[10px] font-bold uppercase tracking-wider ${H} sticky left-0 z-30 ${i==="dark"?"bg-[#0b1015]":"bg-white"}`,children:"Участник"}),ee.map(B=>{const pe=ie(B,"yyyy-MM-dd")===P;return r.jsx("th",{className:"p-1 min-w-[100px] lg:min-w-[120px]",children:r.jsxs("div",{className:`mx-auto w-full p-1.5 rounded-xl border transition-colors ${pe?"bg-emerald-500/10 border-emerald-500/50 text-emerald-500":i==="dark"?"bg-[#151a21] border-white/5 text-gray-400":"bg-gray-50 border-gray-100 text-gray-500"}`,children:[r.jsx("div",{className:"text-[9px] uppercase font-bold opacity-70 mb-0.5",children:ie(B,"EEE")}),r.jsx("div",{className:"text-xs font-black",children:ie(B,"dd.MM")})]})},B.toISOString())}),r.jsx("th",{className:`p-3 text-center text-[10px] font-bold uppercase tracking-wider ${H} min-w-[110px]`,children:"Итоги"})]})}),r.jsx("tbody",{className:`divide-y ${i==="dark"?"divide-white/5":"divide-gray-100"}`,children:D.map((B,pe)=>{const F=p(B.id),q=pe%2===0?i==="dark"?"bg-[#0f141a]":"bg-gray-50/30":"transparent";return r.jsxs("tr",{className:`${q} hover:bg-emerald-500/5 transition-colors group`,children:[r.jsx("td",{className:`p-2 sticky left-0 z-20 ${q} group-hover:bg-[#1a2029] transition-colors align-middle`,children:r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsxs("div",{className:"relative",children:[B.avatar?r.jsx("img",{src:B.avatar,alt:L(B.id),className:"w-8 h-8 rounded-full object-cover border border-emerald-500/20 shadow-sm",onError:M=>{const z=M.target;z.style.display="none";const I=z.nextElementSibling;I&&(I.style.display="flex")}}):null,r.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center font-bold text-xs ${i==="dark"?"bg-[#1f2937] text-gray-300":"bg-gray-200 text-gray-600"} ${B.avatar?"absolute inset-0 hidden":""}`,children:r.jsx(Ls,{userId:B.id,formatter:M=>M.charAt(0).toUpperCase()})}),r.jsx("div",{className:"absolute -bottom-0.5 -right-0.5 w-2.5 h-2.5 rounded-full bg-emerald-500 border-2 border-[#0b1015]"})]}),r.jsxs("div",{children:[r.jsx("div",{className:`font-bold text-[13px] leading-tight ${le}`,children:r.jsx(Ls,{userId:B.id})}),r.jsx("div",{className:"text-[9px] text-gray-500 font-medium uppercase tracking-tight",children:"Member"})]})]})}),ee.map(M=>{const z=ie(M,"yyyy-MM-dd"),I=N(B.id,z),R=y(B.id,z);return r.jsx("td",{className:"p-1.5 align-middle",children:I?r.jsx("div",{className:"flex flex-col items-center gap-1.5",children:I.slots.map((O,U)=>{var oe,ae,V,Z;const J=`${I.id}-${U}`,C=T[J];return r.jsxs("div",{className:"w-full flex flex-col items-center gap-1.5 group/timecard",children:[r.jsxs("div",{className:`w-full max-w-[120px] rounded-xl p-2 text-[10px] font-bold transition-all relative overflow-hidden shadow-md ${i==="dark"?"bg-[#1a1f26] border border-white/5 text-gray-200":"bg-gray-100 text-gray-700"}`,children:[r.jsxs("div",{className:"flex flex-col items-center gap-1.5",children:[r.jsxs("div",{className:"flex items-center gap-1 opacity-80",children:[r.jsx(Dr,{className:"w-3 h-3"}),r.jsxs("span",{className:"whitespace-nowrap tracking-tight",children:[O.start," - ",O.end]})]}),I.category&&r.jsx("span",{className:`text-[9px] px-1.5 py-0.5 rounded-full border font-medium ${((oe=ce[I.category])==null?void 0:oe.bg)||"bg-gray-100 dark:bg-gray-800"} ${((ae=ce[I.category])==null?void 0:ae.text)||"text-gray-700 dark:text-gray-300"} ${((V=ce[I.category])==null?void 0:V.border)||"border-gray-300 dark:border-gray-600"}`,children:((Z=bn[I.category])==null?void 0:Z.label)||I.category}),O.breaks&&O.breaks.length>0&&r.jsx("button",{onClick:()=>ue(J),className:"p-0.5 hover:bg-white/10 rounded-md transition-colors",children:C?r.jsx(Gh,{className:"w-3 h-3"}):r.jsx(Ts,{className:"w-3 h-3"})})]}),C&&O.breaks&&O.breaks.length>0&&r.jsx("div",{className:"mt-1.5 pt-1.5 border-t border-white/10 space-y-0.5 w-full text-center",children:O.breaks.map((ye,we)=>r.jsxs("div",{className:"text-[9px] opacity-70 font-medium",children:[ye.start," - ",ye.end]},we))})]}),r.jsxs("div",{className:"flex items-center gap-2 opacity-0 group-hover/timecard:opacity-100 transition-opacity duration-200",children:[r.jsx("button",{onClick:()=>t(I),className:`transition-all hover:scale-110 ${i==="dark"?"text-blue-400 hover:text-blue-300":"text-blue-600 hover:text-blue-500"}`,children:r.jsx(cr,{className:"w-3.5 h-3.5"})}),r.jsx("button",{onClick:()=>b(I),className:`transition-all hover:scale-110 ${i==="dark"?"text-rose-500 hover:text-rose-400":"text-rose-600 hover:text-rose-500"}`,children:r.jsx(Pt,{className:"w-3.5 h-3.5"})})]})]},U)})}):R?r.jsxs("div",{className:"flex flex-col items-center gap-1.5 group/status",children:[r.jsx("div",{className:`w-full max-w-[120px] rounded-lg p-2 text-[10px] font-black text-center border shadow-sm ${i==="dark"?"bg-[#2A3441]/40":"bg-white"} ${ne[R.type]}`,children:R.type==="dayoff"?"Выходной":R.type==="sick"?"Больничный":R.type==="vacation"?"Отпуск":"Прогул"}),r.jsxs("div",{className:"flex items-center gap-2 opacity-0 group-hover/status:opacity-100 transition-opacity duration-200",children:[r.jsx("button",{onClick:()=>n(R),className:`transition-all hover:scale-110 ${i==="dark"?"text-blue-400 hover:text-blue-300":"text-blue-600 hover:text-blue-500"}`,children:r.jsx(cr,{className:"w-3.5 h-3.5"})}),r.jsx("button",{onClick:()=>v(R,z),className:`transition-all hover:scale-110 ${i==="dark"?"text-rose-500 hover:text-rose-400":"text-rose-600 hover:text-rose-500"}`,children:r.jsx(Pt,{className:"w-3.5 h-3.5"})})]})]}):r.jsx("div",{className:"h-8 w-full max-w-[120px] mx-auto rounded-lg border border-dashed border-gray-700/20 dark:border-white/5 opacity-20"})},z)}),r.jsx("td",{className:"p-2 align-middle",children:r.jsxs("div",{className:"space-y-1 py-1 min-w-[110px] text-center ml-2",children:[r.jsxs("div",{className:`text-[12px] font-medium leading-tight ${le}`,children:["Часов: ",F.totalHours.toFixed(1)]}),r.jsxs("div",{className:`text-[12px] font-medium leading-tight ${le}`,children:["Выходных: ",F.daysOff]}),r.jsxs("div",{className:`text-[12px] font-medium leading-tight ${le}`,children:["Больничных: ",F.sickDays]}),r.jsxs("div",{className:`text-[12px] font-medium leading-tight ${le}`,children:["Отпусков: ",F.vacationDays]}),r.jsxs("div",{className:`text-[12px] font-medium leading-tight ${le}`,children:["Прогулов: ",F.absenceDays]})]})})]},B.id)})})]})})})]})},Fj=({selectedUserId:s,slotFilter:e,onEditSlot:t,onEditStatus:n,refreshKey:a})=>{const{theme:i}=it(),{user:o}=bt(),{isAdmin:c}=_t(),[d,h]=E.useState([]),[m,x]=E.useState([]),[f,w]=E.useState(new Date),[$,A]=E.useState(!0),[T,K]=E.useState({}),P={artyom:"1",adel:"2",kseniya:"3",olga:"4",anastasia:"5"},S=H=>{const ne=$e.find(ce=>ce.id===H)||$e.find(ce=>P[H]===ce.id);return{member:ne,displayName:kt((ne==null?void 0:ne.id)||H)}},L=ed(f),ee=new Date;E.useEffect(()=>{D()},[s,f,a]),E.useEffect(()=>{const H=()=>{D(!0)};return window.addEventListener("focus",H),()=>window.removeEventListener("focus",H)},[]);const D=async(H=!1)=>{H||A(!0);try{const ne=new Date(L[0]);ne.setHours(0,0,0,0);const ce=new Date(L[6]);ce.setHours(23,59,59,999);const B=ie(ne,"yyyy-MM-dd"),pe=ie(ce,"yyyy-MM-dd"),[F,q]=await Promise.all([wr(),is()]),M=F.filter(O=>O.date>=B&&O.date<=pe),z=q.filter(O=>{const U=O.date,J=O.endDate||O.date;return U<=pe&&J>=B}),I=s?M.filter(O=>O.userId===s):M,R=s?z.filter(O=>O.userId===s):z;console.log("Loaded slots (week view):",{weekStart:B,weekEnd:pe,allSlotsCount:F.length,weekSlotsCount:M.length,filteredSlotsCount:I.length,selectedUserId:s}),h(I),x(R)}catch(ne){console.error("Error loading data:",ne)}finally{H||A(!1)}},k=async H=>{if(!c&&(o==null?void 0:o.id)!==H.userId){alert("Только администратор может удалять чужие слоты");return}if(c){confirm("Удалить слот?")&&(await So(H.id),D());return}confirm("Отправить на согласование удаление слота?")&&(await Nt({entity:"slot",action:"delete",authorId:(o==null?void 0:o.id)||H.userId,targetUserId:H.userId,before:H,after:null,comment:H.comment}),D())},b=async(H,ne)=>{if(!c&&(o==null?void 0:o.id)!==H.userId){alert("Только администратор может удалять чужие статусы");return}if(H.endDate&&ne){const ce=H.date,B=H.endDate;if(ne===ce){if(confirm(c?"Удалить первый день диапазона?":"Отправить на согласование удаление первого дня диапазона?")){const pe=new Date(jr(ce));pe.setDate(pe.getDate()+1);const F=ie(pe,"yyyy-MM-dd");c?await $s(H.id,{...H,date:F}):await Nt({entity:"status",action:"update",authorId:(o==null?void 0:o.id)||H.userId,targetUserId:H.userId,before:H,after:{...H,date:F},comment:H.comment}),D()}return}if(ne===B){if(confirm(c?"Удалить последний день диапазона?":"Отправить на согласование удаление последнего дня диапазона?")){const pe=new Date(jr(B));pe.setDate(pe.getDate()-1);const F=ie(pe,"yyyy-MM-dd");c?await $s(H.id,{...H,endDate:F}):await Nt({entity:"status",action:"update",authorId:(o==null?void 0:o.id)||H.userId,targetUserId:H.userId,before:H,after:{...H,endDate:F},comment:H.comment}),D()}return}if(ne>ce&&ne<B){if(confirm(c?"Удалить этот день? Диапазон будет разбит на две части.":"Отправить на согласование удаление этого дня? Диапазон будет разбит на две части.")){const pe=new Date(jr(ne));pe.setDate(pe.getDate()-1);const F=ie(pe,"yyyy-MM-dd");if(c){await $s(H.id,{...H,endDate:F});const q=new Date(jr(ne));q.setDate(q.getDate()+1);const M=ie(q,"yyyy-MM-dd");await Ao({userId:H.userId,date:M,endDate:B,type:H.type,comment:H.comment})}else{await Nt({entity:"status",action:"update",authorId:(o==null?void 0:o.id)||H.userId,targetUserId:H.userId,before:H,after:{...H,endDate:F},comment:H.comment});const q=new Date(jr(ne));q.setDate(q.getDate()+1);const M=ie(q,"yyyy-MM-dd");await Nt({entity:"status",action:"create",authorId:(o==null?void 0:o.id)||H.userId,targetUserId:H.userId,before:null,after:{id:"",userId:H.userId,date:M,endDate:B,type:H.type,comment:H.comment},comment:H.comment})}D()}return}}c?confirm("Удалить статус?")&&(await Co(H.id),D()):confirm("Отправить на согласование удаление статуса?")&&(await Nt({entity:"status",action:"delete",authorId:(o==null?void 0:o.id)||H.userId,targetUserId:H.userId,before:H,after:null,comment:H.comment}),D())},v=H=>{const ne=Er(),ce=new Date(ne);ce.setHours(0,0,0,0);const B=new Date(H.date);if(B.setHours(0,0,0,0),B>ce)return!0;if(B.getTime()===ce.getTime()){const M=Er(),z=M.getHours()*60+M.getMinutes();return H.slots.some(I=>{if(I.endDate){const J=new Date(I.endDate);if(J.setHours(0,0,0,0),new Date(ce).setHours(23,59,59),J>ce)return!0;if(J.getTime()===ce.getTime()){const[oe,ae]=I.end.split(":").map(Number);return oe*60+ae>z}return!1}const[R,O]=I.end.split(":").map(Number);return R*60+O>z})}const pe=Er(),F=pe.getHours()*60+pe.getMinutes();return H.slots.some(M=>{if(M.endDate){const z=new Date(M.endDate);if(z.setHours(0,0,0,0),z>ce)return!0;if(z.getTime()===ce.getTime()){const[I,R]=M.end.split(":").map(Number);return I*60+R>F}return!1}return!1})},j=H=>{let ne=d.filter(ce=>ce.date===H);return e!=="all"&&(ne=ne.filter(ce=>{const B=v(ce);return e==="upcoming"?B:e==="completed"?!B:!0})),ne},N=H=>m.filter(ne=>ne.endDate?ne.date<=H&&ne.endDate>=H:ne.date===H),y=H=>{const ne=new Date(f);H==="prev"?ne.setDate(ne.getDate()-7):ne.setDate(ne.getDate()+7),w(ne)},p=H=>{K(ne=>({...ne,[H]:!ne[H]}))};if($)return r.jsx("div",{className:`rounded-lg p-8 text-center ${i==="dark"?"bg-[#1a1a1a]":"bg-white"}`,children:r.jsx("p",{className:i==="dark"?"text-gray-400":"text-gray-600",children:"Загрузка..."})});const te=i==="dark"?"text-white":"text-gray-900",ue={dayoff:"bg-amber-500/10 text-amber-500 border border-amber-500/20",sick:"bg-orange-500/10 text-orange-500 border border-orange-500/20",vacation:"bg-sky-500/10 text-sky-500 border border-sky-500/20",absence:"bg-rose-500/10 text-rose-500 border border-rose-500/20"},le={memecoins:{bg:"bg-emerald-100 dark:bg-emerald-900/40",text:"text-emerald-700 dark:text-emerald-300",border:"border-emerald-300 dark:border-emerald-700"},futures:{bg:"bg-blue-100 dark:bg-blue-900/40",text:"text-blue-700 dark:text-blue-300",border:"border-blue-300 dark:border-blue-700"},nft:{bg:"bg-purple-100 dark:bg-purple-900/40",text:"text-purple-700 dark:text-purple-300",border:"border-purple-300 dark:border-purple-700"},spot:{bg:"bg-amber-100 dark:bg-amber-900/40",text:"text-amber-700 dark:text-amber-300",border:"border-amber-300 dark:border-amber-700"},airdrop:{bg:"bg-cyan-100 dark:bg-cyan-900/40",text:"text-cyan-700 dark:text-cyan-300",border:"border-cyan-300 dark:border-cyan-700"},polymarket:{bg:"bg-pink-100 dark:bg-pink-900/40",text:"text-pink-700 dark:text-pink-300",border:"border-pink-300 dark:border-pink-700"},staking:{bg:"bg-indigo-100 dark:bg-indigo-900/40",text:"text-indigo-700 dark:text-indigo-300",border:"border-indigo-300 dark:border-indigo-700"}};return r.jsxs("div",{className:`rounded-2xl ${i==="dark"?"bg-transparent":"bg-white"} overflow-visible`,children:[r.jsxs("div",{className:`p-3 sm:p-4 border-b ${i==="dark"?"border-white/5":"border-gray-100"} flex flex-col gap-2 sm:gap-3 sm:flex-row sm:items-center sm:justify-between`,children:[r.jsxs("button",{onClick:()=>y("prev"),className:`px-4 py-2 text-sm font-bold rounded-xl transition-all flex items-center gap-2 hover:scale-105 active:scale-95 ${i==="dark"?"bg-[#151a21] text-gray-300 hover:text-white hover:bg-[#1f2937]":"bg-gray-50 text-gray-600 hover:bg-gray-100"}`,children:[r.jsx(Ts,{className:"w-4 h-4 rotate-90"}),r.jsx("span",{children:"Пред. неделя"})]}),r.jsxs("span",{className:`${te} font-black text-lg tracking-tight whitespace-nowrap`,children:[ie(L[0],"d MMMM")," — ",ie(L[6],"d MMMM yyyy")]}),r.jsxs("button",{onClick:()=>y("next"),className:`px-4 py-2 text-sm font-bold rounded-xl transition-all flex items-center gap-2 hover:scale-105 active:scale-95 ${i==="dark"?"bg-[#151a21] text-gray-300 hover:text-white hover:bg-[#1f2937]":"bg-gray-50 text-gray-600 hover:bg-gray-100"}`,children:[r.jsx("span",{children:"След. неделя"}),r.jsx(Ts,{className:"w-4 h-4 -rotate-90"})]})]}),r.jsx("div",{className:"p-3 sm:p-4 space-y-3 sm:space-y-4",children:L.map(H=>{const ne=ie(H,"yyyy-MM-dd"),ce=j(ne),B=N(ne),pe=T0(H,ee),F="relative rounded-xl p-4 sm:p-5 border transition-all duration-300",q=i==="dark"?"bg-[#0b1015] border-white/5 shadow-md":"bg-gray-50 border-gray-200 shadow-sm",M=i==="dark"?"border-emerald-500/50 bg-emerald-500/5 ring-1 ring-emerald-500/20":"border-emerald-300 bg-emerald-50 ring-2 ring-emerald-200/70";return r.jsxs("div",{className:`${F} ${q} ${pe?M:""}`,children:[pe&&r.jsxs("div",{className:"absolute top-3 right-3 inline-flex items-center gap-2 px-3 py-1 rounded-full bg-emerald-500 text-white text-xs font-semibold shadow-lg ring-2 ring-white/50 dark:ring-emerald-200/30",children:[r.jsx("span",{className:"w-2 h-2 rounded-full bg-white animate-ping"}),r.jsx("span",{className:"relative",children:"Сегодня"})]}),r.jsx("h3",{className:`text-lg font-semibold mb-3 ${te}`,children:ie(H,"dd.MM.yyyy")}),r.jsxs("div",{className:"space-y-3 sm:space-y-4",children:[B.map(z=>{const{displayName:I}=S(z.userId);return r.jsxs("div",{className:`relative flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 p-4 rounded-2xl border-2 transition-all duration-300 hover:shadow-xl backdrop-blur text-center sm:text-left ring-1 ring-inset ring-black/5 dark:ring-white/5 ${ue[z.type]}`,children:[r.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2 justify-center sm:justify-start w-full",children:[r.jsx("span",{className:"font-semibold text-base sm:text-lg",children:I}),r.jsx("span",{className:"inline-flex items-center gap-2 px-3 py-1 rounded-full bg-white/70 dark:bg-white/10 text-xs sm:text-sm font-semibold",children:z.type==="dayoff"?"Выходной":z.type==="sick"?"Больничный":z.type==="vacation"?"Отпуск":"Прогул"})]}),r.jsx("div",{className:"flex gap-2 justify-center sm:justify-end w-full",children:c||(o==null?void 0:o.id)===z.userId?r.jsxs(r.Fragment,{children:[r.jsx("button",{onClick:()=>n(z),className:`p-1 rounded transition-colors ${i==="dark"?"bg-white/10 hover:bg-white/20 text-white":"bg-white border border-gray-200 text-gray-700 hover:bg-gray-100"}`,children:r.jsx(cr,{className:"w-4 h-4 text-current"})}),r.jsx("button",{onClick:()=>b(z,ne),className:`p-1 rounded transition-colors ${i==="dark"?"bg-white/10 hover:bg-white/20 text-white":"bg-white border border-gray-200 text-gray-700 hover:bg-gray-100"}`,children:r.jsx(Pt,{className:"w-4 h-4 text-current"})})]}):r.jsxs(r.Fragment,{children:[r.jsx("button",{disabled:!0,className:`p-1 cursor-not-allowed rounded ${i==="dark"?"bg-white/5 text-white/60":"bg-gray-100 text-gray-400 border border-gray-200"}`,title:"Вы можете редактировать только свои статусы",children:r.jsx(cr,{className:"w-4 h-4 text-current opacity-60"})}),r.jsx("button",{disabled:!0,className:`p-1 cursor-not-allowed rounded ${i==="dark"?"bg-white/5 text-white/60":"bg-gray-100 text-gray-400 border border-gray-200"}`,title:"Вы можете удалять только свои статусы",children:r.jsx(Pt,{className:"w-4 h-4 text-current opacity-60"})})]})})]},z.id)}),ce.map(z=>{const{member:I,displayName:R}=S(z.userId),O=v(z),U=O?"bg-gradient-to-r from-emerald-500 to-teal-600 border-emerald-300/40":"bg-gradient-to-r from-slate-500 to-slate-700 border-slate-300/40",J=O?gs:Ra;return r.jsxs("div",{className:`group relative space-y-2 sm:space-y-3 p-3 sm:p-4 ${U} rounded-lg sm:rounded-xl shadow-xl border-2 transition-all duration-300 hover:shadow-2xl active:scale-[0.98] sm:hover:scale-[1.03] mb-2 sm:mb-3 ${O?"hover:border-emerald-200/80 ring-2 ring-emerald-200/40 hover:ring-4 hover:ring-emerald-200/60":"hover:border-slate-200/80 ring-2 ring-slate-200/40 hover:ring-4 hover:ring-slate-200/60"}`,children:[r.jsxs("div",{className:"flex items-center justify-between border-b border-white/20 pb-2 sm:pb-3",children:[r.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 min-w-0 flex-1",children:[r.jsxs("div",{className:"relative flex-shrink-0 group/avatar",children:[I!=null&&I.avatar?r.jsx("img",{src:I.avatar,alt:R,className:`w-8 h-8 sm:w-9 sm:h-9 md:w-10 md:h-10 lg:w-11 lg:h-11 rounded-full object-cover border-2 shadow-xl transition-all duration-300 group-hover/avatar:scale-110 group-hover/avatar:shadow-2xl ${O?"border-white/50 ring-2 ring-white/40 ring-offset-2 ring-offset-emerald-400/30 group-hover/avatar:ring-4 group-hover/avatar:ring-white/60":"border-white/40 ring-2 ring-white/30 ring-offset-2 ring-offset-slate-400/30 group-hover/avatar:ring-4 group-hover/avatar:ring-white/50"}`,onError:C=>{const oe=C.target;oe.style.display="none";const ae=oe.nextElementSibling;ae&&(ae.style.display="flex")}}):null,r.jsx("div",{className:`w-8 h-8 sm:w-9 sm:h-9 md:w-10 md:h-10 lg:w-11 lg:h-11 rounded-full flex items-center justify-center font-bold text-xs sm:text-sm transition-all duration-300 shadow-xl group-hover/avatar:scale-110 group-hover/avatar:shadow-2xl ${O?"bg-white/25 backdrop-blur-md border-2 border-white/40 ring-2 ring-white/30 group-hover/avatar:ring-4 group-hover/avatar:ring-white/60":"bg-white/15 backdrop-blur-md border-2 border-white/30 ring-2 ring-white/20 group-hover/avatar:ring-4 group-hover/avatar:ring-white/50"} ${I!=null&&I.avatar?"absolute inset-0 hidden":""}`,children:R.charAt(0).toUpperCase()}),r.jsx("div",{className:`absolute -bottom-0.5 -right-0.5 w-2.5 h-2.5 sm:w-3 sm:h-3 md:w-3.5 md:h-3.5 rounded-full border border-white sm:border-2 shadow-lg animate-pulse opacity-0 group-hover/avatar:opacity-100 transition-opacity duration-300 ${O?"bg-emerald-300":"bg-slate-400"}`})]}),r.jsx("span",{className:"text-white font-bold text-sm sm:text-base group-hover:scale-105 transition-transform duration-300 truncate",children:R})]}),r.jsx("div",{className:"flex gap-2",children:c||(o==null?void 0:o.id)===z.userId?r.jsxs(r.Fragment,{children:[r.jsx("button",{onClick:()=>t(z),className:"p-1.5 bg-white/20 hover:bg-white/30 rounded-lg transition-colors",children:r.jsx(cr,{className:"w-4 h-4 text-white"})}),r.jsx("button",{onClick:()=>k(z),className:"p-1.5 bg-white/20 hover:bg-white/30 rounded-lg transition-colors",children:r.jsx(Pt,{className:"w-4 h-4 text-white"})})]}):r.jsxs(r.Fragment,{children:[r.jsx("button",{disabled:!0,className:"p-1.5 bg-white/10 cursor-not-allowed rounded-lg",title:"Вы можете редактировать только свои слоты",children:r.jsx(cr,{className:"w-4 h-4 text-white/50"})}),r.jsx("button",{disabled:!0,className:"p-1.5 bg-white/10 cursor-not-allowed rounded-lg",title:"Вы можете удалять только свои слоты",children:r.jsx(Pt,{className:"w-4 h-4 text-white/50"})})]})})]}),r.jsx("div",{className:"space-y-2",children:z.slots.map((C,oe)=>{var ae,V,Z,ye;return r.jsxs("div",{className:"space-y-1.5",children:[r.jsx("div",{className:`bg-white/25 backdrop-blur-md rounded-md sm:rounded-lg px-2 sm:px-3 py-1.5 sm:py-2 border-2 transition-all duration-300 hover:scale-105 hover:shadow-xl ${O?"border-white/40 ring-2 ring-white/20 hover:border-white/60 hover:ring-4 hover:ring-white/40":"border-white/30 ring-2 ring-white/10 hover:border-white/50 hover:ring-4 hover:ring-white/30"}`,children:r.jsxs("div",{className:"flex items-center gap-1.5 sm:gap-2 flex-wrap",children:[r.jsx(J,{className:`w-3.5 h-3.5 sm:w-4 sm:h-4 text-white flex-shrink-0 ${O?"animate-pulse":""}`}),r.jsxs("span",{className:"text-white font-bold text-xs sm:text-sm whitespace-nowrap",children:[C.start," - ",C.end]}),C.endDate&&r.jsxs("span",{className:"text-white/80 font-medium text-[10px] sm:text-xs whitespace-nowrap",children:["(до ",ie(new Date(C.endDate),"dd.MM"),")"]}),z.category&&r.jsx("span",{className:`text-[10px] px-1.5 py-0.5 rounded-full border font-medium whitespace-nowrap ${((ae=le[z.category])==null?void 0:ae.bg)||"bg-white/20"} ${((V=le[z.category])==null?void 0:V.text)||"text-white"} ${((Z=le[z.category])==null?void 0:Z.border)||"border-white/30"}`,children:((ye=bn[z.category])==null?void 0:ye.label)||z.category})]})}),C.breaks&&C.breaks.length>0&&r.jsx("div",{className:"flex justify-center",children:r.jsx("button",{onClick:()=>p(z.id),className:`p-1 rounded-md transition-all duration-200 hover:scale-110 ${T[z.id]?"text-white hover:text-white/80":"text-white/70 hover:text-white"}`,title:T[z.id]?"Скрыть перерывы":"Показать перерывы",children:T[z.id]?r.jsx(Gh,{className:"w-4 h-4"}):r.jsx(Ts,{className:"w-4 h-4"})})}),C.breaks&&C.breaks.length>0&&T[z.id]&&r.jsxs("div",{className:"space-y-1 w-full",children:[r.jsx("div",{className:`text-[10px] ${i==="dark"?"text-gray-300":"text-gray-700"} font-medium text-center sm:text-left`,children:"Перерывы:"}),C.breaks.map((we,Ke)=>r.jsx("div",{className:`${i==="dark"?"bg-gray-700/95":"bg-white"} ${i==="dark"?"text-gray-200":"text-gray-900"} border-2 ${i==="dark"?"border-orange-500/60":"border-orange-300"} rounded-md sm:rounded-lg px-2 sm:px-3 py-1 sm:py-1.5 text-[10px] sm:text-xs font-semibold shadow-lg transition-all duration-300 hover:scale-105 hover:shadow-xl ${i==="dark"?"hover:border-orange-400/80 hover:shadow-orange-500/30 ring-2 ring-orange-500/20 hover:ring-4 hover:ring-orange-400/40":"hover:border-orange-400 hover:shadow-orange-400/30 ring-2 ring-orange-300/20 hover:ring-4 hover:ring-orange-300/40"} w-full`,children:r.jsxs("span",{className:"flex items-center gap-1 sm:gap-1.5 justify-center flex-wrap w-full",children:[r.jsx("span",{className:`w-1 h-1 sm:w-1.5 sm:h-1.5 rounded-full ${i==="dark"?"bg-orange-400":"bg-orange-500"} animate-pulse flex-shrink-0`}),r.jsxs("span",{className:"whitespace-nowrap",children:[we.start," - ",we.end]})]})},Ke))]})]},oe)})})]},z.id)}),ce.length===0&&B.length===0&&ne===ie(ee,"yyyy-MM-dd")&&r.jsx("div",{className:`rounded-lg px-3 py-2 text-xs font-semibold ring-1 ring-inset ring-black/5 dark:ring-white/10 ${ue.absence}`,children:"Прогул"}),ce.length===0&&B.length===0&&ne!==ie(ee,"yyyy-MM-dd")&&r.jsx("p",{className:`text-sm ${i==="dark"?"text-gray-400":"text-gray-600"}`,children:"Нет данных"})]})]},ne)})})]})},Uj=({selectedUserId:s,onSelect:e})=>{const{theme:t}=it(),[n,a]=E.useState(!1),[i,o]=E.useState(""),c=E.useRef(null),d=$e.find(x=>x.id===s),h=Io(s||"");E.useEffect(()=>{const x=f=>{c.current&&!c.current.contains(f.target)&&a(!1)};return document.addEventListener("mousedown",x),()=>document.removeEventListener("mousedown",x)},[]);const m=$e.filter(x=>{const f=x.name.toLowerCase(),w=x.login.toLowerCase(),$=i.toLowerCase();return f.includes($)||w.includes($)});return r.jsxs("div",{className:"relative w-full",ref:c,children:[r.jsxs("button",{onClick:()=>a(!n),className:`w-full flex items-center justify-between gap-3 px-4 py-2.5 rounded-xl border transition-all ${t==="dark"?"bg-[#151a21] border-white/5 text-gray-300 hover:border-emerald-500/30":"bg-gray-50 border-gray-200 text-gray-700 hover:border-emerald-500"}`,children:[r.jsx("div",{className:"flex items-center gap-2.5 overflow-hidden",children:d?r.jsxs(r.Fragment,{children:[d.avatar?r.jsx("img",{src:d.avatar,alt:"",className:"w-5 h-5 rounded-full object-cover flex-shrink-0"}):r.jsx("div",{className:"w-5 h-5 rounded-full flex items-center justify-center text-[10px] bg-emerald-500/20 text-emerald-500 flex-shrink-0",children:r.jsx(Ys,{size:12})}),r.jsx("span",{className:"text-sm font-bold truncate",children:h||d.name})]}):r.jsxs(r.Fragment,{children:[r.jsx("div",{className:"w-5 h-5 rounded-full flex items-center justify-center border border-dashed border-gray-500 flex-shrink-0",children:r.jsx(Ys,{size:12,className:"text-gray-500"})}),r.jsx("span",{className:"text-sm font-semibold text-gray-500",children:"Все участники..."})]})}),r.jsx(Ts,{size:16,className:`text-gray-500 transition-transform ${n?"rotate-180":""}`})]}),n&&r.jsxs("div",{className:`absolute z-50 top-full mt-2 w-full min-w-[240px] rounded-2xl border shadow-2xl overflow-hidden animate-in fade-in slide-in-from-top-2 duration-200 ${t==="dark"?"bg-[#1a1f26] border-white/10":"bg-white border-gray-200"}`,children:[r.jsx("div",{className:"p-3 border-b border-white/5",children:r.jsxs("div",{className:"relative",children:[r.jsx(ec,{size:14,className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-500"}),r.jsx("input",{type:"text",placeholder:"Поиск участника...",value:i,onChange:x=>o(x.target.value),className:`w-full pl-9 pr-8 py-2 rounded-lg text-xs font-medium outline-none transition-all ${t==="dark"?"bg-black/20 text-gray-300 focus:bg-black/40":"bg-gray-100 text-gray-700 focus:bg-gray-200"}`,autoFocus:!0}),i&&r.jsx("button",{onClick:()=>o(""),className:"absolute right-2 top-1/2 -translate-y-1/2 p-1 hover:text-rose-500",children:r.jsx(Rt,{size:12})})]})}),r.jsxs("div",{className:"max-h-[300px] overflow-y-auto p-1.5 custom-scrollbar",children:[r.jsxs("button",{onClick:()=>{e(null),a(!1)},className:`w-full flex items-center gap-3 px-3 py-2 rounded-lg transition-all text-left ${s?t==="dark"?"hover:bg-white/5 text-gray-400":"hover:bg-gray-50 text-gray-600":t==="dark"?"bg-emerald-500/10 text-emerald-400":"bg-emerald-50 text-emerald-600"}`,children:[r.jsx("div",{className:"w-6 h-6 rounded-full flex items-center justify-center border border-dashed border-gray-500 text-[10px]",children:r.jsx(Ys,{size:12})}),r.jsx("span",{className:"text-xs font-bold",children:"Все участники"})]}),m.map(x=>r.jsx(Bj,{member:x,isSelected:s===x.id,onSelect:f=>{e(f),a(!1)},theme:t},x.id)),m.length===0&&r.jsx("div",{className:"p-4 text-center",children:r.jsx("p",{className:"text-[10px] text-gray-500",children:"Никого не нашли :("})})]})]})]})},Bj=({member:s,isSelected:e,onSelect:t,theme:n})=>{const a=Io(s.id);return r.jsxs("button",{onClick:()=>t(s.id),className:`w-full flex items-center gap-3 px-3 py-2 rounded-lg transition-all text-left group ${e?n==="dark"?"bg-emerald-500/10 text-emerald-400":"bg-emerald-50 text-emerald-600":n==="dark"?"hover:bg-white/5 text-gray-300":"hover:bg-gray-50 text-gray-700"}`,children:[r.jsx("div",{className:"relative",children:s.avatar?r.jsx("img",{src:s.avatar,alt:"",className:"w-6 h-6 rounded-full object-cover group-hover:ring-2 ring-emerald-500/30 transition-all"}):r.jsx("div",{className:`w-6 h-6 rounded-full flex items-center justify-center text-[10px] ${e?"bg-emerald-500/20 text-emerald-500":"bg-gray-500/10 text-gray-500"}`,children:s.name[0]})}),r.jsxs("div",{className:"flex flex-col min-w-0",children:[r.jsx("span",{className:"text-xs font-bold truncate",children:a||s.name}),r.jsx("span",{className:"text-[9px] opacity-50 truncate",children:s.login})]})]})},qj=({slot:s,onClose:e,onSave:t})=>{var Ce,Oe;const{user:n}=bt(),{theme:a}=it(),{isAdmin:i}=_t(),o=a==="dark"?"text-white":"text-gray-900",c=(s==null?void 0:s.date)||ie(new Date,"yyyy-MM-dd"),[d,h]=E.useState(c),[m,x]=E.useState(s!=null&&s.userId?[s.userId]:n!=null&&n.id?[n.id]:[]),[f,w]=E.useState(((Ce=s==null?void 0:s.slots)==null?void 0:Ce.map(re=>{const ve=re;return ve.break&&!ve.breaks?{...re,breaks:[ve.break]}:re}))||[]),[$,A]=E.useState(""),[T,K]=E.useState(""),[P,S]=E.useState(!1),[L,ee]=E.useState(""),[D,k]=E.useState(""),[b,v]=E.useState(null),[j,N]=E.useState(null),[y,p]=E.useState(null),[te,ue]=E.useState(null),[le,H]=E.useState((s==null?void 0:s.comment)||""),[ne,ce]=E.useState(!1),[B,pe]=E.useState([]),[F,q]=E.useState(!1),[M,z]=E.useState([]),[I,R]=E.useState("single"),[O,U]=E.useState(c),[J,C]=E.useState(c),[oe,ae]=E.useState(c),[V,Z]=E.useState([]),[ye,we]=E.useState(""),[Ke,We]=E.useState(!1),[Q,me]=E.useState((s==null?void 0:s.category)||"");ps();const Ie=["Пн","Вт","Ср","Чт","Пт","Сб","Вс"],de=i&&!s;E.useEffect(()=>{console.log("SlotForm mounted, user:",n==null?void 0:n.name,"slots count:",f.length)},[]),E.useEffect(()=>{if(ne&&d){const re=new Date(d),ve=re.getDay()===0?6:re.getDay()-1;pe([ve])}},[ne,d]),E.useEffect(()=>{F||z([])},[F]),E.useEffect(()=>{I!=="single"&&(ce(!1),pe([]),q(!1),z([]))},[I]);const ze=()=>{var Ze;if(!$||!T){we("Заполните время начала и окончания");return}const re=hr($)>=hr(T),ve=P||re;if(re&&!P){we('Время окончания должно быть позже времени начала. Включите "Переходит через полночь" для слотов, переходящих на следующий день.');return}let De;if(ve&&d){const tt=new Date(d);tt.setDate(tt.getDate()+1),De=ie(tt,"yyyy-MM-dd")}const Fe=b!==null?((Ze=f[b])==null?void 0:Ze.breaks)||[]:[],Je={start:$,end:T,...De&&{endDate:De},breaks:Fe};if(b!==null){const tt=[...f];tt[b]=Je,w(tt)}else w([...f,Je]);A(""),K(""),S(!1),ee(""),k(""),v(null),N(null),we("")},Le=re=>{const ve=f[re];if(!ve)return;const De=!!ve.endDate||hr(ve.end)<=hr(ve.start);A(ve.start),K(ve.end),S(De),v(re),N(null),p(null),ue(null),ee(""),k(""),we("")},W=()=>{v(null),A(""),K(""),S(!1),we("")},Ne=re=>{if(!L||!D){we("Заполните время начала и окончания перерыва");return}const ve=f[re];if(!ve)return;if(L>=D){we("Время окончания перерыва должно быть позже времени начала");return}const De=hr(L),Fe=hr(D),Je=hr(ve.start),Ze=hr(ve.end),tt=ve.endDate||Ze<=Je;let Ye=!1;if(tt){const yt=De>=Je&&De<1440&&Fe>De&&Fe<=1440&&Fe>De,Ct=De>=0&&De<=Ze&&Fe>De&&Fe<=Ze,Lt=De>=Je&&De<1440&&Fe>0&&Fe<=Ze&&De>Fe;Ye=yt||Ct||Lt}else Ye=De>=Je&&Fe<=Ze&&Fe>De;if(!Ye){we(`Перерыв должен быть в пределах времени слота (${ve.start} - ${ve.end})`);return}const Xe=ve.breaks||[];for(let rt=0;rt<Xe.length;rt++){if(y===re&&te===rt)continue;const yt=Xe[rt];if(L>=yt.start&&L<yt.end||D>yt.start&&D<=yt.end||L<=yt.start&&D>=yt.end){we("Перерывы не должны пересекаться");return}}let be;y===re&&te!==null?(be=[...Xe],be[te]={start:L,end:D},be.sort((rt,yt)=>rt.start.localeCompare(yt.start))):be=[...Xe,{start:L,end:D}].sort((rt,yt)=>rt.start.localeCompare(yt.start));const je=[...f];je[re]={...ve,breaks:be},w(je),ee(""),k(""),N(null),p(null),ue(null),we("")},Pe=(re,ve)=>{const De=f[re];if(!De||!De.breaks||!De.breaks[ve])return;const Fe=De.breaks[ve];p(re),ue(ve),N(re),ee(Fe.start),k(Fe.end),we("")},Y=()=>{ee(""),k(""),N(null),p(null),ue(null),we("")},G=(re,ve)=>{const De=f[re];if(!De||!De.breaks)return;const Fe=De.breaks.filter((Ze,tt)=>tt!==ve),Je=[...f];Je[re]={...De,breaks:Fe.length>0?Fe:void 0},w(Je)},Te=re=>{w(f.filter((ve,De)=>De!==re)),b===re&&W()},Re=re=>{B.includes(re)?pe(B.filter(ve=>ve!==re)):pe([...B,re])},Ue=re=>{M.includes(re)?z(M.filter(ve=>ve!==re)):z([...M,re])},xe=re=>{x(ve=>ve.includes(re)?ve.filter(De=>De!==re):[...ve,re])},lt=()=>{m.length===$e.length?x([]):x($e.map(re=>re.id))},Qe=()=>{if(!oe)return;const re=S0([...V,oe]);Z(re),ae("")},ct=re=>{Z(ve=>ve.filter(De=>De!==re))},_e=()=>{if(de){if(I==="range")return Ji(O,J);if(I==="multiple")return V}if(I==="single"){if(ne&&B.length>0){const re=[],ve=new Date(d),De=new Date(ve.getFullYear(),ve.getMonth()+1,0),Fe=B[0],Je=new Date(ve);for(;Je<=De;)(Je.getDay()===0?6:Je.getDay()-1)===Fe&&re.push(ie(Je,"yyyy-MM-dd")),Je.setDate(Je.getDate()+1);return re}if(F&&M.length>0){const re=[],ve=new Date(d),De=ve.getDay()===0?6:ve.getDay()-1;ve.setDate(ve.getDate()-De);for(let Fe=0;Fe<7;Fe++){const Je=new Date(ve);Je.setDate(ve.getDate()+Fe);const Ze=Je.getDay()===0?6:Je.getDay()-1;M.includes(Ze)&&re.push(ie(Je,"yyyy-MM-dd"))}return re}return[d]}return I==="range"?Ji(O,J):V},Me=()=>s?[s.userId]:de?m:i&&!n?m.length>0?m:[]:n!=null&&n.id?[n.id]:[],ot=re=>kt(re),ht=async(re,ve,De)=>{if(De){const Ze=await B0(De,!0);for(const tt of Ze){const Ye=await wr(tt.restrictedUserId,re);for(const Xe of ve){for(const be of Ye)if(pi(Xe,be.slots[0]))return`Ваше время пересекается со слотом ${ot(tt.restrictedUserId)} (${be.slots[0].start}-${be.slots[0].end}). ${tt.reason||"Выберите другое время."}`;if(Xe.endDate){const be=await wr(tt.restrictedUserId,Xe.endDate);for(const je of be)if(pi(Xe,je.slots[0]))return`Ваше время пересекается со слотом ${ot(tt.restrictedUserId)} (${je.slots[0].start}-${je.slots[0].end}). ${tt.reason||"Выберите другое время."}`}}}}const Je=(await wr(void 0,re)).filter(Ze=>Ze.id!==(s==null?void 0:s.id));for(const Ze of ve){for(const tt of Je)if(pi(Ze,tt.slots[0])&&tt.participants.length>=3)return`Слот ${Ze.start}-${Ze.end} уже занят максимальным количеством участников (3)`;if(Ze.endDate){const Ye=(await wr(void 0,Ze.endDate)).filter(Xe=>Xe.id!==(s==null?void 0:s.id));for(const Xe of Ye)if(pi(Ze,Xe.slots[0])&&Xe.participants.length>=3)return`Слот ${Ze.start}-${Ze.end} (до ${Ze.endDate}) уже занят максимальным количеством участников (3)`}}return null},br=async()=>{if(console.log("handleSave called"),!i&&!n){console.log("No user found"),we("Пользователь не найден");return}if(f.length===0){we("Добавьте хотя бы один временной интервал");return}if(s&&!i&&n&&s.userId!==n.id){we("Вы можете редактировать только свои слоты"),We(!1);return}const re=Me();if(re.length===0){we("Выберите хотя бы одного участника");return}const ve=_e();if(ve.length===0){we("Выберите даты");return}if(!s&&!Q){we("Выберите сферу деятельности");return}const De=new Date;De.setHours(0,0,0,0);const Fe=ie(De,"yyyy-MM-dd"),Je=Ye=>Ye<Fe,Ze=(Ye,Xe)=>{const be=new Date(Ye),je=new Date(Xe);return be.setHours(0,0,0,0),je.setHours(0,0,0,0),Math.round((je.getTime()-be.getTime())/(1e3*60*60*24))},tt=async(Ye,Xe,be=[Ye])=>{const je=f.map(Ct=>{const Lt=!Ct.endDate&&hr(Ct.end)<=hr(Ct.start),ur=Ct.endDate?Ze(d,Ct.endDate):Lt?1:0;if(ur>0){const nr=new Date(Xe);return nr.setDate(nr.getDate()+ur),{...Ct,endDate:ie(nr,"yyyy-MM-dd")}}return{...Ct,...Ct.endDate?{endDate:Ct.endDate}:{}}});if(!i){const Ct=je.length>0?je[0].start:void 0,Lt=await Zi("slots",Xe,Ct);if(Lt.restricted)throw new Error(`[${ot(Ye)} • ${ie(new Date(Xe),"dd.MM.yyyy")}] ${Lt.reason}`);for(const ur of je)if(ur.endDate&&ur.endDate!==Xe){const nr=await Zi("slots",ur.endDate);if(nr.restricted)throw new Error(`[${ot(Ye)} • ${ie(new Date(ur.endDate),"dd.MM.yyyy")}] ${nr.reason}`)}}const rt=await ht(Xe,je,Ye);if(rt)throw new Error(`[${ot(Ye)} • ${ie(new Date(Xe),"dd.MM.yyyy")}] ${rt}`);const yt={id:(s==null?void 0:s.id)||"",userId:Ye,date:Xe,slots:je,...le&&{comment:le},participants:be,category:Q};if(i)if(s){const{id:Ct,...Lt}=yt;await C0(s.id,Lt)}else{const{id:Ct,...Lt}=yt;await A0(Lt)}else await Nt({entity:"slot",action:s?"update":"create",authorId:(n==null?void 0:n.id)||Ye,targetUserId:Ye,before:s||null,after:yt,comment:le||void 0})};console.log("Starting save process..."),we(""),We(!0);try{if(s){await tt(s.userId,d,s.participants||[s.userId]),t();return}if(F&&M.length>0){const Ye=_e();for(const Xe of Ye)if(!Je(Xe))for(const be of re)await tt(be,Xe)}else if(ne&&B.length>0){const Ye=new Date(d),Xe=Ye.getMonth(),be=Ye.getFullYear(),je=new Date(be,Xe+1,0).getDate();for(let rt=1;rt<=je;rt++){const yt=new Date(be,Xe,rt),Ct=yt.getDay()===0?6:yt.getDay()-1;if(B.includes(Ct)){const Lt=ie(yt,"yyyy-MM-dd");if(Je(Lt))continue;for(const ur of re)await tt(ur,Lt)}}}else if(de&&I!=="single")for(const Ye of ve)for(const Xe of re)await tt(Xe,Ye);else for(const Ye of re)await tt(Ye,d);t()}catch(Ye){console.error("Error saving slot:",Ye);const Xe=Ye.message||Ye.code||"Ошибка при сохранении";we(Xe)}finally{We(!1)}},Kt=de?_e():[d],Yt=f.map(re=>`${re.start}–${re.end}${re.endDate?" (+1)":""}`);return r.jsx("div",{className:"fixed inset-0 bg-slate-950/75 backdrop-blur-xl flex items-start sm:items-center justify-center z-[70] p-4 sm:p-6 touch-manipulation overflow-y-auto",children:r.jsx("div",{className:`w-full max-w-5xl rounded-3xl shadow-[0_24px_80px_rgba(0,0,0,0.45)] border ${a==="dark"?"bg-gradient-to-br from-[#0c1320] via-[#0b1220] to-[#08111b] border-white/10":"bg-gradient-to-br from-white via-slate-50 to-white border-slate-200"} max-h-[90vh] overflow-y-auto`,children:r.jsxs("div",{className:"p-4 sm:p-6 lg:p-7 flex flex-col h-full min-h-0 overflow-y-auto",children:[r.jsxs("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between",children:[r.jsxs("div",{className:"space-y-1",children:[r.jsx("div",{className:"flex items-center gap-2 text-xs font-semibold text-[#4E6E49] tracking-tight",children:r.jsx("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full bg-[#4E6E49]/10 text-[#4E6E49] border border-[#4E6E49]/30",children:s?"Редактирование слота":"Создание слота"})}),r.jsx("h3",{className:`text-2xl sm:text-3xl font-bold ${o}`,children:s?"Редактировать слот":"Добавить слот"})]}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsxs("div",{className:`px-3 py-2 rounded-xl border text-xs sm:text-sm ${a==="dark"?"border-white/10 bg-white/5 text-gray-200":"border-slate-200 bg-slate-50 text-slate-700"}`,children:[s?"Редактирование":"Создание"," · ",f.length||0," интервал(ов)"]}),r.jsx("button",{onClick:e,className:`p-2.5 rounded-full border ${a==="dark"?"border-white/10 text-gray-200 hover:bg-white/5":"border-slate-200 text-slate-600 hover:bg-slate-100"} transition-colors touch-manipulation`,"aria-label":"Закрыть",children:r.jsx(Rt,{className:"w-4 h-4 sm:w-5 sm:h-5"})})]})]}),r.jsxs("div",{className:"mt-5 grid lg:grid-cols-[0.9fr_1.6fr] gap-4 lg:gap-6 flex-1 min-h-0",children:[r.jsxs("aside",{className:`rounded-2xl border ${a==="dark"?"border-white/10 bg-white/5":"border-slate-200 bg-white"} p-4 sm:p-5 space-y-4 sticky top-0 self-start max-h-full overflow-y-auto`,children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsx("p",{className:"text-sm font-semibold",children:"Навигация"}),r.jsx("span",{className:"text-[11px] uppercase tracking-wide text-[#4E6E49] font-semibold",children:"4 шага"})]}),r.jsx("div",{className:"space-y-2",children:[{label:"Участники",detail:m.length>0?r.jsx("div",{className:"flex flex-wrap gap-x-1",children:m.map((re,ve)=>r.jsxs("span",{children:[r.jsx(Ls,{userId:re}),ve<m.length-1?",":""]},re))}):"Не выбрано",done:m.length>0||!!s},{label:"Даты",detail:Kt.slice(0,2).map(re=>ie(re,"dd.MM")).join(", ")||"Выберите дату",done:Kt.length>0},{label:"Время",detail:Yt.slice(0,2).join(" · ")||"Добавьте интервал",done:f.length>0},{label:"Сфера",detail:Q?((Oe=bn[Q])==null?void 0:Oe.label)||Q:"Выберите сферу",done:!!Q},{label:"Комментарий",detail:le?"Заполнен":"Необязателен",done:!!le}].map((re,ve)=>r.jsxs("div",{className:`flex items-start gap-3 rounded-xl border px-3 py-3 ${a==="dark"?"border-white/10 bg-white/5":"border-slate-200 bg-slate-50"}`,children:[r.jsx("span",{className:`mt-0.5 inline-flex h-6 w-6 items-center justify-center rounded-full text-xs font-bold ${re.done?"bg-[#4E6E49] text-white":a==="dark"?"bg-slate-800 text-gray-300":"bg-slate-200 text-slate-700"}`,children:ve+1}),r.jsxs("div",{className:"flex-1 min-w-0",children:[r.jsx("p",{className:"text-sm font-semibold",children:re.label}),r.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400 truncate",children:re.detail})]})]},re.label))})]}),r.jsxs("div",{className:"space-y-4 overflow-y-auto overscroll-contain pr-1 pb-6 flex-1 min-h-0",children:[de&&r.jsxs("div",{children:[r.jsx("label",{className:`block text-xs sm:text-sm font-medium mb-2 ${a==="dark"?"text-gray-300":"text-gray-700"}`,children:"Участники"}),r.jsxs("div",{className:"space-y-3",children:[r.jsx("div",{className:"flex flex-wrap gap-2",children:$e.map(re=>r.jsxs("label",{className:`px-3 py-1.5 rounded-full border cursor-pointer text-sm flex items-center gap-2 ${m.includes(re.id)?"bg-[#4E6E49] border-[#4E6E49] text-white":a==="dark"?"bg-gray-700 border-gray-800 text-gray-200":"bg-gray-100 border-gray-300 text-gray-700"}`,children:[r.jsx("input",{type:"checkbox",checked:m.includes(re.id),onChange:()=>xe(re.id),className:"hidden"}),r.jsx(Ls,{userId:re.id})]},re.id))}),r.jsx("button",{type:"button",onClick:lt,className:"text-sm text-[#4E6E49] hover:text-[#4E6E49]",children:m.length===$e.length?"Снять выделение":"Выбрать всех"})]})]}),de&&r.jsxs("div",{children:[r.jsx("p",{className:`text-xs sm:text-sm font-medium mb-2 ${a==="dark"?"text-gray-300":"text-gray-700"}`,children:"Формат выбора дат"}),r.jsx("div",{className:"flex flex-wrap gap-4",children:[{value:"single",label:"Один день"},{value:"range",label:"Диапазон дат"},{value:"multiple",label:"Конкретные даты"}].map(re=>r.jsxs("label",{className:"flex items-center gap-2 text-sm cursor-pointer",children:[r.jsx("input",{type:"radio",value:re.value,checked:I===re.value,onChange:ve=>R(ve.target.value)}),r.jsx("span",{className:a==="dark"?"text-gray-200":"text-gray-700",children:re.label})]},re.value))})]}),(!de||I==="single")&&r.jsxs("div",{children:[r.jsx("label",{className:`block text-xs sm:text-sm font-medium mb-2 ${a==="dark"?"text-gray-300":"text-gray-700"}`,children:"Дата"}),r.jsx("input",{type:"date",value:d,onChange:re=>h(re.target.value),className:`w-full px-3 sm:px-4 py-2 sm:py-2.5 text-sm sm:text-base rounded-lg border touch-manipulation ${a==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`})]}),de&&I==="range"&&r.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[r.jsxs("div",{children:[r.jsx("label",{className:`block text-xs sm:text-sm font-medium mb-2 ${a==="dark"?"text-gray-300":"text-gray-700"}`,children:"Начало диапазона"}),r.jsx("input",{type:"date",value:O,onChange:re=>U(re.target.value),className:`w-full px-3 sm:px-4 py-2 sm:py-2.5 text-sm sm:text-base rounded-lg border touch-manipulation ${a==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`})]}),r.jsxs("div",{children:[r.jsx("label",{className:`block text-xs sm:text-sm font-medium mb-2 ${a==="dark"?"text-gray-300":"text-gray-700"}`,children:"Конец диапазона"}),r.jsx("input",{type:"date",value:J,min:O,onChange:re=>C(re.target.value),className:`w-full px-3 sm:px-4 py-2 sm:py-2.5 text-sm sm:text-base rounded-lg border touch-manipulation ${a==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`})]})]}),de&&I==="multiple"&&r.jsxs("div",{children:[r.jsx("label",{className:`block text-xs sm:text-sm font-medium mb-2 ${a==="dark"?"text-gray-300":"text-gray-700"}`,children:"Выбранные даты"}),r.jsxs("div",{className:"flex flex-col gap-3",children:[r.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[r.jsx("input",{type:"date",value:oe,onChange:re=>ae(re.target.value),className:`flex-1 px-3 sm:px-4 py-2 sm:py-2.5 text-sm sm:text-base rounded-lg border touch-manipulation ${a==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`}),r.jsx("button",{type:"button",onClick:Qe,className:"px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg transition-colors",children:"Добавить"})]}),V.length>0?r.jsx("div",{className:"flex flex-wrap gap-2",children:V.map(re=>r.jsxs("span",{className:"inline-flex items-center gap-2 px-3 py-1.5 rounded-full bg-gray-100 text-gray-800 text-sm",children:[ie(re,"dd.MM.yyyy"),r.jsx("button",{type:"button",onClick:()=>ct(re),className:"text-red-500 hover:text-red-600",children:"x"})]},re))}):r.jsx("p",{className:"text-sm text-gray-500",children:"Пока не выбрано ни одной даты"})]})]}),r.jsxs("div",{children:[r.jsx("label",{className:`block text-xs sm:text-sm font-medium mb-2 ${a==="dark"?"text-gray-300":"text-gray-700"}`,children:"Временные слоты"}),r.jsxs("div",{className:"space-y-2 mb-2",children:[r.jsx("div",{className:"flex flex-col sm:flex-row gap-2",children:r.jsxs("div",{className:"flex gap-2 flex-1",children:[r.jsx("input",{type:"time",value:$,onChange:re=>A(re.target.value),className:`flex-1 px-3 sm:px-4 py-2 sm:py-2.5 text-sm sm:text-base rounded-lg border touch-manipulation ${a==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`,placeholder:"Начало"}),r.jsx("span",{className:"mx-1 sm:mx-2 text-gray-500 text-sm sm:text-base flex items-center",children:"—"}),r.jsx("input",{type:"time",value:T,onChange:re=>K(re.target.value),className:`flex-1 px-3 sm:px-4 py-2 sm:py-2.5 text-sm sm:text-base rounded-lg border touch-manipulation ${a==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`,placeholder:"Окончание"})]})}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("input",{type:"checkbox",id:"crossMidnight",checked:P,onChange:re=>{S(re.target.checked)},className:`w-4 h-4 rounded border-2 ${a==="dark"?"border-gray-800 bg-gray-700 checked:bg-[#4E6E49] checked:border-[#4E6E49]":"border-gray-300 bg-white checked:bg-[#4E6E49] checked:border-[#4E6E49]"} focus:ring-2 focus:ring-[#4E6E49] cursor-pointer touch-manipulation`}),r.jsx("label",{htmlFor:"crossMidnight",className:`text-xs sm:text-sm font-medium cursor-pointer ${a==="dark"?"text-gray-300":"text-gray-700"}`,children:"Переходит через полночь (на следующий день)"})]}),r.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[r.jsx("button",{onClick:ze,className:"w-full px-4 py-2 bg-[#4E6E49] hover:bg-[#4E6E49] text-white rounded-lg transition-colors flex items-center justify-center gap-2",children:b!==null?r.jsxs(r.Fragment,{children:[r.jsx(cr,{className:"w-4 h-4"}),"Сохранить слот"]}):r.jsxs(r.Fragment,{children:[r.jsx(os,{className:"w-4 h-4"}),"Добавить слот"]})}),b!==null&&r.jsx("button",{onClick:W,className:`w-full sm:w-auto px-4 py-2 rounded-lg border ${a==="dark"?"border-gray-700 text-gray-200 hover:bg-gray-700":"border-gray-300 text-gray-800 hover:bg-gray-100"}`,children:"Отмена"})]})]}),r.jsx("div",{className:"space-y-3",children:f.map((re,ve)=>r.jsxs("div",{className:`flex flex-col gap-2 p-3 rounded-lg ${a==="dark"?"bg-gray-700":"bg-gray-100"}`,children:[r.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-2",children:[r.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[r.jsxs("span",{className:o,children:[re.start," - ",re.end]}),re.endDate&&r.jsxs("span",{className:`text-xs px-2 py-0.5 rounded-full ${a==="dark"?"bg-blue-500/20 text-blue-400 border border-blue-500/30":"bg-blue-100 text-blue-700 border border-blue-300"}`,children:["до ",ie(new Date(re.endDate),"dd.MM.yyyy")]})]}),r.jsxs("div",{className:"flex items-center gap-1",children:[r.jsx("button",{onClick:()=>Le(ve),className:"p-1 text-blue-500 hover:bg-blue-500 hover:text-white rounded transition-colors flex-shrink-0",title:"Редактировать слот",children:r.jsx(cr,{className:"w-4 h-4"})}),r.jsx("button",{onClick:()=>Te(ve),className:"p-1 text-red-500 hover:bg-red-500 hover:text-white rounded transition-colors flex-shrink-0",title:"Удалить слот",children:r.jsx(Pt,{className:"w-4 h-4"})})]})]}),re.breaks&&re.breaks.length>0&&r.jsxs("div",{className:"ml-4 space-y-1",children:[r.jsx("span",{className:`text-xs ${a==="dark"?"text-gray-400":"text-gray-600"}`,children:"Перерывы:"}),re.breaks.map((De,Fe)=>y===ve&&te===Fe?null:r.jsxs("div",{className:"flex items-center justify-between gap-2",children:[r.jsxs("span",{className:`text-sm ${a==="dark"?"text-gray-300":"text-gray-700"}`,children:[De.start," - ",De.end]}),r.jsxs("div",{className:"flex gap-1",children:[r.jsx("button",{onClick:()=>Pe(ve,Fe),className:"p-1 text-blue-400 hover:bg-blue-400 hover:text-white rounded transition-colors",title:"Редактировать перерыв",children:r.jsx(cr,{className:"w-3 h-3"})}),r.jsx("button",{onClick:()=>G(ve,Fe),className:"p-1 text-red-400 hover:bg-red-400 hover:text-white rounded transition-colors",title:"Удалить перерыв",children:r.jsx(Rt,{className:"w-3 h-3"})})]})]},Fe))]}),r.jsx("div",{className:"ml-4 space-y-2 border-t pt-2 border-gray-500 border-opacity-30",children:j===ve?r.jsxs("div",{className:"space-y-2",children:[r.jsxs("div",{className:"flex gap-2",children:[r.jsx("input",{type:"time",value:L,onChange:De=>ee(De.target.value),className:`flex-1 px-3 py-1.5 text-sm rounded-lg border ${a==="dark"?"bg-gray-600 border-gray-500 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`,placeholder:"Начало"}),r.jsx("input",{type:"time",value:D,onChange:De=>k(De.target.value),className:`flex-1 px-3 py-1.5 text-sm rounded-lg border ${a==="dark"?"bg-gray-600 border-gray-500 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`,placeholder:"Конец"})]}),r.jsxs("div",{className:"flex gap-2",children:[r.jsx("button",{onClick:()=>Ne(ve),className:"flex-1 px-3 py-1.5 text-sm bg-[#4E6E49] hover:bg-[#4E6E49] text-white rounded-lg transition-colors",children:y===ve&&te!==null?"Сохранить":"Добавить перерыв"}),r.jsx("button",{onClick:Y,className:"px-3 py-1.5 text-sm bg-gray-500 hover:bg-gray-600 text-white rounded-lg transition-colors",children:"Отмена"})]})]}):r.jsxs("button",{onClick:()=>{N(ve),ee(""),k(""),p(null),ue(null),we("")},className:"w-full px-3 py-1.5 text-sm bg-blue-500 hover:bg-blue-600 text-white rounded-lg transition-colors flex items-center justify-center gap-1",children:[r.jsx(os,{className:"w-3 h-3"}),"Добавить перерыв"]})})]},ve))}),f.length>0&&r.jsxs("p",{className:`text-sm mt-2 ${a==="dark"?"text-gray-400":"text-gray-600"}`,children:["Всего часов: ",To(f).toFixed(1)]})]}),r.jsxs("div",{children:[r.jsxs("label",{className:`block text-xs sm:text-sm font-medium mb-2 ${a==="dark"?"text-gray-300":"text-gray-700"}`,children:["Сфера деятельности ",r.jsx("span",{className:"text-red-500",children:"*"})]}),r.jsxs("select",{value:Q,onChange:re=>{me(re.target.value),we("")},className:`w-full px-3 sm:px-4 py-2 sm:py-2.5 text-sm sm:text-base rounded-lg border touch-manipulation ${a==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`,children:[r.jsx("option",{value:"",children:"Выберите сферу..."}),Object.keys(bn).map(re=>r.jsx("option",{value:re,children:bn[re].label},re))]})]}),(!de||I==="single")&&r.jsxs("div",{children:[r.jsx("p",{className:`text-xs sm:text-sm font-medium mb-3 ${a==="dark"?"text-gray-300":"text-gray-700"}`,children:"Повторы"}),r.jsxs("div",{className:"grid sm:grid-cols-2 gap-3",children:[r.jsxs("button",{type:"button",onClick:()=>{q(!F),we("")},className:`text-left rounded-xl border px-4 py-4 transition-all shadow-sm flex items-start gap-3 h-full ${F?"bg-blue-100 text-blue-800 border-blue-200 dark:bg-blue-900/30 dark:text-blue-100 dark:border-blue-800 ring-2 ring-blue-500/50 shadow-lg":a==="dark"?"border-white/10 bg-white/5 text-gray-200 hover:border-white/30":"border-slate-200 bg-white text-gray-800 hover:border-slate-300"}`,children:[r.jsx(ix,{className:"w-5 h-5 flex-shrink-0 mt-0.5"}),r.jsxs("div",{className:"flex-1 min-w-0",children:[r.jsx("p",{className:"font-semibold text-sm",children:"Повтор на неделю"}),r.jsx("p",{className:"text-xs mt-1 opacity-80",children:"Актуальная неделя по дням"}),F&&r.jsx("div",{className:"mt-3 flex flex-wrap gap-2",children:Ie.map((re,ve)=>r.jsx("button",{type:"button",onClick:De=>{De.stopPropagation(),Ue(ve)},className:`px-2 py-1 rounded-lg text-xs transition-colors ${M.includes(ve)?"bg-blue-600 text-white":a==="dark"?"bg-gray-700 text-gray-300":"bg-gray-200 text-gray-700"}`,children:re},ve))})]})]}),r.jsxs("button",{type:"button",onClick:()=>{ce(!ne),we("")},className:`text-left rounded-xl border px-4 py-4 transition-all shadow-sm flex items-start gap-3 h-full ${ne?"bg-purple-100 text-purple-800 border-purple-200 dark:bg-purple-900/30 dark:text-purple-100 dark:border-purple-800 ring-2 ring-purple-500/50 shadow-lg":a==="dark"?"border-white/10 bg-white/5 text-gray-200 hover:border-white/30":"border-slate-200 bg-white text-gray-800 hover:border-slate-300"}`,children:[r.jsx(gs,{className:"w-5 h-5 flex-shrink-0 mt-0.5"}),r.jsxs("div",{className:"flex-1 min-w-0",children:[r.jsx("p",{className:"font-semibold text-sm",children:"Повтор по месяцу"}),r.jsx("p",{className:"text-xs mt-1 opacity-80",children:"На месяц вперед по дням"}),ne&&r.jsx("div",{className:"mt-3 flex flex-wrap gap-2",children:Ie.map((re,ve)=>r.jsx("button",{type:"button",onClick:De=>{De.stopPropagation(),Re(ve)},className:`px-2 py-1 rounded-lg text-xs transition-colors ${B.includes(ve)?"bg-purple-600 text-white":a==="dark"?"bg-gray-700 text-gray-300":"bg-gray-200 text-gray-700"}`,children:re},ve))})]})]})]})]}),r.jsxs("div",{children:[r.jsx("label",{className:`block text-xs sm:text-sm font-medium mb-2 ${a==="dark"?"text-gray-300":"text-gray-700"}`,children:"Комментарий"}),r.jsx("textarea",{value:le,onChange:re=>H(re.target.value),rows:3,className:`w-full px-3 sm:px-4 py-2 sm:py-2.5 text-sm sm:text-base rounded-lg border touch-manipulation resize-y ${a==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`,placeholder:"Добавьте комментарий (необязательно)"})]}),ye&&r.jsx("div",{className:"p-3 bg-red-500 text-white rounded-lg text-sm",children:ye}),r.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 sm:gap-3 pt-2",children:[r.jsx("button",{onClick:re=>{console.log("Save button clicked!",{loading:Ke,slotsCount:f.length,disabled:Ke||f.length===0}),re.preventDefault(),br()},disabled:Ke||f.length===0||!s&&!Q,className:"flex-1 px-4 py-2.5 sm:py-2 bg-[#4E6E49] hover:bg-[#4E6E49] disabled:bg-gray-400 disabled:cursor-not-allowed text-white rounded-lg sm:rounded-xl transition-colors text-sm sm:text-base font-medium touch-manipulation active:scale-95 disabled:active:scale-100",children:Ke?"Ошибка добавления слота":"Отправить на согласование"}),r.jsx("button",{onClick:e,className:`px-4 py-2.5 sm:py-2 rounded-lg sm:rounded-xl transition-colors text-sm sm:text-base font-medium touch-manipulation active:scale-95 ${a==="dark"?"bg-gray-700 hover:bg-gray-600 active:bg-gray-500":"bg-gray-200 hover:bg-gray-300 active:bg-gray-400"}`,children:"Отмена"})]})]})]})]})})})},zj=({type:s,status:e,onClose:t,onSave:n})=>{const{user:a}=bt(),{theme:i}=it(),{isAdmin:o}=_t(),c=i==="dark"?"text-white":"text-gray-900",d=(e==null?void 0:e.date)||ie(new Date,"yyyy-MM-dd"),[h,m]=E.useState(e!=null&&e.userId?[e.userId]:a!=null&&a.id?[a.id]:[]),[x,f]=E.useState(d),[w,$]=E.useState((e==null?void 0:e.endDate)||d),[A,T]=E.useState(!!(e!=null&&e.endDate)),[K,P]=E.useState((e==null?void 0:e.comment)||""),[S,L]=E.useState(s||(e==null?void 0:e.type)||null),[ee,D]=E.useState(""),[k,b]=E.useState(!1),[v,j]=E.useState("single"),[N,y]=E.useState(d),[p,te]=E.useState(d),[ue,le]=E.useState(d),[H,ne]=E.useState([]),[ce,B]=E.useState(!1),[pe,F]=E.useState([]),[q,M]=E.useState(!1),[z,I]=E.useState([]),R=o&&!e,O=["Пн","Вт","Ср","Чт","Пт","Сб","Вс"];ps(),E.useEffect(()=>{A||$(x)},[A,x]),E.useEffect(()=>{R&&v!=="single"&&T(!1)},[R,v]),E.useEffect(()=>{ce||F([])},[ce]),E.useEffect(()=>{if(q&&x){const W=new Date(x),Ne=W.getDay()===0?6:W.getDay()-1;I([Ne])}},[q,x]),E.useEffect(()=>{v!=="single"&&(B(!1),F([]),M(!1),I([]))},[v]);const U=W=>{m(Ne=>Ne.includes(W)?Ne.filter(Pe=>Pe!==W):[...Ne,W])},J=()=>{h.length===$e.length?m([]):m($e.map(W=>W.id))},C=()=>{if(!ue)return;const W=S0([...H,ue]);ne(W),le("")},oe=W=>{ne(Ne=>Ne.filter(Pe=>Pe!==W))},ae=()=>e?[e.userId]:R?h:o&&!a?h.length>0?h:[]:a!=null&&a.id?[a.id]:[],V=W=>kt(W),Z=W=>{if(R){if(v==="range")return N&&p?W==="dayoff"?Ji(N,p).map(Pe=>({date:Pe})):[{date:N,endDate:p}]:[];if(v==="multiple")return W==="dayoff"?H.map(Pe=>({date:Pe})):H.map(Pe=>({date:Pe,endDate:Pe}))}if(v==="single"&&W==="dayoff"){if(q&&z.length>0){const Pe=[],Y=new Date(x),G=new Date(Y.getFullYear(),Y.getMonth()+1,0),Te=z[0],Re=new Date(Y);for(;Re<=G;)(Re.getDay()===0?6:Re.getDay()-1)===Te&&Pe.push(ie(Re,"yyyy-MM-dd")),Re.setDate(Re.getDate()+1);return Pe.map(Ue=>({date:Ue}))}if(ce&&pe.length>0){const Pe=[],Y=new Date(x),G=Y.getDay()===0?6:Y.getDay()-1;Y.setDate(Y.getDate()-G);for(let Te=0;Te<7;Te++){const Re=new Date(Y);Re.setDate(Y.getDate()+Te);const Ue=Re.getDay()===0?6:Re.getDay()-1;pe.includes(Ue)&&Pe.push(ie(Re,"yyyy-MM-dd"))}return Pe.map(Te=>({date:Te}))}}if(W==="dayoff"){if(v==="range")return Ji(N,p).map(Pe=>({date:Pe}));if(v==="multiple")return H.map(Pe=>({date:Pe}))}if(v==="range"&&N&&p)return[{date:N,endDate:p}];if(v==="multiple")return H.map(Pe=>({date:Pe,endDate:Pe}));const Ne={date:x};return W!=="dayoff"&&(A||e!=null&&e.endDate)&&(Ne.endDate=w),[Ne]},ye=async(W,Ne,Pe,Y)=>{if(o)return null;if(!a)return"Пользователь не найден";const G=new Date,Te=new Date(Ne),Re=new Date(Pe||Ne);if(Y==="dayoff"&&T0(Te,G))return"Нельзя установить выходной на сегодня. Выберите смену или возьмите больничный.";if(Y==="sick"){const Ue=new Date;Ue.setHours(0,0,0,0);const xe=new Date(Ue);xe.setDate(xe.getDate()+2);const lt=new Date(Ne);if(lt.setHours(0,0,0,0),lt<Ue||lt>xe)return"Больничный можно взять только на актуальную дату и + 2 суток. Нельзя выбрать заранее.";const Qe=Math.ceil((Re.getTime()-Te.getTime())/(1e3*60*60*24))+1;if(Qe<1)return"Больничный должен быть минимум на 1 день";if(Qe>14)return"Больничный может длиться не более 14 календарных дней в месяце";const ct=new Date(Te.getFullYear(),Te.getMonth(),1),_e=new Date(Te.getFullYear(),Te.getMonth()+1,0);if((await is(W)).filter(ht=>ht.type==="sick"&&ht.date>=ie(ct,"yyyy-MM-dd")&&ht.date<=ie(_e,"yyyy-MM-dd")).length+Qe>14)return"Больничный ограничен 14 днями в месяц"}if(Y==="vacation"){if(Math.ceil((Re.getTime()-Te.getTime())/864e5)+1>14)return"Отпуск не может быть больше 14 дней в месяце";const xe=new Date(Te.getFullYear(),0,1),lt=new Date(Te.getFullYear(),11,31);if((await is(W)).filter(_e=>_e.type==="vacation"&&_e.date>=ie(xe,"yyyy-MM-dd")&&_e.date<=ie(lt,"yyyy-MM-dd")).length>=6)return"Не более 6 отпусков в год"}if(Y==="dayoff"){const Ue=new Date(Te);Ue.setDate(Ue.getDate()-Ue.getDay()+1);const xe=new Date(Ue);xe.setDate(Ue.getDate()+6);let Qe=(await is(W)).filter(ct=>ct.type==="dayoff"&&ct.date>=ie(Ue,"yyyy-MM-dd")&&ct.date<=ie(xe,"yyyy-MM-dd"));if(e&&(Qe=Qe.filter(ct=>ct.id!==e.id)),Qe.length>=4)return"Выходные на неделе ограничены максимум 4 днями"}return null},we=async()=>{if(console.log("handleSave called (DayStatusForm)"),!o&&!a){console.log("No user found"),D("Пользователь не найден");return}if(!S){D("Выберите тип отсутствия");return}if(e&&!o&&a&&e.userId!==a.id){D("Вы можете редактировать только свои статусы"),b(!1);return}const W=ae();if(W.length===0){D("Выберите хотя бы одного участника");return}if(R&&v==="range"){if(!N||!p){D("Укажите даты начала и окончания");return}if(new Date(p)<new Date(N)){D("Дата окончания не может быть раньше даты начала");return}}const Ne=Z(S);if(Ne.length===0){D("Выберите даты");return}const Pe=async(Y,G)=>{if(!o){const Re=await Zi(S,G.date);if(Re.restricted)throw new Error(`[${V(Y)} • ${ie(new Date(G.date),"dd.MM.yyyy")}] ${Re.reason}`);const Ue=await ye(Y,G.date,G.endDate,S);if(Ue)throw new Error(`[${V(Y)} • ${ie(G.date,"dd.MM.yyyy")}] ${Ue}`)}const Te={id:(e==null?void 0:e.id)||"",userId:Y,date:G.date,type:S,...G.endDate&&{endDate:G.endDate},...K&&{comment:K}};if(o){const{id:Re,...Ue}=Te;e?await $s(e.id,Ue):await Ao(Ue)}else await Nt({entity:"status",action:e?"update":"create",authorId:(a==null?void 0:a.id)||Y,targetUserId:Y,before:e||null,after:Te,comment:K||void 0})};console.log("Starting save process..."),D(""),b(!0);try{if(e){const Y={date:x};S!=="dayoff"&&(A||e.endDate)&&(Y.endDate=w),await Pe(e.userId,Y),n();return}for(const Y of W)for(const G of Ne)await Pe(Y,G);n()}catch(Y){console.error("Error saving day status:",Y);const G=Y.message||Y.code||"Ошибка при сохранении";D(G)}finally{b(!1)}},Ke={dayoff:"bg-yellow-500",sick:"bg-purple-500",vacation:"bg-orange-500",absence:"bg-red-500"},We=R&&v==="range"?[`${ie(N,"dd.MM")}–${ie(p,"dd.MM")}`]:R&&v==="multiple"?H.map(W=>ie(W,"dd.MM")):[ie(x,"dd.MM")],Q=h.map(W=>V(W)).join(", "),me=[{label:"Тип",detail:S?S==="dayoff"?"Выходной":S==="sick"?"Больничный":S==="vacation"?"Отпуск":"Прогул":"Не выбран",done:!!S,anchor:"#type"},{label:"Members",detail:Q||"Не выбрано",done:h.length>0||!!e,anchor:"#members"},{label:"Даты",detail:We.slice(0,2).join(" · "),done:We.length>0,anchor:"#dates"},{label:"Комментарий",detail:K?"Заполнен":"Необязателен",done:!!K,anchor:"#notes"}],Ie=Math.round(me.filter(W=>W.done).length/me.length*100),de=[{value:"single",label:"Один день",hint:"Быстрая отметка",icon:"•"},{value:"range",label:S==="dayoff"?"Диапазон (каждый день)":"Диапазон дат",hint:"Поток дней",icon:"⎯⎯"},{value:"multiple",label:"Конкретные даты",hint:"Точечный выбор",icon:"◎"}],Le=S?`${e?"Редактировать":"Добавить"} ${{dayoff:"выходной",sick:"больничный",vacation:"отпуск",absence:"прогул"}[S]}`:"Добавить отсутствие";return r.jsx("div",{className:"fixed inset-0 bg-slate-950/80 backdrop-blur-xl flex items-start sm:items-center justify-center z-[70] p-4 sm:p-6 touch-manipulation overflow-y-auto overscroll-contain modal-scroll",children:r.jsx("div",{className:`w-full max-w-[52rem] rounded-3xl shadow-[0_28px_80px_rgba(0,0,0,0.55)] border ${i==="dark"?"bg-[#0b1222] border-white/10":"bg-white border-slate-200"} max-h-[85dvh] sm:max-h-[calc(100dvh-96px)] overflow-y-auto relative`,children:r.jsxs("div",{className:"relative p-4 sm:p-6 lg:p-7 flex flex-col h-full min-h-0 overflow-y-auto modal-scroll",children:[r.jsxs("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-start sm:justify-between",children:[r.jsxs("div",{className:"space-y-2",children:[r.jsx("h3",{className:`text-2xl sm:text-3xl font-bold ${c}`,children:Le}),r.jsx("div",{className:"flex flex-wrap gap-2",children:me.map((W,Ne)=>r.jsxs("a",{href:W.anchor,className:`inline-flex items-center gap-2 px-3 py-1.5 rounded-full border text-xs transition ${W.done?"bg-[#4E6E49] border-[#4E6E49] text-white shadow-sm":i==="dark"?"border-white/15 bg-white/5 text-gray-200 hover:border-white/30":"border-slate-200 bg-white text-gray-700 hover:border-slate-300"}`,children:[r.jsx("span",{className:"font-semibold",children:Ne+1}),r.jsx("span",{className:"whitespace-nowrap",children:W.label})]},W.label))}),s==="dayoff"&&r.jsx("div",{className:"flex flex-wrap gap-2 text-xs sm:text-sm",children:["Один выходной","Диапазон дней","Несколько дат"].map(W=>r.jsx("span",{className:`px-3 py-1.5 rounded-full border ${i==="dark"?"border-white/10 text-gray-200 bg-white/5":"border-slate-200 text-gray-700 bg-slate-50"}`,children:W},W))})]}),r.jsx("button",{onClick:t,className:`p-2.5 rounded-full border shadow-sm transition hover:-translate-y-0.5 active:translate-y-0 ${i==="dark"?"border-white/10 text-gray-200 hover:bg-white/5":"border-slate-200 text-slate-600 hover:bg-slate-100"}`,children:r.jsx(Rt,{className:"w-5 h-5"})})]}),r.jsx("div",{className:`mt-5 rounded-2xl border ${i==="dark"?"border-white/10 bg-white/5":"border-slate-200 bg-white"} p-4 sm:p-5 shadow-inner`,children:r.jsxs("div",{className:"grid md:grid-cols-3 gap-3 md:gap-4",children:[r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx("div",{className:"h-10 w-10 rounded-2xl bg-gradient-to-br from-emerald-500/20 to-emerald-400/10 flex items-center justify-center text-emerald-600 dark:text-emerald-300 text-lg font-semibold border border-emerald-500/30",children:"👥"}),r.jsxs("div",{children:[r.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Members"}),r.jsx("p",{className:"text-sm font-semibold text-gray-900 dark:text-gray-100 line-clamp-2",children:Q||"Не выбрано"})]})]}),r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx("div",{className:"h-10 w-10 rounded-2xl bg-gradient-to-br from-blue-500/20 to-indigo-500/10 flex items-center justify-center text-blue-600 dark:text-blue-300 text-lg font-semibold border border-blue-500/30",children:"📅"}),r.jsxs("div",{children:[r.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Даты"}),r.jsx("p",{className:"text-sm font-semibold text-gray-900 dark:text-gray-100 line-clamp-2",children:We.length>0?We.join(" · "):"Не выбрано"})]})]}),r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx("div",{className:"h-10 w-10 rounded-2xl bg-gradient-to-br from-amber-500/20 to-orange-500/10 flex items-center justify-center text-amber-600 dark:text-amber-300 text-lg font-semibold border border-amber-500/30",children:"✏️"}),r.jsxs("div",{children:[r.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Комментарий"}),r.jsx("p",{className:"text-sm font-semibold text-gray-900 dark:text-gray-100 line-clamp-2",children:K||"Необязателен"})]})]})]})}),r.jsxs("div",{className:"mt-5 grid lg:grid-cols-[0.9fr_1.4fr] gap-4 lg:gap-6 flex-1 overflow-hidden",children:[r.jsxs("aside",{className:`rounded-2xl border ${i==="dark"?"border-white/10 bg-white/5":"border-slate-200 bg-white"} p-4 sm:p-5 space-y-4 sticky top-2 self-start max-h-full overflow-y-auto`,children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsx("p",{className:"text-sm font-semibold",children:"Навигация"}),r.jsxs("span",{className:"text-[11px] uppercase tracking-wide text-[#4E6E49] font-semibold",children:[me.length," шага"]})]}),r.jsx("div",{className:"h-1.5 rounded-full bg-slate-200 dark:bg-white/10 overflow-hidden",children:r.jsx("div",{className:"h-full rounded-full bg-gradient-to-r from-[#4E6E49] via-emerald-500 to-lime-400 transition-all",style:{width:`${Ie}%`}})}),r.jsx("div",{className:"space-y-2",children:me.map((W,Ne)=>r.jsxs("a",{href:W.anchor,className:`flex items-start gap-3 rounded-xl border px-3 py-3 transition ${i==="dark"?"border-white/10 bg-white/5 hover:border-white/30":"border-slate-200 bg-slate-50 hover:border-slate-300"}`,children:[r.jsx("span",{className:`mt-0.5 inline-flex h-7 w-7 items-center justify-center rounded-full text-xs font-bold ${W.done?"bg-[#4E6E49] text-white shadow-sm":i==="dark"?"bg-slate-800 text-gray-300":"bg-slate-200 text-slate-700"}`,children:Ne+1}),r.jsxs("div",{className:"flex-1 min-w-0",children:[r.jsx("p",{className:"text-sm font-semibold",children:W.label}),r.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 truncate",children:W.detail||"—"})]}),r.jsx("span",{className:"text-[11px] text-gray-400",children:W.done?"✓":""})]},W.label))})]}),r.jsxs("div",{className:"space-y-5 overflow-y-auto overscroll-contain pr-1 pb-6 flex-1 min-h-0",children:[!e&&!s&&r.jsxs("div",{id:"type",className:"scroll-mt-20 space-y-2",children:[r.jsx("p",{className:`text-xs sm:text-sm font-medium ${i==="dark"?"text-gray-300":"text-gray-700"}`,children:"Тип отсутствия"}),r.jsx("div",{className:"grid sm:grid-cols-3 gap-2",children:[{key:"dayoff",label:"Выходной",icon:"🌙"},{key:"sick",label:"Больничный",icon:"🏥"},{key:"vacation",label:"Отпуск",icon:"✈️"},...o?[{key:"absence",label:"Прогул",icon:"🚫"}]:[]].map(W=>r.jsxs("button",{type:"button",onClick:()=>L(W.key),className:`px-4 py-3 rounded-xl border text-sm font-semibold transition ${S===W.key?"border-[#4E6E49] bg-[#4E6E49]/10 text-[#4E6E49] shadow-sm":i==="dark"?"border-white/10 bg-white/5 text-gray-200 hover:border-white/30":"border-slate-200 bg-white text-gray-800 hover:border-slate-300"}`,children:[r.jsx("span",{className:"text-lg",children:W.icon}),r.jsx("span",{className:"block mt-1",children:W.label})]},W.key))})]}),R&&r.jsxs("div",{id:"members",className:"scroll-mt-20",children:[r.jsx("label",{className:`block text-xs sm:text-sm font-medium mb-2 ${i==="dark"?"text-gray-300":"text-gray-700"}`,children:"Members"}),r.jsxs("div",{className:"space-y-3 rounded-2xl border border-dashed border-[#4E6E49]/30 p-3 sm:p-4 bg-[#4E6E49]/5 dark:bg-[#4E6E49]/10",children:[r.jsx("div",{className:"flex flex-wrap gap-2",children:$e.map(W=>{const Ne=h.includes(W.id);return r.jsxs("label",{className:`px-3 py-1.5 rounded-full border cursor-pointer text-sm flex items-center gap-2 transition ${Ne?"bg-[#4E6E49] border-[#4E6E49] text-white shadow-sm":i==="dark"?"bg-gray-800/60 border-gray-800 text-gray-200 hover:border-gray-600":"bg-gray-100 border-gray-300 text-gray-700 hover:border-gray-400"}`,children:[r.jsx("input",{type:"checkbox",checked:Ne,onChange:()=>U(W.id),className:"hidden"}),kt(W.id)]},W.id)})}),r.jsxs("div",{className:"flex items-center justify-between text-sm",children:[r.jsx("span",{className:`${i==="dark"?"text-gray-300":"text-gray-700"}`,children:"Быстрый выбор"}),r.jsx("button",{type:"button",onClick:J,className:"text-sm text-[#4E6E49] hover:text-[#4E6E49] font-semibold",children:h.length===$e.length?"Снять выделение":"Выбрать всех"})]})]})]}),R&&r.jsxs("div",{id:"dates",className:"scroll-mt-20",children:[r.jsx("p",{className:`text-xs sm:text-sm font-medium mb-2 ${i==="dark"?"text-gray-300":"text-gray-700"}`,children:"Формат выбора дат"}),r.jsx("div",{className:"grid sm:grid-cols-3 gap-2",children:de.map(W=>{const Ne=v===W.value;return r.jsxs("button",{type:"button",onClick:()=>j(W.value),className:`w-full text-left px-3 py-3 rounded-xl border transition flex flex-col gap-1 ${Ne?"border-[#4E6E49] bg-[#4E6E49]/10 text-[#4E6E49] shadow-sm":i==="dark"?"border-white/10 bg-white/5 text-gray-200 hover:border-white/30":"border-slate-200 bg-white text-gray-800 hover:border-slate-300"}`,children:[r.jsx("span",{className:"text-lg leading-none",children:W.icon}),r.jsx("span",{className:"text-sm font-semibold",children:W.label}),r.jsx("span",{className:"text-[11px] text-gray-500 dark:text-gray-400",children:W.hint})]},W.value)})})]}),!R&&s==="dayoff"&&r.jsxs("div",{id:"dates",className:"scroll-mt-20",children:[r.jsx("p",{className:`text-xs sm:text-sm font-medium mb-2 ${i==="dark"?"text-gray-300":"text-gray-700"}`,children:"Формат выбора дат"}),r.jsx("div",{className:"grid sm:grid-cols-3 gap-2",children:de.map(W=>{const Ne=v===W.value;return r.jsxs("button",{type:"button",onClick:()=>j(W.value),className:`w-full text-left px-3 py-3 rounded-xl border transition flex flex-col gap-1 ${Ne?"border-[#4E6E49] bg-[#4E6E49]/10 text-[#4E6E49] shadow-sm":i==="dark"?"border-white/10 bg-white/5 text-gray-200 hover:border-white/30":"border-slate-200 bg-white text-gray-800 hover:border-slate-300"}`,children:[r.jsx("span",{className:"text-lg leading-none",children:W.icon}),r.jsx("span",{className:"text-sm font-semibold",children:W.label}),r.jsx("span",{className:"text-[11px] text-gray-500 dark:text-gray-400",children:W.hint})]},W.value)})})]}),(!R||v==="single")&&r.jsxs("div",{children:[r.jsx("label",{className:`block text-xs sm:text-sm font-medium mb-2 ${i==="dark"?"text-gray-300":"text-gray-700"}`,children:"Дата начала"}),r.jsx("input",{type:"date",value:x,onChange:W=>f(W.target.value),className:`w-full px-3 sm:px-4 py-2 sm:py-2.5 text-sm sm:text-base rounded-lg border touch-manipulation ${i==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`})]}),R&&v==="range"&&r.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[r.jsxs("div",{children:[r.jsx("label",{className:`block text-xs sm:text-sm font-medium mb-2 ${i==="dark"?"text-gray-300":"text-gray-700"}`,children:"Начало"}),r.jsx("input",{type:"date",value:N,onChange:W=>y(W.target.value),className:`w-full px-3 sm:px-4 py-2 sm:py-2.5 text-sm sm:text-base rounded-lg border touch-manipulation ${i==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`})]}),r.jsxs("div",{children:[r.jsx("label",{className:`block text-xs sm:text-sm font-medium mb-2 ${i==="dark"?"text-gray-300":"text-gray-700"}`,children:"Конец"}),r.jsx("input",{type:"date",value:p,min:N,onChange:W=>te(W.target.value),className:`w-full px-3 sm:px-4 py-2 sm:py-2.5 text-sm sm:text-base rounded-lg border touch-manipulation ${i==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`})]})]}),!R&&s==="dayoff"&&v==="range"&&r.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[r.jsxs("div",{children:[r.jsx("label",{className:`block text-xs sm:text-sm font-medium mb-2 ${i==="dark"?"text-gray-300":"text-gray-700"}`,children:"Начало"}),r.jsx("input",{type:"date",value:N,onChange:W=>y(W.target.value),className:`w-full px-3 sm:px-4 py-2 sm:py-2.5 text-sm sm:text-base rounded-lg border touch-manipulation ${i==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`})]}),r.jsxs("div",{children:[r.jsx("label",{className:`block text-xs sm:text-sm font-medium mb-2 ${i==="dark"?"text-gray-300":"text-gray-700"}`,children:"Конец"}),r.jsx("input",{type:"date",value:p,min:N,onChange:W=>te(W.target.value),className:`w-full px-3 sm:px-4 py-2 sm:py-2.5 text-sm sm:text-base rounded-lg border touch-manipulation ${i==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`})]})]}),R&&v==="multiple"&&r.jsxs("div",{children:[r.jsx("label",{className:`block text-xs sm:text-sm font-medium mb-2 ${i==="dark"?"text-gray-300":"text-gray-700"}`,children:"Выбранные даты"}),r.jsxs("div",{className:"flex flex-col gap-3",children:[r.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[r.jsx("input",{type:"date",value:ue,onChange:W=>le(W.target.value),className:`flex-1 px-3 sm:px-4 py-2 sm:py-2.5 text-sm sm:text-base rounded-lg border touch-manipulation ${i==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`}),r.jsx("button",{type:"button",onClick:C,className:"px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg transition-colors",children:"Добавить"})]}),H.length>0?r.jsx("div",{className:"flex flex-wrap gap-2",children:H.map(W=>r.jsxs("span",{className:"inline-flex items-center gap-2 px-3 py-1.5 rounded-full bg-gray-100 text-gray-800 text-sm",children:[ie(W,"dd.MM.yyyy"),r.jsx("button",{type:"button",onClick:()=>oe(W),className:"text-red-500 hover:text-red-600",children:"x"})]},W))}):r.jsx("p",{className:"text-sm text-gray-500",children:"Пока не выбрано ни одной даты"})]})]}),!R&&s==="dayoff"&&v==="multiple"&&r.jsxs("div",{children:[r.jsx("label",{className:`block text-xs sm:text-sm font-medium mb-2 ${i==="dark"?"text-gray-300":"text-gray-700"}`,children:"Выбранные даты"}),r.jsxs("div",{className:"flex flex-col gap-3",children:[r.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[r.jsx("input",{type:"date",value:ue,onChange:W=>le(W.target.value),className:`flex-1 px-3 sm:px-4 py-2 sm:py-2.5 text-sm sm:text-base rounded-lg border touch-manipulation ${i==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`}),r.jsx("button",{type:"button",onClick:C,className:"px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg transition-colors",children:"Добавить"})]}),H.length>0?r.jsx("div",{className:"flex flex-wrap gap-2",children:H.map(W=>r.jsxs("span",{className:"inline-flex items-center gap-2 px-3 py-1.5 rounded-full bg-gray-100 text-gray-800 text-sm",children:[ie(W,"dd.MM.yyyy"),r.jsx("button",{type:"button",onClick:()=>oe(W),className:"text-red-500 hover:text-red-600",children:"x"})]},W))}):r.jsx("p",{className:"text-sm text-gray-500",children:"Пока не выбрано ни одной даты"})]})]}),v==="single"&&!R&&S==="dayoff"&&r.jsxs("div",{className:"space-y-3",children:[r.jsxs("div",{className:"rounded-xl border border-gray-200 dark:border-gray-800 p-3 sm:p-4 space-y-3",children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{children:[r.jsx("p",{className:`text-sm sm:text-base font-semibold ${c}`,children:"Повтор на неделю"}),r.jsx("p",{className:`text-xs ${i==="dark"?"text-gray-400":"text-gray-600"}`,children:"Выберите дни текущей недели"})]}),r.jsxs("label",{className:"inline-flex items-center gap-2",children:[r.jsx("input",{type:"checkbox",checked:ce,onChange:W=>B(W.target.checked),className:"w-4 h-4"}),r.jsx("span",{className:"text-sm",children:"Активировать"})]})]}),ce&&r.jsx("div",{className:"flex flex-wrap gap-2",children:O.map((W,Ne)=>{const Pe=pe.includes(Ne);return r.jsx("button",{type:"button",onClick:()=>F(Y=>Pe?Y.filter(G=>G!==Ne):[...Y,Ne]),className:`px-3 py-1 rounded-lg border text-sm ${Pe?"border-[#4E6E49] bg-[#4E6E49]/10 text-[#4E6E49]":i==="dark"?"border-white/10 bg-white/5 text-gray-200":"border-gray-200 bg-white text-gray-800"}`,children:W},W)})})]}),r.jsxs("div",{className:"rounded-xl border border-gray-200 dark:border-gray-800 p-3 sm:p-4 space-y-3",children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{children:[r.jsx("p",{className:`text-sm sm:text-base font-semibold ${c}`,children:"Повтор по месяцу"}),r.jsx("p",{className:`text-xs ${i==="dark"?"text-gray-400":"text-gray-600"}`,children:"На тот же день недели до конца месяца"})]}),r.jsxs("label",{className:"inline-flex items-center gap-2",children:[r.jsx("input",{type:"checkbox",checked:q,onChange:W=>M(W.target.checked),className:"w-4 h-4"}),r.jsx("span",{className:"text-sm",children:"Активировать"})]})]}),q&&r.jsx("div",{className:"flex flex-wrap gap-2",children:O.map((W,Ne)=>r.jsx("span",{className:`px-3 py-1 rounded-lg border text-sm ${z.includes(Ne)?"border-[#4E6E49] bg-[#4E6E49]/10 text-[#4E6E49]":i==="dark"?"border-white/10 bg-white/5 text-gray-200":"border-gray-200 bg-white text-gray-800"}`,children:W},W))})]})]}),(S==="sick"||S==="vacation")&&(!R||v==="single")&&r.jsxs("label",{className:"flex items-center gap-2",children:[r.jsx("input",{type:"checkbox",checked:A,onChange:W=>T(W.target.checked),className:"w-4 h-4"}),r.jsx("span",{className:`${i==="dark"?"text-gray-300":"text-gray-700"}`,children:"Несколько дней"})]}),A&&r.jsxs("div",{children:[r.jsx("label",{className:`block text-xs sm:text-sm font-medium mb-2 ${i==="dark"?"text-gray-300":"text-gray-700"}`,children:"Дата окончания"}),r.jsx("input",{type:"date",value:w,onChange:W=>$(W.target.value),min:x,className:`w-full px-3 sm:px-4 py-2 sm:py-2.5 text-sm sm:text-base rounded-lg border touch-manipulation ${i==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`})]}),r.jsxs("div",{children:[r.jsx("label",{className:`block text-xs sm:text-sm font-medium mb-2 ${i==="dark"?"text-gray-300":"text-gray-700"}`,children:"Комментарий"}),r.jsx("textarea",{value:K,onChange:W=>P(W.target.value),rows:3,className:`w-full px-3 sm:px-4 py-2 sm:py-2.5 text-sm sm:text-base rounded-lg border touch-manipulation resize-y ${i==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`,placeholder:"Добавьте комментарий (необязательно)"})]}),ee&&r.jsx("div",{className:"p-3 bg-red-500 text-white rounded-lg text-sm",children:ee}),r.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 sm:gap-3 pt-2",children:[r.jsx("button",{onClick:we,disabled:k||!S,className:`flex-1 px-4 py-2.5 sm:py-2 ${S?Ke[S]:"bg-gray-400"} hover:opacity-90 disabled:opacity-50 disabled:cursor-not-allowed text-white rounded-lg sm:rounded-xl transition-colors text-sm sm:text-base font-medium touch-manipulation active:scale-95 disabled:active:scale-100`,children:k?"Отправка...":o?"Сохранить":"Отправить на согласование"}),r.jsx("button",{onClick:t,className:`px-4 py-2.5 sm:py-2 rounded-lg sm:rounded-xl transition-colors text-sm sm:text-base font-medium touch-manipulation active:scale-95 ${i==="dark"?"bg-gray-700 hover:bg-gray-600 active:bg-gray-500":"bg-gray-200 hover:bg-gray-300 active:bg-gray-400"}`,children:"Отмена"})]})]})]})]})})})},Wj=({onClose:s,onSave:e})=>{const{user:t}=bt(),{theme:n}=it(),{isAdmin:a}=_t(),i=n==="dark"?"text-white":"text-gray-900",[o,c]=E.useState(a?[]:t!=null&&t.id?[t.id]:[]),[d,h]=E.useState("slots"),[m,x]=E.useState(!1),[f,w]=E.useState(!1),[$,A]=E.useState(!1),[T,K]=E.useState([]),[P,S]=E.useState([]),[L,ee]=E.useState(""),[D,k]=E.useState(""),[b,v]=E.useState(""),[j,N]=E.useState(""),[y,p]=E.useState(!1);ps();const te=["Пн","Вт","Ср","Чт","Пт","Сб","Вс"],ue=m?T.length>0?T.map(F=>te[F]).join(", "):"Дни недели":f?P[0]?`${ie(P[0],"dd.MM")} +${Math.max(P.length-1,0)}`:"Добавьте даты":$?D&&b?`${ie(D,"dd.MM")}–${ie(b,"dd.MM")}`:"Укажите диапазон":"Выберите режим",le=o.map(F=>kt(F)).join(", "),H=F=>{c(q=>q.includes(F)?q.filter(M=>M!==F):[...q,F])},ne=(F,q,M)=>{if(q&&M.some(Boolean)){N("Снимите галочку с другой функции, чтобы активировать эту");return}F(q),q||N("")},ce=()=>{if(!L){N("Выберите дату");return}if(P.includes(L)){N("Эта дата уже добавлена");return}S([...P,L].sort()),ee(""),N("")},B=F=>S(P.filter(q=>q!==F)),pe=async()=>{if(!a&&!t){N("Пользователь не найден");return}const F=a?o:t?[t.id]:[];if(F.length===0){N("Выберите хотя бы одного участника");return}if(!m&&!f&&!$){N("Выберите способ удаления");return}if(m&&T.length===0){N("Выберите день недели");return}if(f&&P.length===0){N("Добавьте хотя бы одну дату");return}if($){if(!D||!b){N("Укажите начальную и конечную дату диапазона");return}if(D>b){N("Начальная дата должна быть раньше конечной");return}}N(""),p(!0);try{const q=await Promise.all(F.map(Z=>wr(Z))),M=await Promise.all(F.map(Z=>is(Z))),z=q.flat(),I=M.flat(),R=(Z,ye)=>!D||!b?!1:!((ye||Z)<D||Z>b),O=(Z,ye)=>P.length===0?!1:ye?P.some(we=>we>=Z&&we<=(ye||Z)):P.includes(Z),U=(Z,ye)=>{if(T.length===0)return!1;const we=[],Ke=new Date(Z+"T00:00:00"),We=ye?new Date(ye+"T00:00:00"):new Date(Z+"T00:00:00");let Q=Ke;for(;Q<=We;)we.push(ie(Q,"yyyy-MM-dd")),Q.setDate(Q.getDate()+1);return we.some(me=>{const Ie=new Date(me+"T00:00:00"),de=Ie.getDay()===0?6:Ie.getDay()-1;return T.includes(de)})};let J=[];if(d==="slots"?J=z.filter(Z=>!!(m&&U(Z.date)||f&&P.includes(Z.date)||$&&R(Z.date))).map(Z=>Z.id):J=I.filter(Z=>Z.type!==d?!1:!!(m&&U(Z.date,Z.endDate)||f&&O(Z.date,Z.endDate)||$&&R(Z.date,Z.endDate))).map(Z=>Z.id),J.length===0){N("Ничего не найдено под выбранные условия"),p(!1);return}const C=F.length>1?`${F.length} участников`:kt(F[0])||"участника",oe=T.map(Z=>te[Z]).join(", "),ae=d==="slots"?"слоты":d==="dayoff"?"выходные":d==="sick"?"больничные":d==="vacation"?"отпуска":"прогулы",V=m?`по дням недели (${oe})`:f?`по датам: ${P.map(Z=>ie(Z,"dd.MM")).join(", ")}`:`по диапазону ${ie(D,"dd.MM")} — ${ie(b,"dd.MM")}`;if(!confirm(`Удалить ${ae} (${J.length}) ${V} для ${C}?`)){p(!1);return}if(a)if(d==="slots")for(const Z of J)await So(Z);else for(const Z of J)await Co(Z);else if(d==="slots")for(const Z of J){const ye=z.find(we=>we.id===Z);ye&&await Nt({entity:"slot",action:"delete",authorId:(t==null?void 0:t.id)||"",targetUserId:ye.userId,before:ye,after:null,comment:`Удаление слота ${ie(ye.date,"dd.MM.yyyy")}`})}else for(const Z of J){const ye=I.find(we=>we.id===Z);ye&&await Nt({entity:"status",action:"delete",authorId:(t==null?void 0:t.id)||"",targetUserId:ye.userId,before:ye,after:null,comment:`Удаление ${d==="dayoff"?"выходного":d==="sick"?"больничного":d==="vacation"?"отпуска":"прогула"} ${ie(ye.date,"dd.MM.yyyy")}`})}e(),s()}catch(q){console.error("Error deleting items:",q),N("Ошибка при удалении")}finally{p(!1)}};return r.jsx("div",{className:"fixed inset-0 bg-slate-950/75 backdrop-blur-xl flex items-start sm:items-center justify-center z-[70] p-4 sm:p-6 overflow-y-auto overscroll-contain modal-scroll",children:r.jsx("div",{className:`w-full max-w-5xl rounded-3xl shadow-[0_24px_80px_rgba(0,0,0,0.45)] border ${n==="dark"?"bg-gradient-to-br from-[#0c1320] via-[#0b1220] to-[#08111b] border-white/10":"bg-gradient-to-br from-white via-slate-50 to-white border-slate-200"} max-h-[85dvh] sm:max-h-[calc(100dvh-96px)] overflow-y-auto`,children:r.jsxs("div",{className:"p-5 sm:p-6 lg:p-7 flex flex-col h-full min-h-0 overflow-y-auto modal-scroll",children:[r.jsxs("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between",children:[r.jsxs("div",{className:"space-y-1",children:[r.jsx("div",{className:"flex items-center gap-2 text-xs font-semibold text-[#4E6E49] tracking-tight",children:r.jsx("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full bg-[#4E6E49]/10 text-[#4E6E49] border border-[#4E6E49]/30",children:"Очистить расписание"})}),r.jsx("h3",{className:`text-2xl sm:text-3xl font-bold ${i}`,children:"Удаление слотов и отсутствий"})]}),r.jsx("button",{onClick:s,className:`p-2.5 rounded-full border ${n==="dark"?"border-white/10 text-gray-200 hover:bg-white/5":"border-slate-200 text-slate-600 hover:bg-slate-100"}`,children:r.jsx(Rt,{className:"w-5 h-5"})})]}),r.jsxs("div",{className:"mt-5 grid lg:grid-cols-[0.95fr_1.45fr] gap-4 lg:gap-6 flex-1 overflow-hidden",children:[r.jsxs("aside",{className:`rounded-2xl border ${n==="dark"?"border-white/10 bg-white/5":"border-slate-200 bg-white"} p-4 sm:p-5 space-y-4 sticky top-0 self-start max-h-full overflow-y-auto`,children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsx("p",{className:"text-sm font-semibold",children:"Навигация"}),r.jsx("span",{className:"text-[11px] uppercase tracking-wide text-[#4E6E49] font-semibold",children:"3 шага"})]}),r.jsx("div",{className:"space-y-2",children:[{label:"Участники",detail:le||"Не выбрано",done:o.length>0||!a},{label:"Тип удаления",detail:d==="slots"?"Слоты":d==="dayoff"?"Выходные":d==="sick"?"Больничные":d==="vacation"?"Отпуска":"Прогулы",done:!0},{label:"Режим",detail:ue,done:ue!=="Выберите режим"}].map((F,q)=>r.jsxs("div",{className:`flex items-start gap-3 rounded-xl border px-3 py-3 ${n==="dark"?"border-white/10 bg-white/5":"border-slate-200 bg-slate-50"}`,children:[r.jsx("span",{className:`mt-0.5 inline-flex h-6 w-6 items-center justify-center rounded-full text-xs font-bold ${F.done?"bg-[#4E6E49] text-white":n==="dark"?"bg-slate-800 text-gray-300":"bg-slate-200 text-slate-700"}`,children:q+1}),r.jsxs("div",{className:"flex-1",children:[r.jsx("p",{className:"text-sm font-semibold",children:F.label}),r.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 truncate",children:F.detail||"—"})]})]},F.label))}),r.jsxs("div",{className:`rounded-xl border px-3 py-3 space-y-2 ${n==="dark"?"border-emerald-900/50 bg-emerald-900/20":"border-emerald-100 bg-emerald-50"}`,children:[r.jsx("p",{className:"text-xs uppercase tracking-wide text-emerald-600 font-semibold",children:"Подсказка"}),r.jsx("p",{className:"text-sm text-emerald-700 dark:text-emerald-200",children:"Один режим за раз: дни недели, конкретные даты или диапазон."})]})]}),r.jsxs("div",{className:"space-y-4 overflow-y-auto overscroll-contain pr-1 pb-6 flex-1 min-h-0",children:[r.jsxs("div",{className:"space-y-2",children:[r.jsx("p",{className:`text-sm font-semibold ${i}`,children:"Что удаляем"}),r.jsx("div",{className:"flex flex-wrap gap-2",children:[{key:"slots",label:"Слоты"},{key:"dayoff",label:"Выходные"},{key:"sick",label:"Больничные"},{key:"vacation",label:"Отпуска"},...a?[{key:"absence",label:"Прогулы"}]:[]].map(F=>r.jsx("button",{onClick:()=>h(F.key),className:`px-3 py-1.5 rounded-lg border text-sm ${d===F.key?"bg-red-500 text-white border-red-500":n==="dark"?"bg-gray-700 text-gray-200 border-gray-700 hover:bg-gray-600":"bg-gray-100 text-gray-800 border-gray-200 hover:bg-gray-200"}`,children:F.label},F.key))})]}),a&&r.jsxs("div",{className:"space-y-2",children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsx("p",{className:`text-sm font-semibold ${i}`,children:"Участники"}),r.jsx("button",{onClick:()=>c(F=>F.length===$e.length?[]:$e.map(q=>q.id)),className:"text-xs text-[#4E6E49] font-semibold",children:o.length===$e.length?"Снять выделение":"Выбрать всех"})]}),r.jsx("div",{className:"flex flex-wrap gap-2",children:$e.map(F=>{const q=o.includes(F.id);return r.jsx("button",{onClick:()=>H(F.id),className:`px-3 py-1.5 rounded-lg transition-colors text-sm ${q?"bg-red-500 text-white":n==="dark"?"bg-gray-700 text-gray-300 hover:bg-gray-600":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:kt(F.id)},F.id)})})]}),r.jsxs("label",{className:"flex items-center gap-2",children:[r.jsx("input",{type:"checkbox",checked:m,onChange:F=>ne(x,F.target.checked,[f,$]),className:"w-4 h-4"}),r.jsx("span",{className:`${n==="dark"?"text-gray-300":"text-gray-700"}`,children:"Удалить по дню недели"})]}),m&&r.jsxs("div",{className:"ml-6",children:[r.jsx("p",{className:`text-sm mb-2 ${n==="dark"?"text-gray-400":"text-gray-600"}`,children:"Выберите дни недели:"}),r.jsx("div",{className:"flex gap-2 flex-wrap",children:te.map((F,q)=>{const M=T.includes(q);return r.jsx("button",{onClick:()=>K(z=>M?z.filter(I=>I!==q):[...z,q]),className:`px-3 py-1 rounded-lg transition-colors ${M?"bg-red-500 text-white":n==="dark"?"bg-gray-700 text-gray-300":"bg-gray-200 text-gray-700"}`,children:F},F)})})]}),r.jsxs("label",{className:"flex items-center gap-2",children:[r.jsx("input",{type:"checkbox",checked:f,onChange:F=>ne(w,F.target.checked,[m,$]),className:"w-4 h-4"}),r.jsx("span",{className:`${n==="dark"?"text-gray-300":"text-gray-700"}`,children:"Удалить по конкретным датам"})]}),f&&r.jsxs("div",{className:"ml-6 space-y-3",children:[r.jsxs("div",{className:"flex gap-2",children:[r.jsx("input",{type:"date",value:L,onChange:F=>ee(F.target.value),className:`flex-1 px-4 py-2 rounded-lg border ${n==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-red-500`}),r.jsx("button",{onClick:ce,className:"px-4 py-2 bg-[#4E6E49] hover:bg-[#4E6E49] text-white rounded-lg transition-colors",children:"Добавить"})]}),P.length>0&&r.jsxs("div",{className:"space-y-2",children:[r.jsxs("p",{className:`text-sm ${n==="dark"?"text-gray-400":"text-gray-600"}`,children:["Выбранные даты (",P.length,"):"]}),r.jsx("div",{className:"flex flex-wrap gap-2",children:P.map(F=>r.jsxs("div",{className:`flex items-center gap-2 px-3 py-1 rounded-lg ${n==="dark"?"bg-gray-700":"bg-gray-100"}`,children:[r.jsx("span",{className:i,children:ie(F,"dd.MM.yyyy")}),r.jsx("button",{onClick:()=>B(F),className:"p-1 text-red-500 hover:bg-red-500 hover:text-white rounded transition-colors",children:r.jsx(Rt,{className:"w-3 h-3"})})]},F))})]})]}),r.jsxs("label",{className:"flex items-center gap-2",children:[r.jsx("input",{type:"checkbox",checked:$,onChange:F=>ne(A,F.target.checked,[m,f]),className:"w-4 h-4"}),r.jsx("span",{className:`${n==="dark"?"text-gray-300":"text-gray-700"}`,children:"Удалить по диапазону дат"})]}),$&&r.jsxs("div",{className:"ml-6 space-y-3",children:[r.jsxs("div",{className:"flex gap-2",children:[r.jsxs("div",{className:"flex-1",children:[r.jsx("label",{className:`block text-xs mb-1 ${n==="dark"?"text-gray-400":"text-gray-600"}`,children:"Начальная дата"}),r.jsx("input",{type:"date",value:D,onChange:F=>k(F.target.value),className:`w-full px-4 py-2 rounded-lg border ${n==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-red-500`})]}),r.jsxs("div",{className:"flex-1",children:[r.jsx("label",{className:`block text-xs mb-1 ${n==="dark"?"text-gray-400":"text-gray-600"}`,children:"Конечная дата"}),r.jsx("input",{type:"date",value:b,onChange:F=>v(F.target.value),min:D,className:`w-full px-4 py-2 rounded-lg border ${n==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-red-500`})]})]}),D&&b&&r.jsxs("p",{className:`text-sm ${n==="dark"?"text-gray-400":"text-gray-600"}`,children:["Будет удалено: с ",ie(D,"dd.MM.yyyy")," по ",ie(b,"dd.MM.yyyy")]})]}),j&&r.jsx("div",{className:"p-3 bg-red-500 text-white rounded-lg text-sm",children:j}),r.jsxs("div",{className:"flex gap-3",children:[r.jsxs("button",{onClick:pe,disabled:y||!m&&!f&&!$,className:"flex-1 px-4 py-2 bg-red-500 hover:bg-red-600 disabled:bg-gray-400 disabled:cursor-not-allowed text-white rounded-lg transition-colors flex items-center justify-center gap-2",children:[r.jsx(Pt,{className:"w-4 h-4"}),y?a?"Удаление...":"Отправка на согласование...":a?"Очистить расписание":"Отправить на согласование"]}),r.jsx("button",{onClick:s,className:`px-4 py-2 rounded-lg transition-colors ${n==="dark"?"bg-gray-700 hover:bg-gray-600":"bg-gray-200 hover:bg-gray-300"}`,children:"Отмена"})]})]})]})]})})})},Hj=({onClose:s,onSave:e})=>{const{user:t}=bt(),{theme:n}=it(),{isAdmin:a}=_t(),i=n==="dark"?"text-white":"text-gray-900",[o,c]=E.useState("all"),[d,h]=E.useState(ie(new Date,"yyyy-MM-dd")),[m,x]=E.useState(ie(new Date,"yyyy-MM-dd")),[f,w]=E.useState(!1),[$,A]=E.useState(""),[T,K]=E.useState(!1),[P,S]=E.useState(""),[L,ee]=E.useState(""),[D,k]=E.useState(!1),[b,v]=E.useState(!0),[j,N]=E.useState(!1),[y,p]=E.useState([]),[te,ue]=E.useState(!1),[le,H]=E.useState(!1),[ne,ce]=E.useState(null);ps(),E.useEffect(()=>{f||x(d)},[f,d]),E.useEffect(()=>{B()},[]);const B=async()=>{if(a){ue(!0);try{const I=await Wl();p(I)}catch(I){console.error("Error loading restrictions:",I)}finally{ue(!1)}}},pe=I=>{ce(I),c(I.type),h(I.startDate),x(I.endDate||I.startDate),w(!!I.endDate),A(I.startTime||""),K(!!I.startTime),S(I.comment||""),v(I.isActive),N(I.blockFutureDates||!1),H(!0),ee("")},F=async I=>{if(confirm("Вы уверены, что хотите удалить это ограничение?"))try{await oj(I),await B(),ee("")}catch(R){console.error("Error deleting restriction:",R),ee(R.message||"Ошибка при удалении ограничения")}},q=()=>{ce(null),c("all"),h(ie(new Date,"yyyy-MM-dd")),x(ie(new Date,"yyyy-MM-dd")),w(!1),A(""),K(!1),S(""),v(!0),N(!1),H(!0),ee("")},M={slots:"Слоты",dayoff:"Выходные",sick:"Больничные",vacation:"Отпуска",absence:"Прогулы",all:"Всё"},z=async()=>{if(console.log("handleSave called, isAdmin:",a,"user:",t),!a){ee("Только администратор может управлять ограничениями. Активируйте админ режим на странице входа.");return}if(!d){ee("Выберите дату начала ограничения");return}if(f&&m&&d>m){ee("Дата окончания должна быть позже даты начала");return}try{const I=await Wl(!0),R=ne==null?void 0:ne.id;if(I.some(U=>{if(U.id===R)return!1;const J=new Date(U.startDate),C=U.endDate?new Date(U.endDate):J,oe=new Date(d),V=!((f&&m?new Date(m):oe)<J||oe>C),Z=U.type===o||U.type==="all"||o==="all";return V&&Z})){ee("Уже существует пересекающееся ограничение для этого типа/периода");return}}catch(I){console.error("Error checking restrictions:",I)}ee(""),k(!0);try{const I={type:o,startDate:d,...f&&m!==d&&{endDate:m},...T&&$&&{startTime:$},...j&&{blockFutureDates:j},...P&&{comment:P},createdBy:(t==null?void 0:t.id)||"admin",createdAt:(ne==null?void 0:ne.createdAt)||new Date().toISOString(),isActive:b};ne?await ij(ne.id,I):await aj(I),await B(),H(!1),e()}catch(I){console.error("Error saving restriction:",I),ee(I.message||"Ошибка при сохранении ограничения")}finally{k(!1)}};return r.jsx("div",{className:"fixed inset-0 bg-slate-950/75 backdrop-blur-xl flex items-start sm:items-center justify-center z-[70] p-4 sm:p-6 touch-manipulation overflow-y-auto",children:r.jsx("div",{className:`w-full max-w-2xl rounded-3xl shadow-[0_24px_80px_rgba(0,0,0,0.45)] border ${n==="dark"?"bg-gradient-to-br from-[#0c1320] via-[#0b1220] to-[#08111b] border-white/10":"bg-gradient-to-br from-white via-slate-50 to-white border-slate-200"} max-h-[90vh] overflow-y-auto`,children:r.jsxs("div",{className:"p-4 sm:p-6 lg:p-7 flex flex-col h-full min-h-0 overflow-y-auto",children:[r.jsxs("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between",children:[r.jsxs("div",{className:"space-y-1",children:[r.jsx("div",{className:"flex items-center gap-2 text-xs font-semibold text-orange-600 tracking-tight",children:r.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full bg-orange-500/10 text-orange-600 border border-orange-500/30",children:[r.jsx(At,{className:"w-3 h-3"}),"Управление ограничениями"]})}),r.jsx("h3",{className:`text-2xl sm:text-3xl font-bold ${i}`,children:"Ограничения для команды"}),r.jsx("p",{className:`text-sm ${n==="dark"?"text-gray-400":"text-gray-600"}`,children:"Запретить участникам создавать определённые записи в указанный период"})]}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsxs("div",{className:`px-3 py-2 rounded-xl border text-xs sm:text-sm ${n==="dark"?"border-white/10 bg-white/5 text-gray-200":"border-slate-200 bg-slate-50 text-slate-700"}`,children:["Админ · Управление ",a?"(активен)":"(не активен)"]}),r.jsx("button",{onClick:s,className:`p-2.5 rounded-full border ${n==="dark"?"border-white/10 text-gray-200 hover:bg-white/5":"border-slate-200 text-slate-600 hover:bg-slate-100"} transition-colors touch-manipulation`,"aria-label":"Закрыть",children:r.jsx(Rt,{className:"w-4 h-4 sm:w-5 sm:h-5"})})]})]}),r.jsxs("div",{className:"mt-5 space-y-6 flex-1 min-h-0",children:[r.jsxs("div",{children:[r.jsxs("div",{className:"flex items-center justify-between mb-4",children:[r.jsx("h4",{className:`text-lg font-semibold ${i}`,children:"Существующие ограничения"}),r.jsxs("div",{className:"flex gap-2",children:[r.jsxs("button",{onClick:q,className:`flex items-center gap-2 px-3 py-2 rounded-lg text-sm font-medium transition-colors ${le?"bg-orange-500 text-white":n==="dark"?"bg-gray-700 text-gray-200 hover:bg-gray-600":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:[r.jsx(os,{className:"w-4 h-4"}),le?"Создать новое":"Создать ограничение"]}),r.jsxs("button",{onClick:async()=>{const I=ie(new Date,"yyyy-MM-dd"),R=await Zi("slots",I,"10:00");alert(`Test result: ${R.restricted?"BLOCKED":"ALLOWED"}
${R.reason||"No restrictions"}`)},className:"flex items-center gap-2 px-3 py-2 rounded-lg text-sm font-medium bg-blue-500 text-white hover:bg-blue-600 transition-colors",children:[r.jsx(At,{className:"w-4 h-4"}),"Тест ограничений"]})]})]}),te?r.jsx("div",{className:`p-6 rounded-xl border ${n==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-gray-50"} text-center`,children:r.jsx("p",{className:n==="dark"?"text-gray-400":"text-gray-600",children:"Загрузка..."})}):y.length===0?r.jsxs("div",{className:`p-6 rounded-xl border ${n==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-gray-50"} text-center`,children:[r.jsx(Ut,{className:`w-8 h-8 mx-auto mb-2 ${n==="dark"?"text-gray-400":"text-gray-500"}`}),r.jsx("p",{className:n==="dark"?"text-gray-400":"text-gray-600",children:"Нет активных ограничений"})]}):r.jsx("div",{className:"space-y-3",children:y.map(I=>r.jsx("div",{className:`p-4 rounded-xl border transition-all ${I.isActive?n==="dark"?"border-orange-500/30 bg-orange-500/5":"border-orange-200 bg-orange-50":n==="dark"?"border-gray-600 bg-gray-800/50":"border-gray-300 bg-gray-100"}`,children:r.jsxs("div",{className:"flex items-start justify-between",children:[r.jsxs("div",{className:"flex-1",children:[r.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[r.jsxs("span",{className:`inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium ${I.isActive?"bg-orange-100 text-orange-800 dark:bg-orange-900/50 dark:text-orange-200":"bg-gray-100 text-gray-600 dark:bg-gray-700 dark:text-gray-400"}`,children:[I.isActive?r.jsx(Ut,{className:"w-3 h-3"}):r.jsx(At,{className:"w-3 h-3"}),M[I.type]]}),!I.isActive&&r.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Неактивно"})]}),r.jsxs("div",{className:"space-y-1 text-sm",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(gs,{className:"w-4 h-4 text-gray-500"}),r.jsx("span",{className:i,children:I.endDate?`${ie(I.startDate,"dd.MM.yyyy")} - ${ie(I.endDate,"dd.MM.yyyy")}`:ie(I.startDate,"dd.MM.yyyy")})]}),I.startTime&&r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(Dr,{className:"w-4 h-4 text-gray-500"}),r.jsxs("span",{className:n==="dark"?"text-gray-300":"text-gray-700",children:["С ",I.startTime]})]}),I.blockFutureDates&&r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(Ut,{className:"w-4 h-4 text-amber-500"}),r.jsx("span",{className:`text-xs ${n==="dark"?"text-amber-300":"text-amber-700"}`,children:"Блокировка следующего дня после наступления времени ограничения"})]}),I.comment&&r.jsx("div",{className:"text-gray-600 dark:text-gray-400 italic",children:I.comment})]})]}),r.jsxs("div",{className:"flex items-center gap-1 ml-4",children:[r.jsx("button",{onClick:()=>pe(I),className:"p-2 text-blue-500 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded-lg transition-colors",title:"Редактировать",children:r.jsx(cr,{className:"w-4 h-4"})}),r.jsx("button",{onClick:()=>F(I.id),className:"p-2 text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition-colors",title:"Удалить",children:r.jsx(Pt,{className:"w-4 h-4"})})]})]})},I.id))})]}),le&&r.jsxs("div",{className:"border-t pt-6",children:[r.jsx("h4",{className:`text-lg font-semibold mb-4 ${i}`,children:ne?"Редактировать ограничение":"Создать новое ограничение"}),r.jsxs("div",{children:[r.jsx("label",{className:`block text-xs sm:text-sm font-medium mb-3 ${n==="dark"?"text-gray-300":"text-gray-700"}`,children:"Что запретить"}),r.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-3",children:Object.entries(M).map(([I,R])=>r.jsxs("label",{className:`relative flex items-center gap-3 p-3 rounded-xl border cursor-pointer transition-all ${o===I?"bg-orange-100 text-orange-800 border-orange-200 dark:bg-orange-900/30 dark:text-orange-100 dark:border-orange-800 ring-2 ring-orange-500/50 shadow-lg":n==="dark"?"border-white/10 bg-white/5 text-gray-200 hover:border-white/30":"border-slate-200 bg-white text-gray-800 hover:border-slate-300"}`,children:[r.jsx("input",{type:"radio",value:I,checked:o===I,onChange:O=>c(O.target.value),className:"hidden"}),r.jsx("span",{className:`text-sm font-semibold ${o===I?"text-orange-700 dark:text-orange-200":""}`,children:R})]},I))})]}),r.jsxs("div",{children:[r.jsx("label",{className:`block text-xs sm:text-sm font-medium mb-3 ${n==="dark"?"text-gray-300":"text-gray-700"}`,children:"Период ограничения"}),r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{className:"flex items-center gap-4",children:[r.jsxs("label",{className:"flex items-center gap-2 text-sm cursor-pointer",children:[r.jsx("input",{type:"radio",checked:!f,onChange:()=>w(!1),className:`w-4 h-4 rounded border-2 ${n==="dark"?"border-gray-800 bg-gray-700 checked:bg-[#4E6E49] checked:border-[#4E6E49]":"border-gray-300 bg-white checked:bg-[#4E6E49] checked:border-[#4E6E49]"} focus:ring-2 focus:ring-[#4E6E49] cursor-pointer touch-manipulation`}),r.jsx("span",{className:n==="dark"?"text-gray-200":"text-gray-700",children:"Один день"})]}),r.jsxs("label",{className:"flex items-center gap-2 text-sm cursor-pointer",children:[r.jsx("input",{type:"radio",checked:f,onChange:()=>w(!0),className:`w-4 h-4 rounded border-2 ${n==="dark"?"border-gray-800 bg-gray-700 checked:bg-[#4E6E49] checked:border-[#4E6E49]":"border-gray-300 bg-white checked:bg-[#4E6E49] checked:border-[#4E6E49]"} focus:ring-2 focus:ring-[#4E6E49] cursor-pointer touch-manipulation`}),r.jsx("span",{className:n==="dark"?"text-gray-200":"text-gray-700",children:"Диапазон дат"})]})]}),r.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[r.jsxs("div",{children:[r.jsx("label",{className:`block text-xs sm:text-sm font-medium mb-2 ${n==="dark"?"text-gray-300":"text-gray-700"}`,children:"Дата начала"}),r.jsx("input",{type:"date",value:d,onChange:I=>h(I.target.value),className:`w-full px-3 sm:px-4 py-2 sm:py-2.5 text-sm sm:text-base rounded-lg border touch-manipulation ${n==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`})]}),f&&r.jsxs("div",{children:[r.jsx("label",{className:`block text-xs sm:text-sm font-medium mb-2 ${n==="dark"?"text-gray-300":"text-gray-700"}`,children:"Дата окончания"}),r.jsx("input",{type:"date",value:m,min:d,onChange:I=>x(I.target.value),className:`w-full px-3 sm:px-4 py-2 sm:py-2.5 text-sm sm:text-base rounded-lg border touch-manipulation ${n==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`})]})]})]})]}),r.jsxs("div",{children:[r.jsx("label",{className:`block text-xs sm:text-sm font-medium mb-3 ${n==="dark"?"text-gray-300":"text-gray-700"}`,children:"Временное ограничение"}),r.jsxs("div",{className:"space-y-3",children:[r.jsxs("label",{className:"flex items-center gap-2 text-sm cursor-pointer",children:[r.jsx("input",{type:"checkbox",checked:T,onChange:I=>K(I.target.checked),className:`w-4 h-4 rounded border-2 ${n==="dark"?"border-gray-800 bg-gray-700 checked:bg-[#4E6E49] checked:border-[#4E6E49]":"border-gray-300 bg-white checked:bg-[#4E6E49] checked:border-[#4E6E49]"} focus:ring-2 focus:ring-[#4E6E49] cursor-pointer touch-manipulation`}),r.jsx("span",{className:n==="dark"?"text-gray-200":"text-gray-700",children:"Запретить начиная с определённого времени"})]}),T&&r.jsxs("div",{className:"ml-6",children:[r.jsx("label",{className:`block text-xs sm:text-sm font-medium mb-2 ${n==="dark"?"text-gray-300":"text-gray-700"}`,children:"Время начала ограничения"}),r.jsx("input",{type:"time",value:$,onChange:I=>A(I.target.value),className:`w-full max-w-xs px-3 sm:px-4 py-2 sm:py-2.5 text-sm sm:text-base rounded-lg border touch-manipulation ${n==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`})]})]})]}),r.jsxs("div",{children:[r.jsx("label",{className:`block text-xs sm:text-sm font-medium mb-2 ${n==="dark"?"text-gray-300":"text-gray-700"}`,children:"Комментарий"}),r.jsx("textarea",{value:P,onChange:I=>S(I.target.value),rows:3,className:`w-full px-3 sm:px-4 py-2 sm:py-2.5 text-sm sm:text-base rounded-lg border touch-manipulation resize-y ${n==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`,placeholder:"Причина ограничения (необязательно)"})]}),ne&&r.jsx("div",{children:r.jsxs("label",{className:"flex items-center gap-2 text-sm cursor-pointer",children:[r.jsx("input",{type:"checkbox",checked:b,onChange:I=>v(I.target.checked),className:`w-4 h-4 rounded border-2 ${n==="dark"?"border-gray-800 bg-gray-700 checked:bg-[#4E6E49] checked:border-[#4E6E49]":"border-gray-300 bg-white checked:bg-[#4E6E49] checked:border-[#4E6E49]"} focus:ring-2 focus:ring-[#4E6E49] cursor-pointer touch-manipulation`}),r.jsx("span",{className:n==="dark"?"text-gray-200":"text-gray-700",children:"Ограничение активно"})]})}),r.jsxs("div",{children:[r.jsxs("label",{className:"flex items-center gap-2 text-sm cursor-pointer",children:[r.jsx("input",{type:"checkbox",checked:j,onChange:I=>N(I.target.checked),className:`w-4 h-4 rounded border-2 ${n==="dark"?"border-gray-800 bg-gray-700 checked:bg-[#4E6E49] checked:border-[#4E6E49]":"border-gray-300 bg-white checked:bg-[#4E6E49] checked:border-[#4E6E49]"} focus:ring-2 focus:ring-[#4E6E49] cursor-pointer touch-manipulation`}),r.jsx("span",{className:n==="dark"?"text-gray-200":"text-gray-700",children:"После наступления даты/времени ограничения блокировать создание записей только на следующий день"})]}),j&&r.jsx("p",{className:`mt-2 text-xs ${n==="dark"?"text-gray-400":"text-gray-600"}`,children:"Пример: после 14.12 21:00 нельзя будет создавать слоты/отпуска только на 15.12 (следующий день)"})]}),L&&r.jsx("div",{className:"p-3 bg-red-500 text-white rounded-lg text-sm",children:L}),r.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 sm:gap-3 pt-2",children:[r.jsx("button",{onClick:z,disabled:D,className:"flex-1 px-4 py-2.5 sm:py-2 bg-orange-500 hover:bg-orange-600 disabled:bg-gray-400 disabled:cursor-not-allowed text-white rounded-lg sm:rounded-xl transition-colors text-sm sm:text-base font-medium touch-manipulation active:scale-95 disabled:active:scale-100",children:D?"Сохранение...":ne?"Сохранить изменения":"Создать ограничение"}),r.jsx("button",{onClick:s,className:`px-4 py-2.5 sm:py-2 rounded-lg sm:rounded-xl transition-colors text-sm sm:text-base font-medium touch-manipulation active:scale-95 ${n==="dark"?"bg-gray-700 hover:bg-gray-600 active:bg-gray-500":"bg-gray-200 hover:bg-gray-300 active:bg-gray-400"}`,children:"Отмена"})]})]})]})]})})})},Gj=({onClose:s})=>{const{theme:e}=it(),{user:t}=bt(),{isAdmin:n}=_t();ps();const[a,i]=E.useState([]),[o,c]=E.useState(!0),[d,h]=E.useState(!1),[m,x]=E.useState(""),[f,w]=E.useState(null),[$,A]=E.useState(!1),[T,K]=E.useState({userId:"",restrictedUserId:"",reason:"",isActive:!0});E.useEffect(()=>{P()},[]);const P=async()=>{try{const j=await B0();i(j)}catch(j){console.error("Error loading conflicts:",j)}finally{c(!1)}},S=async j=>{if(j.preventDefault(),!t&&!n){x("Пользователь не найден (необходима авторизация)");return}h(!0),x("");try{const N={...T,createdBy:(t==null?void 0:t.id)||"admin",createdAt:new Date().toISOString()};f?await Ih(f.id,N):await Ej(N),await P(),k(),A(!1),w(null)}catch(N){console.error("Error saving conflict:",N),x(N.message||"Ошибка при сохранении конфликта")}finally{h(!1)}},L=j=>{w(j),K({userId:j.userId,restrictedUserId:j.restrictedUserId,reason:j.reason||"",isActive:j.isActive}),x(""),A(!0)},ee=async j=>{if(confirm("Удалить конфликт?"))try{await Ij(j),await P()}catch(N){console.error("Error deleting conflict:",N)}},D=async j=>{try{await Ih(j.id,{isActive:!j.isActive}),await P()}catch(N){console.error("Error toggling conflict status:",N)}},k=()=>{x(""),K({userId:"",restrictedUserId:"",reason:"",isActive:!0})},b=j=>{const N=$e.find(y=>y.id===j);return(N==null?void 0:N.name)||j},v=$e.filter(j=>j.id!==T.userId);return o?r.jsx("div",{className:"flex items-center justify-center p-8",children:r.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-4 border-[#4E6E49] border-t-transparent"})}):r.jsx("div",{className:"fixed inset-0 bg-slate-950/75 backdrop-blur-xl flex items-start sm:items-center justify-center z-[70] p-4 overflow-y-auto touch-manipulation",children:r.jsxs("div",{className:`w-full max-w-4xl rounded-3xl shadow-[0_24px_80px_rgba(0,0,0,0.45)] border ${e==="dark"?"bg-gradient-to-br from-[#0c1320] via-[#0b1220] to-[#08111b] border-white/10":"bg-gradient-to-br from-white via-slate-50 to-white border-slate-200"} max-h-[90vh] overflow-hidden flex flex-col`,children:[r.jsx("div",{className:"p-6 border-b border-white/10",children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx("div",{className:"w-10 h-10 rounded-xl flex items-center justify-center bg-red-500/10 text-red-500",children:r.jsx(fl,{className:"w-5 h-5"})}),r.jsxs("div",{children:[r.jsx("h3",{className:`text-xl font-bold ${e==="dark"?"text-white":"text-gray-900"}`,children:"Управление конфликтами пользователей"}),r.jsx("p",{className:`text-sm ${e==="dark"?"text-gray-400":"text-gray-600"}`,children:"Настройте ограничения на совместную работу пользователей"})]})]}),r.jsx("button",{onClick:s,className:`p-2 rounded-full border ${e==="dark"?"border-white/10 text-gray-200 hover:bg-white/5":"border-slate-200 text-slate-600 hover:bg-slate-100"} transition-colors`,children:r.jsx(Rt,{className:"w-5 h-5"})})]})}),r.jsx("div",{className:"flex-1 overflow-y-auto",children:r.jsx("div",{className:"p-6",children:r.jsxs("div",{className:"space-y-6",children:[($||f)&&r.jsxs("div",{className:`rounded-2xl border p-6 ${e==="dark"?"border-white/10 bg-white/5":"border-slate-200 bg-slate-50"}`,children:[r.jsx("h4",{className:`text-lg font-semibold mb-4 ${e==="dark"?"text-white":"text-gray-900"}`,children:f?"Редактировать конфликт":"Добавить конфликт"}),m&&r.jsxs("div",{className:"mb-4 p-3 rounded-lg bg-red-500/10 border border-red-500/20 flex items-start gap-3",children:[r.jsx(no,{className:"w-5 h-5 text-red-500 shrink-0 mt-0.5"}),r.jsx("p",{className:"text-sm text-red-500",children:m})]}),r.jsxs("form",{onSubmit:S,className:"space-y-4",children:[r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[r.jsxs("div",{children:[r.jsx("label",{className:`block text-sm font-medium mb-2 ${e==="dark"?"text-gray-300":"text-gray-700"}`,children:"Пользователь"}),r.jsxs("select",{value:T.userId,onChange:j=>K(N=>({...N,userId:j.target.value})),className:`w-full px-3 py-2 rounded-lg border ${e==="dark"?"bg-gray-700 border-gray-600 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`,required:!0,children:[r.jsx("option",{value:"",children:"Выберите пользователя"}),$e.map(j=>r.jsx("option",{value:j.id,children:j.name},j.id))]})]}),r.jsxs("div",{children:[r.jsx("label",{className:`block text-sm font-medium mb-2 ${e==="dark"?"text-gray-300":"text-gray-700"}`,children:"Запрещено работать с"}),r.jsxs("select",{value:T.restrictedUserId,onChange:j=>K(N=>({...N,restrictedUserId:j.target.value})),className:`w-full px-3 py-2 rounded-lg border ${e==="dark"?"bg-gray-700 border-gray-600 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`,required:!0,children:[r.jsx("option",{value:"",children:"Выберите пользователя"}),v.map(j=>r.jsx("option",{value:j.id,children:j.name},j.id))]})]})]}),r.jsxs("div",{children:[r.jsx("label",{className:`block text-sm font-medium mb-2 ${e==="dark"?"text-gray-300":"text-gray-700"}`,children:"Причина (опционально)"}),r.jsx("textarea",{value:T.reason,onChange:j=>K(N=>({...N,reason:j.target.value})),className:`w-full px-3 py-2 rounded-lg border resize-none ${e==="dark"?"bg-gray-700 border-gray-600 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`,rows:3,placeholder:"Объяснение ограничения..."})]}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("input",{type:"checkbox",id:"isActive",checked:T.isActive,onChange:j=>K(N=>({...N,isActive:j.target.checked})),className:"rounded border-gray-300 text-[#4E6E49] focus:ring-[#4E6E49]"}),r.jsx("label",{htmlFor:"isActive",className:`text-sm ${e==="dark"?"text-gray-300":"text-gray-700"}`,children:"Активно"})]}),r.jsxs("div",{className:"flex gap-3 pt-4",children:[r.jsx("button",{type:"submit",disabled:d,className:"flex-1 px-4 py-2 bg-[#4E6E49] hover:bg-[#4E6E49] text-white rounded-lg transition-colors disabled:opacity-50 flex items-center justify-center gap-2",children:d?r.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-white border-t-transparent"}):r.jsxs(r.Fragment,{children:[r.jsx(Zl,{className:"w-4 h-4"}),f?"Сохранить":"Добавить"]})}),r.jsx("button",{type:"button",onClick:()=>{k(),A(!1),w(null)},className:`px-4 py-2 rounded-lg border ${e==="dark"?"border-gray-600 text-gray-200 hover:bg-gray-700":"border-gray-300 text-gray-700 hover:bg-gray-100"} transition-colors`,children:"Отмена"})]})]})]}),r.jsxs("div",{className:`rounded-2xl border ${e==="dark"?"border-white/10 bg-white/5":"border-slate-200 bg-white"}`,children:[r.jsx("div",{className:"p-6 border-b border-white/10",children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("h4",{className:`text-lg font-semibold ${e==="dark"?"text-white":"text-gray-900"}`,children:["Активные конфликты (",a.filter(j=>j.isActive).length,")"]}),r.jsxs("button",{onClick:()=>{x(""),A(!0)},className:"px-4 py-2 bg-[#4E6E49] hover:bg-[#4E6E49] text-white rounded-lg transition-colors flex items-center gap-2",children:[r.jsx(os,{className:"w-4 h-4"}),"Добавить конфликт"]})]})}),r.jsx("div",{className:"p-6",children:a.length===0?r.jsxs("div",{className:"text-center py-8",children:[r.jsx(fl,{className:`w-12 h-12 mx-auto mb-4 ${e==="dark"?"text-gray-600":"text-gray-400"}`}),r.jsx("p",{className:`text-lg ${e==="dark"?"text-gray-400":"text-gray-600"}`,children:"Нет настроенных конфликтов"})]}):r.jsx("div",{className:"space-y-4",children:a.map(j=>r.jsxs("div",{className:`flex items-center justify-between p-4 rounded-xl border ${j.isActive?e==="dark"?"border-red-500/30 bg-red-500/10":"border-red-200 bg-red-50":e==="dark"?"border-gray-600 bg-gray-700/50":"border-gray-200 bg-gray-50"}`,children:[r.jsxs("div",{className:"flex-1",children:[r.jsxs("div",{className:`font-medium ${e==="dark"?"text-white":"text-gray-900"}`,children:[b(j.userId)," ↔ ",b(j.restrictedUserId)]}),j.reason&&r.jsx("div",{className:`text-sm mt-1 ${e==="dark"?"text-gray-400":"text-gray-600"}`,children:j.reason}),r.jsxs("div",{className:"text-xs mt-1 text-gray-500",children:["Создано: ",new Date(j.createdAt).toLocaleDateString("ru-RU")]})]}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("button",{onClick:()=>D(j),className:`px-3 py-1 rounded-full text-xs font-medium transition-colors ${j.isActive?"bg-red-500 text-white":e==="dark"?"bg-gray-600 text-gray-300":"bg-gray-200 text-gray-700"}`,children:j.isActive?"Активен":"Неактивен"}),r.jsx("button",{onClick:()=>L(j),className:`p-2 rounded-lg ${e==="dark"?"hover:bg-gray-700 text-gray-400":"hover:bg-gray-100 text-gray-600"} transition-colors`,children:r.jsx(cr,{className:"w-4 h-4"})}),r.jsx("button",{onClick:()=>ee(j.id),className:"p-2 rounded-lg text-red-500 hover:bg-red-500 hover:text-white transition-colors",children:r.jsx(Pt,{className:"w-4 h-4"})})]})]},j.id))})})]})]})})})]})})},$h=[{value:"all",label:"Весь доступ",description:"Блокировать весь сайт"},{value:"login",label:"Вход в систему",description:"Запретить авторизацию"},{value:"slots",label:"Управление слотами",description:"Блокировать создание/редактирование слотов"},{value:"earnings",label:"Доходы",description:"Блокировать добавление доходов"},{value:"tasks",label:"Задачи",description:"Блокировать управление задачами"},{value:"rating",label:"Рейтинг",description:"Блокировать просмотр рейтинга"},{value:"profile",label:"Профиль",description:"Блокировать редактирование профиля"},{value:"admin",label:"Админ-панель",description:"Блокировать доступ к админке"}],Kj=({onClose:s})=>{const{theme:e}=it(),{user:t}=bt(),{isAdmin:n}=_t();ps();const[a,i]=E.useState([]),[o,c]=E.useState(!0),[d,h]=E.useState(!1),[m,x]=E.useState(""),[f,w]=E.useState(null),[$,A]=E.useState(!1),[T,K]=E.useState({userId:"",reason:"",expiresAt:"",blockFeatures:[],isActive:!0});E.useEffect(()=>{P()},[]);const P=async()=>{try{const y=await Gl();i(y)}catch(y){console.error("Error loading blocks:",y)}finally{c(!1)}},S=async y=>{if(y.preventDefault(),!t&&!n){x("Пользователь не найден (необходима авторизация)");return}h(!0),x("");try{const p={reason:T.reason,blockFeatures:T.blockFeatures,isActive:T.isActive,createdBy:(t==null?void 0:t.id)||"admin",createdAt:new Date().toISOString(),...T.userId?{userId:T.userId}:{},...T.expiresAt?{expiresAt:T.expiresAt}:{}};f?await eo(f.id,p):await Tj(p),await P(),b(),A(!1),w(null)}catch(p){console.error("Error saving block:",p),x(p.message||"Ошибка при сохранении блокировки")}finally{h(!1)}},L=y=>{w(y),K({userId:y.userId||"",reason:y.reason,expiresAt:y.expiresAt||"",blockFeatures:y.blockFeatures,isActive:y.isActive}),x(""),A(!0)},ee=async y=>{if(confirm("Удалить блокировку доступа?"))try{await Sj(y),await P()}catch(p){console.error("Error deleting block:",p)}},D=async y=>{try{await eo(y.id,{isActive:!y.isActive}),await P()}catch(p){console.error("Error toggling block status:",p)}},k=y=>{K(p=>({...p,blockFeatures:p.blockFeatures.includes(y)?p.blockFeatures.filter(te=>te!==y):[...p.blockFeatures,y]}))},b=()=>{x(""),K({userId:"",reason:"",expiresAt:"",blockFeatures:[],isActive:!0})},v=y=>{if(!y)return"Все пользователи";const p=$e.find(te=>te.id===y);return(p==null?void 0:p.name)||y},j=y=>{const p=$h.find(te=>te.value===y);return(p==null?void 0:p.label)||y},N=y=>y?new Date(y)<new Date:!1;return o?r.jsx("div",{className:"flex items-center justify-center p-8",children:r.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-4 border-[#4E6E49] border-t-transparent"})}):r.jsx("div",{className:"fixed inset-0 bg-slate-950/75 backdrop-blur-xl flex items-start sm:items-center justify-center z-[70] p-4 overflow-y-auto touch-manipulation",children:r.jsxs("div",{className:`w-full max-w-4xl rounded-3xl shadow-[0_24px_80px_rgba(0,0,0,0.45)] border ${e==="dark"?"bg-gradient-to-br from-[#0c1320] via-[#0b1220] to-[#08111b] border-white/10":"bg-gradient-to-br from-white via-slate-50 to-white border-slate-200"} max-h-[90vh] overflow-hidden flex flex-col`,children:[r.jsx("div",{className:"p-6 border-b border-white/10",children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx("div",{className:"w-10 h-10 rounded-xl flex items-center justify-center bg-red-500/10 text-red-500",children:r.jsx(tc,{className:"w-5 h-5"})}),r.jsxs("div",{children:[r.jsx("h3",{className:`text-xl font-bold ${e==="dark"?"text-white":"text-gray-900"}`,children:"Управление доступом"}),r.jsx("p",{className:`text-sm ${e==="dark"?"text-gray-400":"text-gray-600"}`,children:"Блокировка доступа к функциям сайта"})]})]}),r.jsx("button",{onClick:s,className:`p-2 rounded-full border ${e==="dark"?"border-white/10 text-gray-200 hover:bg-white/5":"border-slate-200 text-slate-600 hover:bg-slate-100"} transition-colors`,children:r.jsx(Rt,{className:"w-5 h-5"})})]})}),r.jsx("div",{className:"flex-1 overflow-y-auto",children:r.jsx("div",{className:"p-6",children:r.jsxs("div",{className:"space-y-6",children:[($||f)&&r.jsxs("div",{className:`rounded-2xl border p-6 ${e==="dark"?"border-white/10 bg-white/5":"border-slate-200 bg-slate-50"}`,children:[r.jsx("h4",{className:`text-lg font-semibold mb-4 ${e==="dark"?"text-white":"text-gray-900"}`,children:f?"Редактировать блокировку":"Добавить блокировку"}),m&&r.jsxs("div",{className:"mb-4 p-3 rounded-lg bg-red-500/10 border border-red-500/20 flex items-start gap-3",children:[r.jsx(no,{className:"w-5 h-5 text-red-500 shrink-0 mt-0.5"}),r.jsx("p",{className:"text-sm text-red-500",children:m})]}),r.jsxs("form",{onSubmit:S,className:"space-y-4",children:[r.jsxs("div",{children:[r.jsx("label",{className:`block text-sm font-medium mb-2 ${e==="dark"?"text-gray-300":"text-gray-700"}`,children:"Пользователь (оставьте пустым для блокировки всем)"}),r.jsxs("select",{value:T.userId,onChange:y=>K(p=>({...p,userId:y.target.value})),className:`w-full px-3 py-2 rounded-lg border ${e==="dark"?"bg-gray-700 border-gray-600 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`,children:[r.jsx("option",{value:"",children:"Все пользователи"}),$e.map(y=>r.jsx("option",{value:y.id,children:y.name},y.id))]})]}),r.jsxs("div",{children:[r.jsx("label",{className:`block text-sm font-medium mb-2 ${e==="dark"?"text-gray-300":"text-gray-700"}`,children:"Блокируемые функции"}),r.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:$h.map(y=>r.jsxs("label",{className:`flex items-start gap-3 p-3 rounded-lg border cursor-pointer transition-colors ${T.blockFeatures.includes(y.value)?e==="dark"?"border-red-500/50 bg-red-500/10":"border-red-200 bg-red-50":e==="dark"?"border-gray-600 hover:border-gray-500":"border-gray-200 hover:border-gray-300"}`,children:[r.jsx("input",{type:"checkbox",checked:T.blockFeatures.includes(y.value),onChange:()=>k(y.value),className:"mt-0.5 rounded border-gray-300 text-red-500 focus:ring-red-500"}),r.jsxs("div",{className:"flex-1",children:[r.jsx("div",{className:`font-medium text-sm ${e==="dark"?"text-white":"text-gray-900"}`,children:y.label}),r.jsx("div",{className:`text-xs ${e==="dark"?"text-gray-400":"text-gray-600"}`,children:y.description})]})]},y.value))})]}),r.jsxs("div",{children:[r.jsx("label",{className:`block text-sm font-medium mb-2 ${e==="dark"?"text-gray-300":"text-gray-700"}`,children:"Причина блокировки *"}),r.jsx("textarea",{value:T.reason,onChange:y=>K(p=>({...p,reason:y.target.value})),className:`w-full px-3 py-2 rounded-lg border resize-none ${e==="dark"?"bg-gray-700 border-gray-600 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`,rows:3,placeholder:"Объяснение блокировки...",required:!0})]}),r.jsxs("div",{children:[r.jsx("label",{className:`block text-sm font-medium mb-2 ${e==="dark"?"text-gray-300":"text-gray-700"}`,children:"Дата окончания (опционально)"}),r.jsx("input",{type:"datetime-local",value:T.expiresAt,onChange:y=>K(p=>({...p,expiresAt:y.target.value})),className:`w-full px-3 py-2 rounded-lg border ${e==="dark"?"bg-gray-700 border-gray-600 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`})]}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("input",{type:"checkbox",id:"isActive",checked:T.isActive,onChange:y=>K(p=>({...p,isActive:y.target.checked})),className:"rounded border-gray-300 text-red-500 focus:ring-red-500"}),r.jsx("label",{htmlFor:"isActive",className:`text-sm ${e==="dark"?"text-gray-300":"text-gray-700"}`,children:"Активна"})]}),r.jsxs("div",{className:"flex gap-3 pt-4",children:[r.jsx("button",{type:"submit",disabled:d||T.blockFeatures.length===0,className:"flex-1 px-4 py-2 bg-red-500 hover:bg-red-600 text-white rounded-lg transition-colors disabled:opacity-50 flex items-center justify-center gap-2",children:d?r.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-white border-t-transparent"}):r.jsxs(r.Fragment,{children:[r.jsx(Zl,{className:"w-4 h-4"}),f?"Сохранить":"Заблокировать"]})}),r.jsx("button",{type:"button",onClick:()=>{b(),A(!1),w(null)},className:`px-4 py-2 rounded-lg border ${e==="dark"?"border-gray-600 text-gray-200 hover:bg-gray-700":"border-gray-300 text-gray-700 hover:bg-gray-100"} transition-colors`,children:"Отмена"})]})]})]}),r.jsxs("div",{className:`rounded-2xl border ${e==="dark"?"border-white/10 bg-white/5":"border-slate-200 bg-white"}`,children:[r.jsx("div",{className:"p-6 border-b border-white/10",children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("h4",{className:`text-lg font-semibold ${e==="dark"?"text-white":"text-gray-900"}`,children:["Активные блокировки (",a.filter(y=>y.isActive).length,")"]}),r.jsxs("button",{onClick:()=>{x(""),A(!0)},className:"px-4 py-2 bg-red-500 hover:bg-red-600 text-white rounded-lg transition-colors flex items-center gap-2",children:[r.jsx(os,{className:"w-4 h-4"}),"Добавить блокировку"]})]})}),r.jsx("div",{className:"p-6",children:a.length===0?r.jsxs("div",{className:"text-center py-8",children:[r.jsx(At,{className:`w-12 h-12 mx-auto mb-4 ${e==="dark"?"text-gray-600":"text-gray-400"}`}),r.jsx("p",{className:`text-lg ${e==="dark"?"text-gray-400":"text-gray-600"}`,children:"Нет активных блокировок"})]}):r.jsx("div",{className:"space-y-4",children:a.map(y=>r.jsxs("div",{className:`flex items-center justify-between p-4 rounded-xl border ${y.isActive&&!N(y.expiresAt)?e==="dark"?"border-red-500/30 bg-red-500/10":"border-red-200 bg-red-50":e==="dark"?"border-gray-600 bg-gray-700/50":"border-gray-200 bg-gray-50"}`,children:[r.jsxs("div",{className:"flex-1",children:[r.jsx("div",{className:`font-medium ${e==="dark"?"text-white":"text-gray-900"}`,children:v(y.userId)}),r.jsx("div",{className:`text-sm mt-1 ${e==="dark"?"text-gray-400":"text-gray-600"}`,children:y.reason}),r.jsxs("div",{className:"flex items-center gap-4 mt-2",children:[r.jsxs("div",{className:"text-xs text-gray-500",children:["Функции: ",y.blockFeatures.map(p=>j(p)).join(", ")]}),y.expiresAt&&r.jsxs("div",{className:`flex items-center gap-1 text-xs ${N(y.expiresAt)?"text-gray-500":"text-amber-600"}`,children:[r.jsx(Dr,{className:"w-3 h-3"}),N(y.expiresAt)?"Истекла":`До ${new Date(y.expiresAt).toLocaleString("ru-RU")}`]})]})]}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("button",{onClick:()=>D(y),className:`px-3 py-1 rounded-full text-xs font-medium transition-colors ${y.isActive&&!N(y.expiresAt)?"bg-red-500 text-white":e==="dark"?"bg-gray-600 text-gray-300":"bg-gray-200 text-gray-700"}`,children:y.isActive&&!N(y.expiresAt)?"Активна":"Неактивна"}),r.jsx("button",{onClick:()=>L(y),className:`p-2 rounded-lg ${e==="dark"?"hover:bg-gray-700 text-gray-400":"hover:bg-gray-100 text-gray-600"} transition-colors`,children:r.jsx(cr,{className:"w-4 h-4"})}),r.jsx("button",{onClick:()=>ee(y.id),className:"p-2 rounded-lg text-red-500 hover:bg-red-500 hover:text-white transition-colors",children:r.jsx(Pt,{className:"w-4 h-4"})})]})]},y.id))})})]})]})})})]})})},Yj=()=>{const{theme:s}=it(),{isAdmin:e}=_t(),[t,n]=E.useState("table"),[a]=E.useState("all"),[i,o]=E.useState(!1),[c,d]=E.useState(!1),[h,m]=E.useState(!1),[x,f]=E.useState(!1),[w,$]=E.useState(!1),[A,T]=E.useState(!1),[K,P]=E.useState(null),[S,L]=E.useState(null),[ee,D]=E.useState(null),[k,b]=E.useState(null),[v,j]=E.useState(0),[N,y]=E.useState({slotsThisWeek:0,activeMembers:0,upcomingSlots:0,completedSlots:0,recommendedWeek:0,recommendedDay:0,mostActive:"",leastActive:[],remainingSlots:0,todaySlots:0}),[p,te]=E.useState({nextStart:null,activeEnd:null}),[ue,le]=E.useState({nextStart:"—",activeRemaining:"—"});E.useEffect(()=>{pe()},[]),E.useEffect(()=>{const ae=(ye,we)=>{if(!ye)return"—";const Ke=ye.getTime()-Date.now();if(Ke<=0)return we?"Слот завершён":"Уже начался";const We=Math.floor(Ke/6e4),Q=Math.floor(We/(60*24)),me=Math.floor(We%(60*24)/60),Ie=We%60;return Q>0?`${Q}д ${me}ч`:me>0?`${me}ч ${Ie}м`:`${Math.max(Ie,1)}м`},V=()=>{le({nextStart:ae(p.nextStart,!1),activeRemaining:ae(p.activeEnd,!0)})};V();const Z=setInterval(V,6e4);return()=>clearInterval(Z)},[p]);const H=ae=>{const V=Er(),Z=new Date(V);Z.setHours(0,0,0,0);const ye=new Date(ae.date);if(ye.setHours(0,0,0,0),ye>Z)return!0;if(ye.getTime()===Z.getTime()){const Q=Er(),me=Q.getHours()*60+Q.getMinutes();return ae.slots.some(Ie=>{if(Ie.endDate){const W=new Date(Ie.endDate);if(W.setHours(0,0,0,0),W>Z)return!0;if(W.getTime()===Z.getTime()){const[Ne,Pe]=Ie.end.split(":").map(Number);return Ne*60+Pe>me}return!1}const[de,ze]=Ie.end.split(":").map(Number);return de*60+ze>me})}const we=Er(),Ke=we.getHours()*60+we.getMinutes();return ae.slots.some(Q=>{if(Q.endDate){const me=new Date(Q.endDate);if(me.setHours(0,0,0,0),me>Z)return!0;if(me.getTime()===Z.getTime()){const[Ie,de]=Q.end.split(":").map(Number);return Ie*60+de>Ke}return!1}return!1})},ne={1:"Dex",2:"Enowk",3:"Xenia",4:"Olenka",5:"Sydney"},ce={artyom:"1",adel:"2",kseniya:"3",olga:"4",anastasia:"5"},B=ae=>{const V=$e.find(Z=>Z.id===ae)||$e.find(Z=>ce[ae]===Z.id);return ne[(V==null?void 0:V.id)||ae]||(V==null?void 0:V.name)||ae},pe=async()=>{var ae,V;try{const Z=new Date,ye=ed(Z),we=ie(ye[0],"yyyy-MM-dd"),Ke=ie(ye[6],"yyyy-MM-dd"),We=ie(Z,"yyyy-MM-dd"),[Q,me]=await Promise.all([wr(),is()]),Ie=Q.filter(Me=>Me.date>=we&&Me.date<=Ke),de=Q.filter(Me=>Me.date===We),ze=new Set([...Ie.flatMap(Me=>[Me.userId,...Me.participants||[]]),...me.map(Me=>Me.userId)]),Le=Ie.filter(H).length,W=Ie.length-Le,Ne=Math.max(0,15-Ie.length),Pe=Math.max(0,3-de.length),Y={};$e.forEach(Me=>{Y[Me.id]=0}),Ie.forEach(Me=>{new Set([Me.userId,...Me.participants||[]]).forEach(ht=>{Y[ht]!==void 0&&(Y[ht]=(Y[ht]||0)+1)})});const G=Object.entries(Y).sort((Me,ot)=>ot[1]-Me[1]),Te=(ae=G[0])!=null&&ae[1]?B(G[0][0]):"Нет данных",Re=Math.min(...Object.values(Y)),Ue=Object.entries(Y).filter(([,Me])=>Me===Re).map(([Me])=>B(Me)).slice(0,3),xe=Q.flatMap(Me=>{const ot=Me.date;return(Me.slots||[]).map(ht=>{const br=new Date(`${ot}T${ht.start}`);let Kt=ht.endDate?new Date(`${ht.endDate}T${ht.end}`):new Date(`${ot}T${ht.end}`);if(!ht.endDate&&Kt.getTime()<=br.getTime()){const Yt=new Date(ot);Yt.setDate(Yt.getDate()+1),Kt=new Date(`${ie(Yt,"yyyy-MM-dd")}T${ht.end}`)}return{start:br,end:Kt}})}),lt=xe.filter(Me=>Z>=Me.start&&Z<=Me.end),Qe=lt.length?new Date(Math.min(...lt.map(Me=>Me.end.getTime()))):null,_e=((V=xe.filter(Me=>Me.start>Z).sort((Me,ot)=>Me.start.getTime()-ot.start.getTime())[0])==null?void 0:V.start)||null;y({slotsThisWeek:Ie.length,activeMembers:ze.size,upcomingSlots:Le,completedSlots:W,recommendedWeek:Ne,recommendedDay:Pe,mostActive:Te,leastActive:Ue,remainingSlots:Le,todaySlots:de.length}),te({nextStart:_e,activeEnd:Qe})}catch(Z){console.error("Error loading stats:",Z)}},F=()=>{D(null),o(!0)},q=ae=>{D(ae),o(!0)},M=()=>{P(null),b(null),m(!0)},z=ae=>{b(ae),P(ae.type),m(!0)},I=()=>{d(!0)},R=()=>{f(!0)},O=()=>{$(!0)},U=()=>{T(!0)},J=()=>{o(!1),d(!1),m(!1),f(!1),$(!1),T(!1),P(null),D(null),b(null),pe(),j(ae=>ae+1)},C=ae=>{n(ae)},oe=[{label:"Сколько ещё добавить слотов",value:`${Math.max(N.recommendedDay,0)} в день`,note:`Неделя: ${Math.max(N.recommendedWeek,0)} до цели 15`,icon:r.jsx(Rr,{className:"w-5 h-5 text-emerald-400"}),tone:"emerald",bgClass:"bg-emerald-500/5",borderClass:"border-emerald-500/20"},{label:"Сколько осталось слотов",value:N.remainingSlots,note:"предстоящие",icon:r.jsx(bx,{className:"w-5 h-5 text-blue-400"}),tone:"blue",bgClass:"bg-blue-500/5",borderClass:"border-blue-500/20"},{label:"Активные члены",value:N.activeMembers,note:"за неделю",icon:r.jsx(Ln,{className:"w-5 h-5 text-purple-400"}),tone:"purple",bgClass:"bg-purple-500/5",borderClass:"border-purple-500/20"},{label:"Завершено слотов на неделе",value:N.completedSlots,note:"факт",icon:r.jsx(ml,{className:"w-5 h-5 text-emerald-400"}),tone:"emerald",bgClass:"bg-emerald-500/5",borderClass:"border-emerald-500/20"},{label:"Таймер ближайшего слота",value:ue.nextStart,note:"до старта",icon:r.jsx(rc,{className:"w-5 h-5 text-sky-400"}),tone:"sky",bgClass:"bg-sky-500/5",borderClass:"border-sky-500/20"},{label:"До окончания активного слота",value:ue.activeRemaining,note:"если слот идёт",icon:r.jsx(Dr,{className:"w-5 h-5 text-pink-400"}),tone:"pink",bgClass:"bg-pink-500/5",borderClass:"border-pink-500/20"},{label:"Самый активный член недели",value:N.mostActive||"Нет данных",note:"по слотам",icon:r.jsx(Xl,{className:"w-5 h-5 text-amber-400"}),tone:"amber",bgClass:"bg-amber-500/5",borderClass:"border-amber-500/20"},{label:"Самые неактивные члены недели",value:N.leastActive.length?N.leastActive.join(", "):"Нет данных",note:"минимум слотов",icon:r.jsx(nx,{className:"w-5 h-5 text-slate-400"}),tone:"slate",bgClass:"bg-slate-500/5",borderClass:"border-slate-500/20"}];return r.jsxs("div",{className:"space-y-6",children:[r.jsxs("div",{className:"space-y-6",children:[r.jsx("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:r.jsxs("div",{className:"flex items-center gap-4",children:[r.jsx("div",{className:"p-3 bg-emerald-500/10 rounded-2xl border border-emerald-500/20",children:r.jsx(ml,{className:"w-8 h-8 text-emerald-500"})}),r.jsxs("div",{children:[r.jsx("h1",{className:`text-2xl md:text-3xl font-black tracking-tight ${s==="dark"?"text-white":"text-gray-900"}`,children:"AVF Schedule"}),r.jsx("p",{className:`text-sm font-medium ${s==="dark"?"text-gray-400":"text-gray-500"}`,children:"Управление сменами и активностью ApeVault Frontier"})]})]})}),r.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:oe.map((ae,V)=>r.jsxs("div",{className:`relative overflow-hidden rounded-2xl p-5 border transition-all duration-300 hover:shadow-lg group ${s==="dark"?`${ae.bgClass} ${ae.borderClass} hover:border-opacity-50`:"bg-white border-gray-100 hover:border-emerald-500/20"}`,children:[r.jsxs("div",{className:"flex justify-between items-start mb-4",children:[r.jsx("span",{className:`text-[10px] font-bold uppercase tracking-wider ${s==="dark"?"text-gray-400":"text-gray-500"}`,children:ae.label}),r.jsx("div",{className:`p-2 rounded-xl transition-colors ${s==="dark"?"bg-white/5 group-hover:bg-white/10":"bg-gray-100 group-hover:bg-gray-200"}`,children:ae.icon})]}),r.jsxs("div",{className:"space-y-1",children:[r.jsx("div",{className:`text-2xl font-black tracking-tight ${s==="dark"?"text-white":"text-gray-900"}`,children:ae.value}),r.jsx("div",{className:"text-[11px] font-medium text-gray-500",children:ae.note})]})]},V))})]}),r.jsx("div",{className:`sticky top-4 z-40 p-2 rounded-2xl border shadow-xl backdrop-blur-xl ${s==="dark"?"bg-[#0b1015]/80 border-white/10":"bg-white/80 border-gray-200"}`,children:r.jsxs("div",{className:"flex flex-col lg:flex-row items-center justify-between gap-4 p-2",children:[r.jsxs("div",{className:`flex items-center gap-1 p-1 rounded-xl border ${s==="dark"?"bg-[#151a21] border-white/5":"bg-gray-50 border-gray-200"}`,children:[r.jsxs("button",{onClick:()=>C("table"),className:`flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-bold transition-all ${t==="table"?"bg-[#2A3441] text-white shadow-lg ring-1 ring-white/10":"text-gray-400 hover:text-gray-200"}`,children:[r.jsx(Rx,{className:"w-4 h-4"}),r.jsx("span",{children:"Таблица"})]}),r.jsxs("button",{onClick:()=>C("week"),className:`flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-bold transition-all ${t==="week"?"bg-[#4E6E49] text-white shadow-lg shadow-emerald-900/20":"text-gray-400 hover:text-gray-200"}`,children:[r.jsx(gs,{className:"w-4 h-4"}),r.jsx("span",{children:"Неделя"})]})]}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsxs("button",{onClick:F,className:"flex items-center gap-2 px-6 py-2.5 rounded-xl bg-emerald-500 hover:bg-emerald-600 text-white font-bold text-sm transition-all shadow-lg shadow-emerald-500/20 hover:scale-105 active:scale-95",children:[r.jsx(tm,{className:"w-4 h-4"}),r.jsx("span",{children:"Добавить слот"})]}),r.jsxs("button",{onClick:M,className:`flex items-center gap-2 px-4 py-2.5 rounded-xl border font-bold text-sm transition-all hover:scale-105 active:scale-95 ${s==="dark"?"border-white/10 bg-white/5 text-gray-300 hover:bg-white/10 hover:text-white":"border-gray-200 bg-gray-50 text-gray-600 hover:bg-gray-100"}`,children:[r.jsx(fl,{className:"w-4 h-4"}),r.jsx("span",{className:"hidden sm:inline",children:"Отсутствие"})]}),r.jsx("button",{onClick:I,className:"p-2.5 rounded-xl border border-rose-500/20 bg-rose-500/10 text-rose-500 hover:bg-rose-500/20 transition-all",title:"Очистить",children:r.jsx(Pt,{className:"w-5 h-5"})})]}),r.jsx("div",{className:"flex items-center gap-2 w-full lg:w-72",children:r.jsx(Uj,{selectedUserId:S,onSelect:L})}),e&&r.jsx("div",{className:"flex gap-1",children:[{icon:r.jsx(At,{className:"w-4 h-4"}),action:R,title:"Ограничения"},{icon:r.jsx(At,{className:"w-4 h-4"}),action:O,title:"Конфликты"},{icon:r.jsx(tc,{className:"w-4 h-4"}),action:U,title:"Блокировки"}].map((ae,V)=>r.jsx("button",{onClick:ae.action,title:ae.title,className:`p-2.5 rounded-xl border ${s==="dark"?"border-white/10 bg-white/5 text-gray-400 hover:text-white":"border-gray-200 text-gray-500"}`,children:ae.icon},V))})]})}),r.jsx("div",{className:`rounded-2xl border overflow-hidden ${s==="dark"?"bg-[#0b1015] border-white/5":"bg-white border-gray-200"}`,children:r.jsx("div",{className:"p-0",children:t==="table"?r.jsx(Lj,{selectedUserId:S,slotFilter:a,refreshKey:v,onEditSlot:q,onEditStatus:z}):r.jsx(Fj,{selectedUserId:S,slotFilter:a,refreshKey:v,onEditSlot:q,onEditStatus:z})})}),i&&r.jsx(qj,{slot:ee,onClose:J,onSave:J}),c&&r.jsx(Wj,{onClose:J,onSave:J}),h&&r.jsx(zj,{type:K||void 0,status:k,onClose:J,onSave:J}),x&&r.jsx(Hj,{onClose:J,onSave:J}),w&&r.jsx(Gj,{onClose:()=>$(!1)}),A&&r.jsx(Kj,{onClose:()=>T(!1)})]})},oa=.45,Qj=({onClose:s,onSave:e,editingEarning:t})=>{var U,J;const{user:n}=bt(),{isAdmin:a}=_t(),{theme:i}=it(),o=i==="dark"?"text-white":"text-gray-900",c=!!t,[d,h]=E.useState((t==null?void 0:t.date)||ie(new Date,"yyyy-MM-dd")),[m,x]=E.useState((t==null?void 0:t.slotId)||""),[f,w]=E.useState((t==null?void 0:t.amount.toString())||""),[$,A]=E.useState(((U=t==null?void 0:t.extraWalletsCount)==null?void 0:U.toString())||""),[T,K]=E.useState(((J=t==null?void 0:t.extraWalletsAmount)==null?void 0:J.toString())||""),[P,S]=E.useState((t==null?void 0:t.category)||"memecoins"),[L,ee]=E.useState(t?t.participants.length>1:!1),[D,k]=E.useState(t?t.participants.filter(C=>C!==t.userId):[]),[b,v]=E.useState([]),[j,N]=E.useState([]),[y,p]=E.useState(""),[te,ue]=E.useState(!1);ps();const le=(C,oe="w-4 h-4")=>{switch(C){case"memecoins":return r.jsx(Pa,{className:oe});case"futures":return r.jsx(io,{className:oe});case"nft":return r.jsx(ao,{className:oe});case"spot":return r.jsx(lr,{className:oe});case"polymarket":return r.jsx(Jl,{className:oe});case"staking":return r.jsx(Ma,{className:oe});default:return r.jsx(pr,{className:oe})}},H=()=>{var C;return c&&t?(C=t.participants)!=null&&C.length?t.participants:[t.userId]:a&&!n?D:n?L?Array.from(new Set([n.id,...D])):[n.id]:[]},ne=H(),ce=ne.length,B=ce||1,pe=C=>{const oe=parseFloat(C.replace(",","."));return Number.isFinite(oe)?oe:0},F=E.useMemo(()=>{const C=pe(f),oe=pe(T),ae=Math.max(C+oe,0),V=ae>0?parseFloat((ae*oa).toFixed(2)):0,Z=Math.max(ae-V,0),ye=B>0?parseFloat((Z/B).toFixed(2)):0;return{gross:ae,pool:V,net:Z,share:ye}},[f,T,B]);E.useEffect(()=>{q()},[d,n,c]);const q=async()=>{if(!(!a&&!n&&!c))try{const C=c||a?await wr(void 0,d):await wr(n.id,d),oe=Er(),ae=ie(oe,"yyyy-MM-dd"),V=c?C:C.filter(Z=>{if(d!==ae)return a;const ye=Z.slots[Z.slots.length-1];return kh(ye.end,oe)||a});v(V)}catch(C){console.error("Error loading slots:",C)}},M=C=>{D.includes(C)?k(D.filter(oe=>oe!==C)):k([...D,C])},z=()=>{const C=pe(f),oe=pe(T),ae=parseInt($||"0",10);if(!C&&!oe)return p("Укажите сумму заработка (основную или по доп. кошелькам)"),null;if(C<0||oe<0)return p("Суммы не могут быть отрицательными"),null;if(!P)return p("Выберите сферу заработка"),null;const V=H();if(V.length===0)return p("Выберите хотя бы одного участника"),null;const Z=C+oe;return{id:crypto.randomUUID?crypto.randomUUID():`${Date.now()}-${Math.random()}`,category:P,amount:Z,extraWalletsAmount:oe,extraWalletsCount:Number.isFinite(ae)?ae:0,participants:V}},I=()=>{p("");const C=z();C&&(N([...j,C]),w(""),K(""),A(""),k([]),ee(!1))},R=C=>{N(oe=>oe.filter(ae=>ae.id!==C))},O=async()=>{if(!a&&!n&&!c){p("Пользователь не найден");return}p(""),ue(!0);try{if(!m){p("Выберите слот"),ue(!1);return}const C=b.find(V=>V.id===m);if(!C&&!c){p("Выбранный слот не найден"),ue(!1);return}if(!a&&!c){const V=Er(),Z=ie(V,"yyyy-MM-dd");if(d!==Z){p("Можно добавить заработок только за сегодня"),ue(!1);return}if(C){const ye=C.slots[C.slots.length-1];if(!kh(ye.end,V)){p("Слот еще идет или еще не начат. Можно добавить заработок после 21:00 МСК или после окончания слота"),ue(!1);return}}}const oe=V=>({userId:V.userId,date:d,amount:V.amount,poolAmount:V.poolAmount,slotId:m,category:V.category,participants:V.participants,extraWalletsAmount:V.extraWalletsAmount,extraWalletsCount:V.extraWalletsCount}),ae=async(V,Z,ye)=>{a?Z==="update"&&t?await R0(t.id,V):await $0(V):await Nt({entity:"earning",action:Z,authorId:(n==null?void 0:n.id)||V.userId,targetUserId:V.userId,before:ye||null,after:{id:(t==null?void 0:t.id)||"",...V}})};if(c&&t){const V=z();if(!V){ue(!1);return}await ae(oe({userId:t.userId,amount:V.amount,poolAmount:parseFloat((V.amount*oa).toFixed(2)),category:V.category,participants:V.participants,extraWalletsAmount:V.extraWalletsAmount,extraWalletsCount:V.extraWalletsCount}),"update",t)}else{let V=j;if(V.length===0){const Z=z();if(!Z){ue(!1);return}V=[Z]}for(const Z of V)await ae(oe({userId:Z.participants[0],amount:Z.amount,poolAmount:parseFloat((Z.amount*oa).toFixed(2)),category:Z.category,participants:Z.participants,extraWalletsAmount:Z.extraWalletsAmount,extraWalletsCount:Z.extraWalletsCount}),"create")}e()}catch(C){console.error("Error saving earnings:",C);const oe=C.message||C.code||"Ошибка при сохранении";p(oe)}finally{ue(!1)}};return r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-start sm:items-center justify-center z-[70] p-4 sm:p-6 touch-manipulation overflow-y-auto overflow-x-hidden overscroll-contain modal-scroll",children:r.jsxs("div",{className:`w-full max-w-[540px] sm:max-w-3xl rounded-2xl sm:rounded-3xl shadow-xl ${i==="dark"?"bg-[#1a1a1a]":"bg-white"} max-h-[85dvh] sm:max-h-[calc(100dvh-96px)] flex flex-col overflow-hidden`,children:[r.jsx("div",{className:"flex-shrink-0 p-4 sm:p-6",children:r.jsxs("div",{className:"flex items-center justify-between mb-4 sm:mb-6",children:[r.jsx("h3",{className:`text-lg sm:text-xl font-bold ${o} pr-2`,children:c?"Редактировать заработок":"Добавить заработок"}),r.jsx("button",{onClick:s,className:`p-1.5 sm:p-2 rounded-lg flex-shrink-0 ${i==="dark"?"hover:bg-gray-700 active:bg-gray-600 text-gray-200":"hover:bg-gray-100 active:bg-gray-200 text-gray-700"} transition-colors touch-manipulation`,"aria-label":"Закрыть",children:r.jsx(Rt,{className:"w-4 h-4 sm:w-5 sm:h-5"})})]})}),r.jsx("div",{className:"flex-1 min-h-0 overflow-y-auto overflow-x-hidden overscroll-contain modal-scroll px-4 sm:px-6",children:r.jsxs("div",{className:"space-y-3 sm:space-y-4 pb-8 min-w-0",children:[r.jsxs("div",{children:[r.jsxs("label",{className:`flex flex-col sm:flex-row sm:items-center sm:justify-between text-xs sm:text-sm font-medium mb-2 gap-1 sm:gap-2 ${i==="dark"?"text-gray-300":"text-gray-700"}`,children:[r.jsx("span",{children:"Дата"}),!a&&!c&&r.jsx("span",{className:"text-[10px] sm:text-xs text-gray-400 whitespace-nowrap",children:"Доступна только текущая дата"})]}),r.jsx("input",{type:"date",value:d,onChange:C=>h(C.target.value),disabled:!a&&!c,className:`w-full px-3 sm:px-4 py-2 sm:py-2.5 text-sm sm:text-base rounded-lg border touch-manipulation ${i==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49] disabled:opacity-50 disabled:cursor-not-allowed`}),c&&!a&&r.jsx("p",{className:`mt-1 text-xs ${i==="dark"?"text-gray-400":"text-gray-500"}`,children:"Только администратор может изменить дату"})]}),r.jsxs("div",{children:[r.jsx("label",{className:`block text-xs sm:text-sm font-medium mb-2 ${i==="dark"?"text-gray-300":"text-gray-700"}`,children:"Слот"}),r.jsxs("select",{value:m,onChange:C=>x(C.target.value),className:`w-full px-3 sm:px-4 py-2 sm:py-2.5 text-sm sm:text-base rounded-lg border touch-manipulation ${i==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`,children:[r.jsx("option",{value:"",children:"Выберите слот"}),b.map(C=>r.jsx("option",{value:C.id,children:C.slots.map(oe=>`${oe.start}-${oe.end}`).join(", ")},C.id)),c&&t&&!b.find(C=>C.id===t.slotId)&&r.jsx("option",{value:t.slotId,disabled:!0,children:"[Текущий слот - не найден]"})]}),c&&t&&!b.find(C=>C.id===t.slotId)&&r.jsx("p",{className:`mt-1 text-xs ${i==="dark"?"text-gray-400":"text-gray-500"}`,children:"Текущий слот не найден в списке. Выберите другой слот или оставьте текущий."})]}),r.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[r.jsxs("div",{children:[r.jsx("label",{className:`block text-xs sm:text-sm font-medium mb-2 ${i==="dark"?"text-gray-300":"text-gray-700"}`,children:"Сумма заработка (руб.)"}),r.jsx("input",{type:"number",value:f,onChange:C=>w(C.target.value),className:`w-full px-3 sm:px-4 py-2 sm:py-2.5 text-sm sm:text-base rounded-lg border touch-manipulation ${i==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`,placeholder:"0",min:"0",step:"100"})]}),r.jsxs("div",{className:"space-y-2",children:[r.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[r.jsxs("div",{children:[r.jsx("label",{className:`block text-xs sm:text-sm font-medium mb-2 ${i==="dark"?"text-gray-300":"text-gray-700"}`,children:"Кол-во доп. кошельков"}),r.jsx("input",{type:"number",value:$,onChange:C=>A(C.target.value),className:`w-full px-3 sm:px-4 py-2 sm:py-2.5 text-sm sm:text-base rounded-lg border touch-manipulation ${i==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`,placeholder:"0",min:"0",step:"1"})]}),r.jsxs("div",{children:[r.jsx("label",{className:`block text-xs sm:text-sm font-medium mb-2 ${i==="dark"?"text-gray-300":"text-gray-700"}`,children:"Доп. кошельки (руб.)"}),r.jsx("input",{type:"number",value:T,onChange:C=>K(C.target.value),className:`w-full px-3 sm:px-4 py-2 sm:py-2.5 text-sm sm:text-base rounded-lg border touch-manipulation ${i==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`,placeholder:"0",min:"0",step:"100"})]})]}),r.jsx("div",{className:"space-y-1 text-[11px] text-gray-500",children:r.jsx("p",{children:"Общая сумма = основная + доп. кошельки. Пул 45% считается с общей суммы."})})]})]}),r.jsxs("div",{className:"space-y-2",children:[r.jsxs("div",{className:"flex items-center justify-between gap-2",children:[r.jsx("label",{className:`text-xs sm:text-sm font-medium ${i==="dark"?"text-gray-300":"text-gray-700"}`,children:"Сфера заработка"}),r.jsx("span",{className:"text-[10px] sm:text-xs text-gray-400",children:"Влияет на статистику"})]}),r.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-2",children:Object.entries(Zr).map(([C,oe])=>r.jsxs("button",{type:"button",onClick:()=>S(C),className:`flex items-center gap-2 px-3 py-2 rounded-lg border text-left transition-all ${P===C?"border-[#4E6E49] bg-[#4E6E49]/10 text-[#4E6E49]":i==="dark"?"border-gray-800 bg-gray-800/60 text-gray-200 hover:border-[#4E6E49]/40":"border-gray-200 bg-white text-gray-800 hover:border-[#4E6E49]/40"}`,children:[r.jsx("span",{className:"p-1.5 rounded-lg bg-gray-100 dark:bg-gray-800/80",children:le(C,"w-4 h-4")}),r.jsxs("div",{className:"flex flex-col leading-tight",children:[r.jsx("span",{className:"text-sm font-semibold",children:oe.label}),r.jsx("span",{className:"text-[11px] text-gray-500",children:"45% пул / 55% чистыми"})]})]},C))})]}),r.jsxs(r.Fragment,{children:[r.jsxs("label",{className:"flex items-center gap-2",children:[r.jsx("input",{type:"checkbox",checked:L,onChange:C=>ee(C.target.checked),className:"w-4 h-4"}),r.jsx("span",{className:`${i==="dark"?"text-gray-300":"text-gray-700"}`,children:"Отметить несколько участников"})]}),(L||a&&!n)&&r.jsx("div",{className:"ml-0 sm:ml-2 grid grid-cols-2 sm:grid-cols-3 gap-2",children:$e.filter(C=>!n||C.id!==n.id).map(C=>r.jsxs("label",{className:"flex items-center gap-2 rounded-lg px-2 py-1 border border-gray-200 dark:border-gray-800",children:[r.jsx("input",{type:"checkbox",checked:D.includes(C.id),onChange:()=>M(C.id),className:"w-4 h-4"}),r.jsx("span",{className:i==="dark"?"text-gray-300":"text-gray-700",children:kt(C.id)})]},C.id))})]}),r.jsxs("div",{className:`p-4 rounded-xl border ${i==="dark"?"border-gray-800 bg-gray-900/60":"border-gray-200 bg-gray-50"}`,children:[r.jsxs("div",{className:"flex items-center justify-between gap-2 mb-3",children:[r.jsxs("div",{children:[r.jsx("p",{className:`text-xs font-semibold ${i==="dark"?"text-gray-200":"text-gray-800"}`,children:"Авторасчет"}),r.jsx("p",{className:"text-[11px] text-gray-500",children:"Пул 45% + деление между участниками"})]}),r.jsxs("span",{className:"text-[11px] px-2 py-1 rounded-full bg-[#4E6E49]/10 text-[#4E6E49] font-semibold",children:[ce||0," участн."]})]}),r.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-2 mb-3",children:[r.jsxs("div",{className:`p-3 rounded-lg ${i==="dark"?"bg-gray-800/70":"bg-white"}`,children:[r.jsx("p",{className:"text-[11px] text-gray-500",children:"Пул (45%)"}),r.jsxs("p",{className:"text-lg font-bold text-purple-500",children:[F.pool.toFixed(2)," ₽"]})]}),r.jsxs("div",{className:`p-3 rounded-lg ${i==="dark"?"bg-gray-800/70":"bg-white"}`,children:[r.jsx("p",{className:"text-[11px] text-gray-500",children:"Чистыми после пула"}),r.jsxs("p",{className:"text-lg font-bold text-emerald-500",children:[F.net.toFixed(2)," ₽"]})]}),r.jsxs("div",{className:`p-3 rounded-lg ${i==="dark"?"bg-gray-800/70":"bg-white"}`,children:[r.jsx("p",{className:"text-[11px] text-gray-500",children:"На каждого"}),r.jsxs("p",{className:"text-lg font-bold text-[#4E6E49]",children:[F.share.toFixed(2)," ₽"]})]})]}),r.jsxs("div",{className:`text-xs ${i==="dark"?"text-gray-400":"text-gray-600"} mb-1`,children:["Отмеченные участники получат по ",F.share.toFixed(2)," ₽"]}),r.jsx("div",{className:"flex flex-wrap gap-2",children:ne.length===0?r.jsx("span",{className:"text-xs text-gray-400",children:"Нет выбранных участников"}):ne.map(C=>r.jsx("span",{className:`px-2.5 py-1 rounded-full text-xs font-semibold border ${i==="dark"?"border-gray-800 bg-gray-800/70 text-gray-100":"border-gray-200 bg-white text-gray-800"}`,children:kt(C)},C))})]}),!c&&j.length>0&&r.jsxs("div",{className:`rounded-xl border ${i==="dark"?"border-gray-800 bg-gray-900/70":"border-gray-200 bg-gray-50"} p-3 sm:p-4 space-y-3`,children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsx("p",{className:`text-sm font-semibold ${i==="dark"?"text-gray-200":"text-gray-800"}`,children:"Добавленные записи"}),r.jsxs("span",{className:"text-xs text-gray-500",children:[j.length," шт."]})]}),r.jsx("div",{className:"space-y-2 max-h-64 overflow-y-auto pr-1",children:j.map(C=>r.jsxs("div",{className:`flex flex-col sm:flex-row sm:items-center justify-between gap-3 p-3 rounded-lg border ${i==="dark"?"border-gray-800 bg-gray-800/60":"border-gray-200 bg-white"}`,children:[r.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[r.jsx("div",{className:"p-2 rounded-lg bg-gray-100 dark:bg-gray-900/70",children:le(C.category,"w-4 h-4")}),r.jsxs("div",{className:"min-w-0",children:[r.jsxs("p",{className:"text-sm font-semibold flex items-center gap-2",children:[Zr[C.category].label,r.jsxs("span",{className:"text-[11px] text-gray-500",children:["(",C.participants.length," уч.)"]})]}),r.jsxs("p",{className:"text-xs text-gray-500 whitespace-normal break-words",children:["Гросс ",C.amount.toFixed(0)," ₽ • Пул ",(C.amount*oa).toFixed(0)," ₽ • Чистыми ",(C.amount-C.amount*oa).toFixed(0)," ₽"]}),C.extraWalletsAmount>0&&r.jsxs("p",{className:"text-[11px] text-gray-500",children:["Доп. кошельки: ",C.extraWalletsCount," на ",C.extraWalletsAmount.toFixed(0)," ₽"]})]})]}),r.jsx("button",{type:"button",onClick:()=>R(C.id),className:`self-start sm:self-center p-2 rounded-lg ${i==="dark"?"hover:bg-gray-700 text-red-400":"hover:bg-gray-100 text-red-600"}`,"aria-label":"Удалить запись",children:r.jsx(Pt,{className:"w-4 h-4"})})]},C.id))})]}),y&&r.jsx("div",{className:"p-3 bg-red-500 text-white rounded-lg text-sm",children:y}),r.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 sm:gap-3 pt-2",children:[!c&&r.jsxs("button",{type:"button",onClick:I,disabled:te,className:"flex-1 sm:flex-none sm:px-4 px-4 py-2.5 sm:py-2 border border-[#4E6E49] text-[#4E6E49] rounded-lg sm:rounded-xl font-medium flex items-center justify-center gap-2 hover:bg-[#4E6E49]/10 active:scale-95 transition-colors",children:[r.jsx(tm,{className:"w-4 h-4"}),"Добавить в список"]}),r.jsx("button",{onClick:O,disabled:te,className:"flex-1 px-4 py-2.5 sm:py-2 bg-[#4E6E49] hover:bg-[#4E6E49] disabled:bg-gray-400 disabled:cursor-not-allowed text-white rounded-lg sm:rounded-xl transition-colors text-sm sm:text-base font-medium touch-manipulation active:scale-95 disabled:active:scale-100",children:te?"Сохранение...":c?"Сохранить":"Сохранить все"}),r.jsx("button",{type:"button",onClick:s,className:`flex-1 px-4 py-2.5 sm:py-2 rounded-lg sm:rounded-xl border text-sm sm:text-base font-medium transition-colors touch-manipulation active:scale-95 ${i==="dark"?"border-gray-700 text-gray-200 hover:bg-gray-800":"border-gray-300 text-gray-800 hover:bg-gray-100"}`,children:"Отмена"})]})]})})]})})},Xj=({earnings:s})=>{const{theme:e}=it(),t=.45,n=Gn(),a=ie(n.start,"yyyy-MM-dd"),i=ie(n.end,"yyyy-MM-dd"),o=ie(new Date(new Date().getFullYear(),new Date().getMonth(),1),"yyyy-MM-dd"),c=ie(new Date(new Date().getFullYear(),new Date().getMonth()+1,0),"yyyy-MM-dd"),d=(x,f,w)=>{const $=s.filter(P=>(P.participants&&P.participants.length>0?[...P.participants,P.userId]:[P.userId]).includes(x)&&P.date>=f&&P.date<=w),A=$.reduce((P,S)=>{const L=S.participants&&S.participants.length>0?S.participants.length:1,ee=S.poolAmount||S.amount*t,D=Math.max(S.amount-ee,0);return P+D/L},0),T=$.reduce((P,S)=>{const L=S.participants&&S.participants.length>0?S.participants.length:1,ee=S.poolAmount||S.amount*t;return P+ee/L},0),K=Array.from(new Set($.map(P=>P.category))).filter(P=>P!=="other");return{totalEarnings:A,totalPool:T,count:$.length,categories:K}},h=$e.map(x=>{const f=d(x.id,o,c),w=d(x.id,a,i);return{...x,...f,weeklyNet:w.totalEarnings}}).sort((x,f)=>f.totalEarnings-x.totalEarnings),m=5e4;return r.jsx("div",{className:`overflow-hidden rounded-3xl border shadow-2xl ${e==="dark"?"bg-[#0b1015] border-white/5":"bg-white border-gray-100"}`,children:r.jsxs("table",{className:"w-full text-left border-collapse",children:[r.jsx("thead",{children:r.jsxs("tr",{className:e==="dark"?"bg-white/5":"bg-gray-50",children:[r.jsx("th",{className:"px-6 py-5 text-[10px] font-black uppercase tracking-widest text-gray-500",children:"Ранг"}),r.jsx("th",{className:"px-6 py-5 text-[10px] font-black uppercase tracking-widest text-gray-500",children:"Участник"}),r.jsx("th",{className:"px-6 py-5 text-[10px] font-black uppercase tracking-widest text-gray-500",children:"Сферы"}),r.jsx("th",{className:"px-6 py-5 text-[10px] font-black uppercase tracking-widest text-gray-500 text-right",children:"Сумма пула"}),r.jsx("th",{className:"px-6 py-5 text-[10px] font-black uppercase tracking-widest text-gray-500 text-right",children:"Чистые средства"}),r.jsx("th",{className:"px-6 py-5 text-[10px] font-black uppercase tracking-widest text-gray-500 text-right",children:"KPI"})]})}),r.jsx("tbody",{className:"divide-y divide-white/5",children:h.map((x,f)=>{const w=x.weeklyNet/m*100,$=f===0?"text-amber-500":f===1?"text-gray-400":f===2?"text-orange-500":"text-gray-600",A=x.avatar;return r.jsxs("tr",{className:`group transition-all duration-300 ${e==="dark"?"hover:bg-white/[0.02]":"hover:bg-gray-50"}`,children:[r.jsx("td",{className:"px-6 py-5",children:r.jsxs("span",{className:`text-sm font-black ${$}`,children:["#",f+1]})}),r.jsx("td",{className:"px-6 py-5",children:r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsxs("div",{className:"relative",children:[A?r.jsx("img",{src:A,alt:"",className:"w-9 h-9 rounded-full object-cover ring-2 ring-white/5"}):r.jsx("div",{className:"w-9 h-9 rounded-full bg-emerald-500/20 flex items-center justify-center text-sm font-black text-emerald-500",children:x.name[0]}),r.jsx("div",{className:"absolute -bottom-1 -right-1 w-3 h-3 bg-emerald-500 border-2 border-[#0b1015] rounded-full"})]}),r.jsxs("div",{children:[r.jsx("p",{className:`text-sm font-black ${e==="dark"?"text-white":"text-gray-900"}`,children:kt(x.id)}),r.jsx("p",{className:"text-[10px] font-bold text-gray-500 uppercase tracking-widest",children:"Frontier Team"})]})]})}),r.jsx("td",{className:"px-6 py-5",children:r.jsx("div",{className:"flex flex-wrap gap-1.5",children:x.categories.length>0?x.categories.map(T=>{var K;return r.jsx("span",{className:`px-2 py-0.5 rounded-md text-[9px] font-black uppercase tracking-tight border ${e==="dark"?"bg-white/5 border-white/10 text-gray-400":"bg-gray-100 border-gray-200 text-gray-600"}`,children:((K=Zr[T])==null?void 0:K.label)||T},T)}):r.jsx("span",{className:"text-[10px] text-gray-500 font-bold uppercase",children:"—"})})}),r.jsx("td",{className:"px-6 py-5 text-right",children:r.jsxs("span",{className:`text-sm font-black ${e==="dark"?"text-gray-300":"text-gray-700"}`,children:[x.totalPool.toLocaleString()," ₽"]})}),r.jsx("td",{className:"px-6 py-5 text-right",children:r.jsxs("span",{className:"text-sm font-black text-emerald-500",children:[x.totalEarnings.toLocaleString()," ₽"]})}),r.jsx("td",{className:"px-6 py-5 text-right w-48",children:r.jsxs("div",{className:"flex items-center justify-end gap-3",children:[r.jsx("div",{className:`w-24 h-1.5 rounded-full overflow-hidden ${e==="dark"?"bg-white/5":"bg-gray-100"}`,children:r.jsx("div",{className:`h-full rounded-full transition-all duration-1000 ${e==="dark"?"bg-white":"bg-black"}`,style:{width:`${Math.min(w,100)}%`}})}),r.jsxs("span",{className:"text-[10px] font-black text-gray-500",children:[w.toFixed(0),"%"]})]})})]},x.id)})})]})})},Jj=({earnings:s,onEdit:e,onDelete:t})=>{const{theme:n}=it(),{user:a}=bt(),{isAdmin:i}=_t(),[o,c]=E.useState(null),d=.45,h=(S,L="w-4 h-4")=>{switch(S){case"memecoins":return r.jsx(Pa,{className:L});case"futures":return r.jsx(io,{className:L});case"nft":return r.jsx(ao,{className:L});case"spot":return r.jsx(lr,{className:L});case"polymarket":return r.jsx(Jl,{className:L});case"staking":return r.jsx(Ma,{className:L});default:return r.jsx(pr,{className:L})}},m=async S=>{if(confirm("Вы уверены, что хотите удалить эту запись о заработке?")){c(S.id);try{i?await P0(S.id):await Nt({entity:"earning",action:"delete",authorId:(a==null?void 0:a.id)||S.userId,targetUserId:S.userId,before:S,after:null}),t()}catch(L){console.error("Error deleting earnings:",L),alert("Ошибка при удалении записи")}finally{c(null)}}},x=S=>S.participants&&S.participants.length>0?S.participants:[S.userId],f=S=>S.poolAmount||S.amount*d,w=S=>Math.max(S.amount-f(S),0),$=S=>{const L=x(S);return L.length?w(S)/L.length:w(S)},A=S=>Zr[S]||Zr.other,T=S=>kt(S)||S,K=S=>i||S.userId===(a==null?void 0:a.id),P=[...s].sort((S,L)=>L.date.localeCompare(S.date));return P.length===0?r.jsxs("div",{className:`rounded-2xl p-8 text-center border-2 ${n==="dark"?"bg-[#1a1a1a] border-gray-800":"bg-white border-gray-200"} shadow-md`,children:[r.jsx("p",{className:`${n==="dark"?"text-gray-400":"text-gray-600"} text-lg`,children:"Пока нет записей о заработке"}),r.jsx("p",{className:"text-gray-500 text-sm mt-2",children:"Добавьте первую запись, чтобы начать отслеживать доходы команды"})]}):r.jsxs("div",{className:`rounded-3xl overflow-hidden border shadow-2xl ${n==="dark"?"bg-[#0b1015] border-white/5":"bg-white border-gray-100"}`,children:[r.jsx("div",{className:"p-6 border-b border-white/5 flex items-center justify-between",children:r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx("div",{className:"p-2 bg-blue-500/10 rounded-xl",children:r.jsx(Kd,{className:"w-5 h-5 text-blue-400"})}),r.jsx("h3",{className:`text-lg font-black tracking-tight ${n==="dark"?"text-white":"text-gray-900"}`,children:"История выплат"})]})}),r.jsx("div",{className:"overflow-x-auto",children:r.jsxs("table",{className:"w-full text-left border-collapse",children:[r.jsx("thead",{children:r.jsxs("tr",{className:n==="dark"?"bg-white/5":"bg-gray-50",children:[r.jsx("th",{className:"px-6 py-4 text-[10px] font-black uppercase tracking-wider text-gray-500 whitespace-nowrap",children:"Дата"}),r.jsx("th",{className:"px-6 py-4 text-[10px] font-black uppercase tracking-wider text-gray-500",children:"Сфера"}),r.jsx("th",{className:"px-6 py-4 text-[10px] font-black uppercase tracking-wider text-gray-500",children:"Команда"}),r.jsx("th",{className:"px-6 py-4 text-[10px] font-black uppercase tracking-wider text-gray-500 text-right",children:"Выплата"}),r.jsx("th",{className:"px-6 py-4 text-[10px] font-black uppercase tracking-wider text-gray-500 text-right",children:"В Пул"}),r.jsx("th",{className:"px-6 py-4 text-[10px] font-black uppercase tracking-wider text-gray-500 text-center",children:"Действия"})]})}),r.jsx("tbody",{className:"divide-y divide-white/5",children:P.map(S=>{const L=x(S),ee=A(S.category),D=w(S),k=$(S),b=K(S);return r.jsxs("tr",{className:`group/row transition-colors ${n==="dark"?"hover:bg-white/[0.02]":"hover:bg-gray-50"}`,children:[r.jsx("td",{className:"px-6 py-5 whitespace-nowrap",children:r.jsx("span",{className:`text-[12px] font-bold ${n==="dark"?"text-gray-400":"text-gray-600"}`,children:ie(new Date(S.date+"T00:00:00"),"dd.MM")})}),r.jsx("td",{className:"px-6 py-5",children:r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("div",{className:"p-1.5 bg-white/5 rounded-lg",children:h(S.category,"w-3.5 h-3.5 text-gray-400")}),r.jsx("span",{className:`text-xs font-bold ${n==="dark"?"text-gray-300":"text-gray-900"}`,children:ee.label})]})}),r.jsx("td",{className:"px-6 py-5",children:r.jsx("div",{className:"flex flex-wrap gap-1.5 max-w-[200px]",children:L.map(v=>r.jsx("span",{className:`px-2 py-0.5 rounded-md text-[10px] font-black tracking-tight border ${n==="dark"?"border-white/5 bg-white/5 text-gray-400":"border-gray-100 bg-gray-50 text-gray-600"}`,children:T(v)},v))})}),r.jsx("td",{className:"px-6 py-5 text-right",children:r.jsxs("div",{className:"flex flex-col items-end",children:[r.jsxs("span",{className:"text-sm font-black text-emerald-500",children:[D.toFixed(0)," ₽"]}),L.length>1&&r.jsxs("span",{className:"text-[10px] font-medium text-gray-500",children:["по ",k.toFixed(0)," ₽"]})]})}),r.jsx("td",{className:"px-6 py-5 text-right",children:r.jsxs("span",{className:"text-sm font-bold text-purple-400 opacity-60",children:[f(S).toFixed(0)," ₽"]})}),r.jsx("td",{className:"px-6 py-5 text-center",children:b?r.jsxs("div",{className:"flex items-center justify-center gap-2 opacity-0 group-hover/row:opacity-100 transition-opacity duration-200",children:[r.jsx("button",{onClick:()=>e(S),className:"p-2 rounded-xl border border-blue-500/20 bg-blue-500/5 text-blue-400 hover:bg-blue-500/20 transition-all",children:r.jsx(Kd,{className:"w-3.5 h-3.5"})}),r.jsx("button",{onClick:()=>m(S),disabled:o===S.id,className:"p-2 rounded-xl border border-rose-500/20 bg-rose-500/5 text-rose-500 hover:bg-rose-500/20 transition-all disabled:opacity-50",children:r.jsx(Pt,{className:"w-3.5 h-3.5"})})]}):r.jsx("span",{className:"text-gray-700 text-xs",children:"—"})})]},S.id)})})]})})]})},Zj=()=>{const{theme:s}=it(),[e,t]=E.useState(!1),[n,a]=E.useState(null),[i,o]=E.useState([]),[c,d]=E.useState(!0),[h,m]=E.useState({weekTotal:0,weekPool:0,weekNet:0,monthTotal:0,monthPool:0,monthNet:0}),x=.45,f=Object.keys(Zr),w=s==="dark"?"bg-[#1a1a1a]":"bg-white",$=y=>y.poolAmount||y.amount*x,A=y=>Math.max(y.amount-$(y),0),T=y=>{var p;return(p=y.participants)!=null&&p.length?y.participants:[y.userId]},K=()=>{const y=Gn(),p=ie(y.start,"yyyy-MM-dd"),te=ie(y.end,"yyyy-MM-dd"),ue=ie(new Date(new Date().getFullYear(),new Date().getMonth(),1),"yyyy-MM-dd"),le=ie(new Date(new Date().getFullYear(),new Date().getMonth()+1,0),"yyyy-MM-dd"),H=i.filter(ce=>ce.date>=p&&ce.date<=te),ne=i.filter(ce=>ce.date>=ue&&ce.date<=le);m({weekTotal:H.reduce((ce,B)=>ce+B.amount,0),weekPool:H.reduce((ce,B)=>ce+$(B),0),weekNet:H.reduce((ce,B)=>ce+A(B),0),monthTotal:ne.reduce((ce,B)=>ce+B.amount,0),monthPool:ne.reduce((ce,B)=>ce+$(B),0),monthNet:ne.reduce((ce,B)=>ce+A(B),0)})};E.useEffect(()=>{P()},[]),E.useEffect(()=>{K()},[i]),E.useEffect(()=>{const y=async p=>{const te=p,{userId:ue}=te.detail||{};if(ue)await as(ue);else for(const le of $e)await as(le.id);o(le=>[...le])};return window.addEventListener("nicknameUpdated",y),()=>{window.removeEventListener("nicknameUpdated",y)}},[]);const P=async()=>{d(!0);try{const y=await Ca();o(y)}catch(y){console.error("Error loading earnings:",y)}finally{d(!1)}},S=y=>{a(y),t(!0)},L=()=>{t(!1),a(null)},ee=()=>{t(!1),a(null),P()},D=f.map(y=>{const p=i.filter(ce=>ce.category===y),te=p.reduce((ce,B)=>ce+B.amount,0),ue=p.reduce((ce,B)=>ce+$(B),0),le=p.reduce((ce,B)=>ce+A(B),0),H=new Map;p.forEach(ce=>{const B=T(ce),pe=A(ce)/Math.max(B.length,1);B.forEach(F=>{H.set(F,(H.get(F)||0)+pe)})});const ne=Array.from(H.entries()).sort((ce,B)=>B[1]-ce[1]).slice(0,2);return{key:y,gross:te,pool:ue,net:le,count:p.length,topParticipants:ne}}).filter(y=>y.key!=="other"),k=D.reduce((y,p)=>y+p.net,0),b=D.map(y=>({...y,share:k>0?y.net/k*100:0})).sort((y,p)=>p.share-y.share),v=$e.map(y=>{const p=i.filter(H=>T(H).includes(y.id)),te=p.reduce((H,ne)=>{const ce=A(ne)/Math.max(T(ne).length,1);return H+ce},0),ue=p.reduce((H,ne)=>{const ce=$(ne)/Math.max(T(ne).length,1);return H+ce},0),le=p.reduce((H,ne)=>{const ce=ne.amount/Math.max(T(ne).length,1);return H+ce},0);return{...y,net:te,poolShare:ue,grossContribution:le}}).sort((y,p)=>p.net-y.net),j=[...D].sort((y,p)=>p.net-y.net)[0],N=v[0];return r.jsxs("div",{className:"space-y-6",children:[r.jsxs("div",{className:"space-y-6",children:[r.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[r.jsxs("div",{className:"flex items-center gap-4",children:[r.jsx("div",{className:"p-3 bg-emerald-500/10 rounded-2xl border border-emerald-500/20",children:r.jsx(Tn,{className:"w-8 h-8 text-emerald-500"})}),r.jsxs("div",{children:[r.jsx("h1",{className:`text-2xl md:text-3xl font-black tracking-tight ${s==="dark"?"text-white":"text-gray-900"}`,children:"AVF Profit"}),r.jsx("p",{className:`text-sm font-medium ${s==="dark"?"text-gray-400":"text-gray-500"}`,children:"Мониторинг доходов и распределение пула"})]})]}),r.jsxs("button",{onClick:()=>t(!0),className:"flex items-center gap-2 px-6 py-3 rounded-xl bg-emerald-500 hover:bg-emerald-600 text-white font-bold text-sm transition-all shadow-lg shadow-emerald-500/20 hover:scale-105 active:scale-95",children:[r.jsx(os,{className:"w-4 h-4"}),r.jsx("span",{children:"Добавить заработок"})]})]}),r.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[{label:"НЕДЕЛЯ (ЧИСТЫМИ)",value:`${h.weekNet.toLocaleString()} ₽`,badgeIcon:r.jsx(Bx,{className:"w-4 h-4 text-emerald-500"}),changeType:"positive",icon:r.jsx(qt,{className:"w-5 h-5 text-emerald-400"}),bgClass:"bg-emerald-500/5",borderClass:"border-emerald-500/10"},{label:"НЕДЕЛЯ (ПУЛ)",value:`${h.weekPool.toLocaleString()} ₽`,badgeIcon:r.jsx(Ma,{className:"w-4 h-4 text-blue-400"}),icon:r.jsx(oi,{className:"w-5 h-5 text-blue-400"}),bgClass:"bg-blue-500/5",borderClass:"border-blue-500/10"},{label:"МЕСЯЦ (ЧИСТЫМИ)",value:`${h.monthNet.toLocaleString()} ₽`,isTrend:!0,icon:r.jsx(Fx,{className:"w-5 h-5 text-purple-400"}),bgClass:"bg-purple-500/5",borderClass:"border-purple-500/10"},{label:"МЕСЯЦ (ПУЛ)",value:`${h.monthPool.toLocaleString()} ₽`,isCoins:!0,icon:r.jsx(lr,{className:"w-5 h-5 text-orange-400"}),bgClass:"bg-orange-500/5",borderClass:"border-orange-500/10",change:void 0,badgeIcon:void 0}].map((y,p)=>r.jsxs("div",{className:`relative overflow-hidden rounded-2xl p-5 border transition-all duration-300 hover:shadow-xl group ${s==="dark"?`${y.bgClass} ${y.borderClass} hover:border-white/20`:"bg-white border-gray-100 hover:border-emerald-500/20 shadow-sm"}`,children:[r.jsxs("div",{className:"flex justify-between items-start mb-6",children:[r.jsx("span",{className:`text-[10px] font-black uppercase tracking-widest ${s==="dark"?"text-gray-500":"text-gray-400"}`,children:y.label}),y.change&&r.jsx("span",{className:"px-2 py-0.5 rounded-full bg-emerald-500/10 text-emerald-500 text-[10px] font-black",children:y.change}),"badgeIcon"in y&&y.badgeIcon&&r.jsx("div",{className:"p-1 bg-emerald-500/10 rounded-lg",children:y.badgeIcon}),y.isTrend&&r.jsx(qt,{className:"w-4 h-4 text-purple-500/40"}),y.isCoins&&r.jsx(oi,{className:"w-4 h-4 text-orange-500/40"})]}),r.jsx("div",{className:"flex items-end justify-between",children:r.jsx("div",{className:`text-2xl md:text-3xl font-black tracking-tight ${s==="dark"?"text-white":"text-gray-900"}`,children:y.value})})]},p))})]}),r.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-12 gap-6",children:[r.jsxs("div",{className:`lg:col-span-3 rounded-2xl p-6 ${w} border ${s==="dark"?"border-white/5":"border-gray-100"} shadow-xl`,children:[r.jsxs("div",{className:"flex items-center gap-3 mb-8",children:[r.jsx("div",{className:"p-2 bg-[#4E6E49]/10 rounded-lg",children:r.jsx(Sx,{className:"w-5 h-5 text-[#4E6E49]"})}),r.jsx("h3",{className:`text-sm font-black uppercase tracking-widest ${s==="dark"?"text-white":"text-gray-900"}`,children:"Доли заработка"})]}),r.jsx("div",{className:"space-y-6",children:b.map(y=>{const p=Zr[y.key];return r.jsxs("div",{className:"space-y-2",children:[r.jsxs("div",{className:"flex justify-between items-center text-[11px] font-black uppercase",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("div",{className:`w-2 h-2 rounded-full ${p.accent==="emerald"?"bg-emerald-500":p.accent==="blue"?"bg-blue-500":p.accent==="purple"?"bg-purple-500":p.accent==="amber"?"bg-amber-500":p.accent==="pink"?"bg-pink-500":p.accent==="indigo"?"bg-indigo-500":"bg-gray-500"}`}),r.jsx("span",{className:s==="dark"?"text-gray-300":"text-gray-700",children:p.label})]}),r.jsxs("span",{className:s==="dark"?"text-white":"text-gray-900",children:[y.share.toFixed(0),"%"]})]}),r.jsx("div",{className:"h-1.5 w-full bg-white/5 rounded-full overflow-hidden",children:r.jsx("div",{className:`h-full rounded-full ${p.accent==="emerald"?"bg-emerald-500":p.accent==="blue"?"bg-blue-500":p.accent==="purple"?"bg-purple-500":p.accent==="amber"?"bg-amber-500":p.accent==="pink"?"bg-pink-500":p.accent==="indigo"?"bg-indigo-500":"bg-gray-500"}`,style:{width:`${y.share}%`}})})]},y.key)})})]}),r.jsxs("div",{className:`lg:col-span-9 rounded-2xl p-6 ${w} border ${s==="dark"?"border-white/5":"border-gray-100"} shadow-xl`,children:[r.jsx("div",{className:"flex items-center justify-between mb-8",children:r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx("div",{className:"p-2 bg-blue-500/10 rounded-lg",children:r.jsx(Jl,{className:"w-5 h-5 text-blue-400"})}),r.jsx("h3",{className:`text-sm font-black uppercase tracking-widest ${s==="dark"?"text-white":"text-gray-900"}`,children:"Детализация дохода по сферам"})]})}),r.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:b.map(y=>{const p=Zr[y.key];return r.jsxs("div",{className:`p-4 rounded-xl border ${s==="dark"?"bg-black/20 border-white/5 hover:border-white/10":"bg-gray-50 border-gray-200"} transition-all group`,children:[r.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[r.jsx("div",{className:`w-2 h-2 rounded-full ${p.accent==="emerald"?"bg-emerald-500":p.accent==="blue"?"bg-blue-500":p.accent==="purple"?"bg-purple-500":p.accent==="amber"?"bg-amber-500":p.accent==="pink"?"bg-pink-500":p.accent==="indigo"?"bg-indigo-500":"bg-gray-500"}`}),r.jsx("span",{className:`text-xs font-black uppercase tracking-widest ${s==="dark"?"text-white":"text-gray-900"}`,children:p.label})]}),r.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[r.jsxs("div",{children:[r.jsx("p",{className:"text-[9px] font-black text-gray-500 uppercase mb-1",children:"ЧИСТЫМИ"}),r.jsxs("p",{className:`text-sm font-black ${s==="dark"?"text-white":"text-gray-900"}`,children:[y.net.toLocaleString()," ₽"]})]}),r.jsxs("div",{className:"text-right",children:[r.jsx("p",{className:"text-[9px] font-black text-gray-500 uppercase mb-1",children:"В ПУЛ"}),r.jsxs("p",{className:`text-sm font-black ${s==="dark"?"text-white":"text-gray-900"}`,children:[y.pool.toLocaleString()," ₽"]})]})]}),r.jsx("div",{className:"h-1 w-full bg-white/5 rounded-full overflow-hidden",children:r.jsx("div",{className:`h-full rounded-full transition-all duration-500 ${p.accent==="emerald"?"bg-emerald-500 focus:bg-emerald-400":p.accent==="blue"?"bg-blue-500 focus:bg-blue-400":p.accent==="purple"?"bg-purple-500 focus:bg-purple-400":p.accent==="amber"?"bg-amber-500 focus:bg-amber-400":p.accent==="pink"?"bg-pink-500 focus:bg-pink-400":p.accent==="indigo"?"bg-indigo-500 focus:bg-indigo-400":"bg-gray-500"}`,style:{width:`${y.share}%`}})})]},y.key)})})]})]}),r.jsxs("div",{id:"earn-insights",className:`relative overflow-hidden rounded-3xl p-8 ${s==="dark"?"bg-[#0b1015] border-white/5":"bg-white border-gray-100"} border shadow-2xl`,children:[r.jsx("div",{className:"absolute top-0 right-0 w-64 h-64 bg-emerald-500/5 blur-3xl rounded-full -mr-32 -mt-32"}),r.jsxs("div",{className:"relative z-10 space-y-8",children:[r.jsxs("div",{children:[r.jsx("h3",{className:`text-lg font-black tracking-tight ${s==="dark"?"text-white":"text-gray-900"}`,children:"Инсайты Эффективности"}),r.jsx("p",{className:"text-xs text-gray-500",children:"Аналитика доходности по направлениям и участникам"})]}),r.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[{label:"Топ категория",value:j?Zr[j.key].label:"—",note:"+14% ROI",icon:r.jsx(qt,{className:"w-5 h-5 text-emerald-500"})},{label:"Лидер недели",value:N?N.name:"—",note:N?`${N.net.toLocaleString()} ₽ чистого`:"Нет данных",icon:r.jsx(pr,{className:"w-5 h-5 text-amber-500"})},{label:"Доля пула в работе",value:h.monthTotal?`${Math.round(h.monthPool/h.monthTotal*100)}%`:"68%",note:h.monthTotal?`Доступно ${h.monthPool.toLocaleString()} ₽`:"Доступно 0 ₽",icon:r.jsx(oi,{className:"w-5 h-5 text-blue-500"})},{label:"Средняя выплата",value:i.length?`${(i.reduce((y,p)=>y+A(p),0)/i.length).toFixed(0)} ₽`:"0 ₽",note:"↑ 5%",icon:r.jsx(Tn,{className:"w-5 h-5 text-emerald-500"})}].map((y,p)=>r.jsx("div",{className:`p-5 rounded-2xl border ${s==="dark"?"bg-white/5 border-white/5 shadow-inner":"bg-gray-50 border-gray-100"}`,children:r.jsxs("div",{className:"flex flex-col h-full justify-between",children:[r.jsxs("div",{className:"flex justify-between items-start mb-4",children:[r.jsx("span",{className:"text-[10px] font-black uppercase tracking-widest text-gray-500",children:y.label}),y.icon]}),r.jsxs("div",{className:"space-y-1",children:[r.jsx("p",{className:`text-lg font-black leading-tight ${s==="dark"?"text-white":"text-gray-900"}`,children:y.value}),r.jsx("p",{className:"text-[10px] font-black uppercase tracking-widest text-[#4E6E49]",children:y.note})]})]})},p))})]})]}),r.jsx("div",{className:"pt-8 border-t border-white/5",children:c?r.jsx("div",{className:`rounded-2xl p-12 text-center border border-dashed ${s==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-gray-50"}`,children:r.jsxs("div",{className:"flex flex-col items-center gap-4",children:[r.jsx("div",{className:"w-10 h-10 border-4 border-emerald-500/20 border-t-emerald-500 rounded-full animate-spin"}),r.jsx("p",{className:`text-sm font-medium ${s==="dark"?"text-gray-400":"text-gray-500"}`,children:"Загрузка данных..."})]})}):r.jsx("div",{className:"space-y-12",children:r.jsxs("div",{id:"earn-history",className:"space-y-8",children:[r.jsx("div",{className:"flex items-center justify-between",children:r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx("div",{className:"p-2 bg-emerald-500/10 rounded-xl",children:r.jsx(qt,{className:"w-5 h-5 text-emerald-500"})}),r.jsx("h3",{className:`text-lg font-black tracking-tight ${s==="dark"?"text-white":"text-gray-900"}`,children:"Лидеры по доходу"})]})}),r.jsx(Xj,{earnings:i}),r.jsxs("div",{className:"space-y-6",children:[r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx("div",{className:"p-2 bg-purple-500/10 rounded-xl",children:r.jsx(oi,{className:"w-5 h-5 text-purple-400"})}),r.jsx("h3",{className:`text-lg font-black tracking-tight ${s==="dark"?"text-white":"text-gray-900"}`,children:"Личные Накопления"})]}),r.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-5 gap-4",children:v.map(y=>r.jsxs("div",{className:`relative overflow-hidden rounded-2xl p-5 border shadow-xl ${s==="dark"?"bg-white/5 border-white/5":"bg-white border-gray-100"}`,children:[r.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[r.jsx("div",{className:"relative",children:y.avatar?r.jsx("img",{src:y.avatar,alt:"",className:"w-8 h-8 rounded-full object-cover ring-2 ring-white/10"}):r.jsx("div",{className:"w-8 h-8 rounded-full bg-emerald-500/20 flex items-center justify-center text-xs font-black text-emerald-500",children:y.name[0]})}),r.jsxs("div",{children:[r.jsx("p",{className:`text-sm font-black truncate max-w-[100px] ${s==="dark"?"text-white":"text-gray-900"}`,children:y.name}),r.jsx("p",{className:"text-[10px] text-gray-500 font-bold uppercase tracking-widest",children:y.login})]})]}),r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{className:"space-y-1",children:[r.jsx("p",{className:"text-[9px] font-black text-gray-500 uppercase tracking-widest",children:"Всего заработано"}),r.jsxs("p",{className:"text-base font-black text-emerald-500",children:[y.grossContribution.toLocaleString()," ₽"]})]}),r.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[r.jsxs("div",{className:"space-y-1",children:[r.jsx("p",{className:"text-[8px] font-black text-gray-500 uppercase tracking-widest",children:"В ПУЛ"}),r.jsxs("p",{className:`text-[11px] font-black ${s==="dark"?"text-gray-300":"text-gray-700"}`,children:[y.poolShare.toLocaleString()," ₽"]})]}),r.jsxs("div",{className:"space-y-1 text-right",children:[r.jsx("p",{className:"text-[8px] font-black text-gray-500 uppercase tracking-widest",children:"ПОЛУЧЕНО"}),r.jsxs("p",{className:`text-[11px] font-black ${s==="dark"?"text-gray-300":"text-gray-700"}`,children:[y.net.toLocaleString()," ₽"]})]})]}),r.jsx("div",{className:"h-1 w-full bg-white/5 rounded-full overflow-hidden",children:r.jsx("div",{className:"h-full bg-emerald-500 rounded-full",style:{width:`${Math.min(y.net/y.grossContribution*100,100)}%`}})})]})]},y.id))})]}),r.jsx("div",{className:"pt-8 border-t border-white/5",children:r.jsx(Jj,{earnings:i,onEdit:S,onDelete:P})})]})})}),e&&r.jsx(Qj,{onClose:L,onSave:ee,editingEarning:n})]})},q0=(s,e=0,t=0,n=0,a=0,i=0)=>{console.log("calculateRating input:",{userId:s.userId,weeklyDaysOff:n,weeklySickDays:a,data_sickDays:s.sickDays,data_vacationDays:s.vacationDays,ninetyDayVacationDays:i,data_absenceDays:s.absenceDays,weeklyHours:e,weeklyEarnings:t});let o=0,c=0;n<2?(c=5,o+=5):n>3&&(c=-15,o-=15),console.log("DaysOff calculation:",{weeklyDaysOff:n,daysOffPoints:c,currentRating:o});let d=0;a<3&&s.sickDays<=9?(d=5,o+=5):(a>4||s.sickDays>10)&&(d=-15,o-=15),console.log("SickDays calculation:",{weeklySickDays:a,monthlySickDays:s.sickDays,sickDaysPoints:d,currentRating:o});let h=0;s.vacationDays<12&&i<=30?(h=10,o+=10):(s.vacationDays>12||i>30)&&(h=-10,o-=10),console.log("Vacation calculation:",{monthlyVacationDays:s.vacationDays,ninetyDayVacationDays:i,vacationDaysPoints:h,currentRating:o});let m=0;s.absenceDays>2&&(m=30),console.log("Absence penalty:",{absenceDays:s.absenceDays,absencePenalty:m,currentRating:o}),e>=20?o+=25:e>=15&&(o+=15),t>=6e3?o+=30:t>=3e3&&(o+=15);const x=Math.min(s.referrals*5,30);return o+=x,o=Math.max(0,o-m),console.log("Final rating calculation:",{ratingAfterAbsencePenalty:o,finalRating:Math.min(o,100)}),Math.min(o,100)},z0=(s,e=0,t=0,n=0,a=0,i=0)=>{let o=0;n<2?o=5:n>3&&(o=-15);let c=0;a<3&&s.sickDays<=9?c=5:(a>4||s.sickDays>10)&&(c=-15);let d=0;s.vacationDays<12&&i<=30?d=10:(s.vacationDays>12||i>30)&&(d=-10);let h=0;s.absenceDays>2&&(h=-30);let m=0;e>=20?m=25:e>=15&&(m=15);let x=0;t>=6e3?x=30:t>=3e3&&(x=15);const f=Math.min(s.referrals*5,30),w=o+c+d+m+x+f,$=Math.min(Math.max(0,w+h),100);return{daysOff:n,daysOffPoints:o,sickDays:s.sickDays,sickDaysPoints:c,vacationDays:s.vacationDays,vacationDaysPoints:d,absenceDays:s.absenceDays,absenceDaysPoints:h,weeklyHours:e,weeklyHoursPoints:m,weeklyEarnings:t,weeklyEarningsPoints:x,referrals:s.referrals,referralsPoints:f,totalRating:$}},e4=s=>s<20?{status:"excluded",label:"Исключен",description:"Участник исключается из сообщества",color:"#dc2626"}:s>=21&&s<=45?{status:"warning",label:"Исправиться",description:"Необходимо улучшить показатели",color:"#f59e0b"}:{status:"ok",label:"В команде",description:"Участник в команде",color:"#10b981"},t4=({rating:s,place:e})=>{var k;const{theme:t}=it(),[n,a]=E.useState(null),i=$e.find(b=>b.id===s.userId),o=t==="dark"?"text-white":"text-gray-900",c=t==="dark"?"text-gray-400":"text-gray-600",d=t==="dark"?"bg-[#0f0f0f]":"bg-white",h=t==="dark"?"border-white/10":"border-gray-200",m=t==="dark"?"hover:bg-white/5":"hover:bg-gray-50",x=t==="dark"?"bg-white/5":"bg-gray-50/80",f=s.rating<=0?"4%":`${Math.min(s.rating,100)}%`,w=s.rating>=80?"bg-emerald-500":s.rating>=60?"bg-blue-500":s.rating>=40?"bg-amber-500":"bg-rose-500",$=s.rating>=80?"#10b981":s.rating>=60?"#3b82f6":s.rating>=40?"#f59e0b":"#f43f5e",T={1:{bg:t==="dark"?"bg-emerald-500/10":"bg-emerald-50",border:t==="dark"?"border-emerald-400/30":"border-emerald-200",text:t==="dark"?"text-emerald-100":"text-emerald-900",icon:t==="dark"?"text-emerald-200":"text-emerald-600",soft:t==="dark"?"bg-emerald-500/8":"bg-emerald-50"},2:{bg:t==="dark"?"bg-sky-500/10":"bg-sky-50",border:t==="dark"?"border-sky-400/30":"border-sky-200",text:t==="dark"?"text-sky-100":"text-sky-900",icon:t==="dark"?"text-sky-200":"text-sky-600",soft:t==="dark"?"bg-sky-500/8":"bg-sky-50"},3:{bg:t==="dark"?"bg-purple-500/10":"bg-purple-50",border:t==="dark"?"border-purple-400/30":"border-purple-200",text:t==="dark"?"text-purple-100":"text-purple-900",icon:t==="dark"?"text-purple-200":"text-purple-600",soft:t==="dark"?"bg-purple-500/8":"bg-purple-50"},4:{bg:t==="dark"?"bg-amber-500/10":"bg-amber-50",border:t==="dark"?"border-amber-400/30":"border-amber-200",text:t==="dark"?"text-amber-100":"text-amber-900",icon:t==="dark"?"text-amber-200":"text-amber-600",soft:t==="dark"?"bg-amber-500/8":"bg-amber-50"},5:{bg:t==="dark"?"bg-rose-500/10":"bg-rose-50",border:t==="dark"?"border-rose-400/30":"border-rose-200",text:t==="dark"?"text-rose-100":"text-rose-900",icon:t==="dark"?"text-rose-200":"text-rose-600",soft:t==="dark"?"bg-rose-500/8":"bg-rose-50"},default:{bg:t==="dark"?"bg-white/5":"bg-gray-50",border:t==="dark"?"border-white/10":"border-gray-200",text:t==="dark"?"text-white":"text-gray-900",icon:t==="dark"?"text-white":"text-gray-700",soft:t==="dark"?"bg-white/5":"bg-gray-50"}}[(i==null?void 0:i.id)||"default"],K=s.breakdown?[{icon:r.jsx(gs,{className:"w-5 h-5"}),label:"Выходные",value:`${s.breakdown.daysOff} день`,points:s.breakdown.daysOffPoints,maxPoints:5,explanation:"Менее 2 выходных в неделю = +5% к рейтингу. Более 3 выходных = -15%. Показывает стабильность присутствия.",threshold:"<2 дня: +5% | >3 дня: -15%",color:"bg-amber-200 text-amber-900"},{icon:r.jsx(xx,{className:"w-5 h-5"}),label:"Больничные",value:`${s.breakdown.sickDays} дней`,points:s.breakdown.sickDaysPoints,maxPoints:5,explanation:"Менее 3 дней больничных в неделю И ≤9 дней в месяц = +5%. Более 4 дней в неделю ИЛИ >10 дней в месяц = -15%.",threshold:"<3/нед + ≤9/мес: +5% | >4/нед или >10/мес: -15%",color:"bg-purple-200 text-purple-900"},{icon:r.jsx(Ax,{className:"w-5 h-5"}),label:"Отпуск",value:`${s.breakdown.vacationDays} дней`,points:s.breakdown.vacationDaysPoints,maxPoints:10,explanation:"Менее 12 дней отпуска в месяц И ≤30 дней за 90 дней = +10%. Более 12 дней в месяц ИЛИ >30 дней за 90 дней = -10%.",threshold:"<12/мес + ≤30/90дн: +10% | >12/мес или >30/90дн: -10%",color:"bg-orange-200 text-orange-900"},{icon:r.jsx(Ut,{className:"w-5 h-5"}),label:"Прогулы",value:`${s.breakdown.absenceDays} дней`,points:s.breakdown.absenceDaysPoints,maxPoints:0,explanation:"До 1 прогула в неделю = рейтинг не страдает. Более 2 прогулов = -30% к рейтингу. Учитывается за последние 7 дней.",threshold:"≤1 дня",color:"bg-red-200 text-red-900"},{icon:r.jsx(Dr,{className:"w-5 h-5"}),label:"Часы работы",value:tj(s.breakdown.weeklyHours),points:s.breakdown.weeklyHoursPoints,maxPoints:25,explanation:"20+ часов в неделю = 25% к рейтингу. 15-19 часов = 15%. Менее 15 часов = 0%. Показывает объем работы за неделю.",threshold:"≥20ч: 25% | ≥15ч: 15%",color:"bg-blue-200 text-blue-900"},{icon:r.jsx(Tn,{className:"w-5 h-5"}),label:"Заработок",value:`${s.breakdown.weeklyEarnings.toFixed(2)} ₽`,points:s.breakdown.weeklyEarningsPoints,maxPoints:30,explanation:"6000+ ₽ в неделю = 30% к рейтингу. 3000-5999 ₽ = 15%. Менее 3000 ₽ = 0%. Основной показатель эффективности.",threshold:"≥6000₽: 30% | ≥3000₽: 15%",color:"bg-emerald-200 text-emerald-900"},{icon:r.jsx(Ln,{className:"w-5 h-5"}),label:"Рефералы",value:`${s.breakdown.referrals} чел.`,points:s.breakdown.referralsPoints,maxPoints:30,explanation:"5% к рейтингу за каждого реферала. Максимум 30% (6 рефералов). Учитываются за последние 30 дней. Показывает активность по привлечению новых участников.",threshold:"5% за каждого (макс 30%)",color:"bg-pink-200 text-pink-900"}]:[],P=K.filter(b=>b.label!=="Прогулы").reduce((b,v)=>b+v.points,0),S=((k=K.find(b=>b.label==="Прогулы"))==null?void 0:k.points)||0,L=Math.max(0,Math.min(100,P+S)),ee=e4(s.rating),D=(()=>{if(!e)return null;const b=e.rank,v=b===1?{bg:"from-amber-400 to-amber-600",ring:"ring-amber-300/50",icon:"🥇"}:b===2?{bg:"from-slate-300 to-slate-500",ring:"ring-slate-300/50",icon:"🥈"}:b===3?{bg:"from-amber-200 to-amber-500",ring:"ring-amber-200/40",icon:"🥉"}:{bg:"from-gray-200 to-gray-400",ring:"ring-gray-200/40",icon:b.toString()};return r.jsx("div",{className:"absolute top-3 right-3",children:r.jsx("div",{className:`w-10 h-10 rounded-full bg-gradient-to-br ${v.bg} ring-4 ${v.ring} shadow-lg grid place-items-center text-lg font-semibold`,children:v.icon})})})();return r.jsxs("div",{className:`relative rounded-2xl p-6 ${d} shadow-sm border ${h} transition-colors`,children:[D,r.jsxs("div",{className:"mb-5 flex flex-col gap-3",children:[r.jsx("div",{className:"flex items-start justify-between gap-3",children:r.jsxs("div",{className:"min-w-0",children:[r.jsx("p",{className:`text-[11px] uppercase tracking-[0.12em] ${c}`,children:"Участник"}),r.jsx("div",{className:"flex items-center gap-2 flex-wrap",children:r.jsx("h3",{className:`text-2xl font-bold ${o} truncate`,children:r.jsx(Ls,{userId:s.userId,fallback:"unknown"})})}),r.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[r.jsxs("span",{className:`px-2.5 py-1 rounded-lg text-xs font-semibold border ${T.border} ${T.bg} ${T.text} flex items-center gap-1`,children:[r.jsx("span",{className:`text-lg leading-none ${T.icon}`,children:"●"}),r.jsx("span",{children:"Ник"})]}),r.jsx("div",{className:"flex items-center gap-2",children:r.jsxs("span",{className:"text-lg font-bold",style:{color:$},children:[s.rating.toFixed(1),"%"]})})]})]})}),r.jsxs("div",{children:[r.jsx("div",{className:"w-full bg-gray-200/70 dark:bg-gray-800 rounded-full h-6 overflow-hidden shadow-inner",children:r.jsx("div",{className:`h-full transition-all duration-500 flex items-center justify-center text-sm font-semibold text-white ${w}`,style:{width:f,minWidth:s.rating<=0?"40px":void 0},children:s.rating>=8&&r.jsxs("span",{children:[s.rating.toFixed(0),"%"]})})}),r.jsxs("div",{className:"flex justify-between mt-1",children:[r.jsx("span",{className:`text-xs ${c}`,children:"Общий рейтинг"}),r.jsxs("span",{className:`text-xs font-semibold ${c}`,children:[L,"/100 баллов"]})]})]}),r.jsxs("div",{className:"mt-3",children:[r.jsxs("div",{className:"inline-flex items-center gap-2 px-3 py-1.5 rounded-lg border text-sm font-medium",style:{backgroundColor:`${ee.color}15`,borderColor:`${ee.color}40`,color:ee.color},children:[r.jsx("div",{className:"w-2 h-2 rounded-full animate-pulse",style:{backgroundColor:ee.color}}),r.jsx("span",{children:ee.label})]}),r.jsx("p",{className:`text-xs mt-1 ${c}`,children:ee.description})]})]}),s.breakdown&&r.jsxs("div",{className:"space-y-3 mb-6",children:[r.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[r.jsx(qt,{className:`w-5 h-5 ${c}`}),r.jsx("h4",{className:`text-lg font-semibold ${o}`,children:"Детальный разбор рейтинга"})]}),K.map((b,v)=>{const j=b.maxPoints>0?b.points/b.maxPoints*100:0,N=n===v;return r.jsxs("div",{className:`rounded-lg border ${h} overflow-hidden transition-all ${N?"shadow-md":""}`,children:[r.jsx("button",{onClick:()=>a(N?null:v),className:`w-full p-4 flex items-center justify-between ${m} transition-colors`,children:r.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[r.jsx("div",{className:`p-2 rounded-lg ${b.color} flex-shrink-0`,children:b.icon}),r.jsxs("div",{className:"flex-1 min-w-0",children:[r.jsxs("div",{className:"flex items-center justify-between mb-1",children:[r.jsx("span",{className:`font-semibold ${o} truncate`,children:b.label}),r.jsxs("span",{className:`font-bold ml-2 ${b.points>0?"text-[#4E6E49]":"text-red-500"}`,children:[b.points,"/",b.maxPoints]})]}),r.jsx("div",{className:"w-full bg-gray-200 dark:bg-gray-800 rounded-full h-2 overflow-hidden",children:r.jsx("div",{className:`h-full transition-all duration-300 ${b.color}`,style:{width:`${j}%`}})}),r.jsxs("div",{className:"flex items-center justify-between mt-1",children:[r.jsx("span",{className:`text-xs ${c} truncate mr-2`,children:b.value}),r.jsx("span",{className:`text-xs ${c} whitespace-nowrap`,children:b.threshold})]})]}),r.jsx(Tr,{className:`w-4 h-4 flex-shrink-0 ml-2 ${c} transition-transform ${N?"rotate-180":""}`})]})}),N&&r.jsx("div",{className:`px-4 pb-4 pt-2 border-t ${h} ${x}`,children:r.jsx("p",{className:`text-sm ${c} leading-relaxed`,children:b.explanation})})]},v)})]}),r.jsxs("div",{className:`pt-4 border-t ${h}`,children:[r.jsx("h4",{className:`text-sm font-semibold mb-3 ${o}`,children:"Дополнительная статистика"}),r.jsxs("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[r.jsxs("div",{className:`p-3 rounded-lg ${x}`,children:[r.jsx("div",{className:`text-xs ${c} mb-1`,children:"Заработок (месяц)"}),r.jsxs("div",{className:`text-lg font-bold ${o}`,children:[s.earnings.toFixed(0)," ₽"]})]}),r.jsxs("div",{className:`p-3 rounded-lg ${x}`,children:[r.jsx("div",{className:`text-xs ${c} mb-1`,children:"В пул"}),r.jsxs("div",{className:`text-lg font-bold ${o}`,children:[s.poolAmount.toFixed(0)," ₽"]})]}),r.jsxs("div",{className:`p-3 rounded-lg ${x}`,children:[r.jsx("div",{className:`text-xs ${c} mb-1`,children:"Прогулы (неделя)"}),r.jsxs("div",{className:`text-lg font-bold ${o}`,children:[s.absenceDays," дней"]})]}),r.jsxs("div",{className:`p-3 rounded-lg ${x}`,children:[r.jsx("div",{className:`text-xs ${c} mb-1`,children:"Сигналы"}),r.jsxs("div",{className:`text-lg font-bold ${o}`,children:[s.signals,"/",s.profitableSignals]})]})]})]})]})},dl=()=>`REF-${Math.random().toString(36).slice(2,8).toUpperCase()}`,r4=({referral:s,onClose:e,onSave:t})=>{const{user:n}=bt(),{isAdmin:a}=_t(),{theme:i}=it(),[o,c]=E.useState(""),[d,h]=E.useState(""),[m,x]=E.useState(""),[f,w]=E.useState(dl()),[$,A]=E.useState(""),[T,K]=E.useState(!1),[P,S]=E.useState(!1);E.useEffect(()=>{s?(c(s.name),h(String(s.age)),w(s.referralId),x(s.comment||"")):(c(""),h(""),x(""),w(dl()))},[s]);const L=!!s,ee=L?"Редактировать реферала":"Добавить реферала",D=i==="dark"?"bg-gray-700 hover:bg-gray-600 text-white":"bg-gray-200 hover:bg-gray-300 text-gray-900",k=i==="dark"?"text-gray-300":"text-gray-700",b=i==="dark"?"text-white":"text-gray-900",v=async()=>{if(!s){if(!n){A("Пользователь не найден. Для добавления реферала необходимо войти как участник.");return}}if(!o.trim()||!d.trim()){A("Заполните имя и возраст");return}const N=Number(d);if(Number.isNaN(N)||N<16){A("Возраст должен быть числом не меньше 16");return}K(!0),A("");const y={referralId:f,ownerId:(s==null?void 0:s.ownerId)||n.id,name:o.trim(),age:N,createdAt:(s==null?void 0:s.createdAt)||new Date().toISOString(),...m.trim()&&{comment:m.trim()}};try{s?a?await L0(s.id,y):await Nt({entity:"referral",action:"update",authorId:(n==null?void 0:n.id)||s.ownerId,targetUserId:s.ownerId,before:s,after:{id:s.id,...y}}):a?await O0(y):await Nt({entity:"referral",action:"create",authorId:n.id,targetUserId:n.id,before:null,after:{id:"",...y}}),t()}catch(p){console.error("Error saving referral:",p);const te=p.message||p.code||"Не удалось сохранить реферала";A(te)}finally{K(!1)}},j=async()=>{if(s&&confirm(`Удалить реферала ${s.name}?`)){S(!0);try{a?await rd(s.id):await Nt({entity:"referral",action:"delete",authorId:(n==null?void 0:n.id)||s.ownerId,targetUserId:s.ownerId,before:s,after:null}),t()}catch(N){console.error("Error deleting referral:",N);const y=N.message||N.code||"Не удалось удалить реферала";A(y)}finally{S(!1)}}};return r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-start sm:items-center justify-center z-[70] p-4 sm:py-0 overflow-y-auto overflow-x-hidden overscroll-contain modal-scroll",children:r.jsxs("div",{className:`w-full max-w-md rounded-lg shadow-xl ${i==="dark"?"bg-[#1a1a1a]":"bg-white"} max-h-[90vh] flex flex-col overflow-hidden`,children:[r.jsx("div",{className:"flex-shrink-0 p-6 pb-4",children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsx("h3",{className:`text-xl font-bold ${b}`,children:ee}),r.jsx("button",{onClick:e,className:`p-2 rounded-lg flex-shrink-0 ${D}`,"aria-label":"Закрыть",children:r.jsx(Rt,{className:"w-5 h-5"})})]})}),r.jsx("div",{className:"flex-1 min-h-0 overflow-y-auto overflow-x-hidden overscroll-contain modal-scroll px-6 pb-6",children:r.jsxs("div",{className:"space-y-4 min-w-0",children:[r.jsxs("div",{children:[r.jsx("label",{className:`block text-sm font-medium mb-2 ${k}`,children:"Имя"}),r.jsx("input",{type:"text",value:o,onChange:N=>c(N.target.value),className:`w-full px-4 py-2 rounded-lg border ${i==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`,placeholder:"Введите имя"})]}),r.jsxs("div",{children:[r.jsx("label",{className:`block text-sm font-medium mb-2 ${k}`,children:"Возраст"}),r.jsx("input",{type:"number",value:d,onChange:N=>h(N.target.value),className:`w-full px-4 py-2 rounded-lg border ${i==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`,placeholder:"18",min:16})]}),r.jsxs("div",{children:[r.jsx("label",{className:`block text-sm font-medium mb-2 ${k}`,children:"Комментарий"}),r.jsx("textarea",{value:m,onChange:N=>x(N.target.value),rows:3,className:`w-full px-4 py-2 rounded-lg border ${i==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`,placeholder:"Например, источник лида или статус"})]}),r.jsxs("div",{children:[r.jsx("label",{className:`block text-sm font-medium mb-2 ${k}`,children:"ID реферала"}),r.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[r.jsx("input",{type:"text",value:f,readOnly:L,onChange:N=>w(N.target.value),className:`flex-1 px-4 py-2 rounded-lg border ${i==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49] ${L?"opacity-80 cursor-not-allowed":""}`}),!L&&r.jsxs("button",{type:"button",onClick:()=>w(dl()),className:"px-3 py-2 bg-[#4E6E49] hover:bg-[#4E6E49] text-white rounded-lg transition-colors flex items-center justify-center gap-1 text-sm",children:[r.jsx(Cx,{className:"w-4 h-4"}),"Новый"]})]}),r.jsx("p",{className:`text-xs mt-1 ${i==="dark"?"text-gray-400":"text-gray-500"}`,children:"ID генерируется автоматически и используется для учета."})]}),$&&r.jsx("div",{className:"p-3 bg-red-500 text-white rounded-lg text-sm",children:$}),r.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[L&&r.jsxs("button",{onClick:j,disabled:P,className:"flex-1 px-4 py-2 bg-red-500 hover:bg-red-600 disabled:bg-red-300 text-white rounded-lg transition-colors flex items-center justify-center gap-2",children:[r.jsx(Pt,{className:"w-4 h-4"}),P?"Удаление...":"Удалить"]}),r.jsx("button",{onClick:v,disabled:T,className:"flex-1 px-4 py-2 bg-[#4E6E49] hover:bg-[#4E6E49] disabled:bg-gray-400 disabled:cursor-not-allowed text-white rounded-lg transition-colors",children:T?"Сохранение...":"Сохранить"}),r.jsx("button",{onClick:e,className:`px-4 py-2 rounded-lg transition-colors ${D}`,children:"Отмена"})]})]})})]})})},s4=()=>{var q;const{theme:s}=it(),{user:e}=bt(),{isAdmin:t}=_t(),[n,a]=E.useState([]),[i,o]=E.useState(!0),[c,d]=E.useState([]),[h,m]=E.useState(!1),[x,f]=E.useState(null),[w,$]=E.useState([]),[A,T]=E.useState([]);E.useEffect(()=>{K()},[]);const K=async()=>{o(!0);try{const M=Gn(),z=ie(M.start,"yyyy-MM-dd"),I=ie(M.end,"yyyy-MM-dd"),R=Xi(30),O=ie(R.start,"yyyy-MM-dd"),U=ie(R.end,"yyyy-MM-dd"),J=R.start.toISOString(),C=R.end.toISOString(),oe=Xi(90),ae=ie(oe.start,"yyyy-MM-dd"),V=ie(oe.end,"yyyy-MM-dd"),Z=await V0(void 0,J,C);d(Z);const ye=[];for(const We of $e){const me=(await Ca(We.id,z,I)).reduce((Ce,Oe)=>{const re=Oe.participants&&Oe.participants.length>0?Oe.participants.length:1;return Ce+Oe.amount/re},0),Ie=await Ca(We.id,O,U),de=Ie.reduce((Ce,Oe)=>{const re=Oe.participants&&Oe.participants.length>0?Oe.participants.length:1;return Ce+Oe.amount/re},0),ze=Ie.reduce((Ce,Oe)=>{const re=Oe.participants&&Oe.participants.length>0?Oe.participants.length:1;return Ce+Oe.poolAmount/re},0),Le=await is(We.id),W=Le.filter(Ce=>{const Oe=Ce.date,re=Ce.endDate||Ce.date;return Oe<=U&&re>=O}),Ne=W.filter(Ce=>Ce.type==="dayoff").reduce((Ce,Oe)=>Ce+or(Oe.date,Oe.endDate,O,U),0),Pe=W.filter(Ce=>Ce.type==="sick").reduce((Ce,Oe)=>Ce+or(Oe.date,Oe.endDate,O,U),0),Y=W.filter(Ce=>Ce.type==="vacation").reduce((Ce,Oe)=>Ce+or(Oe.date,Oe.endDate,O,U),0),G=W.filter(Ce=>Ce.type==="absence").reduce((Ce,Oe)=>Ce+or(Oe.date,Oe.endDate,O,U),0),Te=Le.filter(Ce=>{const Oe=Ce.date,re=Ce.endDate||Ce.date;return Oe<=I&&re>=z}),Re=Te.filter(Ce=>Ce.type==="dayoff").reduce((Ce,Oe)=>Ce+or(Oe.date,Oe.endDate,z,I),0),Ue=Te.filter(Ce=>Ce.type==="sick").reduce((Ce,Oe)=>Ce+or(Oe.date,Oe.endDate,z,I),0),lt=Le.filter(Ce=>{const Oe=Ce.date,re=Ce.endDate||Ce.date;return Oe<=V&&re>=ae}).filter(Ce=>Ce.type==="vacation").reduce((Ce,Oe)=>Ce+or(Oe.date,Oe.endDate,ae,V),0),_e=(await wr(We.id)).filter(Ce=>Ce.date>=z&&Ce.date<=I).reduce((Ce,Oe)=>Ce+To(Oe.slots),0),ot=(await M0(We.id))[0]||{userId:We.id,earnings:0,messages:0,initiatives:0,signals:0,profitableSignals:0,referrals:0,daysOff:0,sickDays:0,vacationDays:0,absenceDays:0,poolAmount:0,rating:0,lastUpdated:new Date().toISOString()},ht=Z.filter(Ce=>Ce.ownerId===We.id).length,br={userId:We.id,earnings:de,messages:ot.messages||0,initiatives:ot.initiatives||0,signals:ot.signals||0,profitableSignals:ot.profitableSignals||0,referrals:ht,daysOff:Ne,sickDays:Pe,vacationDays:Y,absenceDays:G,poolAmount:ze,lastUpdated:new Date().toISOString()},Kt=q0(br,_e,me,Re,Ue,lt),Yt=z0(br,_e,me,Re,Ue,lt);ye.push({...br,rating:Kt,breakdown:Yt})}ye.sort((We,Q)=>Q.rating-We.rating),a(ye);const we=await vj();$(we);const Ke=await _j();T(Ke)}catch(M){console.error("Error loading ratings:",M)}finally{o(!1)}},P=n.reduce((M,z)=>M+z.rating,0)/(n.length||1),S=s==="dark"?"text-gray-400":"text-gray-600",L=s==="dark"?"text-white":"text-gray-900",ee="bg-[#10141c]",D="border-[#48a35e]/60",k="shadow-[0_24px_80px_rgba(0,0,0,0.45)]",b=s==="dark"?"text-white/70":"text-slate-600",v=s==="dark"?"text-white":"text-slate-900",j=[{label:"80-100%",title:"Эталон",desc:"Стабильный вклад, примеры для команды",tone:"text-emerald-700 dark:text-emerald-100",bg:"bg-emerald-50 dark:bg-emerald-900/40 border-emerald-200/60 dark:border-emerald-700/60"},{label:"60-79%",title:"Уверенно",desc:"Держат темп, есть потенциал роста",tone:"text-blue-700 dark:text-blue-100",bg:"bg-blue-50 dark:bg-blue-900/40 border-blue-200/60 dark:border-blue-700/60"},{label:"40-59%",title:"В пути",desc:"Нужна точечная поддержка и фокус",tone:"text-amber-700 dark:text-amber-100",bg:"bg-amber-50 dark:bg-amber-900/40 border-amber-200/60 dark:border-amber-700/60"},{label:"0-39%",title:"Зона роста",desc:"Запускаем план восстановления",tone:"text-rose-700 dark:text-rose-100",bg:"bg-rose-50 dark:bg-rose-900/40 border-rose-200/60 dark:border-rose-700/60"}],N=M=>{if(!M.breakdown)return["Недостаточно данных — обновите статистику."];const z=[];return M.breakdown.weeklyHoursPoints<25&&z.push("Дотяни рабочие часы до 20+ в неделю (25%)."),M.breakdown.weeklyEarningsPoints<30&&z.push("Увеличь недельный доход до 6000+ ₽ (30%)."),M.breakdown.referralsPoints<30&&z.push("Добавь рефералов: до +30% (6 человек)."),M.breakdown.daysOffPoints<=0&&z.push("Выходные: <2 дней в неделю для +5%."),M.breakdown.sickDaysPoints<=0&&z.push("Больничные: <3 дней в неделю И ≤9 дней в месяц для +5%."),M.breakdown.vacationDaysPoints<=0&&z.push("Отпуск: <12 дней в месяц И ≤30 дней за 90 дней для +10%."),z.length?z:["Отлично! Держи текущий темп."]},y=E.useMemo(()=>[...n].sort((M,z)=>z.rating-M.rating),[n]),p=E.useMemo(()=>{var O,U;if(!n.length)return{top:0,median:0,count:0,high:0};const M=[...n].sort((J,C)=>C.rating-J.rating),z=((O=M[0])==null?void 0:O.rating)||0,I=((U=M[Math.floor((M.length-1)/2)])==null?void 0:U.rating)||z,R=M.filter(J=>J.rating>=80).length;return{top:z,median:I,count:M.length,high:R}},[n]),te=y[0],ue=te?kt(te.userId):"—",le=new Date().toLocaleDateString("ru-RU"),H=[{label:"Средний рейтинг",value:`${P.toFixed(1)}%`,meta:"по команде за неделю",tone:"emerald"},{label:"Лидер недели",value:ue,meta:te?`${te.rating.toFixed(1)}%`:"—",tone:"amber"},{label:"80%+ участников",value:`${p.high}`,meta:"стабильно высоко",tone:"blue"},{label:"Всего участников",value:`${n.length}`,meta:"в рейтинге",tone:"slate"},{label:"Медиана",value:`${p.median.toFixed(1)}%`,meta:"ровный темп",tone:"purple"},{label:"Рефералы 30д",value:`${c.length}`,meta:"активность команды",tone:"pink"},{label:"Обновление",value:le,meta:"автообновление данных",tone:"indigo"},{label:"КПД недели",value:`${P.toFixed(1)}%`,meta:"ключевой ориентир",tone:"emerald"}],ne=M=>M==="emerald"?s==="dark"?"bg-emerald-500/15 border-emerald-400/30 text-emerald-50":"bg-emerald-50 border-emerald-200 text-emerald-900":M==="amber"?s==="dark"?"bg-amber-500/15 border-amber-400/30 text-amber-50":"bg-amber-50 border-amber-200 text-amber-900":M==="blue"?s==="dark"?"bg-sky-500/15 border-sky-400/30 text-sky-50":"bg-sky-50 border-sky-200 text-sky-900":M==="purple"?s==="dark"?"bg-indigo-500/15 border-indigo-400/30 text-indigo-50":"bg-indigo-50 border-indigo-200 text-indigo-900":M==="pink"?s==="dark"?"bg-rose-500/15 border-rose-400/30 text-rose-50":"bg-rose-50 border-rose-200 text-rose-900":M==="indigo"?s==="dark"?"bg-indigo-500/15 border-indigo-400/30 text-indigo-50":"bg-indigo-50 border-indigo-200 text-indigo-900":s==="dark"?"bg-white/5 border-white/15 text-white":"bg-gray-50 border-gray-200 text-gray-900",ce=M=>kt(M)||"—";E.useEffect(()=>{(async()=>{gh();for(const z of $e)await as(z.id)})()},[]),E.useEffect(()=>{const M=async z=>{const I=z,{userId:R}=I.detail||{};if(R)await as(R),a(O=>[...O]);else{gh();for(const O of $e)await as(O.id);a(O=>[...O])}};return window.addEventListener("nicknameUpdated",M),()=>{window.removeEventListener("nicknameUpdated",M)}},[]);const B=()=>{f(null),m(!0)},pe=M=>{f(M),m(!0)},F=async M=>{(t||M.ownerId===(e==null?void 0:e.id))&&(t?await rd(M.id):await Nt({entity:"referral",action:"delete",authorId:(e==null?void 0:e.id)||M.ownerId,targetUserId:M.ownerId,before:M,after:null}),await K())};return r.jsxs("div",{className:"space-y-6",children:[r.jsxs("div",{className:"relative overflow-hidden rounded-3xl border border-[#48a35e]/60 shadow-[0_24px_80px_rgba(0,0,0,0.45)] bg-[#10141c]",children:[r.jsxs("div",{className:"absolute inset-0 pointer-events-none",children:[r.jsx("div",{className:"absolute -left-16 -bottom-10 w-80 h-80 bg-emerald-500/18 blur-3xl"}),r.jsx("div",{className:"absolute inset-0 bg-[radial-gradient(circle_at_50%_0%,rgba(255,255,255,0.08),transparent_45%)]"})]}),r.jsxs("div",{className:"relative p-6 sm:p-8 space-y-6",children:[r.jsxs("div",{className:"flex flex-col gap-4 lg:flex-row lg:items-start lg:justify-between",children:[r.jsx("div",{className:"space-y-3 max-w-3xl",children:r.jsxs("div",{className:"flex items-start gap-3",children:[r.jsx("div",{className:"p-3 rounded-2xl bg-white/10 border border-white/20 text-white shadow-inner",children:r.jsxs("svg",{width:"26",height:"26",viewBox:"0 0 24 24",fill:"none",className:"text-emerald-300",children:[r.jsx("path",{d:"M4 13.5V20h4v-6.5H4Z",stroke:"currentColor",strokeWidth:"1.6",strokeLinecap:"round",strokeLinejoin:"round"}),r.jsx("path",{d:"M10 10v10h4V10h-4Z",stroke:"currentColor",strokeWidth:"1.6",strokeLinecap:"round",strokeLinejoin:"round"}),r.jsx("path",{d:"M16 4v16h4V4h-4Z",stroke:"currentColor",strokeWidth:"1.6",strokeLinecap:"round",strokeLinejoin:"round"}),r.jsx("path",{d:"M4 16.5 9.5 11l3 3 7-7",stroke:"currentColor",strokeWidth:"1.6",strokeLinecap:"round",strokeLinejoin:"round"})]})}),r.jsxs("div",{className:"space-y-2",children:[r.jsx("h1",{className:"text-3xl sm:text-4xl font-black text-white leading-tight",children:"Рейтинг команды"}),r.jsx("p",{className:"text-sm text-white/70",children:"Данные за текущую неделю + последние 30 дней. В фокусе KPI команды, динамика и реферальная активность — как на дашборде задач."}),r.jsx("div",{className:"flex flex-wrap gap-2",children:["КПД недели","Рейтинг 30д","Рефералы","Сообщения"].map((M,z)=>r.jsx("span",{className:`px-4 py-1.5 rounded-full text-xs font-semibold border ${z===0?"bg-emerald-500 text-white border-emerald-300/60 shadow-md":"bg-white/10 text-white border-white/20"}`,children:M},M))})]})]})}),r.jsx("div",{className:"flex flex-col items-start lg:items-end gap-2 text-white"})]}),r.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-4 gap-3",children:H.map(M=>r.jsxs("div",{className:`relative overflow-hidden rounded-2xl border ${ne(M.tone)} p-4 backdrop-blur-sm`,children:[r.jsx("div",{className:"absolute right-3 top-3 text-xl opacity-20",children:"•"}),r.jsx("div",{className:`text-xs uppercase tracking-[0.1em] font-semibold ${b}`,children:M.label}),r.jsx("div",{className:`mt-2 text-2xl font-bold ${v}`,children:M.value}),r.jsx("div",{className:`text-sm ${b}`,children:M.meta})]},M.label))})]})]}),r.jsxs("div",{className:`rounded-2xl p-6 sm:p-7 ${ee} ${k} border ${D}`,children:[r.jsxs("div",{className:"flex flex-col gap-2 mb-4",children:[r.jsx("p",{className:`text-xs uppercase tracking-[0.12em] ${S}`,children:"Методика"}),r.jsx("h3",{className:`text-2xl font-bold ${L}`,children:"Как мы строим эффективность команды?"}),r.jsx("p",{className:`text-sm ${S}`,children:"Четыре зоны, которые показывают, где сейчас участник и что делать дальше."})]}),r.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-4 gap-3",children:j.map(M=>r.jsxs("div",{className:`rounded-xl border ${M.bg} p-3 transition`,children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsx("span",{className:`text-xs font-semibold ${S}`,children:M.label}),r.jsx("span",{className:"text-lg",children:"•"})]}),r.jsx("p",{className:`text-base font-semibold ${M.tone}`,children:M.title}),r.jsx("p",{className:`text-sm ${S}`,children:M.desc})]},M.label))})]}),r.jsxs("div",{className:`rounded-2xl p-6 sm:p-7 ${ee} ${k} border ${D}`,children:[r.jsxs("div",{className:"flex flex-col gap-2 mb-4",children:[r.jsx("p",{className:`text-xs uppercase tracking-[0.12em] ${S}`,children:"Рекомендации"}),r.jsx("h3",{className:`text-2xl font-bold ${L}`,children:"Что улучшить каждому"}),r.jsx("p",{className:`text-sm ${S}`,children:"Динамические подсказки на основе текущих метрик рейтинга."})]}),r.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-3",children:y.map(M=>{const z=N(M),I=ce(M.userId),R=M.rating>=80?"bg-emerald-500":M.rating>=60?"bg-blue-500":M.rating>=40?"bg-amber-500":"bg-rose-500",O=M.rating>=80?"Эталон":M.rating>=60?"Уверенно":M.rating>=40?"В пути":"Зона роста";return r.jsxs("div",{className:"rounded-xl border border-white/10 bg-white/5 p-4 space-y-3",children:[r.jsxs("div",{className:"flex items-center justify-between gap-2",children:[r.jsxs("div",{className:"min-w-0",children:[r.jsx("p",{className:`text-xs uppercase tracking-[0.12em] ${S}`,children:O}),r.jsx("h4",{className:`text-lg font-bold ${L} truncate`,children:I})]}),r.jsx("div",{className:"text-right",children:r.jsxs("div",{className:"text-2xl font-bold text-white",children:[M.rating.toFixed(1),"%"]})})]}),r.jsx("div",{className:"w-full bg-white/5 rounded-full h-3 overflow-hidden border border-white/10",children:r.jsx("div",{className:`h-full ${R}`,style:{width:`${Math.min(M.rating,100)}%`}})}),r.jsx("ul",{className:"space-y-1 text-sm text-white/80",children:z.map((U,J)=>r.jsxs("li",{className:"flex items-start gap-2",children:[r.jsx("span",{className:"text-xs mt-0.5",children:"•"}),r.jsx("span",{children:U})]},J))})]},M.userId)})})]}),r.jsxs("div",{className:`rounded-2xl p-6 sm:p-7 ${ee} ${k} border ${D}`,children:[r.jsxs("div",{className:"flex flex-col gap-2 mb-4",children:[r.jsx("p",{className:`text-xs uppercase tracking-[0.12em] ${S}`,children:"Активность"}),r.jsx("h3",{className:`text-2xl font-bold ${L}`,children:"Последняя активность на сайте"}),r.jsx("p",{className:`text-sm ${S}`,children:"Информация о последнем посещении каждого участника."})]}),w.length>0?r.jsx("div",{className:"overflow-auto rounded-xl border border-white/10 bg-white/5",children:r.jsxs("table",{className:"min-w-[800px] w-full text-sm text-white/90",children:[r.jsx("thead",{className:"bg-white/5 text-white/70 text-left",children:r.jsxs("tr",{children:[r.jsx("th",{className:"py-3 px-4 font-semibold",children:"Участник"}),r.jsx("th",{className:"py-3 px-4 font-semibold",children:"Последний вход"}),r.jsx("th",{className:"py-3 px-4 font-semibold",children:"Браузер"}),r.jsx("th",{className:"py-3 px-4 font-semibold",children:"Время на сайте"}),r.jsx("th",{className:"py-3 px-4 font-semibold",children:"Выход"}),r.jsx("th",{className:"py-3 px-4 font-semibold",children:"Статус"})]})}),r.jsx("tbody",{children:$e.map(M=>{const z=w.find(O=>O.userId===M.id),I=O=>{if(!O)return"—";const U=Math.floor(O/3600),J=Math.floor(O%3600/60),C=O%60;return U>0?`${U}ч ${J}м ${C}с`:J>0?`${J}м ${C}с`:`${C}с`},R=O=>{try{const U=new Date(O);return ie(U,"dd.MM.yyyy HH:mm")}catch{return O}};return r.jsxs("tr",{className:"border-t border-white/10 hover:bg-white/5 transition-colors",children:[r.jsx("td",{className:"py-3 px-4 font-semibold text-white whitespace-nowrap",children:kt(M.id)}),r.jsx("td",{className:"py-3 px-4 text-white/80 whitespace-nowrap",children:z?R(z.loginAt):"—"}),r.jsx("td",{className:"py-3 px-4 text-white/80 whitespace-nowrap",children:(z==null?void 0:z.browser)||"—"}),r.jsx("td",{className:"py-3 px-4 text-white/80 whitespace-nowrap",children:z?I(z.sessionDuration):"—"}),r.jsx("td",{className:"py-3 px-4 text-white/80 whitespace-nowrap",children:z!=null&&z.logoutAt?R(z.logoutAt):z!=null&&z.isActive?"Активен":"—"}),r.jsx("td",{className:"py-3 px-4 whitespace-nowrap",children:z!=null&&z.isActive?r.jsx("span",{className:"px-2 py-1 rounded-lg text-xs font-semibold bg-emerald-500/20 text-emerald-200 border border-emerald-400/30",children:"Онлайн"}):r.jsx("span",{className:"px-2 py-1 rounded-lg text-xs font-semibold bg-gray-500/20 text-gray-300 border border-gray-400/30",children:"Офлайн"})})]},M.id)})})]})}):r.jsx("div",{className:"rounded-xl border border-white/10 bg-white/5 p-4 text-white/70",children:"Данные об активности пока отсутствуют."}),r.jsxs("div",{className:"mt-6",children:[r.jsxs("div",{className:"flex flex-col gap-2 mb-4",children:[r.jsx("p",{className:`text-xs uppercase tracking-[0.12em] ${S}`,children:"Статистика"}),r.jsx("h4",{className:`text-xl font-bold ${L}`,children:"Активность за последние 24 часа"}),r.jsx("p",{className:`text-sm ${S}`,children:"Сводная информация о посещениях за сутки."})]}),A.length>0?r.jsx("div",{className:"overflow-auto rounded-xl border border-white/10 bg-white/5",children:r.jsxs("table",{className:"min-w-[700px] w-full text-sm text-white/90",children:[r.jsx("thead",{className:"bg-white/5 text-white/70 text-left",children:r.jsxs("tr",{children:[r.jsx("th",{className:"py-3 px-4 font-semibold",children:"Участник"}),r.jsx("th",{className:"py-3 px-4 font-semibold",children:"Входов"}),r.jsx("th",{className:"py-3 px-4 font-semibold",children:"Общее время"}),r.jsx("th",{className:"py-3 px-4 font-semibold",children:"Среднее время сессии"}),r.jsx("th",{className:"py-3 px-4 font-semibold",children:"Последний вход"})]})}),r.jsx("tbody",{children:$e.map(M=>{const z=A.filter(oe=>oe.userId===M.id),I=oe=>{if(!oe)return"—";const ae=Math.floor(oe/3600),V=Math.floor(oe%3600/60),Z=oe%60;return ae>0?`${ae}ч ${V}м ${Z}с`:V>0?`${V}м ${Z}с`:`${Z}с`},R=oe=>{try{const ae=new Date(oe);return ie(ae,"dd.MM.yyyy HH:mm")}catch{return oe}},O=z.length,U=z.reduce((oe,ae)=>oe+(ae.sessionDuration||0),0),J=O>0?Math.floor(U/O):0,C=z.length>0?z.reduce((oe,ae)=>new Date(ae.loginAt)>new Date(oe.loginAt)?ae:oe):null;return r.jsxs("tr",{className:"border-t border-white/10 hover:bg-white/5 transition-colors",children:[r.jsx("td",{className:"py-3 px-4 font-semibold text-white whitespace-nowrap",children:kt(M.id)}),r.jsx("td",{className:"py-3 px-4 text-white/80 whitespace-nowrap text-center",children:O>0?O:"—"}),r.jsx("td",{className:"py-3 px-4 text-white/80 whitespace-nowrap",children:U>0?I(U):"—"}),r.jsx("td",{className:"py-3 px-4 text-white/80 whitespace-nowrap",children:J>0?I(J):"—"}),r.jsx("td",{className:"py-3 px-4 text-white/80 whitespace-nowrap",children:C?R(C.loginAt):"—"})]},M.id)})})]})}):r.jsx("div",{className:"rounded-xl border border-white/10 bg-white/5 p-4 text-white/70",children:"За последние 24 часа активности не зафиксировано."})]})]}),r.jsxs("div",{id:"rating-ref",className:`rounded-2xl p-6 sm:p-7 ${ee} ${k} border ${D}`,children:[r.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between mb-4",children:[r.jsxs("div",{className:"space-y-1",children:[r.jsx("p",{className:`text-xs uppercase tracking-[0.12em] ${S}`,children:"Рефералы · 30 дней"}),r.jsx("h3",{className:`text-2xl font-bold ${L}`,children:"Привлеченные участники"}),r.jsxs("p",{className:`text-sm ${S}`,children:["Всего добавлено: ",r.jsx("span",{className:"font-semibold",children:c.length})]})]}),r.jsxs("button",{onClick:B,className:"px-4 py-3 rounded-xl transition-all duration-200 flex items-center justify-center gap-2 font-semibold shadow-md w-full sm:w-auto border border-indigo-200/70 bg-indigo-50 text-indigo-900 hover:bg-indigo-100 dark:bg-indigo-500/15 dark:border-indigo-400/30 dark:text-indigo-50",children:[r.jsx("span",{className:"text-xl",children:"➕"}),r.jsx("span",{children:"Добавить реферала"})]})]}),c.length?r.jsx("div",{className:"overflow-auto rounded-xl border border-white/10 bg-white/5",children:r.jsxs("table",{className:"min-w-[820px] w-full text-sm text-white/90",children:[r.jsx("thead",{className:"bg-white/5 text-white/70 text-left",children:r.jsxs("tr",{children:[r.jsx("th",{className:"py-3 px-4 font-semibold",children:"Кто привел"}),r.jsx("th",{className:"py-3 px-4 font-semibold",children:"Код"}),r.jsx("th",{className:"py-3 px-4 font-semibold",children:"Имя"}),r.jsx("th",{className:"py-3 px-4 font-semibold",children:"Комментарий"}),r.jsx("th",{className:"py-3 px-4 font-semibold text-right",children:"Действия"})]})}),r.jsx("tbody",{children:c.map(M=>{const z=ce(M.ownerId),I=t||M.ownerId===(e==null?void 0:e.id);return r.jsxs("tr",{className:"border-t border-white/10 hover:bg-white/5 transition-colors",children:[r.jsx("td",{className:"py-3 px-4 font-semibold text-white whitespace-nowrap",children:z}),r.jsx("td",{className:"py-3 px-4 text-white/80 whitespace-nowrap",children:M.referralId}),r.jsx("td",{className:"py-3 px-4 text-white/80",children:M.name}),r.jsx("td",{className:"py-3 px-4 text-white/70",children:M.comment||"—"}),r.jsxs("td",{className:"py-3 px-4 text-right whitespace-nowrap flex items-center justify-end gap-2",children:[r.jsx("button",{onClick:()=>I&&pe(M),className:`px-3 py-1.5 rounded-lg text-xs font-semibold border border-white/20 bg-white/10 text-white transition ${I?"hover:bg-white/20":"opacity-40 cursor-not-allowed"}`,disabled:!I,children:"Редактировать"}),r.jsx("button",{onClick:()=>I&&F(M),className:`px-3 py-1.5 rounded-lg text-xs font-semibold border border-rose-300/60 bg-rose-500/20 text-rose-50 transition ${I?"hover:bg-rose-500/30":"opacity-40 cursor-not-allowed"}`,disabled:!I,children:"Удалить"})]})]},M.id)})})]})}):r.jsx("div",{className:"rounded-xl border border-white/10 bg-white/5 p-4 text-white/70",children:"Пока нет рефералов."})]}),r.jsxs("div",{id:"rating-method",className:`rounded-2xl p-6 sm:p-7 ${ee} ${k} border ${D}`,children:[r.jsx("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between mb-4",children:r.jsxs("div",{className:"space-y-1",children:[r.jsx("p",{className:`text-xs uppercase tracking-[0.12em] ${S}`,children:"Карточки участников"}),r.jsx("h3",{className:`text-2xl font-bold ${L}`,children:"Детальная статистика"})]})}),i?r.jsxs("div",{className:`rounded-xl p-12 text-center ${s==="dark"?"bg-white/5":"bg-gray-50"} border ${D}`,children:[r.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-4 border-emerald-500 border-t-transparent mx-auto mb-4"}),r.jsx("p",{className:`text-lg font-semibold ${L}`,children:"Загрузка рейтинга..."}),r.jsx("p",{className:`text-sm ${S} mt-2`,children:"Подождите, собираем статистику"})]}):r.jsxs(r.Fragment,{children:[r.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3 mb-6",children:[{label:"Топ-1",value:(q=y[0])!=null&&q.rating?`${y[0].rating.toFixed(1)}%`:"—"},{label:"Средний рейтинг",value:`${P.toFixed(1)}%`},{label:"Медиана",value:`${p.median.toFixed(1)}%`},{label:"Участников",value:y.length}].map(M=>r.jsxs("div",{className:`rounded-xl border ${D} ${s==="dark"?"bg-white/5":"bg-gray-50"} px-4 py-3`,children:[r.jsx("p",{className:`text-[11px] uppercase tracking-wide ${S}`,children:M.label}),r.jsx("p",{className:`text-2xl font-extrabold ${L}`,children:M.value})]},M.label))}),r.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-2 gap-6",children:y.map((M,z)=>r.jsx("div",{children:r.jsx(t4,{rating:M,place:{rank:z+1}})},M.userId))})]})]}),h&&r.jsx(r4,{referral:x,onClose:()=>{m(!1),f(null)},onSave:()=>{m(!1),f(null),K()}})]})},Ro={trading:ox,learning:In,technical:hx,stream:rm,research:px,organization:ux},n4=({onClose:s,onSave:e,editingTask:t})=>{var I,R;const{user:n}=bt(),{theme:a}=it(),i=!!t,o=a==="dark"?"text-white":"text-gray-900",c=a==="dark"?"bg-[#1a1a1a]":"bg-white",d=a==="dark"?"bg-gray-800":"bg-gray-50",h=a==="dark"?"border-gray-800":"border-gray-300",[m,x]=E.useState((t==null?void 0:t.title)||""),[f,w]=E.useState((t==null?void 0:t.description)||""),[$,A]=E.useState((t==null?void 0:t.category)||"trading"),[T,K]=E.useState((t==null?void 0:t.priority)||"medium"),[P,S]=E.useState((t==null?void 0:t.expectedResult)||""),[L,ee]=E.useState((t==null?void 0:t.dueDate)||ie(new Date,"yyyy-MM-dd")),[D,k]=E.useState((t==null?void 0:t.dueTime)||"12:00"),b=O=>({...O,assignees:O.assignees||[],approvals:O.approvals||[],requiresApproval:O.requiresApproval??!0,stagePriority:O.stagePriority||"medium",status:O.status||"pending"}),[v,j]=E.useState((I=t==null?void 0:t.stages)!=null&&I.length?t.stages.map(b):[b({id:"stage-1",name:"Этап 1",description:"",responsible:"all",assignees:[],approvals:[],stagePriority:"medium",requiresApproval:!0,status:"pending"})]),[N,y]=E.useState((t==null?void 0:t.currentStageId)||((R=v[0])==null?void 0:R.id)||"stage-1"),[p,te]=E.useState(""),[ue,le]=E.useState(!1);ps();const H=[{value:"urgent",label:"Экстренный",desc:"Нужно прямо сейчас",tone:a==="dark"?"bg-rose-600/20 border-rose-500/50 text-rose-100":"bg-rose-50 border-rose-200 text-rose-700"},{value:"high",label:"Высокий",desc:"Быстрый старт",tone:a==="dark"?"bg-red-500/15 border-red-500/40 text-red-100":"bg-red-50 border-red-200 text-red-700"},{value:"medium",label:"Средний",desc:"Плановый слот",tone:a==="dark"?"bg-amber-500/15 border-amber-500/40 text-amber-100":"bg-amber-50 border-amber-200 text-amber-700"},{value:"low",label:"Низкий",desc:"Фон",tone:a==="dark"?"bg-gray-500/15 border-gray-500/40 text-gray-100":"bg-gray-50 border-gray-200 text-gray-700"}],ne=(O,U)=>{j(J=>J.map(C=>C.id===O?{...C,...U}:C))},ce=(O,U)=>{j(J=>J.map(C=>C.id!==O?C:C.assignees.find(ae=>ae.userId===U)?{...C,assignees:C.assignees.filter(ae=>ae.userId!==U)}:C.assignees.length>=10?C:{...C,assignees:[...C.assignees,{userId:U,priority:"medium"}]}))},B=(O,U,J,C)=>{j(oe=>oe.map(ae=>{if(ae.id!==O)return ae;const V=ae.assignees.map(Z=>Z.userId===U?{...Z,[J]:C}:Z);return{...ae,assignees:V}}))},pe=()=>{const O=b({id:`stage-${Date.now()}`,name:`Этап ${v.length+1}`,description:"",responsible:"all",assignees:[],approvals:[],stagePriority:"medium",requiresApproval:!0,status:"pending"});j(U=>[...U,O]),N||y(O.id)},F=O=>{var J;if(v.length===1)return;const U=v.filter(C=>C.id!==O);j(U),N===O&&y(((J=U[0])==null?void 0:J.id)||"")},q=()=>m.trim()?!L||!D?"Укажите дедлайн (дата и время)":new Set(v.flatMap(U=>U.assignees.map(J=>J.userId))).size===0?"Добавьте исполнителей в этапах":"":"Введите название задачи",M=(O,U)=>{const J=O.assignees,C=J.map(ae=>ae.userId),oe=C.map(ae=>{const V=J.find(Z=>Z.userId===ae);return{userId:ae,status:"pending",updatedAt:U,...V!=null&&V.comment?{comment:V.comment}:{}}});return{id:O.id,name:O.name,description:O.description,responsible:C,assignees:J,stagePriority:O.stagePriority||"medium",requiresApproval:!0,approvals:oe,comments:O.comments||[],status:"pending"}},z=async()=>{var J;const O=q();if(O){te(O);return}if(!n){te("Пользователь не найден");return}te(""),le(!0);const U=new Date().toISOString();try{const C=v.map(Z=>M(Z,U)),oe=Array.from(new Set(C.flatMap(Z=>{var ye;return((ye=Z.assignees)==null?void 0:ye.map(we=>we.userId))||[]}))),ae=oe.map(Z=>({userId:Z,status:"pending",updatedAt:U})),V={title:m.trim(),description:f.trim()||void 0,category:$,priority:T,assignedTo:oe,assignees:oe.map(Z=>({userId:Z,priority:"medium"})),approvals:ae,stages:C,currentStageId:N||((J=C[0])==null?void 0:J.id),dueDate:L,dueTime:D,expectedResult:P.trim()||void 0,updatedAt:U};if(i&&t)await Jr(t.id,V);else{const Z={...V,status:"in_progress",createdBy:n.id,createdAt:U};await xj(Z)}e()}catch(C){console.error("Error saving task:",C),te("Ошибка при сохранении задачи")}finally{le(!1)}};return r.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-start sm:items-center justify-center z-[70] p-4 overflow-y-auto overscroll-contain modal-scroll touch-pan-y",children:r.jsx("div",{className:`${c} rounded-xl sm:rounded-2xl shadow-2xl w-full max-w-2xl max-h-[calc(100vh-48px)] sm:max-h-[calc(100vh-64px)] overflow-y-auto border-2 touch-pan-y ${a==="dark"?"border-[#4E6E49]/30 bg-gradient-to-br from-[#1a1a1a] via-[#1a1a1a] to-[#0A0A0A]":"border-green-200 bg-gradient-to-br from-white via-green-50/30 to-white"} relative`,children:r.jsxs("div",{className:"flex flex-col h-full min-h-0",children:[r.jsxs("div",{className:`sticky top-0 ${c} border-b ${h} p-4 sm:p-6 flex items-center justify-between z-10`,children:[r.jsxs("h2",{className:`text-xl sm:text-2xl font-bold ${o} flex items-center gap-2`,children:[r.jsx(Yh,{className:"w-5 h-5 sm:w-6 sm:h-6"}),i?"Редактировать задачу":"Новая задача"]}),r.jsx("button",{onClick:s,className:`p-2 rounded-lg transition-colors ${a==="dark"?"hover:bg-gray-700":"hover:bg-gray-100"}`,children:r.jsx(Rt,{className:"w-5 h-5"})})]}),r.jsxs("div",{className:"p-4 sm:p-6 space-y-4 sm:space-y-6 flex-1 min-h-0 overflow-y-auto overscroll-contain modal-scroll touch-pan-y pb-10",children:[p&&r.jsxs("div",{className:"p-3 rounded-lg bg-red-500/10 border border-red-500/30 flex items-center gap-2 text-red-500",children:[r.jsx(jx,{className:"w-5 h-5 flex-shrink-0"}),r.jsx("span",{className:"text-sm",children:p})]}),r.jsxs("div",{children:[r.jsx("label",{className:`block text-sm font-medium mb-2 ${o}`,children:"Название *"}),r.jsx("input",{value:m,onChange:O=>x(O.target.value),className:`w-full px-4 py-2.5 rounded-lg border ${h} ${d} ${o} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]/50`,placeholder:"Введите название задачи"})]}),r.jsxs("div",{children:[r.jsx("label",{className:`block text-sm font-medium mb-2 ${o}`,children:"Описание"}),r.jsx("textarea",{value:f,onChange:O=>w(O.target.value),rows:4,className:`w-full px-4 py-2.5 rounded-lg border ${h} ${d} ${o} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]/50`,placeholder:"Кратко опишите задачу"})]}),r.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[r.jsxs("div",{className:"space-y-3",children:[r.jsxs("label",{className:`block text-sm font-medium ${o} flex items-center gap-2`,children:[r.jsx(Mx,{className:"w-4 h-4"}),"Категория"]}),r.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2 sm:gap-3",children:Object.entries(ya).map(([O,{label:U}])=>{const J=Ro[O],C=$===O;return r.jsxs("button",{type:"button",onClick:()=>A(O),className:`p-3 rounded-lg border-2 text-sm font-semibold transition-all text-center ${C?a==="dark"?"border-[#4E6E49] bg-[#4E6E49]/15 text-[#4E6E49]":"border-[#4E6E49] bg-green-50 text-[#4E6E49]":a==="dark"?"border-gray-800 bg-gray-900 text-gray-200 hover:border-[#4E6E49]/40":"border-gray-200 bg-white text-gray-800 hover:border-[#4E6E49]/40"} flex items-center justify-center gap-2`,children:[r.jsx(J,{className:"w-4 h-4"}),r.jsx("span",{children:U})]},O)})})]}),r.jsxs("div",{className:"space-y-3",children:[r.jsxs("label",{className:`block text-sm font-medium ${o} flex items-center gap-2`,children:[r.jsx(pr,{className:"w-4 h-4"}),"Приоритет"]}),r.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2",children:H.map(O=>r.jsxs("button",{type:"button",onClick:()=>K(O.value),className:`p-3 rounded-lg border-2 text-left transition-all ${O.tone} ${T===O.value?"ring-2 ring-offset-2 ring-[#4E6E49] dark:ring-offset-[#1a1a1a]":""}`,children:[r.jsxs("div",{className:"flex items-center justify-between gap-2",children:[r.jsx("span",{className:"font-semibold text-sm",children:O.label}),T===O.value&&r.jsx("span",{className:"text-xs font-semibold",children:"выбрано"})]}),r.jsx("p",{className:"text-xs mt-1 opacity-80",children:O.desc})]},O.value))})]})]}),r.jsxs("div",{className:"space-y-3",children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsx("label",{className:`block text-sm font-medium ${o}`,children:"Этапы и исполнители"}),r.jsxs("button",{type:"button",onClick:pe,className:`px-3 py-1.5 rounded-lg text-xs font-semibold ${a==="dark"?"bg-gray-700 hover:bg-gray-600 text-gray-200":"bg-gray-200 hover:bg-gray-300 text-gray-800"}`,children:[r.jsx(os,{className:"w-4 h-4 inline"})," Добавить этап"]})]}),r.jsx("div",{className:"space-y-3",children:v.map((O,U)=>r.jsxs("div",{className:`p-3 rounded-lg border-2 ${h} ${d}`,children:[r.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[r.jsx("input",{value:O.name,onChange:J=>ne(O.id,{name:J.target.value}),className:`flex-1 px-3 py-2 rounded-lg border ${h} ${a==="dark"?"bg-[#0f0f0f] text-gray-100":"bg-white text-gray-800"}`,placeholder:`Этап ${U+1}`}),v.length>1&&r.jsx("button",{onClick:()=>F(O.id),className:`p-2 rounded-lg ${a==="dark"?"bg-red-500/20 text-red-200":"bg-red-100 text-red-700"}`,children:r.jsx(Lx,{className:"w-4 h-4"})})]}),r.jsx("textarea",{value:O.description||"",onChange:J=>ne(O.id,{description:J.target.value}),rows:2,className:`w-full px-3 py-2 rounded-lg border ${h} ${a==="dark"?"bg-[#0f0f0f] text-gray-100":"bg-white text-gray-800"}`,placeholder:"Описание этапа (опционально)"}),r.jsxs("div",{className:"mt-3 space-y-2",children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("label",{className:`text-sm font-medium ${o} flex items-center gap-2`,children:[r.jsx(Ln,{className:"w-4 h-4"}),"Исполнители этапа"]}),r.jsxs("span",{className:"text-[11px] text-gray-500",children:[O.assignees.length,"/10"]})]}),r.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-2",children:$e.map(J=>{const C=O.assignees.some(oe=>oe.userId===J.id);return r.jsx("button",{type:"button",onClick:()=>ce(O.id,J.id),className:`p-2 rounded-lg border text-left text-sm transition-all ${C?a==="dark"?"border-[#4E6E49] bg-[#4E6E49]/20":"border-[#4E6E49] bg-green-50":`${h} ${d}`}`,children:r.jsx("span",{className:C?"text-[#4E6E49]":o,children:kt(J.id)})},J.id)})}),O.assignees.length>0&&r.jsx("div",{className:"space-y-2",children:O.assignees.map(J=>{const C=$e.find(oe=>oe.id===J.userId);return r.jsxs("div",{className:`p-2 rounded-lg border ${h} ${a==="dark"?"bg-[#0f0f0f]":"bg-white"}`,children:[r.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2",children:[r.jsx("div",{className:"text-sm font-medium",children:(C==null?void 0:C.name)||J.userId}),r.jsxs("select",{value:J.priority,onChange:oe=>B(O.id,J.userId,"priority",oe.target.value),className:`px-3 py-1.5 rounded-lg border ${h} ${a==="dark"?"bg-[#1a1a1a] text-gray-100":"bg-white text-gray-700"}`,children:[r.jsx("option",{value:"urgent",children:"Экстренный"}),r.jsx("option",{value:"high",children:"Высокий"}),r.jsx("option",{value:"medium",children:"Средний"}),r.jsx("option",{value:"low",children:"Низкий"})]})]}),r.jsx("textarea",{value:J.comment||"",onChange:oe=>B(O.id,J.userId,"comment",oe.target.value),rows:2,className:`mt-2 w-full px-3 py-2 rounded-lg border ${h} ${a==="dark"?"bg-[#1a1a1a] text-gray-100":"bg-white text-gray-700"}`,placeholder:"Комментарий для исполнителя (опционально)"})]},J.userId)})})]})]},O.id))})]}),r.jsxs("div",{children:[r.jsxs("label",{className:`block text-sm font-medium mb-2 ${o} flex items-center gap-2`,children:[r.jsx(er,{className:"w-4 h-4"}),"Какой результат должен быть"]}),r.jsx("textarea",{value:P,onChange:O=>S(O.target.value),rows:3,className:`w-full px-4 py-2.5 rounded-lg border ${h} ${d} ${o} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]/50`,placeholder:"Опишите ожидаемый итог"})]}),r.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[r.jsxs("div",{className:"space-y-1",children:[r.jsxs("label",{className:`text-sm font-medium ${o} flex items-center gap-2`,children:[r.jsx(gs,{className:"w-4 h-4"}),"Дата дедлайна *"]}),r.jsx("input",{type:"date",value:L,onChange:O=>ee(O.target.value),min:ie(new Date,"yyyy-MM-dd"),className:`w-full px-4 py-2.5 rounded-lg border ${h} ${d} ${o} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]/50`})]}),r.jsxs("div",{className:"space-y-1",children:[r.jsxs("label",{className:`text-sm font-medium ${o} flex items-center gap-2`,children:[r.jsx(Dr,{className:"w-4 h-4"}),"Время дедлайна *"]}),r.jsx("input",{type:"time",value:D,onChange:O=>k(O.target.value),className:`w-full px-4 py-2.5 rounded-lg border ${h} ${d} ${o} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]/50`})]})]}),r.jsxs("div",{className:`flex flex-col sm:flex-row gap-3 pt-4 border-t ${h}`,children:[r.jsx("button",{onClick:z,disabled:ue,className:`flex-1 px-6 py-3 rounded-lg font-semibold transition-all ${ue?"bg-gray-400 cursor-not-allowed":"bg-gradient-to-r from-[#4E6E49] to-emerald-700 hover:from-[#4E6E49] hover:to-emerald-700 text-white shadow-lg hover:shadow-xl transform hover:scale-[1.02]"}`,children:ue?"Сохранение...":i?"Сохранить":"Создать задачу"}),r.jsx("button",{onClick:s,className:`px-6 py-3 rounded-lg font-semibold transition-colors ${a==="dark"?"bg-gray-700 hover:bg-gray-600 text-gray-300":"bg-gray-200 hover:bg-gray-300 text-gray-700"}`,children:"Отмена"})]})]})]})})})},ad=60*1e3,Da=60*ad,Rh=24*Da,a4=s=>{if(s<=0)return"Просрочено";const e=Math.floor(s/Rh),t=Math.floor(s%Rh/Da),n=Math.floor(s%Da/ad);return e>0?`${e}д ${t}ч`:t>0?`${t}ч ${n}м`:`${Math.max(n,1)}м`},i4=s=>s<=0?"overdue":s<=Da?"urgent":s<=6*Da?"soon":"on_track",ul=(s,e)=>{if(!s||!e)return{label:"—",status:"unknown",isOverdue:!1};const n=new Date(`${s}T${e}`).getTime()-Date.now();if(Number.isNaN(n))return{label:"—",status:"unknown",isOverdue:!1};const a=i4(n);return{label:a4(n),status:a,isOverdue:a==="overdue"}},o4=(s,e)=>{const t=E.useMemo(()=>ul(s,e),[s,e]),[n,a]=E.useState(t);return E.useEffect(()=>{a(ul(s,e));const i=setInterval(()=>{a(ul(s,e))},ad);return()=>clearInterval(i)},[s,e]),n},l4=(s,e)=>e==="dark"?{overdue:"bg-red-500/10 border-red-500/40 text-red-300",urgent:"bg-orange-500/10 border-orange-500/40 text-orange-200",soon:"bg-yellow-500/10 border-yellow-500/40 text-yellow-200",on_track:"bg-[#4E6E49]/10 border-[#4E6E49]/40 text-green-200",unknown:"bg-gray-600/30 border-gray-500/40 text-gray-200"}[s]:{overdue:"bg-red-50 border-red-200 text-red-600",urgent:"bg-orange-50 border-orange-200 text-orange-600",soon:"bg-yellow-50 border-yellow-200 text-yellow-700",on_track:"bg-green-50 border-green-200 text-[#4E6E49]",unknown:"bg-gray-100 border-gray-200 text-gray-600"}[s],W0=({dueDate:s,dueTime:e,theme:t,size:n="default"})=>{const{label:a,status:i}=o4(s,e),o=l4(i,t),c=n==="compact"?"px-2 py-0.5 text-[11px]":"px-2.5 py-1 text-xs sm:text-sm",d=n==="compact"?"w-3 h-3":"w-4 h-4";return r.jsxs("span",{className:`inline-flex items-center gap-1 rounded-full border font-medium ${c} ${o}`,children:[r.jsx(Dr,{className:d}),a]})},c4=({task:s,onEdit:e,onDelete:t,onUpdate:n})=>{const{user:a}=bt(),{isAdmin:i}=_t(),{theme:o}=it(),[c,d]=E.useState(!1),[h,m]=E.useState(!1),[x,f]=E.useState(""),w=o==="dark"?"text-white":"text-gray-900",$=o==="dark"?"bg-[#1a1a1a]":"bg-white",A=o==="dark"?"border-gray-800":"border-gray-300",T=ya[s.category],K=Gs[s.status],P=Ro[s.category],S=s.assignees&&s.assignees.length>0?s.assignees:s.assignedTo.map(F=>({userId:F,priority:"medium"})),L=S.map(F=>F.userId),ee=S.map(F=>{const q=$e.find(M=>M.id===F.userId);return q?{...F,member:q}:null}).filter(Boolean),D=i||(a==null?void 0:a.id)===s.createdBy||s.mainExecutor===(a==null?void 0:a.id),k=()=>{const F=new Date().toISOString(),M=(s.approvals||[]).filter(I=>L.includes(I.userId)).map(I=>({userId:I.userId,status:I.status==="approved"?"approved":"pending",updatedAt:I.updatedAt||F,...I.comment?{comment:I.comment}:{}})),z=L.filter(I=>!M.some(R=>R.userId===I)).map(I=>({userId:I,status:"pending",updatedAt:F}));return[...M,...z]},b=()=>!!a&&L.includes(a.id),v=()=>i||(a==null?void 0:a.id)===s.createdBy,j=()=>{const F=k(),q=F.filter(M=>M.status==="approved").length;return{approvals:F,approved:q,total:L.length}},{approvals:N,approved:y,total:p}=j(),te=N.find(F=>F.userId===(a==null?void 0:a.id)),ue=b()&&s.status==="in_progress"&&(!te||te.status!=="approved"),le=v()&&s.status==="completed",H=async()=>{if(!(!a||s.status!=="in_progress"||!b())){d(!0);try{const F=new Date().toISOString(),q=k().map(I=>I.userId===a.id?{...I,status:"approved",updatedAt:F}:I),M=L.length>0&&L.every(I=>q.find(R=>R.userId===I&&R.status==="approved")),z={approvals:q,updatedAt:F};M&&(z.status="completed",z.completedAt=F,z.completedBy=a.id),await Jr(s.id,z),n()}catch(F){console.error("Error confirming task:",F)}finally{d(!1)}}},ne=async()=>{if(!(!v()||s.status!=="completed")){d(!0);try{const F=new Date().toISOString();await Jr(s.id,{status:"closed",closedAt:F,updatedAt:F}),n()}catch(F){console.error("Error closing task:",F)}finally{d(!1)}}},ce=async()=>{if(!v())return;const F=(x||"").trim();if(F){d(!0);try{const q=new Date().toISOString(),M=L.map(I=>({userId:I,status:"pending",updatedAt:q})),z={id:`c-${Date.now()}`,userId:(a==null?void 0:a.id)||"system",text:F,createdAt:q};await Jr(s.id,{status:"in_progress",approvals:M,completedAt:void 0,completedBy:void 0,closedAt:void 0,comments:[...s.comments||[],z],updatedAt:q}),m(!1),f(""),n()}catch(q){console.error("Error returning task:",q)}finally{d(!1)}}},B=()=>({in_progress:o==="dark"?"bg-blue-500/20 border-blue-500/50 text-blue-400":"bg-blue-50 border-blue-200 text-blue-700",completed:o==="dark"?"bg-[#4E6E49]/20 border-[#4E6E49]/50 text-[#4E6E49]":"bg-green-50 border-green-200 text-[#4E6E49]",closed:o==="dark"?"bg-gray-500/20 border-gray-500/50 text-gray-400":"bg-gray-50 border-gray-200 text-gray-700"})[s.status],pe=()=>{const F={green:{bg:o==="dark"?"bg-[#4E6E49]/20":"bg-green-50",text:"text-[#4E6E49]"},blue:{bg:o==="dark"?"bg-blue-500/20":"bg-blue-50",text:o==="dark"?"text-blue-400":"text-blue-700"},purple:{bg:o==="dark"?"bg-purple-500/20":"bg-purple-50",text:o==="dark"?"text-purple-400":"text-purple-700"},red:{bg:o==="dark"?"bg-red-500/20":"bg-red-50",text:o==="dark"?"text-red-400":"text-red-700"},yellow:{bg:o==="dark"?"bg-yellow-500/20":"bg-yellow-50",text:o==="dark"?"text-yellow-400":"text-yellow-700"},indigo:{bg:o==="dark"?"bg-indigo-500/20":"bg-indigo-50",text:o==="dark"?"text-indigo-400":"text-indigo-700"}};return F[T.color]||F.green};return r.jsxs(r.Fragment,{children:[r.jsxs("div",{className:`${$} rounded-xl border-2 ${A} p-4 sm:p-6 shadow-lg hover:shadow-xl transition-all ${o==="dark"?"hover:border-[#4E6E49]/50":"hover:border-[#4E6E49]"}`,children:[r.jsxs("div",{className:"flex items-start justify-between gap-3 mb-3",children:[r.jsxs("div",{className:"flex-1 min-w-0",children:[r.jsx("div",{className:"flex items-center gap-2 mb-2",children:r.jsx("h3",{className:`text-lg sm:text-xl font-bold ${w} truncate`,children:s.title})}),r.jsxs("div",{className:"flex flex-wrap items-center gap-2 sm:gap-3",children:[r.jsxs("span",{className:`px-2.5 py-1 rounded-lg text-xs sm:text-sm font-medium ${pe().bg} ${pe().text} inline-flex items-center gap-1.5`,children:[r.jsx(P,{className:"w-4 h-4"}),T.label]}),r.jsx("span",{className:`px-2.5 py-1 rounded-lg text-xs sm:text-sm font-medium border ${B()}`,children:K.label}),r.jsx("span",{className:`px-2.5 py-1 rounded-lg text-xs sm:text-sm font-medium border ${o==="dark"?"border-yellow-500/40 text-yellow-200 bg-yellow-500/10":"border-yellow-200 text-yellow-700 bg-yellow-50"}`,children:s.priority==="urgent"?"Экстренный приоритет":s.priority==="high"?"Высокий приоритет":s.priority==="medium"?"Средний приоритет":"Низкий приоритет"})]})]}),D&&r.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[r.jsx("button",{onClick:()=>e(s),className:`p-2 rounded-lg transition-colors ${o==="dark"?"hover:bg-gray-700":"hover:bg-gray-100"}`,title:"Редактировать",children:r.jsx(cr,{className:"w-4 h-4"})}),r.jsx("button",{onClick:()=>t(s.id),className:`p-2 rounded-lg transition-colors ${o==="dark"?"hover:bg-red-500/20 text-red-400":"hover:bg-red-50 text-red-600"}`,title:"Удалить",children:r.jsx(Pt,{className:"w-4 h-4"})})]})]}),s.description&&r.jsx("p",{className:`text-sm ${o==="dark"?"text-gray-300":"text-gray-600"} mb-4 line-clamp-2`,children:s.description}),r.jsxs("div",{className:"space-y-2 mb-4",children:[r.jsxs("div",{className:"flex flex-col gap-3",children:[r.jsxs("div",{className:"flex items-center gap-2 text-xs sm:text-sm",children:[r.jsx(Ys,{className:`w-4 h-4 ${o==="dark"?"text-blue-400":"text-blue-600"}`}),r.jsx("span",{className:`font-medium ${o==="dark"?"text-gray-300":"text-gray-700"}`,children:"Автор:"}),r.jsx("span",{className:o==="dark"?"text-gray-400":"text-gray-600",children:s.createdBy?kt(s.createdBy):"Неизвестно"})]}),r.jsxs("div",{children:[r.jsxs("div",{className:"flex items-center gap-2 text-xs sm:text-sm",children:[r.jsx(Ln,{className:"w-4 h-4 text-[#4E6E49]"}),r.jsx("span",{className:`font-medium ${o==="dark"?"text-gray-300":"text-gray-700"}`,children:"Исполнители:"})]}),ee.length>0?r.jsx("div",{className:"mt-2 space-y-1",children:ee.map(F=>r.jsx("div",{className:`text-sm ${o==="dark"?"text-gray-100":"text-gray-800"}`,children:kt(F.member.id)},F.member.id))}):r.jsx("span",{className:"text-gray-500",children:"Не назначены"})]})]}),r.jsxs("div",{className:"flex items-center gap-3 flex-wrap text-xs sm:text-sm",children:[r.jsxs("span",{className:"inline-flex items-center gap-1",children:[r.jsx(gs,{className:`w-4 h-4 ${o==="dark"?"text-gray-400":"text-gray-500"}`}),r.jsxs("span",{className:o==="dark"?"text-gray-400":"text-gray-600",children:["Дедлайн: ",ie(new Date(s.dueDate),"dd.MM.yyyy")," ",s.dueTime]})]}),r.jsx(W0,{dueDate:s.dueDate,dueTime:s.dueTime,theme:o})]}),p>0&&r.jsxs("div",{className:"flex items-center gap-2 text-xs sm:text-sm",children:[r.jsx(no,{className:`w-4 h-4 ${o==="dark"?"text-yellow-400":"text-yellow-600"}`}),r.jsxs("span",{className:o==="dark"?"text-yellow-400":"text-yellow-600",children:["Подтвердили: ",y,"/",p]})]})]}),r.jsxs("div",{className:`mt-4 p-3 rounded-lg border ${A} ${o==="dark"?"bg-[#1a1a1a]/70":"bg-gray-50"}`,children:[r.jsxs("div",{className:"flex items-center justify-between mb-2",children:[r.jsx("span",{className:"text-sm font-semibold",children:"Подтверждения исполнителей"}),r.jsxs("span",{className:"text-xs text-gray-500",children:[y,"/",p]})]}),N.length>0&&r.jsx("div",{className:"space-y-1 text-xs",children:N.map(F=>{const q=$e.find(z=>z.id===F.userId),M=F.status==="approved"?"подтвердил":"ожидает";return r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("span",{className:"flex items-center gap-1",children:[r.jsx("span",{className:"font-medium",children:(q==null?void 0:q.name)||F.userId}),r.jsxs("span",{className:"text-gray-500",children:["(",M,")"]})]}),F.comment&&r.jsx("span",{className:"text-gray-500 truncate max-w-[140px]",children:F.comment})]},F.userId)})})]}),r.jsxs("div",{className:`flex flex-wrap gap-2 pt-4 border-t ${A}`,children:[ue&&r.jsxs("button",{onClick:H,disabled:c,className:"flex-1 sm:flex-none px-4 py-2 bg-[#4E6E49] hover:bg-[#4E6E49] text-white rounded-lg text-sm font-medium transition-colors flex items-center justify-center gap-2 disabled:opacity-50",children:[r.jsx(_r,{className:"w-4 h-4"}),"Подтвердить"]}),le&&r.jsxs(r.Fragment,{children:[r.jsxs("button",{onClick:ne,disabled:c,className:"flex-1 sm:flex-none px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg text-sm font-medium transition-colors flex items-center justify-center gap-2 disabled:opacity-50",children:[r.jsx(Ra,{className:"w-4 h-4"}),"Закрыто"]}),r.jsxs("button",{onClick:()=>m(!0),disabled:c,className:"flex-1 sm:flex-none px-4 py-2 bg-red-500 hover:bg-red-600 text-white rounded-lg text-sm font-medium transition-colors flex items-center justify-center gap-2 disabled:opacity-50",children:[r.jsx(Rt,{className:"w-4 h-4"}),"Не выполнено"]})]}),s.status==="completed"&&!le&&r.jsx("span",{className:`text-xs ${o==="dark"?"text-gray-400":"text-gray-600"}`,children:"Ожидает подтверждения автора"})]})]}),h&&r.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-start sm:items-center justify-center z-[70] p-4 overflow-y-auto overscroll-contain modal-scroll",children:r.jsxs("div",{className:`${$} rounded-xl p-6 max-w-md w-full border-2 ${A}`,children:[r.jsx("h3",{className:`text-lg font-bold mb-4 ${w}`,children:"Не выполнено"}),r.jsx("textarea",{value:x,onChange:F=>f(F.target.value),placeholder:"Опишите, что нужно доработать",rows:3,className:`w-full px-4 py-2 rounded-lg border ${A} ${o==="dark"?"bg-gray-700":"bg-gray-50"} ${w} mb-4 focus:outline-none focus:ring-2 focus:ring-[#4E6E49]/50`}),r.jsxs("div",{className:"flex gap-3",children:[r.jsx("button",{onClick:ce,disabled:c||!x.trim(),className:"flex-1 px-4 py-2 rounded-lg font-medium transition-colors bg-red-500 hover:bg-red-600 text-white disabled:opacity-50",children:"Отправить на доработку"}),r.jsx("button",{onClick:()=>{m(!1),f("")},className:`px-4 py-2 rounded-lg font-medium transition-colors ${o==="dark"?"bg-gray-700 hover:bg-gray-600":"bg-gray-200 hover:bg-gray-300"}`,children:"Отмена"})]})]})})]})},d4=({selectedCategory:s,selectedStatus:e,selectedUsers:t,onCategoryChange:n,onStatusChange:a,onUsersChange:i,onClear:o})=>{const{theme:c}=it(),d=c==="dark"?"text-white":"text-gray-900",h=c==="dark"?"bg-[#1a1a1a]":"bg-white",m=c==="dark"?"border-gray-800":"border-gray-300",x=s!=="all"||e!=="all"||t.length>0,f=$e.filter(A=>t.includes(A.id)).map(A=>A.name),w=[{href:"#filter-status",label:"Статусы"},{href:"#filter-category",label:"Категории"},{href:"#filter-people",label:"Исполнители"}],$={in_progress:r.jsx(Ss,{className:"w-4 h-4"}),completed:r.jsx(Ra,{className:"w-4 h-4"}),closed:r.jsx(sx,{className:"w-4 h-4"})};return r.jsxs("div",{className:`${h} rounded-xl border-2 ${m} p-4 sm:p-6 shadow-lg sticky top-4 space-y-4`,children:[r.jsxs("div",{className:"flex items-start justify-between gap-3",children:[r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx("div",{className:`p-2 rounded-lg ${c==="dark"?"bg-[#4E6E49]/20":"bg-green-50"}`,children:r.jsx(Qh,{className:"w-5 h-5 text-[#4E6E49]"})}),r.jsxs("div",{children:[r.jsx("h3",{className:`text-lg font-bold ${d}`,children:"Фильтры"}),r.jsx("p",{className:`text-xs ${c==="dark"?"text-gray-400":"text-gray-500"}`,children:"Быстрая навигация по статусам, категориям и участникам"})]})]}),x&&r.jsxs("button",{onClick:o,className:`px-3 py-1.5 rounded-lg text-sm transition-all flex items-center gap-2 ${c==="dark"?"bg-red-500/20 hover:bg-red-500/30 text-red-300 border border-red-500/50":"bg-red-50 hover:bg-red-100 text-red-600 border border-red-200"}`,children:[r.jsx(Rt,{className:"w-4 h-4"}),r.jsx("span",{className:"hidden sm:inline",children:"Сбросить всё"})]})]}),r.jsx("div",{className:"flex flex-wrap gap-2",children:w.map(A=>r.jsxs("a",{href:A.href,className:`px-3 py-1.5 rounded-lg text-xs font-semibold border transition flex items-center gap-2 ${c==="dark"?"border-white/10 bg-white/5 text-gray-100 hover:border-[#4E6E49]/50":"border-gray-200 bg-white text-gray-800 hover:border-[#4E6E49]/50 hover:text-[#4E6E49]"}`,children:[r.jsx(Yd,{className:"w-4 h-4"}),A.label]},A.href))}),r.jsxs("div",{className:`rounded-lg border ${m} ${c==="dark"?"bg-[#1f1f1f]":"bg-gray-50"} p-3 space-y-2`,children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(Ex,{className:"w-4 h-4 text-[#4E6E49]"}),r.jsx("p",{className:`text-sm font-semibold ${d}`,children:"Текущая подборка"})]}),r.jsx("div",{className:"flex flex-wrap gap-2",children:x?r.jsxs(r.Fragment,{children:[s!=="all"&&r.jsx("span",{className:"px-2.5 py-1 rounded-full text-xs font-semibold bg-emerald-500/10 text-emerald-700 dark:text-emerald-200 border border-emerald-500/30",children:ya[s].label}),e!=="all"&&r.jsx("span",{className:"px-2.5 py-1 rounded-full text-xs font-semibold bg-sky-500/10 text-sky-700 dark:text-sky-200 border border-sky-500/30",children:Gs[e].label}),t.length>0&&r.jsx("span",{className:"px-2.5 py-1 rounded-full text-xs font-semibold bg-purple-500/10 text-purple-700 dark:text-purple-200 border border-purple-500/30",children:f.join(", ")})]}):r.jsx("span",{className:`text-xs ${c==="dark"?"text-gray-400":"text-gray-500"}`,children:"Фильтры не заданы"})})]}),r.jsxs("div",{className:"space-y-6",children:[r.jsxs("div",{id:"filter-status",className:"space-y-3",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(vx,{className:"w-4 h-4 text-yellow-500"}),r.jsx("label",{className:`block text-sm font-semibold ${d}`,children:"Статусы"})]}),r.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[r.jsxs("button",{onClick:()=>a("all"),className:`px-3 py-2 rounded-lg text-sm font-semibold transition-all border-2 ${e==="all"?c==="dark"?"bg-[#4E6E49]/20 border-[#4E6E49] text-[#4E6E49]":"bg-green-50 border-[#4E6E49] text-[#4E6E49]":`${c==="dark"?"bg-gray-800 border-gray-800 text-gray-200 hover:bg-gray-700":"bg-white border-gray-200 text-gray-700 hover:border-[#4E6E49]/40"}`} flex items-center gap-2 justify-start text-left w-full`,children:[r.jsx(Ks,{className:"w-4 h-4"}),"Целиком"]}),Object.entries(Gs).map(([A,{label:T,color:K}])=>{const P={yellow:c==="dark"?"bg-yellow-500/10 border-yellow-500/50 text-yellow-300":"bg-yellow-50 border-yellow-500/40 text-yellow-700",blue:c==="dark"?"bg-blue-500/10 border-blue-500/50 text-blue-300":"bg-blue-50 border-blue-500/40 text-blue-700",purple:c==="dark"?"bg-purple-500/10 border-purple-500/50 text-purple-200":"bg-purple-50 border-purple-500/40 text-purple-700",green:c==="dark"?"bg-emerald-500/10 border-emerald-500/50 text-emerald-200":"bg-emerald-50 border-emerald-500/40 text-emerald-700",gray:c==="dark"?"bg-gray-500/10 border-gray-500/50 text-gray-300":"bg-gray-50 border-gray-400/60 text-gray-700",red:c==="dark"?"bg-red-500/10 border-red-500/50 text-red-300":"bg-red-50 border-red-500/40 text-red-700"},S=P[K]||P.gray,L=$[A];return r.jsx("button",{onClick:()=>a(A),className:`px-3 py-2 rounded-lg text-sm font-semibold transition-all border-2 flex items-center justify-start gap-3 text-left ${e===A?S:c==="dark"?"bg-gray-900 border-gray-800 text-gray-200 hover:border-[#4E6E49]/40":"bg-white border-gray-200 text-gray-700 hover:border-[#4E6E49]/40"}`,children:r.jsxs("span",{className:"flex items-center gap-2",children:[L,T]})},A)})]})]}),r.jsxs("div",{id:"filter-category",className:"space-y-3",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(pr,{className:"w-4 h-4 text-purple-500"}),r.jsx("label",{className:`block text-sm font-semibold ${d}`,children:"Категории"})]}),r.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2",children:[r.jsxs("button",{onClick:()=>n("all"),className:`px-3 py-3 rounded-lg text-sm font-semibold transition-all border-2 flex items-center gap-2 justify-start text-left w-full ${s==="all"?c==="dark"?"bg-[#4E6E49]/20 border-[#4E6E49] text-[#4E6E49]":"bg-green-50 border-[#4E6E49] text-[#4E6E49]":`${c==="dark"?"bg-gray-900 border-gray-800 text-gray-200 hover:border-[#4E6E49]/40":"bg-white border-gray-200 text-gray-700 hover:border-[#4E6E49]/40"}`}`,children:[r.jsx(Yd,{className:"w-4 h-4"}),"Всё"]}),Object.entries(ya).map(([A,{label:T}])=>{const K=Ro[A],P=s===A;return r.jsx("button",{onClick:()=>n(A),className:`px-3 py-3 rounded-lg text-sm font-semibold transition-all border-2 flex flex-col items-start gap-2 text-left leading-tight whitespace-normal ${P?c==="dark"?"bg-[#4E6E49]/20 border-[#4E6E49] text-[#4E6E49]":"bg-green-50 border-[#4E6E49] text-[#4E6E49]":`${c==="dark"?"bg-gray-900 border-gray-800 text-gray-200 hover:border-[#4E6E49]/40":"bg-white border-gray-200 text-gray-700 hover:border-[#4E6E49]/40"}`}`,children:r.jsxs("span",{className:"flex items-center gap-2 justify-start",children:[r.jsx(K,{className:"w-4 h-4"}),r.jsx("span",{className:"break-words",children:T})]})},A)})]})]}),r.jsxs("div",{id:"filter-people",className:"space-y-3",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(Ln,{className:"w-4 h-4 text-sky-500"}),r.jsx("label",{className:`block text-sm font-semibold ${d}`,children:"Исполнители"})]}),r.jsxs("div",{className:"flex flex-wrap gap-2",children:[r.jsx("button",{onClick:()=>i([]),className:`px-3 py-2 rounded-lg text-sm font-semibold transition-all border-2 ${t.length===0?c==="dark"?"bg-[#4E6E49]/20 border-[#4E6E49] text-[#4E6E49]":"bg-green-50 border-[#4E6E49] text-[#4E6E49]":`${c==="dark"?"bg-gray-900 border-gray-800 text-gray-200 hover:border-[#4E6E49]/40":"bg-white border-gray-200 text-gray-700 hover:border-[#4E6E49]/40"}`}`,children:"Все"}),$e.map(A=>{const T=t.includes(A.id);return r.jsxs("button",{onClick:()=>{i(T?t.filter(K=>K!==A.id):[...t,A.id])},className:`px-3 py-2 rounded-lg text-sm font-semibold transition-all border-2 flex items-center gap-2 ${T?c==="dark"?"bg-[#4E6E49]/20 border-[#4E6E49] text-[#4E6E49]":"bg-green-50 border-[#4E6E49] text-[#4E6E49]":`${c==="dark"?"bg-gray-900 border-gray-800 text-gray-200 hover:border-[#4E6E49]/40":"bg-white border-gray-200 text-gray-700 hover:border-[#4E6E49]/40"}`}`,children:[r.jsx(dx,{className:`w-3 h-3 ${T?"text-[#4E6E49]":"text-gray-400"}`}),kt(A.id)]},A.id)})]})]})]})]})},u4=({tasks:s,onUpdate:e,onEdit:t,onDelete:n})=>{var Ke,We;const{theme:a}=it(),{user:i}=bt(),{isAdmin:o}=_t(),[c,d]=E.useState(null),[h,m]=E.useState(null),[x,f]=E.useState(null),[w,$]=E.useState(""),[A,T]=E.useState(null),[K,P]=E.useState(null),[S,L]=E.useState(null),[ee,D]=E.useState(null),k=a==="dark"?"text-white":"text-gray-900",b=a==="dark"?"bg-[#1a1a1a]":"bg-white",v=a==="dark"?"border-gray-800":"border-gray-300",j=["in_progress","completed","closed"],N=Q=>Q.assignees&&Q.assignees.length>0?Q.assignees:Q.assignedTo.map(me=>({userId:me,priority:"medium"})),y=Q=>N(Q).map(me=>me.userId),p=Q=>{if(Q.stages&&Q.stages.length>0){const me=Q.awaitingStageId||Q.currentStageId||Q.stages[0].id;return Q.stages.find(Ie=>Ie.id===me)||Q.stages[0]}return{id:"legacy-stage",name:"Этап",responsible:"all",approvals:Q.approvals||[],status:"pending",comments:[]}},te=Q=>!!i&&Q.createdBy===i.id,ue=Q=>!!i&&Q.mainExecutor===i.id,le=Q=>!!i&&(Q.leadExecutor===i.id||(Q.leads||[]).includes(i.id)),H=Q=>o||te(Q)||ue(Q)||le(Q),ne=(Q,me)=>me===Q.createdBy?"A":me===Q.mainExecutor?"ГИ":me===Q.leadExecutor||(Q.leads||[]).includes(me)?"ВИ":"",ce=Q=>s.filter(me=>me.status===Q),B=(Q,me)=>{if(A||!H(me)){Q.preventDefault();return}d(me),Q.dataTransfer.effectAllowed="move",Q.dataTransfer.setData("text/plain",me.id)},pe=Q=>{Q.preventDefault(),Q.dataTransfer.dropEffect="move"},F=()=>{d(null)},q=(Q,me)=>{if(A||!H(me))return;const Ie=Q.touches[0];P({x:Ie.clientX,y:Ie.clientY,task:me})},M=Q=>{if(!K)return;Q.preventDefault();const me=Q.touches[0],Ie=document.elementFromPoint(me.clientX,me.clientY);if(Ie){const de=Ie.closest("[data-status]");if(de){const ze=de.getAttribute("data-status");ze&&L(ze)}}},z=async(Q,me)=>{if(!K)return;const Ie=Q.changedTouches[0],de=document.elementFromPoint(Ie.clientX,Ie.clientY);if(de){const ze=de.closest("[data-status]");if(ze){const Le=ze.getAttribute("data-status");Le&&Le!==me&&await C(K.task,Le)}}P(null),L(null)},I=Q=>{const me=y(Q),Ie=new Date().toISOString(),ze=(Q.approvals||[]).filter(W=>me.includes(W.userId)).map(W=>({userId:W.userId,status:W.status==="approved"?"approved":"pending",updatedAt:W.updatedAt||Ie,...W.comment?{comment:W.comment}:{}})),Le=me.filter(W=>!ze.some(Ne=>Ne.userId===W)).map(W=>({userId:W,status:"pending",updatedAt:Ie}));return[...ze,...Le]},R=Q=>{const me=I(Q),Ie=y(Q).length,de=me.filter(ze=>ze.status==="approved").length;return{approvals:me,approved:de,total:Ie}},O=Q=>!!i&&y(Q).includes(i.id),U=Q=>o||te(Q),J=async(Q,me)=>{if(Q.preventDefault(),Q.stopPropagation(),!c||c.status===me||A||!H(c)){d(null);return}const{approvals:Ie,approved:de,total:ze}=R(c),Le=new Date().toISOString();if(me==="completed"&&(ze===0||de<ze)){d(null);return}if(me==="closed"&&(!U(c)||c.status!=="completed")){d(null);return}const W={status:me,updatedAt:Le};me==="completed"?(W.completedAt=Le,W.completedBy=(i==null?void 0:i.id)||"system",W.approvals=Ie):me==="closed"?W.closedAt=Le:me==="in_progress"&&(W.approvals=y(c).map(Ne=>({userId:Ne,status:"pending",updatedAt:Le})),W.completedAt=void 0,W.completedBy=void 0,W.closedAt=void 0),T(c.id);try{await Jr(c.id,W),e()}catch(Ne){console.error("Error updating task status:",Ne)}finally{T(null),d(null)}},C=async(Q,me)=>{if(Q.status===me||A===Q.id||!H(Q)){m(null);return}const{approvals:Ie,approved:de,total:ze}=R(Q),Le=new Date().toISOString();if(me==="completed"&&(ze===0||de<ze)){m(null);return}if(me==="closed"&&(!U(Q)||Q.status!=="completed")){m(null);return}const W={status:me,updatedAt:Le};me==="completed"?(W.completedAt=Le,W.completedBy=(i==null?void 0:i.id)||"system",W.approvals=Ie):me==="closed"?W.closedAt=Le:me==="in_progress"&&(W.approvals=y(Q).map(Ne=>({userId:Ne,status:"pending",updatedAt:Le})),W.completedAt=void 0,W.completedBy=void 0,W.closedAt=void 0),T(Q.id);try{await Jr(Q.id,W),e(),m(null)}catch(Ne){console.error("Error updating task status:",Ne)}finally{T(null)}},oe=async Q=>{if(!(!i||Q.status!=="in_progress"||!O(Q))){T(Q.id);try{const me=new Date().toISOString(),Ie=I(Q).map(W=>W.userId===i.id?{...W,status:"approved",updatedAt:me}:W),de=y(Q),ze=de.length>0&&de.every(W=>Ie.find(Ne=>Ne.userId===W&&Ne.status==="approved")),Le={approvals:Ie,updatedAt:me};ze&&(Le.status="completed",Le.completedAt=me,Le.completedBy=i.id),await Jr(Q.id,Le),e()}catch(me){console.error("Error confirming task:",me)}finally{T(null)}}},ae=async Q=>{if(!(!U(Q)||Q.status!=="completed")){T(Q.id);try{const me=new Date().toISOString();await Jr(Q.id,{status:"closed",closedAt:me,updatedAt:me}),e()}catch(me){console.error("Error closing task:",me)}finally{T(null)}}},V=async(Q,me)=>{if(!U(Q))return;const Ie=(me||"").trim();if(Ie){T(Q.id);try{const de=new Date().toISOString(),ze=y(Q).map(W=>({userId:W,status:"pending",updatedAt:de})),Le={id:`c-${Date.now()}`,userId:(i==null?void 0:i.id)||"system",text:Ie,createdAt:de};await Jr(Q.id,{status:"in_progress",approvals:ze,completedAt:void 0,completedBy:void 0,closedAt:void 0,comments:[...Q.comments||[],Le],updatedAt:de}),e(),f(null),$("")}catch(de){console.error("Error returning task to work:",de)}finally{T(null)}}},Z=Q=>({in_progress:a==="dark"?"bg-blue-500/20 border-blue-500/50":"bg-blue-50 border-blue-200",completed:a==="dark"?"bg-[#4E6E49]/20 border-[#4E6E49]/50":"bg-green-50 border-green-200",closed:a==="dark"?"bg-gray-500/20 border-gray-500/50":"bg-gray-50 border-gray-200"})[Q],ye=Q=>({in_progress:a==="dark"?"text-blue-400":"text-blue-700",completed:"text-[#4E6E49]",closed:a==="dark"?"text-gray-400":"text-gray-700"})[Q],we=Q=>{const me=new Date;return new Date(`${Q.dueDate}T${Q.dueTime}`)<me&&Q.status!=="completed"&&Q.status!=="closed"};return r.jsxs(r.Fragment,{children:[r.jsx("div",{className:"overflow-x-auto pb-4 -mx-4 px-4",children:r.jsx("div",{className:"flex gap-3 sm:gap-4 min-w-max",children:j.map(Q=>{const me=ce(Q),Ie=Gs[Q];return r.jsxs("div",{"data-status":Q,className:`flex-shrink-0 w-[280px] sm:w-80 ${b} rounded-xl border-2 ${v} p-3 sm:p-4 ${S===Q?"border-[#4E6E49]":""}`,onDragOver:pe,onDrop:de=>J(de,Q),onTouchMove:M,children:[r.jsx("div",{className:`mb-3 sm:mb-4 pb-2 sm:pb-3 border-b ${v}`,children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsx("h3",{className:`text-base sm:text-lg font-bold ${ye(Q)}`,children:Ie.label}),r.jsx("span",{className:`px-2 py-1 rounded-lg text-xs sm:text-sm font-medium ${Z(Q)} ${ye(Q)}`,children:me.length})]})}),r.jsxs("div",{className:"space-y-2 sm:space-y-3 max-h-[calc(100vh-280px)] sm:max-h-[calc(100vh-300px)] overflow-y-auto",children:[me.map(de=>{var lt,Qe,ct;const ze=we(de),Le=o||(i==null?void 0:i.id)===de.createdBy||de.mainExecutor===(i==null?void 0:i.id),W=p(de),Pe=N(de).map(_e=>{const Me=$e.find(ot=>ot.id===_e.userId);return Me?{..._e,member:Me}:null}).filter(Boolean),{approvals:Y,approved:G,total:Te}=R(de),Re=Y.find(_e=>_e.userId===(i==null?void 0:i.id)),Ue=O(de)&&de.status==="in_progress"&&(!Re||Re.status!=="approved"),xe=U(de)&&de.status==="completed";return r.jsxs("div",{draggable:!A&&H(de),onDragStart:_e=>B(_e,de),onDragEnd:F,onTouchStart:_e=>q(_e,de),onTouchEnd:_e=>z(_e,Q),className:`${b} rounded-lg border-2 ${v} p-2.5 sm:p-3 cursor-move hover:shadow-lg transition-all ${(c==null?void 0:c.id)===de.id||(K==null?void 0:K.task.id)===de.id?"opacity-50":""} ${ze?"border-red-500":""} ${A===de.id?"opacity-50 pointer-events-none":""}`,children:[r.jsxs("div",{className:"flex items-start justify-between gap-2 mb-2",children:[r.jsx("h4",{className:`font-semibold text-xs sm:text-sm ${k} flex-1`,children:de.title}),r.jsx("div",{className:"flex items-center gap-1 flex-shrink-0",children:r.jsxs("div",{className:"relative lg:hidden",children:[r.jsx("button",{onClick:()=>m((h==null?void 0:h.id)===de.id?null:de),className:`p-1 rounded ${a==="dark"?"hover:bg-gray-700":"hover:bg-gray-100"}`,children:r.jsx(_x,{className:"w-4 h-4"})}),(h==null?void 0:h.id)===de.id&&r.jsxs(r.Fragment,{children:[r.jsx("div",{className:"fixed inset-0 z-40",onClick:()=>m(null)}),r.jsx("div",{className:`absolute right-0 top-8 z-50 ${b} rounded-lg shadow-xl border-2 ${v} min-w-[200px]`,children:r.jsxs("div",{className:"p-2",children:[r.jsx("div",{className:`text-xs font-medium mb-2 px-2 py-1 ${a==="dark"?"text-gray-400":"text-gray-600"}`,children:"Изменить статус:"}),j.map(_e=>r.jsx("button",{onClick:()=>C(de,_e),disabled:de.status===_e||A===de.id||!H(de),className:`w-full text-left px-3 py-2 rounded-lg text-sm transition-colors mb-1 ${de.status===_e?Z(_e):a==="dark"?"hover:bg-gray-700":"hover:bg-gray-100"} ${de.status===_e?ye(_e):k} disabled:opacity-50`,children:Gs[_e].label},_e)),Le&&r.jsxs(r.Fragment,{children:[r.jsx("div",{className:`border-t ${v} my-2`}),r.jsx("button",{onClick:()=>{m(null),t(de)},className:`w-full text-left px-3 py-2 rounded-lg text-sm transition-colors mb-1 ${a==="dark"?"hover:bg-gray-700":"hover:bg-gray-100"} ${k}`,children:"Редактировать"}),r.jsx("button",{onClick:()=>{m(null),D(de)},className:`w-full text-left px-3 py-2 rounded-lg text-sm transition-colors mb-1 ${a==="dark"?"hover:bg-gray-700":"hover:bg-gray-100"} ${k}`,children:"Всё о задаче"}),r.jsx("button",{onClick:()=>{m(null),n(de.id)},className:`w-full text-left px-3 py-2 rounded-lg text-sm transition-colors ${a==="dark"?"hover:bg-red-500/20 text-red-400":"hover:bg-red-50 text-red-600"}`,children:"Удалить"})]})]})})]})]})})]}),r.jsxs("div",{className:"space-y-1.5 text-xs mb-2",children:[r.jsxs("div",{className:"space-y-1",children:[r.jsxs("div",{className:`flex items-center gap-1 ${a==="dark"?"text-blue-400":"text-blue-600"}`,children:[r.jsx("span",{className:"font-medium",children:"Автор:"}),r.jsx("span",{className:a==="dark"?"text-gray-400":"text-gray-600",children:((lt=$e.find(_e=>_e.id===de.createdBy))==null?void 0:lt.name)||"Неизвестно"})]}),r.jsxs("div",{className:"flex flex-col gap-1",children:[r.jsx("div",{className:"flex items-center gap-1 text-[#4E6E49]",children:r.jsx("span",{className:"font-medium",children:"Исполнители:"})}),Pe.length>0?Pe.map(_e=>r.jsx("div",{className:`text-[11px] sm:text-xs ${a==="dark"?"text-gray-300":"text-gray-700"} flex flex-wrap gap-1`,children:r.jsx("span",{className:"font-medium",children:kt(_e.member.id)})},_e.member.id)):r.jsx("span",{className:"text-gray-500",children:"Не назначены"})]})]}),r.jsxs("div",{className:`flex items-center gap-2 flex-wrap ${a==="dark"?"text-gray-400":"text-gray-600"}`,children:[r.jsxs("span",{className:"inline-flex items-center gap-1",children:[r.jsx(Si,{className:"w-3.5 h-3.5"}),ie(new Date(de.dueDate),"dd.MM.yyyy")]}),r.jsxs("span",{className:"inline-flex items-center gap-1",children:[r.jsx(Ss,{className:"w-3.5 h-3.5"}),de.dueTime]}),r.jsx(W0,{dueDate:de.dueDate,dueTime:de.dueTime,theme:a,size:"compact"})]}),r.jsx("div",{className:"flex items-center gap-1 text-[11px]",children:r.jsx("span",{className:`px-2 py-0.5 rounded-full border ${a==="dark"?"border-yellow-500/40 text-yellow-200 bg-yellow-500/10":"border-yellow-200 text-yellow-700 bg-yellow-50"}`,children:de.priority==="urgent"?"Экстренный приоритет":de.priority==="high"?"Высокий приоритет":de.priority==="medium"?"Средний приоритет":"Низкий приоритет"})}),Te>0&&r.jsxs("div",{className:`flex items-center justify-between gap-2 ${a==="dark"?"text-yellow-300":"text-yellow-700"}`,children:[r.jsxs("span",{className:"inline-flex items-center gap-1",children:[r.jsx(no,{className:"w-3 h-3"}),"Подтверждения исполнителей"]}),r.jsxs("span",{className:"text-[11px] font-semibold",children:[G,"/",Te]})]}),de.description&&r.jsx("p",{className:`line-clamp-2 ${a==="dark"?"text-gray-300":"text-gray-600"}`,children:de.description}),Y.length>0&&r.jsx("div",{className:`mt-1 space-y-1 ${a==="dark"?"text-gray-300":"text-gray-700"}`,children:Y.map(_e=>{const Me=$e.find(ht=>ht.id===_e.userId),ot=_e.status==="approved"?"подтвердил":"в ожидании";return r.jsxs("div",{className:"flex items-center justify-between text-[11px]",children:[r.jsxs("span",{className:"flex items-center gap-1",children:[r.jsxs("span",{className:"font-medium",children:[(Me==null?void 0:Me.name)||_e.userId,ne(de,_e.userId)&&r.jsx("span",{className:"ml-1 text-[10px] px-1 rounded bg-gray-200 dark:bg-gray-800",children:ne(de,_e.userId)})]}),r.jsxs("span",{className:"text-gray-500",children:["(",ot,")"]})]}),_e.comment&&r.jsx("span",{className:"truncate max-w-[140px] text-gray-500",children:_e.comment})]},_e.userId)})}),(((Qe=de.comments)==null?void 0:Qe.length)||((ct=W.comments)==null?void 0:ct.length))&&r.jsx("div",{className:"mt-2 space-y-1",children:[...de.comments||[],...W.comments||[]].map(_e=>{const Me=$e.find(ot=>ot.id===_e.userId);return r.jsxs("div",{className:`text-[11px] ${a==="dark"?"text-gray-300":"text-gray-700"}`,children:[r.jsx("span",{className:"font-semibold",children:(Me==null?void 0:Me.name)||_e.userId})," ",r.jsx("span",{className:"text-gray-500",children:_e.stageId?"(этап)":"(задача)"}),": ",_e.text]},_e.id)})}),r.jsx("div",{className:"flex items-center gap-2 flex-wrap",children:r.jsx("span",{className:`px-1.5 py-0.5 rounded text-xs inline-flex items-center gap-1 ${Z(Q)} ${ye(Q)}`,children:(()=>{const _e=Ro[de.category];return r.jsx(_e,{className:"w-3.5 h-3.5"})})()})})]}),r.jsx("div",{className:"flex justify-end mt-1",children:r.jsx("button",{onClick:()=>D(de),className:`text-[11px] underline ${a==="dark"?"text-gray-300":"text-gray-600"} hover:text-[#4E6E49]`,children:"Всё о задаче"})}),r.jsxs("div",{className:`flex flex-col gap-2 mt-2 pt-2 border-t ${v}`,children:[Ue&&r.jsxs("button",{onClick:()=>oe(de),disabled:A===de.id,className:"w-full px-2 py-1.5 bg-[#4E6E49] hover:bg-emerald-700 text-white rounded-lg text-xs font-medium transition-colors flex items-center justify-center gap-1 disabled:opacity-50",children:[r.jsx(_r,{className:"w-3 h-3"}),"Подтвердить"]}),xe&&r.jsxs("div",{className:"flex gap-2",children:[r.jsxs("button",{onClick:()=>ae(de),disabled:A===de.id,className:"flex-1 px-2 py-1.5 bg-blue-600 hover:bg-blue-700 text-white rounded-lg text-xs font-medium transition-colors flex items-center justify-center gap-1 disabled:opacity-50",children:[r.jsx(_r,{className:"w-3 h-3"}),"Закрыто"]}),r.jsxs("button",{onClick:()=>{f({task:de}),$("")},disabled:A===de.id,className:"flex-1 px-2 py-1.5 bg-red-500 hover:bg-red-600 text-white rounded-lg text-xs font-medium transition-colors flex items-center justify-center gap-1 disabled:opacity-50",children:[r.jsx(Rt,{className:"w-3 h-3"}),"Не выполнено"]})]}),de.status==="completed"&&!xe&&r.jsx("p",{className:`text-[11px] ${a==="dark"?"text-gray-400":"text-gray-500"}`,children:"Ожидает подтверждения автора"})]})]},de.id)}),me.length===0&&r.jsxs("div",{className:`text-center py-6 sm:py-8 ${a==="dark"?"text-gray-500":"text-gray-400"}`,children:[r.jsx(ss,{className:"w-6 h-6 sm:w-8 sm:h-8 mx-auto mb-2 opacity-50"}),r.jsx("p",{className:"text-xs sm:text-sm",children:"Нет задач"})]})]})]},Q)})})}),x&&r.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-start sm:items-center justify-center z-[70] p-4 overflow-y-auto overscroll-contain modal-scroll",children:r.jsxs("div",{className:`${b} rounded-xl p-6 max-w-md w-full border-2 ${v}`,children:[r.jsx("h3",{className:`text-lg font-bold mb-4 ${k}`,children:"Не выполнено"}),r.jsx("textarea",{value:w,onChange:Q=>$(Q.target.value),placeholder:"Опишите, что нужно доработать",rows:3,className:`w-full px-4 py-2 rounded-lg border ${v} ${a==="dark"?"bg-gray-700":"bg-gray-50"} ${k} mb-4 focus:outline-none focus:ring-2 focus:ring-[#4E6E49]/50`}),r.jsxs("div",{className:"flex gap-3",children:[r.jsx("button",{onClick:()=>x.task&&V(x.task,w),disabled:A===x.task.id||!w.trim(),className:"flex-1 px-4 py-2 rounded-lg font-medium transition-colors bg-red-500 hover:bg-red-600 text-white disabled:opacity-50",children:"Отправить на доработку"}),r.jsx("button",{onClick:()=>{f(null),$("")},className:`px-4 py-2 rounded-lg font-medium transition-colors ${a==="dark"?"bg-gray-700 hover:bg-gray-600":"bg-gray-200 hover:bg-gray-300"}`,children:"Отмена"})]})]})}),ee&&r.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-start sm:items-center justify-center z-[70] p-4 overflow-y-auto overscroll-contain modal-scroll",children:r.jsxs("div",{className:`${b} rounded-xl p-6 max-w-2xl w-full border-2 ${v}`,children:[r.jsxs("div",{className:"flex items-center justify-between mb-4",children:[r.jsx("h3",{className:`text-lg font-bold ${k}`,children:"Всё о задаче"}),r.jsx("button",{onClick:()=>D(null),className:`p-2 rounded-lg ${a==="dark"?"hover:bg-gray-700":"hover:bg-gray-100"}`,children:r.jsx(Rt,{className:"w-4 h-4"})})]}),r.jsxs("div",{className:"space-y-4 text-sm",children:[r.jsxs("div",{children:[r.jsx("p",{className:"text-xs text-gray-500",children:"Название"}),r.jsx("p",{className:`font-semibold ${k}`,children:ee.title})]}),ee.description&&r.jsxs("div",{children:[r.jsx("p",{className:"text-xs text-gray-500",children:"Описание"}),r.jsx("p",{className:a==="dark"?"text-gray-300":"text-gray-700",children:ee.description})]}),ee.expectedResult&&r.jsxs("div",{children:[r.jsx("p",{className:"text-xs text-gray-500",children:"Ожидаемый результат"}),r.jsx("p",{className:a==="dark"?"text-gray-300":"text-gray-700",children:ee.expectedResult})]}),r.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[r.jsxs("div",{children:[r.jsx("p",{className:"text-xs text-gray-500",children:"Автор"}),r.jsx("p",{className:k,children:((Ke=$e.find(Q=>Q.id===ee.createdBy))==null?void 0:Ke.name)||ee.createdBy})]}),r.jsxs("div",{children:[r.jsx("p",{className:"text-xs text-gray-500",children:"Категория"}),r.jsx("p",{className:k,children:((We=ya[ee.category])==null?void 0:We.label)||ee.category})]}),r.jsxs("div",{children:[r.jsx("p",{className:"text-xs text-gray-500",children:"Приоритет"}),r.jsx("p",{className:k,children:ee.priority==="urgent"?"Экстренный":ee.priority==="high"?"Высокий":ee.priority==="medium"?"Средний":"Низкий"})]}),r.jsxs("div",{children:[r.jsx("p",{className:"text-xs text-gray-500",children:"Дедлайн"}),r.jsxs("p",{className:k,children:[ie(new Date(ee.dueDate),"dd.MM.yyyy")," · ",ee.dueTime]})]})]}),r.jsxs("div",{children:[r.jsx("p",{className:"text-xs text-gray-500",children:"Статус"}),r.jsx("p",{className:`${k} font-semibold`,children:Gs[ee.status].label})]}),ee.stages&&ee.stages.length>0&&r.jsxs("div",{className:"space-y-2",children:[r.jsx("p",{className:"text-xs text-gray-500",children:"Этапы"}),ee.stages.map(Q=>{var me,Ie;return r.jsxs("div",{className:`p-3 rounded border ${v} space-y-2`,children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsx("p",{className:`font-semibold ${k}`,children:Q.name}),r.jsxs("p",{className:"text-xs text-gray-500",children:[((me=Q.approvals)==null?void 0:me.filter(de=>de.status==="approved").length)||0,"/",((Ie=Q.approvals)==null?void 0:Ie.length)||0," подтверждений"]})]}),Q.assignees&&Q.assignees.length>0&&r.jsx("div",{className:"space-y-1 text-xs",children:Q.assignees.map(de=>{const ze=$e.find(Le=>Le.id===de.userId);return r.jsx("div",{className:"flex items-start justify-between gap-2",children:r.jsx("span",{className:"font-medium",children:(ze==null?void 0:ze.name)||de.userId})},de.userId)})})]},Q.id)})]})]})]})})]})},h4=()=>{var O;const{theme:s}=it(),{user:e}=bt(),[t,n]=E.useState(!1),[a,i]=E.useState(null),[o,c]=E.useState([]),[d,h]=E.useState(!0),[m,x]=E.useState("all"),[f,w]=E.useState("all"),[$,A]=E.useState([]),[T,K]=E.useState("kanban"),P=s==="dark"?"text-white":"text-gray-900",S=s==="dark"?"bg-[#1a1a1a]":"bg-white";E.useEffect(()=>{L()},[e]),E.useEffect(()=>{L()},[m,f,$]);const L=async()=>{h(!0);try{const U={};m!=="all"&&(U.category=m),f!=="all"&&(U.status=f),$.length>0&&(U.assignedTo=$);const J=await sd(U);c(J)}catch(U){console.error("Error loading tasks:",U)}finally{h(!1)}},ee=U=>{i(U),n(!0)},D=async U=>{if(confirm("Вы уверены, что хотите удалить эту задачу?"))try{await U0(U),L()}catch(J){console.error("Error deleting task:",J)}},k=()=>{n(!1),i(null)},b=()=>{n(!1),i(null),L()},v=()=>{x("all"),w("all"),A([])},j=o.filter(U=>!(m!=="all"&&U.category!==m||f!=="all"&&U.status!==f||$.length>0&&!$.some(J=>U.assignedTo.includes(J)))),N={inProgress:o.filter(U=>U.status==="in_progress").length,completed:o.filter(U=>U.status==="completed").length,closed:o.filter(U=>U.status==="closed").length},y=new Date,p=ie(y,"yyyy-MM-dd"),te=new Date(y);te.setDate(y.getDate()-7);const ue=new Date(y);ue.setDate(y.getDate()-30);const le=o.filter(U=>new Date(U.createdAt)>=te).length,H=o.filter(U=>new Date(U.createdAt)>=ue).length,ne=o.filter(U=>U.completedAt&&U.completedAt.startsWith(p)).length,ce=e?o.filter(U=>U.mainExecutor===e.id||U.leadExecutor===e.id||(U.assignedTo||[]).includes(e.id)||(U.coExecutors||[]).includes(e.id)):[],B=ce.length,pe=o.length,F=pe?Math.round(N.inProgress/pe*100):0,q=(()=>{var C;const U={};return o.forEach(oe=>{[oe.mainExecutor,oe.leadExecutor,...oe.assignedTo||[],...oe.coExecutors||[]].filter(Boolean).forEach(V=>{U[V]=(U[V]||0)+1})}),((C=Object.entries(U).sort((oe,ae)=>ae[1]-oe[1])[0])==null?void 0:C[0])||""})(),M=q?((O=$e.find(U=>U.id===q))==null?void 0:O.name)||q:"—",z=o.filter(U=>U.status!=="completed"&&U.status!=="closed").sort((U,J)=>new Date(`${U.dueDate}T${U.dueTime}`).getTime()-new Date(`${J.dueDate}T${J.dueTime}`).getTime())[0],I=[{label:"Всего задач на неделе",value:le,sub:"последние 7 дней",tone:"sky"},{label:"Всего задач на месяце",value:H,sub:"последние 30 дней",tone:"emerald"},{label:"Задач в работе",value:N.inProgress,sub:`${F}% от всех`,tone:"blue"},{label:"Отмечено исполнителями",value:N.completed,sub:"ожидают проверки автора",tone:"amber"},{label:"Самый активный исполнитель",value:M,sub:"по числу назначений",tone:"purple"},{label:"Закрыто автором",value:N.closed,sub:"финально подтверждено",tone:"slate"},{label:"Ближайший дедлайн",value:z?z.title:"Нет активных",sub:z?`${ie(new Date(z.dueDate),"dd.MM.yyyy")} · ${z.dueTime}`:"Свободное окно",tone:"pink"},{label:"Сделано задач за сегодня",value:ne,sub:p,tone:"green"}],R=[{href:"#tasks-board",label:"Все задачи"},{href:"#my-tasks",label:"Мои задачи",action:()=>e&&A([e.id])},{href:"#tasks-stats",label:"Статистика"}];return r.jsxs("div",{className:"space-y-6",children:[r.jsxs("div",{className:`rounded-xl sm:rounded-2xl p-4 sm:p-6 md:p-8 ${S} shadow-xl border-2 ${s==="dark"?"border-[#4E6E49]/30 bg-gradient-to-br from-[#1a1a1a] via-[#1a1a1a] to-[#0A0A0A]":"border-green-200 bg-gradient-to-br from-white via-green-50/30 to-white"} relative overflow-hidden`,children:[r.jsx("div",{className:"absolute top-0 right-0 w-32 h-32 sm:w-64 sm:h-64 bg-gradient-to-br from-[#4E6E49]/10 to-emerald-700/10 rounded-full blur-3xl -mr-16 sm:-mr-32 -mt-16 sm:-mt-32"}),r.jsx("div",{className:"absolute bottom-0 left-0 w-24 h-24 sm:w-48 sm:h-48 bg-gradient-to-tr from-yellow-500/10 to-orange-500/10 rounded-full blur-2xl -ml-12 sm:-ml-24 -mb-12 sm:-mb-24"}),r.jsxs("div",{className:"relative z-10",children:[r.jsx("div",{className:"flex flex-col gap-4 sm:gap-6 lg:flex-row lg:items-start lg:justify-between mb-4 sm:mb-6",children:r.jsxs("div",{className:"flex-1",children:[r.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 mb-2",children:[r.jsx(ss,{className:"w-6 h-6 sm:w-8 sm:h-8 text-[#4E6E49]"}),r.jsxs("h1",{className:`text-2xl sm:text-3xl md:text-4xl font-extrabold ${P} flex items-center gap-2`,children:["Task Team",r.jsx(pr,{className:`w-5 h-5 sm:w-6 sm:h-6 ${s==="dark"?"text-yellow-400":"text-yellow-600"}`})]})]}),r.jsx("p",{className:`text-sm sm:text-base ${s==="dark"?"text-gray-300":"text-gray-600"}`,children:"Управление задачами и заданиями команды"}),r.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:R.map(U=>r.jsx("a",{href:U.href,onClick:()=>{var J;return(J=U.action)==null?void 0:J.call(U)},className:`px-3 py-1.5 rounded-lg text-xs font-semibold border transition ${s==="dark"?"border-white/10 bg-white/5 text-white hover:border-[#4E6E49]/50":"border-gray-200 bg-white text-gray-800 hover:border-[#4E6E49]/50 hover:text-[#4E6E49]"}`,children:U.label},U.href))})]})}),r.jsx("div",{id:"tasks-stats",className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3 sm:gap-4",children:I.map(U=>{const C={emerald:{bg:s==="dark"?"bg-emerald-500/10":"bg-emerald-50",text:s==="dark"?"text-emerald-100":"text-emerald-800",border:s==="dark"?"border-emerald-500/30":"border-emerald-200"},sky:{bg:s==="dark"?"bg-sky-500/10":"bg-sky-50",text:s==="dark"?"text-sky-100":"text-sky-800",border:s==="dark"?"border-sky-500/30":"border-sky-200"},amber:{bg:s==="dark"?"bg-amber-500/10":"bg-amber-50",text:s==="dark"?"text-amber-100":"text-amber-800",border:s==="dark"?"border-amber-500/30":"border-amber-200"},blue:{bg:s==="dark"?"bg-blue-500/10":"bg-blue-50",text:s==="dark"?"text-blue-100":"text-blue-800",border:s==="dark"?"border-blue-500/30":"border-blue-200"},purple:{bg:s==="dark"?"bg-purple-500/10":"bg-purple-50",text:s==="dark"?"text-purple-100":"text-purple-800",border:s==="dark"?"border-purple-500/30":"border-purple-200"},slate:{bg:s==="dark"?"bg-gray-500/10":"bg-gray-50",text:s==="dark"?"text-gray-100":"text-gray-800",border:s==="dark"?"border-gray-500/30":"border-gray-200"},pink:{bg:s==="dark"?"bg-pink-500/10":"bg-pink-50",text:s==="dark"?"text-pink-100":"text-pink-800",border:s==="dark"?"border-pink-500/30":"border-pink-200"},green:{bg:s==="dark"?"bg-green-500/10":"bg-green-50",text:s==="dark"?"text-green-100":"text-green-800",border:s==="dark"?"border-green-500/30":"border-green-200"}}[U.tone];return r.jsxs("div",{className:`p-4 rounded-xl border ${C.border} ${C.bg} shadow-sm space-y-1`,children:[r.jsx("p",{className:`text-xs font-semibold uppercase ${C.text}`,children:U.label}),r.jsx("p",{className:`text-2xl font-extrabold ${P} truncate`,children:U.value}),r.jsx("p",{className:`text-xs ${s==="dark"?"text-gray-400":"text-gray-600"}`,children:U.sub})]},U.label)})})]})]}),e&&r.jsxs("div",{id:"my-tasks",className:`rounded-xl sm:rounded-2xl p-4 sm:p-6 ${S} border-2 ${s==="dark"?"border-white/10":"border-gray-200"}`,children:[r.jsxs("div",{className:"flex items-center justify-between gap-3 mb-3",children:[r.jsxs("div",{children:[r.jsx("p",{className:`text-xs uppercase font-semibold ${s==="dark"?"text-gray-400":"text-gray-500"}`,children:"Мои задачи"}),r.jsx("p",{className:`text-xl font-bold ${P}`,children:B})]}),r.jsx("a",{href:"#tasks-board",className:`px-3 py-2 rounded-lg text-xs font-semibold border ${s==="dark"?"border-white/10 bg-white/5 text-white hover:border-[#4E6E49]/50":"border-gray-200 bg-white text-gray-800 hover:border-[#4E6E49]/50 hover:text-[#4E6E49]"}`,children:"Перейти на доску"})]}),ce.length===0?r.jsx("p",{className:s==="dark"?"text-gray-400":"text-gray-600",children:"Нет назначенных задач"}):r.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:ce.slice(0,4).map(U=>r.jsxs("div",{className:`p-3 rounded-lg border ${s==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white"}`,children:[r.jsx("p",{className:`text-sm font-semibold ${P} truncate`,children:U.title}),r.jsxs("p",{className:`text-xs ${s==="dark"?"text-gray-400":"text-gray-600"}`,children:[ie(new Date(U.dueDate),"dd.MM.yyyy")," · ",U.dueTime]}),r.jsx("p",{className:"text-xs mt-1",children:r.jsx("span",{className:`px-2 py-0.5 rounded-full ${s==="dark"?"bg-gray-800 text-gray-200":"bg-gray-100 text-gray-700"}`,children:Gs[U.status].label})})]},U.id))})]}),r.jsxs("div",{className:"flex flex-col lg:flex-row gap-4 sm:gap-6",id:"tasks-board",children:[r.jsx("div",{className:"lg:w-80 flex-shrink-0",children:r.jsx(d4,{selectedCategory:m,selectedStatus:f,selectedUsers:$,onCategoryChange:x,onStatusChange:w,onUsersChange:A,onClear:v})}),r.jsxs("div",{className:"flex-1",children:[r.jsxs("div",{className:"flex items-center justify-between mb-4 gap-3",children:[r.jsxs("h2",{className:`text-xl font-bold ${P}`,children:["Задачи (",j.length,")"]}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsxs("div",{className:`flex rounded-lg border-2 ${s==="dark"?"border-gray-800":"border-gray-300"} overflow-hidden`,children:[r.jsx("button",{onClick:()=>K("kanban"),className:`px-3 py-2 transition-colors ${T==="kanban"?"bg-[#4E6E49] text-white":s==="dark"?"bg-[#1a1a1a] text-gray-300 hover:bg-gray-700":"bg-white text-gray-700 hover:bg-gray-50"}`,title:"Kanban доска",children:r.jsx(wx,{className:"w-4 h-4"})}),r.jsx("button",{onClick:()=>K("list"),className:`px-3 py-2 transition-colors ${T==="list"?"bg-[#4E6E49] text-white":s==="dark"?"bg-[#1a1a1a] text-gray-300 hover:bg-gray-700":"bg-white text-gray-700 hover:bg-gray-50"}`,title:"Список",children:r.jsx(kx,{className:"w-4 h-4"})})]}),r.jsxs("button",{onClick:()=>n(!0),className:"px-4 py-2 bg-gradient-to-r from-[#4E6E49] to-emerald-700 hover:from-[#4E6E49] hover:to-emerald-700 text-white rounded-lg font-semibold transition-all shadow-lg hover:shadow-xl transform hover:scale-105 flex items-center gap-2",children:[r.jsx(os,{className:"w-5 h-5"}),r.jsx("span",{className:"hidden sm:inline",children:"Новая задача"}),r.jsx("span",{className:"sm:hidden",children:"Добавить"})]})]})]}),d?r.jsx("div",{className:`${S} rounded-xl p-8 text-center ${P}`,children:r.jsx("div",{className:"animate-pulse",children:"Загрузка..."})}):j.length===0?r.jsxs("div",{className:`${S} rounded-xl p-8 text-center border-2 ${s==="dark"?"border-gray-800":"border-gray-300"}`,children:[r.jsx(ss,{className:`w-12 h-12 mx-auto mb-4 ${s==="dark"?"text-gray-600":"text-gray-400"}`}),r.jsx("p",{className:`text-lg font-medium ${P} mb-2`,children:"Нет задач"}),r.jsx("p",{className:`text-sm ${s==="dark"?"text-gray-400":"text-gray-600"}`,children:m!=="all"||f!=="all"||$.length>0?"Попробуйте изменить фильтры":"Создайте первую задачу"})]}):T==="kanban"?r.jsx(u4,{tasks:j,onUpdate:L,onEdit:ee,onDelete:D}):r.jsx("div",{className:"grid grid-cols-1 gap-4 sm:gap-6",children:j.map(U=>r.jsx(c4,{task:U,onEdit:ee,onDelete:D,onUpdate:L},U.id))})]})]}),t&&r.jsx(n4,{onClose:k,onSave:b,editingTask:a})]})},m4=()=>{const{theme:s}=it(),{isAdmin:e}=_t(),t=s==="dark"?"text-white":"text-gray-900",n=s==="dark"?"text-gray-300":"text-gray-700",a=s==="dark"?"bg-[#1a1a1a]":"bg-white";return e?r.jsxs("div",{className:"space-y-6",children:[r.jsxs("div",{className:`rounded-2xl p-6 ${a} shadow-lg border-2 ${s==="dark"?"border-purple-500/30 bg-gradient-to-br from-[#1a1a1a] to-[#1a1a1a]/90":"border-purple-200 bg-gradient-to-br from-white to-purple-50/30"}`,children:[r.jsxs("div",{className:"flex items-start gap-4 mb-6",children:[r.jsx("div",{className:`p-3 rounded-xl ${s==="dark"?"bg-purple-500/20":"bg-purple-100"}`,children:r.jsx(At,{className:`w-8 h-8 ${s==="dark"?"text-purple-400":"text-purple-600"}`})}),r.jsxs("div",{className:"flex-1",children:[r.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[r.jsx("h1",{className:`text-3xl font-bold bg-gradient-to-r ${s==="dark"?"from-purple-400 to-pink-400 text-transparent bg-clip-text":"from-purple-600 to-pink-600 text-transparent bg-clip-text"}`,children:"Панель администратора"}),r.jsx(pr,{className:`w-5 h-5 ${s==="dark"?"text-yellow-400":"text-yellow-500"} animate-pulse`})]}),r.jsxs("p",{className:`${n} text-sm flex items-center gap-2`,children:[r.jsx(wa,{className:"w-4 h-4"}),"Управление системой и командой ApeVault"]})]})]}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-6",children:[r.jsxs("div",{className:`p-4 rounded-xl border-2 ${s==="dark"?"bg-blue-500/10 border-blue-500/30":"bg-blue-50 border-blue-200"}`,children:[r.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[r.jsx("div",{className:`p-2 rounded-lg ${s==="dark"?"bg-blue-500/20":"bg-blue-100"}`,children:r.jsx(At,{className:`w-5 h-5 ${s==="dark"?"text-blue-400":"text-blue-600"}`})}),r.jsx("h3",{className:`font-semibold ${t}`,children:"Доступ к функциям"})]}),r.jsx("p",{className:`text-sm ${n}`,children:"В режиме администратора вы можете управлять слотами, статусами и заработком всех участников команды"})]}),r.jsxs("div",{className:"p-4 rounded-xl border-2 bg-[#4E6E49]/10 border-[#4E6E49]/30",children:[r.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[r.jsx("div",{className:`p-2 rounded-lg ${s==="dark"?"bg-[#4E6E49]/20":"bg-green-100"}`,children:r.jsx(yx,{className:"w-5 h-5 text-[#4E6E49]"})}),r.jsx("h3",{className:`font-semibold ${t}`,children:"Безопасность"})]}),r.jsx("p",{className:`text-sm ${n}`,children:"Режим администратора требует ввода пароля. Не делитесь паролем с другими участниками"})]})]}),r.jsx("div",{className:`pt-4 border-t ${s==="dark"?"border-gray-800":"border-gray-200"}`,children:r.jsxs("div",{className:`flex items-center gap-3 p-4 rounded-xl ${s==="dark"?"bg-[#4E6E49]/20 border-2 border-[#4E6E49]/50":"bg-green-50 border-2 border-green-200"}`,children:[r.jsx("div",{className:`p-2 rounded-lg ${s==="dark"?"bg-[#4E6E49]/30":"bg-green-100"}`,children:r.jsx(At,{className:"w-6 h-6 text-[#4E6E49]"})}),r.jsxs("div",{children:[r.jsx("h3",{className:`font-semibold mb-1 ${t}`,children:"Режим администратора активен"}),r.jsx("p",{className:`text-sm ${n}`,children:"Вы вошли в систему как администратор. Все административные функции доступны."})]})]})})]}),r.jsxs("div",{className:`rounded-2xl p-6 ${a} shadow-lg border-2 ${s==="dark"?"border-gray-800":"border-gray-200"}`,children:[r.jsx("h2",{className:`text-xl font-semibold mb-4 ${t}`,children:"Возможности администратора"}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[r.jsxs("div",{className:`p-4 rounded-xl border ${s==="dark"?"border-gray-800 bg-gray-700/30":"border-gray-200 bg-gray-50"}`,children:[r.jsx("h3",{className:`font-semibold mb-2 ${t}`,children:"📅 Управление слотами"}),r.jsxs("ul",{className:`text-sm space-y-1 ${n} list-disc list-inside`,children:[r.jsx("li",{children:"Создание слотов для любого участника"}),r.jsx("li",{children:"Массовое создание слотов"}),r.jsx("li",{children:"Удаление слотов любого участника"}),r.jsx("li",{children:"Массовое удаление слотов"})]})]}),r.jsxs("div",{className:`p-4 rounded-xl border ${s==="dark"?"border-gray-800 bg-gray-700/30":"border-gray-200 bg-gray-50"}`,children:[r.jsx("h3",{className:`font-semibold mb-2 ${t}`,children:"📋 Управление статусами"}),r.jsxs("ul",{className:`text-sm space-y-1 ${n} list-disc list-inside`,children:[r.jsx("li",{children:"Установка выходных, больничных и отпуск"}),r.jsx("li",{children:"Массовое управление статусами"}),r.jsx("li",{children:"Удаление статусов любого участника"})]})]}),r.jsxs("div",{className:`p-4 rounded-xl border ${s==="dark"?"border-gray-800 bg-gray-700/30":"border-gray-200 bg-gray-50"}`,children:[r.jsx("h3",{className:`font-semibold mb-2 ${t}`,children:"💰 Управление заработком"}),r.jsxs("ul",{className:`text-sm space-y-1 ${n} list-disc list-inside`,children:[r.jsx("li",{children:"Добавление заработка за любую дату"}),r.jsx("li",{children:"Редактирование записей о заработке"}),r.jsx("li",{children:"Удаление записей о заработке"})]})]}),r.jsxs("div",{className:`p-4 rounded-xl border ${s==="dark"?"border-gray-800 bg-gray-700/30":"border-gray-200 bg-gray-50"}`,children:[r.jsx("h3",{className:`font-semibold mb-2 ${t}`,children:"📊 Дополнительно"}),r.jsxs("ul",{className:`text-sm space-y-1 ${n} list-disc list-inside`,children:[r.jsx("li",{children:"Удаление сообщений из подсчета"}),r.jsx("li",{children:"Полный доступ ко всем функциям"}),r.jsx("li",{children:"Просмотр и управление данными команды"})]})]})]})]})]}):r.jsx("div",{className:`rounded-2xl p-8 ${a} shadow-xl border-2 ${s==="dark"?"border-red-500/30 bg-gradient-to-br from-[#1a1a1a] to-[#0A0A0A]":"border-red-200 bg-gradient-to-br from-white to-red-50/20"} relative overflow-hidden`,children:r.jsxs("div",{className:"text-center",children:[r.jsx("div",{className:`inline-flex p-4 rounded-2xl mb-4 ${s==="dark"?"bg-red-500/20":"bg-red-100"}`,children:r.jsx(wa,{className:`w-12 h-12 ${s==="dark"?"text-red-400":"text-red-600"}`})}),r.jsx("h2",{className:`text-2xl font-bold mb-2 ${t}`,children:"Доступ запрещен"}),r.jsx("p",{className:n,children:'Эта страница доступна только администраторам. Для входа используйте режим "Админ" на странице входа.'})]})})},g4=()=>{var ae;const{theme:s}=it(),{user:e,logout:t}=bt(),{isAdmin:n,deactivateAdmin:a}=_t(),i=Vh(),[o,c]=E.useState(!1),[d,h]=E.useState(!1),[m,x]=E.useState([]),[f,w]=E.useState(null),[$,A]=E.useState(null),[T,K]=E.useState(null),[P,S]=E.useState([]),[L,ee]=E.useState({id:"",userId:"",title:"",text:"",priority:"medium",createdAt:"",updatedAt:""}),[D,k]=E.useState(!0),[b,v]=E.useState(!1),[j,N]=E.useState(""),[y,p]=E.useState(!1),[te,ue]=E.useState(!1),le=Io((e==null?void 0:e.id)||""),H=e||(n?{name:"Администратор",login:"admin",password:Ql}:null),ne=e!=null&&e.id?(ae=$e.find(V=>V.id===e.id))==null?void 0:ae.avatar:void 0,ce=H!=null&&H.name?H.name.charAt(0).toUpperCase():"A",B=s==="dark"?"text-white":"text-gray-900";E.useEffect(()=>{(e||n)&&pe()},[e,n]);const pe=async()=>{if(!(!e&&!n)){k(!0);try{const V=(e==null?void 0:e.id)||"admin",Z=await sd({assignedTo:V});if(x(Z),e){const ye=Gn(),we=ie(ye.start,"yyyy-MM-dd"),Ke=ie(ye.end,"yyyy-MM-dd"),We=Xi(30),Q=ie(We.start,"yyyy-MM-dd"),me=ie(We.end,"yyyy-MM-dd"),Ie=We.start.toISOString(),de=We.end.toISOString(),ze=Xi(90),Le=ie(ze.start,"yyyy-MM-dd"),W=ie(ze.end,"yyyy-MM-dd"),Ne=await Ca(V,we,Ke),Pe=Ne.reduce((be,je)=>{const rt=je.participants&&je.participants.length>0?je.participants.length:1;return be+je.amount/rt},0),Y=Ne.reduce((be,je)=>{const rt=je.participants&&je.participants.length>0?je.participants.length:1;return be+je.poolAmount/rt},0),G=await Ca(V,Q,me),Te=G.reduce((be,je)=>{const rt=je.participants&&je.participants.length>0?je.participants.length:1;return be+je.amount/rt},0),Re=G.reduce((be,je)=>{const rt=je.participants&&je.participants.length>0?je.participants.length:1;return be+je.poolAmount/rt},0),Ue=await is(V),xe=Ue.filter(be=>{const je=be.date,rt=be.endDate||be.date;return je<=me&&rt>=Q}),lt=xe.filter(be=>be.type==="dayoff").reduce((be,je)=>be+or(je.date,je.endDate,Q,me),0),Qe=xe.filter(be=>be.type==="sick").reduce((be,je)=>be+or(je.date,je.endDate,Q,me),0),ct=xe.filter(be=>be.type==="vacation").reduce((be,je)=>be+or(je.date,je.endDate,Q,me),0),_e=xe.filter(be=>be.type==="absence").reduce((be,je)=>be+or(je.date,je.endDate,Q,me),0),Me=Ue.filter(be=>{const je=be.date,rt=be.endDate||be.date;return je<=Ke&&rt>=we}),ot=Me.filter(be=>be.type==="dayoff").reduce((be,je)=>be+or(je.date,je.endDate,we,Ke),0),ht=Me.filter(be=>be.type==="sick").reduce((be,je)=>be+or(je.date,je.endDate,we,Ke),0),Kt=Ue.filter(be=>{const je=be.date,rt=be.endDate||be.date;return je<=W&&rt>=Le}).filter(be=>be.type==="vacation").reduce((be,je)=>be+or(je.date,je.endDate,Le,W),0),Oe=(await wr(V)).filter(be=>be.date>=we&&be.date<=Ke).reduce((be,je)=>be+To(je.slots),0),ve=(await M0(V))[0]||{userId:V,earnings:0,messages:0,initiatives:0,signals:0,profitableSignals:0,referrals:0,daysOff:0,sickDays:0,vacationDays:0,absenceDays:0,poolAmount:0,rating:0,lastUpdated:new Date().toISOString()},Fe=(await V0(void 0,Ie,de)).filter(be=>be.ownerId===V).length,Je={userId:V,earnings:Te,messages:ve.messages||0,initiatives:ve.initiatives||0,signals:ve.signals||0,profitableSignals:ve.profitableSignals||0,referrals:Fe,daysOff:lt,sickDays:Qe,vacationDays:ct,absenceDays:_e,poolAmount:Re,lastUpdated:new Date().toISOString()};console.log("Profile.tsx calculateRating call for user:",V,{weeklyHours:Oe,weeklyEarnings:Pe,weeklyDaysOff:ot,weeklySickDays:ht,ninetyDayVacationDays:Kt,updatedData:Je});const Ze=q0(Je,Oe,Pe,ot,ht,Kt),tt=z0(Je,Oe,Pe,ot,ht,Kt);w({...Je,rating:Ze}),A(tt),K({total:Te,pool:Re,net:Math.max(0,Te-Re),weekly:{gross:Pe,pool:Y,net:Math.max(0,Pe-Y)}});const Ye=e!=null&&e.id?`notes-cache-${e.id}`:null,Xe=be=>{if(Ye)try{localStorage.setItem(Ye,JSON.stringify(be))}catch(je){console.error("Error caching notes locally",je)}};try{if(e){const be=await Eh(e.id,n);S(be),Xe(be)}else if(n){const be=await Eh(void 0,!0);S(be),Xe(be)}}catch(be){if(console.error("Error loading notes",be),Ye)try{const je=localStorage.getItem(Ye);if(je){const rt=JSON.parse(je);S(rt)}}catch(je){console.error("Error loading cached notes",je)}}}}catch(V){console.error("Error loading profile data:",V)}finally{k(!1)}}},F=async()=>{if(!(e!=null&&e.id)||!L.title.trim()&&!L.text.trim())return;const V=e!=null&&e.id?`notes-cache-${e.id}`:null,Z=ye=>{if(V)try{localStorage.setItem(V,JSON.stringify(ye))}catch(we){console.error("Error caching notes locally",we)}};try{if(L.id){await bj(L.id,{title:L.title,text:L.text,priority:L.priority});const ye=P.map(we=>we.id===L.id?{...we,title:L.title,text:L.text,priority:L.priority,updatedAt:new Date().toISOString()}:we);S(ye),Z(ye)}else{const ye=await fj({userId:e.id,title:L.title,text:L.text,priority:L.priority}),we=new Date().toISOString(),Ke=[{id:ye,userId:e.id,title:L.title,text:L.text,priority:L.priority,createdAt:we,updatedAt:we},...P];S(Ke),Z(Ke)}}catch(ye){console.error("Error saving note",ye)}finally{ee({id:"",userId:"",title:"",text:"",priority:"medium",createdAt:"",updatedAt:""})}},q=V=>{const Z=P.find(ye=>ye.id===V);Z&&ee(Z)},M=async V=>{const Z=e!=null&&e.id?`notes-cache-${e.id}`:null,ye=we=>{if(Z)try{localStorage.setItem(Z,JSON.stringify(we))}catch(Ke){console.error("Error caching notes locally",Ke)}};try{await yj(V);const we=P.filter(Ke=>Ke.id!==V);S(we),ye(we),L.id===V&&ee({id:"",userId:"",title:"",text:"",priority:"medium",createdAt:"",updatedAt:""})}catch(we){console.error("Error deleting note",we)}},z=()=>{n&&a(),t(),i("/login")},I=()=>{e!=null&&e.password&&(navigator.clipboard.writeText(e.password),h(!0),setTimeout(()=>h(!1),2e3))},R=()=>{const V=H==null?void 0:H.login;V&&(navigator.clipboard.writeText(V),v(!0),setTimeout(()=>v(!1),2e3))},O=async()=>{if(!(e!=null&&e.id)||!j.trim())return;const V=j.trim(),Z=le||"";if(V===Z){p(!1),N("");return}ue(!0);try{const ye=await $o(e.id);await Nt({entity:"login",action:"update",authorId:e.id,targetUserId:e.id,before:ye||{id:"",userId:e.id,nickname:Z,createdAt:"",updatedAt:""},after:{id:"",userId:e.id,nickname:V,createdAt:"",updatedAt:""},comment:`Запрос на изменение ника с "${Z}" на "${V}"`}),p(!1),N(""),alert("Запрос на изменение ника отправлен на согласование администратору")}catch(ye){console.error("Error requesting nickname change:",ye),alert("Ошибка при отправке запроса на изменение ника")}finally{ue(!1)}},U=m.filter(V=>V.status==="in_progress").length,J=m.filter(V=>V.status==="completed").length,C=m.filter(V=>V.status==="closed").length,oe={in_progress:{label:"В работе",classes:s==="dark"?"bg-blue-500/15 text-blue-100 border-blue-500/30":"bg-blue-50 text-blue-900 border-blue-200"},completed:{label:"Выполнена",classes:s==="dark"?"bg-emerald-500/15 text-emerald-50 border-emerald-500/30":"bg-emerald-50 text-emerald-900 border-emerald-200"},closed:{label:"Закрыта",classes:s==="dark"?"bg-gray-600/20 text-gray-100 border-gray-500/40":"bg-gray-50 text-gray-800 border-gray-200"}};return H?r.jsxs("div",{className:"space-y-6",children:[r.jsx("div",{className:`rounded-2xl p-6 border ${s==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white"} shadow-lg`,children:r.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4",children:[r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx("div",{className:"relative w-12 h-12 rounded-xl overflow-hidden shadow-lg border border-white/50 dark:border-white/10 bg-gradient-to-br from-[#4E6E49]/15 to-emerald-200/40 flex items-center justify-center",children:ne?r.jsx("img",{src:ne,alt:H.name,className:"w-full h-full object-cover",onError:V=>{const Z=V.target;Z.style.display="none"}}):r.jsx("span",{className:"text-lg font-extrabold text-[#4E6E49]",children:ce})}),r.jsxs("div",{children:[r.jsx("p",{className:`text-xs uppercase tracking-[0.14em] ${s==="dark"?"text-gray-400":"text-gray-500"}`,children:"ApeVault Black Ops"}),r.jsx("h1",{className:`text-2xl sm:text-3xl font-extrabold ${B}`,children:"Личный кабинет"}),r.jsx("p",{className:`text-sm ${s==="dark"?"text-gray-300":"text-gray-600"}`,children:"Закрытый контур. Ваши данные и показатели."})]})]}),r.jsxs("div",{className:"flex flex-wrap gap-2",children:[r.jsxs("div",{className:"pill","data-active":"true",children:[r.jsx(Ys,{className:"w-4 h-4"}),r.jsx("span",{children:H.name})]}),n&&r.jsxs("div",{className:"pill","data-active":"true",children:[r.jsx(At,{className:"w-4 h-4"}),r.jsx("span",{children:"Администратор"})]}),r.jsxs("div",{className:"pill","data-active":"false",children:[r.jsx(ss,{className:"w-4 h-4"}),r.jsxs("span",{children:[m.length," задач"]})]}),f&&r.jsxs("div",{className:"pill","data-active":"false",children:[r.jsx(qt,{className:"w-4 h-4"}),r.jsxs("span",{children:[f.rating.toFixed(1),"%"]})]}),r.jsxs($r,{to:"/rules",className:"inline-flex items-center gap-2 px-3 py-2 rounded-xl bg-gradient-to-r from-[#4E6E49] to-emerald-600 text-white text-sm font-semibold shadow-md hover:shadow-lg hover:-translate-y-0.5 transition-all",children:[r.jsx(In,{className:"w-4 h-4"}),"Ознакомиться с правилами"]})]})]})}),D?r.jsx("div",{className:`rounded-xl p-8 text-center ${s==="dark"?"bg-white/5 text-white":"bg-white text-gray-800"} shadow`,children:"Загрузка..."}):r.jsxs("div",{className:"space-y-5",children:[r.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-[1.05fr_0.95fr] gap-4 items-stretch",children:[r.jsxs("div",{className:"space-y-4 flex flex-col",children:[r.jsxs("div",{className:`rounded-2xl p-5 border ${s==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white"} shadow flex-1`,children:[r.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[r.jsx("div",{className:`p-2.5 rounded-xl ${s==="dark"?"bg-blue-500/15 text-blue-200":"bg-blue-50 text-blue-700"}`,children:r.jsx(Ys,{className:"w-5 h-5"})}),r.jsxs("div",{children:[r.jsx("h2",{className:`text-lg font-bold ${B}`,children:"Профиль"}),r.jsx("p",{className:`text-xs ${s==="dark"?"text-gray-400":"text-gray-500"}`,children:"Доступ и учетные данные"})]})]}),r.jsxs("div",{className:"grid sm:grid-cols-2 gap-3",children:[r.jsxs("div",{className:`p-4 rounded-xl border ${s==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white"} shadow-sm`,children:[r.jsx("p",{className:`text-xs font-semibold uppercase tracking-wide ${s==="dark"?"text-gray-400":"text-gray-500"}`,children:"Имя"}),r.jsx("p",{className:`mt-1 text-lg font-bold ${B}`,children:H.name})]}),r.jsxs("div",{className:`p-4 rounded-xl border ${s==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white"} shadow-sm`,children:[r.jsxs("div",{className:"flex items-center justify-between mb-1",children:[r.jsx("p",{className:`text-xs font-semibold uppercase tracking-wide ${s==="dark"?"text-gray-400":"text-gray-500"}`,children:"Ник"}),!y&&e&&!n&&r.jsxs("button",{onClick:async()=>{p(!0),N(le||"")},className:`text-xs px-2 py-1 rounded-lg border transition ${s==="dark"?"border-white/10 bg-white/5 hover:border-white/30 text-white":"border-gray-200 bg-white hover:border-gray-300 text-gray-700"}`,children:[r.jsx(Go,{className:"w-3 h-3 inline mr-1"}),"Изменить"]})]}),y?r.jsxs("div",{className:"space-y-2 mt-1",children:[r.jsx("input",{type:"text",value:j,onChange:V=>N(V.target.value),placeholder:"Введите новый ник",className:`w-full px-3 py-2 rounded-lg border ${s==="dark"?"border-white/10 bg-white/5 text-white":"border-gray-200 bg-white text-gray-900"} text-sm`,disabled:te}),r.jsxs("div",{className:"flex gap-2",children:[r.jsx("button",{onClick:O,disabled:te||!j.trim(),className:`px-3 py-1.5 rounded-lg text-xs font-semibold transition ${te||!j.trim()?"opacity-50 cursor-not-allowed":"bg-[#4E6E49] text-white hover:bg-[#3d5639]"}`,children:te?"Отправка...":"Отправить на согласование"}),r.jsx("button",{onClick:()=>{p(!1),N("")},disabled:te,className:`px-3 py-1.5 rounded-lg text-xs font-semibold border transition ${s==="dark"?"border-white/10 bg-white/5 hover:border-white/30 text-white":"border-gray-200 bg-white hover:border-gray-300 text-gray-700"}`,children:"Отмена"})]}),r.jsx("p",{className:`text-xs ${s==="dark"?"text-gray-400":"text-gray-500"}`,children:"Изменение ника требует согласования администратора"})]}):r.jsx("div",{className:"flex items-center gap-2 mt-1",children:r.jsx("p",{className:`text-lg font-bold ${B}`,children:e!=null&&e.id?r.jsx(Ls,{userId:e.id}):"—"})})]}),r.jsxs("div",{className:`p-4 rounded-xl border ${s==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white"} shadow-sm`,children:[r.jsx("p",{className:`text-xs font-semibold uppercase tracking-wide ${s==="dark"?"text-gray-400":"text-gray-500"}`,children:"Логин"}),r.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[r.jsx("p",{className:`text-lg font-bold ${B}`,children:H.login}),r.jsx("button",{onClick:R,className:`p-2 rounded-lg border transition ${b?"bg-[#4E6E49] text-white border-[#4E6E49]":s==="dark"?"border-white/10 bg-white/5 hover:border-white/30":"border-gray-200 bg-white hover:border-gray-300"}`,title:"Скопировать логин",children:b?r.jsx(_r,{className:"w-4 h-4"}):r.jsx(va,{className:"w-4 h-4"})})]})]})]}),r.jsxs("div",{className:"mt-4 space-y-2",children:[r.jsx("label",{className:`text-sm font-semibold ${s==="dark"?"text-gray-300":"text-gray-700"} block`,children:"Пароль"}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("div",{className:`flex-1 px-4 py-3 rounded-lg border ${s==="dark"?"border-white/10 bg-white/5 text-white":"border-gray-200 bg-white text-gray-900"} font-mono text-sm`,children:o?H.password:"•".repeat(H.password.length)}),r.jsx("button",{onClick:()=>c(!o),className:`p-3 rounded-lg border ${s==="dark"?"border-white/10 bg-white/5 hover:border-white/30":"border-gray-200 bg-white hover:border-gray-300"} transition`,title:o?"Скрыть пароль":"Показать пароль",children:o?r.jsx(Kh,{className:"w-5 h-5"}):r.jsx(Ai,{className:"w-5 h-5"})}),r.jsx("button",{onClick:I,className:`p-3 rounded-lg border transition ${d?"bg-[#4E6E49] text-white border-[#4E6E49]":s==="dark"?"border-white/10 bg-white/5 hover:border-white/30":"border-gray-200 bg-white hover:border-gray-300"}`,title:"Скопировать пароль",children:d?r.jsx(_r,{className:"w-5 h-5"}):r.jsx(va,{className:"w-5 h-5"})})]})]}),r.jsx("div",{className:"mt-4 grid gap-3 sm:grid-cols-1",children:r.jsxs("div",{className:`p-4 rounded-xl border ${s==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white"} shadow-sm`,children:[r.jsx("p",{className:`text-xs font-semibold uppercase tracking-wide ${s==="dark"?"text-gray-400":"text-gray-500"}`,children:"Учебная панель (преподаватель)"}),r.jsxs("div",{className:"mt-2 space-y-2 text-sm",children:[r.jsxs("div",{className:`${s==="dark"?"text-gray-300":"text-gray-700"}`,children:[r.jsx("span",{className:"font-semibold",children:"Имя: "}),r.jsx("span",{className:"font-medium",children:"в разработке"})]}),r.jsxs("div",{className:`${s==="dark"?"text-gray-300":"text-gray-700"}`,children:[r.jsx("span",{className:"font-semibold",children:"Логин: "}),r.jsx("span",{className:"font-medium",children:"в разработке"})]}),r.jsxs("div",{className:`${s==="dark"?"text-gray-300":"text-gray-700"}`,children:[r.jsx("span",{className:"font-semibold",children:"Пароль: "}),r.jsx("span",{className:"font-medium",children:"в разработке"})]})]})]})})]}),r.jsxs("div",{className:`rounded-2xl p-5 border ${s==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white"} shadow flex-1`,children:[r.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[r.jsx("div",{className:`p-2.5 rounded-xl ${s==="dark"?"bg-green-500/15 text-green-200":"bg-green-50 text-[#4E6E49]"}`,children:r.jsx(ss,{className:"w-5 h-5"})}),r.jsxs("div",{children:[r.jsx("h2",{className:`text-lg font-bold ${B}`,children:"Мои задачи"}),r.jsx("p",{className:`text-xs ${s==="dark"?"text-gray-400":"text-gray-500"}`,children:"Сводка по статусам"})]})]}),r.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-3 mb-4",children:[{label:"В работе",value:U,classes:s==="dark"?"bg-blue-500/15 border-blue-500/30 text-blue-100":"bg-blue-50 border-blue-200 text-blue-900"},{label:"Выполнено",value:J,classes:s==="dark"?"bg-emerald-500/15 border-emerald-500/30 text-emerald-50":"bg-emerald-50 border-emerald-200 text-emerald-900"},{label:"Закрыто",value:C,classes:s==="dark"?"bg-gray-600/20 border-gray-500/40 text-gray-100":"bg-gray-50 border-gray-200 text-gray-800"},{label:"Всего",value:m.length,classes:s==="dark"?"bg-gray-600/20 border-gray-500/40 text-gray-100":"bg-gray-50 border-gray-200 text-gray-800"}].map(({label:V,value:Z,classes:ye})=>r.jsxs("div",{className:`p-4 rounded-xl border shadow-sm transition-all hover:translate-y-[-2px] ${ye}`,children:[r.jsx("div",{className:"text-xs font-semibold mb-2 opacity-80",children:V}),r.jsx("div",{className:`text-3xl font-extrabold ${B}`,children:Z})]},V))}),m.length>0&&r.jsxs("div",{className:"space-y-2 mb-4",children:[r.jsx("p",{className:`text-sm font-semibold ${s==="dark"?"text-gray-200":"text-gray-800"}`,children:"Активные задачи"}),r.jsx("div",{className:"space-y-2",children:m.slice(0,3).map(V=>r.jsxs("div",{className:`p-3 rounded-lg border ${s==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-gray-50"} shadow-sm`,children:[r.jsxs("div",{className:"flex items-start justify-between gap-2",children:[r.jsxs("div",{className:"min-w-0",children:[r.jsx("p",{className:`text-sm font-semibold ${B} truncate`,children:V.title}),r.jsxs("p",{className:`text-xs ${s==="dark"?"text-gray-400":"text-gray-600"}`,children:["Дедлайн: ",V.dueDate?ie(new Date(V.dueDate),"dd.MM.yyyy"):"—"," ",V.dueTime||""]})]}),r.jsx("span",{className:`text-[11px] px-2 py-1 rounded-full border ${oe[V.status].classes}`,children:oe[V.status].label})]}),V.description&&r.jsx("p",{className:`text-xs mt-2 ${s==="dark"?"text-gray-300":"text-gray-600"} line-clamp-2`,children:V.description})]},V.id))})]}),r.jsxs("div",{className:"mt-4 space-y-3",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx($x,{className:"w-4 h-4 text-[#4E6E49]"}),r.jsx("p",{className:`text-sm font-semibold ${B}`,children:"Мои заметки"})]}),r.jsxs("div",{className:"grid gap-2 sm:grid-cols-2",children:[r.jsx("input",{type:"text",value:L.title,onChange:V=>ee({...L,title:V.target.value}),placeholder:"Заголовок",className:`px-3 py-2 rounded-lg border ${s==="dark"?"border-white/10 bg-white/5 text-white":"border-gray-200 bg-white text-gray-900"} text-sm`}),r.jsx("div",{className:"flex gap-2",children:["low","medium","high"].map(V=>r.jsx("button",{onClick:()=>ee({...L,priority:V}),className:`px-3 py-2 rounded-lg border text-sm flex-1 ${L.priority===V?"border-[#4E6E49] bg-[#4E6E49]/10 text-[#4E6E49]":s==="dark"?"border-white/10 bg-white/5 text-white":"border-gray-200 bg-white text-gray-800"}`,children:V==="low"?"Низкий":V==="medium"?"Средний":"Высокий"},V))})]}),r.jsx("textarea",{value:L.text,onChange:V=>ee({...L,text:V.target.value}),rows:3,placeholder:"Текст заметки",className:`w-full px-3 py-2 rounded-lg border ${s==="dark"?"border-white/10 bg-white/5 text-white":"border-gray-200 bg-white text-gray-900"} text-sm`}),r.jsxs("div",{className:"flex gap-2",children:[r.jsxs("button",{onClick:F,className:`px-4 py-2 rounded-lg font-semibold flex items-center gap-2 ${e!=null&&e.id?s==="dark"?"bg-[#4E6E49]/20 text-[#4E6E49] border border-[#4E6E49]/40":"bg-gradient-to-r from-[#4E6E49] to-emerald-500 text-white":"bg-gray-300 text-gray-600 cursor-not-allowed"}`,disabled:!(e!=null&&e.id),children:[r.jsx(Go,{className:"w-4 h-4"}),L.id?"Сохранить":"Добавить"]}),L.id&&r.jsx("button",{onClick:()=>ee({id:"",userId:"",title:"",text:"",priority:"medium",createdAt:"",updatedAt:""}),className:`px-4 py-2 rounded-lg font-semibold border ${s==="dark"?"border-white/15 text-gray-200":"border-gray-200 text-gray-700"}`,children:"Отмена"})]}),P.length>0&&r.jsx("div",{className:"space-y-2",children:P.map(V=>r.jsx("div",{className:`p-3 rounded-lg border ${s==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-gray-50"} flex flex-col gap-1`,children:r.jsxs("div",{className:"flex items-start justify-between gap-2",children:[r.jsxs("div",{className:"min-w-0",children:[r.jsx("p",{className:`text-sm font-semibold ${B} truncate`,children:V.title||"Без названия"}),r.jsx("p",{className:`text-xs ${s==="dark"?"text-gray-400":"text-gray-600"} whitespace-pre-line`,children:V.text})]}),r.jsxs("div",{className:"flex items-center gap-1",children:[r.jsx("span",{className:`text-[11px] px-2 py-1 rounded-full border ${V.priority==="high"?"border-rose-200 bg-rose-50 text-rose-700 dark:border-rose-500/40 dark:bg-rose-500/15 dark:text-rose-50":V.priority==="medium"?"border-amber-200 bg-amber-50 text-amber-700 dark:border-amber-500/40 dark:bg-amber-500/15 dark:text-amber-50":"border-emerald-200 bg-emerald-50 text-emerald-700 dark:border-emerald-500/40 dark:bg-emerald-500/15 dark:text-emerald-50"}`,children:V.priority==="high"?"Высокий":V.priority==="medium"?"Средний":"Низкий"}),r.jsx("button",{onClick:()=>q(V.id),className:`p-1 rounded border ${s==="dark"?"border-white/10 text-gray-200":"border-gray-200 text-gray-700"}`,title:"Редактировать",children:r.jsx(Go,{className:"w-4 h-4"})}),r.jsx("button",{onClick:()=>M(V.id),className:`p-1 rounded border ${s==="dark"?"border-white/10 text-red-200":"border-gray-200 text-red-600"}`,title:"Удалить",children:r.jsx(Pt,{className:"w-4 h-4"})})]})]})},V.id))})]}),r.jsx("div",{className:"mt-4",children:r.jsxs("button",{onClick:()=>i("/tasks"),className:`w-full px-4 py-3 rounded-lg font-semibold transition-all flex items-center justify-center gap-2 ${s==="dark"?"bg-gradient-to-r from-[#4E6E49]/20 to-emerald-700/20 text-[#4E6E49] border border-[#4E6E49]/40":"bg-gradient-to-r from-green-50 to-emerald-50 text-[#4E6E49] border border-green-200"}`,children:[r.jsx(ss,{className:"w-4 h-4"}),"Перейти к задачам"]})})]})]}),r.jsxs("div",{className:"space-y-4 flex flex-col",children:[T&&r.jsxs("div",{className:`rounded-2xl p-5 border ${s==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white"} shadow flex-1`,children:[r.jsxs("div",{className:"flex items-center justify-between mb-4",children:[r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx("div",{className:`p-2.5 rounded-xl ${s==="dark"?"bg-emerald-500/20 text-emerald-200":"bg-emerald-50 text-emerald-700"}`,children:r.jsx(Tn,{className:"w-5 h-5"})}),r.jsxs("div",{children:[r.jsx("h2",{className:`text-lg font-bold ${B}`,children:"Мой заработок"}),r.jsx("p",{className:`text-xs ${s==="dark"?"text-gray-400":"text-gray-500"}`,children:"Суммы с учётом долей"})]})]}),r.jsx("div",{className:`px-3 py-1.5 rounded-full text-xs font-semibold border ${T.weekly.net>=1e4?"border-emerald-200 bg-emerald-50 text-emerald-800 dark:border-emerald-500/30 dark:bg-emerald-500/15 dark:text-emerald-100":"border-amber-200 bg-amber-50 text-amber-800 dark:border-amber-500/30 dark:bg-amber-500/15 dark:text-amber-100"}`,children:T.weekly.net>=1e4?"Вывод доступен":"Минимум 10 000 для вывода"})]}),r.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3 mb-4",children:[{label:"Всего заработано",value:T.total},{label:"Отправлено в пул",value:T.pool},{label:"Чистыми",value:T.net}].map(V=>r.jsxs("div",{className:`p-4 rounded-xl border shadow-sm ${s==="dark"?"border-white/10 bg-white/5":"border-gray-100 bg-gray-50"}`,children:[r.jsx("p",{className:"text-xs uppercase tracking-wide opacity-70",children:V.label}),r.jsxs("p",{className:`text-2xl font-extrabold ${B}`,children:[Math.round(V.value).toLocaleString("ru-RU")," ₽"]})]},V.label))}),r.jsxs("div",{className:`p-4 rounded-xl border ${s==="dark"?"border-white/10 bg-white/5":"border-emerald-50 bg-emerald-50/70"} flex flex-col gap-2`,children:[r.jsxs("div",{className:"flex items-center justify-between gap-2 flex-wrap",children:[r.jsxs("div",{children:[r.jsx("p",{className:`text-sm font-semibold ${B}`,children:"Активная неделя"}),r.jsx("p",{className:`text-xs ${s==="dark"?"text-gray-400":"text-gray-600"}`,children:"Понедельник, среда, пятница, суббота — дни вывода"})]}),r.jsx("span",{className:`text-xs px-3 py-1 rounded-full border ${T.weekly.net>=1e4?"border-emerald-200 bg-emerald-100 text-emerald-800 dark:border-emerald-500/40 dark:bg-emerald-500/15 dark:text-emerald-50":"border-amber-200 bg-amber-100 text-amber-800 dark:border-amber-500/40 dark:bg-amber-500/15 dark:text-amber-50"}`,children:T.weekly.net>=1e4?"Доступно к выводу":"Перенос на следующую неделю"})]}),r.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3",children:[{label:"Заработано за неделю",value:T.weekly.gross},{label:"В пул за неделю",value:T.weekly.pool},{label:"Чистыми за неделю",value:T.weekly.net}].map(V=>r.jsxs("div",{className:`p-3 rounded-lg border ${s==="dark"?"border-white/10 bg-white/5":"border-white/80 bg-white/80"} shadow-sm`,children:[r.jsx("p",{className:"text-[11px] uppercase tracking-wide opacity-70",children:V.label}),r.jsxs("p",{className:`text-lg font-bold ${B}`,children:[Math.round(V.value).toLocaleString("ru-RU")," ₽"]})]},V.label))}),T.weekly.net<1e4&&r.jsx("p",{className:`text-xs ${s==="dark"?"text-amber-200":"text-amber-700"}`,children:"Менее 10 000 ₽ чистыми за активную неделю — вывод недоступен, сумма переносится на следующую неделю."})]})]}),f&&$&&r.jsxs("div",{className:`rounded-2xl p-5 border ${s==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white"} shadow flex-1`,children:[r.jsxs("div",{className:"flex items-center justify-between mb-4",children:[r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx("div",{className:`p-2.5 rounded-xl ${s==="dark"?"bg-purple-500/20 text-purple-200":"bg-purple-50 text-purple-700"}`,children:r.jsx(qt,{className:"w-5 h-5"})}),r.jsxs("div",{children:[r.jsx("h2",{className:`text-lg font-bold ${B}`,children:"Рейтинг"}),r.jsx("p",{className:`text-xs ${s==="dark"?"text-gray-400":"text-gray-500"}`,children:"Еженедельная оценка"})]})]}),r.jsx("div",{className:"pill","data-active":"true",children:r.jsxs("span",{className:"font-bold",children:[f.rating.toFixed(1),"%"]})})]}),r.jsxs("div",{className:`p-4 rounded-xl border ${s==="dark"?"border-white/10 bg-white/5":"border-gray-100 bg-gray-50"} mb-4`,children:[r.jsxs("div",{className:`text-4xl font-extrabold ${B}`,children:[f.rating.toFixed(1),"%"]}),r.jsx("p",{className:`text-xs mt-1 ${s==="dark"?"text-gray-400":"text-gray-600"}`,children:f.rating>=70?"Отличный результат":f.rating>=50?"Хороший темп":"Требуется усиление показателей"})]}),r.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[{label:"Выходные",value:`${$.daysOff} дн`,pts:$.daysOffPoints,classes:s==="dark"?"bg-slate-700/40 border-slate-600/60":"bg-slate-50 border-slate-200"},{label:"Больничные",value:`${f.sickDays} дн`,pts:$.sickDaysPoints,classes:s==="dark"?"bg-amber-500/15 border-amber-500/30":"bg-amber-50 border-amber-200"},{label:"Отпуск",value:`${f.vacationDays} дн`,pts:$.vacationDaysPoints,classes:s==="dark"?"bg-orange-500/15 border-orange-500/30":"bg-orange-50 border-orange-200"},{label:"Часы",value:`${$.weeklyHours.toFixed(1)} ч/нед`,pts:$.weeklyHoursPoints,classes:s==="dark"?"bg-blue-500/15 border-blue-500/30":"bg-blue-50 border-blue-200"},{label:"Заработок",value:`${$.weeklyEarnings.toFixed(0)} ₽/нед`,pts:$.weeklyEarningsPoints,classes:s==="dark"?"bg-emerald-500/15 border-emerald-500/30":"bg-emerald-50 border-emerald-200"},{label:"Рефералы",value:`${f.referrals}`,pts:$.referralsPoints,classes:s==="dark"?"bg-purple-500/15 border-purple-500/30":"bg-purple-50 border-purple-200"}].map(V=>r.jsxs("div",{className:`p-3 rounded-xl border shadow-sm ${V.classes}`,children:[r.jsx("div",{className:"text-xs font-semibold uppercase opacity-80",children:V.label}),r.jsx("div",{className:`text-lg font-bold ${B}`,children:V.value}),r.jsxs("div",{className:`text-sm ${s==="dark"?"text-gray-100":"text-gray-800"}`,children:[V.pts.toFixed(1),"%"]})]},V.label))}),r.jsxs("div",{className:`mt-4 p-4 rounded-xl border ${s==="dark"?"border-white/10 bg-white/5":"border-gray-100 bg-gray-50"}`,children:[r.jsxs("h3",{className:`text-sm font-bold ${B} mb-2 flex items-center gap-2`,children:[r.jsx(Tr,{className:"w-4 h-4"}),"Как считается рейтинг"]}),r.jsx("p",{className:`text-xs ${s==="dark"?"text-gray-300":"text-gray-700"}`,children:"7 параметров: выходные, больничные, отпуск (месяц), часы, доход, рефералы, сообщения (неделя). Максимум 100%."})]})]})]})]}),r.jsx("div",{className:`rounded-2xl p-5 border ${s==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white"} shadow`,children:r.jsxs("button",{onClick:z,className:`w-full px-6 py-3.5 rounded-lg font-semibold transition-all flex items-center justify-center gap-2 ${s==="dark"?"bg-gradient-to-r from-red-500/20 to-pink-500/20 text-red-300 border border-red-500/50":"bg-gradient-to-r from-red-50 to-pink-50 text-red-700 border border-red-200"}`,children:[r.jsx(Zh,{className:"w-5 h-5"}),"Выйти из аккаунта"]})})]})]}):r.jsx("div",{className:"text-center py-12",children:r.jsx("p",{className:B,children:"Необходима авторизация"})})},p4="/assets/image-779ddbd9-e512-4bda-8983-af1ab9237b7c-B_v6l7J0.png",x4=()=>{const{theme:s}=it(),e=s==="dark"?"text-white":"text-gray-900",t=s==="dark"?"text-gray-400":"text-gray-600",n=[{title:"Финансовая грамотность",note:"Учимся управлять рисками, понимать токеномику и принимать решения на основе анализа, а не эмоций.",accent:"from-emerald-200 to-teal-200"},{title:"Приватность превыше всего",note:"Уважаем личные границы и используем инструменты, защищающие цифровую идентичность.",accent:"from-sky-200 to-blue-200"},{title:"Образование и развитие",note:"Учимся от основ блокчейна до продвинутых DeFi-стратегий и делимся знаниями.",accent:"from-amber-200 to-orange-200"},{title:"Честность и прозрачность",note:"Внутри клуба — открытость, честные сделки и уважение. Доверие строим действиями.",accent:"from-purple-200 to-indigo-200"},{title:"Инновации и эксперименты",note:"Тестируем новые протоколы, участвуем в DAO, не боимся быть первыми в трендах.",accent:"from-pink-200 to-rose-200"},{title:"Критическое мышление",note:"Не следуем слепо за хайпом: анализируем, проверяем источники и опираемся на здравый смысл.",accent:"from-cyan-200 to-teal-200"},{title:"Глобальное мышление",note:"Открыты к сотрудничеству с людьми из разных стран ради цифровой и финансовой свободы в рамках закона.",accent:"from-lime-200 to-green-200"},{title:"Свобода и ответственность",note:"Ценим свободу крипты и понимаем её цену: зрелость, самоконтроль и ответственность за решения.",accent:"from-gray-200 to-slate-200"}],a=[{label:"Что такое ApeVault?",value:"Клуб криптоэнтузиастов, где знания превращаются в действие."},{label:"Цель",value:"Объединить инвесторов и трейдеров ради роста дохода и безопасности входа в рынок."}];return r.jsxs("div",{className:"space-y-7 sm:space-y-8",children:[r.jsxs("div",{className:"section-card rounded-3xl p-6 sm:p-8 border border-white/60 dark:border-white/10 shadow-2xl relative overflow-hidden",children:[r.jsx("div",{className:"accent-dots"}),r.jsx("div",{className:"absolute inset-y-0 right-0 w-1/3 pointer-events-none bg-gradient-to-l from-[#4E6E49]/10 to-transparent blur-2xl"}),r.jsxs("div",{className:"relative z-10 flex flex-col gap-5 lg:flex-row lg:items-center lg:justify-between",children:[r.jsxs("div",{className:"space-y-3 max-w-3xl",children:[r.jsxs("div",{className:"inline-flex items-center gap-2 px-3 py-1.5 rounded-full border border-white/50 dark:border-white/10 bg-white/70 dark:bg-white/5 text-xs font-semibold uppercase tracking-[0.16em]",children:[r.jsx(Tr,{className:"w-4 h-4 text-[#4E6E49]"}),"ApeVault Community"]}),r.jsx("h1",{className:`text-3xl sm:text-4xl lg:text-5xl font-extrabold leading-tight ${e}`,children:"О нас и нашем сообществе"}),r.jsx("p",{className:`text-sm sm:text-base ${t} max-w-2xl`,children:"ApeVault — это пространство, где опытные криптоэнтузиасты объединяют знания и проверенные стратегии, чтобы безопасно заходить в рынок и расти вместе."}),r.jsx("div",{className:"flex flex-wrap gap-2",children:["Командные сессии","Проверенные стратегии","Прозрачные регламенты"].map(i=>r.jsx("span",{className:`px-3 py-1.5 rounded-full text-xs font-semibold border ${s==="dark"?"border-white/10 bg-white/5 text-white":"border-gray-200 bg-white text-gray-900"}`,children:i},i))})]}),r.jsx("div",{className:"grid grid-cols-2 gap-3 w-full max-w-xs lg:max-w-sm",children:[{label:"Участников",value:"50+"},{label:"Сессий / неделю",value:"10+"},{label:"Уроков",value:"100+"},{label:"Фокуса",value:"100% качество"}].map(i=>r.jsxs("div",{className:`rounded-2xl border p-3 sm:p-4 shadow-sm ${s==="dark"?"border-white/10 bg-white/5 text-white":"border-gray-200 bg-white text-gray-900"}`,children:[r.jsx("p",{className:"text-[11px] uppercase tracking-wide opacity-70",children:i.label}),r.jsx("p",{className:"text-xl font-extrabold leading-tight mt-1",children:i.value})]},i.label))})]})]}),r.jsxs("div",{className:"section-card rounded-3xl p-6 sm:p-7 border border-white/60 dark:border-white/10 shadow-xl relative overflow-hidden",children:[r.jsx("div",{className:"absolute top-0 right-0 w-40 h-40 bg-gradient-to-br from-emerald-500/10 to-blue-500/10 rounded-full blur-3xl -mr-16 -mt-16"}),r.jsxs("div",{className:"relative z-10 space-y-4",children:[r.jsxs("h2",{className:`text-2xl sm:text-3xl font-extrabold ${e} flex items-center gap-2`,children:[r.jsx(pr,{className:"w-6 h-6 text-[#4E6E49]"}),"Что такое ApeVault?"]}),r.jsx("div",{className:"grid gap-4 sm:grid-cols-2",children:a.map(i=>r.jsxs("div",{className:`rounded-2xl border p-4 sm:p-5 flex gap-3 items-start ${s==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white"}`,children:[r.jsx("div",{className:"p-2 rounded-xl bg-gradient-to-br from-[#4E6E49] to-emerald-600 text-white shadow-lg",children:r.jsx(Rr,{className:"w-4 h-4"})}),r.jsxs("div",{className:"space-y-1",children:[r.jsx("p",{className:"text-xs uppercase tracking-wide text-[#4E6E49] font-semibold",children:i.label}),r.jsx("p",{className:`text-sm sm:text-base leading-relaxed ${e}`,children:i.value})]})]},i.label))})]})]}),r.jsxs("div",{className:"section-card rounded-3xl p-6 sm:p-7 border border-white/60 dark:border-white/10 shadow-xl relative overflow-hidden",children:[r.jsx("div",{className:"absolute -left-10 top-0 w-52 h-52 bg-gradient-to-br from-amber-400/10 to-rose-400/10 rounded-full blur-3xl"}),r.jsx("div",{className:"absolute -right-10 bottom-0 w-52 h-52 bg-gradient-to-br from-blue-400/10 to-emerald-400/10 rounded-full blur-3xl"}),r.jsxs("div",{className:"relative z-10 space-y-5",children:[r.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-3",children:[r.jsx("h2",{className:`text-2xl sm:text-3xl font-extrabold ${e}`,children:"Принципы, которые держат нас на вершине"}),r.jsxs("div",{className:"flex gap-2",children:[r.jsxs($r,{to:"/rules",className:"pill justify-center text-center","data-active":"false",children:["Ознакомиться с правилами",r.jsx(Rr,{className:"w-4 h-4"})]}),r.jsxs("a",{href:"#contacts",className:"pill","data-active":"false",children:["Контакты",r.jsx(Rr,{className:"w-4 h-4"})]})]})]}),r.jsxs("div",{className:"grid lg:grid-cols-[1fr_420px_1fr] gap-6 items-center",children:[r.jsx("div",{className:"space-y-3",children:n.slice(0,4).map(i=>r.jsxs("div",{className:`rounded-2xl border px-4 py-3 flex items-start gap-3 ${s==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white/90"}`,children:[r.jsx("div",{className:`p-2 rounded-xl text-gray-900 bg-gradient-to-br ${i.accent}`,children:r.jsx(Rr,{className:"w-4 h-4"})}),r.jsxs("div",{className:"space-y-1",children:[r.jsx("p",{className:`text-sm sm:text-base font-semibold ${e}`,children:i.title}),i.note&&r.jsx("p",{className:`text-xs ${t}`,children:i.note})]})]},i.title))}),r.jsxs("div",{className:`rounded-3xl border shadow-xl overflow-hidden relative ${s==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white/95"}`,children:[r.jsx("img",{src:p4,alt:"Принципы ApeVault",className:"w-full h-full object-contain"}),r.jsx("div",{className:"absolute inset-0 pointer-events-none bg-gradient-to-b from-transparent via-transparent to-white/0"})]}),r.jsx("div",{className:"space-y-3",children:n.slice(4).map(i=>r.jsxs("div",{className:`rounded-2xl border px-4 py-3 flex items-start gap-3 ${s==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white/90"}`,children:[r.jsx("div",{className:`p-2 rounded-xl text-gray-900 bg-gradient-to-br ${i.accent}`,children:r.jsx(Rr,{className:"w-4 h-4"})}),r.jsxs("div",{className:"space-y-1",children:[r.jsx("p",{className:`text-sm sm:text-base font-semibold ${e}`,children:i.title}),i.note&&r.jsx("p",{className:`text-xs ${t}`,children:i.note})]})]},i.title))})]})]})]}),r.jsxs("div",{id:"rules",className:"section-card rounded-3xl p-6 sm:p-7 border border-white/60 dark:border-white/10 shadow-xl relative overflow-hidden",children:[r.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-indigo-100/50 via-white/40 to-purple-100/40 dark:from-indigo-900/30 dark:via-transparent dark:to-purple-900/20"}),r.jsxs("div",{className:"relative z-10 grid gap-5 sm:grid-cols-[1.15fr_0.85fr] items-center",children:[r.jsxs("div",{className:"space-y-3",children:[r.jsxs("div",{className:"inline-flex items-center gap-2 px-3 py-1.5 rounded-full bg-white/80 dark:bg-white/10 border border-white/60 dark:border-white/10 text-xs font-semibold tracking-wide text-indigo-700 dark:text-white",children:[r.jsx(In,{className:"w-4 h-4"}),"Правила сообщества"]}),r.jsx("h2",{className:`text-2xl sm:text-3xl font-extrabold ${e}`,children:"Простой регламент, чтобы оставаться на одной волне"}),r.jsx("p",{className:`text-sm sm:text-base ${t}`,children:"Подробно описали процессы, безопасность и взаимодействие, чтобы каждый чувствовал прозрачность и поддержку."}),r.jsx("div",{className:"flex flex-wrap gap-2",children:["Безопасность","Честные сделки","Уважение","Прозрачность"].map(i=>r.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-semibold border ${s==="dark"?"border-white/10 bg-white/5 text-white":"border-indigo-100 bg-white text-indigo-900"}`,children:i},i))}),r.jsxs($r,{to:"/rules",className:"inline-flex items-center gap-2 px-5 py-3 rounded-xl bg-gradient-to-r from-indigo-500 to-purple-500 text-white font-semibold shadow-lg hover:shadow-xl hover:-translate-y-0.5 transition-all",children:[r.jsx(In,{className:"w-5 h-5"}),r.jsx("span",{children:"Ознакомиться с правилами"}),r.jsx(Rr,{className:"w-4 h-4"})]})]}),r.jsx("div",{className:`rounded-2xl border p-4 sm:p-5 shadow-lg ${s==="dark"?"border-white/10 bg-white/5":"border-white/80 bg-white/90"}`,children:r.jsx("div",{className:"space-y-3",children:["Короткие правила для быстрых решений","Фокус на безопасности и приватности","Прозрачные роли и ответственность","Действуем в рамках законодательства"].map(i=>r.jsxs("div",{className:"flex items-start gap-2",children:[r.jsx("div",{className:"w-2 h-2 rounded-full bg-indigo-500 mt-2"}),r.jsx("p",{className:`text-sm ${e}`,children:i})]},i))})})]})]}),r.jsxs("div",{id:"contacts",className:"section-card rounded-3xl p-6 sm:p-7 border border-white/60 dark:border-white/10 shadow-xl relative overflow-hidden",children:[r.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-rose-100/50 via-white/40 to-amber-100/40 dark:from-rose-900/25 dark:via-transparent dark:to-amber-900/20"}),r.jsxs("div",{className:"relative z-10 grid gap-5 sm:grid-cols-[0.9fr_1.1fr] items-center",children:[r.jsxs("div",{className:`p-4 rounded-2xl shadow-lg inline-flex items-center gap-3 ${s==="dark"?"bg-gradient-to-br from-rose-600 to-amber-600 text-white":"bg-gradient-to-br from-rose-500 to-amber-500 text-white"}`,children:[r.jsx(Nx,{className:"w-7 h-7"}),r.jsxs("div",{children:[r.jsx("p",{className:"text-xs uppercase tracking-wide",children:"Контакты клуба"}),r.jsx("p",{className:"text-base font-semibold",children:"Свяжитесь с нами"})]})]}),r.jsxs("div",{className:"grid gap-3 sm:grid-cols-2",children:[r.jsxs("div",{className:`rounded-2xl border p-4 shadow-md flex flex-col gap-2 ${s==="dark"?"border-white/10 bg-white/5":"border-white/80 bg-white/90"}`,children:[r.jsx("p",{className:"text-xs uppercase tracking-wide text-rose-600 dark:text-rose-200 font-semibold",children:"Администратор"}),r.jsx("p",{className:`text-lg font-extrabold ${e}`,children:"@artyommedoed"}),r.jsx("p",{className:`text-sm ${t}`,children:"По вопросам правил, доступов и регламентов."})]}),r.jsxs("div",{className:`rounded-2xl border p-4 shadow-md flex flex-col gap-2 ${s==="dark"?"border-white/10 bg-white/5":"border-white/80 bg-white/90"}`,children:[r.jsx("p",{className:"text-xs uppercase tracking-wide text-amber-600 dark:text-amber-200 font-semibold",children:"Обратная связь"}),r.jsx("p",{className:`text-lg font-extrabold ${e}`,children:"Командный чат"}),r.jsx("p",{className:`text-sm ${t}`,children:"Оперативные вопросы по продуктам и сессиям."}),r.jsxs("a",{href:"https://t.me/+vPZdPwPaaKI1MjAy",target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-2 text-sm font-semibold text-[#4E6E49] hover:text-emerald-600",children:["Присоединиться",r.jsx(Rr,{className:"w-4 h-4"})]})]})]})]})]})]})},Yr=({title:s,description:e,children:t})=>{const{theme:n}=it(),a=n==="dark"?"text-white":"text-gray-900",i=n==="dark"?"text-gray-400":"text-gray-600";return r.jsx("div",{className:"section-card rounded-3xl p-6 sm:p-7 border border-white/60 dark:border-white/10 shadow-xl relative overflow-hidden",children:r.jsxs("div",{className:"relative z-10 space-y-4",children:[r.jsxs("div",{className:"flex items-start gap-3",children:[r.jsx("div",{className:"p-2 rounded-xl bg-gradient-to-br from-[#4E6E49]/20 to-emerald-500/15 text-[#4E6E49]",children:r.jsx(In,{className:"w-5 h-5"})}),r.jsxs("div",{className:"space-y-1",children:[r.jsx("h2",{className:`text-xl sm:text-2xl font-extrabold ${a}`,children:s}),e&&r.jsx("p",{className:`text-sm ${i}`,children:e})]})]}),t]})})},f4=()=>{const{theme:s}=it(),e=s==="dark"?"text-white":"text-gray-900",t=s==="dark"?"text-gray-400":"text-gray-600",n=["последовательной эскалации","объективности и равного применения","недопустимости злоупотребления полномочиями","исключения спорных трактовок и субъективности"],a=["единичные опоздания (не более 1 раза за календарную неделю)","некорректное выполнение инструкций без последствий вследствие заболевания или сбоев в ПО","нарушение регламента общения, не приводящее к конфликту"],i=["повторяющиеся нарушения регламента","несоблюдение правил торговой сессии","недостаточная подготовка к сессии","игнорирование инструкций ведущего","нарушение процедур безопасности данных или доступа"],o=["оскорбления участников","провокации и попытки вызвать конфликт","манипуляции и мошеннические действия","действия, создающие финансовые, репутационные или организационные риски","подрыв дисциплины и порядка в сообществе"],c=[{term:"Нарушение",text:"любое действие или бездействие, противоречащее регламентам ApeVault"},{term:"Предупреждение",text:"официальное уведомление о нарушении"},{term:"Выговор",text:"фиксируемая мера повышенной строгости при повторных нарушениях"},{term:"Ведущий торговой сессии",text:"управляет процессом и следит за соблюдением регламента на сессии"},{term:"Ответственный за сообщество",text:"назначенное лицо, управляющее дисциплиной и коммуникацией"},{term:"Повторное нарушение",text:"нарушение в течение 30 календарных дней после предыдущего"}];return r.jsxs("div",{className:"space-y-7 sm:space-y-8",children:[r.jsxs("div",{className:"section-card rounded-3xl p-6 sm:p-8 border border-white/60 dark:border-white/10 shadow-2xl relative overflow-hidden",children:[r.jsx("div",{className:"accent-dots"}),r.jsx("div",{className:"absolute inset-y-0 right-0 w-1/3 pointer-events-none bg-gradient-to-l from-[#4E6E49]/12 to-transparent blur-3xl"}),r.jsxs("div",{className:"relative z-10 flex flex-col gap-5 lg:flex-row lg:items-center lg:justify-between",children:[r.jsxs("div",{className:"space-y-4 max-w-3xl",children:[r.jsx("div",{className:"inline-flex items-center gap-2 px-3 py-1.5 rounded-full border border-white/50 dark:border-white/10 bg-white/70 dark:bg-white/5 text-xs font-semibold uppercase tracking-[0.16em] text-[#4E6E49]",children:"ApeVault Standard Operating Code — ASOC"}),r.jsx("h1",{className:`text-3xl sm:text-4xl lg:text-5xl font-extrabold leading-tight ${e}`,children:"Кодекс операционных процедур и регламентов платформы ApeVault"}),r.jsx("p",{className:`text-sm sm:text-base ${t}`,children:"Единые правила ответственности, дисциплинарных мер и прозрачных процедур для команды ApeVault."}),r.jsx("div",{className:"flex flex-wrap gap-2",children:["Ответственность","Прозрачность","Безопасность","Справедливость"].map(d=>r.jsx("span",{className:`px-3 py-1.5 rounded-full text-xs font-semibold border ${s==="dark"?"border-white/10 bg-white/5 text-white":"border-gray-200 bg-white text-gray-900"}`,children:d},d))})]}),r.jsxs("div",{className:`rounded-3xl border shadow-xl p-4 sm:p-5 w-full lg:max-w-sm ${s==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white"}`,children:[r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx("div",{className:"p-3 rounded-2xl bg-gradient-to-br from-[#4E6E49] to-emerald-600 text-white shadow-lg",children:r.jsx(Ma,{className:"w-6 h-6"})}),r.jsxs("div",{children:[r.jsx("p",{className:"text-xs uppercase tracking-wide text-[#4E6E49] font-semibold",children:"Назначение раздела"}),r.jsx("p",{className:`text-base font-semibold ${e}`,children:"Поддержание порядка и профессионализма команды"})]})]}),r.jsxs("div",{className:"mt-4 space-y-3",children:[r.jsxs("div",{className:"flex items-center gap-2 text-sm font-semibold text-[#4E6E49]",children:[r.jsx(Rr,{className:"w-4 h-4"}),"Публичная версия правил доступна на сайте"]}),r.jsx("p",{className:`text-xs ${t}`,children:"Используйте кнопку «Правила» в навигации или в профиле, чтобы быстро открыть этот раздел."}),r.jsxs("a",{href:"/rules.pdf",download:!0,className:`inline-flex items-center gap-2 px-4 py-2.5 rounded-xl border transition-all shadow-sm hover:shadow-md hover:-translate-y-0.5 ${s==="dark"?"border-white/20 bg-white/10 text-white hover:bg-white/15":"border-[#4E6E49]/30 bg-[#4E6E49]/10 text-[#4E6E49] hover:bg-[#4E6E49]/15"}`,children:[r.jsx(mx,{className:"w-4 h-4"}),r.jsx("span",{className:"text-sm font-semibold",children:"Скачать правила (PDF)"})]})]})]})]})]}),r.jsxs(Yr,{title:"Политика ответственности и меры дисциплинарного воздействия",description:"Единый порядок применения мер для поддержания порядка, прозрачности и профессионального уровня.",children:[r.jsxs("div",{className:`grid gap-4 sm:grid-cols-2 ${s==="dark"?"text-gray-200":"text-gray-900"}`,children:[r.jsxs("div",{className:`rounded-2xl border p-4 sm:p-5 ${s==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white"}`,children:[r.jsxs("div",{className:"flex items-center gap-2 text-sm font-semibold text-[#4E6E49]",children:[r.jsx(Gd,{className:"w-4 h-4"}),"Цели дисциплинарной политики"]}),r.jsx("p",{className:`text-sm mt-2 ${t}`,children:"Обеспечить соблюдение регламентов, процедур и рабочих стандартов команды."})]}),r.jsxs("div",{className:`rounded-2xl border p-4 sm:p-5 ${s==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white"}`,children:[r.jsxs("div",{className:"flex items-center gap-2 text-sm font-semibold text-[#4E6E49]",children:[r.jsx(Dx,{className:"w-4 h-4"}),"Принципы применения мер"]}),r.jsx("ul",{className:`text-sm mt-2 space-y-1 ${t}`,children:n.map(d=>r.jsxs("li",{children:["• ",d]},d))})]})]}),r.jsx("div",{className:`mt-3 text-sm ${t}`,children:"Меры ответственности применяются в зависимости от тяжести, регулярности и последствий нарушения."})]}),r.jsx(Yr,{title:"Унифицированный регламент торговой деятельности ApeVault",description:"Нормы поведения на торговых сессиях, полномочия ведущего, перерывы, записи и конфиденциальность.",children:r.jsxs("div",{className:`space-y-4 text-sm ${t}`,children:[r.jsxs("div",{className:`rounded-2xl border p-4 sm:p-5 ${s==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white"}`,children:[r.jsx("p",{className:"text-base font-semibold text-[#4E6E49]",children:"1. Общие положения"}),r.jsxs("ul",{className:"mt-2 space-y-1",children:[r.jsx("li",{children:"• Регламент задаёт нормы участия, дисциплину, полномочия ведущего и ответственность."}),r.jsx("li",{children:"• Все участники обязаны ознакомиться с разделом до начала торговой деятельности."})]})]}),r.jsxs("div",{className:`rounded-2xl border p-4 sm:p-5 ${s==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white"}`,children:[r.jsx("p",{className:"text-base font-semibold text-[#4E6E49]",children:"2. Права и полномочия ведущего"}),r.jsx("p",{className:"mt-2 font-semibold text-[#4E6E49]",children:"Полномочия:"}),r.jsxs("ul",{className:"mt-1 space-y-1",children:[r.jsx("li",{children:"• Давать обязательные распоряжения по порядку, действиям, стратегии и дисциплине."}),r.jsx("li",{children:"• Требовать соблюдения тайминга, регламента и корректного поведения."}),r.jsx("li",{children:"• Приостанавливать участие нарушающих участников."}),r.jsx("li",{children:"• Объявлять перерывы и завершение сессии."}),r.jsx("li",{children:"• Фиксировать нарушения, выдавать предупреждения/выговоры, вводить временный запрет на участие."})]}),r.jsx("p",{className:"mt-3 font-semibold text-[#4E6E49]",children:"Ограничения:"}),r.jsxs("ul",{className:"mt-1 space-y-1",children:[r.jsx("li",{children:"• Не изменяет дисциплинарные меры, установленные регламентом."}),r.jsx("li",{children:"• Не принимает решения об исключении из команды (решает ответственный за команду)."}),r.jsx("li",{children:"• Не меняет торговую стратегию вне утверждённой методологии или плана сессии."})]})]}),r.jsxs("div",{className:`rounded-2xl border p-4 sm:p-5 space-y-3 ${s==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white"}`,children:[r.jsx("p",{className:"text-base font-semibold text-[#4E6E49]",children:"3. Порядок проведения сессии"}),r.jsxs("div",{children:[r.jsx("p",{className:"font-semibold",children:"Начало и окончание:"}),r.jsxs("ul",{className:"mt-1 space-y-1",children:[r.jsx("li",{children:"• Старт строго по времени слота."}),r.jsx("li",{children:"• Подключение за 3–5 минут до старта обязательно."}),r.jsx("li",{children:"• Окончание объявляет ведущий, не позднее 30 минут после окончания слота."})]})]}),r.jsxs("div",{children:[r.jsx("p",{className:"font-semibold",children:"Поведение во время торгов:"}),r.jsx("p",{className:"text-xs uppercase tracking-wide opacity-70 mt-1",children:"Запрещено:"}),r.jsxs("ul",{className:"space-y-1",children:[r.jsx("li",{children:"• Перебивать ведущего или участников."}),r.jsx("li",{children:"• Отвлекать команду сторонними вопросами."}),r.jsx("li",{children:"• Включать микрофон без необходимости, создавать шум."}),r.jsx("li",{children:"• Саботировать процесс или предлагать несогласованные решения."}),r.jsx("li",{children:"• Коммуницировать с кем-либо вне участников сессии."})]}),r.jsx("p",{className:"text-xs uppercase tracking-wide opacity-70 mt-2",children:"Обязано:"}),r.jsxs("ul",{className:"space-y-1",children:[r.jsx("li",{children:"• Следовать инструкциям ведущего и оперативно исполнять распоряжения."}),r.jsx("li",{children:"• Сохранять корректность и нейтральность в коммуникации."}),r.jsx("li",{children:"• Обеспечивать техническую готовность: связь, устройство, ПО."})]})]})]}),r.jsxs("div",{className:`rounded-2xl border p-4 sm:p-5 space-y-2 ${s==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white"}`,children:[r.jsx("p",{className:"text-base font-semibold text-[#4E6E49]",children:"4. Политика перерывов"}),r.jsxs("ul",{className:"space-y-1",children:[r.jsx("li",{children:"• Краткий перерыв — до 10 минут каждые 45 минут."}),r.jsx("li",{children:"• Большой перерыв — до 45 минут каждые 3 часа активной торговли."}),r.jsx("li",{children:"• Все перерывы объявляет ведущий."}),r.jsx("li",{children:"• Самовольные перерывы запрещены; нарушение дисциплины, если не согласовано в трекере слотов и с ответственным."})]})]}),r.jsxs("div",{className:`rounded-2xl border p-4 sm:p-5 space-y-2 ${s==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white"}`,children:[r.jsx("p",{className:"text-base font-semibold text-[#4E6E49]",children:"5. Правила записи сессий"}),r.jsxs("ul",{className:"space-y-1",children:[r.jsx("li",{children:"• Запись включает только ведущий или ответственный за сообщество."}),r.jsx("li",{children:"• Хранение — в закрытом архиве команды; доступ: ведущий, управляющий сообществом, ответственные аналитики."}),r.jsx("li",{children:"• Распространение вне команды запрещено."}),r.jsx("li",{children:"• Срок хранения определяет ведущий: до 3 лет, но ≥14 календарных дней."})]})]}),r.jsxs("div",{className:`rounded-2xl border p-4 sm:p-5 space-y-2 ${s==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white"}`,children:[r.jsx("p",{className:"text-base font-semibold text-[#4E6E49]",children:"6. Конфликт интересов"}),r.jsxs("ul",{className:"space-y-1",children:[r.jsx("li",{children:"• Запрещено действовать в интересах сторонних групп/конкурентов."}),r.jsx("li",{children:"• Запрещено передавать стратегию, аналитику, материалы, алгоритмы, сигналы и методики ApeVault третьим лицам."}),r.jsx("li",{children:"• Запрещено получать вознаграждение за внешние консультации, использующие опыт или данные ApeVault."}),r.jsx("li",{children:"• Запрещено участвовать в параллельных торговых группах, если это создаёт риск конфликта или утечки информации."})]})]}),r.jsxs("div",{className:`rounded-2xl border p-4 sm:p-5 space-y-2 ${s==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white"}`,children:[r.jsx("p",{className:"text-base font-semibold text-[#4E6E49]",children:"7. Конфиденциальность"}),r.jsxs("ul",{className:"space-y-1",children:[r.jsx("li",{children:"• Все материалы, данные, аналитика, торговые решения и внутренняя коммуникация — интеллектуальная собственность ApeVault."}),r.jsx("li",{children:"• Запрещено копировать, распространять или передавать информацию третьим лицам."}),r.jsx("li",{children:"• Запрещено создавать производные материалы без согласования с ответственным."}),r.jsx("li",{children:"• Запрещено публиковать скриншоты, отчёты или содержимое сессий в открытых источниках (кроме чата команды)."}),r.jsx("li",{children:"• Требование к среде: наушники и отсутствие посторонних рядом; не допускать, чтобы экран/звук были доступны третьим лицам."}),r.jsx("li",{className:"font-semibold text-[#4E6E49]",children:"Нарушение положений конфиденциальности — основание для немедленного исключения."})]})]})]})}),r.jsx(Yr,{title:"Классификация нарушений",description:"Три уровня тяжести определяют, как быстро применяются ограничения.",children:r.jsxs("div",{className:"grid gap-4 lg:grid-cols-3",children:[r.jsxs("div",{className:`rounded-2xl border p-4 sm:p-5 ${s==="dark"?"border-white/10 bg-white/5":"border-amber-100 bg-white/95"}`,children:[r.jsxs("div",{className:"flex items-center gap-2 text-sm font-semibold text-amber-600 dark:text-amber-300",children:[r.jsx(Tr,{className:"w-4 h-4"}),"Незначительные"]}),r.jsx("ul",{className:`text-sm mt-2 space-y-1 ${t}`,children:a.map(d=>r.jsxs("li",{children:["• ",d]},d))})]}),r.jsxs("div",{className:`rounded-2xl border p-4 sm:p-5 ${s==="dark"?"border-white/10 bg-white/5":"border-orange-100 bg-white/95"}`,children:[r.jsxs("div",{className:"flex items-center gap-2 text-sm font-semibold text-orange-600 dark:text-orange-300",children:[r.jsx(Ut,{className:"w-4 h-4"}),"Средние"]}),r.jsx("ul",{className:`text-sm mt-2 space-y-1 ${t}`,children:i.map(d=>r.jsxs("li",{children:["• ",d]},d))})]}),r.jsxs("div",{className:`rounded-2xl border p-4 sm:p-5 ${s==="dark"?"border-white/10 bg-white/5":"border-rose-100 bg-white/95"}`,children:[r.jsxs("div",{className:"flex items-center gap-2 text-sm font-semibold text-rose-600 dark:text-rose-300",children:[r.jsx(wa,{className:"w-4 h-4"}),"Грубые"]}),r.jsx("ul",{className:`text-sm mt-2 space-y-1 ${t}`,children:o.map(d=>r.jsxs("li",{children:["• ",d]},d))})]})]})}),r.jsx(Yr,{title:"Меры дисциплинарного воздействия и ограничения",description:"Применяются последовательно, кроме случаев грубых нарушений.",children:r.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[r.jsxs("div",{className:`rounded-2xl border p-4 sm:p-5 space-y-2 ${s==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white"}`,children:[r.jsxs("div",{className:"flex items-center gap-2 text-sm font-semibold text-[#4E6E49]",children:[r.jsx(Gd,{className:"w-4 h-4"}),"Порядок эскалации"]}),r.jsxs("ul",{className:`text-sm space-y-1 ${t}`,children:[r.jsx("li",{children:"• Напоминания — не более 1 в неделю, без последствий."}),r.jsx("li",{children:"• Предупреждения — не более 2 в неделю, при повторении незначительных или единичном среднем нарушении."}),r.jsx("li",{children:"• Выговоры — не более 2 в неделю, назначаются ведущим сессии или ответственным за сообщество."})]})]}),r.jsxs("div",{className:`rounded-2xl border p-4 sm:p-5 space-y-2 ${s==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white"}`,children:[r.jsxs("div",{className:"flex items-center gap-2 text-sm font-semibold text-[#4E6E49]",children:[r.jsx(wa,{className:"w-4 h-4"}),"Ограничительные меры"]}),r.jsxs("ul",{className:`text-sm space-y-1 ${t}`,children:[r.jsx("li",{children:"• Ограничение доступа к торговым сессиям: 1-е — ≥3 дней; повторное — 1 неделя; систематическое — 2 недели; дальше — исключение без восстановления."}),r.jsx("li",{children:"• Немедленное исключение без эскалации за грубое нарушение, оскорбления, провокации или угрозу финансам/безопасности/репутации."})]})]})]})}),r.jsx(Yr,{title:"Финансовые последствия",description:"Что происходит при систематических нарушениях и невыполнении мер.",children:r.jsx("div",{className:`rounded-2xl border p-4 sm:p-5 space-y-2 ${s==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white"}`,children:r.jsxs("ul",{className:`text-sm space-y-2 ${t}`,children:[r.jsx("li",{children:"• При систематических нарушениях и игнорировании мер может быть отказано в удовлетворении заявки на вывод средств, включая заработок за успешные сессии."}),r.jsx("li",{children:"• Перераспределение заработка: удержанные средства делятся между участниками, кроме тех, кто допустил два и более нарушений в неделю или более 6 нарушений в месяц."}),r.jsx("li",{children:"• Добровольно внесённые в пул или кошелёк команды средства не возвращаются при досрочном выходе или исключении за нарушения."})]})})}),r.jsx(Yr,{title:"Фиксация нарушений и апелляции",description:"Прозрачный процесс учёта нарушений и возможность обжаловать решение.",children:r.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[r.jsxs("div",{className:`rounded-2xl border p-4 sm:p-5 space-y-2 ${s==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white"}`,children:[r.jsxs("div",{className:"flex items-center gap-2 text-sm font-semibold text-[#4E6E49]",children:[r.jsx(Xr,{className:"w-4 h-4"}),"Порядок фиксации"]}),r.jsxs("ul",{className:`text-sm space-y-1 ${t}`,children:[r.jsx("li",{children:"• Все нарушения фиксируются ответственным за сообщество в отдельной ветви командного чата Telegram."}),r.jsx("li",{children:"• Обязательная фиксация: дата и время, тип нарушения, краткое описание ситуации, применённая мера."})]})]}),r.jsxs("div",{className:`rounded-2xl border p-4 sm:p-5 space-y-2 ${s==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white"}`,children:[r.jsxs("div",{className:"flex items-center gap-2 text-sm font-semibold text-[#4E6E49]",children:[r.jsx(Dr,{className:"w-4 h-4"}),"Процедура апелляции"]}),r.jsxs("ul",{className:`text-sm space-y-1 ${t}`,children:[r.jsx("li",{children:"• Апелляция подаётся в течение 24 часов с момента уведомления о мере."}),r.jsx("li",{children:"• Подача: ответственному за сообщество или назначенному куратору."}),r.jsx("li",{children:"• Рассмотрение: до 60 часов; решение окончательное."})]})]})]})}),r.jsx(Yr,{title:"Принцип равного применения",description:"Меры действуют одинаково для всех участников.",children:r.jsx("div",{className:`rounded-2xl border p-4 sm:p-5 space-y-1 ${s==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white"}`,children:r.jsx("p",{className:`text-sm ${t}`,children:"Дисциплинарные меры применяются ко всем участникам независимо от стажа, роли в проекте, вклада, личных отношений или результатов торговых сессий. Привилегии и исключения не допускаются."})})}),r.jsx(Yr,{title:"Определения",description:"Ключевые термины, чтобы избежать двусмысленностей.",children:r.jsx("div",{className:"grid gap-4 md:grid-cols-2",children:c.map(d=>r.jsxs("div",{className:`rounded-2xl border p-4 sm:p-5 space-y-1 ${s==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white"}`,children:[r.jsx("p",{className:"text-sm font-semibold text-[#4E6E49]",children:d.term}),r.jsx("p",{className:`text-sm ${t}`,children:d.text})]},d.term))})}),r.jsx(Yr,{title:"Заключительные положения",description:"Кто может обновлять раздел и обязанность ознакомления.",children:r.jsx("div",{className:`rounded-2xl border p-4 sm:p-5 space-y-2 ${s==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white"}`,children:r.jsxs("ul",{className:`text-sm space-y-1 ${t}`,children:[r.jsx("li",{children:"• Ответственный за сообщество или исполняющий обязанности оставляет за собой право корректировать и обновлять раздел при изменении процессов или структуры платформы."}),r.jsx("li",{children:"• Все участники обязаны ознакомиться с настоящей политикой и соблюдать её безусловно."})]})})})]})},b4={create:"Создание",update:"Изменение",delete:"Удаление"},y4={slot:"Слот",status:"Статус",earning:"Заработок",referral:"Реферал",login:"Ник"},v4={pending:"bg-amber-50 text-amber-900 border border-amber-200 shadow-inner dark:bg-amber-900/25 dark:text-amber-50 dark:border-amber-700",approved:"bg-emerald-50 text-emerald-900 border border-emerald-200 shadow-inner dark:bg-emerald-900/25 dark:text-emerald-50 dark:border-emerald-700",rejected:"bg-rose-50 text-rose-900 border border-rose-200 shadow-inner dark:bg-rose-900/25 dark:text-rose-50 dark:border-rose-700"},w4={pending:r.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-semibold bg-amber-100 text-amber-900 dark:bg-amber-900/40 dark:text-amber-100",children:[r.jsx(Dr,{className:"w-3 h-3"})," На согласовании"]}),approved:r.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-semibold bg-emerald-100 text-emerald-900 dark:bg-emerald-900/40 dark:text-emerald-100",children:[r.jsx(Ra,{className:"w-3 h-3"})," Принято"]}),rejected:r.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-semibold bg-rose-100 text-rose-900 dark:bg-rose-900/40 dark:text-rose-100",children:[r.jsx(Vx,{className:"w-3 h-3"})," Отклонено"]})},$a=s=>{if(!s)return"—";try{return ie(s,"dd.MM.yyyy")}catch{return"—"}},Ph=s=>{var n,a,i;if(!s)return"—";const e=(a=(n=s.slots)==null?void 0:n.map(o=>`${o.start}-${o.end}${o.endDate?` (до ${$a(o.endDate)})`:""}`))==null?void 0:a.join(", "),t=s.category?` [${((i=bn[s.category])==null?void 0:i.label)||s.category}]`:"";return`${$a(s.date)}${e?` · ${e}`:""}${t}`},Mh=s=>{if(!s)return"—";const e=s.type==="dayoff"?"Выходной":s.type==="sick"?"Больничный":"Отпуск",t=s.endDate?` (${$a(s.endDate)})`:"";return`${$a(s.date)} · ${e}${t}`},k4=()=>{const{user:s}=bt(),{isAdmin:e}=_t(),[t,n]=E.useState([]),[a,i]=E.useState(!0),[o,c]=E.useState(null),[d,h]=E.useState(!1),[m,x]=E.useState([]),[f,w]=E.useState(null),$=async()=>{i(!0),w(null);try{const D=await D0();let k=D;if(e){const b=new Date;b.setHours(b.getHours()-60),k=D.filter(v=>new Date(v.createdAt)>=b)}n(k)}catch(D){console.error("Не удалось загрузить заявки на согласование",D),w("Не удалось загрузить заявки")}finally{i(!1)}};E.useEffect(()=>{$()},[]);const A=async D=>{if(!o){c(D),w(null);try{const k=t.find(b=>b.id===D);await jh(D,(s==null?void 0:s.id)||"admin"),(k==null?void 0:k.entity)==="login"&&(zl(k.targetUserId),await as(k.targetUserId),window.dispatchEvent(new CustomEvent("nicknameUpdated",{detail:{userId:k.targetUserId}}))),await $(),x(b=>b.filter(v=>v!==D))}catch(k){console.error("Ошибка при подтверждении",k),w(`Не удалось подтвердить заявку: ${(k==null?void 0:k.message)||k}`),await $()}finally{c(null)}}},T=async D=>{if(o)return;const k=prompt("Комментарий для отклонения заявки","Уточните детали")||"Отклонено без комментария";c(D),w(null);try{await _h(D,(s==null?void 0:s.id)||"admin",k),await $()}catch(b){console.error("Ошибка при отклонении",b),w("Не удалось отклонить заявку")}finally{c(null)}},K=async()=>{if(!(d||o||m.length===0)){h(!0),w(null);try{for(const D of m){const k=t.find(b=>b.id===D);await jh(D,(s==null?void 0:s.id)||"admin"),(k==null?void 0:k.entity)==="login"&&(zl(k.targetUserId),await as(k.targetUserId),window.dispatchEvent(new CustomEvent("nicknameUpdated",{detail:{userId:k.targetUserId}})))}await $(),x([])}catch(D){console.error("Ошибка при подтверждении выбранных",D),w(`Не удалось подтвердить выбранные заявки: ${(D==null?void 0:D.message)||D}`),await $()}finally{h(!1)}}},P=async()=>{if(d||o||m.length===0)return;const D=prompt("Комментарий для отклонения выбранных заявок","Отклонено без комментария")||"Отклонено без комментария";if(D!==null){h(!0),w(null);try{for(const k of m)await _h(k,(s==null?void 0:s.id)||"admin",D);await $(),x([])}catch(k){console.error("Ошибка при отклонении выбранных",k),w(`Не удалось отклонить выбранные заявки: ${(k==null?void 0:k.message)||k}`),await $()}finally{h(!1)}}},S=D=>{x(k=>k.includes(D)?k.filter(b=>b!==D):[...k,D])},L=()=>{const D=t.filter(b=>b.status==="pending").map(b=>b.id),k=D.every(b=>m.includes(b));x(k?[]:D)},ee=D=>{if(D.entity==="login"){const k=D.before,b=D.after,v=(k==null?void 0:k.nickname)||"—",j=(b==null?void 0:b.nickname)||"—";return`${v} → ${j}`}if(D.entity==="slot"){const k=D.before,b=D.after;return`${Ph(k)} → ${Ph(b)}`}if(D.entity==="status"){const k=D.before,b=D.after;return`${Mh(k)} → ${Mh(b)}`}return D.after?"Изменение":D.before?"Удаление":"Создание"};return a?r.jsx("div",{className:"rounded-xl border border-gray-200 dark:border-gray-800 p-6 text-center text-sm text-gray-600 dark:text-gray-300",children:"Загружаем заявки..."}):r.jsxs("div",{className:"rounded-xl border border-gray-200 dark:border-gray-800 overflow-hidden shadow-sm",children:[r.jsxs("div",{className:"p-4 sm:p-5 border-b border-gray-200 dark:border-gray-800 flex items-center justify-between",children:[r.jsxs("div",{children:[r.jsx("p",{className:"text-lg font-semibold",children:"Согласования"}),r.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Заявки на изменение слотов и статусов"})]}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("button",{onClick:K,disabled:d||o!==null||m.length===0,className:"text-sm px-3 py-2 rounded-lg bg-emerald-600 hover:bg-emerald-700 disabled:bg-emerald-400 text-white font-semibold",children:d?"Подтверждаем...":`Принять выбранные (${m.length})`}),r.jsx("button",{onClick:P,disabled:d||o!==null||m.length===0,className:"text-sm px-3 py-2 rounded-lg bg-rose-600 hover:bg-rose-700 disabled:bg-rose-400 text-white font-semibold",children:d?"Отклоняем...":`Отклонить выбранные (${m.length})`}),r.jsx("button",{onClick:$,className:"text-sm px-3 py-2 rounded-lg bg-gray-100 hover:bg-gray-200 dark:bg-gray-800 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-200",children:"Обновить"})]})]}),f&&r.jsx("div",{className:"px-4 py-3 bg-rose-100 text-rose-900 dark:bg-rose-900/30 dark:text-rose-100 text-sm",children:f}),r.jsx("div",{className:"overflow-x-auto",children:r.jsxs("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-800 text-sm",children:[r.jsx("thead",{className:"bg-gray-50 dark:bg-gray-900/40",children:r.jsxs("tr",{children:[r.jsx("th",{className:"px-4 py-3 text-left font-semibold text-gray-700 dark:text-gray-200",children:"Статус"}),r.jsx("th",{className:"px-4 py-3 text-left font-semibold text-gray-700 dark:text-gray-200",children:"Тип"}),r.jsx("th",{className:"px-4 py-3 text-left font-semibold text-gray-700 dark:text-gray-200",children:"Действие"}),r.jsx("th",{className:"px-4 py-3 text-left font-semibold text-gray-700 dark:text-gray-200",children:"Кто"}),r.jsx("th",{className:"px-4 py-3 text-left font-semibold text-gray-700 dark:text-gray-200",children:"Изменение"}),r.jsx("th",{className:"px-4 py-3 text-left font-semibold text-gray-700 dark:text-gray-200",children:"Комментарий"}),r.jsx("th",{className:"px-4 py-3 text-left font-semibold text-gray-700 dark:text-gray-200",children:"Действия"}),r.jsx("th",{className:"px-4 py-3 text-left font-semibold text-gray-700 dark:text-gray-200",children:r.jsx("button",{onClick:L,className:"inline-flex items-center gap-1 text-sm text-[#4E6E49] hover:text-emerald-700",title:"Выбрать все на согласовании",children:t.some(D=>D.status==="pending")?r.jsxs(r.Fragment,{children:[t.filter(D=>D.status==="pending").every(D=>m.includes(D.id))?r.jsx(ss,{className:"w-4 h-4"}):r.jsx(Ko,{className:"w-4 h-4"})," Все"]}):r.jsx(Ko,{className:"w-4 h-4 opacity-50"})})})]})}),r.jsxs("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-800",children:[t.map(D=>r.jsxs("tr",{className:`bg-white dark:bg-[#0f1624] ${v4[D.status]}`,children:[r.jsx("td",{className:"px-4 py-3 align-top",children:w4[D.status]}),r.jsx("td",{className:"px-4 py-3 align-top font-semibold",children:y4[D.entity]}),r.jsx("td",{className:"px-4 py-3 align-top",children:b4[D.action]}),r.jsx("td",{className:"px-4 py-3 align-top",children:r.jsxs("div",{className:"flex flex-col gap-1",children:[r.jsx("span",{className:"font-semibold",children:r.jsx(Ls,{userId:D.targetUserId})}),r.jsxs("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:["Автор: ",r.jsx(Ls,{userId:D.authorId})]}),r.jsxs("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:["Создано: ",$a(D.createdAt)," "]})]})}),r.jsxs("td",{className:"px-4 py-3 align-top",children:[r.jsx("div",{className:"text-xs sm:text-sm font-medium",children:ee(D)}),D.after&&D.entity==="slot"&&D.after.comment&&r.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:["Комментарий слота: ",D.after.comment]}),D.after&&D.entity==="status"&&D.after.comment&&r.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:["Комментарий статуса: ",D.after.comment]})]}),r.jsxs("td",{className:"px-4 py-3 align-top",children:[r.jsx("div",{className:"text-xs sm:text-sm text-gray-700 dark:text-gray-200 whitespace-pre-wrap",children:D.comment||"—"}),D.adminComment&&r.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:["Ответ админа: ",D.adminComment]})]}),r.jsx("td",{className:"px-4 py-3 align-top",children:D.status==="pending"?r.jsxs("div",{className:"flex flex-col gap-2",children:[r.jsx("button",{onClick:()=>A(D.id),disabled:!!o,className:"px-3 py-2 rounded-lg bg-emerald-600 hover:bg-emerald-700 disabled:bg-emerald-400 text-white text-xs sm:text-sm font-semibold",children:o===D.id?"Применяем...":"Подтвердить и применить"}),r.jsx("button",{onClick:()=>T(D.id),disabled:!!o,className:"px-3 py-2 rounded-lg bg-rose-600 hover:bg-rose-700 disabled:bg-rose-400 text-white text-xs sm:text-sm font-semibold",children:o===D.id?"Отклоняем...":"Отклонить"})]}):r.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Действие выполнено"})}),r.jsx("td",{className:"px-4 py-3 align-top",children:D.status==="pending"?r.jsxs("button",{onClick:()=>S(D.id),className:"inline-flex items-center gap-1 text-sm text-[#4E6E49] hover:text-emerald-700",children:[m.includes(D.id)?r.jsx(ss,{className:"w-4 h-4"}):r.jsx(Ko,{className:"w-4 h-4"}),r.jsx("span",{className:"sr-only",children:"Выбрать заявку"})]}):r.jsx("span",{className:"text-xs text-gray-400",children:"—"})})]},D.id)),t.length===0&&r.jsx("tr",{children:r.jsx("td",{colSpan:7,className:"px-4 py-6 text-center text-sm text-gray-500 dark:text-gray-400",children:"Нет заявок на согласование"})})]})]})})]})},N4=()=>{const{isAdmin:s}=_t();return s?r.jsxs("div",{className:"max-w-6xl mx-auto px-4 sm:px-6 py-6 sm:py-8 space-y-6",children:[r.jsxs("div",{children:[r.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Администрирование"}),r.jsx("h1",{className:"text-2xl sm:text-3xl font-bold",children:"Согласования изменений"}),r.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Подтверждайте или отклоняйте изменения слотов, перерывов и статусов участников."})]}),r.jsx(k4,{})]}):r.jsx(Ii,{to:"/management",replace:!0})},j4=()=>{const{theme:s}=it(),e=s==="dark"?"text-gray-400":"text-gray-600",t=s==="dark"?"text-white":"text-gray-900",n=s==="dark"?"bg-[#10141c]":"bg-white",a="border-[#48a35e]/60",i=s==="dark"?"shadow-[0_24px_80px_rgba(0,0,0,0.45)]":"shadow-[0_24px_80px_rgba(0,0,0,0.15)]",o=s==="dark"?"bg-[#10141c]":"bg-white",c=s==="dark"?"border-[#48a35e]/60":"border-[#48a35e]/40",d=s==="dark"?"shadow-[0_24px_80px_rgba(0,0,0,0.45)]":"shadow-[0_24px_80px_rgba(0,0,0,0.1)]",h=s==="dark"?"bg-white/10 border-white/20":"bg-[#4E6E49]/10 border-[#4E6E49]/30",m=s==="dark"?"text-white":"text-[#4E6E49]",x=s==="dark"?"bg-white/10 border-white/20":"bg-gray-100 border-gray-300",f=s==="dark"?"text-white":"text-gray-800";return E.useEffect(()=>{const w=()=>{const D=document.querySelectorAll(".meme-checkbox"),k=document.getElementById("meme-progress-fill"),b=document.getElementById("meme-checked-count"),v=document.getElementById("meme-total-count"),j=document.getElementById("meme-progress-percentage");!D.length||!k||!b||!v||!j||(v.textContent=D.length.toString(),T(),D.forEach(N=>{N.addEventListener("change",$)}))},$=()=>{const D=document.querySelectorAll(".meme-checkbox"),k=document.querySelectorAll(".meme-checkbox:checked"),b=document.getElementById("meme-progress-fill"),v=document.getElementById("meme-checked-count"),j=document.getElementById("meme-progress-percentage");if(!b||!v||!j)return;const N=k.length,y=D.length,p=Math.round(N/y*100);v.textContent=N.toString(),j.textContent=p+"%",b.style.width=p+"%",D.forEach(te=>{const ue=te,le=te.closest(".meme-item");ue.checked?le==null||le.classList.add("completed"):le==null||le.classList.remove("completed")}),A()},A=()=>{const D=document.querySelectorAll(".meme-checkbox"),k={};D.forEach(b=>{const v=b;k[v.id]=v.checked}),localStorage.setItem("memeChecklistProgress",JSON.stringify(k))},T=()=>{const D=document.querySelectorAll(".meme-checkbox"),k=localStorage.getItem("memeChecklistProgress");if(k){const b=JSON.parse(k);D.forEach(v=>{var N;const j=v;b[j.id]&&(j.checked=!0,(N=j.closest(".meme-item"))==null||N.classList.add("completed"))}),K()}},K=()=>{const D=document.querySelectorAll(".meme-checkbox"),k=document.querySelectorAll(".meme-checkbox:checked"),b=document.getElementById("meme-progress-fill"),v=document.getElementById("meme-checked-count"),j=document.getElementById("meme-progress-percentage");if(!b||!v||!j)return;const N=k.length,y=D.length,p=Math.round(N/y*100);v.textContent=N.toString(),j.textContent=p+"%",b.style.width=p+"%"},P=()=>{document.querySelectorAll(".meme-checkbox").forEach(k=>{var v;const b=k;b.checked=!1,(v=b.closest(".meme-item"))==null||v.classList.remove("completed")}),localStorage.removeItem("memeChecklistProgress"),K()},S=document.getElementById("meme-reset-button");S&&S.addEventListener("click",P),document.querySelectorAll(".meme-stage-title").forEach(D=>{D.addEventListener("click",k=>{const b=k.currentTarget.closest(".meme-stage");b==null||b.scrollIntoView({behavior:"smooth",block:"start"})})});const L={threshold:.1,rootMargin:"0px 0px -50px 0px"},ee=new IntersectionObserver(D=>{D.forEach(k=>{k.isIntersecting&&k.target.setAttribute("style","opacity: 1; transform: translateY(0);")})},L);document.querySelectorAll(".meme-stage").forEach(D=>{D.setAttribute("style","opacity: 0; transform: translateY(30px); transition: opacity 0.6s ease, transform 0.6s ease;"),ee.observe(D)}),w()},[]),r.jsxs(r.Fragment,{children:[r.jsxs("div",{className:"space-y-6",children:[r.jsxs("div",{className:`relative overflow-hidden rounded-3xl border ${c} ${d} ${o}`,children:[r.jsxs("div",{className:"absolute inset-0 pointer-events-none",children:[r.jsx("div",{className:"absolute -left-16 -bottom-10 w-80 h-80 bg-emerald-500/18 blur-3xl"}),r.jsx("div",{className:`absolute inset-0 ${s==="dark"?"bg-[radial-gradient(circle_at_50%_0%,rgba(255,255,255,0.08),transparent_45%)]":"bg-[radial-gradient(circle_at_50%_0%,rgba(78,110,73,0.05),transparent_45%)]"}`})]}),r.jsx("div",{className:"relative p-6 sm:p-8 space-y-6",children:r.jsx("div",{className:"flex flex-col gap-4 lg:flex-row lg:items-start lg:justify-between",children:r.jsx("div",{className:"space-y-3 max-w-3xl",children:r.jsxs("div",{className:"flex items-start gap-3",children:[r.jsx("div",{className:`p-3 rounded-2xl ${h} ${m} shadow-inner`,children:r.jsx("span",{className:"text-2xl",children:"🐊"})}),r.jsxs("div",{className:"space-y-2",children:[r.jsx("h1",{className:`text-3xl sm:text-4xl font-black ${s==="dark"?"text-white":"text-gray-900"} leading-tight`,children:"Оценка мемкоина"}),r.jsx("p",{className:`text-sm ${s==="dark"?"text-white/70":"text-gray-600"}`,children:"Полный чек-лист проверки мемкоина. Систематический анализ для безопасного входа."}),r.jsx("div",{className:"flex flex-wrap gap-2",children:["Базовые метрики","Бандлы","Сообщество","DEV анализ"].map((w,$)=>r.jsx("span",{className:`px-4 py-1.5 rounded-full text-xs font-semibold border ${$===0?"bg-emerald-500 text-white border-emerald-300/60 shadow-md":`${x} ${f} border-gray-300`}`,children:w},w))})]})]})})})})]}),r.jsxs("div",{className:"space-y-6",children:[r.jsxs("div",{className:`meme-stage rounded-2xl p-6 sm:p-7 ${n} ${i} border ${a}`,children:[r.jsxs("div",{className:"flex flex-col gap-2 mb-6",children:[r.jsx("p",{className:`text-xs uppercase tracking-[0.12em] ${e}`,children:"Этап 1"}),r.jsx("h3",{className:`text-2xl font-bold ${t}`,children:"Базовые метрики (первичный фильтр)"}),r.jsx("p",{className:`text-sm ${e}`,children:"Убираем мусор, скам и неподходящие ранние фазы проекта."})]}),r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{className:`meme-item flex items-start gap-4 p-4 rounded-xl border ${s==="dark"?"border-white/10 bg-white/5 hover:bg-white/10":"border-gray-200 bg-gray-50 hover:bg-gray-100"} transition-all duration-200`,children:[r.jsx("input",{type:"checkbox",id:"meme-1-1",className:"meme-checkbox w-5 h-5 mt-1 accent-[#4E6E49] rounded flex-shrink-0"}),r.jsxs("label",{htmlFor:"meme-1-1",className:"flex-1 cursor-pointer",children:[r.jsx("strong",{className:`font-semibold block mb-2 ${t}`,children:"Market Cap"}),r.jsxs("ul",{className:`space-y-1 text-sm ${e}`,children:[r.jsx("li",{children:"• Капа ≤ 100k (оптимально 20–80k)."}),r.jsx("li",{children:"• Резкий скачок капы на старте без реальной ликвидности — минус."})]})]})]}),r.jsxs("div",{className:"meme-item flex items-start gap-4 p-4 rounded-xl ${theme === 'dark' ? 'border-white/10 bg-white/5 hover:bg-white/10' : 'border-gray-200 bg-gray-50 hover:bg-gray-100'} transition-all duration-200",children:[r.jsx("input",{type:"checkbox",id:"meme-1-2",className:"meme-checkbox w-5 h-5 mt-1 accent-[#4E6E49] rounded flex-shrink-0"}),r.jsxs("label",{htmlFor:"meme-1-2",className:"flex-1 cursor-pointer",children:[r.jsx("strong",{className:`font-semibold block mb-2 ${t}`,children:"Объём торгов"}),r.jsxs("ul",{className:`space-y-1 text-sm ${e}`,children:[r.jsx("li",{children:"• Объём > капы в 1.5–2 раза (лучше 2.5–3)."}),r.jsx("li",{children:"• Проверить синхронность: объём должен совпадать с движением цены."})]})]})]}),r.jsxs("div",{className:"meme-item flex items-start gap-4 p-4 rounded-xl ${theme === 'dark' ? 'border-white/10 bg-white/5 hover:bg-white/10' : 'border-gray-200 bg-gray-50 hover:bg-gray-100'} transition-all duration-200",children:[r.jsx("input",{type:"checkbox",id:"meme-1-3",className:"meme-checkbox w-5 h-5 mt-1 accent-[#4E6E49] rounded flex-shrink-0"}),r.jsxs("label",{htmlFor:"meme-1-3",className:"flex-1 cursor-pointer",children:[r.jsx("strong",{className:`font-semibold block mb-2 ${t}`,children:"Холдеры"}),r.jsxs("ul",{className:`space-y-1 text-sm ${e}`,children:[r.jsx("li",{children:"• Рост холдеров стабильный, без искусственных всплесков."}),r.jsx("li",{children:"• Проверить уникальность кошельков."})]})]})]}),r.jsxs("div",{className:"meme-item flex items-start gap-4 p-4 rounded-xl ${theme === 'dark' ? 'border-white/10 bg-white/5 hover:bg-white/10' : 'border-gray-200 bg-gray-50 hover:bg-gray-100'} transition-all duration-200",children:[r.jsx("input",{type:"checkbox",id:"meme-1-4",className:"meme-checkbox w-5 h-5 mt-1 accent-[#4E6E49] rounded flex-shrink-0"}),r.jsxs("label",{htmlFor:"meme-1-4",className:"flex-1 cursor-pointer",children:[r.jsx("strong",{className:`font-semibold block mb-2 ${t}`,children:"График"}),r.jsxs("ul",{className:"text-gray-700 dark:text-gray-300 space-y-1 text-sm",children:[r.jsx("li",{children:"• Органичный график, без параболического роста."}),r.jsx("li",{children:"• Нет вертикальных ракет на старте."})]})]})]}),r.jsxs("div",{className:"meme-item flex items-start gap-4 p-4 rounded-xl ${theme === 'dark' ? 'border-white/10 bg-white/5 hover:bg-white/10' : 'border-gray-200 bg-gray-50 hover:bg-gray-100'} transition-all duration-200",children:[r.jsx("input",{type:"checkbox",id:"meme-1-5",className:"meme-checkbox w-5 h-5 mt-1 accent-[#4E6E49] rounded flex-shrink-0"}),r.jsxs("label",{htmlFor:"meme-1-5",className:"flex-1 cursor-pointer",children:[r.jsx("strong",{className:`font-semibold block mb-2 ${t}`,children:"Ликвидность"}),r.jsxs("ul",{className:`space-y-1 text-sm ${e}`,children:[r.jsx("li",{children:"• Ликвидность > 15k (лучше 25–40k)."}),r.jsx("li",{children:"• Проверить соотношение ликвидности к капе."})]})]})]})]})]}),r.jsxs("div",{className:`meme-stage rounded-2xl p-6 sm:p-7 ${n} ${i} border ${a}`,children:[r.jsxs("div",{className:"flex flex-col gap-2 mb-6",children:[r.jsx("p",{className:`text-xs uppercase tracking-[0.12em] ${e}`,children:"Этап 2"}),r.jsx("h3",{className:`text-2xl font-bold ${t}`,children:"Бандлы (MEV-активность)"}),r.jsx("p",{className:`text-sm ${e}`,children:"Анализ влияния бандлеров на токен и рыночную манипуляцию."})]}),r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{className:"meme-item flex items-start gap-4 p-4 rounded-xl ${theme === 'dark' ? 'border-white/10 bg-white/5 hover:bg-white/10' : 'border-gray-200 bg-gray-50 hover:bg-gray-100'} transition-all duration-200",children:[r.jsx("input",{type:"checkbox",id:"meme-2-1",className:"meme-checkbox w-5 h-5 mt-1 accent-[#4E6E49] rounded flex-shrink-0"}),r.jsxs("label",{htmlFor:"meme-2-1",className:"flex-1 cursor-pointer",children:[r.jsx("strong",{className:`font-semibold block mb-2 ${t}`,children:"Откуплено бандлами"}),r.jsx("ul",{className:`space-y-1 text-sm ${e}`,children:r.jsx("li",{children:"• ≤ 100, максимум 200 SOL за весь период."})})]})]}),r.jsxs("div",{className:"meme-item flex items-start gap-4 p-4 rounded-xl ${theme === 'dark' ? 'border-white/10 bg-white/5 hover:bg-white/10' : 'border-gray-200 bg-gray-50 hover:bg-gray-100'} transition-all duration-200",children:[r.jsx("input",{type:"checkbox",id:"meme-2-2",className:"meme-checkbox w-5 h-5 mt-1 accent-[#4E6E49] rounded flex-shrink-0"}),r.jsxs("label",{htmlFor:"meme-2-2",className:"flex-1 cursor-pointer",children:[r.jsx("strong",{className:`font-semibold block mb-2 ${t}`,children:"Остаток бандлов"}),r.jsx("ul",{className:`space-y-1 text-sm ${e}`,children:r.jsx("li",{children:"• ≤ 30 SOL."})})]})]})]})]}),r.jsxs("div",{className:`meme-stage rounded-2xl p-6 sm:p-7 ${n} ${i} border ${a}`,children:[r.jsxs("div",{className:"flex flex-col gap-2 mb-6",children:[r.jsx("p",{className:`text-xs uppercase tracking-[0.12em] ${e}`,children:"Этап 3"}),r.jsx("h3",{className:`text-2xl font-bold ${t}`,children:"Сообщество и социальные сети"}),r.jsx("p",{className:`text-sm ${e}`,children:"Проверка органичности сообщества и качества информационного поля."})]}),r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{className:"meme-item flex items-start gap-4 p-4 rounded-xl ${theme === 'dark' ? 'border-white/10 bg-white/5 hover:bg-white/10' : 'border-gray-200 bg-gray-50 hover:bg-gray-100'} transition-all duration-200",children:[r.jsx("input",{type:"checkbox",id:"meme-3-1",className:"meme-checkbox w-5 h-5 mt-1 accent-[#4E6E49] rounded flex-shrink-0"}),r.jsxs("label",{htmlFor:"meme-3-1",className:"flex-1 cursor-pointer",children:[r.jsx("strong",{className:`font-semibold block mb-2 ${t}`,children:"Twitter"}),r.jsxs("ul",{className:`space-y-1 text-sm ${e}`,children:[r.jsx("li",{children:"• Посты каждые 1–3 минуты в первые часы."}),r.jsx("li",{children:"• Рост подписчиков органичный."})]})]})]}),r.jsxs("div",{className:"meme-item flex items-start gap-4 p-4 rounded-xl ${theme === 'dark' ? 'border-white/10 bg-white/5 hover:bg-white/10' : 'border-gray-200 bg-gray-50 hover:bg-gray-100'} transition-all duration-200",children:[r.jsx("input",{type:"checkbox",id:"meme-3-2",className:"meme-checkbox w-5 h-5 mt-1 accent-[#4E6E49] rounded flex-shrink-0"}),r.jsxs("label",{htmlFor:"meme-3-2",className:"flex-1 cursor-pointer",children:[r.jsx("strong",{className:`font-semibold block mb-2 ${t}`,children:"Сайт"}),r.jsx("ul",{className:`space-y-1 text-sm ${e}`,children:r.jsx("li",{children:"• Дизайн прикольный, ссылки рабочие."})})]})]})]})]}),r.jsxs("div",{className:`meme-stage rounded-2xl p-6 sm:p-7 ${n} ${i} border ${a}`,children:[r.jsxs("div",{className:"flex flex-col gap-2 mb-6",children:[r.jsx("p",{className:`text-xs uppercase tracking-[0.12em] ${e}`,children:"Этап 4"}),r.jsx("h3",{className:`text-2xl font-bold ${t}`,children:"DEV и контракт"}),r.jsx("p",{className:`text-sm ${e}`,children:"Исключение манипуляций, контроль и потенциальный скам."})]}),r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{className:"meme-item flex items-start gap-4 p-4 rounded-xl ${theme === 'dark' ? 'border-white/10 bg-white/5 hover:bg-white/10' : 'border-gray-200 bg-gray-50 hover:bg-gray-100'} transition-all duration-200",children:[r.jsx("input",{type:"checkbox",id:"meme-4-1",className:"meme-checkbox w-5 h-5 mt-1 accent-[#4E6E49] rounded flex-shrink-0"}),r.jsxs("label",{htmlFor:"meme-4-1",className:"flex-1 cursor-pointer",children:[r.jsx("strong",{className:`font-semibold block mb-2 ${t}`,children:"Активность DEV"}),r.jsxs("ul",{className:`space-y-1 text-sm ${e}`,children:[r.jsx("li",{children:"• Продал ли DEV: если да, то как много и в какой фазе."}),r.jsx("li",{children:"• Что делает DEV сейчас: покупки, сливы, пополнение ликвы?"})]})]})]}),r.jsxs("div",{className:"meme-item flex items-start gap-4 p-4 rounded-xl ${theme === 'dark' ? 'border-white/10 bg-white/5 hover:bg-white/10' : 'border-gray-200 bg-gray-50 hover:bg-gray-100'} transition-all duration-200",children:[r.jsx("input",{type:"checkbox",id:"meme-4-2",className:"meme-checkbox w-5 h-5 mt-1 accent-[#4E6E49] rounded flex-shrink-0"}),r.jsxs("label",{htmlFor:"meme-4-2",className:"flex-1 cursor-pointer",children:[r.jsx("strong",{className:`font-semibold block mb-2 ${t}`,children:"История монет DEV"}),r.jsxs("ul",{className:`space-y-1 text-sm ${e}`,children:[r.jsx("li",{children:"• Создавал ли ранее токены."}),r.jsx("li",{children:"• Как они себя вели (пампы/дампы, длительность жизни)."})]})]})]}),r.jsxs("div",{className:"meme-item flex items-start gap-4 p-4 rounded-xl ${theme === 'dark' ? 'border-white/10 bg-white/5 hover:bg-white/10' : 'border-gray-200 bg-gray-50 hover:bg-gray-100'} transition-all duration-200",children:[r.jsx("input",{type:"checkbox",id:"meme-4-3",className:"meme-checkbox w-5 h-5 mt-1 accent-[#4E6E49] rounded flex-shrink-0"}),r.jsxs("label",{htmlFor:"meme-4-3",className:"flex-1 cursor-pointer",children:[r.jsx("strong",{className:`font-semibold block mb-2 ${t}`,children:"Токены DEV"}),r.jsx("ul",{className:`space-y-1 text-sm ${e}`,children:r.jsx("li",{children:"• Если перевёл более 15% — высокий риск."})})]})]}),r.jsxs("div",{className:"meme-item flex items-start gap-4 p-4 rounded-xl ${theme === 'dark' ? 'border-white/10 bg-white/5 hover:bg-white/10' : 'border-gray-200 bg-gray-50 hover:bg-gray-100'} transition-all duration-200",children:[r.jsx("input",{type:"checkbox",id:"meme-4-4",className:"meme-checkbox w-5 h-5 mt-1 accent-[#4E6E49] rounded flex-shrink-0"}),r.jsxs("label",{htmlFor:"meme-4-4",className:"flex-1 cursor-pointer",children:[r.jsx("strong",{className:`font-semibold block mb-2 ${t}`,children:"Безопасность контракта"}),r.jsxs("ul",{className:`space-y-1 text-sm ${e}`,children:[r.jsx("li",{children:"• Mint отключён."}),r.jsx("li",{children:"• Freeze отключён."}),r.jsx("li",{children:"• Trading limits отключены."}),r.jsx("li",{children:"• Владелец LP — сожжён или передан в отказ (renounce)."})]})]})]}),r.jsxs("div",{className:"meme-item flex items-start gap-4 p-4 rounded-xl ${theme === 'dark' ? 'border-white/10 bg-white/5 hover:bg-white/10' : 'border-gray-200 bg-gray-50 hover:bg-gray-100'} transition-all duration-200",children:[r.jsx("input",{type:"checkbox",id:"meme-4-5",className:"meme-checkbox w-5 h-5 mt-1 accent-[#4E6E49] rounded flex-shrink-0"}),r.jsxs("label",{htmlFor:"meme-4-5",className:"flex-1 cursor-pointer",children:[r.jsx("strong",{className:`font-semibold block mb-2 ${t}`,children:"Curve-Manipulation Check"}),r.jsxs("ul",{className:`space-y-1 text-sm ${e}`,children:[r.jsx("li",{children:"• Нет скрытых функций, влияющих на цену."}),r.jsx("li",{children:"• Проверить контракт на сторонних аудит-ботах."})]})]})]})]})]}),r.jsxs("div",{className:`meme-stage rounded-2xl p-6 sm:p-7 ${n} ${i} border ${a}`,children:[r.jsxs("div",{className:"flex flex-col gap-2 mb-6",children:[r.jsx("p",{className:`text-xs uppercase tracking-[0.12em] ${e}`,children:"Этап 5"}),r.jsx("h3",{className:`text-2xl font-bold ${t}`,children:"Распределение холдеров"}),r.jsx("p",{className:`text-sm ${e}`,children:"Убедиться, что флоат распределён и нет доминирующих кластеров."})]}),r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{className:"meme-item flex items-start gap-4 p-4 rounded-xl ${theme === 'dark' ? 'border-white/10 bg-white/5 hover:bg-white/10' : 'border-gray-200 bg-gray-50 hover:bg-gray-100'} transition-all duration-200",children:[r.jsx("input",{type:"checkbox",id:"meme-5-1",className:"meme-checkbox w-5 h-5 mt-1 accent-[#4E6E49] rounded flex-shrink-0"}),r.jsxs("label",{htmlFor:"meme-5-1",className:"flex-1 cursor-pointer",children:[r.jsx("strong",{className:`font-semibold block mb-2 ${t}`,children:"Топ-кошельки"}),r.jsxs("ul",{className:`space-y-1 text-sm ${e}`,children:[r.jsx("li",{children:"• Топ-держатели ≤ 5–7%."}),r.jsx("li",{children:"• Оптимально: ранний лидер имеет не более 3–4%."})]})]})]}),r.jsxs("div",{className:"meme-item flex items-start gap-4 p-4 rounded-xl ${theme === 'dark' ? 'border-white/10 bg-white/5 hover:bg-white/10' : 'border-gray-200 bg-gray-50 hover:bg-gray-100'} transition-all duration-200",children:[r.jsx("input",{type:"checkbox",id:"meme-5-2",className:"meme-checkbox w-5 h-5 mt-1 accent-[#4E6E49] rounded flex-shrink-0"}),r.jsxs("label",{htmlFor:"meme-5-2",className:"flex-1 cursor-pointer",children:[r.jsx("strong",{className:`font-semibold block mb-2 ${t}`,children:"Кластеры"}),r.jsxs("ul",{className:`space-y-1 text-sm ${e}`,children:[r.jsx("li",{children:"• Нет крупных связанных кошельков."}),r.jsx("li",{children:'• Нет "пачек" кошельков, созданных в одну минуту.'})]})]})]}),r.jsxs("div",{className:"meme-item flex items-start gap-4 p-4 rounded-xl ${theme === 'dark' ? 'border-white/10 bg-white/5 hover:bg-white/10' : 'border-gray-200 bg-gray-50 hover:bg-gray-100'} transition-all duration-200",children:[r.jsx("input",{type:"checkbox",id:"meme-5-3",className:"meme-checkbox w-5 h-5 mt-1 accent-[#4E6E49] rounded flex-shrink-0"}),r.jsxs("label",{htmlFor:"meme-5-3",className:"flex-1 cursor-pointer",children:[r.jsx("strong",{className:`font-semibold block mb-2 ${t}`,children:"Фермы"}),r.jsxs("ul",{className:`space-y-1 text-sm ${e}`,children:[r.jsx("li",{children:"• Фермы не перегружены."}),r.jsx("li",{children:"• Нет пачки фармеров с одинаковой стратегией."})]})]})]}),r.jsxs("div",{className:"meme-item flex items-start gap-4 p-4 rounded-xl ${theme === 'dark' ? 'border-white/10 bg-white/5 hover:bg-white/10' : 'border-gray-200 bg-gray-50 hover:bg-gray-100'} transition-all duration-200",children:[r.jsx("input",{type:"checkbox",id:"meme-5-4",className:"meme-checkbox w-5 h-5 mt-1 accent-[#4E6E49] rounded flex-shrink-0"}),r.jsxs("label",{htmlFor:"meme-5-4",className:"flex-1 cursor-pointer",children:[r.jsx("strong",{className:`font-semibold block mb-2 ${t}`,children:"PNL/RPL-анализ"}),r.jsx("ul",{className:`space-y-1 text-sm ${e}`,children:r.jsx("li",{children:"• Холдеры не сидят в прибыли 4–5х (сливы неизбежны)."})})]})]}),r.jsxs("div",{className:"meme-item flex items-start gap-4 p-4 rounded-xl ${theme === 'dark' ? 'border-white/10 bg-white/5 hover:bg-white/10' : 'border-gray-200 bg-gray-50 hover:bg-gray-100'} transition-all duration-200",children:[r.jsx("input",{type:"checkbox",id:"meme-5-5",className:"meme-checkbox w-5 h-5 mt-1 accent-[#4E6E49] rounded flex-shrink-0"}),r.jsxs("label",{htmlFor:"meme-5-5",className:"flex-1 cursor-pointer",children:[r.jsx("strong",{className:`font-semibold block mb-2 ${t}`,children:"Активность торговли"}),r.jsxs("ul",{className:`space-y-1 text-sm ${e}`,children:[r.jsx("li",{children:"• Нет торговли только команды."}),r.jsx("li",{children:"• Есть новые кошельки."}),r.jsx("li",{children:"• Нет явного копитрейдинга."})]})]})]}),r.jsxs("div",{className:"meme-item flex items-start gap-4 p-4 rounded-xl ${theme === 'dark' ? 'border-white/10 bg-white/5 hover:bg-white/10' : 'border-gray-200 bg-gray-50 hover:bg-gray-100'} transition-all duration-200",children:[r.jsx("input",{type:"checkbox",id:"meme-5-6",className:"meme-checkbox w-5 h-5 mt-1 accent-[#4E6E49] rounded flex-shrink-0"}),r.jsxs("label",{htmlFor:"meme-5-6",className:"flex-1 cursor-pointer",children:[r.jsx("strong",{className:`font-semibold block mb-2 ${t}`,children:"Время удержания токена"}),r.jsx("ul",{className:`space-y-1 text-sm ${e}`,children:r.jsx("li",{children:"• Если все держат ≤3 минут — чистый скальпинг, можно словить дамп."})})]})]})]})]}),r.jsxs("div",{className:`meme-stage rounded-2xl p-6 sm:p-7 ${n} ${i} border ${a}`,children:[r.jsxs("div",{className:"flex flex-col gap-2 mb-6",children:[r.jsx("p",{className:`text-xs uppercase tracking-[0.12em] ${e}`,children:"Этап 6"}),r.jsx("h3",{className:`text-2xl font-bold ${t}`,children:"Технический вход"}),r.jsx("p",{className:`text-sm ${e}`,children:"Войти по адекватной цене после фильтрации ончейн-данных."})]}),r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{className:"meme-item flex items-start gap-4 p-4 rounded-xl ${theme === 'dark' ? 'border-white/10 bg-white/5 hover:bg-white/10' : 'border-gray-200 bg-gray-50 hover:bg-gray-100'} transition-all duration-200",children:[r.jsx("input",{type:"checkbox",id:"meme-6-1",className:"meme-checkbox w-5 h-5 mt-1 accent-[#4E6E49] rounded flex-shrink-0"}),r.jsxs("label",{htmlFor:"meme-6-1",className:"flex-1 cursor-pointer",children:[r.jsx("strong",{className:`font-semibold block mb-2 ${t}`,children:"Фибо"}),r.jsx("ul",{className:`space-y-1 text-sm ${e}`,children:r.jsx("li",{children:"• Строим сетку по ключевому импульсу."})})]})]}),r.jsxs("div",{className:"meme-item flex items-start gap-4 p-4 rounded-xl ${theme === 'dark' ? 'border-white/10 bg-white/5 hover:bg-white/10' : 'border-gray-200 bg-gray-50 hover:bg-gray-100'} transition-all duration-200",children:[r.jsx("input",{type:"checkbox",id:"meme-6-2",className:"meme-checkbox w-5 h-5 mt-1 accent-[#4E6E49] rounded flex-shrink-0"}),r.jsxs("label",{htmlFor:"meme-6-2",className:"flex-1 cursor-pointer",children:[r.jsx("strong",{className:`font-semibold block mb-2 ${t}`,children:"Уровни"}),r.jsx("ul",{className:`space-y-1 text-sm ${e}`,children:r.jsx("li",{children:"• Совпадение 0.5/0.618/0.702 с зонами проторговки."})})]})]}),r.jsxs("div",{className:"meme-item flex items-start gap-4 p-4 rounded-xl ${theme === 'dark' ? 'border-white/10 bg-white/5 hover:bg-white/10' : 'border-gray-200 bg-gray-50 hover:bg-gray-100'} transition-all duration-200",children:[r.jsx("input",{type:"checkbox",id:"meme-6-3",className:"meme-checkbox w-5 h-5 mt-1 accent-[#4E6E49] rounded flex-shrink-0"}),r.jsxs("label",{htmlFor:"meme-6-3",className:"flex-1 cursor-pointer",children:[r.jsx("strong",{className:`font-semibold block mb-2 ${t}`,children:"Вход"}),r.jsx("ul",{className:`space-y-1 text-sm ${e}`,children:r.jsx("li",{children:"• 50–70% откат от локального хая."})})]})]}),r.jsxs("div",{className:"meme-item flex items-start gap-4 p-4 rounded-xl ${theme === 'dark' ? 'border-white/10 bg-white/5 hover:bg-white/10' : 'border-gray-200 bg-gray-50 hover:bg-gray-100'} transition-all duration-200",children:[r.jsx("input",{type:"checkbox",id:"meme-6-4",className:"meme-checkbox w-5 h-5 mt-1 accent-[#4E6E49] rounded flex-shrink-0"}),r.jsxs("label",{htmlFor:"meme-6-4",className:"flex-1 cursor-pointer",children:[r.jsx("strong",{className:`font-semibold block mb-2 ${t}`,children:"Дополнительно"}),r.jsxs("ul",{className:`space-y-1 text-sm ${e}`,children:[r.jsx("li",{children:"• Проверить, есть ли ликвидность на уровнях покупок."}),r.jsx("li",{children:"• Проверить объёмы на откате: ослабление продавцов."}),r.jsx("li",{children:"• Проверить, не обновляет ли токен лоу (в таком случае вход отменяется)."})]})]})]})]})]}),r.jsxs("div",{className:`meme-stage rounded-2xl p-6 sm:p-7 ${n} ${i} border ${a}`,children:[r.jsxs("div",{className:"flex flex-col gap-2 mb-6",children:[r.jsx("p",{className:`text-xs uppercase tracking-[0.12em] ${e}`,children:"Этап 7"}),r.jsx("h3",{className:`text-2xl font-bold ${t}`,children:"Анализ риска"}),r.jsx("p",{className:`text-sm ${e}`,children:"Формализовать риск-менеджмент."})]}),r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{className:"meme-item flex items-start gap-4 p-4 rounded-xl ${theme === 'dark' ? 'border-white/10 bg-white/5 hover:bg-white/10' : 'border-gray-200 bg-gray-50 hover:bg-gray-100'} transition-all duration-200",children:[r.jsx("input",{type:"checkbox",id:"meme-7-1",className:"meme-checkbox w-5 h-5 mt-1 accent-[#4E6E49] rounded flex-shrink-0"}),r.jsxs("label",{htmlFor:"meme-7-1",className:"flex-1 cursor-pointer",children:[r.jsx("strong",{className:`font-semibold block mb-2 ${t}`,children:"Стоп-логика"}),r.jsxs("ul",{className:`space-y-1 text-sm ${e}`,children:[r.jsx("li",{children:"• Стоп по структуре (обновление локального лоу)."}),r.jsx("li",{children:"• Стоп по ончейн-сигналу (DEV слил, появились новые бандлы, появились киты)."})]})]})]}),r.jsxs("div",{className:"meme-item flex items-start gap-4 p-4 rounded-xl ${theme === 'dark' ? 'border-white/10 bg-white/5 hover:bg-white/10' : 'border-gray-200 bg-gray-50 hover:bg-gray-100'} transition-all duration-200",children:[r.jsx("input",{type:"checkbox",id:"meme-7-2",className:"meme-checkbox w-5 h-5 mt-1 accent-[#4E6E49] rounded flex-shrink-0"}),r.jsxs("label",{htmlFor:"meme-7-2",className:"flex-1 cursor-pointer",children:[r.jsx("strong",{className:`font-semibold block mb-2 ${t}`,children:"Целевые зоны"}),r.jsx("ul",{className:`space-y-1 text-sm ${e}`,children:r.jsx("li",{children:"• Минимум 2 стратегии выхода: частичный выход на 1.5–2х, остальное — трейл."})})]})]})]})]}),r.jsxs("div",{className:`meme-stage rounded-2xl p-6 sm:p-7 ${n} ${i} border ${a}`,children:[r.jsxs("div",{className:"flex flex-col gap-2 mb-6",children:[r.jsx("p",{className:`text-xs uppercase tracking-[0.12em] ${e}`,children:"Напоминание"}),r.jsx("h3",{className:`text-2xl font-bold ${t}`,children:"Ключевые правила входа в сделки"}),r.jsx("p",{className:`text-sm ${e}`,children:"Трейдинг-дисциплина превыше всего."})]}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[r.jsxs("div",{className:`meme-item flex items-start gap-3 p-4 rounded-xl ${s==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-gray-50"}`,children:[r.jsx(qt,{className:"w-6 h-6 text-[#4E6E49]"}),r.jsxs("div",{children:[r.jsx("strong",{className:`font-semibold block mb-1 ${t}`,children:"Уровни Фибоначчи"}),r.jsx("p",{className:`text-sm ${e}`,children:"Заходим только когда уровни поддержки совпадают с зоной проторговки и на прошлом уровне были высокие объёмы."})]})]}),r.jsxs("div",{className:`meme-item flex items-start gap-3 p-4 rounded-xl ${s==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-gray-50"}`,children:[r.jsx(er,{className:"w-6 h-6 text-[#4E6E49]"}),r.jsxs("div",{children:[r.jsx("strong",{className:`font-semibold block mb-1 ${t}`,children:"Зона входа"}),r.jsx("p",{className:`text-sm ${e}`,children:"Преимущественно заходим в канале 0.7, в идеале — строго от линии 0.7."})]})]}),r.jsxs("div",{className:`meme-item flex items-start gap-3 p-4 rounded-xl ${s==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-gray-50"}`,children:[r.jsx(Ma,{className:"w-6 h-6 text-[#4E6E49]"}),r.jsxs("div",{children:[r.jsx("strong",{className:`font-semibold block mb-1 ${t}`,children:"Stop Loss"}),r.jsx("p",{className:`text-sm ${e}`,children:"Устанавливаем от линии 0.7 до 50% от позиции в зависимости от волатильности."})]})]}),r.jsxs("div",{className:`meme-item flex items-start gap-3 p-4 rounded-xl ${s==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-gray-50"}`,children:[r.jsx(Ut,{className:"w-6 h-6 text-[#4E6E49]"}),r.jsxs("div",{children:[r.jsx("strong",{className:`font-semibold block mb-1 ${t}`,children:"Альтернативный вход"}),r.jsx("p",{className:`text-sm ${e}`,children:"Допустимо заходить по уровню 0.6, но только при наличии активного роста холдеров."})]})]}),r.jsxs("div",{className:`meme-item flex items-start gap-3 p-4 rounded-xl ${s==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-gray-50"}`,children:[r.jsx(Pa,{className:"w-6 h-6 text-[#4E6E49]"}),r.jsxs("div",{children:[r.jsx("strong",{className:`font-semibold block mb-1 ${t}`,children:"Сигнал роста"}),r.jsx("p",{className:`text-sm ${e}`,children:"Рост холдеров при сильной поддержке = высокая вероятность скачка вверх."})]})]}),r.jsxs("div",{className:`meme-item flex items-start gap-3 p-4 rounded-xl ${s==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-gray-50"}`,children:[r.jsx(Tn,{className:"w-6 h-6 text-[#4E6E49]"}),r.jsxs("div",{children:[r.jsx("strong",{className:`font-semibold block mb-1 ${t}`,children:"Take Profit"}),r.jsx("p",{className:`text-sm ${e}`,children:"Целевые зоны 30-45% от входа, шаг фиксации прибыли — 12%."})]})]}),r.jsxs("div",{className:`meme-item flex items-start gap-3 p-4 rounded-xl ${s==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-gray-50"}`,children:[r.jsx(fx,{className:"w-6 h-6 text-[#4E6E49]"}),r.jsxs("div",{children:[r.jsx("strong",{className:`font-semibold block mb-1 ${t}`,children:"Правило выхода"}),r.jsx("p",{className:`text-sm ${e}`,children:"По общему правилу фиксируем максимум на 70-80% позиции, если токен продолжает движение — выходим в оранжевой зоне Фибоначчи."})]})]}),r.jsxs("div",{className:`meme-item flex items-start gap-3 p-4 rounded-xl ${s==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-gray-50"}`,children:[r.jsx(Dr,{className:"w-6 h-6 text-[#4E6E49]"}),r.jsxs("div",{children:[r.jsx("strong",{className:`font-semibold block mb-1 ${t}`,children:"Тайминг входа"}),r.jsx("p",{className:`text-sm ${e}`,children:"Помните, что в токен лучше заходить спустя 10-15 минут от миграции, чтобы избежать ранних рисков."})]})]}),r.jsxs("div",{className:`meme-item flex items-start gap-3 p-4 rounded-xl ${s==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-gray-50"}`,children:[r.jsx(lx,{className:"w-6 h-6 text-[#4E6E49]"}),r.jsxs("div",{children:[r.jsx("strong",{className:`font-semibold block mb-1 ${t}`,children:"Минимальные суммы"}),r.jsx("p",{className:`text-sm ${e}`,children:"Старайтесь проверять токен минимальными суммами, если не уверены — достаточно 10-15 секунд анализа."})]})]}),r.jsxs("div",{className:`meme-item flex items-start gap-3 p-4 rounded-xl ${s==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-gray-50"}`,children:[r.jsx(ec,{className:"w-6 h-6 text-[#4E6E49]"}),r.jsxs("div",{children:[r.jsx("strong",{className:`font-semibold block mb-1 ${t}`,children:"Сервисы проверки"}),r.jsxs("p",{className:`text-sm ${e}`,children:["Используйте для анализа: ",r.jsx("a",{href:"https://rugcheck.xyz",className:"underline text-[#4E6E49]",target:"_blank",children:"rugcheck.xyz"})," и ",r.jsx("a",{href:"https://gmgn.ai/?chain=sol",className:"underline text-[#4E6E49]",target:"_blank",children:"gmgn.ai"})]})]})]})]})]}),r.jsxs("div",{className:`rounded-2xl p-6 sm:p-7 ${n} ${i} border ${a}`,children:[r.jsxs("div",{className:"flex flex-col gap-2 mb-4",children:[r.jsx("p",{className:`text-xs uppercase tracking-[0.12em] ${e}`,children:"Прогресс"}),r.jsx("h3",{className:`text-2xl font-bold ${t}`,children:"Состояние проверки"}),r.jsx("p",{className:`text-sm ${e}`,children:"Отмечайте выполненные пункты для отслеживания прогресса анализа."})]}),r.jsxs("div",{className:"space-y-6",children:[r.jsxs("div",{className:"text-center",children:[r.jsx("div",{id:"meme-progress-percentage",className:"text-6xl font-bold text-[#4E6E49] mb-2",children:"0%"}),r.jsx("p",{className:`text-sm ${e}`,children:"завершено"})]}),r.jsx("div",{className:`w-full h-8 ${s==="dark"?"bg-white/5":"bg-gray-200"} rounded-full overflow-hidden border ${s==="dark"?"border-white/10":"border-gray-300"}`,children:r.jsx("div",{id:"meme-progress-fill",className:"h-full bg-gradient-to-r from-[#4E6E49] to-[#6b8f5f] transition-all duration-800 ease-out relative",children:r.jsx("div",{className:"absolute right-3 top-1/2 -translate-y-1/2 text-white text-sm opacity-0 animate-pulse",children:"🐊"})})}),r.jsx("div",{className:"flex items-center justify-between text-center",children:r.jsxs("div",{className:"flex-1",children:[r.jsxs("div",{className:`text-2xl font-bold ${t}`,children:[r.jsx("span",{id:"meme-checked-count",children:"0"}),r.jsx("span",{className:`text-sm ${e} ml-1`,children:"из"}),r.jsx("span",{id:"meme-total-count",className:`text-sm ${e} ml-1`,children:"0"})]}),r.jsx("p",{className:`text-xs ${e} mt-1`,children:"пунктов выполнено"})]})}),r.jsx("div",{className:"flex justify-center",children:r.jsxs("button",{id:"meme-reset-button",className:`px-6 py-3 rounded-xl transition-all duration-200 border ${s==="dark"?"border-rose-300/60 bg-rose-500/20 text-rose-50 hover:bg-rose-500/30":"border-rose-400 bg-rose-50 text-rose-700 hover:bg-rose-100"} font-semibold flex items-center gap-2`,children:[r.jsx("span",{children:"🗑️"}),r.jsx("span",{children:"Сбросить прогресс"})]})})]})]})]})]}),r.jsx("style",{children:`
        .completed {
          background: rgba(255, 255, 255, 0.1) !important;
          border-color: #4E6E49 !important;
        }

        .meme-item.completed strong {
          color: #4E6E49 !important;
        }

        .meme-checkbox:checked {
          background-color: #4E6E49;
          border-color: #4E6E49;
        }

        .meme-checkbox:checked::after {
          content: '🐊';
          position: absolute;
          top: 50%;
          left: 50%;
          transform: translate(-50%, -50%);
          font-size: 12px;
          color: white;
        }
      `})]})},_4=()=>{const{theme:s}=it(),{user:e}=bt(),[t,n]=E.useState([]),[a,i]=E.useState(!0),[o,c]=E.useState(!1),[d,h]=E.useState(null),[m,x]=E.useState(null),[f,w]=E.useState(!1),[$,A]=E.useState(!1),[T,K]=E.useState({signalDate:new Date().toISOString().split("T")[0],signalTime:new Date().toLocaleTimeString("ru-RU",{hour:"2-digit",minute:"2-digit"}),marketCap:"",address:"",maxDrop:"",maxProfit:"",comment:""}),P=s==="dark"?"text-gray-400":"text-gray-600",S=s==="dark"?"text-white":"text-gray-900",L=s==="dark"?"bg-[#10141c]":"bg-white",ee=s==="dark"?"border-[#48a35e]/30":"border-[#48a35e]/20",D=s==="dark"?"shadow-[0_24px_80px_rgba(0,0,0,0.45)]":"shadow-[0_24px_80px_rgba(0,0,0,0.15)]";E.useEffect(()=>{k()},[]);const k=async()=>{try{const te=await Aj();n(te)}catch(te){console.error("Error loading alerts:",te)}finally{i(!1)}},b=(te,ue)=>{navigator.clipboard.writeText(te),x(ue),setTimeout(()=>x(null),2e3)},v=()=>{const te=t.map(le=>`${le.signalDate}	${le.signalTime}	${le.marketCap||"-"}	${le.address}	${le.maxDrop||"-"}	${le.maxProfit||"-"}	${le.comment||""}`).join(`
`);navigator.clipboard.writeText(`Дата	Время	Market Cap	Адрес	Макс. Падение	Макс. Профит	Комментарий
`+te),w(!0),setTimeout(()=>w(!1),2e3)},j=()=>{const te=`
      <table border="1">
        <thead>
          <tr>
            <th>Дата</th>
            <th>Время</th>
            <th>Market Cap</th>
            <th>Адрес</th>
            <th>Макс. Падение</th>
            <th>Макс. Профит</th>
            <th>Комментарий</th>
          </tr>
        </thead>
        <tbody>
          ${t.map(ne=>`
            <tr>
              <td>${ne.signalDate}</td>
              <td>${ne.signalTime}</td>
              <td>${ne.marketCap||"-"}</td>
              <td>${ne.address}</td>
              <td>${ne.maxDrop||"-"}</td>
              <td>${ne.maxProfit||"-"}</td>
              <td>${ne.comment||""}</td>
            </tr>
          `).join("")}
        </tbody>
      </table>
    `,ue="text/html",le=new Blob([te],{type:ue}),H=[new ClipboardItem({[ue]:le})];navigator.clipboard.write(H),A(!0),setTimeout(()=>A(!1),2e3)},N=async te=>{if(confirm("Удалить алерт?"))try{await $j(te),await k()}catch(ue){console.error("Error deleting alert:",ue)}},y=te=>{h(te),K(te),c(!0)},p=async te=>{te.preventDefault();try{d?await Dj(d.id,T):await Cj({...T,createdAt:new Date().toISOString(),createdBy:(e==null?void 0:e.id)||"admin"}),c(!1),h(null),K({signalDate:new Date().toISOString().split("T")[0],signalTime:new Date().toLocaleTimeString("ru-RU",{hour:"2-digit",minute:"2-digit"}),marketCap:"",address:"",maxDrop:"",maxProfit:"",comment:""}),await k()}catch(ue){console.error("Error saving alert:",ue)}};return r.jsxs(r.Fragment,{children:[r.jsxs("div",{className:"space-y-6",children:[r.jsxs("div",{className:`relative overflow-hidden rounded-3xl border ${ee} ${D} ${L}`,children:[r.jsxs("div",{className:"absolute inset-0 pointer-events-none",children:[r.jsx("div",{className:"absolute -left-16 -bottom-10 w-80 h-80 bg-emerald-500/10 blur-3xl"}),r.jsx("div",{className:`absolute inset-0 ${s==="dark"?"bg-[radial-gradient(circle_at_50%_0%,rgba(255,255,255,0.05),transparent_45%)]":"bg-[radial-gradient(circle_at_50%_0%,rgba(78,110,73,0.05),transparent_45%)]"}`})]}),r.jsxs("div",{className:"relative p-6 sm:p-8 flex flex-col lg:flex-row items-stretch lg:items-center justify-between gap-6",children:[r.jsxs("div",{className:"flex items-center gap-4",children:[r.jsx("div",{className:`p-3 rounded-2xl ${s==="dark"?"bg-white/10 border-white/20":"bg-[#4E6E49]/10 border-[#4E6E49]/30"} shadow-inner`,children:r.jsx(Ox,{className:`w-8 h-8 ${s==="dark"?"text-white":"text-[#4E6E49]"}`})}),r.jsxs("div",{children:[r.jsx("h1",{className:`text-3xl font-black ${S}`,children:"AI - AO Alerts"}),r.jsx("p",{className:`text-sm ${P}`,children:"Мониторинг сигналов искусственного интеллекта"})]})]}),r.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[r.jsx("button",{onClick:v,disabled:t.length===0,className:`px-4 py-2 rounded-xl text-sm font-semibold transition-all flex items-center gap-2 border ${s==="dark"?"bg-white/5 border-white/10 hover:bg-white/10 text-gray-300":"bg-gray-100 border-gray-200 hover:bg-gray-200 text-gray-700"} disabled:opacity-50`,children:f?r.jsxs(r.Fragment,{children:[r.jsx(_r,{className:"w-4 h-4 text-green-500"}),r.jsx("span",{children:"Данные скопированы"})]}):r.jsxs(r.Fragment,{children:[r.jsx(Yh,{className:"w-4 h-4"}),r.jsx("span",{children:"Копировать данные"})]})}),r.jsx("button",{onClick:j,disabled:t.length===0,className:`px-4 py-2 rounded-xl text-sm font-semibold transition-all flex items-center gap-2 border ${s==="dark"?"bg-white/5 border-white/10 hover:bg-white/10 text-gray-300":"bg-gray-100 border-gray-200 hover:bg-gray-200 text-gray-700"} disabled:opacity-50`,children:$?r.jsxs(r.Fragment,{children:[r.jsx(_r,{className:"w-4 h-4 text-green-500"}),r.jsx("span",{children:"Таблица скопирована"})]}):r.jsxs(r.Fragment,{children:[r.jsx(Px,{className:"w-4 h-4"}),r.jsx("span",{children:"Копировать таблицу"})]})}),r.jsxs("button",{onClick:()=>{h(null),K({signalDate:new Date().toISOString().split("T")[0],signalTime:new Date().toLocaleTimeString("ru-RU",{hour:"2-digit",minute:"2-digit"})}),c(!0)},className:"px-4 py-2 rounded-xl bg-[#4E6E49] hover:bg-[#3d5a39] text-white font-semibold transition-colors flex items-center gap-2 shadow-lg shadow-[#4E6E49]/20 ml-auto",children:[r.jsx(os,{className:"w-4 h-4"}),r.jsx("span",{children:"Добавить сигнал"})]})]})]})]}),r.jsx("div",{className:`relative overflow-hidden rounded-3xl border ${ee} ${D} ${L}`,children:r.jsx("div",{className:"overflow-x-auto",children:r.jsxs("table",{className:"w-full text-left border-collapse",children:[r.jsx("thead",{children:r.jsxs("tr",{className:`border-b ${s==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-gray-50"}`,children:[r.jsx("th",{className:`p-4 text-xs uppercase tracking-wider font-semibold ${P}`,children:"Дата/Время"}),r.jsx("th",{className:`p-4 text-xs uppercase tracking-wider font-semibold ${P}`,children:"Капитализация"}),r.jsx("th",{className:`p-4 text-xs uppercase tracking-wider font-semibold ${P}`,children:"Адрес"}),r.jsx("th",{className:`p-4 text-xs uppercase tracking-wider font-semibold ${P}`,children:"Макс. Падение"}),r.jsx("th",{className:`p-4 text-xs uppercase tracking-wider font-semibold ${P}`,children:"Макс. Профит"}),r.jsx("th",{className:`p-4 text-xs uppercase tracking-wider font-semibold ${P}`,children:"Действия"})]})}),r.jsx("tbody",{className:`divide-y ${s==="dark"?"divide-white/5":"divide-gray-100"}`,children:a?r.jsx("tr",{children:r.jsx("td",{colSpan:6,className:"p-8 text-center text-gray-500",children:"Загрузка..."})}):t.length===0?r.jsx("tr",{children:r.jsx("td",{colSpan:6,className:"p-8 text-center text-gray-500",children:"Нет сигналов"})}):t.map(te=>r.jsxs("tr",{className:`${s==="dark"?"hover:bg-white/5":"hover:bg-gray-50"} transition-colors`,children:[r.jsxs("td",{className:"p-4 whitespace-nowrap",children:[r.jsx("div",{className:`font-mono font-medium ${S}`,children:te.signalDate}),r.jsx("div",{className:`text-xs ${P}`,children:te.signalTime})]}),r.jsx("td",{className:"p-4 whitespace-nowrap",children:r.jsx("div",{className:`font-mono ${S}`,children:te.marketCap||"-"})}),r.jsx("td",{className:"p-4",children:r.jsxs("div",{className:"flex items-center gap-2 max-w-[200px]",children:[r.jsx("div",{className:`truncate font-mono text-sm ${s==="dark"?"text-blue-400":"text-blue-600"}`,children:te.address}),r.jsx("button",{onClick:()=>b(te.address,te.id),className:`p-1.5 rounded-lg hover:bg-white/10 transition-colors ${P}`,children:m===te.id?r.jsx(_r,{className:"w-3 h-3 text-green-500"}):r.jsx(va,{className:"w-3 h-3"})})]})}),r.jsxs("td",{className:"p-4 whitespace-nowrap",children:[r.jsx("span",{className:`font-mono ${te.maxDrop&&te.maxDrop.startsWith("-")?"text-red-500":S}`,children:te.maxDrop||"-"}),te.comment&&r.jsx("div",{className:`text-xs ${P} mt-1`,children:te.comment})]}),r.jsx("td",{className:"p-4 whitespace-nowrap",children:r.jsx("span",{className:"font-mono text-green-500 font-bold",children:te.maxProfit||"-"})}),r.jsx("td",{className:"p-4 whitespace-nowrap",children:r.jsxs("div",{className:"flex items-center gap-1",children:[r.jsx("button",{onClick:()=>y(te),className:`p-2 rounded-lg hover:bg-white/10 transition-colors ${s==="dark"?"text-blue-400":"text-blue-600"}`,children:r.jsx(cr,{className:"w-4 h-4"})}),r.jsx("button",{onClick:()=>N(te.id),className:"p-2 rounded-lg hover:bg-red-500/10 text-red-500 transition-colors",children:r.jsx(Pt,{className:"w-4 h-4"})})]})})]},te.id))})]})})})]}),o&&r.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm",children:r.jsxs("div",{className:`w-full max-w-lg rounded-3xl ${L} ${ee} border shadow-2xl overflow-hidden`,children:[r.jsxs("div",{className:`p-6 border-b ${s==="dark"?"border-white/10":"border-gray-100"} flex items-center justify-between`,children:[r.jsx("h3",{className:`text-xl font-bold ${S}`,children:d?"Редактировать сигнал":"Новый сигнал"}),r.jsx("button",{onClick:()=>c(!1),className:`p-2 rounded-lg hover:bg-white/10 ${P}`,children:r.jsx(Rt,{className:"w-5 h-5"})})]}),r.jsxs("form",{onSubmit:p,className:"p-6 space-y-4",children:[r.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[r.jsxs("div",{className:"space-y-1",children:[r.jsx("label",{className:`text-xs font-semibold uppercase ${P}`,children:"Дата"}),r.jsx("input",{type:"date",required:!0,value:T.signalDate,onChange:te=>K({...T,signalDate:te.target.value}),className:`w-full p-3 rounded-xl border outline-none transition-all ${s==="dark"?"bg-black/30 border-white/10 text-white focus:border-[#4E6E49]":"bg-white border-gray-200 text-gray-900 focus:border-[#4E6E49]"}`})]}),r.jsxs("div",{className:"space-y-1",children:[r.jsx("label",{className:`text-xs font-semibold uppercase ${P}`,children:"Время"}),r.jsx("input",{type:"time",required:!0,value:T.signalTime,onChange:te=>K({...T,signalTime:te.target.value}),className:`w-full p-3 rounded-xl border outline-none transition-all ${s==="dark"?"bg-black/30 border-white/10 text-white focus:border-[#4E6E49]":"bg-white border-gray-200 text-gray-900 focus:border-[#4E6E49]"}`})]})]}),r.jsxs("div",{className:"space-y-1",children:[r.jsx("label",{className:`text-xs font-semibold uppercase ${P}`,children:"Адрес токена"}),r.jsx("input",{type:"text",required:!0,placeholder:"Адрес контракта...",value:T.address||"",onChange:te=>K({...T,address:te.target.value}),className:`w-full p-3 rounded-xl border outline-none transition-all font-mono text-sm ${s==="dark"?"bg-black/30 border-white/10 text-white focus:border-[#4E6E49]":"bg-white border-gray-200 text-gray-900 focus:border-[#4E6E49]"}`})]}),r.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[r.jsxs("div",{className:"space-y-1",children:[r.jsx("label",{className:`text-xs font-semibold uppercase ${P}`,children:"Market Cap"}),r.jsx("input",{type:"text",placeholder:"e.g. 300,77",value:T.marketCap||"",onChange:te=>K({...T,marketCap:te.target.value}),className:`w-full p-3 rounded-xl border outline-none transition-all ${s==="dark"?"bg-black/30 border-white/10 text-white focus:border-[#4E6E49]":"bg-white border-gray-200 text-gray-900 focus:border-[#4E6E49]"}`})]}),r.jsxs("div",{className:"space-y-1",children:[r.jsx("label",{className:`text-xs font-semibold uppercase ${P}`,children:"Макс. Падение"}),r.jsx("input",{type:"text",placeholder:"e.g. -16",value:T.maxDrop||"",onChange:te=>K({...T,maxDrop:te.target.value}),className:`w-full p-3 rounded-xl border outline-none transition-all ${s==="dark"?"bg-black/30 border-white/10 text-white focus:border-[#4E6E49]":"bg-white border-gray-200 text-gray-900 focus:border-[#4E6E49]"}`})]}),r.jsxs("div",{className:"space-y-1",children:[r.jsx("label",{className:`text-xs font-semibold uppercase ${P}`,children:"Макс. Профит"}),r.jsx("input",{type:"text",placeholder:"e.g. +28",value:T.maxProfit||"",onChange:te=>K({...T,maxProfit:te.target.value}),className:`w-full p-3 rounded-xl border outline-none transition-all ${s==="dark"?"bg-black/30 border-white/10 text-white focus:border-[#4E6E49]":"bg-white border-gray-200 text-gray-900 focus:border-[#4E6E49]"}`})]})]}),r.jsxs("div",{className:"space-y-1",children:[r.jsx("label",{className:`text-xs font-semibold uppercase ${P}`,children:"Комментарий"}),r.jsx("input",{type:"text",placeholder:"Дополнительная информация...",value:T.comment||"",onChange:te=>K({...T,comment:te.target.value}),className:`w-full p-3 rounded-xl border outline-none transition-all ${s==="dark"?"bg-black/30 border-white/10 text-white focus:border-[#4E6E49]":"bg-white border-gray-200 text-gray-900 focus:border-[#4E6E49]"}`})]}),r.jsxs("div",{className:"pt-4 flex gap-3",children:[r.jsx("button",{type:"button",onClick:()=>c(!1),className:`flex-1 py-3 rounded-xl font-semibold transition-colors ${s==="dark"?"bg-white/5 hover:bg-white/10 text-white":"bg-gray-100 hover:bg-gray-200 text-gray-800"}`,children:"Отмена"}),r.jsxs("button",{type:"submit",className:"flex-1 py-3 rounded-xl bg-[#4E6E49] hover:bg-[#3d5a39] text-white font-semibold transition-colors flex items-center justify-center gap-2",children:[r.jsx(Zl,{className:"w-4 h-4"}),r.jsx("span",{children:"Сохранить"})]})]})]})]})})]})},Nr=({children:s})=>{const{isAuthenticated:e,user:t}=bt(),{isAdmin:n}=_t(),a=Lh(),[i,o]=E.useState(null),[c,d]=E.useState("");if(!e&&!n)return r.jsx(Ii,{to:"/login",replace:!0});const h=m=>m==="/admin"?"admin":m==="/management"?"slots":m==="/earnings"?"earnings":m==="/tasks"?"tasks":m==="/rating"?"rating":m==="/profile"?"profile":m==="/approvals"?"admin":"login";return E.useEffect(()=>{(async()=>{if(!t||n){o(!0);return}const x=h(a.pathname);try{const f=await nd(t.id,x);o(f.hasAccess),d(f.reason||"Доступ запрещен")}catch(f){console.error("Error checking access:",f),o(!0)}})()},[t,n,a.pathname]),i===null?r.jsx("div",{className:"flex items-center justify-center min-h-screen",children:r.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-4 border-[#4E6E49] border-t-transparent"})}):i?r.jsx(r.Fragment,{children:s}):r.jsx("div",{className:"flex items-center justify-center min-h-screen p-4",children:r.jsxs("div",{className:"text-center max-w-md",children:[r.jsx("div",{className:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4",children:r.jsx("svg",{className:"w-8 h-8 text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})})}),r.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-2",children:"Доступ запрещен"}),r.jsx("p",{className:"text-gray-600",children:c})]})})},E4=()=>{const{user:s}=bt(),[e,t]=E.useState(""),[n,a]=E.useState(),[i,o]=E.useState(!0),[c,d]=E.useState(!1);if(E.useEffect(()=>{(async()=>{if(!s){o(!1);return}try{const x=await nd(s.id,"login");x.hasAccess?d(!1):(t(x.reason||"Доступ заблокирован"),a(x.expiresAt),d(!0))}catch(x){console.error("Error checking access:",x),t("Ошибка проверки доступа"),d(!0)}finally{o(!1)}})()},[s]),!c)return null;if(i)return r.jsx("div",{className:"fixed inset-0 bg-slate-950 flex items-center justify-center z-50",children:r.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-4 border-[#4E6E49] border-t-transparent"})});if(!e)return null;const h=m=>{if(!m)return"навсегда";const x=new Date(m);return x<=new Date?"навсегда":x.toLocaleString("ru-RU",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})};return r.jsx("div",{className:"fixed inset-0 bg-slate-950 flex items-center justify-center z-50 p-4",children:r.jsxs("div",{className:"max-w-md w-full bg-white dark:bg-gray-900 rounded-2xl shadow-2xl border border-gray-200 dark:border-gray-700 p-8 text-center",children:[r.jsxs("div",{className:"mb-6",children:[r.jsx("div",{className:"w-16 h-16 bg-red-100 dark:bg-red-900/30 rounded-full flex items-center justify-center mx-auto mb-4",children:r.jsx(tc,{className:"w-8 h-8 text-red-600 dark:text-red-400"})}),r.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-2",children:"Доступ заблокирован"}),r.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-4",children:e})]}),r.jsx("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-4 mb-6",children:r.jsxs("div",{className:"flex items-center justify-center gap-2 text-sm text-gray-600 dark:text-gray-400",children:[r.jsx(Dr,{className:"w-4 h-4"}),r.jsxs("span",{children:["Блокировка до: ",h(n)]})]})}),r.jsx("div",{className:"bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-800 rounded-lg p-4",children:r.jsxs("div",{className:"flex items-start gap-3",children:[r.jsx(Ut,{className:"w-5 h-5 text-amber-600 dark:text-amber-400 flex-shrink-0 mt-0.5"}),r.jsxs("div",{className:"text-left",children:[r.jsx("p",{className:"text-sm font-medium text-amber-800 dark:text-amber-200 mb-1",children:"Свяжитесь с администратором"}),r.jsx("p",{className:"text-sm text-amber-700 dark:text-amber-300",children:"Для восстановления доступа обратитесь к администратору системы"})]})]})}),r.jsx("div",{className:"mt-6 text-xs text-gray-500 dark:text-gray-500",children:"ApeVault Team"})]})})},I4=s=>s.includes("Chrome")&&!s.includes("Edg")&&!s.includes("OPR")?"Chrome":s.includes("Firefox")?"Firefox":s.includes("Safari")&&!s.includes("Chrome")?"Safari":s.includes("Edg")?"Edge":s.includes("OPR")?"Opera":"Unknown",T4=()=>{const{user:s}=bt(),e=E.useRef(null),t=E.useRef(Date.now()),n=E.useRef(!1);E.useEffect(()=>{if(!(s!=null&&s.id)||n.current)return;(async()=>{n.current=!0,t.current=Date.now();const d=navigator.userAgent,h=I4(d);try{const m=await wj({userId:s.id,loginAt:new Date().toISOString(),browser:h,userAgent:d,isActive:!0,pageViews:[]});e.current=m}catch(m){console.error("Failed to track user activity:",m)}})();const i=()=>{if(e.current){const d=Date.now(),h=Math.floor((d-t.current)/1e3);cl(e.current,new Date().toISOString(),h).catch(m=>console.error("Failed to update activity on unload:",m))}},o=setInterval(async()=>{if(e.current&&!document.hidden){const d=Date.now(),h=Math.floor((d-t.current)/1e3);try{await Hl(e.current,{sessionDuration:h,isActive:!0})}catch(m){console.error("Failed to update activity duration:",m)}}},3e4),c=async()=>{if(document.hidden&&e.current){const d=Date.now(),h=Math.floor((d-t.current)/1e3);try{await cl(e.current,new Date().toISOString(),h)}catch(m){console.error("Failed to update activity on visibility change:",m)}}else if(!document.hidden&&e.current)try{await Hl(e.current,{isActive:!0})}catch(d){console.error("Failed to reactivate activity:",d)}};return window.addEventListener("beforeunload",i),document.addEventListener("visibilitychange",c),()=>{if(clearInterval(o),window.removeEventListener("beforeunload",i),document.removeEventListener("visibilitychange",c),e.current){const d=Date.now(),h=Math.floor((d-t.current)/1e3);cl(e.current,new Date().toISOString(),h).catch(m=>console.error("Failed to update activity on unmount:",m))}}},[s==null?void 0:s.id])},S4=({children:s})=>{const{theme:e,toggleTheme:t}=it(),{isAdmin:n,activateAdmin:a,deactivateAdmin:i}=_t(),{user:o,logout:c}=bt(),d=Lh(),[h,m]=E.useState(!1),[x,f]=E.useState(!1),[w,$]=E.useState(()=>localStorage.getItem("sidebarCollapsed")==="true"),[A,T]=E.useState([]),[K,P]=E.useState(new Set);T4(),E.useEffect(()=>{(async()=>{if(!o||n){P(new Set(["slots","earnings","tasks","rating","profile","admin"]));return}const j=["slots","earnings","tasks","rating","profile"],N=new Set;for(const y of j)try{(await nd(o.id,y)).hasAccess&&N.add(y)}catch(p){console.error(`Error checking access to ${y}:`,p),N.add(y)}P(N)})()},[o,n]);const L=[{path:"/call",label:"AVF HUB",icon:rm,feature:"slots"},{path:"/management",label:"AVF Schedule",icon:gs,feature:"slots"},{path:"/tasks",label:"AVF Tasks",icon:ss,feature:"tasks"},{path:"/earnings",label:"AVF Profit",icon:Tn,feature:"earnings"},{path:"/rating",label:"AVF Score",icon:qt,feature:"rating"},{path:"/about",label:"AVF NFO",icon:Tr,feature:"profile"},...n?[{path:"/approvals",label:"AVF Check",icon:Ra,feature:"admin"}]:[]].filter(v=>!v.feature||K.has(v.feature)||n),ee=[{path:"/meme-evaluation",label:"Оценка мема",icon:qt},{path:"/ai-ao-alerts",label:"ИИ - АО Alerts",icon:Ut}],D=ee.some(v=>d.pathname===v.path);E.useEffect(()=>{m(!1)},[d.pathname]),E.useEffect(()=>{const v=async()=>{try{if(n||!o){T([]);return}const N=[],y=Date.now()-6*60*60*1e3,p=Date.now(),te=60*60*1e3,ue=`viewedNotifications_${o.id}`,le=JSON.parse(localStorage.getItem(ue)||"[]"),ne=(await D0()).filter(q=>{if(q.authorId!==o.id&&q.targetUserId!==o.id)return!1;const M=Date.parse(q.updatedAt||q.createdAt);return!(Number.isNaN(M)||M<y||le.includes(`approval_${q.id}`))}).map(q=>{const M=Date.parse(q.updatedAt||q.createdAt||new Date().toISOString());return{id:`approval_${q.id}`,status:q.status,text:`${q.entity==="slot"?"Слот":q.entity==="status"?"Статус":q.entity==="login"?"Ник":q.entity==="earning"?"Заработок":q.entity==="referral"?"Реферал":"Изменение"} • ${q.status==="approved"?"Подтверждено":q.status==="rejected"?"Отклонено":"На согласовании"}${q.adminComment?`: ${q.adminComment}`:""}`,time:ie(q.updatedAt||q.createdAt||new Date().toISOString(),"dd.MM HH:mm"),timestamp:Number.isNaN(M)?p:M}});N.push(...ne);const B=(await sd({assignedTo:o.id})).filter(q=>{const M=Date.parse(q.createdAt),z=!Number.isNaN(M)&&M>=y&&!le.includes(`task_new_${q.id}`);if(!q.dueDate||!q.dueTime)return z;const R=new Date(`${q.dueDate}T${q.dueTime}`).getTime();if(Number.isNaN(R))return z;const O=R-p,U=O>0&&O<=te&&!le.includes(`task_due_${q.id}`),J=O<0&&O>=-y&&!le.includes(`task_overdue_${q.id}`);return z||U||J}).map(q=>{const M=Date.parse(q.createdAt);if(!Number.isNaN(M)&&M>=y&&!le.includes(`task_new_${q.id}`)){const U=Date.parse(q.createdAt);return{id:`task_new_${q.id}`,status:"new",text:`Новая задача: ${q.title}`,time:ie(q.createdAt,"dd.MM HH:mm"),timestamp:Number.isNaN(U)?p:U}}if(!q.dueDate||!q.dueTime)return null;const I=new Date(`${q.dueDate}T${q.dueTime}`),R=I.getTime();if(Number.isNaN(R))return null;const O=R-p;return O>0&&O<=te&&!le.includes(`task_due_${q.id}`)?{id:`task_due_${q.id}`,status:"due",text:`Дедлайн через час: ${q.title}`,time:ie(I.toISOString(),"dd.MM HH:mm"),timestamp:R}:O<0&&O>=-y&&!le.includes(`task_overdue_${q.id}`)?{id:`task_overdue_${q.id}`,status:"overdue",text:`Просрочен дедлайн: ${q.title}`,time:ie(I.toISOString(),"dd.MM HH:mm"),timestamp:R}:null}).filter(q=>q!==null);N.push(...B);const F=(await wr(o.id)).filter(q=>{if(le.includes(`slot_ended_${q.id}`)||!q.slots||q.slots.length===0)return!1;const M=q.slots[q.slots.length-1];if(!M)return!1;let z;if(M.endDate){z=new Date(M.endDate);const[R,O]=M.end.split(":").map(Number);z.setHours(R,O,0,0)}else{z=new Date(q.date);const[R,O]=M.end.split(":").map(Number);z.setHours(R,O,0,0)}const I=z.getTime();return Number.isNaN(I)?!1:I<p&&I>=p-y}).map(q=>{const M=q.slots[q.slots.length-1];let z;if(M.endDate){z=new Date(M.endDate);const[I,R]=M.end.split(":").map(Number);z.setHours(I,R,0,0)}else{z=new Date(q.date);const[I,R]=M.end.split(":").map(Number);z.setHours(I,R,0,0)}return{id:`slot_ended_${q.id}`,status:"ended",text:`Слот завершился: ${ie(q.date,"dd.MM.yyyy")}`,time:ie(z.toISOString(),"dd.MM HH:mm"),timestamp:z.getTime()}});N.push(...F),N.sort((q,M)=>(M.timestamp||0)-(q.timestamp||0)),T(N.map(({timestamp:q,...M})=>M))}catch(N){console.error("Failed to load notifications",N)}};v();const j=setInterval(v,2*60*1e3);return()=>clearInterval(j)},[o,n]);const k=()=>{const v=!w;$(v),localStorage.setItem("sidebarCollapsed",String(v))},b=v=>v.split(" ").map(j=>j[0]).join("").toUpperCase().substring(0,2);return r.jsxs("div",{className:`min-h-screen ${e==="dark"?"dark bg-[#0b0f17]":"bg-[#f8fafc]"}`,children:[r.jsxs("div",{className:"absolute inset-0 pointer-events-none -z-10 overflow-hidden",children:[r.jsx("div",{className:"absolute -top-24 -left-12 w-80 h-80 bg-gradient-to-br from-[#4E6E49]/25 via-transparent to-transparent blur-3xl"}),r.jsx("div",{className:"absolute top-8 right-0 w-[520px] h-[520px] bg-gradient-to-bl from-blue-500/12 via-purple-500/10 to-transparent blur-3xl"}),r.jsx("div",{className:"absolute bottom-[-120px] left-12 w-96 h-96 bg-gradient-to-tr from-amber-400/10 to-[#4E6E49]/12 blur-3xl"}),r.jsx("div",{className:"floating-grid"})]}),r.jsxs("div",{className:"flex flex-col lg:flex-row min-h-screen",children:[r.jsxs("aside",{className:`hidden xl:flex ${w?"w-20":"w-72"} h-screen fixed left-0 top-0 flex-col glass-panel border-r border-white/40 dark:border-white/10 z-50 transition-all duration-500 ease-[cubic-bezier(0.4,0,0.2,1)]`,children:[r.jsx("div",{className:"accent-dots"}),r.jsx("button",{onClick:k,className:`absolute top-6 -right-0 transition-all duration-500 z-50 ${w?"right-1/2 translate-x-1/2":"right-4"} p-2 rounded-xl bg-[#4E6E49]/10 hover:bg-[#4E6E49]/20 text-[#4E6E49] dark:text-gray-400 dark:hover:text-white border border-[#4E6E49]/20 dark:border-white/10 group`,children:w?r.jsx(Tx,{className:"w-5 h-5 transition-transform group-hover:scale-110"}):r.jsx(Ix,{className:"w-5 h-5 transition-transform group-hover:scale-110"})}),r.jsx("div",{className:`p-6 pb-2 transition-all duration-500 origin-left overflow-hidden ${w?"opacity-0 scale-90 w-0 px-0 translate-x-[-100%]":"opacity-100 scale-100"}`,children:r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx("div",{className:"w-10 h-10 flex items-center justify-center",children:r.jsx("img",{src:bl,alt:"ApeVault",className:"w-9 h-9 object-contain filter drop-shadow-[0_0_8px_rgba(78,110,73,0.3)]"})}),r.jsxs("div",{className:"flex flex-col whitespace-nowrap",children:[r.jsx("span",{className:"text-sm font-black tracking-widest text-[#4E6E49] dark:text-white uppercase transition-opacity duration-300",children:"ApeVault"}),r.jsx("span",{className:"text-[10px] font-bold text-gray-400 -mt-1 uppercase tracking-tighter transition-opacity duration-300",children:"Frontier"})]})]})}),r.jsxs("div",{className:`relative z-10 px-6 pb-4 flex items-center gap-2 transition-all duration-500 ${w?"flex-col px-4 items-center":""}`,children:[r.jsx("button",{onClick:t,className:"flex-1 flex items-center justify-center p-2 rounded-xl border border-gray-200 dark:border-white/10 hover:bg-gray-100 dark:hover:bg-white/5 transition-colors w-full",children:e==="dark"?r.jsx(xl,{className:"w-4 h-4 text-amber-300"}):r.jsx(pl,{className:"w-4 h-4 text-gray-700"})}),!w&&r.jsxs("button",{onClick:()=>f(!x),className:`flex-1 flex items-center justify-center relative p-2 rounded-xl border border-gray-200 dark:border-white/10 hover:bg-gray-100 dark:hover:bg-white/5 transition-colors w-full ${x?"bg-amber-500/10":""}`,children:[r.jsx(ax,{className:"w-4 h-4"}),A.length>0&&r.jsx("span",{className:"absolute top-2 right-[35%] w-2 h-2 bg-red-500 rounded-full"})]})]}),x&&r.jsx("div",{className:"mx-4 mb-4 p-3 glass-panel rounded-xl border border-white/20 shadow-xl max-h-60 overflow-y-auto space-y-2 relative z-20",children:A.length===0?r.jsx("p",{className:"text-[10px] text-gray-500",children:"Нет уведомлений"}):A.map(v=>r.jsxs("div",{className:"text-[10px] p-2 rounded-lg bg-black/5 dark:bg-white/5",children:[r.jsx("p",{className:"font-bold",children:v.text}),r.jsx("p",{className:"opacity-60",children:v.time})]},v.id))}),r.jsx("div",{className:`h-px w-full bg-gradient-to-r from-transparent via-gray-200/50 dark:via-white/10 to-transparent my-2 transition-opacity duration-500 ${w?"opacity-0":"opacity-100"}`}),r.jsxs("nav",{className:"relative z-10 flex-1 px-4 py-4 space-y-1 overflow-y-auto no-scrollbar",children:[r.jsxs("div",{className:"space-y-1 relative group/tools",children:[r.jsxs("button",{onClick:()=>!w&&m(!h),className:`w-full flex items-center gap-3 px-4 py-3 rounded-xl transition-all duration-300 ${D?"bg-[#4E6E49]/15 text-[#4E6E49]":"text-gray-500 hover:bg-gray-100/50 dark:hover:bg-white/5"} ${w?"justify-center px-0":""}`,children:[r.jsx(vs,{className:`w-4 h-4 transition-transform duration-500 ${w?"group-hover/tools:rotate-90":""}`}),!w&&r.jsxs(r.Fragment,{children:[r.jsx("span",{className:"font-bold flex-1 text-left",children:"Tools"}),r.jsx(Ts,{className:`w-4 h-4 transition-transform ${h?"rotate-180":""}`})]})]}),w&&r.jsx("div",{className:"absolute left-full top-0 invisible group-hover/tools:visible opacity-0 group-hover/tools:opacity-100 transition-all duration-300 translate-x-3 group-hover/tools:translate-x-1 z-[100]",children:r.jsxs("div",{className:"ml-2 glass-panel border border-white/40 dark:border-white/10 rounded-2xl p-2 min-w-[200px] shadow-2xl backdrop-blur-2xl",children:[r.jsx("div",{className:"px-3 py-2 mb-1 border-b border-white/10",children:r.jsx("p",{className:"text-[10px] font-black uppercase tracking-widest text-[#4E6E49]",children:"Инструменты"})}),ee.map(v=>r.jsxs($r,{to:v.path,className:`flex items-center gap-3 px-3 py-2.5 rounded-xl text-sm font-bold transition-all ${d.pathname===v.path?"bg-[#4E6E49] text-white":"text-gray-500 hover:bg-[#4E6E49]/10 hover:text-[#4E6E49]"}`,children:[r.jsx(v.icon,{className:"w-3.5 h-3.5"}),r.jsx("span",{children:v.label})]},v.path))]})}),h&&!w&&r.jsx("div",{className:"pl-11 pr-4 py-1 space-y-1 animate-in fade-in slide-in-from-top-1 duration-300",children:ee.map(v=>r.jsx($r,{to:v.path,className:`block py-2 text-sm font-medium transition-colors ${d.pathname===v.path?"text-[#4E6E49]":"text-gray-400 hover:text-[#4E6E49]"}`,children:v.label},v.path))})]}),L.map(v=>r.jsxs($r,{to:v.path,className:`flex items-center gap-3 px-4 py-3 rounded-xl transition-all duration-300 ${d.pathname===v.path?"bg-[#4E6E49] text-white shadow-lg shadow-[#4E6E49]/30":"text-gray-500 hover:bg-gray-100/50 dark:hover:bg-white/5 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white"} ${w?"justify-center px-0":""}`,children:[r.jsx(v.icon,{className:"w-4 h-4"}),!w&&r.jsx("span",{className:"font-bold text-sm tracking-tight",children:v.label})]},v.path))]}),r.jsxs("div",{className:`relative z-10 m-4 space-y-2 transition-all duration-500 ${w?"m-2 space-y-4":""}`,children:[r.jsxs($r,{to:"/profile",className:`p-4 rounded-2xl flex items-center gap-3 transition-all group ${d.pathname==="/profile"?"bg-[#4E6E49]/10 border border-[#4E6E49]/30":"border border-gray-200/50 dark:border-white/5 hover:bg-gray-100/50 dark:hover:bg-white/5"} ${w?"p-0 h-12 w-12 items-center justify-center mx-auto border-0":""}`,children:[r.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center font-bold text-sm shadow-inner shrink-0 ${e==="dark"?"bg-emerald-500/20 text-[#4E6E49]":"bg-[#4E6E49]/10 text-[#4E6E49]"}`,children:o!=null&&o.avatar?r.jsx("img",{src:o.avatar,className:"w-full h-full rounded-full object-cover"}):b((o==null?void 0:o.name)||"User")}),!w&&r.jsxs(r.Fragment,{children:[r.jsxs("div",{className:"flex-1 min-w-0",children:[r.jsx("p",{className:"text-sm font-bold truncate dark:text-white",children:(o==null?void 0:o.name)||"Administrator"}),r.jsx("p",{className:"text-[10px] text-gray-500 font-medium truncate",children:(o==null?void 0:o.login)||"admin@apevault.io"})]}),r.jsx(cx,{className:"w-4 h-4 text-gray-400 group-hover:text-[#4E6E49] transition-colors"})]})]}),r.jsxs("div",{className:`flex gap-2 transition-all duration-500 ${w?"flex-col gap-4 px-2":""}`,children:[r.jsxs("button",{onClick:()=>{c(),i(),window.location.href="/login"},className:`flex-1 flex items-center justify-center gap-2 py-2.5 rounded-xl border border-red-500/20 bg-red-500/5 text-red-500 hover:bg-red-500/10 transition-colors text-xs font-bold ${w?"w-full px-0 border-0":""}`,children:[r.jsx(Zh,{className:"w-3.5 h-3.5"}),!w&&r.jsx("span",{children:"Выйти"})]}),(o==null?void 0:o.name)==="Артём"&&!n&&r.jsxs("button",{onClick:()=>a(Ql),className:`flex-1 flex items-center justify-center gap-2 py-2.5 rounded-xl border border-[#4E6E49]/20 bg-[#4E6E49]/5 text-[#4E6E49] hover:bg-[#4E6E49]/10 transition-colors text-xs font-bold ${w?"border-0":""}`,children:[r.jsx(At,{className:"w-3.5 h-3.5"}),!w&&r.jsx("span",{children:"Админ"})]}),n&&r.jsxs("button",{onClick:i,className:`flex-1 flex items-center justify-center gap-2 py-2.5 rounded-xl border border-amber-500/20 bg-amber-500/5 text-amber-500 hover:bg-amber-500/10 transition-colors text-xs font-bold ${w?"border-0":""}`,children:[r.jsx(Ux,{className:"w-3.5 h-3.5"}),!w&&r.jsx("span",{children:"Стоп"})]})]})]})]}),r.jsx("div",{className:`flex-1 ${w?"xl:pl-20":"xl:pl-72"} min-h-screen transition-all duration-500 ease-[cubic-bezier(0.4,0,0.2,1)]`,children:r.jsx("main",{className:"page-shell",children:s})}),r.jsxs("nav",{className:"xl:hidden fixed bottom-4 left-0 right-0 px-3 z-50",children:[r.jsx("div",{className:"max-w-5xl mx-auto",children:r.jsx("div",{className:"glass-panel rounded-2xl shadow-2xl border border-white/60 dark:border-white/10 overflow-hidden",children:r.jsxs("div",{className:"flex divide-x divide-white/40 dark:divide-white/5 w-full overflow-x-auto no-scrollbar",children:[r.jsxs("button",{onClick:()=>m(!h),className:`flex-none w-20 flex flex-col items-center justify-center gap-1 py-3 ${D?"text-[#4E6E49]":"text-gray-400"}`,children:[r.jsx(vs,{className:"w-5 h-5"}),r.jsx("span",{className:"text-[10px] font-bold",children:"Tools"})]}),L.map(v=>r.jsxs($r,{to:v.path,className:`flex-none w-20 flex flex-col items-center justify-center gap-1 py-3 ${d.pathname===v.path?"text-[#4E6E49]":"text-gray-400"}`,children:[r.jsx(v.icon,{className:"w-5 h-5"}),r.jsx("span",{className:"text-[10px] font-bold",children:v.label.replace("AVF ","")})]},v.path)),r.jsxs($r,{to:"/profile",className:`flex-none min-w-[120px] flex items-center gap-2 px-3 py-2 ${d.pathname==="/profile"?"text-[#4E6E49]":"text-gray-400"}`,children:[r.jsx("div",{className:"w-8 h-8 rounded-full bg-[#4E6E49]/10 flex items-center justify-center text-[10px] font-bold flex-shrink-0",children:b((o==null?void 0:o.name)||"AU")}),r.jsxs("div",{className:"min-w-0 flex flex-col items-start px-1",children:[r.jsx("span",{className:"text-[10px] font-bold truncate w-full text-left",children:(o==null?void 0:o.name)||"User"}),r.jsx("span",{className:"text-[8px] opacity-60 truncate w-full text-left",children:(o==null?void 0:o.login)||"id"})]})]})]})})}),h&&r.jsxs(r.Fragment,{children:[r.jsx("div",{className:"fixed inset-0 bg-black/40 backdrop-blur-sm z-[-1]",onClick:()=>m(!1)}),r.jsx("div",{className:"absolute bottom-20 left-4 right-4 glass-panel rounded-2xl border border-white/40 overflow-hidden animate-fade-in",children:ee.map(v=>r.jsxs($r,{to:v.path,onClick:()=>m(!1),className:"flex items-center gap-3 p-4 border-b border-white/10 last:border-0",children:[r.jsx(v.icon,{className:"w-4 h-4 text-[#4E6E49]"}),r.jsx("span",{className:"font-bold text-sm flex-1",children:v.label}),r.jsx(Rr,{className:"w-4 h-4 opacity-40"})]},v.path))})]})]})]})]})},A4=()=>r.jsx(S4,{children:r.jsx(gp,{})});function C4(){const{isAuthenticated:s}=bt(),{isAdmin:e}=_t(),{theme:t}=it();return E.useEffect(()=>{document.body.classList.toggle("dark",t==="dark")},[t]),E.useEffect(()=>{nj().catch(n=>console.error("Cleanup failed",n))},[]),r.jsxs(pp,{children:[r.jsx(E4,{}),r.jsxs(xp,{children:[r.jsx(ar,{path:"/login",element:!s&&!e?r.jsx(qx,{}):r.jsx(Ii,{to:"/management",replace:!0})}),r.jsxs(ar,{element:r.jsx(A4,{}),children:[r.jsx(ar,{path:"/call",element:r.jsx(Nr,{children:r.jsx(Vj,{})})}),r.jsx(ar,{path:"/management",element:r.jsx(Nr,{children:r.jsx(Yj,{})})}),r.jsx(ar,{path:"/earnings",element:r.jsx(Nr,{children:r.jsx(Zj,{})})}),r.jsx(ar,{path:"/rating",element:r.jsx(Nr,{children:r.jsx(s4,{})})}),r.jsx(ar,{path:"/tasks",element:r.jsx(Nr,{children:r.jsx(h4,{})})}),r.jsx(ar,{path:"/about",element:r.jsx(Nr,{children:r.jsx(x4,{})})}),r.jsx(ar,{path:"/rules",element:r.jsx(Nr,{children:r.jsx(f4,{})})}),r.jsx(ar,{path:"/approvals",element:r.jsx(Nr,{children:r.jsx(N4,{})})}),r.jsx(ar,{path:"/admin",element:r.jsx(Nr,{children:r.jsx(m4,{})})}),r.jsx(ar,{path:"/profile",element:r.jsx(Nr,{children:r.jsx(g4,{})})}),r.jsx(ar,{path:"/meme-evaluation",element:r.jsx(Nr,{children:r.jsx(j4,{})})}),r.jsx(ar,{path:"/ai-ao-alerts",element:r.jsx(Nr,{children:r.jsx(_4,{})})})]}),r.jsx(ar,{path:"/",element:r.jsx(Ii,{to:s||e?"/management":"/login",replace:!0})})]})]})}hl.createRoot(document.getElementById("root")).render(r.jsx(Oh.StrictMode,{children:r.jsx(C4,{})}));
