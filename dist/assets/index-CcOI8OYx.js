import{r as I,a as cp,g as dp,R as Dh,u as $h,b as up,c as Rh,L as Qr,N as _i,B as hp,d as mp,e as or}from"./react-vendor-Dou2_yf_.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))n(a);new MutationObserver(a=>{for(const i of a)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function t(a){const i={};return a.integrity&&(i.integrity=a.integrity),a.referrerPolicy&&(i.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?i.credentials="include":a.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(a){if(a.ep)return;a.ep=!0;const i=t(a);fetch(a.href,i)}})();var Ph={exports:{}},to={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var gp=I,pp=Symbol.for("react.element"),xp=Symbol.for("react.fragment"),fp=Object.prototype.hasOwnProperty,yp=gp.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,bp={key:!0,ref:!0,__self:!0,__source:!0};function Mh(s,e,t){var n,a={},i=null,o=null;t!==void 0&&(i=""+t),e.key!==void 0&&(i=""+e.key),e.ref!==void 0&&(o=e.ref);for(n in e)fp.call(e,n)&&!bp.hasOwnProperty(n)&&(a[n]=e[n]);if(s&&s.defaultProps)for(n in e=s.defaultProps,e)a[n]===void 0&&(a[n]=e[n]);return{$$typeof:pp,type:s,key:i,ref:o,props:a,_owner:yp.current}}to.Fragment=xp;to.jsx=Mh;to.jsxs=Mh;Ph.exports=to;var r=Ph.exports,cl={},Vd=cp;cl.createRoot=Vd.createRoot,cl.hydrateRoot=Vd.hydrateRoot;const vp={},Ld=s=>{let e;const t=new Set,n=(m,x)=>{const f=typeof m=="function"?m(e):m;if(!Object.is(f,e)){const k=e;e=x??(typeof f!="object"||f===null)?f:Object.assign({},e,f),t.forEach(A=>A(e,k))}},a=()=>e,d={setState:n,getState:a,getInitialState:()=>h,subscribe:m=>(t.add(m),()=>t.delete(m)),destroy:()=>{(vp?"production":void 0)!=="production"&&console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),t.clear()}},h=e=s(n,a,d);return d},wp=s=>s?Ld(s):Ld;var Oh={exports:{}},Vh={},Lh={exports:{}},Fh={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var kn=I;function kp(s,e){return s===e&&(s!==0||1/s===1/e)||s!==s&&e!==e}var Np=typeof Object.is=="function"?Object.is:kp,jp=kn.useState,_p=kn.useEffect,Ep=kn.useLayoutEffect,Ip=kn.useDebugValue;function Tp(s,e){var t=e(),n=jp({inst:{value:t,getSnapshot:e}}),a=n[0].inst,i=n[1];return Ep(function(){a.value=t,a.getSnapshot=e,qo(a)&&i({inst:a})},[s,t,e]),_p(function(){return qo(a)&&i({inst:a}),s(function(){qo(a)&&i({inst:a})})},[s]),Ip(t),t}function qo(s){var e=s.getSnapshot;s=s.value;try{var t=e();return!Np(s,t)}catch{return!0}}function Sp(s,e){return e()}var Ap=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?Sp:Tp;Fh.useSyncExternalStore=kn.useSyncExternalStore!==void 0?kn.useSyncExternalStore:Ap;Lh.exports=Fh;var Cp=Lh.exports;/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ro=I,Dp=Cp;function $p(s,e){return s===e&&(s!==0||1/s===1/e)||s!==s&&e!==e}var Rp=typeof Object.is=="function"?Object.is:$p,Pp=Dp.useSyncExternalStore,Mp=ro.useRef,Op=ro.useEffect,Vp=ro.useMemo,Lp=ro.useDebugValue;Vh.useSyncExternalStoreWithSelector=function(s,e,t,n,a){var i=Mp(null);if(i.current===null){var o={hasValue:!1,value:null};i.current=o}else o=i.current;i=Vp(function(){function d(k){if(!h){if(h=!0,m=k,k=n(k),a!==void 0&&o.hasValue){var A=o.value;if(a(A,k))return x=A}return x=k}if(A=x,Rp(m,k))return A;var D=n(k);return a!==void 0&&a(A,D)?(m=k,A):(m=k,x=D)}var h=!1,m,x,f=t===void 0?null:t;return[function(){return d(e())},f===null?void 0:function(){return d(f())}]},[e,t,n,a]);var c=Pp(s,i[0],i[1]);return Op(function(){o.hasValue=!0,o.value=c},[c]),Lp(c),c};Oh.exports=Vh;var Fp=Oh.exports;const Up=dp(Fp),Uh={},{useDebugValue:Bp}=Dh,{useSyncExternalStoreWithSelector:qp}=Up;let Fd=!1;const Wp=s=>s;function zp(s,e=Wp,t){(Uh?"production":void 0)!=="production"&&t&&!Fd&&(console.warn("[DEPRECATED] Use `createWithEqualityFn` instead of `create` or use `useStoreWithEqualityFn` instead of `useStore`. They can be imported from 'zustand/traditional'. https://github.com/pmndrs/zustand/discussions/1937"),Fd=!0);const n=qp(s.subscribe,s.getState,s.getServerState||s.getInitialState,e,t);return Bp(n),n}const Hp=s=>{(Uh?"production":void 0)!=="production"&&typeof s!="function"&&console.warn("[DEPRECATED] Passing a vanilla store will be unsupported in a future version. Instead use `import { useStore } from 'zustand'`.");const e=typeof s=="function"?wp(s):s,t=(n,a)=>zp(e,n,a);return Object.assign(t,e),t},Bl=s=>Hp,Gp={};function Kp(s,e){let t;try{t=s()}catch{return}return{getItem:a=>{var i;const o=d=>d===null?null:JSON.parse(d,void 0),c=(i=t.getItem(a))!=null?i:null;return c instanceof Promise?c.then(o):o(c)},setItem:(a,i)=>t.setItem(a,JSON.stringify(i,void 0)),removeItem:a=>t.removeItem(a)}}const ma=s=>e=>{try{const t=s(e);return t instanceof Promise?t:{then(n){return ma(n)(t)},catch(n){return this}}}catch(t){return{then(n){return this},catch(n){return ma(n)(t)}}}},Yp=(s,e)=>(t,n,a)=>{let i={getStorage:()=>localStorage,serialize:JSON.stringify,deserialize:JSON.parse,partialize:T=>T,version:0,merge:(T,H)=>({...H,...T}),...e},o=!1;const c=new Set,d=new Set;let h;try{h=i.getStorage()}catch{}if(!h)return s((...T)=>{console.warn(`[zustand persist middleware] Unable to update item '${i.name}', the given storage is currently unavailable.`),t(...T)},n,a);const m=ma(i.serialize),x=()=>{const T=i.partialize({...n()});let H;const L=m({state:T,version:i.version}).then(E=>h.setItem(i.name,E)).catch(E=>{H=E});if(H)throw H;return L},f=a.setState;a.setState=(T,H)=>{f(T,H),x()};const k=s((...T)=>{t(...T),x()},n,a);let A;const D=()=>{var T;if(!h)return;o=!1,c.forEach(L=>L(n()));const H=((T=i.onRehydrateStorage)==null?void 0:T.call(i,n()))||void 0;return ma(h.getItem.bind(h))(i.name).then(L=>{if(L)return i.deserialize(L)}).then(L=>{if(L)if(typeof L.version=="number"&&L.version!==i.version){if(i.migrate)return i.migrate(L.state,L.version);console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return L.state}).then(L=>{var E;return A=i.merge(L,(E=n())!=null?E:k),t(A,!0),x()}).then(()=>{H==null||H(A,void 0),o=!0,d.forEach(L=>L(A))}).catch(L=>{H==null||H(void 0,L)})};return a.persist={setOptions:T=>{i={...i,...T},T.getStorage&&(h=T.getStorage())},clearStorage:()=>{h==null||h.removeItem(i.name)},getOptions:()=>i,rehydrate:()=>D(),hasHydrated:()=>o,onHydrate:T=>(c.add(T),()=>{c.delete(T)}),onFinishHydration:T=>(d.add(T),()=>{d.delete(T)})},D(),A||k},Qp=(s,e)=>(t,n,a)=>{let i={storage:Kp(()=>localStorage),partialize:D=>D,version:0,merge:(D,T)=>({...T,...D}),...e},o=!1;const c=new Set,d=new Set;let h=i.storage;if(!h)return s((...D)=>{console.warn(`[zustand persist middleware] Unable to update item '${i.name}', the given storage is currently unavailable.`),t(...D)},n,a);const m=()=>{const D=i.partialize({...n()});return h.setItem(i.name,{state:D,version:i.version})},x=a.setState;a.setState=(D,T)=>{x(D,T),m()};const f=s((...D)=>{t(...D),m()},n,a);a.getInitialState=()=>f;let k;const A=()=>{var D,T;if(!h)return;o=!1,c.forEach(L=>{var E;return L((E=n())!=null?E:f)});const H=((T=i.onRehydrateStorage)==null?void 0:T.call(i,(D=n())!=null?D:f))||void 0;return ma(h.getItem.bind(h))(i.name).then(L=>{if(L)if(typeof L.version=="number"&&L.version!==i.version){if(i.migrate)return[!0,i.migrate(L.state,L.version)];console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return[!1,L.state];return[!1,void 0]}).then(L=>{var E;const[M,ee]=L;if(k=i.merge(ee,(E=n())!=null?E:f),t(k,!0),M)return m()}).then(()=>{H==null||H(k,void 0),k=n(),o=!0,d.forEach(L=>L(k))}).catch(L=>{H==null||H(void 0,L)})};return a.persist={setOptions:D=>{i={...i,...D},D.storage&&(h=D.storage)},clearStorage:()=>{h==null||h.removeItem(i.name)},getOptions:()=>i,rehydrate:()=>A(),hasHydrated:()=>o,onHydrate:D=>(c.add(D),()=>{c.delete(D)}),onFinishHydration:D=>(d.add(D),()=>{d.delete(D)})},i.skipHydration||A(),k||f},Xp=(s,e)=>"getStorage"in e||"serialize"in e||"deserialize"in e?((Gp?"production":void 0)!=="production"&&console.warn("[DEPRECATED] `getStorage`, `serialize` and `deserialize` options are deprecated. Use `storage` option instead."),Yp(s,e)):Qp(s,e),ql=Xp,Ws={memecoins:{label:"Мемкоины",accent:"emerald",icon:"rocket"},futures:{label:"Фьючерсы",accent:"blue",icon:"line"},nft:{label:"NFT",accent:"purple",icon:"image"},spot:{label:"Спот",accent:"amber",icon:"coins"},polymarket:{label:"PolyMarket",accent:"pink",icon:"barchart"},staking:{label:"Стейкинг",accent:"indigo",icon:"shield"},other:{label:"Другое",accent:"gray",icon:"sparkles"}},De=[{id:"1",name:"Артём",login:"artyom03",password:"248artdex",avatar:"/avatars/artyom.jpg"},{id:"2",name:"Enowk",login:"adel05",password:"058adeldex",avatar:"/avatars/adel.jpg"},{id:"3",name:"Ксения",login:"ksen03",password:"907ksendex",avatar:"/avatars/kseniya.jpg"},{id:"4",name:"Ольга",login:"olga04",password:"638olgadex",avatar:"/avatars/olga.jpg"},{id:"5",name:"Анастасия",login:"anastasia05",password:"638anastadex",avatar:"/avatars/anastasia.jpg"}],ga={trading:{label:"Торговля",icon:"candles",color:"green"},learning:{label:"Обучение",icon:"book",color:"blue"},technical:{label:"ТЧ",icon:"cpu",color:"purple"},stream:{label:"Стрим",icon:"broadcast",color:"red"},research:{label:"Изучение",icon:"flask",color:"yellow"},organization:{label:"Ресёрч",icon:"clipboard",color:"indigo"}},zs={in_progress:{label:"В работе",color:"blue"},completed:{label:"Выполнено",color:"green"},closed:{label:"Закрыто",color:"gray"}},pt=Bl()(ql(s=>({user:null,isAuthenticated:!1,login:(e,t)=>{const n=De.find(a=>a.login===e&&a.password===t);return n?(s({user:n,isAuthenticated:!0}),!0):!1},logout:()=>s({user:null,isAuthenticated:!1})}),{name:"apevault-auth"})),Bh="4747",kt=Bl()(ql(s=>({isAdmin:!1,activateAdmin:e=>e===Bh?(s({isAdmin:!0}),!0):!1,deactivateAdmin:()=>s({isAdmin:!1})}),{name:"apevault-admin"})),at=Bl()(ql(s=>({theme:"light",toggleTheme:()=>s(e=>{const t=e.theme==="light"?"dark":"light";return document.body.classList.toggle("dark",t==="dark"),{theme:t}}),setTheme:e=>s(()=>(document.body.classList.toggle("dark",e==="dark"),{theme:e}))}),{name:"apevault-theme"}));/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var Jp={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zp=s=>s.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().trim(),xe=(s,e)=>{const t=I.forwardRef(({color:n="currentColor",size:a=24,strokeWidth:i=2,absoluteStrokeWidth:o,className:c="",children:d,...h},m)=>I.createElement("svg",{ref:m,...Jp,width:a,height:a,stroke:n,strokeWidth:o?Number(i)*24/Number(a):i,className:["lucide",`lucide-${Zp(s)}`,c].join(" "),...h},[...e.map(([x,f])=>I.createElement(x,f)),...Array.isArray(d)?d:[d]]));return t.displayName=`${s}`,t};/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Wl=xe("Activity",[["path",{d:"M22 12h-4l-3 9L9 3l-3 9H2",key:"d5dnw9"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const so=xe("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Lt=xe("AlertTriangle",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z",key:"c3ski4"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ex=xe("Archive",[["rect",{width:"20",height:"5",x:"2",y:"3",rx:"1",key:"1wp1u1"}],["path",{d:"M4 8v11a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8",key:"1s80jp"}],["path",{d:"M10 12h4",key:"a56b0p"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tx=xe("ArrowDownRight",[["path",{d:"m7 7 10 10",key:"1fmybs"}],["path",{d:"M17 7v10H7",key:"6fjiku"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Cr=xe("ArrowUpRight",[["path",{d:"M7 7h10v10",key:"1tivn9"}],["path",{d:"M7 17 17 7",key:"1vkiza"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zl=xe("BarChart3",[["path",{d:"M3 3v18h18",key:"1s2lah"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rx=xe("Bell",[["path",{d:"M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9",key:"1qo2s2"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pa=xe("BookOpen",[["path",{d:"M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z",key:"vv98re"}],["path",{d:"M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z",key:"1cyq3y"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ei=xe("Building2",[["path",{d:"M6 22V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v18Z",key:"1b4qmf"}],["path",{d:"M6 12H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h2",key:"i71pzd"}],["path",{d:"M18 9h2a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2h-2",key:"10jefs"}],["path",{d:"M10 6h4",key:"1itunk"}],["path",{d:"M10 10h4",key:"tcdvrf"}],["path",{d:"M10 14h4",key:"kelpxr"}],["path",{d:"M10 18h4",key:"1ulq68"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pi=xe("CalendarCheck",[["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",ry:"2",key:"eu3xkr"}],["line",{x1:"16",x2:"16",y1:"2",y2:"6",key:"m3sa8f"}],["line",{x1:"8",x2:"8",y1:"2",y2:"6",key:"18kwsl"}],["line",{x1:"3",x2:"21",y1:"10",y2:"10",key:"xt86sb"}],["path",{d:"m9 16 2 2 4-4",key:"19s6y9"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ii=xe("CalendarClock",[["path",{d:"M21 7.5V6a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h3.5",key:"1osxxc"}],["path",{d:"M16 2v4",key:"4m81vk"}],["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M3 10h5",key:"r794hk"}],["path",{d:"M17.5 17.5 16 16.25V14",key:"re2vv1"}],["path",{d:"M22 16a6 6 0 1 1-12 0 6 6 0 0 1 12 0Z",key:"ame013"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sx=xe("CalendarDays",[["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",ry:"2",key:"eu3xkr"}],["line",{x1:"16",x2:"16",y1:"2",y2:"6",key:"m3sa8f"}],["line",{x1:"8",x2:"8",y1:"2",y2:"6",key:"18kwsl"}],["line",{x1:"3",x2:"21",y1:"10",y2:"10",key:"xt86sb"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 18h.01",key:"lrp35t"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M16 18h.01",key:"kzsmim"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Tr=xe("Calendar",[["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",ry:"2",key:"eu3xkr"}],["line",{x1:"16",x2:"16",y1:"2",y2:"6",key:"m3sa8f"}],["line",{x1:"8",x2:"8",y1:"2",y2:"6",key:"18kwsl"}],["line",{x1:"3",x2:"21",y1:"10",y2:"10",key:"xt86sb"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nx=xe("CandlestickChart",[["path",{d:"M9 5v4",key:"14uxtq"}],["rect",{width:"4",height:"6",x:"7",y:"9",rx:"1",key:"f4fvz0"}],["path",{d:"M9 15v2",key:"r5rk32"}],["path",{d:"M17 3v2",key:"1l2re6"}],["rect",{width:"4",height:"8",x:"15",y:"5",rx:"1",key:"z38je5"}],["path",{d:"M17 13v3",key:"5l0wba"}],["path",{d:"M3 3v18h18",key:"1s2lah"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $n=xe("CheckCircle2",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ax=xe("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ts=xe("CheckSquare",[["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}],["path",{d:"M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11",key:"1jnkn4"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wr=xe("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Hl=xe("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qh=xe("ChevronUp",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ix=xe("CircleDot",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ud=xe("ClipboardCheck",[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}],["path",{d:"m9 14 2 2 4-4",key:"df797q"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ox=xe("ClipboardList",[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}],["path",{d:"M12 11h4",key:"1jrz19"}],["path",{d:"M12 16h4",key:"n85exb"}],["path",{d:"M8 11h.01",key:"1dfujw"}],["path",{d:"M8 16h.01",key:"18s6g9"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Is=xe("Clock3",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16.5 12",key:"1aq6pp"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Sr=xe("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rr=xe("Coins",[["circle",{cx:"8",cy:"8",r:"6",key:"3yglwk"}],["path",{d:"M18.09 10.37A6 6 0 1 1 10.34 18",key:"t5s6rm"}],["path",{d:"M7 6h1v4",key:"1obek4"}],["path",{d:"m16.71 13.88.7.71-2.82 2.82",key:"1rbuyh"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xa=xe("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lx=xe("Cpu",[["rect",{x:"4",y:"4",width:"16",height:"16",rx:"2",key:"1vbyd7"}],["rect",{x:"9",y:"9",width:"6",height:"6",key:"o3kz5p"}],["path",{d:"M15 2v2",key:"13l42r"}],["path",{d:"M15 20v2",key:"15mkzm"}],["path",{d:"M2 15h2",key:"1gxd5l"}],["path",{d:"M2 9h2",key:"1bbxkp"}],["path",{d:"M20 15h2",key:"19e6y8"}],["path",{d:"M20 9h2",key:"19tzq7"}],["path",{d:"M9 2v2",key:"165o2o"}],["path",{d:"M9 20v2",key:"i2bqo8"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Sa=xe("DollarSign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Wh=xe("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cx=xe("EyeOff",[["path",{d:"M9.88 9.88a3 3 0 1 0 4.24 4.24",key:"1jxqfv"}],["path",{d:"M10.73 5.08A10.43 10.43 0 0 1 12 5c7 0 10 7 10 7a13.16 13.16 0 0 1-1.67 2.68",key:"9wicm4"}],["path",{d:"M6.61 6.61A13.526 13.526 0 0 0 2 12s3 7 10 7a9.74 9.74 0 0 0 5.39-1.61",key:"1jreej"}],["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dl=xe("Eye",[["path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",key:"rwhkz3"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dx=xe("FileCode",[["path",{d:"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z",key:"1nnpy2"}],["polyline",{points:"14 2 14 8 20 8",key:"1ew0cm"}],["path",{d:"m10 13-2 2 2 2",key:"17smn8"}],["path",{d:"m14 17 2-2-2-2",key:"14mezr"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zh=xe("FileText",[["path",{d:"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z",key:"1nnpy2"}],["polyline",{points:"14 2 14 8 20 8",key:"1ew0cm"}],["line",{x1:"16",x2:"8",y1:"13",y2:"13",key:"14keom"}],["line",{x1:"16",x2:"8",y1:"17",y2:"17",key:"17nazh"}],["line",{x1:"10",x2:"8",y1:"9",y2:"9",key:"1a5vjj"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Hh=xe("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ux=xe("FlaskConical",[["path",{d:"M10 2v7.527a2 2 0 0 1-.211.896L4.72 20.55a1 1 0 0 0 .9 1.45h12.76a1 1 0 0 0 .9-1.45l-5.069-10.127A2 2 0 0 1 14 9.527V2",key:"pzvekw"}],["path",{d:"M8.5 2h7",key:"csnxdl"}],["path",{d:"M7 16h10",key:"wp8him"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Hs=xe("Gauge",[["path",{d:"m12 14 4-4",key:"9kzdfg"}],["path",{d:"M3.34 19a10 10 0 1 1 17.32 0",key:"19p75a"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gh=xe("Globe2",[["path",{d:"M21.54 15H17a2 2 0 0 0-2 2v4.54",key:"1djwo0"}],["path",{d:"M7 3.34V5a3 3 0 0 0 3 3v0a2 2 0 0 1 2 2v0c0 1.1.9 2 2 2v0a2 2 0 0 0 2-2v0c0-1.1.9-2 2-2h3.17",key:"1fi5u6"}],["path",{d:"M11 21.95V18a2 2 0 0 0-2-2v0a2 2 0 0 1-2-2v-1a2 2 0 0 0-2-2H2.05",key:"xsiumc"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Kh=xe("Hash",[["line",{x1:"4",x2:"20",y1:"9",y2:"9",key:"4lhtct"}],["line",{x1:"4",x2:"20",y1:"15",y2:"15",key:"vyu0kd"}],["line",{x1:"10",x2:"8",y1:"3",y2:"21",key:"1ggp8o"}],["line",{x1:"16",x2:"14",y1:"3",y2:"21",key:"weycgp"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hx=xe("Heart",[["path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z",key:"c3ymky"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mx=xe("Home",[["path",{d:"m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"y5dka4"}],["polyline",{points:"9 22 9 12 15 12 15 22",key:"e2us08"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gx=xe("Hourglass",[["path",{d:"M5 22h14",key:"ehvnwv"}],["path",{d:"M5 2h14",key:"pdyrp9"}],["path",{d:"M17 22v-4.172a2 2 0 0 0-.586-1.414L12 12l-4.414 4.414A2 2 0 0 0 7 17.828V22",key:"1d314k"}],["path",{d:"M7 2v4.172a2 2 0 0 0 .586 1.414L12 12l4.414-4.414A2 2 0 0 0 17 6.172V2",key:"1vvvr6"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Aa=xe("Image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _r=xe("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const px=xe("Key",[["circle",{cx:"7.5",cy:"15.5",r:"5.5",key:"yqb3hr"}],["path",{d:"m21 2-9.6 9.6",key:"1j0ho8"}],["path",{d:"m15.5 7.5 3 3L22 7l-3-3",key:"1rn1fs"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xx=xe("Layers",[["path",{d:"m12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83Z",key:"8b97xw"}],["path",{d:"m22 17.65-9.17 4.16a2 2 0 0 1-1.66 0L2 17.65",key:"dd6zsq"}],["path",{d:"m22 12.65-9.17 4.16a2 2 0 0 1-1.66 0L2 12.65",key:"ep9fru"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fx=xe("LayoutGrid",[["rect",{width:"7",height:"7",x:"3",y:"3",rx:"1",key:"1g98yp"}],["rect",{width:"7",height:"7",x:"14",y:"3",rx:"1",key:"6d4xhi"}],["rect",{width:"7",height:"7",x:"14",y:"14",rx:"1",key:"nxv5o0"}],["rect",{width:"7",height:"7",x:"3",y:"14",rx:"1",key:"1bb6yr"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ca=xe("LineChart",[["path",{d:"M3 3v18h18",key:"1s2lah"}],["path",{d:"m19 9-5 5-4-4-3 3",key:"2osh9i"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ul=xe("Link2",[["path",{d:"M9 17H7A5 5 0 0 1 7 7h2",key:"8i5ue5"}],["path",{d:"M15 7h2a5 5 0 1 1 0 10h-2",key:"1b9ql8"}],["line",{x1:"8",x2:"16",y1:"12",y2:"12",key:"1jonct"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yx=xe("List",[["line",{x1:"8",x2:"21",y1:"6",y2:"6",key:"7ey8pc"}],["line",{x1:"8",x2:"21",y1:"12",y2:"12",key:"rjfblc"}],["line",{x1:"8",x2:"21",y1:"18",y2:"18",key:"c3b1m8"}],["line",{x1:"3",x2:"3.01",y1:"6",y2:"6",key:"1g7gq3"}],["line",{x1:"3",x2:"3.01",y1:"12",y2:"12",key:"1pjlvk"}],["line",{x1:"3",x2:"3.01",y1:"18",y2:"18",key:"28t2mc"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ti=xe("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bx=xe("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vx=xe("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dr=xe("MapPin",[["path",{d:"M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z",key:"2oe9fu"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wx=xe("MessageCircle",[["path",{d:"m3 21 1.9-5.7a8.5 8.5 0 1 1 3.8 3.8z",key:"v2veuj"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dn=xe("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gl=xe("Moon",[["path",{d:"M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z",key:"a7tn18"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kx=xe("MoreVertical",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Yh=xe("Network",[["rect",{x:"16",y:"16",width:"6",height:"6",rx:"1",key:"4q2zg0"}],["rect",{x:"2",y:"16",width:"6",height:"6",rx:"1",key:"8cvhb9"}],["rect",{x:"9",y:"2",width:"6",height:"6",rx:"1",key:"1egb70"}],["path",{d:"M5 16v-3a1 1 0 0 1 1-1h12a1 1 0 0 1 1 1v3",key:"1jsf9p"}],["path",{d:"M12 12V8",key:"2874zd"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pn=xe("Octagon",[["polygon",{points:"7.86 2 16.14 2 22 7.86 22 16.14 16.14 22 7.86 22 2 16.14 2 7.86 7.86 2",key:"h1p8hx"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Nx=xe("Palette",[["circle",{cx:"13.5",cy:"6.5",r:".5",key:"1xcu5"}],["circle",{cx:"17.5",cy:"10.5",r:".5",key:"736e4u"}],["circle",{cx:"8.5",cy:"7.5",r:".5",key:"clrty"}],["circle",{cx:"6.5",cy:"12.5",r:".5",key:"1s4xz9"}],["path",{d:"M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10c.926 0 1.648-.746 1.648-1.688 0-.437-.18-.835-.437-1.125-.29-.289-.438-.652-.438-1.125a1.64 1.64 0 0 1 1.668-1.668h1.996c3.051 0 5.555-2.503 5.555-5.554C21.965 6.012 17.461 2 12 2z",key:"12rzf8"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Wo=xe("PenLine",[["path",{d:"M12 20h9",key:"t2du7b"}],["path",{d:"M16.5 3.5a2.12 2.12 0 0 1 3 3L7 19l-4 1 1-4Z",key:"ymcmye"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bt=xe("PenSquare",[["path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1qinfi"}],["path",{d:"M18.5 2.5a2.12 2.12 0 0 1 3 3L12 15l-4 1 1-4Z",key:"w2jsv5"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bd=xe("Pen",[["path",{d:"M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z",key:"5qss01"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const js=xe("Percent",[["line",{x1:"19",x2:"5",y1:"5",y2:"19",key:"1x9vlm"}],["circle",{cx:"6.5",cy:"6.5",r:"2.5",key:"4mh3h7"}],["circle",{cx:"17.5",cy:"17.5",r:"2.5",key:"1mdrzq"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jx=xe("PieChart",[["path",{d:"M21.21 15.89A10 10 0 1 1 8 2.83",key:"k2fpak"}],["path",{d:"M22 12A10 10 0 0 0 12 2v10z",key:"1rfc4y"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qd=xe("PiggyBank",[["path",{d:"M19 5c-1.5 0-2.8 1.4-3 2-3.5-1.5-11-.3-11 5 0 1.8 0 3 2 4.5V20h4v-2h3v2h4v-4c1-.5 1.7-1 2-2h2v-4h-2c0-1-.5-1.5-1-2h0V5z",key:"uf6l00"}],["path",{d:"M2 9v1c0 1.1.9 2 2 2h1",key:"nm575m"}],["path",{d:"M16 11h0",key:"k2aug8"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _x=xe("Plane",[["path",{d:"M17.8 19.2 16 11l3.5-3.5C21 6 21.5 4 21 3c-1-.5-3 0-4.5 1.5L13 8 4.8 6.2c-.5-.1-.9.1-1.1.5l-.3.5c-.2.5-.1 1 .3 1.3L9 12l-2 3H4l-1 1 3 2 2 3 1-1v-3l3-2 3.5 5.3c.3.4.8.5 1.3.3l.5-.2c.4-.3.6-.7.5-1.2z",key:"1v9wt8"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qh=xe("PlusCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}],["path",{d:"M12 8v8",key:"napkw2"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const is=xe("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ex=xe("Radio",[["path",{d:"M4.9 19.1C1 15.2 1 8.8 4.9 4.9",key:"1vaf9d"}],["path",{d:"M7.8 16.2c-2.3-2.3-2.3-6.1 0-8.5",key:"u1ii0m"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}],["path",{d:"M16.2 7.8c2.3 2.3 2.3 6.1 0 8.5",key:"1j5fej"}],["path",{d:"M19.1 4.9C23 8.8 23 15.1 19.1 19",key:"10b0cb"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ix=xe("RefreshCcw",[["path",{d:"M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"14sxne"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16",key:"1hlbsb"}],["path",{d:"M16 16h5v5",key:"ccwih5"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Rn=xe("Rocket",[["path",{d:"M4.5 16.5c-1.5 1.26-2 5-2 5s3.74-.5 5-2c.71-.84.7-2.13-.09-2.91a2.18 2.18 0 0 0-2.91-.09z",key:"m3kijz"}],["path",{d:"m12 15-3-3a22 22 0 0 1 2-3.95A12.88 12.88 0 0 1 22 2c0 2.72-.78 7.5-6 11a22.35 22.35 0 0 1-4 2z",key:"1fmvmk"}],["path",{d:"M9 12H4s.55-3.03 2-4c1.62-1.08 5 0 5 0",key:"1f8sc4"}],["path",{d:"M12 15v5s3.03-.55 4-2c1.08-1.62 0-5 0-5",key:"qeys4"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Kl=xe("Save",[["path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z",key:"1owoqh"}],["polyline",{points:"17 21 17 13 7 13 7 21",key:"1md35c"}],["polyline",{points:"7 3 7 8 15 8",key:"8nz8an"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Tx=xe("Scale",[["path",{d:"m16 16 3-8 3 8c-.87.65-1.92 1-3 1s-2.13-.35-3-1Z",key:"7g6ntu"}],["path",{d:"m2 16 3-8 3 8c-.87.65-1.92 1-3 1s-2.13-.35-3-1Z",key:"ijws7r"}],["path",{d:"M7 21h10",key:"1b0cd5"}],["path",{d:"M12 3v18",key:"108xh3"}],["path",{d:"M3 7h2c2 0 5-1 7-2 2 1 5 2 7 2h2",key:"3gwbw2"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Yr=xe("ScrollText",[["path",{d:"M8 21h12a2 2 0 0 0 2-2v-2H10v2a2 2 0 1 1-4 0V5a2 2 0 1 0-4 0v3h4",key:"13a6an"}],["path",{d:"M19 17V5a2 2 0 0 0-2-2H4",key:"zz82l3"}],["path",{d:"M15 8h-5",key:"1khuty"}],["path",{d:"M15 12h-5",key:"r7krc0"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xh=xe("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Sx=xe("Send",[["path",{d:"m22 2-7 20-4-9-9-4Z",key:"1q3vgg"}],["path",{d:"M22 2 11 13",key:"nzbqef"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bs=xe("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xn=xe("ShieldAlert",[["path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10",key:"1irkt0"}],["path",{d:"M12 8v4",key:"1got3b"}],["path",{d:"M12 16h.01",key:"1drbdi"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Da=xe("ShieldCheck",[["path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10",key:"1irkt0"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Yl=xe("ShieldX",[["path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10",key:"1irkt0"}],["path",{d:"m14.5 9-5 5",key:"1m49dw"}],["path",{d:"m9.5 9 5 5",key:"wyx7zg"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $t=xe("Shield",[["path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10",key:"1irkt0"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Wd=xe("SlidersHorizontal",[["line",{x1:"21",x2:"14",y1:"4",y2:"4",key:"obuewd"}],["line",{x1:"10",x2:"3",y1:"4",y2:"4",key:"1q6298"}],["line",{x1:"21",x2:"12",y1:"12",y2:"12",key:"1iu8h1"}],["line",{x1:"8",x2:"3",y1:"12",y2:"12",key:"ntss68"}],["line",{x1:"21",x2:"16",y1:"20",y2:"20",key:"14d8ph"}],["line",{x1:"12",x2:"3",y1:"20",y2:"20",key:"m0wm8r"}],["line",{x1:"14",x2:"14",y1:"2",y2:"6",key:"14e1ph"}],["line",{x1:"8",x2:"8",y1:"10",y2:"14",key:"1i6ji0"}],["line",{x1:"16",x2:"16",y1:"18",y2:"22",key:"1lctlv"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nr=xe("Sparkles",[["path",{d:"m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z",key:"17u4zn"}],["path",{d:"M5 3v4",key:"bklmnn"}],["path",{d:"M19 17v4",key:"iiml17"}],["path",{d:"M3 5h4",key:"nem4j1"}],["path",{d:"M17 19h4",key:"lbex7p"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zo=xe("Square",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ax=xe("StickyNote",[["path",{d:"M15.5 3H5a2 2 0 0 0-2 2v14c0 1.1.9 2 2 2h14a2 2 0 0 0 2-2V8.5L15.5 3Z",key:"1wis1t"}],["path",{d:"M15 3v6h6",key:"edgan2"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Jh=xe("Sun",[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"m4.93 4.93 1.41 1.41",key:"149t6j"}],["path",{d:"m17.66 17.66 1.41 1.41",key:"ptbguv"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"m6.34 17.66-1.41 1.41",key:"1m8zz5"}],["path",{d:"m19.07 4.93-1.41 1.41",key:"1shlcs"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Cx=xe("Table2",[["path",{d:"M9 3H5a2 2 0 0 0-2 2v4m6-6h10a2 2 0 0 1 2 2v4M9 3v18m0 0h10a2 2 0 0 0 2-2V9M9 21H5a2 2 0 0 1-2-2V9m0 0h18",key:"gugj83"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Dx=xe("Table",[["path",{d:"M12 3v18",key:"108xh3"}],["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M3 15h18",key:"5xshup"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $x=xe("Tag",[["path",{d:"M12 2H2v10l9.29 9.29c.94.94 2.48.94 3.42 0l6.58-6.58c.94-.94.94-2.48 0-3.42L12 2Z",key:"14b2ls"}],["path",{d:"M7 7h.01",key:"7u93v4"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qt=xe("Target",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Rx=xe("Terminal",[["polyline",{points:"4 17 10 11 4 5",key:"akl6gq"}],["line",{x1:"12",x2:"20",y1:"19",y2:"19",key:"q2wloq"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Px=xe("ThumbsDown",[["path",{d:"M17 14V2",key:"8ymqnk"}],["path",{d:"M9 18.12 10 14H4.17a2 2 0 0 1-1.92-2.56l2.33-8A2 2 0 0 1 6.5 2H20a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2h-2.76a2 2 0 0 0-1.79 1.11L12 22h0a3.13 3.13 0 0 1-3-3.88Z",key:"s6e0r"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ql=xe("Timer",[["line",{x1:"10",x2:"14",y1:"2",y2:"2",key:"14vaq8"}],["line",{x1:"12",x2:"15",y1:"14",y2:"11",key:"17fdiu"}],["circle",{cx:"12",cy:"14",r:"8",key:"1e1u0o"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const At=xe("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Mx=xe("Trash",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sr=xe("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hl=xe("UserX",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"17",x2:"22",y1:"8",y2:"13",key:"3nzzx3"}],["line",{x1:"22",x2:"17",y1:"8",y2:"13",key:"1swrse"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Si=xe("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pn=xe("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ox=xe("Wallet2",[["path",{d:"M17 14h.01",key:"7oqj8z"}],["path",{d:"M7 7h12a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h14",key:"u1rqew"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vx=xe("Wallet",[["path",{d:"M21 12V7H5a2 2 0 0 1 0-4h14v4",key:"195gfw"}],["path",{d:"M3 5v14a2 2 0 0 0 2 2h16v-5",key:"195n9w"}],["path",{d:"M18 12a2 2 0 0 0 0 4h4v-4Z",key:"vllfpd"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xn=xe("Wand2",[["path",{d:"m21.64 3.64-1.28-1.28a1.21 1.21 0 0 0-1.72 0L2.36 18.64a1.21 1.21 0 0 0 0 1.72l1.28 1.28a1.2 1.2 0 0 0 1.72 0L21.64 5.36a1.2 1.2 0 0 0 0-1.72Z",key:"1bcowg"}],["path",{d:"m14 7 3 3",key:"1r5n42"}],["path",{d:"M5 6v4",key:"ilb8ba"}],["path",{d:"M19 14v4",key:"blhpug"}],["path",{d:"M10 2v2",key:"7u0qdc"}],["path",{d:"M7 8H3",key:"zfb6yr"}],["path",{d:"M21 16h-4",key:"1cnmox"}],["path",{d:"M11 3H9",key:"1obp7u"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pt=xe("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),Zh="/assets/logo-CxzOhvKg.png",Lx=()=>{const[s,e]=I.useState("member"),[t,n]=I.useState(""),[a,i]=I.useState(""),[o,c]=I.useState(""),{login:d,user:h,isAuthenticated:m}=pt(),{theme:x,toggleTheme:f}=at(),{activateAdmin:k}=kt(),A=$h(),[D]=up();I.useEffect(()=>{document.body.classList.toggle("dark",x==="dark")},[x]),I.useEffect(()=>{var L,E,M;if(m&&h){A("/management");return}if((L=window.Telegram)!=null&&L.WebApp){window.Telegram.WebApp.ready(),window.Telegram.WebApp.expand();const C=D.get("tgWebAppData")||window.Telegram.WebApp.initData,v=D.get("login"),p=D.get("password");if(v&&p&&d(v,p)){A("/management");return}if(C)try{const j=new URLSearchParams(C).get("user");if(j){const y=JSON.parse(decodeURIComponent(j)).id;sessionStorage.setItem("telegram_user_id",String(y));const re=localStorage.getItem("apevault-auth");if(re)try{const ue=JSON.parse(re);if((E=ue.state)!=null&&E.user){const W=ue.state.user;if(d(W.login,W.password)){A("/management");return}}}catch(ue){console.error("Error parsing saved auth:",ue)}console.log("Telegram Mini App detected, user ID:",y)}}catch(N){console.error("Error parsing Telegram initData:",N)}const w=(M=window.Telegram.WebApp.initDataUnsafe)==null?void 0:M.user;w&&(sessionStorage.setItem("telegram_user_id",String(w.id)),console.log("Telegram user detected:",w.first_name))}},[D,m,h,A,d]);const T=L=>{if(L.preventDefault(),c(""),!a){c("Пожалуйста, введите пароль");return}if(s==="admin")k(a)?A("/management"):c("Неверный пароль администратора");else{if(!t){c("Пожалуйста, введите логин");return}d(t,a)?A("/management"):c("Неверный логин или пароль")}},H=()=>{f()};return r.jsxs("div",{className:`min-h-screen relative overflow-hidden ${x==="dark"?"bg-[#0b0f17]":"bg-gradient-to-br from-slate-50 via-white to-slate-100"}`,children:[r.jsxs("div",{className:"absolute inset-0 pointer-events-none",children:[r.jsx("div",{className:"absolute -top-24 -left-24 w-[620px] h-[620px] bg-gradient-to-br from-[#4E6E49]/35 via-emerald-400/22 to-transparent blur-[110px]"}),r.jsx("div",{className:"absolute top-[-120px] right-[-180px] w-[780px] h-[780px] bg-gradient-to-bl from-blue-500/24 via-purple-500/22 to-transparent blur-[140px]"}),r.jsx("div",{className:"absolute bottom-[-200px] right-[-80px] w-[620px] h-[620px] bg-gradient-to-tr from-amber-400/18 via-[#4E6E49]/18 to-transparent blur-[120px]"}),r.jsx("div",{className:"floating-grid opacity-75 dark:opacity-45"})]}),r.jsx("div",{className:"relative z-10 max-w-6xl mx-auto px-4 lg:px-6 min-h-screen flex items-center justify-center py-10",children:r.jsxs("div",{className:"glass-panel rounded-[28px] p-4 sm:p-6 md:p-8 border border-white/70 dark:border-white/10 shadow-2xl overflow-hidden w-full",children:[r.jsx("div",{className:"accent-dots"}),r.jsxs("div",{className:"relative z-10 grid md:grid-cols-[1.05fr_0.95fr] gap-6 lg:gap-8 items-stretch",children:[r.jsxs("div",{className:"flex flex-col items-center text-center gap-6 py-10 relative",children:[r.jsx("div",{className:"p-4 rounded-2xl bg-white/80 dark:bg-white/5 border border-white/50 dark:border-white/10 shadow-lg backdrop-blur-sm",children:r.jsx("img",{src:Zh,alt:"ApeVault Logo",className:"w-16 h-16 object-contain"})}),r.jsxs("div",{className:"space-y-1",children:[r.jsx("p",{className:`text-xs uppercase tracking-[0.16em] ${x==="dark"?"text-gray-400":"text-gray-500"}`,children:"ApeVault Black Ops"}),r.jsx("h1",{className:`text-3xl lg:text-4xl font-extrabold ${x==="dark"?"text-white":"text-gray-900"}`,children:"Командная панель"})]}),r.jsxs("div",{className:"inline-flex items-center gap-2 px-3 py-1 rounded-full bg-gradient-to-r from-[#4E6E49]/15 to-emerald-500/10 text-[#4E6E49] text-xs font-semibold",children:[r.jsx($t,{className:"w-4 h-4"}),"Защищенный доступ"]}),r.jsxs("div",{className:"w-full mt-6 flex flex-col sm:flex-row gap-3",children:[r.jsxs("a",{href:"/rules.pdf",download:!0,className:"flex-1 inline-flex items-center justify-center gap-2 px-5 py-3 text-sm font-bold rounded-xl bg-gradient-to-r from-[#4E6E49] to-emerald-600 text-white shadow-lg hover:shadow-[#4E6E49]/20 hover:-translate-y-0.5 transition-all",children:[r.jsx(Wh,{className:"w-4 h-4"}),"Скачать правила"]}),r.jsxs("a",{href:"https://t.me/artyommedoed",target:"_blank",rel:"noopener noreferrer",className:`flex-1 inline-flex items-center justify-center gap-2 px-5 py-3 text-sm font-bold rounded-xl border transition-all hover:-translate-y-0.5 ${x==="dark"?"border-white/10 bg-white/5 text-white hover:bg-white/10":"border-gray-200 bg-white text-gray-700 hover:bg-gray-50"}`,children:[r.jsx(Sx,{className:"w-4 h-4"}),"Админ (TG)"]})]})]}),r.jsxs("div",{className:"section-card rounded-2xl p-6 lg:p-7 border border-white/60 dark:border-white/10 shadow-xl",children:[r.jsxs("div",{className:"flex items-center justify-between mb-6",children:[r.jsxs("div",{children:[r.jsx("p",{className:`text-xs uppercase tracking-[0.12em] ${x==="dark"?"text-gray-400":"text-gray-500"}`,children:"Доступ"}),r.jsx("h2",{className:`text-2xl font-extrabold ${x==="dark"?"text-white":"text-gray-900"}`,children:"Вход в систему"})]}),r.jsx("button",{onClick:H,className:"nav-chip px-3 py-2","data-active":"false","aria-label":"Toggle theme",children:x==="dark"?r.jsx(Jh,{className:"w-5 h-5 text-amber-300"}):r.jsx(Gl,{className:"w-5 h-5 text-gray-700"})})]}),r.jsxs("form",{onSubmit:T,className:"space-y-5",children:[r.jsxs("div",{children:[r.jsx("label",{className:`block text-sm font-semibold mb-3 ${x==="dark"?"text-gray-300":"text-gray-700"}`,children:"Тип пользователя"}),r.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[r.jsxs("button",{type:"button",onClick:()=>{e("member"),n(""),i(""),c("")},className:"pill justify-center","data-active":s==="member",children:[r.jsx(Pn,{className:"w-5 h-5"}),r.jsx("span",{children:"Участник"})]}),r.jsxs("button",{type:"button",onClick:()=>{e("admin"),n(""),i(""),c("")},className:"pill justify-center","data-active":s==="admin",children:[r.jsx($t,{className:"w-5 h-5"}),r.jsx("span",{children:"Админ"})]})]})]}),s==="member"&&r.jsxs("div",{children:[r.jsxs("label",{htmlFor:"login",className:`block text-sm font-semibold mb-2 ${x==="dark"?"text-gray-300":"text-gray-700"}`,children:[r.jsx(Si,{className:"w-4 h-4 inline mr-2"}),"Логин"]}),r.jsx("div",{className:"flex items-center gap-2",children:r.jsx("input",{id:"login",type:"text",value:t,onChange:L=>n(L.target.value),className:`w-full px-4 py-3 rounded-xl border transition-all ${x==="dark"?"bg-white/5 border-white/10 text-white placeholder-gray-500 focus:border-[#4E6E49]":"bg-white border-gray-300 text-gray-900 placeholder-gray-400 focus:border-[#4E6E49]"} focus:outline-none focus:ring-4 focus:ring-[#4E6E49]/20`,placeholder:"Введите ваш логин",autoComplete:"username"})})]}),r.jsxs("div",{children:[r.jsxs("label",{htmlFor:"password",className:`block text-sm font-semibold mb-2 ${x==="dark"?"text-gray-300":"text-gray-700"}`,children:[r.jsx($t,{className:"w-4 h-4 inline mr-2"}),"Пароль"]}),r.jsx("input",{id:"password",type:"password",value:a,onChange:L=>i(L.target.value),className:`w-full px-4 py-3 rounded-xl border transition-all ${x==="dark"?"bg-white/5 border-white/10 text-white placeholder-gray-500 focus:border-[#4E6E49]":"bg-white border-gray-300 text-gray-900 placeholder-gray-400 focus:border-[#4E6E49]"} focus:outline-none focus:ring-4 focus:ring-[#4E6E49]/20`,placeholder:s==="admin"?"Введите пароль администратора":"Введите ваш пароль",autoComplete:s==="admin"?"off":"current-password"}),s==="admin"&&r.jsx("p",{className:`mt-2 text-xs ${x==="dark"?"text-gray-400":"text-gray-500"}`,children:"Для входа в режим администратора требуется специальный пароль"})]}),o&&r.jsx("div",{className:`p-4 rounded-xl border ${x==="dark"?"bg-red-500/15 border-red-500/40 text-red-300":"bg-red-50 border-red-300 text-red-700"} text-sm font-semibold animate-shake`,children:o}),r.jsx("button",{type:"submit",className:"w-full py-3 px-4 rounded-xl font-bold text-lg shadow-lg hover:shadow-xl transform hover:-translate-y-0.5 transition-all bg-gradient-to-r from-[#4E6E49] to-[#4E6E49] text-white",children:"Войти в систему"})]}),r.jsx("div",{className:`mt-6 pt-6 border-t ${x==="dark"?"border-white/10":"border-gray-200"} flex items-center justify-between gap-3 flex-wrap`,children:r.jsx("div",{className:`text-xs ${x==="dark"?"text-gray-400":"text-gray-600"}`,children:"Защищенная система для команды ApeVault"})})]})]})]})})]})};var zd={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const em=function(s){const e=[];let t=0;for(let n=0;n<s.length;n++){let a=s.charCodeAt(n);a<128?e[t++]=a:a<2048?(e[t++]=a>>6|192,e[t++]=a&63|128):(a&64512)===55296&&n+1<s.length&&(s.charCodeAt(n+1)&64512)===56320?(a=65536+((a&1023)<<10)+(s.charCodeAt(++n)&1023),e[t++]=a>>18|240,e[t++]=a>>12&63|128,e[t++]=a>>6&63|128,e[t++]=a&63|128):(e[t++]=a>>12|224,e[t++]=a>>6&63|128,e[t++]=a&63|128)}return e},Fx=function(s){const e=[];let t=0,n=0;for(;t<s.length;){const a=s[t++];if(a<128)e[n++]=String.fromCharCode(a);else if(a>191&&a<224){const i=s[t++];e[n++]=String.fromCharCode((a&31)<<6|i&63)}else if(a>239&&a<365){const i=s[t++],o=s[t++],c=s[t++],d=((a&7)<<18|(i&63)<<12|(o&63)<<6|c&63)-65536;e[n++]=String.fromCharCode(55296+(d>>10)),e[n++]=String.fromCharCode(56320+(d&1023))}else{const i=s[t++],o=s[t++];e[n++]=String.fromCharCode((a&15)<<12|(i&63)<<6|o&63)}}return e.join("")},tm={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(s,e){if(!Array.isArray(s))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,n=[];for(let a=0;a<s.length;a+=3){const i=s[a],o=a+1<s.length,c=o?s[a+1]:0,d=a+2<s.length,h=d?s[a+2]:0,m=i>>2,x=(i&3)<<4|c>>4;let f=(c&15)<<2|h>>6,k=h&63;d||(k=64,o||(f=64)),n.push(t[m],t[x],t[f],t[k])}return n.join("")},encodeString(s,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(s):this.encodeByteArray(em(s),e)},decodeString(s,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(s):Fx(this.decodeStringToByteArray(s,e))},decodeStringToByteArray(s,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,n=[];for(let a=0;a<s.length;){const i=t[s.charAt(a++)],c=a<s.length?t[s.charAt(a)]:0;++a;const h=a<s.length?t[s.charAt(a)]:64;++a;const x=a<s.length?t[s.charAt(a)]:64;if(++a,i==null||c==null||h==null||x==null)throw new Ux;const f=i<<2|c>>4;if(n.push(f),h!==64){const k=c<<4&240|h>>2;if(n.push(k),x!==64){const A=h<<6&192|x;n.push(A)}}}return n},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let s=0;s<this.ENCODED_VALS.length;s++)this.byteToCharMap_[s]=this.ENCODED_VALS.charAt(s),this.charToByteMap_[this.byteToCharMap_[s]]=s,this.byteToCharMapWebSafe_[s]=this.ENCODED_VALS_WEBSAFE.charAt(s),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[s]]=s,s>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(s)]=s,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(s)]=s)}}};class Ux extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const Bx=function(s){const e=em(s);return tm.encodeByteArray(e,!0)},Ai=function(s){return Bx(s).replace(/\./g,"")},rm=function(s){try{return tm.decodeString(s,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qx(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Wx=()=>qx().__FIREBASE_DEFAULTS__,zx=()=>{if(typeof process>"u"||typeof zd>"u")return;const s=zd.__FIREBASE_DEFAULTS__;if(s)return JSON.parse(s)},Hx=()=>{if(typeof document>"u")return;let s;try{s=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=s&&rm(s[1]);return e&&JSON.parse(e)},no=()=>{try{return Wx()||zx()||Hx()}catch(s){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${s}`);return}},sm=s=>{var e,t;return(t=(e=no())===null||e===void 0?void 0:e.emulatorHosts)===null||t===void 0?void 0:t[s]},nm=s=>{const e=sm(s);if(!e)return;const t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const n=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),n]:[e.substring(0,t),n]},am=()=>{var s;return(s=no())===null||s===void 0?void 0:s.config},im=s=>{var e;return(e=no())===null||e===void 0?void 0:e[`_${s}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gx{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,n)=>{t?this.reject(t):this.resolve(n),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,n))}}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function om(s,e){if(s.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const t={alg:"none",type:"JWT"},n=e||"demo-project",a=s.iat||0,i=s.sub||s.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o=Object.assign({iss:`https://securetoken.google.com/${n}`,aud:n,iat:a,exp:a+3600,auth_time:a,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}}},s);return[Ai(JSON.stringify(t)),Ai(JSON.stringify(o)),""].join(".")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Jt(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function Kx(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Jt())}function Yx(){var s;const e=(s=no())===null||s===void 0?void 0:s.forceEnvironment;if(e==="node")return!0;if(e==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function Qx(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function Xx(){const s=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof s=="object"&&s.id!==void 0}function Jx(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function Zx(){const s=Jt();return s.indexOf("MSIE ")>=0||s.indexOf("Trident/")>=0}function ef(){return!Yx()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function tf(){try{return typeof indexedDB=="object"}catch{return!1}}function rf(){return new Promise((s,e)=>{try{let t=!0;const n="validate-browser-context-for-indexeddb-analytics-module",a=self.indexedDB.open(n);a.onsuccess=()=>{a.result.close(),t||self.indexedDB.deleteDatabase(n),s(!0)},a.onupgradeneeded=()=>{t=!1},a.onerror=()=>{var i;e(((i=a.error)===null||i===void 0?void 0:i.message)||"")}}catch(t){e(t)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sf="FirebaseError";class Br extends Error{constructor(e,t,n){super(t),this.code=e,this.customData=n,this.name=sf,Object.setPrototypeOf(this,Br.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,$a.prototype.create)}}class $a{constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(e,...t){const n=t[0]||{},a=`${this.service}/${e}`,i=this.errors[e],o=i?nf(i,n):"Error",c=`${this.serviceName}: ${o} (${a}).`;return new Br(a,c,n)}}function nf(s,e){return s.replace(af,(t,n)=>{const a=e[n];return a!=null?String(a):`<${n}?>`})}const af=/\{\$([^}]+)}/g;function of(s){for(const e in s)if(Object.prototype.hasOwnProperty.call(s,e))return!1;return!0}function Ci(s,e){if(s===e)return!0;const t=Object.keys(s),n=Object.keys(e);for(const a of t){if(!n.includes(a))return!1;const i=s[a],o=e[a];if(Hd(i)&&Hd(o)){if(!Ci(i,o))return!1}else if(i!==o)return!1}for(const a of n)if(!t.includes(a))return!1;return!0}function Hd(s){return s!==null&&typeof s=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ra(s){const e=[];for(const[t,n]of Object.entries(s))Array.isArray(n)?n.forEach(a=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(a))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(n));return e.length?"&"+e.join("&"):""}function lf(s,e){const t=new cf(s,e);return t.subscribe.bind(t)}class cf{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(n=>{this.error(n)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,n){let a;if(e===void 0&&t===void 0&&n===void 0)throw new Error("Missing Observer.");df(e,["next","error","complete"])?a=e:a={next:e,error:t,complete:n},a.next===void 0&&(a.next=Ho),a.error===void 0&&(a.error=Ho),a.complete===void 0&&(a.complete=Ho);const i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?a.error(this.finalError):a.complete()}catch{}}),this.observers.push(a),i}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(n){typeof console<"u"&&console.error&&console.error(n)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function df(s,e){if(typeof s!="object"||s===null)return!1;for(const t of e)if(t in s&&typeof s[t]=="function")return!0;return!1}function Ho(){}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Zt(s){return s&&s._delegate?s._delegate:s}class Ds{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Us="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uf{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const n=new Gx;if(this.instancesDeferred.set(t,n),this.isInitialized(t)||this.shouldAutoInitialize())try{const a=this.getOrInitializeService({instanceIdentifier:t});a&&n.resolve(a)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const n=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),a=(t=e==null?void 0:e.optional)!==null&&t!==void 0?t:!1;if(this.isInitialized(n)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:n})}catch(i){if(a)return null;throw i}else{if(a)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(mf(e))try{this.getOrInitializeService({instanceIdentifier:Us})}catch{}for(const[t,n]of this.instancesDeferred.entries()){const a=this.normalizeInstanceIdentifier(t);try{const i=this.getOrInitializeService({instanceIdentifier:a});n.resolve(i)}catch{}}}}clearInstance(e=Us){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=Us){return this.instances.has(e)}getOptions(e=Us){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,n=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const a=this.getOrInitializeService({instanceIdentifier:n,options:t});for(const[i,o]of this.instancesDeferred.entries()){const c=this.normalizeInstanceIdentifier(i);n===c&&o.resolve(a)}return a}onInit(e,t){var n;const a=this.normalizeInstanceIdentifier(t),i=(n=this.onInitCallbacks.get(a))!==null&&n!==void 0?n:new Set;i.add(e),this.onInitCallbacks.set(a,i);const o=this.instances.get(a);return o&&e(o,a),()=>{i.delete(e)}}invokeOnInitCallbacks(e,t){const n=this.onInitCallbacks.get(t);if(n)for(const a of n)try{a(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let n=this.instances.get(e);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:hf(e),options:t}),this.instances.set(e,n),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(n,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,n)}catch{}return n||null}normalizeInstanceIdentifier(e=Us){return this.component?this.component.multipleInstances?e:Us:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function hf(s){return s===Us?void 0:s}function mf(s){return s.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gf{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new uf(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var tt;(function(s){s[s.DEBUG=0]="DEBUG",s[s.VERBOSE=1]="VERBOSE",s[s.INFO=2]="INFO",s[s.WARN=3]="WARN",s[s.ERROR=4]="ERROR",s[s.SILENT=5]="SILENT"})(tt||(tt={}));const pf={debug:tt.DEBUG,verbose:tt.VERBOSE,info:tt.INFO,warn:tt.WARN,error:tt.ERROR,silent:tt.SILENT},xf=tt.INFO,ff={[tt.DEBUG]:"log",[tt.VERBOSE]:"log",[tt.INFO]:"info",[tt.WARN]:"warn",[tt.ERROR]:"error"},yf=(s,e,...t)=>{if(e<s.logLevel)return;const n=new Date().toISOString(),a=ff[e];if(a)console[a](`[${n}]  ${s.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class Xl{constructor(e){this.name=e,this._logLevel=xf,this._logHandler=yf,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in tt))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?pf[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,tt.DEBUG,...e),this._logHandler(this,tt.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,tt.VERBOSE,...e),this._logHandler(this,tt.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,tt.INFO,...e),this._logHandler(this,tt.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,tt.WARN,...e),this._logHandler(this,tt.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,tt.ERROR,...e),this._logHandler(this,tt.ERROR,...e)}}const bf=(s,e)=>e.some(t=>s instanceof t);let Gd,Kd;function vf(){return Gd||(Gd=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function wf(){return Kd||(Kd=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const lm=new WeakMap,ml=new WeakMap,cm=new WeakMap,Go=new WeakMap,Jl=new WeakMap;function kf(s){const e=new Promise((t,n)=>{const a=()=>{s.removeEventListener("success",i),s.removeEventListener("error",o)},i=()=>{t(Ts(s.result)),a()},o=()=>{n(s.error),a()};s.addEventListener("success",i),s.addEventListener("error",o)});return e.then(t=>{t instanceof IDBCursor&&lm.set(t,s)}).catch(()=>{}),Jl.set(e,s),e}function Nf(s){if(ml.has(s))return;const e=new Promise((t,n)=>{const a=()=>{s.removeEventListener("complete",i),s.removeEventListener("error",o),s.removeEventListener("abort",o)},i=()=>{t(),a()},o=()=>{n(s.error||new DOMException("AbortError","AbortError")),a()};s.addEventListener("complete",i),s.addEventListener("error",o),s.addEventListener("abort",o)});ml.set(s,e)}let gl={get(s,e,t){if(s instanceof IDBTransaction){if(e==="done")return ml.get(s);if(e==="objectStoreNames")return s.objectStoreNames||cm.get(s);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return Ts(s[e])},set(s,e,t){return s[e]=t,!0},has(s,e){return s instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in s}};function jf(s){gl=s(gl)}function _f(s){return s===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const n=s.call(Ko(this),e,...t);return cm.set(n,e.sort?e.sort():[e]),Ts(n)}:wf().includes(s)?function(...e){return s.apply(Ko(this),e),Ts(lm.get(this))}:function(...e){return Ts(s.apply(Ko(this),e))}}function Ef(s){return typeof s=="function"?_f(s):(s instanceof IDBTransaction&&Nf(s),bf(s,vf())?new Proxy(s,gl):s)}function Ts(s){if(s instanceof IDBRequest)return kf(s);if(Go.has(s))return Go.get(s);const e=Ef(s);return e!==s&&(Go.set(s,e),Jl.set(e,s)),e}const Ko=s=>Jl.get(s);function If(s,e,{blocked:t,upgrade:n,blocking:a,terminated:i}={}){const o=indexedDB.open(s,e),c=Ts(o);return n&&o.addEventListener("upgradeneeded",d=>{n(Ts(o.result),d.oldVersion,d.newVersion,Ts(o.transaction),d)}),t&&o.addEventListener("blocked",d=>t(d.oldVersion,d.newVersion,d)),c.then(d=>{i&&d.addEventListener("close",()=>i()),a&&d.addEventListener("versionchange",h=>a(h.oldVersion,h.newVersion,h))}).catch(()=>{}),c}const Tf=["get","getKey","getAll","getAllKeys","count"],Sf=["put","add","delete","clear"],Yo=new Map;function Yd(s,e){if(!(s instanceof IDBDatabase&&!(e in s)&&typeof e=="string"))return;if(Yo.get(e))return Yo.get(e);const t=e.replace(/FromIndex$/,""),n=e!==t,a=Sf.includes(t);if(!(t in(n?IDBIndex:IDBObjectStore).prototype)||!(a||Tf.includes(t)))return;const i=async function(o,...c){const d=this.transaction(o,a?"readwrite":"readonly");let h=d.store;return n&&(h=h.index(c.shift())),(await Promise.all([h[t](...c),a&&d.done]))[0]};return Yo.set(e,i),i}jf(s=>({...s,get:(e,t,n)=>Yd(e,t)||s.get(e,t,n),has:(e,t)=>!!Yd(e,t)||s.has(e,t)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Af{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(Cf(t)){const n=t.getImmediate();return`${n.library}/${n.version}`}else return null}).filter(t=>t).join(" ")}}function Cf(s){const e=s.getComponent();return(e==null?void 0:e.type)==="VERSION"}const pl="@firebase/app",Qd="0.10.13";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const os=new Xl("@firebase/app"),Df="@firebase/app-compat",$f="@firebase/analytics-compat",Rf="@firebase/analytics",Pf="@firebase/app-check-compat",Mf="@firebase/app-check",Of="@firebase/auth",Vf="@firebase/auth-compat",Lf="@firebase/database",Ff="@firebase/data-connect",Uf="@firebase/database-compat",Bf="@firebase/functions",qf="@firebase/functions-compat",Wf="@firebase/installations",zf="@firebase/installations-compat",Hf="@firebase/messaging",Gf="@firebase/messaging-compat",Kf="@firebase/performance",Yf="@firebase/performance-compat",Qf="@firebase/remote-config",Xf="@firebase/remote-config-compat",Jf="@firebase/storage",Zf="@firebase/storage-compat",ey="@firebase/firestore",ty="@firebase/vertexai-preview",ry="@firebase/firestore-compat",sy="firebase",ny="10.14.1";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xl="[DEFAULT]",ay={[pl]:"fire-core",[Df]:"fire-core-compat",[Rf]:"fire-analytics",[$f]:"fire-analytics-compat",[Mf]:"fire-app-check",[Pf]:"fire-app-check-compat",[Of]:"fire-auth",[Vf]:"fire-auth-compat",[Lf]:"fire-rtdb",[Ff]:"fire-data-connect",[Uf]:"fire-rtdb-compat",[Bf]:"fire-fn",[qf]:"fire-fn-compat",[Wf]:"fire-iid",[zf]:"fire-iid-compat",[Hf]:"fire-fcm",[Gf]:"fire-fcm-compat",[Kf]:"fire-perf",[Yf]:"fire-perf-compat",[Qf]:"fire-rc",[Xf]:"fire-rc-compat",[Jf]:"fire-gcs",[Zf]:"fire-gcs-compat",[ey]:"fire-fst",[ry]:"fire-fst-compat",[ty]:"fire-vertex","fire-js":"fire-js",[sy]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Di=new Map,iy=new Map,fl=new Map;function Xd(s,e){try{s.container.addComponent(e)}catch(t){os.debug(`Component ${e.name} failed to register with FirebaseApp ${s.name}`,t)}}function Ys(s){const e=s.name;if(fl.has(e))return os.debug(`There were multiple attempts to register component ${e}.`),!1;fl.set(e,s);for(const t of Di.values())Xd(t,s);for(const t of iy.values())Xd(t,s);return!0}function ao(s,e){const t=s.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),s.container.getProvider(e)}function _s(s){return s.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const oy={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},Ss=new $a("app","Firebase",oy);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ly{constructor(e,t,n){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new Ds("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Ss.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const en=ny;function dm(s,e={}){let t=s;typeof e!="object"&&(e={name:e});const n=Object.assign({name:xl,automaticDataCollectionEnabled:!1},e),a=n.name;if(typeof a!="string"||!a)throw Ss.create("bad-app-name",{appName:String(a)});if(t||(t=am()),!t)throw Ss.create("no-options");const i=Di.get(a);if(i){if(Ci(t,i.options)&&Ci(n,i.config))return i;throw Ss.create("duplicate-app",{appName:a})}const o=new gf(a);for(const d of fl.values())o.addComponent(d);const c=new ly(t,n,o);return Di.set(a,c),c}function Zl(s=xl){const e=Di.get(s);if(!e&&s===xl&&am())return dm();if(!e)throw Ss.create("no-app",{appName:s});return e}function Rr(s,e,t){var n;let a=(n=ay[s])!==null&&n!==void 0?n:s;t&&(a+=`-${t}`);const i=a.match(/\s|\//),o=e.match(/\s|\//);if(i||o){const c=[`Unable to register library "${a}" with version "${e}":`];i&&c.push(`library name "${a}" contains illegal characters (whitespace or "/")`),i&&o&&c.push("and"),o&&c.push(`version name "${e}" contains illegal characters (whitespace or "/")`),os.warn(c.join(" "));return}Ys(new Ds(`${a}-version`,()=>({library:a,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cy="firebase-heartbeat-database",dy=1,fa="firebase-heartbeat-store";let Qo=null;function um(){return Qo||(Qo=If(cy,dy,{upgrade:(s,e)=>{switch(e){case 0:try{s.createObjectStore(fa)}catch(t){console.warn(t)}}}}).catch(s=>{throw Ss.create("idb-open",{originalErrorMessage:s.message})})),Qo}async function uy(s){try{const t=(await um()).transaction(fa),n=await t.objectStore(fa).get(hm(s));return await t.done,n}catch(e){if(e instanceof Br)os.warn(e.message);else{const t=Ss.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});os.warn(t.message)}}}async function Jd(s,e){try{const n=(await um()).transaction(fa,"readwrite");await n.objectStore(fa).put(e,hm(s)),await n.done}catch(t){if(t instanceof Br)os.warn(t.message);else{const n=Ss.create("idb-set",{originalErrorMessage:t==null?void 0:t.message});os.warn(n.message)}}}function hm(s){return`${s.name}!${s.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hy=1024,my=30*24*60*60*1e3;class gy{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new xy(t),this._heartbeatsCachePromise=this._storage.read().then(n=>(this._heartbeatsCache=n,n))}async triggerHeartbeat(){var e,t;try{const a=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),i=Zd();return((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===i||this._heartbeatsCache.heartbeats.some(o=>o.date===i)?void 0:(this._heartbeatsCache.heartbeats.push({date:i,agent:a}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(o=>{const c=new Date(o.date).valueOf();return Date.now()-c<=my}),this._storage.overwrite(this._heartbeatsCache))}catch(n){os.warn(n)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const t=Zd(),{heartbeatsToSend:n,unsentEntries:a}=py(this._heartbeatsCache.heartbeats),i=Ai(JSON.stringify({version:2,heartbeats:n}));return this._heartbeatsCache.lastSentHeartbeatDate=t,a.length>0?(this._heartbeatsCache.heartbeats=a,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(t){return os.warn(t),""}}}function Zd(){return new Date().toISOString().substring(0,10)}function py(s,e=hy){const t=[];let n=s.slice();for(const a of s){const i=t.find(o=>o.agent===a.agent);if(i){if(i.dates.push(a.date),eu(t)>e){i.dates.pop();break}}else if(t.push({agent:a.agent,dates:[a.date]}),eu(t)>e){t.pop();break}n=n.slice(1)}return{heartbeatsToSend:t,unsentEntries:n}}class xy{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return tf()?rf().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const t=await uy(this.app);return t!=null&&t.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){const a=await this.read();return Jd(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:a.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){var t;if(await this._canUseIndexedDBPromise){const a=await this.read();return Jd(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:a.lastSentHeartbeatDate,heartbeats:[...a.heartbeats,...e.heartbeats]})}else return}}function eu(s){return Ai(JSON.stringify({version:2,heartbeats:s})).length}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fy(s){Ys(new Ds("platform-logger",e=>new Af(e),"PRIVATE")),Ys(new Ds("heartbeat",e=>new gy(e),"PRIVATE")),Rr(pl,Qd,s),Rr(pl,Qd,"esm2017"),Rr("fire-js","")}fy("");var tu=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var Gs,mm;(function(){var s;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(v,p){function w(){}w.prototype=p.prototype,v.D=p.prototype,v.prototype=new w,v.prototype.constructor=v,v.C=function(N,j,b){for(var y=Array(arguments.length-2),re=2;re<arguments.length;re++)y[re-2]=arguments[re];return p.prototype[j].apply(N,y)}}function t(){this.blockSize=-1}function n(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(n,t),n.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function a(v,p,w){w||(w=0);var N=Array(16);if(typeof p=="string")for(var j=0;16>j;++j)N[j]=p.charCodeAt(w++)|p.charCodeAt(w++)<<8|p.charCodeAt(w++)<<16|p.charCodeAt(w++)<<24;else for(j=0;16>j;++j)N[j]=p[w++]|p[w++]<<8|p[w++]<<16|p[w++]<<24;p=v.g[0],w=v.g[1],j=v.g[2];var b=v.g[3],y=p+(b^w&(j^b))+N[0]+3614090360&4294967295;p=w+(y<<7&4294967295|y>>>25),y=b+(j^p&(w^j))+N[1]+3905402710&4294967295,b=p+(y<<12&4294967295|y>>>20),y=j+(w^b&(p^w))+N[2]+606105819&4294967295,j=b+(y<<17&4294967295|y>>>15),y=w+(p^j&(b^p))+N[3]+3250441966&4294967295,w=j+(y<<22&4294967295|y>>>10),y=p+(b^w&(j^b))+N[4]+4118548399&4294967295,p=w+(y<<7&4294967295|y>>>25),y=b+(j^p&(w^j))+N[5]+1200080426&4294967295,b=p+(y<<12&4294967295|y>>>20),y=j+(w^b&(p^w))+N[6]+2821735955&4294967295,j=b+(y<<17&4294967295|y>>>15),y=w+(p^j&(b^p))+N[7]+4249261313&4294967295,w=j+(y<<22&4294967295|y>>>10),y=p+(b^w&(j^b))+N[8]+1770035416&4294967295,p=w+(y<<7&4294967295|y>>>25),y=b+(j^p&(w^j))+N[9]+2336552879&4294967295,b=p+(y<<12&4294967295|y>>>20),y=j+(w^b&(p^w))+N[10]+4294925233&4294967295,j=b+(y<<17&4294967295|y>>>15),y=w+(p^j&(b^p))+N[11]+2304563134&4294967295,w=j+(y<<22&4294967295|y>>>10),y=p+(b^w&(j^b))+N[12]+1804603682&4294967295,p=w+(y<<7&4294967295|y>>>25),y=b+(j^p&(w^j))+N[13]+4254626195&4294967295,b=p+(y<<12&4294967295|y>>>20),y=j+(w^b&(p^w))+N[14]+2792965006&4294967295,j=b+(y<<17&4294967295|y>>>15),y=w+(p^j&(b^p))+N[15]+1236535329&4294967295,w=j+(y<<22&4294967295|y>>>10),y=p+(j^b&(w^j))+N[1]+4129170786&4294967295,p=w+(y<<5&4294967295|y>>>27),y=b+(w^j&(p^w))+N[6]+3225465664&4294967295,b=p+(y<<9&4294967295|y>>>23),y=j+(p^w&(b^p))+N[11]+643717713&4294967295,j=b+(y<<14&4294967295|y>>>18),y=w+(b^p&(j^b))+N[0]+3921069994&4294967295,w=j+(y<<20&4294967295|y>>>12),y=p+(j^b&(w^j))+N[5]+3593408605&4294967295,p=w+(y<<5&4294967295|y>>>27),y=b+(w^j&(p^w))+N[10]+38016083&4294967295,b=p+(y<<9&4294967295|y>>>23),y=j+(p^w&(b^p))+N[15]+3634488961&4294967295,j=b+(y<<14&4294967295|y>>>18),y=w+(b^p&(j^b))+N[4]+3889429448&4294967295,w=j+(y<<20&4294967295|y>>>12),y=p+(j^b&(w^j))+N[9]+568446438&4294967295,p=w+(y<<5&4294967295|y>>>27),y=b+(w^j&(p^w))+N[14]+3275163606&4294967295,b=p+(y<<9&4294967295|y>>>23),y=j+(p^w&(b^p))+N[3]+4107603335&4294967295,j=b+(y<<14&4294967295|y>>>18),y=w+(b^p&(j^b))+N[8]+1163531501&4294967295,w=j+(y<<20&4294967295|y>>>12),y=p+(j^b&(w^j))+N[13]+2850285829&4294967295,p=w+(y<<5&4294967295|y>>>27),y=b+(w^j&(p^w))+N[2]+4243563512&4294967295,b=p+(y<<9&4294967295|y>>>23),y=j+(p^w&(b^p))+N[7]+1735328473&4294967295,j=b+(y<<14&4294967295|y>>>18),y=w+(b^p&(j^b))+N[12]+2368359562&4294967295,w=j+(y<<20&4294967295|y>>>12),y=p+(w^j^b)+N[5]+4294588738&4294967295,p=w+(y<<4&4294967295|y>>>28),y=b+(p^w^j)+N[8]+2272392833&4294967295,b=p+(y<<11&4294967295|y>>>21),y=j+(b^p^w)+N[11]+1839030562&4294967295,j=b+(y<<16&4294967295|y>>>16),y=w+(j^b^p)+N[14]+4259657740&4294967295,w=j+(y<<23&4294967295|y>>>9),y=p+(w^j^b)+N[1]+2763975236&4294967295,p=w+(y<<4&4294967295|y>>>28),y=b+(p^w^j)+N[4]+1272893353&4294967295,b=p+(y<<11&4294967295|y>>>21),y=j+(b^p^w)+N[7]+4139469664&4294967295,j=b+(y<<16&4294967295|y>>>16),y=w+(j^b^p)+N[10]+3200236656&4294967295,w=j+(y<<23&4294967295|y>>>9),y=p+(w^j^b)+N[13]+681279174&4294967295,p=w+(y<<4&4294967295|y>>>28),y=b+(p^w^j)+N[0]+3936430074&4294967295,b=p+(y<<11&4294967295|y>>>21),y=j+(b^p^w)+N[3]+3572445317&4294967295,j=b+(y<<16&4294967295|y>>>16),y=w+(j^b^p)+N[6]+76029189&4294967295,w=j+(y<<23&4294967295|y>>>9),y=p+(w^j^b)+N[9]+3654602809&4294967295,p=w+(y<<4&4294967295|y>>>28),y=b+(p^w^j)+N[12]+3873151461&4294967295,b=p+(y<<11&4294967295|y>>>21),y=j+(b^p^w)+N[15]+530742520&4294967295,j=b+(y<<16&4294967295|y>>>16),y=w+(j^b^p)+N[2]+3299628645&4294967295,w=j+(y<<23&4294967295|y>>>9),y=p+(j^(w|~b))+N[0]+4096336452&4294967295,p=w+(y<<6&4294967295|y>>>26),y=b+(w^(p|~j))+N[7]+1126891415&4294967295,b=p+(y<<10&4294967295|y>>>22),y=j+(p^(b|~w))+N[14]+2878612391&4294967295,j=b+(y<<15&4294967295|y>>>17),y=w+(b^(j|~p))+N[5]+4237533241&4294967295,w=j+(y<<21&4294967295|y>>>11),y=p+(j^(w|~b))+N[12]+1700485571&4294967295,p=w+(y<<6&4294967295|y>>>26),y=b+(w^(p|~j))+N[3]+2399980690&4294967295,b=p+(y<<10&4294967295|y>>>22),y=j+(p^(b|~w))+N[10]+4293915773&4294967295,j=b+(y<<15&4294967295|y>>>17),y=w+(b^(j|~p))+N[1]+2240044497&4294967295,w=j+(y<<21&4294967295|y>>>11),y=p+(j^(w|~b))+N[8]+1873313359&4294967295,p=w+(y<<6&4294967295|y>>>26),y=b+(w^(p|~j))+N[15]+4264355552&4294967295,b=p+(y<<10&4294967295|y>>>22),y=j+(p^(b|~w))+N[6]+2734768916&4294967295,j=b+(y<<15&4294967295|y>>>17),y=w+(b^(j|~p))+N[13]+1309151649&4294967295,w=j+(y<<21&4294967295|y>>>11),y=p+(j^(w|~b))+N[4]+4149444226&4294967295,p=w+(y<<6&4294967295|y>>>26),y=b+(w^(p|~j))+N[11]+3174756917&4294967295,b=p+(y<<10&4294967295|y>>>22),y=j+(p^(b|~w))+N[2]+718787259&4294967295,j=b+(y<<15&4294967295|y>>>17),y=w+(b^(j|~p))+N[9]+3951481745&4294967295,v.g[0]=v.g[0]+p&4294967295,v.g[1]=v.g[1]+(j+(y<<21&4294967295|y>>>11))&4294967295,v.g[2]=v.g[2]+j&4294967295,v.g[3]=v.g[3]+b&4294967295}n.prototype.u=function(v,p){p===void 0&&(p=v.length);for(var w=p-this.blockSize,N=this.B,j=this.h,b=0;b<p;){if(j==0)for(;b<=w;)a(this,v,b),b+=this.blockSize;if(typeof v=="string"){for(;b<p;)if(N[j++]=v.charCodeAt(b++),j==this.blockSize){a(this,N),j=0;break}}else for(;b<p;)if(N[j++]=v[b++],j==this.blockSize){a(this,N),j=0;break}}this.h=j,this.o+=p},n.prototype.v=function(){var v=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);v[0]=128;for(var p=1;p<v.length-8;++p)v[p]=0;var w=8*this.o;for(p=v.length-8;p<v.length;++p)v[p]=w&255,w/=256;for(this.u(v),v=Array(16),p=w=0;4>p;++p)for(var N=0;32>N;N+=8)v[w++]=this.g[p]>>>N&255;return v};function i(v,p){var w=c;return Object.prototype.hasOwnProperty.call(w,v)?w[v]:w[v]=p(v)}function o(v,p){this.h=p;for(var w=[],N=!0,j=v.length-1;0<=j;j--){var b=v[j]|0;N&&b==p||(w[j]=b,N=!1)}this.g=w}var c={};function d(v){return-128<=v&&128>v?i(v,function(p){return new o([p|0],0>p?-1:0)}):new o([v|0],0>v?-1:0)}function h(v){if(isNaN(v)||!isFinite(v))return x;if(0>v)return T(h(-v));for(var p=[],w=1,N=0;v>=w;N++)p[N]=v/w|0,w*=4294967296;return new o(p,0)}function m(v,p){if(v.length==0)throw Error("number format error: empty string");if(p=p||10,2>p||36<p)throw Error("radix out of range: "+p);if(v.charAt(0)=="-")return T(m(v.substring(1),p));if(0<=v.indexOf("-"))throw Error('number format error: interior "-" character');for(var w=h(Math.pow(p,8)),N=x,j=0;j<v.length;j+=8){var b=Math.min(8,v.length-j),y=parseInt(v.substring(j,j+b),p);8>b?(b=h(Math.pow(p,b)),N=N.j(b).add(h(y))):(N=N.j(w),N=N.add(h(y)))}return N}var x=d(0),f=d(1),k=d(16777216);s=o.prototype,s.m=function(){if(D(this))return-T(this).m();for(var v=0,p=1,w=0;w<this.g.length;w++){var N=this.i(w);v+=(0<=N?N:4294967296+N)*p,p*=4294967296}return v},s.toString=function(v){if(v=v||10,2>v||36<v)throw Error("radix out of range: "+v);if(A(this))return"0";if(D(this))return"-"+T(this).toString(v);for(var p=h(Math.pow(v,6)),w=this,N="";;){var j=M(w,p).g;w=H(w,j.j(p));var b=((0<w.g.length?w.g[0]:w.h)>>>0).toString(v);if(w=j,A(w))return b+N;for(;6>b.length;)b="0"+b;N=b+N}},s.i=function(v){return 0>v?0:v<this.g.length?this.g[v]:this.h};function A(v){if(v.h!=0)return!1;for(var p=0;p<v.g.length;p++)if(v.g[p]!=0)return!1;return!0}function D(v){return v.h==-1}s.l=function(v){return v=H(this,v),D(v)?-1:A(v)?0:1};function T(v){for(var p=v.g.length,w=[],N=0;N<p;N++)w[N]=~v.g[N];return new o(w,~v.h).add(f)}s.abs=function(){return D(this)?T(this):this},s.add=function(v){for(var p=Math.max(this.g.length,v.g.length),w=[],N=0,j=0;j<=p;j++){var b=N+(this.i(j)&65535)+(v.i(j)&65535),y=(b>>>16)+(this.i(j)>>>16)+(v.i(j)>>>16);N=y>>>16,b&=65535,y&=65535,w[j]=y<<16|b}return new o(w,w[w.length-1]&-2147483648?-1:0)};function H(v,p){return v.add(T(p))}s.j=function(v){if(A(this)||A(v))return x;if(D(this))return D(v)?T(this).j(T(v)):T(T(this).j(v));if(D(v))return T(this.j(T(v)));if(0>this.l(k)&&0>v.l(k))return h(this.m()*v.m());for(var p=this.g.length+v.g.length,w=[],N=0;N<2*p;N++)w[N]=0;for(N=0;N<this.g.length;N++)for(var j=0;j<v.g.length;j++){var b=this.i(N)>>>16,y=this.i(N)&65535,re=v.i(j)>>>16,ue=v.i(j)&65535;w[2*N+2*j]+=y*ue,L(w,2*N+2*j),w[2*N+2*j+1]+=b*ue,L(w,2*N+2*j+1),w[2*N+2*j+1]+=y*re,L(w,2*N+2*j+1),w[2*N+2*j+2]+=b*re,L(w,2*N+2*j+2)}for(N=0;N<p;N++)w[N]=w[2*N+1]<<16|w[2*N];for(N=p;N<2*p;N++)w[N]=0;return new o(w,0)};function L(v,p){for(;(v[p]&65535)!=v[p];)v[p+1]+=v[p]>>>16,v[p]&=65535,p++}function E(v,p){this.g=v,this.h=p}function M(v,p){if(A(p))throw Error("division by zero");if(A(v))return new E(x,x);if(D(v))return p=M(T(v),p),new E(T(p.g),T(p.h));if(D(p))return p=M(v,T(p)),new E(T(p.g),p.h);if(30<v.g.length){if(D(v)||D(p))throw Error("slowDivide_ only works with positive integers.");for(var w=f,N=p;0>=N.l(v);)w=ee(w),N=ee(N);var j=C(w,1),b=C(N,1);for(N=C(N,2),w=C(w,2);!A(N);){var y=b.add(N);0>=y.l(v)&&(j=j.add(w),b=y),N=C(N,1),w=C(w,1)}return p=H(v,j.j(p)),new E(j,p)}for(j=x;0<=v.l(p);){for(w=Math.max(1,Math.floor(v.m()/p.m())),N=Math.ceil(Math.log(w)/Math.LN2),N=48>=N?1:Math.pow(2,N-48),b=h(w),y=b.j(p);D(y)||0<y.l(v);)w-=N,b=h(w),y=b.j(p);A(b)&&(b=f),j=j.add(b),v=H(v,y)}return new E(j,v)}s.A=function(v){return M(this,v).h},s.and=function(v){for(var p=Math.max(this.g.length,v.g.length),w=[],N=0;N<p;N++)w[N]=this.i(N)&v.i(N);return new o(w,this.h&v.h)},s.or=function(v){for(var p=Math.max(this.g.length,v.g.length),w=[],N=0;N<p;N++)w[N]=this.i(N)|v.i(N);return new o(w,this.h|v.h)},s.xor=function(v){for(var p=Math.max(this.g.length,v.g.length),w=[],N=0;N<p;N++)w[N]=this.i(N)^v.i(N);return new o(w,this.h^v.h)};function ee(v){for(var p=v.g.length+1,w=[],N=0;N<p;N++)w[N]=v.i(N)<<1|v.i(N-1)>>>31;return new o(w,v.h)}function C(v,p){var w=p>>5;p%=32;for(var N=v.g.length-w,j=[],b=0;b<N;b++)j[b]=0<p?v.i(b+w)>>>p|v.i(b+w+1)<<32-p:v.i(b+w);return new o(j,v.h)}n.prototype.digest=n.prototype.v,n.prototype.reset=n.prototype.s,n.prototype.update=n.prototype.u,mm=n,o.prototype.add=o.prototype.add,o.prototype.multiply=o.prototype.j,o.prototype.modulo=o.prototype.A,o.prototype.compare=o.prototype.l,o.prototype.toNumber=o.prototype.m,o.prototype.toString=o.prototype.toString,o.prototype.getBits=o.prototype.i,o.fromNumber=h,o.fromString=m,Gs=o}).apply(typeof tu<"u"?tu:typeof self<"u"?self:typeof window<"u"?window:{});var ai=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var gm,sa,pm,xi,yl,xm,fm,ym;(function(){var s,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(l,u,g){return l==Array.prototype||l==Object.prototype||(l[u]=g.value),l};function t(l){l=[typeof globalThis=="object"&&globalThis,l,typeof window=="object"&&window,typeof self=="object"&&self,typeof ai=="object"&&ai];for(var u=0;u<l.length;++u){var g=l[u];if(g&&g.Math==Math)return g}throw Error("Cannot find global object")}var n=t(this);function a(l,u){if(u)e:{var g=n;l=l.split(".");for(var _=0;_<l.length-1;_++){var Y=l[_];if(!(Y in g))break e;g=g[Y]}l=l[l.length-1],_=g[l],u=u(_),u!=_&&u!=null&&e(g,l,{configurable:!0,writable:!0,value:u})}}function i(l,u){l instanceof String&&(l+="");var g=0,_=!1,Y={next:function(){if(!_&&g<l.length){var ie=g++;return{value:u(ie,l[ie]),done:!1}}return _=!0,{done:!0,value:void 0}}};return Y[Symbol.iterator]=function(){return Y},Y}a("Array.prototype.values",function(l){return l||function(){return i(this,function(u,g){return g})}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var o=o||{},c=this||self;function d(l){var u=typeof l;return u=u!="object"?u:l?Array.isArray(l)?"array":u:"null",u=="array"||u=="object"&&typeof l.length=="number"}function h(l){var u=typeof l;return u=="object"&&l!=null||u=="function"}function m(l,u,g){return l.call.apply(l.bind,arguments)}function x(l,u,g){if(!l)throw Error();if(2<arguments.length){var _=Array.prototype.slice.call(arguments,2);return function(){var Y=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(Y,_),l.apply(u,Y)}}return function(){return l.apply(u,arguments)}}function f(l,u,g){return f=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?m:x,f.apply(null,arguments)}function k(l,u){var g=Array.prototype.slice.call(arguments,1);return function(){var _=g.slice();return _.push.apply(_,arguments),l.apply(this,_)}}function A(l,u){function g(){}g.prototype=u.prototype,l.aa=u.prototype,l.prototype=new g,l.prototype.constructor=l,l.Qb=function(_,Y,ie){for(var ke=Array(arguments.length-2),mt=2;mt<arguments.length;mt++)ke[mt-2]=arguments[mt];return u.prototype[Y].apply(_,ke)}}function D(l){const u=l.length;if(0<u){const g=Array(u);for(let _=0;_<u;_++)g[_]=l[_];return g}return[]}function T(l,u){for(let g=1;g<arguments.length;g++){const _=arguments[g];if(d(_)){const Y=l.length||0,ie=_.length||0;l.length=Y+ie;for(let ke=0;ke<ie;ke++)l[Y+ke]=_[ke]}else l.push(_)}}class H{constructor(u,g){this.i=u,this.j=g,this.h=0,this.g=null}get(){let u;return 0<this.h?(this.h--,u=this.g,this.g=u.next,u.next=null):u=this.i(),u}}function L(l){return/^[\s\xa0]*$/.test(l)}function E(){var l=c.navigator;return l&&(l=l.userAgent)?l:""}function M(l){return M[" "](l),l}M[" "]=function(){};var ee=E().indexOf("Gecko")!=-1&&!(E().toLowerCase().indexOf("webkit")!=-1&&E().indexOf("Edge")==-1)&&!(E().indexOf("Trident")!=-1||E().indexOf("MSIE")!=-1)&&E().indexOf("Edge")==-1;function C(l,u,g){for(const _ in l)u.call(g,l[_],_,l)}function v(l,u){for(const g in l)u.call(void 0,l[g],g,l)}function p(l){const u={};for(const g in l)u[g]=l[g];return u}const w="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function N(l,u){let g,_;for(let Y=1;Y<arguments.length;Y++){_=arguments[Y];for(g in _)l[g]=_[g];for(let ie=0;ie<w.length;ie++)g=w[ie],Object.prototype.hasOwnProperty.call(_,g)&&(l[g]=_[g])}}function j(l){var u=1;l=l.split(":");const g=[];for(;0<u&&l.length;)g.push(l.shift()),u--;return l.length&&g.push(l.join(":")),g}function b(l){c.setTimeout(()=>{throw l},0)}function y(){var l=te;let u=null;return l.g&&(u=l.g,l.g=l.g.next,l.g||(l.h=null),u.next=null),u}class re{constructor(){this.h=this.g=null}add(u,g){const _=ue.get();_.set(u,g),this.h?this.h.next=_:this.g=_,this.h=_}}var ue=new H(()=>new W,l=>l.reset());class W{constructor(){this.next=this.g=this.h=null}set(u,g){this.h=u,this.g=g,this.next=null}reset(){this.next=this.g=this.h=null}}let O,P=!1,te=new re,J=()=>{const l=c.Promise.resolve(void 0);O=()=>{l.then(fe)}};var fe=()=>{for(var l;l=y();){try{l.h.call(l.g)}catch(g){b(g)}var u=ue;u.j(l),100>u.h&&(u.h++,l.next=u.g,u.g=l)}P=!1};function F(){this.s=this.s,this.C=this.C}F.prototype.s=!1,F.prototype.ma=function(){this.s||(this.s=!0,this.N())},F.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function ne(l,u){this.type=l,this.g=this.target=u,this.defaultPrevented=!1}ne.prototype.h=function(){this.defaultPrevented=!0};var V=function(){if(!c.addEventListener||!Object.defineProperty)return!1;var l=!1,u=Object.defineProperty({},"passive",{get:function(){l=!0}});try{const g=()=>{};c.addEventListener("test",g,u),c.removeEventListener("test",g,u)}catch{}return l}();function X(l,u){if(ne.call(this,l?l.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,l){var g=this.type=l.type,_=l.changedTouches&&l.changedTouches.length?l.changedTouches[0]:null;if(this.target=l.target||l.srcElement,this.g=u,u=l.relatedTarget){if(ee){e:{try{M(u.nodeName);var Y=!0;break e}catch{}Y=!1}Y||(u=null)}}else g=="mouseover"?u=l.fromElement:g=="mouseout"&&(u=l.toElement);this.relatedTarget=u,_?(this.clientX=_.clientX!==void 0?_.clientX:_.pageX,this.clientY=_.clientY!==void 0?_.clientY:_.pageY,this.screenX=_.screenX||0,this.screenY=_.screenY||0):(this.clientX=l.clientX!==void 0?l.clientX:l.pageX,this.clientY=l.clientY!==void 0?l.clientY:l.pageY,this.screenX=l.screenX||0,this.screenY=l.screenY||0),this.button=l.button,this.key=l.key||"",this.ctrlKey=l.ctrlKey,this.altKey=l.altKey,this.shiftKey=l.shiftKey,this.metaKey=l.metaKey,this.pointerId=l.pointerId||0,this.pointerType=typeof l.pointerType=="string"?l.pointerType:S[l.pointerType]||"",this.state=l.state,this.i=l,l.defaultPrevented&&X.aa.h.call(this)}}A(X,ne);var S={2:"touch",3:"pen",4:"mouse"};X.prototype.h=function(){X.aa.h.call(this);var l=this.i;l.preventDefault?l.preventDefault():l.returnValue=!1};var R="closure_listenable_"+(1e6*Math.random()|0),K=0;function U(l,u,g,_,Y){this.listener=l,this.proxy=null,this.src=u,this.type=g,this.capture=!!_,this.ha=Y,this.key=++K,this.da=this.fa=!1}function Q(l){l.da=!0,l.listener=null,l.proxy=null,l.src=null,l.ha=null}function $(l){this.src=l,this.g={},this.h=0}$.prototype.add=function(l,u,g,_,Y){var ie=l.toString();l=this.g[ie],l||(l=this.g[ie]=[],this.h++);var ke=we(l,u,_,Y);return-1<ke?(u=l[ke],g||(u.fa=!1)):(u=new U(u,this.src,ie,!!_,Y),u.fa=g,l.push(u)),u};function ce(l,u){var g=u.type;if(g in l.g){var _=l.g[g],Y=Array.prototype.indexOf.call(_,u,void 0),ie;(ie=0<=Y)&&Array.prototype.splice.call(_,Y,1),ie&&(Q(u),l.g[g].length==0&&(delete l.g[g],l.h--))}}function we(l,u,g,_){for(var Y=0;Y<l.length;++Y){var ie=l[Y];if(!ie.da&&ie.listener==u&&ie.capture==!!g&&ie.ha==_)return Y}return-1}var G="closure_lm_"+(1e6*Math.random()|0),oe={};function _e(l,u,g,_,Y){if(Array.isArray(u)){for(var ie=0;ie<u.length;ie++)_e(l,u[ie],g,_,Y);return null}return g=Ve(g),l&&l[R]?l.K(u,g,h(_)?!!_.capture:!1,Y):Te(l,u,g,!1,_,Y)}function Te(l,u,g,_,Y,ie){if(!u)throw Error("Invalid event type");var ke=h(Y)?!!Y.capture:!!Y,mt=de(l);if(mt||(l[G]=mt=new $(l)),g=mt.add(u,g,_,ke,ie),g.proxy)return g;if(_=Je(),g.proxy=_,_.src=l,_.listener=g,l.addEventListener)V||(Y=ke),Y===void 0&&(Y=!1),l.addEventListener(u.toString(),_,Y);else if(l.attachEvent)l.attachEvent(ge(u.toString()),_);else if(l.addListener&&l.removeListener)l.addListener(_);else throw Error("addEventListener and attachEvent are unavailable.");return g}function Je(){function l(g){return u.call(l.src,l.listener,g)}const u=ye;return l}function Qe(l,u,g,_,Y){if(Array.isArray(u))for(var ie=0;ie<u.length;ie++)Qe(l,u[ie],g,_,Y);else _=h(_)?!!_.capture:!!_,g=Ve(g),l&&l[R]?(l=l.i,u=String(u).toString(),u in l.g&&(ie=l.g[u],g=we(ie,g,_,Y),-1<g&&(Q(ie[g]),Array.prototype.splice.call(ie,g,1),ie.length==0&&(delete l.g[u],l.h--)))):l&&(l=de(l))&&(u=l.g[u.toString()],l=-1,u&&(l=we(u,g,_,Y)),(g=-1<l?u[l]:null)&&Z(g))}function Z(l){if(typeof l!="number"&&l&&!l.da){var u=l.src;if(u&&u[R])ce(u.i,l);else{var g=l.type,_=l.proxy;u.removeEventListener?u.removeEventListener(g,_,l.capture):u.detachEvent?u.detachEvent(ge(g),_):u.addListener&&u.removeListener&&u.removeListener(_),(g=de(u))?(ce(g,l),g.h==0&&(g.src=null,u[G]=null)):Q(l)}}}function ge(l){return l in oe?oe[l]:oe[l]="on"+l}function ye(l,u){if(l.da)l=!0;else{u=new X(u,this);var g=l.listener,_=l.ha||l.src;l.fa&&Z(l),l=g.call(_,u)}return l}function de(l){return l=l[G],l instanceof $?l:null}var Ce="__closure_events_fn_"+(1e9*Math.random()>>>0);function Ve(l){return typeof l=="function"?l:(l[Ce]||(l[Ce]=function(u){return l.handleEvent(u)}),l[Ce])}function q(){F.call(this),this.i=new $(this),this.M=this,this.F=null}A(q,F),q.prototype[R]=!0,q.prototype.removeEventListener=function(l,u,g,_){Qe(this,l,u,g,_)};function Ne(l,u){var g,_=l.F;if(_)for(g=[];_;_=_.F)g.push(_);if(l=l.M,_=u.type||u,typeof u=="string")u=new ne(u,l);else if(u instanceof ne)u.target=u.target||l;else{var Y=u;u=new ne(_,l),N(u,Y)}if(Y=!0,g)for(var ie=g.length-1;0<=ie;ie--){var ke=u.g=g[ie];Y=Me(ke,_,!0,u)&&Y}if(ke=u.g=l,Y=Me(ke,_,!0,u)&&Y,Y=Me(ke,_,!1,u)&&Y,g)for(ie=0;ie<g.length;ie++)ke=u.g=g[ie],Y=Me(ke,_,!1,u)&&Y}q.prototype.N=function(){if(q.aa.N.call(this),this.i){var l=this.i,u;for(u in l.g){for(var g=l.g[u],_=0;_<g.length;_++)Q(g[_]);delete l.g[u],l.h--}}this.F=null},q.prototype.K=function(l,u,g,_){return this.i.add(String(l),u,!1,g,_)},q.prototype.L=function(l,u,g,_){return this.i.add(String(l),u,!0,g,_)};function Me(l,u,g,_){if(u=l.i.g[String(u)],!u)return!0;u=u.concat();for(var Y=!0,ie=0;ie<u.length;++ie){var ke=u[ie];if(ke&&!ke.da&&ke.capture==g){var mt=ke.listener,Vt=ke.ha||ke.src;ke.fa&&ce(l.i,ke),Y=mt.call(Vt,_)!==!1&&Y}}return Y&&!_.defaultPrevented}function z(l,u,g){if(typeof l=="function")g&&(l=f(l,g));else if(l&&typeof l.handleEvent=="function")l=f(l.handleEvent,l);else throw Error("Invalid listener argument");return 2147483647<Number(u)?-1:c.setTimeout(l,u||0)}function B(l){l.g=z(()=>{l.g=null,l.i&&(l.i=!1,B(l))},l.l);const u=l.h;l.h=null,l.m.apply(null,u)}class je extends F{constructor(u,g){super(),this.m=u,this.l=g,this.h=null,this.i=!1,this.g=null}j(u){this.h=arguments,this.g?this.i=!0:B(this)}N(){super.N(),this.g&&(c.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Pe(l){F.call(this),this.h=l,this.g={}}A(Pe,F);var Fe=[];function pe(l){C(l.g,function(u,g){this.g.hasOwnProperty(g)&&Z(u)},l),l.g={}}Pe.prototype.N=function(){Pe.aa.N.call(this),pe(this)},Pe.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Ze=c.JSON.stringify,He=c.JSON.parse,et=class{stringify(l){return c.JSON.stringify(l,void 0)}parse(l){return c.JSON.parse(l,void 0)}};function Ee(){}Ee.prototype.h=null;function xt(l){return l.h||(l.h=l.i())}function jt(){}var _t={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function br(){ne.call(this,"d")}A(br,ne);function er(){ne.call(this,"c")}A(er,ne);var ae={},se=null;function me(){return se=se||new q}ae.La="serverreachability";function Ue(l){ne.call(this,ae.La,l)}A(Ue,ne);function Se(l){const u=me();Ne(u,new Ue(u))}ae.STAT_EVENT="statevent";function Ye(l,u){ne.call(this,ae.STAT_EVENT,l),this.stat=u}A(Ye,ne);function Oe(l){const u=me();Ne(u,new Ye(u,l))}ae.Ma="timingevent";function ze(l,u){ne.call(this,ae.Ma,l),this.size=u}A(ze,ne);function Be(l,u){if(typeof l!="function")throw Error("Fn must not be null and must be a function");return c.setTimeout(function(){l()},u)}function rt(){this.g=!0}rt.prototype.xa=function(){this.g=!1};function ft(l,u,g,_,Y,ie){l.info(function(){if(l.g)if(ie)for(var ke="",mt=ie.split("&"),Vt=0;Vt<mt.length;Vt++){var it=mt[Vt].split("=");if(1<it.length){var Ht=it[0];it=it[1];var Gt=Ht.split("_");ke=2<=Gt.length&&Gt[1]=="type"?ke+(Ht+"="+it+"&"):ke+(Ht+"=redacted&")}}else ke=null;else ke=ie;return"XMLHTTP REQ ("+_+") [attempt "+Y+"]: "+u+`
`+g+`
`+ke})}function Et(l,u,g,_,Y,ie,ke){l.info(function(){return"XMLHTTP RESP ("+_+") [ attempt "+Y+"]: "+u+`
`+g+`
`+ie+" "+ke})}function ve(l,u,g,_){l.info(function(){return"XMLHTTP TEXT ("+u+"): "+lt(l,g)+(_?" "+_:"")})}function Ie(l,u){l.info(function(){return"TIMEOUT: "+u})}rt.prototype.info=function(){};function lt(l,u){if(!l.g)return u;if(!u)return null;try{var g=JSON.parse(u);if(g){for(l=0;l<g.length;l++)if(Array.isArray(g[l])){var _=g[l];if(!(2>_.length)){var Y=_[1];if(Array.isArray(Y)&&!(1>Y.length)){var ie=Y[0];if(ie!="noop"&&ie!="stop"&&ie!="close")for(var ke=1;ke<Y.length;ke++)Y[ke]=""}}}}return Ze(g)}catch{return u}}var ir={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},Wr={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},Co;function Ha(){}A(Ha,Ee),Ha.prototype.g=function(){return new XMLHttpRequest},Ha.prototype.i=function(){return{}},Co=new Ha;function gs(l,u,g,_){this.j=l,this.i=u,this.l=g,this.R=_||1,this.U=new Pe(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new ed}function ed(){this.i=null,this.g="",this.h=!1}var td={},Do={};function $o(l,u,g){l.L=1,l.v=Qa(zr(u)),l.m=g,l.P=!0,rd(l,null)}function rd(l,u){l.F=Date.now(),Ga(l),l.A=zr(l.v);var g=l.A,_=l.R;Array.isArray(_)||(_=[String(_)]),xd(g.i,"t",_),l.C=0,g=l.j.J,l.h=new ed,l.g=Rd(l.j,g?u:null,!l.m),0<l.O&&(l.M=new je(f(l.Y,l,l.g),l.O)),u=l.U,g=l.g,_=l.ca;var Y="readystatechange";Array.isArray(Y)||(Y&&(Fe[0]=Y.toString()),Y=Fe);for(var ie=0;ie<Y.length;ie++){var ke=_e(g,Y[ie],_||u.handleEvent,!1,u.h||u);if(!ke)break;u.g[ke.key]=ke}u=l.H?p(l.H):{},l.m?(l.u||(l.u="POST"),u["Content-Type"]="application/x-www-form-urlencoded",l.g.ea(l.A,l.u,l.m,u)):(l.u="GET",l.g.ea(l.A,l.u,null,u)),Se(),ft(l.i,l.u,l.A,l.l,l.R,l.m)}gs.prototype.ca=function(l){l=l.target;const u=this.M;u&&Hr(l)==3?u.j():this.Y(l)},gs.prototype.Y=function(l){try{if(l==this.g)e:{const Gt=Hr(this.g);var u=this.g.Ba();const on=this.g.Z();if(!(3>Gt)&&(Gt!=3||this.g&&(this.h.h||this.g.oa()||Nd(this.g)))){this.J||Gt!=4||u==7||(u==8||0>=on?Se(3):Se(2)),Ro(this);var g=this.g.Z();this.X=g;t:if(sd(this)){var _=Nd(this.g);l="";var Y=_.length,ie=Hr(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){Vs(this),qn(this);var ke="";break t}this.h.i=new c.TextDecoder}for(u=0;u<Y;u++)this.h.h=!0,l+=this.h.i.decode(_[u],{stream:!(ie&&u==Y-1)});_.length=0,this.h.g+=l,this.C=0,ke=this.h.g}else ke=this.g.oa();if(this.o=g==200,Et(this.i,this.u,this.A,this.l,this.R,Gt,g),this.o){if(this.T&&!this.K){t:{if(this.g){var mt,Vt=this.g;if((mt=Vt.g?Vt.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!L(mt)){var it=mt;break t}}it=null}if(g=it)ve(this.i,this.l,g,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Po(this,g);else{this.o=!1,this.s=3,Oe(12),Vs(this),qn(this);break e}}if(this.P){g=!0;let Nr;for(;!this.J&&this.C<ke.length;)if(Nr=W0(this,ke),Nr==Do){Gt==4&&(this.s=4,Oe(14),g=!1),ve(this.i,this.l,null,"[Incomplete Response]");break}else if(Nr==td){this.s=4,Oe(15),ve(this.i,this.l,ke,"[Invalid Chunk]"),g=!1;break}else ve(this.i,this.l,Nr,null),Po(this,Nr);if(sd(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),Gt!=4||ke.length!=0||this.h.h||(this.s=1,Oe(16),g=!1),this.o=this.o&&g,!g)ve(this.i,this.l,ke,"[Invalid Chunked Response]"),Vs(this),qn(this);else if(0<ke.length&&!this.W){this.W=!0;var Ht=this.j;Ht.g==this&&Ht.ba&&!Ht.M&&(Ht.j.info("Great, no buffering proxy detected. Bytes received: "+ke.length),Uo(Ht),Ht.M=!0,Oe(11))}}else ve(this.i,this.l,ke,null),Po(this,ke);Gt==4&&Vs(this),this.o&&!this.J&&(Gt==4?Ad(this.j,this):(this.o=!1,Ga(this)))}else op(this.g),g==400&&0<ke.indexOf("Unknown SID")?(this.s=3,Oe(12)):(this.s=0,Oe(13)),Vs(this),qn(this)}}}catch{}finally{}};function sd(l){return l.g?l.u=="GET"&&l.L!=2&&l.j.Ca:!1}function W0(l,u){var g=l.C,_=u.indexOf(`
`,g);return _==-1?Do:(g=Number(u.substring(g,_)),isNaN(g)?td:(_+=1,_+g>u.length?Do:(u=u.slice(_,_+g),l.C=_+g,u)))}gs.prototype.cancel=function(){this.J=!0,Vs(this)};function Ga(l){l.S=Date.now()+l.I,nd(l,l.I)}function nd(l,u){if(l.B!=null)throw Error("WatchDog timer not null");l.B=Be(f(l.ba,l),u)}function Ro(l){l.B&&(c.clearTimeout(l.B),l.B=null)}gs.prototype.ba=function(){this.B=null;const l=Date.now();0<=l-this.S?(Ie(this.i,this.A),this.L!=2&&(Se(),Oe(17)),Vs(this),this.s=2,qn(this)):nd(this,this.S-l)};function qn(l){l.j.G==0||l.J||Ad(l.j,l)}function Vs(l){Ro(l);var u=l.M;u&&typeof u.ma=="function"&&u.ma(),l.M=null,pe(l.U),l.g&&(u=l.g,l.g=null,u.abort(),u.ma())}function Po(l,u){try{var g=l.j;if(g.G!=0&&(g.g==l||Mo(g.h,l))){if(!l.K&&Mo(g.h,l)&&g.G==3){try{var _=g.Da.g.parse(u)}catch{_=null}if(Array.isArray(_)&&_.length==3){var Y=_;if(Y[0]==0){e:if(!g.u){if(g.g)if(g.g.F+3e3<l.F)ri(g),ei(g);else break e;Fo(g),Oe(18)}}else g.za=Y[1],0<g.za-g.T&&37500>Y[2]&&g.F&&g.v==0&&!g.C&&(g.C=Be(f(g.Za,g),6e3));if(1>=od(g.h)&&g.ca){try{g.ca()}catch{}g.ca=void 0}}else Fs(g,11)}else if((l.K||g.g==l)&&ri(g),!L(u))for(Y=g.Da.g.parse(u),u=0;u<Y.length;u++){let it=Y[u];if(g.T=it[0],it=it[1],g.G==2)if(it[0]=="c"){g.K=it[1],g.ia=it[2];const Ht=it[3];Ht!=null&&(g.la=Ht,g.j.info("VER="+g.la));const Gt=it[4];Gt!=null&&(g.Aa=Gt,g.j.info("SVER="+g.Aa));const on=it[5];on!=null&&typeof on=="number"&&0<on&&(_=1.5*on,g.L=_,g.j.info("backChannelRequestTimeoutMs_="+_)),_=g;const Nr=l.g;if(Nr){const ni=Nr.g?Nr.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(ni){var ie=_.h;ie.g||ni.indexOf("spdy")==-1&&ni.indexOf("quic")==-1&&ni.indexOf("h2")==-1||(ie.j=ie.l,ie.g=new Set,ie.h&&(Oo(ie,ie.h),ie.h=null))}if(_.D){const Bo=Nr.g?Nr.g.getResponseHeader("X-HTTP-Session-Id"):null;Bo&&(_.ya=Bo,yt(_.I,_.D,Bo))}}g.G=3,g.l&&g.l.ua(),g.ba&&(g.R=Date.now()-l.F,g.j.info("Handshake RTT: "+g.R+"ms")),_=g;var ke=l;if(_.qa=$d(_,_.J?_.ia:null,_.W),ke.K){ld(_.h,ke);var mt=ke,Vt=_.L;Vt&&(mt.I=Vt),mt.B&&(Ro(mt),Ga(mt)),_.g=ke}else Td(_);0<g.i.length&&ti(g)}else it[0]!="stop"&&it[0]!="close"||Fs(g,7);else g.G==3&&(it[0]=="stop"||it[0]=="close"?it[0]=="stop"?Fs(g,7):Lo(g):it[0]!="noop"&&g.l&&g.l.ta(it),g.v=0)}}Se(4)}catch{}}var z0=class{constructor(l,u){this.g=l,this.map=u}};function ad(l){this.l=l||10,c.PerformanceNavigationTiming?(l=c.performance.getEntriesByType("navigation"),l=0<l.length&&(l[0].nextHopProtocol=="hq"||l[0].nextHopProtocol=="h2")):l=!!(c.chrome&&c.chrome.loadTimes&&c.chrome.loadTimes()&&c.chrome.loadTimes().wasFetchedViaSpdy),this.j=l?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function id(l){return l.h?!0:l.g?l.g.size>=l.j:!1}function od(l){return l.h?1:l.g?l.g.size:0}function Mo(l,u){return l.h?l.h==u:l.g?l.g.has(u):!1}function Oo(l,u){l.g?l.g.add(u):l.h=u}function ld(l,u){l.h&&l.h==u?l.h=null:l.g&&l.g.has(u)&&l.g.delete(u)}ad.prototype.cancel=function(){if(this.i=cd(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const l of this.g.values())l.cancel();this.g.clear()}};function cd(l){if(l.h!=null)return l.i.concat(l.h.D);if(l.g!=null&&l.g.size!==0){let u=l.i;for(const g of l.g.values())u=u.concat(g.D);return u}return D(l.i)}function H0(l){if(l.V&&typeof l.V=="function")return l.V();if(typeof Map<"u"&&l instanceof Map||typeof Set<"u"&&l instanceof Set)return Array.from(l.values());if(typeof l=="string")return l.split("");if(d(l)){for(var u=[],g=l.length,_=0;_<g;_++)u.push(l[_]);return u}u=[],g=0;for(_ in l)u[g++]=l[_];return u}function G0(l){if(l.na&&typeof l.na=="function")return l.na();if(!l.V||typeof l.V!="function"){if(typeof Map<"u"&&l instanceof Map)return Array.from(l.keys());if(!(typeof Set<"u"&&l instanceof Set)){if(d(l)||typeof l=="string"){var u=[];l=l.length;for(var g=0;g<l;g++)u.push(g);return u}u=[],g=0;for(const _ in l)u[g++]=_;return u}}}function dd(l,u){if(l.forEach&&typeof l.forEach=="function")l.forEach(u,void 0);else if(d(l)||typeof l=="string")Array.prototype.forEach.call(l,u,void 0);else for(var g=G0(l),_=H0(l),Y=_.length,ie=0;ie<Y;ie++)u.call(void 0,_[ie],g&&g[ie],l)}var ud=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function K0(l,u){if(l){l=l.split("&");for(var g=0;g<l.length;g++){var _=l[g].indexOf("="),Y=null;if(0<=_){var ie=l[g].substring(0,_);Y=l[g].substring(_+1)}else ie=l[g];u(ie,Y?decodeURIComponent(Y.replace(/\+/g," ")):"")}}}function Ls(l){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,l instanceof Ls){this.h=l.h,Ka(this,l.j),this.o=l.o,this.g=l.g,Ya(this,l.s),this.l=l.l;var u=l.i,g=new Hn;g.i=u.i,u.g&&(g.g=new Map(u.g),g.h=u.h),hd(this,g),this.m=l.m}else l&&(u=String(l).match(ud))?(this.h=!1,Ka(this,u[1]||"",!0),this.o=Wn(u[2]||""),this.g=Wn(u[3]||"",!0),Ya(this,u[4]),this.l=Wn(u[5]||"",!0),hd(this,u[6]||"",!0),this.m=Wn(u[7]||"")):(this.h=!1,this.i=new Hn(null,this.h))}Ls.prototype.toString=function(){var l=[],u=this.j;u&&l.push(zn(u,md,!0),":");var g=this.g;return(g||u=="file")&&(l.push("//"),(u=this.o)&&l.push(zn(u,md,!0),"@"),l.push(encodeURIComponent(String(g)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),g=this.s,g!=null&&l.push(":",String(g))),(g=this.l)&&(this.g&&g.charAt(0)!="/"&&l.push("/"),l.push(zn(g,g.charAt(0)=="/"?X0:Q0,!0))),(g=this.i.toString())&&l.push("?",g),(g=this.m)&&l.push("#",zn(g,Z0)),l.join("")};function zr(l){return new Ls(l)}function Ka(l,u,g){l.j=g?Wn(u,!0):u,l.j&&(l.j=l.j.replace(/:$/,""))}function Ya(l,u){if(u){if(u=Number(u),isNaN(u)||0>u)throw Error("Bad port number "+u);l.s=u}else l.s=null}function hd(l,u,g){u instanceof Hn?(l.i=u,ep(l.i,l.h)):(g||(u=zn(u,J0)),l.i=new Hn(u,l.h))}function yt(l,u,g){l.i.set(u,g)}function Qa(l){return yt(l,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),l}function Wn(l,u){return l?u?decodeURI(l.replace(/%25/g,"%2525")):decodeURIComponent(l):""}function zn(l,u,g){return typeof l=="string"?(l=encodeURI(l).replace(u,Y0),g&&(l=l.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),l):null}function Y0(l){return l=l.charCodeAt(0),"%"+(l>>4&15).toString(16)+(l&15).toString(16)}var md=/[#\/\?@]/g,Q0=/[#\?:]/g,X0=/[#\?]/g,J0=/[#\?@]/g,Z0=/#/g;function Hn(l,u){this.h=this.g=null,this.i=l||null,this.j=!!u}function ps(l){l.g||(l.g=new Map,l.h=0,l.i&&K0(l.i,function(u,g){l.add(decodeURIComponent(u.replace(/\+/g," ")),g)}))}s=Hn.prototype,s.add=function(l,u){ps(this),this.i=null,l=nn(this,l);var g=this.g.get(l);return g||this.g.set(l,g=[]),g.push(u),this.h+=1,this};function gd(l,u){ps(l),u=nn(l,u),l.g.has(u)&&(l.i=null,l.h-=l.g.get(u).length,l.g.delete(u))}function pd(l,u){return ps(l),u=nn(l,u),l.g.has(u)}s.forEach=function(l,u){ps(this),this.g.forEach(function(g,_){g.forEach(function(Y){l.call(u,Y,_,this)},this)},this)},s.na=function(){ps(this);const l=Array.from(this.g.values()),u=Array.from(this.g.keys()),g=[];for(let _=0;_<u.length;_++){const Y=l[_];for(let ie=0;ie<Y.length;ie++)g.push(u[_])}return g},s.V=function(l){ps(this);let u=[];if(typeof l=="string")pd(this,l)&&(u=u.concat(this.g.get(nn(this,l))));else{l=Array.from(this.g.values());for(let g=0;g<l.length;g++)u=u.concat(l[g])}return u},s.set=function(l,u){return ps(this),this.i=null,l=nn(this,l),pd(this,l)&&(this.h-=this.g.get(l).length),this.g.set(l,[u]),this.h+=1,this},s.get=function(l,u){return l?(l=this.V(l),0<l.length?String(l[0]):u):u};function xd(l,u,g){gd(l,u),0<g.length&&(l.i=null,l.g.set(nn(l,u),D(g)),l.h+=g.length)}s.toString=function(){if(this.i)return this.i;if(!this.g)return"";const l=[],u=Array.from(this.g.keys());for(var g=0;g<u.length;g++){var _=u[g];const ie=encodeURIComponent(String(_)),ke=this.V(_);for(_=0;_<ke.length;_++){var Y=ie;ke[_]!==""&&(Y+="="+encodeURIComponent(String(ke[_]))),l.push(Y)}}return this.i=l.join("&")};function nn(l,u){return u=String(u),l.j&&(u=u.toLowerCase()),u}function ep(l,u){u&&!l.j&&(ps(l),l.i=null,l.g.forEach(function(g,_){var Y=_.toLowerCase();_!=Y&&(gd(this,_),xd(this,Y,g))},l)),l.j=u}function tp(l,u){const g=new rt;if(c.Image){const _=new Image;_.onload=k(xs,g,"TestLoadImage: loaded",!0,u,_),_.onerror=k(xs,g,"TestLoadImage: error",!1,u,_),_.onabort=k(xs,g,"TestLoadImage: abort",!1,u,_),_.ontimeout=k(xs,g,"TestLoadImage: timeout",!1,u,_),c.setTimeout(function(){_.ontimeout&&_.ontimeout()},1e4),_.src=l}else u(!1)}function rp(l,u){const g=new rt,_=new AbortController,Y=setTimeout(()=>{_.abort(),xs(g,"TestPingServer: timeout",!1,u)},1e4);fetch(l,{signal:_.signal}).then(ie=>{clearTimeout(Y),ie.ok?xs(g,"TestPingServer: ok",!0,u):xs(g,"TestPingServer: server error",!1,u)}).catch(()=>{clearTimeout(Y),xs(g,"TestPingServer: error",!1,u)})}function xs(l,u,g,_,Y){try{Y&&(Y.onload=null,Y.onerror=null,Y.onabort=null,Y.ontimeout=null),_(g)}catch{}}function sp(){this.g=new et}function np(l,u,g){const _=g||"";try{dd(l,function(Y,ie){let ke=Y;h(Y)&&(ke=Ze(Y)),u.push(_+ie+"="+encodeURIComponent(ke))})}catch(Y){throw u.push(_+"type="+encodeURIComponent("_badmap")),Y}}function Xa(l){this.l=l.Ub||null,this.j=l.eb||!1}A(Xa,Ee),Xa.prototype.g=function(){return new Ja(this.l,this.j)},Xa.prototype.i=function(l){return function(){return l}}({});function Ja(l,u){q.call(this),this.D=l,this.o=u,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}A(Ja,q),s=Ja.prototype,s.open=function(l,u){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=l,this.A=u,this.readyState=1,Kn(this)},s.send=function(l){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const u={headers:this.u,method:this.B,credentials:this.m,cache:void 0};l&&(u.body=l),(this.D||c).fetch(new Request(this.A,u)).then(this.Sa.bind(this),this.ga.bind(this))},s.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,Gn(this)),this.readyState=0},s.Sa=function(l){if(this.g&&(this.l=l,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=l.headers,this.readyState=2,Kn(this)),this.g&&(this.readyState=3,Kn(this),this.g)))if(this.responseType==="arraybuffer")l.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof c.ReadableStream<"u"&&"body"in l){if(this.j=l.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;fd(this)}else l.text().then(this.Ra.bind(this),this.ga.bind(this))};function fd(l){l.j.read().then(l.Pa.bind(l)).catch(l.ga.bind(l))}s.Pa=function(l){if(this.g){if(this.o&&l.value)this.response.push(l.value);else if(!this.o){var u=l.value?l.value:new Uint8Array(0);(u=this.v.decode(u,{stream:!l.done}))&&(this.response=this.responseText+=u)}l.done?Gn(this):Kn(this),this.readyState==3&&fd(this)}},s.Ra=function(l){this.g&&(this.response=this.responseText=l,Gn(this))},s.Qa=function(l){this.g&&(this.response=l,Gn(this))},s.ga=function(){this.g&&Gn(this)};function Gn(l){l.readyState=4,l.l=null,l.j=null,l.v=null,Kn(l)}s.setRequestHeader=function(l,u){this.u.append(l,u)},s.getResponseHeader=function(l){return this.h&&this.h.get(l.toLowerCase())||""},s.getAllResponseHeaders=function(){if(!this.h)return"";const l=[],u=this.h.entries();for(var g=u.next();!g.done;)g=g.value,l.push(g[0]+": "+g[1]),g=u.next();return l.join(`\r
`)};function Kn(l){l.onreadystatechange&&l.onreadystatechange.call(l)}Object.defineProperty(Ja.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(l){this.m=l?"include":"same-origin"}});function yd(l){let u="";return C(l,function(g,_){u+=_,u+=":",u+=g,u+=`\r
`}),u}function Vo(l,u,g){e:{for(_ in g){var _=!1;break e}_=!0}_||(g=yd(g),typeof l=="string"?g!=null&&encodeURIComponent(String(g)):yt(l,u,g))}function It(l){q.call(this),this.headers=new Map,this.o=l||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}A(It,q);var ap=/^https?$/i,ip=["POST","PUT"];s=It.prototype,s.Ha=function(l){this.J=l},s.ea=function(l,u,g,_){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+l);u=u?u.toUpperCase():"GET",this.D=l,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():Co.g(),this.v=this.o?xt(this.o):xt(Co),this.g.onreadystatechange=f(this.Ea,this);try{this.B=!0,this.g.open(u,String(l),!0),this.B=!1}catch(ie){bd(this,ie);return}if(l=g||"",g=new Map(this.headers),_)if(Object.getPrototypeOf(_)===Object.prototype)for(var Y in _)g.set(Y,_[Y]);else if(typeof _.keys=="function"&&typeof _.get=="function")for(const ie of _.keys())g.set(ie,_.get(ie));else throw Error("Unknown input type for opt_headers: "+String(_));_=Array.from(g.keys()).find(ie=>ie.toLowerCase()=="content-type"),Y=c.FormData&&l instanceof c.FormData,!(0<=Array.prototype.indexOf.call(ip,u,void 0))||_||Y||g.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[ie,ke]of g)this.g.setRequestHeader(ie,ke);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{kd(this),this.u=!0,this.g.send(l),this.u=!1}catch(ie){bd(this,ie)}};function bd(l,u){l.h=!1,l.g&&(l.j=!0,l.g.abort(),l.j=!1),l.l=u,l.m=5,vd(l),Za(l)}function vd(l){l.A||(l.A=!0,Ne(l,"complete"),Ne(l,"error"))}s.abort=function(l){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=l||7,Ne(this,"complete"),Ne(this,"abort"),Za(this))},s.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Za(this,!0)),It.aa.N.call(this)},s.Ea=function(){this.s||(this.B||this.u||this.j?wd(this):this.bb())},s.bb=function(){wd(this)};function wd(l){if(l.h&&typeof o<"u"&&(!l.v[1]||Hr(l)!=4||l.Z()!=2)){if(l.u&&Hr(l)==4)z(l.Ea,0,l);else if(Ne(l,"readystatechange"),Hr(l)==4){l.h=!1;try{const ke=l.Z();e:switch(ke){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var u=!0;break e;default:u=!1}var g;if(!(g=u)){var _;if(_=ke===0){var Y=String(l.D).match(ud)[1]||null;!Y&&c.self&&c.self.location&&(Y=c.self.location.protocol.slice(0,-1)),_=!ap.test(Y?Y.toLowerCase():"")}g=_}if(g)Ne(l,"complete"),Ne(l,"success");else{l.m=6;try{var ie=2<Hr(l)?l.g.statusText:""}catch{ie=""}l.l=ie+" ["+l.Z()+"]",vd(l)}}finally{Za(l)}}}}function Za(l,u){if(l.g){kd(l);const g=l.g,_=l.v[0]?()=>{}:null;l.g=null,l.v=null,u||Ne(l,"ready");try{g.onreadystatechange=_}catch{}}}function kd(l){l.I&&(c.clearTimeout(l.I),l.I=null)}s.isActive=function(){return!!this.g};function Hr(l){return l.g?l.g.readyState:0}s.Z=function(){try{return 2<Hr(this)?this.g.status:-1}catch{return-1}},s.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},s.Oa=function(l){if(this.g){var u=this.g.responseText;return l&&u.indexOf(l)==0&&(u=u.substring(l.length)),He(u)}};function Nd(l){try{if(!l.g)return null;if("response"in l.g)return l.g.response;switch(l.H){case"":case"text":return l.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in l.g)return l.g.mozResponseArrayBuffer}return null}catch{return null}}function op(l){const u={};l=(l.g&&2<=Hr(l)&&l.g.getAllResponseHeaders()||"").split(`\r
`);for(let _=0;_<l.length;_++){if(L(l[_]))continue;var g=j(l[_]);const Y=g[0];if(g=g[1],typeof g!="string")continue;g=g.trim();const ie=u[Y]||[];u[Y]=ie,ie.push(g)}v(u,function(_){return _.join(", ")})}s.Ba=function(){return this.m},s.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function Yn(l,u,g){return g&&g.internalChannelParams&&g.internalChannelParams[l]||u}function jd(l){this.Aa=0,this.i=[],this.j=new rt,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=Yn("failFast",!1,l),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=Yn("baseRetryDelayMs",5e3,l),this.cb=Yn("retryDelaySeedMs",1e4,l),this.Wa=Yn("forwardChannelMaxRetries",2,l),this.wa=Yn("forwardChannelRequestTimeoutMs",2e4,l),this.pa=l&&l.xmlHttpFactory||void 0,this.Xa=l&&l.Tb||void 0,this.Ca=l&&l.useFetchStreams||!1,this.L=void 0,this.J=l&&l.supportsCrossDomainXhr||!1,this.K="",this.h=new ad(l&&l.concurrentRequestLimit),this.Da=new sp,this.P=l&&l.fastHandshake||!1,this.O=l&&l.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=l&&l.Rb||!1,l&&l.xa&&this.j.xa(),l&&l.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&l&&l.detectBufferingProxy||!1,this.ja=void 0,l&&l.longPollingTimeout&&0<l.longPollingTimeout&&(this.ja=l.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}s=jd.prototype,s.la=8,s.G=1,s.connect=function(l,u,g,_){Oe(0),this.W=l,this.H=u||{},g&&_!==void 0&&(this.H.OSID=g,this.H.OAID=_),this.F=this.X,this.I=$d(this,null,this.W),ti(this)};function Lo(l){if(_d(l),l.G==3){var u=l.U++,g=zr(l.I);if(yt(g,"SID",l.K),yt(g,"RID",u),yt(g,"TYPE","terminate"),Qn(l,g),u=new gs(l,l.j,u),u.L=2,u.v=Qa(zr(g)),g=!1,c.navigator&&c.navigator.sendBeacon)try{g=c.navigator.sendBeacon(u.v.toString(),"")}catch{}!g&&c.Image&&(new Image().src=u.v,g=!0),g||(u.g=Rd(u.j,null),u.g.ea(u.v)),u.F=Date.now(),Ga(u)}Dd(l)}function ei(l){l.g&&(Uo(l),l.g.cancel(),l.g=null)}function _d(l){ei(l),l.u&&(c.clearTimeout(l.u),l.u=null),ri(l),l.h.cancel(),l.s&&(typeof l.s=="number"&&c.clearTimeout(l.s),l.s=null)}function ti(l){if(!id(l.h)&&!l.s){l.s=!0;var u=l.Ga;O||J(),P||(O(),P=!0),te.add(u,l),l.B=0}}function lp(l,u){return od(l.h)>=l.h.j-(l.s?1:0)?!1:l.s?(l.i=u.D.concat(l.i),!0):l.G==1||l.G==2||l.B>=(l.Va?0:l.Wa)?!1:(l.s=Be(f(l.Ga,l,u),Cd(l,l.B)),l.B++,!0)}s.Ga=function(l){if(this.s)if(this.s=null,this.G==1){if(!l){this.U=Math.floor(1e5*Math.random()),l=this.U++;const Y=new gs(this,this.j,l);let ie=this.o;if(this.S&&(ie?(ie=p(ie),N(ie,this.S)):ie=this.S),this.m!==null||this.O||(Y.H=ie,ie=null),this.P)e:{for(var u=0,g=0;g<this.i.length;g++){t:{var _=this.i[g];if("__data__"in _.map&&(_=_.map.__data__,typeof _=="string")){_=_.length;break t}_=void 0}if(_===void 0)break;if(u+=_,4096<u){u=g;break e}if(u===4096||g===this.i.length-1){u=g+1;break e}}u=1e3}else u=1e3;u=Id(this,Y,u),g=zr(this.I),yt(g,"RID",l),yt(g,"CVER",22),this.D&&yt(g,"X-HTTP-Session-Id",this.D),Qn(this,g),ie&&(this.O?u="headers="+encodeURIComponent(String(yd(ie)))+"&"+u:this.m&&Vo(g,this.m,ie)),Oo(this.h,Y),this.Ua&&yt(g,"TYPE","init"),this.P?(yt(g,"$req",u),yt(g,"SID","null"),Y.T=!0,$o(Y,g,null)):$o(Y,g,u),this.G=2}}else this.G==3&&(l?Ed(this,l):this.i.length==0||id(this.h)||Ed(this))};function Ed(l,u){var g;u?g=u.l:g=l.U++;const _=zr(l.I);yt(_,"SID",l.K),yt(_,"RID",g),yt(_,"AID",l.T),Qn(l,_),l.m&&l.o&&Vo(_,l.m,l.o),g=new gs(l,l.j,g,l.B+1),l.m===null&&(g.H=l.o),u&&(l.i=u.D.concat(l.i)),u=Id(l,g,1e3),g.I=Math.round(.5*l.wa)+Math.round(.5*l.wa*Math.random()),Oo(l.h,g),$o(g,_,u)}function Qn(l,u){l.H&&C(l.H,function(g,_){yt(u,_,g)}),l.l&&dd({},function(g,_){yt(u,_,g)})}function Id(l,u,g){g=Math.min(l.i.length,g);var _=l.l?f(l.l.Na,l.l,l):null;e:{var Y=l.i;let ie=-1;for(;;){const ke=["count="+g];ie==-1?0<g?(ie=Y[0].g,ke.push("ofs="+ie)):ie=0:ke.push("ofs="+ie);let mt=!0;for(let Vt=0;Vt<g;Vt++){let it=Y[Vt].g;const Ht=Y[Vt].map;if(it-=ie,0>it)ie=Math.max(0,Y[Vt].g-100),mt=!1;else try{np(Ht,ke,"req"+it+"_")}catch{_&&_(Ht)}}if(mt){_=ke.join("&");break e}}}return l=l.i.splice(0,g),u.D=l,_}function Td(l){if(!l.g&&!l.u){l.Y=1;var u=l.Fa;O||J(),P||(O(),P=!0),te.add(u,l),l.v=0}}function Fo(l){return l.g||l.u||3<=l.v?!1:(l.Y++,l.u=Be(f(l.Fa,l),Cd(l,l.v)),l.v++,!0)}s.Fa=function(){if(this.u=null,Sd(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var l=2*this.R;this.j.info("BP detection timer enabled: "+l),this.A=Be(f(this.ab,this),l)}},s.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,Oe(10),ei(this),Sd(this))};function Uo(l){l.A!=null&&(c.clearTimeout(l.A),l.A=null)}function Sd(l){l.g=new gs(l,l.j,"rpc",l.Y),l.m===null&&(l.g.H=l.o),l.g.O=0;var u=zr(l.qa);yt(u,"RID","rpc"),yt(u,"SID",l.K),yt(u,"AID",l.T),yt(u,"CI",l.F?"0":"1"),!l.F&&l.ja&&yt(u,"TO",l.ja),yt(u,"TYPE","xmlhttp"),Qn(l,u),l.m&&l.o&&Vo(u,l.m,l.o),l.L&&(l.g.I=l.L);var g=l.g;l=l.ia,g.L=1,g.v=Qa(zr(u)),g.m=null,g.P=!0,rd(g,l)}s.Za=function(){this.C!=null&&(this.C=null,ei(this),Fo(this),Oe(19))};function ri(l){l.C!=null&&(c.clearTimeout(l.C),l.C=null)}function Ad(l,u){var g=null;if(l.g==u){ri(l),Uo(l),l.g=null;var _=2}else if(Mo(l.h,u))g=u.D,ld(l.h,u),_=1;else return;if(l.G!=0){if(u.o)if(_==1){g=u.m?u.m.length:0,u=Date.now()-u.F;var Y=l.B;_=me(),Ne(_,new ze(_,g)),ti(l)}else Td(l);else if(Y=u.s,Y==3||Y==0&&0<u.X||!(_==1&&lp(l,u)||_==2&&Fo(l)))switch(g&&0<g.length&&(u=l.h,u.i=u.i.concat(g)),Y){case 1:Fs(l,5);break;case 4:Fs(l,10);break;case 3:Fs(l,6);break;default:Fs(l,2)}}}function Cd(l,u){let g=l.Ta+Math.floor(Math.random()*l.cb);return l.isActive()||(g*=2),g*u}function Fs(l,u){if(l.j.info("Error code "+u),u==2){var g=f(l.fb,l),_=l.Xa;const Y=!_;_=new Ls(_||"//www.google.com/images/cleardot.gif"),c.location&&c.location.protocol=="http"||Ka(_,"https"),Qa(_),Y?tp(_.toString(),g):rp(_.toString(),g)}else Oe(2);l.G=0,l.l&&l.l.sa(u),Dd(l),_d(l)}s.fb=function(l){l?(this.j.info("Successfully pinged google.com"),Oe(2)):(this.j.info("Failed to ping google.com"),Oe(1))};function Dd(l){if(l.G=0,l.ka=[],l.l){const u=cd(l.h);(u.length!=0||l.i.length!=0)&&(T(l.ka,u),T(l.ka,l.i),l.h.i.length=0,D(l.i),l.i.length=0),l.l.ra()}}function $d(l,u,g){var _=g instanceof Ls?zr(g):new Ls(g);if(_.g!="")u&&(_.g=u+"."+_.g),Ya(_,_.s);else{var Y=c.location;_=Y.protocol,u=u?u+"."+Y.hostname:Y.hostname,Y=+Y.port;var ie=new Ls(null);_&&Ka(ie,_),u&&(ie.g=u),Y&&Ya(ie,Y),g&&(ie.l=g),_=ie}return g=l.D,u=l.ya,g&&u&&yt(_,g,u),yt(_,"VER",l.la),Qn(l,_),_}function Rd(l,u,g){if(u&&!l.J)throw Error("Can't create secondary domain capable XhrIo object.");return u=l.Ca&&!l.pa?new It(new Xa({eb:g})):new It(l.pa),u.Ha(l.J),u}s.isActive=function(){return!!this.l&&this.l.isActive(this)};function Pd(){}s=Pd.prototype,s.ua=function(){},s.ta=function(){},s.sa=function(){},s.ra=function(){},s.isActive=function(){return!0},s.Na=function(){};function si(){}si.prototype.g=function(l,u){return new pr(l,u)};function pr(l,u){q.call(this),this.g=new jd(u),this.l=l,this.h=u&&u.messageUrlParams||null,l=u&&u.messageHeaders||null,u&&u.clientProtocolHeaderRequired&&(l?l["X-Client-Protocol"]="webchannel":l={"X-Client-Protocol":"webchannel"}),this.g.o=l,l=u&&u.initMessageHeaders||null,u&&u.messageContentType&&(l?l["X-WebChannel-Content-Type"]=u.messageContentType:l={"X-WebChannel-Content-Type":u.messageContentType}),u&&u.va&&(l?l["X-WebChannel-Client-Profile"]=u.va:l={"X-WebChannel-Client-Profile":u.va}),this.g.S=l,(l=u&&u.Sb)&&!L(l)&&(this.g.m=l),this.v=u&&u.supportsCrossDomainXhr||!1,this.u=u&&u.sendRawJson||!1,(u=u&&u.httpSessionIdParam)&&!L(u)&&(this.g.D=u,l=this.h,l!==null&&u in l&&(l=this.h,u in l&&delete l[u])),this.j=new an(this)}A(pr,q),pr.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},pr.prototype.close=function(){Lo(this.g)},pr.prototype.o=function(l){var u=this.g;if(typeof l=="string"){var g={};g.__data__=l,l=g}else this.u&&(g={},g.__data__=Ze(l),l=g);u.i.push(new z0(u.Ya++,l)),u.G==3&&ti(u)},pr.prototype.N=function(){this.g.l=null,delete this.j,Lo(this.g),delete this.g,pr.aa.N.call(this)};function Md(l){br.call(this),l.__headers__&&(this.headers=l.__headers__,this.statusCode=l.__status__,delete l.__headers__,delete l.__status__);var u=l.__sm__;if(u){e:{for(const g in u){l=g;break e}l=void 0}(this.i=l)&&(l=this.i,u=u!==null&&l in u?u[l]:void 0),this.data=u}else this.data=l}A(Md,br);function Od(){er.call(this),this.status=1}A(Od,er);function an(l){this.g=l}A(an,Pd),an.prototype.ua=function(){Ne(this.g,"a")},an.prototype.ta=function(l){Ne(this.g,new Md(l))},an.prototype.sa=function(l){Ne(this.g,new Od)},an.prototype.ra=function(){Ne(this.g,"b")},si.prototype.createWebChannel=si.prototype.g,pr.prototype.send=pr.prototype.o,pr.prototype.open=pr.prototype.m,pr.prototype.close=pr.prototype.close,ym=function(){return new si},fm=function(){return me()},xm=ae,yl={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},ir.NO_ERROR=0,ir.TIMEOUT=8,ir.HTTP_ERROR=6,xi=ir,Wr.COMPLETE="complete",pm=Wr,jt.EventType=_t,_t.OPEN="a",_t.CLOSE="b",_t.ERROR="c",_t.MESSAGE="d",q.prototype.listen=q.prototype.K,sa=jt,It.prototype.listenOnce=It.prototype.L,It.prototype.getLastError=It.prototype.Ka,It.prototype.getLastErrorCode=It.prototype.Ba,It.prototype.getStatus=It.prototype.Z,It.prototype.getResponseJson=It.prototype.Oa,It.prototype.getResponseText=It.prototype.oa,It.prototype.send=It.prototype.ea,It.prototype.setWithCredentials=It.prototype.Ha,gm=It}).apply(typeof ai<"u"?ai:typeof self<"u"?self:typeof window<"u"?window:{});const ru="@firebase/firestore";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yt{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}Yt.UNAUTHENTICATED=new Yt(null),Yt.GOOGLE_CREDENTIALS=new Yt("google-credentials-uid"),Yt.FIRST_PARTY=new Yt("first-party-uid"),Yt.MOCK_USER=new Yt("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Mn="10.14.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Qs=new Xl("@firebase/firestore");function Jn(){return Qs.logLevel}function $e(s,...e){if(Qs.logLevel<=tt.DEBUG){const t=e.map(ec);Qs.debug(`Firestore (${Mn}): ${s}`,...t)}}function ls(s,...e){if(Qs.logLevel<=tt.ERROR){const t=e.map(ec);Qs.error(`Firestore (${Mn}): ${s}`,...t)}}function Nn(s,...e){if(Qs.logLevel<=tt.WARN){const t=e.map(ec);Qs.warn(`Firestore (${Mn}): ${s}`,...t)}}function ec(s){if(typeof s=="string")return s;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return function(t){return JSON.stringify(t)}(s)}catch{return s}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function We(s="Unexpected state"){const e=`FIRESTORE (${Mn}) INTERNAL ASSERTION FAILED: `+s;throw ls(e),new Error(e)}function ut(s,e){s||We()}function Ke(s,e){return s}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const he={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Ae extends Br{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rs{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bm{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class yy{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(Yt.UNAUTHENTICATED))}shutdown(){}}class by{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class vy{constructor(e){this.t=e,this.currentUser=Yt.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){ut(this.o===void 0);let n=this.i;const a=d=>this.i!==n?(n=this.i,t(d)):Promise.resolve();let i=new rs;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new rs,e.enqueueRetryable(()=>a(this.currentUser))};const o=()=>{const d=i;e.enqueueRetryable(async()=>{await d.promise,await a(this.currentUser)})},c=d=>{$e("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=d,this.o&&(this.auth.addAuthTokenListener(this.o),o())};this.t.onInit(d=>c(d)),setTimeout(()=>{if(!this.auth){const d=this.t.getImmediate({optional:!0});d?c(d):($e("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new rs)}},0),o()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(n=>this.i!==e?($e("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):n?(ut(typeof n.accessToken=="string"),new bm(n.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return ut(e===null||typeof e=="string"),new Yt(e)}}class wy{constructor(e,t,n){this.l=e,this.h=t,this.P=n,this.type="FirstParty",this.user=Yt.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);const e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class ky{constructor(e,t,n){this.l=e,this.h=t,this.P=n}getToken(){return Promise.resolve(new wy(this.l,this.h,this.P))}start(e,t){e.enqueueRetryable(()=>t(Yt.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class Ny{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class jy{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,t){ut(this.o===void 0);const n=i=>{i.error!=null&&$e("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${i.error.message}`);const o=i.token!==this.R;return this.R=i.token,$e("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?t(i.token):Promise.resolve()};this.o=i=>{e.enqueueRetryable(()=>n(i))};const a=i=>{$e("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=i,this.o&&this.appCheck.addTokenListener(this.o)};this.A.onInit(i=>a(i)),setTimeout(()=>{if(!this.appCheck){const i=this.A.getImmediate({optional:!0});i?a(i):$e("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(ut(typeof t.token=="string"),this.R=t.token,new Ny(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _y(s){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(s);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let n=0;n<s;n++)t[n]=Math.floor(256*Math.random());return t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vm{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length;let n="";for(;n.length<20;){const a=_y(40);for(let i=0;i<a.length;++i)n.length<20&&a[i]<t&&(n+=e.charAt(a[i]%e.length))}return n}}function ot(s,e){return s<e?-1:s>e?1:0}function jn(s,e,t){return s.length===e.length&&s.every((n,a)=>t(n,e[a]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rt{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new Ae(he.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new Ae(he.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new Ae(he.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new Ae(he.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return Rt.fromMillis(Date.now())}static fromDate(e){return Rt.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),n=Math.floor(1e6*(e-1e3*t));return new Rt(t,n)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?ot(this.nanoseconds,e.nanoseconds):ot(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ge{constructor(e){this.timestamp=e}static fromTimestamp(e){return new Ge(e)}static min(){return new Ge(new Rt(0,0))}static max(){return new Ge(new Rt(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ya{constructor(e,t,n){t===void 0?t=0:t>e.length&&We(),n===void 0?n=e.length-t:n>e.length-t&&We(),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return ya.comparator(this,e)===0}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof ya?e.forEach(n=>{t.push(n)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const n=Math.min(e.length,t.length);for(let a=0;a<n;a++){const i=e.get(a),o=t.get(a);if(i<o)return-1;if(i>o)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class bt extends ya{construct(e,t,n){return new bt(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const n of e){if(n.indexOf("//")>=0)throw new Ae(he.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter(a=>a.length>0))}return new bt(t)}static emptyPath(){return new bt([])}}const Ey=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Ut extends ya{construct(e,t,n){return new Ut(e,t,n)}static isValidIdentifier(e){return Ey.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Ut.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new Ut(["__name__"])}static fromServerFormat(e){const t=[];let n="",a=0;const i=()=>{if(n.length===0)throw new Ae(he.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""};let o=!1;for(;a<e.length;){const c=e[a];if(c==="\\"){if(a+1===e.length)throw new Ae(he.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const d=e[a+1];if(d!=="\\"&&d!=="."&&d!=="`")throw new Ae(he.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=d,a+=2}else c==="`"?(o=!o,a++):c!=="."||o?(n+=c,a++):(i(),a++)}if(i(),o)throw new Ae(he.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new Ut(t)}static emptyPath(){return new Ut([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Le{constructor(e){this.path=e}static fromPath(e){return new Le(bt.fromString(e))}static fromName(e){return new Le(bt.fromString(e).popFirst(5))}static empty(){return new Le(bt.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&bt.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return bt.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new Le(new bt(e.slice()))}}function Iy(s,e){const t=s.toTimestamp().seconds,n=s.toTimestamp().nanoseconds+1,a=Ge.fromTimestamp(n===1e9?new Rt(t+1,0):new Rt(t,n));return new $s(a,Le.empty(),e)}function Ty(s){return new $s(s.readTime,s.key,-1)}class $s{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new $s(Ge.min(),Le.empty(),-1)}static max(){return new $s(Ge.max(),Le.empty(),-1)}}function Sy(s,e){let t=s.readTime.compareTo(e.readTime);return t!==0?t:(t=Le.comparator(s.documentKey,e.documentKey),t!==0?t:ot(s.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ay="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class Cy{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Pa(s){if(s.code!==he.FAILED_PRECONDITION||s.message!==Ay)throw s;$e("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class be{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&We(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new be((n,a)=>{this.nextCallback=i=>{this.wrapSuccess(e,i).next(n,a)},this.catchCallback=i=>{this.wrapFailure(t,i).next(n,a)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof be?t:be.resolve(t)}catch(t){return be.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):be.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):be.reject(t)}static resolve(e){return new be((t,n)=>{t(e)})}static reject(e){return new be((t,n)=>{n(e)})}static waitFor(e){return new be((t,n)=>{let a=0,i=0,o=!1;e.forEach(c=>{++a,c.next(()=>{++i,o&&i===a&&t()},d=>n(d))}),o=!0,i===a&&t()})}static or(e){let t=be.resolve(!1);for(const n of e)t=t.next(a=>a?be.resolve(a):n());return t}static forEach(e,t){const n=[];return e.forEach((a,i)=>{n.push(t.call(this,a,i))}),this.waitFor(n)}static mapArray(e,t){return new be((n,a)=>{const i=e.length,o=new Array(i);let c=0;for(let d=0;d<i;d++){const h=d;t(e[h]).next(m=>{o[h]=m,++c,c===i&&n(o)},m=>a(m))}})}static doWhile(e,t){return new be((n,a)=>{const i=()=>{e()===!0?t().next(()=>{i()},a):n()};i()})}}function Dy(s){const e=s.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}function Ma(s){return s.name==="IndexedDbTransactionError"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tc{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=n=>this.ie(n),this.se=n=>t.writeSequenceNumber(n))}ie(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.se&&this.se(e),e}}tc.oe=-1;function io(s){return s==null}function $i(s){return s===0&&1/s==-1/0}function $y(s){return typeof s=="number"&&Number.isInteger(s)&&!$i(s)&&s<=Number.MAX_SAFE_INTEGER&&s>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function su(s){let e=0;for(const t in s)Object.prototype.hasOwnProperty.call(s,t)&&e++;return e}function tn(s,e){for(const t in s)Object.prototype.hasOwnProperty.call(s,t)&&e(t,s[t])}function wm(s){for(const e in s)if(Object.prototype.hasOwnProperty.call(s,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wt{constructor(e,t){this.comparator=e,this.root=t||Ft.EMPTY}insert(e,t){return new wt(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Ft.BLACK,null,null))}remove(e){return new wt(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Ft.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const n=this.comparator(e,t.key);if(n===0)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){const a=this.comparator(e,n.key);if(a===0)return t+n.left.size;a<0?n=n.left:(t+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,n)=>(e(t,n),!1))}toString(){const e=[];return this.inorderTraversal((t,n)=>(e.push(`${t}:${n}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new ii(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new ii(this.root,e,this.comparator,!1)}getReverseIterator(){return new ii(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new ii(this.root,e,this.comparator,!0)}}class ii{constructor(e,t,n,a){this.isReverse=a,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?n(e.key,t):1,t&&a&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(i===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Ft{constructor(e,t,n,a,i){this.key=e,this.value=t,this.color=n??Ft.RED,this.left=a??Ft.EMPTY,this.right=i??Ft.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,a,i){return new Ft(e??this.key,t??this.value,n??this.color,a??this.left,i??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let a=this;const i=n(e,a.key);return a=i<0?a.copy(null,null,null,a.left.insert(e,t,n),null):i===0?a.copy(null,t,null,null,null):a.copy(null,null,null,null,a.right.insert(e,t,n)),a.fixUp()}removeMin(){if(this.left.isEmpty())return Ft.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let n,a=this;if(t(e,a.key)<0)a.left.isEmpty()||a.left.isRed()||a.left.left.isRed()||(a=a.moveRedLeft()),a=a.copy(null,null,null,a.left.remove(e,t),null);else{if(a.left.isRed()&&(a=a.rotateRight()),a.right.isEmpty()||a.right.isRed()||a.right.left.isRed()||(a=a.moveRedRight()),t(e,a.key)===0){if(a.right.isEmpty())return Ft.EMPTY;n=a.right.min(),a=a.copy(n.key,n.value,null,null,a.right.removeMin())}a=a.copy(null,null,null,null,a.right.remove(e,t))}return a.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Ft.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Ft.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw We();const e=this.left.check();if(e!==this.right.check())throw We();return e+(this.isRed()?0:1)}}Ft.EMPTY=null,Ft.RED=!0,Ft.BLACK=!1;Ft.EMPTY=new class{constructor(){this.size=0}get key(){throw We()}get value(){throw We()}get color(){throw We()}get left(){throw We()}get right(){throw We()}copy(e,t,n,a,i){return this}insert(e,t,n){return new Ft(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qt{constructor(e){this.comparator=e,this.data=new wt(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,n)=>(e(t),!1))}forEachInRange(e,t){const n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){const a=n.getNext();if(this.comparator(a.key,e[1])>=0)return;t(a.key)}}forEachWhile(e,t){let n;for(n=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new nu(this.data.getIterator())}getIteratorFrom(e){return new nu(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(n=>{t=t.add(n)}),t}isEqual(e){if(!(e instanceof qt)||this.size!==e.size)return!1;const t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){const a=t.getNext().key,i=n.getNext().key;if(this.comparator(a,i)!==0)return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new qt(this.comparator);return t.data=e,t}}class nu{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xr{constructor(e){this.fields=e,e.sort(Ut.comparator)}static empty(){return new xr([])}unionWith(e){let t=new qt(Ut.comparator);for(const n of this.fields)t=t.add(n);for(const n of e)t=t.add(n);return new xr(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return jn(this.fields,e.fields,(t,n)=>t.isEqual(n))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class km extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wt{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(a){try{return atob(a)}catch(i){throw typeof DOMException<"u"&&i instanceof DOMException?new km("Invalid base64 string: "+i):i}}(e);return new Wt(t)}static fromUint8Array(e){const t=function(a){let i="";for(let o=0;o<a.length;++o)i+=String.fromCharCode(a[o]);return i}(e);return new Wt(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(t){return btoa(t)}(this.binaryString)}toUint8Array(){return function(t){const n=new Uint8Array(t.length);for(let a=0;a<t.length;a++)n[a]=t.charCodeAt(a);return n}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return ot(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Wt.EMPTY_BYTE_STRING=new Wt("");const Ry=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Rs(s){if(ut(!!s),typeof s=="string"){let e=0;const t=Ry.exec(s);if(ut(!!t),t[1]){let a=t[1];a=(a+"000000000").substr(0,9),e=Number(a)}const n=new Date(s);return{seconds:Math.floor(n.getTime()/1e3),nanos:e}}return{seconds:St(s.seconds),nanos:St(s.nanos)}}function St(s){return typeof s=="number"?s:typeof s=="string"?Number(s):0}function Xs(s){return typeof s=="string"?Wt.fromBase64String(s):Wt.fromUint8Array(s)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rc(s){var e,t;return((t=(((e=s==null?void 0:s.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||t===void 0?void 0:t.stringValue)==="server_timestamp"}function sc(s){const e=s.mapValue.fields.__previous_value__;return rc(e)?sc(e):e}function ba(s){const e=Rs(s.mapValue.fields.__local_write_time__.timestampValue);return new Rt(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Py{constructor(e,t,n,a,i,o,c,d,h){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=a,this.ssl=i,this.forceLongPolling=o,this.autoDetectLongPolling=c,this.longPollingOptions=d,this.useFetchStreams=h}}class va{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new va("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(e){return e instanceof va&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const oi={mapValue:{}};function Js(s){return"nullValue"in s?0:"booleanValue"in s?1:"integerValue"in s||"doubleValue"in s?2:"timestampValue"in s?3:"stringValue"in s?5:"bytesValue"in s?6:"referenceValue"in s?7:"geoPointValue"in s?8:"arrayValue"in s?9:"mapValue"in s?rc(s)?4:Oy(s)?9007199254740991:My(s)?10:11:We()}function Lr(s,e){if(s===e)return!0;const t=Js(s);if(t!==Js(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return s.booleanValue===e.booleanValue;case 4:return ba(s).isEqual(ba(e));case 3:return function(a,i){if(typeof a.timestampValue=="string"&&typeof i.timestampValue=="string"&&a.timestampValue.length===i.timestampValue.length)return a.timestampValue===i.timestampValue;const o=Rs(a.timestampValue),c=Rs(i.timestampValue);return o.seconds===c.seconds&&o.nanos===c.nanos}(s,e);case 5:return s.stringValue===e.stringValue;case 6:return function(a,i){return Xs(a.bytesValue).isEqual(Xs(i.bytesValue))}(s,e);case 7:return s.referenceValue===e.referenceValue;case 8:return function(a,i){return St(a.geoPointValue.latitude)===St(i.geoPointValue.latitude)&&St(a.geoPointValue.longitude)===St(i.geoPointValue.longitude)}(s,e);case 2:return function(a,i){if("integerValue"in a&&"integerValue"in i)return St(a.integerValue)===St(i.integerValue);if("doubleValue"in a&&"doubleValue"in i){const o=St(a.doubleValue),c=St(i.doubleValue);return o===c?$i(o)===$i(c):isNaN(o)&&isNaN(c)}return!1}(s,e);case 9:return jn(s.arrayValue.values||[],e.arrayValue.values||[],Lr);case 10:case 11:return function(a,i){const o=a.mapValue.fields||{},c=i.mapValue.fields||{};if(su(o)!==su(c))return!1;for(const d in o)if(o.hasOwnProperty(d)&&(c[d]===void 0||!Lr(o[d],c[d])))return!1;return!0}(s,e);default:return We()}}function wa(s,e){return(s.values||[]).find(t=>Lr(t,e))!==void 0}function _n(s,e){if(s===e)return 0;const t=Js(s),n=Js(e);if(t!==n)return ot(t,n);switch(t){case 0:case 9007199254740991:return 0;case 1:return ot(s.booleanValue,e.booleanValue);case 2:return function(i,o){const c=St(i.integerValue||i.doubleValue),d=St(o.integerValue||o.doubleValue);return c<d?-1:c>d?1:c===d?0:isNaN(c)?isNaN(d)?0:-1:1}(s,e);case 3:return au(s.timestampValue,e.timestampValue);case 4:return au(ba(s),ba(e));case 5:return ot(s.stringValue,e.stringValue);case 6:return function(i,o){const c=Xs(i),d=Xs(o);return c.compareTo(d)}(s.bytesValue,e.bytesValue);case 7:return function(i,o){const c=i.split("/"),d=o.split("/");for(let h=0;h<c.length&&h<d.length;h++){const m=ot(c[h],d[h]);if(m!==0)return m}return ot(c.length,d.length)}(s.referenceValue,e.referenceValue);case 8:return function(i,o){const c=ot(St(i.latitude),St(o.latitude));return c!==0?c:ot(St(i.longitude),St(o.longitude))}(s.geoPointValue,e.geoPointValue);case 9:return iu(s.arrayValue,e.arrayValue);case 10:return function(i,o){var c,d,h,m;const x=i.fields||{},f=o.fields||{},k=(c=x.value)===null||c===void 0?void 0:c.arrayValue,A=(d=f.value)===null||d===void 0?void 0:d.arrayValue,D=ot(((h=k==null?void 0:k.values)===null||h===void 0?void 0:h.length)||0,((m=A==null?void 0:A.values)===null||m===void 0?void 0:m.length)||0);return D!==0?D:iu(k,A)}(s.mapValue,e.mapValue);case 11:return function(i,o){if(i===oi.mapValue&&o===oi.mapValue)return 0;if(i===oi.mapValue)return 1;if(o===oi.mapValue)return-1;const c=i.fields||{},d=Object.keys(c),h=o.fields||{},m=Object.keys(h);d.sort(),m.sort();for(let x=0;x<d.length&&x<m.length;++x){const f=ot(d[x],m[x]);if(f!==0)return f;const k=_n(c[d[x]],h[m[x]]);if(k!==0)return k}return ot(d.length,m.length)}(s.mapValue,e.mapValue);default:throw We()}}function au(s,e){if(typeof s=="string"&&typeof e=="string"&&s.length===e.length)return ot(s,e);const t=Rs(s),n=Rs(e),a=ot(t.seconds,n.seconds);return a!==0?a:ot(t.nanos,n.nanos)}function iu(s,e){const t=s.values||[],n=e.values||[];for(let a=0;a<t.length&&a<n.length;++a){const i=_n(t[a],n[a]);if(i)return i}return ot(t.length,n.length)}function En(s){return bl(s)}function bl(s){return"nullValue"in s?"null":"booleanValue"in s?""+s.booleanValue:"integerValue"in s?""+s.integerValue:"doubleValue"in s?""+s.doubleValue:"timestampValue"in s?function(t){const n=Rs(t);return`time(${n.seconds},${n.nanos})`}(s.timestampValue):"stringValue"in s?s.stringValue:"bytesValue"in s?function(t){return Xs(t).toBase64()}(s.bytesValue):"referenceValue"in s?function(t){return Le.fromName(t).toString()}(s.referenceValue):"geoPointValue"in s?function(t){return`geo(${t.latitude},${t.longitude})`}(s.geoPointValue):"arrayValue"in s?function(t){let n="[",a=!0;for(const i of t.values||[])a?a=!1:n+=",",n+=bl(i);return n+"]"}(s.arrayValue):"mapValue"in s?function(t){const n=Object.keys(t.fields||{}).sort();let a="{",i=!0;for(const o of n)i?i=!1:a+=",",a+=`${o}:${bl(t.fields[o])}`;return a+"}"}(s.mapValue):We()}function ou(s,e){return{referenceValue:`projects/${s.projectId}/databases/${s.database}/documents/${e.path.canonicalString()}`}}function vl(s){return!!s&&"integerValue"in s}function nc(s){return!!s&&"arrayValue"in s}function lu(s){return!!s&&"nullValue"in s}function cu(s){return!!s&&"doubleValue"in s&&isNaN(Number(s.doubleValue))}function fi(s){return!!s&&"mapValue"in s}function My(s){var e,t;return((t=(((e=s==null?void 0:s.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||t===void 0?void 0:t.stringValue)==="__vector__"}function oa(s){if(s.geoPointValue)return{geoPointValue:Object.assign({},s.geoPointValue)};if(s.timestampValue&&typeof s.timestampValue=="object")return{timestampValue:Object.assign({},s.timestampValue)};if(s.mapValue){const e={mapValue:{fields:{}}};return tn(s.mapValue.fields,(t,n)=>e.mapValue.fields[t]=oa(n)),e}if(s.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(s.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=oa(s.arrayValue.values[t]);return e}return Object.assign({},s)}function Oy(s){return(((s.mapValue||{}).fields||{}).__type__||{}).stringValue==="__max__"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ur{constructor(e){this.value=e}static empty(){return new ur({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(t=(t.mapValue.fields||{})[e.get(n)],!fi(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=oa(t)}setAll(e){let t=Ut.emptyPath(),n={},a=[];e.forEach((o,c)=>{if(!t.isImmediateParentOf(c)){const d=this.getFieldsMap(t);this.applyChanges(d,n,a),n={},a=[],t=c.popLast()}o?n[c.lastSegment()]=oa(o):a.push(c.lastSegment())});const i=this.getFieldsMap(t);this.applyChanges(i,n,a)}delete(e){const t=this.field(e.popLast());fi(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Lr(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let a=t.mapValue.fields[e.get(n)];fi(a)&&a.mapValue.fields||(a={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=a),t=a}return t.mapValue.fields}applyChanges(e,t,n){tn(t,(a,i)=>e[a]=i);for(const a of n)delete e[a]}clone(){return new ur(oa(this.value))}}function Nm(s){const e=[];return tn(s.fields,(t,n)=>{const a=new Ut([t]);if(fi(n)){const i=Nm(n.mapValue).fields;if(i.length===0)e.push(a);else for(const o of i)e.push(a.child(o))}else e.push(a)}),new xr(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xt{constructor(e,t,n,a,i,o,c){this.key=e,this.documentType=t,this.version=n,this.readTime=a,this.createTime=i,this.data=o,this.documentState=c}static newInvalidDocument(e){return new Xt(e,0,Ge.min(),Ge.min(),Ge.min(),ur.empty(),0)}static newFoundDocument(e,t,n,a){return new Xt(e,1,t,Ge.min(),n,a,0)}static newNoDocument(e,t){return new Xt(e,2,t,Ge.min(),Ge.min(),ur.empty(),0)}static newUnknownDocument(e,t){return new Xt(e,3,t,Ge.min(),Ge.min(),ur.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(Ge.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=ur.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=ur.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=Ge.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof Xt&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new Xt(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ri{constructor(e,t){this.position=e,this.inclusive=t}}function du(s,e,t){let n=0;for(let a=0;a<s.position.length;a++){const i=e[a],o=s.position[a];if(i.field.isKeyField()?n=Le.comparator(Le.fromName(o.referenceValue),t.key):n=_n(o,t.data.field(i.field)),i.dir==="desc"&&(n*=-1),n!==0)break}return n}function uu(s,e){if(s===null)return e===null;if(e===null||s.inclusive!==e.inclusive||s.position.length!==e.position.length)return!1;for(let t=0;t<s.position.length;t++)if(!Lr(s.position[t],e.position[t]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ka{constructor(e,t="asc"){this.field=e,this.dir=t}}function Vy(s,e){return s.dir===e.dir&&s.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jm{}class Dt extends jm{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,n):new Fy(e,t,n):t==="array-contains"?new qy(e,n):t==="in"?new Wy(e,n):t==="not-in"?new zy(e,n):t==="array-contains-any"?new Hy(e,n):new Dt(e,t,n)}static createKeyFieldInFilter(e,t,n){return t==="in"?new Uy(e,n):new By(e,n)}matches(e){const t=e.data.field(this.field);return this.op==="!="?t!==null&&this.matchesComparison(_n(t,this.value)):t!==null&&Js(this.value)===Js(t)&&this.matchesComparison(_n(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return We()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class Ar extends jm{constructor(e,t){super(),this.filters=e,this.op=t,this.ae=null}static create(e,t){return new Ar(e,t)}matches(e){return _m(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.ae!==null||(this.ae=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.ae}getFilters(){return Object.assign([],this.filters)}}function _m(s){return s.op==="and"}function Em(s){return Ly(s)&&_m(s)}function Ly(s){for(const e of s.filters)if(e instanceof Ar)return!1;return!0}function wl(s){if(s instanceof Dt)return s.field.canonicalString()+s.op.toString()+En(s.value);if(Em(s))return s.filters.map(e=>wl(e)).join(",");{const e=s.filters.map(t=>wl(t)).join(",");return`${s.op}(${e})`}}function Im(s,e){return s instanceof Dt?function(n,a){return a instanceof Dt&&n.op===a.op&&n.field.isEqual(a.field)&&Lr(n.value,a.value)}(s,e):s instanceof Ar?function(n,a){return a instanceof Ar&&n.op===a.op&&n.filters.length===a.filters.length?n.filters.reduce((i,o,c)=>i&&Im(o,a.filters[c]),!0):!1}(s,e):void We()}function Tm(s){return s instanceof Dt?function(t){return`${t.field.canonicalString()} ${t.op} ${En(t.value)}`}(s):s instanceof Ar?function(t){return t.op.toString()+" {"+t.getFilters().map(Tm).join(" ,")+"}"}(s):"Filter"}class Fy extends Dt{constructor(e,t,n){super(e,t,n),this.key=Le.fromName(n.referenceValue)}matches(e){const t=Le.comparator(e.key,this.key);return this.matchesComparison(t)}}class Uy extends Dt{constructor(e,t){super(e,"in",t),this.keys=Sm("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class By extends Dt{constructor(e,t){super(e,"not-in",t),this.keys=Sm("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function Sm(s,e){var t;return(((t=e.arrayValue)===null||t===void 0?void 0:t.values)||[]).map(n=>Le.fromName(n.referenceValue))}class qy extends Dt{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return nc(t)&&wa(t.arrayValue,this.value)}}class Wy extends Dt{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return t!==null&&wa(this.value.arrayValue,t)}}class zy extends Dt{constructor(e,t){super(e,"not-in",t)}matches(e){if(wa(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return t!==null&&!wa(this.value.arrayValue,t)}}class Hy extends Dt{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!nc(t)||!t.arrayValue.values)&&t.arrayValue.values.some(n=>wa(this.value.arrayValue,n))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gy{constructor(e,t=null,n=[],a=[],i=null,o=null,c=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=a,this.limit=i,this.startAt=o,this.endAt=c,this.ue=null}}function hu(s,e=null,t=[],n=[],a=null,i=null,o=null){return new Gy(s,e,t,n,a,i,o)}function ac(s){const e=Ke(s);if(e.ue===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(n=>wl(n)).join(","),t+="|ob:",t+=e.orderBy.map(n=>function(i){return i.field.canonicalString()+i.dir}(n)).join(","),io(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(n=>En(n)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(n=>En(n)).join(",")),e.ue=t}return e.ue}function ic(s,e){if(s.limit!==e.limit||s.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<s.orderBy.length;t++)if(!Vy(s.orderBy[t],e.orderBy[t]))return!1;if(s.filters.length!==e.filters.length)return!1;for(let t=0;t<s.filters.length;t++)if(!Im(s.filters[t],e.filters[t]))return!1;return s.collectionGroup===e.collectionGroup&&!!s.path.isEqual(e.path)&&!!uu(s.startAt,e.startAt)&&uu(s.endAt,e.endAt)}function kl(s){return Le.isDocumentKey(s.path)&&s.collectionGroup===null&&s.filters.length===0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class On{constructor(e,t=null,n=[],a=[],i=null,o="F",c=null,d=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=a,this.limit=i,this.limitType=o,this.startAt=c,this.endAt=d,this.ce=null,this.le=null,this.he=null,this.startAt,this.endAt}}function Ky(s,e,t,n,a,i,o,c){return new On(s,e,t,n,a,i,o,c)}function oc(s){return new On(s)}function mu(s){return s.filters.length===0&&s.limit===null&&s.startAt==null&&s.endAt==null&&(s.explicitOrderBy.length===0||s.explicitOrderBy.length===1&&s.explicitOrderBy[0].field.isKeyField())}function Am(s){return s.collectionGroup!==null}function la(s){const e=Ke(s);if(e.ce===null){e.ce=[];const t=new Set;for(const i of e.explicitOrderBy)e.ce.push(i),t.add(i.field.canonicalString());const n=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(o){let c=new qt(Ut.comparator);return o.filters.forEach(d=>{d.getFlattenedFilters().forEach(h=>{h.isInequality()&&(c=c.add(h.field))})}),c})(e).forEach(i=>{t.has(i.canonicalString())||i.isKeyField()||e.ce.push(new ka(i,n))}),t.has(Ut.keyField().canonicalString())||e.ce.push(new ka(Ut.keyField(),n))}return e.ce}function Pr(s){const e=Ke(s);return e.le||(e.le=Yy(e,la(s))),e.le}function Yy(s,e){if(s.limitType==="F")return hu(s.path,s.collectionGroup,e,s.filters,s.limit,s.startAt,s.endAt);{e=e.map(a=>{const i=a.dir==="desc"?"asc":"desc";return new ka(a.field,i)});const t=s.endAt?new Ri(s.endAt.position,s.endAt.inclusive):null,n=s.startAt?new Ri(s.startAt.position,s.startAt.inclusive):null;return hu(s.path,s.collectionGroup,e,s.filters,s.limit,t,n)}}function Nl(s,e){const t=s.filters.concat([e]);return new On(s.path,s.collectionGroup,s.explicitOrderBy.slice(),t,s.limit,s.limitType,s.startAt,s.endAt)}function jl(s,e,t){return new On(s.path,s.collectionGroup,s.explicitOrderBy.slice(),s.filters.slice(),e,t,s.startAt,s.endAt)}function oo(s,e){return ic(Pr(s),Pr(e))&&s.limitType===e.limitType}function Cm(s){return`${ac(Pr(s))}|lt:${s.limitType}`}function un(s){return`Query(target=${function(t){let n=t.path.canonicalString();return t.collectionGroup!==null&&(n+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(n+=`, filters: [${t.filters.map(a=>Tm(a)).join(", ")}]`),io(t.limit)||(n+=", limit: "+t.limit),t.orderBy.length>0&&(n+=`, orderBy: [${t.orderBy.map(a=>function(o){return`${o.field.canonicalString()} (${o.dir})`}(a)).join(", ")}]`),t.startAt&&(n+=", startAt: ",n+=t.startAt.inclusive?"b:":"a:",n+=t.startAt.position.map(a=>En(a)).join(",")),t.endAt&&(n+=", endAt: ",n+=t.endAt.inclusive?"a:":"b:",n+=t.endAt.position.map(a=>En(a)).join(",")),`Target(${n})`}(Pr(s))}; limitType=${s.limitType})`}function lo(s,e){return e.isFoundDocument()&&function(n,a){const i=a.key.path;return n.collectionGroup!==null?a.key.hasCollectionId(n.collectionGroup)&&n.path.isPrefixOf(i):Le.isDocumentKey(n.path)?n.path.isEqual(i):n.path.isImmediateParentOf(i)}(s,e)&&function(n,a){for(const i of la(n))if(!i.field.isKeyField()&&a.data.field(i.field)===null)return!1;return!0}(s,e)&&function(n,a){for(const i of n.filters)if(!i.matches(a))return!1;return!0}(s,e)&&function(n,a){return!(n.startAt&&!function(o,c,d){const h=du(o,c,d);return o.inclusive?h<=0:h<0}(n.startAt,la(n),a)||n.endAt&&!function(o,c,d){const h=du(o,c,d);return o.inclusive?h>=0:h>0}(n.endAt,la(n),a))}(s,e)}function Qy(s){return s.collectionGroup||(s.path.length%2==1?s.path.lastSegment():s.path.get(s.path.length-2))}function Dm(s){return(e,t)=>{let n=!1;for(const a of la(s)){const i=Xy(a,e,t);if(i!==0)return i;n=n||a.field.isKeyField()}return 0}}function Xy(s,e,t){const n=s.field.isKeyField()?Le.comparator(e.key,t.key):function(i,o,c){const d=o.data.field(i),h=c.data.field(i);return d!==null&&h!==null?_n(d,h):We()}(s.field,e,t);switch(s.dir){case"asc":return n;case"desc":return-1*n;default:return We()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vn{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),n=this.inner[t];if(n!==void 0){for(const[a,i]of n)if(this.equalsFn(a,e))return i}}has(e){return this.get(e)!==void 0}set(e,t){const n=this.mapKeyFn(e),a=this.inner[n];if(a===void 0)return this.inner[n]=[[e,t]],void this.innerSize++;for(let i=0;i<a.length;i++)if(this.equalsFn(a[i][0],e))return void(a[i]=[e,t]);a.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),n=this.inner[t];if(n===void 0)return!1;for(let a=0;a<n.length;a++)if(this.equalsFn(n[a][0],e))return n.length===1?delete this.inner[t]:n.splice(a,1),this.innerSize--,!0;return!1}forEach(e){tn(this.inner,(t,n)=>{for(const[a,i]of n)e(a,i)})}isEmpty(){return wm(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Jy=new wt(Le.comparator);function cs(){return Jy}const $m=new wt(Le.comparator);function na(...s){let e=$m;for(const t of s)e=e.insert(t.key,t);return e}function Rm(s){let e=$m;return s.forEach((t,n)=>e=e.insert(t,n.overlayedDocument)),e}function qs(){return ca()}function Pm(){return ca()}function ca(){return new Vn(s=>s.toString(),(s,e)=>s.isEqual(e))}const Zy=new wt(Le.comparator),eb=new qt(Le.comparator);function Xe(...s){let e=eb;for(const t of s)e=e.add(t);return e}const tb=new qt(ot);function rb(){return tb}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lc(s,e){if(s.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:$i(e)?"-0":e}}function Mm(s){return{integerValue:""+s}}function sb(s,e){return $y(e)?Mm(e):lc(s,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class co{constructor(){this._=void 0}}function nb(s,e,t){return s instanceof Pi?function(a,i){const o={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:a.seconds,nanos:a.nanoseconds}}}};return i&&rc(i)&&(i=sc(i)),i&&(o.fields.__previous_value__=i),{mapValue:o}}(t,e):s instanceof Na?Vm(s,e):s instanceof ja?Lm(s,e):function(a,i){const o=Om(a,i),c=gu(o)+gu(a.Pe);return vl(o)&&vl(a.Pe)?Mm(c):lc(a.serializer,c)}(s,e)}function ab(s,e,t){return s instanceof Na?Vm(s,e):s instanceof ja?Lm(s,e):t}function Om(s,e){return s instanceof Mi?function(n){return vl(n)||function(i){return!!i&&"doubleValue"in i}(n)}(e)?e:{integerValue:0}:null}class Pi extends co{}class Na extends co{constructor(e){super(),this.elements=e}}function Vm(s,e){const t=Fm(e);for(const n of s.elements)t.some(a=>Lr(a,n))||t.push(n);return{arrayValue:{values:t}}}class ja extends co{constructor(e){super(),this.elements=e}}function Lm(s,e){let t=Fm(e);for(const n of s.elements)t=t.filter(a=>!Lr(a,n));return{arrayValue:{values:t}}}class Mi extends co{constructor(e,t){super(),this.serializer=e,this.Pe=t}}function gu(s){return St(s.integerValue||s.doubleValue)}function Fm(s){return nc(s)&&s.arrayValue.values?s.arrayValue.values.slice():[]}function ib(s,e){return s.field.isEqual(e.field)&&function(n,a){return n instanceof Na&&a instanceof Na||n instanceof ja&&a instanceof ja?jn(n.elements,a.elements,Lr):n instanceof Mi&&a instanceof Mi?Lr(n.Pe,a.Pe):n instanceof Pi&&a instanceof Pi}(s.transform,e.transform)}class ob{constructor(e,t){this.version=e,this.transformResults=t}}class Ir{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new Ir}static exists(e){return new Ir(void 0,e)}static updateTime(e){return new Ir(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function yi(s,e){return s.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(s.updateTime):s.exists===void 0||s.exists===e.isFoundDocument()}class uo{}function Um(s,e){if(!s.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return s.isNoDocument()?new cc(s.key,Ir.none()):new Oa(s.key,s.data,Ir.none());{const t=s.data,n=ur.empty();let a=new qt(Ut.comparator);for(let i of e.fields)if(!a.has(i)){let o=t.field(i);o===null&&i.length>1&&(i=i.popLast(),o=t.field(i)),o===null?n.delete(i):n.set(i,o),a=a.add(i)}return new Os(s.key,n,new xr(a.toArray()),Ir.none())}}function lb(s,e,t){s instanceof Oa?function(a,i,o){const c=a.value.clone(),d=xu(a.fieldTransforms,i,o.transformResults);c.setAll(d),i.convertToFoundDocument(o.version,c).setHasCommittedMutations()}(s,e,t):s instanceof Os?function(a,i,o){if(!yi(a.precondition,i))return void i.convertToUnknownDocument(o.version);const c=xu(a.fieldTransforms,i,o.transformResults),d=i.data;d.setAll(Bm(a)),d.setAll(c),i.convertToFoundDocument(o.version,d).setHasCommittedMutations()}(s,e,t):function(a,i,o){i.convertToNoDocument(o.version).setHasCommittedMutations()}(0,e,t)}function da(s,e,t,n){return s instanceof Oa?function(i,o,c,d){if(!yi(i.precondition,o))return c;const h=i.value.clone(),m=fu(i.fieldTransforms,d,o);return h.setAll(m),o.convertToFoundDocument(o.version,h).setHasLocalMutations(),null}(s,e,t,n):s instanceof Os?function(i,o,c,d){if(!yi(i.precondition,o))return c;const h=fu(i.fieldTransforms,d,o),m=o.data;return m.setAll(Bm(i)),m.setAll(h),o.convertToFoundDocument(o.version,m).setHasLocalMutations(),c===null?null:c.unionWith(i.fieldMask.fields).unionWith(i.fieldTransforms.map(x=>x.field))}(s,e,t,n):function(i,o,c){return yi(i.precondition,o)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):c}(s,e,t)}function cb(s,e){let t=null;for(const n of s.fieldTransforms){const a=e.data.field(n.field),i=Om(n.transform,a||null);i!=null&&(t===null&&(t=ur.empty()),t.set(n.field,i))}return t||null}function pu(s,e){return s.type===e.type&&!!s.key.isEqual(e.key)&&!!s.precondition.isEqual(e.precondition)&&!!function(n,a){return n===void 0&&a===void 0||!(!n||!a)&&jn(n,a,(i,o)=>ib(i,o))}(s.fieldTransforms,e.fieldTransforms)&&(s.type===0?s.value.isEqual(e.value):s.type!==1||s.data.isEqual(e.data)&&s.fieldMask.isEqual(e.fieldMask))}class Oa extends uo{constructor(e,t,n,a=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=a,this.type=0}getFieldMask(){return null}}class Os extends uo{constructor(e,t,n,a,i=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=a,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function Bm(s){const e=new Map;return s.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){const n=s.data.field(t);e.set(t,n)}}),e}function xu(s,e,t){const n=new Map;ut(s.length===t.length);for(let a=0;a<t.length;a++){const i=s[a],o=i.transform,c=e.data.field(i.field);n.set(i.field,ab(o,c,t[a]))}return n}function fu(s,e,t){const n=new Map;for(const a of s){const i=a.transform,o=t.data.field(a.field);n.set(a.field,nb(i,o,e))}return n}class cc extends uo{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class db extends uo{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ub{constructor(e,t,n,a){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=a}applyToRemoteDocument(e,t){const n=t.mutationResults;for(let a=0;a<this.mutations.length;a++){const i=this.mutations[a];i.key.isEqual(e.key)&&lb(i,e,n[a])}}applyToLocalView(e,t){for(const n of this.baseMutations)n.key.isEqual(e.key)&&(t=da(n,e,t,this.localWriteTime));for(const n of this.mutations)n.key.isEqual(e.key)&&(t=da(n,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const n=Pm();return this.mutations.forEach(a=>{const i=e.get(a.key),o=i.overlayedDocument;let c=this.applyToLocalView(o,i.mutatedFields);c=t.has(a.key)?null:c;const d=Um(o,c);d!==null&&n.set(a.key,d),o.isValidDocument()||o.convertToNoDocument(Ge.min())}),n}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),Xe())}isEqual(e){return this.batchId===e.batchId&&jn(this.mutations,e.mutations,(t,n)=>pu(t,n))&&jn(this.baseMutations,e.baseMutations,(t,n)=>pu(t,n))}}class dc{constructor(e,t,n,a){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=a}static from(e,t,n){ut(e.mutations.length===n.length);let a=function(){return Zy}();const i=e.mutations;for(let o=0;o<i.length;o++)a=a.insert(i[o].key,n[o].version);return new dc(e,t,n,a)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hb{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mb{constructor(e,t){this.count=e,this.unchangedNames=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Ct,st;function gb(s){switch(s){default:return We();case he.CANCELLED:case he.UNKNOWN:case he.DEADLINE_EXCEEDED:case he.RESOURCE_EXHAUSTED:case he.INTERNAL:case he.UNAVAILABLE:case he.UNAUTHENTICATED:return!1;case he.INVALID_ARGUMENT:case he.NOT_FOUND:case he.ALREADY_EXISTS:case he.PERMISSION_DENIED:case he.FAILED_PRECONDITION:case he.ABORTED:case he.OUT_OF_RANGE:case he.UNIMPLEMENTED:case he.DATA_LOSS:return!0}}function qm(s){if(s===void 0)return ls("GRPC error has no .code"),he.UNKNOWN;switch(s){case Ct.OK:return he.OK;case Ct.CANCELLED:return he.CANCELLED;case Ct.UNKNOWN:return he.UNKNOWN;case Ct.DEADLINE_EXCEEDED:return he.DEADLINE_EXCEEDED;case Ct.RESOURCE_EXHAUSTED:return he.RESOURCE_EXHAUSTED;case Ct.INTERNAL:return he.INTERNAL;case Ct.UNAVAILABLE:return he.UNAVAILABLE;case Ct.UNAUTHENTICATED:return he.UNAUTHENTICATED;case Ct.INVALID_ARGUMENT:return he.INVALID_ARGUMENT;case Ct.NOT_FOUND:return he.NOT_FOUND;case Ct.ALREADY_EXISTS:return he.ALREADY_EXISTS;case Ct.PERMISSION_DENIED:return he.PERMISSION_DENIED;case Ct.FAILED_PRECONDITION:return he.FAILED_PRECONDITION;case Ct.ABORTED:return he.ABORTED;case Ct.OUT_OF_RANGE:return he.OUT_OF_RANGE;case Ct.UNIMPLEMENTED:return he.UNIMPLEMENTED;case Ct.DATA_LOSS:return he.DATA_LOSS;default:return We()}}(st=Ct||(Ct={}))[st.OK=0]="OK",st[st.CANCELLED=1]="CANCELLED",st[st.UNKNOWN=2]="UNKNOWN",st[st.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",st[st.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",st[st.NOT_FOUND=5]="NOT_FOUND",st[st.ALREADY_EXISTS=6]="ALREADY_EXISTS",st[st.PERMISSION_DENIED=7]="PERMISSION_DENIED",st[st.UNAUTHENTICATED=16]="UNAUTHENTICATED",st[st.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",st[st.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",st[st.ABORTED=10]="ABORTED",st[st.OUT_OF_RANGE=11]="OUT_OF_RANGE",st[st.UNIMPLEMENTED=12]="UNIMPLEMENTED",st[st.INTERNAL=13]="INTERNAL",st[st.UNAVAILABLE=14]="UNAVAILABLE",st[st.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function pb(){return new TextEncoder}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xb=new Gs([4294967295,4294967295],0);function yu(s){const e=pb().encode(s),t=new mm;return t.update(e),new Uint8Array(t.digest())}function bu(s){const e=new DataView(s.buffer),t=e.getUint32(0,!0),n=e.getUint32(4,!0),a=e.getUint32(8,!0),i=e.getUint32(12,!0);return[new Gs([t,n],0),new Gs([a,i],0)]}class uc{constructor(e,t,n){if(this.bitmap=e,this.padding=t,this.hashCount=n,t<0||t>=8)throw new aa(`Invalid padding: ${t}`);if(n<0)throw new aa(`Invalid hash count: ${n}`);if(e.length>0&&this.hashCount===0)throw new aa(`Invalid hash count: ${n}`);if(e.length===0&&t!==0)throw new aa(`Invalid padding when bitmap length is 0: ${t}`);this.Ie=8*e.length-t,this.Te=Gs.fromNumber(this.Ie)}Ee(e,t,n){let a=e.add(t.multiply(Gs.fromNumber(n)));return a.compare(xb)===1&&(a=new Gs([a.getBits(0),a.getBits(1)],0)),a.modulo(this.Te).toNumber()}de(e){return(this.bitmap[Math.floor(e/8)]&1<<e%8)!=0}mightContain(e){if(this.Ie===0)return!1;const t=yu(e),[n,a]=bu(t);for(let i=0;i<this.hashCount;i++){const o=this.Ee(n,a,i);if(!this.de(o))return!1}return!0}static create(e,t,n){const a=e%8==0?0:8-e%8,i=new Uint8Array(Math.ceil(e/8)),o=new uc(i,a,t);return n.forEach(c=>o.insert(c)),o}insert(e){if(this.Ie===0)return;const t=yu(e),[n,a]=bu(t);for(let i=0;i<this.hashCount;i++){const o=this.Ee(n,a,i);this.Ae(o)}}Ae(e){const t=Math.floor(e/8),n=e%8;this.bitmap[t]|=1<<n}}class aa extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ho{constructor(e,t,n,a,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=a,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,n){const a=new Map;return a.set(e,Va.createSynthesizedTargetChangeForCurrentChange(e,t,n)),new ho(Ge.min(),a,new wt(ot),cs(),Xe())}}class Va{constructor(e,t,n,a,i){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=a,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,n){return new Va(n,t,Xe(),Xe(),Xe())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bi{constructor(e,t,n,a){this.Re=e,this.removedTargetIds=t,this.key=n,this.Ve=a}}class Wm{constructor(e,t){this.targetId=e,this.me=t}}class zm{constructor(e,t,n=Wt.EMPTY_BYTE_STRING,a=null){this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=a}}class vu{constructor(){this.fe=0,this.ge=ku(),this.pe=Wt.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return this.fe!==0}get be(){return this.we}De(e){e.approximateByteSize()>0&&(this.we=!0,this.pe=e)}ve(){let e=Xe(),t=Xe(),n=Xe();return this.ge.forEach((a,i)=>{switch(i){case 0:e=e.add(a);break;case 2:t=t.add(a);break;case 1:n=n.add(a);break;default:We()}}),new Va(this.pe,this.ye,e,t,n)}Ce(){this.we=!1,this.ge=ku()}Fe(e,t){this.we=!0,this.ge=this.ge.insert(e,t)}Me(e){this.we=!0,this.ge=this.ge.remove(e)}xe(){this.fe+=1}Oe(){this.fe-=1,ut(this.fe>=0)}Ne(){this.we=!0,this.ye=!0}}class fb{constructor(e){this.Le=e,this.Be=new Map,this.ke=cs(),this.qe=wu(),this.Qe=new wt(ot)}Ke(e){for(const t of e.Re)e.Ve&&e.Ve.isFoundDocument()?this.$e(t,e.Ve):this.Ue(t,e.key,e.Ve);for(const t of e.removedTargetIds)this.Ue(t,e.key,e.Ve)}We(e){this.forEachTarget(e,t=>{const n=this.Ge(t);switch(e.state){case 0:this.ze(t)&&n.De(e.resumeToken);break;case 1:n.Oe(),n.Se||n.Ce(),n.De(e.resumeToken);break;case 2:n.Oe(),n.Se||this.removeTarget(t);break;case 3:this.ze(t)&&(n.Ne(),n.De(e.resumeToken));break;case 4:this.ze(t)&&(this.je(t),n.De(e.resumeToken));break;default:We()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Be.forEach((n,a)=>{this.ze(a)&&t(a)})}He(e){const t=e.targetId,n=e.me.count,a=this.Je(t);if(a){const i=a.target;if(kl(i))if(n===0){const o=new Le(i.path);this.Ue(t,o,Xt.newNoDocument(o,Ge.min()))}else ut(n===1);else{const o=this.Ye(t);if(o!==n){const c=this.Ze(e),d=c?this.Xe(c,e,o):1;if(d!==0){this.je(t);const h=d===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Qe=this.Qe.insert(t,h)}}}}}Ze(e){const t=e.me.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:n="",padding:a=0},hashCount:i=0}=t;let o,c;try{o=Xs(n).toUint8Array()}catch(d){if(d instanceof km)return Nn("Decoding the base64 bloom filter in existence filter failed ("+d.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw d}try{c=new uc(o,a,i)}catch(d){return Nn(d instanceof aa?"BloomFilter error: ":"Applying bloom filter failed: ",d),null}return c.Ie===0?null:c}Xe(e,t,n){return t.me.count===n-this.nt(e,t.targetId)?0:2}nt(e,t){const n=this.Le.getRemoteKeysForTarget(t);let a=0;return n.forEach(i=>{const o=this.Le.tt(),c=`projects/${o.projectId}/databases/${o.database}/documents/${i.path.canonicalString()}`;e.mightContain(c)||(this.Ue(t,i,null),a++)}),a}rt(e){const t=new Map;this.Be.forEach((i,o)=>{const c=this.Je(o);if(c){if(i.current&&kl(c.target)){const d=new Le(c.target.path);this.ke.get(d)!==null||this.it(o,d)||this.Ue(o,d,Xt.newNoDocument(d,e))}i.be&&(t.set(o,i.ve()),i.Ce())}});let n=Xe();this.qe.forEach((i,o)=>{let c=!0;o.forEachWhile(d=>{const h=this.Je(d);return!h||h.purpose==="TargetPurposeLimboResolution"||(c=!1,!1)}),c&&(n=n.add(i))}),this.ke.forEach((i,o)=>o.setReadTime(e));const a=new ho(e,t,this.Qe,this.ke,n);return this.ke=cs(),this.qe=wu(),this.Qe=new wt(ot),a}$e(e,t){if(!this.ze(e))return;const n=this.it(e,t.key)?2:0;this.Ge(e).Fe(t.key,n),this.ke=this.ke.insert(t.key,t),this.qe=this.qe.insert(t.key,this.st(t.key).add(e))}Ue(e,t,n){if(!this.ze(e))return;const a=this.Ge(e);this.it(e,t)?a.Fe(t,1):a.Me(t),this.qe=this.qe.insert(t,this.st(t).delete(e)),n&&(this.ke=this.ke.insert(t,n))}removeTarget(e){this.Be.delete(e)}Ye(e){const t=this.Ge(e).ve();return this.Le.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}xe(e){this.Ge(e).xe()}Ge(e){let t=this.Be.get(e);return t||(t=new vu,this.Be.set(e,t)),t}st(e){let t=this.qe.get(e);return t||(t=new qt(ot),this.qe=this.qe.insert(e,t)),t}ze(e){const t=this.Je(e)!==null;return t||$e("WatchChangeAggregator","Detected inactive target",e),t}Je(e){const t=this.Be.get(e);return t&&t.Se?null:this.Le.ot(e)}je(e){this.Be.set(e,new vu),this.Le.getRemoteKeysForTarget(e).forEach(t=>{this.Ue(e,t,null)})}it(e,t){return this.Le.getRemoteKeysForTarget(e).has(t)}}function wu(){return new wt(Le.comparator)}function ku(){return new wt(Le.comparator)}const yb={asc:"ASCENDING",desc:"DESCENDING"},bb={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},vb={and:"AND",or:"OR"};class wb{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function _l(s,e){return s.useProto3Json||io(e)?e:{value:e}}function Oi(s,e){return s.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function Hm(s,e){return s.useProto3Json?e.toBase64():e.toUint8Array()}function kb(s,e){return Oi(s,e.toTimestamp())}function Mr(s){return ut(!!s),Ge.fromTimestamp(function(t){const n=Rs(t);return new Rt(n.seconds,n.nanos)}(s))}function hc(s,e){return El(s,e).canonicalString()}function El(s,e){const t=function(a){return new bt(["projects",a.projectId,"databases",a.database])}(s).child("documents");return e===void 0?t:t.child(e)}function Gm(s){const e=bt.fromString(s);return ut(Jm(e)),e}function Il(s,e){return hc(s.databaseId,e.path)}function Xo(s,e){const t=Gm(e);if(t.get(1)!==s.databaseId.projectId)throw new Ae(he.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+s.databaseId.projectId);if(t.get(3)!==s.databaseId.database)throw new Ae(he.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+s.databaseId.database);return new Le(Ym(t))}function Km(s,e){return hc(s.databaseId,e)}function Nb(s){const e=Gm(s);return e.length===4?bt.emptyPath():Ym(e)}function Tl(s){return new bt(["projects",s.databaseId.projectId,"databases",s.databaseId.database]).canonicalString()}function Ym(s){return ut(s.length>4&&s.get(4)==="documents"),s.popFirst(5)}function Nu(s,e,t){return{name:Il(s,e),fields:t.value.mapValue.fields}}function jb(s,e){let t;if("targetChange"in e){e.targetChange;const n=function(h){return h==="NO_CHANGE"?0:h==="ADD"?1:h==="REMOVE"?2:h==="CURRENT"?3:h==="RESET"?4:We()}(e.targetChange.targetChangeType||"NO_CHANGE"),a=e.targetChange.targetIds||[],i=function(h,m){return h.useProto3Json?(ut(m===void 0||typeof m=="string"),Wt.fromBase64String(m||"")):(ut(m===void 0||m instanceof Buffer||m instanceof Uint8Array),Wt.fromUint8Array(m||new Uint8Array))}(s,e.targetChange.resumeToken),o=e.targetChange.cause,c=o&&function(h){const m=h.code===void 0?he.UNKNOWN:qm(h.code);return new Ae(m,h.message||"")}(o);t=new zm(n,a,i,c||null)}else if("documentChange"in e){e.documentChange;const n=e.documentChange;n.document,n.document.name,n.document.updateTime;const a=Xo(s,n.document.name),i=Mr(n.document.updateTime),o=n.document.createTime?Mr(n.document.createTime):Ge.min(),c=new ur({mapValue:{fields:n.document.fields}}),d=Xt.newFoundDocument(a,i,o,c),h=n.targetIds||[],m=n.removedTargetIds||[];t=new bi(h,m,d.key,d)}else if("documentDelete"in e){e.documentDelete;const n=e.documentDelete;n.document;const a=Xo(s,n.document),i=n.readTime?Mr(n.readTime):Ge.min(),o=Xt.newNoDocument(a,i),c=n.removedTargetIds||[];t=new bi([],c,o.key,o)}else if("documentRemove"in e){e.documentRemove;const n=e.documentRemove;n.document;const a=Xo(s,n.document),i=n.removedTargetIds||[];t=new bi([],i,a,null)}else{if(!("filter"in e))return We();{e.filter;const n=e.filter;n.targetId;const{count:a=0,unchangedNames:i}=n,o=new mb(a,i),c=n.targetId;t=new Wm(c,o)}}return t}function _b(s,e){let t;if(e instanceof Oa)t={update:Nu(s,e.key,e.value)};else if(e instanceof cc)t={delete:Il(s,e.key)};else if(e instanceof Os)t={update:Nu(s,e.key,e.data),updateMask:Rb(e.fieldMask)};else{if(!(e instanceof db))return We();t={verify:Il(s,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(n=>function(i,o){const c=o.transform;if(c instanceof Pi)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(c instanceof Na)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:c.elements}};if(c instanceof ja)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:c.elements}};if(c instanceof Mi)return{fieldPath:o.field.canonicalString(),increment:c.Pe};throw We()}(0,n))),e.precondition.isNone||(t.currentDocument=function(a,i){return i.updateTime!==void 0?{updateTime:kb(a,i.updateTime)}:i.exists!==void 0?{exists:i.exists}:We()}(s,e.precondition)),t}function Eb(s,e){return s&&s.length>0?(ut(e!==void 0),s.map(t=>function(a,i){let o=a.updateTime?Mr(a.updateTime):Mr(i);return o.isEqual(Ge.min())&&(o=Mr(i)),new ob(o,a.transformResults||[])}(t,e))):[]}function Ib(s,e){return{documents:[Km(s,e.path)]}}function Tb(s,e){const t={structuredQuery:{}},n=e.path;let a;e.collectionGroup!==null?(a=n,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(a=n.popLast(),t.structuredQuery.from=[{collectionId:n.lastSegment()}]),t.parent=Km(s,a);const i=function(h){if(h.length!==0)return Xm(Ar.create(h,"and"))}(e.filters);i&&(t.structuredQuery.where=i);const o=function(h){if(h.length!==0)return h.map(m=>function(f){return{field:hn(f.field),direction:Cb(f.dir)}}(m))}(e.orderBy);o&&(t.structuredQuery.orderBy=o);const c=_l(s,e.limit);return c!==null&&(t.structuredQuery.limit=c),e.startAt&&(t.structuredQuery.startAt=function(h){return{before:h.inclusive,values:h.position}}(e.startAt)),e.endAt&&(t.structuredQuery.endAt=function(h){return{before:!h.inclusive,values:h.position}}(e.endAt)),{_t:t,parent:a}}function Sb(s){let e=Nb(s.parent);const t=s.structuredQuery,n=t.from?t.from.length:0;let a=null;if(n>0){ut(n===1);const m=t.from[0];m.allDescendants?a=m.collectionId:e=e.child(m.collectionId)}let i=[];t.where&&(i=function(x){const f=Qm(x);return f instanceof Ar&&Em(f)?f.getFilters():[f]}(t.where));let o=[];t.orderBy&&(o=function(x){return x.map(f=>function(A){return new ka(mn(A.field),function(T){switch(T){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(A.direction))}(f))}(t.orderBy));let c=null;t.limit&&(c=function(x){let f;return f=typeof x=="object"?x.value:x,io(f)?null:f}(t.limit));let d=null;t.startAt&&(d=function(x){const f=!!x.before,k=x.values||[];return new Ri(k,f)}(t.startAt));let h=null;return t.endAt&&(h=function(x){const f=!x.before,k=x.values||[];return new Ri(k,f)}(t.endAt)),Ky(e,a,o,i,c,"F",d,h)}function Ab(s,e){const t=function(a){switch(a){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return We()}}(e.purpose);return t==null?null:{"goog-listen-tags":t}}function Qm(s){return s.unaryFilter!==void 0?function(t){switch(t.unaryFilter.op){case"IS_NAN":const n=mn(t.unaryFilter.field);return Dt.create(n,"==",{doubleValue:NaN});case"IS_NULL":const a=mn(t.unaryFilter.field);return Dt.create(a,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const i=mn(t.unaryFilter.field);return Dt.create(i,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const o=mn(t.unaryFilter.field);return Dt.create(o,"!=",{nullValue:"NULL_VALUE"});default:return We()}}(s):s.fieldFilter!==void 0?function(t){return Dt.create(mn(t.fieldFilter.field),function(a){switch(a){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return We()}}(t.fieldFilter.op),t.fieldFilter.value)}(s):s.compositeFilter!==void 0?function(t){return Ar.create(t.compositeFilter.filters.map(n=>Qm(n)),function(a){switch(a){case"AND":return"and";case"OR":return"or";default:return We()}}(t.compositeFilter.op))}(s):We()}function Cb(s){return yb[s]}function Db(s){return bb[s]}function $b(s){return vb[s]}function hn(s){return{fieldPath:s.canonicalString()}}function mn(s){return Ut.fromServerFormat(s.fieldPath)}function Xm(s){return s instanceof Dt?function(t){if(t.op==="=="){if(cu(t.value))return{unaryFilter:{field:hn(t.field),op:"IS_NAN"}};if(lu(t.value))return{unaryFilter:{field:hn(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(cu(t.value))return{unaryFilter:{field:hn(t.field),op:"IS_NOT_NAN"}};if(lu(t.value))return{unaryFilter:{field:hn(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:hn(t.field),op:Db(t.op),value:t.value}}}(s):s instanceof Ar?function(t){const n=t.getFilters().map(a=>Xm(a));return n.length===1?n[0]:{compositeFilter:{op:$b(t.op),filters:n}}}(s):We()}function Rb(s){const e=[];return s.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function Jm(s){return s.length>=4&&s.get(0)==="projects"&&s.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Es{constructor(e,t,n,a,i=Ge.min(),o=Ge.min(),c=Wt.EMPTY_BYTE_STRING,d=null){this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=a,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=c,this.expectedCount=d}withSequenceNumber(e){return new Es(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new Es(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new Es(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new Es(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pb{constructor(e){this.ct=e}}function Mb(s){const e=Sb({parent:s.parent,structuredQuery:s.structuredQuery});return s.limitType==="LAST"?jl(e,e.limit,"L"):e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ob{constructor(){this.un=new Vb}addToCollectionParentIndex(e,t){return this.un.add(t),be.resolve()}getCollectionParents(e,t){return be.resolve(this.un.getEntries(t))}addFieldIndex(e,t){return be.resolve()}deleteFieldIndex(e,t){return be.resolve()}deleteAllFieldIndexes(e){return be.resolve()}createTargetIndexes(e,t){return be.resolve()}getDocumentsMatchingTarget(e,t){return be.resolve(null)}getIndexType(e,t){return be.resolve(0)}getFieldIndexes(e,t){return be.resolve([])}getNextCollectionGroupToUpdate(e){return be.resolve(null)}getMinOffset(e,t){return be.resolve($s.min())}getMinOffsetFromCollectionGroup(e,t){return be.resolve($s.min())}updateCollectionGroup(e,t,n){return be.resolve()}updateIndexEntries(e,t){return be.resolve()}}class Vb{constructor(){this.index={}}add(e){const t=e.lastSegment(),n=e.popLast(),a=this.index[t]||new qt(bt.comparator),i=!a.has(n);return this.index[t]=a.add(n),i}has(e){const t=e.lastSegment(),n=e.popLast(),a=this.index[t];return a&&a.has(n)}getEntries(e){return(this.index[e]||new qt(bt.comparator)).toArray()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class In{constructor(e){this.Ln=e}next(){return this.Ln+=2,this.Ln}static Bn(){return new In(0)}static kn(){return new In(-1)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lb{constructor(){this.changes=new Vn(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,Xt.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const n=this.changes.get(t);return n!==void 0?be.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fb{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ub{constructor(e,t,n,a){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=a}getDocument(e,t){let n=null;return this.documentOverlayCache.getOverlay(e,t).next(a=>(n=a,this.remoteDocumentCache.getEntry(e,t))).next(a=>(n!==null&&da(n.mutation,a,xr.empty(),Rt.now()),a))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(n=>this.getLocalViewOfDocuments(e,n,Xe()).next(()=>n))}getLocalViewOfDocuments(e,t,n=Xe()){const a=qs();return this.populateOverlays(e,a,t).next(()=>this.computeViews(e,t,a,n).next(i=>{let o=na();return i.forEach((c,d)=>{o=o.insert(c,d.overlayedDocument)}),o}))}getOverlayedDocuments(e,t){const n=qs();return this.populateOverlays(e,n,t).next(()=>this.computeViews(e,t,n,Xe()))}populateOverlays(e,t,n){const a=[];return n.forEach(i=>{t.has(i)||a.push(i)}),this.documentOverlayCache.getOverlays(e,a).next(i=>{i.forEach((o,c)=>{t.set(o,c)})})}computeViews(e,t,n,a){let i=cs();const o=ca(),c=function(){return ca()}();return t.forEach((d,h)=>{const m=n.get(h.key);a.has(h.key)&&(m===void 0||m.mutation instanceof Os)?i=i.insert(h.key,h):m!==void 0?(o.set(h.key,m.mutation.getFieldMask()),da(m.mutation,h,m.mutation.getFieldMask(),Rt.now())):o.set(h.key,xr.empty())}),this.recalculateAndSaveOverlays(e,i).next(d=>(d.forEach((h,m)=>o.set(h,m)),t.forEach((h,m)=>{var x;return c.set(h,new Fb(m,(x=o.get(h))!==null&&x!==void 0?x:null))}),c))}recalculateAndSaveOverlays(e,t){const n=ca();let a=new wt((o,c)=>o-c),i=Xe();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(o=>{for(const c of o)c.keys().forEach(d=>{const h=t.get(d);if(h===null)return;let m=n.get(d)||xr.empty();m=c.applyToLocalView(h,m),n.set(d,m);const x=(a.get(c.batchId)||Xe()).add(d);a=a.insert(c.batchId,x)})}).next(()=>{const o=[],c=a.getReverseIterator();for(;c.hasNext();){const d=c.getNext(),h=d.key,m=d.value,x=Pm();m.forEach(f=>{if(!i.has(f)){const k=Um(t.get(f),n.get(f));k!==null&&x.set(f,k),i=i.add(f)}}),o.push(this.documentOverlayCache.saveOverlays(e,h,x))}return be.waitFor(o)}).next(()=>n)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(n=>this.recalculateAndSaveOverlays(e,n))}getDocumentsMatchingQuery(e,t,n,a){return function(o){return Le.isDocumentKey(o.path)&&o.collectionGroup===null&&o.filters.length===0}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):Am(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n,a):this.getDocumentsMatchingCollectionQuery(e,t,n,a)}getNextDocuments(e,t,n,a){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,n,a).next(i=>{const o=a-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,n.largestBatchId,a-i.size):be.resolve(qs());let c=-1,d=i;return o.next(h=>be.forEach(h,(m,x)=>(c<x.largestBatchId&&(c=x.largestBatchId),i.get(m)?be.resolve():this.remoteDocumentCache.getEntry(e,m).next(f=>{d=d.insert(m,f)}))).next(()=>this.populateOverlays(e,h,i)).next(()=>this.computeViews(e,d,h,Xe())).next(m=>({batchId:c,changes:Rm(m)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new Le(t)).next(n=>{let a=na();return n.isFoundDocument()&&(a=a.insert(n.key,n)),a})}getDocumentsMatchingCollectionGroupQuery(e,t,n,a){const i=t.collectionGroup;let o=na();return this.indexManager.getCollectionParents(e,i).next(c=>be.forEach(c,d=>{const h=function(x,f){return new On(f,null,x.explicitOrderBy.slice(),x.filters.slice(),x.limit,x.limitType,x.startAt,x.endAt)}(t,d.child(i));return this.getDocumentsMatchingCollectionQuery(e,h,n,a).next(m=>{m.forEach((x,f)=>{o=o.insert(x,f)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(e,t,n,a){let i;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,n.largestBatchId).next(o=>(i=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,n,i,a))).next(o=>{i.forEach((d,h)=>{const m=h.getKey();o.get(m)===null&&(o=o.insert(m,Xt.newInvalidDocument(m)))});let c=na();return o.forEach((d,h)=>{const m=i.get(d);m!==void 0&&da(m.mutation,h,xr.empty(),Rt.now()),lo(t,h)&&(c=c.insert(d,h))}),c})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bb{constructor(e){this.serializer=e,this.hr=new Map,this.Pr=new Map}getBundleMetadata(e,t){return be.resolve(this.hr.get(t))}saveBundleMetadata(e,t){return this.hr.set(t.id,function(a){return{id:a.id,version:a.version,createTime:Mr(a.createTime)}}(t)),be.resolve()}getNamedQuery(e,t){return be.resolve(this.Pr.get(t))}saveNamedQuery(e,t){return this.Pr.set(t.name,function(a){return{name:a.name,query:Mb(a.bundledQuery),readTime:Mr(a.readTime)}}(t)),be.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qb{constructor(){this.overlays=new wt(Le.comparator),this.Ir=new Map}getOverlay(e,t){return be.resolve(this.overlays.get(t))}getOverlays(e,t){const n=qs();return be.forEach(t,a=>this.getOverlay(e,a).next(i=>{i!==null&&n.set(a,i)})).next(()=>n)}saveOverlays(e,t,n){return n.forEach((a,i)=>{this.ht(e,t,i)}),be.resolve()}removeOverlaysForBatchId(e,t,n){const a=this.Ir.get(n);return a!==void 0&&(a.forEach(i=>this.overlays=this.overlays.remove(i)),this.Ir.delete(n)),be.resolve()}getOverlaysForCollection(e,t,n){const a=qs(),i=t.length+1,o=new Le(t.child("")),c=this.overlays.getIteratorFrom(o);for(;c.hasNext();){const d=c.getNext().value,h=d.getKey();if(!t.isPrefixOf(h.path))break;h.path.length===i&&d.largestBatchId>n&&a.set(d.getKey(),d)}return be.resolve(a)}getOverlaysForCollectionGroup(e,t,n,a){let i=new wt((h,m)=>h-m);const o=this.overlays.getIterator();for(;o.hasNext();){const h=o.getNext().value;if(h.getKey().getCollectionGroup()===t&&h.largestBatchId>n){let m=i.get(h.largestBatchId);m===null&&(m=qs(),i=i.insert(h.largestBatchId,m)),m.set(h.getKey(),h)}}const c=qs(),d=i.getIterator();for(;d.hasNext()&&(d.getNext().value.forEach((h,m)=>c.set(h,m)),!(c.size()>=a)););return be.resolve(c)}ht(e,t,n){const a=this.overlays.get(n.key);if(a!==null){const o=this.Ir.get(a.largestBatchId).delete(n.key);this.Ir.set(a.largestBatchId,o)}this.overlays=this.overlays.insert(n.key,new hb(t,n));let i=this.Ir.get(t);i===void 0&&(i=Xe(),this.Ir.set(t,i)),this.Ir.set(t,i.add(n.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wb{constructor(){this.sessionToken=Wt.EMPTY_BYTE_STRING}getSessionToken(e){return be.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,be.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mc{constructor(){this.Tr=new qt(Mt.Er),this.dr=new qt(Mt.Ar)}isEmpty(){return this.Tr.isEmpty()}addReference(e,t){const n=new Mt(e,t);this.Tr=this.Tr.add(n),this.dr=this.dr.add(n)}Rr(e,t){e.forEach(n=>this.addReference(n,t))}removeReference(e,t){this.Vr(new Mt(e,t))}mr(e,t){e.forEach(n=>this.removeReference(n,t))}gr(e){const t=new Le(new bt([])),n=new Mt(t,e),a=new Mt(t,e+1),i=[];return this.dr.forEachInRange([n,a],o=>{this.Vr(o),i.push(o.key)}),i}pr(){this.Tr.forEach(e=>this.Vr(e))}Vr(e){this.Tr=this.Tr.delete(e),this.dr=this.dr.delete(e)}yr(e){const t=new Le(new bt([])),n=new Mt(t,e),a=new Mt(t,e+1);let i=Xe();return this.dr.forEachInRange([n,a],o=>{i=i.add(o.key)}),i}containsKey(e){const t=new Mt(e,0),n=this.Tr.firstAfterOrEqual(t);return n!==null&&e.isEqual(n.key)}}class Mt{constructor(e,t){this.key=e,this.wr=t}static Er(e,t){return Le.comparator(e.key,t.key)||ot(e.wr,t.wr)}static Ar(e,t){return ot(e.wr,t.wr)||Le.comparator(e.key,t.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zb{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.Sr=1,this.br=new qt(Mt.Er)}checkEmpty(e){return be.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,n,a){const i=this.Sr;this.Sr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const o=new ub(i,t,n,a);this.mutationQueue.push(o);for(const c of a)this.br=this.br.add(new Mt(c.key,i)),this.indexManager.addToCollectionParentIndex(e,c.key.path.popLast());return be.resolve(o)}lookupMutationBatch(e,t){return be.resolve(this.Dr(t))}getNextMutationBatchAfterBatchId(e,t){const n=t+1,a=this.vr(n),i=a<0?0:a;return be.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return be.resolve(this.mutationQueue.length===0?-1:this.Sr-1)}getAllMutationBatches(e){return be.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const n=new Mt(t,0),a=new Mt(t,Number.POSITIVE_INFINITY),i=[];return this.br.forEachInRange([n,a],o=>{const c=this.Dr(o.wr);i.push(c)}),be.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new qt(ot);return t.forEach(a=>{const i=new Mt(a,0),o=new Mt(a,Number.POSITIVE_INFINITY);this.br.forEachInRange([i,o],c=>{n=n.add(c.wr)})}),be.resolve(this.Cr(n))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,a=n.length+1;let i=n;Le.isDocumentKey(i)||(i=i.child(""));const o=new Mt(new Le(i),0);let c=new qt(ot);return this.br.forEachWhile(d=>{const h=d.key.path;return!!n.isPrefixOf(h)&&(h.length===a&&(c=c.add(d.wr)),!0)},o),be.resolve(this.Cr(c))}Cr(e){const t=[];return e.forEach(n=>{const a=this.Dr(n);a!==null&&t.push(a)}),t}removeMutationBatch(e,t){ut(this.Fr(t.batchId,"removed")===0),this.mutationQueue.shift();let n=this.br;return be.forEach(t.mutations,a=>{const i=new Mt(a.key,t.batchId);return n=n.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,a.key)}).next(()=>{this.br=n})}On(e){}containsKey(e,t){const n=new Mt(t,0),a=this.br.firstAfterOrEqual(n);return be.resolve(t.isEqual(a&&a.key))}performConsistencyCheck(e){return this.mutationQueue.length,be.resolve()}Fr(e,t){return this.vr(e)}vr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Dr(e){const t=this.vr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hb{constructor(e){this.Mr=e,this.docs=function(){return new wt(Le.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const n=t.key,a=this.docs.get(n),i=a?a.size:0,o=this.Mr(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:o}),this.size+=o-i,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const n=this.docs.get(t);return be.resolve(n?n.document.mutableCopy():Xt.newInvalidDocument(t))}getEntries(e,t){let n=cs();return t.forEach(a=>{const i=this.docs.get(a);n=n.insert(a,i?i.document.mutableCopy():Xt.newInvalidDocument(a))}),be.resolve(n)}getDocumentsMatchingQuery(e,t,n,a){let i=cs();const o=t.path,c=new Le(o.child("")),d=this.docs.getIteratorFrom(c);for(;d.hasNext();){const{key:h,value:{document:m}}=d.getNext();if(!o.isPrefixOf(h.path))break;h.path.length>o.length+1||Sy(Ty(m),n)<=0||(a.has(m.key)||lo(t,m))&&(i=i.insert(m.key,m.mutableCopy()))}return be.resolve(i)}getAllFromCollectionGroup(e,t,n,a){We()}Or(e,t){return be.forEach(this.docs,n=>t(n))}newChangeBuffer(e){return new Gb(this)}getSize(e){return be.resolve(this.size)}}class Gb extends Lb{constructor(e){super(),this.cr=e}applyChanges(e){const t=[];return this.changes.forEach((n,a)=>{a.isValidDocument()?t.push(this.cr.addEntry(e,a)):this.cr.removeEntry(n)}),be.waitFor(t)}getFromCache(e,t){return this.cr.getEntry(e,t)}getAllFromCache(e,t){return this.cr.getEntries(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kb{constructor(e){this.persistence=e,this.Nr=new Vn(t=>ac(t),ic),this.lastRemoteSnapshotVersion=Ge.min(),this.highestTargetId=0,this.Lr=0,this.Br=new mc,this.targetCount=0,this.kr=In.Bn()}forEachTarget(e,t){return this.Nr.forEach((n,a)=>t(a)),be.resolve()}getLastRemoteSnapshotVersion(e){return be.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return be.resolve(this.Lr)}allocateTargetId(e){return this.highestTargetId=this.kr.next(),be.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.Lr&&(this.Lr=t),be.resolve()}Kn(e){this.Nr.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.kr=new In(t),this.highestTargetId=t),e.sequenceNumber>this.Lr&&(this.Lr=e.sequenceNumber)}addTargetData(e,t){return this.Kn(t),this.targetCount+=1,be.resolve()}updateTargetData(e,t){return this.Kn(t),be.resolve()}removeTargetData(e,t){return this.Nr.delete(t.target),this.Br.gr(t.targetId),this.targetCount-=1,be.resolve()}removeTargets(e,t,n){let a=0;const i=[];return this.Nr.forEach((o,c)=>{c.sequenceNumber<=t&&n.get(c.targetId)===null&&(this.Nr.delete(o),i.push(this.removeMatchingKeysForTargetId(e,c.targetId)),a++)}),be.waitFor(i).next(()=>a)}getTargetCount(e){return be.resolve(this.targetCount)}getTargetData(e,t){const n=this.Nr.get(t)||null;return be.resolve(n)}addMatchingKeys(e,t,n){return this.Br.Rr(t,n),be.resolve()}removeMatchingKeys(e,t,n){this.Br.mr(t,n);const a=this.persistence.referenceDelegate,i=[];return a&&t.forEach(o=>{i.push(a.markPotentiallyOrphaned(e,o))}),be.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this.Br.gr(t),be.resolve()}getMatchingKeysForTargetId(e,t){const n=this.Br.yr(t);return be.resolve(n)}containsKey(e,t){return be.resolve(this.Br.containsKey(t))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yb{constructor(e,t){this.qr={},this.overlays={},this.Qr=new tc(0),this.Kr=!1,this.Kr=!0,this.$r=new Wb,this.referenceDelegate=e(this),this.Ur=new Kb(this),this.indexManager=new Ob,this.remoteDocumentCache=function(a){return new Hb(a)}(n=>this.referenceDelegate.Wr(n)),this.serializer=new Pb(t),this.Gr=new Bb(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Kr=!1,Promise.resolve()}get started(){return this.Kr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new qb,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this.qr[e.toKey()];return n||(n=new zb(t,this.referenceDelegate),this.qr[e.toKey()]=n),n}getGlobalsCache(){return this.$r}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Gr}runTransaction(e,t,n){$e("MemoryPersistence","Starting transaction:",e);const a=new Qb(this.Qr.next());return this.referenceDelegate.zr(),n(a).next(i=>this.referenceDelegate.jr(a).next(()=>i)).toPromise().then(i=>(a.raiseOnCommittedEvent(),i))}Hr(e,t){return be.or(Object.values(this.qr).map(n=>()=>n.containsKey(e,t)))}}class Qb extends Cy{constructor(e){super(),this.currentSequenceNumber=e}}class gc{constructor(e){this.persistence=e,this.Jr=new mc,this.Yr=null}static Zr(e){return new gc(e)}get Xr(){if(this.Yr)return this.Yr;throw We()}addReference(e,t,n){return this.Jr.addReference(n,t),this.Xr.delete(n.toString()),be.resolve()}removeReference(e,t,n){return this.Jr.removeReference(n,t),this.Xr.add(n.toString()),be.resolve()}markPotentiallyOrphaned(e,t){return this.Xr.add(t.toString()),be.resolve()}removeTarget(e,t){this.Jr.gr(t.targetId).forEach(a=>this.Xr.add(a.toString()));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next(a=>{a.forEach(i=>this.Xr.add(i.toString()))}).next(()=>n.removeTargetData(e,t))}zr(){this.Yr=new Set}jr(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return be.forEach(this.Xr,n=>{const a=Le.fromPath(n);return this.ei(e,a).next(i=>{i||t.removeEntry(a,Ge.min())})}).next(()=>(this.Yr=null,t.apply(e)))}updateLimboDocument(e,t){return this.ei(e,t).next(n=>{n?this.Xr.delete(t.toString()):this.Xr.add(t.toString())})}Wr(e){return 0}ei(e,t){return be.or([()=>be.resolve(this.Jr.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Hr(e,t)])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pc{constructor(e,t,n,a){this.targetId=e,this.fromCache=t,this.$i=n,this.Ui=a}static Wi(e,t){let n=Xe(),a=Xe();for(const i of t.docChanges)switch(i.type){case 0:n=n.add(i.doc.key);break;case 1:a=a.add(i.doc.key)}return new pc(e,t.fromCache,n,a)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xb{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jb{constructor(){this.Gi=!1,this.zi=!1,this.ji=100,this.Hi=function(){return ef()?8:Dy(Jt())>0?6:4}()}initialize(e,t){this.Ji=e,this.indexManager=t,this.Gi=!0}getDocumentsMatchingQuery(e,t,n,a){const i={result:null};return this.Yi(e,t).next(o=>{i.result=o}).next(()=>{if(!i.result)return this.Zi(e,t,a,n).next(o=>{i.result=o})}).next(()=>{if(i.result)return;const o=new Xb;return this.Xi(e,t,o).next(c=>{if(i.result=c,this.zi)return this.es(e,t,o,c.size)})}).next(()=>i.result)}es(e,t,n,a){return n.documentReadCount<this.ji?(Jn()<=tt.DEBUG&&$e("QueryEngine","SDK will not create cache indexes for query:",un(t),"since it only creates cache indexes for collection contains","more than or equal to",this.ji,"documents"),be.resolve()):(Jn()<=tt.DEBUG&&$e("QueryEngine","Query:",un(t),"scans",n.documentReadCount,"local documents and returns",a,"documents as results."),n.documentReadCount>this.Hi*a?(Jn()<=tt.DEBUG&&$e("QueryEngine","The SDK decides to create cache indexes for query:",un(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Pr(t))):be.resolve())}Yi(e,t){if(mu(t))return be.resolve(null);let n=Pr(t);return this.indexManager.getIndexType(e,n).next(a=>a===0?null:(t.limit!==null&&a===1&&(t=jl(t,null,"F"),n=Pr(t)),this.indexManager.getDocumentsMatchingTarget(e,n).next(i=>{const o=Xe(...i);return this.Ji.getDocuments(e,o).next(c=>this.indexManager.getMinOffset(e,n).next(d=>{const h=this.ts(t,c);return this.ns(t,h,o,d.readTime)?this.Yi(e,jl(t,null,"F")):this.rs(e,h,t,d)}))})))}Zi(e,t,n,a){return mu(t)||a.isEqual(Ge.min())?be.resolve(null):this.Ji.getDocuments(e,n).next(i=>{const o=this.ts(t,i);return this.ns(t,o,n,a)?be.resolve(null):(Jn()<=tt.DEBUG&&$e("QueryEngine","Re-using previous result from %s to execute query: %s",a.toString(),un(t)),this.rs(e,o,t,Iy(a,-1)).next(c=>c))})}ts(e,t){let n=new qt(Dm(e));return t.forEach((a,i)=>{lo(e,i)&&(n=n.add(i))}),n}ns(e,t,n,a){if(e.limit===null)return!1;if(n.size!==t.size)return!0;const i=e.limitType==="F"?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(a)>0)}Xi(e,t,n){return Jn()<=tt.DEBUG&&$e("QueryEngine","Using full collection scan to execute query:",un(t)),this.Ji.getDocumentsMatchingQuery(e,t,$s.min(),n)}rs(e,t,n,a){return this.Ji.getDocumentsMatchingQuery(e,n,a).next(i=>(t.forEach(o=>{i=i.insert(o.key,o)}),i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zb{constructor(e,t,n,a){this.persistence=e,this.ss=t,this.serializer=a,this.os=new wt(ot),this._s=new Vn(i=>ac(i),ic),this.us=new Map,this.cs=e.getRemoteDocumentCache(),this.Ur=e.getTargetCache(),this.Gr=e.getBundleCache(),this.ls(n)}ls(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new Ub(this.cs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.cs.setIndexManager(this.indexManager),this.ss.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.os))}}function ev(s,e,t,n){return new Zb(s,e,t,n)}async function Zm(s,e){const t=Ke(s);return await t.persistence.runTransaction("Handle user change","readonly",n=>{let a;return t.mutationQueue.getAllMutationBatches(n).next(i=>(a=i,t.ls(e),t.mutationQueue.getAllMutationBatches(n))).next(i=>{const o=[],c=[];let d=Xe();for(const h of a){o.push(h.batchId);for(const m of h.mutations)d=d.add(m.key)}for(const h of i){c.push(h.batchId);for(const m of h.mutations)d=d.add(m.key)}return t.localDocuments.getDocuments(n,d).next(h=>({hs:h,removedBatchIds:o,addedBatchIds:c}))})})}function tv(s,e){const t=Ke(s);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",n=>{const a=e.batch.keys(),i=t.cs.newChangeBuffer({trackRemovals:!0});return function(c,d,h,m){const x=h.batch,f=x.keys();let k=be.resolve();return f.forEach(A=>{k=k.next(()=>m.getEntry(d,A)).next(D=>{const T=h.docVersions.get(A);ut(T!==null),D.version.compareTo(T)<0&&(x.applyToRemoteDocument(D,h),D.isValidDocument()&&(D.setReadTime(h.commitVersion),m.addEntry(D)))})}),k.next(()=>c.mutationQueue.removeMutationBatch(d,x))}(t,n,e,i).next(()=>i.apply(n)).next(()=>t.mutationQueue.performConsistencyCheck(n)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(n,a,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(n,function(c){let d=Xe();for(let h=0;h<c.mutationResults.length;++h)c.mutationResults[h].transformResults.length>0&&(d=d.add(c.batch.mutations[h].key));return d}(e))).next(()=>t.localDocuments.getDocuments(n,a))})}function eg(s){const e=Ke(s);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Ur.getLastRemoteSnapshotVersion(t))}function rv(s,e){const t=Ke(s),n=e.snapshotVersion;let a=t.os;return t.persistence.runTransaction("Apply remote event","readwrite-primary",i=>{const o=t.cs.newChangeBuffer({trackRemovals:!0});a=t.os;const c=[];e.targetChanges.forEach((m,x)=>{const f=a.get(x);if(!f)return;c.push(t.Ur.removeMatchingKeys(i,m.removedDocuments,x).next(()=>t.Ur.addMatchingKeys(i,m.addedDocuments,x)));let k=f.withSequenceNumber(i.currentSequenceNumber);e.targetMismatches.get(x)!==null?k=k.withResumeToken(Wt.EMPTY_BYTE_STRING,Ge.min()).withLastLimboFreeSnapshotVersion(Ge.min()):m.resumeToken.approximateByteSize()>0&&(k=k.withResumeToken(m.resumeToken,n)),a=a.insert(x,k),function(D,T,H){return D.resumeToken.approximateByteSize()===0||T.snapshotVersion.toMicroseconds()-D.snapshotVersion.toMicroseconds()>=3e8?!0:H.addedDocuments.size+H.modifiedDocuments.size+H.removedDocuments.size>0}(f,k,m)&&c.push(t.Ur.updateTargetData(i,k))});let d=cs(),h=Xe();if(e.documentUpdates.forEach(m=>{e.resolvedLimboDocuments.has(m)&&c.push(t.persistence.referenceDelegate.updateLimboDocument(i,m))}),c.push(sv(i,o,e.documentUpdates).next(m=>{d=m.Ps,h=m.Is})),!n.isEqual(Ge.min())){const m=t.Ur.getLastRemoteSnapshotVersion(i).next(x=>t.Ur.setTargetsMetadata(i,i.currentSequenceNumber,n));c.push(m)}return be.waitFor(c).next(()=>o.apply(i)).next(()=>t.localDocuments.getLocalViewOfDocuments(i,d,h)).next(()=>d)}).then(i=>(t.os=a,i))}function sv(s,e,t){let n=Xe(),a=Xe();return t.forEach(i=>n=n.add(i)),e.getEntries(s,n).next(i=>{let o=cs();return t.forEach((c,d)=>{const h=i.get(c);d.isFoundDocument()!==h.isFoundDocument()&&(a=a.add(c)),d.isNoDocument()&&d.version.isEqual(Ge.min())?(e.removeEntry(c,d.readTime),o=o.insert(c,d)):!h.isValidDocument()||d.version.compareTo(h.version)>0||d.version.compareTo(h.version)===0&&h.hasPendingWrites?(e.addEntry(d),o=o.insert(c,d)):$e("LocalStore","Ignoring outdated watch update for ",c,". Current version:",h.version," Watch version:",d.version)}),{Ps:o,Is:a}})}function nv(s,e){const t=Ke(s);return t.persistence.runTransaction("Get next mutation batch","readonly",n=>(e===void 0&&(e=-1),t.mutationQueue.getNextMutationBatchAfterBatchId(n,e)))}function av(s,e){const t=Ke(s);return t.persistence.runTransaction("Allocate target","readwrite",n=>{let a;return t.Ur.getTargetData(n,e).next(i=>i?(a=i,be.resolve(a)):t.Ur.allocateTargetId(n).next(o=>(a=new Es(e,o,"TargetPurposeListen",n.currentSequenceNumber),t.Ur.addTargetData(n,a).next(()=>a))))}).then(n=>{const a=t.os.get(n.targetId);return(a===null||n.snapshotVersion.compareTo(a.snapshotVersion)>0)&&(t.os=t.os.insert(n.targetId,n),t._s.set(e,n.targetId)),n})}async function Sl(s,e,t){const n=Ke(s),a=n.os.get(e),i=t?"readwrite":"readwrite-primary";try{t||await n.persistence.runTransaction("Release target",i,o=>n.persistence.referenceDelegate.removeTarget(o,a))}catch(o){if(!Ma(o))throw o;$e("LocalStore",`Failed to update sequence numbers for target ${e}: ${o}`)}n.os=n.os.remove(e),n._s.delete(a.target)}function ju(s,e,t){const n=Ke(s);let a=Ge.min(),i=Xe();return n.persistence.runTransaction("Execute query","readwrite",o=>function(d,h,m){const x=Ke(d),f=x._s.get(m);return f!==void 0?be.resolve(x.os.get(f)):x.Ur.getTargetData(h,m)}(n,o,Pr(e)).next(c=>{if(c)return a=c.lastLimboFreeSnapshotVersion,n.Ur.getMatchingKeysForTargetId(o,c.targetId).next(d=>{i=d})}).next(()=>n.ss.getDocumentsMatchingQuery(o,e,t?a:Ge.min(),t?i:Xe())).next(c=>(iv(n,Qy(e),c),{documents:c,Ts:i})))}function iv(s,e,t){let n=s.us.get(e)||Ge.min();t.forEach((a,i)=>{i.readTime.compareTo(n)>0&&(n=i.readTime)}),s.us.set(e,n)}class _u{constructor(){this.activeTargetIds=rb()}fs(e){this.activeTargetIds=this.activeTargetIds.add(e)}gs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Vs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class ov{constructor(){this.so=new _u,this.oo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e,t=!0){return t&&this.so.fs(e),this.oo[e]||"not-current"}updateQueryState(e,t,n){this.oo[e]=t}removeLocalQueryTarget(e){this.so.gs(e)}isLocalQueryTarget(e){return this.so.activeTargetIds.has(e)}clearQueryState(e){delete this.oo[e]}getAllActiveQueryTargets(){return this.so.activeTargetIds}isActiveQueryTarget(e){return this.so.activeTargetIds.has(e)}start(){return this.so=new _u,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lv{_o(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Eu{constructor(){this.ao=()=>this.uo(),this.co=()=>this.lo(),this.ho=[],this.Po()}_o(e){this.ho.push(e)}shutdown(){window.removeEventListener("online",this.ao),window.removeEventListener("offline",this.co)}Po(){window.addEventListener("online",this.ao),window.addEventListener("offline",this.co)}uo(){$e("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.ho)e(0)}lo(){$e("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.ho)e(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let li=null;function Jo(){return li===null?li=function(){return 268435456+Math.round(2147483648*Math.random())}():li++,"0x"+li.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cv={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dv{constructor(e){this.Io=e.Io,this.To=e.To}Eo(e){this.Ao=e}Ro(e){this.Vo=e}mo(e){this.fo=e}onMessage(e){this.po=e}close(){this.To()}send(e){this.Io(e)}yo(){this.Ao()}wo(){this.Vo()}So(e){this.fo(e)}bo(e){this.po(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Kt="WebChannelConnection";class uv extends class{constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const n=t.ssl?"https":"http",a=encodeURIComponent(this.databaseId.projectId),i=encodeURIComponent(this.databaseId.database);this.Do=n+"://"+t.host,this.vo=`projects/${a}/databases/${i}`,this.Co=this.databaseId.database==="(default)"?`project_id=${a}`:`project_id=${a}&database_id=${i}`}get Fo(){return!1}Mo(t,n,a,i,o){const c=Jo(),d=this.xo(t,n.toUriEncodedString());$e("RestConnection",`Sending RPC '${t}' ${c}:`,d,a);const h={"google-cloud-resource-prefix":this.vo,"x-goog-request-params":this.Co};return this.Oo(h,i,o),this.No(t,d,h,a).then(m=>($e("RestConnection",`Received RPC '${t}' ${c}: `,m),m),m=>{throw Nn("RestConnection",`RPC '${t}' ${c} failed with error: `,m,"url: ",d,"request:",a),m})}Lo(t,n,a,i,o,c){return this.Mo(t,n,a,i,o)}Oo(t,n,a){t["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+Mn}(),t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),n&&n.headers.forEach((i,o)=>t[o]=i),a&&a.headers.forEach((i,o)=>t[o]=i)}xo(t,n){const a=cv[t];return`${this.Do}/v1/${n}:${a}`}terminate(){}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}No(e,t,n,a){const i=Jo();return new Promise((o,c)=>{const d=new gm;d.setWithCredentials(!0),d.listenOnce(pm.COMPLETE,()=>{try{switch(d.getLastErrorCode()){case xi.NO_ERROR:const m=d.getResponseJson();$e(Kt,`XHR for RPC '${e}' ${i} received:`,JSON.stringify(m)),o(m);break;case xi.TIMEOUT:$e(Kt,`RPC '${e}' ${i} timed out`),c(new Ae(he.DEADLINE_EXCEEDED,"Request time out"));break;case xi.HTTP_ERROR:const x=d.getStatus();if($e(Kt,`RPC '${e}' ${i} failed with status:`,x,"response text:",d.getResponseText()),x>0){let f=d.getResponseJson();Array.isArray(f)&&(f=f[0]);const k=f==null?void 0:f.error;if(k&&k.status&&k.message){const A=function(T){const H=T.toLowerCase().replace(/_/g,"-");return Object.values(he).indexOf(H)>=0?H:he.UNKNOWN}(k.status);c(new Ae(A,k.message))}else c(new Ae(he.UNKNOWN,"Server responded with status "+d.getStatus()))}else c(new Ae(he.UNAVAILABLE,"Connection failed."));break;default:We()}}finally{$e(Kt,`RPC '${e}' ${i} completed.`)}});const h=JSON.stringify(a);$e(Kt,`RPC '${e}' ${i} sending request:`,a),d.send(t,"POST",h,n,15)})}Bo(e,t,n){const a=Jo(),i=[this.Do,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=ym(),c=fm(),d={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},h=this.longPollingOptions.timeoutSeconds;h!==void 0&&(d.longPollingTimeout=Math.round(1e3*h)),this.useFetchStreams&&(d.useFetchStreams=!0),this.Oo(d.initMessageHeaders,t,n),d.encodeInitMessageHeaders=!0;const m=i.join("");$e(Kt,`Creating RPC '${e}' stream ${a}: ${m}`,d);const x=o.createWebChannel(m,d);let f=!1,k=!1;const A=new dv({Io:T=>{k?$e(Kt,`Not sending because RPC '${e}' stream ${a} is closed:`,T):(f||($e(Kt,`Opening RPC '${e}' stream ${a} transport.`),x.open(),f=!0),$e(Kt,`RPC '${e}' stream ${a} sending:`,T),x.send(T))},To:()=>x.close()}),D=(T,H,L)=>{T.listen(H,E=>{try{L(E)}catch(M){setTimeout(()=>{throw M},0)}})};return D(x,sa.EventType.OPEN,()=>{k||($e(Kt,`RPC '${e}' stream ${a} transport opened.`),A.yo())}),D(x,sa.EventType.CLOSE,()=>{k||(k=!0,$e(Kt,`RPC '${e}' stream ${a} transport closed`),A.So())}),D(x,sa.EventType.ERROR,T=>{k||(k=!0,Nn(Kt,`RPC '${e}' stream ${a} transport errored:`,T),A.So(new Ae(he.UNAVAILABLE,"The operation could not be completed")))}),D(x,sa.EventType.MESSAGE,T=>{var H;if(!k){const L=T.data[0];ut(!!L);const E=L,M=E.error||((H=E[0])===null||H===void 0?void 0:H.error);if(M){$e(Kt,`RPC '${e}' stream ${a} received error:`,M);const ee=M.status;let C=function(w){const N=Ct[w];if(N!==void 0)return qm(N)}(ee),v=M.message;C===void 0&&(C=he.INTERNAL,v="Unknown error status: "+ee+" with message "+M.message),k=!0,A.So(new Ae(C,v)),x.close()}else $e(Kt,`RPC '${e}' stream ${a} received:`,L),A.bo(L)}}),D(c,xm.STAT_EVENT,T=>{T.stat===yl.PROXY?$e(Kt,`RPC '${e}' stream ${a} detected buffering proxy`):T.stat===yl.NOPROXY&&$e(Kt,`RPC '${e}' stream ${a} detected no buffering proxy`)}),setTimeout(()=>{A.wo()},0),A}}function Zo(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mo(s){return new wb(s,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tg{constructor(e,t,n=1e3,a=1.5,i=6e4){this.ui=e,this.timerId=t,this.ko=n,this.qo=a,this.Qo=i,this.Ko=0,this.$o=null,this.Uo=Date.now(),this.reset()}reset(){this.Ko=0}Wo(){this.Ko=this.Qo}Go(e){this.cancel();const t=Math.floor(this.Ko+this.zo()),n=Math.max(0,Date.now()-this.Uo),a=Math.max(0,t-n);a>0&&$e("ExponentialBackoff",`Backing off for ${a} ms (base delay: ${this.Ko} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.$o=this.ui.enqueueAfterDelay(this.timerId,a,()=>(this.Uo=Date.now(),e())),this.Ko*=this.qo,this.Ko<this.ko&&(this.Ko=this.ko),this.Ko>this.Qo&&(this.Ko=this.Qo)}jo(){this.$o!==null&&(this.$o.skipDelay(),this.$o=null)}cancel(){this.$o!==null&&(this.$o.cancel(),this.$o=null)}zo(){return(Math.random()-.5)*this.Ko}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rg{constructor(e,t,n,a,i,o,c,d){this.ui=e,this.Ho=n,this.Jo=a,this.connection=i,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=c,this.listener=d,this.state=0,this.Yo=0,this.Zo=null,this.Xo=null,this.stream=null,this.e_=0,this.t_=new tg(e,t)}n_(){return this.state===1||this.state===5||this.r_()}r_(){return this.state===2||this.state===3}start(){this.e_=0,this.state!==4?this.auth():this.i_()}async stop(){this.n_()&&await this.close(0)}s_(){this.state=0,this.t_.reset()}o_(){this.r_()&&this.Zo===null&&(this.Zo=this.ui.enqueueAfterDelay(this.Ho,6e4,()=>this.__()))}a_(e){this.u_(),this.stream.send(e)}async __(){if(this.r_())return this.close(0)}u_(){this.Zo&&(this.Zo.cancel(),this.Zo=null)}c_(){this.Xo&&(this.Xo.cancel(),this.Xo=null)}async close(e,t){this.u_(),this.c_(),this.t_.cancel(),this.Yo++,e!==4?this.t_.reset():t&&t.code===he.RESOURCE_EXHAUSTED?(ls(t.toString()),ls("Using maximum backoff delay to prevent overloading the backend."),this.t_.Wo()):t&&t.code===he.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.l_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.mo(t)}l_(){}auth(){this.state=1;const e=this.h_(this.Yo),t=this.Yo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([n,a])=>{this.Yo===t&&this.P_(n,a)},n=>{e(()=>{const a=new Ae(he.UNKNOWN,"Fetching auth token failed: "+n.message);return this.I_(a)})})}P_(e,t){const n=this.h_(this.Yo);this.stream=this.T_(e,t),this.stream.Eo(()=>{n(()=>this.listener.Eo())}),this.stream.Ro(()=>{n(()=>(this.state=2,this.Xo=this.ui.enqueueAfterDelay(this.Jo,1e4,()=>(this.r_()&&(this.state=3),Promise.resolve())),this.listener.Ro()))}),this.stream.mo(a=>{n(()=>this.I_(a))}),this.stream.onMessage(a=>{n(()=>++this.e_==1?this.E_(a):this.onNext(a))})}i_(){this.state=5,this.t_.Go(async()=>{this.state=0,this.start()})}I_(e){return $e("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}h_(e){return t=>{this.ui.enqueueAndForget(()=>this.Yo===e?t():($e("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class hv extends rg{constructor(e,t,n,a,i,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,a,o),this.serializer=i}T_(e,t){return this.connection.Bo("Listen",e,t)}E_(e){return this.onNext(e)}onNext(e){this.t_.reset();const t=jb(this.serializer,e),n=function(i){if(!("targetChange"in i))return Ge.min();const o=i.targetChange;return o.targetIds&&o.targetIds.length?Ge.min():o.readTime?Mr(o.readTime):Ge.min()}(e);return this.listener.d_(t,n)}A_(e){const t={};t.database=Tl(this.serializer),t.addTarget=function(i,o){let c;const d=o.target;if(c=kl(d)?{documents:Ib(i,d)}:{query:Tb(i,d)._t},c.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){c.resumeToken=Hm(i,o.resumeToken);const h=_l(i,o.expectedCount);h!==null&&(c.expectedCount=h)}else if(o.snapshotVersion.compareTo(Ge.min())>0){c.readTime=Oi(i,o.snapshotVersion.toTimestamp());const h=_l(i,o.expectedCount);h!==null&&(c.expectedCount=h)}return c}(this.serializer,e);const n=Ab(this.serializer,e);n&&(t.labels=n),this.a_(t)}R_(e){const t={};t.database=Tl(this.serializer),t.removeTarget=e,this.a_(t)}}class mv extends rg{constructor(e,t,n,a,i,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,a,o),this.serializer=i}get V_(){return this.e_>0}start(){this.lastStreamToken=void 0,super.start()}l_(){this.V_&&this.m_([])}T_(e,t){return this.connection.Bo("Write",e,t)}E_(e){return ut(!!e.streamToken),this.lastStreamToken=e.streamToken,ut(!e.writeResults||e.writeResults.length===0),this.listener.f_()}onNext(e){ut(!!e.streamToken),this.lastStreamToken=e.streamToken,this.t_.reset();const t=Eb(e.writeResults,e.commitTime),n=Mr(e.commitTime);return this.listener.g_(n,t)}p_(){const e={};e.database=Tl(this.serializer),this.a_(e)}m_(e){const t={streamToken:this.lastStreamToken,writes:e.map(n=>_b(this.serializer,n))};this.a_(t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gv extends class{}{constructor(e,t,n,a){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=n,this.serializer=a,this.y_=!1}w_(){if(this.y_)throw new Ae(he.FAILED_PRECONDITION,"The client has already been terminated.")}Mo(e,t,n,a){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,o])=>this.connection.Mo(e,El(t,n),a,i,o)).catch(i=>{throw i.name==="FirebaseError"?(i.code===he.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),i):new Ae(he.UNKNOWN,i.toString())})}Lo(e,t,n,a,i){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,c])=>this.connection.Lo(e,El(t,n),a,o,c,i)).catch(o=>{throw o.name==="FirebaseError"?(o.code===he.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new Ae(he.UNKNOWN,o.toString())})}terminate(){this.y_=!0,this.connection.terminate()}}class pv{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.S_=0,this.b_=null,this.D_=!0}v_(){this.S_===0&&(this.C_("Unknown"),this.b_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.b_=null,this.F_("Backend didn't respond within 10 seconds."),this.C_("Offline"),Promise.resolve())))}M_(e){this.state==="Online"?this.C_("Unknown"):(this.S_++,this.S_>=1&&(this.x_(),this.F_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.C_("Offline")))}set(e){this.x_(),this.S_=0,e==="Online"&&(this.D_=!1),this.C_(e)}C_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}F_(e){const t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.D_?(ls(t),this.D_=!1):$e("OnlineStateTracker",t)}x_(){this.b_!==null&&(this.b_.cancel(),this.b_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xv{constructor(e,t,n,a,i){this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.O_=[],this.N_=new Map,this.L_=new Set,this.B_=[],this.k_=i,this.k_._o(o=>{n.enqueueAndForget(async()=>{rn(this)&&($e("RemoteStore","Restarting streams for network reachability change."),await async function(d){const h=Ke(d);h.L_.add(4),await La(h),h.q_.set("Unknown"),h.L_.delete(4),await go(h)}(this))})}),this.q_=new pv(n,a)}}async function go(s){if(rn(s))for(const e of s.B_)await e(!0)}async function La(s){for(const e of s.B_)await e(!1)}function sg(s,e){const t=Ke(s);t.N_.has(e.targetId)||(t.N_.set(e.targetId,e),bc(t)?yc(t):Ln(t).r_()&&fc(t,e))}function xc(s,e){const t=Ke(s),n=Ln(t);t.N_.delete(e),n.r_()&&ng(t,e),t.N_.size===0&&(n.r_()?n.o_():rn(t)&&t.q_.set("Unknown"))}function fc(s,e){if(s.Q_.xe(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(Ge.min())>0){const t=s.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}Ln(s).A_(e)}function ng(s,e){s.Q_.xe(e),Ln(s).R_(e)}function yc(s){s.Q_=new fb({getRemoteKeysForTarget:e=>s.remoteSyncer.getRemoteKeysForTarget(e),ot:e=>s.N_.get(e)||null,tt:()=>s.datastore.serializer.databaseId}),Ln(s).start(),s.q_.v_()}function bc(s){return rn(s)&&!Ln(s).n_()&&s.N_.size>0}function rn(s){return Ke(s).L_.size===0}function ag(s){s.Q_=void 0}async function fv(s){s.q_.set("Online")}async function yv(s){s.N_.forEach((e,t)=>{fc(s,e)})}async function bv(s,e){ag(s),bc(s)?(s.q_.M_(e),yc(s)):s.q_.set("Unknown")}async function vv(s,e,t){if(s.q_.set("Online"),e instanceof zm&&e.state===2&&e.cause)try{await async function(a,i){const o=i.cause;for(const c of i.targetIds)a.N_.has(c)&&(await a.remoteSyncer.rejectListen(c,o),a.N_.delete(c),a.Q_.removeTarget(c))}(s,e)}catch(n){$e("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),n),await Vi(s,n)}else if(e instanceof bi?s.Q_.Ke(e):e instanceof Wm?s.Q_.He(e):s.Q_.We(e),!t.isEqual(Ge.min()))try{const n=await eg(s.localStore);t.compareTo(n)>=0&&await function(i,o){const c=i.Q_.rt(o);return c.targetChanges.forEach((d,h)=>{if(d.resumeToken.approximateByteSize()>0){const m=i.N_.get(h);m&&i.N_.set(h,m.withResumeToken(d.resumeToken,o))}}),c.targetMismatches.forEach((d,h)=>{const m=i.N_.get(d);if(!m)return;i.N_.set(d,m.withResumeToken(Wt.EMPTY_BYTE_STRING,m.snapshotVersion)),ng(i,d);const x=new Es(m.target,d,h,m.sequenceNumber);fc(i,x)}),i.remoteSyncer.applyRemoteEvent(c)}(s,t)}catch(n){$e("RemoteStore","Failed to raise snapshot:",n),await Vi(s,n)}}async function Vi(s,e,t){if(!Ma(e))throw e;s.L_.add(1),await La(s),s.q_.set("Offline"),t||(t=()=>eg(s.localStore)),s.asyncQueue.enqueueRetryable(async()=>{$e("RemoteStore","Retrying IndexedDB access"),await t(),s.L_.delete(1),await go(s)})}function ig(s,e){return e().catch(t=>Vi(s,t,e))}async function po(s){const e=Ke(s),t=Ps(e);let n=e.O_.length>0?e.O_[e.O_.length-1].batchId:-1;for(;wv(e);)try{const a=await nv(e.localStore,n);if(a===null){e.O_.length===0&&t.o_();break}n=a.batchId,kv(e,a)}catch(a){await Vi(e,a)}og(e)&&lg(e)}function wv(s){return rn(s)&&s.O_.length<10}function kv(s,e){s.O_.push(e);const t=Ps(s);t.r_()&&t.V_&&t.m_(e.mutations)}function og(s){return rn(s)&&!Ps(s).n_()&&s.O_.length>0}function lg(s){Ps(s).start()}async function Nv(s){Ps(s).p_()}async function jv(s){const e=Ps(s);for(const t of s.O_)e.m_(t.mutations)}async function _v(s,e,t){const n=s.O_.shift(),a=dc.from(n,e,t);await ig(s,()=>s.remoteSyncer.applySuccessfulWrite(a)),await po(s)}async function Ev(s,e){e&&Ps(s).V_&&await async function(n,a){if(function(o){return gb(o)&&o!==he.ABORTED}(a.code)){const i=n.O_.shift();Ps(n).s_(),await ig(n,()=>n.remoteSyncer.rejectFailedWrite(i.batchId,a)),await po(n)}}(s,e),og(s)&&lg(s)}async function Iu(s,e){const t=Ke(s);t.asyncQueue.verifyOperationInProgress(),$e("RemoteStore","RemoteStore received new credentials");const n=rn(t);t.L_.add(3),await La(t),n&&t.q_.set("Unknown"),await t.remoteSyncer.handleCredentialChange(e),t.L_.delete(3),await go(t)}async function Iv(s,e){const t=Ke(s);e?(t.L_.delete(2),await go(t)):e||(t.L_.add(2),await La(t),t.q_.set("Unknown"))}function Ln(s){return s.K_||(s.K_=function(t,n,a){const i=Ke(t);return i.w_(),new hv(n,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,a)}(s.datastore,s.asyncQueue,{Eo:fv.bind(null,s),Ro:yv.bind(null,s),mo:bv.bind(null,s),d_:vv.bind(null,s)}),s.B_.push(async e=>{e?(s.K_.s_(),bc(s)?yc(s):s.q_.set("Unknown")):(await s.K_.stop(),ag(s))})),s.K_}function Ps(s){return s.U_||(s.U_=function(t,n,a){const i=Ke(t);return i.w_(),new mv(n,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,a)}(s.datastore,s.asyncQueue,{Eo:()=>Promise.resolve(),Ro:Nv.bind(null,s),mo:Ev.bind(null,s),f_:jv.bind(null,s),g_:_v.bind(null,s)}),s.B_.push(async e=>{e?(s.U_.s_(),await po(s)):(await s.U_.stop(),s.O_.length>0&&($e("RemoteStore",`Stopping write stream with ${s.O_.length} pending writes`),s.O_=[]))})),s.U_}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vc{constructor(e,t,n,a,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=a,this.removalCallback=i,this.deferred=new rs,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,n,a,i){const o=Date.now()+n,c=new vc(e,t,o,a,i);return c.start(n),c}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new Ae(he.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function wc(s,e){if(ls("AsyncQueue",`${e}: ${s}`),Ma(s))return new Ae(he.UNAVAILABLE,`${e}: ${s}`);throw s}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fn{constructor(e){this.comparator=e?(t,n)=>e(t,n)||Le.comparator(t.key,n.key):(t,n)=>Le.comparator(t.key,n.key),this.keyedMap=na(),this.sortedSet=new wt(this.comparator)}static emptySet(e){return new fn(e.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,n)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof fn)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){const a=t.getNext().key,i=n.getNext().key;if(!a.isEqual(i))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){const n=new fn;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tu{constructor(){this.W_=new wt(Le.comparator)}track(e){const t=e.doc.key,n=this.W_.get(t);n?e.type!==0&&n.type===3?this.W_=this.W_.insert(t,e):e.type===3&&n.type!==1?this.W_=this.W_.insert(t,{type:n.type,doc:e.doc}):e.type===2&&n.type===2?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):e.type===2&&n.type===0?this.W_=this.W_.insert(t,{type:0,doc:e.doc}):e.type===1&&n.type===0?this.W_=this.W_.remove(t):e.type===1&&n.type===2?this.W_=this.W_.insert(t,{type:1,doc:n.doc}):e.type===0&&n.type===1?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):We():this.W_=this.W_.insert(t,e)}G_(){const e=[];return this.W_.inorderTraversal((t,n)=>{e.push(n)}),e}}class Tn{constructor(e,t,n,a,i,o,c,d,h){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=a,this.mutatedKeys=i,this.fromCache=o,this.syncStateChanged=c,this.excludesMetadataChanges=d,this.hasCachedResults=h}static fromInitialDocuments(e,t,n,a,i){const o=[];return t.forEach(c=>{o.push({type:0,doc:c})}),new Tn(e,t,fn.emptySet(t),o,n,a,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&oo(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let a=0;a<t.length;a++)if(t[a].type!==n[a].type||!t[a].doc.isEqual(n[a].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tv{constructor(){this.z_=void 0,this.j_=[]}H_(){return this.j_.some(e=>e.J_())}}class Sv{constructor(){this.queries=Su(),this.onlineState="Unknown",this.Y_=new Set}terminate(){(function(t,n){const a=Ke(t),i=a.queries;a.queries=Su(),i.forEach((o,c)=>{for(const d of c.j_)d.onError(n)})})(this,new Ae(he.ABORTED,"Firestore shutting down"))}}function Su(){return new Vn(s=>Cm(s),oo)}async function cg(s,e){const t=Ke(s);let n=3;const a=e.query;let i=t.queries.get(a);i?!i.H_()&&e.J_()&&(n=2):(i=new Tv,n=e.J_()?0:1);try{switch(n){case 0:i.z_=await t.onListen(a,!0);break;case 1:i.z_=await t.onListen(a,!1);break;case 2:await t.onFirstRemoteStoreListen(a)}}catch(o){const c=wc(o,`Initialization of query '${un(e.query)}' failed`);return void e.onError(c)}t.queries.set(a,i),i.j_.push(e),e.Z_(t.onlineState),i.z_&&e.X_(i.z_)&&kc(t)}async function dg(s,e){const t=Ke(s),n=e.query;let a=3;const i=t.queries.get(n);if(i){const o=i.j_.indexOf(e);o>=0&&(i.j_.splice(o,1),i.j_.length===0?a=e.J_()?0:1:!i.H_()&&e.J_()&&(a=2))}switch(a){case 0:return t.queries.delete(n),t.onUnlisten(n,!0);case 1:return t.queries.delete(n),t.onUnlisten(n,!1);case 2:return t.onLastRemoteStoreUnlisten(n);default:return}}function Av(s,e){const t=Ke(s);let n=!1;for(const a of e){const i=a.query,o=t.queries.get(i);if(o){for(const c of o.j_)c.X_(a)&&(n=!0);o.z_=a}}n&&kc(t)}function Cv(s,e,t){const n=Ke(s),a=n.queries.get(e);if(a)for(const i of a.j_)i.onError(t);n.queries.delete(e)}function kc(s){s.Y_.forEach(e=>{e.next()})}var Al,Au;(Au=Al||(Al={})).ea="default",Au.Cache="cache";class ug{constructor(e,t,n){this.query=e,this.ta=t,this.na=!1,this.ra=null,this.onlineState="Unknown",this.options=n||{}}X_(e){if(!this.options.includeMetadataChanges){const n=[];for(const a of e.docChanges)a.type!==3&&n.push(a);e=new Tn(e.query,e.docs,e.oldDocs,n,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.na?this.ia(e)&&(this.ta.next(e),t=!0):this.sa(e,this.onlineState)&&(this.oa(e),t=!0),this.ra=e,t}onError(e){this.ta.error(e)}Z_(e){this.onlineState=e;let t=!1;return this.ra&&!this.na&&this.sa(this.ra,e)&&(this.oa(this.ra),t=!0),t}sa(e,t){if(!e.fromCache||!this.J_())return!0;const n=t!=="Offline";return(!this.options._a||!n)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}ia(e){if(e.docChanges.length>0)return!0;const t=this.ra&&this.ra.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}oa(e){e=Tn.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.na=!0,this.ta.next(e)}J_(){return this.options.source!==Al.Cache}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hg{constructor(e){this.key=e}}class mg{constructor(e){this.key=e}}class Dv{constructor(e,t){this.query=e,this.Ta=t,this.Ea=null,this.hasCachedResults=!1,this.current=!1,this.da=Xe(),this.mutatedKeys=Xe(),this.Aa=Dm(e),this.Ra=new fn(this.Aa)}get Va(){return this.Ta}ma(e,t){const n=t?t.fa:new Tu,a=t?t.Ra:this.Ra;let i=t?t.mutatedKeys:this.mutatedKeys,o=a,c=!1;const d=this.query.limitType==="F"&&a.size===this.query.limit?a.last():null,h=this.query.limitType==="L"&&a.size===this.query.limit?a.first():null;if(e.inorderTraversal((m,x)=>{const f=a.get(m),k=lo(this.query,x)?x:null,A=!!f&&this.mutatedKeys.has(f.key),D=!!k&&(k.hasLocalMutations||this.mutatedKeys.has(k.key)&&k.hasCommittedMutations);let T=!1;f&&k?f.data.isEqual(k.data)?A!==D&&(n.track({type:3,doc:k}),T=!0):this.ga(f,k)||(n.track({type:2,doc:k}),T=!0,(d&&this.Aa(k,d)>0||h&&this.Aa(k,h)<0)&&(c=!0)):!f&&k?(n.track({type:0,doc:k}),T=!0):f&&!k&&(n.track({type:1,doc:f}),T=!0,(d||h)&&(c=!0)),T&&(k?(o=o.add(k),i=D?i.add(m):i.delete(m)):(o=o.delete(m),i=i.delete(m)))}),this.query.limit!==null)for(;o.size>this.query.limit;){const m=this.query.limitType==="F"?o.last():o.first();o=o.delete(m.key),i=i.delete(m.key),n.track({type:1,doc:m})}return{Ra:o,fa:n,ns:c,mutatedKeys:i}}ga(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n,a){const i=this.Ra;this.Ra=e.Ra,this.mutatedKeys=e.mutatedKeys;const o=e.fa.G_();o.sort((m,x)=>function(k,A){const D=T=>{switch(T){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return We()}};return D(k)-D(A)}(m.type,x.type)||this.Aa(m.doc,x.doc)),this.pa(n),a=a!=null&&a;const c=t&&!a?this.ya():[],d=this.da.size===0&&this.current&&!a?1:0,h=d!==this.Ea;return this.Ea=d,o.length!==0||h?{snapshot:new Tn(this.query,e.Ra,i,o,e.mutatedKeys,d===0,h,!1,!!n&&n.resumeToken.approximateByteSize()>0),wa:c}:{wa:c}}Z_(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({Ra:this.Ra,fa:new Tu,mutatedKeys:this.mutatedKeys,ns:!1},!1)):{wa:[]}}Sa(e){return!this.Ta.has(e)&&!!this.Ra.has(e)&&!this.Ra.get(e).hasLocalMutations}pa(e){e&&(e.addedDocuments.forEach(t=>this.Ta=this.Ta.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.Ta=this.Ta.delete(t)),this.current=e.current)}ya(){if(!this.current)return[];const e=this.da;this.da=Xe(),this.Ra.forEach(n=>{this.Sa(n.key)&&(this.da=this.da.add(n.key))});const t=[];return e.forEach(n=>{this.da.has(n)||t.push(new mg(n))}),this.da.forEach(n=>{e.has(n)||t.push(new hg(n))}),t}ba(e){this.Ta=e.Ts,this.da=Xe();const t=this.ma(e.documents);return this.applyChanges(t,!0)}Da(){return Tn.fromInitialDocuments(this.query,this.Ra,this.mutatedKeys,this.Ea===0,this.hasCachedResults)}}class $v{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}}class Rv{constructor(e){this.key=e,this.va=!1}}class Pv{constructor(e,t,n,a,i,o){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=a,this.currentUser=i,this.maxConcurrentLimboResolutions=o,this.Ca={},this.Fa=new Vn(c=>Cm(c),oo),this.Ma=new Map,this.xa=new Set,this.Oa=new wt(Le.comparator),this.Na=new Map,this.La=new mc,this.Ba={},this.ka=new Map,this.qa=In.kn(),this.onlineState="Unknown",this.Qa=void 0}get isPrimaryClient(){return this.Qa===!0}}async function Mv(s,e,t=!0){const n=bg(s);let a;const i=n.Fa.get(e);return i?(n.sharedClientState.addLocalQueryTarget(i.targetId),a=i.view.Da()):a=await gg(n,e,t,!0),a}async function Ov(s,e){const t=bg(s);await gg(t,e,!0,!1)}async function gg(s,e,t,n){const a=await av(s.localStore,Pr(e)),i=a.targetId,o=s.sharedClientState.addLocalQueryTarget(i,t);let c;return n&&(c=await Vv(s,e,i,o==="current",a.resumeToken)),s.isPrimaryClient&&t&&sg(s.remoteStore,a),c}async function Vv(s,e,t,n,a){s.Ka=(x,f,k)=>async function(D,T,H,L){let E=T.view.ma(H);E.ns&&(E=await ju(D.localStore,T.query,!1).then(({documents:v})=>T.view.ma(v,E)));const M=L&&L.targetChanges.get(T.targetId),ee=L&&L.targetMismatches.get(T.targetId)!=null,C=T.view.applyChanges(E,D.isPrimaryClient,M,ee);return Du(D,T.targetId,C.wa),C.snapshot}(s,x,f,k);const i=await ju(s.localStore,e,!0),o=new Dv(e,i.Ts),c=o.ma(i.documents),d=Va.createSynthesizedTargetChangeForCurrentChange(t,n&&s.onlineState!=="Offline",a),h=o.applyChanges(c,s.isPrimaryClient,d);Du(s,t,h.wa);const m=new $v(e,t,o);return s.Fa.set(e,m),s.Ma.has(t)?s.Ma.get(t).push(e):s.Ma.set(t,[e]),h.snapshot}async function Lv(s,e,t){const n=Ke(s),a=n.Fa.get(e),i=n.Ma.get(a.targetId);if(i.length>1)return n.Ma.set(a.targetId,i.filter(o=>!oo(o,e))),void n.Fa.delete(e);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(a.targetId),n.sharedClientState.isActiveQueryTarget(a.targetId)||await Sl(n.localStore,a.targetId,!1).then(()=>{n.sharedClientState.clearQueryState(a.targetId),t&&xc(n.remoteStore,a.targetId),Cl(n,a.targetId)}).catch(Pa)):(Cl(n,a.targetId),await Sl(n.localStore,a.targetId,!0))}async function Fv(s,e){const t=Ke(s),n=t.Fa.get(e),a=t.Ma.get(n.targetId);t.isPrimaryClient&&a.length===1&&(t.sharedClientState.removeLocalQueryTarget(n.targetId),xc(t.remoteStore,n.targetId))}async function Uv(s,e,t){const n=Kv(s);try{const a=await function(o,c){const d=Ke(o),h=Rt.now(),m=c.reduce((k,A)=>k.add(A.key),Xe());let x,f;return d.persistence.runTransaction("Locally write mutations","readwrite",k=>{let A=cs(),D=Xe();return d.cs.getEntries(k,m).next(T=>{A=T,A.forEach((H,L)=>{L.isValidDocument()||(D=D.add(H))})}).next(()=>d.localDocuments.getOverlayedDocuments(k,A)).next(T=>{x=T;const H=[];for(const L of c){const E=cb(L,x.get(L.key).overlayedDocument);E!=null&&H.push(new Os(L.key,E,Nm(E.value.mapValue),Ir.exists(!0)))}return d.mutationQueue.addMutationBatch(k,h,H,c)}).next(T=>{f=T;const H=T.applyToLocalDocumentSet(x,D);return d.documentOverlayCache.saveOverlays(k,T.batchId,H)})}).then(()=>({batchId:f.batchId,changes:Rm(x)}))}(n.localStore,e);n.sharedClientState.addPendingMutation(a.batchId),function(o,c,d){let h=o.Ba[o.currentUser.toKey()];h||(h=new wt(ot)),h=h.insert(c,d),o.Ba[o.currentUser.toKey()]=h}(n,a.batchId,t),await Fa(n,a.changes),await po(n.remoteStore)}catch(a){const i=wc(a,"Failed to persist write");t.reject(i)}}async function pg(s,e){const t=Ke(s);try{const n=await rv(t.localStore,e);e.targetChanges.forEach((a,i)=>{const o=t.Na.get(i);o&&(ut(a.addedDocuments.size+a.modifiedDocuments.size+a.removedDocuments.size<=1),a.addedDocuments.size>0?o.va=!0:a.modifiedDocuments.size>0?ut(o.va):a.removedDocuments.size>0&&(ut(o.va),o.va=!1))}),await Fa(t,n,e)}catch(n){await Pa(n)}}function Cu(s,e,t){const n=Ke(s);if(n.isPrimaryClient&&t===0||!n.isPrimaryClient&&t===1){const a=[];n.Fa.forEach((i,o)=>{const c=o.view.Z_(e);c.snapshot&&a.push(c.snapshot)}),function(o,c){const d=Ke(o);d.onlineState=c;let h=!1;d.queries.forEach((m,x)=>{for(const f of x.j_)f.Z_(c)&&(h=!0)}),h&&kc(d)}(n.eventManager,e),a.length&&n.Ca.d_(a),n.onlineState=e,n.isPrimaryClient&&n.sharedClientState.setOnlineState(e)}}async function Bv(s,e,t){const n=Ke(s);n.sharedClientState.updateQueryState(e,"rejected",t);const a=n.Na.get(e),i=a&&a.key;if(i){let o=new wt(Le.comparator);o=o.insert(i,Xt.newNoDocument(i,Ge.min()));const c=Xe().add(i),d=new ho(Ge.min(),new Map,new wt(ot),o,c);await pg(n,d),n.Oa=n.Oa.remove(i),n.Na.delete(e),Nc(n)}else await Sl(n.localStore,e,!1).then(()=>Cl(n,e,t)).catch(Pa)}async function qv(s,e){const t=Ke(s),n=e.batch.batchId;try{const a=await tv(t.localStore,e);fg(t,n,null),xg(t,n),t.sharedClientState.updateMutationState(n,"acknowledged"),await Fa(t,a)}catch(a){await Pa(a)}}async function Wv(s,e,t){const n=Ke(s);try{const a=await function(o,c){const d=Ke(o);return d.persistence.runTransaction("Reject batch","readwrite-primary",h=>{let m;return d.mutationQueue.lookupMutationBatch(h,c).next(x=>(ut(x!==null),m=x.keys(),d.mutationQueue.removeMutationBatch(h,x))).next(()=>d.mutationQueue.performConsistencyCheck(h)).next(()=>d.documentOverlayCache.removeOverlaysForBatchId(h,m,c)).next(()=>d.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(h,m)).next(()=>d.localDocuments.getDocuments(h,m))})}(n.localStore,e);fg(n,e,t),xg(n,e),n.sharedClientState.updateMutationState(e,"rejected",t),await Fa(n,a)}catch(a){await Pa(a)}}function xg(s,e){(s.ka.get(e)||[]).forEach(t=>{t.resolve()}),s.ka.delete(e)}function fg(s,e,t){const n=Ke(s);let a=n.Ba[n.currentUser.toKey()];if(a){const i=a.get(e);i&&(t?i.reject(t):i.resolve(),a=a.remove(e)),n.Ba[n.currentUser.toKey()]=a}}function Cl(s,e,t=null){s.sharedClientState.removeLocalQueryTarget(e);for(const n of s.Ma.get(e))s.Fa.delete(n),t&&s.Ca.$a(n,t);s.Ma.delete(e),s.isPrimaryClient&&s.La.gr(e).forEach(n=>{s.La.containsKey(n)||yg(s,n)})}function yg(s,e){s.xa.delete(e.path.canonicalString());const t=s.Oa.get(e);t!==null&&(xc(s.remoteStore,t),s.Oa=s.Oa.remove(e),s.Na.delete(t),Nc(s))}function Du(s,e,t){for(const n of t)n instanceof hg?(s.La.addReference(n.key,e),zv(s,n)):n instanceof mg?($e("SyncEngine","Document no longer in limbo: "+n.key),s.La.removeReference(n.key,e),s.La.containsKey(n.key)||yg(s,n.key)):We()}function zv(s,e){const t=e.key,n=t.path.canonicalString();s.Oa.get(t)||s.xa.has(n)||($e("SyncEngine","New document in limbo: "+t),s.xa.add(n),Nc(s))}function Nc(s){for(;s.xa.size>0&&s.Oa.size<s.maxConcurrentLimboResolutions;){const e=s.xa.values().next().value;s.xa.delete(e);const t=new Le(bt.fromString(e)),n=s.qa.next();s.Na.set(n,new Rv(t)),s.Oa=s.Oa.insert(t,n),sg(s.remoteStore,new Es(Pr(oc(t.path)),n,"TargetPurposeLimboResolution",tc.oe))}}async function Fa(s,e,t){const n=Ke(s),a=[],i=[],o=[];n.Fa.isEmpty()||(n.Fa.forEach((c,d)=>{o.push(n.Ka(d,e,t).then(h=>{var m;if((h||t)&&n.isPrimaryClient){const x=h?!h.fromCache:(m=t==null?void 0:t.targetChanges.get(d.targetId))===null||m===void 0?void 0:m.current;n.sharedClientState.updateQueryState(d.targetId,x?"current":"not-current")}if(h){a.push(h);const x=pc.Wi(d.targetId,h);i.push(x)}}))}),await Promise.all(o),n.Ca.d_(a),await async function(d,h){const m=Ke(d);try{await m.persistence.runTransaction("notifyLocalViewChanges","readwrite",x=>be.forEach(h,f=>be.forEach(f.$i,k=>m.persistence.referenceDelegate.addReference(x,f.targetId,k)).next(()=>be.forEach(f.Ui,k=>m.persistence.referenceDelegate.removeReference(x,f.targetId,k)))))}catch(x){if(!Ma(x))throw x;$e("LocalStore","Failed to update sequence numbers: "+x)}for(const x of h){const f=x.targetId;if(!x.fromCache){const k=m.os.get(f),A=k.snapshotVersion,D=k.withLastLimboFreeSnapshotVersion(A);m.os=m.os.insert(f,D)}}}(n.localStore,i))}async function Hv(s,e){const t=Ke(s);if(!t.currentUser.isEqual(e)){$e("SyncEngine","User change. New user:",e.toKey());const n=await Zm(t.localStore,e);t.currentUser=e,function(i,o){i.ka.forEach(c=>{c.forEach(d=>{d.reject(new Ae(he.CANCELLED,o))})}),i.ka.clear()}(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,n.removedBatchIds,n.addedBatchIds),await Fa(t,n.hs)}}function Gv(s,e){const t=Ke(s),n=t.Na.get(e);if(n&&n.va)return Xe().add(n.key);{let a=Xe();const i=t.Ma.get(e);if(!i)return a;for(const o of i){const c=t.Fa.get(o);a=a.unionWith(c.view.Va)}return a}}function bg(s){const e=Ke(s);return e.remoteStore.remoteSyncer.applyRemoteEvent=pg.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=Gv.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=Bv.bind(null,e),e.Ca.d_=Av.bind(null,e.eventManager),e.Ca.$a=Cv.bind(null,e.eventManager),e}function Kv(s){const e=Ke(s);return e.remoteStore.remoteSyncer.applySuccessfulWrite=qv.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=Wv.bind(null,e),e}class Li{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=mo(e.databaseInfo.databaseId),this.sharedClientState=this.Wa(e),this.persistence=this.Ga(e),await this.persistence.start(),this.localStore=this.za(e),this.gcScheduler=this.ja(e,this.localStore),this.indexBackfillerScheduler=this.Ha(e,this.localStore)}ja(e,t){return null}Ha(e,t){return null}za(e){return ev(this.persistence,new Jb,e.initialUser,this.serializer)}Ga(e){return new Yb(gc.Zr,this.serializer)}Wa(e){return new ov}async terminate(){var e,t;(e=this.gcScheduler)===null||e===void 0||e.stop(),(t=this.indexBackfillerScheduler)===null||t===void 0||t.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}Li.provider={build:()=>new Li};class Dl{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=n=>Cu(this.syncEngine,n,1),this.remoteStore.remoteSyncer.handleCredentialChange=Hv.bind(null,this.syncEngine),await Iv(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return function(){return new Sv}()}createDatastore(e){const t=mo(e.databaseInfo.databaseId),n=function(i){return new uv(i)}(e.databaseInfo);return function(i,o,c,d){return new gv(i,o,c,d)}(e.authCredentials,e.appCheckCredentials,n,t)}createRemoteStore(e){return function(n,a,i,o,c){return new xv(n,a,i,o,c)}(this.localStore,this.datastore,e.asyncQueue,t=>Cu(this.syncEngine,t,0),function(){return Eu.D()?new Eu:new lv}())}createSyncEngine(e,t){return function(a,i,o,c,d,h,m){const x=new Pv(a,i,o,c,d,h);return m&&(x.Qa=!0),x}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){var e,t;await async function(a){const i=Ke(a);$e("RemoteStore","RemoteStore shutting down."),i.L_.add(5),await La(i),i.k_.shutdown(),i.q_.set("Unknown")}(this.remoteStore),(e=this.datastore)===null||e===void 0||e.terminate(),(t=this.eventManager)===null||t===void 0||t.terminate()}}Dl.provider={build:()=>new Dl};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vg{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ya(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ya(this.observer.error,e):ls("Uncaught Error in snapshot listener:",e.toString()))}Za(){this.muted=!0}Ya(e,t){setTimeout(()=>{this.muted||e(t)},0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yv{constructor(e,t,n,a,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=a,this.user=Yt.UNAUTHENTICATED,this.clientId=vm.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(n,async o=>{$e("FirestoreClient","Received user=",o.uid),await this.authCredentialListener(o),this.user=o}),this.appCheckCredentials.start(n,o=>($e("FirestoreClient","Received new app check token=",o),this.appCheckCredentialListener(o,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new rs;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const n=wc(t,"Failed to shutdown persistence");e.reject(n)}}),e.promise}}async function el(s,e){s.asyncQueue.verifyOperationInProgress(),$e("FirestoreClient","Initializing OfflineComponentProvider");const t=s.configuration;await e.initialize(t);let n=t.initialUser;s.setCredentialChangeListener(async a=>{n.isEqual(a)||(await Zm(e.localStore,a),n=a)}),e.persistence.setDatabaseDeletedListener(()=>s.terminate()),s._offlineComponents=e}async function $u(s,e){s.asyncQueue.verifyOperationInProgress();const t=await Qv(s);$e("FirestoreClient","Initializing OnlineComponentProvider"),await e.initialize(t,s.configuration),s.setCredentialChangeListener(n=>Iu(e.remoteStore,n)),s.setAppCheckTokenChangeListener((n,a)=>Iu(e.remoteStore,a)),s._onlineComponents=e}async function Qv(s){if(!s._offlineComponents)if(s._uninitializedComponentsProvider){$e("FirestoreClient","Using user provided OfflineComponentProvider");try{await el(s,s._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!function(a){return a.name==="FirebaseError"?a.code===he.FAILED_PRECONDITION||a.code===he.UNIMPLEMENTED:!(typeof DOMException<"u"&&a instanceof DOMException)||a.code===22||a.code===20||a.code===11}(t))throw t;Nn("Error using user provided cache. Falling back to memory cache: "+t),await el(s,new Li)}}else $e("FirestoreClient","Using default OfflineComponentProvider"),await el(s,new Li);return s._offlineComponents}async function wg(s){return s._onlineComponents||(s._uninitializedComponentsProvider?($e("FirestoreClient","Using user provided OnlineComponentProvider"),await $u(s,s._uninitializedComponentsProvider._online)):($e("FirestoreClient","Using default OnlineComponentProvider"),await $u(s,new Dl))),s._onlineComponents}function Xv(s){return wg(s).then(e=>e.syncEngine)}async function kg(s){const e=await wg(s),t=e.eventManager;return t.onListen=Mv.bind(null,e.syncEngine),t.onUnlisten=Lv.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=Ov.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=Fv.bind(null,e.syncEngine),t}function Jv(s,e,t={}){const n=new rs;return s.asyncQueue.enqueueAndForget(async()=>function(i,o,c,d,h){const m=new vg({next:f=>{m.Za(),o.enqueueAndForget(()=>dg(i,x));const k=f.docs.has(c);!k&&f.fromCache?h.reject(new Ae(he.UNAVAILABLE,"Failed to get document because the client is offline.")):k&&f.fromCache&&d&&d.source==="server"?h.reject(new Ae(he.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):h.resolve(f)},error:f=>h.reject(f)}),x=new ug(oc(c.path),m,{includeMetadataChanges:!0,_a:!0});return cg(i,x)}(await kg(s),s.asyncQueue,e,t,n)),n.promise}function Zv(s,e,t={}){const n=new rs;return s.asyncQueue.enqueueAndForget(async()=>function(i,o,c,d,h){const m=new vg({next:f=>{m.Za(),o.enqueueAndForget(()=>dg(i,x)),f.fromCache&&d.source==="server"?h.reject(new Ae(he.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):h.resolve(f)},error:f=>h.reject(f)}),x=new ug(c,m,{includeMetadataChanges:!0,_a:!0});return cg(i,x)}(await kg(s),s.asyncQueue,e,t,n)),n.promise}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ng(s){const e={};return s.timeoutSeconds!==void 0&&(e.timeoutSeconds=s.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ru=new Map;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jg(s,e,t){if(!t)throw new Ae(he.INVALID_ARGUMENT,`Function ${s}() cannot be called with an empty ${e}.`)}function ew(s,e,t,n){if(e===!0&&n===!0)throw new Ae(he.INVALID_ARGUMENT,`${s} and ${t} cannot be used together.`)}function Pu(s){if(!Le.isDocumentKey(s))throw new Ae(he.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${s} has ${s.length}.`)}function Mu(s){if(Le.isDocumentKey(s))throw new Ae(he.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${s} has ${s.length}.`)}function xo(s){if(s===void 0)return"undefined";if(s===null)return"null";if(typeof s=="string")return s.length>20&&(s=`${s.substring(0,20)}...`),JSON.stringify(s);if(typeof s=="number"||typeof s=="boolean")return""+s;if(typeof s=="object"){if(s instanceof Array)return"an array";{const e=function(n){return n.constructor?n.constructor.name:null}(s);return e?`a custom ${e} object`:"an object"}}return typeof s=="function"?"a function":We()}function ds(s,e){if("_delegate"in s&&(s=s._delegate),!(s instanceof e)){if(e.name===s.constructor.name)throw new Ae(he.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=xo(s);throw new Ae(he.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ou{constructor(e){var t,n;if(e.host===void 0){if(e.ssl!==void 0)throw new Ae(he.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=(t=e.ssl)===null||t===void 0||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new Ae(he.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}ew("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=Ng((n=e.experimentalLongPollingOptions)!==null&&n!==void 0?n:{}),function(i){if(i.timeoutSeconds!==void 0){if(isNaN(i.timeoutSeconds))throw new Ae(he.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (must not be NaN)`);if(i.timeoutSeconds<5)throw new Ae(he.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (minimum allowed value is 5)`);if(i.timeoutSeconds>30)throw new Ae(he.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(n,a){return n.timeoutSeconds===a.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class fo{constructor(e,t,n,a){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=a,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Ou({}),this._settingsFrozen=!1,this._terminateTask="notTerminated"}get app(){if(!this._app)throw new Ae(he.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new Ae(he.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Ou(e),e.credentials!==void 0&&(this._authCredentials=function(n){if(!n)return new yy;switch(n.type){case"firstParty":return new ky(n.sessionIndex||"0",n.iamToken||null,n.authTokenFactory||null);case"provider":return n.client;default:throw new Ae(he.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const n=Ru.get(t);n&&($e("ComponentProvider","Removing Datastore"),Ru.delete(t),n.terminate())}(this),Promise.resolve()}}function tw(s,e,t,n={}){var a;const i=(s=ds(s,fo))._getSettings(),o=`${e}:${t}`;if(i.host!=="firestore.googleapis.com"&&i.host!==o&&Nn("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),s._setSettings(Object.assign(Object.assign({},i),{host:o,ssl:!1})),n.mockUserToken){let c,d;if(typeof n.mockUserToken=="string")c=n.mockUserToken,d=Yt.MOCK_USER;else{c=om(n.mockUserToken,(a=s._app)===null||a===void 0?void 0:a.options.projectId);const h=n.mockUserToken.sub||n.mockUserToken.user_id;if(!h)throw new Ae(he.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");d=new Yt(h)}s._authCredentials=new by(new bm(c,d))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sn{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new sn(this.firestore,e,this._query)}}class hr{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new As(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new hr(this.firestore,e,this._key)}}class As extends sn{constructor(e,t,n){super(e,t,oc(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new hr(this.firestore,null,new Le(e))}withConverter(e){return new As(this.firestore,e,this._path)}}function ct(s,e,...t){if(s=Zt(s),jg("collection","path",e),s instanceof fo){const n=bt.fromString(e,...t);return Mu(n),new As(s,null,n)}{if(!(s instanceof hr||s instanceof As))throw new Ae(he.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const n=s._path.child(bt.fromString(e,...t));return Mu(n),new As(s.firestore,null,n)}}function ht(s,e,...t){if(s=Zt(s),arguments.length===1&&(e=vm.newId()),jg("doc","path",e),s instanceof fo){const n=bt.fromString(e,...t);return Pu(n),new hr(s,null,new Le(n))}{if(!(s instanceof hr||s instanceof As))throw new Ae(he.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const n=s._path.child(bt.fromString(e,...t));return Pu(n),new hr(s.firestore,s instanceof As?s.converter:null,new Le(n))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vu{constructor(e=Promise.resolve()){this.Pu=[],this.Iu=!1,this.Tu=[],this.Eu=null,this.du=!1,this.Au=!1,this.Ru=[],this.t_=new tg(this,"async_queue_retry"),this.Vu=()=>{const n=Zo();n&&$e("AsyncQueue","Visibility state changed to "+n.visibilityState),this.t_.jo()},this.mu=e;const t=Zo();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this.Vu)}get isShuttingDown(){return this.Iu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.fu(),this.gu(e)}enterRestrictedMode(e){if(!this.Iu){this.Iu=!0,this.Au=e||!1;const t=Zo();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this.Vu)}}enqueue(e){if(this.fu(),this.Iu)return new Promise(()=>{});const t=new rs;return this.gu(()=>this.Iu&&this.Au?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Pu.push(e),this.pu()))}async pu(){if(this.Pu.length!==0){try{await this.Pu[0](),this.Pu.shift(),this.t_.reset()}catch(e){if(!Ma(e))throw e;$e("AsyncQueue","Operation failed with retryable error: "+e)}this.Pu.length>0&&this.t_.Go(()=>this.pu())}}gu(e){const t=this.mu.then(()=>(this.du=!0,e().catch(n=>{this.Eu=n,this.du=!1;const a=function(o){let c=o.message||"";return o.stack&&(c=o.stack.includes(o.message)?o.stack:o.message+`
`+o.stack),c}(n);throw ls("INTERNAL UNHANDLED ERROR: ",a),n}).then(n=>(this.du=!1,n))));return this.mu=t,t}enqueueAfterDelay(e,t,n){this.fu(),this.Ru.indexOf(e)>-1&&(t=0);const a=vc.createAndSchedule(this,e,t,n,i=>this.yu(i));return this.Tu.push(a),a}fu(){this.Eu&&We()}verifyOperationInProgress(){}async wu(){let e;do e=this.mu,await e;while(e!==this.mu)}Su(e){for(const t of this.Tu)if(t.timerId===e)return!0;return!1}bu(e){return this.wu().then(()=>{this.Tu.sort((t,n)=>t.targetTimeMs-n.targetTimeMs);for(const t of this.Tu)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.wu()})}Du(e){this.Ru.push(e)}yu(e){const t=this.Tu.indexOf(e);this.Tu.splice(t,1)}}class Fn extends fo{constructor(e,t,n,a){super(e,t,n,a),this.type="firestore",this._queue=new Vu,this._persistenceKey=(a==null?void 0:a.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new Vu(e),this._firestoreClient=void 0,await e}}}function rw(s,e){const t=typeof s=="object"?s:Zl(),n=typeof s=="string"?s:"(default)",a=ao(t,"firestore").getImmediate({identifier:n});if(!a._initialized){const i=nm("firestore");i&&tw(a,...i)}return a}function jc(s){if(s._terminated)throw new Ae(he.FAILED_PRECONDITION,"The client has already been terminated.");return s._firestoreClient||sw(s),s._firestoreClient}function sw(s){var e,t,n;const a=s._freezeSettings(),i=function(c,d,h,m){return new Py(c,d,h,m.host,m.ssl,m.experimentalForceLongPolling,m.experimentalAutoDetectLongPolling,Ng(m.experimentalLongPollingOptions),m.useFetchStreams)}(s._databaseId,((e=s._app)===null||e===void 0?void 0:e.options.appId)||"",s._persistenceKey,a);s._componentsProvider||!((t=a.localCache)===null||t===void 0)&&t._offlineComponentProvider&&(!((n=a.localCache)===null||n===void 0)&&n._onlineComponentProvider)&&(s._componentsProvider={_offline:a.localCache._offlineComponentProvider,_online:a.localCache._onlineComponentProvider}),s._firestoreClient=new Yv(s._authCredentials,s._appCheckCredentials,s._queue,i,s._componentsProvider&&function(c){const d=c==null?void 0:c._online.build();return{_offline:c==null?void 0:c._offline.build(d),_online:d}}(s._componentsProvider))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sn{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Sn(Wt.fromBase64String(e))}catch(t){throw new Ae(he.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new Sn(Wt.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yo{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new Ae(he.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Ut(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _c{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ec{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new Ae(he.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new Ae(he.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return ot(this._lat,e._lat)||ot(this._long,e._long)}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ic{constructor(e){this._values=(e||[]).map(t=>t)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(n,a){if(n.length!==a.length)return!1;for(let i=0;i<n.length;++i)if(n[i]!==a[i])return!1;return!0}(this._values,e._values)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nw=/^__.*__$/;class aw{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return this.fieldMask!==null?new Os(e,this.data,this.fieldMask,t,this.fieldTransforms):new Oa(e,this.data,t,this.fieldTransforms)}}class _g{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return new Os(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function Eg(s){switch(s){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw We()}}class Tc{constructor(e,t,n,a,i,o){this.settings=e,this.databaseId=t,this.serializer=n,this.ignoreUndefinedProperties=a,i===void 0&&this.vu(),this.fieldTransforms=i||[],this.fieldMask=o||[]}get path(){return this.settings.path}get Cu(){return this.settings.Cu}Fu(e){return new Tc(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Mu(e){var t;const n=(t=this.path)===null||t===void 0?void 0:t.child(e),a=this.Fu({path:n,xu:!1});return a.Ou(e),a}Nu(e){var t;const n=(t=this.path)===null||t===void 0?void 0:t.child(e),a=this.Fu({path:n,xu:!1});return a.vu(),a}Lu(e){return this.Fu({path:void 0,xu:!0})}Bu(e){return Fi(e,this.settings.methodName,this.settings.ku||!1,this.path,this.settings.qu)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}vu(){if(this.path)for(let e=0;e<this.path.length;e++)this.Ou(this.path.get(e))}Ou(e){if(e.length===0)throw this.Bu("Document fields must not be empty");if(Eg(this.Cu)&&nw.test(e))throw this.Bu('Document fields cannot begin and end with "__"')}}class iw{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=n||mo(e)}Qu(e,t,n,a=!1){return new Tc({Cu:e,methodName:t,qu:n,path:Ut.emptyPath(),xu:!1,ku:a},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function Sc(s){const e=s._freezeSettings(),t=mo(s._databaseId);return new iw(s._databaseId,!!e.ignoreUndefinedProperties,t)}function ow(s,e,t,n,a,i={}){const o=s.Qu(i.merge||i.mergeFields?2:0,e,t,a);Ac("Data must be an object, but it was:",o,n);const c=Ig(n,o);let d,h;if(i.merge)d=new xr(o.fieldMask),h=o.fieldTransforms;else if(i.mergeFields){const m=[];for(const x of i.mergeFields){const f=$l(e,x,t);if(!o.contains(f))throw new Ae(he.INVALID_ARGUMENT,`Field '${f}' is specified in your field mask but missing from your input data.`);Sg(m,f)||m.push(f)}d=new xr(m),h=o.fieldTransforms.filter(x=>d.covers(x.field))}else d=null,h=o.fieldTransforms;return new aw(new ur(c),d,h)}class bo extends _c{_toFieldTransform(e){if(e.Cu!==2)throw e.Cu===1?e.Bu(`${this._methodName}() can only appear at the top level of your update data`):e.Bu(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof bo}}function lw(s,e,t,n){const a=s.Qu(1,e,t);Ac("Data must be an object, but it was:",a,n);const i=[],o=ur.empty();tn(n,(d,h)=>{const m=Cc(e,d,t);h=Zt(h);const x=a.Nu(m);if(h instanceof bo)i.push(m);else{const f=Ua(h,x);f!=null&&(i.push(m),o.set(m,f))}});const c=new xr(i);return new _g(o,c,a.fieldTransforms)}function cw(s,e,t,n,a,i){const o=s.Qu(1,e,t),c=[$l(e,n,t)],d=[a];if(i.length%2!=0)throw new Ae(he.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let f=0;f<i.length;f+=2)c.push($l(e,i[f])),d.push(i[f+1]);const h=[],m=ur.empty();for(let f=c.length-1;f>=0;--f)if(!Sg(h,c[f])){const k=c[f];let A=d[f];A=Zt(A);const D=o.Nu(k);if(A instanceof bo)h.push(k);else{const T=Ua(A,D);T!=null&&(h.push(k),m.set(k,T))}}const x=new xr(h);return new _g(m,x,o.fieldTransforms)}function dw(s,e,t,n=!1){return Ua(t,s.Qu(n?4:3,e))}function Ua(s,e){if(Tg(s=Zt(s)))return Ac("Unsupported field value:",e,s),Ig(s,e);if(s instanceof _c)return function(n,a){if(!Eg(a.Cu))throw a.Bu(`${n._methodName}() can only be used with update() and set()`);if(!a.path)throw a.Bu(`${n._methodName}() is not currently supported inside arrays`);const i=n._toFieldTransform(a);i&&a.fieldTransforms.push(i)}(s,e),null;if(s===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),s instanceof Array){if(e.settings.xu&&e.Cu!==4)throw e.Bu("Nested arrays are not supported");return function(n,a){const i=[];let o=0;for(const c of n){let d=Ua(c,a.Lu(o));d==null&&(d={nullValue:"NULL_VALUE"}),i.push(d),o++}return{arrayValue:{values:i}}}(s,e)}return function(n,a){if((n=Zt(n))===null)return{nullValue:"NULL_VALUE"};if(typeof n=="number")return sb(a.serializer,n);if(typeof n=="boolean")return{booleanValue:n};if(typeof n=="string")return{stringValue:n};if(n instanceof Date){const i=Rt.fromDate(n);return{timestampValue:Oi(a.serializer,i)}}if(n instanceof Rt){const i=new Rt(n.seconds,1e3*Math.floor(n.nanoseconds/1e3));return{timestampValue:Oi(a.serializer,i)}}if(n instanceof Ec)return{geoPointValue:{latitude:n.latitude,longitude:n.longitude}};if(n instanceof Sn)return{bytesValue:Hm(a.serializer,n._byteString)};if(n instanceof hr){const i=a.databaseId,o=n.firestore._databaseId;if(!o.isEqual(i))throw a.Bu(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${i.projectId}/${i.database}`);return{referenceValue:hc(n.firestore._databaseId||a.databaseId,n._key.path)}}if(n instanceof Ic)return function(o,c){return{mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{values:o.toArray().map(d=>{if(typeof d!="number")throw c.Bu("VectorValues must only contain numeric values.");return lc(c.serializer,d)})}}}}}}(n,a);throw a.Bu(`Unsupported field value: ${xo(n)}`)}(s,e)}function Ig(s,e){const t={};return wm(s)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):tn(s,(n,a)=>{const i=Ua(a,e.Mu(n));i!=null&&(t[n]=i)}),{mapValue:{fields:t}}}function Tg(s){return!(typeof s!="object"||s===null||s instanceof Array||s instanceof Date||s instanceof Rt||s instanceof Ec||s instanceof Sn||s instanceof hr||s instanceof _c||s instanceof Ic)}function Ac(s,e,t){if(!Tg(t)||!function(a){return typeof a=="object"&&a!==null&&(Object.getPrototypeOf(a)===Object.prototype||Object.getPrototypeOf(a)===null)}(t)){const n=xo(t);throw n==="an object"?e.Bu(s+" a custom object"):e.Bu(s+" "+n)}}function $l(s,e,t){if((e=Zt(e))instanceof yo)return e._internalPath;if(typeof e=="string")return Cc(s,e);throw Fi("Field path arguments must be of type string or ",s,!1,void 0,t)}const uw=new RegExp("[~\\*/\\[\\]]");function Cc(s,e,t){if(e.search(uw)>=0)throw Fi(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,s,!1,void 0,t);try{return new yo(...e.split("."))._internalPath}catch{throw Fi(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,s,!1,void 0,t)}}function Fi(s,e,t,n,a){const i=n&&!n.isEmpty(),o=a!==void 0;let c=`Function ${e}() called with invalid data`;t&&(c+=" (via `toFirestore()`)"),c+=". ";let d="";return(i||o)&&(d+=" (found",i&&(d+=` in field ${n}`),o&&(d+=` in document ${a}`),d+=")"),new Ae(he.INVALID_ARGUMENT,c+s+d)}function Sg(s,e){return s.some(t=>t.isEqual(e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ag{constructor(e,t,n,a,i){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=a,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new hr(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new hw(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(vo("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}}class hw extends Ag{data(){return super.data()}}function vo(s,e){return typeof e=="string"?Cc(s,e):e instanceof yo?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mw(s){if(s.limitType==="L"&&s.explicitOrderBy.length===0)throw new Ae(he.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class Dc{}class Cg extends Dc{}function nt(s,e,...t){let n=[];e instanceof Dc&&n.push(e),n=n.concat(t),function(i){const o=i.filter(d=>d instanceof $c).length,c=i.filter(d=>d instanceof wo).length;if(o>1||o>0&&c>0)throw new Ae(he.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(n);for(const a of n)s=a._apply(s);return s}class wo extends Cg{constructor(e,t,n){super(),this._field=e,this._op=t,this._value=n,this.type="where"}static _create(e,t,n){return new wo(e,t,n)}_apply(e){const t=this._parse(e);return Dg(e._query,t),new sn(e.firestore,e.converter,Nl(e._query,t))}_parse(e){const t=Sc(e.firestore);return function(i,o,c,d,h,m,x){let f;if(h.isKeyField()){if(m==="array-contains"||m==="array-contains-any")throw new Ae(he.INVALID_ARGUMENT,`Invalid Query. You can't perform '${m}' queries on documentId().`);if(m==="in"||m==="not-in"){Fu(x,m);const k=[];for(const A of x)k.push(Lu(d,i,A));f={arrayValue:{values:k}}}else f=Lu(d,i,x)}else m!=="in"&&m!=="not-in"&&m!=="array-contains-any"||Fu(x,m),f=dw(c,o,x,m==="in"||m==="not-in");return Dt.create(h,m,f)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}}function Tt(s,e,t){const n=e,a=vo("where",s);return wo._create(a,n,t)}class $c extends Dc{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new $c(e,t)}_parse(e){const t=this._queryConstraints.map(n=>n._parse(e)).filter(n=>n.getFilters().length>0);return t.length===1?t[0]:Ar.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return t.getFilters().length===0?e:(function(a,i){let o=a;const c=i.getFlattenedFilters();for(const d of c)Dg(o,d),o=Nl(o,d)}(e._query,t),new sn(e.firestore,e.converter,Nl(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}class Rc extends Cg{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new Rc(e,t)}_apply(e){const t=function(a,i,o){if(a.startAt!==null)throw new Ae(he.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(a.endAt!==null)throw new Ae(he.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new ka(i,o)}(e._query,this._field,this._direction);return new sn(e.firestore,e.converter,function(a,i){const o=a.explicitOrderBy.concat([i]);return new On(a.path,a.collectionGroup,o,a.filters.slice(),a.limit,a.limitType,a.startAt,a.endAt)}(e._query,t))}}function Ms(s,e="asc"){const t=e,n=vo("orderBy",s);return Rc._create(n,t)}function Lu(s,e,t){if(typeof(t=Zt(t))=="string"){if(t==="")throw new Ae(he.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Am(e)&&t.indexOf("/")!==-1)throw new Ae(he.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);const n=e.path.child(bt.fromString(t));if(!Le.isDocumentKey(n))throw new Ae(he.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${n}' is not because it has an odd number of segments (${n.length}).`);return ou(s,new Le(n))}if(t instanceof hr)return ou(s,t._key);throw new Ae(he.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${xo(t)}.`)}function Fu(s,e){if(!Array.isArray(s)||s.length===0)throw new Ae(he.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function Dg(s,e){const t=function(a,i){for(const o of a)for(const c of o.getFlattenedFilters())if(i.indexOf(c.op)>=0)return c.op;return null}(s.filters,function(a){switch(a){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(t!==null)throw t===e.op?new Ae(he.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new Ae(he.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}class gw{convertValue(e,t="none"){switch(Js(e)){case 0:return null;case 1:return e.booleanValue;case 2:return St(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Xs(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw We()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const n={};return tn(e,(a,i)=>{n[a]=this.convertValue(i,t)}),n}convertVectorValue(e){var t,n,a;const i=(a=(n=(t=e.fields)===null||t===void 0?void 0:t.value.arrayValue)===null||n===void 0?void 0:n.values)===null||a===void 0?void 0:a.map(o=>St(o.doubleValue));return new Ic(i)}convertGeoPoint(e){return new Ec(St(e.latitude),St(e.longitude))}convertArray(e,t){return(e.values||[]).map(n=>this.convertValue(n,t))}convertServerTimestamp(e,t){switch(t){case"previous":const n=sc(e);return n==null?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(ba(e));default:return null}}convertTimestamp(e){const t=Rs(e);return new Rt(t.seconds,t.nanos)}convertDocumentKey(e,t){const n=bt.fromString(e);ut(Jm(n));const a=new va(n.get(1),n.get(3)),i=new Le(n.popFirst(5));return a.isEqual(t)||ls(`Document ${i} contains a document reference within a different database (${a.projectId}/${a.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function pw(s,e,t){let n;return n=s?s.toFirestore(e):e,n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ia{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class $g extends Ag{constructor(e,t,n,a,i,o){super(e,t,n,a,o),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new vi(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const n=this._document.data.field(vo("DocumentSnapshot.get",e));if(n!==null)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}}class vi extends $g{data(e={}){return super.data(e)}}class xw{constructor(e,t,n,a){this._firestore=e,this._userDataWriter=t,this._snapshot=a,this.metadata=new ia(a.hasPendingWrites,a.fromCache),this.query=n}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(n=>{e.call(t,new vi(this._firestore,this._userDataWriter,n.key,n,new ia(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new Ae(he.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(a,i){if(a._snapshot.oldDocs.isEmpty()){let o=0;return a._snapshot.docChanges.map(c=>{const d=new vi(a._firestore,a._userDataWriter,c.doc.key,c.doc,new ia(a._snapshot.mutatedKeys.has(c.doc.key),a._snapshot.fromCache),a.query.converter);return c.doc,{type:"added",doc:d,oldIndex:-1,newIndex:o++}})}{let o=a._snapshot.oldDocs;return a._snapshot.docChanges.filter(c=>i||c.type!==3).map(c=>{const d=new vi(a._firestore,a._userDataWriter,c.doc.key,c.doc,new ia(a._snapshot.mutatedKeys.has(c.doc.key),a._snapshot.fromCache),a.query.converter);let h=-1,m=-1;return c.type!==0&&(h=o.indexOf(c.doc.key),o=o.delete(c.doc.key)),c.type!==1&&(o=o.add(c.doc),m=o.indexOf(c.doc.key)),{type:fw(c.type),doc:d,oldIndex:h,newIndex:m}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function fw(s){switch(s){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return We()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Rg(s){s=ds(s,hr);const e=ds(s.firestore,Fn);return Jv(jc(e),s._key).then(t=>yw(e,s,t))}class Pg extends gw{constructor(e){super(),this.firestore=e}convertBytes(e){return new Sn(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new hr(this.firestore,null,t)}}function zt(s){s=ds(s,sn);const e=ds(s.firestore,Fn),t=jc(e),n=new Pg(e);return mw(s._query),Zv(t,s._query).then(a=>new xw(e,n,s,a))}function ar(s,e,t,...n){s=ds(s,hr);const a=ds(s.firestore,Fn),i=Sc(a);let o;return o=typeof(e=Zt(e))=="string"||e instanceof yo?cw(i,"updateDoc",s._key,e,t,n):lw(i,"updateDoc",s._key,e),Pc(a,[o.toMutation(s._key,Ir.exists(!0))])}function yr(s){return Pc(ds(s.firestore,Fn),[new cc(s._key,Ir.none())])}function gr(s,e){const t=ds(s.firestore,Fn),n=ht(s),a=pw(s.converter,e);return Pc(t,[ow(Sc(s.firestore),"addDoc",n._key,a,s.converter!==null,{}).toMutation(n._key,Ir.exists(!1))]).then(()=>n)}function Pc(s,e){return function(n,a){const i=new rs;return n.asyncQueue.enqueueAndForget(async()=>Uv(await Xv(n),a,i)),i.promise}(jc(s),e)}function yw(s,e,t){const n=t.docs.get(e._key),a=new Pg(s);return new $g(s,a,e._key,n,new ia(t.hasPendingWrites,t.fromCache),e.converter)}(function(e,t=!0){(function(a){Mn=a})(en),Ys(new Ds("firestore",(n,{instanceIdentifier:a,options:i})=>{const o=n.getProvider("app").getImmediate(),c=new Fn(new vy(n.getProvider("auth-internal")),new jy(n.getProvider("app-check-internal")),function(h,m){if(!Object.prototype.hasOwnProperty.apply(h.options,["projectId"]))throw new Ae(he.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new va(h.options.projectId,m)}(o,a),o);return i=Object.assign({useFetchStreams:t},i),c._setSettings(i),c},"PUBLIC").setMultipleInstances(!0)),Rr(ru,"4.7.3",e),Rr(ru,"4.7.3","esm2017")})();var bw="firebase",vw="10.14.1";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Rr(bw,vw,"app");function Mc(s,e){var t={};for(var n in s)Object.prototype.hasOwnProperty.call(s,n)&&e.indexOf(n)<0&&(t[n]=s[n]);if(s!=null&&typeof Object.getOwnPropertySymbols=="function")for(var a=0,n=Object.getOwnPropertySymbols(s);a<n.length;a++)e.indexOf(n[a])<0&&Object.prototype.propertyIsEnumerable.call(s,n[a])&&(t[n[a]]=s[n[a]]);return t}function Mg(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const ww=Mg,Og=new $a("auth","Firebase",Mg());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ui=new Xl("@firebase/auth");function kw(s,...e){Ui.logLevel<=tt.WARN&&Ui.warn(`Auth (${en}): ${s}`,...e)}function wi(s,...e){Ui.logLevel<=tt.ERROR&&Ui.error(`Auth (${en}): ${s}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function us(s,...e){throw Oc(s,...e)}function Or(s,...e){return Oc(s,...e)}function Vg(s,e,t){const n=Object.assign(Object.assign({},ww()),{[e]:t});return new $a("auth","Firebase",n).create(e,{appName:s.name})}function Ks(s){return Vg(s,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function Oc(s,...e){if(typeof s!="string"){const t=e[0],n=[...e.slice(1)];return n[0]&&(n[0].appName=s.name),s._errorFactory.create(t,...n)}return Og.create(s,...e)}function qe(s,e,...t){if(!s)throw Oc(e,...t)}function Jr(s){const e="INTERNAL ASSERTION FAILED: "+s;throw wi(e),new Error(e)}function hs(s,e){s||Jr(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Rl(){var s;return typeof self<"u"&&((s=self.location)===null||s===void 0?void 0:s.href)||""}function Nw(){return Uu()==="http:"||Uu()==="https:"}function Uu(){var s;return typeof self<"u"&&((s=self.location)===null||s===void 0?void 0:s.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jw(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(Nw()||Xx()||"connection"in navigator)?navigator.onLine:!0}function _w(){if(typeof navigator>"u")return null;const s=navigator;return s.languages&&s.languages[0]||s.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ba{constructor(e,t){this.shortDelay=e,this.longDelay=t,hs(t>e,"Short delay should be less than long delay!"),this.isMobile=Kx()||Jx()}get(){return jw()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Vc(s,e){hs(s.emulator,"Emulator should always be set here");const{url:t}=s.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lg{static initialize(e,t,n){this.fetchImpl=e,t&&(this.headersImpl=t),n&&(this.responseImpl=n)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;Jr("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;Jr("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;Jr("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ew={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Iw=new Ba(3e4,6e4);function Lc(s,e){return s.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:s.tenantId}):e}async function Un(s,e,t,n,a={}){return Fg(s,a,async()=>{let i={},o={};n&&(e==="GET"?o=n:i={body:JSON.stringify(n)});const c=Ra(Object.assign({key:s.config.apiKey},o)).slice(1),d=await s._getAdditionalHeaders();d["Content-Type"]="application/json",s.languageCode&&(d["X-Firebase-Locale"]=s.languageCode);const h=Object.assign({method:e,headers:d},i);return Qx()||(h.referrerPolicy="no-referrer"),Lg.fetch()(Ug(s,s.config.apiHost,t,c),h)})}async function Fg(s,e,t){s._canInitEmulator=!1;const n=Object.assign(Object.assign({},Ew),e);try{const a=new Sw(s),i=await Promise.race([t(),a.promise]);a.clearNetworkTimeout();const o=await i.json();if("needConfirmation"in o)throw ci(s,"account-exists-with-different-credential",o);if(i.ok&&!("errorMessage"in o))return o;{const c=i.ok?o.errorMessage:o.error.message,[d,h]=c.split(" : ");if(d==="FEDERATED_USER_ID_ALREADY_LINKED")throw ci(s,"credential-already-in-use",o);if(d==="EMAIL_EXISTS")throw ci(s,"email-already-in-use",o);if(d==="USER_DISABLED")throw ci(s,"user-disabled",o);const m=n[d]||d.toLowerCase().replace(/[_\s]+/g,"-");if(h)throw Vg(s,m,h);us(s,m)}}catch(a){if(a instanceof Br)throw a;us(s,"network-request-failed",{message:String(a)})}}async function Tw(s,e,t,n,a={}){const i=await Un(s,e,t,n,a);return"mfaPendingCredential"in i&&us(s,"multi-factor-auth-required",{_serverResponse:i}),i}function Ug(s,e,t,n){const a=`${e}${t}?${n}`;return s.config.emulator?Vc(s.config,a):`${s.config.apiScheme}://${a}`}class Sw{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,n)=>{this.timer=setTimeout(()=>n(Or(this.auth,"network-request-failed")),Iw.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function ci(s,e,t){const n={appName:s.name};t.email&&(n.email=t.email),t.phoneNumber&&(n.phoneNumber=t.phoneNumber);const a=Or(s,e,n);return a.customData._tokenResponse=t,a}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Aw(s,e){return Un(s,"POST","/v1/accounts:delete",e)}async function Bg(s,e){return Un(s,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ua(s){if(s)try{const e=new Date(Number(s));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function Cw(s,e=!1){const t=Zt(s),n=await t.getIdToken(e),a=Fc(n);qe(a&&a.exp&&a.auth_time&&a.iat,t.auth,"internal-error");const i=typeof a.firebase=="object"?a.firebase:void 0,o=i==null?void 0:i.sign_in_provider;return{claims:a,token:n,authTime:ua(tl(a.auth_time)),issuedAtTime:ua(tl(a.iat)),expirationTime:ua(tl(a.exp)),signInProvider:o||null,signInSecondFactor:(i==null?void 0:i.sign_in_second_factor)||null}}function tl(s){return Number(s)*1e3}function Fc(s){const[e,t,n]=s.split(".");if(e===void 0||t===void 0||n===void 0)return wi("JWT malformed, contained fewer than 3 sections"),null;try{const a=rm(t);return a?JSON.parse(a):(wi("Failed to decode base64 JWT payload"),null)}catch(a){return wi("Caught error parsing JWT payload as JSON",a==null?void 0:a.toString()),null}}function Bu(s){const e=Fc(s);return qe(e,"internal-error"),qe(typeof e.exp<"u","internal-error"),qe(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function _a(s,e,t=!1){if(t)return e;try{return await e}catch(n){throw n instanceof Br&&Dw(n)&&s.auth.currentUser===s&&await s.auth.signOut(),n}}function Dw({code:s}){return s==="auth/user-disabled"||s==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $w{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){const n=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),n}else{this.errorBackoff=3e4;const a=((t=this.user.stsTokenManager.expirationTime)!==null&&t!==void 0?t:0)-Date.now()-3e5;return Math.max(0,a)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(e==null?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pl{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=ua(this.lastLoginAt),this.creationTime=ua(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Bi(s){var e;const t=s.auth,n=await s.getIdToken(),a=await _a(s,Bg(t,{idToken:n}));qe(a==null?void 0:a.users.length,t,"internal-error");const i=a.users[0];s._notifyReloadListener(i);const o=!((e=i.providerUserInfo)===null||e===void 0)&&e.length?qg(i.providerUserInfo):[],c=Pw(s.providerData,o),d=s.isAnonymous,h=!(s.email&&i.passwordHash)&&!(c!=null&&c.length),m=d?h:!1,x={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:c,metadata:new Pl(i.createdAt,i.lastLoginAt),isAnonymous:m};Object.assign(s,x)}async function Rw(s){const e=Zt(s);await Bi(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function Pw(s,e){return[...s.filter(n=>!e.some(a=>a.providerId===n.providerId)),...e]}function qg(s){return s.map(e=>{var{providerId:t}=e,n=Mc(e,["providerId"]);return{providerId:t,uid:n.rawId||"",displayName:n.displayName||null,email:n.email||null,phoneNumber:n.phoneNumber||null,photoURL:n.photoUrl||null}})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Mw(s,e){const t=await Fg(s,{},async()=>{const n=Ra({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:a,apiKey:i}=s.config,o=Ug(s,a,"/v1/token",`key=${i}`),c=await s._getAdditionalHeaders();return c["Content-Type"]="application/x-www-form-urlencoded",Lg.fetch()(o,{method:"POST",headers:c,body:n})});return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}}async function Ow(s,e){return Un(s,"POST","/v2/accounts:revokeToken",Lc(s,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yn{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){qe(e.idToken,"internal-error"),qe(typeof e.idToken<"u","internal-error"),qe(typeof e.refreshToken<"u","internal-error");const t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):Bu(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){qe(e.length!==0,"internal-error");const t=Bu(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return!t&&this.accessToken&&!this.isExpired?this.accessToken:(qe(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:n,refreshToken:a,expiresIn:i}=await Mw(e,t);this.updateTokensAndExpiration(n,a,Number(i))}updateTokensAndExpiration(e,t,n){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+n*1e3}static fromJSON(e,t){const{refreshToken:n,accessToken:a,expirationTime:i}=t,o=new yn;return n&&(qe(typeof n=="string","internal-error",{appName:e}),o.refreshToken=n),a&&(qe(typeof a=="string","internal-error",{appName:e}),o.accessToken=a),i&&(qe(typeof i=="number","internal-error",{appName:e}),o.expirationTime=i),o}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new yn,this.toJSON())}_performRefresh(){return Jr("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fs(s,e){qe(typeof s=="string"||typeof s>"u","internal-error",{appName:e})}class Zr{constructor(e){var{uid:t,auth:n,stsTokenManager:a}=e,i=Mc(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new $w(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=n,this.stsTokenManager=a,this.accessToken=a.accessToken,this.displayName=i.displayName||null,this.email=i.email||null,this.emailVerified=i.emailVerified||!1,this.phoneNumber=i.phoneNumber||null,this.photoURL=i.photoURL||null,this.isAnonymous=i.isAnonymous||!1,this.tenantId=i.tenantId||null,this.providerData=i.providerData?[...i.providerData]:[],this.metadata=new Pl(i.createdAt||void 0,i.lastLoginAt||void 0)}async getIdToken(e){const t=await _a(this,this.stsTokenManager.getToken(this.auth,e));return qe(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return Cw(this,e)}reload(){return Rw(this)}_assign(e){this!==e&&(qe(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>Object.assign({},t)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new Zr(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){qe(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let n=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),n=!0),t&&await Bi(this),await this.auth._persistUserIfCurrent(this),n&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(_s(this.auth.app))return Promise.reject(Ks(this.auth));const e=await this.getIdToken();return await _a(this,Aw(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var n,a,i,o,c,d,h,m;const x=(n=t.displayName)!==null&&n!==void 0?n:void 0,f=(a=t.email)!==null&&a!==void 0?a:void 0,k=(i=t.phoneNumber)!==null&&i!==void 0?i:void 0,A=(o=t.photoURL)!==null&&o!==void 0?o:void 0,D=(c=t.tenantId)!==null&&c!==void 0?c:void 0,T=(d=t._redirectEventId)!==null&&d!==void 0?d:void 0,H=(h=t.createdAt)!==null&&h!==void 0?h:void 0,L=(m=t.lastLoginAt)!==null&&m!==void 0?m:void 0,{uid:E,emailVerified:M,isAnonymous:ee,providerData:C,stsTokenManager:v}=t;qe(E&&v,e,"internal-error");const p=yn.fromJSON(this.name,v);qe(typeof E=="string",e,"internal-error"),fs(x,e.name),fs(f,e.name),qe(typeof M=="boolean",e,"internal-error"),qe(typeof ee=="boolean",e,"internal-error"),fs(k,e.name),fs(A,e.name),fs(D,e.name),fs(T,e.name),fs(H,e.name),fs(L,e.name);const w=new Zr({uid:E,auth:e,email:f,emailVerified:M,displayName:x,isAnonymous:ee,photoURL:A,phoneNumber:k,tenantId:D,stsTokenManager:p,createdAt:H,lastLoginAt:L});return C&&Array.isArray(C)&&(w.providerData=C.map(N=>Object.assign({},N))),T&&(w._redirectEventId=T),w}static async _fromIdTokenResponse(e,t,n=!1){const a=new yn;a.updateFromServerResponse(t);const i=new Zr({uid:t.localId,auth:e,stsTokenManager:a,isAnonymous:n});return await Bi(i),i}static async _fromGetAccountInfoResponse(e,t,n){const a=t.users[0];qe(a.localId!==void 0,"internal-error");const i=a.providerUserInfo!==void 0?qg(a.providerUserInfo):[],o=!(a.email&&a.passwordHash)&&!(i!=null&&i.length),c=new yn;c.updateFromIdToken(n);const d=new Zr({uid:a.localId,auth:e,stsTokenManager:c,isAnonymous:o}),h={uid:a.localId,displayName:a.displayName||null,photoURL:a.photoUrl||null,email:a.email||null,emailVerified:a.emailVerified||!1,phoneNumber:a.phoneNumber||null,tenantId:a.tenantId||null,providerData:i,metadata:new Pl(a.createdAt,a.lastLoginAt),isAnonymous:!(a.email&&a.passwordHash)&&!(i!=null&&i.length)};return Object.assign(d,h),d}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qu=new Map;function es(s){hs(s instanceof Function,"Expected a class definition");let e=qu.get(s);return e?(hs(e instanceof s,"Instance stored in cache mismatched with class"),e):(e=new s,qu.set(s,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wg{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return t===void 0?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}Wg.type="NONE";const Wu=Wg;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ki(s,e,t){return`firebase:${s}:${e}:${t}`}class bn{constructor(e,t,n){this.persistence=e,this.auth=t,this.userKey=n;const{config:a,name:i}=this.auth;this.fullUserKey=ki(this.userKey,a.apiKey,i),this.fullPersistenceKey=ki("persistence",a.apiKey,i),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);return e?Zr._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,n="authUser"){if(!t.length)return new bn(es(Wu),e,n);const a=(await Promise.all(t.map(async h=>{if(await h._isAvailable())return h}))).filter(h=>h);let i=a[0]||es(Wu);const o=ki(n,e.config.apiKey,e.name);let c=null;for(const h of t)try{const m=await h._get(o);if(m){const x=Zr._fromJSON(e,m);h!==i&&(c=x),i=h;break}}catch{}const d=a.filter(h=>h._shouldAllowMigration);return!i._shouldAllowMigration||!d.length?new bn(i,e,n):(i=d[0],c&&await i._set(o,c.toJSON()),await Promise.all(t.map(async h=>{if(h!==i)try{await h._remove(o)}catch{}})),new bn(i,e,n))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zu(s){const e=s.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(Kg(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(zg(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(Qg(e))return"Blackberry";if(Xg(e))return"Webos";if(Hg(e))return"Safari";if((e.includes("chrome/")||Gg(e))&&!e.includes("edge/"))return"Chrome";if(Yg(e))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,n=s.match(t);if((n==null?void 0:n.length)===2)return n[1]}return"Other"}function zg(s=Jt()){return/firefox\//i.test(s)}function Hg(s=Jt()){const e=s.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function Gg(s=Jt()){return/crios\//i.test(s)}function Kg(s=Jt()){return/iemobile/i.test(s)}function Yg(s=Jt()){return/android/i.test(s)}function Qg(s=Jt()){return/blackberry/i.test(s)}function Xg(s=Jt()){return/webos/i.test(s)}function Uc(s=Jt()){return/iphone|ipad|ipod/i.test(s)||/macintosh/i.test(s)&&/mobile/i.test(s)}function Vw(s=Jt()){var e;return Uc(s)&&!!(!((e=window.navigator)===null||e===void 0)&&e.standalone)}function Lw(){return Zx()&&document.documentMode===10}function Jg(s=Jt()){return Uc(s)||Yg(s)||Xg(s)||Qg(s)||/windows phone/i.test(s)||Kg(s)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Zg(s,e=[]){let t;switch(s){case"Browser":t=zu(Jt());break;case"Worker":t=`${zu(Jt())}-${s}`;break;default:t=s}const n=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${en}/${n}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fw{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const n=i=>new Promise((o,c)=>{try{const d=e(i);o(d)}catch(d){c(d)}});n.onAbort=t,this.queue.push(n);const a=this.queue.length-1;return()=>{this.queue[a]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const n of this.queue)await n(e),n.onAbort&&t.push(n.onAbort)}catch(n){t.reverse();for(const a of t)try{a()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:n==null?void 0:n.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Uw(s,e={}){return Un(s,"GET","/v2/passwordPolicy",Lc(s,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Bw=6;class qw{constructor(e){var t,n,a,i;const o=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(t=o.minPasswordLength)!==null&&t!==void 0?t:Bw,o.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=o.maxPasswordLength),o.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=o.containsLowercaseCharacter),o.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=o.containsUppercaseCharacter),o.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=o.containsNumericCharacter),o.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=o.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(a=(n=e.allowedNonAlphanumericCharacters)===null||n===void 0?void 0:n.join(""))!==null&&a!==void 0?a:"",this.forceUpgradeOnSignin=(i=e.forceUpgradeOnSignin)!==null&&i!==void 0?i:!1,this.schemaVersion=e.schemaVersion}validatePassword(e){var t,n,a,i,o,c;const d={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,d),this.validatePasswordCharacterOptions(e,d),d.isValid&&(d.isValid=(t=d.meetsMinPasswordLength)!==null&&t!==void 0?t:!0),d.isValid&&(d.isValid=(n=d.meetsMaxPasswordLength)!==null&&n!==void 0?n:!0),d.isValid&&(d.isValid=(a=d.containsLowercaseLetter)!==null&&a!==void 0?a:!0),d.isValid&&(d.isValid=(i=d.containsUppercaseLetter)!==null&&i!==void 0?i:!0),d.isValid&&(d.isValid=(o=d.containsNumericCharacter)!==null&&o!==void 0?o:!0),d.isValid&&(d.isValid=(c=d.containsNonAlphanumericCharacter)!==null&&c!==void 0?c:!0),d}validatePasswordLengthOptions(e,t){const n=this.customStrengthOptions.minPasswordLength,a=this.customStrengthOptions.maxPasswordLength;n&&(t.meetsMinPasswordLength=e.length>=n),a&&(t.meetsMaxPasswordLength=e.length<=a)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let n;for(let a=0;a<e.length;a++)n=e.charAt(a),this.updatePasswordCharacterOptionsStatuses(t,n>="a"&&n<="z",n>="A"&&n<="Z",n>="0"&&n<="9",this.allowedNonAlphanumericCharacters.includes(n))}updatePasswordCharacterOptionsStatuses(e,t,n,a,i){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=n)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=a)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ww{constructor(e,t,n,a){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=n,this.config=a,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Hu(this),this.idTokenSubscription=new Hu(this),this.beforeStateQueue=new Fw(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=Og,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=a.sdkClientVersion}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=es(t)),this._initializationPromise=this.queue(async()=>{var n,a;if(!this._deleted&&(this.persistenceManager=await bn.create(this,e),!this._deleted)){if(!((n=this._popupRedirectResolver)===null||n===void 0)&&n._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(t),this.lastNotifiedUid=((a=this.currentUser)===null||a===void 0?void 0:a.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const t=await Bg(this,{idToken:e}),n=await Zr._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(n)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var t;if(_s(this.app)){const o=this.app.settings.authIdToken;return o?new Promise(c=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(o).then(c,c))}):this.directlySetCurrentUser(null)}const n=await this.assertedPersistence.getCurrentUser();let a=n,i=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const o=(t=this.redirectUser)===null||t===void 0?void 0:t._redirectEventId,c=a==null?void 0:a._redirectEventId,d=await this.tryRedirectSignIn(e);(!o||o===c)&&(d!=null&&d.user)&&(a=d.user,i=!0)}if(!a)return this.directlySetCurrentUser(null);if(!a._redirectEventId){if(i)try{await this.beforeStateQueue.runMiddleware(a)}catch(o){a=n,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(o))}return a?this.reloadAndSetCurrentUserOrClear(a):this.directlySetCurrentUser(null)}return qe(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===a._redirectEventId?this.directlySetCurrentUser(a):this.reloadAndSetCurrentUserOrClear(a)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await Bi(e)}catch(t){if((t==null?void 0:t.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=_w()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(_s(this.app))return Promise.reject(Ks(this));const t=e?Zt(e):null;return t&&qe(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&qe(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return _s(this.app)?Promise.reject(Ks(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return _s(this.app)?Promise.reject(Ks(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(es(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await Uw(this),t=new qw(e);this.tenantId===null?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new $a("auth","Firebase",e())}onAuthStateChanged(e,t,n){return this.registerStateListener(this.authStateSubscription,e,t,n)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,n){return this.registerStateListener(this.idTokenSubscription,e,t,n)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const n=this.onAuthStateChanged(()=>{n(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){const t=await this.currentUser.getIdToken(),n={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};this.tenantId!=null&&(n.tenantId=this.tenantId),await Ow(this,n)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)===null||e===void 0?void 0:e.toJSON()}}async _setRedirectUser(e,t){const n=await this.getOrInitRedirectPersistenceManager(t);return e===null?n.removeCurrentUser():n.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&es(e)||this._popupRedirectResolver;qe(t,this,"argument-error"),this.redirectPersistenceManager=await bn.create(this,[es(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,n;return this._isInitialized&&await this.queue(async()=>{}),((t=this._currentUser)===null||t===void 0?void 0:t._redirectEventId)===e?this._currentUser:((n=this.redirectUser)===null||n===void 0?void 0:n._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const n=(t=(e=this.currentUser)===null||e===void 0?void 0:e.uid)!==null&&t!==void 0?t:null;this.lastNotifiedUid!==n&&(this.lastNotifiedUid=n,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,n,a){if(this._deleted)return()=>{};const i=typeof t=="function"?t:t.next.bind(t);let o=!1;const c=this._isInitialized?Promise.resolve():this._initializationPromise;if(qe(c,this,"internal-error"),c.then(()=>{o||i(this.currentUser)}),typeof t=="function"){const d=e.addObserver(t,n,a);return()=>{o=!0,d()}}else{const d=e.addObserver(t);return()=>{o=!0,d()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return qe(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=Zg(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);const n=await((e=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getHeartbeatsHeader());n&&(t["X-Firebase-Client"]=n);const a=await this._getAppCheckToken();return a&&(t["X-Firebase-AppCheck"]=a),t}async _getAppCheckToken(){var e;const t=await((e=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getToken());return t!=null&&t.error&&kw(`Error while retrieving App Check token: ${t.error}`),t==null?void 0:t.token}}function Bc(s){return Zt(s)}class Hu{constructor(e){this.auth=e,this.observer=null,this.addObserver=lf(t=>this.observer=t)}get next(){return qe(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let qc={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function zw(s){qc=s}function Hw(s){return qc.loadJS(s)}function Gw(){return qc.gapiScript}function Kw(s){return`__${s}${Math.floor(Math.random()*1e6)}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Yw(s,e){const t=ao(s,"auth");if(t.isInitialized()){const a=t.getImmediate(),i=t.getOptions();if(Ci(i,e??{}))return a;us(a,"already-initialized")}return t.initialize({options:e})}function Qw(s,e){const t=(e==null?void 0:e.persistence)||[],n=(Array.isArray(t)?t:[t]).map(es);e!=null&&e.errorMap&&s._updateErrorMap(e.errorMap),s._initializeWithPersistence(n,e==null?void 0:e.popupRedirectResolver)}function Xw(s,e,t){const n=Bc(s);qe(n._canInitEmulator,n,"emulator-config-failed"),qe(/^https?:\/\//.test(e),n,"invalid-emulator-scheme");const a=!1,i=e0(e),{host:o,port:c}=Jw(e),d=c===null?"":`:${c}`;n.config.emulator={url:`${i}//${o}${d}/`},n.settings.appVerificationDisabledForTesting=!0,n.emulatorConfig=Object.freeze({host:o,port:c,protocol:i.replace(":",""),options:Object.freeze({disableWarnings:a})}),Zw()}function e0(s){const e=s.indexOf(":");return e<0?"":s.substr(0,e+1)}function Jw(s){const e=e0(s),t=/(\/\/)?([^?#/]+)/.exec(s.substr(e.length));if(!t)return{host:"",port:null};const n=t[2].split("@").pop()||"",a=/^(\[[^\]]+\])(:|$)/.exec(n);if(a){const i=a[1];return{host:i,port:Gu(n.substr(i.length+1))}}else{const[i,o]=n.split(":");return{host:i,port:Gu(o)}}}function Gu(s){if(!s)return null;const e=Number(s);return isNaN(e)?null:e}function Zw(){function s(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",s):s())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class t0{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return Jr("not implemented")}_getIdTokenResponse(e){return Jr("not implemented")}_linkToIdToken(e,t){return Jr("not implemented")}_getReauthenticationResolver(e){return Jr("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function vn(s,e){return Tw(s,"POST","/v1/accounts:signInWithIdp",Lc(s,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const e1="http://localhost";class Zs extends t0{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new Zs(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):us("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:n,signInMethod:a}=t,i=Mc(t,["providerId","signInMethod"]);if(!n||!a)return null;const o=new Zs(n,a);return o.idToken=i.idToken||void 0,o.accessToken=i.accessToken||void 0,o.secret=i.secret,o.nonce=i.nonce,o.pendingToken=i.pendingToken||null,o}_getIdTokenResponse(e){const t=this.buildRequest();return vn(e,t)}_linkToIdToken(e,t){const n=this.buildRequest();return n.idToken=t,vn(e,n)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,vn(e,t)}buildRequest(){const e={requestUri:e1,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=Ra(t)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class r0{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qa extends r0{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vs extends qa{constructor(){super("facebook.com")}static credential(e){return Zs._fromParams({providerId:vs.PROVIDER_ID,signInMethod:vs.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return vs.credentialFromTaggedObject(e)}static credentialFromError(e){return vs.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return vs.credential(e.oauthAccessToken)}catch{return null}}}vs.FACEBOOK_SIGN_IN_METHOD="facebook.com";vs.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ws extends qa{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return Zs._fromParams({providerId:ws.PROVIDER_ID,signInMethod:ws.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return ws.credentialFromTaggedObject(e)}static credentialFromError(e){return ws.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:n}=e;if(!t&&!n)return null;try{return ws.credential(t,n)}catch{return null}}}ws.GOOGLE_SIGN_IN_METHOD="google.com";ws.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ks extends qa{constructor(){super("github.com")}static credential(e){return Zs._fromParams({providerId:ks.PROVIDER_ID,signInMethod:ks.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return ks.credentialFromTaggedObject(e)}static credentialFromError(e){return ks.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return ks.credential(e.oauthAccessToken)}catch{return null}}}ks.GITHUB_SIGN_IN_METHOD="github.com";ks.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ns extends qa{constructor(){super("twitter.com")}static credential(e,t){return Zs._fromParams({providerId:Ns.PROVIDER_ID,signInMethod:Ns.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return Ns.credentialFromTaggedObject(e)}static credentialFromError(e){return Ns.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:n}=e;if(!t||!n)return null;try{return Ns.credential(t,n)}catch{return null}}}Ns.TWITTER_SIGN_IN_METHOD="twitter.com";Ns.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class An{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,n,a=!1){const i=await Zr._fromIdTokenResponse(e,n,a),o=Ku(n);return new An({user:i,providerId:o,_tokenResponse:n,operationType:t})}static async _forOperation(e,t,n){await e._updateTokensIfNecessary(n,!0);const a=Ku(n);return new An({user:e,providerId:a,_tokenResponse:n,operationType:t})}}function Ku(s){return s.providerId?s.providerId:"phoneNumber"in s?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qi extends Br{constructor(e,t,n,a){var i;super(t.code,t.message),this.operationType=n,this.user=a,Object.setPrototypeOf(this,qi.prototype),this.customData={appName:e.name,tenantId:(i=e.tenantId)!==null&&i!==void 0?i:void 0,_serverResponse:t.customData._serverResponse,operationType:n}}static _fromErrorAndOperation(e,t,n,a){return new qi(e,t,n,a)}}function s0(s,e,t,n){return(e==="reauthenticate"?t._getReauthenticationResolver(s):t._getIdTokenResponse(s)).catch(i=>{throw i.code==="auth/multi-factor-auth-required"?qi._fromErrorAndOperation(s,i,e,n):i})}async function t1(s,e,t=!1){const n=await _a(s,e._linkToIdToken(s.auth,await s.getIdToken()),t);return An._forOperation(s,"link",n)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function r1(s,e,t=!1){const{auth:n}=s;if(_s(n.app))return Promise.reject(Ks(n));const a="reauthenticate";try{const i=await _a(s,s0(n,a,e,s),t);qe(i.idToken,n,"internal-error");const o=Fc(i.idToken);qe(o,n,"internal-error");const{sub:c}=o;return qe(s.uid===c,n,"user-mismatch"),An._forOperation(s,a,i)}catch(i){throw(i==null?void 0:i.code)==="auth/user-not-found"&&us(n,"user-mismatch"),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function s1(s,e,t=!1){if(_s(s.app))return Promise.reject(Ks(s));const n="signIn",a=await s0(s,n,e),i=await An._fromIdTokenResponse(s,n,a);return t||await s._updateCurrentUser(i.user),i}function n1(s,e,t,n){return Zt(s).onIdTokenChanged(e,t,n)}function a1(s,e,t){return Zt(s).beforeAuthStateChanged(e,t)}const Wi="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class n0{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(Wi,"1"),this.storage.removeItem(Wi),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const i1=1e3,o1=10;class a0 extends n0{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=Jg(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const n=this.storage.getItem(t),a=this.localCache[t];n!==a&&e(t,a,n)}}onStorageEvent(e,t=!1){if(!e.key){this.forAllChangedKeys((o,c,d)=>{this.notifyListeners(o,d)});return}const n=e.key;t?this.detachListener():this.stopPolling();const a=()=>{const o=this.storage.getItem(n);!t&&this.localCache[n]===o||this.notifyListeners(n,o)},i=this.storage.getItem(n);Lw()&&i!==e.newValue&&e.newValue!==e.oldValue?setTimeout(a,o1):a()}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const a of Array.from(n))a(t&&JSON.parse(t))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,n)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:n}),!0)})},i1)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}a0.type="LOCAL";const l1=a0;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class i0 extends n0{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}i0.type="SESSION";const o0=i0;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function c1(s){return Promise.all(s.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ko{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(a=>a.isListeningto(e));if(t)return t;const n=new ko(e);return this.receivers.push(n),n}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:n,eventType:a,data:i}=t.data,o=this.handlersMap[a];if(!(o!=null&&o.size))return;t.ports[0].postMessage({status:"ack",eventId:n,eventType:a});const c=Array.from(o).map(async h=>h(t.origin,i)),d=await c1(c);t.ports[0].postMessage({status:"done",eventId:n,eventType:a,response:d})}_subscribe(e,t){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),(!t||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}ko.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Wc(s="",e=10){let t="";for(let n=0;n<e;n++)t+=Math.floor(Math.random()*10);return s+t}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class d1{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,n=50){const a=typeof MessageChannel<"u"?new MessageChannel:null;if(!a)throw new Error("connection_unavailable");let i,o;return new Promise((c,d)=>{const h=Wc("",20);a.port1.start();const m=setTimeout(()=>{d(new Error("unsupported_event"))},n);o={messageChannel:a,onMessage(x){const f=x;if(f.data.eventId===h)switch(f.data.status){case"ack":clearTimeout(m),i=setTimeout(()=>{d(new Error("timeout"))},3e3);break;case"done":clearTimeout(i),c(f.data.response);break;default:clearTimeout(m),clearTimeout(i),d(new Error("invalid_response"));break}}},this.handlers.add(o),a.port1.addEventListener("message",o.onMessage),this.target.postMessage({eventType:e,eventId:h,data:t},[a.port2])}).finally(()=>{o&&this.removeMessageHandler(o)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Vr(){return window}function u1(s){Vr().location.href=s}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function l0(){return typeof Vr().WorkerGlobalScope<"u"&&typeof Vr().importScripts=="function"}async function h1(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function m1(){var s;return((s=navigator==null?void 0:navigator.serviceWorker)===null||s===void 0?void 0:s.controller)||null}function g1(){return l0()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const c0="firebaseLocalStorageDb",p1=1,zi="firebaseLocalStorage",d0="fbase_key";class Wa{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function No(s,e){return s.transaction([zi],e?"readwrite":"readonly").objectStore(zi)}function x1(){const s=indexedDB.deleteDatabase(c0);return new Wa(s).toPromise()}function Ml(){const s=indexedDB.open(c0,p1);return new Promise((e,t)=>{s.addEventListener("error",()=>{t(s.error)}),s.addEventListener("upgradeneeded",()=>{const n=s.result;try{n.createObjectStore(zi,{keyPath:d0})}catch(a){t(a)}}),s.addEventListener("success",async()=>{const n=s.result;n.objectStoreNames.contains(zi)?e(n):(n.close(),await x1(),e(await Ml()))})})}async function Yu(s,e,t){const n=No(s,!0).put({[d0]:e,value:t});return new Wa(n).toPromise()}async function f1(s,e){const t=No(s,!1).get(e),n=await new Wa(t).toPromise();return n===void 0?null:n.value}function Qu(s,e){const t=No(s,!0).delete(e);return new Wa(t).toPromise()}const y1=800,b1=3;class u0{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await Ml(),this.db)}async _withRetries(e){let t=0;for(;;)try{const n=await this._openDb();return await e(n)}catch(n){if(t++>b1)throw n;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return l0()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=ko._getInstance(g1()),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){var e,t;if(this.activeServiceWorker=await h1(),!this.activeServiceWorker)return;this.sender=new d1(this.activeServiceWorker);const n=await this.sender._send("ping",{},800);n&&!((e=n[0])===null||e===void 0)&&e.fulfilled&&!((t=n[0])===null||t===void 0)&&t.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||m1()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await Ml();return await Yu(e,Wi,"1"),await Qu(e,Wi),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(n=>Yu(n,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(n=>f1(n,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>Qu(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(a=>{const i=No(a,!1).getAll();return new Wa(i).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const t=[],n=new Set;if(e.length!==0)for(const{fbase_key:a,value:i}of e)n.add(a),JSON.stringify(this.localCache[a])!==JSON.stringify(i)&&(this.notifyListeners(a,i),t.push(a));for(const a of Object.keys(this.localCache))this.localCache[a]&&!n.has(a)&&(this.notifyListeners(a,null),t.push(a));return t}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const a of Array.from(n))a(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),y1)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}u0.type="LOCAL";const v1=u0;new Ba(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function w1(s,e){return e?es(e):(qe(s._popupRedirectResolver,s,"argument-error"),s._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zc extends t0{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return vn(e,this._buildIdpRequest())}_linkToIdToken(e,t){return vn(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return vn(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function k1(s){return s1(s.auth,new zc(s),s.bypassAuthState)}function N1(s){const{auth:e,user:t}=s;return qe(t,e,"internal-error"),r1(t,new zc(s),s.bypassAuthState)}async function j1(s){const{auth:e,user:t}=s;return qe(t,e,"internal-error"),t1(t,new zc(s),s.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class h0{constructor(e,t,n,a,i=!1){this.auth=e,this.resolver=n,this.user=a,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(n){this.reject(n)}})}async onAuthEvent(e){const{urlResponse:t,sessionId:n,postBody:a,tenantId:i,error:o,type:c}=e;if(o){this.reject(o);return}const d={auth:this.auth,requestUri:t,sessionId:n,tenantId:i||void 0,postBody:a||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(c)(d))}catch(h){this.reject(h)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return k1;case"linkViaPopup":case"linkViaRedirect":return j1;case"reauthViaPopup":case"reauthViaRedirect":return N1;default:us(this.auth,"internal-error")}}resolve(e){hs(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){hs(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _1=new Ba(2e3,1e4);class gn extends h0{constructor(e,t,n,a,i){super(e,t,a,i),this.provider=n,this.authWindow=null,this.pollId=null,gn.currentPopupAction&&gn.currentPopupAction.cancel(),gn.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return qe(e,this.auth,"internal-error"),e}async onExecution(){hs(this.filter.length===1,"Popup operations only handle one event");const e=Wc();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(t=>{this.reject(t)}),this.resolver._isIframeWebStorageSupported(this.auth,t=>{t||this.reject(Or(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)===null||e===void 0?void 0:e.associatedEvent)||null}cancel(){this.reject(Or(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,gn.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,n;if(!((n=(t=this.authWindow)===null||t===void 0?void 0:t.window)===null||n===void 0)&&n.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(Or(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,_1.get())};e()}}gn.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const E1="pendingRedirect",Ni=new Map;class I1 extends h0{constructor(e,t,n=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,n),this.eventId=null}async execute(){let e=Ni.get(this.auth._key());if(!e){try{const n=await T1(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(n)}catch(t){e=()=>Promise.reject(t)}Ni.set(this.auth._key(),e)}return this.bypassAuthState||Ni.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function T1(s,e){const t=C1(e),n=A1(s);if(!await n._isAvailable())return!1;const a=await n._get(t)==="true";return await n._remove(t),a}function S1(s,e){Ni.set(s._key(),e)}function A1(s){return es(s._redirectPersistence)}function C1(s){return ki(E1,s.config.apiKey,s.name)}async function D1(s,e,t=!1){if(_s(s.app))return Promise.reject(Ks(s));const n=Bc(s),a=w1(n,e),o=await new I1(n,a,t).execute();return o&&!t&&(delete o.user._redirectEventId,await n._persistUserIfCurrent(o.user),await n._setRedirectUser(null,e)),o}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $1=10*60*1e3;class R1{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(n=>{this.isEventForConsumer(e,n)&&(t=!0,this.sendToConsumer(e,n),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!P1(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var n;if(e.error&&!m0(e)){const a=((n=e.error.code)===null||n===void 0?void 0:n.split("auth/")[1])||"internal-error";t.onError(Or(this.auth,a))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const n=t.eventId===null||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&n}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=$1&&this.cachedEventUids.clear(),this.cachedEventUids.has(Xu(e))}saveEventToCache(e){this.cachedEventUids.add(Xu(e)),this.lastProcessedEventTime=Date.now()}}function Xu(s){return[s.type,s.eventId,s.sessionId,s.tenantId].filter(e=>e).join("-")}function m0({type:s,error:e}){return s==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function P1(s){switch(s.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return m0(s);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function M1(s,e={}){return Un(s,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const O1=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,V1=/^https?/;async function L1(s){if(s.config.emulator)return;const{authorizedDomains:e}=await M1(s);for(const t of e)try{if(F1(t))return}catch{}us(s,"unauthorized-domain")}function F1(s){const e=Rl(),{protocol:t,hostname:n}=new URL(e);if(s.startsWith("chrome-extension://")){const o=new URL(s);return o.hostname===""&&n===""?t==="chrome-extension:"&&s.replace("chrome-extension://","")===e.replace("chrome-extension://",""):t==="chrome-extension:"&&o.hostname===n}if(!V1.test(t))return!1;if(O1.test(s))return n===s;const a=s.replace(/\./g,"\\.");return new RegExp("^(.+\\."+a+"|"+a+")$","i").test(n)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const U1=new Ba(3e4,6e4);function Ju(){const s=Vr().___jsl;if(s!=null&&s.H){for(const e of Object.keys(s.H))if(s.H[e].r=s.H[e].r||[],s.H[e].L=s.H[e].L||[],s.H[e].r=[...s.H[e].L],s.CP)for(let t=0;t<s.CP.length;t++)s.CP[t]=null}}function B1(s){return new Promise((e,t)=>{var n,a,i;function o(){Ju(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{Ju(),t(Or(s,"network-request-failed"))},timeout:U1.get()})}if(!((a=(n=Vr().gapi)===null||n===void 0?void 0:n.iframes)===null||a===void 0)&&a.Iframe)e(gapi.iframes.getContext());else if(!((i=Vr().gapi)===null||i===void 0)&&i.load)o();else{const c=Kw("iframefcb");return Vr()[c]=()=>{gapi.load?o():t(Or(s,"network-request-failed"))},Hw(`${Gw()}?onload=${c}`).catch(d=>t(d))}}).catch(e=>{throw ji=null,e})}let ji=null;function q1(s){return ji=ji||B1(s),ji}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const W1=new Ba(5e3,15e3),z1="__/auth/iframe",H1="emulator/auth/iframe",G1={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},K1=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function Y1(s){const e=s.config;qe(e.authDomain,s,"auth-domain-config-required");const t=e.emulator?Vc(e,H1):`https://${s.config.authDomain}/${z1}`,n={apiKey:e.apiKey,appName:s.name,v:en},a=K1.get(s.config.apiHost);a&&(n.eid=a);const i=s._getFrameworks();return i.length&&(n.fw=i.join(",")),`${t}?${Ra(n).slice(1)}`}async function Q1(s){const e=await q1(s),t=Vr().gapi;return qe(t,s,"internal-error"),e.open({where:document.body,url:Y1(s),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:G1,dontclear:!0},n=>new Promise(async(a,i)=>{await n.restyle({setHideOnLeave:!1});const o=Or(s,"network-request-failed"),c=Vr().setTimeout(()=>{i(o)},W1.get());function d(){Vr().clearTimeout(c),a(n)}n.ping(d).then(d,()=>{i(o)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const X1={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},J1=500,Z1=600,ek="_blank",tk="http://localhost";class Zu{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function rk(s,e,t,n=J1,a=Z1){const i=Math.max((window.screen.availHeight-a)/2,0).toString(),o=Math.max((window.screen.availWidth-n)/2,0).toString();let c="";const d=Object.assign(Object.assign({},X1),{width:n.toString(),height:a.toString(),top:i,left:o}),h=Jt().toLowerCase();t&&(c=Gg(h)?ek:t),zg(h)&&(e=e||tk,d.scrollbars="yes");const m=Object.entries(d).reduce((f,[k,A])=>`${f}${k}=${A},`,"");if(Vw(h)&&c!=="_self")return sk(e||"",c),new Zu(null);const x=window.open(e||"",c,m);qe(x,s,"popup-blocked");try{x.focus()}catch{}return new Zu(x)}function sk(s,e){const t=document.createElement("a");t.href=s,t.target=e;const n=document.createEvent("MouseEvent");n.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),t.dispatchEvent(n)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nk="__/auth/handler",ak="emulator/auth/handler",ik=encodeURIComponent("fac");async function eh(s,e,t,n,a,i){qe(s.config.authDomain,s,"auth-domain-config-required"),qe(s.config.apiKey,s,"invalid-api-key");const o={apiKey:s.config.apiKey,appName:s.name,authType:t,redirectUrl:n,v:en,eventId:a};if(e instanceof r0){e.setDefaultLanguage(s.languageCode),o.providerId=e.providerId||"",of(e.getCustomParameters())||(o.customParameters=JSON.stringify(e.getCustomParameters()));for(const[m,x]of Object.entries({}))o[m]=x}if(e instanceof qa){const m=e.getScopes().filter(x=>x!=="");m.length>0&&(o.scopes=m.join(","))}s.tenantId&&(o.tid=s.tenantId);const c=o;for(const m of Object.keys(c))c[m]===void 0&&delete c[m];const d=await s._getAppCheckToken(),h=d?`#${ik}=${encodeURIComponent(d)}`:"";return`${ok(s)}?${Ra(c).slice(1)}${h}`}function ok({config:s}){return s.emulator?Vc(s,ak):`https://${s.authDomain}/${nk}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rl="webStorageSupport";class lk{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=o0,this._completeRedirectFn=D1,this._overrideRedirectResult=S1}async _openPopup(e,t,n,a){var i;hs((i=this.eventManagers[e._key()])===null||i===void 0?void 0:i.manager,"_initialize() not called before _openPopup()");const o=await eh(e,t,n,Rl(),a);return rk(e,o,Wc())}async _openRedirect(e,t,n,a){await this._originValidation(e);const i=await eh(e,t,n,Rl(),a);return u1(i),new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:a,promise:i}=this.eventManagers[t];return a?Promise.resolve(a):(hs(i,"If manager is not set, promise should be"),i)}const n=this.initAndGetManager(e);return this.eventManagers[t]={promise:n},n.catch(()=>{delete this.eventManagers[t]}),n}async initAndGetManager(e){const t=await Q1(e),n=new R1(e);return t.register("authEvent",a=>(qe(a==null?void 0:a.authEvent,e,"invalid-auth-event"),{status:n.onEvent(a.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:n},this.iframes[e._key()]=t,n}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(rl,{type:rl},a=>{var i;const o=(i=a==null?void 0:a[0])===null||i===void 0?void 0:i[rl];o!==void 0&&t(!!o),us(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=L1(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return Jg()||Hg()||Uc()}}const ck=lk;var th="@firebase/auth",rh="1.7.9";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dk{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)===null||e===void 0?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(n=>{e((n==null?void 0:n.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){qe(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function uk(s){switch(s){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function hk(s){Ys(new Ds("auth",(e,{options:t})=>{const n=e.getProvider("app").getImmediate(),a=e.getProvider("heartbeat"),i=e.getProvider("app-check-internal"),{apiKey:o,authDomain:c}=n.options;qe(o&&!o.includes(":"),"invalid-api-key",{appName:n.name});const d={apiKey:o,authDomain:c,clientPlatform:s,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:Zg(s)},h=new Ww(n,a,i,d);return Qw(h,t),h},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,n)=>{e.getProvider("auth-internal").initialize()})),Ys(new Ds("auth-internal",e=>{const t=Bc(e.getProvider("auth").getImmediate());return(n=>new dk(n))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),Rr(th,rh,uk(s)),Rr(th,rh,"esm2017")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mk=5*60,gk=im("authIdTokenMaxAge")||mk;let sh=null;const pk=s=>async e=>{const t=e&&await e.getIdTokenResult(),n=t&&(new Date().getTime()-Date.parse(t.issuedAtTime))/1e3;if(n&&n>gk)return;const a=t==null?void 0:t.token;sh!==a&&(sh=a,await fetch(s,{method:a?"POST":"DELETE",headers:a?{Authorization:`Bearer ${a}`}:{}}))};function xk(s=Zl()){const e=ao(s,"auth");if(e.isInitialized())return e.getImmediate();const t=Yw(s,{popupRedirectResolver:ck,persistence:[v1,l1,o0]}),n=im("authTokenSyncURL");if(n&&typeof isSecureContext=="boolean"&&isSecureContext){const i=new URL(n,location.origin);if(location.origin===i.origin){const o=pk(i.toString());a1(t,o,()=>o(t.currentUser)),n1(t,c=>o(c))}}const a=sm("auth");return a&&Xw(t,`http://${a}`),t}function fk(){var s,e;return(e=(s=document.getElementsByTagName("head"))===null||s===void 0?void 0:s[0])!==null&&e!==void 0?e:document}zw({loadJS(s){return new Promise((e,t)=>{const n=document.createElement("script");n.setAttribute("src",s),n.onload=e,n.onerror=a=>{const i=Or("internal-error");i.customData=a,t(i)},n.type="text/javascript",n.charset="UTF-8",fk().appendChild(n)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});hk("Browser");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const g0="firebasestorage.googleapis.com",yk="storageBucket",bk=2*60*1e3,vk=10*60*1e3;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qr extends Br{constructor(e,t,n=0){super(sl(e),`Firebase Storage: ${t} (${sl(e)})`),this.status_=n,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,qr.prototype)}get status(){return this.status_}set status(e){this.status_=e}_codeEquals(e){return sl(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message=`${this._baseMessage}
${this.customData.serverResponse}`:this.message=this._baseMessage}}var Fr;(function(s){s.UNKNOWN="unknown",s.OBJECT_NOT_FOUND="object-not-found",s.BUCKET_NOT_FOUND="bucket-not-found",s.PROJECT_NOT_FOUND="project-not-found",s.QUOTA_EXCEEDED="quota-exceeded",s.UNAUTHENTICATED="unauthenticated",s.UNAUTHORIZED="unauthorized",s.UNAUTHORIZED_APP="unauthorized-app",s.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",s.INVALID_CHECKSUM="invalid-checksum",s.CANCELED="canceled",s.INVALID_EVENT_NAME="invalid-event-name",s.INVALID_URL="invalid-url",s.INVALID_DEFAULT_BUCKET="invalid-default-bucket",s.NO_DEFAULT_BUCKET="no-default-bucket",s.CANNOT_SLICE_BLOB="cannot-slice-blob",s.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",s.NO_DOWNLOAD_URL="no-download-url",s.INVALID_ARGUMENT="invalid-argument",s.INVALID_ARGUMENT_COUNT="invalid-argument-count",s.APP_DELETED="app-deleted",s.INVALID_ROOT_OPERATION="invalid-root-operation",s.INVALID_FORMAT="invalid-format",s.INTERNAL_ERROR="internal-error",s.UNSUPPORTED_ENVIRONMENT="unsupported-environment"})(Fr||(Fr={}));function sl(s){return"storage/"+s}function wk(){const s="An unknown error occurred, please check the error payload for server response.";return new qr(Fr.UNKNOWN,s)}function kk(){return new qr(Fr.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function Nk(){return new qr(Fr.CANCELED,"User canceled the upload/download.")}function jk(s){return new qr(Fr.INVALID_URL,"Invalid URL '"+s+"'.")}function _k(s){return new qr(Fr.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+s+"'.")}function nh(s){return new qr(Fr.INVALID_ARGUMENT,s)}function p0(){return new qr(Fr.APP_DELETED,"The Firebase app was deleted.")}function Ek(s){return new qr(Fr.INVALID_ROOT_OPERATION,"The operation '"+s+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Er{constructor(e,t){this.bucket=e,this.path_=t}get path(){return this.path_}get isRoot(){return this.path.length===0}fullServerUrl(){const e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(e,t){let n;try{n=Er.makeFromUrl(e,t)}catch{return new Er(e,"")}if(n.path==="")return n;throw _k(e)}static makeFromUrl(e,t){let n=null;const a="([A-Za-z0-9.\\-_]+)";function i(M){M.path.charAt(M.path.length-1)==="/"&&(M.path_=M.path_.slice(0,-1))}const o="(/(.*))?$",c=new RegExp("^gs://"+a+o,"i"),d={bucket:1,path:3};function h(M){M.path_=decodeURIComponent(M.path)}const m="v[A-Za-z0-9_]+",x=t.replace(/[.]/g,"\\."),f="(/([^?#]*).*)?$",k=new RegExp(`^https?://${x}/${m}/b/${a}/o${f}`,"i"),A={bucket:1,path:3},D=t===g0?"(?:storage.googleapis.com|storage.cloud.google.com)":t,T="([^?#]*)",H=new RegExp(`^https?://${D}/${a}/${T}`,"i"),E=[{regex:c,indices:d,postModify:i},{regex:k,indices:A,postModify:h},{regex:H,indices:{bucket:1,path:2},postModify:h}];for(let M=0;M<E.length;M++){const ee=E[M],C=ee.regex.exec(e);if(C){const v=C[ee.indices.bucket];let p=C[ee.indices.path];p||(p=""),n=new Er(v,p),ee.postModify(n);break}}if(n==null)throw jk(e);return n}}class Ik{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(e=!1){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Tk(s,e,t){let n=1,a=null,i=null,o=!1,c=0;function d(){return c===2}let h=!1;function m(...T){h||(h=!0,e.apply(null,T))}function x(T){a=setTimeout(()=>{a=null,s(k,d())},T)}function f(){i&&clearTimeout(i)}function k(T,...H){if(h){f();return}if(T){f(),m.call(null,T,...H);return}if(d()||o){f(),m.call(null,T,...H);return}n<64&&(n*=2);let E;c===1?(c=2,E=0):E=(n+Math.random())*1e3,x(E)}let A=!1;function D(T){A||(A=!0,f(),!h&&(a!==null?(T||(c=2),clearTimeout(a),x(0)):T||(c=1)))}return x(0),i=setTimeout(()=>{o=!0,D(!0)},t),D}function Sk(s){s(!1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ak(s){return s!==void 0}function ah(s,e,t,n){if(n<e)throw nh(`Invalid value for '${s}'. Expected ${e} or greater.`);if(n>t)throw nh(`Invalid value for '${s}'. Expected ${t} or less.`)}function Ck(s){const e=encodeURIComponent;let t="?";for(const n in s)if(s.hasOwnProperty(n)){const a=e(n)+"="+e(s[n]);t=t+a+"&"}return t=t.slice(0,-1),t}var Hi;(function(s){s[s.NO_ERROR=0]="NO_ERROR",s[s.NETWORK_ERROR=1]="NETWORK_ERROR",s[s.ABORT=2]="ABORT"})(Hi||(Hi={}));/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Dk(s,e){const t=s>=500&&s<600,a=[408,429].indexOf(s)!==-1,i=e.indexOf(s)!==-1;return t||a||i}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $k{constructor(e,t,n,a,i,o,c,d,h,m,x,f=!0){this.url_=e,this.method_=t,this.headers_=n,this.body_=a,this.successCodes_=i,this.additionalRetryCodes_=o,this.callback_=c,this.errorCallback_=d,this.timeout_=h,this.progressCallback_=m,this.connectionFactory_=x,this.retry=f,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((k,A)=>{this.resolve_=k,this.reject_=A,this.start_()})}start_(){const e=(n,a)=>{if(a){n(!1,new di(!1,null,!0));return}const i=this.connectionFactory_();this.pendingConnection_=i;const o=c=>{const d=c.loaded,h=c.lengthComputable?c.total:-1;this.progressCallback_!==null&&this.progressCallback_(d,h)};this.progressCallback_!==null&&i.addUploadProgressListener(o),i.send(this.url_,this.method_,this.body_,this.headers_).then(()=>{this.progressCallback_!==null&&i.removeUploadProgressListener(o),this.pendingConnection_=null;const c=i.getErrorCode()===Hi.NO_ERROR,d=i.getStatus();if(!c||Dk(d,this.additionalRetryCodes_)&&this.retry){const m=i.getErrorCode()===Hi.ABORT;n(!1,new di(!1,null,m));return}const h=this.successCodes_.indexOf(d)!==-1;n(!0,new di(h,i))})},t=(n,a)=>{const i=this.resolve_,o=this.reject_,c=a.connection;if(a.wasSuccessCode)try{const d=this.callback_(c,c.getResponse());Ak(d)?i(d):i()}catch(d){o(d)}else if(c!==null){const d=wk();d.serverResponse=c.getErrorText(),this.errorCallback_?o(this.errorCallback_(c,d)):o(d)}else if(a.canceled){const d=this.appDelete_?p0():Nk();o(d)}else{const d=kk();o(d)}};this.canceled_?t(!1,new di(!1,null,!0)):this.backoffId_=Tk(e,t,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,this.backoffId_!==null&&Sk(this.backoffId_),this.pendingConnection_!==null&&this.pendingConnection_.abort()}}class di{constructor(e,t,n){this.wasSuccessCode=e,this.connection=t,this.canceled=!!n}}function Rk(s,e){e!==null&&e.length>0&&(s.Authorization="Firebase "+e)}function Pk(s,e){s["X-Firebase-Storage-Version"]="webjs/"+(e??"AppManager")}function Mk(s,e){e&&(s["X-Firebase-GMPID"]=e)}function Ok(s,e){e!==null&&(s["X-Firebase-AppCheck"]=e)}function Vk(s,e,t,n,a,i,o=!0){const c=Ck(s.urlParams),d=s.url+c,h=Object.assign({},s.headers);return Mk(h,e),Rk(h,t),Pk(h,i),Ok(h,n),new $k(d,s.method,h,s.body,s.successCodes,s.additionalRetryCodes,s.handler,s.errorHandler,s.timeout,s.progressCallback,a,o)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Lk(s){if(s.length===0)return null;const e=s.lastIndexOf("/");return e===-1?"":s.slice(0,e)}function Fk(s){const e=s.lastIndexOf("/",s.length-2);return e===-1?s:s.slice(e+1)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gi{constructor(e,t){this._service=e,t instanceof Er?this._location=t:this._location=Er.makeFromUrl(t,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,t){return new Gi(e,t)}get root(){const e=new Er(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return Fk(this._location.path)}get storage(){return this._service}get parent(){const e=Lk(this._location.path);if(e===null)return null;const t=new Er(this._location.bucket,e);return new Gi(this._service,t)}_throwIfRoot(e){if(this._location.path==="")throw Ek(e)}}function ih(s,e){const t=e==null?void 0:e[yk];return t==null?null:Er.makeFromBucketSpec(t,s)}function Uk(s,e,t,n={}){s.host=`${e}:${t}`,s._protocol="http";const{mockUserToken:a}=n;a&&(s._overrideAuthToken=typeof a=="string"?a:om(a,s.app.options.projectId))}class Bk{constructor(e,t,n,a,i){this.app=e,this._authProvider=t,this._appCheckProvider=n,this._url=a,this._firebaseVersion=i,this._bucket=null,this._host=g0,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=bk,this._maxUploadRetryTime=vk,this._requests=new Set,a!=null?this._bucket=Er.makeFromBucketSpec(a,this._host):this._bucket=ih(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,this._url!=null?this._bucket=Er.makeFromBucketSpec(this._url,e):this._bucket=ih(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){ah("time",0,Number.POSITIVE_INFINITY,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){ah("time",0,Number.POSITIVE_INFINITY,e),this._maxOperationRetryTime=e}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const e=this._authProvider.getImmediate({optional:!0});if(e){const t=await e.getToken();if(t!==null)return t.accessToken}return null}async _getAppCheckToken(){const e=this._appCheckProvider.getImmediate({optional:!0});return e?(await e.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(e=>e.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new Gi(this,e)}_makeRequest(e,t,n,a,i=!0){if(this._deleted)return new Ik(p0());{const o=Vk(e,this._appId,n,a,t,this._firebaseVersion,i);return this._requests.add(o),o.getPromise().then(()=>this._requests.delete(o),()=>this._requests.delete(o)),o}}async makeRequestWithTokens(e,t){const[n,a]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,t,n,a).getPromise()}}const oh="@firebase/storage",lh="0.13.2";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const x0="storage";function qk(s=Zl(),e){s=Zt(s);const n=ao(s,x0).getImmediate({identifier:e}),a=nm("storage");return a&&Wk(n,...a),n}function Wk(s,e,t,n={}){Uk(s,e,t,n)}function zk(s,{instanceIdentifier:e}){const t=s.getProvider("app").getImmediate(),n=s.getProvider("auth-internal"),a=s.getProvider("app-check-internal");return new Bk(t,n,a,e,en)}function Hk(){Ys(new Ds(x0,zk,"PUBLIC").setMultipleInstances(!0)),Rr(oh,lh,""),Rr(oh,lh,"esm2017")}Hk();const Kr={apiKey:"AIzaSyAwXWcGulx8NIxWhi4XubIwh_RDNeCpHr8",authDomain:"apevault-teams.firebaseapp.com",projectId:"apevault-teams",storageBucket:"apevault-teams.firebasestorage.app",messagingSenderId:"515829779788",appId:"1:515829779788:web:d001cd40196ab1995893e9"};console.log("Firebase config check:",{hasApiKey:!!Kr.apiKey&&Kr.apiKey!=="your-api-key",authDomain:Kr.authDomain,projectId:Kr.projectId,hasStorageBucket:!!Kr.storageBucket&&Kr.storageBucket!=="your-storage-bucket",hasAppId:!!Kr.appId&&Kr.appId!=="your-app-id"});console.log("Raw env values:",{VITE_FIREBASE_API_KEY:"AIzaSyAwXWcGulx8NIxWhi4XubIwh_RDNeCpHr8",VITE_FIREBASE_AUTH_DOMAIN:"apevault-teams.firebaseapp.com",VITE_FIREBASE_PROJECT_ID:"apevault-teams",VITE_FIREBASE_STORAGE_BUCKET:"apevault-teams.firebasestorage.app"});const Hc=dm(Kr);xk(Hc);const Re=rw(Hc);qk(Hc);console.log("Firestore db initialized:",!!Re);const Ol={1:"Dex",2:"Enowk",3:"Xenia",4:"Olenka",5:"Sydney"},Cn=new Map,gt=s=>{var t,n;const e=Cn.get(s);return e!==void 0?e||Ol[s]||((t=De.find(a=>a.id===s))==null?void 0:t.login)||s:Ol[s]||((n=De.find(a=>a.id===s))==null?void 0:n.login)||s},ss=async s=>{var e;try{const t=await yj(s);if(t)return Cn.set(s,t),t;const n=Ol[s]||((e=De.find(a=>a.id===s))==null?void 0:e.login)||s;return Cn.set(s,null),n}catch(t){return console.error("Error fetching user nickname:",t),gt(s)}},Vl=s=>{Cn.delete(s)},ch=()=>{Cn.clear()},f0=s=>{const[e,t]=I.useState(()=>gt(s));return I.useEffect(()=>{Cn.has(s)||ss(s).then(a=>t(a));const n=a=>{const i=a,{userId:o}=i.detail||{};(!o||o===s)&&t(gt(s))};return window.addEventListener("nicknameUpdated",n),()=>window.removeEventListener("nicknameUpdated",n)},[s]),e};function Ki(s){"@babel/helpers - typeof";return Ki=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ki(s)}function Ur(s){if(s===null||s===!0||s===!1)return NaN;var e=Number(s);return isNaN(e)?e:e<0?Math.ceil(e):Math.floor(e)}function Nt(s,e){if(e.length<s)throw new TypeError(s+" argument"+(s>1?"s":"")+" required, but only "+e.length+" present")}function Ot(s){Nt(1,arguments);var e=Object.prototype.toString.call(s);return s instanceof Date||Ki(s)==="object"&&e==="[object Date]"?new Date(s.getTime()):typeof s=="number"||e==="[object Number]"?new Date(s):((typeof s=="string"||e==="[object String]")&&typeof console<"u"&&(console.warn("Starting with v2.0.0-beta.1 date-fns doesn't accept strings as date arguments. Please use `parseISO` to parse strings. See: https://github.com/date-fns/date-fns/blob/master/docs/upgradeGuide.md#string-arguments"),console.warn(new Error().stack)),new Date(NaN))}function Gk(s,e){Nt(2,arguments);var t=Ot(s).getTime(),n=Ur(e);return new Date(t+n)}var Kk={};function Bn(){return Kk}function Yk(s,e){var t,n,a,i,o,c,d,h;Nt(1,arguments);var m=Bn(),x=Ur((t=(n=(a=(i=e==null?void 0:e.weekStartsOn)!==null&&i!==void 0?i:e==null||(o=e.locale)===null||o===void 0||(c=o.options)===null||c===void 0?void 0:c.weekStartsOn)!==null&&a!==void 0?a:m.weekStartsOn)!==null&&n!==void 0?n:(d=m.locale)===null||d===void 0||(h=d.options)===null||h===void 0?void 0:h.weekStartsOn)!==null&&t!==void 0?t:0);if(!(x>=0&&x<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");var f=Ot(s),k=f.getDay(),A=(k<x?7:0)+k-x;return f.setDate(f.getDate()-A),f.setHours(0,0,0,0),f}function Qk(s){var e=new Date(Date.UTC(s.getFullYear(),s.getMonth(),s.getDate(),s.getHours(),s.getMinutes(),s.getSeconds(),s.getMilliseconds()));return e.setUTCFullYear(s.getFullYear()),s.getTime()-e.getTime()}function dh(s){Nt(1,arguments);var e=Ot(s);return e.setHours(0,0,0,0),e}var y0=6e4,b0=36e5;function Xk(s,e){Nt(2,arguments);var t=dh(s),n=dh(e);return t.getTime()===n.getTime()}function Jk(s){return Nt(1,arguments),s instanceof Date||Ki(s)==="object"&&Object.prototype.toString.call(s)==="[object Date]"}function Zk(s){if(Nt(1,arguments),!Jk(s)&&typeof s!="number")return!1;var e=Ot(s);return!isNaN(Number(e))}function eN(s,e){var t;Nt(1,arguments);var n=s||{},a=Ot(n.start),i=Ot(n.end),o=i.getTime();if(!(a.getTime()<=o))throw new RangeError("Invalid interval");var c=[],d=a;d.setHours(0,0,0,0);var h=Number((t=void 0)!==null&&t!==void 0?t:1);if(h<1||isNaN(h))throw new RangeError("`options.step` must be a number greater than 1");for(;d.getTime()<=o;)c.push(Ot(d)),d.setDate(d.getDate()+h),d.setHours(0,0,0,0);return c}function tN(s,e){var t,n,a,i,o,c,d,h;Nt(1,arguments);var m=Bn(),x=Ur((t=(n=(a=(i=e==null?void 0:e.weekStartsOn)!==null&&i!==void 0?i:e==null||(o=e.locale)===null||o===void 0||(c=o.options)===null||c===void 0?void 0:c.weekStartsOn)!==null&&a!==void 0?a:m.weekStartsOn)!==null&&n!==void 0?n:(d=m.locale)===null||d===void 0||(h=d.options)===null||h===void 0?void 0:h.weekStartsOn)!==null&&t!==void 0?t:0);if(!(x>=0&&x<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");var f=Ot(s),k=f.getDay(),A=(k<x?-7:0)+6-(k-x);return f.setDate(f.getDate()+A),f.setHours(23,59,59,999),f}function rN(s,e){Nt(2,arguments);var t=Ur(e);return Gk(s,-t)}var sN=864e5;function nN(s){Nt(1,arguments);var e=Ot(s),t=e.getTime();e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0);var n=e.getTime(),a=t-n;return Math.floor(a/sN)+1}function Yi(s){Nt(1,arguments);var e=1,t=Ot(s),n=t.getUTCDay(),a=(n<e?7:0)+n-e;return t.setUTCDate(t.getUTCDate()-a),t.setUTCHours(0,0,0,0),t}function v0(s){Nt(1,arguments);var e=Ot(s),t=e.getUTCFullYear(),n=new Date(0);n.setUTCFullYear(t+1,0,4),n.setUTCHours(0,0,0,0);var a=Yi(n),i=new Date(0);i.setUTCFullYear(t,0,4),i.setUTCHours(0,0,0,0);var o=Yi(i);return e.getTime()>=a.getTime()?t+1:e.getTime()>=o.getTime()?t:t-1}function aN(s){Nt(1,arguments);var e=v0(s),t=new Date(0);t.setUTCFullYear(e,0,4),t.setUTCHours(0,0,0,0);var n=Yi(t);return n}var iN=6048e5;function oN(s){Nt(1,arguments);var e=Ot(s),t=Yi(e).getTime()-aN(e).getTime();return Math.round(t/iN)+1}function Dn(s,e){var t,n,a,i,o,c,d,h;Nt(1,arguments);var m=Bn(),x=Ur((t=(n=(a=(i=e==null?void 0:e.weekStartsOn)!==null&&i!==void 0?i:e==null||(o=e.locale)===null||o===void 0||(c=o.options)===null||c===void 0?void 0:c.weekStartsOn)!==null&&a!==void 0?a:m.weekStartsOn)!==null&&n!==void 0?n:(d=m.locale)===null||d===void 0||(h=d.options)===null||h===void 0?void 0:h.weekStartsOn)!==null&&t!==void 0?t:0);if(!(x>=0&&x<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");var f=Ot(s),k=f.getUTCDay(),A=(k<x?7:0)+k-x;return f.setUTCDate(f.getUTCDate()-A),f.setUTCHours(0,0,0,0),f}function w0(s,e){var t,n,a,i,o,c,d,h;Nt(1,arguments);var m=Ot(s),x=m.getUTCFullYear(),f=Bn(),k=Ur((t=(n=(a=(i=e==null?void 0:e.firstWeekContainsDate)!==null&&i!==void 0?i:e==null||(o=e.locale)===null||o===void 0||(c=o.options)===null||c===void 0?void 0:c.firstWeekContainsDate)!==null&&a!==void 0?a:f.firstWeekContainsDate)!==null&&n!==void 0?n:(d=f.locale)===null||d===void 0||(h=d.options)===null||h===void 0?void 0:h.firstWeekContainsDate)!==null&&t!==void 0?t:1);if(!(k>=1&&k<=7))throw new RangeError("firstWeekContainsDate must be between 1 and 7 inclusively");var A=new Date(0);A.setUTCFullYear(x+1,0,k),A.setUTCHours(0,0,0,0);var D=Dn(A,e),T=new Date(0);T.setUTCFullYear(x,0,k),T.setUTCHours(0,0,0,0);var H=Dn(T,e);return m.getTime()>=D.getTime()?x+1:m.getTime()>=H.getTime()?x:x-1}function lN(s,e){var t,n,a,i,o,c,d,h;Nt(1,arguments);var m=Bn(),x=Ur((t=(n=(a=(i=e==null?void 0:e.firstWeekContainsDate)!==null&&i!==void 0?i:e==null||(o=e.locale)===null||o===void 0||(c=o.options)===null||c===void 0?void 0:c.firstWeekContainsDate)!==null&&a!==void 0?a:m.firstWeekContainsDate)!==null&&n!==void 0?n:(d=m.locale)===null||d===void 0||(h=d.options)===null||h===void 0?void 0:h.firstWeekContainsDate)!==null&&t!==void 0?t:1),f=w0(s,e),k=new Date(0);k.setUTCFullYear(f,0,x),k.setUTCHours(0,0,0,0);var A=Dn(k,e);return A}var cN=6048e5;function dN(s,e){Nt(1,arguments);var t=Ot(s),n=Dn(t,e).getTime()-lN(t,e).getTime();return Math.round(n/cN)+1}function dt(s,e){for(var t=s<0?"-":"",n=Math.abs(s).toString();n.length<e;)n="0"+n;return t+n}var ys={y:function(e,t){var n=e.getUTCFullYear(),a=n>0?n:1-n;return dt(t==="yy"?a%100:a,t.length)},M:function(e,t){var n=e.getUTCMonth();return t==="M"?String(n+1):dt(n+1,2)},d:function(e,t){return dt(e.getUTCDate(),t.length)},a:function(e,t){var n=e.getUTCHours()/12>=1?"pm":"am";switch(t){case"a":case"aa":return n.toUpperCase();case"aaa":return n;case"aaaaa":return n[0];case"aaaa":default:return n==="am"?"a.m.":"p.m."}},h:function(e,t){return dt(e.getUTCHours()%12||12,t.length)},H:function(e,t){return dt(e.getUTCHours(),t.length)},m:function(e,t){return dt(e.getUTCMinutes(),t.length)},s:function(e,t){return dt(e.getUTCSeconds(),t.length)},S:function(e,t){var n=t.length,a=e.getUTCMilliseconds(),i=Math.floor(a*Math.pow(10,n-3));return dt(i,t.length)}},ln={midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},uN={G:function(e,t,n){var a=e.getUTCFullYear()>0?1:0;switch(t){case"G":case"GG":case"GGG":return n.era(a,{width:"abbreviated"});case"GGGGG":return n.era(a,{width:"narrow"});case"GGGG":default:return n.era(a,{width:"wide"})}},y:function(e,t,n){if(t==="yo"){var a=e.getUTCFullYear(),i=a>0?a:1-a;return n.ordinalNumber(i,{unit:"year"})}return ys.y(e,t)},Y:function(e,t,n,a){var i=w0(e,a),o=i>0?i:1-i;if(t==="YY"){var c=o%100;return dt(c,2)}return t==="Yo"?n.ordinalNumber(o,{unit:"year"}):dt(o,t.length)},R:function(e,t){var n=v0(e);return dt(n,t.length)},u:function(e,t){var n=e.getUTCFullYear();return dt(n,t.length)},Q:function(e,t,n){var a=Math.ceil((e.getUTCMonth()+1)/3);switch(t){case"Q":return String(a);case"QQ":return dt(a,2);case"Qo":return n.ordinalNumber(a,{unit:"quarter"});case"QQQ":return n.quarter(a,{width:"abbreviated",context:"formatting"});case"QQQQQ":return n.quarter(a,{width:"narrow",context:"formatting"});case"QQQQ":default:return n.quarter(a,{width:"wide",context:"formatting"})}},q:function(e,t,n){var a=Math.ceil((e.getUTCMonth()+1)/3);switch(t){case"q":return String(a);case"qq":return dt(a,2);case"qo":return n.ordinalNumber(a,{unit:"quarter"});case"qqq":return n.quarter(a,{width:"abbreviated",context:"standalone"});case"qqqqq":return n.quarter(a,{width:"narrow",context:"standalone"});case"qqqq":default:return n.quarter(a,{width:"wide",context:"standalone"})}},M:function(e,t,n){var a=e.getUTCMonth();switch(t){case"M":case"MM":return ys.M(e,t);case"Mo":return n.ordinalNumber(a+1,{unit:"month"});case"MMM":return n.month(a,{width:"abbreviated",context:"formatting"});case"MMMMM":return n.month(a,{width:"narrow",context:"formatting"});case"MMMM":default:return n.month(a,{width:"wide",context:"formatting"})}},L:function(e,t,n){var a=e.getUTCMonth();switch(t){case"L":return String(a+1);case"LL":return dt(a+1,2);case"Lo":return n.ordinalNumber(a+1,{unit:"month"});case"LLL":return n.month(a,{width:"abbreviated",context:"standalone"});case"LLLLL":return n.month(a,{width:"narrow",context:"standalone"});case"LLLL":default:return n.month(a,{width:"wide",context:"standalone"})}},w:function(e,t,n,a){var i=dN(e,a);return t==="wo"?n.ordinalNumber(i,{unit:"week"}):dt(i,t.length)},I:function(e,t,n){var a=oN(e);return t==="Io"?n.ordinalNumber(a,{unit:"week"}):dt(a,t.length)},d:function(e,t,n){return t==="do"?n.ordinalNumber(e.getUTCDate(),{unit:"date"}):ys.d(e,t)},D:function(e,t,n){var a=nN(e);return t==="Do"?n.ordinalNumber(a,{unit:"dayOfYear"}):dt(a,t.length)},E:function(e,t,n){var a=e.getUTCDay();switch(t){case"E":case"EE":case"EEE":return n.day(a,{width:"abbreviated",context:"formatting"});case"EEEEE":return n.day(a,{width:"narrow",context:"formatting"});case"EEEEEE":return n.day(a,{width:"short",context:"formatting"});case"EEEE":default:return n.day(a,{width:"wide",context:"formatting"})}},e:function(e,t,n,a){var i=e.getUTCDay(),o=(i-a.weekStartsOn+8)%7||7;switch(t){case"e":return String(o);case"ee":return dt(o,2);case"eo":return n.ordinalNumber(o,{unit:"day"});case"eee":return n.day(i,{width:"abbreviated",context:"formatting"});case"eeeee":return n.day(i,{width:"narrow",context:"formatting"});case"eeeeee":return n.day(i,{width:"short",context:"formatting"});case"eeee":default:return n.day(i,{width:"wide",context:"formatting"})}},c:function(e,t,n,a){var i=e.getUTCDay(),o=(i-a.weekStartsOn+8)%7||7;switch(t){case"c":return String(o);case"cc":return dt(o,t.length);case"co":return n.ordinalNumber(o,{unit:"day"});case"ccc":return n.day(i,{width:"abbreviated",context:"standalone"});case"ccccc":return n.day(i,{width:"narrow",context:"standalone"});case"cccccc":return n.day(i,{width:"short",context:"standalone"});case"cccc":default:return n.day(i,{width:"wide",context:"standalone"})}},i:function(e,t,n){var a=e.getUTCDay(),i=a===0?7:a;switch(t){case"i":return String(i);case"ii":return dt(i,t.length);case"io":return n.ordinalNumber(i,{unit:"day"});case"iii":return n.day(a,{width:"abbreviated",context:"formatting"});case"iiiii":return n.day(a,{width:"narrow",context:"formatting"});case"iiiiii":return n.day(a,{width:"short",context:"formatting"});case"iiii":default:return n.day(a,{width:"wide",context:"formatting"})}},a:function(e,t,n){var a=e.getUTCHours(),i=a/12>=1?"pm":"am";switch(t){case"a":case"aa":return n.dayPeriod(i,{width:"abbreviated",context:"formatting"});case"aaa":return n.dayPeriod(i,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return n.dayPeriod(i,{width:"narrow",context:"formatting"});case"aaaa":default:return n.dayPeriod(i,{width:"wide",context:"formatting"})}},b:function(e,t,n){var a=e.getUTCHours(),i;switch(a===12?i=ln.noon:a===0?i=ln.midnight:i=a/12>=1?"pm":"am",t){case"b":case"bb":return n.dayPeriod(i,{width:"abbreviated",context:"formatting"});case"bbb":return n.dayPeriod(i,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return n.dayPeriod(i,{width:"narrow",context:"formatting"});case"bbbb":default:return n.dayPeriod(i,{width:"wide",context:"formatting"})}},B:function(e,t,n){var a=e.getUTCHours(),i;switch(a>=17?i=ln.evening:a>=12?i=ln.afternoon:a>=4?i=ln.morning:i=ln.night,t){case"B":case"BB":case"BBB":return n.dayPeriod(i,{width:"abbreviated",context:"formatting"});case"BBBBB":return n.dayPeriod(i,{width:"narrow",context:"formatting"});case"BBBB":default:return n.dayPeriod(i,{width:"wide",context:"formatting"})}},h:function(e,t,n){if(t==="ho"){var a=e.getUTCHours()%12;return a===0&&(a=12),n.ordinalNumber(a,{unit:"hour"})}return ys.h(e,t)},H:function(e,t,n){return t==="Ho"?n.ordinalNumber(e.getUTCHours(),{unit:"hour"}):ys.H(e,t)},K:function(e,t,n){var a=e.getUTCHours()%12;return t==="Ko"?n.ordinalNumber(a,{unit:"hour"}):dt(a,t.length)},k:function(e,t,n){var a=e.getUTCHours();return a===0&&(a=24),t==="ko"?n.ordinalNumber(a,{unit:"hour"}):dt(a,t.length)},m:function(e,t,n){return t==="mo"?n.ordinalNumber(e.getUTCMinutes(),{unit:"minute"}):ys.m(e,t)},s:function(e,t,n){return t==="so"?n.ordinalNumber(e.getUTCSeconds(),{unit:"second"}):ys.s(e,t)},S:function(e,t){return ys.S(e,t)},X:function(e,t,n,a){var i=a._originalDate||e,o=i.getTimezoneOffset();if(o===0)return"Z";switch(t){case"X":return hh(o);case"XXXX":case"XX":return Bs(o);case"XXXXX":case"XXX":default:return Bs(o,":")}},x:function(e,t,n,a){var i=a._originalDate||e,o=i.getTimezoneOffset();switch(t){case"x":return hh(o);case"xxxx":case"xx":return Bs(o);case"xxxxx":case"xxx":default:return Bs(o,":")}},O:function(e,t,n,a){var i=a._originalDate||e,o=i.getTimezoneOffset();switch(t){case"O":case"OO":case"OOO":return"GMT"+uh(o,":");case"OOOO":default:return"GMT"+Bs(o,":")}},z:function(e,t,n,a){var i=a._originalDate||e,o=i.getTimezoneOffset();switch(t){case"z":case"zz":case"zzz":return"GMT"+uh(o,":");case"zzzz":default:return"GMT"+Bs(o,":")}},t:function(e,t,n,a){var i=a._originalDate||e,o=Math.floor(i.getTime()/1e3);return dt(o,t.length)},T:function(e,t,n,a){var i=a._originalDate||e,o=i.getTime();return dt(o,t.length)}};function uh(s,e){var t=s>0?"-":"+",n=Math.abs(s),a=Math.floor(n/60),i=n%60;if(i===0)return t+String(a);var o=e;return t+String(a)+o+dt(i,2)}function hh(s,e){if(s%60===0){var t=s>0?"-":"+";return t+dt(Math.abs(s)/60,2)}return Bs(s,e)}function Bs(s,e){var t=e||"",n=s>0?"-":"+",a=Math.abs(s),i=dt(Math.floor(a/60),2),o=dt(a%60,2);return n+i+t+o}var mh=function(e,t){switch(e){case"P":return t.date({width:"short"});case"PP":return t.date({width:"medium"});case"PPP":return t.date({width:"long"});case"PPPP":default:return t.date({width:"full"})}},k0=function(e,t){switch(e){case"p":return t.time({width:"short"});case"pp":return t.time({width:"medium"});case"ppp":return t.time({width:"long"});case"pppp":default:return t.time({width:"full"})}},hN=function(e,t){var n=e.match(/(P+)(p+)?/)||[],a=n[1],i=n[2];if(!i)return mh(e,t);var o;switch(a){case"P":o=t.dateTime({width:"short"});break;case"PP":o=t.dateTime({width:"medium"});break;case"PPP":o=t.dateTime({width:"long"});break;case"PPPP":default:o=t.dateTime({width:"full"});break}return o.replace("{{date}}",mh(a,t)).replace("{{time}}",k0(i,t))},mN={p:k0,P:hN},gN=["D","DD"],pN=["YY","YYYY"];function xN(s){return gN.indexOf(s)!==-1}function fN(s){return pN.indexOf(s)!==-1}function gh(s,e,t){if(s==="YYYY")throw new RangeError("Use `yyyy` instead of `YYYY` (in `".concat(e,"`) for formatting years to the input `").concat(t,"`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md"));if(s==="YY")throw new RangeError("Use `yy` instead of `YY` (in `".concat(e,"`) for formatting years to the input `").concat(t,"`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md"));if(s==="D")throw new RangeError("Use `d` instead of `D` (in `".concat(e,"`) for formatting days of the month to the input `").concat(t,"`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md"));if(s==="DD")throw new RangeError("Use `dd` instead of `DD` (in `".concat(e,"`) for formatting days of the month to the input `").concat(t,"`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md"))}var yN={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},bN=function(e,t,n){var a,i=yN[e];return typeof i=="string"?a=i:t===1?a=i.one:a=i.other.replace("{{count}}",t.toString()),n!=null&&n.addSuffix?n.comparison&&n.comparison>0?"in "+a:a+" ago":a};function wn(s){return function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=e.width?String(e.width):s.defaultWidth,n=s.formats[t]||s.formats[s.defaultWidth];return n}}var vN={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},wN={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},kN={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},NN={date:wn({formats:vN,defaultWidth:"full"}),time:wn({formats:wN,defaultWidth:"full"}),dateTime:wn({formats:kN,defaultWidth:"full"})},jN={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},_N=function(e,t,n,a){return jN[e]};function Dr(s){return function(e,t){var n=t!=null&&t.context?String(t.context):"standalone",a;if(n==="formatting"&&s.formattingValues){var i=s.defaultFormattingWidth||s.defaultWidth,o=t!=null&&t.width?String(t.width):i;a=s.formattingValues[o]||s.formattingValues[i]}else{var c=s.defaultWidth,d=t!=null&&t.width?String(t.width):s.defaultWidth;a=s.values[d]||s.values[c]}var h=s.argumentCallback?s.argumentCallback(e):e;return a[h]}}var EN={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},IN={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},TN={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},SN={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},AN={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},CN={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},DN=function(e,t){var n=Number(e),a=n%100;if(a>20||a<10)switch(a%10){case 1:return n+"st";case 2:return n+"nd";case 3:return n+"rd"}return n+"th"},$N={ordinalNumber:DN,era:Dr({values:EN,defaultWidth:"wide"}),quarter:Dr({values:IN,defaultWidth:"wide",argumentCallback:function(e){return e-1}}),month:Dr({values:TN,defaultWidth:"wide"}),day:Dr({values:SN,defaultWidth:"wide"}),dayPeriod:Dr({values:AN,defaultWidth:"wide",formattingValues:CN,defaultFormattingWidth:"wide"})};function $r(s){return function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=t.width,a=n&&s.matchPatterns[n]||s.matchPatterns[s.defaultMatchWidth],i=e.match(a);if(!i)return null;var o=i[0],c=n&&s.parsePatterns[n]||s.parsePatterns[s.defaultParseWidth],d=Array.isArray(c)?PN(c,function(x){return x.test(o)}):RN(c,function(x){return x.test(o)}),h;h=s.valueCallback?s.valueCallback(d):d,h=t.valueCallback?t.valueCallback(h):h;var m=e.slice(o.length);return{value:h,rest:m}}}function RN(s,e){for(var t in s)if(s.hasOwnProperty(t)&&e(s[t]))return t}function PN(s,e){for(var t=0;t<s.length;t++)if(e(s[t]))return t}function N0(s){return function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=e.match(s.matchPattern);if(!n)return null;var a=n[0],i=e.match(s.parsePattern);if(!i)return null;var o=s.valueCallback?s.valueCallback(i[0]):i[0];o=t.valueCallback?t.valueCallback(o):o;var c=e.slice(a.length);return{value:o,rest:c}}}var MN=/^(\d+)(th|st|nd|rd)?/i,ON=/\d+/i,VN={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},LN={any:[/^b/i,/^(a|c)/i]},FN={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},UN={any:[/1/i,/2/i,/3/i,/4/i]},BN={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},qN={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},WN={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},zN={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},HN={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},GN={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},KN={ordinalNumber:N0({matchPattern:MN,parsePattern:ON,valueCallback:function(e){return parseInt(e,10)}}),era:$r({matchPatterns:VN,defaultMatchWidth:"wide",parsePatterns:LN,defaultParseWidth:"any"}),quarter:$r({matchPatterns:FN,defaultMatchWidth:"wide",parsePatterns:UN,defaultParseWidth:"any",valueCallback:function(e){return e+1}}),month:$r({matchPatterns:BN,defaultMatchWidth:"wide",parsePatterns:qN,defaultParseWidth:"any"}),day:$r({matchPatterns:WN,defaultMatchWidth:"wide",parsePatterns:zN,defaultParseWidth:"any"}),dayPeriod:$r({matchPatterns:HN,defaultMatchWidth:"any",parsePatterns:GN,defaultParseWidth:"any"})},YN={code:"en-US",formatDistance:bN,formatLong:NN,formatRelative:_N,localize:$N,match:KN,options:{weekStartsOn:0,firstWeekContainsDate:1}},QN=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,XN=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,JN=/^'([^]*?)'?$/,ZN=/''/g,e2=/[a-zA-Z]/;function j0(s,e,t){var n,a,i,o,c,d,h,m,x,f,k,A,D,T,H,L,E,M;Nt(2,arguments);var ee=String(e),C=Bn(),v=(n=(a=t==null?void 0:t.locale)!==null&&a!==void 0?a:C.locale)!==null&&n!==void 0?n:YN,p=Ur((i=(o=(c=(d=t==null?void 0:t.firstWeekContainsDate)!==null&&d!==void 0?d:t==null||(h=t.locale)===null||h===void 0||(m=h.options)===null||m===void 0?void 0:m.firstWeekContainsDate)!==null&&c!==void 0?c:C.firstWeekContainsDate)!==null&&o!==void 0?o:(x=C.locale)===null||x===void 0||(f=x.options)===null||f===void 0?void 0:f.firstWeekContainsDate)!==null&&i!==void 0?i:1);if(!(p>=1&&p<=7))throw new RangeError("firstWeekContainsDate must be between 1 and 7 inclusively");var w=Ur((k=(A=(D=(T=t==null?void 0:t.weekStartsOn)!==null&&T!==void 0?T:t==null||(H=t.locale)===null||H===void 0||(L=H.options)===null||L===void 0?void 0:L.weekStartsOn)!==null&&D!==void 0?D:C.weekStartsOn)!==null&&A!==void 0?A:(E=C.locale)===null||E===void 0||(M=E.options)===null||M===void 0?void 0:M.weekStartsOn)!==null&&k!==void 0?k:0);if(!(w>=0&&w<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");if(!v.localize)throw new RangeError("locale must contain localize property");if(!v.formatLong)throw new RangeError("locale must contain formatLong property");var N=Ot(s);if(!Zk(N))throw new RangeError("Invalid time value");var j=Qk(N),b=rN(N,j),y={firstWeekContainsDate:p,weekStartsOn:w,locale:v,_originalDate:N},re=ee.match(XN).map(function(ue){var W=ue[0];if(W==="p"||W==="P"){var O=mN[W];return O(ue,v.formatLong)}return ue}).join("").match(QN).map(function(ue){if(ue==="''")return"'";var W=ue[0];if(W==="'")return t2(ue);var O=uN[W];if(O)return!(t!=null&&t.useAdditionalWeekYearTokens)&&fN(ue)&&gh(ue,e,String(s)),!(t!=null&&t.useAdditionalDayOfYearTokens)&&xN(ue)&&gh(ue,e,String(s)),O(b,ue,v.localize,y);if(W.match(e2))throw new RangeError("Format string contains an unescaped latin alphabet character `"+W+"`");return ue}).join("");return re}function t2(s){var e=s.match(JN);return e?e[1].replace(ZN,"'"):s}function r2(s,e){Nt(2,arguments);var t=Ot(s),n=Ot(e);return t.getTime()<n.getTime()}function vr(s,e){var t;Nt(1,arguments);var n=Ur((t=void 0)!==null&&t!==void 0?t:2);if(n!==2&&n!==1&&n!==0)throw new RangeError("additionalDigits must be 0, 1 or 2");if(!(typeof s=="string"||Object.prototype.toString.call(s)==="[object String]"))return new Date(NaN);var a=i2(s),i;if(a.date){var o=o2(a.date,n);i=l2(o.restDateString,o.year)}if(!i||isNaN(i.getTime()))return new Date(NaN);var c=i.getTime(),d=0,h;if(a.time&&(d=c2(a.time),isNaN(d)))return new Date(NaN);if(a.timezone){if(h=d2(a.timezone),isNaN(h))return new Date(NaN)}else{var m=new Date(c+d),x=new Date(0);return x.setFullYear(m.getUTCFullYear(),m.getUTCMonth(),m.getUTCDate()),x.setHours(m.getUTCHours(),m.getUTCMinutes(),m.getUTCSeconds(),m.getUTCMilliseconds()),x}return new Date(c+d+h)}var ui={dateTimeDelimiter:/[T ]/,timeZoneDelimiter:/[Z ]/i,timezone:/([Z+-].*)$/},s2=/^-?(?:(\d{3})|(\d{2})(?:-?(\d{2}))?|W(\d{2})(?:-?(\d{1}))?|)$/,n2=/^(\d{2}(?:[.,]\d*)?)(?::?(\d{2}(?:[.,]\d*)?))?(?::?(\d{2}(?:[.,]\d*)?))?$/,a2=/^([+-])(\d{2})(?::?(\d{2}))?$/;function i2(s){var e={},t=s.split(ui.dateTimeDelimiter),n;if(t.length>2)return e;if(/:/.test(t[0])?n=t[0]:(e.date=t[0],n=t[1],ui.timeZoneDelimiter.test(e.date)&&(e.date=s.split(ui.timeZoneDelimiter)[0],n=s.substr(e.date.length,s.length))),n){var a=ui.timezone.exec(n);a?(e.time=n.replace(a[1],""),e.timezone=a[1]):e.time=n}return e}function o2(s,e){var t=new RegExp("^(?:(\\d{4}|[+-]\\d{"+(4+e)+"})|(\\d{2}|[+-]\\d{"+(2+e)+"})$)"),n=s.match(t);if(!n)return{year:NaN,restDateString:""};var a=n[1]?parseInt(n[1]):null,i=n[2]?parseInt(n[2]):null;return{year:i===null?a:i*100,restDateString:s.slice((n[1]||n[2]).length)}}function l2(s,e){if(e===null)return new Date(NaN);var t=s.match(s2);if(!t)return new Date(NaN);var n=!!t[4],a=Zn(t[1]),i=Zn(t[2])-1,o=Zn(t[3]),c=Zn(t[4]),d=Zn(t[5])-1;if(n)return p2(e,c,d)?u2(e,c,d):new Date(NaN);var h=new Date(0);return!m2(e,i,o)||!g2(e,a)?new Date(NaN):(h.setUTCFullYear(e,i,Math.max(a,o)),h)}function Zn(s){return s?parseInt(s):1}function c2(s){var e=s.match(n2);if(!e)return NaN;var t=nl(e[1]),n=nl(e[2]),a=nl(e[3]);return x2(t,n,a)?t*b0+n*y0+a*1e3:NaN}function nl(s){return s&&parseFloat(s.replace(",","."))||0}function d2(s){if(s==="Z")return 0;var e=s.match(a2);if(!e)return 0;var t=e[1]==="+"?-1:1,n=parseInt(e[2]),a=e[3]&&parseInt(e[3])||0;return f2(n,a)?t*(n*b0+a*y0):NaN}function u2(s,e,t){var n=new Date(0);n.setUTCFullYear(s,0,4);var a=n.getUTCDay()||7,i=(e-1)*7+t+1-a;return n.setUTCDate(n.getUTCDate()+i),n}var h2=[31,null,31,30,31,30,31,31,30,31,30,31];function _0(s){return s%400===0||s%4===0&&s%100!==0}function m2(s,e,t){return e>=0&&e<=11&&t>=1&&t<=(h2[e]||(_0(s)?29:28))}function g2(s,e){return e>=1&&e<=(_0(s)?366:365)}function p2(s,e,t){return e>=1&&e<=53&&t>=0&&t<=6}function x2(s,e,t){return s===24?e===0&&t===0:t>=0&&t<60&&e>=0&&e<60&&s>=0&&s<25}function f2(s,e){return e>=0&&e<=59}function ph(s,e,t){Nt(2,arguments);var n=Dn(s,t),a=Dn(e,t);return n.getTime()===a.getTime()}function ea(s,e){if(s.one!==void 0&&e===1)return s.one;var t=e%10,n=e%100;return t===1&&n!==11?s.singularNominative.replace("{{count}}",String(e)):t>=2&&t<=4&&(n<10||n>20)?s.singularGenitive.replace("{{count}}",String(e)):s.pluralGenitive.replace("{{count}}",String(e))}function tr(s){return function(e,t){return t!=null&&t.addSuffix?t.comparison&&t.comparison>0?s.future?ea(s.future,e):"через "+ea(s.regular,e):s.past?ea(s.past,e):ea(s.regular,e)+" назад":ea(s.regular,e)}}var y2={lessThanXSeconds:tr({regular:{one:"меньше секунды",singularNominative:"меньше {{count}} секунды",singularGenitive:"меньше {{count}} секунд",pluralGenitive:"меньше {{count}} секунд"},future:{one:"меньше, чем через секунду",singularNominative:"меньше, чем через {{count}} секунду",singularGenitive:"меньше, чем через {{count}} секунды",pluralGenitive:"меньше, чем через {{count}} секунд"}}),xSeconds:tr({regular:{singularNominative:"{{count}} секунда",singularGenitive:"{{count}} секунды",pluralGenitive:"{{count}} секунд"},past:{singularNominative:"{{count}} секунду назад",singularGenitive:"{{count}} секунды назад",pluralGenitive:"{{count}} секунд назад"},future:{singularNominative:"через {{count}} секунду",singularGenitive:"через {{count}} секунды",pluralGenitive:"через {{count}} секунд"}}),halfAMinute:function(e,t){return t!=null&&t.addSuffix?t.comparison&&t.comparison>0?"через полминуты":"полминуты назад":"полминуты"},lessThanXMinutes:tr({regular:{one:"меньше минуты",singularNominative:"меньше {{count}} минуты",singularGenitive:"меньше {{count}} минут",pluralGenitive:"меньше {{count}} минут"},future:{one:"меньше, чем через минуту",singularNominative:"меньше, чем через {{count}} минуту",singularGenitive:"меньше, чем через {{count}} минуты",pluralGenitive:"меньше, чем через {{count}} минут"}}),xMinutes:tr({regular:{singularNominative:"{{count}} минута",singularGenitive:"{{count}} минуты",pluralGenitive:"{{count}} минут"},past:{singularNominative:"{{count}} минуту назад",singularGenitive:"{{count}} минуты назад",pluralGenitive:"{{count}} минут назад"},future:{singularNominative:"через {{count}} минуту",singularGenitive:"через {{count}} минуты",pluralGenitive:"через {{count}} минут"}}),aboutXHours:tr({regular:{singularNominative:"около {{count}} часа",singularGenitive:"около {{count}} часов",pluralGenitive:"около {{count}} часов"},future:{singularNominative:"приблизительно через {{count}} час",singularGenitive:"приблизительно через {{count}} часа",pluralGenitive:"приблизительно через {{count}} часов"}}),xHours:tr({regular:{singularNominative:"{{count}} час",singularGenitive:"{{count}} часа",pluralGenitive:"{{count}} часов"}}),xDays:tr({regular:{singularNominative:"{{count}} день",singularGenitive:"{{count}} дня",pluralGenitive:"{{count}} дней"}}),aboutXWeeks:tr({regular:{singularNominative:"около {{count}} недели",singularGenitive:"около {{count}} недель",pluralGenitive:"около {{count}} недель"},future:{singularNominative:"приблизительно через {{count}} неделю",singularGenitive:"приблизительно через {{count}} недели",pluralGenitive:"приблизительно через {{count}} недель"}}),xWeeks:tr({regular:{singularNominative:"{{count}} неделя",singularGenitive:"{{count}} недели",pluralGenitive:"{{count}} недель"}}),aboutXMonths:tr({regular:{singularNominative:"около {{count}} месяца",singularGenitive:"около {{count}} месяцев",pluralGenitive:"около {{count}} месяцев"},future:{singularNominative:"приблизительно через {{count}} месяц",singularGenitive:"приблизительно через {{count}} месяца",pluralGenitive:"приблизительно через {{count}} месяцев"}}),xMonths:tr({regular:{singularNominative:"{{count}} месяц",singularGenitive:"{{count}} месяца",pluralGenitive:"{{count}} месяцев"}}),aboutXYears:tr({regular:{singularNominative:"около {{count}} года",singularGenitive:"около {{count}} лет",pluralGenitive:"около {{count}} лет"},future:{singularNominative:"приблизительно через {{count}} год",singularGenitive:"приблизительно через {{count}} года",pluralGenitive:"приблизительно через {{count}} лет"}}),xYears:tr({regular:{singularNominative:"{{count}} год",singularGenitive:"{{count}} года",pluralGenitive:"{{count}} лет"}}),overXYears:tr({regular:{singularNominative:"больше {{count}} года",singularGenitive:"больше {{count}} лет",pluralGenitive:"больше {{count}} лет"},future:{singularNominative:"больше, чем через {{count}} год",singularGenitive:"больше, чем через {{count}} года",pluralGenitive:"больше, чем через {{count}} лет"}}),almostXYears:tr({regular:{singularNominative:"почти {{count}} год",singularGenitive:"почти {{count}} года",pluralGenitive:"почти {{count}} лет"},future:{singularNominative:"почти через {{count}} год",singularGenitive:"почти через {{count}} года",pluralGenitive:"почти через {{count}} лет"}})},b2=function(e,t,n){return y2[e](t,n)},v2={full:"EEEE, d MMMM y 'г.'",long:"d MMMM y 'г.'",medium:"d MMM y 'г.'",short:"dd.MM.y"},w2={full:"H:mm:ss zzzz",long:"H:mm:ss z",medium:"H:mm:ss",short:"H:mm"},k2={any:"{{date}}, {{time}}"},N2={date:wn({formats:v2,defaultWidth:"full"}),time:wn({formats:w2,defaultWidth:"full"}),dateTime:wn({formats:k2,defaultWidth:"any"})},Gc=["воскресенье","понедельник","вторник","среду","четверг","пятницу","субботу"];function j2(s){var e=Gc[s];switch(s){case 0:return"'в прошлое "+e+" в' p";case 1:case 2:case 4:return"'в прошлый "+e+" в' p";case 3:case 5:case 6:return"'в прошлую "+e+" в' p"}}function xh(s){var e=Gc[s];return s===2?"'во "+e+" в' p":"'в "+e+" в' p"}function _2(s){var e=Gc[s];switch(s){case 0:return"'в следующее "+e+" в' p";case 1:case 2:case 4:return"'в следующий "+e+" в' p";case 3:case 5:case 6:return"'в следующую "+e+" в' p"}}var E2={lastWeek:function(e,t,n){var a=e.getUTCDay();return ph(e,t,n)?xh(a):j2(a)},yesterday:"'вчера в' p",today:"'сегодня в' p",tomorrow:"'завтра в' p",nextWeek:function(e,t,n){var a=e.getUTCDay();return ph(e,t,n)?xh(a):_2(a)},other:"P"},I2=function(e,t,n,a){var i=E2[e];return typeof i=="function"?i(t,n,a):i},T2={narrow:["до н.э.","н.э."],abbreviated:["до н. э.","н. э."],wide:["до нашей эры","нашей эры"]},S2={narrow:["1","2","3","4"],abbreviated:["1-й кв.","2-й кв.","3-й кв.","4-й кв."],wide:["1-й квартал","2-й квартал","3-й квартал","4-й квартал"]},A2={narrow:["Я","Ф","М","А","М","И","И","А","С","О","Н","Д"],abbreviated:["янв.","фев.","март","апр.","май","июнь","июль","авг.","сент.","окт.","нояб.","дек."],wide:["январь","февраль","март","апрель","май","июнь","июль","август","сентябрь","октябрь","ноябрь","декабрь"]},C2={narrow:["Я","Ф","М","А","М","И","И","А","С","О","Н","Д"],abbreviated:["янв.","фев.","мар.","апр.","мая","июн.","июл.","авг.","сент.","окт.","нояб.","дек."],wide:["января","февраля","марта","апреля","мая","июня","июля","августа","сентября","октября","ноября","декабря"]},D2={narrow:["В","П","В","С","Ч","П","С"],short:["вс","пн","вт","ср","чт","пт","сб"],abbreviated:["вск","пнд","втр","срд","чтв","птн","суб"],wide:["воскресенье","понедельник","вторник","среда","четверг","пятница","суббота"]},$2={narrow:{am:"ДП",pm:"ПП",midnight:"полн.",noon:"полд.",morning:"утро",afternoon:"день",evening:"веч.",night:"ночь"},abbreviated:{am:"ДП",pm:"ПП",midnight:"полн.",noon:"полд.",morning:"утро",afternoon:"день",evening:"веч.",night:"ночь"},wide:{am:"ДП",pm:"ПП",midnight:"полночь",noon:"полдень",morning:"утро",afternoon:"день",evening:"вечер",night:"ночь"}},R2={narrow:{am:"ДП",pm:"ПП",midnight:"полн.",noon:"полд.",morning:"утра",afternoon:"дня",evening:"веч.",night:"ночи"},abbreviated:{am:"ДП",pm:"ПП",midnight:"полн.",noon:"полд.",morning:"утра",afternoon:"дня",evening:"веч.",night:"ночи"},wide:{am:"ДП",pm:"ПП",midnight:"полночь",noon:"полдень",morning:"утра",afternoon:"дня",evening:"вечера",night:"ночи"}},P2=function(e,t){var n=Number(e),a=t==null?void 0:t.unit,i;return a==="date"?i="-е":a==="week"||a==="minute"||a==="second"?i="-я":i="-й",n+i},M2={ordinalNumber:P2,era:Dr({values:T2,defaultWidth:"wide"}),quarter:Dr({values:S2,defaultWidth:"wide",argumentCallback:function(e){return e-1}}),month:Dr({values:A2,defaultWidth:"wide",formattingValues:C2,defaultFormattingWidth:"wide"}),day:Dr({values:D2,defaultWidth:"wide"}),dayPeriod:Dr({values:$2,defaultWidth:"any",formattingValues:R2,defaultFormattingWidth:"wide"})},O2=/^(\d+)(-?(е|я|й|ое|ье|ая|ья|ый|ой|ий|ый))?/i,V2=/\d+/i,L2={narrow:/^((до )?н\.?\s?э\.?)/i,abbreviated:/^((до )?н\.?\s?э\.?)/i,wide:/^(до нашей эры|нашей эры|наша эра)/i},F2={any:[/^д/i,/^н/i]},U2={narrow:/^[1234]/i,abbreviated:/^[1234](-?[ыои]?й?)? кв.?/i,wide:/^[1234](-?[ыои]?й?)? квартал/i},B2={any:[/1/i,/2/i,/3/i,/4/i]},q2={narrow:/^[яфмаисонд]/i,abbreviated:/^(янв|фев|март?|апр|ма[йя]|июн[ья]?|июл[ья]?|авг|сент?|окт|нояб?|дек)\.?/i,wide:/^(январ[ья]|феврал[ья]|марта?|апрел[ья]|ма[йя]|июн[ья]|июл[ья]|августа?|сентябр[ья]|октябр[ья]|октябр[ья]|ноябр[ья]|декабр[ья])/i},W2={narrow:[/^я/i,/^ф/i,/^м/i,/^а/i,/^м/i,/^и/i,/^и/i,/^а/i,/^с/i,/^о/i,/^н/i,/^я/i],any:[/^я/i,/^ф/i,/^мар/i,/^ап/i,/^ма[йя]/i,/^июн/i,/^июл/i,/^ав/i,/^с/i,/^о/i,/^н/i,/^д/i]},z2={narrow:/^[впсч]/i,short:/^(вс|во|пн|по|вт|ср|чт|че|пт|пя|сб|су)\.?/i,abbreviated:/^(вск|вос|пнд|пон|втр|вто|срд|сре|чтв|чет|птн|пят|суб).?/i,wide:/^(воскресень[ея]|понедельника?|вторника?|сред[аы]|четверга?|пятниц[аы]|суббот[аы])/i},H2={narrow:[/^в/i,/^п/i,/^в/i,/^с/i,/^ч/i,/^п/i,/^с/i],any:[/^в[ос]/i,/^п[он]/i,/^в/i,/^ср/i,/^ч/i,/^п[ят]/i,/^с[уб]/i]},G2={narrow:/^([дп]п|полн\.?|полд\.?|утр[оа]|день|дня|веч\.?|ноч[ьи])/i,abbreviated:/^([дп]п|полн\.?|полд\.?|утр[оа]|день|дня|веч\.?|ноч[ьи])/i,wide:/^([дп]п|полночь|полдень|утр[оа]|день|дня|вечера?|ноч[ьи])/i},K2={any:{am:/^дп/i,pm:/^пп/i,midnight:/^полн/i,noon:/^полд/i,morning:/^у/i,afternoon:/^д[ен]/i,evening:/^в/i,night:/^н/i}},Y2={ordinalNumber:N0({matchPattern:O2,parsePattern:V2,valueCallback:function(e){return parseInt(e,10)}}),era:$r({matchPatterns:L2,defaultMatchWidth:"wide",parsePatterns:F2,defaultParseWidth:"any"}),quarter:$r({matchPatterns:U2,defaultMatchWidth:"wide",parsePatterns:B2,defaultParseWidth:"any",valueCallback:function(e){return e+1}}),month:$r({matchPatterns:q2,defaultMatchWidth:"wide",parsePatterns:W2,defaultParseWidth:"any"}),day:$r({matchPatterns:z2,defaultMatchWidth:"wide",parsePatterns:H2,defaultParseWidth:"any"}),dayPeriod:$r({matchPatterns:G2,defaultMatchWidth:"wide",parsePatterns:K2,defaultParseWidth:"any"})},Q2={code:"ru",formatDistance:b2,formatLong:N2,formatRelative:I2,localize:M2,match:Y2,options:{weekStartsOn:1,firstWeekContainsDate:1}};const le=(s,e="dd.MM.yyyy")=>{try{const t=typeof s=="string"?vr(s):s;return!t||Number.isNaN(t.getTime())?"":j0(t,e,{locale:Q2})}catch{return""}},za=(s=new Date)=>{const e=Yk(s,{weekStartsOn:1}),t=tN(s,{weekStartsOn:1});return{start:e,end:t}},Kc=(s=new Date)=>{const{start:e,end:t}=za(s);return eN({start:e,end:t})},Qi=s=>{const e=new Date,t=new Date(e);t.setHours(0,0,0,0),t.setDate(t.getDate()-(s-1));const n=new Date(e);return n.setHours(23,59,59,999),{start:t,end:n}},E0=(s,e)=>{const t=typeof s=="string"?vr(s):s,n=typeof e=="string"?vr(e):e;return Xk(t,n)},jo=s=>s.reduce((e,t)=>{const[n,a]=t.start.split(":").map(Number),[i,o]=t.end.split(":").map(Number),c=n*60+a;let h=(i*60+o-c)/60;if(h<0&&(h+=24),t.breaks&&t.breaks.length>0){const m=t.breaks.reduce((x,f)=>{const[k,A]=f.start.split(":").map(Number),[D,T]=f.end.split(":").map(Number),H=k*60+A;let E=(D*60+T-H)/60;return E<0&&(E+=24),x+E},0);h-=m}return e+h},0),lr=s=>{const[e,t]=s.split(":").map(Number);return e*60+t},Xi=(s,e)=>{if(!s||!e)return[];const t=vr(s),n=vr(e);if(r2(n,t))return[];const a=[],i=new Date(t);for(;i<=n;)a.push(le(i,"yyyy-MM-dd")),i.setDate(i.getDate()+1);return a},I0=s=>{const e=Array.from(new Set(s.filter(Boolean)));return e.sort(),e},hi=(s,e)=>{const t=lr(s.start),n=lr(s.end),a=lr(e.start),i=lr(e.end),o=s.endDate||n<=t,c=e.endDate||i<=a;if(!o&&!c)return t<i&&n>a;const d=24*60,h=o?n+d:n,m=c?i+d:i;return t<m&&h>a},kr=()=>{const s=new Date,e=3*60,t=s.getTimezoneOffset();return new Date(s.getTime()+(e+t)*60*1e3)},fh=(s,e=kr())=>{const t=e.getHours(),n=new Date(`${j0(e,"yyyy-MM-dd")}T${s}:00`);return t>=21||e>n},X2=s=>{const e=Math.floor(s),t=Math.round((s-e)*60);return e===0&&t===0?"0ч":e===0?`${t}м`:t===0?`${e}ч`:`${e}ч ${t}м`},cr=(s,e,t,n)=>{const a=s,i=e||s;if(i<t||a>n)return 0;const o=a>t?a:t,c=i<n?i:n,d=vr(o),m=vr(c).getTime()-d.getTime();return Math.floor(m/(1e3*60*60*24))+1},J2=30,yh=s=>s.toString().padStart(2,"0"),Z2=()=>{const s=new Date;return s.setDate(s.getDate()-J2),{dateOnly:`${s.getFullYear()} -${yh(s.getMonth()+1)} -${yh(s.getDate())} `,iso:s.toISOString()}},mi=async(s,e,t)=>{const n=ct(Re,s),a=nt(n,Tt(e,"<",t)),i=await zt(a);await Promise.all(i.docs.map(o=>yr(ht(Re,s,o.id))))},ej=async()=>{try{const{dateOnly:s,iso:e}=Z2();await Promise.all([mi("workSlots","date",s),mi("dayStatuses","date",s),mi("earnings","date",s),mi("referrals","createdAt",e)])}catch(s){console.error("Failed to cleanup old data",s)}},fr=async(s,e)=>{const t=ct(Re,"workSlots");let n;s&&e||s?n=nt(t,Tt("userId","==",s)):e?n=nt(t,Tt("date","==",e)):n=nt(t);let i=(await zt(n)).docs.map(o=>{const c=o.data(),d=((c==null?void 0:c.slots)||[]).map(h=>h.break&&!h.breaks?{...h,breaks:[h.break],break:void 0}:h);return{id:o.id,userId:(c==null?void 0:c.userId)||"",date:(c==null?void 0:c.date)||"",slots:d,participants:(c==null?void 0:c.participants)||[],...(c==null?void 0:c.comment)&&{comment:c.comment}}});return s&&e&&(i=i.filter(o=>o.date===e)),i.sort((o,c)=>o.date.localeCompare(c.date)),i},T0=async s=>{try{console.log("addWorkSlot: Starting, db initialized:",!!Re);const e=ct(Re,"workSlots");console.log("addWorkSlot: Collection reference created");const t=Object.fromEntries(Object.entries(s).filter(([a,i])=>i!==void 0));console.log("addWorkSlot: Clean slot prepared:",t),console.log("addWorkSlot: Calling addDoc...");const n=await gr(e,t);return console.log("addWorkSlot: Work slot added successfully:",n.id),n}catch(e){throw console.error("addWorkSlot: Error caught:",e),console.error("addWorkSlot: Error code:",e==null?void 0:e.code),console.error("addWorkSlot: Error message:",e==null?void 0:e.message),console.error("addWorkSlot: Full error:",JSON.stringify(e,null,2)),e}},S0=async(s,e)=>{const t=ht(Re,"workSlots",s),n=Object.fromEntries(Object.entries(e).filter(([a,i])=>i!==void 0));await ar(t,n)},_o=async s=>{const e=ht(Re,"workSlots",s);await yr(e)},ns=async(s,e)=>{const t=ct(Re,"dayStatuses");let n;s?n=nt(t,Tt("userId","==",s)):n=nt(t);let i=(await zt(n)).docs.map(o=>{const c=o.data();return{id:o.id,userId:(c==null?void 0:c.userId)||"",date:(c==null?void 0:c.date)||"",type:(c==null?void 0:c.type)||"dayoff",...(c==null?void 0:c.comment)&&{comment:c.comment},...(c==null?void 0:c.endDate)&&{endDate:c.endDate}}});return i.sort((o,c)=>o.date.localeCompare(c.date)),i},Eo=async s=>{try{const e=ct(Re,"dayStatuses"),t=Object.fromEntries(Object.entries(s).filter(([a,i])=>i!==void 0));console.log("Adding day status:",t);const n=await gr(e,t);return console.log("Day status added successfully:",n.id),n}catch(e){throw console.error("Error in addDayStatus:",e),e}},Cs=async(s,e)=>{const t=ht(Re,"dayStatuses",s),n=Object.fromEntries(Object.entries(e).filter(([a,i])=>i!==void 0));await ar(t,n)},Io=async s=>{const e=ht(Re,"dayStatuses",s);await yr(e)},Ll=async s=>{const e=ct(Re,"restrictions");let t;s!==void 0?t=nt(e,Tt("isActive","==",s)):t=nt(e);const a=(await zt(t)).docs.map(i=>{const o=i.data();return{id:i.id,type:(o==null?void 0:o.type)||"all",startDate:(o==null?void 0:o.startDate)||"",endDate:o==null?void 0:o.endDate,startTime:o==null?void 0:o.startTime,blockFutureDates:(o==null?void 0:o.blockFutureDates)||!1,comment:o==null?void 0:o.comment,createdBy:(o==null?void 0:o.createdBy)||"",createdAt:(o==null?void 0:o.createdAt)||"",isActive:(o==null?void 0:o.isActive)??!0}});return a.sort((i,o)=>i.startDate.localeCompare(o.startDate)),a},tj=async s=>{try{const e=ct(Re,"restrictions"),t=Object.fromEntries(Object.entries(s).filter(([a,i])=>i!==void 0));return await gr(e,t)}catch(e){throw console.error("Error adding restriction:",e),e}},rj=async(s,e)=>{const t=ht(Re,"restrictions",s),n=Object.fromEntries(Object.entries(e).filter(([a,i])=>i!==void 0));await ar(t,n)},sj=async s=>{const e=ht(Re,"restrictions",s);await yr(e)},Ji=async(s,e,t)=>{try{const n=await Ll(!0),a=new Date;for(const i of n){if(i.type!=="all"&&i.type!==s)continue;const o=new Date(e),c=new Date(`${i.startDate}${i.startTime?`T${i.startTime}`:""} `);if(i.blockFutureDates&&a>=c){const m=new Date(i.startDate),x=new Date(m);if(x.setDate(m.getDate()+1),o.toDateString()===x.toDateString())return{restricted:!0,restriction:i,reason:`После ${le(c,"dd.MM.yyyy")}${i.startTime?` ${i.startTime}`:""} запрещено создавать ${al(s)} на следующий день ${le(x,"dd.MM.yyyy")} `}}const d=new Date(i.startDate);let h=!1;if(i.endDate){const m=new Date(i.endDate);h=o>=d&&o<=m}else h=o.getTime()===d.getTime();if(h){if(!i.startTime)return{restricted:!0,restriction:i,reason:`Запрещено создавать ${al(s)} на ${le(o,"dd.MM.yyyy")} `};if(t&&i.startTime){const m=t,x=i.startTime;if(m>=x)return{restricted:!0,restriction:i,reason:`Запрещено создавать ${al(s)} после ${x} на ${le(o,"dd.MM.yyyy")} `}}}}return{restricted:!1}}catch(n){return console.error("Error checking restrictions:",n),{restricted:!1}}},al=s=>({slots:"слоты",dayoff:"выходные",sick:"больничные",vacation:"отпуска",absence:"прогулы",all:"любые записи"})[s],To="approvalRequests",Yc=s=>{const e=s.data(),t=new Date().toISOString();return{id:s.id,entity:(e==null?void 0:e.entity)||"slot",action:(e==null?void 0:e.action)||"create",status:(e==null?void 0:e.status)||"pending",authorId:(e==null?void 0:e.authorId)||"",targetUserId:(e==null?void 0:e.targetUserId)||"",before:(e==null?void 0:e.before)??null,after:(e==null?void 0:e.after)??null,comment:e==null?void 0:e.comment,adminComment:e==null?void 0:e.adminComment,reviewedBy:e==null?void 0:e.reviewedBy,createdAt:(e==null?void 0:e.createdAt)||t,updatedAt:(e==null?void 0:e.updatedAt)||(e==null?void 0:e.createdAt)||t}},nj=async s=>{const e=s.before,t=s.after;switch(s.action){case"create":{if(!t)throw new Error("No slot payload for creation");const{id:n,...a}=t;await T0(a);return}case"update":{const n=(t==null?void 0:t.id)||(e==null?void 0:e.id);if(!n||!t)throw new Error("No slot payload for update");const{id:a,...i}=t;await S0(n,i);return}case"delete":{if(!(e!=null&&e.id))throw new Error("No slot id for delete");await _o(e.id);return}default:return}},aj=async s=>{const e=s.before,t=s.after;switch(s.action){case"create":{if(!t)throw new Error("No status payload for creation");const{id:n,...a}=t;await Eo(a);return}case"update":{const n=(t==null?void 0:t.id)||(e==null?void 0:e.id);if(!n||!t)throw new Error("No status payload for update");const{id:a,...i}=t;await Cs(n,i);return}case"delete":{if(!(e!=null&&e.id))throw new Error("No status id for delete");await Io(e.id);return}default:return}},ij=async s=>{const e=s.before,t=s.after;switch(s.action){case"create":{if(!t)throw new Error("No earning payload for creation");const{id:n,...a}=t;await C0(a);return}case"update":{const n=(t==null?void 0:t.id)||(e==null?void 0:e.id);if(!n||!t)throw new Error("No earning payload for update");const{id:a,...i}=t;await D0(n,i);return}case"delete":{if(!(e!=null&&e.id))throw new Error("No earning id for delete");await $0(e.id);return}default:return}},oj=async s=>{const e=s.before,t=s.after;switch(s.action){case"create":{if(!t)throw new Error("No referral payload for creation");const{id:n,...a}=t;await P0(a);return}case"update":{const n=(t==null?void 0:t.id)||(e==null?void 0:e.id);if(!n||!t)throw new Error("No referral payload for update");const{id:a,...i}=t;await O0(n,i);return}case"delete":{if(!(e!=null&&e.id))throw new Error("No referral id for delete");await Qc(e.id);return}default:return}},lj=async s=>{const e=s.after;switch(s.action){case"update":{if(!e||!e.nickname)throw new Error("No nickname payload for update");await bj(s.targetUserId,e.nickname);return}case"delete":{await vj(s.targetUserId);return}default:return}},vt=async s=>{const e=ct(Re,To),t=new Date().toISOString(),n={...s,status:"pending",createdAt:t,updatedAt:t},a=Object.fromEntries(Object.entries(n).filter(([,o])=>o!==void 0));return await gr(e,a)},A0=async(s,e,t)=>{const n=ct(Re,To);let a;a=nt(n);let o=(await zt(a)).docs.map(Yc);return o.sort((c,d)=>d.createdAt.localeCompare(c.createdAt)),o},bh=async(s,e,t)=>{const n=ht(Re,To,s),a=await Rg(n);if(!a.exists())return;const i=Yc(a);if(i.status!=="pending")return;i.entity==="slot"?await nj(i):i.entity==="status"?await aj(i):i.entity==="earning"?await ij(i):i.entity==="referral"?await oj(i):i.entity==="login"&&(await lj(i),Vl(i.targetUserId),await ss(i.targetUserId));const o={status:"approved",reviewedBy:e,updatedAt:new Date().toISOString()},c=i.adminComment;c!==void 0&&(o.adminComment=c),await ar(n,o)},vh=async(s,e,t)=>{const n=ht(Re,To,s),a=await Rg(n);!a.exists()||Yc(a).status!=="pending"||await ar(n,{status:"rejected",adminComment:t,reviewedBy:e,updatedAt:new Date().toISOString()})},Ea=async(s,e,t)=>{const n=ct(Re,"earnings");let a;s?a=nt(n):e&&t?a=nt(n,Tt("date",">=",e),Tt("date","<=",t)):a=nt(n);let o=(await zt(a)).docs.map(c=>{const d=c.data();return{id:c.id,userId:(d==null?void 0:d.userId)||"",date:(d==null?void 0:d.date)||"",amount:(d==null?void 0:d.amount)||0,poolAmount:(d==null?void 0:d.poolAmount)||0,slotId:(d==null?void 0:d.slotId)||"",extraWalletsCount:(d==null?void 0:d.extraWalletsCount)||0,extraWalletsAmount:(d==null?void 0:d.extraWalletsAmount)||0,category:(d==null?void 0:d.category)||"other",participants:(d==null?void 0:d.participants)||[]}});return s&&(o=o.filter(c=>(c.participants&&c.participants.length>0?[...c.participants,c.userId]:[c.userId]).includes(s))),s&&e&&t?o=o.filter(c=>c.date>=e&&c.date<=t):!s&&e&&t&&(o=o.filter(c=>c.date>=e&&c.date<=t)),o.sort((c,d)=>d.date.localeCompare(c.date)),o},C0=async s=>{try{const e=ct(Re,"earnings"),t=Object.fromEntries(Object.entries(s).filter(([a,i])=>i!==void 0));console.log("Adding earnings:",t);const n=await gr(e,t);return console.log("Earnings added successfully:",n.id),n}catch(e){throw console.error("Error in addEarnings:",e),e}},D0=async(s,e)=>{const t=ht(Re,"earnings",s),n=Object.fromEntries(Object.entries(e).filter(([a,i])=>i!==void 0));await ar(t,n)},$0=async s=>{const e=ht(Re,"earnings",s);await yr(e)},R0=async s=>{const e=ct(Re,"ratings");let t=nt(e);return s&&(t=nt(t,Tt("userId","==",s))),(await zt(t)).docs.map(a=>{const i=a.data();return{id:a.id,userId:i.userId||"",earnings:i.earnings||0,messages:i.messages||0,initiatives:i.initiatives||0,signals:i.signals||0,profitableSignals:i.profitableSignals||0,referrals:i.referrals||0,daysOff:i.daysOff||0,sickDays:i.sickDays||0,vacationDays:i.vacationDays||0,absenceDays:i.absenceDays||0,poolAmount:i.poolAmount||0,rating:i.rating||0,lastUpdated:i.lastUpdated||new Date().toISOString()}})},P0=async s=>{try{const e=ct(Re,"referrals"),t=Object.fromEntries(Object.entries(s).filter(([a,i])=>i!==void 0));console.log("Adding referral:",t);const n=await gr(e,t);return console.log("Referral added successfully:",n.id),n}catch(e){throw console.error("Error in addReferral:",e),e}},M0=async(s,e,t)=>{const n=ct(Re,"referrals");let a;a=nt(n,Ms("createdAt","desc"));let o=(await zt(a)).docs.map(c=>{const d=c.data();return{id:c.id,referralId:d.referralId,ownerId:d.ownerId,name:d.name,age:d.age,createdAt:d.createdAt,comment:d.comment}});return e&&t&&(o=o.filter(c=>c.createdAt>=e&&c.createdAt<=t)),o.sort((c,d)=>c.createdAt<d.createdAt?1:-1)},O0=async(s,e)=>{const t=ht(Re,"referrals",s),n=Object.fromEntries(Object.entries(e).filter(([a,i])=>i!==void 0));await ar(t,n)},Qc=async s=>{const e=ht(Re,"referrals",s);await yr(e)},cj=async s=>{if(console.log("📝 Service site: Creating call:",{category:s.category,userId:s.userId,status:s.status,createdAt:s.createdAt}),!Re)throw console.error("❌ Service site: Firestore db is not initialized"),new Error("Firestore database is not initialized");const e=ct(Re,"calls"),t=await gr(e,s);return console.log("✅ Service site: Call created successfully with ID:",t.id),console.log("📊 Service site: Call data saved to Firestore:",s),t.id},dj=async s=>{const e=ct(Re,"calls"),t=[];t.push(Ms("createdAt","desc"));let n;return t.length>0?n=nt(e,...t):n=nt(e,Ms("createdAt","desc")),(await zt(n)).docs.map(o=>{var k,A,D,T,H,L,E,M;const c=o.data(),d=c.category||"memecoins",h=!c.details&&c.ticker?{memecoins:{coinName:c.pair||c.ticker,ticker:c.ticker||"",network:c.network||"solana",contract:c.contract,signalType:c.sentiment||"buy",reason:c.comment||c.risks||"",entryCap:c.entryPoint||"",targets:c.target||"",stopLoss:c.cancelConditions,riskLevel:c.riskLevel||"medium",risks:c.risks||"",holdPlan:"short",liquidityLocked:!1,traderComment:c.comment}}:{},m=c.details||h||{},x=c.riskLevel||((k=m.memecoins)==null?void 0:k.riskLevel)||((A=m.polymarket)==null?void 0:A.riskLevel)||((D=m.staking)==null?void 0:D.protocolRisk)||((T=m.spot)==null?void 0:T.riskLevel)||((H=m.futures)==null?void 0:H.riskLevel),f=c.sentiment||((L=m.memecoins)==null?void 0:L.signalType)||(((E=m.futures)==null?void 0:E.direction)==="long"?"buy":((M=m.futures)==null?void 0:M.direction)==="short"?"sell":void 0);return{id:o.id,userId:c.userId||"",category:d,details:m,sentiment:f,riskLevel:x,comment:c.comment,createdAt:c.createdAt||new Date().toISOString(),status:c.status||"active",maxProfit:c.maxProfit,currentPnL:c.currentPnL,currentMarketCap:c.currentMarketCap,signalMarketCap:c.signalMarketCap,currentPrice:c.currentPrice,entryPrice:c.entryPrice,tags:c.tags||[]}})},V0=async(s,e)=>{const t=ht(Re,"calls",s);await ar(t,e)},uj=async s=>{const e=ht(Re,"calls",s);await yr(e)},hj=async s=>{const e=ct(Re,"tasks");return(await gr(e,s)).id},Xc=async s=>{const e=ct(Re,"tasks"),t=[];s!=null&&s.status&&t.push(Tt("status","==",s.status)),s!=null&&s.category&&t.push(Tt("category","==",s.category)),s!=null&&s.createdBy&&t.push(Tt("createdBy","==",s.createdBy)),t.push(Ms("createdAt","desc"));let n;t.length>0?n=nt(e,...t):n=nt(e,Ms("createdAt","desc"));const a=await zt(n),i=f=>f==="high"||f==="low"||f==="urgent"?f:"medium",o=f=>f==="completed"||f==="closed"?f:"in_progress",c=(f=[])=>f.filter(k=>k==null?void 0:k.userId).slice(0,10).map(k=>({userId:k.userId,priority:i(k.priority),comment:k.comment,instruction:k.instruction}));let d=a.docs.map(f=>{const k=f.data(),D=((Array.isArray(k.assignees)?k.assignees:(k.assignedTo||[]).map(E=>({userId:E,priority:"medium"})))||[]).map(E=>({userId:E.userId||"",priority:i(E.priority),comment:E.comment})).filter(E=>!!E.userId),T=D.map(E=>E.userId),H=Array.isArray(k.coExecutors)?k.coExecutors:Array.isArray(k.executors)?k.executors:[],L=(k.stages||[]).map(E=>({id:E.id||`stage - ${Date.now()} `,name:E.name||"Этап",description:E.description,responsible:E.responsible==="all"?"all":Array.isArray(E.responsible)?E.responsible:(E.assignees||[]).map(M=>M.userId),assignees:c(E.assignees),stagePriority:i(E.stagePriority),requiresApproval:E.requiresApproval??!0,approvals:E.approvals||[],comments:E.comments||[],status:E.status||"pending"}));return{id:f.id,title:k.title||"",description:k.description,category:k.category||"trading",status:o(k.status),createdBy:k.createdBy||"",assignedTo:T,assignees:D,approvals:k.approvals||[],createdAt:k.createdAt||new Date().toISOString(),updatedAt:k.updatedAt||new Date().toISOString(),completedAt:k.completedAt,closedAt:k.closedAt,completedBy:k.completedBy,priority:i(k.priority),dueDate:k.dueDate||new Date().toISOString().split("T")[0],dueTime:k.dueTime||"12:00",startTime:k.startTime,mainExecutor:k.mainExecutor,leadExecutor:k.leadExecutor,deputies:k.deputies||[],coExecutors:H,executors:k.executors||[],curators:k.curators||[],leads:k.leads||[],stages:L,currentStageId:k.currentStageId,awaitingStageId:k.awaitingStageId,comments:k.comments||[],expectedResult:k.expectedResult,requiresApproval:k.requiresApproval??!0}});const h=new Date,m=new Date(h.getTime()-12*60*60*1e3),x=d.filter(f=>f.status==="closed"&&f.closedAt?new Date(f.closedAt)<m:!1);if(x.length>0&&(await Promise.all(x.map(f=>L0(f.id))),d=d.filter(f=>!x.find(k=>k.id===f.id))),s!=null&&s.assignedTo)if(Array.isArray(s.assignedTo)){const f=s.assignedTo;f.length>0&&(d=d.filter(k=>f.some(A=>k.assignedTo.includes(A))))}else d=d.filter(f=>f.assignedTo.includes(s.assignedTo));return d},Xr=async(s,e)=>{const t=ht(Re,"tasks",s),n=Object.fromEntries(Object.entries({...e,updatedAt:new Date().toISOString()}).filter(([a,i])=>i!==void 0));await ar(t,n)},L0=async s=>{const e=ht(Re,"tasks",s);await yr(e)},wh=async(s,e=!1)=>{const t=ct(Re,"notes");let n;!e&&s?n=nt(t,Tt("userId","==",s)):n=nt(t);const i=(await zt(n)).docs.map(o=>{const c=o.data();return{id:o.id,userId:c.userId||"",title:c.title||"",text:c.text||"",priority:c.priority==="low"||c.priority==="high"?c.priority:"medium",createdAt:c.createdAt||new Date().toISOString(),updatedAt:c.updatedAt||new Date().toISOString()}});return i.sort((o,c)=>(c.updatedAt||"").localeCompare(o.updatedAt||"")),s&&!e?i.filter(o=>o.userId===s):i},mj=async s=>{const e=ct(Re,"notes"),t={...s,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};return(await gr(e,t)).id},gj=async(s,e)=>{const t=ht(Re,"notes",s),n=Object.fromEntries(Object.entries({...e,updatedAt:new Date().toISOString()}).filter(([a,i])=>i!==void 0));await ar(t,n)},pj=async s=>{const e=ht(Re,"notes",s);await yr(e)},xj=async()=>{const s=ct(Re,"userActivities"),e=nt(s,Ms("loginAt","desc")),n=(await zt(e)).docs.map(i=>{const o=i.data();return{id:i.id,userId:o.userId||"",loginAt:o.loginAt||new Date().toISOString(),logoutAt:o.logoutAt||void 0,browser:o.browser||"Unknown",userAgent:o.userAgent||"",sessionDuration:o.sessionDuration||void 0,isActive:o.isActive!==!1,pageViews:o.pageViews||[]}}),a=new Map;for(const i of n){const o=a.get(i.userId);(!o||new Date(i.loginAt)>new Date(o.loginAt))&&a.set(i.userId,i)}return Array.from(a.values())},fj=async s=>{const e=ct(Re,"userActivities");return(await gr(e,s)).id},Fl=async(s,e)=>{const t=ht(Re,"userActivities",s),n=Object.fromEntries(Object.entries(e).filter(([a,i])=>i!==void 0));await ar(t,n)},il=async(s,e,t)=>{await Fl(s,{logoutAt:e,sessionDuration:t,isActive:!1})},So=async s=>{const e=ct(Re,"userNicknames"),t=nt(e,Tt("userId","==",s)),n=await zt(t);if(n.empty)return null;const a=n.docs[0].data();return{id:n.docs[0].id,userId:a.userId||"",nickname:a.nickname||"",createdAt:a.createdAt||new Date().toISOString(),updatedAt:a.updatedAt||new Date().toISOString()}},yj=async s=>{const e=await So(s);return(e==null?void 0:e.nickname)||null},bj=async(s,e)=>{const t=ct(Re,"userNicknames"),n=await So(s),a=new Date().toISOString();if(n){const i=ht(Re,"userNicknames",n.id);return await ar(i,{nickname:e,updatedAt:a}),n.id}else return(await gr(t,{userId:s,nickname:e,createdAt:a,updatedAt:a})).id},vj=async s=>{const e=await So(s);e&&await yr(ht(Re,"userNicknames",e.id))},wj=async()=>{const s=ct(Re,"userActivities"),e=new Date,t=new Date(e.getTime()-24*60*60*1e3),n=nt(s,Ms("loginAt","desc"));return(await zt(n)).docs.map(o=>{const c=o.data();return{id:o.id,userId:c.userId||"",loginAt:c.loginAt||new Date().toISOString(),logoutAt:c.logoutAt||void 0,browser:c.browser||"Unknown",userAgent:c.userAgent||"",sessionDuration:c.sessionDuration||void 0,isActive:c.isActive!==!1,pageViews:c.pageViews||[]}}).filter(o=>new Date(o.loginAt)>=t)},F0=async(s,e)=>{const t=ct(Re,"userConflicts");let n;return s&&e!==void 0?n=nt(t,Tt("isActive","==",e),Tt("userId","==",s)):s?n=nt(t,Tt("userId","==",s)):e!==void 0?n=nt(t,Tt("isActive","==",e)):n=nt(t),(await zt(n)).docs.map(i=>{const o=i.data();return{id:i.id,userId:(o==null?void 0:o.userId)||"",restrictedUserId:(o==null?void 0:o.restrictedUserId)||"",reason:(o==null?void 0:o.reason)||"",createdBy:(o==null?void 0:o.createdBy)||"",createdAt:(o==null?void 0:o.createdAt)||"",isActive:(o==null?void 0:o.isActive)??!0}})},kj=async s=>{const e=ct(Re,"userConflicts");return await gr(e,s)},kh=async(s,e)=>{const t=ht(Re,"userConflicts",s);await ar(t,e)},Nj=async s=>{const e=ht(Re,"userConflicts",s);await yr(e)},Ul=async(s,e)=>{const t=ct(Re,"accessBlocks");let n;return s&&e!==void 0?n=nt(t,Tt("isActive","==",e),Tt("userId","==",s)):s?n=nt(t,Tt("userId","==",s)):e!==void 0?n=nt(t,Tt("isActive","==",e)):n=nt(t),(await zt(n)).docs.map(i=>{const o=i.data();return{id:i.id,userId:o==null?void 0:o.userId,reason:(o==null?void 0:o.reason)||"",createdBy:(o==null?void 0:o.createdBy)||"",createdAt:(o==null?void 0:o.createdAt)||"",expiresAt:o==null?void 0:o.expiresAt,isActive:(o==null?void 0:o.isActive)??!0,blockFeatures:(o==null?void 0:o.blockFeatures)||[]}})},jj=async s=>{const e=ct(Re,"accessBlocks");return await gr(e,s)},Zi=async(s,e)=>{const t=ht(Re,"accessBlocks",s);await ar(t,e)},_j=async s=>{const e=ht(Re,"accessBlocks",s);await yr(e)},Jc=async(s,e)=>{try{const t=await Ul(void 0,!0);for(const a of t)if(!a.userId&&a.blockFeatures.includes("all")||a.blockFeatures.includes(e)){if(a.expiresAt&&new Date(a.expiresAt)<new Date){await Zi(a.id,{isActive:!1});continue}return{hasAccess:!1,reason:a.reason,expiresAt:a.expiresAt}}const n=await Ul(s,!0);for(const a of n)if(a.blockFeatures.includes("all")||a.blockFeatures.includes(e)){if(a.expiresAt&&new Date(a.expiresAt)<new Date){await Zi(a.id,{isActive:!1});continue}return{hasAccess:!1,reason:a.reason,expiresAt:a.expiresAt}}return{hasAccess:!0,reason:void 0,expiresAt:void 0}}catch(t){return console.error("Error checking user access:",t),{hasAccess:!0,reason:void 0,expiresAt:void 0}}},Ej=async()=>{const s=ct(Re,"aiAlerts"),e=nt(s,Ms("createdAt","desc"));return(await zt(e)).docs.map(n=>({id:n.id,...n.data()}))},Ij=async s=>{const e=ct(Re,"aiAlerts"),t=Object.fromEntries(Object.entries(s).filter(([a,i])=>i!==void 0));return await gr(e,t)},Tj=async(s,e)=>{const t=ht(Re,"aiAlerts",s),n=Object.fromEntries(Object.entries(e).filter(([a,i])=>i!==void 0));await ar(t,n)},Sj=async s=>{const e=ht(Re,"aiAlerts",s);await yr(e)},Aj=s=>s.includes("Chrome")&&!s.includes("Edg")&&!s.includes("OPR")?"Chrome":s.includes("Firefox")?"Firefox":s.includes("Safari")&&!s.includes("Chrome")?"Safari":s.includes("Edg")?"Edge":s.includes("OPR")?"Opera":"Unknown",Cj=()=>{const{user:s}=pt(),e=I.useRef(null),t=I.useRef(Date.now()),n=I.useRef(!1);I.useEffect(()=>{if(!(s!=null&&s.id)||n.current)return;(async()=>{n.current=!0,t.current=Date.now();const d=navigator.userAgent,h=Aj(d);try{const m=await fj({userId:s.id,loginAt:new Date().toISOString(),browser:h,userAgent:d,isActive:!0,pageViews:[]});e.current=m}catch(m){console.error("Failed to track user activity:",m)}})();const i=()=>{if(e.current){const d=Date.now(),h=Math.floor((d-t.current)/1e3);il(e.current,new Date().toISOString(),h).catch(m=>console.error("Failed to update activity on unload:",m))}},o=setInterval(async()=>{if(e.current&&!document.hidden){const d=Date.now(),h=Math.floor((d-t.current)/1e3);try{await Fl(e.current,{sessionDuration:h,isActive:!0})}catch(m){console.error("Failed to update activity duration:",m)}}},3e4),c=async()=>{if(document.hidden&&e.current){const d=Date.now(),h=Math.floor((d-t.current)/1e3);try{await il(e.current,new Date().toISOString(),h)}catch(m){console.error("Failed to update activity on visibility change:",m)}}else if(!document.hidden&&e.current)try{await Fl(e.current,{isActive:!0})}catch(d){console.error("Failed to reactivate activity:",d)}};return window.addEventListener("beforeunload",i),document.addEventListener("visibilitychange",c),()=>{if(clearInterval(o),window.removeEventListener("beforeunload",i),document.removeEventListener("visibilitychange",c),e.current){const d=Date.now(),h=Math.floor((d-t.current)/1e3);il(e.current,new Date().toISOString(),h).catch(m=>console.error("Failed to update activity on unmount:",m))}}},[s==null?void 0:s.id])},mr=({children:s})=>{const{theme:e,toggleTheme:t}=at(),{isAdmin:n}=kt(),{user:a}=pt(),i=Rh(),[o,c]=I.useState(!1),[d,h]=I.useState(!1),[m,x]=I.useState([]),[f,k]=I.useState(new Set);Cj(),I.useEffect(()=>{(async()=>{if(!a||n){k(new Set(["slots","earnings","tasks","rating","profile","admin"]));return}const M=["slots","earnings","tasks","rating","profile"],ee=new Set;for(const C of M)try{(await Jc(a.id,C)).hasAccess&&ee.add(C)}catch(v){console.error(`Error checking access to ${C}:`,v),ee.add(C)}k(ee)})()},[a,n]);const D=[{path:"/call",label:"AVF HUB",icon:Tr,feature:"slots"},{path:"/management",label:"AVF Schedule",icon:Tr,feature:"slots"},{path:"/tasks",label:"AVF Tasks",icon:ts,feature:"tasks"},{path:"/earnings",label:"AVF Profit",icon:Sa,feature:"earnings"},{path:"/rating",label:"AVF Score",icon:sr,feature:"rating"},{path:"/about",label:"AVF NFO",icon:_r,feature:"profile"},...n?[{path:"/approvals",label:"AVF Check",icon:$n,feature:"admin"}]:[]].filter(E=>!E.feature||f.has(E.feature)||n),T=[{path:"/meme-evaluation",label:"Оценка мема",icon:sr},{path:"/ai-ao-alerts",label:"ИИ - АО Alerts",icon:Lt}],H=T.some(E=>i.pathname===E.path);I.useEffect(()=>{c(!1)},[i.pathname]),I.useEffect(()=>{const E=async()=>{try{if(n||!a){x([]);return}const ee=[],C=Date.now()-6*60*60*1e3,v=Date.now(),p=60*60*1e3,w=`viewedNotifications_${a.id}`,N=JSON.parse(localStorage.getItem(w)||"[]"),b=(await A0()).filter(O=>{if(O.authorId!==a.id&&O.targetUserId!==a.id)return!1;const P=Date.parse(O.updatedAt||O.createdAt);return!(Number.isNaN(P)||P<C||N.includes(`approval_${O.id}`))}).map(O=>{const P=Date.parse(O.updatedAt||O.createdAt||new Date().toISOString());return{id:`approval_${O.id}`,status:O.status,text:`${O.entity==="slot"?"Слот":O.entity==="status"?"Статус":O.entity==="login"?"Ник":O.entity==="earning"?"Заработок":O.entity==="referral"?"Реферал":"Изменение"} • ${O.status==="approved"?"Подтверждено":O.status==="rejected"?"Отклонено":"На согласовании"}${O.adminComment?`: ${O.adminComment}`:""}`,time:le(O.updatedAt||O.createdAt||new Date().toISOString(),"dd.MM HH:mm"),timestamp:Number.isNaN(P)?v:P}});ee.push(...b);const re=(await Xc({assignedTo:a.id})).filter(O=>{const P=Date.parse(O.createdAt),te=!Number.isNaN(P)&&P>=C&&!N.includes(`task_new_${O.id}`);if(!O.dueDate||!O.dueTime)return te;const fe=new Date(`${O.dueDate}T${O.dueTime}`).getTime();if(Number.isNaN(fe))return te;const F=fe-v,ne=F>0&&F<=p&&!N.includes(`task_due_${O.id}`),V=F<0&&F>=-C&&!N.includes(`task_overdue_${O.id}`);return te||ne||V}).map(O=>{const P=Date.parse(O.createdAt);if(!Number.isNaN(P)&&P>=C&&!N.includes(`task_new_${O.id}`)){const ne=Date.parse(O.createdAt);return{id:`task_new_${O.id}`,status:"new",text:`Новая задача: ${O.title}`,time:le(O.createdAt,"dd.MM HH:mm"),timestamp:Number.isNaN(ne)?v:ne}}if(!O.dueDate||!O.dueTime)return null;const J=new Date(`${O.dueDate}T${O.dueTime}`),fe=J.getTime();if(Number.isNaN(fe))return null;const F=fe-v;return F>0&&F<=p&&!N.includes(`task_due_${O.id}`)?{id:`task_due_${O.id}`,status:"due",text:`Дедлайн через час: ${O.title}`,time:le(J.toISOString(),"dd.MM HH:mm"),timestamp:fe}:F<0&&F>=-C&&!N.includes(`task_overdue_${O.id}`)?{id:`task_overdue_${O.id}`,status:"overdue",text:`Просрочен дедлайн: ${O.title}`,time:le(J.toISOString(),"dd.MM HH:mm"),timestamp:fe}:null}).filter(O=>O!==null);ee.push(...re);const W=(await fr(a.id)).filter(O=>{if(N.includes(`slot_ended_${O.id}`)||!O.slots||O.slots.length===0)return!1;const P=O.slots[O.slots.length-1];if(!P)return!1;let te;if(P.endDate){te=new Date(P.endDate);const[fe,F]=P.end.split(":").map(Number);te.setHours(fe,F,0,0)}else{te=new Date(O.date);const[fe,F]=P.end.split(":").map(Number);te.setHours(fe,F,0,0)}const J=te.getTime();return Number.isNaN(J)?!1:J<v&&J>=v-C}).map(O=>{const P=O.slots[O.slots.length-1];let te;if(P.endDate){te=new Date(P.endDate);const[J,fe]=P.end.split(":").map(Number);te.setHours(J,fe,0,0)}else{te=new Date(O.date);const[J,fe]=P.end.split(":").map(Number);te.setHours(J,fe,0,0)}return{id:`slot_ended_${O.id}`,status:"ended",text:`Слот завершился: ${le(O.date,"dd.MM.yyyy")}`,time:le(te.toISOString(),"dd.MM HH:mm"),timestamp:te.getTime()}});ee.push(...W),ee.sort((O,P)=>(P.timestamp||0)-(O.timestamp||0)),x(ee.map(({timestamp:O,...P})=>P))}catch(ee){console.error("Failed to load notifications",ee)}};E();const M=setInterval(E,2*60*1e3);return()=>clearInterval(M)},[a,n]);const L=E=>E.split(" ").map(M=>M[0]).join("").toUpperCase().substring(0,2);return r.jsxs("div",{className:`min-h-screen ${e==="dark"?"dark bg-[#0b0f17]":"bg-[#f8fafc]"}`,children:[r.jsxs("div",{className:"absolute inset-0 pointer-events-none -z-10 overflow-hidden",children:[r.jsx("div",{className:"absolute -top-24 -left-12 w-80 h-80 bg-gradient-to-br from-[#4E6E49]/25 via-transparent to-transparent blur-3xl"}),r.jsx("div",{className:"absolute top-8 right-0 w-[520px] h-[520px] bg-gradient-to-bl from-blue-500/12 via-purple-500/10 to-transparent blur-3xl"}),r.jsx("div",{className:"absolute bottom-[-120px] left-12 w-96 h-96 bg-gradient-to-tr from-amber-400/10 to-[#4E6E49]/12 blur-3xl"}),r.jsx("div",{className:"floating-grid"})]}),r.jsxs("div",{className:"flex flex-col lg:flex-row-reverse min-h-screen",children:[r.jsxs("aside",{className:"hidden lg:flex w-72 h-screen fixed right-0 top-0 flex-col glass-panel border-l border-white/40 dark:border-white/10 z-50 overflow-hidden",children:[r.jsx("div",{className:"accent-dots"}),r.jsxs("div",{className:"relative z-10 p-6 flex items-center gap-3",children:[r.jsx("div",{className:"relative w-10 h-10 rounded-xl bg-white/80 dark:bg-white/5 border border-white/50 dark:border-white/10 shadow-lg overflow-hidden flex items-center justify-center",children:r.jsx("img",{src:Zh,alt:"Logo",className:"w-8 h-8 object-contain"})}),r.jsxs("div",{children:[r.jsx("p",{className:"text-[10px] uppercase tracking-[0.2em] font-bold text-[#4E6E49]",children:"ApeVault"}),r.jsx("p",{className:`text-sm font-black tracking-tight ${e==="dark"?"text-white":"text-gray-900"}`,children:"FRONTIER"})]})]}),r.jsx("div",{className:"h-px w-full bg-gradient-to-r from-transparent via-gray-200/50 dark:via-white/10 to-transparent my-2"}),r.jsxs("nav",{className:"relative z-10 flex-1 px-4 py-4 space-y-1 overflow-y-auto",children:[r.jsxs("div",{className:"space-y-1",children:[r.jsxs("button",{onClick:()=>c(!o),className:`w-full flex items-center gap-3 px-4 py-3 rounded-xl transition-all ${H?"bg-[#4E6E49]/15 text-[#4E6E49]":"text-gray-500 hover:bg-gray-100/50 dark:hover:bg-white/5"}`,children:[r.jsx(bs,{className:"w-4 h-4"}),r.jsx("span",{className:"font-bold flex-1 text-left",children:"Tools"}),r.jsx(Hl,{className:`w-4 h-4 transition-transform ${o?"rotate-180":""}`})]}),o&&r.jsx("div",{className:"pl-11 pr-4 py-1 space-y-1",children:T.map(E=>r.jsx(Qr,{to:E.path,className:`block py-2 text-sm font-medium transition-colors ${i.pathname===E.path?"text-[#4E6E49]":"text-gray-400 hover:text-[#4E6E49]"}`,children:E.label},E.path))})]}),D.map(E=>r.jsxs(Qr,{to:E.path,className:`flex items-center gap-3 px-4 py-3 rounded-xl transition-all ${i.pathname===E.path?"bg-[#4E6E49] text-white shadow-lg shadow-[#4E6E49]/30":"text-gray-500 hover:bg-gray-100/50 dark:hover:bg-white/5 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white"}`,children:[r.jsx(E.icon,{className:"w-4 h-4"}),r.jsx("span",{className:"font-bold text-sm tracking-tight",children:E.label})]},E.path)),r.jsxs("div",{className:"pt-4 space-y-4",children:[r.jsxs("div",{className:"flex items-center justify-between px-4",children:[r.jsx("button",{onClick:t,className:"p-2 rounded-xl border border-gray-200 dark:border-white/10 hover:bg-gray-100 dark:hover:bg-white/5 transition-colors",children:e==="dark"?r.jsx(Jh,{className:"w-4 h-4 text-amber-300"}):r.jsx(Gl,{className:"w-4 h-4 text-gray-700"})}),r.jsxs("button",{onClick:()=>h(!d),className:`relative p-2 rounded-xl border border-gray-200 dark:border-white/10 hover:bg-gray-100 dark:hover:bg-white/5 transition-colors ${d?"bg-amber-500/10":""}`,children:[r.jsx(rx,{className:"w-4 h-4"}),m.length>0&&r.jsx("span",{className:"absolute -top-1 -right-1 w-2 h-2 bg-red-500 rounded-full"})]})]}),d&&r.jsx("div",{className:"mx-2 p-3 glass-panel rounded-xl border border-white/20 shadow-xl max-h-60 overflow-y-auto space-y-2",children:m.length===0?r.jsx("p",{className:"text-[10px] text-gray-500",children:"Нет уведомлений"}):m.map(E=>r.jsxs("div",{className:"text-[10px] p-2 rounded-lg bg-black/5 dark:bg-white/5",children:[r.jsx("p",{className:"font-bold",children:E.text}),r.jsx("p",{className:"opacity-60",children:E.time})]},E.id))})]})]}),r.jsxs(Qr,{to:"/profile",className:`relative z-10 m-4 p-4 rounded-2xl flex items-center gap-3 transition-all ${i.pathname==="/profile"?"bg-[#4E6E49]/10 border border-[#4E6E49]/30":"border border-gray-200/50 dark:border-white/5 hover:bg-gray-100/50 dark:hover:bg-white/5"}`,children:[r.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center font-bold text-sm shadow-inner ${e==="dark"?"bg-emerald-500/20 text-[#4E6E49]":"bg-[#4E6E49]/10 text-[#4E6E49]"}`,children:a!=null&&a.avatar?r.jsx("img",{src:a.avatar,className:"w-full h-full rounded-full object-cover"}):L((a==null?void 0:a.name)||"User")}),r.jsxs("div",{className:"flex-1 min-w-0",children:[r.jsx("p",{className:"text-sm font-bold truncate dark:text-white",children:(a==null?void 0:a.name)||"Administrator"}),r.jsx("p",{className:"text-[10px] text-gray-500 font-medium truncate",children:(a==null?void 0:a.login)||"admin@apevault.io"})]})]})]}),r.jsx("div",{className:"flex-1 lg:pr-72 min-h-screen",children:r.jsx("main",{className:"page-shell",children:s})}),r.jsxs("nav",{className:"lg:hidden fixed bottom-4 left-0 right-0 px-3 z-50",children:[r.jsx("div",{className:"max-w-5xl mx-auto",children:r.jsx("div",{className:"glass-panel rounded-2xl shadow-2xl border border-white/60 dark:border-white/10 overflow-hidden",children:r.jsxs("div",{className:"flex divide-x divide-white/40 dark:divide-white/5 w-full overflow-x-auto no-scrollbar",children:[r.jsxs("button",{onClick:()=>c(!o),className:`flex-none w-20 flex flex-col items-center justify-center gap-1 py-3 ${H?"text-[#4E6E49]":"text-gray-400"}`,children:[r.jsx(bs,{className:"w-5 h-5"}),r.jsx("span",{className:"text-[10px] font-bold",children:"Tools"})]}),D.map(E=>r.jsxs(Qr,{to:E.path,className:`flex-none w-20 flex flex-col items-center justify-center gap-1 py-3 ${i.pathname===E.path?"text-[#4E6E49]":"text-gray-400"}`,children:[r.jsx(E.icon,{className:"w-5 h-5"}),r.jsx("span",{className:"text-[10px] font-bold",children:E.label.replace("AVF ","")})]},E.path)),r.jsxs(Qr,{to:"/profile",className:`flex-none min-w-[120px] flex items-center gap-2 px-3 py-2 ${i.pathname==="/profile"?"text-[#4E6E49]":"text-gray-400"}`,children:[r.jsx("div",{className:"w-8 h-8 rounded-full bg-[#4E6E49]/10 flex items-center justify-center text-[10px] font-bold flex-shrink-0",children:L((a==null?void 0:a.name)||"AU")}),r.jsxs("div",{className:"min-w-0 flex flex-col items-start px-1",children:[r.jsx("span",{className:"text-[10px] font-bold truncate w-full text-left",children:(a==null?void 0:a.name)||"User"}),r.jsx("span",{className:"text-[8px] opacity-60 truncate w-full text-left",children:(a==null?void 0:a.login)||"id"})]})]})]})})}),o&&r.jsxs(r.Fragment,{children:[r.jsx("div",{className:"fixed inset-0 bg-black/40 backdrop-blur-sm z-[-1]",onClick:()=>c(!1)}),r.jsx("div",{className:"absolute bottom-20 left-4 right-4 glass-panel rounded-2xl border border-white/40 overflow-hidden animate-fade-in",children:T.map(E=>r.jsxs(Qr,{to:E.path,onClick:()=>c(!1),className:"flex items-center gap-3 p-4 border-b border-white/10 last:border-0",children:[r.jsx(E.icon,{className:"w-4 h-4 text-[#4E6E49]"}),r.jsx("span",{className:"font-bold text-sm flex-1",children:E.label}),r.jsx(Cr,{className:"w-4 h-4 opacity-40"})]},E.path))})]})]})]})]})},Nh=[{value:"solana",label:"Solana"},{value:"ethereum",label:"ETH"},{value:"bsc",label:"BSC"},{value:"ton",label:"TON"},{value:"base",label:"Base"},{value:"sui",label:"SUI"},{value:"monad",label:"Monad"},{value:"polygon",label:"Polygon"}],cn={memecoins:{label:"Мемкоины",gradient:"from-emerald-300 to-teal-400",icon:r.jsx(Rn,{className:"w-5 h-5"}),pastelBg:"bg-emerald-50",pastelBorder:"border-emerald-100",pastelText:"text-emerald-800"},futures:{label:"Фьючерсы",gradient:"from-sky-300 to-indigo-400",icon:r.jsx(Ca,{className:"w-5 h-5"}),pastelBg:"bg-sky-50",pastelBorder:"border-sky-100",pastelText:"text-sky-800"},nft:{label:"NFT",gradient:"from-purple-300 to-pink-300",icon:r.jsx(Aa,{className:"w-5 h-5"}),pastelBg:"bg-purple-50",pastelBorder:"border-purple-100",pastelText:"text-purple-800"},spot:{label:"Спот",gradient:"from-amber-300 to-orange-300",icon:r.jsx(rr,{className:"w-5 h-5"}),pastelBg:"bg-amber-50",pastelBorder:"border-amber-100",pastelText:"text-amber-800"},polymarket:{label:"Polymarket",gradient:"from-rose-300 to-red-300",icon:r.jsx(Qt,{className:"w-5 h-5"}),pastelBg:"bg-rose-50",pastelBorder:"border-rose-100",pastelText:"text-rose-800"},staking:{label:"Стейкинг",gradient:"from-cyan-300 to-blue-300",icon:r.jsx($t,{className:"w-5 h-5"}),pastelBg:"bg-cyan-50",pastelBorder:"border-cyan-100",pastelText:"text-cyan-800"}},Dj={memecoins:{basic:{title:"Основная информация",icon:r.jsx(_r,{className:"w-4 h-4"}),description:"Базовые данные о монете"},entry:{title:"Зоны входа",icon:r.jsx(dr,{className:"w-4 h-4"}),description:"Условия для входа в позицию"},targets:{title:"Цели и риски",icon:r.jsx(sr,{className:"w-4 h-4"}),description:"План прибыли и управления рисками"},additional:{title:"Дополнительно",icon:r.jsx(bs,{className:"w-4 h-4"}),description:"Дополнительные настройки и комментарии"}},futures:{basic:{title:"Основная информация",icon:r.jsx(_r,{className:"w-4 h-4"}),description:"Данные о паре и направлении"},entry:{title:"Зоны входа",icon:r.jsx(dr,{className:"w-4 h-4"}),description:"Условия входа и размер позиции"},targets:{title:"Цели и риски",icon:r.jsx(sr,{className:"w-4 h-4"}),description:"План прибыли и стоп-лоссы"},strategy:{title:"Стратегия",icon:r.jsx(Qt,{className:"w-4 h-4"}),description:"Тип сигнала и анализ"},additional:{title:"Дополнительно",icon:r.jsx(bs,{className:"w-4 h-4"}),description:"Комментарии и детали"}},nft:{basic:{title:"Основная информация",icon:r.jsx(_r,{className:"w-4 h-4"}),description:"Данные о NFT и коллекции"},entry:{title:"Условия входа",icon:r.jsx(dr,{className:"w-4 h-4"}),description:"Цена и условия покупки"},targets:{title:"Цели и риски",icon:r.jsx(sr,{className:"w-4 h-4"}),description:"План продажи и риски"},additional:{title:"Дополнительно",icon:r.jsx(bs,{className:"w-4 h-4"}),description:"Анализ и комментарии"}},spot:{basic:{title:"Основная информация",icon:r.jsx(_r,{className:"w-4 h-4"}),description:"Данные о монете"},entry:{title:"Зоны входа",icon:r.jsx(dr,{className:"w-4 h-4"}),description:"Условия входа в позицию"},targets:{title:"Цели и риски",icon:r.jsx(sr,{className:"w-4 h-4"}),description:"План прибыли и стоп-лоссы"},additional:{title:"Дополнительно",icon:r.jsx(bs,{className:"w-4 h-4"}),description:"Анализ и комментарии"}},polymarket:{basic:{title:"Основная информация",icon:r.jsx(_r,{className:"w-4 h-4"}),description:"Данные о событии"},entry:{title:"Условия входа",icon:r.jsx(dr,{className:"w-4 h-4"}),description:"Позиция и цена входа"},targets:{title:"Цели и риски",icon:r.jsx(sr,{className:"w-4 h-4"}),description:"План прибыли и риски"},additional:{title:"Дополнительно",icon:r.jsx(bs,{className:"w-4 h-4"}),description:"Анализ и детали"}},staking:{basic:{title:"Основная информация",icon:r.jsx(_r,{className:"w-4 h-4"}),description:"Данные о стейкинге"},entry:{title:"Условия входа",icon:r.jsx(dr,{className:"w-4 h-4"}),description:"Платформа и условия"},targets:{title:"Риски и анализ",icon:r.jsx(Lt,{className:"w-4 h-4"}),description:"Оценка рисков"},additional:{title:"Дополнительно",icon:r.jsx(bs,{className:"w-4 h-4"}),description:"Комментарии и детали"}}},jh={memecoins:[{key:"coinName",label:"Название монеты",placeholder:"PEPE",section:"basic"},{key:"ticker",label:"Тикер",placeholder:"PEPE",section:"basic"},{key:"network",label:"Сеть",type:"select",options:Nh,section:"basic"},{key:"contract",label:"Контракт",placeholder:"0x...",section:"basic"},{key:"signalType",label:"Тип сигнала",type:"select",options:[{value:"buy",label:"Buy"},{value:"sell",label:"Sell"},{value:"hold",label:"Hold"},{value:"alert",label:"Alert"}],section:"basic"},{key:"reason",label:"Причина входа",placeholder:"Хайп, крупные покупки, листинг...",type:"textarea",section:"entry"},{key:"entryCap",label:"Зона входа в капитализации",placeholder:"10M-15M",section:"entry"},{key:"targets",label:"Цели (TP1/TP2/TP3)",placeholder:"20M / 30M / 50M",section:"targets"},{key:"stopLoss",label:"Стоп-лосс",placeholder:"5M или -25%",section:"targets"},{key:"riskLevel",label:"Риск-уровень",type:"select",options:[{value:"low",label:"Низкий"},{value:"medium",label:"Средний"},{value:"high",label:"Высокий"},{value:"ultra",label:"Ультра-высокий"}],section:"targets"},{key:"risks",label:"Риски",placeholder:"Разворот тренда, низкая ликвидность",type:"textarea",section:"targets"},{key:"holdPlan",label:"План удержания",type:"select",options:[{value:"flip",label:"Флип"},{value:"short",label:"Краткосрок"},{value:"medium",label:"Среднесрок"},{value:"long",label:"Дальнесрок"}],section:"additional"},{key:"liquidityLocked",label:"Залочена ли ликвидность",type:"checkbox",section:"additional"},{key:"traderComment",label:"Комментарий трейдера",type:"textarea",placeholder:"Доп. наблюдения, планы",section:"additional"}],futures:[{key:"pair",label:"Пара",placeholder:"BTC/USDT",section:"basic"},{key:"direction",label:"Направление",type:"select",options:[{value:"long",label:"Long"},{value:"short",label:"Short"}],section:"basic"},{key:"leverage",label:"Рекомендованное плечо",placeholder:"x3 - x10",section:"entry"},{key:"entryPrice",label:"Цена входа",placeholder:"69500",section:"entry"},{key:"entryZone",label:"Зоны входа (min-max)",placeholder:"69000 - 70000",section:"entry"},{key:"positionSize",label:"Размер позиции (% от депо)",placeholder:"2-5%",section:"entry"},{key:"targets",label:"Цели (TP1/TP2/TP3)",placeholder:"71000 / 72500 / 74000",section:"targets"},{key:"stopLoss",label:"SL уровень",placeholder:"68000",section:"targets"},{key:"riskLevel",label:"Риск-уровень",type:"select",options:[{value:"low",label:"Низкий"},{value:"medium",label:"Средний"},{value:"high",label:"Высокий"},{value:"ultra",label:"Ультра-высокий"}],section:"targets"},{key:"signalStyle",label:"Тип сигнала",type:"select",options:[{value:"breakout",label:"Breakout"},{value:"retest",label:"Retest"},{value:"range",label:"Range"},{value:"scalping",label:"Scalping"},{value:"swing",label:"Swing"}],section:"strategy"},{key:"timeframe",label:"Таймфрейм анализа",type:"select",options:[{value:"1m",label:"1m"},{value:"5m",label:"5m"},{value:"15m",label:"15m"},{value:"1h",label:"1h"},{value:"4h",label:"4h"}],section:"strategy"},{key:"reason",label:"Причина входа (анализ)",placeholder:"Тренд, объемы, дивергенция...",type:"textarea",section:"strategy"},{key:"risks",label:"Риски",placeholder:"Резкий вброс, низкая волатильность",type:"textarea",section:"additional"}],nft:[{key:"collectionLink",label:"Коллекция (ссылка)",placeholder:"https://...",section:"basic"},{key:"nftLink",label:"NFT (ссылка)",placeholder:"https://.../item",section:"basic"},{key:"marketplace",label:"Маркетплейс",placeholder:"OpenSea / Magic Eden",section:"basic"},{key:"network",label:"Сеть",type:"select",options:Nh,section:"basic"},{key:"entryPrice",label:"Рекомендованная цена входа",placeholder:"1.2 ETH",section:"entry"},{key:"rarity",label:"Редкость / атрибуты",placeholder:"Rank < 5%",section:"entry"},{key:"minLiquidity",label:"Минимальная ликвидность",placeholder:"Floor 2 ETH, объём 120 ETH",section:"entry"},{key:"signalType",label:"Тип сигнала",type:"select",options:[{value:"buy",label:"Buy"},{value:"sell",label:"Sell"},{value:"mint",label:"Mint"}],section:"entry"},{key:"holdingHorizon",label:"Срок удержания",type:"select",options:[{value:"flip",label:"Скоростной флип"},{value:"short",label:"Краткосрок"},{value:"medium",label:"Среднесрок"},{value:"long",label:"Долгосрок"}],section:"targets"},{key:"targetPrice",label:"Цель продажи / Target price",placeholder:"3 ETH",section:"targets"},{key:"risks",label:"Риски",placeholder:"Падение спроса, фальшивый объём",type:"textarea",section:"targets"},{key:"reason",label:"Причина входа",placeholder:"Минт, хайп, инсайд",type:"textarea",section:"additional"},{key:"traderComment",label:"Комментарий трейдера",type:"textarea",placeholder:"Что смотрим, когда фиксируем",section:"additional"}],spot:[{key:"coin",label:"Монета",placeholder:"BTC",section:"basic"},{key:"entryCap",label:"Капитализация входа",placeholder:"500M",section:"entry"},{key:"positionSize",label:"Размер позиции",placeholder:"5-10% портфеля",section:"entry"},{key:"targets",label:"Цели (TP1/TP2/TP3)",placeholder:"550M / 650M / 750M",section:"targets"},{key:"stopLoss",label:"SL",placeholder:"-10%",section:"targets"},{key:"holdingHorizon",label:"Горизонт удержания",type:"select",options:[{value:"short",label:"Краткосрок"},{value:"medium",label:"Среднесрок"},{value:"long",label:"Долгосрок"}],section:"targets"},{key:"riskLevel",label:"Риск-уровень",type:"select",options:[{value:"low",label:"Низкий"},{value:"medium",label:"Средний"},{value:"high",label:"Высокий"},{value:"ultra",label:"Ультра-высокий"}],section:"targets"},{key:"reason",label:"Причина входа",placeholder:"Фундаментал, хайп",type:"textarea",section:"additional"},{key:"risks",label:"Риски",placeholder:"Регуляторика, конкуренты",type:"textarea",section:"additional"},{key:"traderComment",label:"Комментарий",type:"textarea",placeholder:"Условия фиксации, обновления",section:"additional"}],polymarket:[{key:"event",label:"Событие",placeholder:"Trump wins 2025",section:"basic"},{key:"eventDeadline",label:"Срок исхода события",placeholder:"31.12.2025",section:"basic"},{key:"positionType",label:"Тип позиции",type:"select",options:[{value:"yes",label:"Yes"},{value:"no",label:"No"}],section:"entry"},{key:"entryPrice",label:"Цена входа (%)",placeholder:"42%",section:"entry"},{key:"expectedProbability",label:"Ожидаемая вероятность (%)",placeholder:"65%",section:"entry"},{key:"maxStake",label:"Максимальный объём ставки",placeholder:"до $5k",section:"entry"},{key:"targetPlan",label:"Цель",placeholder:"Продажа до события или удержание",section:"targets"},{key:"riskLevel",label:"Риск",type:"select",options:[{value:"low",label:"Низкий"},{value:"medium",label:"Средний"},{value:"high",label:"Высокий"},{value:"ultra",label:"Ультра-высокий"}],section:"targets"},{key:"risks",label:"Риски",placeholder:"Неопределённость новостей, низкая ликвидность",type:"textarea",section:"targets"},{key:"reason",label:"Причина входа",placeholder:"Аналитика, инсайд",type:"textarea",section:"additional"}],staking:[{key:"coin",label:"Монета",placeholder:"SOL",section:"basic"},{key:"platform",label:"Платформа",placeholder:"Jito, Lido...",section:"entry"},{key:"term",label:"Срок стейкинга",type:"select",options:[{value:"flexible",label:"Гибкий"},{value:"30d",label:"30 дней"},{value:"90d",label:"90 дней"},{value:"fixed",label:"Фиксированный"}],section:"entry"},{key:"apy",label:"APY",placeholder:"12-18%",section:"entry"},{key:"minDeposit",label:"Минимальный депозит",placeholder:"100 USDT",section:"entry"},{key:"action",label:"Тип сигнала",type:"select",options:[{value:"enter",label:"Вход"},{value:"exit",label:"Выход"},{value:"rebalance",label:"Перераспределение"}],section:"entry"},{key:"protocolRisk",label:"Риски протокола",type:"select",options:[{value:"low",label:"Низкие"},{value:"medium",label:"Средние"},{value:"high",label:"Высокие"},{value:"ultra",label:"Ультра"}],section:"targets"},{key:"risks",label:"Риски",placeholder:"Смарт-контракт, ликвидность",type:"textarea",section:"targets"},{key:"reason",label:"Причина",placeholder:"Рост доходности",type:"textarea",section:"additional"},{key:"traderComment",label:"Комментарий трейдера",type:"textarea",placeholder:"Тактика выхода, дополнительные условия",section:"additional"}]},_h=()=>({memecoins:{coinName:"",ticker:"",network:"solana",contract:"",signalType:"buy",reason:"",entryCap:"",targets:"",stopLoss:"",riskLevel:"medium",risks:"",holdPlan:"short",liquidityLocked:!1,traderComment:""},futures:{pair:"",direction:"long",leverage:"",entryPrice:"",entryZone:"",targets:"",stopLoss:"",signalStyle:"breakout",positionSize:"",reason:"",timeframe:"1h",risks:"",riskLevel:"medium"},nft:{collectionLink:"",nftLink:"",marketplace:"",network:"ethereum",entryPrice:"",rarity:"",signalType:"buy",reason:"",holdingHorizon:"short",minLiquidity:"",targetPrice:"",traderComment:"",risks:""},spot:{coin:"",entryCap:"",targets:"",stopLoss:"",holdingHorizon:"medium",reason:"",positionSize:"",risks:"",traderComment:"",riskLevel:"medium"},polymarket:{event:"",positionType:"yes",entryPrice:"",expectedProbability:"",reason:"",eventDeadline:"",riskLevel:"medium",maxStake:"",risks:"",targetPlan:""},staking:{coin:"",platform:"",term:"flexible",apy:"",minDeposit:"",protocolRisk:"medium",action:"enter",reason:"",risks:"",traderComment:""}}),Eh=(s,e)=>({memecoins:{...s.memecoins,...(e==null?void 0:e.memecoins)||{}},futures:{...s.futures,...(e==null?void 0:e.futures)||{}},nft:{...s.nft,...(e==null?void 0:e.nft)||{}},spot:{...s.spot,...(e==null?void 0:e.spot)||{}},polymarket:{...s.polymarket,...(e==null?void 0:e.polymarket)||{}},staking:{...s.staking,...(e==null?void 0:e.staking)||{}}}),$j=({onSuccess:s,onCancel:e,callToEdit:t,initialCategory:n})=>{const{theme:a}=at(),{user:i}=pt(),[o,c]=I.useState(!1),[d,h]=I.useState(""),[m,x]=I.useState(!1),f=Eh(_h(),t==null?void 0:t.details),[k,A]=I.useState((t==null?void 0:t.category)||n||"memecoins"),[D,T]=I.useState((t==null?void 0:t.comment)||""),[H,L]=I.useState(f);I.useEffect(()=>{const S=Eh(_h(),t==null?void 0:t.details);L(S),A((t==null?void 0:t.category)||n||"memecoins"),T((t==null?void 0:t.comment)||"")},[t,n]);const E=a==="dark"?"text-white":"text-gray-900",M=a==="dark"?"border-gray-800":"border-gray-200",ee=a==="dark"?"bg-gray-700/60":"bg-gray-50",C=a==="dark"?"text-gray-400":"text-gray-500",v=C,p=a==="dark"?"bg-[#121212]":"bg-white",w=(S,R)=>{L(K=>({...K,[k]:{...K[k],[S]:R}}))},N=S=>(S==null?void 0:S.riskLevel)||(S==null?void 0:S.protocolRisk)||void 0,j=S=>{if(S!=null&&S.signalType)return S.signalType;if((S==null?void 0:S.direction)==="long")return"buy";if((S==null?void 0:S.direction)==="short")return"sell"},y=(()=>{const R=jh[k].filter(Q=>Q.required),K=H[k]||{};let U=0;return R.forEach(Q=>{const $=K[Q.key];$!=null&&$!==""&&U++}),{filled:U,total:R.length,percentage:R.length>0?Math.round(U/R.length*100):100}})(),re={low:"bg-emerald-500/10 text-emerald-600 border border-emerald-500/20",medium:"bg-blue-500/10 text-blue-600 border border-blue-500/20",high:"bg-amber-500/10 text-amber-600 border border-amber-500/20",ultra:"bg-red-500/10 text-red-600 border border-red-500/20"},ue={memecoins:{bg:a==="dark"?"bg-emerald-500/10":"bg-emerald-50",text:a==="dark"?"text-emerald-100":"text-emerald-800",border:a==="dark"?"border-emerald-500/30":"border-emerald-200",chipBg:a==="dark"?"bg-emerald-500/20":"bg-emerald-500/10"},futures:{bg:a==="dark"?"bg-sky-500/10":"bg-sky-50",text:a==="dark"?"text-sky-100":"text-sky-800",border:a==="dark"?"border-sky-500/30":"border-sky-200",chipBg:a==="dark"?"bg-sky-500/20":"bg-sky-500/10"},nft:{bg:a==="dark"?"bg-purple-500/10":"bg-purple-50",text:a==="dark"?"text-purple-100":"text-purple-800",border:a==="dark"?"border-purple-500/30":"border-purple-200",chipBg:a==="dark"?"bg-purple-500/20":"bg-purple-500/10"},spot:{bg:a==="dark"?"bg-amber-500/10":"bg-amber-50",text:a==="dark"?"text-amber-100":"text-amber-800",border:a==="dark"?"border-amber-500/30":"border-amber-200",chipBg:a==="dark"?"bg-amber-500/20":"bg-amber-500/10"},polymarket:{bg:a==="dark"?"bg-rose-500/10":"bg-rose-50",text:a==="dark"?"text-rose-100":"text-rose-800",border:a==="dark"?"border-rose-500/30":"border-rose-200",chipBg:a==="dark"?"bg-rose-500/20":"bg-rose-500/10"},staking:{bg:a==="dark"?"bg-cyan-500/10":"bg-cyan-50",text:a==="dark"?"text-cyan-100":"text-cyan-800",border:a==="dark"?"border-cyan-500/30":"border-cyan-200",chipBg:a==="dark"?"bg-cyan-500/20":"bg-cyan-500/10"}},W=S=>{var R;return((R=S.details)==null?void 0:R[S.category])||{}},O=S=>{const R=W(S);switch(S.category){case"memecoins":return R.coinName||R.ticker||"Мемкоин";case"futures":return R.pair||"Фьючерс";case"nft":return R.collectionLink||"NFT коллекция";case"spot":return R.coin||"Спот";case"polymarket":return R.event||"Polymarket событие";case"staking":return R.coin||"Стейкинг";default:return"Сигнал"}},P=S=>{const R=W(S);switch(S.category){case"memecoins":return`${R.ticker||""} ${R.network?`• ${String(R.network).toUpperCase()}`:""}`.trim();case"futures":return`${R.direction==="long"?"Long":"Short"} • ${R.timeframe||""}`;case"nft":return`${R.marketplace||""}${R.network?` • ${String(R.network).toUpperCase()}`:""}`;case"spot":return R.holdingHorizon?`Горизонт: ${R.holdingHorizon}`:"";case"polymarket":return`${R.positionType==="yes"?"YES":"NO"} • ${R.entryPrice||""}`;case"staking":return`${R.platform||""}${R.term?` • ${R.term}`:""}`;default:return""}},te=S=>S.riskLevel||W(S).riskLevel||W(S).protocolRisk||"medium",J=(S,R=28)=>{if(!S)return"";if(S.length<=R)return S;const K=S.slice(0,Math.floor(R/2)),U=S.slice(-6);return`${K}...${U}`},fe=S=>{const R=W(S),K=te(S),U=ue[S.category],Q=[],$=(we,G,oe)=>{G&&Q.push({label:we,value:G,icon:oe})};switch(S.category){case"memecoins":$("Монета",R.coinName,r.jsx(rr,{className:"w-4 h-4"})),$("Тикер",J(R.ticker,8),r.jsx(Kh,{className:"w-4 h-4"})),$("Сеть",R.network?String(R.network).toUpperCase():"",r.jsx(Gh,{className:"w-4 h-4"})),$("Тип сигнала",R.signalType?R.signalType.toUpperCase():"",r.jsx(xn,{className:"w-4 h-4"})),$("Зона входа",R.entryCap,r.jsx(dr,{className:"w-4 h-4"})),$("Цели",R.targets,r.jsx(Qt,{className:"w-4 h-4"})),$("SL",R.stopLoss,r.jsx(pn,{className:"w-4 h-4"})),$("План",R.holdPlan,r.jsx(Is,{className:"w-4 h-4"})),$("Ликвидность",R.liquidityLocked?"Залочена":"",r.jsx($t,{className:"w-4 h-4"}));break;case"futures":$("Пара",R.pair,r.jsx(Wl,{className:"w-4 h-4"})),$("Направление",R.direction?R.direction.toUpperCase():"",r.jsx(sr,{className:"w-4 h-4"})),$("Плечо",R.leverage,r.jsx(Hs,{className:"w-4 h-4"})),$("Зона входа",R.entryZone||R.entryPrice,r.jsx(dr,{className:"w-4 h-4"})),$("Цели",R.targets,r.jsx(Qt,{className:"w-4 h-4"})),$("SL",R.stopLoss,r.jsx(pn,{className:"w-4 h-4"})),$("Стиль",R.signalStyle,r.jsx(xn,{className:"w-4 h-4"})),$("Размер позиции",R.positionSize,r.jsx(js,{className:"w-4 h-4"})),$("Таймфрейм",R.timeframe,r.jsx(Ql,{className:"w-4 h-4"}));break;case"nft":$("Коллекция",R.collectionLink,r.jsx(ul,{className:"w-4 h-4"})),$("Маркетплейс",R.marketplace,r.jsx(Ei,{className:"w-4 h-4"})),$("Сеть",R.network?String(R.network).toUpperCase():"",r.jsx(Yh,{className:"w-4 h-4"})),$("Вход",R.entryPrice,r.jsx(dr,{className:"w-4 h-4"})),$("Редкость",R.rarity,r.jsx(nr,{className:"w-4 h-4"})),$("Тип сигнала",R.signalType?R.signalType.toUpperCase():"",r.jsx(xn,{className:"w-4 h-4"})),$("Срок удержания",R.holdingHorizon,r.jsx(Is,{className:"w-4 h-4"})),$("Мин. ликвидность",R.minLiquidity,r.jsx(Hs,{className:"w-4 h-4"})),$("Target",R.targetPrice,r.jsx(Qt,{className:"w-4 h-4"}));break;case"spot":$("Монета",R.coin,r.jsx(rr,{className:"w-4 h-4"})),$("Зона входа",R.entryCap,r.jsx(dr,{className:"w-4 h-4"})),$("Цели",R.targets,r.jsx(Qt,{className:"w-4 h-4"})),$("SL",R.stopLoss,r.jsx(pn,{className:"w-4 h-4"})),$("Горизонт",R.holdingHorizon,r.jsx(Is,{className:"w-4 h-4"})),$("Размер",R.positionSize,r.jsx(js,{className:"w-4 h-4"}));break;case"polymarket":$("Событие",R.event,r.jsx(Yr,{className:"w-4 h-4"})),$("Тип",R.positionType?R.positionType.toUpperCase():"",r.jsx($t,{className:"w-4 h-4"})),$("Вход %",R.entryPrice,r.jsx(js,{className:"w-4 h-4"})),$("Ожидание %",R.expectedProbability,r.jsx(Hs,{className:"w-4 h-4"})),$("Цель",R.targetPlan,r.jsx(Qt,{className:"w-4 h-4"})),$("Макс ставка",R.maxStake,r.jsx(rr,{className:"w-4 h-4"}));break;case"staking":$("Монета",R.coin,r.jsx(rr,{className:"w-4 h-4"})),$("Платформа",R.platform,r.jsx(Ei,{className:"w-4 h-4"})),$("Срок",R.term,r.jsx(Ii,{className:"w-4 h-4"})),$("APY",R.apy,r.jsx(js,{className:"w-4 h-4"})),$("Мин. депозит",R.minDeposit,r.jsx(rr,{className:"w-4 h-4"})),$("Тип сигнала",R.action,r.jsx($t,{className:"w-4 h-4"}));break}const ce=Q.filter(we=>we.value);return ce.length?r.jsxs("div",{className:`rounded-2xl border ${M} ${a==="dark"?"bg-gray-900/60":"bg-white"}`,children:[r.jsxs("div",{className:`flex items-center gap-2 px-4 py-3 border-b ${M} ${a==="dark"?"bg-white/5":"bg-gray-50"}`,children:[r.jsx(nr,{className:"w-4 h-4 text-amber-500"}),r.jsx("p",{className:`text-sm font-semibold ${E}`,children:"Ключевые метрики"}),r.jsxs("span",{className:`ml-auto text-[11px] font-semibold px-3 py-1 rounded-full ${re[K]}`,children:["Риск: ",K]})]}),r.jsx("div",{className:"divide-y divide-gray-200/70 dark:divide-white/10",children:ce.map(we=>r.jsx("div",{className:"flex items-center justify-between gap-3 px-4 py-3",children:r.jsxs("div",{className:"flex items-start gap-3",children:[r.jsx("div",{className:`p-2 rounded-xl border ${U.border} ${U.bg} ${U.text}`,children:we.icon}),r.jsxs("div",{className:"flex-1 min-w-0",children:[r.jsx("p",{className:`text-xs uppercase tracking-wide ${v}`,children:we.label}),r.jsx("p",{className:`${E} font-semibold whitespace-pre-wrap break-words`,children:we.value})]})]})},we.label))})]}):null},F=()=>{const S=H[k],R={[k]:S},K=j(S),U=N(S);return{id:"preview",userId:(i==null?void 0:i.id)||"unknown",category:k,details:R,createdAt:new Date().toISOString(),status:"active",tags:[],sentiment:K,riskLevel:U,comment:D}},ne=()=>{x(!0)},V=async S=>{S.preventDefault(),h(""),c(!0);try{const R=H[k],K={...t==null?void 0:t.details,[k]:R},Q={userId:(t==null?void 0:t.userId)||(i==null?void 0:i.id)||"unknown",category:k,details:K,createdAt:(t==null?void 0:t.createdAt)||new Date().toISOString(),status:(t==null?void 0:t.status)||"active",tags:(t==null?void 0:t.tags)||[]},$=D==null?void 0:D.trim();$&&(Q.comment=$);const ce=j(R);ce&&(Q.sentiment=ce);const we=N(R);we&&(Q.riskLevel=we),(t==null?void 0:t.maxProfit)!==void 0&&(Q.maxProfit=t.maxProfit),(t==null?void 0:t.currentPnL)!==void 0&&(Q.currentPnL=t.currentPnL),(t==null?void 0:t.currentMarketCap)!==void 0&&(Q.currentMarketCap=t.currentMarketCap),(t==null?void 0:t.signalMarketCap)!==void 0&&(Q.signalMarketCap=t.signalMarketCap),(t==null?void 0:t.currentPrice)!==void 0&&(Q.currentPrice=t.currentPrice),(t==null?void 0:t.entryPrice)!==void 0&&(Q.entryPrice=t.entryPrice),t?await V0(t.id,Q):await cj(Q),s==null||s()}catch(R){console.error("Error creating call:",R);const K=(R==null?void 0:R.message)||(R==null?void 0:R.code)||"Ошибка при сохранении сигнала";h(K)}finally{c(!1)}},X=S=>{const K=(H[k]||{})[S.key],U=`w-full px-4 py-2 rounded-lg border ${M} ${ee} ${E} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`;if(S.type==="textarea")return r.jsx("textarea",{value:K||"",onChange:Q=>w(S.key,Q.target.value),className:`${U} min-h-[100px] resize-y`,placeholder:S.placeholder});if(S.type==="select"&&S.options){const Q=S.options.length<=3?"grid-cols-1 sm:grid-cols-3":S.options.length<=4?"grid-cols-2 sm:grid-cols-4":"grid-cols-2 sm:grid-cols-3";return r.jsx("div",{className:`grid ${Q} gap-2 sm:gap-3`,children:S.options.map($=>{const ce=K===$.value;return r.jsx("button",{type:"button",onClick:()=>w(S.key,$.value),className:`px-3 py-3 sm:py-2 rounded-lg border-2 text-sm font-medium transition-all duration-300 min-h-[44px] sm:min-h-[40px] hover:shadow-md focus:outline-none focus:ring-2 focus:ring-[#4E6E49]/30 ${ce?"border-[#4E6E49] bg-gradient-to-r from-[#4E6E49] to-emerald-600 text-white shadow-md shadow-emerald-300/30 scale-[1.02] ring-2 ring-[#4E6E49]/20":`border-gray-200 dark:border-gray-700 ${a==="dark"?"text-gray-300 hover:border-gray-600 hover:bg-gray-800":"text-gray-700 hover:border-gray-400 hover:bg-gray-50"} active:scale-95 hover:-translate-y-0.5`}`,children:$.label},$.value)})})}return S.type==="checkbox"?r.jsxs("label",{className:"inline-flex items-center gap-3 cursor-pointer select-none p-3 sm:p-3 rounded-lg border border-gray-200 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-800 hover:border-gray-300 dark:hover:border-gray-600 transition-all duration-200 min-h-[48px] sm:min-h-[44px] hover:shadow-sm",children:[r.jsx("input",{type:"checkbox",checked:!!K,onChange:Q=>w(S.key,Q.target.checked),className:"accent-[#4E6E49] w-5 h-5 sm:w-4 sm:h-4"}),r.jsx("span",{className:`font-medium ${E} text-sm sm:text-base`,children:S.label})]}):r.jsx("input",{type:"text",value:K||"",onChange:Q=>w(S.key,Q.target.value),className:U,placeholder:S.placeholder})};return r.jsxs("form",{onSubmit:V,className:"space-y-6",children:[d&&r.jsx("div",{className:`p-4 rounded-lg ${a==="dark"?"bg-red-900/30 border border-red-700 text-red-300":"bg-red-50 border border-red-200 text-red-800"}`,children:d}),r.jsxs("div",{className:`rounded-2xl border ${M} ${a==="dark"?"bg-gray-800/60":"bg-white"} p-4 sm:p-6`,children:[r.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[r.jsx("div",{className:"w-10 h-10 rounded-xl flex items-center justify-center text-white shadow-lg",style:{background:"linear-gradient(135deg, #4E6E49, #3b8d5a)"},children:r.jsx(Qt,{className:"w-5 h-5"})}),r.jsxs("div",{children:[r.jsx("p",{className:`text-lg font-bold ${E}`,children:"Выберите тип сигнала"}),r.jsx("p",{className:`text-xs ${C}`,children:"Какая категория лучше всего описывает ваш сигнал?"})]})]}),r.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-3 gap-2 sm:gap-3",children:Object.keys(cn).map(S=>{const R=cn[S],K=k===S;return r.jsx("button",{type:"button",onClick:()=>A(S),className:`p-4 rounded-xl border-2 transition-all duration-300 hover:shadow-md hover:-translate-y-0.5 active:scale-95 ${K?"border-[#4E6E49] bg-gradient-to-br from-[#4E6E49]/10 to-emerald-500/10 shadow-md shadow-emerald-300/20 scale-[1.02] ring-2 ring-[#4E6E49]/20":"border-gray-200 dark:border-gray-700 hover:border-gray-300 dark:hover:border-gray-600 hover:shadow-lg"}`,children:r.jsxs("div",{className:"flex flex-col items-center gap-2 text-center",children:[r.jsx("div",{className:`p-2 rounded-lg ${K?"bg-[#4E6E49] text-white":"bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-300"} transition-colors`,children:R.icon}),r.jsx("span",{className:`text-sm font-semibold ${K?"text-[#4E6E49]":E}`,children:R.label})]})},S)})})]}),r.jsxs("div",{className:`rounded-2xl border ${M} ${a==="dark"?"bg-gray-800/60":"bg-white"} p-4 sm:p-6 space-y-4`,children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx("div",{className:"hidden sm:flex w-10 h-10 rounded-xl items-center justify-center text-white shadow-lg",style:{background:"linear-gradient(135deg, #4E6E49, #3b8d5a)"},children:r.jsx("div",{className:"w-5 h-5",children:cn[k].icon})}),r.jsxs("div",{className:"hidden sm:block",children:[r.jsxs("p",{className:`text-lg font-bold ${E}`,children:[cn[k].label," - Детали сигнала"]}),r.jsx("p",{className:`text-xs ${C}`,children:"Заполните все необходимые поля"})]}),r.jsx("div",{className:"sm:hidden",children:r.jsx("p",{className:`text-sm font-bold ${E}`,children:cn[k].label})})]}),y.percentage<100&&r.jsxs("div",{className:"text-right",children:[r.jsx("div",{className:`w-16 h-2 rounded-full overflow-hidden ${a==="dark"?"bg-gray-700":"bg-gray-200"} shadow-inner`,children:r.jsx("div",{className:"h-full rounded-full transition-all duration-500 ease-out bg-gradient-to-r from-[#4E6E49] to-emerald-600",style:{width:`${y.percentage}%`}})}),r.jsxs("p",{className:`text-xs ${C} mt-1`,children:[y.filled,"/",y.total]})]}),y.percentage===100&&r.jsx("div",{className:"text-right",children:r.jsx("div",{className:"w-8 h-8 rounded-full bg-emerald-500 flex items-center justify-center",children:r.jsx(wr,{className:"w-4 h-4 text-white"})})})]}),r.jsx("div",{className:"space-y-6",children:Object.entries(Dj[k]).map(([S,R],K)=>{const U=jh[k].filter(Q=>Q.section===S);return U.length===0?null:r.jsxs("div",{className:"space-y-4 animate-in fade-in-0 slide-in-from-bottom-4 duration-500",style:{animationDelay:`${K*100}ms`},children:[r.jsxs("div",{className:"flex items-center gap-2 pb-2 border-b border-gray-200 dark:border-gray-700",children:[r.jsx("div",{className:`p-1.5 rounded-lg transition-colors duration-200 ${a==="dark"?"bg-gray-700 text-gray-300 hover:bg-gray-600":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:R.icon}),r.jsxs("div",{children:[r.jsx("h3",{className:`text-sm font-bold ${E}`,children:R.title}),R.description&&r.jsx("p",{className:`text-xs ${C}`,children:R.description})]})]}),r.jsx("div",{className:"grid grid-cols-1 gap-4",children:U.map(Q=>r.jsxs("div",{className:"space-y-2",children:[Q.type!=="checkbox"&&r.jsx("label",{className:`text-sm font-semibold ${E}`,children:Q.label}),X(Q)]},Q.key))})]},S)})})]}),r.jsxs("div",{children:[r.jsx("label",{className:`block text-sm font-medium ${E} mb-2`,children:"Общий комментарий или доп. заметки"}),r.jsx("textarea",{value:D,onChange:S=>T(S.target.value),className:`w-full px-4 py-3 rounded-lg border ${M} ${ee} ${E} focus:outline-none focus:ring-2 focus:ring-[#4E6E49] min-h-[90px] resize-y`,placeholder:"Здесь можно оставить чеклист для апдейтов, условия выхода, алерты."})]}),r.jsx("div",{className:"flex flex-col gap-3 sm:gap-4",children:r.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 sm:gap-4",children:[r.jsxs("button",{type:"button",onClick:ne,className:`px-6 py-4 sm:py-3 rounded-lg font-semibold border ${M} ${a==="dark"?"text-white hover:bg-gray-800 active:bg-gray-800":"text-gray-800 hover:bg-gray-100 active:bg-gray-200"} transition-colors min-h-[48px] sm:min-h-[44px]`,children:[r.jsx(dl,{className:"w-4 h-4 inline mr-2"}),"Предпросмотр"]}),r.jsx("button",{type:"submit",disabled:o,className:`flex-1 py-4 sm:py-3 rounded-lg font-semibold transition-all shadow-md min-h-[48px] sm:min-h-[44px] ${a==="dark"?"bg-gradient-to-r from-[#4E6E49] to-emerald-700 text-white hover:scale-[1.01] active:scale-[0.98] disabled:bg-gray-700":"bg-gradient-to-r from-[#4E6E49] to-emerald-600 text-white hover:shadow-lg active:shadow-md disabled:bg-gray-300 disabled:text-gray-600"}`,children:o?"Сохраняем...":t?"Обновить сигнал":"Создать сигнал"}),e&&r.jsx("button",{type:"button",onClick:e,className:`px-6 py-4 sm:py-3 rounded-lg font-semibold border ${M} ${a==="dark"?"text-white hover:bg-gray-800 active:bg-gray-800":"text-gray-800 hover:bg-gray-100 active:bg-gray-200"} min-h-[48px] sm:min-h-[44px]`,children:"Отмена"})]})}),m&&(()=>{const S=F(),R=cn[k],K=De.find(U=>U.id===S.userId);return r.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-[70] flex items-start sm:items-center justify-center p-4 overflow-y-auto",children:r.jsx("div",{className:`${p} rounded-2xl shadow-2xl border ${M} max-w-4xl w-full max-h-[90vh] overflow-hidden`,children:r.jsxs("div",{className:"flex flex-col h-full",children:[r.jsxs("div",{className:`p-6 flex items-center justify-between sticky top-0 z-20 ${p} border-b ${M} shadow-sm`,children:[r.jsxs("h2",{className:`text-2xl font-bold ${E} flex items-center gap-2`,children:[r.jsx(dl,{className:"w-5 h-5"}),"Предпросмотр сигнала"]}),r.jsx("button",{onClick:()=>x(!1),className:`p-2 rounded-xl ${a==="dark"?"hover:bg-gray-800":"hover:bg-gray-100"}`,children:r.jsx(Pt,{className:`w-5 h-5 ${v}`})})]}),r.jsxs("div",{className:"px-6 pb-6 pt-2 overflow-y-auto flex-1 max-h-[75vh]",children:[r.jsxs("div",{className:`rounded-3xl border-2 shadow-xl overflow-hidden mb-6 ${ue[k].border} ${ue[k].bg}`,children:[r.jsxs("div",{className:`px-5 py-4 flex flex-wrap items-center justify-between gap-3 border-b ${a==="dark"?"border-white/10 bg-white/5":"border-white/70 bg-white/70"}`,children:[r.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[r.jsxs("span",{className:`flex items-center gap-2 px-3 py-1.5 rounded-full text-sm font-semibold border ${ue[k].border} ${ue[k].chipBg||""} ${ue[k].text}`,children:[R.icon,R.label]}),r.jsx("span",{className:"px-3 py-1.5 rounded-full text-xs font-semibold bg-emerald-500/15 text-emerald-500 border border-emerald-500/20",children:"Активен"}),r.jsxs("span",{className:`px-3 py-1.5 rounded-full text-xs font-semibold ${re[S.riskLevel||"medium"]}`,children:["Риск: ",S.riskLevel||"medium"]})]}),r.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[r.jsx("div",{className:`px-3 py-1.5 rounded-xl text-xs font-semibold border ${a==="dark"?"bg-gray-800/70 text-gray-200 border-white/10":"bg-white text-gray-700 border-gray-200"}`,children:"Создано только что"}),K&&r.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 rounded-xl border border-white/10 bg-black/5 dark:bg-white/5",children:[r.jsx("div",{className:"w-8 h-8 rounded-full bg-gradient-to-r from-[#4E6E49] to-emerald-600 text-white flex items-center justify-center text-sm font-bold",children:K.name[0]}),r.jsx("span",{className:`text-xs ${v}`,children:K.name})]})]})]}),r.jsxs("div",{className:"p-5 space-y-5",children:[r.jsx("div",{className:"grid md:grid-cols-[1.15fr_auto] gap-4 items-start",children:r.jsxs("div",{className:"space-y-1",children:[r.jsx("p",{className:`text-2xl font-bold ${E}`,children:O(S)}),r.jsx("p",{className:`text-sm ${v}`,children:P(S)})]})}),fe(S),S.comment&&r.jsxs("div",{className:`rounded-xl border ${M} ${a==="dark"?"bg-gray-900/60":"bg-gray-50"} p-4`,children:[r.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[r.jsx(dn,{className:"w-4 h-4 text-amber-500"}),r.jsx("p",{className:`text-sm font-semibold ${E}`,children:"Общий комментарий"})]}),r.jsx("p",{className:`${E} whitespace-pre-wrap`,children:S.comment})]})]})]}),r.jsxs("div",{className:"flex gap-4",children:[r.jsx("button",{onClick:()=>x(!1),className:`flex-1 px-4 py-3 rounded-xl border ${M} ${a==="dark"?"text-white hover:bg-gray-800":"text-gray-800 hover:bg-gray-100"} font-semibold`,children:"Вернуться к редактированию"}),r.jsxs("button",{onClick:()=>{x(!1);const U=document.querySelector("form");U==null||U.requestSubmit()},className:`flex-1 px-4 py-3 rounded-xl font-semibold transition-all ${y.percentage===100?"bg-gradient-to-r from-[#4E6E49] to-emerald-600 text-white shadow-md hover:shadow-lg":"bg-gray-400 text-gray-200 cursor-not-allowed"}`,children:[r.jsx(wr,{className:"w-4 h-4 inline mr-2"}),"Создать сигнал"]})]})]})]})})})})()]})},eo="modal-open";let ha=0;const Rj=()=>{typeof document>"u"||(ha===0&&(document.body.classList.add(eo),document.documentElement.classList.add(eo)),ha+=1)},Pj=()=>{typeof document>"u"||(ha=Math.max(ha-1,0),ha===0&&(document.body.classList.remove(eo),document.documentElement.classList.remove(eo)))},ms=(s=!0)=>{I.useEffect(()=>{if(s)return Rj(),()=>{Pj()}},[s])},ta={memecoins:{label:"Мемкоины",gradient:"from-emerald-400 to-teal-500",chip:"bg-emerald-500/10 text-emerald-600",icon:r.jsx(Rn,{className:"w-4 h-4"})},futures:{label:"Фьючерсы",gradient:"from-blue-400 to-indigo-500",chip:"bg-blue-500/10 text-blue-600",icon:r.jsx(Ca,{className:"w-4 h-4"})},nft:{label:"NFT",gradient:"from-purple-400 to-pink-500",chip:"bg-purple-500/10 text-purple-600",icon:r.jsx(Aa,{className:"w-4 h-4"})},spot:{label:"Спот",gradient:"from-amber-400 to-orange-500",chip:"bg-amber-500/10 text-amber-600",icon:r.jsx(rr,{className:"w-4 h-4"})},polymarket:{label:"Polymarket",gradient:"from-rose-400 to-red-500",chip:"bg-rose-500/10 text-rose-600",icon:r.jsx(Qt,{className:"w-4 h-4"})},staking:{label:"Стейкинг",gradient:"from-cyan-400 to-blue-500",chip:"bg-cyan-500/10 text-cyan-600",icon:r.jsx($t,{className:"w-4 h-4"})}},gi={all:{label:"Все",className:""},active:{label:"Активен",className:"bg-emerald-500/15 text-emerald-500 border border-emerald-500/20"},completed:{label:"Завершен",className:"bg-blue-500/15 text-blue-500 border border-blue-500/20"},cancelled:{label:"Отменен",className:"bg-red-500/15 text-red-500 border border-red-500/20"},reviewed:{label:"На рассмотрении",className:"bg-gray-500/15 text-gray-500 border border-gray-500/20"}},Ih={low:"bg-emerald-500/10 text-emerald-600 border border-emerald-500/20",medium:"bg-blue-500/10 text-blue-600 border border-blue-500/20",high:"bg-amber-500/10 text-amber-600 border border-amber-500/20",ultra:"bg-red-500/10 text-red-600 border border-red-500/20"},Mj=()=>{const{theme:s}=at(),[e,t]=I.useState([]),[n,a]=I.useState(!0),[i,o]=I.useState(!1),[c,d]=I.useState(!1),[h,m]=I.useState(null),[x,f]=I.useState(null),[k,A]=I.useState(null),[D,T]=I.useState("memecoins"),[H,L]=I.useState(null),[E,M]=I.useState(""),[ee,C]=I.useState("all"),[v,p]=I.useState("all"),[w,N]=I.useState("all"),[j,b]=I.useState("all");ms(i||c||!!x),I.useEffect(()=>{y()},[]);const y=async()=>{a(!0);try{const z=await dj();t(z)}catch(z){console.error("Error loading calls:",z),t([])}finally{a(!1)}},re=s==="dark"?"bg-[#121212]":"bg-white",ue=s==="dark"?"text-white":"text-gray-900",W=s==="dark"?"text-gray-400":"text-gray-600",O=s==="dark"?"border-gray-800":"border-gray-200",te=`rounded-2xl p-4 sm:p-6 md:p-8 border-2 ${s==="dark"?"border-[#4E6E49]/30 bg-gradient-to-br from-[#1a1a1a] via-[#1a1a1a] to-[#0A0A0A]":"border-green-200 bg-gradient-to-br from-white via-green-50/30 to-white"}`,J=`rounded-2xl border ${s==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white"}`,fe={memecoins:{bg:s==="dark"?"bg-emerald-500/10":"bg-emerald-50",text:s==="dark"?"text-emerald-100":"text-emerald-800",border:s==="dark"?"border-emerald-500/30":"border-emerald-200",chipBg:s==="dark"?"bg-emerald-500/20":"bg-emerald-500/10"},futures:{bg:s==="dark"?"bg-sky-500/10":"bg-sky-50",text:s==="dark"?"text-sky-100":"text-sky-800",border:s==="dark"?"border-sky-500/30":"border-sky-200",chipBg:s==="dark"?"bg-sky-500/20":"bg-sky-500/10"},nft:{bg:s==="dark"?"bg-purple-500/10":"bg-purple-50",text:s==="dark"?"text-purple-100":"text-purple-800",border:s==="dark"?"border-purple-500/30":"border-purple-200",chipBg:s==="dark"?"bg-purple-500/20":"bg-purple-500/10"},spot:{bg:s==="dark"?"bg-amber-500/10":"bg-amber-50",text:s==="dark"?"text-amber-100":"text-amber-800",border:s==="dark"?"border-amber-500/30":"border-amber-200",chipBg:s==="dark"?"bg-amber-500/20":"bg-amber-500/10"},polymarket:{bg:s==="dark"?"bg-rose-500/10":"bg-rose-50",text:s==="dark"?"text-rose-100":"text-rose-800",border:s==="dark"?"border-rose-500/30":"border-rose-200",chipBg:s==="dark"?"bg-rose-500/20":"bg-rose-500/10"},staking:{bg:s==="dark"?"bg-cyan-500/10":"bg-cyan-50",text:s==="dark"?"text-cyan-100":"text-cyan-800",border:s==="dark"?"border-cyan-500/30":"border-cyan-200",chipBg:s==="dark"?"bg-cyan-500/20":"bg-cyan-500/10"}},F=()=>{o(!1),A(null),y()},ne=()=>{o(!1),A(null)},V=z=>{A(z),T(z.category),o(!0)},X=z=>{m(z),d(!0)},S=async()=>{if(h)try{await uj(h),d(!1),m(null),y()}catch(z){console.error("Error deleting call:",z),alert("Ошибка при удалении сигнала")}},R=async()=>{if(x)try{await V0(x,{status:"cancelled"}),f(null),y()}catch(z){console.error("Error cancelling call:",z),alert("Ошибка при отмене сигнала")}},K=async z=>{try{await navigator.clipboard.writeText(z),L(z),setTimeout(()=>L(null),1800)}catch(B){console.error("Failed to copy:",B)}},U=z=>{var B;return((B=z.details)==null?void 0:B[z.category])||{}},Q=z=>{const B=U(z);switch(z.category){case"memecoins":return B.coinName||B.ticker||"Мемкоин";case"futures":return B.pair||"Фьючерс";case"nft":return B.collectionLink||"NFT коллекция";case"spot":return B.coin||"Спот";case"polymarket":return B.event||"Polymarket событие";case"staking":return B.coin||"Стейкинг";default:return"Сигнал"}},$=z=>{const B=U(z);switch(z.category){case"memecoins":return`${B.ticker||""} ${B.network?`• ${String(B.network).toUpperCase()}`:""}`.trim();case"futures":return`${B.direction==="long"?"Long":"Short"} • ${B.timeframe||""}`;case"nft":return`${B.marketplace||""}${B.network?` • ${String(B.network).toUpperCase()}`:""}`;case"spot":return B.holdingHorizon?`Горизонт: ${B.holdingHorizon}`:"";case"polymarket":return`${B.positionType==="yes"?"YES":"NO"} • ${B.entryPrice||""}`;case"staking":return`${B.platform||""}${B.term?` • ${B.term}`:""}`;default:return""}},ce=z=>z.riskLevel||U(z).riskLevel||U(z).protocolRisk||"medium",we=z=>{const B=U(z);return[z.category,z.status,z.comment,B.coinName,B.ticker,B.pair,B.reason,B.targets,B.event,B.marketplace,B.platform,B.entryCap,B.entryZone,B.network].filter(Boolean).join(" ").toLowerCase()},G=e.filter(z=>ee!=="all"&&z.status!==ee||v!=="all"&&z.category!==v||w!=="all"&&ce(z)!==w||j!=="all"&&z.userId!==j?!1:E.trim()?we(z).includes(E.toLowerCase()):!0),oe=I.useMemo(()=>e.reduce((z,B)=>(z[B.category]||(z[B.category]={total:0,active:0}),z[B.category].total+=1,B.status==="active"&&(z[B.category].active+=1),z),{memecoins:{total:0,active:0},futures:{total:0,active:0},nft:{total:0,active:0},spot:{total:0,active:0},polymarket:{total:0,active:0},staking:{total:0,active:0}}),[e]),_e=I.useMemo(()=>({total:e.length,active:e.filter(z=>z.status==="active").length,completed:e.filter(z=>z.status==="completed").length,highRisk:e.filter(z=>ce(z)==="high"||ce(z)==="ultra").length}),[e]),Te=s==="dark"?"bg-gray-800 text-gray-200 border border-gray-700":"bg-white text-gray-700 border border-gray-200",Je="bg-gradient-to-r from-emerald-400 to-teal-500 text-white shadow-md shadow-emerald-300/30",Qe=(z,B,je)=>r.jsxs("div",{className:`p-4 rounded-xl border ${O} ${s==="dark"?"bg-gray-800/70":"bg-gray-50"}`,children:[r.jsx("p",{className:`text-xs uppercase tracking-wider ${W}`,children:z}),r.jsx("p",{className:`text-2xl font-bold ${je}`,children:B})]}),Z={low:"Низкий",medium:"Средний",high:"Высокий",ultra:"Ультра"},ge={flip:"Flip",short:"Короткий",medium:"Средний",long:"Длинный"},ye={flexible:"Гибкий","30d":"30 дней","90d":"90 дней",fixed:"Фикс."},de={enter:"Вход",exit:"Выход",rebalance:"Ребаланс"},Ce={yes:"YES",no:"NO"},Ve=(z,B=28)=>{if(!z)return"";if(z.length<=B)return z;const je=z.slice(0,Math.floor(B/2)),Pe=z.slice(-6);return`${je}...${Pe}`},q=z=>z?z.includes("%")?z:`${z}%`:"",Ne=z=>{if(!z)return"";const B=new Date(z);if(Number.isNaN(B.getTime()))return z;const je=new Date,Pe=B.getTime()-je.getTime(),Fe=B.toLocaleString("ru-RU",{day:"2-digit",month:"short",hour:"2-digit",minute:"2-digit"});if(Pe<=0)return`${Fe} (истек)`;const pe=Math.max(0,Math.floor(Pe/(1e3*60))),Ze=Math.floor(pe/(60*24)),He=Math.floor(pe%(60*24)/60),et=pe%60,Ee=[Ze>0?`${Ze}д`:null,He>0?`${He}ч`:null,et>0?`${et}м`:null].filter(Boolean).slice(0,2).join(" ");return`${Fe} (через ${Ee||"минуты"})`},Me=z=>{const B=U(z),je=ce(z),Pe=fe[z.category],Fe=[],pe=(He,et,Ee,xt)=>{et&&Fe.push({label:He,value:et,icon:Ee,copyValue:xt??et})};switch(z.category){case"memecoins":pe("Монета",B.coinName,r.jsx(rr,{className:"w-4 h-4"})),pe("Тикер",Ve(B.ticker,8),r.jsx(Kh,{className:"w-4 h-4"}),B.ticker),pe("Сеть",B.network?String(B.network).toUpperCase():"",r.jsx(Gh,{className:"w-4 h-4"})),pe("Контракт",Ve(B.contract,12),r.jsx(dx,{className:"w-4 h-4"}),B.contract),pe("Тип сигнала",B.signalType?B.signalType.toUpperCase():"",r.jsx(xn,{className:"w-4 h-4"})),pe("Зона входа",B.entryCap,r.jsx(dr,{className:"w-4 h-4"})),pe("Цели",B.targets,r.jsx(Qt,{className:"w-4 h-4"})),pe("SL",B.stopLoss,r.jsx(pn,{className:"w-4 h-4"})),pe("План",ge[B.holdPlan]||B.holdPlan,r.jsx(Is,{className:"w-4 h-4"})),pe("Ликвидность",B.liquidityLocked?"Залочена":"",r.jsx($t,{className:"w-4 h-4"})),pe("Риск",Z[je]||je,r.jsx(Xn,{className:"w-4 h-4"})),pe("Риски",B.risks,r.jsx(Lt,{className:"w-4 h-4"})),pe("Комментарий",B.traderComment,r.jsx(dn,{className:"w-4 h-4"})),pe("Причина входа",B.reason,r.jsx(Yr,{className:"w-4 h-4"}));break;case"futures":pe("Пара",B.pair,r.jsx(Wl,{className:"w-4 h-4"}),B.pair),pe("Направление",B.direction?B.direction.toUpperCase():"",r.jsx(sr,{className:"w-4 h-4"})),pe("Плечо",B.leverage,r.jsx(Hs,{className:"w-4 h-4"})),pe("Зона входа",B.entryZone||B.entryPrice,r.jsx(dr,{className:"w-4 h-4"})),pe("Цели",B.targets,r.jsx(Qt,{className:"w-4 h-4"})),pe("SL",B.stopLoss,r.jsx(pn,{className:"w-4 h-4"})),pe("Стиль",B.signalStyle,r.jsx(xn,{className:"w-4 h-4"})),pe("Размер позиции",B.positionSize,r.jsx(js,{className:"w-4 h-4"})),pe("Таймфрейм",B.timeframe,r.jsx(Ql,{className:"w-4 h-4"})),pe("Риск",Z[je]||je,r.jsx(Xn,{className:"w-4 h-4"})),pe("Риски",B.risks,r.jsx(Lt,{className:"w-4 h-4"})),pe("Причина входа",B.reason,r.jsx(Yr,{className:"w-4 h-4"}));break;case"nft":pe("Коллекция",Ve(B.collectionLink),r.jsx(ul,{className:"w-4 h-4"}),B.collectionLink),pe("NFT",Ve(B.nftLink),r.jsx(ul,{className:"w-4 h-4"}),B.nftLink),pe("Маркетплейс",B.marketplace,r.jsx(Ei,{className:"w-4 h-4"})),pe("Сеть",B.network?String(B.network).toUpperCase():"",r.jsx(Yh,{className:"w-4 h-4"})),pe("Вход",B.entryPrice,r.jsx(dr,{className:"w-4 h-4"})),pe("Редкость",B.rarity,r.jsx(nr,{className:"w-4 h-4"})),pe("Тип сигнала",B.signalType?B.signalType.toUpperCase():"",r.jsx(xn,{className:"w-4 h-4"})),pe("Срок удержания",ge[B.holdingHorizon]||B.holdingHorizon,r.jsx(Is,{className:"w-4 h-4"})),pe("Мин. ликвидность",B.minLiquidity,r.jsx(Hs,{className:"w-4 h-4"})),pe("Target",B.targetPrice,r.jsx(Qt,{className:"w-4 h-4"})),pe("Риски",B.risks,r.jsx(Lt,{className:"w-4 h-4"})),pe("Комментарий",B.traderComment,r.jsx(dn,{className:"w-4 h-4"})),pe("Причина входа",B.reason,r.jsx(Yr,{className:"w-4 h-4"}));break;case"spot":pe("Монета",B.coin,r.jsx(rr,{className:"w-4 h-4"})),pe("Зона входа",B.entryCap,r.jsx(dr,{className:"w-4 h-4"})),pe("Цели",B.targets,r.jsx(Qt,{className:"w-4 h-4"})),pe("SL",B.stopLoss,r.jsx(pn,{className:"w-4 h-4"})),pe("Горизонт",ge[B.holdingHorizon]||B.holdingHorizon,r.jsx(Is,{className:"w-4 h-4"})),pe("Размер",B.positionSize,r.jsx(js,{className:"w-4 h-4"})),pe("Риск",B.riskLevel?Z[B.riskLevel]:void 0,r.jsx(Xn,{className:"w-4 h-4"})),pe("Риски",B.risks,r.jsx(Lt,{className:"w-4 h-4"})),pe("Комментарий",B.traderComment,r.jsx(dn,{className:"w-4 h-4"})),pe("Причина входа",B.reason,r.jsx(Yr,{className:"w-4 h-4"}));break;case"polymarket":const He=B.positionType;pe("Событие",B.event,r.jsx(Yr,{className:"w-4 h-4"})),pe("Тип",He?Ce[He]:"",r.jsx($t,{className:"w-4 h-4"})),pe("Вход %",q(B.entryPrice),r.jsx(js,{className:"w-4 h-4"})),pe("Ожидание %",q(B.expectedProbability),r.jsx(Hs,{className:"w-4 h-4"})),pe("Цель",B.targetPlan,r.jsx(Qt,{className:"w-4 h-4"})),pe("Макс ставка",B.maxStake,r.jsx(rr,{className:"w-4 h-4"})),pe("Срок исхода",Ne(B.eventDeadline),r.jsx(Ii,{className:"w-4 h-4"})),pe("Риск",Z[je]||je,r.jsx(Xn,{className:"w-4 h-4"})),pe("Риски",B.risks,r.jsx(Lt,{className:"w-4 h-4"})),pe("Комментарий",B.traderComment,r.jsx(dn,{className:"w-4 h-4"})),pe("Причина входа",B.reason,r.jsx(Yr,{className:"w-4 h-4"}));break;case"staking":pe("Монета",B.coin,r.jsx(rr,{className:"w-4 h-4"})),pe("Платформа",B.platform,r.jsx(Ei,{className:"w-4 h-4"})),pe("Срок",ye[B.term]||B.term,r.jsx(Ii,{className:"w-4 h-4"})),pe("APY",q(B.apy),r.jsx(js,{className:"w-4 h-4"})),pe("Мин. депозит",B.minDeposit,r.jsx(rr,{className:"w-4 h-4"})),pe("Тип сигнала",de[B.action]||B.action,r.jsx($t,{className:"w-4 h-4"})),pe("Риск протокола",B.protocolRisk?Z[B.protocolRisk]:void 0,r.jsx(Xn,{className:"w-4 h-4"})),pe("Риски",B.risks,r.jsx(Lt,{className:"w-4 h-4"})),pe("Комментарий",B.traderComment,r.jsx(dn,{className:"w-4 h-4"})),pe("Причина входа",B.reason,r.jsx(Yr,{className:"w-4 h-4"}));break}const Ze=Fe.filter(He=>He.value);return Ze.length?r.jsxs("div",{className:`rounded-2xl border ${O} ${s==="dark"?"bg-gray-900/60":"bg-white"}`,children:[r.jsxs("div",{className:`flex items-center gap-2 px-4 py-3 border-b ${O} ${s==="dark"?"bg-white/5":"bg-gray-50"}`,children:[r.jsx(nr,{className:"w-4 h-4 text-amber-500"}),r.jsx("p",{className:`text-sm font-semibold ${ue}`,children:"Ключевые метрики"}),r.jsxs("span",{className:`ml-auto text-[11px] font-semibold px-3 py-1 rounded-full ${Ih[je]}`,children:["Риск: ",Z[je]||je]})]}),r.jsx("div",{className:"divide-y divide-gray-200/70 dark:divide-white/10",children:Ze.map(He=>r.jsxs("div",{className:"flex items-center justify-between gap-3 px-4 py-3",children:[r.jsxs("div",{className:"flex items-start gap-3",children:[r.jsx("div",{className:`p-2 rounded-xl border ${Pe.border} ${Pe.bg} ${Pe.text}`,children:He.icon}),r.jsxs("div",{className:"flex-1 min-w-0",children:[r.jsx("p",{className:`text-xs uppercase tracking-wide ${W}`,children:He.label}),r.jsx("p",{className:`${ue} font-semibold whitespace-pre-wrap break-words`,children:He.value})]})]}),He.copyValue&&r.jsx("button",{onClick:()=>K(He.copyValue),className:`p-2 rounded-lg border ${O} ${s==="dark"?"hover:bg-gray-800 bg-white/5":"hover:bg-gray-100 bg-white"} transition-colors`,title:"Копировать",children:H===He.copyValue?r.jsx(wr,{className:"w-4 h-4 text-emerald-500"}):r.jsx(xa,{className:"w-4 h-4"})})]},He.label))})]}):null};return r.jsx(mr,{children:r.jsxs("div",{className:"space-y-10 pb-20",children:[r.jsxs("div",{className:`relative overflow-hidden ${te} p-5 sm:p-6 md:p-8 ${s==="dark"?"bg-gradient-to-br from-[#0e1b2c] via-[#0c1827] to-[#0a1420]":"bg-gradient-to-br from-white via-emerald-50/40 to-sky-50"}`,children:[r.jsxs("div",{className:"absolute inset-0 pointer-events-none",children:[r.jsx("div",{className:"absolute -top-32 -left-16 w-80 h-80 bg-gradient-to-br from-[#4E6E49]/18 via-sky-500/8 to-transparent blur-3xl"}),r.jsx("div",{className:"absolute top-0 right-0 w-[26rem] h-[26rem] bg-gradient-to-bl from-sky-400/14 via-emerald-400/12 to-transparent blur-3xl"}),r.jsx("div",{className:"absolute bottom-[-140px] left-14 w-80 h-80 bg-gradient-to-tr from-sky-300/12 via-[#4E6E49]/12 to-transparent blur-3xl"})]}),r.jsx("div",{className:"relative z-10 grid grid-cols-1 gap-5",children:r.jsx("div",{className:`${J} backdrop-blur p-4 sm:p-5 space-y-4`,children:r.jsx("div",{className:"flex flex-col gap-4 sm:gap-5 lg:flex-row lg:items-center lg:justify-between",children:r.jsxs("div",{className:"flex flex-col sm:flex-row items-center gap-3 w-full sm:w-auto",children:[r.jsx("div",{className:"hidden sm:block p-3 rounded-2xl bg-white/80 dark:bg-white/5 border border-white/40 dark:border-white/10 shadow-lg",children:r.jsx(pi,{className:"w-6 h-6 text-[#4E6E49]"})}),r.jsx("div",{className:"flex items-center text-center sm:text-left w-full sm:w-auto justify-center sm:justify-start",children:r.jsx("h1",{className:`text-xl sm:text-3xl font-extrabold leading-tight ${s==="dark"?"text-white":"text-gray-900"}`,children:"Signals HUB"})})]})})})})]}),r.jsxs("div",{className:`${te} shadow-2xl relative overflow-hidden p-6 sm:p-8`,children:[r.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-white/5 to-transparent pointer-events-none"}),r.jsx("div",{className:"relative z-10 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-5",children:Object.keys(ta).map(z=>{const B=ta[z],je=oe[z],Pe=fe[z];return r.jsxs("button",{onClick:()=>{T(z),A(null),o(!0)},className:`p-5 rounded-[1.5rem] border-2 ${Pe.border} ${Pe.bg} text-left shadow-lg hover:shadow-xl transition-all hover:-translate-y-1 space-y-3 group/card relative overflow-hidden`,children:[r.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-white/10 to-transparent opacity-0 group-hover/card:opacity-100 transition-opacity"}),r.jsxs("div",{className:"flex items-start justify-between gap-3 relative z-10",children:[r.jsxs("div",{className:`flex items-center gap-2 px-3 py-1.5 rounded-full text-[11px] font-bold ${Pe.text} bg-white/10 border border-white/10 backdrop-blur-md`,children:[B.icon,r.jsx("span",{children:B.label})]}),r.jsx("span",{className:`px-2.5 py-1 rounded-lg text-[10px] font-bold border ${Pe.border} ${Pe.text} ${s==="dark"?"bg-black/20":"bg-white/50"} group-hover/card:bg-[#4E6E49] group-hover/card:text-white group-hover/card:border-transparent transition-all`,children:"Добавить"})]}),r.jsxs("div",{className:"pl-1 relative z-10",children:[r.jsx("p",{className:`text-3xl font-black ${ue} leading-none mb-1 group-hover/card:scale-105 transition-transform origin-left`,children:(je==null?void 0:je.total)||0}),r.jsxs("p",{className:`text-[10px] uppercase tracking-wider font-bold ${W} opacity-80`,children:["Всего сигналов • Активных ",(je==null?void 0:je.active)||0]})]})]},z)})})]}),r.jsxs("div",{className:`${te} !p-0 shadow-2xl`,children:[r.jsx("div",{className:"p-6 sm:p-8 space-y-8",children:r.jsxs("div",{className:"flex flex-col gap-3",children:[r.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[r.jsxs("div",{className:"flex items-center gap-2 text-sm font-semibold",children:[r.jsx(Hh,{className:`w-4 h-4 ${W}`}),r.jsx("span",{className:ue,children:"Фильтры"})]}),r.jsx("div",{className:"flex flex-wrap gap-2",children:Object.keys(gi).map(z=>r.jsx("button",{onClick:()=>C(z),className:`px-3 py-1.5 rounded-xl text-sm font-semibold transition-all ${ee===z?Je:Te}`,children:gi[z].label},z))})]}),r.jsxs("div",{className:"flex flex-col gap-2",children:[r.jsxs("label",{className:`text-xs uppercase tracking-wider ${W} flex items-center gap-2`,children:[r.jsx(Xh,{className:"w-4 h-4"}),"Поиск по всем сферам ",r.jsxs("span",{className:"text-[11px] text-gray-500 dark:text-gray-400",children:[G.length,"/",e.length]})]}),r.jsx("input",{value:E,onChange:z=>M(z.target.value),placeholder:"тикер, событие, сеть, причина...",className:`w-full px-3 py-2 rounded-xl border ${O} ${s==="dark"?"bg-gray-800":"bg-gray-50"} ${ue} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]/60`})]}),r.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[r.jsx("span",{className:`text-xs ${W} uppercase tracking-wider`,children:"Сфера:"}),r.jsx("button",{onClick:()=>p("all"),className:`px-3 py-1.5 rounded-full text-sm font-semibold border ${v==="all"?Je:Te}`,children:"Все"}),Object.keys(ta).map(z=>r.jsx("button",{onClick:()=>p(v===z?"all":z),className:`px-3 py-1.5 rounded-full text-sm font-semibold border ${v===z?Je:Te}`,children:ta[z].label},z))]}),r.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[r.jsx("span",{className:`text-xs ${W} uppercase tracking-wider`,children:"Риск:"}),["all","low","medium","high","ultra"].map(z=>r.jsx("button",{onClick:()=>N(z),className:`px-3 py-1.5 rounded-full text-sm font-semibold border ${w===z?Je:Te}`,children:z==="all"?"Все":z},z))]}),r.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[r.jsx("span",{className:`text-xs ${W} uppercase tracking-wider`,children:"Трейдер:"}),r.jsxs("select",{value:j,onChange:z=>b(z.target.value),className:`px-3 py-2 rounded-lg border ${O} ${s==="dark"?"bg-gray-800 text-white":"bg-gray-50 text-gray-900"} text-sm focus:outline-none focus:ring-2 focus:ring-emerald-500/50`,children:[r.jsx("option",{value:"all",children:"Все трейдеры"}),De.map(z=>r.jsx("option",{value:z.id,children:z.name},z.id))]})]}),r.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:[Qe("Всего сигналов",_e.total,ue),Qe("Активных",_e.active,"text-emerald-500"),Qe("Завершено",_e.completed,"text-blue-500"),Qe("High risk",_e.highRisk,"text-amber-500")]})]})}),i&&r.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-[70] flex items-start sm:items-center justify-center p-4 overflow-y-auto",children:r.jsx("div",{className:`${re} rounded-2xl shadow-2xl border ${O} max-w-3xl w-full max-h-[90vh] overflow-hidden`,children:r.jsxs("div",{className:"flex flex-col h-full",children:[r.jsxs("div",{className:`p-6 flex items-center justify-between sticky top-0 z-20 ${re} border-b ${O} shadow-sm`,children:[r.jsx("h2",{className:`text-2xl font-bold ${ue}`,children:k?"Редактировать сигнал":"Создать сигнал"}),r.jsx("button",{onClick:ne,className:`p-2 rounded-xl ${s==="dark"?"hover:bg-gray-800":"hover:bg-gray-100"}`,children:r.jsx(Pt,{className:`w-5 h-5 ${W}`})})]}),r.jsx("div",{className:"px-6 pb-6 pt-2 overflow-y-auto flex-1 max-h-[75vh]",children:r.jsx($j,{callToEdit:k,onSuccess:F,onCancel:ne,initialCategory:D})})]})})}),c&&r.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-[70] flex items-start sm:items-center justify-center p-4 overflow-y-auto overscroll-contain",children:r.jsx("div",{className:`${re} rounded-2xl shadow-2xl border ${O} max-w-md w-full`,children:r.jsxs("div",{className:"p-6 space-y-4",children:[r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx(Lt,{className:"w-6 h-6 text-red-500"}),r.jsxs("div",{children:[r.jsx("h3",{className:`text-xl font-bold ${ue}`,children:"Удалить сигнал?"}),r.jsx("p",{className:W,children:"Это действие нельзя отменить"})]})]}),r.jsxs("div",{className:"flex gap-3",children:[r.jsx("button",{onClick:()=>{d(!1),m(null)},className:`flex-1 px-4 py-3 rounded-xl border ${O} ${s==="dark"?"text-white":"text-gray-800"}`,children:"Отмена"}),r.jsx("button",{onClick:S,className:"flex-1 px-4 py-3 rounded-xl bg-red-600 text-white font-semibold hover:bg-red-700",children:"Удалить"})]})]})})}),x&&r.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-[70] flex items-start sm:items-center justify-center p-4 overflow-y-auto overscroll-contain",children:r.jsx("div",{className:`${re} rounded-2xl shadow-2xl border ${O} max-w-md w-full`,children:r.jsxs("div",{className:"p-6 space-y-4",children:[r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx(Lt,{className:"w-6 h-6 text-amber-500"}),r.jsxs("div",{children:[r.jsx("h3",{className:`text-xl font-bold ${ue}`,children:"Отменить сигнал?"}),r.jsx("p",{className:W,children:"Статус станет «Отменен», запись останется в списке."})]})]}),r.jsxs("div",{className:"flex gap-3",children:[r.jsx("button",{onClick:()=>f(null),className:`flex-1 px-4 py-3 rounded-xl border ${O} ${s==="dark"?"text-white":"text-gray-800"}`,children:"Отмена"}),r.jsx("button",{onClick:R,className:"flex-1 px-4 py-3 rounded-xl bg-amber-500 text-white font-semibold hover:bg-amber-600",children:"Отменить"})]})]})})}),!i&&r.jsx(r.Fragment,{children:n?r.jsxs("div",{className:`${re} rounded-2xl p-12 text-center ${O} border shadow-xl`,children:[r.jsx("div",{className:"animate-spin rounded-full h-14 w-14 border-4 border-[#4E6E49] border-t-transparent mx-auto mb-4"}),r.jsx("p",{className:`${W} text-lg`,children:"Загрузка сигналов..."})]}):e.length===0?r.jsxs("div",{className:`${re} rounded-[2rem] p-16 text-center ${O} border-2 shadow-2xl backdrop-blur-sm relative overflow-hidden group`,children:[r.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-[#4E6E49]/5 via-transparent to-emerald-500/5 opacity-0 group-hover:opacity-100 transition-opacity"}),r.jsx(nr,{className:`w-20 h-20 mx-auto mb-6 ${W} animate-pulse`}),r.jsx("p",{className:`text-2xl font-black ${ue} mb-2`,children:"Пока пусто"}),r.jsx("p",{className:`${W} text-lg`,children:"Создайте первый сигнал в новой структуре"})]}):G.length===0?r.jsxs("div",{className:`${re} rounded-2xl p-12 text-center ${O} border shadow-xl`,children:[r.jsx(nr,{className:`w-16 h-16 mx-auto mb-4 ${W}`}),r.jsx("p",{className:`text-xl font-bold ${ue}`,children:"Нет совпадений"}),r.jsxs("p",{className:W,children:["Сигналы есть (",e.length,"), но фильтр ничего не нашел."]})]}):r.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-5 px-4 py-2",children:G.map(z=>{const B=ta[z.category],je=gi[z.status]||gi.active,Pe=ce(z),Fe=U(z),pe=De.find(Ee=>Ee.id===z.userId),Ze=Fe.ticker||Fe.pair||Fe.coin||Q(z),He=new Date(z.createdAt).toLocaleDateString("ru-RU",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"}),et=fe[z.category];return r.jsxs("div",{className:`rounded-3xl border-2 shadow-xl overflow-hidden transition-all hover:-translate-y-1 ${et.border} ${et.bg}`,children:[r.jsxs("div",{className:`px-5 py-4 flex flex-wrap items-center justify-between gap-3 border-b ${s==="dark"?"border-white/10 bg-white/5":"border-white/70 bg-white/70"}`,children:[r.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[r.jsxs("span",{className:`flex items-center gap-2 px-3 py-1.5 rounded-full text-sm font-semibold border ${et.border} ${et.chipBg||""} ${et.text}`,children:[B.icon,B.label]}),r.jsx("span",{className:`px-3 py-1.5 rounded-full text-xs font-semibold ${je.className}`,children:je.label}),r.jsxs("span",{className:`px-3 py-1.5 rounded-full text-xs font-semibold ${Ih[Pe]}`,children:["Риск: ",Pe]})]}),r.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[r.jsxs("div",{className:`px-3 py-1.5 rounded-xl text-xs font-semibold border ${s==="dark"?"bg-gray-800/70 text-gray-200 border-white/10":"bg-white text-gray-700 border-gray-200"}`,children:[r.jsx("span",{className:"opacity-70",children:"Создано "}),He]}),pe&&r.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 rounded-xl border border-white/10 bg-black/5 dark:bg-white/5",children:[r.jsx("div",{className:"w-8 h-8 rounded-full bg-gradient-to-r from-[#4E6E49] to-emerald-600 text-white flex items-center justify-center text-sm font-bold",children:pe.name[0]}),r.jsx("span",{className:`text-xs ${W}`,children:pe.name})]}),r.jsxs("div",{className:"flex items-center gap-1",children:[r.jsx("button",{onClick:()=>V(z),className:`p-2 rounded-lg ${s==="dark"?"hover:bg-gray-800":"hover:bg-gray-100"}`,children:r.jsx(Bt,{className:"w-4 h-4"})}),z.status!=="cancelled"&&r.jsx("button",{onClick:()=>f(z.id),className:`p-2 rounded-lg ${s==="dark"?"hover:bg-gray-800":"hover:bg-gray-100"}`,children:r.jsx(Pt,{className:"w-4 h-4 text-amber-500"})}),r.jsx("button",{onClick:()=>X(z.id),className:`p-2 rounded-lg ${s==="dark"?"hover:bg-gray-800":"hover:bg-gray-100"}`,children:r.jsx(At,{className:"w-4 h-4 text-red-500"})})]})]})]}),r.jsxs("div",{className:"p-5 space-y-5",children:[r.jsxs("div",{className:"grid md:grid-cols-[1.15fr_auto] gap-4 items-start",children:[r.jsxs("div",{className:"space-y-1",children:[r.jsx("p",{className:`text-2xl font-bold ${ue}`,children:Q(z)}),r.jsx("p",{className:`text-sm ${W}`,children:$(z)})]}),r.jsx("div",{className:"flex flex-wrap gap-2 justify-end",children:r.jsx("button",{onClick:()=>K(Ze),className:`p-2 rounded-xl border ${O} ${s==="dark"?"hover:bg-gray-800 bg-white/5":"hover:bg-gray-100 bg-white"} transition-colors`,title:"Копировать",children:H===Ze?r.jsx(wr,{className:"w-4 h-4 text-emerald-500"}):r.jsx(xa,{className:"w-4 h-4"})})})]}),Me(z)]})]},z.id)})})})]})]})})},as=({userId:s,className:e="",fallback:t="unknown",formatter:n})=>{const i=f0(s)||t;return r.jsx("span",{className:e,children:n?n(i):i})},Oj=({selectedUserId:s,slotFilter:e,onEditSlot:t,onEditStatus:n,refreshKey:a})=>{const{theme:i}=at(),{user:o}=pt(),{isAdmin:c}=kt(),[d,h]=I.useState([]),[m,x]=I.useState([]),[f,k]=I.useState(new Date),[A,D]=I.useState(!0),[T,H]=I.useState({}),L=le(new Date,"yyyy-MM-dd"),E={artyom:"1",adel:"2",kseniya:"3",olga:"4",anastasia:"5"},M=P=>{const te=De.find(J=>J.id===P)||De.find(J=>E[P]===J.id);return gt((te==null?void 0:te.id)||P)},ee=Kc(f),C=s?De.filter(P=>P.id===s):De;I.useEffect(()=>{v()},[s,f,a]),I.useEffect(()=>{const P=()=>{v(!0)};return window.addEventListener("focus",P),()=>window.removeEventListener("focus",P)},[]);const v=async(P=!1)=>{P||D(!0);try{const te=new Date(ee[0]);te.setHours(0,0,0,0);const J=new Date(ee[6]);J.setHours(23,59,59,999);const fe=le(te,"yyyy-MM-dd"),F=le(J,"yyyy-MM-dd"),[ne,V]=await Promise.all([fr(),ns()]),X=ne.filter(U=>U.date>=fe&&U.date<=F),S=V.filter(U=>{const Q=U.date,$=U.endDate||U.date;return Q<=F&&$>=fe}),R=s?X.filter(U=>U.userId===s):X,K=s?S.filter(U=>U.userId===s):S;h(R),x(K)}catch(te){console.error("Error loading data:",te)}finally{P||D(!1)}},p=async P=>{if(!c&&(o==null?void 0:o.id)!==P.userId){alert("Только администратор может удалять чужие слоты");return}if(c){confirm("Удалить слот?")&&(await _o(P.id),v());return}confirm("Отправить на согласование удаление слота?")&&(await vt({entity:"slot",action:"delete",authorId:(o==null?void 0:o.id)||P.userId,targetUserId:P.userId,before:P,after:null,comment:P.comment}),v())},w=async(P,te)=>{if(!c&&(o==null?void 0:o.id)!==P.userId){alert("Только администратор может удалять чужие статусы");return}if(P.endDate&&te){const J=P.date,fe=P.endDate;if(te===J){if(confirm(c?"Удалить первый день диапазона?":"Отправить на согласование удаление первого дня диапазона?")){const F=new Date(J+"T00:00:00");F.setDate(F.getDate()+1);const ne=le(F,"yyyy-MM-dd");c?await Cs(P.id,{...P,date:ne}):await vt({entity:"status",action:"update",authorId:(o==null?void 0:o.id)||P.userId,targetUserId:P.userId,before:P,after:{...P,date:ne},comment:P.comment}),v()}return}if(te===fe){if(confirm(c?"Удалить последний день диапазона?":"Отправить на согласование удаление последнего дня диапазона?")){const F=new Date(fe+"T00:00:00");F.setDate(F.getDate()-1);const ne=le(F,"yyyy-MM-dd");c?await Cs(P.id,{...P,endDate:ne}):await vt({entity:"status",action:"update",authorId:(o==null?void 0:o.id)||P.userId,targetUserId:P.userId,before:P,after:{...P,endDate:ne},comment:P.comment}),v()}return}if(te>J&&te<fe){if(confirm(c?"Удалить этот день? Диапазон будет разбит на две части.":"Отправить на согласование удаление этого дня? Диапазон будет разбит на две части.")){const F=new Date(te+"T00:00:00");F.setDate(F.getDate()-1);const ne=le(F,"yyyy-MM-dd");if(c){await Cs(P.id,{...P,endDate:ne});const V=new Date(te+"T00:00:00");V.setDate(V.getDate()+1);const X=le(V,"yyyy-MM-dd");await Eo({userId:P.userId,date:X,endDate:fe,type:P.type,comment:P.comment})}else{await vt({entity:"status",action:"update",authorId:(o==null?void 0:o.id)||P.userId,targetUserId:P.userId,before:P,after:{...P,endDate:ne},comment:P.comment});const V=new Date(te+"T00:00:00");V.setDate(V.getDate()+1);const X=le(V,"yyyy-MM-dd");await vt({entity:"status",action:"create",authorId:(o==null?void 0:o.id)||P.userId,targetUserId:P.userId,before:null,after:{id:"",userId:P.userId,date:X,endDate:fe,type:P.type,comment:P.comment},comment:P.comment})}v()}return}}c?confirm("Удалить статус?")&&(await Io(P.id),v()):confirm("Отправить на согласование удаление статуса?")&&(await vt({entity:"status",action:"delete",authorId:(o==null?void 0:o.id)||P.userId,targetUserId:P.userId,before:P,after:null,comment:P.comment}),v())},N=P=>{const te=kr(),J=new Date(te);J.setHours(0,0,0,0);const fe=new Date(P.date);if(fe.setHours(0,0,0,0),fe>J)return!0;if(fe.getTime()===J.getTime()){const X=kr(),S=X.getHours()*60+X.getMinutes();return P.slots.some(R=>{if(R.endDate){const $=new Date(R.endDate);if($.setHours(0,0,0,0),new Date(J).setHours(23,59,59),$>J)return!0;if($.getTime()===J.getTime()){const[we,G]=R.end.split(":").map(Number);return we*60+G>S}return!1}const[K,U]=R.end.split(":").map(Number);return K*60+U>S})}const F=kr(),ne=F.getHours()*60+F.getMinutes();return P.slots.some(X=>{if(X.endDate){const S=new Date(X.endDate);if(S.setHours(0,0,0,0),S>J)return!0;if(S.getTime()===J.getTime()){const[R,K]=X.end.split(":").map(Number);return R*60+K>ne}return!1}return!1})},j=(P,te)=>{const J=d.find(fe=>fe.userId===P&&fe.date===te)||null;if(J&&e!=="all"){const fe=N(J);if(e==="upcoming"&&!fe||e==="completed"&&fe)return null}return J},b=(P,te)=>m.find(J=>J.userId!==P?!1:J.endDate?J.date<=te&&J.endDate>=te:J.date===te)||null,y=P=>{const J=d.filter(S=>S.userId===P).reduce((S,R)=>S+jo(R.slots),0),fe=m.filter(S=>S.userId===P),F=fe.filter(S=>S.type==="dayoff").length,ne=fe.filter(S=>S.type==="sick").length,V=fe.filter(S=>S.type==="vacation").length,X=fe.filter(S=>S.type==="absence").length;return{totalHours:J,daysOff:F,sickDays:ne,vacationDays:V,absenceDays:X}},re=P=>{const te=new Date(f);P==="prev"?te.setDate(te.getDate()-7):te.setDate(te.getDate()+7),k(te)},ue=P=>{H(te=>({...te,[P]:!te[P]}))};if(A)return r.jsx("div",{className:`rounded-lg p-8 text-center ${i==="dark"?"bg-[#1a1a1a]":"bg-white"}`,children:r.jsx("p",{className:i==="dark"?"text-gray-400":"text-gray-600",children:"Загрузка..."})});const W=i==="dark"?"text-white":"text-gray-900",O={dayoff:"bg-amber-50 text-amber-900 border border-amber-200 shadow-inner dark:bg-amber-900/30 dark:text-amber-50 dark:border-amber-700",sick:"bg-orange-50 text-orange-900 border border-orange-200 shadow-inner dark:bg-orange-900/30 dark:text-orange-50 dark:border-orange-700",vacation:"bg-sky-50 text-sky-900 border border-sky-200 shadow-inner dark:bg-sky-900/30 dark:text-sky-50 dark:border-sky-700",absence:"bg-red-50 text-red-900 border border-red-200 shadow-inner dark:bg-red-900/30 dark:text-red-50 dark:border-red-700"};return r.jsxs("div",{className:`rounded-lg ${i==="dark"?"bg-[#1a1a1a]":"bg-white"} shadow-md overflow-hidden`,children:[r.jsxs("div",{className:`p-4 border-b ${i==="dark"?"border-gray-800":"border-gray-200"} flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between`,children:[r.jsxs("button",{onClick:()=>re("prev"),className:`w-full sm:w-auto px-3 py-2 text-sm sm:text-base rounded-lg transition-colors flex items-center justify-center gap-2 whitespace-nowrap ${i==="dark"?"border border-gray-700 bg-gray-900/60 hover:border-[#4E6E49]/50 hover:bg-gray-900":"border border-gray-200 bg-white hover:border-[#4E6E49]/40 hover:bg-gray-50"}`,children:[r.jsx("span",{children:"←"}),r.jsx("span",{children:"Предыдущая неделя"})]}),r.jsxs("span",{className:`${W} font-semibold text-center text-sm sm:text-base whitespace-nowrap`,children:[le(ee[0],"dd.MM.yyyy")," - ",le(ee[6],"dd.MM.yyyy")]}),r.jsxs("button",{onClick:()=>re("next"),className:`w-full sm:w-auto px-3 py-2 text-sm sm:text-base rounded-lg transition-colors flex items-center justify-center gap-2 whitespace-nowrap ${i==="dark"?"border border-gray-700 bg-gray-900/60 hover:border-[#4E6E49]/50 hover:bg-gray-900":"border border-gray-200 bg-white hover:border-[#4E6E49]/40 hover:bg-gray-50"}`,children:[r.jsx("span",{children:"Следующая неделя"}),r.jsx("span",{children:"→"})]})]}),r.jsx("div",{className:"overflow-x-auto -mx-3 sm:-mx-4 md:-mx-6 lg:-mx-8 px-3 sm:px-4 md:px-6 lg:px-8",children:r.jsx("div",{className:"min-w-full inline-block align-middle",children:r.jsxs("table",{className:"w-full",children:[r.jsx("thead",{className:"sticky top-0 z-30",children:r.jsxs("tr",{className:`${i==="dark"?"bg-[#0f172a]":"bg-gray-50"} shadow-sm`,children:[r.jsx("th",{className:`px-2 sm:px-3 md:px-4 py-3 text-left text-xs sm:text-sm font-semibold ${W} sticky left-0 z-30 ${i==="dark"?"bg-[#0f172a]":"bg-gray-50"}`,children:"Members"}),ee.map(P=>r.jsx("th",{className:"px-1.5 sm:px-2 md:px-3 lg:px-4 py-3",children:r.jsxs("div",{className:`mx-auto w-full max-w-[110px] rounded-xl border ${i==="dark"?"border-white/10 bg-white/5 text-white":"border-gray-200 bg-white text-gray-900"} shadow-sm text-center`,children:[r.jsx("div",{className:"text-[10px] sm:text-xs opacity-70",children:le(P,"EEE")}),r.jsx("div",{className:"text-sm font-semibold",children:le(P,"dd.MM")})]})},P.toISOString())),r.jsx("th",{className:`px-2 sm:px-3 md:px-4 py-3 text-center text-xs sm:text-sm font-bold ${W} whitespace-nowrap`,children:"Итог"})]})}),r.jsx("tbody",{children:C.map((P,te)=>{const J=y(P.id),fe=te%2===0;return r.jsxs("tr",{className:`
                    group border-b transition-all duration-300 relative
                    ${i==="dark"?"border-gray-800/30":"border-gray-200/30"}
                    ${fe?i==="dark"?"bg-gradient-to-r from-[#1a1a1a]/40 via-[#1a1a1a]/20 to-transparent hover:from-[#1a1a1a]/70 hover:via-[#1a1a1a]/50 hover:shadow-lg hover:shadow-#4E6E49/10":"bg-gradient-to-r from-gray-50/70 via-gray-50/40 to-transparent hover:from-gray-100/90 hover:via-gray-100/70 hover:shadow-lg hover:shadow-#4E6E49/5":i==="dark"?"bg-gradient-to-r from-[#1a1a1a]/10 via-[#1a1a1a]/5 to-transparent hover:from-[#1a1a1a]/50 hover:via-[#1a1a1a]/30 hover:shadow-lg hover:shadow-#4E6E49/10":"bg-gradient-to-r from-white via-gray-50/30 to-transparent hover:from-gray-50 hover:via-gray-50/60 hover:shadow-lg hover:shadow-#4E6E49/5"}
                    hover:scale-[1.01] hover:-translate-y-0.5
                  `,children:[r.jsx("td",{className:`px-2 sm:px-3 md:px-4 py-2 sm:py-3 md:py-4 font-semibold text-xs sm:text-sm ${W} sticky left-0 z-10 transition-all duration-300 backdrop-blur-sm min-w-[120px] sm:min-w-[140px] ${fe?i==="dark"?"bg-gradient-to-r from-[#1a1a1a]/40 via-[#1a1a1a]/20 to-transparent group-hover:from-[#1a1a1a]/70 group-hover:via-[#1a1a1a]/50":"bg-gradient-to-r from-gray-50/70 via-gray-50/40 to-transparent group-hover:from-gray-100/90 group-hover:via-gray-100/70":i==="dark"?"bg-gradient-to-r from-[#1a1a1a]/10 via-[#1a1a1a]/5 to-transparent group-hover:from-[#1a1a1a]/50 group-hover:via-[#1a1a1a]/30":"bg-gradient-to-r from-white via-gray-50/30 to-transparent group-hover:from-gray-50 group-hover:via-gray-50/60"}`,children:r.jsxs("div",{className:"flex items-center gap-2 sm:gap-3",children:[r.jsxs("div",{className:"relative flex-shrink-0 group/avatar",children:[P.avatar?r.jsx("img",{src:P.avatar,alt:M(P.id),className:"w-8 h-8 sm:w-10 sm:h-10 md:w-11 md:h-11 rounded-full object-cover border-2 shadow-lg transition-all duration-300 group-hover:scale-110 group-hover:shadow-xl group-hover:shadow-#4E6E49/30 ring-2 ring-transparent group-hover:ring-#4E6E49/50",style:{borderColor:i==="dark"?"rgba(34, 197, 94, 0.6)":"rgba(34, 197, 94, 0.4)"},onError:F=>{const ne=F.target;ne.style.display="none";const V=ne.nextElementSibling;V&&(V.style.display="flex")}}):null,r.jsx("div",{className:`w-8 h-8 sm:w-10 sm:h-10 md:w-11 md:h-11 rounded-full flex items-center justify-center font-bold text-xs sm:text-sm transition-all duration-300 shadow-lg ring-2 ring-transparent group-hover/avatar:scale-110 group-hover/avatar:shadow-xl group-hover/avatar:ring-#4E6E49/50 ${i==="dark"?"bg-gradient-to-br from-[#4E6E49] via-[#4E6E49] to-blue-500 text-white group-hover/avatar:shadow-#4E6E49/40":"bg-gradient-to-br from-[#4E6E49] via-[#4E6E49] to-blue-400 text-white group-hover/avatar:shadow-#4E6E49/40"} ${P.avatar?"absolute inset-0 hidden":""}`,children:r.jsx(as,{userId:P.id,formatter:F=>F.charAt(0).toUpperCase()})}),r.jsx("div",{className:"absolute -bottom-0.5 -right-0.5 w-2.5 h-2.5 sm:w-3 sm:h-3 md:w-3.5 md:h-3.5 bg-[#4E6E49] rounded-full border border-white sm:border-2 shadow-lg animate-pulse opacity-0 group-hover/avatar:opacity-100 transition-opacity duration-300"})]}),r.jsx("span",{className:"font-semibold group-hover:text-[#4E6E49] transition-colors duration-300 truncate hidden sm:inline",children:r.jsx(as,{userId:P.id})}),r.jsx("span",{className:"font-semibold group-hover:text-[#4E6E49] transition-colors duration-300 sm:hidden",children:r.jsx(as,{userId:P.id,formatter:F=>(F.split(" ")[0]||F).substring(0,8)})})]})}),ee.map(F=>{const ne=le(F,"yyyy-MM-dd"),V=j(P.id,ne),X=b(P.id,ne);return r.jsx("td",{className:`px-1 sm:px-2 py-2 sm:py-3 text-center border-l border-r border-transparent hover:border-blue-500/20 transition-colors min-w-[80px] sm:min-w-[100px] ${ne===L?"bg-emerald-50 dark:bg-emerald-900/20 ring-1 ring-emerald-300/70 dark:ring-emerald-500/40":""}`,children:V?r.jsxs("div",{className:"space-y-2",children:[(()=>{const S=N(V),R=S?"bg-gradient-to-r from-emerald-500 to-teal-600":"bg-gradient-to-r from-slate-500 to-slate-700",U=S?Tr:$n;return V.slots.map((Q,$)=>r.jsxs("div",{className:"space-y-1",children:[r.jsx("div",{className:`${R} text-white rounded-md sm:rounded-lg px-2 sm:px-3 py-1 sm:py-1.5 text-[10px] sm:text-xs font-semibold shadow-lg transition-all duration-300 hover:scale-105 hover:shadow-xl ${S?"hover:shadow-emerald-500/40 ring-2 ring-emerald-400/40":"hover:shadow-slate-500/40 ring-2 ring-slate-400/40"}`,children:r.jsxs("div",{className:"flex items-center justify-center gap-0.5 sm:gap-1 flex-wrap",children:[r.jsx(U,{className:"w-2.5 h-2.5 sm:w-3 sm:h-3 animate-pulse flex-shrink-0"}),r.jsxs("span",{className:"whitespace-nowrap",children:[Q.start," - ",Q.end]}),Q.endDate&&r.jsxs("span",{className:"text-[9px] sm:text-[10px] opacity-90 whitespace-nowrap",children:["(до ",le(new Date(Q.endDate),"dd.MM"),")"]})]})}),Q.breaks&&Q.breaks.length>0&&r.jsx("div",{className:"flex justify-center",children:r.jsx("button",{onClick:()=>ue(V.id),className:`p-1 rounded-md transition-all duration-200 hover:scale-110 ${T[V.id]?i==="dark"?"text-gray-300 hover:text-white":"text-gray-600 hover:text-gray-800":i==="dark"?"text-gray-400 hover:text-gray-300":"text-gray-500 hover:text-gray-600"}`,title:T[V.id]?"Скрыть перерывы":"Показать перерывы",children:T[V.id]?r.jsx(qh,{className:"w-4 h-4"}):r.jsx(Hl,{className:"w-4 h-4"})})}),Q.breaks&&Q.breaks.length>0&&T[V.id]&&r.jsxs("div",{className:"space-y-1",children:[r.jsx("div",{className:`text-[10px] ${i==="dark"?"text-gray-400":"text-gray-600"} font-medium`,children:"Перерывы:"}),Q.breaks.map((ce,we)=>r.jsx("div",{className:`${i==="dark"?"bg-gray-700/90":"bg-white"} ${i==="dark"?"text-gray-200":"text-gray-900"} border-2 ${i==="dark"?"border-orange-500/50":"border-orange-300"} rounded-md sm:rounded-lg px-1.5 sm:px-2 py-0.5 sm:py-1 text-[9px] sm:text-[10px] font-medium shadow-md transition-all duration-300 hover:scale-105 hover:shadow-lg ${i==="dark"?"hover:border-orange-400/70 hover:shadow-orange-500/20":"hover:border-orange-400 hover:shadow-orange-400/20"}`,children:r.jsxs("span",{className:"flex items-center gap-0.5 sm:gap-1 justify-center flex-wrap",children:[r.jsx("span",{className:"w-0.5 h-0.5 sm:w-1 sm:h-1 rounded-full bg-orange-500 flex-shrink-0"}),r.jsxs("span",{className:"whitespace-nowrap",children:[ce.start," - ",ce.end]})]})},we))]})]},$))})(),r.jsx("div",{className:"flex gap-1 justify-center",children:c||(P==null?void 0:P.id)===V.userId?r.jsxs(r.Fragment,{children:[r.jsx("button",{onClick:()=>t(V),className:"p-1 text-blue-500 hover:bg-blue-500 hover:text-white rounded",children:r.jsx(Bt,{className:"w-3 h-3"})}),r.jsx("button",{onClick:()=>p(V),className:"p-1 text-red-500 hover:bg-red-500 hover:text-white rounded",children:r.jsx(At,{className:"w-3 h-3"})})]}):r.jsxs(r.Fragment,{children:[r.jsx("button",{disabled:!0,className:"p-1 text-gray-400 cursor-not-allowed rounded",title:"Вы можете редактировать только свои слоты",children:r.jsx(Bt,{className:"w-3 h-3"})}),r.jsx("button",{disabled:!0,className:"p-1 text-gray-400 cursor-not-allowed rounded",title:"Вы можете удалять только свои слоты",children:r.jsx(At,{className:"w-3 h-3"})})]})})]}):X?r.jsxs("div",{className:"space-y-1",children:[r.jsx("div",{className:`rounded-lg px-3 py-2 text-xs font-semibold ring-1 ring-inset ring-black/5 dark:ring-white/10 ${O[X.type]}`,children:X.type==="dayoff"?"Выходной":X.type==="sick"?"Больничный":X.type==="vacation"?"Отпуск":"Прогул"}),r.jsx("div",{className:"flex gap-1 justify-center",children:c||X.type!=="absence"&&(P==null?void 0:P.id)===X.userId?r.jsxs(r.Fragment,{children:[r.jsx("button",{onClick:()=>n(X),className:"p-1 text-blue-500 hover:bg-blue-500 hover:text-white rounded",children:r.jsx(Bt,{className:"w-3 h-3"})}),r.jsx("button",{onClick:()=>w(X,ne),className:"p-1 text-red-500 hover:bg-red-500 hover:text-white rounded",children:r.jsx(At,{className:"w-3 h-3"})})]}):r.jsxs(r.Fragment,{children:[r.jsx("button",{disabled:!0,className:"p-1 text-gray-400 cursor-not-allowed rounded",title:"Вы можете редактировать только свои статусы",children:r.jsx(Bt,{className:"w-3 h-3"})}),r.jsx("button",{disabled:!0,className:"p-1 text-gray-400 cursor-not-allowed rounded",title:"Вы можете удалять только свои статусы",children:r.jsx(At,{className:"w-3 h-3"})})]})})]}):r.jsx("span",{className:`text-sm ${i==="dark"?"text-gray-400":"text-gray-600"}`,children:"—"})},ne)}),r.jsx("td",{className:`px-4 py-3 text-sm ${W} text-center`,children:r.jsxs("div",{className:"space-y-1",children:[r.jsxs("div",{children:["Часов: ",J.totalHours.toFixed(1)]}),r.jsxs("div",{children:["Выходных: ",J.daysOff]}),r.jsxs("div",{children:["Больничных: ",J.sickDays]}),r.jsxs("div",{children:["Отпусков: ",J.vacationDays]}),r.jsxs("div",{children:["Прогулов: ",J.absenceDays]})]})})]},P.id)})})]})})})]})},Vj=({selectedUserId:s,slotFilter:e,onEditSlot:t,onEditStatus:n,refreshKey:a})=>{const{theme:i}=at(),{user:o}=pt(),{isAdmin:c}=kt(),[d,h]=I.useState([]),[m,x]=I.useState([]),[f,k]=I.useState(new Date),[A,D]=I.useState(!0),[T,H]=I.useState({}),L={artyom:"1",adel:"2",kseniya:"3",olga:"4",anastasia:"5"},E=W=>{const O=De.find(P=>P.id===W)||De.find(P=>L[W]===P.id);return{member:O,displayName:gt((O==null?void 0:O.id)||W)}},M=Kc(f),ee=new Date;I.useEffect(()=>{C()},[s,f,a]),I.useEffect(()=>{const W=()=>{C(!0)};return window.addEventListener("focus",W),()=>window.removeEventListener("focus",W)},[]);const C=async(W=!1)=>{W||D(!0);try{const O=new Date(M[0]);O.setHours(0,0,0,0);const P=new Date(M[6]);P.setHours(23,59,59,999);const te=le(O,"yyyy-MM-dd"),J=le(P,"yyyy-MM-dd"),[fe,F]=await Promise.all([fr(),ns()]),ne=fe.filter(R=>R.date>=te&&R.date<=J),V=F.filter(R=>{const K=R.date,U=R.endDate||R.date;return K<=J&&U>=te}),X=s?ne.filter(R=>R.userId===s):ne,S=s?V.filter(R=>R.userId===s):V;console.log("Loaded slots (week view):",{weekStart:te,weekEnd:J,allSlotsCount:fe.length,weekSlotsCount:ne.length,filteredSlotsCount:X.length,selectedUserId:s}),h(X),x(S)}catch(O){console.error("Error loading data:",O)}finally{W||D(!1)}},v=async W=>{if(!c&&(o==null?void 0:o.id)!==W.userId){alert("Только администратор может удалять чужие слоты");return}if(c){confirm("Удалить слот?")&&(await _o(W.id),C());return}confirm("Отправить на согласование удаление слота?")&&(await vt({entity:"slot",action:"delete",authorId:(o==null?void 0:o.id)||W.userId,targetUserId:W.userId,before:W,after:null,comment:W.comment}),C())},p=async(W,O)=>{if(!c&&(o==null?void 0:o.id)!==W.userId){alert("Только администратор может удалять чужие статусы");return}if(W.endDate&&O){const P=W.date,te=W.endDate;if(O===P){if(confirm(c?"Удалить первый день диапазона?":"Отправить на согласование удаление первого дня диапазона?")){const J=new Date(vr(P));J.setDate(J.getDate()+1);const fe=le(J,"yyyy-MM-dd");c?await Cs(W.id,{...W,date:fe}):await vt({entity:"status",action:"update",authorId:(o==null?void 0:o.id)||W.userId,targetUserId:W.userId,before:W,after:{...W,date:fe},comment:W.comment}),C()}return}if(O===te){if(confirm(c?"Удалить последний день диапазона?":"Отправить на согласование удаление последнего дня диапазона?")){const J=new Date(vr(te));J.setDate(J.getDate()-1);const fe=le(J,"yyyy-MM-dd");c?await Cs(W.id,{...W,endDate:fe}):await vt({entity:"status",action:"update",authorId:(o==null?void 0:o.id)||W.userId,targetUserId:W.userId,before:W,after:{...W,endDate:fe},comment:W.comment}),C()}return}if(O>P&&O<te){if(confirm(c?"Удалить этот день? Диапазон будет разбит на две части.":"Отправить на согласование удаление этого дня? Диапазон будет разбит на две части.")){const J=new Date(vr(O));J.setDate(J.getDate()-1);const fe=le(J,"yyyy-MM-dd");if(c){await Cs(W.id,{...W,endDate:fe});const F=new Date(vr(O));F.setDate(F.getDate()+1);const ne=le(F,"yyyy-MM-dd");await Eo({userId:W.userId,date:ne,endDate:te,type:W.type,comment:W.comment})}else{await vt({entity:"status",action:"update",authorId:(o==null?void 0:o.id)||W.userId,targetUserId:W.userId,before:W,after:{...W,endDate:fe},comment:W.comment});const F=new Date(vr(O));F.setDate(F.getDate()+1);const ne=le(F,"yyyy-MM-dd");await vt({entity:"status",action:"create",authorId:(o==null?void 0:o.id)||W.userId,targetUserId:W.userId,before:null,after:{id:"",userId:W.userId,date:ne,endDate:te,type:W.type,comment:W.comment},comment:W.comment})}C()}return}}c?confirm("Удалить статус?")&&(await Io(W.id),C()):confirm("Отправить на согласование удаление статуса?")&&(await vt({entity:"status",action:"delete",authorId:(o==null?void 0:o.id)||W.userId,targetUserId:W.userId,before:W,after:null,comment:W.comment}),C())},w=W=>{const O=kr(),P=new Date(O);P.setHours(0,0,0,0);const te=new Date(W.date);if(te.setHours(0,0,0,0),te>P)return!0;if(te.getTime()===P.getTime()){const ne=kr(),V=ne.getHours()*60+ne.getMinutes();return W.slots.some(X=>{if(X.endDate){const U=new Date(X.endDate);if(U.setHours(0,0,0,0),new Date(P).setHours(23,59,59),U>P)return!0;if(U.getTime()===P.getTime()){const[$,ce]=X.end.split(":").map(Number);return $*60+ce>V}return!1}const[S,R]=X.end.split(":").map(Number);return S*60+R>V})}const J=kr(),fe=J.getHours()*60+J.getMinutes();return W.slots.some(ne=>{if(ne.endDate){const V=new Date(ne.endDate);if(V.setHours(0,0,0,0),V>P)return!0;if(V.getTime()===P.getTime()){const[X,S]=ne.end.split(":").map(Number);return X*60+S>fe}return!1}return!1})},N=W=>{let O=d.filter(P=>P.date===W);return e!=="all"&&(O=O.filter(P=>{const te=w(P);return e==="upcoming"?te:e==="completed"?!te:!0})),O},j=W=>m.filter(O=>O.endDate?O.date<=W&&O.endDate>=W:O.date===W),b=W=>{const O=new Date(f);W==="prev"?O.setDate(O.getDate()-7):O.setDate(O.getDate()+7),k(O)},y=W=>{H(O=>({...O,[W]:!O[W]}))};if(A)return r.jsx("div",{className:`rounded-lg p-8 text-center ${i==="dark"?"bg-[#1a1a1a]":"bg-white"}`,children:r.jsx("p",{className:i==="dark"?"text-gray-400":"text-gray-600",children:"Загрузка..."})});const re=i==="dark"?"text-white":"text-gray-900",ue={dayoff:"bg-amber-50 text-amber-900 border border-amber-200 shadow-inner dark:bg-amber-900/25 dark:text-amber-50 dark:border-amber-700",sick:"bg-orange-50 text-orange-900 border border-orange-200 shadow-inner dark:bg-orange-900/25 dark:text-orange-50 dark:border-orange-700",vacation:"bg-sky-50 text-sky-900 border border-sky-200 shadow-inner dark:bg-sky-900/25 dark:text-sky-50 dark:border-sky-700",absence:"bg-red-50 text-red-900 border border-red-200 shadow-inner dark:bg-red-900/25 dark:text-red-50 dark:border-red-700"};return r.jsxs("div",{className:`rounded-lg ${i==="dark"?"bg-[#1a1a1a]":"bg-white"} shadow-md overflow-hidden`,children:[r.jsxs("div",{className:`p-3 sm:p-4 border-b ${i==="dark"?"border-gray-800":"border-gray-200"} flex flex-col gap-2 sm:gap-3 sm:flex-row sm:items-center sm:justify-between`,children:[r.jsxs("button",{onClick:()=>b("prev"),className:`w-full sm:w-auto px-3 sm:px-4 py-2 text-xs sm:text-sm md:text-base rounded-lg transition-colors touch-manipulation active:scale-95 flex items-center justify-center gap-2 whitespace-nowrap ${i==="dark"?"border border-gray-700 bg-gray-900/60 hover:border-[#4E6E49]/50 hover:bg-gray-900":"border border-gray-200 bg-white hover:border-[#4E6E49]/40 hover:bg-gray-50"}`,children:[r.jsx("span",{children:"←"}),r.jsx("span",{children:"Предыдущая неделя"})]}),r.jsxs("span",{className:`${re} font-semibold text-center text-xs sm:text-sm md:text-base whitespace-nowrap`,children:[le(M[0],"dd.MM.yyyy")," - ",le(M[6],"dd.MM.yyyy")]}),r.jsxs("button",{onClick:()=>b("next"),className:`w-full sm:w-auto px-3 sm:px-4 py-2 text-xs sm:text-sm md:text-base rounded-lg transition-colors touch-manipulation active:scale-95 flex items-center justify-center gap-2 whitespace-nowrap ${i==="dark"?"border border-gray-700 bg-gray-900/60 hover:border-[#4E6E49]/50 hover:bg-gray-900":"border border-gray-200 bg-white hover:border-[#4E6E49]/40 hover:bg-gray-50"}`,children:[r.jsx("span",{children:"Следующая неделя"}),r.jsx("span",{children:"→"})]})]}),r.jsx("div",{className:"p-3 sm:p-4 space-y-3 sm:space-y-4",children:M.map(W=>{const O=le(W,"yyyy-MM-dd"),P=N(O),te=j(O),J=E0(W,ee),fe="relative rounded-xl p-4 sm:p-5 border transition-all duration-300",F=i==="dark"?"bg-gray-800/70 border-gray-700 shadow-md":"bg-gray-50 border-gray-200 shadow-sm",ne=i==="dark"?"border-emerald-500/70 bg-gradient-to-br from-emerald-900/30 via-gray-800 to-gray-900/80 ring-2 ring-emerald-400/40 shadow-[0_20px_40px_-24px_rgba(52,211,153,0.8)]":"border-emerald-300 bg-gradient-to-br from-emerald-50 via-white to-green-50 ring-2 ring-emerald-200/70 shadow-[0_20px_40px_-24px_rgba(52,211,153,0.6)]";return r.jsxs("div",{className:`${fe} ${F} ${J?ne:""}`,children:[J&&r.jsxs("div",{className:"absolute top-3 right-3 inline-flex items-center gap-2 px-3 py-1 rounded-full bg-emerald-500 text-white text-xs font-semibold shadow-lg ring-2 ring-white/50 dark:ring-emerald-200/30",children:[r.jsx("span",{className:"w-2 h-2 rounded-full bg-white animate-ping"}),r.jsx("span",{className:"relative",children:"Сегодня"})]}),r.jsx("h3",{className:`text-lg font-semibold mb-3 ${re}`,children:le(W,"dd.MM.yyyy")}),r.jsxs("div",{className:"space-y-3 sm:space-y-4",children:[te.map(V=>{const{displayName:X}=E(V.userId);return r.jsxs("div",{className:`relative flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 p-4 rounded-2xl border-2 transition-all duration-300 hover:shadow-xl backdrop-blur text-center sm:text-left ring-1 ring-inset ring-black/5 dark:ring-white/5 ${ue[V.type]}`,children:[r.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2 justify-center sm:justify-start w-full",children:[r.jsx("span",{className:"font-semibold text-base sm:text-lg",children:X}),r.jsx("span",{className:"inline-flex items-center gap-2 px-3 py-1 rounded-full bg-white/70 dark:bg-white/10 text-xs sm:text-sm font-semibold",children:V.type==="dayoff"?"Выходной":V.type==="sick"?"Больничный":V.type==="vacation"?"Отпуск":"Прогул"})]}),r.jsx("div",{className:"flex gap-2 justify-center sm:justify-end w-full",children:c||(o==null?void 0:o.id)===V.userId?r.jsxs(r.Fragment,{children:[r.jsx("button",{onClick:()=>n(V),className:`p-1 rounded transition-colors ${i==="dark"?"bg-white/10 hover:bg-white/20 text-white":"bg-white border border-gray-200 text-gray-700 hover:bg-gray-100"}`,children:r.jsx(Bt,{className:"w-4 h-4 text-current"})}),r.jsx("button",{onClick:()=>p(V,O),className:`p-1 rounded transition-colors ${i==="dark"?"bg-white/10 hover:bg-white/20 text-white":"bg-white border border-gray-200 text-gray-700 hover:bg-gray-100"}`,children:r.jsx(At,{className:"w-4 h-4 text-current"})})]}):r.jsxs(r.Fragment,{children:[r.jsx("button",{disabled:!0,className:`p-1 cursor-not-allowed rounded ${i==="dark"?"bg-white/5 text-white/60":"bg-gray-100 text-gray-400 border border-gray-200"}`,title:"Вы можете редактировать только свои статусы",children:r.jsx(Bt,{className:"w-4 h-4 text-current opacity-60"})}),r.jsx("button",{disabled:!0,className:`p-1 cursor-not-allowed rounded ${i==="dark"?"bg-white/5 text-white/60":"bg-gray-100 text-gray-400 border border-gray-200"}`,title:"Вы можете удалять только свои статусы",children:r.jsx(At,{className:"w-4 h-4 text-current opacity-60"})})]})})]},V.id)}),P.map(V=>{const{member:X,displayName:S}=E(V.userId),R=w(V),K=R?"bg-gradient-to-r from-emerald-500 to-teal-600 border-emerald-300/40":"bg-gradient-to-r from-slate-500 to-slate-700 border-slate-300/40",U=R?Tr:$n;return r.jsxs("div",{className:`group relative space-y-2 sm:space-y-3 p-3 sm:p-4 ${K} rounded-lg sm:rounded-xl shadow-xl border-2 transition-all duration-300 hover:shadow-2xl active:scale-[0.98] sm:hover:scale-[1.03] mb-2 sm:mb-3 ${R?"hover:border-emerald-200/80 ring-2 ring-emerald-200/40 hover:ring-4 hover:ring-emerald-200/60":"hover:border-slate-200/80 ring-2 ring-slate-200/40 hover:ring-4 hover:ring-slate-200/60"}`,children:[r.jsxs("div",{className:"flex items-center justify-between border-b border-white/20 pb-2 sm:pb-3",children:[r.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 min-w-0 flex-1",children:[r.jsxs("div",{className:"relative flex-shrink-0 group/avatar",children:[X!=null&&X.avatar?r.jsx("img",{src:X.avatar,alt:S,className:`w-8 h-8 sm:w-9 sm:h-9 md:w-10 md:h-10 lg:w-11 lg:h-11 rounded-full object-cover border-2 shadow-xl transition-all duration-300 group-hover/avatar:scale-110 group-hover/avatar:shadow-2xl ${R?"border-white/50 ring-2 ring-white/40 ring-offset-2 ring-offset-emerald-400/30 group-hover/avatar:ring-4 group-hover/avatar:ring-white/60":"border-white/40 ring-2 ring-white/30 ring-offset-2 ring-offset-slate-400/30 group-hover/avatar:ring-4 group-hover/avatar:ring-white/50"}`,onError:Q=>{const $=Q.target;$.style.display="none";const ce=$.nextElementSibling;ce&&(ce.style.display="flex")}}):null,r.jsx("div",{className:`w-8 h-8 sm:w-9 sm:h-9 md:w-10 md:h-10 lg:w-11 lg:h-11 rounded-full flex items-center justify-center font-bold text-xs sm:text-sm transition-all duration-300 shadow-xl group-hover/avatar:scale-110 group-hover/avatar:shadow-2xl ${R?"bg-white/25 backdrop-blur-md border-2 border-white/40 ring-2 ring-white/30 group-hover/avatar:ring-4 group-hover/avatar:ring-white/60":"bg-white/15 backdrop-blur-md border-2 border-white/30 ring-2 ring-white/20 group-hover/avatar:ring-4 group-hover/avatar:ring-white/50"} ${X!=null&&X.avatar?"absolute inset-0 hidden":""}`,children:S.charAt(0).toUpperCase()}),r.jsx("div",{className:`absolute -bottom-0.5 -right-0.5 w-2.5 h-2.5 sm:w-3 sm:h-3 md:w-3.5 md:h-3.5 rounded-full border border-white sm:border-2 shadow-lg animate-pulse opacity-0 group-hover/avatar:opacity-100 transition-opacity duration-300 ${R?"bg-emerald-300":"bg-slate-400"}`})]}),r.jsx("span",{className:"text-white font-bold text-sm sm:text-base group-hover:scale-105 transition-transform duration-300 truncate",children:S})]}),r.jsx("div",{className:"flex gap-2",children:c||(o==null?void 0:o.id)===V.userId?r.jsxs(r.Fragment,{children:[r.jsx("button",{onClick:()=>t(V),className:"p-1.5 bg-white/20 hover:bg-white/30 rounded-lg transition-colors",children:r.jsx(Bt,{className:"w-4 h-4 text-white"})}),r.jsx("button",{onClick:()=>v(V),className:"p-1.5 bg-white/20 hover:bg-white/30 rounded-lg transition-colors",children:r.jsx(At,{className:"w-4 h-4 text-white"})})]}):r.jsxs(r.Fragment,{children:[r.jsx("button",{disabled:!0,className:"p-1.5 bg-white/10 cursor-not-allowed rounded-lg",title:"Вы можете редактировать только свои слоты",children:r.jsx(Bt,{className:"w-4 h-4 text-white/50"})}),r.jsx("button",{disabled:!0,className:"p-1.5 bg-white/10 cursor-not-allowed rounded-lg",title:"Вы можете удалять только свои слоты",children:r.jsx(At,{className:"w-4 h-4 text-white/50"})})]})})]}),r.jsx("div",{className:"space-y-2",children:V.slots.map((Q,$)=>r.jsxs("div",{className:"space-y-1.5",children:[r.jsx("div",{className:`bg-white/25 backdrop-blur-md rounded-md sm:rounded-lg px-2 sm:px-3 py-1.5 sm:py-2 border-2 transition-all duration-300 hover:scale-105 hover:shadow-xl ${R?"border-white/40 ring-2 ring-white/20 hover:border-white/60 hover:ring-4 hover:ring-white/40":"border-white/30 ring-2 ring-white/10 hover:border-white/50 hover:ring-4 hover:ring-white/30"}`,children:r.jsxs("div",{className:"flex items-center gap-1.5 sm:gap-2 flex-wrap",children:[r.jsx(U,{className:`w-3.5 h-3.5 sm:w-4 sm:h-4 text-white flex-shrink-0 ${R?"animate-pulse":""}`}),r.jsxs("span",{className:"text-white font-bold text-xs sm:text-sm whitespace-nowrap",children:[Q.start," - ",Q.end]}),Q.endDate&&r.jsxs("span",{className:"text-white/80 font-medium text-[10px] sm:text-xs whitespace-nowrap",children:["(до ",le(new Date(Q.endDate),"dd.MM"),")"]})]})}),Q.breaks&&Q.breaks.length>0&&r.jsx("div",{className:"flex justify-center",children:r.jsx("button",{onClick:()=>y(V.id),className:`p-1 rounded-md transition-all duration-200 hover:scale-110 ${T[V.id]?"text-white hover:text-white/80":"text-white/70 hover:text-white"}`,title:T[V.id]?"Скрыть перерывы":"Показать перерывы",children:T[V.id]?r.jsx(qh,{className:"w-4 h-4"}):r.jsx(Hl,{className:"w-4 h-4"})})}),Q.breaks&&Q.breaks.length>0&&T[V.id]&&r.jsxs("div",{className:"space-y-1 w-full",children:[r.jsx("div",{className:`text-[10px] ${i==="dark"?"text-gray-300":"text-gray-700"} font-medium text-center sm:text-left`,children:"Перерывы:"}),Q.breaks.map((ce,we)=>r.jsx("div",{className:`${i==="dark"?"bg-gray-700/95":"bg-white"} ${i==="dark"?"text-gray-200":"text-gray-900"} border-2 ${i==="dark"?"border-orange-500/60":"border-orange-300"} rounded-md sm:rounded-lg px-2 sm:px-3 py-1 sm:py-1.5 text-[10px] sm:text-xs font-semibold shadow-lg transition-all duration-300 hover:scale-105 hover:shadow-xl ${i==="dark"?"hover:border-orange-400/80 hover:shadow-orange-500/30 ring-2 ring-orange-500/20 hover:ring-4 hover:ring-orange-400/40":"hover:border-orange-400 hover:shadow-orange-400/30 ring-2 ring-orange-300/20 hover:ring-4 hover:ring-orange-300/40"} w-full`,children:r.jsxs("span",{className:"flex items-center gap-1 sm:gap-1.5 justify-center flex-wrap w-full",children:[r.jsx("span",{className:`w-1 h-1 sm:w-1.5 sm:h-1.5 rounded-full ${i==="dark"?"bg-orange-400":"bg-orange-500"} animate-pulse flex-shrink-0`}),r.jsxs("span",{className:"whitespace-nowrap",children:[ce.start," - ",ce.end]})]})},we))]})]},$))})]},V.id)}),P.length===0&&te.length===0&&O===le(ee,"yyyy-MM-dd")&&r.jsx("div",{className:`rounded-lg px-3 py-2 text-xs font-semibold ring-1 ring-inset ring-black/5 dark:ring-white/10 ${ue.absence}`,children:"Прогул"}),P.length===0&&te.length===0&&O!==le(ee,"yyyy-MM-dd")&&r.jsx("p",{className:`text-sm ${i==="dark"?"text-gray-400":"text-gray-600"}`,children:"Нет данных"})]})]},O)})})]})},Lj=({slot:s,onClose:e,onSave:t})=>{var er;const{user:n}=pt(),{theme:a}=at(),{isAdmin:i}=kt(),o=a==="dark"?"text-white":"text-gray-900",c=(s==null?void 0:s.date)||le(new Date,"yyyy-MM-dd"),[d,h]=I.useState(c),[m,x]=I.useState(s!=null&&s.userId?[s.userId]:n!=null&&n.id?[n.id]:[]),[f,k]=I.useState(((er=s==null?void 0:s.slots)==null?void 0:er.map(ae=>{const se=ae;return se.break&&!se.breaks?{...ae,breaks:[se.break]}:ae}))||[]),[A,D]=I.useState(""),[T,H]=I.useState(""),[L,E]=I.useState(!1),[M,ee]=I.useState(""),[C,v]=I.useState(""),[p,w]=I.useState(null),[N,j]=I.useState(null),[b,y]=I.useState(null),[re,ue]=I.useState(null),[W,O]=I.useState((s==null?void 0:s.comment)||""),[P,te]=I.useState(!1),[J,fe]=I.useState([]),[F,ne]=I.useState(!1),[V,X]=I.useState([]),[S,R]=I.useState("single"),[K,U]=I.useState(c),[Q,$]=I.useState(c),[ce,we]=I.useState(c),[G,oe]=I.useState([]),[_e,Te]=I.useState(""),[Je,Qe]=I.useState(!1);ms();const Z=["Пн","Вт","Ср","Чт","Пт","Сб","Вс"],ge=i&&!s;I.useEffect(()=>{console.log("SlotForm mounted, user:",n==null?void 0:n.name,"slots count:",f.length)},[]),I.useEffect(()=>{if(P&&d){const ae=new Date(d),se=ae.getDay()===0?6:ae.getDay()-1;fe([se])}},[P,d]),I.useEffect(()=>{F||X([])},[F]),I.useEffect(()=>{S!=="single"&&(te(!1),fe([]),ne(!1),X([]))},[S]);const ye=()=>{var Ye;if(!A||!T){Te("Заполните время начала и окончания");return}const ae=lr(A)>=lr(T),se=L||ae;if(ae&&!L){Te('Время окончания должно быть позже времени начала. Включите "Переходит через полночь" для слотов, переходящих на следующий день.');return}let me;if(se&&d){const Oe=new Date(d);Oe.setDate(Oe.getDate()+1),me=le(Oe,"yyyy-MM-dd")}const Ue=p!==null?((Ye=f[p])==null?void 0:Ye.breaks)||[]:[],Se={start:A,end:T,...me&&{endDate:me},breaks:Ue};if(p!==null){const Oe=[...f];Oe[p]=Se,k(Oe)}else k([...f,Se]);D(""),H(""),E(!1),ee(""),v(""),w(null),j(null),Te("")},de=ae=>{const se=f[ae];if(!se)return;const me=!!se.endDate||lr(se.end)<=lr(se.start);D(se.start),H(se.end),E(me),w(ae),j(null),y(null),ue(null),ee(""),v(""),Te("")},Ce=()=>{w(null),D(""),H(""),E(!1),Te("")},Ve=ae=>{if(!M||!C){Te("Заполните время начала и окончания перерыва");return}const se=f[ae];if(!se)return;if(M>=C){Te("Время окончания перерыва должно быть позже времени начала");return}const me=lr(M),Ue=lr(C),Se=lr(se.start),Ye=lr(se.end),Oe=se.endDate||Ye<=Se;let ze=!1;if(Oe){const ve=me>=Se&&me<1440&&Ue>me&&Ue<=1440&&Ue>me,Ie=me>=0&&me<=Ye&&Ue>me&&Ue<=Ye,lt=me>=Se&&me<1440&&Ue>0&&Ue<=Ye&&me>Ue;ze=ve||Ie||lt}else ze=me>=Se&&Ue<=Ye&&Ue>me;if(!ze){Te(`Перерыв должен быть в пределах времени слота (${se.start} - ${se.end})`);return}const Be=se.breaks||[];for(let Et=0;Et<Be.length;Et++){if(b===ae&&re===Et)continue;const ve=Be[Et];if(M>=ve.start&&M<ve.end||C>ve.start&&C<=ve.end||M<=ve.start&&C>=ve.end){Te("Перерывы не должны пересекаться");return}}let rt;b===ae&&re!==null?(rt=[...Be],rt[re]={start:M,end:C},rt.sort((Et,ve)=>Et.start.localeCompare(ve.start))):rt=[...Be,{start:M,end:C}].sort((Et,ve)=>Et.start.localeCompare(ve.start));const ft=[...f];ft[ae]={...se,breaks:rt},k(ft),ee(""),v(""),j(null),y(null),ue(null),Te("")},q=(ae,se)=>{const me=f[ae];if(!me||!me.breaks||!me.breaks[se])return;const Ue=me.breaks[se];y(ae),ue(se),j(ae),ee(Ue.start),v(Ue.end),Te("")},Ne=()=>{ee(""),v(""),j(null),y(null),ue(null),Te("")},Me=(ae,se)=>{const me=f[ae];if(!me||!me.breaks)return;const Ue=me.breaks.filter((Ye,Oe)=>Oe!==se),Se=[...f];Se[ae]={...me,breaks:Ue.length>0?Ue:void 0},k(Se)},z=ae=>{k(f.filter((se,me)=>me!==ae)),p===ae&&Ce()},B=ae=>{J.includes(ae)?fe(J.filter(se=>se!==ae)):fe([...J,ae])},je=ae=>{V.includes(ae)?X(V.filter(se=>se!==ae)):X([...V,ae])},Pe=ae=>{x(se=>se.includes(ae)?se.filter(me=>me!==ae):[...se,ae])},Fe=()=>{m.length===De.length?x([]):x(De.map(ae=>ae.id))},pe=()=>{if(!ce)return;const ae=I0([...G,ce]);oe(ae),we("")},Ze=ae=>{oe(se=>se.filter(me=>me!==ae))},He=()=>{if(ge){if(S==="range")return Xi(K,Q);if(S==="multiple")return G}if(S==="single"){if(P&&J.length>0){const ae=[],se=new Date(d),me=new Date(se.getFullYear(),se.getMonth()+1,0),Ue=J[0],Se=new Date(se);for(;Se<=me;)(Se.getDay()===0?6:Se.getDay()-1)===Ue&&ae.push(le(Se,"yyyy-MM-dd")),Se.setDate(Se.getDate()+1);return ae}if(F&&V.length>0){const ae=[],se=new Date(d),me=se.getDay()===0?6:se.getDay()-1;se.setDate(se.getDate()-me);for(let Ue=0;Ue<7;Ue++){const Se=new Date(se);Se.setDate(se.getDate()+Ue);const Ye=Se.getDay()===0?6:Se.getDay()-1;V.includes(Ye)&&ae.push(le(Se,"yyyy-MM-dd"))}return ae}return[d]}return S==="range"?Xi(K,Q):G},et=()=>s?[s.userId]:ge?m:i&&!n?m.length>0?m:[]:n!=null&&n.id?[n.id]:[],Ee=ae=>gt(ae),xt=async(ae,se,me)=>{if(me){const Ye=await F0(me,!0);for(const Oe of Ye){const ze=await fr(Oe.restrictedUserId,ae);for(const Be of se){for(const rt of ze)if(hi(Be,rt.slots[0]))return`Ваше время пересекается со слотом ${Ee(Oe.restrictedUserId)} (${rt.slots[0].start}-${rt.slots[0].end}). ${Oe.reason||"Выберите другое время."}`;if(Be.endDate){const rt=await fr(Oe.restrictedUserId,Be.endDate);for(const ft of rt)if(hi(Be,ft.slots[0]))return`Ваше время пересекается со слотом ${Ee(Oe.restrictedUserId)} (${ft.slots[0].start}-${ft.slots[0].end}). ${Oe.reason||"Выберите другое время."}`}}}}const Se=(await fr(void 0,ae)).filter(Ye=>Ye.id!==(s==null?void 0:s.id));for(const Ye of se){for(const Oe of Se)if(hi(Ye,Oe.slots[0])&&Oe.participants.length>=3)return`Слот ${Ye.start}-${Ye.end} уже занят максимальным количеством участников (3)`;if(Ye.endDate){const ze=(await fr(void 0,Ye.endDate)).filter(Be=>Be.id!==(s==null?void 0:s.id));for(const Be of ze)if(hi(Ye,Be.slots[0])&&Be.participants.length>=3)return`Слот ${Ye.start}-${Ye.end} (до ${Ye.endDate}) уже занят максимальным количеством участников (3)`}}return null},jt=async()=>{if(console.log("handleSave called"),!i&&!n){console.log("No user found"),Te("Пользователь не найден");return}if(f.length===0){Te("Добавьте хотя бы один временной интервал");return}if(s&&!i&&n&&s.userId!==n.id){Te("Вы можете редактировать только свои слоты"),Qe(!1);return}const ae=et();if(ae.length===0){Te("Выберите хотя бы одного участника");return}const se=He();if(se.length===0){Te("Выберите даты");return}const me=new Date;me.setHours(0,0,0,0);const Ue=le(me,"yyyy-MM-dd"),Se=ze=>ze<Ue,Ye=(ze,Be)=>{const rt=new Date(ze),ft=new Date(Be);return rt.setHours(0,0,0,0),ft.setHours(0,0,0,0),Math.round((ft.getTime()-rt.getTime())/(1e3*60*60*24))},Oe=async(ze,Be,rt=[ze])=>{const ft=f.map(Ie=>{const lt=!Ie.endDate&&lr(Ie.end)<=lr(Ie.start),ir=Ie.endDate?Ye(d,Ie.endDate):lt?1:0;if(ir>0){const Wr=new Date(Be);return Wr.setDate(Wr.getDate()+ir),{...Ie,endDate:le(Wr,"yyyy-MM-dd")}}return{...Ie,...Ie.endDate?{endDate:Ie.endDate}:{}}});if(!i){const Ie=ft.length>0?ft[0].start:void 0,lt=await Ji("slots",Be,Ie);if(lt.restricted)throw new Error(`[${Ee(ze)} • ${le(new Date(Be),"dd.MM.yyyy")}] ${lt.reason}`);for(const ir of ft)if(ir.endDate&&ir.endDate!==Be){const Wr=await Ji("slots",ir.endDate);if(Wr.restricted)throw new Error(`[${Ee(ze)} • ${le(new Date(ir.endDate),"dd.MM.yyyy")}] ${Wr.reason}`)}}const Et=await xt(Be,ft,ze);if(Et)throw new Error(`[${Ee(ze)} • ${le(new Date(Be),"dd.MM.yyyy")}] ${Et}`);const ve={id:(s==null?void 0:s.id)||"",userId:ze,date:Be,slots:ft,...W&&{comment:W},participants:rt};if(i)if(s){const{id:Ie,...lt}=ve;await S0(s.id,lt)}else{const{id:Ie,...lt}=ve;await T0(lt)}else await vt({entity:"slot",action:s?"update":"create",authorId:(n==null?void 0:n.id)||ze,targetUserId:ze,before:s||null,after:ve,comment:W||void 0})};console.log("Starting save process..."),Te(""),Qe(!0);try{if(s){await Oe(s.userId,d,s.participants||[s.userId]),t();return}if(F&&V.length>0){const ze=He();for(const Be of ze)if(!Se(Be))for(const rt of ae)await Oe(rt,Be)}else if(P&&J.length>0){const ze=new Date(d),Be=ze.getMonth(),rt=ze.getFullYear(),ft=new Date(rt,Be+1,0).getDate();for(let Et=1;Et<=ft;Et++){const ve=new Date(rt,Be,Et),Ie=ve.getDay()===0?6:ve.getDay()-1;if(J.includes(Ie)){const lt=le(ve,"yyyy-MM-dd");if(Se(lt))continue;for(const ir of ae)await Oe(ir,lt)}}}else if(ge&&S!=="single")for(const ze of se)for(const Be of ae)await Oe(Be,ze);else for(const ze of ae)await Oe(ze,d);t()}catch(ze){console.error("Error saving slot:",ze);const Be=ze.message||ze.code||"Ошибка при сохранении";Te(Be)}finally{Qe(!1)}},_t=ge?He():[d],br=f.map(ae=>`${ae.start}–${ae.end}${ae.endDate?" (+1)":""}`);return r.jsx("div",{className:"fixed inset-0 bg-slate-950/75 backdrop-blur-xl flex items-start sm:items-center justify-center z-[70] p-4 sm:p-6 touch-manipulation overflow-y-auto",children:r.jsx("div",{className:`w-full max-w-5xl rounded-3xl shadow-[0_24px_80px_rgba(0,0,0,0.45)] border ${a==="dark"?"bg-gradient-to-br from-[#0c1320] via-[#0b1220] to-[#08111b] border-white/10":"bg-gradient-to-br from-white via-slate-50 to-white border-slate-200"} max-h-[90vh] overflow-y-auto`,children:r.jsxs("div",{className:"p-4 sm:p-6 lg:p-7 flex flex-col h-full min-h-0 overflow-y-auto",children:[r.jsxs("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between",children:[r.jsxs("div",{className:"space-y-1",children:[r.jsx("div",{className:"flex items-center gap-2 text-xs font-semibold text-[#4E6E49] tracking-tight",children:r.jsx("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full bg-[#4E6E49]/10 text-[#4E6E49] border border-[#4E6E49]/30",children:s?"Редактирование слота":"Создание слота"})}),r.jsx("h3",{className:`text-2xl sm:text-3xl font-bold ${o}`,children:s?"Редактировать слот":"Добавить слот"})]}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsxs("div",{className:`px-3 py-2 rounded-xl border text-xs sm:text-sm ${a==="dark"?"border-white/10 bg-white/5 text-gray-200":"border-slate-200 bg-slate-50 text-slate-700"}`,children:[s?"Редактирование":"Создание"," · ",f.length||0," интервал(ов)"]}),r.jsx("button",{onClick:e,className:`p-2.5 rounded-full border ${a==="dark"?"border-white/10 text-gray-200 hover:bg-white/5":"border-slate-200 text-slate-600 hover:bg-slate-100"} transition-colors touch-manipulation`,"aria-label":"Закрыть",children:r.jsx(Pt,{className:"w-4 h-4 sm:w-5 sm:h-5"})})]})]}),r.jsxs("div",{className:"mt-5 grid lg:grid-cols-[0.9fr_1.6fr] gap-4 lg:gap-6 flex-1 min-h-0",children:[r.jsxs("aside",{className:`rounded-2xl border ${a==="dark"?"border-white/10 bg-white/5":"border-slate-200 bg-white"} p-4 sm:p-5 space-y-4 sticky top-0 self-start max-h-full overflow-y-auto`,children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsx("p",{className:"text-sm font-semibold",children:"Навигация"}),r.jsx("span",{className:"text-[11px] uppercase tracking-wide text-[#4E6E49] font-semibold",children:"4 шага"})]}),r.jsx("div",{className:"space-y-2",children:[{label:"Участники",detail:m.length>0?r.jsx("div",{className:"flex flex-wrap gap-x-1",children:m.map((ae,se)=>r.jsxs("span",{children:[r.jsx(as,{userId:ae}),se<m.length-1?",":""]},ae))}):"Не выбрано",done:m.length>0||!!s},{label:"Даты",detail:_t.slice(0,2).map(ae=>le(ae,"dd.MM")).join(", ")||"Выберите дату",done:_t.length>0},{label:"Время",detail:br.slice(0,2).join(" · ")||"Добавьте интервал",done:f.length>0},{label:"Комментарий",detail:W?"Заполнен":"Необязателен",done:!!W}].map((ae,se)=>r.jsxs("div",{className:`flex items-start gap-3 rounded-xl border px-3 py-3 ${a==="dark"?"border-white/10 bg-white/5":"border-slate-200 bg-slate-50"}`,children:[r.jsx("span",{className:`mt-0.5 inline-flex h-6 w-6 items-center justify-center rounded-full text-xs font-bold ${ae.done?"bg-[#4E6E49] text-white":a==="dark"?"bg-slate-800 text-gray-300":"bg-slate-200 text-slate-700"}`,children:se+1}),r.jsxs("div",{className:"flex-1 min-w-0",children:[r.jsx("p",{className:"text-sm font-semibold",children:ae.label}),r.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400 truncate",children:ae.detail})]})]},ae.label))})]}),r.jsxs("div",{className:"space-y-4 overflow-y-auto overscroll-contain pr-1 pb-6 flex-1 min-h-0",children:[ge&&r.jsxs("div",{children:[r.jsx("label",{className:`block text-xs sm:text-sm font-medium mb-2 ${a==="dark"?"text-gray-300":"text-gray-700"}`,children:"Участники"}),r.jsxs("div",{className:"space-y-3",children:[r.jsx("div",{className:"flex flex-wrap gap-2",children:De.map(ae=>r.jsxs("label",{className:`px-3 py-1.5 rounded-full border cursor-pointer text-sm flex items-center gap-2 ${m.includes(ae.id)?"bg-[#4E6E49] border-[#4E6E49] text-white":a==="dark"?"bg-gray-700 border-gray-800 text-gray-200":"bg-gray-100 border-gray-300 text-gray-700"}`,children:[r.jsx("input",{type:"checkbox",checked:m.includes(ae.id),onChange:()=>Pe(ae.id),className:"hidden"}),r.jsx(as,{userId:ae.id})]},ae.id))}),r.jsx("button",{type:"button",onClick:Fe,className:"text-sm text-[#4E6E49] hover:text-[#4E6E49]",children:m.length===De.length?"Снять выделение":"Выбрать всех"})]})]}),ge&&r.jsxs("div",{children:[r.jsx("p",{className:`text-xs sm:text-sm font-medium mb-2 ${a==="dark"?"text-gray-300":"text-gray-700"}`,children:"Формат выбора дат"}),r.jsx("div",{className:"flex flex-wrap gap-4",children:[{value:"single",label:"Один день"},{value:"range",label:"Диапазон дат"},{value:"multiple",label:"Конкретные даты"}].map(ae=>r.jsxs("label",{className:"flex items-center gap-2 text-sm cursor-pointer",children:[r.jsx("input",{type:"radio",value:ae.value,checked:S===ae.value,onChange:se=>R(se.target.value)}),r.jsx("span",{className:a==="dark"?"text-gray-200":"text-gray-700",children:ae.label})]},ae.value))})]}),(!ge||S==="single")&&r.jsxs("div",{children:[r.jsx("label",{className:`block text-xs sm:text-sm font-medium mb-2 ${a==="dark"?"text-gray-300":"text-gray-700"}`,children:"Дата"}),r.jsx("input",{type:"date",value:d,onChange:ae=>h(ae.target.value),className:`w-full px-3 sm:px-4 py-2 sm:py-2.5 text-sm sm:text-base rounded-lg border touch-manipulation ${a==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`})]}),ge&&S==="range"&&r.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[r.jsxs("div",{children:[r.jsx("label",{className:`block text-xs sm:text-sm font-medium mb-2 ${a==="dark"?"text-gray-300":"text-gray-700"}`,children:"Начало диапазона"}),r.jsx("input",{type:"date",value:K,onChange:ae=>U(ae.target.value),className:`w-full px-3 sm:px-4 py-2 sm:py-2.5 text-sm sm:text-base rounded-lg border touch-manipulation ${a==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`})]}),r.jsxs("div",{children:[r.jsx("label",{className:`block text-xs sm:text-sm font-medium mb-2 ${a==="dark"?"text-gray-300":"text-gray-700"}`,children:"Конец диапазона"}),r.jsx("input",{type:"date",value:Q,min:K,onChange:ae=>$(ae.target.value),className:`w-full px-3 sm:px-4 py-2 sm:py-2.5 text-sm sm:text-base rounded-lg border touch-manipulation ${a==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`})]})]}),ge&&S==="multiple"&&r.jsxs("div",{children:[r.jsx("label",{className:`block text-xs sm:text-sm font-medium mb-2 ${a==="dark"?"text-gray-300":"text-gray-700"}`,children:"Выбранные даты"}),r.jsxs("div",{className:"flex flex-col gap-3",children:[r.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[r.jsx("input",{type:"date",value:ce,onChange:ae=>we(ae.target.value),className:`flex-1 px-3 sm:px-4 py-2 sm:py-2.5 text-sm sm:text-base rounded-lg border touch-manipulation ${a==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`}),r.jsx("button",{type:"button",onClick:pe,className:"px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg transition-colors",children:"Добавить"})]}),G.length>0?r.jsx("div",{className:"flex flex-wrap gap-2",children:G.map(ae=>r.jsxs("span",{className:"inline-flex items-center gap-2 px-3 py-1.5 rounded-full bg-gray-100 text-gray-800 text-sm",children:[le(ae,"dd.MM.yyyy"),r.jsx("button",{type:"button",onClick:()=>Ze(ae),className:"text-red-500 hover:text-red-600",children:"x"})]},ae))}):r.jsx("p",{className:"text-sm text-gray-500",children:"Пока не выбрано ни одной даты"})]})]}),r.jsxs("div",{children:[r.jsx("label",{className:`block text-xs sm:text-sm font-medium mb-2 ${a==="dark"?"text-gray-300":"text-gray-700"}`,children:"Временные слоты"}),r.jsxs("div",{className:"space-y-2 mb-2",children:[r.jsx("div",{className:"flex flex-col sm:flex-row gap-2",children:r.jsxs("div",{className:"flex gap-2 flex-1",children:[r.jsx("input",{type:"time",value:A,onChange:ae=>D(ae.target.value),className:`flex-1 px-3 sm:px-4 py-2 sm:py-2.5 text-sm sm:text-base rounded-lg border touch-manipulation ${a==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`,placeholder:"Начало"}),r.jsx("span",{className:"mx-1 sm:mx-2 text-gray-500 text-sm sm:text-base flex items-center",children:"—"}),r.jsx("input",{type:"time",value:T,onChange:ae=>H(ae.target.value),className:`flex-1 px-3 sm:px-4 py-2 sm:py-2.5 text-sm sm:text-base rounded-lg border touch-manipulation ${a==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`,placeholder:"Окончание"})]})}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("input",{type:"checkbox",id:"crossMidnight",checked:L,onChange:ae=>{E(ae.target.checked)},className:`w-4 h-4 rounded border-2 ${a==="dark"?"border-gray-800 bg-gray-700 checked:bg-[#4E6E49] checked:border-[#4E6E49]":"border-gray-300 bg-white checked:bg-[#4E6E49] checked:border-[#4E6E49]"} focus:ring-2 focus:ring-[#4E6E49] cursor-pointer touch-manipulation`}),r.jsx("label",{htmlFor:"crossMidnight",className:`text-xs sm:text-sm font-medium cursor-pointer ${a==="dark"?"text-gray-300":"text-gray-700"}`,children:"Переходит через полночь (на следующий день)"})]}),r.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[r.jsx("button",{onClick:ye,className:"w-full px-4 py-2 bg-[#4E6E49] hover:bg-[#4E6E49] text-white rounded-lg transition-colors flex items-center justify-center gap-2",children:p!==null?r.jsxs(r.Fragment,{children:[r.jsx(Bt,{className:"w-4 h-4"}),"Сохранить слот"]}):r.jsxs(r.Fragment,{children:[r.jsx(is,{className:"w-4 h-4"}),"Добавить слот"]})}),p!==null&&r.jsx("button",{onClick:Ce,className:`w-full sm:w-auto px-4 py-2 rounded-lg border ${a==="dark"?"border-gray-700 text-gray-200 hover:bg-gray-700":"border-gray-300 text-gray-800 hover:bg-gray-100"}`,children:"Отмена"})]})]}),r.jsx("div",{className:"space-y-3",children:f.map((ae,se)=>r.jsxs("div",{className:`flex flex-col gap-2 p-3 rounded-lg ${a==="dark"?"bg-gray-700":"bg-gray-100"}`,children:[r.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-2",children:[r.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[r.jsxs("span",{className:o,children:[ae.start," - ",ae.end]}),ae.endDate&&r.jsxs("span",{className:`text-xs px-2 py-0.5 rounded-full ${a==="dark"?"bg-blue-500/20 text-blue-400 border border-blue-500/30":"bg-blue-100 text-blue-700 border border-blue-300"}`,children:["до ",le(new Date(ae.endDate),"dd.MM.yyyy")]})]}),r.jsxs("div",{className:"flex items-center gap-1",children:[r.jsx("button",{onClick:()=>de(se),className:"p-1 text-blue-500 hover:bg-blue-500 hover:text-white rounded transition-colors flex-shrink-0",title:"Редактировать слот",children:r.jsx(Bt,{className:"w-4 h-4"})}),r.jsx("button",{onClick:()=>z(se),className:"p-1 text-red-500 hover:bg-red-500 hover:text-white rounded transition-colors flex-shrink-0",title:"Удалить слот",children:r.jsx(At,{className:"w-4 h-4"})})]})]}),ae.breaks&&ae.breaks.length>0&&r.jsxs("div",{className:"ml-4 space-y-1",children:[r.jsx("span",{className:`text-xs ${a==="dark"?"text-gray-400":"text-gray-600"}`,children:"Перерывы:"}),ae.breaks.map((me,Ue)=>b===se&&re===Ue?null:r.jsxs("div",{className:"flex items-center justify-between gap-2",children:[r.jsxs("span",{className:`text-sm ${a==="dark"?"text-gray-300":"text-gray-700"}`,children:[me.start," - ",me.end]}),r.jsxs("div",{className:"flex gap-1",children:[r.jsx("button",{onClick:()=>q(se,Ue),className:"p-1 text-blue-400 hover:bg-blue-400 hover:text-white rounded transition-colors",title:"Редактировать перерыв",children:r.jsx(Bt,{className:"w-3 h-3"})}),r.jsx("button",{onClick:()=>Me(se,Ue),className:"p-1 text-red-400 hover:bg-red-400 hover:text-white rounded transition-colors",title:"Удалить перерыв",children:r.jsx(Pt,{className:"w-3 h-3"})})]})]},Ue))]}),r.jsx("div",{className:"ml-4 space-y-2 border-t pt-2 border-gray-500 border-opacity-30",children:N===se?r.jsxs("div",{className:"space-y-2",children:[r.jsxs("div",{className:"flex gap-2",children:[r.jsx("input",{type:"time",value:M,onChange:me=>ee(me.target.value),className:`flex-1 px-3 py-1.5 text-sm rounded-lg border ${a==="dark"?"bg-gray-600 border-gray-500 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`,placeholder:"Начало"}),r.jsx("input",{type:"time",value:C,onChange:me=>v(me.target.value),className:`flex-1 px-3 py-1.5 text-sm rounded-lg border ${a==="dark"?"bg-gray-600 border-gray-500 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`,placeholder:"Конец"})]}),r.jsxs("div",{className:"flex gap-2",children:[r.jsx("button",{onClick:()=>Ve(se),className:"flex-1 px-3 py-1.5 text-sm bg-[#4E6E49] hover:bg-[#4E6E49] text-white rounded-lg transition-colors",children:b===se&&re!==null?"Сохранить":"Добавить перерыв"}),r.jsx("button",{onClick:Ne,className:"px-3 py-1.5 text-sm bg-gray-500 hover:bg-gray-600 text-white rounded-lg transition-colors",children:"Отмена"})]})]}):r.jsxs("button",{onClick:()=>{j(se),ee(""),v(""),y(null),ue(null),Te("")},className:"w-full px-3 py-1.5 text-sm bg-blue-500 hover:bg-blue-600 text-white rounded-lg transition-colors flex items-center justify-center gap-1",children:[r.jsx(is,{className:"w-3 h-3"}),"Добавить перерыв"]})})]},se))}),f.length>0&&r.jsxs("p",{className:`text-sm mt-2 ${a==="dark"?"text-gray-400":"text-gray-600"}`,children:["Всего часов: ",jo(f).toFixed(1)]})]}),(!ge||S==="single")&&r.jsxs("div",{children:[r.jsx("p",{className:`text-xs sm:text-sm font-medium mb-3 ${a==="dark"?"text-gray-300":"text-gray-700"}`,children:"Повторы"}),r.jsxs("div",{className:"grid sm:grid-cols-2 gap-3",children:[r.jsxs("button",{type:"button",onClick:()=>{ne(!F),Te("")},className:`text-left rounded-xl border px-4 py-4 transition-all shadow-sm flex items-start gap-3 h-full ${F?"bg-blue-100 text-blue-800 border-blue-200 dark:bg-blue-900/30 dark:text-blue-100 dark:border-blue-800 ring-2 ring-blue-500/50 shadow-lg":a==="dark"?"border-white/10 bg-white/5 text-gray-200 hover:border-white/30":"border-slate-200 bg-white text-gray-800 hover:border-slate-300"}`,children:[r.jsx(sx,{className:"w-5 h-5 flex-shrink-0 mt-0.5"}),r.jsxs("div",{className:"flex-1 min-w-0",children:[r.jsx("p",{className:"font-semibold text-sm",children:"Повтор на неделю"}),r.jsx("p",{className:"text-xs mt-1 opacity-80",children:"Актуальная неделя по дням"}),F&&r.jsx("div",{className:"mt-3 flex flex-wrap gap-2",children:Z.map((ae,se)=>r.jsx("button",{type:"button",onClick:me=>{me.stopPropagation(),je(se)},className:`px-2 py-1 rounded-lg text-xs transition-colors ${V.includes(se)?"bg-blue-600 text-white":a==="dark"?"bg-gray-700 text-gray-300":"bg-gray-200 text-gray-700"}`,children:ae},se))})]})]}),r.jsxs("button",{type:"button",onClick:()=>{te(!P),Te("")},className:`text-left rounded-xl border px-4 py-4 transition-all shadow-sm flex items-start gap-3 h-full ${P?"bg-purple-100 text-purple-800 border-purple-200 dark:bg-purple-900/30 dark:text-purple-100 dark:border-purple-800 ring-2 ring-purple-500/50 shadow-lg":a==="dark"?"border-white/10 bg-white/5 text-gray-200 hover:border-white/30":"border-slate-200 bg-white text-gray-800 hover:border-slate-300"}`,children:[r.jsx(Tr,{className:"w-5 h-5 flex-shrink-0 mt-0.5"}),r.jsxs("div",{className:"flex-1 min-w-0",children:[r.jsx("p",{className:"font-semibold text-sm",children:"Повтор по месяцу"}),r.jsx("p",{className:"text-xs mt-1 opacity-80",children:"На месяц вперед по дням"}),P&&r.jsx("div",{className:"mt-3 flex flex-wrap gap-2",children:Z.map((ae,se)=>r.jsx("button",{type:"button",onClick:me=>{me.stopPropagation(),B(se)},className:`px-2 py-1 rounded-lg text-xs transition-colors ${J.includes(se)?"bg-purple-600 text-white":a==="dark"?"bg-gray-700 text-gray-300":"bg-gray-200 text-gray-700"}`,children:ae},se))})]})]})]})]}),r.jsxs("div",{children:[r.jsx("label",{className:`block text-xs sm:text-sm font-medium mb-2 ${a==="dark"?"text-gray-300":"text-gray-700"}`,children:"Комментарий"}),r.jsx("textarea",{value:W,onChange:ae=>O(ae.target.value),rows:3,className:`w-full px-3 sm:px-4 py-2 sm:py-2.5 text-sm sm:text-base rounded-lg border touch-manipulation resize-y ${a==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`,placeholder:"Добавьте комментарий (необязательно)"})]}),_e&&r.jsx("div",{className:"p-3 bg-red-500 text-white rounded-lg text-sm",children:_e}),r.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 sm:gap-3 pt-2",children:[r.jsx("button",{onClick:ae=>{console.log("Save button clicked!",{loading:Je,slotsCount:f.length,disabled:Je||f.length===0}),ae.preventDefault(),jt()},disabled:Je||f.length===0,className:"flex-1 px-4 py-2.5 sm:py-2 bg-[#4E6E49] hover:bg-[#4E6E49] disabled:bg-gray-400 disabled:cursor-not-allowed text-white rounded-lg sm:rounded-xl transition-colors text-sm sm:text-base font-medium touch-manipulation active:scale-95 disabled:active:scale-100",children:Je?"Ошибка добавления слота":"Отправить на согласование"}),r.jsx("button",{onClick:e,className:`px-4 py-2.5 sm:py-2 rounded-lg sm:rounded-xl transition-colors text-sm sm:text-base font-medium touch-manipulation active:scale-95 ${a==="dark"?"bg-gray-700 hover:bg-gray-600 active:bg-gray-500":"bg-gray-200 hover:bg-gray-300 active:bg-gray-400"}`,children:"Отмена"})]})]})]})]})})})},Fj=({type:s,status:e,onClose:t,onSave:n})=>{const{user:a}=pt(),{theme:i}=at(),{isAdmin:o}=kt(),c=i==="dark"?"text-white":"text-gray-900",d=(e==null?void 0:e.date)||le(new Date,"yyyy-MM-dd"),[h,m]=I.useState(e!=null&&e.userId?[e.userId]:a!=null&&a.id?[a.id]:[]),[x,f]=I.useState(d),[k,A]=I.useState((e==null?void 0:e.endDate)||d),[D,T]=I.useState(!!(e!=null&&e.endDate)),[H,L]=I.useState((e==null?void 0:e.comment)||""),[E,M]=I.useState(s||(e==null?void 0:e.type)||null),[ee,C]=I.useState(""),[v,p]=I.useState(!1),[w,N]=I.useState("single"),[j,b]=I.useState(d),[y,re]=I.useState(d),[ue,W]=I.useState(d),[O,P]=I.useState([]),[te,J]=I.useState(!1),[fe,F]=I.useState([]),[ne,V]=I.useState(!1),[X,S]=I.useState([]),R=o&&!e,K=["Пн","Вт","Ср","Чт","Пт","Сб","Вс"];ms(),I.useEffect(()=>{D||A(x)},[D,x]),I.useEffect(()=>{R&&w!=="single"&&T(!1)},[R,w]),I.useEffect(()=>{te||F([])},[te]),I.useEffect(()=>{if(ne&&x){const q=new Date(x),Ne=q.getDay()===0?6:q.getDay()-1;S([Ne])}},[ne,x]),I.useEffect(()=>{w!=="single"&&(J(!1),F([]),V(!1),S([]))},[w]);const U=q=>{m(Ne=>Ne.includes(q)?Ne.filter(Me=>Me!==q):[...Ne,q])},Q=()=>{h.length===De.length?m([]):m(De.map(q=>q.id))},$=()=>{if(!ue)return;const q=I0([...O,ue]);P(q),W("")},ce=q=>{P(Ne=>Ne.filter(Me=>Me!==q))},we=()=>e?[e.userId]:R?h:o&&!a?h.length>0?h:[]:a!=null&&a.id?[a.id]:[],G=q=>gt(q),oe=q=>{if(R){if(w==="range")return j&&y?q==="dayoff"?Xi(j,y).map(Me=>({date:Me})):[{date:j,endDate:y}]:[];if(w==="multiple")return q==="dayoff"?O.map(Me=>({date:Me})):O.map(Me=>({date:Me,endDate:Me}))}if(w==="single"&&q==="dayoff"){if(ne&&X.length>0){const Me=[],z=new Date(x),B=new Date(z.getFullYear(),z.getMonth()+1,0),je=X[0],Pe=new Date(z);for(;Pe<=B;)(Pe.getDay()===0?6:Pe.getDay()-1)===je&&Me.push(le(Pe,"yyyy-MM-dd")),Pe.setDate(Pe.getDate()+1);return Me.map(Fe=>({date:Fe}))}if(te&&fe.length>0){const Me=[],z=new Date(x),B=z.getDay()===0?6:z.getDay()-1;z.setDate(z.getDate()-B);for(let je=0;je<7;je++){const Pe=new Date(z);Pe.setDate(z.getDate()+je);const Fe=Pe.getDay()===0?6:Pe.getDay()-1;fe.includes(Fe)&&Me.push(le(Pe,"yyyy-MM-dd"))}return Me.map(je=>({date:je}))}}if(q==="dayoff"){if(w==="range")return Xi(j,y).map(Me=>({date:Me}));if(w==="multiple")return O.map(Me=>({date:Me}))}if(w==="range"&&j&&y)return[{date:j,endDate:y}];if(w==="multiple")return O.map(Me=>({date:Me,endDate:Me}));const Ne={date:x};return q!=="dayoff"&&(D||e!=null&&e.endDate)&&(Ne.endDate=k),[Ne]},_e=async(q,Ne,Me,z)=>{if(o)return null;if(!a)return"Пользователь не найден";const B=new Date,je=new Date(Ne),Pe=new Date(Me||Ne);if(z==="dayoff"&&E0(je,B))return"Нельзя установить выходной на сегодня. Выберите смену или возьмите больничный.";if(z==="sick"){const Fe=new Date;Fe.setHours(0,0,0,0);const pe=new Date(Fe);pe.setDate(pe.getDate()+2);const Ze=new Date(Ne);if(Ze.setHours(0,0,0,0),Ze<Fe||Ze>pe)return"Больничный можно взять только на актуальную дату и + 2 суток. Нельзя выбрать заранее.";const He=Math.ceil((Pe.getTime()-je.getTime())/(1e3*60*60*24))+1;if(He<1)return"Больничный должен быть минимум на 1 день";if(He>14)return"Больничный может длиться не более 14 календарных дней в месяце";const et=new Date(je.getFullYear(),je.getMonth(),1),Ee=new Date(je.getFullYear(),je.getMonth()+1,0);if((await ns(q)).filter(_t=>_t.type==="sick"&&_t.date>=le(et,"yyyy-MM-dd")&&_t.date<=le(Ee,"yyyy-MM-dd")).length+He>14)return"Больничный ограничен 14 днями в месяц"}if(z==="vacation"){if(Math.ceil((Pe.getTime()-je.getTime())/864e5)+1>14)return"Отпуск не может быть больше 14 дней в месяце";const pe=new Date(je.getFullYear(),0,1),Ze=new Date(je.getFullYear(),11,31);if((await ns(q)).filter(Ee=>Ee.type==="vacation"&&Ee.date>=le(pe,"yyyy-MM-dd")&&Ee.date<=le(Ze,"yyyy-MM-dd")).length>=6)return"Не более 6 отпусков в год"}if(z==="dayoff"){const Fe=new Date(je);Fe.setDate(Fe.getDate()-Fe.getDay()+1);const pe=new Date(Fe);pe.setDate(Fe.getDate()+6);let He=(await ns(q)).filter(et=>et.type==="dayoff"&&et.date>=le(Fe,"yyyy-MM-dd")&&et.date<=le(pe,"yyyy-MM-dd"));if(e&&(He=He.filter(et=>et.id!==e.id)),He.length>=4)return"Выходные на неделе ограничены максимум 4 днями"}return null},Te=async()=>{if(console.log("handleSave called (DayStatusForm)"),!o&&!a){console.log("No user found"),C("Пользователь не найден");return}if(!E){C("Выберите тип отсутствия");return}if(e&&!o&&a&&e.userId!==a.id){C("Вы можете редактировать только свои статусы"),p(!1);return}const q=we();if(q.length===0){C("Выберите хотя бы одного участника");return}if(R&&w==="range"){if(!j||!y){C("Укажите даты начала и окончания");return}if(new Date(y)<new Date(j)){C("Дата окончания не может быть раньше даты начала");return}}const Ne=oe(E);if(Ne.length===0){C("Выберите даты");return}const Me=async(z,B)=>{if(!o){const Pe=await Ji(E,B.date);if(Pe.restricted)throw new Error(`[${G(z)} • ${le(new Date(B.date),"dd.MM.yyyy")}] ${Pe.reason}`);const Fe=await _e(z,B.date,B.endDate,E);if(Fe)throw new Error(`[${G(z)} • ${le(B.date,"dd.MM.yyyy")}] ${Fe}`)}const je={id:(e==null?void 0:e.id)||"",userId:z,date:B.date,type:E,...B.endDate&&{endDate:B.endDate},...H&&{comment:H}};if(o){const{id:Pe,...Fe}=je;e?await Cs(e.id,Fe):await Eo(Fe)}else await vt({entity:"status",action:e?"update":"create",authorId:(a==null?void 0:a.id)||z,targetUserId:z,before:e||null,after:je,comment:H||void 0})};console.log("Starting save process..."),C(""),p(!0);try{if(e){const z={date:x};E!=="dayoff"&&(D||e.endDate)&&(z.endDate=k),await Me(e.userId,z),n();return}for(const z of q)for(const B of Ne)await Me(z,B);n()}catch(z){console.error("Error saving day status:",z);const B=z.message||z.code||"Ошибка при сохранении";C(B)}finally{p(!1)}},Je={dayoff:"bg-yellow-500",sick:"bg-purple-500",vacation:"bg-orange-500",absence:"bg-red-500"},Qe=R&&w==="range"?[`${le(j,"dd.MM")}–${le(y,"dd.MM")}`]:R&&w==="multiple"?O.map(q=>le(q,"dd.MM")):[le(x,"dd.MM")],Z=h.map(q=>G(q)).join(", "),ge=[{label:"Тип",detail:E?E==="dayoff"?"Выходной":E==="sick"?"Больничный":E==="vacation"?"Отпуск":"Прогул":"Не выбран",done:!!E,anchor:"#type"},{label:"Members",detail:Z||"Не выбрано",done:h.length>0||!!e,anchor:"#members"},{label:"Даты",detail:Qe.slice(0,2).join(" · "),done:Qe.length>0,anchor:"#dates"},{label:"Комментарий",detail:H?"Заполнен":"Необязателен",done:!!H,anchor:"#notes"}],ye=Math.round(ge.filter(q=>q.done).length/ge.length*100),de=[{value:"single",label:"Один день",hint:"Быстрая отметка",icon:"•"},{value:"range",label:E==="dayoff"?"Диапазон (каждый день)":"Диапазон дат",hint:"Поток дней",icon:"⎯⎯"},{value:"multiple",label:"Конкретные даты",hint:"Точечный выбор",icon:"◎"}],Ve=E?`${e?"Редактировать":"Добавить"} ${{dayoff:"выходной",sick:"больничный",vacation:"отпуск",absence:"прогул"}[E]}`:"Добавить отсутствие";return r.jsx("div",{className:"fixed inset-0 bg-slate-950/80 backdrop-blur-xl flex items-start sm:items-center justify-center z-[70] p-4 sm:p-6 touch-manipulation overflow-y-auto overscroll-contain modal-scroll",children:r.jsx("div",{className:`w-full max-w-[52rem] rounded-3xl shadow-[0_28px_80px_rgba(0,0,0,0.55)] border ${i==="dark"?"bg-[#0b1222] border-white/10":"bg-white border-slate-200"} max-h-[85dvh] sm:max-h-[calc(100dvh-96px)] overflow-y-auto relative`,children:r.jsxs("div",{className:"relative p-4 sm:p-6 lg:p-7 flex flex-col h-full min-h-0 overflow-y-auto modal-scroll",children:[r.jsxs("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-start sm:justify-between",children:[r.jsxs("div",{className:"space-y-2",children:[r.jsx("h3",{className:`text-2xl sm:text-3xl font-bold ${c}`,children:Ve}),r.jsx("div",{className:"flex flex-wrap gap-2",children:ge.map((q,Ne)=>r.jsxs("a",{href:q.anchor,className:`inline-flex items-center gap-2 px-3 py-1.5 rounded-full border text-xs transition ${q.done?"bg-[#4E6E49] border-[#4E6E49] text-white shadow-sm":i==="dark"?"border-white/15 bg-white/5 text-gray-200 hover:border-white/30":"border-slate-200 bg-white text-gray-700 hover:border-slate-300"}`,children:[r.jsx("span",{className:"font-semibold",children:Ne+1}),r.jsx("span",{className:"whitespace-nowrap",children:q.label})]},q.label))}),s==="dayoff"&&r.jsx("div",{className:"flex flex-wrap gap-2 text-xs sm:text-sm",children:["Один выходной","Диапазон дней","Несколько дат"].map(q=>r.jsx("span",{className:`px-3 py-1.5 rounded-full border ${i==="dark"?"border-white/10 text-gray-200 bg-white/5":"border-slate-200 text-gray-700 bg-slate-50"}`,children:q},q))})]}),r.jsx("button",{onClick:t,className:`p-2.5 rounded-full border shadow-sm transition hover:-translate-y-0.5 active:translate-y-0 ${i==="dark"?"border-white/10 text-gray-200 hover:bg-white/5":"border-slate-200 text-slate-600 hover:bg-slate-100"}`,children:r.jsx(Pt,{className:"w-5 h-5"})})]}),r.jsx("div",{className:`mt-5 rounded-2xl border ${i==="dark"?"border-white/10 bg-white/5":"border-slate-200 bg-white"} p-4 sm:p-5 shadow-inner`,children:r.jsxs("div",{className:"grid md:grid-cols-3 gap-3 md:gap-4",children:[r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx("div",{className:"h-10 w-10 rounded-2xl bg-gradient-to-br from-emerald-500/20 to-emerald-400/10 flex items-center justify-center text-emerald-600 dark:text-emerald-300 text-lg font-semibold border border-emerald-500/30",children:"👥"}),r.jsxs("div",{children:[r.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Members"}),r.jsx("p",{className:"text-sm font-semibold text-gray-900 dark:text-gray-100 line-clamp-2",children:Z||"Не выбрано"})]})]}),r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx("div",{className:"h-10 w-10 rounded-2xl bg-gradient-to-br from-blue-500/20 to-indigo-500/10 flex items-center justify-center text-blue-600 dark:text-blue-300 text-lg font-semibold border border-blue-500/30",children:"📅"}),r.jsxs("div",{children:[r.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Даты"}),r.jsx("p",{className:"text-sm font-semibold text-gray-900 dark:text-gray-100 line-clamp-2",children:Qe.length>0?Qe.join(" · "):"Не выбрано"})]})]}),r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx("div",{className:"h-10 w-10 rounded-2xl bg-gradient-to-br from-amber-500/20 to-orange-500/10 flex items-center justify-center text-amber-600 dark:text-amber-300 text-lg font-semibold border border-amber-500/30",children:"✏️"}),r.jsxs("div",{children:[r.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Комментарий"}),r.jsx("p",{className:"text-sm font-semibold text-gray-900 dark:text-gray-100 line-clamp-2",children:H||"Необязателен"})]})]})]})}),r.jsxs("div",{className:"mt-5 grid lg:grid-cols-[0.9fr_1.4fr] gap-4 lg:gap-6 flex-1 overflow-hidden",children:[r.jsxs("aside",{className:`rounded-2xl border ${i==="dark"?"border-white/10 bg-white/5":"border-slate-200 bg-white"} p-4 sm:p-5 space-y-4 sticky top-2 self-start max-h-full overflow-y-auto`,children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsx("p",{className:"text-sm font-semibold",children:"Навигация"}),r.jsxs("span",{className:"text-[11px] uppercase tracking-wide text-[#4E6E49] font-semibold",children:[ge.length," шага"]})]}),r.jsx("div",{className:"h-1.5 rounded-full bg-slate-200 dark:bg-white/10 overflow-hidden",children:r.jsx("div",{className:"h-full rounded-full bg-gradient-to-r from-[#4E6E49] via-emerald-500 to-lime-400 transition-all",style:{width:`${ye}%`}})}),r.jsx("div",{className:"space-y-2",children:ge.map((q,Ne)=>r.jsxs("a",{href:q.anchor,className:`flex items-start gap-3 rounded-xl border px-3 py-3 transition ${i==="dark"?"border-white/10 bg-white/5 hover:border-white/30":"border-slate-200 bg-slate-50 hover:border-slate-300"}`,children:[r.jsx("span",{className:`mt-0.5 inline-flex h-7 w-7 items-center justify-center rounded-full text-xs font-bold ${q.done?"bg-[#4E6E49] text-white shadow-sm":i==="dark"?"bg-slate-800 text-gray-300":"bg-slate-200 text-slate-700"}`,children:Ne+1}),r.jsxs("div",{className:"flex-1 min-w-0",children:[r.jsx("p",{className:"text-sm font-semibold",children:q.label}),r.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 truncate",children:q.detail||"—"})]}),r.jsx("span",{className:"text-[11px] text-gray-400",children:q.done?"✓":""})]},q.label))})]}),r.jsxs("div",{className:"space-y-5 overflow-y-auto overscroll-contain pr-1 pb-6 flex-1 min-h-0",children:[!e&&!s&&r.jsxs("div",{id:"type",className:"scroll-mt-20 space-y-2",children:[r.jsx("p",{className:`text-xs sm:text-sm font-medium ${i==="dark"?"text-gray-300":"text-gray-700"}`,children:"Тип отсутствия"}),r.jsx("div",{className:"grid sm:grid-cols-3 gap-2",children:[{key:"dayoff",label:"Выходной",icon:"🌙"},{key:"sick",label:"Больничный",icon:"🏥"},{key:"vacation",label:"Отпуск",icon:"✈️"},...o?[{key:"absence",label:"Прогул",icon:"🚫"}]:[]].map(q=>r.jsxs("button",{type:"button",onClick:()=>M(q.key),className:`px-4 py-3 rounded-xl border text-sm font-semibold transition ${E===q.key?"border-[#4E6E49] bg-[#4E6E49]/10 text-[#4E6E49] shadow-sm":i==="dark"?"border-white/10 bg-white/5 text-gray-200 hover:border-white/30":"border-slate-200 bg-white text-gray-800 hover:border-slate-300"}`,children:[r.jsx("span",{className:"text-lg",children:q.icon}),r.jsx("span",{className:"block mt-1",children:q.label})]},q.key))})]}),R&&r.jsxs("div",{id:"members",className:"scroll-mt-20",children:[r.jsx("label",{className:`block text-xs sm:text-sm font-medium mb-2 ${i==="dark"?"text-gray-300":"text-gray-700"}`,children:"Members"}),r.jsxs("div",{className:"space-y-3 rounded-2xl border border-dashed border-[#4E6E49]/30 p-3 sm:p-4 bg-[#4E6E49]/5 dark:bg-[#4E6E49]/10",children:[r.jsx("div",{className:"flex flex-wrap gap-2",children:De.map(q=>{const Ne=h.includes(q.id);return r.jsxs("label",{className:`px-3 py-1.5 rounded-full border cursor-pointer text-sm flex items-center gap-2 transition ${Ne?"bg-[#4E6E49] border-[#4E6E49] text-white shadow-sm":i==="dark"?"bg-gray-800/60 border-gray-800 text-gray-200 hover:border-gray-600":"bg-gray-100 border-gray-300 text-gray-700 hover:border-gray-400"}`,children:[r.jsx("input",{type:"checkbox",checked:Ne,onChange:()=>U(q.id),className:"hidden"}),gt(q.id)]},q.id)})}),r.jsxs("div",{className:"flex items-center justify-between text-sm",children:[r.jsx("span",{className:`${i==="dark"?"text-gray-300":"text-gray-700"}`,children:"Быстрый выбор"}),r.jsx("button",{type:"button",onClick:Q,className:"text-sm text-[#4E6E49] hover:text-[#4E6E49] font-semibold",children:h.length===De.length?"Снять выделение":"Выбрать всех"})]})]})]}),R&&r.jsxs("div",{id:"dates",className:"scroll-mt-20",children:[r.jsx("p",{className:`text-xs sm:text-sm font-medium mb-2 ${i==="dark"?"text-gray-300":"text-gray-700"}`,children:"Формат выбора дат"}),r.jsx("div",{className:"grid sm:grid-cols-3 gap-2",children:de.map(q=>{const Ne=w===q.value;return r.jsxs("button",{type:"button",onClick:()=>N(q.value),className:`w-full text-left px-3 py-3 rounded-xl border transition flex flex-col gap-1 ${Ne?"border-[#4E6E49] bg-[#4E6E49]/10 text-[#4E6E49] shadow-sm":i==="dark"?"border-white/10 bg-white/5 text-gray-200 hover:border-white/30":"border-slate-200 bg-white text-gray-800 hover:border-slate-300"}`,children:[r.jsx("span",{className:"text-lg leading-none",children:q.icon}),r.jsx("span",{className:"text-sm font-semibold",children:q.label}),r.jsx("span",{className:"text-[11px] text-gray-500 dark:text-gray-400",children:q.hint})]},q.value)})})]}),!R&&s==="dayoff"&&r.jsxs("div",{id:"dates",className:"scroll-mt-20",children:[r.jsx("p",{className:`text-xs sm:text-sm font-medium mb-2 ${i==="dark"?"text-gray-300":"text-gray-700"}`,children:"Формат выбора дат"}),r.jsx("div",{className:"grid sm:grid-cols-3 gap-2",children:de.map(q=>{const Ne=w===q.value;return r.jsxs("button",{type:"button",onClick:()=>N(q.value),className:`w-full text-left px-3 py-3 rounded-xl border transition flex flex-col gap-1 ${Ne?"border-[#4E6E49] bg-[#4E6E49]/10 text-[#4E6E49] shadow-sm":i==="dark"?"border-white/10 bg-white/5 text-gray-200 hover:border-white/30":"border-slate-200 bg-white text-gray-800 hover:border-slate-300"}`,children:[r.jsx("span",{className:"text-lg leading-none",children:q.icon}),r.jsx("span",{className:"text-sm font-semibold",children:q.label}),r.jsx("span",{className:"text-[11px] text-gray-500 dark:text-gray-400",children:q.hint})]},q.value)})})]}),(!R||w==="single")&&r.jsxs("div",{children:[r.jsx("label",{className:`block text-xs sm:text-sm font-medium mb-2 ${i==="dark"?"text-gray-300":"text-gray-700"}`,children:"Дата начала"}),r.jsx("input",{type:"date",value:x,onChange:q=>f(q.target.value),className:`w-full px-3 sm:px-4 py-2 sm:py-2.5 text-sm sm:text-base rounded-lg border touch-manipulation ${i==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`})]}),R&&w==="range"&&r.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[r.jsxs("div",{children:[r.jsx("label",{className:`block text-xs sm:text-sm font-medium mb-2 ${i==="dark"?"text-gray-300":"text-gray-700"}`,children:"Начало"}),r.jsx("input",{type:"date",value:j,onChange:q=>b(q.target.value),className:`w-full px-3 sm:px-4 py-2 sm:py-2.5 text-sm sm:text-base rounded-lg border touch-manipulation ${i==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`})]}),r.jsxs("div",{children:[r.jsx("label",{className:`block text-xs sm:text-sm font-medium mb-2 ${i==="dark"?"text-gray-300":"text-gray-700"}`,children:"Конец"}),r.jsx("input",{type:"date",value:y,min:j,onChange:q=>re(q.target.value),className:`w-full px-3 sm:px-4 py-2 sm:py-2.5 text-sm sm:text-base rounded-lg border touch-manipulation ${i==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`})]})]}),!R&&s==="dayoff"&&w==="range"&&r.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[r.jsxs("div",{children:[r.jsx("label",{className:`block text-xs sm:text-sm font-medium mb-2 ${i==="dark"?"text-gray-300":"text-gray-700"}`,children:"Начало"}),r.jsx("input",{type:"date",value:j,onChange:q=>b(q.target.value),className:`w-full px-3 sm:px-4 py-2 sm:py-2.5 text-sm sm:text-base rounded-lg border touch-manipulation ${i==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`})]}),r.jsxs("div",{children:[r.jsx("label",{className:`block text-xs sm:text-sm font-medium mb-2 ${i==="dark"?"text-gray-300":"text-gray-700"}`,children:"Конец"}),r.jsx("input",{type:"date",value:y,min:j,onChange:q=>re(q.target.value),className:`w-full px-3 sm:px-4 py-2 sm:py-2.5 text-sm sm:text-base rounded-lg border touch-manipulation ${i==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`})]})]}),R&&w==="multiple"&&r.jsxs("div",{children:[r.jsx("label",{className:`block text-xs sm:text-sm font-medium mb-2 ${i==="dark"?"text-gray-300":"text-gray-700"}`,children:"Выбранные даты"}),r.jsxs("div",{className:"flex flex-col gap-3",children:[r.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[r.jsx("input",{type:"date",value:ue,onChange:q=>W(q.target.value),className:`flex-1 px-3 sm:px-4 py-2 sm:py-2.5 text-sm sm:text-base rounded-lg border touch-manipulation ${i==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`}),r.jsx("button",{type:"button",onClick:$,className:"px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg transition-colors",children:"Добавить"})]}),O.length>0?r.jsx("div",{className:"flex flex-wrap gap-2",children:O.map(q=>r.jsxs("span",{className:"inline-flex items-center gap-2 px-3 py-1.5 rounded-full bg-gray-100 text-gray-800 text-sm",children:[le(q,"dd.MM.yyyy"),r.jsx("button",{type:"button",onClick:()=>ce(q),className:"text-red-500 hover:text-red-600",children:"x"})]},q))}):r.jsx("p",{className:"text-sm text-gray-500",children:"Пока не выбрано ни одной даты"})]})]}),!R&&s==="dayoff"&&w==="multiple"&&r.jsxs("div",{children:[r.jsx("label",{className:`block text-xs sm:text-sm font-medium mb-2 ${i==="dark"?"text-gray-300":"text-gray-700"}`,children:"Выбранные даты"}),r.jsxs("div",{className:"flex flex-col gap-3",children:[r.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[r.jsx("input",{type:"date",value:ue,onChange:q=>W(q.target.value),className:`flex-1 px-3 sm:px-4 py-2 sm:py-2.5 text-sm sm:text-base rounded-lg border touch-manipulation ${i==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`}),r.jsx("button",{type:"button",onClick:$,className:"px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg transition-colors",children:"Добавить"})]}),O.length>0?r.jsx("div",{className:"flex flex-wrap gap-2",children:O.map(q=>r.jsxs("span",{className:"inline-flex items-center gap-2 px-3 py-1.5 rounded-full bg-gray-100 text-gray-800 text-sm",children:[le(q,"dd.MM.yyyy"),r.jsx("button",{type:"button",onClick:()=>ce(q),className:"text-red-500 hover:text-red-600",children:"x"})]},q))}):r.jsx("p",{className:"text-sm text-gray-500",children:"Пока не выбрано ни одной даты"})]})]}),w==="single"&&!R&&E==="dayoff"&&r.jsxs("div",{className:"space-y-3",children:[r.jsxs("div",{className:"rounded-xl border border-gray-200 dark:border-gray-800 p-3 sm:p-4 space-y-3",children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{children:[r.jsx("p",{className:`text-sm sm:text-base font-semibold ${c}`,children:"Повтор на неделю"}),r.jsx("p",{className:`text-xs ${i==="dark"?"text-gray-400":"text-gray-600"}`,children:"Выберите дни текущей недели"})]}),r.jsxs("label",{className:"inline-flex items-center gap-2",children:[r.jsx("input",{type:"checkbox",checked:te,onChange:q=>J(q.target.checked),className:"w-4 h-4"}),r.jsx("span",{className:"text-sm",children:"Активировать"})]})]}),te&&r.jsx("div",{className:"flex flex-wrap gap-2",children:K.map((q,Ne)=>{const Me=fe.includes(Ne);return r.jsx("button",{type:"button",onClick:()=>F(z=>Me?z.filter(B=>B!==Ne):[...z,Ne]),className:`px-3 py-1 rounded-lg border text-sm ${Me?"border-[#4E6E49] bg-[#4E6E49]/10 text-[#4E6E49]":i==="dark"?"border-white/10 bg-white/5 text-gray-200":"border-gray-200 bg-white text-gray-800"}`,children:q},q)})})]}),r.jsxs("div",{className:"rounded-xl border border-gray-200 dark:border-gray-800 p-3 sm:p-4 space-y-3",children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{children:[r.jsx("p",{className:`text-sm sm:text-base font-semibold ${c}`,children:"Повтор по месяцу"}),r.jsx("p",{className:`text-xs ${i==="dark"?"text-gray-400":"text-gray-600"}`,children:"На тот же день недели до конца месяца"})]}),r.jsxs("label",{className:"inline-flex items-center gap-2",children:[r.jsx("input",{type:"checkbox",checked:ne,onChange:q=>V(q.target.checked),className:"w-4 h-4"}),r.jsx("span",{className:"text-sm",children:"Активировать"})]})]}),ne&&r.jsx("div",{className:"flex flex-wrap gap-2",children:K.map((q,Ne)=>r.jsx("span",{className:`px-3 py-1 rounded-lg border text-sm ${X.includes(Ne)?"border-[#4E6E49] bg-[#4E6E49]/10 text-[#4E6E49]":i==="dark"?"border-white/10 bg-white/5 text-gray-200":"border-gray-200 bg-white text-gray-800"}`,children:q},q))})]})]}),(E==="sick"||E==="vacation")&&(!R||w==="single")&&r.jsxs("label",{className:"flex items-center gap-2",children:[r.jsx("input",{type:"checkbox",checked:D,onChange:q=>T(q.target.checked),className:"w-4 h-4"}),r.jsx("span",{className:`${i==="dark"?"text-gray-300":"text-gray-700"}`,children:"Несколько дней"})]}),D&&r.jsxs("div",{children:[r.jsx("label",{className:`block text-xs sm:text-sm font-medium mb-2 ${i==="dark"?"text-gray-300":"text-gray-700"}`,children:"Дата окончания"}),r.jsx("input",{type:"date",value:k,onChange:q=>A(q.target.value),min:x,className:`w-full px-3 sm:px-4 py-2 sm:py-2.5 text-sm sm:text-base rounded-lg border touch-manipulation ${i==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`})]}),r.jsxs("div",{children:[r.jsx("label",{className:`block text-xs sm:text-sm font-medium mb-2 ${i==="dark"?"text-gray-300":"text-gray-700"}`,children:"Комментарий"}),r.jsx("textarea",{value:H,onChange:q=>L(q.target.value),rows:3,className:`w-full px-3 sm:px-4 py-2 sm:py-2.5 text-sm sm:text-base rounded-lg border touch-manipulation resize-y ${i==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`,placeholder:"Добавьте комментарий (необязательно)"})]}),ee&&r.jsx("div",{className:"p-3 bg-red-500 text-white rounded-lg text-sm",children:ee}),r.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 sm:gap-3 pt-2",children:[r.jsx("button",{onClick:Te,disabled:v||!E,className:`flex-1 px-4 py-2.5 sm:py-2 ${E?Je[E]:"bg-gray-400"} hover:opacity-90 disabled:opacity-50 disabled:cursor-not-allowed text-white rounded-lg sm:rounded-xl transition-colors text-sm sm:text-base font-medium touch-manipulation active:scale-95 disabled:active:scale-100`,children:v?"Отправка...":o?"Сохранить":"Отправить на согласование"}),r.jsx("button",{onClick:t,className:`px-4 py-2.5 sm:py-2 rounded-lg sm:rounded-xl transition-colors text-sm sm:text-base font-medium touch-manipulation active:scale-95 ${i==="dark"?"bg-gray-700 hover:bg-gray-600 active:bg-gray-500":"bg-gray-200 hover:bg-gray-300 active:bg-gray-400"}`,children:"Отмена"})]})]})]})]})})})},Uj=({onClose:s,onSave:e})=>{const{user:t}=pt(),{theme:n}=at(),{isAdmin:a}=kt(),i=n==="dark"?"text-white":"text-gray-900",[o,c]=I.useState(a?[]:t!=null&&t.id?[t.id]:[]),[d,h]=I.useState("slots"),[m,x]=I.useState(!1),[f,k]=I.useState(!1),[A,D]=I.useState(!1),[T,H]=I.useState([]),[L,E]=I.useState([]),[M,ee]=I.useState(""),[C,v]=I.useState(""),[p,w]=I.useState(""),[N,j]=I.useState(""),[b,y]=I.useState(!1);ms();const re=["Пн","Вт","Ср","Чт","Пт","Сб","Вс"],ue=m?T.length>0?T.map(F=>re[F]).join(", "):"Дни недели":f?L[0]?`${le(L[0],"dd.MM")} +${Math.max(L.length-1,0)}`:"Добавьте даты":A?C&&p?`${le(C,"dd.MM")}–${le(p,"dd.MM")}`:"Укажите диапазон":"Выберите режим",W=o.map(F=>gt(F)).join(", "),O=F=>{c(ne=>ne.includes(F)?ne.filter(V=>V!==F):[...ne,F])},P=(F,ne,V)=>{if(ne&&V.some(Boolean)){j("Снимите галочку с другой функции, чтобы активировать эту");return}F(ne),ne||j("")},te=()=>{if(!M){j("Выберите дату");return}if(L.includes(M)){j("Эта дата уже добавлена");return}E([...L,M].sort()),ee(""),j("")},J=F=>E(L.filter(ne=>ne!==F)),fe=async()=>{if(!a&&!t){j("Пользователь не найден");return}const F=a?o:t?[t.id]:[];if(F.length===0){j("Выберите хотя бы одного участника");return}if(!m&&!f&&!A){j("Выберите способ удаления");return}if(m&&T.length===0){j("Выберите день недели");return}if(f&&L.length===0){j("Добавьте хотя бы одну дату");return}if(A){if(!C||!p){j("Укажите начальную и конечную дату диапазона");return}if(C>p){j("Начальная дата должна быть раньше конечной");return}}j(""),y(!0);try{const ne=await Promise.all(F.map(oe=>fr(oe))),V=await Promise.all(F.map(oe=>ns(oe))),X=ne.flat(),S=V.flat(),R=(oe,_e)=>!C||!p?!1:!((_e||oe)<C||oe>p),K=(oe,_e)=>L.length===0?!1:_e?L.some(Te=>Te>=oe&&Te<=(_e||oe)):L.includes(oe),U=(oe,_e)=>{if(T.length===0)return!1;const Te=[],Je=new Date(oe+"T00:00:00"),Qe=_e?new Date(_e+"T00:00:00"):new Date(oe+"T00:00:00");let Z=Je;for(;Z<=Qe;)Te.push(le(Z,"yyyy-MM-dd")),Z.setDate(Z.getDate()+1);return Te.some(ge=>{const ye=new Date(ge+"T00:00:00"),de=ye.getDay()===0?6:ye.getDay()-1;return T.includes(de)})};let Q=[];if(d==="slots"?Q=X.filter(oe=>!!(m&&U(oe.date)||f&&L.includes(oe.date)||A&&R(oe.date))).map(oe=>oe.id):Q=S.filter(oe=>oe.type!==d?!1:!!(m&&U(oe.date,oe.endDate)||f&&K(oe.date,oe.endDate)||A&&R(oe.date,oe.endDate))).map(oe=>oe.id),Q.length===0){j("Ничего не найдено под выбранные условия"),y(!1);return}const $=F.length>1?`${F.length} участников`:gt(F[0])||"участника",ce=T.map(oe=>re[oe]).join(", "),we=d==="slots"?"слоты":d==="dayoff"?"выходные":d==="sick"?"больничные":d==="vacation"?"отпуска":"прогулы",G=m?`по дням недели (${ce})`:f?`по датам: ${L.map(oe=>le(oe,"dd.MM")).join(", ")}`:`по диапазону ${le(C,"dd.MM")} — ${le(p,"dd.MM")}`;if(!confirm(`Удалить ${we} (${Q.length}) ${G} для ${$}?`)){y(!1);return}if(a)if(d==="slots")for(const oe of Q)await _o(oe);else for(const oe of Q)await Io(oe);else if(d==="slots")for(const oe of Q){const _e=X.find(Te=>Te.id===oe);_e&&await vt({entity:"slot",action:"delete",authorId:(t==null?void 0:t.id)||"",targetUserId:_e.userId,before:_e,after:null,comment:`Удаление слота ${le(_e.date,"dd.MM.yyyy")}`})}else for(const oe of Q){const _e=S.find(Te=>Te.id===oe);_e&&await vt({entity:"status",action:"delete",authorId:(t==null?void 0:t.id)||"",targetUserId:_e.userId,before:_e,after:null,comment:`Удаление ${d==="dayoff"?"выходного":d==="sick"?"больничного":d==="vacation"?"отпуска":"прогула"} ${le(_e.date,"dd.MM.yyyy")}`})}e(),s()}catch(ne){console.error("Error deleting items:",ne),j("Ошибка при удалении")}finally{y(!1)}};return r.jsx("div",{className:"fixed inset-0 bg-slate-950/75 backdrop-blur-xl flex items-start sm:items-center justify-center z-[70] p-4 sm:p-6 overflow-y-auto overscroll-contain modal-scroll",children:r.jsx("div",{className:`w-full max-w-5xl rounded-3xl shadow-[0_24px_80px_rgba(0,0,0,0.45)] border ${n==="dark"?"bg-gradient-to-br from-[#0c1320] via-[#0b1220] to-[#08111b] border-white/10":"bg-gradient-to-br from-white via-slate-50 to-white border-slate-200"} max-h-[85dvh] sm:max-h-[calc(100dvh-96px)] overflow-y-auto`,children:r.jsxs("div",{className:"p-5 sm:p-6 lg:p-7 flex flex-col h-full min-h-0 overflow-y-auto modal-scroll",children:[r.jsxs("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between",children:[r.jsxs("div",{className:"space-y-1",children:[r.jsx("div",{className:"flex items-center gap-2 text-xs font-semibold text-[#4E6E49] tracking-tight",children:r.jsx("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full bg-[#4E6E49]/10 text-[#4E6E49] border border-[#4E6E49]/30",children:"Очистить расписание"})}),r.jsx("h3",{className:`text-2xl sm:text-3xl font-bold ${i}`,children:"Удаление слотов и отсутствий"})]}),r.jsx("button",{onClick:s,className:`p-2.5 rounded-full border ${n==="dark"?"border-white/10 text-gray-200 hover:bg-white/5":"border-slate-200 text-slate-600 hover:bg-slate-100"}`,children:r.jsx(Pt,{className:"w-5 h-5"})})]}),r.jsxs("div",{className:"mt-5 grid lg:grid-cols-[0.95fr_1.45fr] gap-4 lg:gap-6 flex-1 overflow-hidden",children:[r.jsxs("aside",{className:`rounded-2xl border ${n==="dark"?"border-white/10 bg-white/5":"border-slate-200 bg-white"} p-4 sm:p-5 space-y-4 sticky top-0 self-start max-h-full overflow-y-auto`,children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsx("p",{className:"text-sm font-semibold",children:"Навигация"}),r.jsx("span",{className:"text-[11px] uppercase tracking-wide text-[#4E6E49] font-semibold",children:"3 шага"})]}),r.jsx("div",{className:"space-y-2",children:[{label:"Участники",detail:W||"Не выбрано",done:o.length>0||!a},{label:"Тип удаления",detail:d==="slots"?"Слоты":d==="dayoff"?"Выходные":d==="sick"?"Больничные":d==="vacation"?"Отпуска":"Прогулы",done:!0},{label:"Режим",detail:ue,done:ue!=="Выберите режим"}].map((F,ne)=>r.jsxs("div",{className:`flex items-start gap-3 rounded-xl border px-3 py-3 ${n==="dark"?"border-white/10 bg-white/5":"border-slate-200 bg-slate-50"}`,children:[r.jsx("span",{className:`mt-0.5 inline-flex h-6 w-6 items-center justify-center rounded-full text-xs font-bold ${F.done?"bg-[#4E6E49] text-white":n==="dark"?"bg-slate-800 text-gray-300":"bg-slate-200 text-slate-700"}`,children:ne+1}),r.jsxs("div",{className:"flex-1",children:[r.jsx("p",{className:"text-sm font-semibold",children:F.label}),r.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 truncate",children:F.detail||"—"})]})]},F.label))}),r.jsxs("div",{className:`rounded-xl border px-3 py-3 space-y-2 ${n==="dark"?"border-emerald-900/50 bg-emerald-900/20":"border-emerald-100 bg-emerald-50"}`,children:[r.jsx("p",{className:"text-xs uppercase tracking-wide text-emerald-600 font-semibold",children:"Подсказка"}),r.jsx("p",{className:"text-sm text-emerald-700 dark:text-emerald-200",children:"Один режим за раз: дни недели, конкретные даты или диапазон."})]})]}),r.jsxs("div",{className:"space-y-4 overflow-y-auto overscroll-contain pr-1 pb-6 flex-1 min-h-0",children:[r.jsxs("div",{className:"space-y-2",children:[r.jsx("p",{className:`text-sm font-semibold ${i}`,children:"Что удаляем"}),r.jsx("div",{className:"flex flex-wrap gap-2",children:[{key:"slots",label:"Слоты"},{key:"dayoff",label:"Выходные"},{key:"sick",label:"Больничные"},{key:"vacation",label:"Отпуска"},...a?[{key:"absence",label:"Прогулы"}]:[]].map(F=>r.jsx("button",{onClick:()=>h(F.key),className:`px-3 py-1.5 rounded-lg border text-sm ${d===F.key?"bg-red-500 text-white border-red-500":n==="dark"?"bg-gray-700 text-gray-200 border-gray-700 hover:bg-gray-600":"bg-gray-100 text-gray-800 border-gray-200 hover:bg-gray-200"}`,children:F.label},F.key))})]}),a&&r.jsxs("div",{className:"space-y-2",children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsx("p",{className:`text-sm font-semibold ${i}`,children:"Участники"}),r.jsx("button",{onClick:()=>c(F=>F.length===De.length?[]:De.map(ne=>ne.id)),className:"text-xs text-[#4E6E49] font-semibold",children:o.length===De.length?"Снять выделение":"Выбрать всех"})]}),r.jsx("div",{className:"flex flex-wrap gap-2",children:De.map(F=>{const ne=o.includes(F.id);return r.jsx("button",{onClick:()=>O(F.id),className:`px-3 py-1.5 rounded-lg transition-colors text-sm ${ne?"bg-red-500 text-white":n==="dark"?"bg-gray-700 text-gray-300 hover:bg-gray-600":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:gt(F.id)},F.id)})})]}),r.jsxs("label",{className:"flex items-center gap-2",children:[r.jsx("input",{type:"checkbox",checked:m,onChange:F=>P(x,F.target.checked,[f,A]),className:"w-4 h-4"}),r.jsx("span",{className:`${n==="dark"?"text-gray-300":"text-gray-700"}`,children:"Удалить по дню недели"})]}),m&&r.jsxs("div",{className:"ml-6",children:[r.jsx("p",{className:`text-sm mb-2 ${n==="dark"?"text-gray-400":"text-gray-600"}`,children:"Выберите дни недели:"}),r.jsx("div",{className:"flex gap-2 flex-wrap",children:re.map((F,ne)=>{const V=T.includes(ne);return r.jsx("button",{onClick:()=>H(X=>V?X.filter(S=>S!==ne):[...X,ne]),className:`px-3 py-1 rounded-lg transition-colors ${V?"bg-red-500 text-white":n==="dark"?"bg-gray-700 text-gray-300":"bg-gray-200 text-gray-700"}`,children:F},F)})})]}),r.jsxs("label",{className:"flex items-center gap-2",children:[r.jsx("input",{type:"checkbox",checked:f,onChange:F=>P(k,F.target.checked,[m,A]),className:"w-4 h-4"}),r.jsx("span",{className:`${n==="dark"?"text-gray-300":"text-gray-700"}`,children:"Удалить по конкретным датам"})]}),f&&r.jsxs("div",{className:"ml-6 space-y-3",children:[r.jsxs("div",{className:"flex gap-2",children:[r.jsx("input",{type:"date",value:M,onChange:F=>ee(F.target.value),className:`flex-1 px-4 py-2 rounded-lg border ${n==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-red-500`}),r.jsx("button",{onClick:te,className:"px-4 py-2 bg-[#4E6E49] hover:bg-[#4E6E49] text-white rounded-lg transition-colors",children:"Добавить"})]}),L.length>0&&r.jsxs("div",{className:"space-y-2",children:[r.jsxs("p",{className:`text-sm ${n==="dark"?"text-gray-400":"text-gray-600"}`,children:["Выбранные даты (",L.length,"):"]}),r.jsx("div",{className:"flex flex-wrap gap-2",children:L.map(F=>r.jsxs("div",{className:`flex items-center gap-2 px-3 py-1 rounded-lg ${n==="dark"?"bg-gray-700":"bg-gray-100"}`,children:[r.jsx("span",{className:i,children:le(F,"dd.MM.yyyy")}),r.jsx("button",{onClick:()=>J(F),className:"p-1 text-red-500 hover:bg-red-500 hover:text-white rounded transition-colors",children:r.jsx(Pt,{className:"w-3 h-3"})})]},F))})]})]}),r.jsxs("label",{className:"flex items-center gap-2",children:[r.jsx("input",{type:"checkbox",checked:A,onChange:F=>P(D,F.target.checked,[m,f]),className:"w-4 h-4"}),r.jsx("span",{className:`${n==="dark"?"text-gray-300":"text-gray-700"}`,children:"Удалить по диапазону дат"})]}),A&&r.jsxs("div",{className:"ml-6 space-y-3",children:[r.jsxs("div",{className:"flex gap-2",children:[r.jsxs("div",{className:"flex-1",children:[r.jsx("label",{className:`block text-xs mb-1 ${n==="dark"?"text-gray-400":"text-gray-600"}`,children:"Начальная дата"}),r.jsx("input",{type:"date",value:C,onChange:F=>v(F.target.value),className:`w-full px-4 py-2 rounded-lg border ${n==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-red-500`})]}),r.jsxs("div",{className:"flex-1",children:[r.jsx("label",{className:`block text-xs mb-1 ${n==="dark"?"text-gray-400":"text-gray-600"}`,children:"Конечная дата"}),r.jsx("input",{type:"date",value:p,onChange:F=>w(F.target.value),min:C,className:`w-full px-4 py-2 rounded-lg border ${n==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-red-500`})]})]}),C&&p&&r.jsxs("p",{className:`text-sm ${n==="dark"?"text-gray-400":"text-gray-600"}`,children:["Будет удалено: с ",le(C,"dd.MM.yyyy")," по ",le(p,"dd.MM.yyyy")]})]}),N&&r.jsx("div",{className:"p-3 bg-red-500 text-white rounded-lg text-sm",children:N}),r.jsxs("div",{className:"flex gap-3",children:[r.jsxs("button",{onClick:fe,disabled:b||!m&&!f&&!A,className:"flex-1 px-4 py-2 bg-red-500 hover:bg-red-600 disabled:bg-gray-400 disabled:cursor-not-allowed text-white rounded-lg transition-colors flex items-center justify-center gap-2",children:[r.jsx(At,{className:"w-4 h-4"}),b?a?"Удаление...":"Отправка на согласование...":a?"Очистить расписание":"Отправить на согласование"]}),r.jsx("button",{onClick:s,className:`px-4 py-2 rounded-lg transition-colors ${n==="dark"?"bg-gray-700 hover:bg-gray-600":"bg-gray-200 hover:bg-gray-300"}`,children:"Отмена"})]})]})]})]})})})},Bj=({onClose:s,onSave:e})=>{const{user:t}=pt(),{theme:n}=at(),{isAdmin:a}=kt(),i=n==="dark"?"text-white":"text-gray-900",[o,c]=I.useState("all"),[d,h]=I.useState(le(new Date,"yyyy-MM-dd")),[m,x]=I.useState(le(new Date,"yyyy-MM-dd")),[f,k]=I.useState(!1),[A,D]=I.useState(""),[T,H]=I.useState(!1),[L,E]=I.useState(""),[M,ee]=I.useState(""),[C,v]=I.useState(!1),[p,w]=I.useState(!0),[N,j]=I.useState(!1),[b,y]=I.useState([]),[re,ue]=I.useState(!1),[W,O]=I.useState(!1),[P,te]=I.useState(null);ms(),I.useEffect(()=>{f||x(d)},[f,d]),I.useEffect(()=>{J()},[]);const J=async()=>{if(a){ue(!0);try{const S=await Ll();y(S)}catch(S){console.error("Error loading restrictions:",S)}finally{ue(!1)}}},fe=S=>{te(S),c(S.type),h(S.startDate),x(S.endDate||S.startDate),k(!!S.endDate),D(S.startTime||""),H(!!S.startTime),E(S.comment||""),w(S.isActive),j(S.blockFutureDates||!1),O(!0),ee("")},F=async S=>{if(confirm("Вы уверены, что хотите удалить это ограничение?"))try{await sj(S),await J(),ee("")}catch(R){console.error("Error deleting restriction:",R),ee(R.message||"Ошибка при удалении ограничения")}},ne=()=>{te(null),c("all"),h(le(new Date,"yyyy-MM-dd")),x(le(new Date,"yyyy-MM-dd")),k(!1),D(""),H(!1),E(""),w(!0),j(!1),O(!0),ee("")},V={slots:"Слоты",dayoff:"Выходные",sick:"Больничные",vacation:"Отпуска",absence:"Прогулы",all:"Всё"},X=async()=>{if(console.log("handleSave called, isAdmin:",a,"user:",t),!a){ee("Только администратор может управлять ограничениями. Активируйте админ режим на странице входа.");return}if(!d){ee("Выберите дату начала ограничения");return}if(f&&m&&d>m){ee("Дата окончания должна быть позже даты начала");return}try{const S=await Ll(!0),R=P==null?void 0:P.id;if(S.some(U=>{if(U.id===R)return!1;const Q=new Date(U.startDate),$=U.endDate?new Date(U.endDate):Q,ce=new Date(d),G=!((f&&m?new Date(m):ce)<Q||ce>$),oe=U.type===o||U.type==="all"||o==="all";return G&&oe})){ee("Уже существует пересекающееся ограничение для этого типа/периода");return}}catch(S){console.error("Error checking restrictions:",S)}ee(""),v(!0);try{const S={type:o,startDate:d,...f&&m!==d&&{endDate:m},...T&&A&&{startTime:A},...N&&{blockFutureDates:N},...L&&{comment:L},createdBy:(t==null?void 0:t.id)||"admin",createdAt:(P==null?void 0:P.createdAt)||new Date().toISOString(),isActive:p};P?await rj(P.id,S):await tj(S),await J(),O(!1),e()}catch(S){console.error("Error saving restriction:",S),ee(S.message||"Ошибка при сохранении ограничения")}finally{v(!1)}};return r.jsx("div",{className:"fixed inset-0 bg-slate-950/75 backdrop-blur-xl flex items-start sm:items-center justify-center z-[70] p-4 sm:p-6 touch-manipulation overflow-y-auto",children:r.jsx("div",{className:`w-full max-w-2xl rounded-3xl shadow-[0_24px_80px_rgba(0,0,0,0.45)] border ${n==="dark"?"bg-gradient-to-br from-[#0c1320] via-[#0b1220] to-[#08111b] border-white/10":"bg-gradient-to-br from-white via-slate-50 to-white border-slate-200"} max-h-[90vh] overflow-y-auto`,children:r.jsxs("div",{className:"p-4 sm:p-6 lg:p-7 flex flex-col h-full min-h-0 overflow-y-auto",children:[r.jsxs("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between",children:[r.jsxs("div",{className:"space-y-1",children:[r.jsx("div",{className:"flex items-center gap-2 text-xs font-semibold text-orange-600 tracking-tight",children:r.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full bg-orange-500/10 text-orange-600 border border-orange-500/30",children:[r.jsx($t,{className:"w-3 h-3"}),"Управление ограничениями"]})}),r.jsx("h3",{className:`text-2xl sm:text-3xl font-bold ${i}`,children:"Ограничения для команды"}),r.jsx("p",{className:`text-sm ${n==="dark"?"text-gray-400":"text-gray-600"}`,children:"Запретить участникам создавать определённые записи в указанный период"})]}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsxs("div",{className:`px-3 py-2 rounded-xl border text-xs sm:text-sm ${n==="dark"?"border-white/10 bg-white/5 text-gray-200":"border-slate-200 bg-slate-50 text-slate-700"}`,children:["Админ · Управление ",a?"(активен)":"(не активен)"]}),r.jsx("button",{onClick:s,className:`p-2.5 rounded-full border ${n==="dark"?"border-white/10 text-gray-200 hover:bg-white/5":"border-slate-200 text-slate-600 hover:bg-slate-100"} transition-colors touch-manipulation`,"aria-label":"Закрыть",children:r.jsx(Pt,{className:"w-4 h-4 sm:w-5 sm:h-5"})})]})]}),r.jsxs("div",{className:"mt-5 space-y-6 flex-1 min-h-0",children:[r.jsxs("div",{children:[r.jsxs("div",{className:"flex items-center justify-between mb-4",children:[r.jsx("h4",{className:`text-lg font-semibold ${i}`,children:"Существующие ограничения"}),r.jsxs("div",{className:"flex gap-2",children:[r.jsxs("button",{onClick:ne,className:`flex items-center gap-2 px-3 py-2 rounded-lg text-sm font-medium transition-colors ${W?"bg-orange-500 text-white":n==="dark"?"bg-gray-700 text-gray-200 hover:bg-gray-600":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:[r.jsx(is,{className:"w-4 h-4"}),W?"Создать новое":"Создать ограничение"]}),r.jsxs("button",{onClick:async()=>{const S=le(new Date,"yyyy-MM-dd"),R=await Ji("slots",S,"10:00");alert(`Test result: ${R.restricted?"BLOCKED":"ALLOWED"}
${R.reason||"No restrictions"}`)},className:"flex items-center gap-2 px-3 py-2 rounded-lg text-sm font-medium bg-blue-500 text-white hover:bg-blue-600 transition-colors",children:[r.jsx($t,{className:"w-4 h-4"}),"Тест ограничений"]})]})]}),re?r.jsx("div",{className:`p-6 rounded-xl border ${n==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-gray-50"} text-center`,children:r.jsx("p",{className:n==="dark"?"text-gray-400":"text-gray-600",children:"Загрузка..."})}):b.length===0?r.jsxs("div",{className:`p-6 rounded-xl border ${n==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-gray-50"} text-center`,children:[r.jsx(Lt,{className:`w-8 h-8 mx-auto mb-2 ${n==="dark"?"text-gray-400":"text-gray-500"}`}),r.jsx("p",{className:n==="dark"?"text-gray-400":"text-gray-600",children:"Нет активных ограничений"})]}):r.jsx("div",{className:"space-y-3",children:b.map(S=>r.jsx("div",{className:`p-4 rounded-xl border transition-all ${S.isActive?n==="dark"?"border-orange-500/30 bg-orange-500/5":"border-orange-200 bg-orange-50":n==="dark"?"border-gray-600 bg-gray-800/50":"border-gray-300 bg-gray-100"}`,children:r.jsxs("div",{className:"flex items-start justify-between",children:[r.jsxs("div",{className:"flex-1",children:[r.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[r.jsxs("span",{className:`inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium ${S.isActive?"bg-orange-100 text-orange-800 dark:bg-orange-900/50 dark:text-orange-200":"bg-gray-100 text-gray-600 dark:bg-gray-700 dark:text-gray-400"}`,children:[S.isActive?r.jsx(Lt,{className:"w-3 h-3"}):r.jsx($t,{className:"w-3 h-3"}),V[S.type]]}),!S.isActive&&r.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Неактивно"})]}),r.jsxs("div",{className:"space-y-1 text-sm",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(Tr,{className:"w-4 h-4 text-gray-500"}),r.jsx("span",{className:i,children:S.endDate?`${le(S.startDate,"dd.MM.yyyy")} - ${le(S.endDate,"dd.MM.yyyy")}`:le(S.startDate,"dd.MM.yyyy")})]}),S.startTime&&r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(Sr,{className:"w-4 h-4 text-gray-500"}),r.jsxs("span",{className:n==="dark"?"text-gray-300":"text-gray-700",children:["С ",S.startTime]})]}),S.blockFutureDates&&r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(Lt,{className:"w-4 h-4 text-amber-500"}),r.jsx("span",{className:`text-xs ${n==="dark"?"text-amber-300":"text-amber-700"}`,children:"Блокировка следующего дня после наступления времени ограничения"})]}),S.comment&&r.jsx("div",{className:"text-gray-600 dark:text-gray-400 italic",children:S.comment})]})]}),r.jsxs("div",{className:"flex items-center gap-1 ml-4",children:[r.jsx("button",{onClick:()=>fe(S),className:"p-2 text-blue-500 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded-lg transition-colors",title:"Редактировать",children:r.jsx(Bt,{className:"w-4 h-4"})}),r.jsx("button",{onClick:()=>F(S.id),className:"p-2 text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition-colors",title:"Удалить",children:r.jsx(At,{className:"w-4 h-4"})})]})]})},S.id))})]}),W&&r.jsxs("div",{className:"border-t pt-6",children:[r.jsx("h4",{className:`text-lg font-semibold mb-4 ${i}`,children:P?"Редактировать ограничение":"Создать новое ограничение"}),r.jsxs("div",{children:[r.jsx("label",{className:`block text-xs sm:text-sm font-medium mb-3 ${n==="dark"?"text-gray-300":"text-gray-700"}`,children:"Что запретить"}),r.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-3",children:Object.entries(V).map(([S,R])=>r.jsxs("label",{className:`relative flex items-center gap-3 p-3 rounded-xl border cursor-pointer transition-all ${o===S?"bg-orange-100 text-orange-800 border-orange-200 dark:bg-orange-900/30 dark:text-orange-100 dark:border-orange-800 ring-2 ring-orange-500/50 shadow-lg":n==="dark"?"border-white/10 bg-white/5 text-gray-200 hover:border-white/30":"border-slate-200 bg-white text-gray-800 hover:border-slate-300"}`,children:[r.jsx("input",{type:"radio",value:S,checked:o===S,onChange:K=>c(K.target.value),className:"hidden"}),r.jsx("span",{className:`text-sm font-semibold ${o===S?"text-orange-700 dark:text-orange-200":""}`,children:R})]},S))})]}),r.jsxs("div",{children:[r.jsx("label",{className:`block text-xs sm:text-sm font-medium mb-3 ${n==="dark"?"text-gray-300":"text-gray-700"}`,children:"Период ограничения"}),r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{className:"flex items-center gap-4",children:[r.jsxs("label",{className:"flex items-center gap-2 text-sm cursor-pointer",children:[r.jsx("input",{type:"radio",checked:!f,onChange:()=>k(!1),className:`w-4 h-4 rounded border-2 ${n==="dark"?"border-gray-800 bg-gray-700 checked:bg-[#4E6E49] checked:border-[#4E6E49]":"border-gray-300 bg-white checked:bg-[#4E6E49] checked:border-[#4E6E49]"} focus:ring-2 focus:ring-[#4E6E49] cursor-pointer touch-manipulation`}),r.jsx("span",{className:n==="dark"?"text-gray-200":"text-gray-700",children:"Один день"})]}),r.jsxs("label",{className:"flex items-center gap-2 text-sm cursor-pointer",children:[r.jsx("input",{type:"radio",checked:f,onChange:()=>k(!0),className:`w-4 h-4 rounded border-2 ${n==="dark"?"border-gray-800 bg-gray-700 checked:bg-[#4E6E49] checked:border-[#4E6E49]":"border-gray-300 bg-white checked:bg-[#4E6E49] checked:border-[#4E6E49]"} focus:ring-2 focus:ring-[#4E6E49] cursor-pointer touch-manipulation`}),r.jsx("span",{className:n==="dark"?"text-gray-200":"text-gray-700",children:"Диапазон дат"})]})]}),r.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[r.jsxs("div",{children:[r.jsx("label",{className:`block text-xs sm:text-sm font-medium mb-2 ${n==="dark"?"text-gray-300":"text-gray-700"}`,children:"Дата начала"}),r.jsx("input",{type:"date",value:d,onChange:S=>h(S.target.value),className:`w-full px-3 sm:px-4 py-2 sm:py-2.5 text-sm sm:text-base rounded-lg border touch-manipulation ${n==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`})]}),f&&r.jsxs("div",{children:[r.jsx("label",{className:`block text-xs sm:text-sm font-medium mb-2 ${n==="dark"?"text-gray-300":"text-gray-700"}`,children:"Дата окончания"}),r.jsx("input",{type:"date",value:m,min:d,onChange:S=>x(S.target.value),className:`w-full px-3 sm:px-4 py-2 sm:py-2.5 text-sm sm:text-base rounded-lg border touch-manipulation ${n==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`})]})]})]})]}),r.jsxs("div",{children:[r.jsx("label",{className:`block text-xs sm:text-sm font-medium mb-3 ${n==="dark"?"text-gray-300":"text-gray-700"}`,children:"Временное ограничение"}),r.jsxs("div",{className:"space-y-3",children:[r.jsxs("label",{className:"flex items-center gap-2 text-sm cursor-pointer",children:[r.jsx("input",{type:"checkbox",checked:T,onChange:S=>H(S.target.checked),className:`w-4 h-4 rounded border-2 ${n==="dark"?"border-gray-800 bg-gray-700 checked:bg-[#4E6E49] checked:border-[#4E6E49]":"border-gray-300 bg-white checked:bg-[#4E6E49] checked:border-[#4E6E49]"} focus:ring-2 focus:ring-[#4E6E49] cursor-pointer touch-manipulation`}),r.jsx("span",{className:n==="dark"?"text-gray-200":"text-gray-700",children:"Запретить начиная с определённого времени"})]}),T&&r.jsxs("div",{className:"ml-6",children:[r.jsx("label",{className:`block text-xs sm:text-sm font-medium mb-2 ${n==="dark"?"text-gray-300":"text-gray-700"}`,children:"Время начала ограничения"}),r.jsx("input",{type:"time",value:A,onChange:S=>D(S.target.value),className:`w-full max-w-xs px-3 sm:px-4 py-2 sm:py-2.5 text-sm sm:text-base rounded-lg border touch-manipulation ${n==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`})]})]})]}),r.jsxs("div",{children:[r.jsx("label",{className:`block text-xs sm:text-sm font-medium mb-2 ${n==="dark"?"text-gray-300":"text-gray-700"}`,children:"Комментарий"}),r.jsx("textarea",{value:L,onChange:S=>E(S.target.value),rows:3,className:`w-full px-3 sm:px-4 py-2 sm:py-2.5 text-sm sm:text-base rounded-lg border touch-manipulation resize-y ${n==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`,placeholder:"Причина ограничения (необязательно)"})]}),P&&r.jsx("div",{children:r.jsxs("label",{className:"flex items-center gap-2 text-sm cursor-pointer",children:[r.jsx("input",{type:"checkbox",checked:p,onChange:S=>w(S.target.checked),className:`w-4 h-4 rounded border-2 ${n==="dark"?"border-gray-800 bg-gray-700 checked:bg-[#4E6E49] checked:border-[#4E6E49]":"border-gray-300 bg-white checked:bg-[#4E6E49] checked:border-[#4E6E49]"} focus:ring-2 focus:ring-[#4E6E49] cursor-pointer touch-manipulation`}),r.jsx("span",{className:n==="dark"?"text-gray-200":"text-gray-700",children:"Ограничение активно"})]})}),r.jsxs("div",{children:[r.jsxs("label",{className:"flex items-center gap-2 text-sm cursor-pointer",children:[r.jsx("input",{type:"checkbox",checked:N,onChange:S=>j(S.target.checked),className:`w-4 h-4 rounded border-2 ${n==="dark"?"border-gray-800 bg-gray-700 checked:bg-[#4E6E49] checked:border-[#4E6E49]":"border-gray-300 bg-white checked:bg-[#4E6E49] checked:border-[#4E6E49]"} focus:ring-2 focus:ring-[#4E6E49] cursor-pointer touch-manipulation`}),r.jsx("span",{className:n==="dark"?"text-gray-200":"text-gray-700",children:"После наступления даты/времени ограничения блокировать создание записей только на следующий день"})]}),N&&r.jsx("p",{className:`mt-2 text-xs ${n==="dark"?"text-gray-400":"text-gray-600"}`,children:"Пример: после 14.12 21:00 нельзя будет создавать слоты/отпуска только на 15.12 (следующий день)"})]}),M&&r.jsx("div",{className:"p-3 bg-red-500 text-white rounded-lg text-sm",children:M}),r.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 sm:gap-3 pt-2",children:[r.jsx("button",{onClick:X,disabled:C,className:"flex-1 px-4 py-2.5 sm:py-2 bg-orange-500 hover:bg-orange-600 disabled:bg-gray-400 disabled:cursor-not-allowed text-white rounded-lg sm:rounded-xl transition-colors text-sm sm:text-base font-medium touch-manipulation active:scale-95 disabled:active:scale-100",children:C?"Сохранение...":P?"Сохранить изменения":"Создать ограничение"}),r.jsx("button",{onClick:s,className:`px-4 py-2.5 sm:py-2 rounded-lg sm:rounded-xl transition-colors text-sm sm:text-base font-medium touch-manipulation active:scale-95 ${n==="dark"?"bg-gray-700 hover:bg-gray-600 active:bg-gray-500":"bg-gray-200 hover:bg-gray-300 active:bg-gray-400"}`,children:"Отмена"})]})]})]})]})})})},qj=({onClose:s})=>{const{theme:e}=at(),{user:t}=pt(),{isAdmin:n}=kt();ms();const[a,i]=I.useState([]),[o,c]=I.useState(!0),[d,h]=I.useState(!1),[m,x]=I.useState(""),[f,k]=I.useState(null),[A,D]=I.useState(!1),[T,H]=I.useState({userId:"",restrictedUserId:"",reason:"",isActive:!0});I.useEffect(()=>{L()},[]);const L=async()=>{try{const N=await F0();i(N)}catch(N){console.error("Error loading conflicts:",N)}finally{c(!1)}},E=async N=>{if(N.preventDefault(),!t&&!n){x("Пользователь не найден (необходима авторизация)");return}h(!0),x("");try{const j={...T,createdBy:(t==null?void 0:t.id)||"admin",createdAt:new Date().toISOString()};f?await kh(f.id,j):await kj(j),await L(),v(),D(!1),k(null)}catch(j){console.error("Error saving conflict:",j),x(j.message||"Ошибка при сохранении конфликта")}finally{h(!1)}},M=N=>{k(N),H({userId:N.userId,restrictedUserId:N.restrictedUserId,reason:N.reason||"",isActive:N.isActive}),x(""),D(!0)},ee=async N=>{if(confirm("Удалить конфликт?"))try{await Nj(N),await L()}catch(j){console.error("Error deleting conflict:",j)}},C=async N=>{try{await kh(N.id,{isActive:!N.isActive}),await L()}catch(j){console.error("Error toggling conflict status:",j)}},v=()=>{x(""),H({userId:"",restrictedUserId:"",reason:"",isActive:!0})},p=N=>{const j=De.find(b=>b.id===N);return(j==null?void 0:j.name)||N},w=De.filter(N=>N.id!==T.userId);return o?r.jsx("div",{className:"flex items-center justify-center p-8",children:r.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-4 border-[#4E6E49] border-t-transparent"})}):r.jsx("div",{className:"fixed inset-0 bg-slate-950/75 backdrop-blur-xl flex items-start sm:items-center justify-center z-[70] p-4 overflow-y-auto touch-manipulation",children:r.jsxs("div",{className:`w-full max-w-4xl rounded-3xl shadow-[0_24px_80px_rgba(0,0,0,0.45)] border ${e==="dark"?"bg-gradient-to-br from-[#0c1320] via-[#0b1220] to-[#08111b] border-white/10":"bg-gradient-to-br from-white via-slate-50 to-white border-slate-200"} max-h-[90vh] overflow-hidden flex flex-col`,children:[r.jsx("div",{className:"p-6 border-b border-white/10",children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx("div",{className:"w-10 h-10 rounded-xl flex items-center justify-center bg-red-500/10 text-red-500",children:r.jsx(hl,{className:"w-5 h-5"})}),r.jsxs("div",{children:[r.jsx("h3",{className:`text-xl font-bold ${e==="dark"?"text-white":"text-gray-900"}`,children:"Управление конфликтами пользователей"}),r.jsx("p",{className:`text-sm ${e==="dark"?"text-gray-400":"text-gray-600"}`,children:"Настройте ограничения на совместную работу пользователей"})]})]}),r.jsx("button",{onClick:s,className:`p-2 rounded-full border ${e==="dark"?"border-white/10 text-gray-200 hover:bg-white/5":"border-slate-200 text-slate-600 hover:bg-slate-100"} transition-colors`,children:r.jsx(Pt,{className:"w-5 h-5"})})]})}),r.jsx("div",{className:"flex-1 overflow-y-auto",children:r.jsx("div",{className:"p-6",children:r.jsxs("div",{className:"space-y-6",children:[(A||f)&&r.jsxs("div",{className:`rounded-2xl border p-6 ${e==="dark"?"border-white/10 bg-white/5":"border-slate-200 bg-slate-50"}`,children:[r.jsx("h4",{className:`text-lg font-semibold mb-4 ${e==="dark"?"text-white":"text-gray-900"}`,children:f?"Редактировать конфликт":"Добавить конфликт"}),m&&r.jsxs("div",{className:"mb-4 p-3 rounded-lg bg-red-500/10 border border-red-500/20 flex items-start gap-3",children:[r.jsx(so,{className:"w-5 h-5 text-red-500 shrink-0 mt-0.5"}),r.jsx("p",{className:"text-sm text-red-500",children:m})]}),r.jsxs("form",{onSubmit:E,className:"space-y-4",children:[r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[r.jsxs("div",{children:[r.jsx("label",{className:`block text-sm font-medium mb-2 ${e==="dark"?"text-gray-300":"text-gray-700"}`,children:"Пользователь"}),r.jsxs("select",{value:T.userId,onChange:N=>H(j=>({...j,userId:N.target.value})),className:`w-full px-3 py-2 rounded-lg border ${e==="dark"?"bg-gray-700 border-gray-600 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`,required:!0,children:[r.jsx("option",{value:"",children:"Выберите пользователя"}),De.map(N=>r.jsx("option",{value:N.id,children:N.name},N.id))]})]}),r.jsxs("div",{children:[r.jsx("label",{className:`block text-sm font-medium mb-2 ${e==="dark"?"text-gray-300":"text-gray-700"}`,children:"Запрещено работать с"}),r.jsxs("select",{value:T.restrictedUserId,onChange:N=>H(j=>({...j,restrictedUserId:N.target.value})),className:`w-full px-3 py-2 rounded-lg border ${e==="dark"?"bg-gray-700 border-gray-600 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`,required:!0,children:[r.jsx("option",{value:"",children:"Выберите пользователя"}),w.map(N=>r.jsx("option",{value:N.id,children:N.name},N.id))]})]})]}),r.jsxs("div",{children:[r.jsx("label",{className:`block text-sm font-medium mb-2 ${e==="dark"?"text-gray-300":"text-gray-700"}`,children:"Причина (опционально)"}),r.jsx("textarea",{value:T.reason,onChange:N=>H(j=>({...j,reason:N.target.value})),className:`w-full px-3 py-2 rounded-lg border resize-none ${e==="dark"?"bg-gray-700 border-gray-600 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`,rows:3,placeholder:"Объяснение ограничения..."})]}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("input",{type:"checkbox",id:"isActive",checked:T.isActive,onChange:N=>H(j=>({...j,isActive:N.target.checked})),className:"rounded border-gray-300 text-[#4E6E49] focus:ring-[#4E6E49]"}),r.jsx("label",{htmlFor:"isActive",className:`text-sm ${e==="dark"?"text-gray-300":"text-gray-700"}`,children:"Активно"})]}),r.jsxs("div",{className:"flex gap-3 pt-4",children:[r.jsx("button",{type:"submit",disabled:d,className:"flex-1 px-4 py-2 bg-[#4E6E49] hover:bg-[#4E6E49] text-white rounded-lg transition-colors disabled:opacity-50 flex items-center justify-center gap-2",children:d?r.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-white border-t-transparent"}):r.jsxs(r.Fragment,{children:[r.jsx(Kl,{className:"w-4 h-4"}),f?"Сохранить":"Добавить"]})}),r.jsx("button",{type:"button",onClick:()=>{v(),D(!1),k(null)},className:`px-4 py-2 rounded-lg border ${e==="dark"?"border-gray-600 text-gray-200 hover:bg-gray-700":"border-gray-300 text-gray-700 hover:bg-gray-100"} transition-colors`,children:"Отмена"})]})]})]}),r.jsxs("div",{className:`rounded-2xl border ${e==="dark"?"border-white/10 bg-white/5":"border-slate-200 bg-white"}`,children:[r.jsx("div",{className:"p-6 border-b border-white/10",children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("h4",{className:`text-lg font-semibold ${e==="dark"?"text-white":"text-gray-900"}`,children:["Активные конфликты (",a.filter(N=>N.isActive).length,")"]}),r.jsxs("button",{onClick:()=>{x(""),D(!0)},className:"px-4 py-2 bg-[#4E6E49] hover:bg-[#4E6E49] text-white rounded-lg transition-colors flex items-center gap-2",children:[r.jsx(is,{className:"w-4 h-4"}),"Добавить конфликт"]})]})}),r.jsx("div",{className:"p-6",children:a.length===0?r.jsxs("div",{className:"text-center py-8",children:[r.jsx(hl,{className:`w-12 h-12 mx-auto mb-4 ${e==="dark"?"text-gray-600":"text-gray-400"}`}),r.jsx("p",{className:`text-lg ${e==="dark"?"text-gray-400":"text-gray-600"}`,children:"Нет настроенных конфликтов"})]}):r.jsx("div",{className:"space-y-4",children:a.map(N=>r.jsxs("div",{className:`flex items-center justify-between p-4 rounded-xl border ${N.isActive?e==="dark"?"border-red-500/30 bg-red-500/10":"border-red-200 bg-red-50":e==="dark"?"border-gray-600 bg-gray-700/50":"border-gray-200 bg-gray-50"}`,children:[r.jsxs("div",{className:"flex-1",children:[r.jsxs("div",{className:`font-medium ${e==="dark"?"text-white":"text-gray-900"}`,children:[p(N.userId)," ↔ ",p(N.restrictedUserId)]}),N.reason&&r.jsx("div",{className:`text-sm mt-1 ${e==="dark"?"text-gray-400":"text-gray-600"}`,children:N.reason}),r.jsxs("div",{className:"text-xs mt-1 text-gray-500",children:["Создано: ",new Date(N.createdAt).toLocaleDateString("ru-RU")]})]}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("button",{onClick:()=>C(N),className:`px-3 py-1 rounded-full text-xs font-medium transition-colors ${N.isActive?"bg-red-500 text-white":e==="dark"?"bg-gray-600 text-gray-300":"bg-gray-200 text-gray-700"}`,children:N.isActive?"Активен":"Неактивен"}),r.jsx("button",{onClick:()=>M(N),className:`p-2 rounded-lg ${e==="dark"?"hover:bg-gray-700 text-gray-400":"hover:bg-gray-100 text-gray-600"} transition-colors`,children:r.jsx(Bt,{className:"w-4 h-4"})}),r.jsx("button",{onClick:()=>ee(N.id),className:"p-2 rounded-lg text-red-500 hover:bg-red-500 hover:text-white transition-colors",children:r.jsx(At,{className:"w-4 h-4"})})]})]},N.id))})})]})]})})})]})})},Th=[{value:"all",label:"Весь доступ",description:"Блокировать весь сайт"},{value:"login",label:"Вход в систему",description:"Запретить авторизацию"},{value:"slots",label:"Управление слотами",description:"Блокировать создание/редактирование слотов"},{value:"earnings",label:"Доходы",description:"Блокировать добавление доходов"},{value:"tasks",label:"Задачи",description:"Блокировать управление задачами"},{value:"rating",label:"Рейтинг",description:"Блокировать просмотр рейтинга"},{value:"profile",label:"Профиль",description:"Блокировать редактирование профиля"},{value:"admin",label:"Админ-панель",description:"Блокировать доступ к админке"}],Wj=({onClose:s})=>{const{theme:e}=at(),{user:t}=pt(),{isAdmin:n}=kt();ms();const[a,i]=I.useState([]),[o,c]=I.useState(!0),[d,h]=I.useState(!1),[m,x]=I.useState(""),[f,k]=I.useState(null),[A,D]=I.useState(!1),[T,H]=I.useState({userId:"",reason:"",expiresAt:"",blockFeatures:[],isActive:!0});I.useEffect(()=>{L()},[]);const L=async()=>{try{const b=await Ul();i(b)}catch(b){console.error("Error loading blocks:",b)}finally{c(!1)}},E=async b=>{if(b.preventDefault(),!t&&!n){x("Пользователь не найден (необходима авторизация)");return}h(!0),x("");try{const y={reason:T.reason,blockFeatures:T.blockFeatures,isActive:T.isActive,createdBy:(t==null?void 0:t.id)||"admin",createdAt:new Date().toISOString(),...T.userId?{userId:T.userId}:{},...T.expiresAt?{expiresAt:T.expiresAt}:{}};f?await Zi(f.id,y):await jj(y),await L(),p(),D(!1),k(null)}catch(y){console.error("Error saving block:",y),x(y.message||"Ошибка при сохранении блокировки")}finally{h(!1)}},M=b=>{k(b),H({userId:b.userId||"",reason:b.reason,expiresAt:b.expiresAt||"",blockFeatures:b.blockFeatures,isActive:b.isActive}),x(""),D(!0)},ee=async b=>{if(confirm("Удалить блокировку доступа?"))try{await _j(b),await L()}catch(y){console.error("Error deleting block:",y)}},C=async b=>{try{await Zi(b.id,{isActive:!b.isActive}),await L()}catch(y){console.error("Error toggling block status:",y)}},v=b=>{H(y=>({...y,blockFeatures:y.blockFeatures.includes(b)?y.blockFeatures.filter(re=>re!==b):[...y.blockFeatures,b]}))},p=()=>{x(""),H({userId:"",reason:"",expiresAt:"",blockFeatures:[],isActive:!0})},w=b=>{if(!b)return"Все пользователи";const y=De.find(re=>re.id===b);return(y==null?void 0:y.name)||b},N=b=>{const y=Th.find(re=>re.value===b);return(y==null?void 0:y.label)||b},j=b=>b?new Date(b)<new Date:!1;return o?r.jsx("div",{className:"flex items-center justify-center p-8",children:r.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-4 border-[#4E6E49] border-t-transparent"})}):r.jsx("div",{className:"fixed inset-0 bg-slate-950/75 backdrop-blur-xl flex items-start sm:items-center justify-center z-[70] p-4 overflow-y-auto touch-manipulation",children:r.jsxs("div",{className:`w-full max-w-4xl rounded-3xl shadow-[0_24px_80px_rgba(0,0,0,0.45)] border ${e==="dark"?"bg-gradient-to-br from-[#0c1320] via-[#0b1220] to-[#08111b] border-white/10":"bg-gradient-to-br from-white via-slate-50 to-white border-slate-200"} max-h-[90vh] overflow-hidden flex flex-col`,children:[r.jsx("div",{className:"p-6 border-b border-white/10",children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx("div",{className:"w-10 h-10 rounded-xl flex items-center justify-center bg-red-500/10 text-red-500",children:r.jsx(Yl,{className:"w-5 h-5"})}),r.jsxs("div",{children:[r.jsx("h3",{className:`text-xl font-bold ${e==="dark"?"text-white":"text-gray-900"}`,children:"Управление доступом"}),r.jsx("p",{className:`text-sm ${e==="dark"?"text-gray-400":"text-gray-600"}`,children:"Блокировка доступа к функциям сайта"})]})]}),r.jsx("button",{onClick:s,className:`p-2 rounded-full border ${e==="dark"?"border-white/10 text-gray-200 hover:bg-white/5":"border-slate-200 text-slate-600 hover:bg-slate-100"} transition-colors`,children:r.jsx(Pt,{className:"w-5 h-5"})})]})}),r.jsx("div",{className:"flex-1 overflow-y-auto",children:r.jsx("div",{className:"p-6",children:r.jsxs("div",{className:"space-y-6",children:[(A||f)&&r.jsxs("div",{className:`rounded-2xl border p-6 ${e==="dark"?"border-white/10 bg-white/5":"border-slate-200 bg-slate-50"}`,children:[r.jsx("h4",{className:`text-lg font-semibold mb-4 ${e==="dark"?"text-white":"text-gray-900"}`,children:f?"Редактировать блокировку":"Добавить блокировку"}),m&&r.jsxs("div",{className:"mb-4 p-3 rounded-lg bg-red-500/10 border border-red-500/20 flex items-start gap-3",children:[r.jsx(so,{className:"w-5 h-5 text-red-500 shrink-0 mt-0.5"}),r.jsx("p",{className:"text-sm text-red-500",children:m})]}),r.jsxs("form",{onSubmit:E,className:"space-y-4",children:[r.jsxs("div",{children:[r.jsx("label",{className:`block text-sm font-medium mb-2 ${e==="dark"?"text-gray-300":"text-gray-700"}`,children:"Пользователь (оставьте пустым для блокировки всем)"}),r.jsxs("select",{value:T.userId,onChange:b=>H(y=>({...y,userId:b.target.value})),className:`w-full px-3 py-2 rounded-lg border ${e==="dark"?"bg-gray-700 border-gray-600 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`,children:[r.jsx("option",{value:"",children:"Все пользователи"}),De.map(b=>r.jsx("option",{value:b.id,children:b.name},b.id))]})]}),r.jsxs("div",{children:[r.jsx("label",{className:`block text-sm font-medium mb-2 ${e==="dark"?"text-gray-300":"text-gray-700"}`,children:"Блокируемые функции"}),r.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:Th.map(b=>r.jsxs("label",{className:`flex items-start gap-3 p-3 rounded-lg border cursor-pointer transition-colors ${T.blockFeatures.includes(b.value)?e==="dark"?"border-red-500/50 bg-red-500/10":"border-red-200 bg-red-50":e==="dark"?"border-gray-600 hover:border-gray-500":"border-gray-200 hover:border-gray-300"}`,children:[r.jsx("input",{type:"checkbox",checked:T.blockFeatures.includes(b.value),onChange:()=>v(b.value),className:"mt-0.5 rounded border-gray-300 text-red-500 focus:ring-red-500"}),r.jsxs("div",{className:"flex-1",children:[r.jsx("div",{className:`font-medium text-sm ${e==="dark"?"text-white":"text-gray-900"}`,children:b.label}),r.jsx("div",{className:`text-xs ${e==="dark"?"text-gray-400":"text-gray-600"}`,children:b.description})]})]},b.value))})]}),r.jsxs("div",{children:[r.jsx("label",{className:`block text-sm font-medium mb-2 ${e==="dark"?"text-gray-300":"text-gray-700"}`,children:"Причина блокировки *"}),r.jsx("textarea",{value:T.reason,onChange:b=>H(y=>({...y,reason:b.target.value})),className:`w-full px-3 py-2 rounded-lg border resize-none ${e==="dark"?"bg-gray-700 border-gray-600 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`,rows:3,placeholder:"Объяснение блокировки...",required:!0})]}),r.jsxs("div",{children:[r.jsx("label",{className:`block text-sm font-medium mb-2 ${e==="dark"?"text-gray-300":"text-gray-700"}`,children:"Дата окончания (опционально)"}),r.jsx("input",{type:"datetime-local",value:T.expiresAt,onChange:b=>H(y=>({...y,expiresAt:b.target.value})),className:`w-full px-3 py-2 rounded-lg border ${e==="dark"?"bg-gray-700 border-gray-600 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`})]}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("input",{type:"checkbox",id:"isActive",checked:T.isActive,onChange:b=>H(y=>({...y,isActive:b.target.checked})),className:"rounded border-gray-300 text-red-500 focus:ring-red-500"}),r.jsx("label",{htmlFor:"isActive",className:`text-sm ${e==="dark"?"text-gray-300":"text-gray-700"}`,children:"Активна"})]}),r.jsxs("div",{className:"flex gap-3 pt-4",children:[r.jsx("button",{type:"submit",disabled:d||T.blockFeatures.length===0,className:"flex-1 px-4 py-2 bg-red-500 hover:bg-red-600 text-white rounded-lg transition-colors disabled:opacity-50 flex items-center justify-center gap-2",children:d?r.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-white border-t-transparent"}):r.jsxs(r.Fragment,{children:[r.jsx(Kl,{className:"w-4 h-4"}),f?"Сохранить":"Заблокировать"]})}),r.jsx("button",{type:"button",onClick:()=>{p(),D(!1),k(null)},className:`px-4 py-2 rounded-lg border ${e==="dark"?"border-gray-600 text-gray-200 hover:bg-gray-700":"border-gray-300 text-gray-700 hover:bg-gray-100"} transition-colors`,children:"Отмена"})]})]})]}),r.jsxs("div",{className:`rounded-2xl border ${e==="dark"?"border-white/10 bg-white/5":"border-slate-200 bg-white"}`,children:[r.jsx("div",{className:"p-6 border-b border-white/10",children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("h4",{className:`text-lg font-semibold ${e==="dark"?"text-white":"text-gray-900"}`,children:["Активные блокировки (",a.filter(b=>b.isActive).length,")"]}),r.jsxs("button",{onClick:()=>{x(""),D(!0)},className:"px-4 py-2 bg-red-500 hover:bg-red-600 text-white rounded-lg transition-colors flex items-center gap-2",children:[r.jsx(is,{className:"w-4 h-4"}),"Добавить блокировку"]})]})}),r.jsx("div",{className:"p-6",children:a.length===0?r.jsxs("div",{className:"text-center py-8",children:[r.jsx($t,{className:`w-12 h-12 mx-auto mb-4 ${e==="dark"?"text-gray-600":"text-gray-400"}`}),r.jsx("p",{className:`text-lg ${e==="dark"?"text-gray-400":"text-gray-600"}`,children:"Нет активных блокировок"})]}):r.jsx("div",{className:"space-y-4",children:a.map(b=>r.jsxs("div",{className:`flex items-center justify-between p-4 rounded-xl border ${b.isActive&&!j(b.expiresAt)?e==="dark"?"border-red-500/30 bg-red-500/10":"border-red-200 bg-red-50":e==="dark"?"border-gray-600 bg-gray-700/50":"border-gray-200 bg-gray-50"}`,children:[r.jsxs("div",{className:"flex-1",children:[r.jsx("div",{className:`font-medium ${e==="dark"?"text-white":"text-gray-900"}`,children:w(b.userId)}),r.jsx("div",{className:`text-sm mt-1 ${e==="dark"?"text-gray-400":"text-gray-600"}`,children:b.reason}),r.jsxs("div",{className:"flex items-center gap-4 mt-2",children:[r.jsxs("div",{className:"text-xs text-gray-500",children:["Функции: ",b.blockFeatures.map(y=>N(y)).join(", ")]}),b.expiresAt&&r.jsxs("div",{className:`flex items-center gap-1 text-xs ${j(b.expiresAt)?"text-gray-500":"text-amber-600"}`,children:[r.jsx(Sr,{className:"w-3 h-3"}),j(b.expiresAt)?"Истекла":`До ${new Date(b.expiresAt).toLocaleString("ru-RU")}`]})]})]}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("button",{onClick:()=>C(b),className:`px-3 py-1 rounded-full text-xs font-medium transition-colors ${b.isActive&&!j(b.expiresAt)?"bg-red-500 text-white":e==="dark"?"bg-gray-600 text-gray-300":"bg-gray-200 text-gray-700"}`,children:b.isActive&&!j(b.expiresAt)?"Активна":"Неактивна"}),r.jsx("button",{onClick:()=>M(b),className:`p-2 rounded-lg ${e==="dark"?"hover:bg-gray-700 text-gray-400":"hover:bg-gray-100 text-gray-600"} transition-colors`,children:r.jsx(Bt,{className:"w-4 h-4"})}),r.jsx("button",{onClick:()=>ee(b.id),className:"p-2 rounded-lg text-red-500 hover:bg-red-500 hover:text-white transition-colors",children:r.jsx(At,{className:"w-4 h-4"})})]})]},b.id))})})]})]})})})]})})},zj=()=>{const{theme:s}=at(),{isAdmin:e}=kt(),[t,n]=I.useState("week"),[a,i]=I.useState("all"),[o,c]=I.useState(!1),[d,h]=I.useState(!1),[m,x]=I.useState(!1),[f,k]=I.useState(!1),[A,D]=I.useState(!1),[T,H]=I.useState(!1),[L,E]=I.useState(null),[M,ee]=I.useState(null),[C,v]=I.useState(null),[p,w]=I.useState(null),[N,j]=I.useState(0),[b,y]=I.useState({slotsThisWeek:0,activeMembers:0,upcomingSlots:0,completedSlots:0,recommendedWeek:0,recommendedDay:0,mostActive:"",leastActive:[],remainingSlots:0,todaySlots:0}),[re,ue]=I.useState({nextStart:null,activeEnd:null}),[W,O]=I.useState({nextStart:"—",activeRemaining:"—"});I.useEffect(()=>{F()},[]),I.useEffect(()=>{const ye=(Ve,q)=>{if(!Ve)return"—";const Ne=Ve.getTime()-Date.now();if(Ne<=0)return q?"Слот завершён":"Уже начался";const Me=Math.floor(Ne/6e4),z=Math.floor(Me/(60*24)),B=Math.floor(Me%(60*24)/60),je=Me%60;return z>0?`${z}д ${B}ч`:B>0?`${B}ч ${je}м`:`${Math.max(je,1)}м`},de=()=>{O({nextStart:ye(re.nextStart,!1),activeRemaining:ye(re.activeEnd,!0)})};de();const Ce=setInterval(de,6e4);return()=>clearInterval(Ce)},[re]);const P=ye=>{const de=kr(),Ce=new Date(de);Ce.setHours(0,0,0,0);const Ve=new Date(ye.date);if(Ve.setHours(0,0,0,0),Ve>Ce)return!0;if(Ve.getTime()===Ce.getTime()){const z=kr(),B=z.getHours()*60+z.getMinutes();return ye.slots.some(je=>{if(je.endDate){const Ze=new Date(je.endDate);if(Ze.setHours(0,0,0,0),Ze>Ce)return!0;if(Ze.getTime()===Ce.getTime()){const[He,et]=je.end.split(":").map(Number);return He*60+et>B}return!1}const[Pe,Fe]=je.end.split(":").map(Number);return Pe*60+Fe>B})}const q=kr(),Ne=q.getHours()*60+q.getMinutes();return ye.slots.some(z=>{if(z.endDate){const B=new Date(z.endDate);if(B.setHours(0,0,0,0),B>Ce)return!0;if(B.getTime()===Ce.getTime()){const[je,Pe]=z.end.split(":").map(Number);return je*60+Pe>Ne}return!1}return!1})},te={1:"Dex",2:"Enowk",3:"Xenia",4:"Olenka",5:"Sydney"},J={artyom:"1",adel:"2",kseniya:"3",olga:"4",anastasia:"5"},fe=ye=>{const de=De.find(Ce=>Ce.id===ye)||De.find(Ce=>J[ye]===Ce.id);return te[(de==null?void 0:de.id)||ye]||(de==null?void 0:de.name)||ye},F=async()=>{var ye,de;try{const Ce=new Date,Ve=Kc(Ce),q=le(Ve[0],"yyyy-MM-dd"),Ne=le(Ve[6],"yyyy-MM-dd"),Me=le(Ce,"yyyy-MM-dd"),[z,B]=await Promise.all([fr(),ns()]),je=z.filter(Se=>Se.date>=q&&Se.date<=Ne),Pe=z.filter(Se=>Se.date===Me),Fe=new Set([...je.flatMap(Se=>[Se.userId,...Se.participants||[]]),...B.map(Se=>Se.userId)]),pe=je.filter(P).length,Ze=je.length-pe,He=Math.max(0,15-je.length),et=Math.max(0,3-Pe.length),Ee={};De.forEach(Se=>{Ee[Se.id]=0}),je.forEach(Se=>{new Set([Se.userId,...Se.participants||[]]).forEach(Oe=>{Ee[Oe]!==void 0&&(Ee[Oe]=(Ee[Oe]||0)+1)})});const xt=Object.entries(Ee).sort((Se,Ye)=>Ye[1]-Se[1]),jt=(ye=xt[0])!=null&&ye[1]?fe(xt[0][0]):"Нет данных",_t=Math.min(...Object.values(Ee)),br=Object.entries(Ee).filter(([,Se])=>Se===_t).map(([Se])=>fe(Se)).slice(0,3),er=z.flatMap(Se=>{const Ye=Se.date;return(Se.slots||[]).map(Oe=>{const ze=new Date(`${Ye}T${Oe.start}`);let Be=Oe.endDate?new Date(`${Oe.endDate}T${Oe.end}`):new Date(`${Ye}T${Oe.end}`);if(!Oe.endDate&&Be.getTime()<=ze.getTime()){const rt=new Date(Ye);rt.setDate(rt.getDate()+1),Be=new Date(`${le(rt,"yyyy-MM-dd")}T${Oe.end}`)}return{start:ze,end:Be}})}),ae=er.filter(Se=>Ce>=Se.start&&Ce<=Se.end),se=ae.length?new Date(Math.min(...ae.map(Se=>Se.end.getTime()))):null,Ue=((de=er.filter(Se=>Se.start>Ce).sort((Se,Ye)=>Se.start.getTime()-Ye.start.getTime())[0])==null?void 0:de.start)||null;y({slotsThisWeek:je.length,activeMembers:Fe.size,upcomingSlots:pe,completedSlots:Ze,recommendedWeek:He,recommendedDay:et,mostActive:jt,leastActive:br,remainingSlots:pe,todaySlots:Pe.length}),ue({nextStart:Ue,activeEnd:se})}catch(Ce){console.error("Error loading stats:",Ce)}},ne=()=>{v(null),c(!0)},V=ye=>{v(ye),c(!0)},X=()=>{E(null),w(null),x(!0)},S=ye=>{w(ye),E(ye.type),x(!0)},R=()=>{h(!0)},K=()=>{k(!0)},U=()=>{D(!0)},Q=()=>{H(!0)},$=()=>{c(!1),h(!1),x(!1),k(!1),D(!1),H(!1),E(null),v(null),w(null),F(),j(ye=>ye+1)},ce=s==="dark"?"text-white":"text-gray-900",we=s==="dark"?"text-gray-300":"text-gray-700",G=s==="dark"?"border-[#4E6E49]/30 bg-gradient-to-br from-[#1a1a1a] via-[#1a1a1a] to-[#0A0A0A]":"border-green-200 bg-gradient-to-br from-white via-green-50/30 to-white",oe=`rounded-2xl p-4 sm:p-6 md:p-8 border-2 ${G}`,_e=`rounded-2xl border ${s==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white"}`,Te=s==="dark"?"text-gray-400":"text-gray-600",Je=`rounded-2xl p-4 sm:p-5 border-2 ${G}`,Qe={emerald:{bg:s==="dark"?"bg-emerald-500/10":"bg-emerald-50",text:s==="dark"?"text-emerald-100":"text-emerald-800",border:s==="dark"?"border-emerald-500/30":"border-emerald-200"},purple:{bg:s==="dark"?"bg-purple-500/10":"bg-purple-50",text:s==="dark"?"text-purple-100":"text-purple-800",border:s==="dark"?"border-purple-500/30":"border-purple-200"},amber:{bg:s==="dark"?"bg-amber-500/10":"bg-amber-50",text:s==="dark"?"text-amber-100":"text-amber-800",border:s==="dark"?"border-amber-500/30":"border-amber-200"},slate:{bg:s==="dark"?"bg-gray-500/10":"bg-gray-50",text:s==="dark"?"text-gray-100":"text-gray-800",border:s==="dark"?"border-gray-500/30":"border-gray-200"},blue:{bg:s==="dark"?"bg-blue-500/10":"bg-blue-50",text:s==="dark"?"text-blue-100":"text-blue-800",border:s==="dark"?"border-blue-500/30":"border-blue-200"},green:{bg:s==="dark"?"bg-green-500/10":"bg-green-50",text:s==="dark"?"text-green-100":"text-green-800",border:s==="dark"?"border-green-500/30":"border-green-200"},sky:{bg:s==="dark"?"bg-sky-500/10":"bg-sky-50",text:s==="dark"?"text-sky-100":"text-sky-800",border:s==="dark"?"border-sky-500/30":"border-sky-200"},pink:{bg:s==="dark"?"bg-pink-500/10":"bg-pink-50",text:s==="dark"?"text-pink-100":"text-pink-800",border:s==="dark"?"border-pink-500/30":"border-pink-200"}},Z=ye=>{n(ye)},ge=[{label:"Сколько ещё добавить слотов",value:`${Math.max(b.recommendedDay,0)} в день`,note:`Неделя: ${Math.max(b.recommendedWeek,0)} до цели 15`,icon:r.jsx(Cr,{className:"w-4 h-4"}),tone:"emerald"},{label:"Активные члены",value:b.activeMembers,note:"за неделю",icon:r.jsx(Pn,{className:"w-4 h-4"}),tone:"purple"},{label:"Самый активный член недели",value:b.mostActive||"Нет данных",note:"по слотам",icon:r.jsx(Wl,{className:"w-4 h-4"}),tone:"amber"},{label:"Самые неактивные члены недели",value:b.leastActive.length?b.leastActive.join(", "):"Нет данных",note:"минимум слотов",icon:r.jsx(tx,{className:"w-4 h-4"}),tone:"slate"},{label:"Осталось слотов на неделе",value:b.remainingSlots,note:"предстоящие",icon:r.jsx(gx,{className:"w-4 h-4"}),tone:"blue"},{label:"Завершено слотов на неделе",value:b.completedSlots,note:"факт",icon:r.jsx(pi,{className:"w-4 h-4"}),tone:"green"},{label:"Таймер ближайшего слота",value:W.nextStart,note:"до старта",icon:r.jsx(Ql,{className:"w-4 h-4"}),tone:"sky"},{label:"До окончания активного слота",value:W.activeRemaining,note:"если слот идёт",icon:r.jsx(Sr,{className:"w-4 h-4"}),tone:"pink"}];return r.jsx(mr,{children:r.jsxs("div",{className:"space-y-5 sm:space-y-7",children:[r.jsxs("div",{id:"schedule-overview",className:`relative overflow-hidden ${oe} p-5 sm:p-6 md:p-8 ${s==="dark"?"bg-gradient-to-br from-[#0e1b2c] via-[#0c1827] to-[#0a1420]":"bg-gradient-to-br from-white via-emerald-50/40 to-sky-50"}`,children:[r.jsxs("div",{className:"absolute inset-0 pointer-events-none",children:[r.jsx("div",{className:"absolute -top-32 -left-16 w-80 h-80 bg-gradient-to-br from-[#4E6E49]/18 via-sky-500/8 to-transparent blur-3xl"}),r.jsx("div",{className:"absolute top-0 right-0 w-[26rem] h-[26rem] bg-gradient-to-bl from-sky-400/14 via-emerald-400/12 to-transparent blur-3xl"}),r.jsx("div",{className:"absolute bottom-[-140px] left-14 w-80 h-80 bg-gradient-to-tr from-sky-300/12 via-[#4E6E49]/12 to-transparent blur-3xl"})]}),r.jsx("div",{className:"relative z-10 grid grid-cols-1 gap-5",children:r.jsxs("div",{className:`${_e} backdrop-blur p-4 sm:p-5 space-y-4`,children:[r.jsx("div",{className:"flex flex-col gap-4 sm:gap-5 lg:flex-row lg:items-center lg:justify-between",children:r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx("div",{className:"p-3 rounded-2xl bg-white/80 dark:bg-white/5 border border-white/40 dark:border-white/10 shadow-lg",children:r.jsx(pi,{className:"w-6 h-6 text-[#4E6E49]"})}),r.jsx("div",{className:"flex items-center",children:r.jsxs("h1",{className:`text-xl sm:text-3xl font-extrabold leading-tight ${s==="dark"?"text-white":"text-gray-900"}`,children:[r.jsx("span",{className:"sm:inline hidden",children:"Расписание команды"}),r.jsx("span",{className:"sm:hidden inline",children:"Расписание"})]})})]})}),r.jsx("div",{className:"grid sm:grid-cols-2 lg:grid-cols-4 gap-3",children:ge.map(ye=>{const de=Qe[ye.tone];return r.jsxs("div",{className:`p-4 rounded-xl border-2 ${de.border} ${de.bg} shadow-sm space-y-2`,children:[r.jsxs("div",{className:"flex items-start justify-between gap-3",children:[r.jsx("p",{className:`text-[11px] sm:text-xs font-semibold uppercase tracking-wide ${de.text}`,children:ye.label}),r.jsx("span",{className:`inline-flex items-center gap-1 px-2 py-1 rounded-lg text-[11px] font-semibold border ${de.border} ${de.text} ${s==="dark"?"bg-white/5":"bg-white/80"}`,children:ye.icon})]}),r.jsx("p",{className:`text-lg sm:text-2xl font-extrabold ${ce}`,children:ye.value}),r.jsx("p",{className:`text-xs ${Te}`,children:ye.note})]},ye.label)})})]})})]}),r.jsxs("div",{id:"schedule-actions",className:`${oe} p-4 sm:p-5 space-y-5`,children:[r.jsx("div",{className:"space-y-3",children:r.jsxs("div",{className:"flex flex-wrap items-center gap-3 lg:justify-between",children:[r.jsxs("div",{className:`flex items-center gap-2 rounded-xl border ${s==="dark"?"border-gray-800 bg-gray-900/70":"border-gray-200 bg-gray-50"} px-1.5 py-1 shrink-0`,children:[r.jsxs("button",{onClick:()=>Z("table"),className:`px-3 sm:px-4 py-2 text-sm font-semibold flex items-center gap-2 transition-all rounded-lg ${t==="table"?"bg-[#4E6E49] text-white shadow-lg":s==="dark"?"text-gray-300 hover:bg-gray-800":"text-gray-700 hover:bg-white"}`,children:[r.jsx(Cx,{className:"w-4 h-4"}),"Таблица"]}),r.jsxs("button",{onClick:()=>Z("week"),className:`px-3 sm:px-4 py-2 text-sm font-semibold flex items-center gap-2 transition-all rounded-lg ${t==="week"?"bg-[#4E6E49] text-white shadow-lg":s==="dark"?"text-gray-300 hover:bg-gray-800":"text-gray-700 hover:bg-white"}`,children:[r.jsx(Tr,{className:"w-4 h-4"}),"Неделя"]})]}),r.jsx("div",{className:"flex flex-wrap gap-2 shrink",children:[{key:"all",label:"Все",icon:r.jsx(Tr,{className:"w-4 h-4"})},{key:"upcoming",label:"Предстоящие",icon:r.jsx(Sr,{className:"w-4 h-4"})},{key:"completed",label:"Завершённые",icon:r.jsx(pi,{className:"w-4 h-4"})}].map(ye=>r.jsxs("button",{onClick:()=>i(ye.key),className:`px-3 py-2 rounded-xl text-sm font-semibold flex items-center gap-2 transition-all border ${a===ye.key?"bg-gradient-to-r from-[#4E6E49] to-emerald-600 text-white border-transparent shadow-lg":s==="dark"?"border-gray-800 bg-gray-900/70 text-gray-200 hover:border-[#4E6E49]/40":"border-gray-200 bg-gray-50 text-gray-700 hover:border-[#4E6E49]/40"}`,children:[ye.icon,ye.label]},ye.key))})]})}),r.jsxs("div",{className:`${_e} p-3 sm:p-4 space-y-3`,children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsx("p",{className:`text-sm font-semibold ${ce}`,children:"Действие"}),r.jsx("span",{className:"text-[11px] uppercase tracking-wide text-gray-500 dark:text-gray-400",children:"выбор задачи"})]}),r.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-2",children:[{key:"add-slot",label:"Добавить слот",desc:"Разовое или серия",icon:r.jsx(Qh,{className:"w-5 h-5"}),tone:"bg-emerald-100 text-emerald-800 border-emerald-200 dark:bg-emerald-900/30 dark:text-emerald-100 dark:border-emerald-800",action:ne},{key:"delete-slots",label:"Очистить расписание",desc:"Удалить слоты/статусы",icon:r.jsx(At,{className:"w-5 h-5"}),tone:"bg-rose-100 text-rose-800 border-rose-200 dark:bg-rose-900/30 dark:text-rose-100 dark:border-rose-800",action:R},{key:"absence",label:"Добавить отсутствие",desc:"Выходной, больничный, отпуск",icon:r.jsx(Gl,{className:"w-5 h-5"}),tone:"bg-blue-100 text-blue-800 border-blue-200 dark:bg-blue-900/30 dark:text-blue-100 dark:border-blue-800",action:X},{key:"restriction",label:"Управление ограничениями",desc:"Запретить создание записей",icon:r.jsx($t,{className:"w-5 h-5"}),tone:"bg-orange-100 text-orange-800 border-orange-200 dark:bg-orange-900/30 dark:text-orange-100 dark:border-orange-800",action:K,adminOnly:!0},{key:"conflicts",label:"Конфликты пользователей",desc:"Ограничения совместной работы",icon:r.jsx(hl,{className:"w-5 h-5"}),tone:"bg-red-100 text-red-800 border-red-200 dark:bg-red-900/30 dark:text-red-100 dark:border-red-800",action:U,adminOnly:!0},{key:"access-blocks",label:"Блокировка доступа",desc:"Ограничение функций",icon:r.jsx(Yl,{className:"w-5 h-5"}),tone:"bg-purple-100 text-purple-800 border-purple-200 dark:bg-purple-900/30 dark:text-purple-100 dark:border-purple-800",action:Q,adminOnly:!0}].filter(ye=>!ye.adminOnly||e).map(ye=>r.jsxs("button",{onClick:()=>{ye.action()},className:`text-center rounded-xl border px-3 py-3 transition-all shadow-sm flex flex-col items-center gap-2 h-full ${`${ye.tone} ring-2 ring-[#4E6E49]/50 shadow-lg`}`,children:[r.jsx("span",{className:"p-2 rounded-lg bg-white/30",children:ye.icon}),r.jsxs("span",{className:"flex flex-col whitespace-normal leading-snug gap-0.5 w-full",children:[r.jsx("span",{className:"text-[13px] sm:text-sm font-semibold break-words leading-tight",children:ye.label}),r.jsx("span",{className:"text-[11px] sm:text-xs text-gray-500 dark:text-gray-400 break-words leading-tight",children:ye.desc})]})]},ye.key))})]}),r.jsxs("div",{className:`${_e} p-3 sm:p-4 space-y-2`,children:[r.jsx("p",{className:`text-sm font-semibold ${ce}`,children:"Members"}),r.jsxs("div",{className:"flex gap-2 overflow-x-auto pb-1",children:[r.jsx("button",{onClick:()=>ee(null),className:`px-3 py-2 rounded-xl text-sm font-semibold whitespace-nowrap border transition ${M===null?"bg-gradient-to-r from-[#4E6E49] to-[#4E6E49] text-white border-transparent shadow-lg":s==="dark"?"bg-gray-900/70 border-gray-800 text-gray-200 hover:border-[#4E6E49]/40":"bg-gray-50 border-gray-200 text-gray-700 hover:border-[#4E6E49]/40"}`,children:"Все Members"}),De.map(ye=>r.jsxs("button",{onClick:()=>ee(ye.id),className:`px-3 py-2 rounded-xl text-sm font-semibold whitespace-nowrap border transition flex items-center gap-2 ${M===ye.id?"bg-gradient-to-r from-[#4E6E49] to-[#4E6E49] text-white border-transparent shadow-lg":s==="dark"?"bg-gray-900/70 border-gray-800 text-gray-200 hover:border-[#4E6E49]/40":"bg-gray-50 border-gray-200 text-gray-700 hover:border-[#4E6E49]/40"}`,children:[r.jsx("span",{className:"inline-flex items-center justify-center w-7 h-7 rounded-full bg-gradient-to-br from-[#4E6E49]/30 to-blue-500/30 text-xs font-bold",children:(te[ye.id]||ye.name).charAt(0)}),te[ye.id]||ye.name]},ye.id))]})]})]}),r.jsx("div",{id:"schedule-view",className:Je,children:r.jsxs("div",{className:`${_e} p-4 sm:p-5 flex flex-col gap-4`,children:[r.jsx("div",{className:"flex items-center justify-between flex-wrap gap-2 text-left",children:r.jsxs("div",{className:"text-left",children:[r.jsx("p",{className:`text-sm sm:text-base font-semibold ${ce}`,children:"Расписание"}),r.jsx("p",{className:`text-xs sm:text-sm ${we}`,children:"Слоты и статусы за выбранную неделю"})]})}),t==="table"?r.jsx(Vj,{selectedUserId:M,slotFilter:a,refreshKey:N,onEditSlot:V,onEditStatus:S}):r.jsx(Oj,{selectedUserId:M,slotFilter:a,refreshKey:N,onEditSlot:V,onEditStatus:S})]})}),o&&r.jsx(Lj,{slot:C,onClose:$,onSave:$}),d&&r.jsx(Uj,{onClose:$,onSave:$}),m&&r.jsx(Fj,{type:L||void 0,status:p,onClose:$,onSave:$}),f&&r.jsx(Bj,{onClose:$,onSave:$}),A&&r.jsx(qj,{onClose:()=>D(!1)}),T&&r.jsx(Wj,{onClose:()=>H(!1)})]})})},ra=.45,Hj=({onClose:s,onSave:e,editingEarning:t})=>{var U,Q;const{user:n}=pt(),{isAdmin:a}=kt(),{theme:i}=at(),o=i==="dark"?"text-white":"text-gray-900",c=!!t,[d,h]=I.useState((t==null?void 0:t.date)||le(new Date,"yyyy-MM-dd")),[m,x]=I.useState((t==null?void 0:t.slotId)||""),[f,k]=I.useState((t==null?void 0:t.amount.toString())||""),[A,D]=I.useState(((U=t==null?void 0:t.extraWalletsCount)==null?void 0:U.toString())||""),[T,H]=I.useState(((Q=t==null?void 0:t.extraWalletsAmount)==null?void 0:Q.toString())||""),[L,E]=I.useState((t==null?void 0:t.category)||"memecoins"),[M,ee]=I.useState(t?t.participants.length>1:!1),[C,v]=I.useState(t?t.participants.filter($=>$!==t.userId):[]),[p,w]=I.useState([]),[N,j]=I.useState([]),[b,y]=I.useState(""),[re,ue]=I.useState(!1);ms();const W=($,ce="w-4 h-4")=>{switch($){case"memecoins":return r.jsx(Rn,{className:ce});case"futures":return r.jsx(Ca,{className:ce});case"nft":return r.jsx(Aa,{className:ce});case"spot":return r.jsx(rr,{className:ce});case"polymarket":return r.jsx(zl,{className:ce});case"staking":return r.jsx(Da,{className:ce});default:return r.jsx(nr,{className:ce})}},O=()=>{var $;return c&&t?($=t.participants)!=null&&$.length?t.participants:[t.userId]:a&&!n?C:n?M?Array.from(new Set([n.id,...C])):[n.id]:[]},P=O(),te=P.length,J=te||1,fe=$=>{const ce=parseFloat($.replace(",","."));return Number.isFinite(ce)?ce:0},F=I.useMemo(()=>{const $=fe(f),ce=fe(T),we=Math.max($+ce,0),G=we>0?parseFloat((we*ra).toFixed(2)):0,oe=Math.max(we-G,0),_e=J>0?parseFloat((oe/J).toFixed(2)):0;return{gross:we,pool:G,net:oe,share:_e}},[f,T,J]);I.useEffect(()=>{ne()},[d,n,c]);const ne=async()=>{if(!(!a&&!n&&!c))try{const $=c||a?await fr(void 0,d):await fr(n.id,d),ce=kr(),we=le(ce,"yyyy-MM-dd"),G=c?$:$.filter(oe=>{if(d!==we)return a;const _e=oe.slots[oe.slots.length-1];return fh(_e.end,ce)||a});w(G)}catch($){console.error("Error loading slots:",$)}},V=$=>{C.includes($)?v(C.filter(ce=>ce!==$)):v([...C,$])},X=()=>{const $=fe(f),ce=fe(T),we=parseInt(A||"0",10);if(!$&&!ce)return y("Укажите сумму заработка (основную или по доп. кошелькам)"),null;if($<0||ce<0)return y("Суммы не могут быть отрицательными"),null;if(!L)return y("Выберите сферу заработка"),null;const G=O();if(G.length===0)return y("Выберите хотя бы одного участника"),null;const oe=$+ce;return{id:crypto.randomUUID?crypto.randomUUID():`${Date.now()}-${Math.random()}`,category:L,amount:oe,extraWalletsAmount:ce,extraWalletsCount:Number.isFinite(we)?we:0,participants:G}},S=()=>{y("");const $=X();$&&(j([...N,$]),k(""),H(""),D(""),v([]),ee(!1))},R=$=>{j(ce=>ce.filter(we=>we.id!==$))},K=async()=>{if(!a&&!n&&!c){y("Пользователь не найден");return}y(""),ue(!0);try{if(!m){y("Выберите слот"),ue(!1);return}const $=p.find(G=>G.id===m);if(!$&&!c){y("Выбранный слот не найден"),ue(!1);return}if(!a&&!c){const G=kr(),oe=le(G,"yyyy-MM-dd");if(d!==oe){y("Можно добавить заработок только за сегодня"),ue(!1);return}if($){const _e=$.slots[$.slots.length-1];if(!fh(_e.end,G)){y("Слот еще идет или еще не начат. Можно добавить заработок после 21:00 МСК или после окончания слота"),ue(!1);return}}}const ce=G=>({userId:G.userId,date:d,amount:G.amount,poolAmount:G.poolAmount,slotId:m,category:G.category,participants:G.participants,extraWalletsAmount:G.extraWalletsAmount,extraWalletsCount:G.extraWalletsCount}),we=async(G,oe,_e)=>{a?oe==="update"&&t?await D0(t.id,G):await C0(G):await vt({entity:"earning",action:oe,authorId:(n==null?void 0:n.id)||G.userId,targetUserId:G.userId,before:_e||null,after:{id:(t==null?void 0:t.id)||"",...G}})};if(c&&t){const G=X();if(!G){ue(!1);return}await we(ce({userId:t.userId,amount:G.amount,poolAmount:parseFloat((G.amount*ra).toFixed(2)),category:G.category,participants:G.participants,extraWalletsAmount:G.extraWalletsAmount,extraWalletsCount:G.extraWalletsCount}),"update",t)}else{let G=N;if(G.length===0){const oe=X();if(!oe){ue(!1);return}G=[oe]}for(const oe of G)await we(ce({userId:oe.participants[0],amount:oe.amount,poolAmount:parseFloat((oe.amount*ra).toFixed(2)),category:oe.category,participants:oe.participants,extraWalletsAmount:oe.extraWalletsAmount,extraWalletsCount:oe.extraWalletsCount}),"create")}e()}catch($){console.error("Error saving earnings:",$);const ce=$.message||$.code||"Ошибка при сохранении";y(ce)}finally{ue(!1)}};return r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-start sm:items-center justify-center z-[70] p-4 sm:p-6 touch-manipulation overflow-y-auto overflow-x-hidden overscroll-contain modal-scroll",children:r.jsxs("div",{className:`w-full max-w-[540px] sm:max-w-3xl rounded-2xl sm:rounded-3xl shadow-xl ${i==="dark"?"bg-[#1a1a1a]":"bg-white"} max-h-[85dvh] sm:max-h-[calc(100dvh-96px)] flex flex-col overflow-hidden`,children:[r.jsx("div",{className:"flex-shrink-0 p-4 sm:p-6",children:r.jsxs("div",{className:"flex items-center justify-between mb-4 sm:mb-6",children:[r.jsx("h3",{className:`text-lg sm:text-xl font-bold ${o} pr-2`,children:c?"Редактировать заработок":"Добавить заработок"}),r.jsx("button",{onClick:s,className:`p-1.5 sm:p-2 rounded-lg flex-shrink-0 ${i==="dark"?"hover:bg-gray-700 active:bg-gray-600 text-gray-200":"hover:bg-gray-100 active:bg-gray-200 text-gray-700"} transition-colors touch-manipulation`,"aria-label":"Закрыть",children:r.jsx(Pt,{className:"w-4 h-4 sm:w-5 sm:h-5"})})]})}),r.jsx("div",{className:"flex-1 min-h-0 overflow-y-auto overflow-x-hidden overscroll-contain modal-scroll px-4 sm:px-6",children:r.jsxs("div",{className:"space-y-3 sm:space-y-4 pb-8 min-w-0",children:[r.jsxs("div",{children:[r.jsxs("label",{className:`flex flex-col sm:flex-row sm:items-center sm:justify-between text-xs sm:text-sm font-medium mb-2 gap-1 sm:gap-2 ${i==="dark"?"text-gray-300":"text-gray-700"}`,children:[r.jsx("span",{children:"Дата"}),!a&&!c&&r.jsx("span",{className:"text-[10px] sm:text-xs text-gray-400 whitespace-nowrap",children:"Доступна только текущая дата"})]}),r.jsx("input",{type:"date",value:d,onChange:$=>h($.target.value),disabled:!a&&!c,className:`w-full px-3 sm:px-4 py-2 sm:py-2.5 text-sm sm:text-base rounded-lg border touch-manipulation ${i==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49] disabled:opacity-50 disabled:cursor-not-allowed`}),c&&!a&&r.jsx("p",{className:`mt-1 text-xs ${i==="dark"?"text-gray-400":"text-gray-500"}`,children:"Только администратор может изменить дату"})]}),r.jsxs("div",{children:[r.jsx("label",{className:`block text-xs sm:text-sm font-medium mb-2 ${i==="dark"?"text-gray-300":"text-gray-700"}`,children:"Слот"}),r.jsxs("select",{value:m,onChange:$=>x($.target.value),className:`w-full px-3 sm:px-4 py-2 sm:py-2.5 text-sm sm:text-base rounded-lg border touch-manipulation ${i==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`,children:[r.jsx("option",{value:"",children:"Выберите слот"}),p.map($=>r.jsx("option",{value:$.id,children:$.slots.map(ce=>`${ce.start}-${ce.end}`).join(", ")},$.id)),c&&t&&!p.find($=>$.id===t.slotId)&&r.jsx("option",{value:t.slotId,disabled:!0,children:"[Текущий слот - не найден]"})]}),c&&t&&!p.find($=>$.id===t.slotId)&&r.jsx("p",{className:`mt-1 text-xs ${i==="dark"?"text-gray-400":"text-gray-500"}`,children:"Текущий слот не найден в списке. Выберите другой слот или оставьте текущий."})]}),r.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[r.jsxs("div",{children:[r.jsx("label",{className:`block text-xs sm:text-sm font-medium mb-2 ${i==="dark"?"text-gray-300":"text-gray-700"}`,children:"Сумма заработка (руб.)"}),r.jsx("input",{type:"number",value:f,onChange:$=>k($.target.value),className:`w-full px-3 sm:px-4 py-2 sm:py-2.5 text-sm sm:text-base rounded-lg border touch-manipulation ${i==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`,placeholder:"0",min:"0",step:"100"})]}),r.jsxs("div",{className:"space-y-2",children:[r.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[r.jsxs("div",{children:[r.jsx("label",{className:`block text-xs sm:text-sm font-medium mb-2 ${i==="dark"?"text-gray-300":"text-gray-700"}`,children:"Кол-во доп. кошельков"}),r.jsx("input",{type:"number",value:A,onChange:$=>D($.target.value),className:`w-full px-3 sm:px-4 py-2 sm:py-2.5 text-sm sm:text-base rounded-lg border touch-manipulation ${i==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`,placeholder:"0",min:"0",step:"1"})]}),r.jsxs("div",{children:[r.jsx("label",{className:`block text-xs sm:text-sm font-medium mb-2 ${i==="dark"?"text-gray-300":"text-gray-700"}`,children:"Доп. кошельки (руб.)"}),r.jsx("input",{type:"number",value:T,onChange:$=>H($.target.value),className:`w-full px-3 sm:px-4 py-2 sm:py-2.5 text-sm sm:text-base rounded-lg border touch-manipulation ${i==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`,placeholder:"0",min:"0",step:"100"})]})]}),r.jsx("div",{className:"space-y-1 text-[11px] text-gray-500",children:r.jsx("p",{children:"Общая сумма = основная + доп. кошельки. Пул 45% считается с общей суммы."})})]})]}),r.jsxs("div",{className:"space-y-2",children:[r.jsxs("div",{className:"flex items-center justify-between gap-2",children:[r.jsx("label",{className:`text-xs sm:text-sm font-medium ${i==="dark"?"text-gray-300":"text-gray-700"}`,children:"Сфера заработка"}),r.jsx("span",{className:"text-[10px] sm:text-xs text-gray-400",children:"Влияет на статистику"})]}),r.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-2",children:Object.entries(Ws).map(([$,ce])=>r.jsxs("button",{type:"button",onClick:()=>E($),className:`flex items-center gap-2 px-3 py-2 rounded-lg border text-left transition-all ${L===$?"border-[#4E6E49] bg-[#4E6E49]/10 text-[#4E6E49]":i==="dark"?"border-gray-800 bg-gray-800/60 text-gray-200 hover:border-[#4E6E49]/40":"border-gray-200 bg-white text-gray-800 hover:border-[#4E6E49]/40"}`,children:[r.jsx("span",{className:"p-1.5 rounded-lg bg-gray-100 dark:bg-gray-800/80",children:W($,"w-4 h-4")}),r.jsxs("div",{className:"flex flex-col leading-tight",children:[r.jsx("span",{className:"text-sm font-semibold",children:ce.label}),r.jsx("span",{className:"text-[11px] text-gray-500",children:"45% пул / 55% чистыми"})]})]},$))})]}),r.jsxs(r.Fragment,{children:[r.jsxs("label",{className:"flex items-center gap-2",children:[r.jsx("input",{type:"checkbox",checked:M,onChange:$=>ee($.target.checked),className:"w-4 h-4"}),r.jsx("span",{className:`${i==="dark"?"text-gray-300":"text-gray-700"}`,children:"Отметить несколько участников"})]}),(M||a&&!n)&&r.jsx("div",{className:"ml-0 sm:ml-2 grid grid-cols-2 sm:grid-cols-3 gap-2",children:De.filter($=>!n||$.id!==n.id).map($=>r.jsxs("label",{className:"flex items-center gap-2 rounded-lg px-2 py-1 border border-gray-200 dark:border-gray-800",children:[r.jsx("input",{type:"checkbox",checked:C.includes($.id),onChange:()=>V($.id),className:"w-4 h-4"}),r.jsx("span",{className:i==="dark"?"text-gray-300":"text-gray-700",children:gt($.id)})]},$.id))})]}),r.jsxs("div",{className:`p-4 rounded-xl border ${i==="dark"?"border-gray-800 bg-gray-900/60":"border-gray-200 bg-gray-50"}`,children:[r.jsxs("div",{className:"flex items-center justify-between gap-2 mb-3",children:[r.jsxs("div",{children:[r.jsx("p",{className:`text-xs font-semibold ${i==="dark"?"text-gray-200":"text-gray-800"}`,children:"Авторасчет"}),r.jsx("p",{className:"text-[11px] text-gray-500",children:"Пул 45% + деление между участниками"})]}),r.jsxs("span",{className:"text-[11px] px-2 py-1 rounded-full bg-[#4E6E49]/10 text-[#4E6E49] font-semibold",children:[te||0," участн."]})]}),r.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-2 mb-3",children:[r.jsxs("div",{className:`p-3 rounded-lg ${i==="dark"?"bg-gray-800/70":"bg-white"}`,children:[r.jsx("p",{className:"text-[11px] text-gray-500",children:"Пул (45%)"}),r.jsxs("p",{className:"text-lg font-bold text-purple-500",children:[F.pool.toFixed(2)," ₽"]})]}),r.jsxs("div",{className:`p-3 rounded-lg ${i==="dark"?"bg-gray-800/70":"bg-white"}`,children:[r.jsx("p",{className:"text-[11px] text-gray-500",children:"Чистыми после пула"}),r.jsxs("p",{className:"text-lg font-bold text-emerald-500",children:[F.net.toFixed(2)," ₽"]})]}),r.jsxs("div",{className:`p-3 rounded-lg ${i==="dark"?"bg-gray-800/70":"bg-white"}`,children:[r.jsx("p",{className:"text-[11px] text-gray-500",children:"На каждого"}),r.jsxs("p",{className:"text-lg font-bold text-[#4E6E49]",children:[F.share.toFixed(2)," ₽"]})]})]}),r.jsxs("div",{className:`text-xs ${i==="dark"?"text-gray-400":"text-gray-600"} mb-1`,children:["Отмеченные участники получат по ",F.share.toFixed(2)," ₽"]}),r.jsx("div",{className:"flex flex-wrap gap-2",children:P.length===0?r.jsx("span",{className:"text-xs text-gray-400",children:"Нет выбранных участников"}):P.map($=>r.jsx("span",{className:`px-2.5 py-1 rounded-full text-xs font-semibold border ${i==="dark"?"border-gray-800 bg-gray-800/70 text-gray-100":"border-gray-200 bg-white text-gray-800"}`,children:gt($)},$))})]}),!c&&N.length>0&&r.jsxs("div",{className:`rounded-xl border ${i==="dark"?"border-gray-800 bg-gray-900/70":"border-gray-200 bg-gray-50"} p-3 sm:p-4 space-y-3`,children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsx("p",{className:`text-sm font-semibold ${i==="dark"?"text-gray-200":"text-gray-800"}`,children:"Добавленные записи"}),r.jsxs("span",{className:"text-xs text-gray-500",children:[N.length," шт."]})]}),r.jsx("div",{className:"space-y-2 max-h-64 overflow-y-auto pr-1",children:N.map($=>r.jsxs("div",{className:`flex flex-col sm:flex-row sm:items-center justify-between gap-3 p-3 rounded-lg border ${i==="dark"?"border-gray-800 bg-gray-800/60":"border-gray-200 bg-white"}`,children:[r.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[r.jsx("div",{className:"p-2 rounded-lg bg-gray-100 dark:bg-gray-900/70",children:W($.category,"w-4 h-4")}),r.jsxs("div",{className:"min-w-0",children:[r.jsxs("p",{className:"text-sm font-semibold flex items-center gap-2",children:[Ws[$.category].label,r.jsxs("span",{className:"text-[11px] text-gray-500",children:["(",$.participants.length," уч.)"]})]}),r.jsxs("p",{className:"text-xs text-gray-500 whitespace-normal break-words",children:["Гросс ",$.amount.toFixed(0)," ₽ • Пул ",($.amount*ra).toFixed(0)," ₽ • Чистыми ",($.amount-$.amount*ra).toFixed(0)," ₽"]}),$.extraWalletsAmount>0&&r.jsxs("p",{className:"text-[11px] text-gray-500",children:["Доп. кошельки: ",$.extraWalletsCount," на ",$.extraWalletsAmount.toFixed(0)," ₽"]})]})]}),r.jsx("button",{type:"button",onClick:()=>R($.id),className:`self-start sm:self-center p-2 rounded-lg ${i==="dark"?"hover:bg-gray-700 text-red-400":"hover:bg-gray-100 text-red-600"}`,"aria-label":"Удалить запись",children:r.jsx(At,{className:"w-4 h-4"})})]},$.id))})]}),b&&r.jsx("div",{className:"p-3 bg-red-500 text-white rounded-lg text-sm",children:b}),r.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 sm:gap-3 pt-2",children:[!c&&r.jsxs("button",{type:"button",onClick:S,disabled:re,className:"flex-1 sm:flex-none sm:px-4 px-4 py-2.5 sm:py-2 border border-[#4E6E49] text-[#4E6E49] rounded-lg sm:rounded-xl font-medium flex items-center justify-center gap-2 hover:bg-[#4E6E49]/10 active:scale-95 transition-colors",children:[r.jsx(Qh,{className:"w-4 h-4"}),"Добавить в список"]}),r.jsx("button",{onClick:K,disabled:re,className:"flex-1 px-4 py-2.5 sm:py-2 bg-[#4E6E49] hover:bg-[#4E6E49] disabled:bg-gray-400 disabled:cursor-not-allowed text-white rounded-lg sm:rounded-xl transition-colors text-sm sm:text-base font-medium touch-manipulation active:scale-95 disabled:active:scale-100",children:re?"Сохранение...":c?"Сохранить":"Сохранить все"}),r.jsx("button",{type:"button",onClick:s,className:`flex-1 px-4 py-2.5 sm:py-2 rounded-lg sm:rounded-xl border text-sm sm:text-base font-medium transition-colors touch-manipulation active:scale-95 ${i==="dark"?"border-gray-700 text-gray-200 hover:bg-gray-800":"border-gray-300 text-gray-800 hover:bg-gray-100"}`,children:"Отмена"})]})]})})]})})},Gj=({earnings:s})=>{const{theme:e}=at(),t=.45,n=za(),a=le(n.start,"yyyy-MM-dd"),i=le(n.end,"yyyy-MM-dd"),o=le(new Date(new Date().getFullYear(),new Date().getMonth(),1),"yyyy-MM-dd"),c=le(new Date(new Date().getFullYear(),new Date().getMonth()+1,0),"yyyy-MM-dd"),d=(k,A,D)=>{const T=s.filter(E=>(E.participants&&E.participants.length>0?[...E.participants,E.userId]:[E.userId]).includes(k)&&E.date>=A&&E.date<=D),H=T.reduce((E,M)=>{const ee=M.participants&&M.participants.length>0?M.participants.length:1,C=M.poolAmount||M.amount*t,v=Math.max(M.amount-C,0);return E+v/ee},0),L=T.reduce((E,M)=>{const ee=M.participants&&M.participants.length>0?M.participants.length:1,C=M.poolAmount||M.amount*t;return E+C/ee},0);return{totalEarnings:H,totalPool:L,count:T.length}},h=De.reduce((k,A)=>{const D=d(A.id,a,i);return k+D.totalEarnings},0),m=De.reduce((k,A)=>{const D=d(A.id,a,i);return k+D.totalPool},0),x=De.reduce((k,A)=>{const D=d(A.id,o,c);return k+D.totalEarnings},0),f=De.reduce((k,A)=>{const D=d(A.id,o,c);return k+D.totalPool},0);return r.jsx("div",{className:`rounded-2xl ${e==="dark"?"bg-[#1a1a1a]":"bg-white"} shadow-lg border-2 ${e==="dark"?"border-gray-800":"border-gray-200"} overflow-hidden`,children:r.jsxs("div",{className:"p-6",children:[r.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[r.jsx("div",{className:`p-2 rounded-lg ${e==="dark"?"bg-blue-500/20":"bg-blue-100"}`,children:r.jsx(sr,{className:`w-5 h-5 ${e==="dark"?"text-blue-400":"text-blue-600"}`})}),r.jsx("h3",{className:`text-xl font-bold ${e==="dark"?"text-white":"text-gray-900"}`,children:"Статистика заработка"})]}),r.jsxs("div",{className:"mb-6",children:[r.jsx("h4",{className:`text-lg font-semibold mb-4 px-2 ${e==="dark"?"text-white":"text-gray-900"}`,children:"За неделю"}),r.jsx("div",{className:"overflow-x-auto rounded-xl border-2 border-gray-800/50 dark:border-gray-800",children:r.jsxs("table",{className:"w-full",children:[r.jsx("thead",{children:r.jsxs("tr",{className:`${e==="dark"?"bg-gray-700/50":"bg-gray-100"}`,children:[r.jsx("th",{className:`px-4 py-3 text-left text-sm font-semibold ${e==="dark"?"text-white":"text-gray-900"}`,children:"Участник"}),r.jsx("th",{className:`px-4 py-3 text-right text-sm font-semibold ${e==="dark"?"text-white":"text-gray-900"}`,children:"Чистыми"}),r.jsx("th",{className:`px-4 py-3 text-right text-sm font-semibold ${e==="dark"?"text-white":"text-gray-900"}`,children:"Пул 45%"})]})}),r.jsxs("tbody",{children:[De.map(k=>{const A=d(k.id,a,i);return r.jsxs("tr",{className:`border-b border-gray-800/30 dark:border-gray-800 transition-colors ${e==="dark"?"hover:bg-gray-700/30":"hover:bg-gray-50"}`,children:[r.jsx("td",{className:`px-4 py-3 font-medium ${e==="dark"?"text-white":"text-gray-900"}`,children:gt(k.id)}),r.jsxs("td",{className:"px-4 py-3 text-right font-semibold text-[#4E6E49]",children:[A.totalEarnings.toFixed(2)," ₽"]}),r.jsxs("td",{className:`px-4 py-3 text-right font-semibold ${e==="dark"?"text-purple-400":"text-purple-600"}`,children:[A.totalPool.toFixed(2)," ₽"]})]},k.id)}),r.jsxs("tr",{className:`${e==="dark"?"bg-gray-700/70":"bg-gray-100"} font-bold border-t-2 border-gray-800/50 dark:border-gray-800`,children:[r.jsx("td",{className:`px-4 py-3 ${e==="dark"?"text-white":"text-gray-900"}`,children:"Итого команды"}),r.jsxs("td",{className:"px-4 py-3 text-right text-[#4E6E49]",children:[h.toFixed(2)," ₽"]}),r.jsxs("td",{className:`px-4 py-3 text-right ${e==="dark"?"text-purple-400":"text-purple-600"}`,children:[m.toFixed(2)," ₽"]})]})]})]})})]}),r.jsxs("div",{children:[r.jsx("h4",{className:`text-lg font-semibold mb-4 px-2 ${e==="dark"?"text-white":"text-gray-900"}`,children:"За месяц"}),r.jsx("div",{className:"overflow-x-auto rounded-xl border-2 border-gray-800/50 dark:border-gray-800",children:r.jsxs("table",{className:"w-full",children:[r.jsx("thead",{children:r.jsxs("tr",{className:`${e==="dark"?"bg-gray-700/50":"bg-gray-100"}`,children:[r.jsx("th",{className:`px-4 py-3 text-left text-sm font-semibold ${e==="dark"?"text-white":"text-gray-900"}`,children:"Участник"}),r.jsx("th",{className:`px-4 py-3 text-right text-sm font-semibold ${e==="dark"?"text-white":"text-gray-900"}`,children:"Чистыми"}),r.jsx("th",{className:`px-4 py-3 text-right text-sm font-semibold ${e==="dark"?"text-white":"text-gray-900"}`,children:"Пул 45%"})]})}),r.jsxs("tbody",{children:[De.map(k=>{const A=d(k.id,o,c);return r.jsxs("tr",{className:`border-b border-gray-800/30 dark:border-gray-800 transition-colors ${e==="dark"?"hover:bg-gray-700/30":"hover:bg-gray-50"}`,children:[r.jsx("td",{className:`px-4 py-3 font-medium ${e==="dark"?"text-white":"text-gray-900"}`,children:gt(k.id)}),r.jsxs("td",{className:"px-4 py-3 text-right font-semibold text-[#4E6E49]",children:[A.totalEarnings.toFixed(2)," ₽"]}),r.jsxs("td",{className:`px-4 py-3 text-right font-semibold ${e==="dark"?"text-purple-400":"text-purple-600"}`,children:[A.totalPool.toFixed(2)," ₽"]})]},k.id)}),r.jsxs("tr",{className:`${e==="dark"?"bg-gray-700/70":"bg-gray-100"} font-bold border-t-2 border-gray-800/50 dark:border-gray-800`,children:[r.jsx("td",{className:`px-4 py-3 ${e==="dark"?"text-white":"text-gray-900"}`,children:"Итого команды"}),r.jsxs("td",{className:"px-4 py-3 text-right text-[#4E6E49]",children:[x.toFixed(2)," ₽"]}),r.jsxs("td",{className:`px-4 py-3 text-right ${e==="dark"?"text-purple-400":"text-purple-600"}`,children:[f.toFixed(2)," ₽"]})]})]})]})})]})]})})},Kj=({earnings:s,onEdit:e,onDelete:t})=>{const{theme:n}=at(),{user:a}=pt(),{isAdmin:i}=kt(),[o,c]=I.useState(null),d=.45,h=(E,M="w-4 h-4")=>{switch(E){case"memecoins":return r.jsx(Rn,{className:M});case"futures":return r.jsx(Ca,{className:M});case"nft":return r.jsx(Aa,{className:M});case"spot":return r.jsx(rr,{className:M});case"polymarket":return r.jsx(zl,{className:M});case"staking":return r.jsx(Da,{className:M});default:return r.jsx(nr,{className:M})}},m=async E=>{if(confirm("Вы уверены, что хотите удалить эту запись о заработке?")){c(E.id);try{i?await $0(E.id):await vt({entity:"earning",action:"delete",authorId:(a==null?void 0:a.id)||E.userId,targetUserId:E.userId,before:E,after:null}),t()}catch(M){console.error("Error deleting earnings:",M),alert("Ошибка при удалении записи")}finally{c(null)}}},x=E=>E.participants&&E.participants.length>0?E.participants:[E.userId],f=E=>E.poolAmount||E.amount*d,k=E=>Math.max(E.amount-f(E),0),A=E=>{const M=x(E);return M.length?k(E)/M.length:k(E)},D=E=>Ws[E]||Ws.other,T=E=>gt(E)||E,H=E=>i||E.userId===(a==null?void 0:a.id),L=[...s].sort((E,M)=>M.date.localeCompare(E.date));return L.length===0?r.jsxs("div",{className:`rounded-2xl p-8 text-center border-2 ${n==="dark"?"bg-[#1a1a1a] border-gray-800":"bg-white border-gray-200"} shadow-md`,children:[r.jsx("p",{className:`${n==="dark"?"text-gray-400":"text-gray-600"} text-lg`,children:"Пока нет записей о заработке"}),r.jsx("p",{className:"text-gray-500 text-sm mt-2",children:"Добавьте первую запись, чтобы начать отслеживать доходы команды"})]}):r.jsx("div",{className:`rounded-2xl ${n==="dark"?"bg-[#1a1a1a]":"bg-white"} shadow-lg border-2 ${n==="dark"?"border-gray-800":"border-gray-200"} overflow-hidden`,children:r.jsxs("div",{className:"p-6",children:[r.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[r.jsx("div",{className:`p-2 rounded-lg ${n==="dark"?"bg-blue-500/20":"bg-blue-100"}`,children:r.jsx(Bd,{className:`w-5 h-5 ${n==="dark"?"text-blue-400":"text-blue-600"}`})}),r.jsx("h3",{className:`text-xl font-bold ${n==="dark"?"text-white":"text-gray-900"}`,children:"Все записи о заработке"})]}),r.jsx("div",{className:"overflow-x-auto rounded-xl border-2 border-gray-800/50 dark:border-gray-800",children:r.jsxs("table",{className:"w-full",children:[r.jsx("thead",{children:r.jsxs("tr",{className:`${n==="dark"?"bg-gray-700/50":"bg-gray-100"}`,children:[r.jsx("th",{className:`px-4 py-3 text-left text-sm font-semibold ${n==="dark"?"text-white":"text-gray-900"}`,children:"Дата"}),r.jsx("th",{className:`px-4 py-3 text-left text-sm font-semibold ${n==="dark"?"text-white":"text-gray-900"}`,children:"Сфера"}),r.jsx("th",{className:`px-4 py-3 text-left text-sm font-semibold ${n==="dark"?"text-white":"text-gray-900"}`,children:"Участники"}),r.jsx("th",{className:`px-4 py-3 text-right text-sm font-semibold ${n==="dark"?"text-white":"text-gray-900"}`,children:"Чистыми"}),r.jsx("th",{className:`px-4 py-3 text-right text-sm font-semibold ${n==="dark"?"text-white":"text-gray-900"}`,children:"Пул 45%"}),r.jsx("th",{className:`px-4 py-3 text-center text-sm font-semibold ${n==="dark"?"text-white":"text-gray-900"}`,children:"Действия"})]})}),r.jsx("tbody",{children:L.map(E=>{const M=x(E),ee=D(E.category),C=k(E),v=A(E),p=H(E);return r.jsxs("tr",{className:`border-b border-gray-800/30 dark:border-gray-800 transition-colors ${n==="dark"?"hover:bg-gray-700/30":"hover:bg-gray-50"}`,children:[r.jsx("td",{className:`px-4 py-3 font-medium ${n==="dark"?"text-white":"text-gray-900"}`,children:le(new Date(E.date+"T00:00:00"),"dd.MM.yyyy")}),r.jsx("td",{className:"px-4 py-3",children:r.jsxs("span",{className:`inline-flex items-center gap-2 px-2.5 py-1 rounded-full text-xs font-semibold ${n==="dark"?"bg-gray-800 text-gray-100":"bg-gray-100 text-gray-900"}`,children:[h(E.category,"w-4 h-4"),ee.label]})}),r.jsx("td",{className:"px-4 py-3",children:r.jsx("div",{className:"flex flex-wrap gap-2",children:M.map(w=>r.jsx("span",{className:`px-2.5 py-1 rounded-full text-xs font-semibold border ${n==="dark"?"border-gray-800 bg-gray-800/70 text-gray-100":"border-gray-200 bg-white text-gray-800"}`,children:T(w)},w))})}),r.jsxs("td",{className:"px-4 py-3 text-right font-semibold text-[#4E6E49]",children:[r.jsxs("div",{children:[C.toFixed(2)," ₽"]}),r.jsxs("div",{className:"text-xs text-gray-500",children:["по ",v.toFixed(2)," ₽"]}),E.extraWalletsAmount?r.jsxs("div",{className:"text-[11px] text-gray-500 flex items-center gap-1 mt-1",children:[r.jsx(Ox,{className:"w-3 h-3"}),E.extraWalletsCount||0," / ",E.extraWalletsAmount.toFixed(0)," ₽"]}):null]}),r.jsxs("td",{className:`px-4 py-3 text-right font-semibold ${n==="dark"?"text-purple-400":"text-purple-600"}`,children:[f(E).toFixed(2)," ₽"]}),r.jsx("td",{className:"px-4 py-3 text-center",children:p?r.jsxs("div",{className:"flex items-center justify-center gap-2",children:[r.jsx("button",{onClick:()=>e(E),className:`p-2 rounded-lg transition-colors ${n==="dark"?"hover:bg-gray-600 text-blue-400":"hover:bg-gray-200 text-blue-600"}`,title:"Редактировать",children:r.jsx(Bd,{className:"w-4 h-4"})}),r.jsx("button",{onClick:()=>m(E),disabled:o===E.id,className:`p-2 rounded-lg transition-colors ${n==="dark"?"hover:bg-gray-600 text-red-400":"hover:bg-gray-200 text-red-600"} disabled:opacity-50 disabled:cursor-not-allowed`,title:"Удалить",children:r.jsx(At,{className:"w-4 h-4"})})]}):r.jsx("span",{className:`text-sm ${n==="dark"?"text-gray-500":"text-gray-400"}`,children:"—"})})]},E.id)})})]})})]})})},Yj=()=>{const{theme:s}=at(),[e,t]=I.useState(!1),[n,a]=I.useState(null),[i,o]=I.useState([]),[c,d]=I.useState(!0),[h,m]=I.useState({weekTotal:0,weekPool:0,weekNet:0,monthTotal:0,monthPool:0,monthNet:0}),x=.45,f=Object.keys(Ws),k=s==="dark"?"bg-[#1a1a1a]":"bg-white",A=b=>b.poolAmount||b.amount*x,D=b=>Math.max(b.amount-A(b),0),T=b=>{var y;return(y=b.participants)!=null&&y.length?b.participants:[b.userId]},H=b=>gt(b)||b,L=(b,y="w-4 h-4")=>{switch(b){case"memecoins":return r.jsx(Rn,{className:y});case"futures":return r.jsx(Ca,{className:y});case"nft":return r.jsx(Aa,{className:y});case"spot":return r.jsx(rr,{className:y});case"polymarket":return r.jsx(zl,{className:y});case"staking":return r.jsx(Da,{className:y});default:return r.jsx(nr,{className:y})}},E=()=>{const b=za(),y=le(b.start,"yyyy-MM-dd"),re=le(b.end,"yyyy-MM-dd"),ue=le(new Date(new Date().getFullYear(),new Date().getMonth(),1),"yyyy-MM-dd"),W=le(new Date(new Date().getFullYear(),new Date().getMonth()+1,0),"yyyy-MM-dd"),O=i.filter(te=>te.date>=y&&te.date<=re),P=i.filter(te=>te.date>=ue&&te.date<=W);m({weekTotal:O.reduce((te,J)=>te+J.amount,0),weekPool:O.reduce((te,J)=>te+A(J),0),weekNet:O.reduce((te,J)=>te+D(J),0),monthTotal:P.reduce((te,J)=>te+J.amount,0),monthPool:P.reduce((te,J)=>te+A(J),0),monthNet:P.reduce((te,J)=>te+D(J),0)})};I.useEffect(()=>{M()},[]),I.useEffect(()=>{E()},[i]),I.useEffect(()=>{const b=async y=>{const re=y,{userId:ue}=re.detail||{};if(ue)await ss(ue);else for(const W of De)await ss(W.id);o(W=>[...W])};return window.addEventListener("nicknameUpdated",b),()=>{window.removeEventListener("nicknameUpdated",b)}},[]);const M=async()=>{d(!0);try{const b=await Ea();o(b)}catch(b){console.error("Error loading earnings:",b)}finally{d(!1)}},ee=b=>{a(b),t(!0)},C=()=>{t(!1),a(null)},v=()=>{t(!1),a(null),M()},p=f.map(b=>{const y=i.filter(te=>te.category===b),re=y.reduce((te,J)=>te+J.amount,0),ue=y.reduce((te,J)=>te+A(J),0),W=y.reduce((te,J)=>te+D(J),0),O=new Map;y.forEach(te=>{const J=T(te),fe=D(te)/Math.max(J.length,1);J.forEach(F=>{O.set(F,(O.get(F)||0)+fe)})});const P=Array.from(O.entries()).sort((te,J)=>J[1]-te[1]).slice(0,2);return{key:b,gross:re,pool:ue,net:W,count:y.length,topParticipants:P}}),w=De.map(b=>{const y=i.filter(W=>T(W).includes(b.id)),re=y.reduce((W,O)=>{const P=D(O)/Math.max(T(O).length,1);return W+P},0),ue=y.reduce((W,O)=>{const P=A(O)/Math.max(T(O).length,1);return W+P},0);return{...b,net:re,poolShare:ue}}).sort((b,y)=>y.net-b.net),N=[...p].sort((b,y)=>y.net-b.net)[0],j=w[0];return r.jsx(mr,{children:r.jsxs("div",{className:"space-y-6",children:[r.jsxs("div",{className:`rounded-xl sm:rounded-2xl p-4 sm:p-6 md:p-8 ${k} shadow-xl border-2 ${s==="dark"?"border-[#4E6E49]/30 bg-gradient-to-br from-[#1a1a1a] via-[#1a1a1a] to-[#0A0A0A]":"border-green-200 bg-gradient-to-br from-white via-green-50/30 to-white"} relative overflow-hidden`,children:[r.jsx("div",{className:"absolute top-0 right-0 w-32 h-32 sm:w-64 sm:h-64 bg-gradient-to-br from-[#4E6E49]/10 to-emerald-700/10 rounded-full blur-3xl -mr-16 sm:-mr-32 -mt-16 sm:-mt-32"}),r.jsx("div",{className:"absolute bottom-0 left-0 w-24 h-24 sm:w-48 sm:h-48 bg-gradient-to-tr from-yellow-500/10 to-orange-500/10 rounded-full blur-2xl -ml-12 sm:-ml-24 -mb-12 sm:-mb-24"}),r.jsx("div",{className:"relative z-10",children:r.jsxs("div",{className:"flex flex-col gap-4 sm:gap-6 lg:flex-row lg:items-start lg:justify-between mb-4 sm:mb-6",children:[r.jsxs("div",{className:"flex-1 min-w-0 space-y-3 sm:space-y-4",children:[r.jsxs("div",{className:"flex items-center gap-3 sm:gap-4",children:[r.jsx("div",{className:"p-3 sm:p-4 rounded-xl sm:rounded-2xl shadow-lg flex-shrink-0 bg-gradient-to-br from-[#4E6E49] to-emerald-700 text-white transform transition-transform active:scale-95 sm:hover:scale-110",children:r.jsx(Sa,{className:"w-5 h-5 sm:w-7 sm:h-7"})}),r.jsx("div",{className:"flex-1 min-w-0",children:r.jsxs("h1",{className:"text-2xl sm:text-3xl md:text-4xl font-extrabold text-white flex items-center gap-2 sm:gap-3 drop-shadow-lg",children:[r.jsx("span",{children:"Заработок команды"}),r.jsx(nr,{className:`w-5 h-5 sm:w-6 sm:h-6 flex-shrink-0 ${s==="dark"?"text-yellow-300":"text-yellow-500"} animate-pulse`})]})})]}),r.jsx("p",{className:`text-sm sm:text-base font-medium ${s==="dark"?"text-gray-400":"text-gray-600"}`,children:"Отслеживайте доходы и вклад каждого участника в общий успех"}),r.jsx("div",{className:"flex flex-wrap gap-2",children:[{href:"#earn-stats",label:"Обзор"},{href:"#earn-history",label:"История"},{href:"#earn-insights",label:"Инсайты"}].map(b=>r.jsx("a",{href:b.href,className:`px-3 py-1.5 rounded-lg text-xs font-semibold border transition ${s==="dark"?"border-white/10 bg-white/5 text-white hover:border-[#4E6E49]/50":"border-gray-200 bg-white text-gray-800 hover:border-[#4E6E49]/50 hover:text-[#4E6E49]"}`,children:b.label},b.href))})]}),r.jsxs("button",{onClick:()=>t(!0),className:"w-full lg:w-auto px-4 sm:px-6 py-3 sm:py-4 bg-gradient-to-r from-[#4E6E49] to-[#4E6E49] hover:from-[#4E6E49] hover:to-[#4E6E49] text-white rounded-lg sm:rounded-xl transition-all duration-200 flex items-center justify-center gap-2 text-sm sm:text-base font-semibold shadow-lg hover:shadow-xl active:scale-95 sm:hover:scale-105 transform touch-manipulation",children:[r.jsx(is,{className:"w-4 h-4 sm:w-5 sm:h-5 flex-shrink-0"}),r.jsx("span",{className:"whitespace-nowrap",children:"Добавить заработок"})]})]})}),r.jsxs("div",{id:"earn-stats",className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-6",children:[r.jsxs("div",{className:`p-4 rounded-xl border-2 ${s==="dark"?"bg-blue-500/10 border-blue-500/30":"bg-blue-50 border-blue-200"}`,children:[r.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[r.jsx("div",{className:`p-2 rounded-lg ${s==="dark"?"bg-blue-500/20":"bg-blue-100"}`,children:r.jsx(sr,{className:`w-5 h-5 ${s==="dark"?"text-blue-400":"text-blue-600"}`})}),r.jsx("p",{className:`text-xs ${s==="dark"?"text-gray-400":"text-gray-600"}`,children:"Неделя (чистыми)"})]}),r.jsxs("p",{className:`text-2xl font-bold ${s==="dark"?"text-blue-400":"text-blue-600"}`,children:[h.weekNet.toFixed(2)," ₽"]}),r.jsxs("p",{className:"text-[11px] text-gray-500 mt-1",children:["Гросс: ",h.weekTotal.toFixed(2)," ₽"]})]}),r.jsxs("div",{className:`p-4 rounded-xl border-2 ${s==="dark"?"bg-purple-500/10 border-purple-500/30":"bg-purple-50 border-purple-200"}`,children:[r.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[r.jsx("div",{className:`p-2 rounded-lg ${s==="dark"?"bg-purple-500/20":"bg-purple-100"}`,children:r.jsx(qd,{className:`w-5 h-5 ${s==="dark"?"text-purple-400":"text-purple-600"}`})}),r.jsx("p",{className:`text-xs ${s==="dark"?"text-gray-400":"text-gray-600"}`,children:"Пул за неделю"})]}),r.jsxs("p",{className:`text-2xl font-bold ${s==="dark"?"text-purple-400":"text-purple-600"}`,children:[h.weekPool.toFixed(2)," ₽"]})]}),r.jsxs("div",{className:`p-4 rounded-xl border-2 ${s==="dark"?"bg-[#4E6E49]/10 border-[#4E6E49]/30":"bg-green-50 border-green-200"}`,children:[r.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[r.jsx("div",{className:`p-2 rounded-lg ${s==="dark"?"bg-[#4E6E49]/20":"bg-green-100"}`,children:r.jsx(Vx,{className:"w-5 h-5 text-[#4E6E49]"})}),r.jsx("p",{className:`text-xs ${s==="dark"?"text-gray-400":"text-gray-600"}`,children:"Месяц (чистыми)"})]}),r.jsxs("p",{className:"text-2xl font-bold text-[#4E6E49]",children:[h.monthNet.toFixed(2)," ₽"]}),r.jsxs("p",{className:"text-[11px] text-gray-500 mt-1",children:["Гросс: ",h.monthTotal.toFixed(2)," ₽"]})]}),r.jsxs("div",{className:`p-4 rounded-xl border-2 ${s==="dark"?"bg-orange-500/10 border-orange-500/30":"bg-orange-50 border-orange-200"}`,children:[r.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[r.jsx("div",{className:`p-2 rounded-lg ${s==="dark"?"bg-orange-500/20":"bg-orange-100"}`,children:r.jsx(qd,{className:`w-5 h-5 ${s==="dark"?"text-orange-400":"text-orange-600"}`})}),r.jsx("p",{className:`text-xs ${s==="dark"?"text-gray-400":"text-gray-600"}`,children:"Пул за месяц"})]}),r.jsxs("p",{className:`text-2xl font-bold ${s==="dark"?"text-orange-400":"text-orange-600"}`,children:[h.monthPool.toFixed(2)," ₽"]})]})]}),r.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4 mb-4",children:[r.jsxs("div",{className:`lg:col-span-2 rounded-2xl p-5 ${k} border ${s==="dark"?"border-white/10":"border-gray-200"} shadow-lg`,children:[r.jsx("div",{className:"flex items-center justify-between mb-4",children:r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx("div",{className:`p-2 rounded-lg ${s==="dark"?"bg-[#4E6E49]/20":"bg-green-100"}`,children:r.jsx(jx,{className:"w-5 h-5 text-[#4E6E49]"})}),r.jsxs("div",{children:[r.jsx("p",{className:`text-sm font-semibold ${s==="dark"?"text-gray-200":"text-gray-800"}`,children:"Сферы заработка"}),r.jsx("p",{className:"text-xs text-gray-500",children:"Сколько приносит каждый поток"})]})]})}),r.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3",children:p.map(b=>{const y=Ws[b.key];return r.jsxs("div",{className:`p-3 rounded-xl border ${s==="dark"?"border-gray-800 bg-gray-900/70":"border-gray-200 bg-white"} shadow-sm`,children:[r.jsxs("div",{className:"flex items-start justify-between gap-2",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("span",{className:"p-2 rounded-lg bg-gray-100 dark:bg-gray-800/80 flex items-center justify-center",children:L(b.key,"w-4 h-4")}),r.jsxs("div",{children:[r.jsx("p",{className:"text-sm font-semibold",children:y.label}),r.jsxs("p",{className:"text-[11px] text-gray-500",children:[b.count," записей"]})]})]}),r.jsxs("span",{className:"text-sm font-bold text-[#4E6E49]",children:[b.net.toFixed(0)," ₽"]})]}),r.jsxs("div",{className:"grid grid-cols-2 gap-2 mt-2 text-xs text-gray-500",children:[r.jsxs("div",{children:["Пул: ",b.pool.toFixed(0)," ₽"]}),r.jsxs("div",{children:["Гросс: ",b.gross.toFixed(0)," ₽"]})]}),r.jsxs("div",{className:"mt-2",children:[r.jsx("p",{className:"text-[11px] uppercase tracking-wide text-gray-500 mb-1",children:"Топ участники"}),r.jsx("div",{className:"flex flex-wrap gap-1.5",children:b.topParticipants.length===0?r.jsx("span",{className:"text-[11px] text-gray-500",children:"Нет записей"}):b.topParticipants.map(([re,ue])=>r.jsxs("span",{className:`px-2 py-1 rounded-full text-[11px] font-semibold ${s==="dark"?"bg-gray-800 text-gray-100":"bg-gray-100 text-gray-800"}`,children:[H(re)," · ",ue.toFixed(0)," ₽"]},re))})]})]},b.key)})})]}),r.jsxs("div",{className:`rounded-2xl p-5 ${k} border ${s==="dark"?"border-white/10":"border-gray-200"} shadow-lg`,children:[r.jsx("div",{className:"flex items-center justify-between mb-4",children:r.jsxs("div",{children:[r.jsx("p",{className:`text-sm font-semibold ${s==="dark"?"text-gray-200":"text-gray-800"}`,children:"Лидеры по доходу"}),r.jsx("p",{className:"text-xs text-gray-500",children:"Кто приносит больше всего чистыми"})]})}),r.jsxs("div",{className:"space-y-3",children:[w.slice(0,3).map((b,y)=>r.jsxs("div",{className:`flex items-center justify-between p-3 rounded-xl border ${s==="dark"?"border-gray-800 bg-gray-900/70":"border-gray-200 bg-white"}`,children:[r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx("span",{className:`w-7 h-7 rounded-full flex items-center justify-center text-sm font-bold ${s==="dark"?"bg-gray-800 text-gray-100":"bg-gray-100 text-gray-800"}`,children:y+1}),r.jsxs("div",{children:[r.jsx("p",{className:"text-sm font-semibold",children:b.name}),r.jsxs("p",{className:"text-[11px] text-gray-500",children:["Пул: ",b.poolShare.toFixed(0)," ₽"]})]})]}),r.jsxs("div",{className:"text-right",children:[r.jsxs("p",{className:"text-base font-bold text-[#4E6E49]",children:[b.net.toFixed(0)," ₽"]}),r.jsx("p",{className:"text-[11px] text-gray-500",children:"чистыми"})]})]},b.id)),w.length===0&&r.jsx("p",{className:"text-sm text-gray-500",children:"Нет данных по заработку"})]})]})]}),r.jsx("div",{className:"hidden sm:flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between pt-4 border-t border-gray-800/50 dark:border-gray-800",children:r.jsx("h2",{className:`text-base sm:text-lg md:text-xl font-semibold ${s==="dark"?"text-white":"text-gray-900"}`,children:"Управление заработком"})})]}),c?r.jsx("div",{className:`rounded-xl p-8 text-center border-2 ${s==="dark"?"bg-[#1a1a1a] border-gray-800":"bg-white border-gray-200"} shadow-md`,children:r.jsxs("div",{className:"flex flex-col items-center gap-3",children:[r.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-[#4E6E49]"}),r.jsx("p",{className:s==="dark"?"text-gray-400":"text-gray-600",children:"Загрузка данных..."})]})}):r.jsxs(r.Fragment,{children:[r.jsxs("div",{id:"earn-history",className:"space-y-6",children:[r.jsx(Gj,{earnings:i}),r.jsx(Kj,{earnings:i,onEdit:ee,onDelete:M})]}),r.jsxs("div",{id:"earn-insights",className:`rounded-2xl p-6 ${k} border ${s==="dark"?"border-white/10":"border-gray-200"} shadow-lg space-y-4`,children:[r.jsx("div",{className:"flex items-center justify-between",children:r.jsxs("div",{children:[r.jsx("p",{className:`text-sm font-semibold ${s==="dark"?"text-gray-300":"text-gray-700"}`,children:"Инсайты"}),r.jsx("p",{className:`text-xs ${s==="dark"?"text-gray-400":"text-gray-500"}`,children:"Где мы зарабатываем больше всего"})]})}),r.jsx("div",{className:"grid sm:grid-cols-2 lg:grid-cols-4 gap-3",children:[{label:"Топ категория",value:N?`${Ws[N.key].label} · ${N.net.toFixed(0)} ₽`:"Нет данных",tone:"bg-blue-500/10 text-blue-600 dark:text-blue-200"},{label:"Лидер команды",value:j?`${j.name} · ${j.net.toFixed(0)} ₽`:"Нет данных",tone:"bg-purple-500/10 text-purple-600 dark:text-purple-200"},{label:"Доля пула (мес.)",value:h.monthTotal?`${Math.round(h.monthPool/h.monthTotal*100)}%`:"45%",tone:"bg-emerald-500/10 text-emerald-600 dark:text-emerald-200"},{label:"Средняя выплата",value:i.length?`${(i.reduce((b,y)=>b+D(y),0)/i.length).toFixed(0)} ₽`:"0 ₽",tone:"bg-orange-500/10 text-orange-600 dark:text-orange-200"}].map(b=>r.jsxs("div",{className:`p-3 rounded-xl ${b.tone} border ${s==="dark"?"border-white/10":"border-transparent"} shadow-sm`,children:[r.jsx("p",{className:"text-[11px] uppercase tracking-wide opacity-70",children:b.label}),r.jsx("p",{className:"text-xl font-extrabold",children:b.value})]},b.label))})]})]}),e&&r.jsx(Hj,{onClose:C,onSave:v,editingEarning:n})]})})},U0=(s,e=0,t=0,n=0,a=0,i=0)=>{console.log("calculateRating input:",{userId:s.userId,weeklyDaysOff:n,weeklySickDays:a,data_sickDays:s.sickDays,data_vacationDays:s.vacationDays,ninetyDayVacationDays:i,data_absenceDays:s.absenceDays,weeklyHours:e,weeklyEarnings:t});let o=0,c=0;n<2?(c=5,o+=5):n>3&&(c=-15,o-=15),console.log("DaysOff calculation:",{weeklyDaysOff:n,daysOffPoints:c,currentRating:o});let d=0;a<3&&s.sickDays<=9?(d=5,o+=5):(a>4||s.sickDays>10)&&(d=-15,o-=15),console.log("SickDays calculation:",{weeklySickDays:a,monthlySickDays:s.sickDays,sickDaysPoints:d,currentRating:o});let h=0;s.vacationDays<12&&i<=30?(h=10,o+=10):(s.vacationDays>12||i>30)&&(h=-10,o-=10),console.log("Vacation calculation:",{monthlyVacationDays:s.vacationDays,ninetyDayVacationDays:i,vacationDaysPoints:h,currentRating:o});let m=0;s.absenceDays>2&&(m=30),console.log("Absence penalty:",{absenceDays:s.absenceDays,absencePenalty:m,currentRating:o}),e>=20?o+=25:e>=15&&(o+=15),t>=6e3?o+=30:t>=3e3&&(o+=15);const x=Math.min(s.referrals*5,30);return o+=x,o=Math.max(0,o-m),console.log("Final rating calculation:",{ratingAfterAbsencePenalty:o,finalRating:Math.min(o,100)}),Math.min(o,100)},B0=(s,e=0,t=0,n=0,a=0,i=0)=>{let o=0;n<2?o=5:n>3&&(o=-15);let c=0;a<3&&s.sickDays<=9?c=5:(a>4||s.sickDays>10)&&(c=-15);let d=0;s.vacationDays<12&&i<=30?d=10:(s.vacationDays>12||i>30)&&(d=-10);let h=0;s.absenceDays>2&&(h=-30);let m=0;e>=20?m=25:e>=15&&(m=15);let x=0;t>=6e3?x=30:t>=3e3&&(x=15);const f=Math.min(s.referrals*5,30),k=o+c+d+m+x+f,A=Math.min(Math.max(0,k+h),100);return{daysOff:n,daysOffPoints:o,sickDays:s.sickDays,sickDaysPoints:c,vacationDays:s.vacationDays,vacationDaysPoints:d,absenceDays:s.absenceDays,absenceDaysPoints:h,weeklyHours:e,weeklyHoursPoints:m,weeklyEarnings:t,weeklyEarningsPoints:x,referrals:s.referrals,referralsPoints:f,totalRating:A}},Qj=s=>s<20?{status:"excluded",label:"Исключен",description:"Участник исключается из сообщества",color:"#dc2626"}:s>=21&&s<=45?{status:"warning",label:"Исправиться",description:"Необходимо улучшить показатели",color:"#f59e0b"}:{status:"ok",label:"В команде",description:"Участник в команде",color:"#10b981"},Xj=({rating:s,place:e})=>{var v;const{theme:t}=at(),[n,a]=I.useState(null),i=De.find(p=>p.id===s.userId),o=t==="dark"?"text-white":"text-gray-900",c=t==="dark"?"text-gray-400":"text-gray-600",d=t==="dark"?"bg-[#0f0f0f]":"bg-white",h=t==="dark"?"border-white/10":"border-gray-200",m=t==="dark"?"hover:bg-white/5":"hover:bg-gray-50",x=t==="dark"?"bg-white/5":"bg-gray-50/80",f=s.rating<=0?"4%":`${Math.min(s.rating,100)}%`,k=s.rating>=80?"bg-emerald-500":s.rating>=60?"bg-blue-500":s.rating>=40?"bg-amber-500":"bg-rose-500",A=s.rating>=80?"#10b981":s.rating>=60?"#3b82f6":s.rating>=40?"#f59e0b":"#f43f5e",T={1:{bg:t==="dark"?"bg-emerald-500/10":"bg-emerald-50",border:t==="dark"?"border-emerald-400/30":"border-emerald-200",text:t==="dark"?"text-emerald-100":"text-emerald-900",icon:t==="dark"?"text-emerald-200":"text-emerald-600",soft:t==="dark"?"bg-emerald-500/8":"bg-emerald-50"},2:{bg:t==="dark"?"bg-sky-500/10":"bg-sky-50",border:t==="dark"?"border-sky-400/30":"border-sky-200",text:t==="dark"?"text-sky-100":"text-sky-900",icon:t==="dark"?"text-sky-200":"text-sky-600",soft:t==="dark"?"bg-sky-500/8":"bg-sky-50"},3:{bg:t==="dark"?"bg-purple-500/10":"bg-purple-50",border:t==="dark"?"border-purple-400/30":"border-purple-200",text:t==="dark"?"text-purple-100":"text-purple-900",icon:t==="dark"?"text-purple-200":"text-purple-600",soft:t==="dark"?"bg-purple-500/8":"bg-purple-50"},4:{bg:t==="dark"?"bg-amber-500/10":"bg-amber-50",border:t==="dark"?"border-amber-400/30":"border-amber-200",text:t==="dark"?"text-amber-100":"text-amber-900",icon:t==="dark"?"text-amber-200":"text-amber-600",soft:t==="dark"?"bg-amber-500/8":"bg-amber-50"},5:{bg:t==="dark"?"bg-rose-500/10":"bg-rose-50",border:t==="dark"?"border-rose-400/30":"border-rose-200",text:t==="dark"?"text-rose-100":"text-rose-900",icon:t==="dark"?"text-rose-200":"text-rose-600",soft:t==="dark"?"bg-rose-500/8":"bg-rose-50"},default:{bg:t==="dark"?"bg-white/5":"bg-gray-50",border:t==="dark"?"border-white/10":"border-gray-200",text:t==="dark"?"text-white":"text-gray-900",icon:t==="dark"?"text-white":"text-gray-700",soft:t==="dark"?"bg-white/5":"bg-gray-50"}}[(i==null?void 0:i.id)||"default"],H=s.breakdown?[{icon:r.jsx(Tr,{className:"w-5 h-5"}),label:"Выходные",value:`${s.breakdown.daysOff} день`,points:s.breakdown.daysOffPoints,maxPoints:5,explanation:"Менее 2 выходных в неделю = +5% к рейтингу. Более 3 выходных = -15%. Показывает стабильность присутствия.",threshold:"<2 дня: +5% | >3 дня: -15%",color:"bg-amber-200 text-amber-900"},{icon:r.jsx(hx,{className:"w-5 h-5"}),label:"Больничные",value:`${s.breakdown.sickDays} дней`,points:s.breakdown.sickDaysPoints,maxPoints:5,explanation:"Менее 3 дней больничных в неделю И ≤9 дней в месяц = +5%. Более 4 дней в неделю ИЛИ >10 дней в месяц = -15%.",threshold:"<3/нед + ≤9/мес: +5% | >4/нед или >10/мес: -15%",color:"bg-purple-200 text-purple-900"},{icon:r.jsx(_x,{className:"w-5 h-5"}),label:"Отпуск",value:`${s.breakdown.vacationDays} дней`,points:s.breakdown.vacationDaysPoints,maxPoints:10,explanation:"Менее 12 дней отпуска в месяц И ≤30 дней за 90 дней = +10%. Более 12 дней в месяц ИЛИ >30 дней за 90 дней = -10%.",threshold:"<12/мес + ≤30/90дн: +10% | >12/мес или >30/90дн: -10%",color:"bg-orange-200 text-orange-900"},{icon:r.jsx(Lt,{className:"w-5 h-5"}),label:"Прогулы",value:`${s.breakdown.absenceDays} дней`,points:s.breakdown.absenceDaysPoints,maxPoints:0,explanation:"До 1 прогула в неделю = рейтинг не страдает. Более 2 прогулов = -30% к рейтингу. Учитывается за последние 7 дней.",threshold:"≤1 дня",color:"bg-red-200 text-red-900"},{icon:r.jsx(Sr,{className:"w-5 h-5"}),label:"Часы работы",value:X2(s.breakdown.weeklyHours),points:s.breakdown.weeklyHoursPoints,maxPoints:25,explanation:"20+ часов в неделю = 25% к рейтингу. 15-19 часов = 15%. Менее 15 часов = 0%. Показывает объем работы за неделю.",threshold:"≥20ч: 25% | ≥15ч: 15%",color:"bg-blue-200 text-blue-900"},{icon:r.jsx(Sa,{className:"w-5 h-5"}),label:"Заработок",value:`${s.breakdown.weeklyEarnings.toFixed(2)} ₽`,points:s.breakdown.weeklyEarningsPoints,maxPoints:30,explanation:"6000+ ₽ в неделю = 30% к рейтингу. 3000-5999 ₽ = 15%. Менее 3000 ₽ = 0%. Основной показатель эффективности.",threshold:"≥6000₽: 30% | ≥3000₽: 15%",color:"bg-emerald-200 text-emerald-900"},{icon:r.jsx(Pn,{className:"w-5 h-5"}),label:"Рефералы",value:`${s.breakdown.referrals} чел.`,points:s.breakdown.referralsPoints,maxPoints:30,explanation:"5% к рейтингу за каждого реферала. Максимум 30% (6 рефералов). Учитываются за последние 30 дней. Показывает активность по привлечению новых участников.",threshold:"5% за каждого (макс 30%)",color:"bg-pink-200 text-pink-900"}]:[],L=H.filter(p=>p.label!=="Прогулы").reduce((p,w)=>p+w.points,0),E=((v=H.find(p=>p.label==="Прогулы"))==null?void 0:v.points)||0,M=Math.max(0,Math.min(100,L+E)),ee=Qj(s.rating),C=(()=>{if(!e)return null;const p=e.rank,w=p===1?{bg:"from-amber-400 to-amber-600",ring:"ring-amber-300/50",icon:"🥇"}:p===2?{bg:"from-slate-300 to-slate-500",ring:"ring-slate-300/50",icon:"🥈"}:p===3?{bg:"from-amber-200 to-amber-500",ring:"ring-amber-200/40",icon:"🥉"}:{bg:"from-gray-200 to-gray-400",ring:"ring-gray-200/40",icon:p.toString()};return r.jsx("div",{className:"absolute top-3 right-3",children:r.jsx("div",{className:`w-10 h-10 rounded-full bg-gradient-to-br ${w.bg} ring-4 ${w.ring} shadow-lg grid place-items-center text-lg font-semibold`,children:w.icon})})})();return r.jsxs("div",{className:`relative rounded-2xl p-6 ${d} shadow-sm border ${h} transition-colors`,children:[C,r.jsxs("div",{className:"mb-5 flex flex-col gap-3",children:[r.jsx("div",{className:"flex items-start justify-between gap-3",children:r.jsxs("div",{className:"min-w-0",children:[r.jsx("p",{className:`text-[11px] uppercase tracking-[0.12em] ${c}`,children:"Участник"}),r.jsx("div",{className:"flex items-center gap-2 flex-wrap",children:r.jsx("h3",{className:`text-2xl font-bold ${o} truncate`,children:r.jsx(as,{userId:s.userId,fallback:"unknown"})})}),r.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[r.jsxs("span",{className:`px-2.5 py-1 rounded-lg text-xs font-semibold border ${T.border} ${T.bg} ${T.text} flex items-center gap-1`,children:[r.jsx("span",{className:`text-lg leading-none ${T.icon}`,children:"●"}),r.jsx("span",{children:"Ник"})]}),r.jsx("div",{className:"flex items-center gap-2",children:r.jsxs("span",{className:"text-lg font-bold",style:{color:A},children:[s.rating.toFixed(1),"%"]})})]})]})}),r.jsxs("div",{children:[r.jsx("div",{className:"w-full bg-gray-200/70 dark:bg-gray-800 rounded-full h-6 overflow-hidden shadow-inner",children:r.jsx("div",{className:`h-full transition-all duration-500 flex items-center justify-center text-sm font-semibold text-white ${k}`,style:{width:f,minWidth:s.rating<=0?"40px":void 0},children:s.rating>=8&&r.jsxs("span",{children:[s.rating.toFixed(0),"%"]})})}),r.jsxs("div",{className:"flex justify-between mt-1",children:[r.jsx("span",{className:`text-xs ${c}`,children:"Общий рейтинг"}),r.jsxs("span",{className:`text-xs font-semibold ${c}`,children:[M,"/100 баллов"]})]})]}),r.jsxs("div",{className:"mt-3",children:[r.jsxs("div",{className:"inline-flex items-center gap-2 px-3 py-1.5 rounded-lg border text-sm font-medium",style:{backgroundColor:`${ee.color}15`,borderColor:`${ee.color}40`,color:ee.color},children:[r.jsx("div",{className:"w-2 h-2 rounded-full animate-pulse",style:{backgroundColor:ee.color}}),r.jsx("span",{children:ee.label})]}),r.jsx("p",{className:`text-xs mt-1 ${c}`,children:ee.description})]})]}),s.breakdown&&r.jsxs("div",{className:"space-y-3 mb-6",children:[r.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[r.jsx(sr,{className:`w-5 h-5 ${c}`}),r.jsx("h4",{className:`text-lg font-semibold ${o}`,children:"Детальный разбор рейтинга"})]}),H.map((p,w)=>{const N=p.maxPoints>0?p.points/p.maxPoints*100:0,j=n===w;return r.jsxs("div",{className:`rounded-lg border ${h} overflow-hidden transition-all ${j?"shadow-md":""}`,children:[r.jsx("button",{onClick:()=>a(j?null:w),className:`w-full p-4 flex items-center justify-between ${m} transition-colors`,children:r.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[r.jsx("div",{className:`p-2 rounded-lg ${p.color} flex-shrink-0`,children:p.icon}),r.jsxs("div",{className:"flex-1 min-w-0",children:[r.jsxs("div",{className:"flex items-center justify-between mb-1",children:[r.jsx("span",{className:`font-semibold ${o} truncate`,children:p.label}),r.jsxs("span",{className:`font-bold ml-2 ${p.points>0?"text-[#4E6E49]":"text-red-500"}`,children:[p.points,"/",p.maxPoints]})]}),r.jsx("div",{className:"w-full bg-gray-200 dark:bg-gray-800 rounded-full h-2 overflow-hidden",children:r.jsx("div",{className:`h-full transition-all duration-300 ${p.color}`,style:{width:`${N}%`}})}),r.jsxs("div",{className:"flex items-center justify-between mt-1",children:[r.jsx("span",{className:`text-xs ${c} truncate mr-2`,children:p.value}),r.jsx("span",{className:`text-xs ${c} whitespace-nowrap`,children:p.threshold})]})]}),r.jsx(_r,{className:`w-4 h-4 flex-shrink-0 ml-2 ${c} transition-transform ${j?"rotate-180":""}`})]})}),j&&r.jsx("div",{className:`px-4 pb-4 pt-2 border-t ${h} ${x}`,children:r.jsx("p",{className:`text-sm ${c} leading-relaxed`,children:p.explanation})})]},w)})]}),r.jsxs("div",{className:`pt-4 border-t ${h}`,children:[r.jsx("h4",{className:`text-sm font-semibold mb-3 ${o}`,children:"Дополнительная статистика"}),r.jsxs("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[r.jsxs("div",{className:`p-3 rounded-lg ${x}`,children:[r.jsx("div",{className:`text-xs ${c} mb-1`,children:"Заработок (месяц)"}),r.jsxs("div",{className:`text-lg font-bold ${o}`,children:[s.earnings.toFixed(0)," ₽"]})]}),r.jsxs("div",{className:`p-3 rounded-lg ${x}`,children:[r.jsx("div",{className:`text-xs ${c} mb-1`,children:"В пул"}),r.jsxs("div",{className:`text-lg font-bold ${o}`,children:[s.poolAmount.toFixed(0)," ₽"]})]}),r.jsxs("div",{className:`p-3 rounded-lg ${x}`,children:[r.jsx("div",{className:`text-xs ${c} mb-1`,children:"Прогулы (неделя)"}),r.jsxs("div",{className:`text-lg font-bold ${o}`,children:[s.absenceDays," дней"]})]}),r.jsxs("div",{className:`p-3 rounded-lg ${x}`,children:[r.jsx("div",{className:`text-xs ${c} mb-1`,children:"Сигналы"}),r.jsxs("div",{className:`text-lg font-bold ${o}`,children:[s.signals,"/",s.profitableSignals]})]})]})]})]})},ol=()=>`REF-${Math.random().toString(36).slice(2,8).toUpperCase()}`,Jj=({referral:s,onClose:e,onSave:t})=>{const{user:n}=pt(),{isAdmin:a}=kt(),{theme:i}=at(),[o,c]=I.useState(""),[d,h]=I.useState(""),[m,x]=I.useState(""),[f,k]=I.useState(ol()),[A,D]=I.useState(""),[T,H]=I.useState(!1),[L,E]=I.useState(!1);I.useEffect(()=>{s?(c(s.name),h(String(s.age)),k(s.referralId),x(s.comment||"")):(c(""),h(""),x(""),k(ol()))},[s]);const M=!!s,ee=M?"Редактировать реферала":"Добавить реферала",C=i==="dark"?"bg-gray-700 hover:bg-gray-600 text-white":"bg-gray-200 hover:bg-gray-300 text-gray-900",v=i==="dark"?"text-gray-300":"text-gray-700",p=i==="dark"?"text-white":"text-gray-900",w=async()=>{if(!s){if(!n){D("Пользователь не найден. Для добавления реферала необходимо войти как участник.");return}}if(!o.trim()||!d.trim()){D("Заполните имя и возраст");return}const j=Number(d);if(Number.isNaN(j)||j<16){D("Возраст должен быть числом не меньше 16");return}H(!0),D("");const b={referralId:f,ownerId:(s==null?void 0:s.ownerId)||n.id,name:o.trim(),age:j,createdAt:(s==null?void 0:s.createdAt)||new Date().toISOString(),...m.trim()&&{comment:m.trim()}};try{s?a?await O0(s.id,b):await vt({entity:"referral",action:"update",authorId:(n==null?void 0:n.id)||s.ownerId,targetUserId:s.ownerId,before:s,after:{id:s.id,...b}}):a?await P0(b):await vt({entity:"referral",action:"create",authorId:n.id,targetUserId:n.id,before:null,after:{id:"",...b}}),t()}catch(y){console.error("Error saving referral:",y);const re=y.message||y.code||"Не удалось сохранить реферала";D(re)}finally{H(!1)}},N=async()=>{if(s&&confirm(`Удалить реферала ${s.name}?`)){E(!0);try{a?await Qc(s.id):await vt({entity:"referral",action:"delete",authorId:(n==null?void 0:n.id)||s.ownerId,targetUserId:s.ownerId,before:s,after:null}),t()}catch(j){console.error("Error deleting referral:",j);const b=j.message||j.code||"Не удалось удалить реферала";D(b)}finally{E(!1)}}};return r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-start sm:items-center justify-center z-[70] p-4 sm:py-0 overflow-y-auto overflow-x-hidden overscroll-contain modal-scroll",children:r.jsxs("div",{className:`w-full max-w-md rounded-lg shadow-xl ${i==="dark"?"bg-[#1a1a1a]":"bg-white"} max-h-[90vh] flex flex-col overflow-hidden`,children:[r.jsx("div",{className:"flex-shrink-0 p-6 pb-4",children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsx("h3",{className:`text-xl font-bold ${p}`,children:ee}),r.jsx("button",{onClick:e,className:`p-2 rounded-lg flex-shrink-0 ${C}`,"aria-label":"Закрыть",children:r.jsx(Pt,{className:"w-5 h-5"})})]})}),r.jsx("div",{className:"flex-1 min-h-0 overflow-y-auto overflow-x-hidden overscroll-contain modal-scroll px-6 pb-6",children:r.jsxs("div",{className:"space-y-4 min-w-0",children:[r.jsxs("div",{children:[r.jsx("label",{className:`block text-sm font-medium mb-2 ${v}`,children:"Имя"}),r.jsx("input",{type:"text",value:o,onChange:j=>c(j.target.value),className:`w-full px-4 py-2 rounded-lg border ${i==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`,placeholder:"Введите имя"})]}),r.jsxs("div",{children:[r.jsx("label",{className:`block text-sm font-medium mb-2 ${v}`,children:"Возраст"}),r.jsx("input",{type:"number",value:d,onChange:j=>h(j.target.value),className:`w-full px-4 py-2 rounded-lg border ${i==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`,placeholder:"18",min:16})]}),r.jsxs("div",{children:[r.jsx("label",{className:`block text-sm font-medium mb-2 ${v}`,children:"Комментарий"}),r.jsx("textarea",{value:m,onChange:j=>x(j.target.value),rows:3,className:`w-full px-4 py-2 rounded-lg border ${i==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`,placeholder:"Например, источник лида или статус"})]}),r.jsxs("div",{children:[r.jsx("label",{className:`block text-sm font-medium mb-2 ${v}`,children:"ID реферала"}),r.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[r.jsx("input",{type:"text",value:f,readOnly:M,onChange:j=>k(j.target.value),className:`flex-1 px-4 py-2 rounded-lg border ${i==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49] ${M?"opacity-80 cursor-not-allowed":""}`}),!M&&r.jsxs("button",{type:"button",onClick:()=>k(ol()),className:"px-3 py-2 bg-[#4E6E49] hover:bg-[#4E6E49] text-white rounded-lg transition-colors flex items-center justify-center gap-1 text-sm",children:[r.jsx(Ix,{className:"w-4 h-4"}),"Новый"]})]}),r.jsx("p",{className:`text-xs mt-1 ${i==="dark"?"text-gray-400":"text-gray-500"}`,children:"ID генерируется автоматически и используется для учета."})]}),A&&r.jsx("div",{className:"p-3 bg-red-500 text-white rounded-lg text-sm",children:A}),r.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[M&&r.jsxs("button",{onClick:N,disabled:L,className:"flex-1 px-4 py-2 bg-red-500 hover:bg-red-600 disabled:bg-red-300 text-white rounded-lg transition-colors flex items-center justify-center gap-2",children:[r.jsx(At,{className:"w-4 h-4"}),L?"Удаление...":"Удалить"]}),r.jsx("button",{onClick:w,disabled:T,className:"flex-1 px-4 py-2 bg-[#4E6E49] hover:bg-[#4E6E49] disabled:bg-gray-400 disabled:cursor-not-allowed text-white rounded-lg transition-colors",children:T?"Сохранение...":"Сохранить"}),r.jsx("button",{onClick:e,className:`px-4 py-2 rounded-lg transition-colors ${C}`,children:"Отмена"})]})]})})]})})},Zj=()=>{var ne;const{theme:s}=at(),{user:e}=pt(),{isAdmin:t}=kt(),[n,a]=I.useState([]),[i,o]=I.useState(!0),[c,d]=I.useState([]),[h,m]=I.useState(!1),[x,f]=I.useState(null),[k,A]=I.useState([]),[D,T]=I.useState([]);I.useEffect(()=>{H()},[]);const H=async()=>{o(!0);try{const V=za(),X=le(V.start,"yyyy-MM-dd"),S=le(V.end,"yyyy-MM-dd"),R=Qi(30),K=le(R.start,"yyyy-MM-dd"),U=le(R.end,"yyyy-MM-dd"),Q=R.start.toISOString(),$=R.end.toISOString(),ce=Qi(90),we=le(ce.start,"yyyy-MM-dd"),G=le(ce.end,"yyyy-MM-dd"),oe=await M0(void 0,Q,$);d(oe);const _e=[];for(const Qe of De){const ge=(await Ea(Qe.id,X,S)).reduce((se,me)=>{const Ue=me.participants&&me.participants.length>0?me.participants.length:1;return se+me.amount/Ue},0),ye=await Ea(Qe.id,K,U),de=ye.reduce((se,me)=>{const Ue=me.participants&&me.participants.length>0?me.participants.length:1;return se+me.amount/Ue},0),Ce=ye.reduce((se,me)=>{const Ue=me.participants&&me.participants.length>0?me.participants.length:1;return se+me.poolAmount/Ue},0),Ve=await ns(Qe.id),q=Ve.filter(se=>{const me=se.date,Ue=se.endDate||se.date;return me<=U&&Ue>=K}),Ne=q.filter(se=>se.type==="dayoff").reduce((se,me)=>se+cr(me.date,me.endDate,K,U),0),Me=q.filter(se=>se.type==="sick").reduce((se,me)=>se+cr(me.date,me.endDate,K,U),0),z=q.filter(se=>se.type==="vacation").reduce((se,me)=>se+cr(me.date,me.endDate,K,U),0),B=q.filter(se=>se.type==="absence").reduce((se,me)=>se+cr(me.date,me.endDate,K,U),0),je=Ve.filter(se=>{const me=se.date,Ue=se.endDate||se.date;return me<=S&&Ue>=X}),Pe=je.filter(se=>se.type==="dayoff").reduce((se,me)=>se+cr(me.date,me.endDate,X,S),0),Fe=je.filter(se=>se.type==="sick").reduce((se,me)=>se+cr(me.date,me.endDate,X,S),0),Ze=Ve.filter(se=>{const me=se.date,Ue=se.endDate||se.date;return me<=G&&Ue>=we}).filter(se=>se.type==="vacation").reduce((se,me)=>se+cr(me.date,me.endDate,we,G),0),Ee=(await fr(Qe.id)).filter(se=>se.date>=X&&se.date<=S).reduce((se,me)=>se+jo(me.slots),0),jt=(await R0(Qe.id))[0]||{userId:Qe.id,earnings:0,messages:0,initiatives:0,signals:0,profitableSignals:0,referrals:0,daysOff:0,sickDays:0,vacationDays:0,absenceDays:0,poolAmount:0,rating:0,lastUpdated:new Date().toISOString()},_t=oe.filter(se=>se.ownerId===Qe.id).length,br={userId:Qe.id,earnings:de,messages:jt.messages||0,initiatives:jt.initiatives||0,signals:jt.signals||0,profitableSignals:jt.profitableSignals||0,referrals:_t,daysOff:Ne,sickDays:Me,vacationDays:z,absenceDays:B,poolAmount:Ce,lastUpdated:new Date().toISOString()},er=U0(br,Ee,ge,Pe,Fe,Ze),ae=B0(br,Ee,ge,Pe,Fe,Ze);_e.push({...br,rating:er,breakdown:ae})}_e.sort((Qe,Z)=>Z.rating-Qe.rating),a(_e);const Te=await xj();A(Te);const Je=await wj();T(Je)}catch(V){console.error("Error loading ratings:",V)}finally{o(!1)}},L=n.reduce((V,X)=>V+X.rating,0)/(n.length||1),E=s==="dark"?"text-gray-400":"text-gray-600",M=s==="dark"?"text-white":"text-gray-900",ee="bg-[#10141c]",C="border-[#48a35e]/60",v="shadow-[0_24px_80px_rgba(0,0,0,0.45)]",p=s==="dark"?"text-white/70":"text-slate-600",w=s==="dark"?"text-white":"text-slate-900",N=[{label:"80-100%",title:"Эталон",desc:"Стабильный вклад, примеры для команды",tone:"text-emerald-700 dark:text-emerald-100",bg:"bg-emerald-50 dark:bg-emerald-900/40 border-emerald-200/60 dark:border-emerald-700/60"},{label:"60-79%",title:"Уверенно",desc:"Держат темп, есть потенциал роста",tone:"text-blue-700 dark:text-blue-100",bg:"bg-blue-50 dark:bg-blue-900/40 border-blue-200/60 dark:border-blue-700/60"},{label:"40-59%",title:"В пути",desc:"Нужна точечная поддержка и фокус",tone:"text-amber-700 dark:text-amber-100",bg:"bg-amber-50 dark:bg-amber-900/40 border-amber-200/60 dark:border-amber-700/60"},{label:"0-39%",title:"Зона роста",desc:"Запускаем план восстановления",tone:"text-rose-700 dark:text-rose-100",bg:"bg-rose-50 dark:bg-rose-900/40 border-rose-200/60 dark:border-rose-700/60"}],j=V=>{if(!V.breakdown)return["Недостаточно данных — обновите статистику."];const X=[];return V.breakdown.weeklyHoursPoints<25&&X.push("Дотяни рабочие часы до 20+ в неделю (25%)."),V.breakdown.weeklyEarningsPoints<30&&X.push("Увеличь недельный доход до 6000+ ₽ (30%)."),V.breakdown.referralsPoints<30&&X.push("Добавь рефералов: до +30% (6 человек)."),V.breakdown.daysOffPoints<=0&&X.push("Выходные: <2 дней в неделю для +5%."),V.breakdown.sickDaysPoints<=0&&X.push("Больничные: <3 дней в неделю И ≤9 дней в месяц для +5%."),V.breakdown.vacationDaysPoints<=0&&X.push("Отпуск: <12 дней в месяц И ≤30 дней за 90 дней для +10%."),X.length?X:["Отлично! Держи текущий темп."]},b=I.useMemo(()=>[...n].sort((V,X)=>X.rating-V.rating),[n]),y=I.useMemo(()=>{var K,U;if(!n.length)return{top:0,median:0,count:0,high:0};const V=[...n].sort((Q,$)=>$.rating-Q.rating),X=((K=V[0])==null?void 0:K.rating)||0,S=((U=V[Math.floor((V.length-1)/2)])==null?void 0:U.rating)||X,R=V.filter(Q=>Q.rating>=80).length;return{top:X,median:S,count:V.length,high:R}},[n]),re=b[0],ue=re?gt(re.userId):"—",W=new Date().toLocaleDateString("ru-RU"),O=[{label:"Средний рейтинг",value:`${L.toFixed(1)}%`,meta:"по команде за неделю",tone:"emerald"},{label:"Лидер недели",value:ue,meta:re?`${re.rating.toFixed(1)}%`:"—",tone:"amber"},{label:"80%+ участников",value:`${y.high}`,meta:"стабильно высоко",tone:"blue"},{label:"Всего участников",value:`${n.length}`,meta:"в рейтинге",tone:"slate"},{label:"Медиана",value:`${y.median.toFixed(1)}%`,meta:"ровный темп",tone:"purple"},{label:"Рефералы 30д",value:`${c.length}`,meta:"активность команды",tone:"pink"},{label:"Обновление",value:W,meta:"автообновление данных",tone:"indigo"},{label:"КПД недели",value:`${L.toFixed(1)}%`,meta:"ключевой ориентир",tone:"emerald"}],P=V=>V==="emerald"?s==="dark"?"bg-emerald-500/15 border-emerald-400/30 text-emerald-50":"bg-emerald-50 border-emerald-200 text-emerald-900":V==="amber"?s==="dark"?"bg-amber-500/15 border-amber-400/30 text-amber-50":"bg-amber-50 border-amber-200 text-amber-900":V==="blue"?s==="dark"?"bg-sky-500/15 border-sky-400/30 text-sky-50":"bg-sky-50 border-sky-200 text-sky-900":V==="purple"?s==="dark"?"bg-indigo-500/15 border-indigo-400/30 text-indigo-50":"bg-indigo-50 border-indigo-200 text-indigo-900":V==="pink"?s==="dark"?"bg-rose-500/15 border-rose-400/30 text-rose-50":"bg-rose-50 border-rose-200 text-rose-900":V==="indigo"?s==="dark"?"bg-indigo-500/15 border-indigo-400/30 text-indigo-50":"bg-indigo-50 border-indigo-200 text-indigo-900":s==="dark"?"bg-white/5 border-white/15 text-white":"bg-gray-50 border-gray-200 text-gray-900",te=V=>gt(V)||"—";I.useEffect(()=>{(async()=>{ch();for(const X of De)await ss(X.id)})()},[]),I.useEffect(()=>{const V=async X=>{const S=X,{userId:R}=S.detail||{};if(R)await ss(R),a(K=>[...K]);else{ch();for(const K of De)await ss(K.id);a(K=>[...K])}};return window.addEventListener("nicknameUpdated",V),()=>{window.removeEventListener("nicknameUpdated",V)}},[]);const J=()=>{f(null),m(!0)},fe=V=>{f(V),m(!0)},F=async V=>{(t||V.ownerId===(e==null?void 0:e.id))&&(t?await Qc(V.id):await vt({entity:"referral",action:"delete",authorId:(e==null?void 0:e.id)||V.ownerId,targetUserId:V.ownerId,before:V,after:null}),await H())};return r.jsxs(mr,{children:[r.jsxs("div",{className:"space-y-6",children:[r.jsxs("div",{className:"relative overflow-hidden rounded-3xl border border-[#48a35e]/60 shadow-[0_24px_80px_rgba(0,0,0,0.45)] bg-[#10141c]",children:[r.jsxs("div",{className:"absolute inset-0 pointer-events-none",children:[r.jsx("div",{className:"absolute -left-16 -bottom-10 w-80 h-80 bg-emerald-500/18 blur-3xl"}),r.jsx("div",{className:"absolute inset-0 bg-[radial-gradient(circle_at_50%_0%,rgba(255,255,255,0.08),transparent_45%)]"})]}),r.jsxs("div",{className:"relative p-6 sm:p-8 space-y-6",children:[r.jsxs("div",{className:"flex flex-col gap-4 lg:flex-row lg:items-start lg:justify-between",children:[r.jsx("div",{className:"space-y-3 max-w-3xl",children:r.jsxs("div",{className:"flex items-start gap-3",children:[r.jsx("div",{className:"p-3 rounded-2xl bg-white/10 border border-white/20 text-white shadow-inner",children:r.jsxs("svg",{width:"26",height:"26",viewBox:"0 0 24 24",fill:"none",className:"text-emerald-300",children:[r.jsx("path",{d:"M4 13.5V20h4v-6.5H4Z",stroke:"currentColor",strokeWidth:"1.6",strokeLinecap:"round",strokeLinejoin:"round"}),r.jsx("path",{d:"M10 10v10h4V10h-4Z",stroke:"currentColor",strokeWidth:"1.6",strokeLinecap:"round",strokeLinejoin:"round"}),r.jsx("path",{d:"M16 4v16h4V4h-4Z",stroke:"currentColor",strokeWidth:"1.6",strokeLinecap:"round",strokeLinejoin:"round"}),r.jsx("path",{d:"M4 16.5 9.5 11l3 3 7-7",stroke:"currentColor",strokeWidth:"1.6",strokeLinecap:"round",strokeLinejoin:"round"})]})}),r.jsxs("div",{className:"space-y-2",children:[r.jsx("h1",{className:"text-3xl sm:text-4xl font-black text-white leading-tight",children:"Рейтинг команды"}),r.jsx("p",{className:"text-sm text-white/70",children:"Данные за текущую неделю + последние 30 дней. В фокусе KPI команды, динамика и реферальная активность — как на дашборде задач."}),r.jsx("div",{className:"flex flex-wrap gap-2",children:["КПД недели","Рейтинг 30д","Рефералы","Сообщения"].map((V,X)=>r.jsx("span",{className:`px-4 py-1.5 rounded-full text-xs font-semibold border ${X===0?"bg-emerald-500 text-white border-emerald-300/60 shadow-md":"bg-white/10 text-white border-white/20"}`,children:V},V))})]})]})}),r.jsx("div",{className:"flex flex-col items-start lg:items-end gap-2 text-white"})]}),r.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-4 gap-3",children:O.map(V=>r.jsxs("div",{className:`relative overflow-hidden rounded-2xl border ${P(V.tone)} p-4 backdrop-blur-sm`,children:[r.jsx("div",{className:"absolute right-3 top-3 text-xl opacity-20",children:"•"}),r.jsx("div",{className:`text-xs uppercase tracking-[0.1em] font-semibold ${p}`,children:V.label}),r.jsx("div",{className:`mt-2 text-2xl font-bold ${w}`,children:V.value}),r.jsx("div",{className:`text-sm ${p}`,children:V.meta})]},V.label))})]})]}),r.jsxs("div",{className:`rounded-2xl p-6 sm:p-7 ${ee} ${v} border ${C}`,children:[r.jsxs("div",{className:"flex flex-col gap-2 mb-4",children:[r.jsx("p",{className:`text-xs uppercase tracking-[0.12em] ${E}`,children:"Методика"}),r.jsx("h3",{className:`text-2xl font-bold ${M}`,children:"Как мы строим эффективность команды?"}),r.jsx("p",{className:`text-sm ${E}`,children:"Четыре зоны, которые показывают, где сейчас участник и что делать дальше."})]}),r.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-4 gap-3",children:N.map(V=>r.jsxs("div",{className:`rounded-xl border ${V.bg} p-3 transition`,children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsx("span",{className:`text-xs font-semibold ${E}`,children:V.label}),r.jsx("span",{className:"text-lg",children:"•"})]}),r.jsx("p",{className:`text-base font-semibold ${V.tone}`,children:V.title}),r.jsx("p",{className:`text-sm ${E}`,children:V.desc})]},V.label))})]}),r.jsxs("div",{className:`rounded-2xl p-6 sm:p-7 ${ee} ${v} border ${C}`,children:[r.jsxs("div",{className:"flex flex-col gap-2 mb-4",children:[r.jsx("p",{className:`text-xs uppercase tracking-[0.12em] ${E}`,children:"Рекомендации"}),r.jsx("h3",{className:`text-2xl font-bold ${M}`,children:"Что улучшить каждому"}),r.jsx("p",{className:`text-sm ${E}`,children:"Динамические подсказки на основе текущих метрик рейтинга."})]}),r.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-3",children:b.map(V=>{const X=j(V),S=te(V.userId),R=V.rating>=80?"bg-emerald-500":V.rating>=60?"bg-blue-500":V.rating>=40?"bg-amber-500":"bg-rose-500",K=V.rating>=80?"Эталон":V.rating>=60?"Уверенно":V.rating>=40?"В пути":"Зона роста";return r.jsxs("div",{className:"rounded-xl border border-white/10 bg-white/5 p-4 space-y-3",children:[r.jsxs("div",{className:"flex items-center justify-between gap-2",children:[r.jsxs("div",{className:"min-w-0",children:[r.jsx("p",{className:`text-xs uppercase tracking-[0.12em] ${E}`,children:K}),r.jsx("h4",{className:`text-lg font-bold ${M} truncate`,children:S})]}),r.jsx("div",{className:"text-right",children:r.jsxs("div",{className:"text-2xl font-bold text-white",children:[V.rating.toFixed(1),"%"]})})]}),r.jsx("div",{className:"w-full bg-white/5 rounded-full h-3 overflow-hidden border border-white/10",children:r.jsx("div",{className:`h-full ${R}`,style:{width:`${Math.min(V.rating,100)}%`}})}),r.jsx("ul",{className:"space-y-1 text-sm text-white/80",children:X.map((U,Q)=>r.jsxs("li",{className:"flex items-start gap-2",children:[r.jsx("span",{className:"text-xs mt-0.5",children:"•"}),r.jsx("span",{children:U})]},Q))})]},V.userId)})})]}),r.jsxs("div",{className:`rounded-2xl p-6 sm:p-7 ${ee} ${v} border ${C}`,children:[r.jsxs("div",{className:"flex flex-col gap-2 mb-4",children:[r.jsx("p",{className:`text-xs uppercase tracking-[0.12em] ${E}`,children:"Активность"}),r.jsx("h3",{className:`text-2xl font-bold ${M}`,children:"Последняя активность на сайте"}),r.jsx("p",{className:`text-sm ${E}`,children:"Информация о последнем посещении каждого участника."})]}),k.length>0?r.jsx("div",{className:"overflow-auto rounded-xl border border-white/10 bg-white/5",children:r.jsxs("table",{className:"min-w-[800px] w-full text-sm text-white/90",children:[r.jsx("thead",{className:"bg-white/5 text-white/70 text-left",children:r.jsxs("tr",{children:[r.jsx("th",{className:"py-3 px-4 font-semibold",children:"Участник"}),r.jsx("th",{className:"py-3 px-4 font-semibold",children:"Последний вход"}),r.jsx("th",{className:"py-3 px-4 font-semibold",children:"Браузер"}),r.jsx("th",{className:"py-3 px-4 font-semibold",children:"Время на сайте"}),r.jsx("th",{className:"py-3 px-4 font-semibold",children:"Выход"}),r.jsx("th",{className:"py-3 px-4 font-semibold",children:"Статус"})]})}),r.jsx("tbody",{children:De.map(V=>{const X=k.find(K=>K.userId===V.id),S=K=>{if(!K)return"—";const U=Math.floor(K/3600),Q=Math.floor(K%3600/60),$=K%60;return U>0?`${U}ч ${Q}м ${$}с`:Q>0?`${Q}м ${$}с`:`${$}с`},R=K=>{try{const U=new Date(K);return le(U,"dd.MM.yyyy HH:mm")}catch{return K}};return r.jsxs("tr",{className:"border-t border-white/10 hover:bg-white/5 transition-colors",children:[r.jsx("td",{className:"py-3 px-4 font-semibold text-white whitespace-nowrap",children:gt(V.id)}),r.jsx("td",{className:"py-3 px-4 text-white/80 whitespace-nowrap",children:X?R(X.loginAt):"—"}),r.jsx("td",{className:"py-3 px-4 text-white/80 whitespace-nowrap",children:(X==null?void 0:X.browser)||"—"}),r.jsx("td",{className:"py-3 px-4 text-white/80 whitespace-nowrap",children:X?S(X.sessionDuration):"—"}),r.jsx("td",{className:"py-3 px-4 text-white/80 whitespace-nowrap",children:X!=null&&X.logoutAt?R(X.logoutAt):X!=null&&X.isActive?"Активен":"—"}),r.jsx("td",{className:"py-3 px-4 whitespace-nowrap",children:X!=null&&X.isActive?r.jsx("span",{className:"px-2 py-1 rounded-lg text-xs font-semibold bg-emerald-500/20 text-emerald-200 border border-emerald-400/30",children:"Онлайн"}):r.jsx("span",{className:"px-2 py-1 rounded-lg text-xs font-semibold bg-gray-500/20 text-gray-300 border border-gray-400/30",children:"Офлайн"})})]},V.id)})})]})}):r.jsx("div",{className:"rounded-xl border border-white/10 bg-white/5 p-4 text-white/70",children:"Данные об активности пока отсутствуют."}),r.jsxs("div",{className:"mt-6",children:[r.jsxs("div",{className:"flex flex-col gap-2 mb-4",children:[r.jsx("p",{className:`text-xs uppercase tracking-[0.12em] ${E}`,children:"Статистика"}),r.jsx("h4",{className:`text-xl font-bold ${M}`,children:"Активность за последние 24 часа"}),r.jsx("p",{className:`text-sm ${E}`,children:"Сводная информация о посещениях за сутки."})]}),D.length>0?r.jsx("div",{className:"overflow-auto rounded-xl border border-white/10 bg-white/5",children:r.jsxs("table",{className:"min-w-[700px] w-full text-sm text-white/90",children:[r.jsx("thead",{className:"bg-white/5 text-white/70 text-left",children:r.jsxs("tr",{children:[r.jsx("th",{className:"py-3 px-4 font-semibold",children:"Участник"}),r.jsx("th",{className:"py-3 px-4 font-semibold",children:"Входов"}),r.jsx("th",{className:"py-3 px-4 font-semibold",children:"Общее время"}),r.jsx("th",{className:"py-3 px-4 font-semibold",children:"Среднее время сессии"}),r.jsx("th",{className:"py-3 px-4 font-semibold",children:"Последний вход"})]})}),r.jsx("tbody",{children:De.map(V=>{const X=D.filter(ce=>ce.userId===V.id),S=ce=>{if(!ce)return"—";const we=Math.floor(ce/3600),G=Math.floor(ce%3600/60),oe=ce%60;return we>0?`${we}ч ${G}м ${oe}с`:G>0?`${G}м ${oe}с`:`${oe}с`},R=ce=>{try{const we=new Date(ce);return le(we,"dd.MM.yyyy HH:mm")}catch{return ce}},K=X.length,U=X.reduce((ce,we)=>ce+(we.sessionDuration||0),0),Q=K>0?Math.floor(U/K):0,$=X.length>0?X.reduce((ce,we)=>new Date(we.loginAt)>new Date(ce.loginAt)?we:ce):null;return r.jsxs("tr",{className:"border-t border-white/10 hover:bg-white/5 transition-colors",children:[r.jsx("td",{className:"py-3 px-4 font-semibold text-white whitespace-nowrap",children:gt(V.id)}),r.jsx("td",{className:"py-3 px-4 text-white/80 whitespace-nowrap text-center",children:K>0?K:"—"}),r.jsx("td",{className:"py-3 px-4 text-white/80 whitespace-nowrap",children:U>0?S(U):"—"}),r.jsx("td",{className:"py-3 px-4 text-white/80 whitespace-nowrap",children:Q>0?S(Q):"—"}),r.jsx("td",{className:"py-3 px-4 text-white/80 whitespace-nowrap",children:$?R($.loginAt):"—"})]},V.id)})})]})}):r.jsx("div",{className:"rounded-xl border border-white/10 bg-white/5 p-4 text-white/70",children:"За последние 24 часа активности не зафиксировано."})]})]}),r.jsxs("div",{id:"rating-ref",className:`rounded-2xl p-6 sm:p-7 ${ee} ${v} border ${C}`,children:[r.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between mb-4",children:[r.jsxs("div",{className:"space-y-1",children:[r.jsx("p",{className:`text-xs uppercase tracking-[0.12em] ${E}`,children:"Рефералы · 30 дней"}),r.jsx("h3",{className:`text-2xl font-bold ${M}`,children:"Привлеченные участники"}),r.jsxs("p",{className:`text-sm ${E}`,children:["Всего добавлено: ",r.jsx("span",{className:"font-semibold",children:c.length})]})]}),r.jsxs("button",{onClick:J,className:"px-4 py-3 rounded-xl transition-all duration-200 flex items-center justify-center gap-2 font-semibold shadow-md w-full sm:w-auto border border-indigo-200/70 bg-indigo-50 text-indigo-900 hover:bg-indigo-100 dark:bg-indigo-500/15 dark:border-indigo-400/30 dark:text-indigo-50",children:[r.jsx("span",{className:"text-xl",children:"➕"}),r.jsx("span",{children:"Добавить реферала"})]})]}),c.length?r.jsx("div",{className:"overflow-auto rounded-xl border border-white/10 bg-white/5",children:r.jsxs("table",{className:"min-w-[820px] w-full text-sm text-white/90",children:[r.jsx("thead",{className:"bg-white/5 text-white/70 text-left",children:r.jsxs("tr",{children:[r.jsx("th",{className:"py-3 px-4 font-semibold",children:"Кто привел"}),r.jsx("th",{className:"py-3 px-4 font-semibold",children:"Код"}),r.jsx("th",{className:"py-3 px-4 font-semibold",children:"Имя"}),r.jsx("th",{className:"py-3 px-4 font-semibold",children:"Комментарий"}),r.jsx("th",{className:"py-3 px-4 font-semibold text-right",children:"Действия"})]})}),r.jsx("tbody",{children:c.map(V=>{const X=te(V.ownerId),S=t||V.ownerId===(e==null?void 0:e.id);return r.jsxs("tr",{className:"border-t border-white/10 hover:bg-white/5 transition-colors",children:[r.jsx("td",{className:"py-3 px-4 font-semibold text-white whitespace-nowrap",children:X}),r.jsx("td",{className:"py-3 px-4 text-white/80 whitespace-nowrap",children:V.referralId}),r.jsx("td",{className:"py-3 px-4 text-white/80",children:V.name}),r.jsx("td",{className:"py-3 px-4 text-white/70",children:V.comment||"—"}),r.jsxs("td",{className:"py-3 px-4 text-right whitespace-nowrap flex items-center justify-end gap-2",children:[r.jsx("button",{onClick:()=>S&&fe(V),className:`px-3 py-1.5 rounded-lg text-xs font-semibold border border-white/20 bg-white/10 text-white transition ${S?"hover:bg-white/20":"opacity-40 cursor-not-allowed"}`,disabled:!S,children:"Редактировать"}),r.jsx("button",{onClick:()=>S&&F(V),className:`px-3 py-1.5 rounded-lg text-xs font-semibold border border-rose-300/60 bg-rose-500/20 text-rose-50 transition ${S?"hover:bg-rose-500/30":"opacity-40 cursor-not-allowed"}`,disabled:!S,children:"Удалить"})]})]},V.id)})})]})}):r.jsx("div",{className:"rounded-xl border border-white/10 bg-white/5 p-4 text-white/70",children:"Пока нет рефералов."})]}),r.jsxs("div",{id:"rating-method",className:`rounded-2xl p-6 sm:p-7 ${ee} ${v} border ${C}`,children:[r.jsx("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between mb-4",children:r.jsxs("div",{className:"space-y-1",children:[r.jsx("p",{className:`text-xs uppercase tracking-[0.12em] ${E}`,children:"Карточки участников"}),r.jsx("h3",{className:`text-2xl font-bold ${M}`,children:"Детальная статистика"})]})}),i?r.jsxs("div",{className:`rounded-xl p-12 text-center ${s==="dark"?"bg-white/5":"bg-gray-50"} border ${C}`,children:[r.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-4 border-emerald-500 border-t-transparent mx-auto mb-4"}),r.jsx("p",{className:`text-lg font-semibold ${M}`,children:"Загрузка рейтинга..."}),r.jsx("p",{className:`text-sm ${E} mt-2`,children:"Подождите, собираем статистику"})]}):r.jsxs(r.Fragment,{children:[r.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3 mb-6",children:[{label:"Топ-1",value:(ne=b[0])!=null&&ne.rating?`${b[0].rating.toFixed(1)}%`:"—"},{label:"Средний рейтинг",value:`${L.toFixed(1)}%`},{label:"Медиана",value:`${y.median.toFixed(1)}%`},{label:"Участников",value:b.length}].map(V=>r.jsxs("div",{className:`rounded-xl border ${C} ${s==="dark"?"bg-white/5":"bg-gray-50"} px-4 py-3`,children:[r.jsx("p",{className:`text-[11px] uppercase tracking-wide ${E}`,children:V.label}),r.jsx("p",{className:`text-2xl font-extrabold ${M}`,children:V.value})]},V.label))}),r.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-2 gap-6",children:b.map((V,X)=>r.jsx("div",{children:r.jsx(Xj,{rating:V,place:{rank:X+1}})},V.userId))})]})]})]}),h&&r.jsx(Jj,{referral:x,onClose:()=>{m(!1),f(null)},onSave:()=>{m(!1),f(null),H()}})]})},Ao={trading:nx,learning:pa,technical:lx,stream:Ex,research:ux,organization:ox},e4=({onClose:s,onSave:e,editingTask:t})=>{var S,R;const{user:n}=pt(),{theme:a}=at(),i=!!t,o=a==="dark"?"text-white":"text-gray-900",c=a==="dark"?"bg-[#1a1a1a]":"bg-white",d=a==="dark"?"bg-gray-800":"bg-gray-50",h=a==="dark"?"border-gray-800":"border-gray-300",[m,x]=I.useState((t==null?void 0:t.title)||""),[f,k]=I.useState((t==null?void 0:t.description)||""),[A,D]=I.useState((t==null?void 0:t.category)||"trading"),[T,H]=I.useState((t==null?void 0:t.priority)||"medium"),[L,E]=I.useState((t==null?void 0:t.expectedResult)||""),[M,ee]=I.useState((t==null?void 0:t.dueDate)||le(new Date,"yyyy-MM-dd")),[C,v]=I.useState((t==null?void 0:t.dueTime)||"12:00"),p=K=>({...K,assignees:K.assignees||[],approvals:K.approvals||[],requiresApproval:K.requiresApproval??!0,stagePriority:K.stagePriority||"medium",status:K.status||"pending"}),[w,N]=I.useState((S=t==null?void 0:t.stages)!=null&&S.length?t.stages.map(p):[p({id:"stage-1",name:"Этап 1",description:"",responsible:"all",assignees:[],approvals:[],stagePriority:"medium",requiresApproval:!0,status:"pending"})]),[j,b]=I.useState((t==null?void 0:t.currentStageId)||((R=w[0])==null?void 0:R.id)||"stage-1"),[y,re]=I.useState(""),[ue,W]=I.useState(!1);ms();const O=[{value:"urgent",label:"Экстренный",desc:"Нужно прямо сейчас",tone:a==="dark"?"bg-rose-600/20 border-rose-500/50 text-rose-100":"bg-rose-50 border-rose-200 text-rose-700"},{value:"high",label:"Высокий",desc:"Быстрый старт",tone:a==="dark"?"bg-red-500/15 border-red-500/40 text-red-100":"bg-red-50 border-red-200 text-red-700"},{value:"medium",label:"Средний",desc:"Плановый слот",tone:a==="dark"?"bg-amber-500/15 border-amber-500/40 text-amber-100":"bg-amber-50 border-amber-200 text-amber-700"},{value:"low",label:"Низкий",desc:"Фон",tone:a==="dark"?"bg-gray-500/15 border-gray-500/40 text-gray-100":"bg-gray-50 border-gray-200 text-gray-700"}],P=(K,U)=>{N(Q=>Q.map($=>$.id===K?{...$,...U}:$))},te=(K,U)=>{N(Q=>Q.map($=>$.id!==K?$:$.assignees.find(we=>we.userId===U)?{...$,assignees:$.assignees.filter(we=>we.userId!==U)}:$.assignees.length>=10?$:{...$,assignees:[...$.assignees,{userId:U,priority:"medium"}]}))},J=(K,U,Q,$)=>{N(ce=>ce.map(we=>{if(we.id!==K)return we;const G=we.assignees.map(oe=>oe.userId===U?{...oe,[Q]:$}:oe);return{...we,assignees:G}}))},fe=()=>{const K=p({id:`stage-${Date.now()}`,name:`Этап ${w.length+1}`,description:"",responsible:"all",assignees:[],approvals:[],stagePriority:"medium",requiresApproval:!0,status:"pending"});N(U=>[...U,K]),j||b(K.id)},F=K=>{var Q;if(w.length===1)return;const U=w.filter($=>$.id!==K);N(U),j===K&&b(((Q=U[0])==null?void 0:Q.id)||"")},ne=()=>m.trim()?!M||!C?"Укажите дедлайн (дата и время)":new Set(w.flatMap(U=>U.assignees.map(Q=>Q.userId))).size===0?"Добавьте исполнителей в этапах":"":"Введите название задачи",V=(K,U)=>{const Q=K.assignees,$=Q.map(we=>we.userId),ce=$.map(we=>{const G=Q.find(oe=>oe.userId===we);return{userId:we,status:"pending",updatedAt:U,...G!=null&&G.comment?{comment:G.comment}:{}}});return{id:K.id,name:K.name,description:K.description,responsible:$,assignees:Q,stagePriority:K.stagePriority||"medium",requiresApproval:!0,approvals:ce,comments:K.comments||[],status:"pending"}},X=async()=>{var Q;const K=ne();if(K){re(K);return}if(!n){re("Пользователь не найден");return}re(""),W(!0);const U=new Date().toISOString();try{const $=w.map(oe=>V(oe,U)),ce=Array.from(new Set($.flatMap(oe=>{var _e;return((_e=oe.assignees)==null?void 0:_e.map(Te=>Te.userId))||[]}))),we=ce.map(oe=>({userId:oe,status:"pending",updatedAt:U})),G={title:m.trim(),description:f.trim()||void 0,category:A,priority:T,assignedTo:ce,assignees:ce.map(oe=>({userId:oe,priority:"medium"})),approvals:we,stages:$,currentStageId:j||((Q=$[0])==null?void 0:Q.id),dueDate:M,dueTime:C,expectedResult:L.trim()||void 0,updatedAt:U};if(i&&t)await Xr(t.id,G);else{const oe={...G,status:"in_progress",createdBy:n.id,createdAt:U};await hj(oe)}e()}catch($){console.error("Error saving task:",$),re("Ошибка при сохранении задачи")}finally{W(!1)}};return r.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-start sm:items-center justify-center z-[70] p-4 overflow-y-auto overscroll-contain modal-scroll touch-pan-y",children:r.jsx("div",{className:`${c} rounded-xl sm:rounded-2xl shadow-2xl w-full max-w-2xl max-h-[calc(100vh-48px)] sm:max-h-[calc(100vh-64px)] overflow-y-auto border-2 touch-pan-y ${a==="dark"?"border-[#4E6E49]/30 bg-gradient-to-br from-[#1a1a1a] via-[#1a1a1a] to-[#0A0A0A]":"border-green-200 bg-gradient-to-br from-white via-green-50/30 to-white"} relative`,children:r.jsxs("div",{className:"flex flex-col h-full min-h-0",children:[r.jsxs("div",{className:`sticky top-0 ${c} border-b ${h} p-4 sm:p-6 flex items-center justify-between z-10`,children:[r.jsxs("h2",{className:`text-xl sm:text-2xl font-bold ${o} flex items-center gap-2`,children:[r.jsx(zh,{className:"w-5 h-5 sm:w-6 sm:h-6"}),i?"Редактировать задачу":"Новая задача"]}),r.jsx("button",{onClick:s,className:`p-2 rounded-lg transition-colors ${a==="dark"?"hover:bg-gray-700":"hover:bg-gray-100"}`,children:r.jsx(Pt,{className:"w-5 h-5"})})]}),r.jsxs("div",{className:"p-4 sm:p-6 space-y-4 sm:space-y-6 flex-1 min-h-0 overflow-y-auto overscroll-contain modal-scroll touch-pan-y pb-10",children:[y&&r.jsxs("div",{className:"p-3 rounded-lg bg-red-500/10 border border-red-500/30 flex items-center gap-2 text-red-500",children:[r.jsx(wx,{className:"w-5 h-5 flex-shrink-0"}),r.jsx("span",{className:"text-sm",children:y})]}),r.jsxs("div",{children:[r.jsx("label",{className:`block text-sm font-medium mb-2 ${o}`,children:"Название *"}),r.jsx("input",{value:m,onChange:K=>x(K.target.value),className:`w-full px-4 py-2.5 rounded-lg border ${h} ${d} ${o} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]/50`,placeholder:"Введите название задачи"})]}),r.jsxs("div",{children:[r.jsx("label",{className:`block text-sm font-medium mb-2 ${o}`,children:"Описание"}),r.jsx("textarea",{value:f,onChange:K=>k(K.target.value),rows:4,className:`w-full px-4 py-2.5 rounded-lg border ${h} ${d} ${o} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]/50`,placeholder:"Кратко опишите задачу"})]}),r.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[r.jsxs("div",{className:"space-y-3",children:[r.jsxs("label",{className:`block text-sm font-medium ${o} flex items-center gap-2`,children:[r.jsx($x,{className:"w-4 h-4"}),"Категория"]}),r.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2 sm:gap-3",children:Object.entries(ga).map(([K,{label:U}])=>{const Q=Ao[K],$=A===K;return r.jsxs("button",{type:"button",onClick:()=>D(K),className:`p-3 rounded-lg border-2 text-sm font-semibold transition-all text-center ${$?a==="dark"?"border-[#4E6E49] bg-[#4E6E49]/15 text-[#4E6E49]":"border-[#4E6E49] bg-green-50 text-[#4E6E49]":a==="dark"?"border-gray-800 bg-gray-900 text-gray-200 hover:border-[#4E6E49]/40":"border-gray-200 bg-white text-gray-800 hover:border-[#4E6E49]/40"} flex items-center justify-center gap-2`,children:[r.jsx(Q,{className:"w-4 h-4"}),r.jsx("span",{children:U})]},K)})})]}),r.jsxs("div",{className:"space-y-3",children:[r.jsxs("label",{className:`block text-sm font-medium ${o} flex items-center gap-2`,children:[r.jsx(nr,{className:"w-4 h-4"}),"Приоритет"]}),r.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2",children:O.map(K=>r.jsxs("button",{type:"button",onClick:()=>H(K.value),className:`p-3 rounded-lg border-2 text-left transition-all ${K.tone} ${T===K.value?"ring-2 ring-offset-2 ring-[#4E6E49] dark:ring-offset-[#1a1a1a]":""}`,children:[r.jsxs("div",{className:"flex items-center justify-between gap-2",children:[r.jsx("span",{className:"font-semibold text-sm",children:K.label}),T===K.value&&r.jsx("span",{className:"text-xs font-semibold",children:"выбрано"})]}),r.jsx("p",{className:"text-xs mt-1 opacity-80",children:K.desc})]},K.value))})]})]}),r.jsxs("div",{className:"space-y-3",children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsx("label",{className:`block text-sm font-medium ${o}`,children:"Этапы и исполнители"}),r.jsxs("button",{type:"button",onClick:fe,className:`px-3 py-1.5 rounded-lg text-xs font-semibold ${a==="dark"?"bg-gray-700 hover:bg-gray-600 text-gray-200":"bg-gray-200 hover:bg-gray-300 text-gray-800"}`,children:[r.jsx(is,{className:"w-4 h-4 inline"})," Добавить этап"]})]}),r.jsx("div",{className:"space-y-3",children:w.map((K,U)=>r.jsxs("div",{className:`p-3 rounded-lg border-2 ${h} ${d}`,children:[r.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[r.jsx("input",{value:K.name,onChange:Q=>P(K.id,{name:Q.target.value}),className:`flex-1 px-3 py-2 rounded-lg border ${h} ${a==="dark"?"bg-[#0f0f0f] text-gray-100":"bg-white text-gray-800"}`,placeholder:`Этап ${U+1}`}),w.length>1&&r.jsx("button",{onClick:()=>F(K.id),className:`p-2 rounded-lg ${a==="dark"?"bg-red-500/20 text-red-200":"bg-red-100 text-red-700"}`,children:r.jsx(Mx,{className:"w-4 h-4"})})]}),r.jsx("textarea",{value:K.description||"",onChange:Q=>P(K.id,{description:Q.target.value}),rows:2,className:`w-full px-3 py-2 rounded-lg border ${h} ${a==="dark"?"bg-[#0f0f0f] text-gray-100":"bg-white text-gray-800"}`,placeholder:"Описание этапа (опционально)"}),r.jsxs("div",{className:"mt-3 space-y-2",children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("label",{className:`text-sm font-medium ${o} flex items-center gap-2`,children:[r.jsx(Pn,{className:"w-4 h-4"}),"Исполнители этапа"]}),r.jsxs("span",{className:"text-[11px] text-gray-500",children:[K.assignees.length,"/10"]})]}),r.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-2",children:De.map(Q=>{const $=K.assignees.some(ce=>ce.userId===Q.id);return r.jsx("button",{type:"button",onClick:()=>te(K.id,Q.id),className:`p-2 rounded-lg border text-left text-sm transition-all ${$?a==="dark"?"border-[#4E6E49] bg-[#4E6E49]/20":"border-[#4E6E49] bg-green-50":`${h} ${d}`}`,children:r.jsx("span",{className:$?"text-[#4E6E49]":o,children:gt(Q.id)})},Q.id)})}),K.assignees.length>0&&r.jsx("div",{className:"space-y-2",children:K.assignees.map(Q=>{const $=De.find(ce=>ce.id===Q.userId);return r.jsxs("div",{className:`p-2 rounded-lg border ${h} ${a==="dark"?"bg-[#0f0f0f]":"bg-white"}`,children:[r.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2",children:[r.jsx("div",{className:"text-sm font-medium",children:($==null?void 0:$.name)||Q.userId}),r.jsxs("select",{value:Q.priority,onChange:ce=>J(K.id,Q.userId,"priority",ce.target.value),className:`px-3 py-1.5 rounded-lg border ${h} ${a==="dark"?"bg-[#1a1a1a] text-gray-100":"bg-white text-gray-700"}`,children:[r.jsx("option",{value:"urgent",children:"Экстренный"}),r.jsx("option",{value:"high",children:"Высокий"}),r.jsx("option",{value:"medium",children:"Средний"}),r.jsx("option",{value:"low",children:"Низкий"})]})]}),r.jsx("textarea",{value:Q.comment||"",onChange:ce=>J(K.id,Q.userId,"comment",ce.target.value),rows:2,className:`mt-2 w-full px-3 py-2 rounded-lg border ${h} ${a==="dark"?"bg-[#1a1a1a] text-gray-100":"bg-white text-gray-700"}`,placeholder:"Комментарий для исполнителя (опционально)"})]},Q.userId)})})]})]},K.id))})]}),r.jsxs("div",{children:[r.jsxs("label",{className:`block text-sm font-medium mb-2 ${o} flex items-center gap-2`,children:[r.jsx(Qt,{className:"w-4 h-4"}),"Какой результат должен быть"]}),r.jsx("textarea",{value:L,onChange:K=>E(K.target.value),rows:3,className:`w-full px-4 py-2.5 rounded-lg border ${h} ${d} ${o} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]/50`,placeholder:"Опишите ожидаемый итог"})]}),r.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[r.jsxs("div",{className:"space-y-1",children:[r.jsxs("label",{className:`text-sm font-medium ${o} flex items-center gap-2`,children:[r.jsx(Tr,{className:"w-4 h-4"}),"Дата дедлайна *"]}),r.jsx("input",{type:"date",value:M,onChange:K=>ee(K.target.value),min:le(new Date,"yyyy-MM-dd"),className:`w-full px-4 py-2.5 rounded-lg border ${h} ${d} ${o} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]/50`})]}),r.jsxs("div",{className:"space-y-1",children:[r.jsxs("label",{className:`text-sm font-medium ${o} flex items-center gap-2`,children:[r.jsx(Sr,{className:"w-4 h-4"}),"Время дедлайна *"]}),r.jsx("input",{type:"time",value:C,onChange:K=>v(K.target.value),className:`w-full px-4 py-2.5 rounded-lg border ${h} ${d} ${o} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]/50`})]})]}),r.jsxs("div",{className:`flex flex-col sm:flex-row gap-3 pt-4 border-t ${h}`,children:[r.jsx("button",{onClick:X,disabled:ue,className:`flex-1 px-6 py-3 rounded-lg font-semibold transition-all ${ue?"bg-gray-400 cursor-not-allowed":"bg-gradient-to-r from-[#4E6E49] to-emerald-700 hover:from-[#4E6E49] hover:to-emerald-700 text-white shadow-lg hover:shadow-xl transform hover:scale-[1.02]"}`,children:ue?"Сохранение...":i?"Сохранить":"Создать задачу"}),r.jsx("button",{onClick:s,className:`px-6 py-3 rounded-lg font-semibold transition-colors ${a==="dark"?"bg-gray-700 hover:bg-gray-600 text-gray-300":"bg-gray-200 hover:bg-gray-300 text-gray-700"}`,children:"Отмена"})]})]})]})})})},Zc=60*1e3,Ia=60*Zc,Sh=24*Ia,t4=s=>{if(s<=0)return"Просрочено";const e=Math.floor(s/Sh),t=Math.floor(s%Sh/Ia),n=Math.floor(s%Ia/Zc);return e>0?`${e}д ${t}ч`:t>0?`${t}ч ${n}м`:`${Math.max(n,1)}м`},r4=s=>s<=0?"overdue":s<=Ia?"urgent":s<=6*Ia?"soon":"on_track",ll=(s,e)=>{if(!s||!e)return{label:"—",status:"unknown",isOverdue:!1};const n=new Date(`${s}T${e}`).getTime()-Date.now();if(Number.isNaN(n))return{label:"—",status:"unknown",isOverdue:!1};const a=r4(n);return{label:t4(n),status:a,isOverdue:a==="overdue"}},s4=(s,e)=>{const t=I.useMemo(()=>ll(s,e),[s,e]),[n,a]=I.useState(t);return I.useEffect(()=>{a(ll(s,e));const i=setInterval(()=>{a(ll(s,e))},Zc);return()=>clearInterval(i)},[s,e]),n},n4=(s,e)=>e==="dark"?{overdue:"bg-red-500/10 border-red-500/40 text-red-300",urgent:"bg-orange-500/10 border-orange-500/40 text-orange-200",soon:"bg-yellow-500/10 border-yellow-500/40 text-yellow-200",on_track:"bg-[#4E6E49]/10 border-[#4E6E49]/40 text-green-200",unknown:"bg-gray-600/30 border-gray-500/40 text-gray-200"}[s]:{overdue:"bg-red-50 border-red-200 text-red-600",urgent:"bg-orange-50 border-orange-200 text-orange-600",soon:"bg-yellow-50 border-yellow-200 text-yellow-700",on_track:"bg-green-50 border-green-200 text-[#4E6E49]",unknown:"bg-gray-100 border-gray-200 text-gray-600"}[s],q0=({dueDate:s,dueTime:e,theme:t,size:n="default"})=>{const{label:a,status:i}=s4(s,e),o=n4(i,t),c=n==="compact"?"px-2 py-0.5 text-[11px]":"px-2.5 py-1 text-xs sm:text-sm",d=n==="compact"?"w-3 h-3":"w-4 h-4";return r.jsxs("span",{className:`inline-flex items-center gap-1 rounded-full border font-medium ${c} ${o}`,children:[r.jsx(Sr,{className:d}),a]})},a4=({task:s,onEdit:e,onDelete:t,onUpdate:n})=>{const{user:a}=pt(),{isAdmin:i}=kt(),{theme:o}=at(),[c,d]=I.useState(!1),[h,m]=I.useState(!1),[x,f]=I.useState(""),k=o==="dark"?"text-white":"text-gray-900",A=o==="dark"?"bg-[#1a1a1a]":"bg-white",D=o==="dark"?"border-gray-800":"border-gray-300",T=ga[s.category],H=zs[s.status],L=Ao[s.category],E=s.assignees&&s.assignees.length>0?s.assignees:s.assignedTo.map(F=>({userId:F,priority:"medium"})),M=E.map(F=>F.userId),ee=E.map(F=>{const ne=De.find(V=>V.id===F.userId);return ne?{...F,member:ne}:null}).filter(Boolean),C=i||(a==null?void 0:a.id)===s.createdBy||s.mainExecutor===(a==null?void 0:a.id),v=()=>{const F=new Date().toISOString(),V=(s.approvals||[]).filter(S=>M.includes(S.userId)).map(S=>({userId:S.userId,status:S.status==="approved"?"approved":"pending",updatedAt:S.updatedAt||F,...S.comment?{comment:S.comment}:{}})),X=M.filter(S=>!V.some(R=>R.userId===S)).map(S=>({userId:S,status:"pending",updatedAt:F}));return[...V,...X]},p=()=>!!a&&M.includes(a.id),w=()=>i||(a==null?void 0:a.id)===s.createdBy,N=()=>{const F=v(),ne=F.filter(V=>V.status==="approved").length;return{approvals:F,approved:ne,total:M.length}},{approvals:j,approved:b,total:y}=N(),re=j.find(F=>F.userId===(a==null?void 0:a.id)),ue=p()&&s.status==="in_progress"&&(!re||re.status!=="approved"),W=w()&&s.status==="completed",O=async()=>{if(!(!a||s.status!=="in_progress"||!p())){d(!0);try{const F=new Date().toISOString(),ne=v().map(S=>S.userId===a.id?{...S,status:"approved",updatedAt:F}:S),V=M.length>0&&M.every(S=>ne.find(R=>R.userId===S&&R.status==="approved")),X={approvals:ne,updatedAt:F};V&&(X.status="completed",X.completedAt=F,X.completedBy=a.id),await Xr(s.id,X),n()}catch(F){console.error("Error confirming task:",F)}finally{d(!1)}}},P=async()=>{if(!(!w()||s.status!=="completed")){d(!0);try{const F=new Date().toISOString();await Xr(s.id,{status:"closed",closedAt:F,updatedAt:F}),n()}catch(F){console.error("Error closing task:",F)}finally{d(!1)}}},te=async()=>{if(!w())return;const F=(x||"").trim();if(F){d(!0);try{const ne=new Date().toISOString(),V=M.map(S=>({userId:S,status:"pending",updatedAt:ne})),X={id:`c-${Date.now()}`,userId:(a==null?void 0:a.id)||"system",text:F,createdAt:ne};await Xr(s.id,{status:"in_progress",approvals:V,completedAt:void 0,completedBy:void 0,closedAt:void 0,comments:[...s.comments||[],X],updatedAt:ne}),m(!1),f(""),n()}catch(ne){console.error("Error returning task:",ne)}finally{d(!1)}}},J=()=>({in_progress:o==="dark"?"bg-blue-500/20 border-blue-500/50 text-blue-400":"bg-blue-50 border-blue-200 text-blue-700",completed:o==="dark"?"bg-[#4E6E49]/20 border-[#4E6E49]/50 text-[#4E6E49]":"bg-green-50 border-green-200 text-[#4E6E49]",closed:o==="dark"?"bg-gray-500/20 border-gray-500/50 text-gray-400":"bg-gray-50 border-gray-200 text-gray-700"})[s.status],fe=()=>{const F={green:{bg:o==="dark"?"bg-[#4E6E49]/20":"bg-green-50",text:"text-[#4E6E49]"},blue:{bg:o==="dark"?"bg-blue-500/20":"bg-blue-50",text:o==="dark"?"text-blue-400":"text-blue-700"},purple:{bg:o==="dark"?"bg-purple-500/20":"bg-purple-50",text:o==="dark"?"text-purple-400":"text-purple-700"},red:{bg:o==="dark"?"bg-red-500/20":"bg-red-50",text:o==="dark"?"text-red-400":"text-red-700"},yellow:{bg:o==="dark"?"bg-yellow-500/20":"bg-yellow-50",text:o==="dark"?"text-yellow-400":"text-yellow-700"},indigo:{bg:o==="dark"?"bg-indigo-500/20":"bg-indigo-50",text:o==="dark"?"text-indigo-400":"text-indigo-700"}};return F[T.color]||F.green};return r.jsxs(r.Fragment,{children:[r.jsxs("div",{className:`${A} rounded-xl border-2 ${D} p-4 sm:p-6 shadow-lg hover:shadow-xl transition-all ${o==="dark"?"hover:border-[#4E6E49]/50":"hover:border-[#4E6E49]"}`,children:[r.jsxs("div",{className:"flex items-start justify-between gap-3 mb-3",children:[r.jsxs("div",{className:"flex-1 min-w-0",children:[r.jsx("div",{className:"flex items-center gap-2 mb-2",children:r.jsx("h3",{className:`text-lg sm:text-xl font-bold ${k} truncate`,children:s.title})}),r.jsxs("div",{className:"flex flex-wrap items-center gap-2 sm:gap-3",children:[r.jsxs("span",{className:`px-2.5 py-1 rounded-lg text-xs sm:text-sm font-medium ${fe().bg} ${fe().text} inline-flex items-center gap-1.5`,children:[r.jsx(L,{className:"w-4 h-4"}),T.label]}),r.jsx("span",{className:`px-2.5 py-1 rounded-lg text-xs sm:text-sm font-medium border ${J()}`,children:H.label}),r.jsx("span",{className:`px-2.5 py-1 rounded-lg text-xs sm:text-sm font-medium border ${o==="dark"?"border-yellow-500/40 text-yellow-200 bg-yellow-500/10":"border-yellow-200 text-yellow-700 bg-yellow-50"}`,children:s.priority==="urgent"?"Экстренный приоритет":s.priority==="high"?"Высокий приоритет":s.priority==="medium"?"Средний приоритет":"Низкий приоритет"})]})]}),C&&r.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[r.jsx("button",{onClick:()=>e(s),className:`p-2 rounded-lg transition-colors ${o==="dark"?"hover:bg-gray-700":"hover:bg-gray-100"}`,title:"Редактировать",children:r.jsx(Bt,{className:"w-4 h-4"})}),r.jsx("button",{onClick:()=>t(s.id),className:`p-2 rounded-lg transition-colors ${o==="dark"?"hover:bg-red-500/20 text-red-400":"hover:bg-red-50 text-red-600"}`,title:"Удалить",children:r.jsx(At,{className:"w-4 h-4"})})]})]}),s.description&&r.jsx("p",{className:`text-sm ${o==="dark"?"text-gray-300":"text-gray-600"} mb-4 line-clamp-2`,children:s.description}),r.jsxs("div",{className:"space-y-2 mb-4",children:[r.jsxs("div",{className:"flex flex-col gap-3",children:[r.jsxs("div",{className:"flex items-center gap-2 text-xs sm:text-sm",children:[r.jsx(Si,{className:`w-4 h-4 ${o==="dark"?"text-blue-400":"text-blue-600"}`}),r.jsx("span",{className:`font-medium ${o==="dark"?"text-gray-300":"text-gray-700"}`,children:"Автор:"}),r.jsx("span",{className:o==="dark"?"text-gray-400":"text-gray-600",children:s.createdBy?gt(s.createdBy):"Неизвестно"})]}),r.jsxs("div",{children:[r.jsxs("div",{className:"flex items-center gap-2 text-xs sm:text-sm",children:[r.jsx(Pn,{className:"w-4 h-4 text-[#4E6E49]"}),r.jsx("span",{className:`font-medium ${o==="dark"?"text-gray-300":"text-gray-700"}`,children:"Исполнители:"})]}),ee.length>0?r.jsx("div",{className:"mt-2 space-y-1",children:ee.map(F=>r.jsx("div",{className:`text-sm ${o==="dark"?"text-gray-100":"text-gray-800"}`,children:gt(F.member.id)},F.member.id))}):r.jsx("span",{className:"text-gray-500",children:"Не назначены"})]})]}),r.jsxs("div",{className:"flex items-center gap-3 flex-wrap text-xs sm:text-sm",children:[r.jsxs("span",{className:"inline-flex items-center gap-1",children:[r.jsx(Tr,{className:`w-4 h-4 ${o==="dark"?"text-gray-400":"text-gray-500"}`}),r.jsxs("span",{className:o==="dark"?"text-gray-400":"text-gray-600",children:["Дедлайн: ",le(new Date(s.dueDate),"dd.MM.yyyy")," ",s.dueTime]})]}),r.jsx(q0,{dueDate:s.dueDate,dueTime:s.dueTime,theme:o})]}),y>0&&r.jsxs("div",{className:"flex items-center gap-2 text-xs sm:text-sm",children:[r.jsx(so,{className:`w-4 h-4 ${o==="dark"?"text-yellow-400":"text-yellow-600"}`}),r.jsxs("span",{className:o==="dark"?"text-yellow-400":"text-yellow-600",children:["Подтвердили: ",b,"/",y]})]})]}),r.jsxs("div",{className:`mt-4 p-3 rounded-lg border ${D} ${o==="dark"?"bg-[#1a1a1a]/70":"bg-gray-50"}`,children:[r.jsxs("div",{className:"flex items-center justify-between mb-2",children:[r.jsx("span",{className:"text-sm font-semibold",children:"Подтверждения исполнителей"}),r.jsxs("span",{className:"text-xs text-gray-500",children:[b,"/",y]})]}),j.length>0&&r.jsx("div",{className:"space-y-1 text-xs",children:j.map(F=>{const ne=De.find(X=>X.id===F.userId),V=F.status==="approved"?"подтвердил":"ожидает";return r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("span",{className:"flex items-center gap-1",children:[r.jsx("span",{className:"font-medium",children:(ne==null?void 0:ne.name)||F.userId}),r.jsxs("span",{className:"text-gray-500",children:["(",V,")"]})]}),F.comment&&r.jsx("span",{className:"text-gray-500 truncate max-w-[140px]",children:F.comment})]},F.userId)})})]}),r.jsxs("div",{className:`flex flex-wrap gap-2 pt-4 border-t ${D}`,children:[ue&&r.jsxs("button",{onClick:O,disabled:c,className:"flex-1 sm:flex-none px-4 py-2 bg-[#4E6E49] hover:bg-[#4E6E49] text-white rounded-lg text-sm font-medium transition-colors flex items-center justify-center gap-2 disabled:opacity-50",children:[r.jsx(wr,{className:"w-4 h-4"}),"Подтвердить"]}),W&&r.jsxs(r.Fragment,{children:[r.jsxs("button",{onClick:P,disabled:c,className:"flex-1 sm:flex-none px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg text-sm font-medium transition-colors flex items-center justify-center gap-2 disabled:opacity-50",children:[r.jsx($n,{className:"w-4 h-4"}),"Закрыто"]}),r.jsxs("button",{onClick:()=>m(!0),disabled:c,className:"flex-1 sm:flex-none px-4 py-2 bg-red-500 hover:bg-red-600 text-white rounded-lg text-sm font-medium transition-colors flex items-center justify-center gap-2 disabled:opacity-50",children:[r.jsx(Pt,{className:"w-4 h-4"}),"Не выполнено"]})]}),s.status==="completed"&&!W&&r.jsx("span",{className:`text-xs ${o==="dark"?"text-gray-400":"text-gray-600"}`,children:"Ожидает подтверждения автора"})]})]}),h&&r.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-start sm:items-center justify-center z-[70] p-4 overflow-y-auto overscroll-contain modal-scroll",children:r.jsxs("div",{className:`${A} rounded-xl p-6 max-w-md w-full border-2 ${D}`,children:[r.jsx("h3",{className:`text-lg font-bold mb-4 ${k}`,children:"Не выполнено"}),r.jsx("textarea",{value:x,onChange:F=>f(F.target.value),placeholder:"Опишите, что нужно доработать",rows:3,className:`w-full px-4 py-2 rounded-lg border ${D} ${o==="dark"?"bg-gray-700":"bg-gray-50"} ${k} mb-4 focus:outline-none focus:ring-2 focus:ring-[#4E6E49]/50`}),r.jsxs("div",{className:"flex gap-3",children:[r.jsx("button",{onClick:te,disabled:c||!x.trim(),className:"flex-1 px-4 py-2 rounded-lg font-medium transition-colors bg-red-500 hover:bg-red-600 text-white disabled:opacity-50",children:"Отправить на доработку"}),r.jsx("button",{onClick:()=>{m(!1),f("")},className:`px-4 py-2 rounded-lg font-medium transition-colors ${o==="dark"?"bg-gray-700 hover:bg-gray-600":"bg-gray-200 hover:bg-gray-300"}`,children:"Отмена"})]})]})})]})},i4=({selectedCategory:s,selectedStatus:e,selectedUsers:t,onCategoryChange:n,onStatusChange:a,onUsersChange:i,onClear:o})=>{const{theme:c}=at(),d=c==="dark"?"text-white":"text-gray-900",h=c==="dark"?"bg-[#1a1a1a]":"bg-white",m=c==="dark"?"border-gray-800":"border-gray-300",x=s!=="all"||e!=="all"||t.length>0,f=De.filter(D=>t.includes(D.id)).map(D=>D.name),k=[{href:"#filter-status",label:"Статусы"},{href:"#filter-category",label:"Категории"},{href:"#filter-people",label:"Исполнители"}],A={in_progress:r.jsx(Is,{className:"w-4 h-4"}),completed:r.jsx($n,{className:"w-4 h-4"}),closed:r.jsx(ex,{className:"w-4 h-4"})};return r.jsxs("div",{className:`${h} rounded-xl border-2 ${m} p-4 sm:p-6 shadow-lg sticky top-4 space-y-4`,children:[r.jsxs("div",{className:"flex items-start justify-between gap-3",children:[r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx("div",{className:`p-2 rounded-lg ${c==="dark"?"bg-[#4E6E49]/20":"bg-green-50"}`,children:r.jsx(Hh,{className:"w-5 h-5 text-[#4E6E49]"})}),r.jsxs("div",{children:[r.jsx("h3",{className:`text-lg font-bold ${d}`,children:"Фильтры"}),r.jsx("p",{className:`text-xs ${c==="dark"?"text-gray-400":"text-gray-500"}`,children:"Быстрая навигация по статусам, категориям и участникам"})]})]}),x&&r.jsxs("button",{onClick:o,className:`px-3 py-1.5 rounded-lg text-sm transition-all flex items-center gap-2 ${c==="dark"?"bg-red-500/20 hover:bg-red-500/30 text-red-300 border border-red-500/50":"bg-red-50 hover:bg-red-100 text-red-600 border border-red-200"}`,children:[r.jsx(Pt,{className:"w-4 h-4"}),r.jsx("span",{className:"hidden sm:inline",children:"Сбросить всё"})]})]}),r.jsx("div",{className:"flex flex-wrap gap-2",children:k.map(D=>r.jsxs("a",{href:D.href,className:`px-3 py-1.5 rounded-lg text-xs font-semibold border transition flex items-center gap-2 ${c==="dark"?"border-white/10 bg-white/5 text-gray-100 hover:border-[#4E6E49]/50":"border-gray-200 bg-white text-gray-800 hover:border-[#4E6E49]/50 hover:text-[#4E6E49]"}`,children:[r.jsx(Wd,{className:"w-4 h-4"}),D.label]},D.href))}),r.jsxs("div",{className:`rounded-lg border ${m} ${c==="dark"?"bg-[#1f1f1f]":"bg-gray-50"} p-3 space-y-2`,children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(Nx,{className:"w-4 h-4 text-[#4E6E49]"}),r.jsx("p",{className:`text-sm font-semibold ${d}`,children:"Текущая подборка"})]}),r.jsx("div",{className:"flex flex-wrap gap-2",children:x?r.jsxs(r.Fragment,{children:[s!=="all"&&r.jsx("span",{className:"px-2.5 py-1 rounded-full text-xs font-semibold bg-emerald-500/10 text-emerald-700 dark:text-emerald-200 border border-emerald-500/30",children:ga[s].label}),e!=="all"&&r.jsx("span",{className:"px-2.5 py-1 rounded-full text-xs font-semibold bg-sky-500/10 text-sky-700 dark:text-sky-200 border border-sky-500/30",children:zs[e].label}),t.length>0&&r.jsx("span",{className:"px-2.5 py-1 rounded-full text-xs font-semibold bg-purple-500/10 text-purple-700 dark:text-purple-200 border border-purple-500/30",children:f.join(", ")})]}):r.jsx("span",{className:`text-xs ${c==="dark"?"text-gray-400":"text-gray-500"}`,children:"Фильтры не заданы"})})]}),r.jsxs("div",{className:"space-y-6",children:[r.jsxs("div",{id:"filter-status",className:"space-y-3",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(xx,{className:"w-4 h-4 text-yellow-500"}),r.jsx("label",{className:`block text-sm font-semibold ${d}`,children:"Статусы"})]}),r.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[r.jsxs("button",{onClick:()=>a("all"),className:`px-3 py-2 rounded-lg text-sm font-semibold transition-all border-2 ${e==="all"?c==="dark"?"bg-[#4E6E49]/20 border-[#4E6E49] text-[#4E6E49]":"bg-green-50 border-[#4E6E49] text-[#4E6E49]":`${c==="dark"?"bg-gray-800 border-gray-800 text-gray-200 hover:bg-gray-700":"bg-white border-gray-200 text-gray-700 hover:border-[#4E6E49]/40"}`} flex items-center gap-2 justify-start text-left w-full`,children:[r.jsx(Hs,{className:"w-4 h-4"}),"Целиком"]}),Object.entries(zs).map(([D,{label:T,color:H}])=>{const L={yellow:c==="dark"?"bg-yellow-500/10 border-yellow-500/50 text-yellow-300":"bg-yellow-50 border-yellow-500/40 text-yellow-700",blue:c==="dark"?"bg-blue-500/10 border-blue-500/50 text-blue-300":"bg-blue-50 border-blue-500/40 text-blue-700",purple:c==="dark"?"bg-purple-500/10 border-purple-500/50 text-purple-200":"bg-purple-50 border-purple-500/40 text-purple-700",green:c==="dark"?"bg-emerald-500/10 border-emerald-500/50 text-emerald-200":"bg-emerald-50 border-emerald-500/40 text-emerald-700",gray:c==="dark"?"bg-gray-500/10 border-gray-500/50 text-gray-300":"bg-gray-50 border-gray-400/60 text-gray-700",red:c==="dark"?"bg-red-500/10 border-red-500/50 text-red-300":"bg-red-50 border-red-500/40 text-red-700"},E=L[H]||L.gray,M=A[D];return r.jsx("button",{onClick:()=>a(D),className:`px-3 py-2 rounded-lg text-sm font-semibold transition-all border-2 flex items-center justify-start gap-3 text-left ${e===D?E:c==="dark"?"bg-gray-900 border-gray-800 text-gray-200 hover:border-[#4E6E49]/40":"bg-white border-gray-200 text-gray-700 hover:border-[#4E6E49]/40"}`,children:r.jsxs("span",{className:"flex items-center gap-2",children:[M,T]})},D)})]})]}),r.jsxs("div",{id:"filter-category",className:"space-y-3",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(nr,{className:"w-4 h-4 text-purple-500"}),r.jsx("label",{className:`block text-sm font-semibold ${d}`,children:"Категории"})]}),r.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2",children:[r.jsxs("button",{onClick:()=>n("all"),className:`px-3 py-3 rounded-lg text-sm font-semibold transition-all border-2 flex items-center gap-2 justify-start text-left w-full ${s==="all"?c==="dark"?"bg-[#4E6E49]/20 border-[#4E6E49] text-[#4E6E49]":"bg-green-50 border-[#4E6E49] text-[#4E6E49]":`${c==="dark"?"bg-gray-900 border-gray-800 text-gray-200 hover:border-[#4E6E49]/40":"bg-white border-gray-200 text-gray-700 hover:border-[#4E6E49]/40"}`}`,children:[r.jsx(Wd,{className:"w-4 h-4"}),"Всё"]}),Object.entries(ga).map(([D,{label:T}])=>{const H=Ao[D],L=s===D;return r.jsx("button",{onClick:()=>n(D),className:`px-3 py-3 rounded-lg text-sm font-semibold transition-all border-2 flex flex-col items-start gap-2 text-left leading-tight whitespace-normal ${L?c==="dark"?"bg-[#4E6E49]/20 border-[#4E6E49] text-[#4E6E49]":"bg-green-50 border-[#4E6E49] text-[#4E6E49]":`${c==="dark"?"bg-gray-900 border-gray-800 text-gray-200 hover:border-[#4E6E49]/40":"bg-white border-gray-200 text-gray-700 hover:border-[#4E6E49]/40"}`}`,children:r.jsxs("span",{className:"flex items-center gap-2 justify-start",children:[r.jsx(H,{className:"w-4 h-4"}),r.jsx("span",{className:"break-words",children:T})]})},D)})]})]}),r.jsxs("div",{id:"filter-people",className:"space-y-3",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(Pn,{className:"w-4 h-4 text-sky-500"}),r.jsx("label",{className:`block text-sm font-semibold ${d}`,children:"Исполнители"})]}),r.jsxs("div",{className:"flex flex-wrap gap-2",children:[r.jsx("button",{onClick:()=>i([]),className:`px-3 py-2 rounded-lg text-sm font-semibold transition-all border-2 ${t.length===0?c==="dark"?"bg-[#4E6E49]/20 border-[#4E6E49] text-[#4E6E49]":"bg-green-50 border-[#4E6E49] text-[#4E6E49]":`${c==="dark"?"bg-gray-900 border-gray-800 text-gray-200 hover:border-[#4E6E49]/40":"bg-white border-gray-200 text-gray-700 hover:border-[#4E6E49]/40"}`}`,children:"Все"}),De.map(D=>{const T=t.includes(D.id);return r.jsxs("button",{onClick:()=>{i(T?t.filter(H=>H!==D.id):[...t,D.id])},className:`px-3 py-2 rounded-lg text-sm font-semibold transition-all border-2 flex items-center gap-2 ${T?c==="dark"?"bg-[#4E6E49]/20 border-[#4E6E49] text-[#4E6E49]":"bg-green-50 border-[#4E6E49] text-[#4E6E49]":`${c==="dark"?"bg-gray-900 border-gray-800 text-gray-200 hover:border-[#4E6E49]/40":"bg-white border-gray-200 text-gray-700 hover:border-[#4E6E49]/40"}`}`,children:[r.jsx(ix,{className:`w-3 h-3 ${T?"text-[#4E6E49]":"text-gray-400"}`}),gt(D.id)]},D.id)})]})]})]})]})},o4=({tasks:s,onUpdate:e,onEdit:t,onDelete:n})=>{var Je,Qe;const{theme:a}=at(),{user:i}=pt(),{isAdmin:o}=kt(),[c,d]=I.useState(null),[h,m]=I.useState(null),[x,f]=I.useState(null),[k,A]=I.useState(""),[D,T]=I.useState(null),[H,L]=I.useState(null),[E,M]=I.useState(null),[ee,C]=I.useState(null),v=a==="dark"?"text-white":"text-gray-900",p=a==="dark"?"bg-[#1a1a1a]":"bg-white",w=a==="dark"?"border-gray-800":"border-gray-300",N=["in_progress","completed","closed"],j=Z=>Z.assignees&&Z.assignees.length>0?Z.assignees:Z.assignedTo.map(ge=>({userId:ge,priority:"medium"})),b=Z=>j(Z).map(ge=>ge.userId),y=Z=>{if(Z.stages&&Z.stages.length>0){const ge=Z.awaitingStageId||Z.currentStageId||Z.stages[0].id;return Z.stages.find(ye=>ye.id===ge)||Z.stages[0]}return{id:"legacy-stage",name:"Этап",responsible:"all",approvals:Z.approvals||[],status:"pending",comments:[]}},re=Z=>!!i&&Z.createdBy===i.id,ue=Z=>!!i&&Z.mainExecutor===i.id,W=Z=>!!i&&(Z.leadExecutor===i.id||(Z.leads||[]).includes(i.id)),O=Z=>o||re(Z)||ue(Z)||W(Z),P=(Z,ge)=>ge===Z.createdBy?"A":ge===Z.mainExecutor?"ГИ":ge===Z.leadExecutor||(Z.leads||[]).includes(ge)?"ВИ":"",te=Z=>s.filter(ge=>ge.status===Z),J=(Z,ge)=>{if(D||!O(ge)){Z.preventDefault();return}d(ge),Z.dataTransfer.effectAllowed="move",Z.dataTransfer.setData("text/plain",ge.id)},fe=Z=>{Z.preventDefault(),Z.dataTransfer.dropEffect="move"},F=()=>{d(null)},ne=(Z,ge)=>{if(D||!O(ge))return;const ye=Z.touches[0];L({x:ye.clientX,y:ye.clientY,task:ge})},V=Z=>{if(!H)return;Z.preventDefault();const ge=Z.touches[0],ye=document.elementFromPoint(ge.clientX,ge.clientY);if(ye){const de=ye.closest("[data-status]");if(de){const Ce=de.getAttribute("data-status");Ce&&M(Ce)}}},X=async(Z,ge)=>{if(!H)return;const ye=Z.changedTouches[0],de=document.elementFromPoint(ye.clientX,ye.clientY);if(de){const Ce=de.closest("[data-status]");if(Ce){const Ve=Ce.getAttribute("data-status");Ve&&Ve!==ge&&await $(H.task,Ve)}}L(null),M(null)},S=Z=>{const ge=b(Z),ye=new Date().toISOString(),Ce=(Z.approvals||[]).filter(q=>ge.includes(q.userId)).map(q=>({userId:q.userId,status:q.status==="approved"?"approved":"pending",updatedAt:q.updatedAt||ye,...q.comment?{comment:q.comment}:{}})),Ve=ge.filter(q=>!Ce.some(Ne=>Ne.userId===q)).map(q=>({userId:q,status:"pending",updatedAt:ye}));return[...Ce,...Ve]},R=Z=>{const ge=S(Z),ye=b(Z).length,de=ge.filter(Ce=>Ce.status==="approved").length;return{approvals:ge,approved:de,total:ye}},K=Z=>!!i&&b(Z).includes(i.id),U=Z=>o||re(Z),Q=async(Z,ge)=>{if(Z.preventDefault(),Z.stopPropagation(),!c||c.status===ge||D||!O(c)){d(null);return}const{approvals:ye,approved:de,total:Ce}=R(c),Ve=new Date().toISOString();if(ge==="completed"&&(Ce===0||de<Ce)){d(null);return}if(ge==="closed"&&(!U(c)||c.status!=="completed")){d(null);return}const q={status:ge,updatedAt:Ve};ge==="completed"?(q.completedAt=Ve,q.completedBy=(i==null?void 0:i.id)||"system",q.approvals=ye):ge==="closed"?q.closedAt=Ve:ge==="in_progress"&&(q.approvals=b(c).map(Ne=>({userId:Ne,status:"pending",updatedAt:Ve})),q.completedAt=void 0,q.completedBy=void 0,q.closedAt=void 0),T(c.id);try{await Xr(c.id,q),e()}catch(Ne){console.error("Error updating task status:",Ne)}finally{T(null),d(null)}},$=async(Z,ge)=>{if(Z.status===ge||D===Z.id||!O(Z)){m(null);return}const{approvals:ye,approved:de,total:Ce}=R(Z),Ve=new Date().toISOString();if(ge==="completed"&&(Ce===0||de<Ce)){m(null);return}if(ge==="closed"&&(!U(Z)||Z.status!=="completed")){m(null);return}const q={status:ge,updatedAt:Ve};ge==="completed"?(q.completedAt=Ve,q.completedBy=(i==null?void 0:i.id)||"system",q.approvals=ye):ge==="closed"?q.closedAt=Ve:ge==="in_progress"&&(q.approvals=b(Z).map(Ne=>({userId:Ne,status:"pending",updatedAt:Ve})),q.completedAt=void 0,q.completedBy=void 0,q.closedAt=void 0),T(Z.id);try{await Xr(Z.id,q),e(),m(null)}catch(Ne){console.error("Error updating task status:",Ne)}finally{T(null)}},ce=async Z=>{if(!(!i||Z.status!=="in_progress"||!K(Z))){T(Z.id);try{const ge=new Date().toISOString(),ye=S(Z).map(q=>q.userId===i.id?{...q,status:"approved",updatedAt:ge}:q),de=b(Z),Ce=de.length>0&&de.every(q=>ye.find(Ne=>Ne.userId===q&&Ne.status==="approved")),Ve={approvals:ye,updatedAt:ge};Ce&&(Ve.status="completed",Ve.completedAt=ge,Ve.completedBy=i.id),await Xr(Z.id,Ve),e()}catch(ge){console.error("Error confirming task:",ge)}finally{T(null)}}},we=async Z=>{if(!(!U(Z)||Z.status!=="completed")){T(Z.id);try{const ge=new Date().toISOString();await Xr(Z.id,{status:"closed",closedAt:ge,updatedAt:ge}),e()}catch(ge){console.error("Error closing task:",ge)}finally{T(null)}}},G=async(Z,ge)=>{if(!U(Z))return;const ye=(ge||"").trim();if(ye){T(Z.id);try{const de=new Date().toISOString(),Ce=b(Z).map(q=>({userId:q,status:"pending",updatedAt:de})),Ve={id:`c-${Date.now()}`,userId:(i==null?void 0:i.id)||"system",text:ye,createdAt:de};await Xr(Z.id,{status:"in_progress",approvals:Ce,completedAt:void 0,completedBy:void 0,closedAt:void 0,comments:[...Z.comments||[],Ve],updatedAt:de}),e(),f(null),A("")}catch(de){console.error("Error returning task to work:",de)}finally{T(null)}}},oe=Z=>({in_progress:a==="dark"?"bg-blue-500/20 border-blue-500/50":"bg-blue-50 border-blue-200",completed:a==="dark"?"bg-[#4E6E49]/20 border-[#4E6E49]/50":"bg-green-50 border-green-200",closed:a==="dark"?"bg-gray-500/20 border-gray-500/50":"bg-gray-50 border-gray-200"})[Z],_e=Z=>({in_progress:a==="dark"?"text-blue-400":"text-blue-700",completed:"text-[#4E6E49]",closed:a==="dark"?"text-gray-400":"text-gray-700"})[Z],Te=Z=>{const ge=new Date;return new Date(`${Z.dueDate}T${Z.dueTime}`)<ge&&Z.status!=="completed"&&Z.status!=="closed"};return r.jsxs(r.Fragment,{children:[r.jsx("div",{className:"overflow-x-auto pb-4 -mx-4 px-4",children:r.jsx("div",{className:"flex gap-3 sm:gap-4 min-w-max",children:N.map(Z=>{const ge=te(Z),ye=zs[Z];return r.jsxs("div",{"data-status":Z,className:`flex-shrink-0 w-[280px] sm:w-80 ${p} rounded-xl border-2 ${w} p-3 sm:p-4 ${E===Z?"border-[#4E6E49]":""}`,onDragOver:fe,onDrop:de=>Q(de,Z),onTouchMove:V,children:[r.jsx("div",{className:`mb-3 sm:mb-4 pb-2 sm:pb-3 border-b ${w}`,children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsx("h3",{className:`text-base sm:text-lg font-bold ${_e(Z)}`,children:ye.label}),r.jsx("span",{className:`px-2 py-1 rounded-lg text-xs sm:text-sm font-medium ${oe(Z)} ${_e(Z)}`,children:ge.length})]})}),r.jsxs("div",{className:"space-y-2 sm:space-y-3 max-h-[calc(100vh-280px)] sm:max-h-[calc(100vh-300px)] overflow-y-auto",children:[ge.map(de=>{var Ze,He,et;const Ce=Te(de),Ve=o||(i==null?void 0:i.id)===de.createdBy||de.mainExecutor===(i==null?void 0:i.id),q=y(de),Me=j(de).map(Ee=>{const xt=De.find(jt=>jt.id===Ee.userId);return xt?{...Ee,member:xt}:null}).filter(Boolean),{approvals:z,approved:B,total:je}=R(de),Pe=z.find(Ee=>Ee.userId===(i==null?void 0:i.id)),Fe=K(de)&&de.status==="in_progress"&&(!Pe||Pe.status!=="approved"),pe=U(de)&&de.status==="completed";return r.jsxs("div",{draggable:!D&&O(de),onDragStart:Ee=>J(Ee,de),onDragEnd:F,onTouchStart:Ee=>ne(Ee,de),onTouchEnd:Ee=>X(Ee,Z),className:`${p} rounded-lg border-2 ${w} p-2.5 sm:p-3 cursor-move hover:shadow-lg transition-all ${(c==null?void 0:c.id)===de.id||(H==null?void 0:H.task.id)===de.id?"opacity-50":""} ${Ce?"border-red-500":""} ${D===de.id?"opacity-50 pointer-events-none":""}`,children:[r.jsxs("div",{className:"flex items-start justify-between gap-2 mb-2",children:[r.jsx("h4",{className:`font-semibold text-xs sm:text-sm ${v} flex-1`,children:de.title}),r.jsx("div",{className:"flex items-center gap-1 flex-shrink-0",children:r.jsxs("div",{className:"relative lg:hidden",children:[r.jsx("button",{onClick:()=>m((h==null?void 0:h.id)===de.id?null:de),className:`p-1 rounded ${a==="dark"?"hover:bg-gray-700":"hover:bg-gray-100"}`,children:r.jsx(kx,{className:"w-4 h-4"})}),(h==null?void 0:h.id)===de.id&&r.jsxs(r.Fragment,{children:[r.jsx("div",{className:"fixed inset-0 z-40",onClick:()=>m(null)}),r.jsx("div",{className:`absolute right-0 top-8 z-50 ${p} rounded-lg shadow-xl border-2 ${w} min-w-[200px]`,children:r.jsxs("div",{className:"p-2",children:[r.jsx("div",{className:`text-xs font-medium mb-2 px-2 py-1 ${a==="dark"?"text-gray-400":"text-gray-600"}`,children:"Изменить статус:"}),N.map(Ee=>r.jsx("button",{onClick:()=>$(de,Ee),disabled:de.status===Ee||D===de.id||!O(de),className:`w-full text-left px-3 py-2 rounded-lg text-sm transition-colors mb-1 ${de.status===Ee?oe(Ee):a==="dark"?"hover:bg-gray-700":"hover:bg-gray-100"} ${de.status===Ee?_e(Ee):v} disabled:opacity-50`,children:zs[Ee].label},Ee)),Ve&&r.jsxs(r.Fragment,{children:[r.jsx("div",{className:`border-t ${w} my-2`}),r.jsx("button",{onClick:()=>{m(null),t(de)},className:`w-full text-left px-3 py-2 rounded-lg text-sm transition-colors mb-1 ${a==="dark"?"hover:bg-gray-700":"hover:bg-gray-100"} ${v}`,children:"Редактировать"}),r.jsx("button",{onClick:()=>{m(null),C(de)},className:`w-full text-left px-3 py-2 rounded-lg text-sm transition-colors mb-1 ${a==="dark"?"hover:bg-gray-700":"hover:bg-gray-100"} ${v}`,children:"Всё о задаче"}),r.jsx("button",{onClick:()=>{m(null),n(de.id)},className:`w-full text-left px-3 py-2 rounded-lg text-sm transition-colors ${a==="dark"?"hover:bg-red-500/20 text-red-400":"hover:bg-red-50 text-red-600"}`,children:"Удалить"})]})]})})]})]})})]}),r.jsxs("div",{className:"space-y-1.5 text-xs mb-2",children:[r.jsxs("div",{className:"space-y-1",children:[r.jsxs("div",{className:`flex items-center gap-1 ${a==="dark"?"text-blue-400":"text-blue-600"}`,children:[r.jsx("span",{className:"font-medium",children:"Автор:"}),r.jsx("span",{className:a==="dark"?"text-gray-400":"text-gray-600",children:((Ze=De.find(Ee=>Ee.id===de.createdBy))==null?void 0:Ze.name)||"Неизвестно"})]}),r.jsxs("div",{className:"flex flex-col gap-1",children:[r.jsx("div",{className:"flex items-center gap-1 text-[#4E6E49]",children:r.jsx("span",{className:"font-medium",children:"Исполнители:"})}),Me.length>0?Me.map(Ee=>r.jsx("div",{className:`text-[11px] sm:text-xs ${a==="dark"?"text-gray-300":"text-gray-700"} flex flex-wrap gap-1`,children:r.jsx("span",{className:"font-medium",children:gt(Ee.member.id)})},Ee.member.id)):r.jsx("span",{className:"text-gray-500",children:"Не назначены"})]})]}),r.jsxs("div",{className:`flex items-center gap-2 flex-wrap ${a==="dark"?"text-gray-400":"text-gray-600"}`,children:[r.jsxs("span",{className:"inline-flex items-center gap-1",children:[r.jsx(Ii,{className:"w-3.5 h-3.5"}),le(new Date(de.dueDate),"dd.MM.yyyy")]}),r.jsxs("span",{className:"inline-flex items-center gap-1",children:[r.jsx(Is,{className:"w-3.5 h-3.5"}),de.dueTime]}),r.jsx(q0,{dueDate:de.dueDate,dueTime:de.dueTime,theme:a,size:"compact"})]}),r.jsx("div",{className:"flex items-center gap-1 text-[11px]",children:r.jsx("span",{className:`px-2 py-0.5 rounded-full border ${a==="dark"?"border-yellow-500/40 text-yellow-200 bg-yellow-500/10":"border-yellow-200 text-yellow-700 bg-yellow-50"}`,children:de.priority==="urgent"?"Экстренный приоритет":de.priority==="high"?"Высокий приоритет":de.priority==="medium"?"Средний приоритет":"Низкий приоритет"})}),je>0&&r.jsxs("div",{className:`flex items-center justify-between gap-2 ${a==="dark"?"text-yellow-300":"text-yellow-700"}`,children:[r.jsxs("span",{className:"inline-flex items-center gap-1",children:[r.jsx(so,{className:"w-3 h-3"}),"Подтверждения исполнителей"]}),r.jsxs("span",{className:"text-[11px] font-semibold",children:[B,"/",je]})]}),de.description&&r.jsx("p",{className:`line-clamp-2 ${a==="dark"?"text-gray-300":"text-gray-600"}`,children:de.description}),z.length>0&&r.jsx("div",{className:`mt-1 space-y-1 ${a==="dark"?"text-gray-300":"text-gray-700"}`,children:z.map(Ee=>{const xt=De.find(_t=>_t.id===Ee.userId),jt=Ee.status==="approved"?"подтвердил":"в ожидании";return r.jsxs("div",{className:"flex items-center justify-between text-[11px]",children:[r.jsxs("span",{className:"flex items-center gap-1",children:[r.jsxs("span",{className:"font-medium",children:[(xt==null?void 0:xt.name)||Ee.userId,P(de,Ee.userId)&&r.jsx("span",{className:"ml-1 text-[10px] px-1 rounded bg-gray-200 dark:bg-gray-800",children:P(de,Ee.userId)})]}),r.jsxs("span",{className:"text-gray-500",children:["(",jt,")"]})]}),Ee.comment&&r.jsx("span",{className:"truncate max-w-[140px] text-gray-500",children:Ee.comment})]},Ee.userId)})}),(((He=de.comments)==null?void 0:He.length)||((et=q.comments)==null?void 0:et.length))&&r.jsx("div",{className:"mt-2 space-y-1",children:[...de.comments||[],...q.comments||[]].map(Ee=>{const xt=De.find(jt=>jt.id===Ee.userId);return r.jsxs("div",{className:`text-[11px] ${a==="dark"?"text-gray-300":"text-gray-700"}`,children:[r.jsx("span",{className:"font-semibold",children:(xt==null?void 0:xt.name)||Ee.userId})," ",r.jsx("span",{className:"text-gray-500",children:Ee.stageId?"(этап)":"(задача)"}),": ",Ee.text]},Ee.id)})}),r.jsx("div",{className:"flex items-center gap-2 flex-wrap",children:r.jsx("span",{className:`px-1.5 py-0.5 rounded text-xs inline-flex items-center gap-1 ${oe(Z)} ${_e(Z)}`,children:(()=>{const Ee=Ao[de.category];return r.jsx(Ee,{className:"w-3.5 h-3.5"})})()})})]}),r.jsx("div",{className:"flex justify-end mt-1",children:r.jsx("button",{onClick:()=>C(de),className:`text-[11px] underline ${a==="dark"?"text-gray-300":"text-gray-600"} hover:text-[#4E6E49]`,children:"Всё о задаче"})}),r.jsxs("div",{className:`flex flex-col gap-2 mt-2 pt-2 border-t ${w}`,children:[Fe&&r.jsxs("button",{onClick:()=>ce(de),disabled:D===de.id,className:"w-full px-2 py-1.5 bg-[#4E6E49] hover:bg-emerald-700 text-white rounded-lg text-xs font-medium transition-colors flex items-center justify-center gap-1 disabled:opacity-50",children:[r.jsx(wr,{className:"w-3 h-3"}),"Подтвердить"]}),pe&&r.jsxs("div",{className:"flex gap-2",children:[r.jsxs("button",{onClick:()=>we(de),disabled:D===de.id,className:"flex-1 px-2 py-1.5 bg-blue-600 hover:bg-blue-700 text-white rounded-lg text-xs font-medium transition-colors flex items-center justify-center gap-1 disabled:opacity-50",children:[r.jsx(wr,{className:"w-3 h-3"}),"Закрыто"]}),r.jsxs("button",{onClick:()=>{f({task:de}),A("")},disabled:D===de.id,className:"flex-1 px-2 py-1.5 bg-red-500 hover:bg-red-600 text-white rounded-lg text-xs font-medium transition-colors flex items-center justify-center gap-1 disabled:opacity-50",children:[r.jsx(Pt,{className:"w-3 h-3"}),"Не выполнено"]})]}),de.status==="completed"&&!pe&&r.jsx("p",{className:`text-[11px] ${a==="dark"?"text-gray-400":"text-gray-500"}`,children:"Ожидает подтверждения автора"})]})]},de.id)}),ge.length===0&&r.jsxs("div",{className:`text-center py-6 sm:py-8 ${a==="dark"?"text-gray-500":"text-gray-400"}`,children:[r.jsx(ts,{className:"w-6 h-6 sm:w-8 sm:h-8 mx-auto mb-2 opacity-50"}),r.jsx("p",{className:"text-xs sm:text-sm",children:"Нет задач"})]})]})]},Z)})})}),x&&r.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-start sm:items-center justify-center z-[70] p-4 overflow-y-auto overscroll-contain modal-scroll",children:r.jsxs("div",{className:`${p} rounded-xl p-6 max-w-md w-full border-2 ${w}`,children:[r.jsx("h3",{className:`text-lg font-bold mb-4 ${v}`,children:"Не выполнено"}),r.jsx("textarea",{value:k,onChange:Z=>A(Z.target.value),placeholder:"Опишите, что нужно доработать",rows:3,className:`w-full px-4 py-2 rounded-lg border ${w} ${a==="dark"?"bg-gray-700":"bg-gray-50"} ${v} mb-4 focus:outline-none focus:ring-2 focus:ring-[#4E6E49]/50`}),r.jsxs("div",{className:"flex gap-3",children:[r.jsx("button",{onClick:()=>x.task&&G(x.task,k),disabled:D===x.task.id||!k.trim(),className:"flex-1 px-4 py-2 rounded-lg font-medium transition-colors bg-red-500 hover:bg-red-600 text-white disabled:opacity-50",children:"Отправить на доработку"}),r.jsx("button",{onClick:()=>{f(null),A("")},className:`px-4 py-2 rounded-lg font-medium transition-colors ${a==="dark"?"bg-gray-700 hover:bg-gray-600":"bg-gray-200 hover:bg-gray-300"}`,children:"Отмена"})]})]})}),ee&&r.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-start sm:items-center justify-center z-[70] p-4 overflow-y-auto overscroll-contain modal-scroll",children:r.jsxs("div",{className:`${p} rounded-xl p-6 max-w-2xl w-full border-2 ${w}`,children:[r.jsxs("div",{className:"flex items-center justify-between mb-4",children:[r.jsx("h3",{className:`text-lg font-bold ${v}`,children:"Всё о задаче"}),r.jsx("button",{onClick:()=>C(null),className:`p-2 rounded-lg ${a==="dark"?"hover:bg-gray-700":"hover:bg-gray-100"}`,children:r.jsx(Pt,{className:"w-4 h-4"})})]}),r.jsxs("div",{className:"space-y-4 text-sm",children:[r.jsxs("div",{children:[r.jsx("p",{className:"text-xs text-gray-500",children:"Название"}),r.jsx("p",{className:`font-semibold ${v}`,children:ee.title})]}),ee.description&&r.jsxs("div",{children:[r.jsx("p",{className:"text-xs text-gray-500",children:"Описание"}),r.jsx("p",{className:a==="dark"?"text-gray-300":"text-gray-700",children:ee.description})]}),ee.expectedResult&&r.jsxs("div",{children:[r.jsx("p",{className:"text-xs text-gray-500",children:"Ожидаемый результат"}),r.jsx("p",{className:a==="dark"?"text-gray-300":"text-gray-700",children:ee.expectedResult})]}),r.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[r.jsxs("div",{children:[r.jsx("p",{className:"text-xs text-gray-500",children:"Автор"}),r.jsx("p",{className:v,children:((Je=De.find(Z=>Z.id===ee.createdBy))==null?void 0:Je.name)||ee.createdBy})]}),r.jsxs("div",{children:[r.jsx("p",{className:"text-xs text-gray-500",children:"Категория"}),r.jsx("p",{className:v,children:((Qe=ga[ee.category])==null?void 0:Qe.label)||ee.category})]}),r.jsxs("div",{children:[r.jsx("p",{className:"text-xs text-gray-500",children:"Приоритет"}),r.jsx("p",{className:v,children:ee.priority==="urgent"?"Экстренный":ee.priority==="high"?"Высокий":ee.priority==="medium"?"Средний":"Низкий"})]}),r.jsxs("div",{children:[r.jsx("p",{className:"text-xs text-gray-500",children:"Дедлайн"}),r.jsxs("p",{className:v,children:[le(new Date(ee.dueDate),"dd.MM.yyyy")," · ",ee.dueTime]})]})]}),r.jsxs("div",{children:[r.jsx("p",{className:"text-xs text-gray-500",children:"Статус"}),r.jsx("p",{className:`${v} font-semibold`,children:zs[ee.status].label})]}),ee.stages&&ee.stages.length>0&&r.jsxs("div",{className:"space-y-2",children:[r.jsx("p",{className:"text-xs text-gray-500",children:"Этапы"}),ee.stages.map(Z=>{var ge,ye;return r.jsxs("div",{className:`p-3 rounded border ${w} space-y-2`,children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsx("p",{className:`font-semibold ${v}`,children:Z.name}),r.jsxs("p",{className:"text-xs text-gray-500",children:[((ge=Z.approvals)==null?void 0:ge.filter(de=>de.status==="approved").length)||0,"/",((ye=Z.approvals)==null?void 0:ye.length)||0," подтверждений"]})]}),Z.assignees&&Z.assignees.length>0&&r.jsx("div",{className:"space-y-1 text-xs",children:Z.assignees.map(de=>{const Ce=De.find(Ve=>Ve.id===de.userId);return r.jsx("div",{className:"flex items-start justify-between gap-2",children:r.jsx("span",{className:"font-medium",children:(Ce==null?void 0:Ce.name)||de.userId})},de.userId)})})]},Z.id)})]})]})]})})]})},l4=()=>{var K;const{theme:s}=at(),{user:e}=pt(),[t,n]=I.useState(!1),[a,i]=I.useState(null),[o,c]=I.useState([]),[d,h]=I.useState(!0),[m,x]=I.useState("all"),[f,k]=I.useState("all"),[A,D]=I.useState([]),[T,H]=I.useState("kanban"),L=s==="dark"?"text-white":"text-gray-900",E=s==="dark"?"bg-[#1a1a1a]":"bg-white";I.useEffect(()=>{M()},[e]),I.useEffect(()=>{M()},[m,f,A]);const M=async()=>{h(!0);try{const U={};m!=="all"&&(U.category=m),f!=="all"&&(U.status=f),A.length>0&&(U.assignedTo=A);const Q=await Xc(U);c(Q)}catch(U){console.error("Error loading tasks:",U)}finally{h(!1)}},ee=U=>{i(U),n(!0)},C=async U=>{if(confirm("Вы уверены, что хотите удалить эту задачу?"))try{await L0(U),M()}catch(Q){console.error("Error deleting task:",Q)}},v=()=>{n(!1),i(null)},p=()=>{n(!1),i(null),M()},w=()=>{x("all"),k("all"),D([])},N=o.filter(U=>!(m!=="all"&&U.category!==m||f!=="all"&&U.status!==f||A.length>0&&!A.some(Q=>U.assignedTo.includes(Q)))),j={inProgress:o.filter(U=>U.status==="in_progress").length,completed:o.filter(U=>U.status==="completed").length,closed:o.filter(U=>U.status==="closed").length},b=new Date,y=le(b,"yyyy-MM-dd"),re=new Date(b);re.setDate(b.getDate()-7);const ue=new Date(b);ue.setDate(b.getDate()-30);const W=o.filter(U=>new Date(U.createdAt)>=re).length,O=o.filter(U=>new Date(U.createdAt)>=ue).length,P=o.filter(U=>U.completedAt&&U.completedAt.startsWith(y)).length,te=e?o.filter(U=>U.mainExecutor===e.id||U.leadExecutor===e.id||(U.assignedTo||[]).includes(e.id)||(U.coExecutors||[]).includes(e.id)):[],J=te.length,fe=o.length,F=fe?Math.round(j.inProgress/fe*100):0,ne=(()=>{var $;const U={};return o.forEach(ce=>{[ce.mainExecutor,ce.leadExecutor,...ce.assignedTo||[],...ce.coExecutors||[]].filter(Boolean).forEach(G=>{U[G]=(U[G]||0)+1})}),(($=Object.entries(U).sort((ce,we)=>we[1]-ce[1])[0])==null?void 0:$[0])||""})(),V=ne?((K=De.find(U=>U.id===ne))==null?void 0:K.name)||ne:"—",X=o.filter(U=>U.status!=="completed"&&U.status!=="closed").sort((U,Q)=>new Date(`${U.dueDate}T${U.dueTime}`).getTime()-new Date(`${Q.dueDate}T${Q.dueTime}`).getTime())[0],S=[{label:"Всего задач на неделе",value:W,sub:"последние 7 дней",tone:"sky"},{label:"Всего задач на месяце",value:O,sub:"последние 30 дней",tone:"emerald"},{label:"Задач в работе",value:j.inProgress,sub:`${F}% от всех`,tone:"blue"},{label:"Отмечено исполнителями",value:j.completed,sub:"ожидают проверки автора",tone:"amber"},{label:"Самый активный исполнитель",value:V,sub:"по числу назначений",tone:"purple"},{label:"Закрыто автором",value:j.closed,sub:"финально подтверждено",tone:"slate"},{label:"Ближайший дедлайн",value:X?X.title:"Нет активных",sub:X?`${le(new Date(X.dueDate),"dd.MM.yyyy")} · ${X.dueTime}`:"Свободное окно",tone:"pink"},{label:"Сделано задач за сегодня",value:P,sub:y,tone:"green"}],R=[{href:"#tasks-board",label:"Все задачи"},{href:"#my-tasks",label:"Мои задачи",action:()=>e&&D([e.id])},{href:"#tasks-stats",label:"Статистика"}];return r.jsx(mr,{children:r.jsxs("div",{className:"space-y-6",children:[r.jsxs("div",{className:`rounded-xl sm:rounded-2xl p-4 sm:p-6 md:p-8 ${E} shadow-xl border-2 ${s==="dark"?"border-[#4E6E49]/30 bg-gradient-to-br from-[#1a1a1a] via-[#1a1a1a] to-[#0A0A0A]":"border-green-200 bg-gradient-to-br from-white via-green-50/30 to-white"} relative overflow-hidden`,children:[r.jsx("div",{className:"absolute top-0 right-0 w-32 h-32 sm:w-64 sm:h-64 bg-gradient-to-br from-[#4E6E49]/10 to-emerald-700/10 rounded-full blur-3xl -mr-16 sm:-mr-32 -mt-16 sm:-mt-32"}),r.jsx("div",{className:"absolute bottom-0 left-0 w-24 h-24 sm:w-48 sm:h-48 bg-gradient-to-tr from-yellow-500/10 to-orange-500/10 rounded-full blur-2xl -ml-12 sm:-ml-24 -mb-12 sm:-mb-24"}),r.jsxs("div",{className:"relative z-10",children:[r.jsx("div",{className:"flex flex-col gap-4 sm:gap-6 lg:flex-row lg:items-start lg:justify-between mb-4 sm:mb-6",children:r.jsxs("div",{className:"flex-1",children:[r.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 mb-2",children:[r.jsx(ts,{className:"w-6 h-6 sm:w-8 sm:h-8 text-[#4E6E49]"}),r.jsxs("h1",{className:`text-2xl sm:text-3xl md:text-4xl font-extrabold ${L} flex items-center gap-2`,children:["Task Team",r.jsx(nr,{className:`w-5 h-5 sm:w-6 sm:h-6 ${s==="dark"?"text-yellow-400":"text-yellow-600"}`})]})]}),r.jsx("p",{className:`text-sm sm:text-base ${s==="dark"?"text-gray-300":"text-gray-600"}`,children:"Управление задачами и заданиями команды"}),r.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:R.map(U=>r.jsx("a",{href:U.href,onClick:()=>{var Q;return(Q=U.action)==null?void 0:Q.call(U)},className:`px-3 py-1.5 rounded-lg text-xs font-semibold border transition ${s==="dark"?"border-white/10 bg-white/5 text-white hover:border-[#4E6E49]/50":"border-gray-200 bg-white text-gray-800 hover:border-[#4E6E49]/50 hover:text-[#4E6E49]"}`,children:U.label},U.href))})]})}),r.jsx("div",{id:"tasks-stats",className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3 sm:gap-4",children:S.map(U=>{const $={emerald:{bg:s==="dark"?"bg-emerald-500/10":"bg-emerald-50",text:s==="dark"?"text-emerald-100":"text-emerald-800",border:s==="dark"?"border-emerald-500/30":"border-emerald-200"},sky:{bg:s==="dark"?"bg-sky-500/10":"bg-sky-50",text:s==="dark"?"text-sky-100":"text-sky-800",border:s==="dark"?"border-sky-500/30":"border-sky-200"},amber:{bg:s==="dark"?"bg-amber-500/10":"bg-amber-50",text:s==="dark"?"text-amber-100":"text-amber-800",border:s==="dark"?"border-amber-500/30":"border-amber-200"},blue:{bg:s==="dark"?"bg-blue-500/10":"bg-blue-50",text:s==="dark"?"text-blue-100":"text-blue-800",border:s==="dark"?"border-blue-500/30":"border-blue-200"},purple:{bg:s==="dark"?"bg-purple-500/10":"bg-purple-50",text:s==="dark"?"text-purple-100":"text-purple-800",border:s==="dark"?"border-purple-500/30":"border-purple-200"},slate:{bg:s==="dark"?"bg-gray-500/10":"bg-gray-50",text:s==="dark"?"text-gray-100":"text-gray-800",border:s==="dark"?"border-gray-500/30":"border-gray-200"},pink:{bg:s==="dark"?"bg-pink-500/10":"bg-pink-50",text:s==="dark"?"text-pink-100":"text-pink-800",border:s==="dark"?"border-pink-500/30":"border-pink-200"},green:{bg:s==="dark"?"bg-green-500/10":"bg-green-50",text:s==="dark"?"text-green-100":"text-green-800",border:s==="dark"?"border-green-500/30":"border-green-200"}}[U.tone];return r.jsxs("div",{className:`p-4 rounded-xl border ${$.border} ${$.bg} shadow-sm space-y-1`,children:[r.jsx("p",{className:`text-xs font-semibold uppercase ${$.text}`,children:U.label}),r.jsx("p",{className:`text-2xl font-extrabold ${L} truncate`,children:U.value}),r.jsx("p",{className:`text-xs ${s==="dark"?"text-gray-400":"text-gray-600"}`,children:U.sub})]},U.label)})})]})]}),e&&r.jsxs("div",{id:"my-tasks",className:`rounded-xl sm:rounded-2xl p-4 sm:p-6 ${E} border-2 ${s==="dark"?"border-white/10":"border-gray-200"}`,children:[r.jsxs("div",{className:"flex items-center justify-between gap-3 mb-3",children:[r.jsxs("div",{children:[r.jsx("p",{className:`text-xs uppercase font-semibold ${s==="dark"?"text-gray-400":"text-gray-500"}`,children:"Мои задачи"}),r.jsx("p",{className:`text-xl font-bold ${L}`,children:J})]}),r.jsx("a",{href:"#tasks-board",className:`px-3 py-2 rounded-lg text-xs font-semibold border ${s==="dark"?"border-white/10 bg-white/5 text-white hover:border-[#4E6E49]/50":"border-gray-200 bg-white text-gray-800 hover:border-[#4E6E49]/50 hover:text-[#4E6E49]"}`,children:"Перейти на доску"})]}),te.length===0?r.jsx("p",{className:s==="dark"?"text-gray-400":"text-gray-600",children:"Нет назначенных задач"}):r.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:te.slice(0,4).map(U=>r.jsxs("div",{className:`p-3 rounded-lg border ${s==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white"}`,children:[r.jsx("p",{className:`text-sm font-semibold ${L} truncate`,children:U.title}),r.jsxs("p",{className:`text-xs ${s==="dark"?"text-gray-400":"text-gray-600"}`,children:[le(new Date(U.dueDate),"dd.MM.yyyy")," · ",U.dueTime]}),r.jsx("p",{className:"text-xs mt-1",children:r.jsx("span",{className:`px-2 py-0.5 rounded-full ${s==="dark"?"bg-gray-800 text-gray-200":"bg-gray-100 text-gray-700"}`,children:zs[U.status].label})})]},U.id))})]}),r.jsxs("div",{className:"flex flex-col lg:flex-row gap-4 sm:gap-6",id:"tasks-board",children:[r.jsx("div",{className:"lg:w-80 flex-shrink-0",children:r.jsx(i4,{selectedCategory:m,selectedStatus:f,selectedUsers:A,onCategoryChange:x,onStatusChange:k,onUsersChange:D,onClear:w})}),r.jsxs("div",{className:"flex-1",children:[r.jsxs("div",{className:"flex items-center justify-between mb-4 gap-3",children:[r.jsxs("h2",{className:`text-xl font-bold ${L}`,children:["Задачи (",N.length,")"]}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsxs("div",{className:`flex rounded-lg border-2 ${s==="dark"?"border-gray-800":"border-gray-300"} overflow-hidden`,children:[r.jsx("button",{onClick:()=>H("kanban"),className:`px-3 py-2 transition-colors ${T==="kanban"?"bg-[#4E6E49] text-white":s==="dark"?"bg-[#1a1a1a] text-gray-300 hover:bg-gray-700":"bg-white text-gray-700 hover:bg-gray-50"}`,title:"Kanban доска",children:r.jsx(fx,{className:"w-4 h-4"})}),r.jsx("button",{onClick:()=>H("list"),className:`px-3 py-2 transition-colors ${T==="list"?"bg-[#4E6E49] text-white":s==="dark"?"bg-[#1a1a1a] text-gray-300 hover:bg-gray-700":"bg-white text-gray-700 hover:bg-gray-50"}`,title:"Список",children:r.jsx(yx,{className:"w-4 h-4"})})]}),r.jsxs("button",{onClick:()=>n(!0),className:"px-4 py-2 bg-gradient-to-r from-[#4E6E49] to-emerald-700 hover:from-[#4E6E49] hover:to-emerald-700 text-white rounded-lg font-semibold transition-all shadow-lg hover:shadow-xl transform hover:scale-105 flex items-center gap-2",children:[r.jsx(is,{className:"w-5 h-5"}),r.jsx("span",{className:"hidden sm:inline",children:"Новая задача"}),r.jsx("span",{className:"sm:hidden",children:"Добавить"})]})]})]}),d?r.jsx("div",{className:`${E} rounded-xl p-8 text-center ${L}`,children:r.jsx("div",{className:"animate-pulse",children:"Загрузка..."})}):N.length===0?r.jsxs("div",{className:`${E} rounded-xl p-8 text-center border-2 ${s==="dark"?"border-gray-800":"border-gray-300"}`,children:[r.jsx(ts,{className:`w-12 h-12 mx-auto mb-4 ${s==="dark"?"text-gray-600":"text-gray-400"}`}),r.jsx("p",{className:`text-lg font-medium ${L} mb-2`,children:"Нет задач"}),r.jsx("p",{className:`text-sm ${s==="dark"?"text-gray-400":"text-gray-600"}`,children:m!=="all"||f!=="all"||A.length>0?"Попробуйте изменить фильтры":"Создайте первую задачу"})]}):T==="kanban"?r.jsx(o4,{tasks:N,onUpdate:M,onEdit:ee,onDelete:C}):r.jsx("div",{className:"grid grid-cols-1 gap-4 sm:gap-6",children:N.map(U=>r.jsx(a4,{task:U,onEdit:ee,onDelete:C,onUpdate:M},U.id))})]})]}),t&&r.jsx(e4,{onClose:v,onSave:p,editingTask:a})]})})},c4=()=>{const{theme:s}=at(),{isAdmin:e}=kt(),t=s==="dark"?"text-white":"text-gray-900",n=s==="dark"?"text-gray-300":"text-gray-700",a=s==="dark"?"bg-[#1a1a1a]":"bg-white";return e?r.jsx(mr,{children:r.jsxs("div",{className:"space-y-6",children:[r.jsxs("div",{className:`rounded-2xl p-6 ${a} shadow-lg border-2 ${s==="dark"?"border-purple-500/30 bg-gradient-to-br from-[#1a1a1a] to-[#1a1a1a]/90":"border-purple-200 bg-gradient-to-br from-white to-purple-50/30"}`,children:[r.jsxs("div",{className:"flex items-start gap-4 mb-6",children:[r.jsx("div",{className:`p-3 rounded-xl ${s==="dark"?"bg-purple-500/20":"bg-purple-100"}`,children:r.jsx($t,{className:`w-8 h-8 ${s==="dark"?"text-purple-400":"text-purple-600"}`})}),r.jsxs("div",{className:"flex-1",children:[r.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[r.jsx("h1",{className:`text-3xl font-bold bg-gradient-to-r ${s==="dark"?"from-purple-400 to-pink-400 text-transparent bg-clip-text":"from-purple-600 to-pink-600 text-transparent bg-clip-text"}`,children:"Панель администратора"}),r.jsx(nr,{className:`w-5 h-5 ${s==="dark"?"text-yellow-400":"text-yellow-500"} animate-pulse`})]}),r.jsxs("p",{className:`${n} text-sm flex items-center gap-2`,children:[r.jsx(Ti,{className:"w-4 h-4"}),"Управление системой и командой ApeVault"]})]})]}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-6",children:[r.jsxs("div",{className:`p-4 rounded-xl border-2 ${s==="dark"?"bg-blue-500/10 border-blue-500/30":"bg-blue-50 border-blue-200"}`,children:[r.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[r.jsx("div",{className:`p-2 rounded-lg ${s==="dark"?"bg-blue-500/20":"bg-blue-100"}`,children:r.jsx($t,{className:`w-5 h-5 ${s==="dark"?"text-blue-400":"text-blue-600"}`})}),r.jsx("h3",{className:`font-semibold ${t}`,children:"Доступ к функциям"})]}),r.jsx("p",{className:`text-sm ${n}`,children:"В режиме администратора вы можете управлять слотами, статусами и заработком всех участников команды"})]}),r.jsxs("div",{className:"p-4 rounded-xl border-2 bg-[#4E6E49]/10 border-[#4E6E49]/30",children:[r.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[r.jsx("div",{className:`p-2 rounded-lg ${s==="dark"?"bg-[#4E6E49]/20":"bg-green-100"}`,children:r.jsx(px,{className:"w-5 h-5 text-[#4E6E49]"})}),r.jsx("h3",{className:`font-semibold ${t}`,children:"Безопасность"})]}),r.jsx("p",{className:`text-sm ${n}`,children:"Режим администратора требует ввода пароля. Не делитесь паролем с другими участниками"})]})]}),r.jsx("div",{className:`pt-4 border-t ${s==="dark"?"border-gray-800":"border-gray-200"}`,children:r.jsxs("div",{className:`flex items-center gap-3 p-4 rounded-xl ${s==="dark"?"bg-[#4E6E49]/20 border-2 border-[#4E6E49]/50":"bg-green-50 border-2 border-green-200"}`,children:[r.jsx("div",{className:`p-2 rounded-lg ${s==="dark"?"bg-[#4E6E49]/30":"bg-green-100"}`,children:r.jsx($t,{className:"w-6 h-6 text-[#4E6E49]"})}),r.jsxs("div",{children:[r.jsx("h3",{className:`font-semibold mb-1 ${t}`,children:"Режим администратора активен"}),r.jsx("p",{className:`text-sm ${n}`,children:"Вы вошли в систему как администратор. Все административные функции доступны."})]})]})})]}),r.jsxs("div",{className:`rounded-2xl p-6 ${a} shadow-lg border-2 ${s==="dark"?"border-gray-800":"border-gray-200"}`,children:[r.jsx("h2",{className:`text-xl font-semibold mb-4 ${t}`,children:"Возможности администратора"}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[r.jsxs("div",{className:`p-4 rounded-xl border ${s==="dark"?"border-gray-800 bg-gray-700/30":"border-gray-200 bg-gray-50"}`,children:[r.jsx("h3",{className:`font-semibold mb-2 ${t}`,children:"📅 Управление слотами"}),r.jsxs("ul",{className:`text-sm space-y-1 ${n} list-disc list-inside`,children:[r.jsx("li",{children:"Создание слотов для любого участника"}),r.jsx("li",{children:"Массовое создание слотов"}),r.jsx("li",{children:"Удаление слотов любого участника"}),r.jsx("li",{children:"Массовое удаление слотов"})]})]}),r.jsxs("div",{className:`p-4 rounded-xl border ${s==="dark"?"border-gray-800 bg-gray-700/30":"border-gray-200 bg-gray-50"}`,children:[r.jsx("h3",{className:`font-semibold mb-2 ${t}`,children:"📋 Управление статусами"}),r.jsxs("ul",{className:`text-sm space-y-1 ${n} list-disc list-inside`,children:[r.jsx("li",{children:"Установка выходных, больничных и отпуск"}),r.jsx("li",{children:"Массовое управление статусами"}),r.jsx("li",{children:"Удаление статусов любого участника"})]})]}),r.jsxs("div",{className:`p-4 rounded-xl border ${s==="dark"?"border-gray-800 bg-gray-700/30":"border-gray-200 bg-gray-50"}`,children:[r.jsx("h3",{className:`font-semibold mb-2 ${t}`,children:"💰 Управление заработком"}),r.jsxs("ul",{className:`text-sm space-y-1 ${n} list-disc list-inside`,children:[r.jsx("li",{children:"Добавление заработка за любую дату"}),r.jsx("li",{children:"Редактирование записей о заработке"}),r.jsx("li",{children:"Удаление записей о заработке"})]})]}),r.jsxs("div",{className:`p-4 rounded-xl border ${s==="dark"?"border-gray-800 bg-gray-700/30":"border-gray-200 bg-gray-50"}`,children:[r.jsx("h3",{className:`font-semibold mb-2 ${t}`,children:"📊 Дополнительно"}),r.jsxs("ul",{className:`text-sm space-y-1 ${n} list-disc list-inside`,children:[r.jsx("li",{children:"Удаление сообщений из подсчета"}),r.jsx("li",{children:"Полный доступ ко всем функциям"}),r.jsx("li",{children:"Просмотр и управление данными команды"})]})]})]})]})]})}):r.jsx(mr,{children:r.jsx("div",{className:`rounded-2xl p-8 ${a} shadow-xl border-2 ${s==="dark"?"border-red-500/30 bg-gradient-to-br from-[#1a1a1a] to-[#0A0A0A]":"border-red-200 bg-gradient-to-br from-white to-red-50/20"} relative overflow-hidden`,children:r.jsxs("div",{className:"text-center",children:[r.jsx("div",{className:`inline-flex p-4 rounded-2xl mb-4 ${s==="dark"?"bg-red-500/20":"bg-red-100"}`,children:r.jsx(Ti,{className:`w-12 h-12 ${s==="dark"?"text-red-400":"text-red-600"}`})}),r.jsx("h2",{className:`text-2xl font-bold mb-2 ${t}`,children:"Доступ запрещен"}),r.jsx("p",{className:n,children:'Эта страница доступна только администраторам. Для входа используйте режим "Админ" на странице входа.'})]})})})},d4=()=>{var we;const{theme:s}=at(),{user:e,logout:t}=pt(),{isAdmin:n,deactivateAdmin:a}=kt(),i=$h(),[o,c]=I.useState(!1),[d,h]=I.useState(!1),[m,x]=I.useState([]),[f,k]=I.useState(null),[A,D]=I.useState(null),[T,H]=I.useState(null),[L,E]=I.useState([]),[M,ee]=I.useState({id:"",userId:"",title:"",text:"",priority:"medium",createdAt:"",updatedAt:""}),[C,v]=I.useState(!0),[p,w]=I.useState(!1),[N,j]=I.useState(""),[b,y]=I.useState(!1),[re,ue]=I.useState(!1),W=f0((e==null?void 0:e.id)||""),O=e||(n?{name:"Администратор",login:"admin",password:Bh}:null),P=e!=null&&e.id?(we=De.find(G=>G.id===e.id))==null?void 0:we.avatar:void 0,te=O!=null&&O.name?O.name.charAt(0).toUpperCase():"A",J=s==="dark"?"text-white":"text-gray-900";I.useEffect(()=>{(e||n)&&fe()},[e,n]);const fe=async()=>{if(!(!e&&!n)){v(!0);try{const G=(e==null?void 0:e.id)||"admin",oe=await Xc({assignedTo:G});if(x(oe),e){const _e=za(),Te=le(_e.start,"yyyy-MM-dd"),Je=le(_e.end,"yyyy-MM-dd"),Qe=Qi(30),Z=le(Qe.start,"yyyy-MM-dd"),ge=le(Qe.end,"yyyy-MM-dd"),ye=Qe.start.toISOString(),de=Qe.end.toISOString(),Ce=Qi(90),Ve=le(Ce.start,"yyyy-MM-dd"),q=le(Ce.end,"yyyy-MM-dd"),Ne=await Ea(G,Te,Je),Me=Ne.reduce((ve,Ie)=>{const lt=Ie.participants&&Ie.participants.length>0?Ie.participants.length:1;return ve+Ie.amount/lt},0),z=Ne.reduce((ve,Ie)=>{const lt=Ie.participants&&Ie.participants.length>0?Ie.participants.length:1;return ve+Ie.poolAmount/lt},0),B=await Ea(G,Z,ge),je=B.reduce((ve,Ie)=>{const lt=Ie.participants&&Ie.participants.length>0?Ie.participants.length:1;return ve+Ie.amount/lt},0),Pe=B.reduce((ve,Ie)=>{const lt=Ie.participants&&Ie.participants.length>0?Ie.participants.length:1;return ve+Ie.poolAmount/lt},0),Fe=await ns(G),pe=Fe.filter(ve=>{const Ie=ve.date,lt=ve.endDate||ve.date;return Ie<=ge&&lt>=Z}),Ze=pe.filter(ve=>ve.type==="dayoff").reduce((ve,Ie)=>ve+cr(Ie.date,Ie.endDate,Z,ge),0),He=pe.filter(ve=>ve.type==="sick").reduce((ve,Ie)=>ve+cr(Ie.date,Ie.endDate,Z,ge),0),et=pe.filter(ve=>ve.type==="vacation").reduce((ve,Ie)=>ve+cr(Ie.date,Ie.endDate,Z,ge),0),Ee=pe.filter(ve=>ve.type==="absence").reduce((ve,Ie)=>ve+cr(Ie.date,Ie.endDate,Z,ge),0),xt=Fe.filter(ve=>{const Ie=ve.date,lt=ve.endDate||ve.date;return Ie<=Je&&lt>=Te}),jt=xt.filter(ve=>ve.type==="dayoff").reduce((ve,Ie)=>ve+cr(Ie.date,Ie.endDate,Te,Je),0),_t=xt.filter(ve=>ve.type==="sick").reduce((ve,Ie)=>ve+cr(Ie.date,Ie.endDate,Te,Je),0),er=Fe.filter(ve=>{const Ie=ve.date,lt=ve.endDate||ve.date;return Ie<=q&&lt>=Ve}).filter(ve=>ve.type==="vacation").reduce((ve,Ie)=>ve+cr(Ie.date,Ie.endDate,Ve,q),0),me=(await fr(G)).filter(ve=>ve.date>=Te&&ve.date<=Je).reduce((ve,Ie)=>ve+jo(Ie.slots),0),Se=(await R0(G))[0]||{userId:G,earnings:0,messages:0,initiatives:0,signals:0,profitableSignals:0,referrals:0,daysOff:0,sickDays:0,vacationDays:0,absenceDays:0,poolAmount:0,rating:0,lastUpdated:new Date().toISOString()},Oe=(await M0(void 0,ye,de)).filter(ve=>ve.ownerId===G).length,ze={userId:G,earnings:je,messages:Se.messages||0,initiatives:Se.initiatives||0,signals:Se.signals||0,profitableSignals:Se.profitableSignals||0,referrals:Oe,daysOff:Ze,sickDays:He,vacationDays:et,absenceDays:Ee,poolAmount:Pe,lastUpdated:new Date().toISOString()};console.log("Profile.tsx calculateRating call for user:",G,{weeklyHours:me,weeklyEarnings:Me,weeklyDaysOff:jt,weeklySickDays:_t,ninetyDayVacationDays:er,updatedData:ze});const Be=U0(ze,me,Me,jt,_t,er),rt=B0(ze,me,Me,jt,_t,er);k({...ze,rating:Be}),D(rt),H({total:je,pool:Pe,net:Math.max(0,je-Pe),weekly:{gross:Me,pool:z,net:Math.max(0,Me-z)}});const ft=e!=null&&e.id?`notes-cache-${e.id}`:null,Et=ve=>{if(ft)try{localStorage.setItem(ft,JSON.stringify(ve))}catch(Ie){console.error("Error caching notes locally",Ie)}};try{if(e){const ve=await wh(e.id,n);E(ve),Et(ve)}else if(n){const ve=await wh(void 0,!0);E(ve),Et(ve)}}catch(ve){if(console.error("Error loading notes",ve),ft)try{const Ie=localStorage.getItem(ft);if(Ie){const lt=JSON.parse(Ie);E(lt)}}catch(Ie){console.error("Error loading cached notes",Ie)}}}}catch(G){console.error("Error loading profile data:",G)}finally{v(!1)}}},F=async()=>{if(!(e!=null&&e.id)||!M.title.trim()&&!M.text.trim())return;const G=e!=null&&e.id?`notes-cache-${e.id}`:null,oe=_e=>{if(G)try{localStorage.setItem(G,JSON.stringify(_e))}catch(Te){console.error("Error caching notes locally",Te)}};try{if(M.id){await gj(M.id,{title:M.title,text:M.text,priority:M.priority});const _e=L.map(Te=>Te.id===M.id?{...Te,title:M.title,text:M.text,priority:M.priority,updatedAt:new Date().toISOString()}:Te);E(_e),oe(_e)}else{const _e=await mj({userId:e.id,title:M.title,text:M.text,priority:M.priority}),Te=new Date().toISOString(),Je=[{id:_e,userId:e.id,title:M.title,text:M.text,priority:M.priority,createdAt:Te,updatedAt:Te},...L];E(Je),oe(Je)}}catch(_e){console.error("Error saving note",_e)}finally{ee({id:"",userId:"",title:"",text:"",priority:"medium",createdAt:"",updatedAt:""})}},ne=G=>{const oe=L.find(_e=>_e.id===G);oe&&ee(oe)},V=async G=>{const oe=e!=null&&e.id?`notes-cache-${e.id}`:null,_e=Te=>{if(oe)try{localStorage.setItem(oe,JSON.stringify(Te))}catch(Je){console.error("Error caching notes locally",Je)}};try{await pj(G);const Te=L.filter(Je=>Je.id!==G);E(Te),_e(Te),M.id===G&&ee({id:"",userId:"",title:"",text:"",priority:"medium",createdAt:"",updatedAt:""})}catch(Te){console.error("Error deleting note",Te)}},X=()=>{n&&a(),t(),i("/login")},S=()=>{e!=null&&e.password&&(navigator.clipboard.writeText(e.password),h(!0),setTimeout(()=>h(!1),2e3))},R=()=>{const G=O==null?void 0:O.login;G&&(navigator.clipboard.writeText(G),w(!0),setTimeout(()=>w(!1),2e3))},K=async()=>{if(!(e!=null&&e.id)||!N.trim())return;const G=N.trim(),oe=W||"";if(G===oe){y(!1),j("");return}ue(!0);try{const _e=await So(e.id);await vt({entity:"login",action:"update",authorId:e.id,targetUserId:e.id,before:_e||{id:"",userId:e.id,nickname:oe,createdAt:"",updatedAt:""},after:{id:"",userId:e.id,nickname:G,createdAt:"",updatedAt:""},comment:`Запрос на изменение ника с "${oe}" на "${G}"`}),y(!1),j(""),alert("Запрос на изменение ника отправлен на согласование администратору")}catch(_e){console.error("Error requesting nickname change:",_e),alert("Ошибка при отправке запроса на изменение ника")}finally{ue(!1)}},U=m.filter(G=>G.status==="in_progress").length,Q=m.filter(G=>G.status==="completed").length,$=m.filter(G=>G.status==="closed").length,ce={in_progress:{label:"В работе",classes:s==="dark"?"bg-blue-500/15 text-blue-100 border-blue-500/30":"bg-blue-50 text-blue-900 border-blue-200"},completed:{label:"Выполнена",classes:s==="dark"?"bg-emerald-500/15 text-emerald-50 border-emerald-500/30":"bg-emerald-50 text-emerald-900 border-emerald-200"},closed:{label:"Закрыта",classes:s==="dark"?"bg-gray-600/20 text-gray-100 border-gray-500/40":"bg-gray-50 text-gray-800 border-gray-200"}};return O?r.jsx(mr,{children:r.jsxs("div",{className:"space-y-6",children:[r.jsx("div",{className:`rounded-2xl p-6 border ${s==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white"} shadow-lg`,children:r.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4",children:[r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx("div",{className:"relative w-12 h-12 rounded-xl overflow-hidden shadow-lg border border-white/50 dark:border-white/10 bg-gradient-to-br from-[#4E6E49]/15 to-emerald-200/40 flex items-center justify-center",children:P?r.jsx("img",{src:P,alt:O.name,className:"w-full h-full object-cover",onError:G=>{const oe=G.target;oe.style.display="none"}}):r.jsx("span",{className:"text-lg font-extrabold text-[#4E6E49]",children:te})}),r.jsxs("div",{children:[r.jsx("p",{className:`text-xs uppercase tracking-[0.14em] ${s==="dark"?"text-gray-400":"text-gray-500"}`,children:"ApeVault Black Ops"}),r.jsx("h1",{className:`text-2xl sm:text-3xl font-extrabold ${J}`,children:"Личный кабинет"}),r.jsx("p",{className:`text-sm ${s==="dark"?"text-gray-300":"text-gray-600"}`,children:"Закрытый контур. Ваши данные и показатели."})]})]}),r.jsxs("div",{className:"flex flex-wrap gap-2",children:[r.jsxs("div",{className:"pill","data-active":"true",children:[r.jsx(Si,{className:"w-4 h-4"}),r.jsx("span",{children:O.name})]}),n&&r.jsxs("div",{className:"pill","data-active":"true",children:[r.jsx($t,{className:"w-4 h-4"}),r.jsx("span",{children:"Администратор"})]}),r.jsxs("div",{className:"pill","data-active":"false",children:[r.jsx(ts,{className:"w-4 h-4"}),r.jsxs("span",{children:[m.length," задач"]})]}),f&&r.jsxs("div",{className:"pill","data-active":"false",children:[r.jsx(sr,{className:"w-4 h-4"}),r.jsxs("span",{children:[f.rating.toFixed(1),"%"]})]}),r.jsxs(Qr,{to:"/rules",className:"inline-flex items-center gap-2 px-3 py-2 rounded-xl bg-gradient-to-r from-[#4E6E49] to-emerald-600 text-white text-sm font-semibold shadow-md hover:shadow-lg hover:-translate-y-0.5 transition-all",children:[r.jsx(pa,{className:"w-4 h-4"}),"Ознакомиться с правилами"]})]})]})}),C?r.jsx("div",{className:`rounded-xl p-8 text-center ${s==="dark"?"bg-white/5 text-white":"bg-white text-gray-800"} shadow`,children:"Загрузка..."}):r.jsxs("div",{className:"space-y-5",children:[r.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-[1.05fr_0.95fr] gap-4 items-stretch",children:[r.jsxs("div",{className:"space-y-4 flex flex-col",children:[r.jsxs("div",{className:`rounded-2xl p-5 border ${s==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white"} shadow flex-1`,children:[r.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[r.jsx("div",{className:`p-2.5 rounded-xl ${s==="dark"?"bg-blue-500/15 text-blue-200":"bg-blue-50 text-blue-700"}`,children:r.jsx(Si,{className:"w-5 h-5"})}),r.jsxs("div",{children:[r.jsx("h2",{className:`text-lg font-bold ${J}`,children:"Профиль"}),r.jsx("p",{className:`text-xs ${s==="dark"?"text-gray-400":"text-gray-500"}`,children:"Доступ и учетные данные"})]})]}),r.jsxs("div",{className:"grid sm:grid-cols-2 gap-3",children:[r.jsxs("div",{className:`p-4 rounded-xl border ${s==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white"} shadow-sm`,children:[r.jsx("p",{className:`text-xs font-semibold uppercase tracking-wide ${s==="dark"?"text-gray-400":"text-gray-500"}`,children:"Имя"}),r.jsx("p",{className:`mt-1 text-lg font-bold ${J}`,children:O.name})]}),r.jsxs("div",{className:`p-4 rounded-xl border ${s==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white"} shadow-sm`,children:[r.jsxs("div",{className:"flex items-center justify-between mb-1",children:[r.jsx("p",{className:`text-xs font-semibold uppercase tracking-wide ${s==="dark"?"text-gray-400":"text-gray-500"}`,children:"Ник"}),!b&&e&&!n&&r.jsxs("button",{onClick:async()=>{y(!0),j(W||"")},className:`text-xs px-2 py-1 rounded-lg border transition ${s==="dark"?"border-white/10 bg-white/5 hover:border-white/30 text-white":"border-gray-200 bg-white hover:border-gray-300 text-gray-700"}`,children:[r.jsx(Wo,{className:"w-3 h-3 inline mr-1"}),"Изменить"]})]}),b?r.jsxs("div",{className:"space-y-2 mt-1",children:[r.jsx("input",{type:"text",value:N,onChange:G=>j(G.target.value),placeholder:"Введите новый ник",className:`w-full px-3 py-2 rounded-lg border ${s==="dark"?"border-white/10 bg-white/5 text-white":"border-gray-200 bg-white text-gray-900"} text-sm`,disabled:re}),r.jsxs("div",{className:"flex gap-2",children:[r.jsx("button",{onClick:K,disabled:re||!N.trim(),className:`px-3 py-1.5 rounded-lg text-xs font-semibold transition ${re||!N.trim()?"opacity-50 cursor-not-allowed":"bg-[#4E6E49] text-white hover:bg-[#3d5639]"}`,children:re?"Отправка...":"Отправить на согласование"}),r.jsx("button",{onClick:()=>{y(!1),j("")},disabled:re,className:`px-3 py-1.5 rounded-lg text-xs font-semibold border transition ${s==="dark"?"border-white/10 bg-white/5 hover:border-white/30 text-white":"border-gray-200 bg-white hover:border-gray-300 text-gray-700"}`,children:"Отмена"})]}),r.jsx("p",{className:`text-xs ${s==="dark"?"text-gray-400":"text-gray-500"}`,children:"Изменение ника требует согласования администратора"})]}):r.jsx("div",{className:"flex items-center gap-2 mt-1",children:r.jsx("p",{className:`text-lg font-bold ${J}`,children:e!=null&&e.id?r.jsx(as,{userId:e.id}):"—"})})]}),r.jsxs("div",{className:`p-4 rounded-xl border ${s==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white"} shadow-sm`,children:[r.jsx("p",{className:`text-xs font-semibold uppercase tracking-wide ${s==="dark"?"text-gray-400":"text-gray-500"}`,children:"Логин"}),r.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[r.jsx("p",{className:`text-lg font-bold ${J}`,children:O.login}),r.jsx("button",{onClick:R,className:`p-2 rounded-lg border transition ${p?"bg-[#4E6E49] text-white border-[#4E6E49]":s==="dark"?"border-white/10 bg-white/5 hover:border-white/30":"border-gray-200 bg-white hover:border-gray-300"}`,title:"Скопировать логин",children:p?r.jsx(wr,{className:"w-4 h-4"}):r.jsx(xa,{className:"w-4 h-4"})})]})]})]}),r.jsxs("div",{className:"mt-4 space-y-2",children:[r.jsx("label",{className:`text-sm font-semibold ${s==="dark"?"text-gray-300":"text-gray-700"} block`,children:"Пароль"}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("div",{className:`flex-1 px-4 py-3 rounded-lg border ${s==="dark"?"border-white/10 bg-white/5 text-white":"border-gray-200 bg-white text-gray-900"} font-mono text-sm`,children:o?O.password:"•".repeat(O.password.length)}),r.jsx("button",{onClick:()=>c(!o),className:`p-3 rounded-lg border ${s==="dark"?"border-white/10 bg-white/5 hover:border-white/30":"border-gray-200 bg-white hover:border-gray-300"} transition`,title:o?"Скрыть пароль":"Показать пароль",children:o?r.jsx(cx,{className:"w-5 h-5"}):r.jsx(dl,{className:"w-5 h-5"})}),r.jsx("button",{onClick:S,className:`p-3 rounded-lg border transition ${d?"bg-[#4E6E49] text-white border-[#4E6E49]":s==="dark"?"border-white/10 bg-white/5 hover:border-white/30":"border-gray-200 bg-white hover:border-gray-300"}`,title:"Скопировать пароль",children:d?r.jsx(wr,{className:"w-5 h-5"}):r.jsx(xa,{className:"w-5 h-5"})})]})]}),r.jsx("div",{className:"mt-4 grid gap-3 sm:grid-cols-1",children:r.jsxs("div",{className:`p-4 rounded-xl border ${s==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white"} shadow-sm`,children:[r.jsx("p",{className:`text-xs font-semibold uppercase tracking-wide ${s==="dark"?"text-gray-400":"text-gray-500"}`,children:"Учебная панель (преподаватель)"}),r.jsxs("div",{className:"mt-2 space-y-2 text-sm",children:[r.jsxs("div",{className:`${s==="dark"?"text-gray-300":"text-gray-700"}`,children:[r.jsx("span",{className:"font-semibold",children:"Имя: "}),r.jsx("span",{className:"font-medium",children:"в разработке"})]}),r.jsxs("div",{className:`${s==="dark"?"text-gray-300":"text-gray-700"}`,children:[r.jsx("span",{className:"font-semibold",children:"Логин: "}),r.jsx("span",{className:"font-medium",children:"в разработке"})]}),r.jsxs("div",{className:`${s==="dark"?"text-gray-300":"text-gray-700"}`,children:[r.jsx("span",{className:"font-semibold",children:"Пароль: "}),r.jsx("span",{className:"font-medium",children:"в разработке"})]})]})]})})]}),r.jsxs("div",{className:`rounded-2xl p-5 border ${s==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white"} shadow flex-1`,children:[r.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[r.jsx("div",{className:`p-2.5 rounded-xl ${s==="dark"?"bg-green-500/15 text-green-200":"bg-green-50 text-[#4E6E49]"}`,children:r.jsx(ts,{className:"w-5 h-5"})}),r.jsxs("div",{children:[r.jsx("h2",{className:`text-lg font-bold ${J}`,children:"Мои задачи"}),r.jsx("p",{className:`text-xs ${s==="dark"?"text-gray-400":"text-gray-500"}`,children:"Сводка по статусам"})]})]}),r.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-3 mb-4",children:[{label:"В работе",value:U,classes:s==="dark"?"bg-blue-500/15 border-blue-500/30 text-blue-100":"bg-blue-50 border-blue-200 text-blue-900"},{label:"Выполнено",value:Q,classes:s==="dark"?"bg-emerald-500/15 border-emerald-500/30 text-emerald-50":"bg-emerald-50 border-emerald-200 text-emerald-900"},{label:"Закрыто",value:$,classes:s==="dark"?"bg-gray-600/20 border-gray-500/40 text-gray-100":"bg-gray-50 border-gray-200 text-gray-800"},{label:"Всего",value:m.length,classes:s==="dark"?"bg-gray-600/20 border-gray-500/40 text-gray-100":"bg-gray-50 border-gray-200 text-gray-800"}].map(({label:G,value:oe,classes:_e})=>r.jsxs("div",{className:`p-4 rounded-xl border shadow-sm transition-all hover:translate-y-[-2px] ${_e}`,children:[r.jsx("div",{className:"text-xs font-semibold mb-2 opacity-80",children:G}),r.jsx("div",{className:`text-3xl font-extrabold ${J}`,children:oe})]},G))}),m.length>0&&r.jsxs("div",{className:"space-y-2 mb-4",children:[r.jsx("p",{className:`text-sm font-semibold ${s==="dark"?"text-gray-200":"text-gray-800"}`,children:"Активные задачи"}),r.jsx("div",{className:"space-y-2",children:m.slice(0,3).map(G=>r.jsxs("div",{className:`p-3 rounded-lg border ${s==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-gray-50"} shadow-sm`,children:[r.jsxs("div",{className:"flex items-start justify-between gap-2",children:[r.jsxs("div",{className:"min-w-0",children:[r.jsx("p",{className:`text-sm font-semibold ${J} truncate`,children:G.title}),r.jsxs("p",{className:`text-xs ${s==="dark"?"text-gray-400":"text-gray-600"}`,children:["Дедлайн: ",G.dueDate?le(new Date(G.dueDate),"dd.MM.yyyy"):"—"," ",G.dueTime||""]})]}),r.jsx("span",{className:`text-[11px] px-2 py-1 rounded-full border ${ce[G.status].classes}`,children:ce[G.status].label})]}),G.description&&r.jsx("p",{className:`text-xs mt-2 ${s==="dark"?"text-gray-300":"text-gray-600"} line-clamp-2`,children:G.description})]},G.id))})]}),r.jsxs("div",{className:"mt-4 space-y-3",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(Ax,{className:"w-4 h-4 text-[#4E6E49]"}),r.jsx("p",{className:`text-sm font-semibold ${J}`,children:"Мои заметки"})]}),r.jsxs("div",{className:"grid gap-2 sm:grid-cols-2",children:[r.jsx("input",{type:"text",value:M.title,onChange:G=>ee({...M,title:G.target.value}),placeholder:"Заголовок",className:`px-3 py-2 rounded-lg border ${s==="dark"?"border-white/10 bg-white/5 text-white":"border-gray-200 bg-white text-gray-900"} text-sm`}),r.jsx("div",{className:"flex gap-2",children:["low","medium","high"].map(G=>r.jsx("button",{onClick:()=>ee({...M,priority:G}),className:`px-3 py-2 rounded-lg border text-sm flex-1 ${M.priority===G?"border-[#4E6E49] bg-[#4E6E49]/10 text-[#4E6E49]":s==="dark"?"border-white/10 bg-white/5 text-white":"border-gray-200 bg-white text-gray-800"}`,children:G==="low"?"Низкий":G==="medium"?"Средний":"Высокий"},G))})]}),r.jsx("textarea",{value:M.text,onChange:G=>ee({...M,text:G.target.value}),rows:3,placeholder:"Текст заметки",className:`w-full px-3 py-2 rounded-lg border ${s==="dark"?"border-white/10 bg-white/5 text-white":"border-gray-200 bg-white text-gray-900"} text-sm`}),r.jsxs("div",{className:"flex gap-2",children:[r.jsxs("button",{onClick:F,className:`px-4 py-2 rounded-lg font-semibold flex items-center gap-2 ${e!=null&&e.id?s==="dark"?"bg-[#4E6E49]/20 text-[#4E6E49] border border-[#4E6E49]/40":"bg-gradient-to-r from-[#4E6E49] to-emerald-500 text-white":"bg-gray-300 text-gray-600 cursor-not-allowed"}`,disabled:!(e!=null&&e.id),children:[r.jsx(Wo,{className:"w-4 h-4"}),M.id?"Сохранить":"Добавить"]}),M.id&&r.jsx("button",{onClick:()=>ee({id:"",userId:"",title:"",text:"",priority:"medium",createdAt:"",updatedAt:""}),className:`px-4 py-2 rounded-lg font-semibold border ${s==="dark"?"border-white/15 text-gray-200":"border-gray-200 text-gray-700"}`,children:"Отмена"})]}),L.length>0&&r.jsx("div",{className:"space-y-2",children:L.map(G=>r.jsx("div",{className:`p-3 rounded-lg border ${s==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-gray-50"} flex flex-col gap-1`,children:r.jsxs("div",{className:"flex items-start justify-between gap-2",children:[r.jsxs("div",{className:"min-w-0",children:[r.jsx("p",{className:`text-sm font-semibold ${J} truncate`,children:G.title||"Без названия"}),r.jsx("p",{className:`text-xs ${s==="dark"?"text-gray-400":"text-gray-600"} whitespace-pre-line`,children:G.text})]}),r.jsxs("div",{className:"flex items-center gap-1",children:[r.jsx("span",{className:`text-[11px] px-2 py-1 rounded-full border ${G.priority==="high"?"border-rose-200 bg-rose-50 text-rose-700 dark:border-rose-500/40 dark:bg-rose-500/15 dark:text-rose-50":G.priority==="medium"?"border-amber-200 bg-amber-50 text-amber-700 dark:border-amber-500/40 dark:bg-amber-500/15 dark:text-amber-50":"border-emerald-200 bg-emerald-50 text-emerald-700 dark:border-emerald-500/40 dark:bg-emerald-500/15 dark:text-emerald-50"}`,children:G.priority==="high"?"Высокий":G.priority==="medium"?"Средний":"Низкий"}),r.jsx("button",{onClick:()=>ne(G.id),className:`p-1 rounded border ${s==="dark"?"border-white/10 text-gray-200":"border-gray-200 text-gray-700"}`,title:"Редактировать",children:r.jsx(Wo,{className:"w-4 h-4"})}),r.jsx("button",{onClick:()=>V(G.id),className:`p-1 rounded border ${s==="dark"?"border-white/10 text-red-200":"border-gray-200 text-red-600"}`,title:"Удалить",children:r.jsx(At,{className:"w-4 h-4"})})]})]})},G.id))})]}),r.jsx("div",{className:"mt-4",children:r.jsxs("button",{onClick:()=>i("/tasks"),className:`w-full px-4 py-3 rounded-lg font-semibold transition-all flex items-center justify-center gap-2 ${s==="dark"?"bg-gradient-to-r from-[#4E6E49]/20 to-emerald-700/20 text-[#4E6E49] border border-[#4E6E49]/40":"bg-gradient-to-r from-green-50 to-emerald-50 text-[#4E6E49] border border-green-200"}`,children:[r.jsx(ts,{className:"w-4 h-4"}),"Перейти к задачам"]})})]})]}),r.jsxs("div",{className:"space-y-4 flex flex-col",children:[T&&r.jsxs("div",{className:`rounded-2xl p-5 border ${s==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white"} shadow flex-1`,children:[r.jsxs("div",{className:"flex items-center justify-between mb-4",children:[r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx("div",{className:`p-2.5 rounded-xl ${s==="dark"?"bg-emerald-500/20 text-emerald-200":"bg-emerald-50 text-emerald-700"}`,children:r.jsx(Sa,{className:"w-5 h-5"})}),r.jsxs("div",{children:[r.jsx("h2",{className:`text-lg font-bold ${J}`,children:"Мой заработок"}),r.jsx("p",{className:`text-xs ${s==="dark"?"text-gray-400":"text-gray-500"}`,children:"Суммы с учётом долей"})]})]}),r.jsx("div",{className:`px-3 py-1.5 rounded-full text-xs font-semibold border ${T.weekly.net>=1e4?"border-emerald-200 bg-emerald-50 text-emerald-800 dark:border-emerald-500/30 dark:bg-emerald-500/15 dark:text-emerald-100":"border-amber-200 bg-amber-50 text-amber-800 dark:border-amber-500/30 dark:bg-amber-500/15 dark:text-amber-100"}`,children:T.weekly.net>=1e4?"Вывод доступен":"Минимум 10 000 для вывода"})]}),r.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3 mb-4",children:[{label:"Всего заработано",value:T.total},{label:"Отправлено в пул",value:T.pool},{label:"Чистыми",value:T.net}].map(G=>r.jsxs("div",{className:`p-4 rounded-xl border shadow-sm ${s==="dark"?"border-white/10 bg-white/5":"border-gray-100 bg-gray-50"}`,children:[r.jsx("p",{className:"text-xs uppercase tracking-wide opacity-70",children:G.label}),r.jsxs("p",{className:`text-2xl font-extrabold ${J}`,children:[Math.round(G.value).toLocaleString("ru-RU")," ₽"]})]},G.label))}),r.jsxs("div",{className:`p-4 rounded-xl border ${s==="dark"?"border-white/10 bg-white/5":"border-emerald-50 bg-emerald-50/70"} flex flex-col gap-2`,children:[r.jsxs("div",{className:"flex items-center justify-between gap-2 flex-wrap",children:[r.jsxs("div",{children:[r.jsx("p",{className:`text-sm font-semibold ${J}`,children:"Активная неделя"}),r.jsx("p",{className:`text-xs ${s==="dark"?"text-gray-400":"text-gray-600"}`,children:"Понедельник, среда, пятница, суббота — дни вывода"})]}),r.jsx("span",{className:`text-xs px-3 py-1 rounded-full border ${T.weekly.net>=1e4?"border-emerald-200 bg-emerald-100 text-emerald-800 dark:border-emerald-500/40 dark:bg-emerald-500/15 dark:text-emerald-50":"border-amber-200 bg-amber-100 text-amber-800 dark:border-amber-500/40 dark:bg-amber-500/15 dark:text-amber-50"}`,children:T.weekly.net>=1e4?"Доступно к выводу":"Перенос на следующую неделю"})]}),r.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3",children:[{label:"Заработано за неделю",value:T.weekly.gross},{label:"В пул за неделю",value:T.weekly.pool},{label:"Чистыми за неделю",value:T.weekly.net}].map(G=>r.jsxs("div",{className:`p-3 rounded-lg border ${s==="dark"?"border-white/10 bg-white/5":"border-white/80 bg-white/80"} shadow-sm`,children:[r.jsx("p",{className:"text-[11px] uppercase tracking-wide opacity-70",children:G.label}),r.jsxs("p",{className:`text-lg font-bold ${J}`,children:[Math.round(G.value).toLocaleString("ru-RU")," ₽"]})]},G.label))}),T.weekly.net<1e4&&r.jsx("p",{className:`text-xs ${s==="dark"?"text-amber-200":"text-amber-700"}`,children:"Менее 10 000 ₽ чистыми за активную неделю — вывод недоступен, сумма переносится на следующую неделю."})]})]}),f&&A&&r.jsxs("div",{className:`rounded-2xl p-5 border ${s==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white"} shadow flex-1`,children:[r.jsxs("div",{className:"flex items-center justify-between mb-4",children:[r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx("div",{className:`p-2.5 rounded-xl ${s==="dark"?"bg-purple-500/20 text-purple-200":"bg-purple-50 text-purple-700"}`,children:r.jsx(sr,{className:"w-5 h-5"})}),r.jsxs("div",{children:[r.jsx("h2",{className:`text-lg font-bold ${J}`,children:"Рейтинг"}),r.jsx("p",{className:`text-xs ${s==="dark"?"text-gray-400":"text-gray-500"}`,children:"Еженедельная оценка"})]})]}),r.jsx("div",{className:"pill","data-active":"true",children:r.jsxs("span",{className:"font-bold",children:[f.rating.toFixed(1),"%"]})})]}),r.jsxs("div",{className:`p-4 rounded-xl border ${s==="dark"?"border-white/10 bg-white/5":"border-gray-100 bg-gray-50"} mb-4`,children:[r.jsxs("div",{className:`text-4xl font-extrabold ${J}`,children:[f.rating.toFixed(1),"%"]}),r.jsx("p",{className:`text-xs mt-1 ${s==="dark"?"text-gray-400":"text-gray-600"}`,children:f.rating>=70?"Отличный результат":f.rating>=50?"Хороший темп":"Требуется усиление показателей"})]}),r.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[{label:"Выходные",value:`${A.daysOff} дн`,pts:A.daysOffPoints,classes:s==="dark"?"bg-slate-700/40 border-slate-600/60":"bg-slate-50 border-slate-200"},{label:"Больничные",value:`${f.sickDays} дн`,pts:A.sickDaysPoints,classes:s==="dark"?"bg-amber-500/15 border-amber-500/30":"bg-amber-50 border-amber-200"},{label:"Отпуск",value:`${f.vacationDays} дн`,pts:A.vacationDaysPoints,classes:s==="dark"?"bg-orange-500/15 border-orange-500/30":"bg-orange-50 border-orange-200"},{label:"Часы",value:`${A.weeklyHours.toFixed(1)} ч/нед`,pts:A.weeklyHoursPoints,classes:s==="dark"?"bg-blue-500/15 border-blue-500/30":"bg-blue-50 border-blue-200"},{label:"Заработок",value:`${A.weeklyEarnings.toFixed(0)} ₽/нед`,pts:A.weeklyEarningsPoints,classes:s==="dark"?"bg-emerald-500/15 border-emerald-500/30":"bg-emerald-50 border-emerald-200"},{label:"Рефералы",value:`${f.referrals}`,pts:A.referralsPoints,classes:s==="dark"?"bg-purple-500/15 border-purple-500/30":"bg-purple-50 border-purple-200"}].map(G=>r.jsxs("div",{className:`p-3 rounded-xl border shadow-sm ${G.classes}`,children:[r.jsx("div",{className:"text-xs font-semibold uppercase opacity-80",children:G.label}),r.jsx("div",{className:`text-lg font-bold ${J}`,children:G.value}),r.jsxs("div",{className:`text-sm ${s==="dark"?"text-gray-100":"text-gray-800"}`,children:[G.pts.toFixed(1),"%"]})]},G.label))}),r.jsxs("div",{className:`mt-4 p-4 rounded-xl border ${s==="dark"?"border-white/10 bg-white/5":"border-gray-100 bg-gray-50"}`,children:[r.jsxs("h3",{className:`text-sm font-bold ${J} mb-2 flex items-center gap-2`,children:[r.jsx(_r,{className:"w-4 h-4"}),"Как считается рейтинг"]}),r.jsx("p",{className:`text-xs ${s==="dark"?"text-gray-300":"text-gray-700"}`,children:"7 параметров: выходные, больничные, отпуск (месяц), часы, доход, рефералы, сообщения (неделя). Максимум 100%."})]})]})]})]}),r.jsx("div",{className:`rounded-2xl p-5 border ${s==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white"} shadow`,children:r.jsxs("button",{onClick:X,className:`w-full px-6 py-3.5 rounded-lg font-semibold transition-all flex items-center justify-center gap-2 ${s==="dark"?"bg-gradient-to-r from-red-500/20 to-pink-500/20 text-red-300 border border-red-500/50":"bg-gradient-to-r from-red-50 to-pink-50 text-red-700 border border-red-200"}`,children:[r.jsx(bx,{className:"w-5 h-5"}),"Выйти из аккаунта"]})})]})]})}):r.jsx(mr,{children:r.jsx("div",{className:"text-center py-12",children:r.jsx("p",{className:J,children:"Необходима авторизация"})})})},u4="/assets/image-779ddbd9-e512-4bda-8983-af1ab9237b7c-B_v6l7J0.png",h4=()=>{const{theme:s}=at(),e=s==="dark"?"text-white":"text-gray-900",t=s==="dark"?"text-gray-400":"text-gray-600",n=[{title:"Финансовая грамотность",note:"Учимся управлять рисками, понимать токеномику и принимать решения на основе анализа, а не эмоций.",accent:"from-emerald-200 to-teal-200"},{title:"Приватность превыше всего",note:"Уважаем личные границы и используем инструменты, защищающие цифровую идентичность.",accent:"from-sky-200 to-blue-200"},{title:"Образование и развитие",note:"Учимся от основ блокчейна до продвинутых DeFi-стратегий и делимся знаниями.",accent:"from-amber-200 to-orange-200"},{title:"Честность и прозрачность",note:"Внутри клуба — открытость, честные сделки и уважение. Доверие строим действиями.",accent:"from-purple-200 to-indigo-200"},{title:"Инновации и эксперименты",note:"Тестируем новые протоколы, участвуем в DAO, не боимся быть первыми в трендах.",accent:"from-pink-200 to-rose-200"},{title:"Критическое мышление",note:"Не следуем слепо за хайпом: анализируем, проверяем источники и опираемся на здравый смысл.",accent:"from-cyan-200 to-teal-200"},{title:"Глобальное мышление",note:"Открыты к сотрудничеству с людьми из разных стран ради цифровой и финансовой свободы в рамках закона.",accent:"from-lime-200 to-green-200"},{title:"Свобода и ответственность",note:"Ценим свободу крипты и понимаем её цену: зрелость, самоконтроль и ответственность за решения.",accent:"from-gray-200 to-slate-200"}],a=[{label:"Что такое ApeVault?",value:"Клуб криптоэнтузиастов, где знания превращаются в действие."},{label:"Цель",value:"Объединить инвесторов и трейдеров ради роста дохода и безопасности входа в рынок."}];return r.jsx(mr,{children:r.jsxs("div",{className:"space-y-7 sm:space-y-8",children:[r.jsxs("div",{className:"section-card rounded-3xl p-6 sm:p-8 border border-white/60 dark:border-white/10 shadow-2xl relative overflow-hidden",children:[r.jsx("div",{className:"accent-dots"}),r.jsx("div",{className:"absolute inset-y-0 right-0 w-1/3 pointer-events-none bg-gradient-to-l from-[#4E6E49]/10 to-transparent blur-2xl"}),r.jsxs("div",{className:"relative z-10 flex flex-col gap-5 lg:flex-row lg:items-center lg:justify-between",children:[r.jsxs("div",{className:"space-y-3 max-w-3xl",children:[r.jsxs("div",{className:"inline-flex items-center gap-2 px-3 py-1.5 rounded-full border border-white/50 dark:border-white/10 bg-white/70 dark:bg-white/5 text-xs font-semibold uppercase tracking-[0.16em]",children:[r.jsx(_r,{className:"w-4 h-4 text-[#4E6E49]"}),"ApeVault Community"]}),r.jsx("h1",{className:`text-3xl sm:text-4xl lg:text-5xl font-extrabold leading-tight ${e}`,children:"О нас и нашем сообществе"}),r.jsx("p",{className:`text-sm sm:text-base ${t} max-w-2xl`,children:"ApeVault — это пространство, где опытные криптоэнтузиасты объединяют знания и проверенные стратегии, чтобы безопасно заходить в рынок и расти вместе."}),r.jsx("div",{className:"flex flex-wrap gap-2",children:["Командные сессии","Проверенные стратегии","Прозрачные регламенты"].map(i=>r.jsx("span",{className:`px-3 py-1.5 rounded-full text-xs font-semibold border ${s==="dark"?"border-white/10 bg-white/5 text-white":"border-gray-200 bg-white text-gray-900"}`,children:i},i))})]}),r.jsx("div",{className:"grid grid-cols-2 gap-3 w-full max-w-xs lg:max-w-sm",children:[{label:"Участников",value:"50+"},{label:"Сессий / неделю",value:"10+"},{label:"Уроков",value:"100+"},{label:"Фокуса",value:"100% качество"}].map(i=>r.jsxs("div",{className:`rounded-2xl border p-3 sm:p-4 shadow-sm ${s==="dark"?"border-white/10 bg-white/5 text-white":"border-gray-200 bg-white text-gray-900"}`,children:[r.jsx("p",{className:"text-[11px] uppercase tracking-wide opacity-70",children:i.label}),r.jsx("p",{className:"text-xl font-extrabold leading-tight mt-1",children:i.value})]},i.label))})]})]}),r.jsxs("div",{className:"section-card rounded-3xl p-6 sm:p-7 border border-white/60 dark:border-white/10 shadow-xl relative overflow-hidden",children:[r.jsx("div",{className:"absolute top-0 right-0 w-40 h-40 bg-gradient-to-br from-emerald-500/10 to-blue-500/10 rounded-full blur-3xl -mr-16 -mt-16"}),r.jsxs("div",{className:"relative z-10 space-y-4",children:[r.jsxs("h2",{className:`text-2xl sm:text-3xl font-extrabold ${e} flex items-center gap-2`,children:[r.jsx(nr,{className:"w-6 h-6 text-[#4E6E49]"}),"Что такое ApeVault?"]}),r.jsx("div",{className:"grid gap-4 sm:grid-cols-2",children:a.map(i=>r.jsxs("div",{className:`rounded-2xl border p-4 sm:p-5 flex gap-3 items-start ${s==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white"}`,children:[r.jsx("div",{className:"p-2 rounded-xl bg-gradient-to-br from-[#4E6E49] to-emerald-600 text-white shadow-lg",children:r.jsx(Cr,{className:"w-4 h-4"})}),r.jsxs("div",{className:"space-y-1",children:[r.jsx("p",{className:"text-xs uppercase tracking-wide text-[#4E6E49] font-semibold",children:i.label}),r.jsx("p",{className:`text-sm sm:text-base leading-relaxed ${e}`,children:i.value})]})]},i.label))})]})]}),r.jsxs("div",{className:"section-card rounded-3xl p-6 sm:p-7 border border-white/60 dark:border-white/10 shadow-xl relative overflow-hidden",children:[r.jsx("div",{className:"absolute -left-10 top-0 w-52 h-52 bg-gradient-to-br from-amber-400/10 to-rose-400/10 rounded-full blur-3xl"}),r.jsx("div",{className:"absolute -right-10 bottom-0 w-52 h-52 bg-gradient-to-br from-blue-400/10 to-emerald-400/10 rounded-full blur-3xl"}),r.jsxs("div",{className:"relative z-10 space-y-5",children:[r.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-3",children:[r.jsx("h2",{className:`text-2xl sm:text-3xl font-extrabold ${e}`,children:"Принципы, которые держат нас на вершине"}),r.jsxs("div",{className:"flex gap-2",children:[r.jsxs(Qr,{to:"/rules",className:"pill justify-center text-center","data-active":"false",children:["Ознакомиться с правилами",r.jsx(Cr,{className:"w-4 h-4"})]}),r.jsxs("a",{href:"#contacts",className:"pill","data-active":"false",children:["Контакты",r.jsx(Cr,{className:"w-4 h-4"})]})]})]}),r.jsxs("div",{className:"grid lg:grid-cols-[1fr_420px_1fr] gap-6 items-center",children:[r.jsx("div",{className:"space-y-3",children:n.slice(0,4).map(i=>r.jsxs("div",{className:`rounded-2xl border px-4 py-3 flex items-start gap-3 ${s==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white/90"}`,children:[r.jsx("div",{className:`p-2 rounded-xl text-gray-900 bg-gradient-to-br ${i.accent}`,children:r.jsx(Cr,{className:"w-4 h-4"})}),r.jsxs("div",{className:"space-y-1",children:[r.jsx("p",{className:`text-sm sm:text-base font-semibold ${e}`,children:i.title}),i.note&&r.jsx("p",{className:`text-xs ${t}`,children:i.note})]})]},i.title))}),r.jsxs("div",{className:`rounded-3xl border shadow-xl overflow-hidden relative ${s==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white/95"}`,children:[r.jsx("img",{src:u4,alt:"Принципы ApeVault",className:"w-full h-full object-contain"}),r.jsx("div",{className:"absolute inset-0 pointer-events-none bg-gradient-to-b from-transparent via-transparent to-white/0"})]}),r.jsx("div",{className:"space-y-3",children:n.slice(4).map(i=>r.jsxs("div",{className:`rounded-2xl border px-4 py-3 flex items-start gap-3 ${s==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white/90"}`,children:[r.jsx("div",{className:`p-2 rounded-xl text-gray-900 bg-gradient-to-br ${i.accent}`,children:r.jsx(Cr,{className:"w-4 h-4"})}),r.jsxs("div",{className:"space-y-1",children:[r.jsx("p",{className:`text-sm sm:text-base font-semibold ${e}`,children:i.title}),i.note&&r.jsx("p",{className:`text-xs ${t}`,children:i.note})]})]},i.title))})]})]})]}),r.jsxs("div",{id:"rules",className:"section-card rounded-3xl p-6 sm:p-7 border border-white/60 dark:border-white/10 shadow-xl relative overflow-hidden",children:[r.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-indigo-100/50 via-white/40 to-purple-100/40 dark:from-indigo-900/30 dark:via-transparent dark:to-purple-900/20"}),r.jsxs("div",{className:"relative z-10 grid gap-5 sm:grid-cols-[1.15fr_0.85fr] items-center",children:[r.jsxs("div",{className:"space-y-3",children:[r.jsxs("div",{className:"inline-flex items-center gap-2 px-3 py-1.5 rounded-full bg-white/80 dark:bg-white/10 border border-white/60 dark:border-white/10 text-xs font-semibold tracking-wide text-indigo-700 dark:text-white",children:[r.jsx(pa,{className:"w-4 h-4"}),"Правила сообщества"]}),r.jsx("h2",{className:`text-2xl sm:text-3xl font-extrabold ${e}`,children:"Простой регламент, чтобы оставаться на одной волне"}),r.jsx("p",{className:`text-sm sm:text-base ${t}`,children:"Подробно описали процессы, безопасность и взаимодействие, чтобы каждый чувствовал прозрачность и поддержку."}),r.jsx("div",{className:"flex flex-wrap gap-2",children:["Безопасность","Честные сделки","Уважение","Прозрачность"].map(i=>r.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-semibold border ${s==="dark"?"border-white/10 bg-white/5 text-white":"border-indigo-100 bg-white text-indigo-900"}`,children:i},i))}),r.jsxs(Qr,{to:"/rules",className:"inline-flex items-center gap-2 px-5 py-3 rounded-xl bg-gradient-to-r from-indigo-500 to-purple-500 text-white font-semibold shadow-lg hover:shadow-xl hover:-translate-y-0.5 transition-all",children:[r.jsx(pa,{className:"w-5 h-5"}),r.jsx("span",{children:"Ознакомиться с правилами"}),r.jsx(Cr,{className:"w-4 h-4"})]})]}),r.jsx("div",{className:`rounded-2xl border p-4 sm:p-5 shadow-lg ${s==="dark"?"border-white/10 bg-white/5":"border-white/80 bg-white/90"}`,children:r.jsx("div",{className:"space-y-3",children:["Короткие правила для быстрых решений","Фокус на безопасности и приватности","Прозрачные роли и ответственность","Действуем в рамках законодательства"].map(i=>r.jsxs("div",{className:"flex items-start gap-2",children:[r.jsx("div",{className:"w-2 h-2 rounded-full bg-indigo-500 mt-2"}),r.jsx("p",{className:`text-sm ${e}`,children:i})]},i))})})]})]}),r.jsxs("div",{id:"contacts",className:"section-card rounded-3xl p-6 sm:p-7 border border-white/60 dark:border-white/10 shadow-xl relative overflow-hidden",children:[r.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-rose-100/50 via-white/40 to-amber-100/40 dark:from-rose-900/25 dark:via-transparent dark:to-amber-900/20"}),r.jsxs("div",{className:"relative z-10 grid gap-5 sm:grid-cols-[0.9fr_1.1fr] items-center",children:[r.jsxs("div",{className:`p-4 rounded-2xl shadow-lg inline-flex items-center gap-3 ${s==="dark"?"bg-gradient-to-br from-rose-600 to-amber-600 text-white":"bg-gradient-to-br from-rose-500 to-amber-500 text-white"}`,children:[r.jsx(vx,{className:"w-7 h-7"}),r.jsxs("div",{children:[r.jsx("p",{className:"text-xs uppercase tracking-wide",children:"Контакты клуба"}),r.jsx("p",{className:"text-base font-semibold",children:"Свяжитесь с нами"})]})]}),r.jsxs("div",{className:"grid gap-3 sm:grid-cols-2",children:[r.jsxs("div",{className:`rounded-2xl border p-4 shadow-md flex flex-col gap-2 ${s==="dark"?"border-white/10 bg-white/5":"border-white/80 bg-white/90"}`,children:[r.jsx("p",{className:"text-xs uppercase tracking-wide text-rose-600 dark:text-rose-200 font-semibold",children:"Администратор"}),r.jsx("p",{className:`text-lg font-extrabold ${e}`,children:"@artyommedoed"}),r.jsx("p",{className:`text-sm ${t}`,children:"По вопросам правил, доступов и регламентов."})]}),r.jsxs("div",{className:`rounded-2xl border p-4 shadow-md flex flex-col gap-2 ${s==="dark"?"border-white/10 bg-white/5":"border-white/80 bg-white/90"}`,children:[r.jsx("p",{className:"text-xs uppercase tracking-wide text-amber-600 dark:text-amber-200 font-semibold",children:"Обратная связь"}),r.jsx("p",{className:`text-lg font-extrabold ${e}`,children:"Командный чат"}),r.jsx("p",{className:`text-sm ${t}`,children:"Оперативные вопросы по продуктам и сессиям."}),r.jsxs("a",{href:"https://t.me/+vPZdPwPaaKI1MjAy",target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-2 text-sm font-semibold text-[#4E6E49] hover:text-emerald-600",children:["Присоединиться",r.jsx(Cr,{className:"w-4 h-4"})]})]})]})]})]})]})})},Gr=({title:s,description:e,children:t})=>{const{theme:n}=at(),a=n==="dark"?"text-white":"text-gray-900",i=n==="dark"?"text-gray-400":"text-gray-600";return r.jsx("div",{className:"section-card rounded-3xl p-6 sm:p-7 border border-white/60 dark:border-white/10 shadow-xl relative overflow-hidden",children:r.jsxs("div",{className:"relative z-10 space-y-4",children:[r.jsxs("div",{className:"flex items-start gap-3",children:[r.jsx("div",{className:"p-2 rounded-xl bg-gradient-to-br from-[#4E6E49]/20 to-emerald-500/15 text-[#4E6E49]",children:r.jsx(pa,{className:"w-5 h-5"})}),r.jsxs("div",{className:"space-y-1",children:[r.jsx("h2",{className:`text-xl sm:text-2xl font-extrabold ${a}`,children:s}),e&&r.jsx("p",{className:`text-sm ${i}`,children:e})]})]}),t]})})},m4=()=>{const{theme:s}=at(),e=s==="dark"?"text-white":"text-gray-900",t=s==="dark"?"text-gray-400":"text-gray-600",n=["последовательной эскалации","объективности и равного применения","недопустимости злоупотребления полномочиями","исключения спорных трактовок и субъективности"],a=["единичные опоздания (не более 1 раза за календарную неделю)","некорректное выполнение инструкций без последствий вследствие заболевания или сбоев в ПО","нарушение регламента общения, не приводящее к конфликту"],i=["повторяющиеся нарушения регламента","несоблюдение правил торговой сессии","недостаточная подготовка к сессии","игнорирование инструкций ведущего","нарушение процедур безопасности данных или доступа"],o=["оскорбления участников","провокации и попытки вызвать конфликт","манипуляции и мошеннические действия","действия, создающие финансовые, репутационные или организационные риски","подрыв дисциплины и порядка в сообществе"],c=[{term:"Нарушение",text:"любое действие или бездействие, противоречащее регламентам ApeVault"},{term:"Предупреждение",text:"официальное уведомление о нарушении"},{term:"Выговор",text:"фиксируемая мера повышенной строгости при повторных нарушениях"},{term:"Ведущий торговой сессии",text:"управляет процессом и следит за соблюдением регламента на сессии"},{term:"Ответственный за сообщество",text:"назначенное лицо, управляющее дисциплиной и коммуникацией"},{term:"Повторное нарушение",text:"нарушение в течение 30 календарных дней после предыдущего"}];return r.jsx(mr,{children:r.jsxs("div",{className:"space-y-7 sm:space-y-8",children:[r.jsxs("div",{className:"section-card rounded-3xl p-6 sm:p-8 border border-white/60 dark:border-white/10 shadow-2xl relative overflow-hidden",children:[r.jsx("div",{className:"accent-dots"}),r.jsx("div",{className:"absolute inset-y-0 right-0 w-1/3 pointer-events-none bg-gradient-to-l from-[#4E6E49]/12 to-transparent blur-3xl"}),r.jsxs("div",{className:"relative z-10 flex flex-col gap-5 lg:flex-row lg:items-center lg:justify-between",children:[r.jsxs("div",{className:"space-y-4 max-w-3xl",children:[r.jsx("div",{className:"inline-flex items-center gap-2 px-3 py-1.5 rounded-full border border-white/50 dark:border-white/10 bg-white/70 dark:bg-white/5 text-xs font-semibold uppercase tracking-[0.16em] text-[#4E6E49]",children:"ApeVault Standard Operating Code — ASOC"}),r.jsx("h1",{className:`text-3xl sm:text-4xl lg:text-5xl font-extrabold leading-tight ${e}`,children:"Кодекс операционных процедур и регламентов платформы ApeVault"}),r.jsx("p",{className:`text-sm sm:text-base ${t}`,children:"Единые правила ответственности, дисциплинарных мер и прозрачных процедур для команды ApeVault."}),r.jsx("div",{className:"flex flex-wrap gap-2",children:["Ответственность","Прозрачность","Безопасность","Справедливость"].map(d=>r.jsx("span",{className:`px-3 py-1.5 rounded-full text-xs font-semibold border ${s==="dark"?"border-white/10 bg-white/5 text-white":"border-gray-200 bg-white text-gray-900"}`,children:d},d))})]}),r.jsxs("div",{className:`rounded-3xl border shadow-xl p-4 sm:p-5 w-full lg:max-w-sm ${s==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white"}`,children:[r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx("div",{className:"p-3 rounded-2xl bg-gradient-to-br from-[#4E6E49] to-emerald-600 text-white shadow-lg",children:r.jsx(Da,{className:"w-6 h-6"})}),r.jsxs("div",{children:[r.jsx("p",{className:"text-xs uppercase tracking-wide text-[#4E6E49] font-semibold",children:"Назначение раздела"}),r.jsx("p",{className:`text-base font-semibold ${e}`,children:"Поддержание порядка и профессионализма команды"})]})]}),r.jsxs("div",{className:"mt-4 space-y-3",children:[r.jsxs("div",{className:"flex items-center gap-2 text-sm font-semibold text-[#4E6E49]",children:[r.jsx(Cr,{className:"w-4 h-4"}),"Публичная версия правил доступна на сайте"]}),r.jsx("p",{className:`text-xs ${t}`,children:"Используйте кнопку «Правила» в навигации или в профиле, чтобы быстро открыть этот раздел."}),r.jsxs("a",{href:"/rules.pdf",download:!0,className:`inline-flex items-center gap-2 px-4 py-2.5 rounded-xl border transition-all shadow-sm hover:shadow-md hover:-translate-y-0.5 ${s==="dark"?"border-white/20 bg-white/10 text-white hover:bg-white/15":"border-[#4E6E49]/30 bg-[#4E6E49]/10 text-[#4E6E49] hover:bg-[#4E6E49]/15"}`,children:[r.jsx(Wh,{className:"w-4 h-4"}),r.jsx("span",{className:"text-sm font-semibold",children:"Скачать правила (PDF)"})]})]})]})]})]}),r.jsxs(Gr,{title:"Политика ответственности и меры дисциплинарного воздействия",description:"Единый порядок применения мер для поддержания порядка, прозрачности и профессионального уровня.",children:[r.jsxs("div",{className:`grid gap-4 sm:grid-cols-2 ${s==="dark"?"text-gray-200":"text-gray-900"}`,children:[r.jsxs("div",{className:`rounded-2xl border p-4 sm:p-5 ${s==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white"}`,children:[r.jsxs("div",{className:"flex items-center gap-2 text-sm font-semibold text-[#4E6E49]",children:[r.jsx(Ud,{className:"w-4 h-4"}),"Цели дисциплинарной политики"]}),r.jsx("p",{className:`text-sm mt-2 ${t}`,children:"Обеспечить соблюдение регламентов, процедур и рабочих стандартов команды."})]}),r.jsxs("div",{className:`rounded-2xl border p-4 sm:p-5 ${s==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white"}`,children:[r.jsxs("div",{className:"flex items-center gap-2 text-sm font-semibold text-[#4E6E49]",children:[r.jsx(Tx,{className:"w-4 h-4"}),"Принципы применения мер"]}),r.jsx("ul",{className:`text-sm mt-2 space-y-1 ${t}`,children:n.map(d=>r.jsxs("li",{children:["• ",d]},d))})]})]}),r.jsx("div",{className:`mt-3 text-sm ${t}`,children:"Меры ответственности применяются в зависимости от тяжести, регулярности и последствий нарушения."})]}),r.jsx(Gr,{title:"Унифицированный регламент торговой деятельности ApeVault",description:"Нормы поведения на торговых сессиях, полномочия ведущего, перерывы, записи и конфиденциальность.",children:r.jsxs("div",{className:`space-y-4 text-sm ${t}`,children:[r.jsxs("div",{className:`rounded-2xl border p-4 sm:p-5 ${s==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white"}`,children:[r.jsx("p",{className:"text-base font-semibold text-[#4E6E49]",children:"1. Общие положения"}),r.jsxs("ul",{className:"mt-2 space-y-1",children:[r.jsx("li",{children:"• Регламент задаёт нормы участия, дисциплину, полномочия ведущего и ответственность."}),r.jsx("li",{children:"• Все участники обязаны ознакомиться с разделом до начала торговой деятельности."})]})]}),r.jsxs("div",{className:`rounded-2xl border p-4 sm:p-5 ${s==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white"}`,children:[r.jsx("p",{className:"text-base font-semibold text-[#4E6E49]",children:"2. Права и полномочия ведущего"}),r.jsx("p",{className:"mt-2 font-semibold text-[#4E6E49]",children:"Полномочия:"}),r.jsxs("ul",{className:"mt-1 space-y-1",children:[r.jsx("li",{children:"• Давать обязательные распоряжения по порядку, действиям, стратегии и дисциплине."}),r.jsx("li",{children:"• Требовать соблюдения тайминга, регламента и корректного поведения."}),r.jsx("li",{children:"• Приостанавливать участие нарушающих участников."}),r.jsx("li",{children:"• Объявлять перерывы и завершение сессии."}),r.jsx("li",{children:"• Фиксировать нарушения, выдавать предупреждения/выговоры, вводить временный запрет на участие."})]}),r.jsx("p",{className:"mt-3 font-semibold text-[#4E6E49]",children:"Ограничения:"}),r.jsxs("ul",{className:"mt-1 space-y-1",children:[r.jsx("li",{children:"• Не изменяет дисциплинарные меры, установленные регламентом."}),r.jsx("li",{children:"• Не принимает решения об исключении из команды (решает ответственный за команду)."}),r.jsx("li",{children:"• Не меняет торговую стратегию вне утверждённой методологии или плана сессии."})]})]}),r.jsxs("div",{className:`rounded-2xl border p-4 sm:p-5 space-y-3 ${s==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white"}`,children:[r.jsx("p",{className:"text-base font-semibold text-[#4E6E49]",children:"3. Порядок проведения сессии"}),r.jsxs("div",{children:[r.jsx("p",{className:"font-semibold",children:"Начало и окончание:"}),r.jsxs("ul",{className:"mt-1 space-y-1",children:[r.jsx("li",{children:"• Старт строго по времени слота."}),r.jsx("li",{children:"• Подключение за 3–5 минут до старта обязательно."}),r.jsx("li",{children:"• Окончание объявляет ведущий, не позднее 30 минут после окончания слота."})]})]}),r.jsxs("div",{children:[r.jsx("p",{className:"font-semibold",children:"Поведение во время торгов:"}),r.jsx("p",{className:"text-xs uppercase tracking-wide opacity-70 mt-1",children:"Запрещено:"}),r.jsxs("ul",{className:"space-y-1",children:[r.jsx("li",{children:"• Перебивать ведущего или участников."}),r.jsx("li",{children:"• Отвлекать команду сторонними вопросами."}),r.jsx("li",{children:"• Включать микрофон без необходимости, создавать шум."}),r.jsx("li",{children:"• Саботировать процесс или предлагать несогласованные решения."}),r.jsx("li",{children:"• Коммуницировать с кем-либо вне участников сессии."})]}),r.jsx("p",{className:"text-xs uppercase tracking-wide opacity-70 mt-2",children:"Обязано:"}),r.jsxs("ul",{className:"space-y-1",children:[r.jsx("li",{children:"• Следовать инструкциям ведущего и оперативно исполнять распоряжения."}),r.jsx("li",{children:"• Сохранять корректность и нейтральность в коммуникации."}),r.jsx("li",{children:"• Обеспечивать техническую готовность: связь, устройство, ПО."})]})]})]}),r.jsxs("div",{className:`rounded-2xl border p-4 sm:p-5 space-y-2 ${s==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white"}`,children:[r.jsx("p",{className:"text-base font-semibold text-[#4E6E49]",children:"4. Политика перерывов"}),r.jsxs("ul",{className:"space-y-1",children:[r.jsx("li",{children:"• Краткий перерыв — до 10 минут каждые 45 минут."}),r.jsx("li",{children:"• Большой перерыв — до 45 минут каждые 3 часа активной торговли."}),r.jsx("li",{children:"• Все перерывы объявляет ведущий."}),r.jsx("li",{children:"• Самовольные перерывы запрещены; нарушение дисциплины, если не согласовано в трекере слотов и с ответственным."})]})]}),r.jsxs("div",{className:`rounded-2xl border p-4 sm:p-5 space-y-2 ${s==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white"}`,children:[r.jsx("p",{className:"text-base font-semibold text-[#4E6E49]",children:"5. Правила записи сессий"}),r.jsxs("ul",{className:"space-y-1",children:[r.jsx("li",{children:"• Запись включает только ведущий или ответственный за сообщество."}),r.jsx("li",{children:"• Хранение — в закрытом архиве команды; доступ: ведущий, управляющий сообществом, ответственные аналитики."}),r.jsx("li",{children:"• Распространение вне команды запрещено."}),r.jsx("li",{children:"• Срок хранения определяет ведущий: до 3 лет, но ≥14 календарных дней."})]})]}),r.jsxs("div",{className:`rounded-2xl border p-4 sm:p-5 space-y-2 ${s==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white"}`,children:[r.jsx("p",{className:"text-base font-semibold text-[#4E6E49]",children:"6. Конфликт интересов"}),r.jsxs("ul",{className:"space-y-1",children:[r.jsx("li",{children:"• Запрещено действовать в интересах сторонних групп/конкурентов."}),r.jsx("li",{children:"• Запрещено передавать стратегию, аналитику, материалы, алгоритмы, сигналы и методики ApeVault третьим лицам."}),r.jsx("li",{children:"• Запрещено получать вознаграждение за внешние консультации, использующие опыт или данные ApeVault."}),r.jsx("li",{children:"• Запрещено участвовать в параллельных торговых группах, если это создаёт риск конфликта или утечки информации."})]})]}),r.jsxs("div",{className:`rounded-2xl border p-4 sm:p-5 space-y-2 ${s==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white"}`,children:[r.jsx("p",{className:"text-base font-semibold text-[#4E6E49]",children:"7. Конфиденциальность"}),r.jsxs("ul",{className:"space-y-1",children:[r.jsx("li",{children:"• Все материалы, данные, аналитика, торговые решения и внутренняя коммуникация — интеллектуальная собственность ApeVault."}),r.jsx("li",{children:"• Запрещено копировать, распространять или передавать информацию третьим лицам."}),r.jsx("li",{children:"• Запрещено создавать производные материалы без согласования с ответственным."}),r.jsx("li",{children:"• Запрещено публиковать скриншоты, отчёты или содержимое сессий в открытых источниках (кроме чата команды)."}),r.jsx("li",{children:"• Требование к среде: наушники и отсутствие посторонних рядом; не допускать, чтобы экран/звук были доступны третьим лицам."}),r.jsx("li",{className:"font-semibold text-[#4E6E49]",children:"Нарушение положений конфиденциальности — основание для немедленного исключения."})]})]})]})}),r.jsx(Gr,{title:"Классификация нарушений",description:"Три уровня тяжести определяют, как быстро применяются ограничения.",children:r.jsxs("div",{className:"grid gap-4 lg:grid-cols-3",children:[r.jsxs("div",{className:`rounded-2xl border p-4 sm:p-5 ${s==="dark"?"border-white/10 bg-white/5":"border-amber-100 bg-white/95"}`,children:[r.jsxs("div",{className:"flex items-center gap-2 text-sm font-semibold text-amber-600 dark:text-amber-300",children:[r.jsx(_r,{className:"w-4 h-4"}),"Незначительные"]}),r.jsx("ul",{className:`text-sm mt-2 space-y-1 ${t}`,children:a.map(d=>r.jsxs("li",{children:["• ",d]},d))})]}),r.jsxs("div",{className:`rounded-2xl border p-4 sm:p-5 ${s==="dark"?"border-white/10 bg-white/5":"border-orange-100 bg-white/95"}`,children:[r.jsxs("div",{className:"flex items-center gap-2 text-sm font-semibold text-orange-600 dark:text-orange-300",children:[r.jsx(Lt,{className:"w-4 h-4"}),"Средние"]}),r.jsx("ul",{className:`text-sm mt-2 space-y-1 ${t}`,children:i.map(d=>r.jsxs("li",{children:["• ",d]},d))})]}),r.jsxs("div",{className:`rounded-2xl border p-4 sm:p-5 ${s==="dark"?"border-white/10 bg-white/5":"border-rose-100 bg-white/95"}`,children:[r.jsxs("div",{className:"flex items-center gap-2 text-sm font-semibold text-rose-600 dark:text-rose-300",children:[r.jsx(Ti,{className:"w-4 h-4"}),"Грубые"]}),r.jsx("ul",{className:`text-sm mt-2 space-y-1 ${t}`,children:o.map(d=>r.jsxs("li",{children:["• ",d]},d))})]})]})}),r.jsx(Gr,{title:"Меры дисциплинарного воздействия и ограничения",description:"Применяются последовательно, кроме случаев грубых нарушений.",children:r.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[r.jsxs("div",{className:`rounded-2xl border p-4 sm:p-5 space-y-2 ${s==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white"}`,children:[r.jsxs("div",{className:"flex items-center gap-2 text-sm font-semibold text-[#4E6E49]",children:[r.jsx(Ud,{className:"w-4 h-4"}),"Порядок эскалации"]}),r.jsxs("ul",{className:`text-sm space-y-1 ${t}`,children:[r.jsx("li",{children:"• Напоминания — не более 1 в неделю, без последствий."}),r.jsx("li",{children:"• Предупреждения — не более 2 в неделю, при повторении незначительных или единичном среднем нарушении."}),r.jsx("li",{children:"• Выговоры — не более 2 в неделю, назначаются ведущим сессии или ответственным за сообщество."})]})]}),r.jsxs("div",{className:`rounded-2xl border p-4 sm:p-5 space-y-2 ${s==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white"}`,children:[r.jsxs("div",{className:"flex items-center gap-2 text-sm font-semibold text-[#4E6E49]",children:[r.jsx(Ti,{className:"w-4 h-4"}),"Ограничительные меры"]}),r.jsxs("ul",{className:`text-sm space-y-1 ${t}`,children:[r.jsx("li",{children:"• Ограничение доступа к торговым сессиям: 1-е — ≥3 дней; повторное — 1 неделя; систематическое — 2 недели; дальше — исключение без восстановления."}),r.jsx("li",{children:"• Немедленное исключение без эскалации за грубое нарушение, оскорбления, провокации или угрозу финансам/безопасности/репутации."})]})]})]})}),r.jsx(Gr,{title:"Финансовые последствия",description:"Что происходит при систематических нарушениях и невыполнении мер.",children:r.jsx("div",{className:`rounded-2xl border p-4 sm:p-5 space-y-2 ${s==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white"}`,children:r.jsxs("ul",{className:`text-sm space-y-2 ${t}`,children:[r.jsx("li",{children:"• При систематических нарушениях и игнорировании мер может быть отказано в удовлетворении заявки на вывод средств, включая заработок за успешные сессии."}),r.jsx("li",{children:"• Перераспределение заработка: удержанные средства делятся между участниками, кроме тех, кто допустил два и более нарушений в неделю или более 6 нарушений в месяц."}),r.jsx("li",{children:"• Добровольно внесённые в пул или кошелёк команды средства не возвращаются при досрочном выходе или исключении за нарушения."})]})})}),r.jsx(Gr,{title:"Фиксация нарушений и апелляции",description:"Прозрачный процесс учёта нарушений и возможность обжаловать решение.",children:r.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[r.jsxs("div",{className:`rounded-2xl border p-4 sm:p-5 space-y-2 ${s==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white"}`,children:[r.jsxs("div",{className:"flex items-center gap-2 text-sm font-semibold text-[#4E6E49]",children:[r.jsx(Yr,{className:"w-4 h-4"}),"Порядок фиксации"]}),r.jsxs("ul",{className:`text-sm space-y-1 ${t}`,children:[r.jsx("li",{children:"• Все нарушения фиксируются ответственным за сообщество в отдельной ветви командного чата Telegram."}),r.jsx("li",{children:"• Обязательная фиксация: дата и время, тип нарушения, краткое описание ситуации, применённая мера."})]})]}),r.jsxs("div",{className:`rounded-2xl border p-4 sm:p-5 space-y-2 ${s==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white"}`,children:[r.jsxs("div",{className:"flex items-center gap-2 text-sm font-semibold text-[#4E6E49]",children:[r.jsx(Sr,{className:"w-4 h-4"}),"Процедура апелляции"]}),r.jsxs("ul",{className:`text-sm space-y-1 ${t}`,children:[r.jsx("li",{children:"• Апелляция подаётся в течение 24 часов с момента уведомления о мере."}),r.jsx("li",{children:"• Подача: ответственному за сообщество или назначенному куратору."}),r.jsx("li",{children:"• Рассмотрение: до 60 часов; решение окончательное."})]})]})]})}),r.jsx(Gr,{title:"Принцип равного применения",description:"Меры действуют одинаково для всех участников.",children:r.jsx("div",{className:`rounded-2xl border p-4 sm:p-5 space-y-1 ${s==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white"}`,children:r.jsx("p",{className:`text-sm ${t}`,children:"Дисциплинарные меры применяются ко всем участникам независимо от стажа, роли в проекте, вклада, личных отношений или результатов торговых сессий. Привилегии и исключения не допускаются."})})}),r.jsx(Gr,{title:"Определения",description:"Ключевые термины, чтобы избежать двусмысленностей.",children:r.jsx("div",{className:"grid gap-4 md:grid-cols-2",children:c.map(d=>r.jsxs("div",{className:`rounded-2xl border p-4 sm:p-5 space-y-1 ${s==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white"}`,children:[r.jsx("p",{className:"text-sm font-semibold text-[#4E6E49]",children:d.term}),r.jsx("p",{className:`text-sm ${t}`,children:d.text})]},d.term))})}),r.jsx(Gr,{title:"Заключительные положения",description:"Кто может обновлять раздел и обязанность ознакомления.",children:r.jsx("div",{className:`rounded-2xl border p-4 sm:p-5 space-y-2 ${s==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white"}`,children:r.jsxs("ul",{className:`text-sm space-y-1 ${t}`,children:[r.jsx("li",{children:"• Ответственный за сообщество или исполняющий обязанности оставляет за собой право корректировать и обновлять раздел при изменении процессов или структуры платформы."}),r.jsx("li",{children:"• Все участники обязаны ознакомиться с настоящей политикой и соблюдать её безусловно."})]})})})]})})},g4={create:"Создание",update:"Изменение",delete:"Удаление"},p4={slot:"Слот",status:"Статус",earning:"Заработок",referral:"Реферал",login:"Ник"},x4={pending:"bg-amber-50 text-amber-900 border border-amber-200 shadow-inner dark:bg-amber-900/25 dark:text-amber-50 dark:border-amber-700",approved:"bg-emerald-50 text-emerald-900 border border-emerald-200 shadow-inner dark:bg-emerald-900/25 dark:text-emerald-50 dark:border-emerald-700",rejected:"bg-rose-50 text-rose-900 border border-rose-200 shadow-inner dark:bg-rose-900/25 dark:text-rose-50 dark:border-rose-700"},f4={pending:r.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-semibold bg-amber-100 text-amber-900 dark:bg-amber-900/40 dark:text-amber-100",children:[r.jsx(Sr,{className:"w-3 h-3"})," На согласовании"]}),approved:r.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-semibold bg-emerald-100 text-emerald-900 dark:bg-emerald-900/40 dark:text-emerald-100",children:[r.jsx($n,{className:"w-3 h-3"})," Принято"]}),rejected:r.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-semibold bg-rose-100 text-rose-900 dark:bg-rose-900/40 dark:text-rose-100",children:[r.jsx(Px,{className:"w-3 h-3"})," Отклонено"]})},Ta=s=>{if(!s)return"—";try{return le(s,"dd.MM.yyyy")}catch{return"—"}},Ah=s=>{var t,n;if(!s)return"—";const e=(n=(t=s.slots)==null?void 0:t.map(a=>`${a.start}-${a.end}${a.endDate?` (до ${Ta(a.endDate)})`:""}`))==null?void 0:n.join(", ");return`${Ta(s.date)}${e?` · ${e}`:""}`},Ch=s=>{if(!s)return"—";const e=s.type==="dayoff"?"Выходной":s.type==="sick"?"Больничный":"Отпуск",t=s.endDate?` (${Ta(s.endDate)})`:"";return`${Ta(s.date)} · ${e}${t}`},y4=()=>{const{user:s}=pt(),{isAdmin:e}=kt(),[t,n]=I.useState([]),[a,i]=I.useState(!0),[o,c]=I.useState(null),[d,h]=I.useState(!1),[m,x]=I.useState([]),[f,k]=I.useState(null),A=async()=>{i(!0),k(null);try{const C=await A0();let v=C;if(e){const p=new Date;p.setHours(p.getHours()-60),v=C.filter(w=>new Date(w.createdAt)>=p)}n(v)}catch(C){console.error("Не удалось загрузить заявки на согласование",C),k("Не удалось загрузить заявки")}finally{i(!1)}};I.useEffect(()=>{A()},[]);const D=async C=>{if(!o){c(C),k(null);try{const v=t.find(p=>p.id===C);await bh(C,(s==null?void 0:s.id)||"admin"),(v==null?void 0:v.entity)==="login"&&(Vl(v.targetUserId),await ss(v.targetUserId),window.dispatchEvent(new CustomEvent("nicknameUpdated",{detail:{userId:v.targetUserId}}))),await A(),x(p=>p.filter(w=>w!==C))}catch(v){console.error("Ошибка при подтверждении",v),k(`Не удалось подтвердить заявку: ${(v==null?void 0:v.message)||v}`),await A()}finally{c(null)}}},T=async C=>{if(o)return;const v=prompt("Комментарий для отклонения заявки","Уточните детали")||"Отклонено без комментария";c(C),k(null);try{await vh(C,(s==null?void 0:s.id)||"admin",v),await A()}catch(p){console.error("Ошибка при отклонении",p),k("Не удалось отклонить заявку")}finally{c(null)}},H=async()=>{if(!(d||o||m.length===0)){h(!0),k(null);try{for(const C of m){const v=t.find(p=>p.id===C);await bh(C,(s==null?void 0:s.id)||"admin"),(v==null?void 0:v.entity)==="login"&&(Vl(v.targetUserId),await ss(v.targetUserId),window.dispatchEvent(new CustomEvent("nicknameUpdated",{detail:{userId:v.targetUserId}})))}await A(),x([])}catch(C){console.error("Ошибка при подтверждении выбранных",C),k(`Не удалось подтвердить выбранные заявки: ${(C==null?void 0:C.message)||C}`),await A()}finally{h(!1)}}},L=async()=>{if(d||o||m.length===0)return;const C=prompt("Комментарий для отклонения выбранных заявок","Отклонено без комментария")||"Отклонено без комментария";if(C!==null){h(!0),k(null);try{for(const v of m)await vh(v,(s==null?void 0:s.id)||"admin",C);await A(),x([])}catch(v){console.error("Ошибка при отклонении выбранных",v),k(`Не удалось отклонить выбранные заявки: ${(v==null?void 0:v.message)||v}`),await A()}finally{h(!1)}}},E=C=>{x(v=>v.includes(C)?v.filter(p=>p!==C):[...v,C])},M=()=>{const C=t.filter(p=>p.status==="pending").map(p=>p.id),v=C.every(p=>m.includes(p));x(v?[]:C)},ee=C=>{if(C.entity==="login"){const v=C.before,p=C.after,w=(v==null?void 0:v.nickname)||"—",N=(p==null?void 0:p.nickname)||"—";return`${w} → ${N}`}if(C.entity==="slot"){const v=C.before,p=C.after;return`${Ah(v)} → ${Ah(p)}`}if(C.entity==="status"){const v=C.before,p=C.after;return`${Ch(v)} → ${Ch(p)}`}return C.after?"Изменение":C.before?"Удаление":"Создание"};return a?r.jsx("div",{className:"rounded-xl border border-gray-200 dark:border-gray-800 p-6 text-center text-sm text-gray-600 dark:text-gray-300",children:"Загружаем заявки..."}):r.jsxs("div",{className:"rounded-xl border border-gray-200 dark:border-gray-800 overflow-hidden shadow-sm",children:[r.jsxs("div",{className:"p-4 sm:p-5 border-b border-gray-200 dark:border-gray-800 flex items-center justify-between",children:[r.jsxs("div",{children:[r.jsx("p",{className:"text-lg font-semibold",children:"Согласования"}),r.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Заявки на изменение слотов и статусов"})]}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("button",{onClick:H,disabled:d||o!==null||m.length===0,className:"text-sm px-3 py-2 rounded-lg bg-emerald-600 hover:bg-emerald-700 disabled:bg-emerald-400 text-white font-semibold",children:d?"Подтверждаем...":`Принять выбранные (${m.length})`}),r.jsx("button",{onClick:L,disabled:d||o!==null||m.length===0,className:"text-sm px-3 py-2 rounded-lg bg-rose-600 hover:bg-rose-700 disabled:bg-rose-400 text-white font-semibold",children:d?"Отклоняем...":`Отклонить выбранные (${m.length})`}),r.jsx("button",{onClick:A,className:"text-sm px-3 py-2 rounded-lg bg-gray-100 hover:bg-gray-200 dark:bg-gray-800 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-200",children:"Обновить"})]})]}),f&&r.jsx("div",{className:"px-4 py-3 bg-rose-100 text-rose-900 dark:bg-rose-900/30 dark:text-rose-100 text-sm",children:f}),r.jsx("div",{className:"overflow-x-auto",children:r.jsxs("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-800 text-sm",children:[r.jsx("thead",{className:"bg-gray-50 dark:bg-gray-900/40",children:r.jsxs("tr",{children:[r.jsx("th",{className:"px-4 py-3 text-left font-semibold text-gray-700 dark:text-gray-200",children:"Статус"}),r.jsx("th",{className:"px-4 py-3 text-left font-semibold text-gray-700 dark:text-gray-200",children:"Тип"}),r.jsx("th",{className:"px-4 py-3 text-left font-semibold text-gray-700 dark:text-gray-200",children:"Действие"}),r.jsx("th",{className:"px-4 py-3 text-left font-semibold text-gray-700 dark:text-gray-200",children:"Кто"}),r.jsx("th",{className:"px-4 py-3 text-left font-semibold text-gray-700 dark:text-gray-200",children:"Изменение"}),r.jsx("th",{className:"px-4 py-3 text-left font-semibold text-gray-700 dark:text-gray-200",children:"Комментарий"}),r.jsx("th",{className:"px-4 py-3 text-left font-semibold text-gray-700 dark:text-gray-200",children:"Действия"}),r.jsx("th",{className:"px-4 py-3 text-left font-semibold text-gray-700 dark:text-gray-200",children:r.jsx("button",{onClick:M,className:"inline-flex items-center gap-1 text-sm text-[#4E6E49] hover:text-emerald-700",title:"Выбрать все на согласовании",children:t.some(C=>C.status==="pending")?r.jsxs(r.Fragment,{children:[t.filter(C=>C.status==="pending").every(C=>m.includes(C.id))?r.jsx(ts,{className:"w-4 h-4"}):r.jsx(zo,{className:"w-4 h-4"})," Все"]}):r.jsx(zo,{className:"w-4 h-4 opacity-50"})})})]})}),r.jsxs("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-800",children:[t.map(C=>r.jsxs("tr",{className:`bg-white dark:bg-[#0f1624] ${x4[C.status]}`,children:[r.jsx("td",{className:"px-4 py-3 align-top",children:f4[C.status]}),r.jsx("td",{className:"px-4 py-3 align-top font-semibold",children:p4[C.entity]}),r.jsx("td",{className:"px-4 py-3 align-top",children:g4[C.action]}),r.jsx("td",{className:"px-4 py-3 align-top",children:r.jsxs("div",{className:"flex flex-col gap-1",children:[r.jsx("span",{className:"font-semibold",children:r.jsx(as,{userId:C.targetUserId})}),r.jsxs("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:["Автор: ",r.jsx(as,{userId:C.authorId})]}),r.jsxs("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:["Создано: ",Ta(C.createdAt)," "]})]})}),r.jsxs("td",{className:"px-4 py-3 align-top",children:[r.jsx("div",{className:"text-xs sm:text-sm font-medium",children:ee(C)}),C.after&&C.entity==="slot"&&C.after.comment&&r.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:["Комментарий слота: ",C.after.comment]}),C.after&&C.entity==="status"&&C.after.comment&&r.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:["Комментарий статуса: ",C.after.comment]})]}),r.jsxs("td",{className:"px-4 py-3 align-top",children:[r.jsx("div",{className:"text-xs sm:text-sm text-gray-700 dark:text-gray-200 whitespace-pre-wrap",children:C.comment||"—"}),C.adminComment&&r.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:["Ответ админа: ",C.adminComment]})]}),r.jsx("td",{className:"px-4 py-3 align-top",children:C.status==="pending"?r.jsxs("div",{className:"flex flex-col gap-2",children:[r.jsx("button",{onClick:()=>D(C.id),disabled:!!o,className:"px-3 py-2 rounded-lg bg-emerald-600 hover:bg-emerald-700 disabled:bg-emerald-400 text-white text-xs sm:text-sm font-semibold",children:o===C.id?"Применяем...":"Подтвердить и применить"}),r.jsx("button",{onClick:()=>T(C.id),disabled:!!o,className:"px-3 py-2 rounded-lg bg-rose-600 hover:bg-rose-700 disabled:bg-rose-400 text-white text-xs sm:text-sm font-semibold",children:o===C.id?"Отклоняем...":"Отклонить"})]}):r.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Действие выполнено"})}),r.jsx("td",{className:"px-4 py-3 align-top",children:C.status==="pending"?r.jsxs("button",{onClick:()=>E(C.id),className:"inline-flex items-center gap-1 text-sm text-[#4E6E49] hover:text-emerald-700",children:[m.includes(C.id)?r.jsx(ts,{className:"w-4 h-4"}):r.jsx(zo,{className:"w-4 h-4"}),r.jsx("span",{className:"sr-only",children:"Выбрать заявку"})]}):r.jsx("span",{className:"text-xs text-gray-400",children:"—"})})]},C.id)),t.length===0&&r.jsx("tr",{children:r.jsx("td",{colSpan:7,className:"px-4 py-6 text-center text-sm text-gray-500 dark:text-gray-400",children:"Нет заявок на согласование"})})]})]})})]})},b4=()=>{const{isAdmin:s}=kt();return s?r.jsx(mr,{children:r.jsxs("div",{className:"max-w-6xl mx-auto px-4 sm:px-6 py-6 sm:py-8 space-y-6",children:[r.jsxs("div",{children:[r.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Администрирование"}),r.jsx("h1",{className:"text-2xl sm:text-3xl font-bold",children:"Согласования изменений"}),r.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Подтверждайте или отклоняйте изменения слотов, перерывов и статусов участников."})]}),r.jsx(y4,{})]})}):r.jsx(_i,{to:"/management",replace:!0})},v4=()=>{const{theme:s}=at(),e=s==="dark"?"text-gray-400":"text-gray-600",t=s==="dark"?"text-white":"text-gray-900",n=s==="dark"?"bg-[#10141c]":"bg-white",a="border-[#48a35e]/60",i=s==="dark"?"shadow-[0_24px_80px_rgba(0,0,0,0.45)]":"shadow-[0_24px_80px_rgba(0,0,0,0.15)]",o=s==="dark"?"bg-[#10141c]":"bg-white",c=s==="dark"?"border-[#48a35e]/60":"border-[#48a35e]/40",d=s==="dark"?"shadow-[0_24px_80px_rgba(0,0,0,0.45)]":"shadow-[0_24px_80px_rgba(0,0,0,0.1)]",h=s==="dark"?"bg-white/10 border-white/20":"bg-[#4E6E49]/10 border-[#4E6E49]/30",m=s==="dark"?"text-white":"text-[#4E6E49]",x=s==="dark"?"bg-white/10 border-white/20":"bg-gray-100 border-gray-300",f=s==="dark"?"text-white":"text-gray-800";return I.useEffect(()=>{const k=()=>{const C=document.querySelectorAll(".meme-checkbox"),v=document.getElementById("meme-progress-fill"),p=document.getElementById("meme-checked-count"),w=document.getElementById("meme-total-count"),N=document.getElementById("meme-progress-percentage");!C.length||!v||!p||!w||!N||(w.textContent=C.length.toString(),T(),C.forEach(j=>{j.addEventListener("change",A)}))},A=()=>{const C=document.querySelectorAll(".meme-checkbox"),v=document.querySelectorAll(".meme-checkbox:checked"),p=document.getElementById("meme-progress-fill"),w=document.getElementById("meme-checked-count"),N=document.getElementById("meme-progress-percentage");if(!p||!w||!N)return;const j=v.length,b=C.length,y=Math.round(j/b*100);w.textContent=j.toString(),N.textContent=y+"%",p.style.width=y+"%",C.forEach(re=>{const ue=re,W=re.closest(".meme-item");ue.checked?W==null||W.classList.add("completed"):W==null||W.classList.remove("completed")}),D()},D=()=>{const C=document.querySelectorAll(".meme-checkbox"),v={};C.forEach(p=>{const w=p;v[w.id]=w.checked}),localStorage.setItem("memeChecklistProgress",JSON.stringify(v))},T=()=>{const C=document.querySelectorAll(".meme-checkbox"),v=localStorage.getItem("memeChecklistProgress");if(v){const p=JSON.parse(v);C.forEach(w=>{var j;const N=w;p[N.id]&&(N.checked=!0,(j=N.closest(".meme-item"))==null||j.classList.add("completed"))}),H()}},H=()=>{const C=document.querySelectorAll(".meme-checkbox"),v=document.querySelectorAll(".meme-checkbox:checked"),p=document.getElementById("meme-progress-fill"),w=document.getElementById("meme-checked-count"),N=document.getElementById("meme-progress-percentage");if(!p||!w||!N)return;const j=v.length,b=C.length,y=Math.round(j/b*100);w.textContent=j.toString(),N.textContent=y+"%",p.style.width=y+"%"},L=()=>{document.querySelectorAll(".meme-checkbox").forEach(v=>{var w;const p=v;p.checked=!1,(w=p.closest(".meme-item"))==null||w.classList.remove("completed")}),localStorage.removeItem("memeChecklistProgress"),H()},E=document.getElementById("meme-reset-button");E&&E.addEventListener("click",L),document.querySelectorAll(".meme-stage-title").forEach(C=>{C.addEventListener("click",v=>{const p=v.currentTarget.closest(".meme-stage");p==null||p.scrollIntoView({behavior:"smooth",block:"start"})})});const M={threshold:.1,rootMargin:"0px 0px -50px 0px"},ee=new IntersectionObserver(C=>{C.forEach(v=>{v.isIntersecting&&v.target.setAttribute("style","opacity: 1; transform: translateY(0);")})},M);document.querySelectorAll(".meme-stage").forEach(C=>{C.setAttribute("style","opacity: 0; transform: translateY(30px); transition: opacity 0.6s ease, transform 0.6s ease;"),ee.observe(C)}),k()},[]),r.jsxs(mr,{children:[r.jsxs("div",{className:"space-y-6",children:[r.jsxs("div",{className:`relative overflow-hidden rounded-3xl border ${c} ${d} ${o}`,children:[r.jsxs("div",{className:"absolute inset-0 pointer-events-none",children:[r.jsx("div",{className:"absolute -left-16 -bottom-10 w-80 h-80 bg-emerald-500/18 blur-3xl"}),r.jsx("div",{className:`absolute inset-0 ${s==="dark"?"bg-[radial-gradient(circle_at_50%_0%,rgba(255,255,255,0.08),transparent_45%)]":"bg-[radial-gradient(circle_at_50%_0%,rgba(78,110,73,0.05),transparent_45%)]"}`})]}),r.jsx("div",{className:"relative p-6 sm:p-8 space-y-6",children:r.jsx("div",{className:"flex flex-col gap-4 lg:flex-row lg:items-start lg:justify-between",children:r.jsx("div",{className:"space-y-3 max-w-3xl",children:r.jsxs("div",{className:"flex items-start gap-3",children:[r.jsx("div",{className:`p-3 rounded-2xl ${h} ${m} shadow-inner`,children:r.jsx("span",{className:"text-2xl",children:"🐊"})}),r.jsxs("div",{className:"space-y-2",children:[r.jsx("h1",{className:`text-3xl sm:text-4xl font-black ${s==="dark"?"text-white":"text-gray-900"} leading-tight`,children:"Оценка мемкоина"}),r.jsx("p",{className:`text-sm ${s==="dark"?"text-white/70":"text-gray-600"}`,children:"Полный чек-лист проверки мемкоина. Систематический анализ для безопасного входа."}),r.jsx("div",{className:"flex flex-wrap gap-2",children:["Базовые метрики","Бандлы","Сообщество","DEV анализ"].map((k,A)=>r.jsx("span",{className:`px-4 py-1.5 rounded-full text-xs font-semibold border ${A===0?"bg-emerald-500 text-white border-emerald-300/60 shadow-md":`${x} ${f} border-gray-300`}`,children:k},k))})]})]})})})})]}),r.jsxs("div",{className:"space-y-6",children:[r.jsxs("div",{className:`meme-stage rounded-2xl p-6 sm:p-7 ${n} ${i} border ${a}`,children:[r.jsxs("div",{className:"flex flex-col gap-2 mb-6",children:[r.jsx("p",{className:`text-xs uppercase tracking-[0.12em] ${e}`,children:"Этап 1"}),r.jsx("h3",{className:`text-2xl font-bold ${t}`,children:"Базовые метрики (первичный фильтр)"}),r.jsx("p",{className:`text-sm ${e}`,children:"Убираем мусор, скам и неподходящие ранние фазы проекта."})]}),r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{className:`meme-item flex items-start gap-4 p-4 rounded-xl border ${s==="dark"?"border-white/10 bg-white/5 hover:bg-white/10":"border-gray-200 bg-gray-50 hover:bg-gray-100"} transition-all duration-200`,children:[r.jsx("input",{type:"checkbox",id:"meme-1-1",className:"meme-checkbox w-5 h-5 mt-1 accent-[#4E6E49] rounded flex-shrink-0"}),r.jsxs("label",{htmlFor:"meme-1-1",className:"flex-1 cursor-pointer",children:[r.jsx("strong",{className:`font-semibold block mb-2 ${t}`,children:"Market Cap"}),r.jsxs("ul",{className:`space-y-1 text-sm ${e}`,children:[r.jsx("li",{children:"• Капа ≤ 100k (оптимально 20–80k)."}),r.jsx("li",{children:"• Резкий скачок капы на старте без реальной ликвидности — минус."})]})]})]}),r.jsxs("div",{className:"meme-item flex items-start gap-4 p-4 rounded-xl ${theme === 'dark' ? 'border-white/10 bg-white/5 hover:bg-white/10' : 'border-gray-200 bg-gray-50 hover:bg-gray-100'} transition-all duration-200",children:[r.jsx("input",{type:"checkbox",id:"meme-1-2",className:"meme-checkbox w-5 h-5 mt-1 accent-[#4E6E49] rounded flex-shrink-0"}),r.jsxs("label",{htmlFor:"meme-1-2",className:"flex-1 cursor-pointer",children:[r.jsx("strong",{className:`font-semibold block mb-2 ${t}`,children:"Объём торгов"}),r.jsxs("ul",{className:`space-y-1 text-sm ${e}`,children:[r.jsx("li",{children:"• Объём > капы в 1.5–2 раза (лучше 2.5–3)."}),r.jsx("li",{children:"• Проверить синхронность: объём должен совпадать с движением цены."})]})]})]}),r.jsxs("div",{className:"meme-item flex items-start gap-4 p-4 rounded-xl ${theme === 'dark' ? 'border-white/10 bg-white/5 hover:bg-white/10' : 'border-gray-200 bg-gray-50 hover:bg-gray-100'} transition-all duration-200",children:[r.jsx("input",{type:"checkbox",id:"meme-1-3",className:"meme-checkbox w-5 h-5 mt-1 accent-[#4E6E49] rounded flex-shrink-0"}),r.jsxs("label",{htmlFor:"meme-1-3",className:"flex-1 cursor-pointer",children:[r.jsx("strong",{className:`font-semibold block mb-2 ${t}`,children:"Холдеры"}),r.jsxs("ul",{className:`space-y-1 text-sm ${e}`,children:[r.jsx("li",{children:"• Рост холдеров стабильный, без искусственных всплесков."}),r.jsx("li",{children:"• Проверить уникальность кошельков."})]})]})]}),r.jsxs("div",{className:"meme-item flex items-start gap-4 p-4 rounded-xl ${theme === 'dark' ? 'border-white/10 bg-white/5 hover:bg-white/10' : 'border-gray-200 bg-gray-50 hover:bg-gray-100'} transition-all duration-200",children:[r.jsx("input",{type:"checkbox",id:"meme-1-4",className:"meme-checkbox w-5 h-5 mt-1 accent-[#4E6E49] rounded flex-shrink-0"}),r.jsxs("label",{htmlFor:"meme-1-4",className:"flex-1 cursor-pointer",children:[r.jsx("strong",{className:`font-semibold block mb-2 ${t}`,children:"График"}),r.jsxs("ul",{className:"text-gray-700 dark:text-gray-300 space-y-1 text-sm",children:[r.jsx("li",{children:"• Органичный график, без параболического роста."}),r.jsx("li",{children:"• Нет вертикальных ракет на старте."})]})]})]}),r.jsxs("div",{className:"meme-item flex items-start gap-4 p-4 rounded-xl ${theme === 'dark' ? 'border-white/10 bg-white/5 hover:bg-white/10' : 'border-gray-200 bg-gray-50 hover:bg-gray-100'} transition-all duration-200",children:[r.jsx("input",{type:"checkbox",id:"meme-1-5",className:"meme-checkbox w-5 h-5 mt-1 accent-[#4E6E49] rounded flex-shrink-0"}),r.jsxs("label",{htmlFor:"meme-1-5",className:"flex-1 cursor-pointer",children:[r.jsx("strong",{className:`font-semibold block mb-2 ${t}`,children:"Ликвидность"}),r.jsxs("ul",{className:`space-y-1 text-sm ${e}`,children:[r.jsx("li",{children:"• Ликвидность > 15k (лучше 25–40k)."}),r.jsx("li",{children:"• Проверить соотношение ликвидности к капе."})]})]})]})]})]}),r.jsxs("div",{className:`meme-stage rounded-2xl p-6 sm:p-7 ${n} ${i} border ${a}`,children:[r.jsxs("div",{className:"flex flex-col gap-2 mb-6",children:[r.jsx("p",{className:`text-xs uppercase tracking-[0.12em] ${e}`,children:"Этап 2"}),r.jsx("h3",{className:`text-2xl font-bold ${t}`,children:"Бандлы (MEV-активность)"}),r.jsx("p",{className:`text-sm ${e}`,children:"Анализ влияния бандлеров на токен и рыночную манипуляцию."})]}),r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{className:"meme-item flex items-start gap-4 p-4 rounded-xl ${theme === 'dark' ? 'border-white/10 bg-white/5 hover:bg-white/10' : 'border-gray-200 bg-gray-50 hover:bg-gray-100'} transition-all duration-200",children:[r.jsx("input",{type:"checkbox",id:"meme-2-1",className:"meme-checkbox w-5 h-5 mt-1 accent-[#4E6E49] rounded flex-shrink-0"}),r.jsxs("label",{htmlFor:"meme-2-1",className:"flex-1 cursor-pointer",children:[r.jsx("strong",{className:`font-semibold block mb-2 ${t}`,children:"Откуплено бандлами"}),r.jsx("ul",{className:`space-y-1 text-sm ${e}`,children:r.jsx("li",{children:"• ≤ 100, максимум 200 SOL за весь период."})})]})]}),r.jsxs("div",{className:"meme-item flex items-start gap-4 p-4 rounded-xl ${theme === 'dark' ? 'border-white/10 bg-white/5 hover:bg-white/10' : 'border-gray-200 bg-gray-50 hover:bg-gray-100'} transition-all duration-200",children:[r.jsx("input",{type:"checkbox",id:"meme-2-2",className:"meme-checkbox w-5 h-5 mt-1 accent-[#4E6E49] rounded flex-shrink-0"}),r.jsxs("label",{htmlFor:"meme-2-2",className:"flex-1 cursor-pointer",children:[r.jsx("strong",{className:`font-semibold block mb-2 ${t}`,children:"Остаток бандлов"}),r.jsx("ul",{className:`space-y-1 text-sm ${e}`,children:r.jsx("li",{children:"• ≤ 30 SOL."})})]})]})]})]}),r.jsxs("div",{className:`meme-stage rounded-2xl p-6 sm:p-7 ${n} ${i} border ${a}`,children:[r.jsxs("div",{className:"flex flex-col gap-2 mb-6",children:[r.jsx("p",{className:`text-xs uppercase tracking-[0.12em] ${e}`,children:"Этап 3"}),r.jsx("h3",{className:`text-2xl font-bold ${t}`,children:"Сообщество и социальные сети"}),r.jsx("p",{className:`text-sm ${e}`,children:"Проверка органичности сообщества и качества информационного поля."})]}),r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{className:"meme-item flex items-start gap-4 p-4 rounded-xl ${theme === 'dark' ? 'border-white/10 bg-white/5 hover:bg-white/10' : 'border-gray-200 bg-gray-50 hover:bg-gray-100'} transition-all duration-200",children:[r.jsx("input",{type:"checkbox",id:"meme-3-1",className:"meme-checkbox w-5 h-5 mt-1 accent-[#4E6E49] rounded flex-shrink-0"}),r.jsxs("label",{htmlFor:"meme-3-1",className:"flex-1 cursor-pointer",children:[r.jsx("strong",{className:`font-semibold block mb-2 ${t}`,children:"Twitter"}),r.jsxs("ul",{className:`space-y-1 text-sm ${e}`,children:[r.jsx("li",{children:"• Посты каждые 1–3 минуты в первые часы."}),r.jsx("li",{children:"• Рост подписчиков органичный."})]})]})]}),r.jsxs("div",{className:"meme-item flex items-start gap-4 p-4 rounded-xl ${theme === 'dark' ? 'border-white/10 bg-white/5 hover:bg-white/10' : 'border-gray-200 bg-gray-50 hover:bg-gray-100'} transition-all duration-200",children:[r.jsx("input",{type:"checkbox",id:"meme-3-2",className:"meme-checkbox w-5 h-5 mt-1 accent-[#4E6E49] rounded flex-shrink-0"}),r.jsxs("label",{htmlFor:"meme-3-2",className:"flex-1 cursor-pointer",children:[r.jsx("strong",{className:`font-semibold block mb-2 ${t}`,children:"Сайт"}),r.jsx("ul",{className:`space-y-1 text-sm ${e}`,children:r.jsx("li",{children:"• Дизайн прикольный, ссылки рабочие."})})]})]})]})]}),r.jsxs("div",{className:`meme-stage rounded-2xl p-6 sm:p-7 ${n} ${i} border ${a}`,children:[r.jsxs("div",{className:"flex flex-col gap-2 mb-6",children:[r.jsx("p",{className:`text-xs uppercase tracking-[0.12em] ${e}`,children:"Этап 4"}),r.jsx("h3",{className:`text-2xl font-bold ${t}`,children:"DEV и контракт"}),r.jsx("p",{className:`text-sm ${e}`,children:"Исключение манипуляций, контроль и потенциальный скам."})]}),r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{className:"meme-item flex items-start gap-4 p-4 rounded-xl ${theme === 'dark' ? 'border-white/10 bg-white/5 hover:bg-white/10' : 'border-gray-200 bg-gray-50 hover:bg-gray-100'} transition-all duration-200",children:[r.jsx("input",{type:"checkbox",id:"meme-4-1",className:"meme-checkbox w-5 h-5 mt-1 accent-[#4E6E49] rounded flex-shrink-0"}),r.jsxs("label",{htmlFor:"meme-4-1",className:"flex-1 cursor-pointer",children:[r.jsx("strong",{className:`font-semibold block mb-2 ${t}`,children:"Активность DEV"}),r.jsxs("ul",{className:`space-y-1 text-sm ${e}`,children:[r.jsx("li",{children:"• Продал ли DEV: если да, то как много и в какой фазе."}),r.jsx("li",{children:"• Что делает DEV сейчас: покупки, сливы, пополнение ликвы?"})]})]})]}),r.jsxs("div",{className:"meme-item flex items-start gap-4 p-4 rounded-xl ${theme === 'dark' ? 'border-white/10 bg-white/5 hover:bg-white/10' : 'border-gray-200 bg-gray-50 hover:bg-gray-100'} transition-all duration-200",children:[r.jsx("input",{type:"checkbox",id:"meme-4-2",className:"meme-checkbox w-5 h-5 mt-1 accent-[#4E6E49] rounded flex-shrink-0"}),r.jsxs("label",{htmlFor:"meme-4-2",className:"flex-1 cursor-pointer",children:[r.jsx("strong",{className:`font-semibold block mb-2 ${t}`,children:"История монет DEV"}),r.jsxs("ul",{className:`space-y-1 text-sm ${e}`,children:[r.jsx("li",{children:"• Создавал ли ранее токены."}),r.jsx("li",{children:"• Как они себя вели (пампы/дампы, длительность жизни)."})]})]})]}),r.jsxs("div",{className:"meme-item flex items-start gap-4 p-4 rounded-xl ${theme === 'dark' ? 'border-white/10 bg-white/5 hover:bg-white/10' : 'border-gray-200 bg-gray-50 hover:bg-gray-100'} transition-all duration-200",children:[r.jsx("input",{type:"checkbox",id:"meme-4-3",className:"meme-checkbox w-5 h-5 mt-1 accent-[#4E6E49] rounded flex-shrink-0"}),r.jsxs("label",{htmlFor:"meme-4-3",className:"flex-1 cursor-pointer",children:[r.jsx("strong",{className:`font-semibold block mb-2 ${t}`,children:"Токены DEV"}),r.jsx("ul",{className:`space-y-1 text-sm ${e}`,children:r.jsx("li",{children:"• Если перевёл более 15% — высокий риск."})})]})]}),r.jsxs("div",{className:"meme-item flex items-start gap-4 p-4 rounded-xl ${theme === 'dark' ? 'border-white/10 bg-white/5 hover:bg-white/10' : 'border-gray-200 bg-gray-50 hover:bg-gray-100'} transition-all duration-200",children:[r.jsx("input",{type:"checkbox",id:"meme-4-4",className:"meme-checkbox w-5 h-5 mt-1 accent-[#4E6E49] rounded flex-shrink-0"}),r.jsxs("label",{htmlFor:"meme-4-4",className:"flex-1 cursor-pointer",children:[r.jsx("strong",{className:`font-semibold block mb-2 ${t}`,children:"Безопасность контракта"}),r.jsxs("ul",{className:`space-y-1 text-sm ${e}`,children:[r.jsx("li",{children:"• Mint отключён."}),r.jsx("li",{children:"• Freeze отключён."}),r.jsx("li",{children:"• Trading limits отключены."}),r.jsx("li",{children:"• Владелец LP — сожжён или передан в отказ (renounce)."})]})]})]}),r.jsxs("div",{className:"meme-item flex items-start gap-4 p-4 rounded-xl ${theme === 'dark' ? 'border-white/10 bg-white/5 hover:bg-white/10' : 'border-gray-200 bg-gray-50 hover:bg-gray-100'} transition-all duration-200",children:[r.jsx("input",{type:"checkbox",id:"meme-4-5",className:"meme-checkbox w-5 h-5 mt-1 accent-[#4E6E49] rounded flex-shrink-0"}),r.jsxs("label",{htmlFor:"meme-4-5",className:"flex-1 cursor-pointer",children:[r.jsx("strong",{className:`font-semibold block mb-2 ${t}`,children:"Curve-Manipulation Check"}),r.jsxs("ul",{className:`space-y-1 text-sm ${e}`,children:[r.jsx("li",{children:"• Нет скрытых функций, влияющих на цену."}),r.jsx("li",{children:"• Проверить контракт на сторонних аудит-ботах."})]})]})]})]})]}),r.jsxs("div",{className:`meme-stage rounded-2xl p-6 sm:p-7 ${n} ${i} border ${a}`,children:[r.jsxs("div",{className:"flex flex-col gap-2 mb-6",children:[r.jsx("p",{className:`text-xs uppercase tracking-[0.12em] ${e}`,children:"Этап 5"}),r.jsx("h3",{className:`text-2xl font-bold ${t}`,children:"Распределение холдеров"}),r.jsx("p",{className:`text-sm ${e}`,children:"Убедиться, что флоат распределён и нет доминирующих кластеров."})]}),r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{className:"meme-item flex items-start gap-4 p-4 rounded-xl ${theme === 'dark' ? 'border-white/10 bg-white/5 hover:bg-white/10' : 'border-gray-200 bg-gray-50 hover:bg-gray-100'} transition-all duration-200",children:[r.jsx("input",{type:"checkbox",id:"meme-5-1",className:"meme-checkbox w-5 h-5 mt-1 accent-[#4E6E49] rounded flex-shrink-0"}),r.jsxs("label",{htmlFor:"meme-5-1",className:"flex-1 cursor-pointer",children:[r.jsx("strong",{className:`font-semibold block mb-2 ${t}`,children:"Топ-кошельки"}),r.jsxs("ul",{className:`space-y-1 text-sm ${e}`,children:[r.jsx("li",{children:"• Топ-держатели ≤ 5–7%."}),r.jsx("li",{children:"• Оптимально: ранний лидер имеет не более 3–4%."})]})]})]}),r.jsxs("div",{className:"meme-item flex items-start gap-4 p-4 rounded-xl ${theme === 'dark' ? 'border-white/10 bg-white/5 hover:bg-white/10' : 'border-gray-200 bg-gray-50 hover:bg-gray-100'} transition-all duration-200",children:[r.jsx("input",{type:"checkbox",id:"meme-5-2",className:"meme-checkbox w-5 h-5 mt-1 accent-[#4E6E49] rounded flex-shrink-0"}),r.jsxs("label",{htmlFor:"meme-5-2",className:"flex-1 cursor-pointer",children:[r.jsx("strong",{className:`font-semibold block mb-2 ${t}`,children:"Кластеры"}),r.jsxs("ul",{className:`space-y-1 text-sm ${e}`,children:[r.jsx("li",{children:"• Нет крупных связанных кошельков."}),r.jsx("li",{children:'• Нет "пачек" кошельков, созданных в одну минуту.'})]})]})]}),r.jsxs("div",{className:"meme-item flex items-start gap-4 p-4 rounded-xl ${theme === 'dark' ? 'border-white/10 bg-white/5 hover:bg-white/10' : 'border-gray-200 bg-gray-50 hover:bg-gray-100'} transition-all duration-200",children:[r.jsx("input",{type:"checkbox",id:"meme-5-3",className:"meme-checkbox w-5 h-5 mt-1 accent-[#4E6E49] rounded flex-shrink-0"}),r.jsxs("label",{htmlFor:"meme-5-3",className:"flex-1 cursor-pointer",children:[r.jsx("strong",{className:`font-semibold block mb-2 ${t}`,children:"Фермы"}),r.jsxs("ul",{className:`space-y-1 text-sm ${e}`,children:[r.jsx("li",{children:"• Фермы не перегружены."}),r.jsx("li",{children:"• Нет пачки фармеров с одинаковой стратегией."})]})]})]}),r.jsxs("div",{className:"meme-item flex items-start gap-4 p-4 rounded-xl ${theme === 'dark' ? 'border-white/10 bg-white/5 hover:bg-white/10' : 'border-gray-200 bg-gray-50 hover:bg-gray-100'} transition-all duration-200",children:[r.jsx("input",{type:"checkbox",id:"meme-5-4",className:"meme-checkbox w-5 h-5 mt-1 accent-[#4E6E49] rounded flex-shrink-0"}),r.jsxs("label",{htmlFor:"meme-5-4",className:"flex-1 cursor-pointer",children:[r.jsx("strong",{className:`font-semibold block mb-2 ${t}`,children:"PNL/RPL-анализ"}),r.jsx("ul",{className:`space-y-1 text-sm ${e}`,children:r.jsx("li",{children:"• Холдеры не сидят в прибыли 4–5х (сливы неизбежны)."})})]})]}),r.jsxs("div",{className:"meme-item flex items-start gap-4 p-4 rounded-xl ${theme === 'dark' ? 'border-white/10 bg-white/5 hover:bg-white/10' : 'border-gray-200 bg-gray-50 hover:bg-gray-100'} transition-all duration-200",children:[r.jsx("input",{type:"checkbox",id:"meme-5-5",className:"meme-checkbox w-5 h-5 mt-1 accent-[#4E6E49] rounded flex-shrink-0"}),r.jsxs("label",{htmlFor:"meme-5-5",className:"flex-1 cursor-pointer",children:[r.jsx("strong",{className:`font-semibold block mb-2 ${t}`,children:"Активность торговли"}),r.jsxs("ul",{className:`space-y-1 text-sm ${e}`,children:[r.jsx("li",{children:"• Нет торговли только команды."}),r.jsx("li",{children:"• Есть новые кошельки."}),r.jsx("li",{children:"• Нет явного копитрейдинга."})]})]})]}),r.jsxs("div",{className:"meme-item flex items-start gap-4 p-4 rounded-xl ${theme === 'dark' ? 'border-white/10 bg-white/5 hover:bg-white/10' : 'border-gray-200 bg-gray-50 hover:bg-gray-100'} transition-all duration-200",children:[r.jsx("input",{type:"checkbox",id:"meme-5-6",className:"meme-checkbox w-5 h-5 mt-1 accent-[#4E6E49] rounded flex-shrink-0"}),r.jsxs("label",{htmlFor:"meme-5-6",className:"flex-1 cursor-pointer",children:[r.jsx("strong",{className:`font-semibold block mb-2 ${t}`,children:"Время удержания токена"}),r.jsx("ul",{className:`space-y-1 text-sm ${e}`,children:r.jsx("li",{children:"• Если все держат ≤3 минут — чистый скальпинг, можно словить дамп."})})]})]})]})]}),r.jsxs("div",{className:`meme-stage rounded-2xl p-6 sm:p-7 ${n} ${i} border ${a}`,children:[r.jsxs("div",{className:"flex flex-col gap-2 mb-6",children:[r.jsx("p",{className:`text-xs uppercase tracking-[0.12em] ${e}`,children:"Этап 6"}),r.jsx("h3",{className:`text-2xl font-bold ${t}`,children:"Технический вход"}),r.jsx("p",{className:`text-sm ${e}`,children:"Войти по адекватной цене после фильтрации ончейн-данных."})]}),r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{className:"meme-item flex items-start gap-4 p-4 rounded-xl ${theme === 'dark' ? 'border-white/10 bg-white/5 hover:bg-white/10' : 'border-gray-200 bg-gray-50 hover:bg-gray-100'} transition-all duration-200",children:[r.jsx("input",{type:"checkbox",id:"meme-6-1",className:"meme-checkbox w-5 h-5 mt-1 accent-[#4E6E49] rounded flex-shrink-0"}),r.jsxs("label",{htmlFor:"meme-6-1",className:"flex-1 cursor-pointer",children:[r.jsx("strong",{className:`font-semibold block mb-2 ${t}`,children:"Фибо"}),r.jsx("ul",{className:`space-y-1 text-sm ${e}`,children:r.jsx("li",{children:"• Строим сетку по ключевому импульсу."})})]})]}),r.jsxs("div",{className:"meme-item flex items-start gap-4 p-4 rounded-xl ${theme === 'dark' ? 'border-white/10 bg-white/5 hover:bg-white/10' : 'border-gray-200 bg-gray-50 hover:bg-gray-100'} transition-all duration-200",children:[r.jsx("input",{type:"checkbox",id:"meme-6-2",className:"meme-checkbox w-5 h-5 mt-1 accent-[#4E6E49] rounded flex-shrink-0"}),r.jsxs("label",{htmlFor:"meme-6-2",className:"flex-1 cursor-pointer",children:[r.jsx("strong",{className:`font-semibold block mb-2 ${t}`,children:"Уровни"}),r.jsx("ul",{className:`space-y-1 text-sm ${e}`,children:r.jsx("li",{children:"• Совпадение 0.5/0.618/0.702 с зонами проторговки."})})]})]}),r.jsxs("div",{className:"meme-item flex items-start gap-4 p-4 rounded-xl ${theme === 'dark' ? 'border-white/10 bg-white/5 hover:bg-white/10' : 'border-gray-200 bg-gray-50 hover:bg-gray-100'} transition-all duration-200",children:[r.jsx("input",{type:"checkbox",id:"meme-6-3",className:"meme-checkbox w-5 h-5 mt-1 accent-[#4E6E49] rounded flex-shrink-0"}),r.jsxs("label",{htmlFor:"meme-6-3",className:"flex-1 cursor-pointer",children:[r.jsx("strong",{className:`font-semibold block mb-2 ${t}`,children:"Вход"}),r.jsx("ul",{className:`space-y-1 text-sm ${e}`,children:r.jsx("li",{children:"• 50–70% откат от локального хая."})})]})]}),r.jsxs("div",{className:"meme-item flex items-start gap-4 p-4 rounded-xl ${theme === 'dark' ? 'border-white/10 bg-white/5 hover:bg-white/10' : 'border-gray-200 bg-gray-50 hover:bg-gray-100'} transition-all duration-200",children:[r.jsx("input",{type:"checkbox",id:"meme-6-4",className:"meme-checkbox w-5 h-5 mt-1 accent-[#4E6E49] rounded flex-shrink-0"}),r.jsxs("label",{htmlFor:"meme-6-4",className:"flex-1 cursor-pointer",children:[r.jsx("strong",{className:`font-semibold block mb-2 ${t}`,children:"Дополнительно"}),r.jsxs("ul",{className:`space-y-1 text-sm ${e}`,children:[r.jsx("li",{children:"• Проверить, есть ли ликвидность на уровнях покупок."}),r.jsx("li",{children:"• Проверить объёмы на откате: ослабление продавцов."}),r.jsx("li",{children:"• Проверить, не обновляет ли токен лоу (в таком случае вход отменяется)."})]})]})]})]})]}),r.jsxs("div",{className:`meme-stage rounded-2xl p-6 sm:p-7 ${n} ${i} border ${a}`,children:[r.jsxs("div",{className:"flex flex-col gap-2 mb-6",children:[r.jsx("p",{className:`text-xs uppercase tracking-[0.12em] ${e}`,children:"Этап 7"}),r.jsx("h3",{className:`text-2xl font-bold ${t}`,children:"Анализ риска"}),r.jsx("p",{className:`text-sm ${e}`,children:"Формализовать риск-менеджмент."})]}),r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{className:"meme-item flex items-start gap-4 p-4 rounded-xl ${theme === 'dark' ? 'border-white/10 bg-white/5 hover:bg-white/10' : 'border-gray-200 bg-gray-50 hover:bg-gray-100'} transition-all duration-200",children:[r.jsx("input",{type:"checkbox",id:"meme-7-1",className:"meme-checkbox w-5 h-5 mt-1 accent-[#4E6E49] rounded flex-shrink-0"}),r.jsxs("label",{htmlFor:"meme-7-1",className:"flex-1 cursor-pointer",children:[r.jsx("strong",{className:`font-semibold block mb-2 ${t}`,children:"Стоп-логика"}),r.jsxs("ul",{className:`space-y-1 text-sm ${e}`,children:[r.jsx("li",{children:"• Стоп по структуре (обновление локального лоу)."}),r.jsx("li",{children:"• Стоп по ончейн-сигналу (DEV слил, появились новые бандлы, появились киты)."})]})]})]}),r.jsxs("div",{className:"meme-item flex items-start gap-4 p-4 rounded-xl ${theme === 'dark' ? 'border-white/10 bg-white/5 hover:bg-white/10' : 'border-gray-200 bg-gray-50 hover:bg-gray-100'} transition-all duration-200",children:[r.jsx("input",{type:"checkbox",id:"meme-7-2",className:"meme-checkbox w-5 h-5 mt-1 accent-[#4E6E49] rounded flex-shrink-0"}),r.jsxs("label",{htmlFor:"meme-7-2",className:"flex-1 cursor-pointer",children:[r.jsx("strong",{className:`font-semibold block mb-2 ${t}`,children:"Целевые зоны"}),r.jsx("ul",{className:`space-y-1 text-sm ${e}`,children:r.jsx("li",{children:"• Минимум 2 стратегии выхода: частичный выход на 1.5–2х, остальное — трейл."})})]})]})]})]}),r.jsxs("div",{className:`meme-stage rounded-2xl p-6 sm:p-7 ${n} ${i} border ${a}`,children:[r.jsxs("div",{className:"flex flex-col gap-2 mb-6",children:[r.jsx("p",{className:`text-xs uppercase tracking-[0.12em] ${e}`,children:"Напоминание"}),r.jsx("h3",{className:`text-2xl font-bold ${t}`,children:"Ключевые правила входа в сделки"}),r.jsx("p",{className:`text-sm ${e}`,children:"Трейдинг-дисциплина превыше всего."})]}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[r.jsxs("div",{className:`meme-item flex items-start gap-3 p-4 rounded-xl ${s==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-gray-50"}`,children:[r.jsx(sr,{className:"w-6 h-6 text-[#4E6E49]"}),r.jsxs("div",{children:[r.jsx("strong",{className:`font-semibold block mb-1 ${t}`,children:"Уровни Фибоначчи"}),r.jsx("p",{className:`text-sm ${e}`,children:"Заходим только когда уровни поддержки совпадают с зоной проторговки и на прошлом уровне были высокие объёмы."})]})]}),r.jsxs("div",{className:`meme-item flex items-start gap-3 p-4 rounded-xl ${s==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-gray-50"}`,children:[r.jsx(Qt,{className:"w-6 h-6 text-[#4E6E49]"}),r.jsxs("div",{children:[r.jsx("strong",{className:`font-semibold block mb-1 ${t}`,children:"Зона входа"}),r.jsx("p",{className:`text-sm ${e}`,children:"Преимущественно заходим в канале 0.7, в идеале — строго от линии 0.7."})]})]}),r.jsxs("div",{className:`meme-item flex items-start gap-3 p-4 rounded-xl ${s==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-gray-50"}`,children:[r.jsx(Da,{className:"w-6 h-6 text-[#4E6E49]"}),r.jsxs("div",{children:[r.jsx("strong",{className:`font-semibold block mb-1 ${t}`,children:"Stop Loss"}),r.jsx("p",{className:`text-sm ${e}`,children:"Устанавливаем от линии 0.7 до 50% от позиции в зависимости от волатильности."})]})]}),r.jsxs("div",{className:`meme-item flex items-start gap-3 p-4 rounded-xl ${s==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-gray-50"}`,children:[r.jsx(Lt,{className:"w-6 h-6 text-[#4E6E49]"}),r.jsxs("div",{children:[r.jsx("strong",{className:`font-semibold block mb-1 ${t}`,children:"Альтернативный вход"}),r.jsx("p",{className:`text-sm ${e}`,children:"Допустимо заходить по уровню 0.6, но только при наличии активного роста холдеров."})]})]}),r.jsxs("div",{className:`meme-item flex items-start gap-3 p-4 rounded-xl ${s==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-gray-50"}`,children:[r.jsx(Rn,{className:"w-6 h-6 text-[#4E6E49]"}),r.jsxs("div",{children:[r.jsx("strong",{className:`font-semibold block mb-1 ${t}`,children:"Сигнал роста"}),r.jsx("p",{className:`text-sm ${e}`,children:"Рост холдеров при сильной поддержке = высокая вероятность скачка вверх."})]})]}),r.jsxs("div",{className:`meme-item flex items-start gap-3 p-4 rounded-xl ${s==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-gray-50"}`,children:[r.jsx(Sa,{className:"w-6 h-6 text-[#4E6E49]"}),r.jsxs("div",{children:[r.jsx("strong",{className:`font-semibold block mb-1 ${t}`,children:"Take Profit"}),r.jsx("p",{className:`text-sm ${e}`,children:"Целевые зоны 30-45% от входа, шаг фиксации прибыли — 12%."})]})]}),r.jsxs("div",{className:`meme-item flex items-start gap-3 p-4 rounded-xl ${s==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-gray-50"}`,children:[r.jsx(mx,{className:"w-6 h-6 text-[#4E6E49]"}),r.jsxs("div",{children:[r.jsx("strong",{className:`font-semibold block mb-1 ${t}`,children:"Правило выхода"}),r.jsx("p",{className:`text-sm ${e}`,children:"По общему правилу фиксируем максимум на 70-80% позиции, если токен продолжает движение — выходим в оранжевой зоне Фибоначчи."})]})]}),r.jsxs("div",{className:`meme-item flex items-start gap-3 p-4 rounded-xl ${s==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-gray-50"}`,children:[r.jsx(Sr,{className:"w-6 h-6 text-[#4E6E49]"}),r.jsxs("div",{children:[r.jsx("strong",{className:`font-semibold block mb-1 ${t}`,children:"Тайминг входа"}),r.jsx("p",{className:`text-sm ${e}`,children:"Помните, что в токен лучше заходить спустя 10-15 минут от миграции, чтобы избежать ранних рисков."})]})]}),r.jsxs("div",{className:`meme-item flex items-start gap-3 p-4 rounded-xl ${s==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-gray-50"}`,children:[r.jsx(ax,{className:"w-6 h-6 text-[#4E6E49]"}),r.jsxs("div",{children:[r.jsx("strong",{className:`font-semibold block mb-1 ${t}`,children:"Минимальные суммы"}),r.jsx("p",{className:`text-sm ${e}`,children:"Старайтесь проверять токен минимальными суммами, если не уверены — достаточно 10-15 секунд анализа."})]})]}),r.jsxs("div",{className:`meme-item flex items-start gap-3 p-4 rounded-xl ${s==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-gray-50"}`,children:[r.jsx(Xh,{className:"w-6 h-6 text-[#4E6E49]"}),r.jsxs("div",{children:[r.jsx("strong",{className:`font-semibold block mb-1 ${t}`,children:"Сервисы проверки"}),r.jsxs("p",{className:`text-sm ${e}`,children:["Используйте для анализа: ",r.jsx("a",{href:"https://rugcheck.xyz",className:"underline text-[#4E6E49]",target:"_blank",children:"rugcheck.xyz"})," и ",r.jsx("a",{href:"https://gmgn.ai/?chain=sol",className:"underline text-[#4E6E49]",target:"_blank",children:"gmgn.ai"})]})]})]})]})]}),r.jsxs("div",{className:`rounded-2xl p-6 sm:p-7 ${n} ${i} border ${a}`,children:[r.jsxs("div",{className:"flex flex-col gap-2 mb-4",children:[r.jsx("p",{className:`text-xs uppercase tracking-[0.12em] ${e}`,children:"Прогресс"}),r.jsx("h3",{className:`text-2xl font-bold ${t}`,children:"Состояние проверки"}),r.jsx("p",{className:`text-sm ${e}`,children:"Отмечайте выполненные пункты для отслеживания прогресса анализа."})]}),r.jsxs("div",{className:"space-y-6",children:[r.jsxs("div",{className:"text-center",children:[r.jsx("div",{id:"meme-progress-percentage",className:"text-6xl font-bold text-[#4E6E49] mb-2",children:"0%"}),r.jsx("p",{className:`text-sm ${e}`,children:"завершено"})]}),r.jsx("div",{className:`w-full h-8 ${s==="dark"?"bg-white/5":"bg-gray-200"} rounded-full overflow-hidden border ${s==="dark"?"border-white/10":"border-gray-300"}`,children:r.jsx("div",{id:"meme-progress-fill",className:"h-full bg-gradient-to-r from-[#4E6E49] to-[#6b8f5f] transition-all duration-800 ease-out relative",children:r.jsx("div",{className:"absolute right-3 top-1/2 -translate-y-1/2 text-white text-sm opacity-0 animate-pulse",children:"🐊"})})}),r.jsx("div",{className:"flex items-center justify-between text-center",children:r.jsxs("div",{className:"flex-1",children:[r.jsxs("div",{className:`text-2xl font-bold ${t}`,children:[r.jsx("span",{id:"meme-checked-count",children:"0"}),r.jsx("span",{className:`text-sm ${e} ml-1`,children:"из"}),r.jsx("span",{id:"meme-total-count",className:`text-sm ${e} ml-1`,children:"0"})]}),r.jsx("p",{className:`text-xs ${e} mt-1`,children:"пунктов выполнено"})]})}),r.jsx("div",{className:"flex justify-center",children:r.jsxs("button",{id:"meme-reset-button",className:`px-6 py-3 rounded-xl transition-all duration-200 border ${s==="dark"?"border-rose-300/60 bg-rose-500/20 text-rose-50 hover:bg-rose-500/30":"border-rose-400 bg-rose-50 text-rose-700 hover:bg-rose-100"} font-semibold flex items-center gap-2`,children:[r.jsx("span",{children:"🗑️"}),r.jsx("span",{children:"Сбросить прогресс"})]})})]})]})]})]}),r.jsx("style",{children:`
        .completed {
          background: rgba(255, 255, 255, 0.1) !important;
          border-color: #4E6E49 !important;
        }

        .meme-item.completed strong {
          color: #4E6E49 !important;
        }

        .meme-checkbox:checked {
          background-color: #4E6E49;
          border-color: #4E6E49;
        }

        .meme-checkbox:checked::after {
          content: '🐊';
          position: absolute;
          top: 50%;
          left: 50%;
          transform: translate(-50%, -50%);
          font-size: 12px;
          color: white;
        }
      `})]})},w4=()=>{const{theme:s}=at(),{user:e}=pt(),[t,n]=I.useState([]),[a,i]=I.useState(!0),[o,c]=I.useState(!1),[d,h]=I.useState(null),[m,x]=I.useState(null),[f,k]=I.useState(!1),[A,D]=I.useState(!1),[T,H]=I.useState({signalDate:new Date().toISOString().split("T")[0],signalTime:new Date().toLocaleTimeString("ru-RU",{hour:"2-digit",minute:"2-digit"}),marketCap:"",address:"",maxDrop:"",maxProfit:"",comment:""}),L=s==="dark"?"text-gray-400":"text-gray-600",E=s==="dark"?"text-white":"text-gray-900",M=s==="dark"?"bg-[#10141c]":"bg-white",ee=s==="dark"?"border-[#48a35e]/30":"border-[#48a35e]/20",C=s==="dark"?"shadow-[0_24px_80px_rgba(0,0,0,0.45)]":"shadow-[0_24px_80px_rgba(0,0,0,0.15)]";I.useEffect(()=>{v()},[]);const v=async()=>{try{const re=await Ej();n(re)}catch(re){console.error("Error loading alerts:",re)}finally{i(!1)}},p=(re,ue)=>{navigator.clipboard.writeText(re),x(ue),setTimeout(()=>x(null),2e3)},w=()=>{const re=t.map(W=>`${W.signalDate}	${W.signalTime}	${W.marketCap||"-"}	${W.address}	${W.maxDrop||"-"}	${W.maxProfit||"-"}	${W.comment||""}`).join(`
`);navigator.clipboard.writeText(`Дата	Время	Market Cap	Адрес	Макс. Падение	Макс. Профит	Комментарий
`+re),k(!0),setTimeout(()=>k(!1),2e3)},N=()=>{const re=`
      <table border="1">
        <thead>
          <tr>
            <th>Дата</th>
            <th>Время</th>
            <th>Market Cap</th>
            <th>Адрес</th>
            <th>Макс. Падение</th>
            <th>Макс. Профит</th>
            <th>Комментарий</th>
          </tr>
        </thead>
        <tbody>
          ${t.map(P=>`
            <tr>
              <td>${P.signalDate}</td>
              <td>${P.signalTime}</td>
              <td>${P.marketCap||"-"}</td>
              <td>${P.address}</td>
              <td>${P.maxDrop||"-"}</td>
              <td>${P.maxProfit||"-"}</td>
              <td>${P.comment||""}</td>
            </tr>
          `).join("")}
        </tbody>
      </table>
    `,ue="text/html",W=new Blob([re],{type:ue}),O=[new ClipboardItem({[ue]:W})];navigator.clipboard.write(O),D(!0),setTimeout(()=>D(!1),2e3)},j=async re=>{if(confirm("Удалить алерт?"))try{await Sj(re),await v()}catch(ue){console.error("Error deleting alert:",ue)}},b=re=>{h(re),H(re),c(!0)},y=async re=>{re.preventDefault();try{d?await Tj(d.id,T):await Ij({...T,createdAt:new Date().toISOString(),createdBy:(e==null?void 0:e.id)||"admin"}),c(!1),h(null),H({signalDate:new Date().toISOString().split("T")[0],signalTime:new Date().toLocaleTimeString("ru-RU",{hour:"2-digit",minute:"2-digit"}),marketCap:"",address:"",maxDrop:"",maxProfit:"",comment:""}),await v()}catch(ue){console.error("Error saving alert:",ue)}};return r.jsxs(mr,{children:[r.jsxs("div",{className:"space-y-6",children:[r.jsxs("div",{className:`relative overflow-hidden rounded-3xl border ${ee} ${C} ${M}`,children:[r.jsxs("div",{className:"absolute inset-0 pointer-events-none",children:[r.jsx("div",{className:"absolute -left-16 -bottom-10 w-80 h-80 bg-emerald-500/10 blur-3xl"}),r.jsx("div",{className:`absolute inset-0 ${s==="dark"?"bg-[radial-gradient(circle_at_50%_0%,rgba(255,255,255,0.05),transparent_45%)]":"bg-[radial-gradient(circle_at_50%_0%,rgba(78,110,73,0.05),transparent_45%)]"}`})]}),r.jsxs("div",{className:"relative p-6 sm:p-8 flex flex-col lg:flex-row items-stretch lg:items-center justify-between gap-6",children:[r.jsxs("div",{className:"flex items-center gap-4",children:[r.jsx("div",{className:`p-3 rounded-2xl ${s==="dark"?"bg-white/10 border-white/20":"bg-[#4E6E49]/10 border-[#4E6E49]/30"} shadow-inner`,children:r.jsx(Rx,{className:`w-8 h-8 ${s==="dark"?"text-white":"text-[#4E6E49]"}`})}),r.jsxs("div",{children:[r.jsx("h1",{className:`text-3xl font-black ${E}`,children:"AI - AO Alerts"}),r.jsx("p",{className:`text-sm ${L}`,children:"Мониторинг сигналов искусственного интеллекта"})]})]}),r.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[r.jsx("button",{onClick:w,disabled:t.length===0,className:`px-4 py-2 rounded-xl text-sm font-semibold transition-all flex items-center gap-2 border ${s==="dark"?"bg-white/5 border-white/10 hover:bg-white/10 text-gray-300":"bg-gray-100 border-gray-200 hover:bg-gray-200 text-gray-700"} disabled:opacity-50`,children:f?r.jsxs(r.Fragment,{children:[r.jsx(wr,{className:"w-4 h-4 text-green-500"}),r.jsx("span",{children:"Данные скопированы"})]}):r.jsxs(r.Fragment,{children:[r.jsx(zh,{className:"w-4 h-4"}),r.jsx("span",{children:"Копировать данные"})]})}),r.jsx("button",{onClick:N,disabled:t.length===0,className:`px-4 py-2 rounded-xl text-sm font-semibold transition-all flex items-center gap-2 border ${s==="dark"?"bg-white/5 border-white/10 hover:bg-white/10 text-gray-300":"bg-gray-100 border-gray-200 hover:bg-gray-200 text-gray-700"} disabled:opacity-50`,children:A?r.jsxs(r.Fragment,{children:[r.jsx(wr,{className:"w-4 h-4 text-green-500"}),r.jsx("span",{children:"Таблица скопирована"})]}):r.jsxs(r.Fragment,{children:[r.jsx(Dx,{className:"w-4 h-4"}),r.jsx("span",{children:"Копировать таблицу"})]})}),r.jsxs("button",{onClick:()=>{h(null),H({signalDate:new Date().toISOString().split("T")[0],signalTime:new Date().toLocaleTimeString("ru-RU",{hour:"2-digit",minute:"2-digit"})}),c(!0)},className:"px-4 py-2 rounded-xl bg-[#4E6E49] hover:bg-[#3d5a39] text-white font-semibold transition-colors flex items-center gap-2 shadow-lg shadow-[#4E6E49]/20 ml-auto",children:[r.jsx(is,{className:"w-4 h-4"}),r.jsx("span",{children:"Добавить сигнал"})]})]})]})]}),r.jsx("div",{className:`relative overflow-hidden rounded-3xl border ${ee} ${C} ${M}`,children:r.jsx("div",{className:"overflow-x-auto",children:r.jsxs("table",{className:"w-full text-left border-collapse",children:[r.jsx("thead",{children:r.jsxs("tr",{className:`border-b ${s==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-gray-50"}`,children:[r.jsx("th",{className:`p-4 text-xs uppercase tracking-wider font-semibold ${L}`,children:"Дата/Время"}),r.jsx("th",{className:`p-4 text-xs uppercase tracking-wider font-semibold ${L}`,children:"Капитализация"}),r.jsx("th",{className:`p-4 text-xs uppercase tracking-wider font-semibold ${L}`,children:"Адрес"}),r.jsx("th",{className:`p-4 text-xs uppercase tracking-wider font-semibold ${L}`,children:"Макс. Падение"}),r.jsx("th",{className:`p-4 text-xs uppercase tracking-wider font-semibold ${L}`,children:"Макс. Профит"}),r.jsx("th",{className:`p-4 text-xs uppercase tracking-wider font-semibold ${L}`,children:"Действия"})]})}),r.jsx("tbody",{className:`divide-y ${s==="dark"?"divide-white/5":"divide-gray-100"}`,children:a?r.jsx("tr",{children:r.jsx("td",{colSpan:6,className:"p-8 text-center text-gray-500",children:"Загрузка..."})}):t.length===0?r.jsx("tr",{children:r.jsx("td",{colSpan:6,className:"p-8 text-center text-gray-500",children:"Нет сигналов"})}):t.map(re=>r.jsxs("tr",{className:`${s==="dark"?"hover:bg-white/5":"hover:bg-gray-50"} transition-colors`,children:[r.jsxs("td",{className:"p-4 whitespace-nowrap",children:[r.jsx("div",{className:`font-mono font-medium ${E}`,children:re.signalDate}),r.jsx("div",{className:`text-xs ${L}`,children:re.signalTime})]}),r.jsx("td",{className:"p-4 whitespace-nowrap",children:r.jsx("div",{className:`font-mono ${E}`,children:re.marketCap||"-"})}),r.jsx("td",{className:"p-4",children:r.jsxs("div",{className:"flex items-center gap-2 max-w-[200px]",children:[r.jsx("div",{className:`truncate font-mono text-sm ${s==="dark"?"text-blue-400":"text-blue-600"}`,children:re.address}),r.jsx("button",{onClick:()=>p(re.address,re.id),className:`p-1.5 rounded-lg hover:bg-white/10 transition-colors ${L}`,children:m===re.id?r.jsx(wr,{className:"w-3 h-3 text-green-500"}):r.jsx(xa,{className:"w-3 h-3"})})]})}),r.jsxs("td",{className:"p-4 whitespace-nowrap",children:[r.jsx("span",{className:`font-mono ${re.maxDrop&&re.maxDrop.startsWith("-")?"text-red-500":E}`,children:re.maxDrop||"-"}),re.comment&&r.jsx("div",{className:`text-xs ${L} mt-1`,children:re.comment})]}),r.jsx("td",{className:"p-4 whitespace-nowrap",children:r.jsx("span",{className:"font-mono text-green-500 font-bold",children:re.maxProfit||"-"})}),r.jsx("td",{className:"p-4 whitespace-nowrap",children:r.jsxs("div",{className:"flex items-center gap-1",children:[r.jsx("button",{onClick:()=>b(re),className:`p-2 rounded-lg hover:bg-white/10 transition-colors ${s==="dark"?"text-blue-400":"text-blue-600"}`,children:r.jsx(Bt,{className:"w-4 h-4"})}),r.jsx("button",{onClick:()=>j(re.id),className:"p-2 rounded-lg hover:bg-red-500/10 text-red-500 transition-colors",children:r.jsx(At,{className:"w-4 h-4"})})]})})]},re.id))})]})})})]}),o&&r.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm",children:r.jsxs("div",{className:`w-full max-w-lg rounded-3xl ${M} ${ee} border shadow-2xl overflow-hidden`,children:[r.jsxs("div",{className:`p-6 border-b ${s==="dark"?"border-white/10":"border-gray-100"} flex items-center justify-between`,children:[r.jsx("h3",{className:`text-xl font-bold ${E}`,children:d?"Редактировать сигнал":"Новый сигнал"}),r.jsx("button",{onClick:()=>c(!1),className:`p-2 rounded-lg hover:bg-white/10 ${L}`,children:r.jsx(Pt,{className:"w-5 h-5"})})]}),r.jsxs("form",{onSubmit:y,className:"p-6 space-y-4",children:[r.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[r.jsxs("div",{className:"space-y-1",children:[r.jsx("label",{className:`text-xs font-semibold uppercase ${L}`,children:"Дата"}),r.jsx("input",{type:"date",required:!0,value:T.signalDate,onChange:re=>H({...T,signalDate:re.target.value}),className:`w-full p-3 rounded-xl border outline-none transition-all ${s==="dark"?"bg-black/30 border-white/10 text-white focus:border-[#4E6E49]":"bg-white border-gray-200 text-gray-900 focus:border-[#4E6E49]"}`})]}),r.jsxs("div",{className:"space-y-1",children:[r.jsx("label",{className:`text-xs font-semibold uppercase ${L}`,children:"Время"}),r.jsx("input",{type:"time",required:!0,value:T.signalTime,onChange:re=>H({...T,signalTime:re.target.value}),className:`w-full p-3 rounded-xl border outline-none transition-all ${s==="dark"?"bg-black/30 border-white/10 text-white focus:border-[#4E6E49]":"bg-white border-gray-200 text-gray-900 focus:border-[#4E6E49]"}`})]})]}),r.jsxs("div",{className:"space-y-1",children:[r.jsx("label",{className:`text-xs font-semibold uppercase ${L}`,children:"Адрес токена"}),r.jsx("input",{type:"text",required:!0,placeholder:"Адрес контракта...",value:T.address||"",onChange:re=>H({...T,address:re.target.value}),className:`w-full p-3 rounded-xl border outline-none transition-all font-mono text-sm ${s==="dark"?"bg-black/30 border-white/10 text-white focus:border-[#4E6E49]":"bg-white border-gray-200 text-gray-900 focus:border-[#4E6E49]"}`})]}),r.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[r.jsxs("div",{className:"space-y-1",children:[r.jsx("label",{className:`text-xs font-semibold uppercase ${L}`,children:"Market Cap"}),r.jsx("input",{type:"text",placeholder:"e.g. 300,77",value:T.marketCap||"",onChange:re=>H({...T,marketCap:re.target.value}),className:`w-full p-3 rounded-xl border outline-none transition-all ${s==="dark"?"bg-black/30 border-white/10 text-white focus:border-[#4E6E49]":"bg-white border-gray-200 text-gray-900 focus:border-[#4E6E49]"}`})]}),r.jsxs("div",{className:"space-y-1",children:[r.jsx("label",{className:`text-xs font-semibold uppercase ${L}`,children:"Макс. Падение"}),r.jsx("input",{type:"text",placeholder:"e.g. -16",value:T.maxDrop||"",onChange:re=>H({...T,maxDrop:re.target.value}),className:`w-full p-3 rounded-xl border outline-none transition-all ${s==="dark"?"bg-black/30 border-white/10 text-white focus:border-[#4E6E49]":"bg-white border-gray-200 text-gray-900 focus:border-[#4E6E49]"}`})]}),r.jsxs("div",{className:"space-y-1",children:[r.jsx("label",{className:`text-xs font-semibold uppercase ${L}`,children:"Макс. Профит"}),r.jsx("input",{type:"text",placeholder:"e.g. +28",value:T.maxProfit||"",onChange:re=>H({...T,maxProfit:re.target.value}),className:`w-full p-3 rounded-xl border outline-none transition-all ${s==="dark"?"bg-black/30 border-white/10 text-white focus:border-[#4E6E49]":"bg-white border-gray-200 text-gray-900 focus:border-[#4E6E49]"}`})]})]}),r.jsxs("div",{className:"space-y-1",children:[r.jsx("label",{className:`text-xs font-semibold uppercase ${L}`,children:"Комментарий"}),r.jsx("input",{type:"text",placeholder:"Дополнительная информация...",value:T.comment||"",onChange:re=>H({...T,comment:re.target.value}),className:`w-full p-3 rounded-xl border outline-none transition-all ${s==="dark"?"bg-black/30 border-white/10 text-white focus:border-[#4E6E49]":"bg-white border-gray-200 text-gray-900 focus:border-[#4E6E49]"}`})]}),r.jsxs("div",{className:"pt-4 flex gap-3",children:[r.jsx("button",{type:"button",onClick:()=>c(!1),className:`flex-1 py-3 rounded-xl font-semibold transition-colors ${s==="dark"?"bg-white/5 hover:bg-white/10 text-white":"bg-gray-100 hover:bg-gray-200 text-gray-800"}`,children:"Отмена"}),r.jsxs("button",{type:"submit",className:"flex-1 py-3 rounded-xl bg-[#4E6E49] hover:bg-[#3d5a39] text-white font-semibold transition-colors flex items-center justify-center gap-2",children:[r.jsx(Kl,{className:"w-4 h-4"}),r.jsx("span",{children:"Сохранить"})]})]})]})]})})]})},jr=({children:s})=>{const{isAuthenticated:e,user:t}=pt(),{isAdmin:n}=kt(),a=Rh(),[i,o]=I.useState(null),[c,d]=I.useState("");if(!e&&!n)return r.jsx(_i,{to:"/login",replace:!0});const h=m=>m==="/admin"?"admin":m==="/management"?"slots":m==="/earnings"?"earnings":m==="/tasks"?"tasks":m==="/rating"?"rating":m==="/profile"?"profile":m==="/approvals"?"admin":"login";return I.useEffect(()=>{(async()=>{if(!t||n){o(!0);return}const x=h(a.pathname);try{const f=await Jc(t.id,x);o(f.hasAccess),d(f.reason||"Доступ запрещен")}catch(f){console.error("Error checking access:",f),o(!0)}})()},[t,n,a.pathname]),i===null?r.jsx("div",{className:"flex items-center justify-center min-h-screen",children:r.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-4 border-[#4E6E49] border-t-transparent"})}):i?r.jsx(r.Fragment,{children:s}):r.jsx("div",{className:"flex items-center justify-center min-h-screen p-4",children:r.jsxs("div",{className:"text-center max-w-md",children:[r.jsx("div",{className:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4",children:r.jsx("svg",{className:"w-8 h-8 text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})})}),r.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-2",children:"Доступ запрещен"}),r.jsx("p",{className:"text-gray-600",children:c})]})})},k4=()=>{const{user:s}=pt(),[e,t]=I.useState(""),[n,a]=I.useState(),[i,o]=I.useState(!0),[c,d]=I.useState(!1);if(I.useEffect(()=>{(async()=>{if(!s){o(!1);return}try{const x=await Jc(s.id,"login");x.hasAccess?d(!1):(t(x.reason||"Доступ заблокирован"),a(x.expiresAt),d(!0))}catch(x){console.error("Error checking access:",x),t("Ошибка проверки доступа"),d(!0)}finally{o(!1)}})()},[s]),!c)return null;if(i)return r.jsx("div",{className:"fixed inset-0 bg-slate-950 flex items-center justify-center z-50",children:r.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-4 border-[#4E6E49] border-t-transparent"})});if(!e)return null;const h=m=>{if(!m)return"навсегда";const x=new Date(m);return x<=new Date?"навсегда":x.toLocaleString("ru-RU",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})};return r.jsx("div",{className:"fixed inset-0 bg-slate-950 flex items-center justify-center z-50 p-4",children:r.jsxs("div",{className:"max-w-md w-full bg-white dark:bg-gray-900 rounded-2xl shadow-2xl border border-gray-200 dark:border-gray-700 p-8 text-center",children:[r.jsxs("div",{className:"mb-6",children:[r.jsx("div",{className:"w-16 h-16 bg-red-100 dark:bg-red-900/30 rounded-full flex items-center justify-center mx-auto mb-4",children:r.jsx(Yl,{className:"w-8 h-8 text-red-600 dark:text-red-400"})}),r.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-2",children:"Доступ заблокирован"}),r.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-4",children:e})]}),r.jsx("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-4 mb-6",children:r.jsxs("div",{className:"flex items-center justify-center gap-2 text-sm text-gray-600 dark:text-gray-400",children:[r.jsx(Sr,{className:"w-4 h-4"}),r.jsxs("span",{children:["Блокировка до: ",h(n)]})]})}),r.jsx("div",{className:"bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-800 rounded-lg p-4",children:r.jsxs("div",{className:"flex items-start gap-3",children:[r.jsx(Lt,{className:"w-5 h-5 text-amber-600 dark:text-amber-400 flex-shrink-0 mt-0.5"}),r.jsxs("div",{className:"text-left",children:[r.jsx("p",{className:"text-sm font-medium text-amber-800 dark:text-amber-200 mb-1",children:"Свяжитесь с администратором"}),r.jsx("p",{className:"text-sm text-amber-700 dark:text-amber-300",children:"Для восстановления доступа обратитесь к администратору системы"})]})]})}),r.jsx("div",{className:"mt-6 text-xs text-gray-500 dark:text-gray-500",children:"ApeVault Team"})]})})};function N4(){const{isAuthenticated:s}=pt(),{isAdmin:e}=kt(),{theme:t}=at();return I.useEffect(()=>{document.body.classList.toggle("dark",t==="dark")},[t]),I.useEffect(()=>{ej().catch(n=>console.error("Cleanup failed",n))},[]),r.jsxs(hp,{children:[r.jsx(k4,{}),r.jsxs(mp,{children:[r.jsx(or,{path:"/login",element:!s&&!e?r.jsx(Lx,{}):r.jsx(_i,{to:"/management",replace:!0})}),r.jsx(or,{path:"/call",element:r.jsx(jr,{children:r.jsx(Mj,{})})}),r.jsx(or,{path:"/management",element:r.jsx(jr,{children:r.jsx(zj,{})})}),r.jsx(or,{path:"/earnings",element:r.jsx(jr,{children:r.jsx(Yj,{})})}),r.jsx(or,{path:"/rating",element:r.jsx(jr,{children:r.jsx(Zj,{})})}),r.jsx(or,{path:"/tasks",element:r.jsx(jr,{children:r.jsx(l4,{})})}),r.jsx(or,{path:"/about",element:r.jsx(jr,{children:r.jsx(h4,{})})}),r.jsx(or,{path:"/rules",element:r.jsx(m4,{})}),r.jsx(or,{path:"/approvals",element:r.jsx(jr,{children:r.jsx(b4,{})})}),r.jsx(or,{path:"/admin",element:r.jsx(jr,{children:r.jsx(c4,{})})}),r.jsx(or,{path:"/profile",element:r.jsx(jr,{children:r.jsx(d4,{})})}),r.jsx(or,{path:"/meme-evaluation",element:r.jsx(jr,{children:r.jsx(v4,{})})}),r.jsx(or,{path:"/ai-ao-alerts",element:r.jsx(jr,{children:r.jsx(w4,{})})}),r.jsx(or,{path:"/",element:r.jsx(_i,{to:s||e?"/management":"/login",replace:!0})})]})]})}cl.createRoot(document.getElementById("root")).render(r.jsx(Dh.StrictMode,{children:r.jsx(N4,{})}));
