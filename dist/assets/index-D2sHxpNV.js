import{r as k,a as bx,g as yx,R as Cc,u as A0,b as vx,L as zr,N as Hi,c as C0,O as wx,B as kx,d as jx,e as zt}from"./react-vendor-C1CKHd5q.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))a(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&a(o)}).observe(document,{childList:!0,subtree:!0});function r(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerPolicy&&(i.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?i.credentials="include":n.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function a(n){if(n.ep)return;n.ep=!0;const i=r(n);fetch(n.href,i)}})();var D0={exports:{}},Io={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Nx=k,_x=Symbol.for("react.element"),Ex=Symbol.for("react.fragment"),Tx=Object.prototype.hasOwnProperty,Sx=Nx.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Ix={key:!0,ref:!0,__self:!0,__source:!0};function $0(s,e,r){var a,n={},i=null,o=null;r!==void 0&&(i=""+r),e.key!==void 0&&(i=""+e.key),e.ref!==void 0&&(o=e.ref);for(a in e)Tx.call(e,a)&&!Ix.hasOwnProperty(a)&&(n[a]=e[a]);if(s&&s.defaultProps)for(a in e=s.defaultProps,e)n[a]===void 0&&(n[a]=e[a]);return{$$typeof:_x,type:s,key:i,ref:o,props:n,_owner:Sx.current}}Io.Fragment=Ex;Io.jsx=$0;Io.jsxs=$0;D0.exports=Io;var t=D0.exports,ql={},Iu=bx;ql.createRoot=Iu.createRoot,ql.hydrateRoot=Iu.hydrateRoot;const Ax={},Au=s=>{let e;const r=new Set,a=(m,f)=>{const x=typeof m=="function"?m(e):m;if(!Object.is(x,e)){const v=e;e=f??(typeof x!="object"||x===null)?x:Object.assign({},e,x),r.forEach(T=>T(e,v))}},n=()=>e,d={setState:a,getState:n,getInitialState:()=>u,subscribe:m=>(r.add(m),()=>r.delete(m)),destroy:()=>{(Ax?"production":void 0)!=="production"&&console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),r.clear()}},u=e=s(a,n,d);return d},Cx=s=>s?Au(s):Au;var R0={exports:{}},P0={},M0={exports:{}},O0={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var za=k;function Dx(s,e){return s===e&&(s!==0||1/s===1/e)||s!==s&&e!==e}var $x=typeof Object.is=="function"?Object.is:Dx,Rx=za.useState,Px=za.useEffect,Mx=za.useLayoutEffect,Ox=za.useDebugValue;function Vx(s,e){var r=e(),a=Rx({inst:{value:r,getSnapshot:e}}),n=a[0].inst,i=a[1];return Mx(function(){n.value=r,n.getSnapshot=e,bl(n)&&i({inst:n})},[s,r,e]),Px(function(){return bl(n)&&i({inst:n}),s(function(){bl(n)&&i({inst:n})})},[s]),Ox(r),r}function bl(s){var e=s.getSnapshot;s=s.value;try{var r=e();return!$x(s,r)}catch{return!0}}function Lx(s,e){return e()}var Fx=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?Lx:Vx;O0.useSyncExternalStore=za.useSyncExternalStore!==void 0?za.useSyncExternalStore:Fx;M0.exports=O0;var Ux=M0.exports;/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ao=k,Bx=Ux;function zx(s,e){return s===e&&(s!==0||1/s===1/e)||s!==s&&e!==e}var qx=typeof Object.is=="function"?Object.is:zx,Wx=Bx.useSyncExternalStore,Hx=Ao.useRef,Gx=Ao.useEffect,Kx=Ao.useMemo,Qx=Ao.useDebugValue;P0.useSyncExternalStoreWithSelector=function(s,e,r,a,n){var i=Hx(null);if(i.current===null){var o={hasValue:!1,value:null};i.current=o}else o=i.current;i=Kx(function(){function d(v){if(!u){if(u=!0,m=v,v=a(v),n!==void 0&&o.hasValue){var T=o.value;if(n(T,v))return f=T}return f=v}if(T=f,qx(m,v))return T;var I=a(v);return n!==void 0&&n(T,I)?(m=v,T):(m=v,f=I)}var u=!1,m,f,x=r===void 0?null:r;return[function(){return d(e())},x===null?void 0:function(){return d(x())}]},[e,r,a,n]);var c=Wx(s,i[0],i[1]);return Gx(function(){o.hasValue=!0,o.value=c},[c]),Qx(c),c};R0.exports=P0;var Yx=R0.exports;const Xx=yx(Yx),V0={},{useDebugValue:Jx}=Cc,{useSyncExternalStoreWithSelector:Zx}=Xx;let Cu=!1;const ef=s=>s;function tf(s,e=ef,r){(V0?"production":void 0)!=="production"&&r&&!Cu&&(console.warn("[DEPRECATED] Use `createWithEqualityFn` instead of `create` or use `useStoreWithEqualityFn` instead of `useStore`. They can be imported from 'zustand/traditional'. https://github.com/pmndrs/zustand/discussions/1937"),Cu=!0);const a=Zx(s.subscribe,s.getState,s.getServerState||s.getInitialState,e,r);return Jx(a),a}const rf=s=>{(V0?"production":void 0)!=="production"&&typeof s!="function"&&console.warn("[DEPRECATED] Passing a vanilla store will be unsupported in a future version. Instead use `import { useStore } from 'zustand'`.");const e=typeof s=="function"?Cx(s):s,r=(a,n)=>tf(e,a,n);return Object.assign(r,e),r},Zn=s=>rf,sf={};function af(s,e){let r;try{r=s()}catch{return}return{getItem:n=>{var i;const o=d=>d===null?null:JSON.parse(d,void 0),c=(i=r.getItem(n))!=null?i:null;return c instanceof Promise?c.then(o):o(c)},setItem:(n,i)=>r.setItem(n,JSON.stringify(i,void 0)),removeItem:n=>r.removeItem(n)}}const Un=s=>e=>{try{const r=s(e);return r instanceof Promise?r:{then(a){return Un(a)(r)},catch(a){return this}}}catch(r){return{then(a){return this},catch(a){return Un(a)(r)}}}},nf=(s,e)=>(r,a,n)=>{let i={getStorage:()=>localStorage,serialize:JSON.stringify,deserialize:JSON.parse,partialize:N=>N,version:0,merge:(N,O)=>({...O,...N}),...e},o=!1;const c=new Set,d=new Set;let u;try{u=i.getStorage()}catch{}if(!u)return s((...N)=>{console.warn(`[zustand persist middleware] Unable to update item '${i.name}', the given storage is currently unavailable.`),r(...N)},a,n);const m=Un(i.serialize),f=()=>{const N=i.partialize({...a()});let O;const D=m({state:N,version:i.version}).then(C=>u.setItem(i.name,C)).catch(C=>{O=C});if(O)throw O;return D},x=n.setState;n.setState=(N,O)=>{x(N,O),f()};const v=s((...N)=>{r(...N),f()},a,n);let T;const I=()=>{var N;if(!u)return;o=!1,c.forEach(D=>D(a()));const O=((N=i.onRehydrateStorage)==null?void 0:N.call(i,a()))||void 0;return Un(u.getItem.bind(u))(i.name).then(D=>{if(D)return i.deserialize(D)}).then(D=>{if(D)if(typeof D.version=="number"&&D.version!==i.version){if(i.migrate)return i.migrate(D.state,D.version);console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return D.state}).then(D=>{var C;return T=i.merge(D,(C=a())!=null?C:v),r(T,!0),f()}).then(()=>{O==null||O(T,void 0),o=!0,d.forEach(D=>D(T))}).catch(D=>{O==null||O(void 0,D)})};return n.persist={setOptions:N=>{i={...i,...N},N.getStorage&&(u=N.getStorage())},clearStorage:()=>{u==null||u.removeItem(i.name)},getOptions:()=>i,rehydrate:()=>I(),hasHydrated:()=>o,onHydrate:N=>(c.add(N),()=>{c.delete(N)}),onFinishHydration:N=>(d.add(N),()=>{d.delete(N)})},I(),T||v},of=(s,e)=>(r,a,n)=>{let i={storage:af(()=>localStorage),partialize:I=>I,version:0,merge:(I,N)=>({...N,...I}),...e},o=!1;const c=new Set,d=new Set;let u=i.storage;if(!u)return s((...I)=>{console.warn(`[zustand persist middleware] Unable to update item '${i.name}', the given storage is currently unavailable.`),r(...I)},a,n);const m=()=>{const I=i.partialize({...a()});return u.setItem(i.name,{state:I,version:i.version})},f=n.setState;n.setState=(I,N)=>{f(I,N),m()};const x=s((...I)=>{r(...I),m()},a,n);n.getInitialState=()=>x;let v;const T=()=>{var I,N;if(!u)return;o=!1,c.forEach(D=>{var C;return D((C=a())!=null?C:x)});const O=((N=i.onRehydrateStorage)==null?void 0:N.call(i,(I=a())!=null?I:x))||void 0;return Un(u.getItem.bind(u))(i.name).then(D=>{if(D)if(typeof D.version=="number"&&D.version!==i.version){if(i.migrate)return[!0,i.migrate(D.state,D.version)];console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return[!1,D.state];return[!1,void 0]}).then(D=>{var C;const[M,V]=D;if(v=i.merge(V,(C=a())!=null?C:x),r(v,!0),M)return m()}).then(()=>{O==null||O(v,void 0),v=a(),o=!0,d.forEach(D=>D(v))}).catch(D=>{O==null||O(void 0,D)})};return n.persist={setOptions:I=>{i={...i,...I},I.storage&&(u=I.storage)},clearStorage:()=>{u==null||u.removeItem(i.name)},getOptions:()=>i,rehydrate:()=>T(),hasHydrated:()=>o,onHydrate:I=>(c.add(I),()=>{c.delete(I)}),onFinishHydration:I=>(d.add(I),()=>{d.delete(I)})},i.skipHydration||T(),v||x},lf=(s,e)=>"getStorage"in e||"serialize"in e||"deserialize"in e?((sf?"production":void 0)!=="production"&&console.warn("[DEPRECATED] `getStorage`, `serialize` and `deserialize` options are deprecated. Use `storage` option instead."),nf(s,e)):of(s,e),ei=lf,us={memecoins:{label:"Мемкоины",accent:"emerald",icon:"rocket"},futures:{label:"Фьючерсы",accent:"blue",icon:"trending"},nft:{label:"NFT",accent:"purple",icon:"image"},spot:{label:"Спот",accent:"amber",icon:"coins"},airdrop:{label:"AirDrop",accent:"cyan",icon:"gift"},polymarket:{label:"Polymarket",accent:"pink",icon:"barchart"},staking:{label:"Стейкинг",accent:"indigo",icon:"shield"}},hs={memecoins:{label:"Мемкоины",accent:"emerald",icon:"rocket",gradient:"from-emerald-500 to-teal-600",shortName:"Мемы"},futures:{label:"Фьючерсы",accent:"blue",icon:"line",gradient:"from-blue-500 to-indigo-600",shortName:"Фьюч"},nft:{label:"NFT",accent:"purple",icon:"image",gradient:"from-purple-500 to-pink-600",shortName:"NFT"},spot:{label:"Спот",accent:"amber",icon:"coins",gradient:"from-amber-500 to-orange-600",shortName:"Спот"},airdrop:{label:"AirDrop",accent:"cyan",icon:"gift",gradient:"from-cyan-500 to-blue-600",shortName:"Airdrop"},polymarket:{label:"PolyMarket",accent:"pink",icon:"barchart",gradient:"from-pink-500 to-rose-600",shortName:"Poly"},staking:{label:"Стейкинг",accent:"indigo",icon:"shield",gradient:"from-indigo-500 to-violet-600",shortName:"Stake"},other:{label:"Другое",accent:"gray",icon:"sparkles",gradient:"from-gray-500 to-gray-600",shortName:"Другое"}},Ge=[{id:"1",name:"Артём",login:"dexim03@apevault.io",password:"095deximadmpro.03",recoveryCode:"20035009",avatar:"/avatars/artyom.jpg",phone:"79778730513"},{id:"2",name:"Адель",login:"enowk05@apevault.io",password:"101enowk.05",recoveryCode:"2005100",avatar:"/avatars/adel.jpg",phone:"79172480769"},{id:"3",name:"Ксения",login:"ksen03@apevault.io",password:"03ksen.03-@!",recoveryCode:"20037958",avatar:"/avatars/kseniya.jpg",phone:"79378159355"},{id:"4",name:"Ольга",login:"lelik-304@apevault.io",password:"040lelik.04",recoveryCode:"200423",avatar:"/avatars/olga.jpg",phone:"79393035770"}],Gi={trading:{label:"Торговля",icon:"candles",color:"green"},learning:{label:"Обучение",icon:"book",color:"blue"},technical:{label:"ТЧ",icon:"cpu",color:"purple"},stream:{label:"Стрим",icon:"broadcast",color:"red"},research:{label:"Изучение",icon:"flask",color:"yellow"},organization:{label:"Ресёрч",icon:"clipboard",color:"indigo"}},cf={in_progress:{label:"В работе",color:"blue"},completed:{label:"Выполнено",color:"green"},closed:{label:"Закрыто",color:"gray"}},Oa={memecoins:{label:"Мемкоины",gradient:"from-emerald-400 via-teal-500 to-cyan-400",gradientDark:"from-emerald-500 via-teal-600 to-cyan-500",icon:"rocket",cardGradient:"from-emerald-500/20 via-teal-400/10 to-cyan-500/5"},polymarket:{label:"Polymarket",gradient:"from-rose-400 to-red-500",gradientDark:"from-rose-600 to-red-500",icon:"barchart",cardGradient:"from-rose-500/20 via-red-500/10 to-transparent"},nft:{label:"NFT",gradient:"from-purple-400 to-pink-500",gradientDark:"from-purple-600 to-pink-500",icon:"image",cardGradient:"from-purple-500/20 via-pink-500/10 to-transparent"},staking:{label:"Стейкинг",gradient:"from-emerald-400 to-green-500",gradientDark:"from-emerald-600 to-green-500",icon:"shield",cardGradient:"from-emerald-500/20 via-green-500/10 to-transparent"},spot:{label:"Спот",gradient:"from-amber-400 to-orange-500",gradientDark:"from-amber-600 to-orange-500",icon:"coins",cardGradient:"from-amber-500/20 via-orange-500/10 to-transparent"},futures:{label:"Фьючерсы",gradient:"from-blue-400 to-indigo-500",gradientDark:"from-blue-600 to-indigo-500",icon:"trending",cardGradient:"from-blue-500/20 via-indigo-500/10 to-transparent"},airdrop:{label:"Airdrop",gradient:"from-gray-300 to-gray-400",gradientDark:"from-gray-400 to-gray-300",icon:"gift",cardGradient:"from-gray-500/20 via-gray-400/10 to-transparent"}},ot=Zn()(ei(s=>({user:null,isAuthenticated:!1,login:(e,r)=>{const a=Ge.find(n=>n.login===e&&n.password===r);return a?(s({user:a,isAuthenticated:!0}),!0):!1},logout:()=>s({user:null,isAuthenticated:!1})}),{name:"apevault-auth"})),Dc="4747",ft=Zn()(ei(s=>({isAdmin:!1,activateAdmin:e=>e===Dc?(s({isAdmin:!0}),!0):!1,deactivateAdmin:()=>s({isAdmin:!1})}),{name:"apevault-admin"})),Re=Zn()(ei(s=>({theme:"light",toggleTheme:()=>s(e=>{const r=e.theme==="light"?"dark":"light";return document.body.classList.toggle("dark",r==="dark"),{theme:r}}),setTheme:e=>s(()=>(document.body.classList.toggle("dark",e==="dark"),{theme:e}))}),{name:"apevault-theme"}));/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var df={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const uf=s=>s.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().trim(),J=(s,e)=>{const r=k.forwardRef(({color:a="currentColor",size:n=24,strokeWidth:i=2,absoluteStrokeWidth:o,className:c="",children:d,...u},m)=>k.createElement("svg",{ref:m,...df,width:n,height:n,stroke:a,strokeWidth:o?Number(i)*24/Number(n):i,className:["lucide",`lucide-${uf(s)}`,c].join(" "),...u},[...e.map(([f,x])=>k.createElement(f,x)),...Array.isArray(d)?d:[d]]));return r.displayName=`${s}`,r};/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ms=J("Activity",[["path",{d:"M22 12h-4l-3 9L9 3l-3 9H2",key:"d5dnw9"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ki=J("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nr=J("AlertTriangle",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z",key:"c3ski4"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const L0=J("Archive",[["rect",{width:"20",height:"5",x:"2",y:"3",rx:"1",key:"1wp1u1"}],["path",{d:"M4 8v11a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8",key:"1s80jp"}],["path",{d:"M10 12h4",key:"a56b0p"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hf=J("ArrowDownRight",[["path",{d:"m7 7 10 10",key:"1fmybs"}],["path",{d:"M17 7v10H7",key:"6fjiku"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mf=J("ArrowRightLeft",[["path",{d:"m16 3 4 4-4 4",key:"1x1c3m"}],["path",{d:"M20 7H4",key:"zbl0bi"}],["path",{d:"m8 21-4-4 4-4",key:"h9nckh"}],["path",{d:"M4 17h16",key:"g4d7ey"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Dn=J("ArrowUpRight",[["path",{d:"M7 7h10v10",key:"1tivn9"}],["path",{d:"M7 17 17 7",key:"1vkiza"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gf=J("Award",[["circle",{cx:"12",cy:"8",r:"6",key:"1vp47v"}],["path",{d:"M15.477 12.89 17 22l-5-3-5 3 1.523-9.11",key:"em7aur"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vr=J("BarChart3",[["path",{d:"M3 3v18h18",key:"1s2lah"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yl=J("BarChart",[["line",{x1:"12",x2:"12",y1:"20",y2:"10",key:"1vz5eb"}],["line",{x1:"18",x2:"18",y1:"20",y2:"4",key:"cun8e5"}],["line",{x1:"6",x2:"6",y1:"20",y2:"16",key:"hq0ia6"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pf=J("Battery",[["rect",{width:"16",height:"10",x:"2",y:"7",rx:"2",ry:"2",key:"1w10f2"}],["line",{x1:"22",x2:"22",y1:"11",y2:"13",key:"4dh1rd"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const F0=J("Bell",[["path",{d:"M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9",key:"1qo2s2"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fs=J("BookOpen",[["path",{d:"M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z",key:"vv98re"}],["path",{d:"M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z",key:"1cyq3y"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xf=J("Bot",[["path",{d:"M12 8V4H8",key:"hb8ula"}],["rect",{width:"16",height:"12",x:"4",y:"8",rx:"2",key:"enze0r"}],["path",{d:"M2 14h2",key:"vft8re"}],["path",{d:"M20 14h2",key:"4cs60a"}],["path",{d:"M15 13v2",key:"1xurst"}],["path",{d:"M9 13v2",key:"rq6x2g"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Du=J("Brain",[["path",{d:"M9.5 2A2.5 2.5 0 0 1 12 4.5v15a2.5 2.5 0 0 1-4.96.44 2.5 2.5 0 0 1-2.96-3.08 3 3 0 0 1-.34-5.58 2.5 2.5 0 0 1 1.32-4.24 2.5 2.5 0 0 1 1.98-3A2.5 2.5 0 0 1 9.5 2Z",key:"1mhkh5"}],["path",{d:"M14.5 2A2.5 2.5 0 0 0 12 4.5v15a2.5 2.5 0 0 0 4.96.44 2.5 2.5 0 0 0 2.96-3.08 3 3 0 0 0 .34-5.58 2.5 2.5 0 0 0-1.32-4.24 2.5 2.5 0 0 0-1.98-3A2.5 2.5 0 0 0 14.5 2Z",key:"1d6s00"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $u=J("Building2",[["path",{d:"M6 22V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v18Z",key:"1b4qmf"}],["path",{d:"M6 12H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h2",key:"i71pzd"}],["path",{d:"M18 9h2a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2h-2",key:"10jefs"}],["path",{d:"M10 6h4",key:"1itunk"}],["path",{d:"M10 10h4",key:"tcdvrf"}],["path",{d:"M10 14h4",key:"kelpxr"}],["path",{d:"M10 18h4",key:"1ulq68"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const U0=J("Calculator",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",key:"1nb95v"}],["line",{x1:"8",x2:"16",y1:"6",y2:"6",key:"x4nwl0"}],["line",{x1:"16",x2:"16",y1:"14",y2:"18",key:"wjye3r"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M8 18h.01",key:"lrp35t"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ru=J("CalendarCheck",[["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",ry:"2",key:"eu3xkr"}],["line",{x1:"16",x2:"16",y1:"2",y2:"6",key:"m3sa8f"}],["line",{x1:"8",x2:"8",y1:"2",y2:"6",key:"18kwsl"}],["line",{x1:"3",x2:"21",y1:"10",y2:"10",key:"xt86sb"}],["path",{d:"m9 16 2 2 4-4",key:"19s6y9"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ff=J("CalendarClock",[["path",{d:"M21 7.5V6a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h3.5",key:"1osxxc"}],["path",{d:"M16 2v4",key:"4m81vk"}],["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M3 10h5",key:"r794hk"}],["path",{d:"M17.5 17.5 16 16.25V14",key:"re2vv1"}],["path",{d:"M22 16a6 6 0 1 1-12 0 6 6 0 0 1 12 0Z",key:"ame013"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const B0=J("CalendarDays",[["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",ry:"2",key:"eu3xkr"}],["line",{x1:"16",x2:"16",y1:"2",y2:"6",key:"m3sa8f"}],["line",{x1:"8",x2:"8",y1:"2",y2:"6",key:"18kwsl"}],["line",{x1:"3",x2:"21",y1:"10",y2:"10",key:"xt86sb"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 18h.01",key:"lrp35t"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M16 18h.01",key:"kzsmim"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ir=J("Calendar",[["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",ry:"2",key:"eu3xkr"}],["line",{x1:"16",x2:"16",y1:"2",y2:"6",key:"m3sa8f"}],["line",{x1:"8",x2:"8",y1:"2",y2:"6",key:"18kwsl"}],["line",{x1:"3",x2:"21",y1:"10",y2:"10",key:"xt86sb"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bf=J("CandlestickChart",[["path",{d:"M9 5v4",key:"14uxtq"}],["rect",{width:"4",height:"6",x:"7",y:"9",rx:"1",key:"f4fvz0"}],["path",{d:"M9 15v2",key:"r5rk32"}],["path",{d:"M17 3v2",key:"1l2re6"}],["rect",{width:"4",height:"8",x:"15",y:"5",rx:"1",key:"z38je5"}],["path",{d:"M17 13v3",key:"5l0wba"}],["path",{d:"M3 3v18h18",key:"1s2lah"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ir=J("CheckCircle2",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const da=J("CheckSquare",[["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}],["path",{d:"M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11",key:"1jnkn4"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zr=J("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Dr=J("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const z0=J("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qi=J("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ti=J("ChevronUp",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pu=J("ClipboardCheck",[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}],["path",{d:"m9 14 2 2 4-4",key:"df797q"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yf=J("ClipboardList",[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}],["path",{d:"M12 11h4",key:"1jrz19"}],["path",{d:"M12 16h4",key:"n85exb"}],["path",{d:"M8 11h.01",key:"1dfujw"}],["path",{d:"M8 16h.01",key:"18s6g9"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vf=J("Clock3",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16.5 12",key:"1aq6pp"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Lt=J("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jr=J("Coins",[["circle",{cx:"8",cy:"8",r:"6",key:"3yglwk"}],["path",{d:"M18.09 10.37A6 6 0 1 1 10.34 18",key:"t5s6rm"}],["path",{d:"M7 6h1v4",key:"1obek4"}],["path",{d:"m16.71 13.88.7.71-2.82 2.82",key:"1rbuyh"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wf=J("Construction",[["rect",{x:"2",y:"6",width:"20",height:"8",rx:"1",key:"1estib"}],["path",{d:"M17 14v7",key:"7m2elx"}],["path",{d:"M7 14v7",key:"1cm7wv"}],["path",{d:"M17 3v3",key:"1v4jwn"}],["path",{d:"M7 3v3",key:"7o6guu"}],["path",{d:"M10 14 2.3 6.3",key:"1023jk"}],["path",{d:"m14 6 7.7 7.7",key:"1s8pl2"}],["path",{d:"m8 6 8 8",key:"hl96qh"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ws=J("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kf=J("Cpu",[["rect",{x:"4",y:"4",width:"16",height:"16",rx:"2",key:"1vbyd7"}],["rect",{x:"9",y:"9",width:"6",height:"6",key:"o3kz5p"}],["path",{d:"M15 2v2",key:"13l42r"}],["path",{d:"M15 20v2",key:"15mkzm"}],["path",{d:"M2 15h2",key:"1gxd5l"}],["path",{d:"M2 9h2",key:"1bbxkp"}],["path",{d:"M20 15h2",key:"19e6y8"}],["path",{d:"M20 9h2",key:"19tzq7"}],["path",{d:"M9 2v2",key:"165o2o"}],["path",{d:"M9 20v2",key:"i2bqo8"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Wl=J("Database",[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qa=J("DollarSign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jf=J("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const q0=J("ExternalLink",[["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}],["polyline",{points:"15 3 21 3 21 9",key:"mznyad"}],["line",{x1:"10",x2:"21",y1:"14",y2:"3",key:"18c3s4"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Yi=J("EyeOff",[["path",{d:"M9.88 9.88a3 3 0 1 0 4.24 4.24",key:"1jxqfv"}],["path",{d:"M10.73 5.08A10.43 10.43 0 0 1 12 5c7 0 10 7 10 7a13.16 13.16 0 0 1-1.67 2.68",key:"9wicm4"}],["path",{d:"M6.61 6.61A13.526 13.526 0 0 0 2 12s3 7 10 7a9.74 9.74 0 0 0 5.39-1.61",key:"1jreej"}],["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Wa=J("Eye",[["path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",key:"rwhkz3"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xi=J("FileText",[["path",{d:"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z",key:"1nnpy2"}],["polyline",{points:"14 2 14 8 20 8",key:"1ew0cm"}],["line",{x1:"16",x2:"8",y1:"13",y2:"13",key:"14keom"}],["line",{x1:"16",x2:"8",y1:"17",y2:"17",key:"17nazh"}],["line",{x1:"10",x2:"8",y1:"9",y2:"9",key:"1a5vjj"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const W0=J("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Nf=J("FlaskConical",[["path",{d:"M10 2v7.527a2 2 0 0 1-.211.896L4.72 20.55a1 1 0 0 0 .9 1.45h12.76a1 1 0 0 0 .9-1.45l-5.069-10.127A2 2 0 0 1 14 9.527V2",key:"pzvekw"}],["path",{d:"M8.5 2h7",key:"csnxdl"}],["path",{d:"M7 16h10",key:"wp8him"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Hl=J("Gauge",[["path",{d:"m12 14 4-4",key:"9kzdfg"}],["path",{d:"M3.34 19a10 10 0 1 1 17.32 0",key:"19p75a"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sn=J("Gift",[["rect",{x:"3",y:"8",width:"18",height:"4",rx:"1",key:"bkv52"}],["path",{d:"M12 8v13",key:"1c76mn"}],["path",{d:"M19 12v7a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2v-7",key:"6wjy6b"}],["path",{d:"M7.5 8a2.5 2.5 0 0 1 0-5A4.8 8 0 0 1 12 8a4.8 8 0 0 1 4.5-5 2.5 2.5 0 0 1 0 5",key:"1ihvrl"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Mu=J("Globe2",[["path",{d:"M21.54 15H17a2 2 0 0 0-2 2v4.54",key:"1djwo0"}],["path",{d:"M7 3.34V5a3 3 0 0 0 3 3v0a2 2 0 0 1 2 2v0c0 1.1.9 2 2 2v0a2 2 0 0 0 2-2v0c0-1.1.9-2 2-2h3.17",key:"1fi5u6"}],["path",{d:"M11 21.95V18a2 2 0 0 0-2-2v0a2 2 0 0 1-2-2v-1a2 2 0 0 0-2-2H2.05",key:"xsiumc"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _f=J("Globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ef=J("GraduationCap",[["path",{d:"M22 10v6M2 10l10-5 10 5-10 5z",key:"1ef52a"}],["path",{d:"M6 12v5c3 3 9 3 12 0v-5",key:"1f75yj"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Tf=J("Heart",[["path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z",key:"c3ymky"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const H0=J("HelpCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Sf=J("History",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const If=J("Hourglass",[["path",{d:"M5 22h14",key:"ehvnwv"}],["path",{d:"M5 2h14",key:"pdyrp9"}],["path",{d:"M17 22v-4.172a2 2 0 0 0-.586-1.414L12 12l-4.414 4.414A2 2 0 0 0 7 17.828V22",key:"1d314k"}],["path",{d:"M7 2v4.172a2 2 0 0 0 .586 1.414L12 12l4.414-4.414A2 2 0 0 0 17 6.172V2",key:"1vvvr6"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _s=J("Image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Wt=J("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Af=J("Key",[["circle",{cx:"7.5",cy:"15.5",r:"5.5",key:"yqb3hr"}],["path",{d:"m21 2-9.6 9.6",key:"1j0ho8"}],["path",{d:"m15.5 7.5 3 3L22 7l-3-3",key:"1rn1fs"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const G0=J("Layers",[["path",{d:"m12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83Z",key:"8b97xw"}],["path",{d:"m22 17.65-9.17 4.16a2 2 0 0 1-1.66 0L2 17.65",key:"dd6zsq"}],["path",{d:"m22 12.65-9.17 4.16a2 2 0 0 1-1.66 0L2 12.65",key:"ep9fru"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const K0=J("LayoutGrid",[["rect",{width:"7",height:"7",x:"3",y:"3",rx:"1",key:"1g98yp"}],["rect",{width:"7",height:"7",x:"14",y:"3",rx:"1",key:"6d4xhi"}],["rect",{width:"7",height:"7",x:"14",y:"14",rx:"1",key:"nxv5o0"}],["rect",{width:"7",height:"7",x:"3",y:"14",rx:"1",key:"1bb6yr"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $c=J("LayoutList",[["rect",{width:"7",height:"7",x:"3",y:"3",rx:"1",key:"1g98yp"}],["rect",{width:"7",height:"7",x:"3",y:"14",rx:"1",key:"1bb6yr"}],["path",{d:"M14 4h7",key:"3xa0d5"}],["path",{d:"M14 9h7",key:"1icrd9"}],["path",{d:"M14 15h7",key:"1mj8o2"}],["path",{d:"M14 20h7",key:"11slyb"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Q0=J("Lightbulb",[["path",{d:"M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5",key:"1gvzjb"}],["path",{d:"M9 18h6",key:"x1upvd"}],["path",{d:"M10 22h4",key:"ceow96"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ka=J("LineChart",[["path",{d:"M3 3v18h18",key:"1s2lah"}],["path",{d:"m19 9-5 5-4-4-3 3",key:"2osh9i"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ji=J("Link2",[["path",{d:"M9 17H7A5 5 0 0 1 7 7h2",key:"8i5ue5"}],["path",{d:"M15 7h2a5 5 0 1 1 0 10h-2",key:"1b9ql8"}],["line",{x1:"8",x2:"16",y1:"12",y2:"12",key:"1jonct"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ou=J("Link",[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ga=J("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gl=J("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Cf=J("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ds=J("MapPin",[["path",{d:"M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z",key:"2oe9fu"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Df=J("Menu",[["line",{x1:"4",x2:"20",y1:"12",y2:"12",key:"1e0a9i"}],["line",{x1:"4",x2:"20",y1:"6",y2:"6",key:"1owob3"}],["line",{x1:"4",x2:"20",y1:"18",y2:"18",key:"yk5zj1"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $f=J("MessageCircle",[["path",{d:"m3 21 1.9-5.7a8.5 8.5 0 1 1 3.8 3.8z",key:"v2veuj"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Y0=J("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Rf=J("MinusCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pf=J("Monitor",[["rect",{width:"20",height:"14",x:"2",y:"3",rx:"2",key:"48i651"}],["line",{x1:"8",x2:"16",y1:"21",y2:"21",key:"1svkeh"}],["line",{x1:"12",x2:"12",y1:"17",y2:"21",key:"vw1qmm"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zi=J("Moon",[["path",{d:"M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z",key:"a7tn18"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const X0=J("MousePointer2",[["path",{d:"m4 4 7.07 17 2.51-7.39L21 11.07z",key:"1vqm48"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Mf=J("Network",[["rect",{x:"16",y:"16",width:"6",height:"6",rx:"1",key:"4q2zg0"}],["rect",{x:"2",y:"16",width:"6",height:"6",rx:"1",key:"8cvhb9"}],["rect",{x:"9",y:"2",width:"6",height:"6",rx:"1",key:"1egb70"}],["path",{d:"M5 16v-3a1 1 0 0 1 1-1h12a1 1 0 0 1 1 1v3",key:"1jsf9p"}],["path",{d:"M12 12V8",key:"2874zd"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vl=J("Octagon",[["polygon",{points:"7.86 2 16.14 2 22 7.86 22 16.14 16.14 22 7.86 22 2 16.14 2 7.86 7.86 2",key:"h1p8hx"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Of=J("PanelLeftClose",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["path",{d:"M9 3v18",key:"fh3hqa"}],["path",{d:"m16 15-3-3 3-3",key:"14y99z"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vf=J("PanelLeftOpen",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["path",{d:"M9 3v18",key:"fh3hqa"}],["path",{d:"m14 9 3 3-3 3",key:"8010ee"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wl=J("PenLine",[["path",{d:"M12 20h9",key:"t2du7b"}],["path",{d:"M16.5 3.5a2.12 2.12 0 0 1 3 3L7 19l-4 1 1-4Z",key:"ymcmye"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ar=J("PenSquare",[["path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1qinfi"}],["path",{d:"M18.5 2.5a2.12 2.12 0 0 1 3 3L12 15l-4 1 1-4Z",key:"w2jsv5"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Kl=J("Pen",[["path",{d:"M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z",key:"5qss01"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Lf=J("Pencil",[["path",{d:"M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z",key:"5qss01"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kl=J("Percent",[["line",{x1:"19",x2:"5",y1:"5",y2:"19",key:"1x9vlm"}],["circle",{cx:"6.5",cy:"6.5",r:"2.5",key:"4mh3h7"}],["circle",{cx:"17.5",cy:"17.5",r:"2.5",key:"1mdrzq"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ff=J("PieChart",[["path",{d:"M21.21 15.89A10 10 0 1 1 8 2.83",key:"k2fpak"}],["path",{d:"M22 12A10 10 0 0 0 12 2v10z",key:"1rfc4y"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Tn=J("PiggyBank",[["path",{d:"M19 5c-1.5 0-2.8 1.4-3 2-3.5-1.5-11-.3-11 5 0 1.8 0 3 2 4.5V20h4v-2h3v2h4v-4c1-.5 1.7-1 2-2h2v-4h-2c0-1-.5-1.5-1-2h0V5z",key:"uf6l00"}],["path",{d:"M2 9v1c0 1.1.9 2 2 2h1",key:"nm575m"}],["path",{d:"M16 11h0",key:"k2aug8"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Uf=J("Plane",[["path",{d:"M17.8 19.2 16 11l3.5-3.5C21 6 21.5 4 21 3c-1-.5-3 0-4.5 1.5L13 8 4.8 6.2c-.5-.1-.9.1-1.1.5l-.3.5c-.2.5-.1 1 .3 1.3L9 12l-2 3H4l-1 1 3 2 2 3 1-1v-3l3-2 3.5 5.3c.3.4.8.5 1.3.3l.5-.2c.4-.3.6-.7.5-1.2z",key:"1v9wt8"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bf=J("PlusCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}],["path",{d:"M12 8v8",key:"napkw2"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mr=J("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const J0=J("Radio",[["path",{d:"M4.9 19.1C1 15.2 1 8.8 4.9 4.9",key:"1vaf9d"}],["path",{d:"M7.8 16.2c-2.3-2.3-2.3-6.1 0-8.5",key:"u1ii0m"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}],["path",{d:"M16.2 7.8c2.3 2.3 2.3 6.1 0 8.5",key:"1j5fej"}],["path",{d:"M19.1 4.9C23 8.8 23 15.1 19.1 19",key:"10b0cb"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zf=J("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qf=J("Repeat",[["path",{d:"m17 2 4 4-4 4",key:"nntrym"}],["path",{d:"M3 11v-1a4 4 0 0 1 4-4h14",key:"84bu3i"}],["path",{d:"m7 22-4-4 4-4",key:"1wqhfi"}],["path",{d:"M21 13v1a4 4 0 0 1-4 4H3",key:"1rx37r"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Lr=J("Rocket",[["path",{d:"M4.5 16.5c-1.5 1.26-2 5-2 5s3.74-.5 5-2c.71-.84.7-2.13-.09-2.91a2.18 2.18 0 0 0-2.91-.09z",key:"m3kijz"}],["path",{d:"m12 15-3-3a22 22 0 0 1 2-3.95A12.88 12.88 0 0 1 22 2c0 2.72-.78 7.5-6 11a22.35 22.35 0 0 1-4 2z",key:"1fmvmk"}],["path",{d:"M9 12H4s.55-3.03 2-4c1.62-1.08 5 0 5 0",key:"1f8sc4"}],["path",{d:"M12 15v5s3.03-.55 4-2c1.08-1.62 0-5 0-5",key:"qeys4"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Z0=J("RotateCcw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Rc=J("Save",[["path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z",key:"1owoqh"}],["polyline",{points:"17 21 17 13 7 13 7 21",key:"1md35c"}],["polyline",{points:"7 3 7 8 15 8",key:"8nz8an"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Wf=J("Scale",[["path",{d:"m16 16 3-8 3 8c-.87.65-1.92 1-3 1s-2.13-.35-3-1Z",key:"7g6ntu"}],["path",{d:"m2 16 3-8 3 8c-.87.65-1.92 1-3 1s-2.13-.35-3-1Z",key:"ijws7r"}],["path",{d:"M7 21h10",key:"1b0cd5"}],["path",{d:"M12 3v18",key:"108xh3"}],["path",{d:"M3 7h2c2 0 5-1 7-2 2 1 5 2 7 2h2",key:"3gwbw2"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Mi=J("ScrollText",[["path",{d:"M8 21h12a2 2 0 0 0 2-2v-2H10v2a2 2 0 1 1-4 0V5a2 2 0 1 0-4 0v3h4",key:"13a6an"}],["path",{d:"M19 17V5a2 2 0 0 0-2-2H4",key:"zz82l3"}],["path",{d:"M15 8h-5",key:"1khuty"}],["path",{d:"M15 12h-5",key:"r7krc0"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const es=J("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const em=J("Send",[["path",{d:"m22 2-7 20-4-9-9-4Z",key:"1q3vgg"}],["path",{d:"M22 2 11 13",key:"nzbqef"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oa=J("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Hf=J("Share2",[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bn=J("ShieldAlert",[["path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10",key:"1irkt0"}],["path",{d:"M12 8v4",key:"1got3b"}],["path",{d:"M12 16h.01",key:"1drbdi"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Hs=J("ShieldCheck",[["path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10",key:"1irkt0"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Co=J("ShieldX",[["path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10",key:"1irkt0"}],["path",{d:"m14.5 9-5 5",key:"1m49dw"}],["path",{d:"m9.5 9 5 5",key:"wyx7zg"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xt=J("Shield",[["path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10",key:"1irkt0"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gf=J("Smartphone",[["rect",{width:"14",height:"20",x:"5",y:"2",rx:"2",ry:"2",key:"1yt0o3"}],["path",{d:"M12 18h.01",key:"mhygvu"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ts=J("Sparkles",[["path",{d:"m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z",key:"17u4zn"}],["path",{d:"M5 3v4",key:"bklmnn"}],["path",{d:"M19 17v4",key:"iiml17"}],["path",{d:"M3 5h4",key:"nem4j1"}],["path",{d:"M17 19h4",key:"lbex7p"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jl=J("Square",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Kf=J("StickyNote",[["path",{d:"M15.5 3H5a2 2 0 0 0-2 2v14c0 1.1.9 2 2 2h14a2 2 0 0 0 2-2V8.5L15.5 3Z",key:"1wis1t"}],["path",{d:"M15 3v6h6",key:"edgan2"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const eo=J("Sun",[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"m4.93 4.93 1.41 1.41",key:"149t6j"}],["path",{d:"m17.66 17.66 1.41 1.41",key:"ptbguv"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"m6.34 17.66-1.41 1.41",key:"1m8zz5"}],["path",{d:"m19.07 4.93-1.41 1.41",key:"1shlcs"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qf=J("Table2",[["path",{d:"M9 3H5a2 2 0 0 0-2 2v4m6-6h10a2 2 0 0 1 2 2v4M9 3v18m0 0h10a2 2 0 0 0 2-2V9M9 21H5a2 2 0 0 1-2-2V9m0 0h18",key:"gugj83"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ql=J("Tag",[["path",{d:"M12 2H2v10l9.29 9.29c.94.94 2.48.94 3.42 0l6.58-6.58c.94-.94.94-2.48 0-3.42L12 2Z",key:"14b2ls"}],["path",{d:"M7 7h.01",key:"7u93v4"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rr=J("Target",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Yf=J("Terminal",[["polyline",{points:"4 17 10 11 4 5",key:"akl6gq"}],["line",{x1:"12",x2:"20",y1:"19",y2:"19",key:"q2wloq"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xf=J("ThumbsDown",[["path",{d:"M17 14V2",key:"8ymqnk"}],["path",{d:"M9 18.12 10 14H4.17a2 2 0 0 1-1.92-2.56l2.33-8A2 2 0 0 1 6.5 2H20a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2h-2.76a2 2 0 0 0-1.79 1.11L12 22h0a3.13 3.13 0 0 1-3-3.88Z",key:"s6e0r"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const an=J("Timer",[["line",{x1:"10",x2:"14",y1:"2",y2:"2",key:"14vaq8"}],["line",{x1:"12",x2:"15",y1:"14",y2:"11",key:"17fdiu"}],["circle",{cx:"12",cy:"14",r:"8",key:"1e1u0o"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Et=J("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Jf=J("Trash",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const it=J("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Yl=J("Twitter",[["path",{d:"M22 4s-.7 2.1-2 3.4c1.6 10-9.4 17.3-18 11.6 2.2.1 4.4-.6 6-2C3 15.5.5 9.6 3 5c2.2 2.6 5.6 4.1 9 4-.9-4.2 4-6.6 7-3.8 1.1 0 3-1.2 3-1.2z",key:"pff0z6"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zf=J("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tm=J("UserPlus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xl=J("UserX",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"17",x2:"22",y1:"8",y2:"13",key:"3nzzx3"}],["line",{x1:"22",x2:"17",y1:"8",y2:"13",key:"1swrse"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pr=J("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gt=J("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const eb=J("Wallet2",[["path",{d:"M17 14h.01",key:"7oqj8z"}],["path",{d:"M7 7h12a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h14",key:"u1rqew"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const to=J("Wallet",[["path",{d:"M21 12V7H5a2 2 0 0 1 0-4h14v4",key:"195gfw"}],["path",{d:"M3 5v14a2 2 0 0 0 2 2h16v-5",key:"195n9w"}],["path",{d:"M18 12a2 2 0 0 0 0 4h4v-4Z",key:"vllfpd"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tb=J("Wrench",[["path",{d:"M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z",key:"cbrjhi"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Os=J("XCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pt=J("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rm=J("ZapOff",[["polyline",{points:"12.41 6.75 13 2 10.57 4.92",key:"122m05"}],["polyline",{points:"18.57 12.91 21 10 15.66 10",key:"16r43o"}],["polyline",{points:"8 8 3 14 12 14 11 22 16 16",key:"tmh4bc"}],["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ar=J("Zap",[["polygon",{points:"13 2 3 14 12 14 11 22 21 10 12 10 13 2",key:"45s27k"}]]),$n="/assets/logo-CxzOhvKg.png",rb=({onClose:s,theme:e})=>{const[r,a]=k.useState(""),[n,i]=k.useState(""),[o,c]=k.useState(""),[d,u]=k.useState(null),[m,f]=k.useState(null),x=D=>{D.preventDefault(),c("");const C=Ge.find(M=>M.phone===r.replace(/\D/g,"")&&M.recoveryCode===n);C?u(C):c("Неверный номер телефона или специальный код")},v=(D,C)=>{navigator.clipboard.writeText(D),f(C),setTimeout(()=>f(null),2e3)},T=e==="dark"?"text-white":"text-gray-900",I=e==="dark"?"text-gray-400":"text-gray-500",N=e==="dark"?"bg-[#0b0f17]":"bg-white",O=e==="dark"?"border-white/10":"border-gray-200";return t.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4",children:[t.jsx("div",{className:"absolute inset-0 bg-black/60 backdrop-blur-md transition-opacity",onClick:s}),t.jsxs("div",{className:`relative w-full max-w-md overflow-hidden rounded-[2.5rem] ${N} shadow-[0_32px_64px_-16px_rgba(0,0,0,0.3)] border ${O} animate-in fade-in zoom-in duration-500`,children:[t.jsx("div",{className:"absolute -top-24 -left-24 w-64 h-64 bg-emerald-500/20 rounded-full blur-[80px] pointer-events-none animate-pulse"}),t.jsx("div",{className:"absolute top-1/2 -right-32 w-64 h-64 bg-blue-500/10 rounded-full blur-[100px] pointer-events-none"}),t.jsxs("div",{className:"relative p-10",children:[t.jsx("button",{onClick:s,className:`absolute top-8 right-8 p-2.5 rounded-full transition-all duration-300 ${e==="dark"?"hover:bg-white/10 text-gray-500 hover:text-white":"hover:bg-gray-100 text-gray-400 hover:text-gray-900"}`,children:t.jsx(pt,{className:"w-5 h-5"})}),d?t.jsxs("div",{className:"space-y-6 text-center animate-in slide-in-from-bottom-8 duration-700",children:[t.jsxs("div",{className:"relative inline-flex mb-2",children:[t.jsx("div",{className:"absolute inset-0 bg-emerald-500/30 blur-2xl rounded-full animate-pulse"}),t.jsx("div",{className:"relative p-5 rounded-3xl bg-emerald-500 text-white shadow-xl shadow-emerald-500/40",children:t.jsx(Hs,{className:"w-10 h-10"})})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx("h3",{className:`text-3xl font-black tracking-tight ${T}`,children:"Доступ восстановлен"}),t.jsx("p",{className:`text-sm font-medium leading-relaxed max-w-[240px] mx-auto ${I}`,children:"Данные подтверждены. Пожалуйста, сохраните ваши учетные данные"})]}),t.jsx("div",{className:"space-y-3",children:[{label:"Логин",value:d.login,icon:Pr,id:"login"},{label:"Пароль",value:d.password,icon:Af,id:"password"},{label:"Спец. код",value:d.recoveryCode||"",icon:ga,id:"code"},{label:"Телефон",value:d.phone||"",icon:Gf,id:"phone"}].map(D=>t.jsx("div",{onClick:()=>v(D.value,D.id),className:`group relative p-4 rounded-2xl border transition-all duration-300 cursor-pointer ${e==="dark"?"bg-white/[0.03] border-white/10 hover:border-emerald-500/50 hover:bg-white/[0.05]":"bg-gray-50 border-gray-200 hover:border-emerald-500/30 hover:bg-emerald-50/30"}`,children:t.jsxs("div",{className:"flex items-center justify-between gap-4",children:[t.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[t.jsx("div",{className:`p-2 rounded-xl shrink-0 ${e==="dark"?"bg-white/5 text-emerald-400":"bg-white text-emerald-500 border border-emerald-100"}`,children:t.jsx(D.icon,{className:"w-4 h-4"})}),t.jsxs("div",{className:"text-left min-w-0",children:[t.jsx("span",{className:`text-[10px] font-black uppercase tracking-wider block mb-0.5 ${I}`,children:D.label}),t.jsx("p",{className:`text-sm font-bold truncate ${T}`,children:D.value})]})]}),t.jsx("div",{className:`p-2 rounded-lg transition-all duration-300 ${m===D.id?"bg-emerald-500 text-white":"bg-transparent text-gray-500 group-hover:text-emerald-500"}`,children:m===D.id?t.jsx(Zr,{className:"w-4 h-4"}):t.jsx(Ws,{className:"w-4 h-4"})})]})},D.id))}),t.jsx("button",{onClick:s,className:"w-full py-5 rounded-[1.25rem] bg-gray-900 dark:bg-white text-white dark:text-gray-900 font-black transition-all duration-300 hover:opacity-90 active:scale-95 shadow-xl shadow-black/10",children:"Вернуться ко входу"})]}):t.jsxs("div",{className:"space-y-8",children:[t.jsxs("div",{className:"text-center space-y-3",children:[t.jsxs("div",{className:"relative inline-flex mb-2",children:[t.jsx("div",{className:"absolute inset-0 bg-emerald-500/20 blur-xl rounded-full"}),t.jsx("div",{className:"relative p-4 rounded-2xl bg-gradient-to-br from-emerald-500/10 to-teal-500/5 text-emerald-500 border border-emerald-500/20",children:t.jsx(ga,{className:"w-7 h-7"})})]}),t.jsx("h3",{className:`text-3xl font-black tracking-tight ${T}`,children:"Восстановление"}),t.jsx("p",{className:`text-sm font-medium leading-relaxed max-w-[240px] mx-auto ${I}`,children:"Введите ваши данные для получения доступа к аккаунту"})]}),t.jsxs("form",{onSubmit:x,className:"space-y-5",children:[t.jsxs("div",{className:"space-y-2.5",children:[t.jsx("label",{className:`text-sm font-bold block mb-2 ${e==="dark"?"text-gray-400":"text-gray-600"}`,children:"Номер телефона"}),t.jsx("div",{className:"relative group",children:t.jsx("input",{type:"tel",value:r,onChange:D=>a(D.target.value),placeholder:"79000000000",className:`w-full px-5 py-4 rounded-2xl border transition-all duration-300 focus:outline-none focus:ring-4 focus:ring-emerald-500/10 ${e==="dark"?"bg-white/5 border-white/10 text-white placeholder-gray-600 focus:border-emerald-500":"bg-gray-50 border-gray-200 text-gray-900 placeholder-gray-400 focus:border-emerald-500"}`,required:!0})})]}),t.jsxs("div",{className:"space-y-2.5",children:[t.jsx("label",{className:`text-sm font-bold block mb-2 ${e==="dark"?"text-gray-400":"text-gray-600"}`,children:"Специальный код"}),t.jsx("div",{className:"relative group",children:t.jsx("input",{type:"text",value:n,onChange:D=>i(D.target.value),placeholder:"00000000",className:`w-full px-5 py-4 rounded-2xl border transition-all duration-300 focus:outline-none focus:ring-4 focus:ring-emerald-500/10 ${e==="dark"?"bg-white/5 border-white/10 text-white placeholder-gray-600 focus:border-emerald-500":"bg-gray-50 border-gray-200 text-gray-900 placeholder-gray-400 focus:border-emerald-500"}`,required:!0})})]}),t.jsxs("div",{className:"relative group overflow-hidden",children:[t.jsx("div",{className:"absolute inset-0 bg-amber-500/5 opacity-0 group-hover:opacity-100 transition-opacity duration-500"}),t.jsxs("div",{className:"relative p-5 rounded-[1.25rem] bg-amber-500/[0.03] border border-amber-500/10 flex gap-4",children:[t.jsx("div",{className:"p-2 rounded-lg bg-amber-500/10 shrink-0 h-fit",children:t.jsx(nr,{className:"w-5 h-5 text-amber-500"})}),t.jsx("p",{className:"text-[11px] font-bold text-amber-600 dark:text-amber-400/80 leading-relaxed normal-case",children:"Внимание: если вы забыли специальный код, восстановить его невозможно, доступ к аккаунту утерян навсегда."})]})]}),o&&t.jsx("div",{className:"p-4 rounded-xl bg-red-500/10 border border-red-500/20 text-red-500 text-xs font-bold text-center animate-shake",children:o}),t.jsxs("button",{type:"submit",className:"w-full relative group overflow-hidden py-5 rounded-[1.25rem] bg-emerald-500 text-white font-black transition-all duration-300 shadow-[0_20px_40px_-10px_rgba(16,185,129,0.3)] hover:shadow-[0_25px_50px_-12px_rgba(16,185,129,0.4)] hover:-translate-y-0.5 active:translate-y-0 active:scale-95",children:[t.jsxs("span",{className:"relative z-10 flex items-center justify-center gap-2",children:["Проверить доступ",t.jsx(Hs,{className:"w-5 h-5 opacity-0 group-hover:opacity-100 -translate-x-2 group-hover:translate-x-0 transition-all duration-300"})]}),t.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-emerald-400 to-teal-500 opacity-0 group-hover:opacity-100 transition-opacity duration-500"})]})]})]})]})]})]})},sb=()=>{const[s,e]=k.useState("member"),[r,a]=k.useState(""),[n,i]=k.useState(""),[o,c]=k.useState(!1),[d,u]=k.useState(!1),[m,f]=k.useState(""),{login:x,user:v,isAuthenticated:T}=ot(),{theme:I,toggleTheme:N}=Re(),{activateAdmin:O}=ft(),D=A0(),[C]=vx(),[M,V]=k.useState(!1);k.useEffect(()=>{document.body.classList.toggle("dark",I==="dark")},[I]),k.useEffect(()=>{const y=localStorage.getItem("apevault_remembered");if(y)try{const{login:b,password:E,type:j}=JSON.parse(y);a(b),i(E),e(j||"member"),u(!0)}catch(b){console.error("Error loading remembered credentials:",b)}},[]),k.useEffect(()=>{var y,b,E;if(T&&v){D("/management");return}if((y=window.Telegram)!=null&&y.WebApp){window.Telegram.WebApp.ready(),window.Telegram.WebApp.expand();const A=C.get("tgWebAppData")||window.Telegram.WebApp.initData,w=C.get("login"),g=C.get("password");if(w&&g&&x(w,g)){D("/management");return}if(A)try{const ee=new URLSearchParams(A).get("user");if(ee){const Y=JSON.parse(decodeURIComponent(ee)).id;sessionStorage.setItem("telegram_user_id",String(Y));const q=localStorage.getItem("apevault-auth");if(q)try{const R=JSON.parse(q);if((b=R.state)!=null&&b.user){const S=R.state.user;if(x(S.login,S.password)){D("/management");return}}}catch(R){console.error("Error parsing saved auth:",R)}}}catch(L){console.error("Error parsing Telegram initData:",L)}const $=(E=window.Telegram.WebApp.initDataUnsafe)==null?void 0:E.user;$&&sessionStorage.setItem("telegram_user_id",String($.id))}},[C,T,v,D,x]);const U=y=>{if(y.preventDefault(),f(""),!n){f("Пожалуйста, введите пароль");return}if(s==="admin")O(n)?(d?localStorage.setItem("apevault_remembered",JSON.stringify({login:"",password:n,type:"admin"})):localStorage.removeItem("apevault_remembered"),D("/management")):f("Неверный пароль администратора");else{if(!r){f("Пожалуйста, введите логин");return}x(r,n)?(d?localStorage.setItem("apevault_remembered",JSON.stringify({login:r,password:n,type:"member"})):localStorage.removeItem("apevault_remembered"),D("/management")):f("Неверный логин или пароль")}};return t.jsxs("div",{className:`min-h-screen flex flex-col xl:flex-row ${I==="dark"?"bg-[#0b0f17]":"bg-white"}`,children:[t.jsxs("div",{className:"hidden xl:flex flex-1 relative bg-[#0b0f17] items-center justify-center p-12 overflow-hidden",children:[t.jsxs("div",{className:"absolute inset-0 pointer-events-none",children:[t.jsx("div",{className:"absolute -top-24 -left-24 w-[620px] h-[620px] bg-gradient-to-br from-[#4E6E49]/35 via-emerald-400/22 to-transparent blur-[110px]"}),t.jsx("div",{className:"absolute top-[-120px] right-[-180px] w-[780px] h-[780px] bg-gradient-to-bl from-blue-500/24 via-purple-500/22 to-transparent blur-[140px]"}),t.jsx("div",{className:"floating-grid opacity-30"})]}),t.jsxs("div",{className:"relative z-10 flex flex-col items-center text-center max-w-md",children:[t.jsx("div",{className:"w-24 h-24 sm:w-32 sm:h-32 mb-8 flex items-center justify-center animate-pulse-subtle",children:t.jsx("img",{src:$n,alt:"ApeVault",className:"w-20 h-20 sm:w-24 sm:h-24 object-contain rounded-xl filter drop-shadow-[0_0_15px_rgba(16,185,129,0.4)]"})}),t.jsxs("h1",{className:"text-4xl lg:text-5xl font-black text-white mb-6 tracking-tight",children:["ApeVault ",t.jsx("span",{className:"text-emerald-500",children:"Frontier"})]}),t.jsx("p",{className:"text-lg text-gray-400 font-medium leading-relaxed",children:"Единая командная панель для управления ресурсами, аналитикой и оперативного взаимодействия."}),t.jsx("div",{className:"mt-20 inline-flex items-center gap-2 px-4 py-2 rounded-full bg-white/5 border border-white/10 text-[10px] font-bold text-gray-400 uppercase tracking-widest"})]})]}),t.jsxs("div",{className:`flex-1 flex flex-col min-h-screen relative p-6 sm:p-12 lg:p-20 ${I==="dark"?"bg-[#0b0f17]":"bg-white"}`,children:[t.jsxs("div",{className:"xl:hidden flex items-center justify-between mb-12",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("img",{src:$n,alt:"Logo",className:"w-10 h-10 object-contain rounded-xl"}),t.jsx("span",{className:`font-black tracking-tight ${I==="dark"?"text-white":"text-gray-900"}`,children:"ApeVault Frontier"})]}),t.jsx("button",{onClick:N,className:"p-2 rounded-xl bg-gray-100 dark:bg-white/5 text-gray-700 dark:text-amber-300",children:I==="dark"?t.jsx(eo,{className:"w-5 h-5"}):t.jsx(Zi,{className:"w-5 h-5"})})]}),t.jsx("div",{className:"hidden xl:flex justify-end absolute top-8 right-8",children:t.jsx("button",{onClick:N,className:`p-3 rounded-full shadow-lg transition-all border ${I==="dark"?"bg-white/5 border-white/10 text-amber-300 hover:bg-white/10":"bg-white border-gray-100 text-gray-700 hover:bg-gray-50"}`,children:I==="dark"?t.jsx(eo,{className:"w-6 h-6"}):t.jsx(Zi,{className:"w-6 h-6"})})}),t.jsxs("div",{className:"flex-1 flex flex-col justify-center max-w-md mx-auto w-full",children:[t.jsxs("div",{className:"mb-10 text-center",children:[t.jsx("h2",{className:`text-4xl font-extrabold mb-3 tracking-tight ${I==="dark"?"text-white":"text-gray-900"}`,children:"Добро пожаловать"}),t.jsxs("p",{className:"text-gray-500 dark:text-gray-400 font-medium",children:["Введите данные для входа в ",t.jsx("span",{className:"text-emerald-500 font-bold",children:"ApeVault"})]})]}),t.jsxs("div",{className:"flex p-1 bg-gray-100 dark:bg-white/5 rounded-2xl mb-8",children:[t.jsxs("button",{onClick:()=>e("member"),className:`flex-1 flex items-center justify-center gap-2 py-3 rounded-xl font-bold transition-all ${s==="member"?"bg-white dark:bg-[#4E6E49] text-[#4E6E49] dark:text-white shadow-sm":"text-gray-500 hover:text-gray-700 dark:hover:text-gray-300"}`,children:[t.jsx(Gt,{className:"w-4 h-4"}),t.jsx("span",{children:"Участник"})]}),t.jsxs("button",{onClick:()=>e("admin"),className:`flex-1 flex items-center justify-center gap-2 py-3 rounded-xl font-bold transition-all ${s==="admin"?"bg-white dark:bg-[#4E6E49] text-[#4E6E49] dark:text-white shadow-sm":"text-gray-500 hover:text-gray-700 dark:hover:text-gray-300"}`,children:[t.jsx(xt,{className:"w-4 h-4"}),t.jsx("span",{children:"Админ"})]})]}),t.jsxs("form",{onSubmit:U,className:"space-y-6",children:[s==="member"&&t.jsxs("div",{className:"space-y-2",children:[t.jsx("label",{className:`text-sm font-bold block ${I==="dark"?"text-gray-400":"text-gray-600"}`,children:"Логин / Email"}),t.jsxs("div",{className:"relative group",children:[t.jsx("div",{className:"absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none text-gray-400 group-focus-within:text-emerald-500 transition-colors",children:t.jsx(Pr,{className:"w-5 h-5"})}),t.jsx("input",{type:"text",value:r,onChange:y=>a(y.target.value),placeholder:"agent@apevault.io",className:`w-full pl-12 pr-4 py-4 rounded-2xl border transition-all focus:outline-none focus:ring-4 focus:ring-emerald-500/10 ${I==="dark"?"bg-white/5 border-white/10 text-white placeholder-gray-600 focus:border-emerald-500":"bg-gray-50 border-gray-200 text-gray-900 placeholder-gray-400 focus:border-emerald-500"}`})]})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx("label",{className:`text-sm font-bold block ${I==="dark"?"text-gray-400":"text-gray-600"}`,children:"Пароль"}),t.jsxs("div",{className:"relative group",children:[t.jsx("div",{className:"absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none text-gray-400 group-focus-within:text-emerald-500 transition-colors",children:t.jsx(ga,{className:"w-5 h-5"})}),t.jsx("input",{type:o?"text":"password",value:n,onChange:y=>i(y.target.value),placeholder:"••••••••",className:`w-full pl-12 pr-12 py-4 rounded-2xl border transition-all focus:outline-none focus:ring-4 focus:ring-emerald-500/10 ${I==="dark"?"bg-white/5 border-white/10 text-white placeholder-gray-600 focus:border-emerald-500":"bg-gray-50 border-gray-200 text-gray-900 placeholder-gray-400 focus:border-emerald-500"}`}),t.jsx("button",{type:"button",onClick:()=>c(!o),className:"absolute inset-y-0 right-0 pr-4 flex items-center text-gray-400 hover:text-emerald-500 transition-colors",children:o?t.jsx(Yi,{className:"w-5 h-5"}):t.jsx(Wa,{className:"w-5 h-5"})})]})]}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("label",{className:"flex items-center gap-3 cursor-pointer group",children:[t.jsxs("div",{className:"relative",children:[t.jsx("input",{type:"checkbox",checked:d,onChange:y=>u(y.target.checked),className:"sr-only"}),t.jsx("div",{className:`w-5 h-5 rounded border transition-all flex items-center justify-center ${d?"bg-emerald-500 border-emerald-500":"border-gray-300 dark:border-white/20"}`,children:d&&t.jsx("div",{className:"w-2.5 h-2.5 bg-white rounded-sm"})})]}),t.jsx("span",{className:`text-sm font-bold ${I==="dark"?"text-gray-400":"text-gray-500"}`,children:"Запомнить меня"})]}),t.jsx("button",{type:"button",onClick:()=>V(!0),className:"text-sm font-bold text-emerald-500 hover:text-emerald-600 transition-colors",children:"Забыли пароль?"})]}),m&&t.jsx("div",{className:"p-4 rounded-2xl bg-red-500/10 border border-red-500/20 text-red-500 text-sm font-bold animate-shake",children:m}),t.jsx("button",{type:"submit",className:"w-full py-4 px-6 rounded-2xl bg-emerald-500 hover:bg-emerald-600 text-white font-black text-lg transition-all shadow-lg shadow-emerald-500/20 hover:scale-[1.02] active:scale-[0.98]",children:"Войти в Систему"})]}),t.jsx("div",{className:"mt-12 pt-8 border-t border-gray-100 dark:border-white/5",children:t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("a",{href:"https://t.me/artyommedoed",target:"_blank",rel:"noopener noreferrer",className:`flex items-center justify-center gap-2 py-3 px-4 rounded-2xl border transition-all font-bold text-sm ${I==="dark"?"border-white/10 bg-white/5 text-white hover:bg-white/10":"border-gray-200 bg-white text-gray-700 hover:bg-gray-50 shadow-sm"}`,children:[t.jsx(xt,{className:"w-4 h-4 text-emerald-500"}),t.jsx("span",{children:"Связаться с Админом"})]}),t.jsxs("a",{href:"/rules.pdf",download:!0,className:`flex items-center justify-center gap-2 py-3 px-4 rounded-2xl border transition-all font-bold text-sm ${I==="dark"?"border-white/10 bg-white/5 text-white hover:bg-white/10":"border-gray-200 bg-white text-gray-700 hover:bg-gray-50 shadow-sm"}`,children:[t.jsx(Fs,{className:"w-4 h-4 text-emerald-500"}),t.jsx("span",{children:"Правила Команды"})]})]})})]})]}),M&&t.jsx(rb,{theme:I,onClose:()=>V(!1)})]})};var Vu={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sm=function(s){const e=[];let r=0;for(let a=0;a<s.length;a++){let n=s.charCodeAt(a);n<128?e[r++]=n:n<2048?(e[r++]=n>>6|192,e[r++]=n&63|128):(n&64512)===55296&&a+1<s.length&&(s.charCodeAt(a+1)&64512)===56320?(n=65536+((n&1023)<<10)+(s.charCodeAt(++a)&1023),e[r++]=n>>18|240,e[r++]=n>>12&63|128,e[r++]=n>>6&63|128,e[r++]=n&63|128):(e[r++]=n>>12|224,e[r++]=n>>6&63|128,e[r++]=n&63|128)}return e},ab=function(s){const e=[];let r=0,a=0;for(;r<s.length;){const n=s[r++];if(n<128)e[a++]=String.fromCharCode(n);else if(n>191&&n<224){const i=s[r++];e[a++]=String.fromCharCode((n&31)<<6|i&63)}else if(n>239&&n<365){const i=s[r++],o=s[r++],c=s[r++],d=((n&7)<<18|(i&63)<<12|(o&63)<<6|c&63)-65536;e[a++]=String.fromCharCode(55296+(d>>10)),e[a++]=String.fromCharCode(56320+(d&1023))}else{const i=s[r++],o=s[r++];e[a++]=String.fromCharCode((n&15)<<12|(i&63)<<6|o&63)}}return e.join("")},am={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(s,e){if(!Array.isArray(s))throw Error("encodeByteArray takes an array as a parameter");this.init_();const r=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,a=[];for(let n=0;n<s.length;n+=3){const i=s[n],o=n+1<s.length,c=o?s[n+1]:0,d=n+2<s.length,u=d?s[n+2]:0,m=i>>2,f=(i&3)<<4|c>>4;let x=(c&15)<<2|u>>6,v=u&63;d||(v=64,o||(x=64)),a.push(r[m],r[f],r[x],r[v])}return a.join("")},encodeString(s,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(s):this.encodeByteArray(sm(s),e)},decodeString(s,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(s):ab(this.decodeStringToByteArray(s,e))},decodeStringToByteArray(s,e){this.init_();const r=e?this.charToByteMapWebSafe_:this.charToByteMap_,a=[];for(let n=0;n<s.length;){const i=r[s.charAt(n++)],c=n<s.length?r[s.charAt(n)]:0;++n;const u=n<s.length?r[s.charAt(n)]:64;++n;const f=n<s.length?r[s.charAt(n)]:64;if(++n,i==null||c==null||u==null||f==null)throw new nb;const x=i<<2|c>>4;if(a.push(x),u!==64){const v=c<<4&240|u>>2;if(a.push(v),f!==64){const T=u<<6&192|f;a.push(T)}}}return a},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let s=0;s<this.ENCODED_VALS.length;s++)this.byteToCharMap_[s]=this.ENCODED_VALS.charAt(s),this.charToByteMap_[this.byteToCharMap_[s]]=s,this.byteToCharMapWebSafe_[s]=this.ENCODED_VALS_WEBSAFE.charAt(s),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[s]]=s,s>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(s)]=s,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(s)]=s)}}};class nb extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const ib=function(s){const e=sm(s);return am.encodeByteArray(e,!0)},ro=function(s){return ib(s).replace(/\./g,"")},nm=function(s){try{return am.decodeString(s,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ob(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lb=()=>ob().__FIREBASE_DEFAULTS__,cb=()=>{if(typeof process>"u"||typeof Vu>"u")return;const s=Vu.__FIREBASE_DEFAULTS__;if(s)return JSON.parse(s)},db=()=>{if(typeof document>"u")return;let s;try{s=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=s&&nm(s[1]);return e&&JSON.parse(e)},Do=()=>{try{return lb()||cb()||db()}catch(s){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${s}`);return}},im=s=>{var e,r;return(r=(e=Do())===null||e===void 0?void 0:e.emulatorHosts)===null||r===void 0?void 0:r[s]},om=s=>{const e=im(s);if(!e)return;const r=e.lastIndexOf(":");if(r<=0||r+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const a=parseInt(e.substring(r+1),10);return e[0]==="["?[e.substring(1,r-1),a]:[e.substring(0,r),a]},lm=()=>{var s;return(s=Do())===null||s===void 0?void 0:s.config},cm=s=>{var e;return(e=Do())===null||e===void 0?void 0:e[`_${s}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ub{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,r)=>{this.resolve=e,this.reject=r})}wrapCallback(e){return(r,a)=>{r?this.reject(r):this.resolve(a),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(r):e(r,a))}}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function dm(s,e){if(s.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const r={alg:"none",type:"JWT"},a=e||"demo-project",n=s.iat||0,i=s.sub||s.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o=Object.assign({iss:`https://securetoken.google.com/${a}`,aud:a,iat:n,exp:n+3600,auth_time:n,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}}},s);return[ro(JSON.stringify(r)),ro(JSON.stringify(o)),""].join(".")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function or(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function hb(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(or())}function mb(){var s;const e=(s=Do())===null||s===void 0?void 0:s.forceEnvironment;if(e==="node")return!0;if(e==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function gb(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function pb(){const s=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof s=="object"&&s.id!==void 0}function xb(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function fb(){const s=or();return s.indexOf("MSIE ")>=0||s.indexOf("Trident/")>=0}function bb(){return!mb()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function yb(){try{return typeof indexedDB=="object"}catch{return!1}}function vb(){return new Promise((s,e)=>{try{let r=!0;const a="validate-browser-context-for-indexeddb-analytics-module",n=self.indexedDB.open(a);n.onsuccess=()=>{n.result.close(),r||self.indexedDB.deleteDatabase(a),s(!0)},n.onupgradeneeded=()=>{r=!1},n.onerror=()=>{var i;e(((i=n.error)===null||i===void 0?void 0:i.message)||"")}}catch(r){e(r)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wb="FirebaseError";class as extends Error{constructor(e,r,a){super(r),this.code=e,this.customData=a,this.name=wb,Object.setPrototypeOf(this,as.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,ri.prototype.create)}}class ri{constructor(e,r,a){this.service=e,this.serviceName=r,this.errors=a}create(e,...r){const a=r[0]||{},n=`${this.service}/${e}`,i=this.errors[e],o=i?kb(i,a):"Error",c=`${this.serviceName}: ${o} (${n}).`;return new as(n,c,a)}}function kb(s,e){return s.replace(jb,(r,a)=>{const n=e[a];return n!=null?String(n):`<${a}?>`})}const jb=/\{\$([^}]+)}/g;function Nb(s){for(const e in s)if(Object.prototype.hasOwnProperty.call(s,e))return!1;return!0}function so(s,e){if(s===e)return!0;const r=Object.keys(s),a=Object.keys(e);for(const n of r){if(!a.includes(n))return!1;const i=s[n],o=e[n];if(Lu(i)&&Lu(o)){if(!so(i,o))return!1}else if(i!==o)return!1}for(const n of a)if(!r.includes(n))return!1;return!0}function Lu(s){return s!==null&&typeof s=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function si(s){const e=[];for(const[r,a]of Object.entries(s))Array.isArray(a)?a.forEach(n=>{e.push(encodeURIComponent(r)+"="+encodeURIComponent(n))}):e.push(encodeURIComponent(r)+"="+encodeURIComponent(a));return e.length?"&"+e.join("&"):""}function _b(s,e){const r=new Eb(s,e);return r.subscribe.bind(r)}class Eb{constructor(e,r){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=r,this.task.then(()=>{e(this)}).catch(a=>{this.error(a)})}next(e){this.forEachObserver(r=>{r.next(e)})}error(e){this.forEachObserver(r=>{r.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,r,a){let n;if(e===void 0&&r===void 0&&a===void 0)throw new Error("Missing Observer.");Tb(e,["next","error","complete"])?n=e:n={next:e,error:r,complete:a},n.next===void 0&&(n.next=Nl),n.error===void 0&&(n.error=Nl),n.complete===void 0&&(n.complete=Nl);const i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?n.error(this.finalError):n.complete()}catch{}}),this.observers.push(n),i}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let r=0;r<this.observers.length;r++)this.sendOne(r,e)}sendOne(e,r){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{r(this.observers[e])}catch(a){typeof console<"u"&&console.error&&console.error(a)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function Tb(s,e){if(typeof s!="object"||s===null)return!1;for(const r of e)if(r in s&&typeof s[r]=="function")return!0;return!1}function Nl(){}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function St(s){return s&&s._delegate?s._delegate:s}class Gs{constructor(e,r,a){this.name=e,this.instanceFactory=r,this.type=a,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const na="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sb{constructor(e,r){this.name=e,this.container=r,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const r=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(r)){const a=new ub;if(this.instancesDeferred.set(r,a),this.isInitialized(r)||this.shouldAutoInitialize())try{const n=this.getOrInitializeService({instanceIdentifier:r});n&&a.resolve(n)}catch{}}return this.instancesDeferred.get(r).promise}getImmediate(e){var r;const a=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),n=(r=e==null?void 0:e.optional)!==null&&r!==void 0?r:!1;if(this.isInitialized(a)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:a})}catch(i){if(n)return null;throw i}else{if(n)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(Ab(e))try{this.getOrInitializeService({instanceIdentifier:na})}catch{}for(const[r,a]of this.instancesDeferred.entries()){const n=this.normalizeInstanceIdentifier(r);try{const i=this.getOrInitializeService({instanceIdentifier:n});a.resolve(i)}catch{}}}}clearInstance(e=na){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(r=>"INTERNAL"in r).map(r=>r.INTERNAL.delete()),...e.filter(r=>"_delete"in r).map(r=>r._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=na){return this.instances.has(e)}getOptions(e=na){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:r={}}=e,a=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(a))throw Error(`${this.name}(${a}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const n=this.getOrInitializeService({instanceIdentifier:a,options:r});for(const[i,o]of this.instancesDeferred.entries()){const c=this.normalizeInstanceIdentifier(i);a===c&&o.resolve(n)}return n}onInit(e,r){var a;const n=this.normalizeInstanceIdentifier(r),i=(a=this.onInitCallbacks.get(n))!==null&&a!==void 0?a:new Set;i.add(e),this.onInitCallbacks.set(n,i);const o=this.instances.get(n);return o&&e(o,n),()=>{i.delete(e)}}invokeOnInitCallbacks(e,r){const a=this.onInitCallbacks.get(r);if(a)for(const n of a)try{n(e,r)}catch{}}getOrInitializeService({instanceIdentifier:e,options:r={}}){let a=this.instances.get(e);if(!a&&this.component&&(a=this.component.instanceFactory(this.container,{instanceIdentifier:Ib(e),options:r}),this.instances.set(e,a),this.instancesOptions.set(e,r),this.invokeOnInitCallbacks(a,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,a)}catch{}return a||null}normalizeInstanceIdentifier(e=na){return this.component?this.component.multipleInstances?e:na:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function Ib(s){return s===na?void 0:s}function Ab(s){return s.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cb{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const r=this.getProvider(e.name);if(r.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);r.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const r=new Sb(e,this);return this.providers.set(e,r),r}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Ke;(function(s){s[s.DEBUG=0]="DEBUG",s[s.VERBOSE=1]="VERBOSE",s[s.INFO=2]="INFO",s[s.WARN=3]="WARN",s[s.ERROR=4]="ERROR",s[s.SILENT=5]="SILENT"})(Ke||(Ke={}));const Db={debug:Ke.DEBUG,verbose:Ke.VERBOSE,info:Ke.INFO,warn:Ke.WARN,error:Ke.ERROR,silent:Ke.SILENT},$b=Ke.INFO,Rb={[Ke.DEBUG]:"log",[Ke.VERBOSE]:"log",[Ke.INFO]:"info",[Ke.WARN]:"warn",[Ke.ERROR]:"error"},Pb=(s,e,...r)=>{if(e<s.logLevel)return;const a=new Date().toISOString(),n=Rb[e];if(n)console[n](`[${a}]  ${s.name}:`,...r);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class Pc{constructor(e){this.name=e,this._logLevel=$b,this._logHandler=Pb,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in Ke))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?Db[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,Ke.DEBUG,...e),this._logHandler(this,Ke.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,Ke.VERBOSE,...e),this._logHandler(this,Ke.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,Ke.INFO,...e),this._logHandler(this,Ke.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,Ke.WARN,...e),this._logHandler(this,Ke.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,Ke.ERROR,...e),this._logHandler(this,Ke.ERROR,...e)}}const Mb=(s,e)=>e.some(r=>s instanceof r);let Fu,Uu;function Ob(){return Fu||(Fu=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function Vb(){return Uu||(Uu=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const um=new WeakMap,Jl=new WeakMap,hm=new WeakMap,_l=new WeakMap,Mc=new WeakMap;function Lb(s){const e=new Promise((r,a)=>{const n=()=>{s.removeEventListener("success",i),s.removeEventListener("error",o)},i=()=>{r(Us(s.result)),n()},o=()=>{a(s.error),n()};s.addEventListener("success",i),s.addEventListener("error",o)});return e.then(r=>{r instanceof IDBCursor&&um.set(r,s)}).catch(()=>{}),Mc.set(e,s),e}function Fb(s){if(Jl.has(s))return;const e=new Promise((r,a)=>{const n=()=>{s.removeEventListener("complete",i),s.removeEventListener("error",o),s.removeEventListener("abort",o)},i=()=>{r(),n()},o=()=>{a(s.error||new DOMException("AbortError","AbortError")),n()};s.addEventListener("complete",i),s.addEventListener("error",o),s.addEventListener("abort",o)});Jl.set(s,e)}let Zl={get(s,e,r){if(s instanceof IDBTransaction){if(e==="done")return Jl.get(s);if(e==="objectStoreNames")return s.objectStoreNames||hm.get(s);if(e==="store")return r.objectStoreNames[1]?void 0:r.objectStore(r.objectStoreNames[0])}return Us(s[e])},set(s,e,r){return s[e]=r,!0},has(s,e){return s instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in s}};function Ub(s){Zl=s(Zl)}function Bb(s){return s===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...r){const a=s.call(El(this),e,...r);return hm.set(a,e.sort?e.sort():[e]),Us(a)}:Vb().includes(s)?function(...e){return s.apply(El(this),e),Us(um.get(this))}:function(...e){return Us(s.apply(El(this),e))}}function zb(s){return typeof s=="function"?Bb(s):(s instanceof IDBTransaction&&Fb(s),Mb(s,Ob())?new Proxy(s,Zl):s)}function Us(s){if(s instanceof IDBRequest)return Lb(s);if(_l.has(s))return _l.get(s);const e=zb(s);return e!==s&&(_l.set(s,e),Mc.set(e,s)),e}const El=s=>Mc.get(s);function qb(s,e,{blocked:r,upgrade:a,blocking:n,terminated:i}={}){const o=indexedDB.open(s,e),c=Us(o);return a&&o.addEventListener("upgradeneeded",d=>{a(Us(o.result),d.oldVersion,d.newVersion,Us(o.transaction),d)}),r&&o.addEventListener("blocked",d=>r(d.oldVersion,d.newVersion,d)),c.then(d=>{i&&d.addEventListener("close",()=>i()),n&&d.addEventListener("versionchange",u=>n(u.oldVersion,u.newVersion,u))}).catch(()=>{}),c}const Wb=["get","getKey","getAll","getAllKeys","count"],Hb=["put","add","delete","clear"],Tl=new Map;function Bu(s,e){if(!(s instanceof IDBDatabase&&!(e in s)&&typeof e=="string"))return;if(Tl.get(e))return Tl.get(e);const r=e.replace(/FromIndex$/,""),a=e!==r,n=Hb.includes(r);if(!(r in(a?IDBIndex:IDBObjectStore).prototype)||!(n||Wb.includes(r)))return;const i=async function(o,...c){const d=this.transaction(o,n?"readwrite":"readonly");let u=d.store;return a&&(u=u.index(c.shift())),(await Promise.all([u[r](...c),n&&d.done]))[0]};return Tl.set(e,i),i}Ub(s=>({...s,get:(e,r,a)=>Bu(e,r)||s.get(e,r,a),has:(e,r)=>!!Bu(e,r)||s.has(e,r)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gb{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(r=>{if(Kb(r)){const a=r.getImmediate();return`${a.library}/${a.version}`}else return null}).filter(r=>r).join(" ")}}function Kb(s){const e=s.getComponent();return(e==null?void 0:e.type)==="VERSION"}const ec="@firebase/app",zu="0.10.13";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vs=new Pc("@firebase/app"),Qb="@firebase/app-compat",Yb="@firebase/analytics-compat",Xb="@firebase/analytics",Jb="@firebase/app-check-compat",Zb="@firebase/app-check",ey="@firebase/auth",ty="@firebase/auth-compat",ry="@firebase/database",sy="@firebase/data-connect",ay="@firebase/database-compat",ny="@firebase/functions",iy="@firebase/functions-compat",oy="@firebase/installations",ly="@firebase/installations-compat",cy="@firebase/messaging",dy="@firebase/messaging-compat",uy="@firebase/performance",hy="@firebase/performance-compat",my="@firebase/remote-config",gy="@firebase/remote-config-compat",py="@firebase/storage",xy="@firebase/storage-compat",fy="@firebase/firestore",by="@firebase/vertexai-preview",yy="@firebase/firestore-compat",vy="firebase",wy="10.14.1";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tc="[DEFAULT]",ky={[ec]:"fire-core",[Qb]:"fire-core-compat",[Xb]:"fire-analytics",[Yb]:"fire-analytics-compat",[Zb]:"fire-app-check",[Jb]:"fire-app-check-compat",[ey]:"fire-auth",[ty]:"fire-auth-compat",[ry]:"fire-rtdb",[sy]:"fire-data-connect",[ay]:"fire-rtdb-compat",[ny]:"fire-fn",[iy]:"fire-fn-compat",[oy]:"fire-iid",[ly]:"fire-iid-compat",[cy]:"fire-fcm",[dy]:"fire-fcm-compat",[uy]:"fire-perf",[hy]:"fire-perf-compat",[my]:"fire-rc",[gy]:"fire-rc-compat",[py]:"fire-gcs",[xy]:"fire-gcs-compat",[fy]:"fire-fst",[yy]:"fire-fst-compat",[by]:"fire-vertex","fire-js":"fire-js",[vy]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ao=new Map,jy=new Map,rc=new Map;function qu(s,e){try{s.container.addComponent(e)}catch(r){vs.debug(`Component ${e.name} failed to register with FirebaseApp ${s.name}`,r)}}function pa(s){const e=s.name;if(rc.has(e))return vs.debug(`There were multiple attempts to register component ${e}.`),!1;rc.set(e,s);for(const r of ao.values())qu(r,s);for(const r of jy.values())qu(r,s);return!0}function $o(s,e){const r=s.container.getProvider("heartbeat").getImmediate({optional:!0});return r&&r.triggerHeartbeat(),s.container.getProvider(e)}function Vs(s){return s.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ny={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},Bs=new ri("app","Firebase",Ny);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _y{constructor(e,r,a){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},r),this._name=r.name,this._automaticDataCollectionEnabled=r.automaticDataCollectionEnabled,this._container=a,this.container.addComponent(new Gs("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Bs.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ja=wy;function mm(s,e={}){let r=s;typeof e!="object"&&(e={name:e});const a=Object.assign({name:tc,automaticDataCollectionEnabled:!1},e),n=a.name;if(typeof n!="string"||!n)throw Bs.create("bad-app-name",{appName:String(n)});if(r||(r=lm()),!r)throw Bs.create("no-options");const i=ao.get(n);if(i){if(so(r,i.options)&&so(a,i.config))return i;throw Bs.create("duplicate-app",{appName:n})}const o=new Cb(n);for(const d of rc.values())o.addComponent(d);const c=new _y(r,a,o);return ao.set(n,c),c}function Oc(s=tc){const e=ao.get(s);if(!e&&s===tc&&lm())return mm();if(!e)throw Bs.create("no-app",{appName:s});return e}function Kr(s,e,r){var a;let n=(a=ky[s])!==null&&a!==void 0?a:s;r&&(n+=`-${r}`);const i=n.match(/\s|\//),o=e.match(/\s|\//);if(i||o){const c=[`Unable to register library "${n}" with version "${e}":`];i&&c.push(`library name "${n}" contains illegal characters (whitespace or "/")`),i&&o&&c.push("and"),o&&c.push(`version name "${e}" contains illegal characters (whitespace or "/")`),vs.warn(c.join(" "));return}pa(new Gs(`${n}-version`,()=>({library:n,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ey="firebase-heartbeat-database",Ty=1,zn="firebase-heartbeat-store";let Sl=null;function gm(){return Sl||(Sl=qb(Ey,Ty,{upgrade:(s,e)=>{switch(e){case 0:try{s.createObjectStore(zn)}catch(r){console.warn(r)}}}}).catch(s=>{throw Bs.create("idb-open",{originalErrorMessage:s.message})})),Sl}async function Sy(s){try{const r=(await gm()).transaction(zn),a=await r.objectStore(zn).get(pm(s));return await r.done,a}catch(e){if(e instanceof as)vs.warn(e.message);else{const r=Bs.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});vs.warn(r.message)}}}async function Wu(s,e){try{const a=(await gm()).transaction(zn,"readwrite");await a.objectStore(zn).put(e,pm(s)),await a.done}catch(r){if(r instanceof as)vs.warn(r.message);else{const a=Bs.create("idb-set",{originalErrorMessage:r==null?void 0:r.message});vs.warn(a.message)}}}function pm(s){return`${s.name}!${s.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Iy=1024,Ay=30*24*60*60*1e3;class Cy{constructor(e){this.container=e,this._heartbeatsCache=null;const r=this.container.getProvider("app").getImmediate();this._storage=new $y(r),this._heartbeatsCachePromise=this._storage.read().then(a=>(this._heartbeatsCache=a,a))}async triggerHeartbeat(){var e,r;try{const n=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),i=Hu();return((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((r=this._heartbeatsCache)===null||r===void 0?void 0:r.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===i||this._heartbeatsCache.heartbeats.some(o=>o.date===i)?void 0:(this._heartbeatsCache.heartbeats.push({date:i,agent:n}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(o=>{const c=new Date(o.date).valueOf();return Date.now()-c<=Ay}),this._storage.overwrite(this._heartbeatsCache))}catch(a){vs.warn(a)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const r=Hu(),{heartbeatsToSend:a,unsentEntries:n}=Dy(this._heartbeatsCache.heartbeats),i=ro(JSON.stringify({version:2,heartbeats:a}));return this._heartbeatsCache.lastSentHeartbeatDate=r,n.length>0?(this._heartbeatsCache.heartbeats=n,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(r){return vs.warn(r),""}}}function Hu(){return new Date().toISOString().substring(0,10)}function Dy(s,e=Iy){const r=[];let a=s.slice();for(const n of s){const i=r.find(o=>o.agent===n.agent);if(i){if(i.dates.push(n.date),Gu(r)>e){i.dates.pop();break}}else if(r.push({agent:n.agent,dates:[n.date]}),Gu(r)>e){r.pop();break}a=a.slice(1)}return{heartbeatsToSend:r,unsentEntries:a}}class $y{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return yb()?vb().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const r=await Sy(this.app);return r!=null&&r.heartbeats?r:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){var r;if(await this._canUseIndexedDBPromise){const n=await this.read();return Wu(this.app,{lastSentHeartbeatDate:(r=e.lastSentHeartbeatDate)!==null&&r!==void 0?r:n.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){var r;if(await this._canUseIndexedDBPromise){const n=await this.read();return Wu(this.app,{lastSentHeartbeatDate:(r=e.lastSentHeartbeatDate)!==null&&r!==void 0?r:n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...e.heartbeats]})}else return}}function Gu(s){return ro(JSON.stringify({version:2,heartbeats:s})).length}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ry(s){pa(new Gs("platform-logger",e=>new Gb(e),"PRIVATE")),pa(new Gs("heartbeat",e=>new Cy(e),"PRIVATE")),Kr(ec,zu,s),Kr(ec,zu,"esm2017"),Kr("fire-js","")}Ry("");var Ku=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var ua,xm;(function(){var s;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(y,b){function E(){}E.prototype=b.prototype,y.D=b.prototype,y.prototype=new E,y.prototype.constructor=y,y.C=function(j,A,w){for(var g=Array(arguments.length-2),$=2;$<arguments.length;$++)g[$-2]=arguments[$];return b.prototype[A].apply(j,g)}}function r(){this.blockSize=-1}function a(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(a,r),a.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function n(y,b,E){E||(E=0);var j=Array(16);if(typeof b=="string")for(var A=0;16>A;++A)j[A]=b.charCodeAt(E++)|b.charCodeAt(E++)<<8|b.charCodeAt(E++)<<16|b.charCodeAt(E++)<<24;else for(A=0;16>A;++A)j[A]=b[E++]|b[E++]<<8|b[E++]<<16|b[E++]<<24;b=y.g[0],E=y.g[1],A=y.g[2];var w=y.g[3],g=b+(w^E&(A^w))+j[0]+3614090360&4294967295;b=E+(g<<7&4294967295|g>>>25),g=w+(A^b&(E^A))+j[1]+3905402710&4294967295,w=b+(g<<12&4294967295|g>>>20),g=A+(E^w&(b^E))+j[2]+606105819&4294967295,A=w+(g<<17&4294967295|g>>>15),g=E+(b^A&(w^b))+j[3]+3250441966&4294967295,E=A+(g<<22&4294967295|g>>>10),g=b+(w^E&(A^w))+j[4]+4118548399&4294967295,b=E+(g<<7&4294967295|g>>>25),g=w+(A^b&(E^A))+j[5]+1200080426&4294967295,w=b+(g<<12&4294967295|g>>>20),g=A+(E^w&(b^E))+j[6]+2821735955&4294967295,A=w+(g<<17&4294967295|g>>>15),g=E+(b^A&(w^b))+j[7]+4249261313&4294967295,E=A+(g<<22&4294967295|g>>>10),g=b+(w^E&(A^w))+j[8]+1770035416&4294967295,b=E+(g<<7&4294967295|g>>>25),g=w+(A^b&(E^A))+j[9]+2336552879&4294967295,w=b+(g<<12&4294967295|g>>>20),g=A+(E^w&(b^E))+j[10]+4294925233&4294967295,A=w+(g<<17&4294967295|g>>>15),g=E+(b^A&(w^b))+j[11]+2304563134&4294967295,E=A+(g<<22&4294967295|g>>>10),g=b+(w^E&(A^w))+j[12]+1804603682&4294967295,b=E+(g<<7&4294967295|g>>>25),g=w+(A^b&(E^A))+j[13]+4254626195&4294967295,w=b+(g<<12&4294967295|g>>>20),g=A+(E^w&(b^E))+j[14]+2792965006&4294967295,A=w+(g<<17&4294967295|g>>>15),g=E+(b^A&(w^b))+j[15]+1236535329&4294967295,E=A+(g<<22&4294967295|g>>>10),g=b+(A^w&(E^A))+j[1]+4129170786&4294967295,b=E+(g<<5&4294967295|g>>>27),g=w+(E^A&(b^E))+j[6]+3225465664&4294967295,w=b+(g<<9&4294967295|g>>>23),g=A+(b^E&(w^b))+j[11]+643717713&4294967295,A=w+(g<<14&4294967295|g>>>18),g=E+(w^b&(A^w))+j[0]+3921069994&4294967295,E=A+(g<<20&4294967295|g>>>12),g=b+(A^w&(E^A))+j[5]+3593408605&4294967295,b=E+(g<<5&4294967295|g>>>27),g=w+(E^A&(b^E))+j[10]+38016083&4294967295,w=b+(g<<9&4294967295|g>>>23),g=A+(b^E&(w^b))+j[15]+3634488961&4294967295,A=w+(g<<14&4294967295|g>>>18),g=E+(w^b&(A^w))+j[4]+3889429448&4294967295,E=A+(g<<20&4294967295|g>>>12),g=b+(A^w&(E^A))+j[9]+568446438&4294967295,b=E+(g<<5&4294967295|g>>>27),g=w+(E^A&(b^E))+j[14]+3275163606&4294967295,w=b+(g<<9&4294967295|g>>>23),g=A+(b^E&(w^b))+j[3]+4107603335&4294967295,A=w+(g<<14&4294967295|g>>>18),g=E+(w^b&(A^w))+j[8]+1163531501&4294967295,E=A+(g<<20&4294967295|g>>>12),g=b+(A^w&(E^A))+j[13]+2850285829&4294967295,b=E+(g<<5&4294967295|g>>>27),g=w+(E^A&(b^E))+j[2]+4243563512&4294967295,w=b+(g<<9&4294967295|g>>>23),g=A+(b^E&(w^b))+j[7]+1735328473&4294967295,A=w+(g<<14&4294967295|g>>>18),g=E+(w^b&(A^w))+j[12]+2368359562&4294967295,E=A+(g<<20&4294967295|g>>>12),g=b+(E^A^w)+j[5]+4294588738&4294967295,b=E+(g<<4&4294967295|g>>>28),g=w+(b^E^A)+j[8]+2272392833&4294967295,w=b+(g<<11&4294967295|g>>>21),g=A+(w^b^E)+j[11]+1839030562&4294967295,A=w+(g<<16&4294967295|g>>>16),g=E+(A^w^b)+j[14]+4259657740&4294967295,E=A+(g<<23&4294967295|g>>>9),g=b+(E^A^w)+j[1]+2763975236&4294967295,b=E+(g<<4&4294967295|g>>>28),g=w+(b^E^A)+j[4]+1272893353&4294967295,w=b+(g<<11&4294967295|g>>>21),g=A+(w^b^E)+j[7]+4139469664&4294967295,A=w+(g<<16&4294967295|g>>>16),g=E+(A^w^b)+j[10]+3200236656&4294967295,E=A+(g<<23&4294967295|g>>>9),g=b+(E^A^w)+j[13]+681279174&4294967295,b=E+(g<<4&4294967295|g>>>28),g=w+(b^E^A)+j[0]+3936430074&4294967295,w=b+(g<<11&4294967295|g>>>21),g=A+(w^b^E)+j[3]+3572445317&4294967295,A=w+(g<<16&4294967295|g>>>16),g=E+(A^w^b)+j[6]+76029189&4294967295,E=A+(g<<23&4294967295|g>>>9),g=b+(E^A^w)+j[9]+3654602809&4294967295,b=E+(g<<4&4294967295|g>>>28),g=w+(b^E^A)+j[12]+3873151461&4294967295,w=b+(g<<11&4294967295|g>>>21),g=A+(w^b^E)+j[15]+530742520&4294967295,A=w+(g<<16&4294967295|g>>>16),g=E+(A^w^b)+j[2]+3299628645&4294967295,E=A+(g<<23&4294967295|g>>>9),g=b+(A^(E|~w))+j[0]+4096336452&4294967295,b=E+(g<<6&4294967295|g>>>26),g=w+(E^(b|~A))+j[7]+1126891415&4294967295,w=b+(g<<10&4294967295|g>>>22),g=A+(b^(w|~E))+j[14]+2878612391&4294967295,A=w+(g<<15&4294967295|g>>>17),g=E+(w^(A|~b))+j[5]+4237533241&4294967295,E=A+(g<<21&4294967295|g>>>11),g=b+(A^(E|~w))+j[12]+1700485571&4294967295,b=E+(g<<6&4294967295|g>>>26),g=w+(E^(b|~A))+j[3]+2399980690&4294967295,w=b+(g<<10&4294967295|g>>>22),g=A+(b^(w|~E))+j[10]+4293915773&4294967295,A=w+(g<<15&4294967295|g>>>17),g=E+(w^(A|~b))+j[1]+2240044497&4294967295,E=A+(g<<21&4294967295|g>>>11),g=b+(A^(E|~w))+j[8]+1873313359&4294967295,b=E+(g<<6&4294967295|g>>>26),g=w+(E^(b|~A))+j[15]+4264355552&4294967295,w=b+(g<<10&4294967295|g>>>22),g=A+(b^(w|~E))+j[6]+2734768916&4294967295,A=w+(g<<15&4294967295|g>>>17),g=E+(w^(A|~b))+j[13]+1309151649&4294967295,E=A+(g<<21&4294967295|g>>>11),g=b+(A^(E|~w))+j[4]+4149444226&4294967295,b=E+(g<<6&4294967295|g>>>26),g=w+(E^(b|~A))+j[11]+3174756917&4294967295,w=b+(g<<10&4294967295|g>>>22),g=A+(b^(w|~E))+j[2]+718787259&4294967295,A=w+(g<<15&4294967295|g>>>17),g=E+(w^(A|~b))+j[9]+3951481745&4294967295,y.g[0]=y.g[0]+b&4294967295,y.g[1]=y.g[1]+(A+(g<<21&4294967295|g>>>11))&4294967295,y.g[2]=y.g[2]+A&4294967295,y.g[3]=y.g[3]+w&4294967295}a.prototype.u=function(y,b){b===void 0&&(b=y.length);for(var E=b-this.blockSize,j=this.B,A=this.h,w=0;w<b;){if(A==0)for(;w<=E;)n(this,y,w),w+=this.blockSize;if(typeof y=="string"){for(;w<b;)if(j[A++]=y.charCodeAt(w++),A==this.blockSize){n(this,j),A=0;break}}else for(;w<b;)if(j[A++]=y[w++],A==this.blockSize){n(this,j),A=0;break}}this.h=A,this.o+=b},a.prototype.v=function(){var y=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);y[0]=128;for(var b=1;b<y.length-8;++b)y[b]=0;var E=8*this.o;for(b=y.length-8;b<y.length;++b)y[b]=E&255,E/=256;for(this.u(y),y=Array(16),b=E=0;4>b;++b)for(var j=0;32>j;j+=8)y[E++]=this.g[b]>>>j&255;return y};function i(y,b){var E=c;return Object.prototype.hasOwnProperty.call(E,y)?E[y]:E[y]=b(y)}function o(y,b){this.h=b;for(var E=[],j=!0,A=y.length-1;0<=A;A--){var w=y[A]|0;j&&w==b||(E[A]=w,j=!1)}this.g=E}var c={};function d(y){return-128<=y&&128>y?i(y,function(b){return new o([b|0],0>b?-1:0)}):new o([y|0],0>y?-1:0)}function u(y){if(isNaN(y)||!isFinite(y))return f;if(0>y)return N(u(-y));for(var b=[],E=1,j=0;y>=E;j++)b[j]=y/E|0,E*=4294967296;return new o(b,0)}function m(y,b){if(y.length==0)throw Error("number format error: empty string");if(b=b||10,2>b||36<b)throw Error("radix out of range: "+b);if(y.charAt(0)=="-")return N(m(y.substring(1),b));if(0<=y.indexOf("-"))throw Error('number format error: interior "-" character');for(var E=u(Math.pow(b,8)),j=f,A=0;A<y.length;A+=8){var w=Math.min(8,y.length-A),g=parseInt(y.substring(A,A+w),b);8>w?(w=u(Math.pow(b,w)),j=j.j(w).add(u(g))):(j=j.j(E),j=j.add(u(g)))}return j}var f=d(0),x=d(1),v=d(16777216);s=o.prototype,s.m=function(){if(I(this))return-N(this).m();for(var y=0,b=1,E=0;E<this.g.length;E++){var j=this.i(E);y+=(0<=j?j:4294967296+j)*b,b*=4294967296}return y},s.toString=function(y){if(y=y||10,2>y||36<y)throw Error("radix out of range: "+y);if(T(this))return"0";if(I(this))return"-"+N(this).toString(y);for(var b=u(Math.pow(y,6)),E=this,j="";;){var A=M(E,b).g;E=O(E,A.j(b));var w=((0<E.g.length?E.g[0]:E.h)>>>0).toString(y);if(E=A,T(E))return w+j;for(;6>w.length;)w="0"+w;j=w+j}},s.i=function(y){return 0>y?0:y<this.g.length?this.g[y]:this.h};function T(y){if(y.h!=0)return!1;for(var b=0;b<y.g.length;b++)if(y.g[b]!=0)return!1;return!0}function I(y){return y.h==-1}s.l=function(y){return y=O(this,y),I(y)?-1:T(y)?0:1};function N(y){for(var b=y.g.length,E=[],j=0;j<b;j++)E[j]=~y.g[j];return new o(E,~y.h).add(x)}s.abs=function(){return I(this)?N(this):this},s.add=function(y){for(var b=Math.max(this.g.length,y.g.length),E=[],j=0,A=0;A<=b;A++){var w=j+(this.i(A)&65535)+(y.i(A)&65535),g=(w>>>16)+(this.i(A)>>>16)+(y.i(A)>>>16);j=g>>>16,w&=65535,g&=65535,E[A]=g<<16|w}return new o(E,E[E.length-1]&-2147483648?-1:0)};function O(y,b){return y.add(N(b))}s.j=function(y){if(T(this)||T(y))return f;if(I(this))return I(y)?N(this).j(N(y)):N(N(this).j(y));if(I(y))return N(this.j(N(y)));if(0>this.l(v)&&0>y.l(v))return u(this.m()*y.m());for(var b=this.g.length+y.g.length,E=[],j=0;j<2*b;j++)E[j]=0;for(j=0;j<this.g.length;j++)for(var A=0;A<y.g.length;A++){var w=this.i(j)>>>16,g=this.i(j)&65535,$=y.i(A)>>>16,L=y.i(A)&65535;E[2*j+2*A]+=g*L,D(E,2*j+2*A),E[2*j+2*A+1]+=w*L,D(E,2*j+2*A+1),E[2*j+2*A+1]+=g*$,D(E,2*j+2*A+1),E[2*j+2*A+2]+=w*$,D(E,2*j+2*A+2)}for(j=0;j<b;j++)E[j]=E[2*j+1]<<16|E[2*j];for(j=b;j<2*b;j++)E[j]=0;return new o(E,0)};function D(y,b){for(;(y[b]&65535)!=y[b];)y[b+1]+=y[b]>>>16,y[b]&=65535,b++}function C(y,b){this.g=y,this.h=b}function M(y,b){if(T(b))throw Error("division by zero");if(T(y))return new C(f,f);if(I(y))return b=M(N(y),b),new C(N(b.g),N(b.h));if(I(b))return b=M(y,N(b)),new C(N(b.g),b.h);if(30<y.g.length){if(I(y)||I(b))throw Error("slowDivide_ only works with positive integers.");for(var E=x,j=b;0>=j.l(y);)E=V(E),j=V(j);var A=U(E,1),w=U(j,1);for(j=U(j,2),E=U(E,2);!T(j);){var g=w.add(j);0>=g.l(y)&&(A=A.add(E),w=g),j=U(j,1),E=U(E,1)}return b=O(y,A.j(b)),new C(A,b)}for(A=f;0<=y.l(b);){for(E=Math.max(1,Math.floor(y.m()/b.m())),j=Math.ceil(Math.log(E)/Math.LN2),j=48>=j?1:Math.pow(2,j-48),w=u(E),g=w.j(b);I(g)||0<g.l(y);)E-=j,w=u(E),g=w.j(b);T(w)&&(w=x),A=A.add(w),y=O(y,g)}return new C(A,y)}s.A=function(y){return M(this,y).h},s.and=function(y){for(var b=Math.max(this.g.length,y.g.length),E=[],j=0;j<b;j++)E[j]=this.i(j)&y.i(j);return new o(E,this.h&y.h)},s.or=function(y){for(var b=Math.max(this.g.length,y.g.length),E=[],j=0;j<b;j++)E[j]=this.i(j)|y.i(j);return new o(E,this.h|y.h)},s.xor=function(y){for(var b=Math.max(this.g.length,y.g.length),E=[],j=0;j<b;j++)E[j]=this.i(j)^y.i(j);return new o(E,this.h^y.h)};function V(y){for(var b=y.g.length+1,E=[],j=0;j<b;j++)E[j]=y.i(j)<<1|y.i(j-1)>>>31;return new o(E,y.h)}function U(y,b){var E=b>>5;b%=32;for(var j=y.g.length-E,A=[],w=0;w<j;w++)A[w]=0<b?y.i(w+E)>>>b|y.i(w+E+1)<<32-b:y.i(w+E);return new o(A,y.h)}a.prototype.digest=a.prototype.v,a.prototype.reset=a.prototype.s,a.prototype.update=a.prototype.u,xm=a,o.prototype.add=o.prototype.add,o.prototype.multiply=o.prototype.j,o.prototype.modulo=o.prototype.A,o.prototype.compare=o.prototype.l,o.prototype.toNumber=o.prototype.m,o.prototype.toString=o.prototype.toString,o.prototype.getBits=o.prototype.i,o.fromNumber=u,o.fromString=m,ua=o}).apply(typeof Ku<"u"?Ku:typeof self<"u"?self:typeof window<"u"?window:{});var Ei=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var fm,Sn,bm,Oi,sc,ym,vm,wm;(function(){var s,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(l,h,p){return l==Array.prototype||l==Object.prototype||(l[h]=p.value),l};function r(l){l=[typeof globalThis=="object"&&globalThis,l,typeof window=="object"&&window,typeof self=="object"&&self,typeof Ei=="object"&&Ei];for(var h=0;h<l.length;++h){var p=l[h];if(p&&p.Math==Math)return p}throw Error("Cannot find global object")}var a=r(this);function n(l,h){if(h)e:{var p=a;l=l.split(".");for(var _=0;_<l.length-1;_++){var z=l[_];if(!(z in p))break e;p=p[z]}l=l[l.length-1],_=p[l],h=h(_),h!=_&&h!=null&&e(p,l,{configurable:!0,writable:!0,value:h})}}function i(l,h){l instanceof String&&(l+="");var p=0,_=!1,z={next:function(){if(!_&&p<l.length){var X=p++;return{value:h(X,l[X]),done:!1}}return _=!0,{done:!0,value:void 0}}};return z[Symbol.iterator]=function(){return z},z}n("Array.prototype.values",function(l){return l||function(){return i(this,function(h,p){return p})}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var o=o||{},c=this||self;function d(l){var h=typeof l;return h=h!="object"?h:l?Array.isArray(l)?"array":h:"null",h=="array"||h=="object"&&typeof l.length=="number"}function u(l){var h=typeof l;return h=="object"&&l!=null||h=="function"}function m(l,h,p){return l.call.apply(l.bind,arguments)}function f(l,h,p){if(!l)throw Error();if(2<arguments.length){var _=Array.prototype.slice.call(arguments,2);return function(){var z=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(z,_),l.apply(h,z)}}return function(){return l.apply(h,arguments)}}function x(l,h,p){return x=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?m:f,x.apply(null,arguments)}function v(l,h){var p=Array.prototype.slice.call(arguments,1);return function(){var _=p.slice();return _.push.apply(_,arguments),l.apply(this,_)}}function T(l,h){function p(){}p.prototype=h.prototype,l.aa=h.prototype,l.prototype=new p,l.prototype.constructor=l,l.Qb=function(_,z,X){for(var fe=Array(arguments.length-2),ct=2;ct<arguments.length;ct++)fe[ct-2]=arguments[ct];return h.prototype[z].apply(_,fe)}}function I(l){const h=l.length;if(0<h){const p=Array(h);for(let _=0;_<h;_++)p[_]=l[_];return p}return[]}function N(l,h){for(let p=1;p<arguments.length;p++){const _=arguments[p];if(d(_)){const z=l.length||0,X=_.length||0;l.length=z+X;for(let fe=0;fe<X;fe++)l[z+fe]=_[fe]}else l.push(_)}}class O{constructor(h,p){this.i=h,this.j=p,this.h=0,this.g=null}get(){let h;return 0<this.h?(this.h--,h=this.g,this.g=h.next,h.next=null):h=this.i(),h}}function D(l){return/^[\s\xa0]*$/.test(l)}function C(){var l=c.navigator;return l&&(l=l.userAgent)?l:""}function M(l){return M[" "](l),l}M[" "]=function(){};var V=C().indexOf("Gecko")!=-1&&!(C().toLowerCase().indexOf("webkit")!=-1&&C().indexOf("Edge")==-1)&&!(C().indexOf("Trident")!=-1||C().indexOf("MSIE")!=-1)&&C().indexOf("Edge")==-1;function U(l,h,p){for(const _ in l)h.call(p,l[_],_,l)}function y(l,h){for(const p in l)h.call(void 0,l[p],p,l)}function b(l){const h={};for(const p in l)h[p]=l[p];return h}const E="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function j(l,h){let p,_;for(let z=1;z<arguments.length;z++){_=arguments[z];for(p in _)l[p]=_[p];for(let X=0;X<E.length;X++)p=E[X],Object.prototype.hasOwnProperty.call(_,p)&&(l[p]=_[p])}}function A(l){var h=1;l=l.split(":");const p=[];for(;0<h&&l.length;)p.push(l.shift()),h--;return l.length&&p.push(l.join(":")),p}function w(l){c.setTimeout(()=>{throw l},0)}function g(){var l=q;let h=null;return l.g&&(h=l.g,l.g=l.g.next,l.g||(l.h=null),h.next=null),h}class ${constructor(){this.h=this.g=null}add(h,p){const _=L.get();_.set(h,p),this.h?this.h.next=_:this.g=_,this.h=_}}var L=new O(()=>new ee,l=>l.reset());class ee{constructor(){this.next=this.g=this.h=null}set(h,p){this.h=h,this.g=p,this.next=null}reset(){this.next=this.g=this.h=null}}let te,Y=!1,q=new $,R=()=>{const l=c.Promise.resolve(void 0);te=()=>{l.then(S)}};var S=()=>{for(var l;l=g();){try{l.h.call(l.g)}catch(p){w(p)}var h=L;h.j(l),100>h.h&&(h.h++,l.next=h.g,h.g=l)}Y=!1};function P(){this.s=this.s,this.C=this.C}P.prototype.s=!1,P.prototype.ma=function(){this.s||(this.s=!0,this.N())},P.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function W(l,h){this.type=l,this.g=this.target=h,this.defaultPrevented=!1}W.prototype.h=function(){this.defaultPrevented=!0};var K=function(){if(!c.addEventListener||!Object.defineProperty)return!1;var l=!1,h=Object.defineProperty({},"passive",{get:function(){l=!0}});try{const p=()=>{};c.addEventListener("test",p,h),c.removeEventListener("test",p,h)}catch{}return l}();function he(l,h){if(W.call(this,l?l.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,l){var p=this.type=l.type,_=l.changedTouches&&l.changedTouches.length?l.changedTouches[0]:null;if(this.target=l.target||l.srcElement,this.g=h,h=l.relatedTarget){if(V){e:{try{M(h.nodeName);var z=!0;break e}catch{}z=!1}z||(h=null)}}else p=="mouseover"?h=l.fromElement:p=="mouseout"&&(h=l.toElement);this.relatedTarget=h,_?(this.clientX=_.clientX!==void 0?_.clientX:_.pageX,this.clientY=_.clientY!==void 0?_.clientY:_.pageY,this.screenX=_.screenX||0,this.screenY=_.screenY||0):(this.clientX=l.clientX!==void 0?l.clientX:l.pageX,this.clientY=l.clientY!==void 0?l.clientY:l.pageY,this.screenX=l.screenX||0,this.screenY=l.screenY||0),this.button=l.button,this.key=l.key||"",this.ctrlKey=l.ctrlKey,this.altKey=l.altKey,this.shiftKey=l.shiftKey,this.metaKey=l.metaKey,this.pointerId=l.pointerId||0,this.pointerType=typeof l.pointerType=="string"?l.pointerType:H[l.pointerType]||"",this.state=l.state,this.i=l,l.defaultPrevented&&he.aa.h.call(this)}}T(he,W);var H={2:"touch",3:"pen",4:"mouse"};he.prototype.h=function(){he.aa.h.call(this);var l=this.i;l.preventDefault?l.preventDefault():l.returnValue=!1};var me="closure_listenable_"+(1e6*Math.random()|0),G=0;function se(l,h,p,_,z){this.listener=l,this.proxy=null,this.src=h,this.type=p,this.capture=!!_,this.ha=z,this.key=++G,this.da=this.fa=!1}function Z(l){l.da=!0,l.listener=null,l.proxy=null,l.src=null,l.ha=null}function ne(l){this.src=l,this.g={},this.h=0}ne.prototype.add=function(l,h,p,_,z){var X=l.toString();l=this.g[X],l||(l=this.g[X]=[],this.h++);var fe=Ce(l,h,_,z);return-1<fe?(h=l[fe],p||(h.fa=!1)):(h=new se(h,this.src,X,!!_,z),h.fa=p,l.push(h)),h};function ie(l,h){var p=h.type;if(p in l.g){var _=l.g[p],z=Array.prototype.indexOf.call(_,h,void 0),X;(X=0<=z)&&Array.prototype.splice.call(_,z,1),X&&(Z(h),l.g[p].length==0&&(delete l.g[p],l.h--))}}function Ce(l,h,p,_){for(var z=0;z<l.length;++z){var X=l[z];if(!X.da&&X.listener==h&&X.capture==!!p&&X.ha==_)return z}return-1}var je="closure_lm_"+(1e6*Math.random()|0),le={};function ue(l,h,p,_,z){if(Array.isArray(h)){for(var X=0;X<h.length;X++)ue(l,h[X],p,_,z);return null}return p=dt(p),l&&l[me]?l.K(h,p,u(_)?!!_.capture:!1,z):F(l,h,p,!1,_,z)}function F(l,h,p,_,z,X){if(!h)throw Error("Invalid event type");var fe=u(z)?!!z.capture:!!z,ct=$e(l);if(ct||(l[je]=ct=new ne(l)),p=ct.add(h,p,_,fe,X),p.proxy)return p;if(_=B(),p.proxy=_,_.src=l,_.listener=p,l.addEventListener)K||(z=fe),z===void 0&&(z=!1),l.addEventListener(h.toString(),_,z);else if(l.attachEvent)l.attachEvent(pe(h.toString()),_);else if(l.addListener&&l.removeListener)l.addListener(_);else throw Error("addEventListener and attachEvent are unavailable.");return p}function B(){function l(p){return h.call(l.src,l.listener,p)}const h=De;return l}function Ne(l,h,p,_,z){if(Array.isArray(h))for(var X=0;X<h.length;X++)Ne(l,h[X],p,_,z);else _=u(_)?!!_.capture:!!_,p=dt(p),l&&l[me]?(l=l.i,h=String(h).toString(),h in l.g&&(X=l.g[h],p=Ce(X,p,_,z),-1<p&&(Z(X[p]),Array.prototype.splice.call(X,p,1),X.length==0&&(delete l.g[h],l.h--)))):l&&(l=$e(l))&&(h=l.g[h.toString()],l=-1,h&&(l=Ce(h,p,_,z)),(p=-1<l?h[l]:null)&&Te(p))}function Te(l){if(typeof l!="number"&&l&&!l.da){var h=l.src;if(h&&h[me])ie(h.i,l);else{var p=l.type,_=l.proxy;h.removeEventListener?h.removeEventListener(p,_,l.capture):h.detachEvent?h.detachEvent(pe(p),_):h.addListener&&h.removeListener&&h.removeListener(_),(p=$e(h))?(ie(p,l),p.h==0&&(p.src=null,h[je]=null)):Z(l)}}}function pe(l){return l in le?le[l]:le[l]="on"+l}function De(l,h){if(l.da)l=!0;else{h=new he(h,this);var p=l.listener,_=l.ha||l.src;l.fa&&Te(l),l=p.call(_,h)}return l}function $e(l){return l=l[je],l instanceof ne?l:null}var nt="__closure_events_fn_"+(1e9*Math.random()>>>0);function dt(l){return typeof l=="function"?l:(l[nt]||(l[nt]=function(h){return l.handleEvent(h)}),l[nt])}function ge(){P.call(this),this.i=new ne(this),this.M=this,this.F=null}T(ge,P),ge.prototype[me]=!0,ge.prototype.removeEventListener=function(l,h,p,_){Ne(this,l,h,p,_)};function be(l,h){var p,_=l.F;if(_)for(p=[];_;_=_.F)p.push(_);if(l=l.M,_=h.type||h,typeof h=="string")h=new W(h,l);else if(h instanceof W)h.target=h.target||l;else{var z=h;h=new W(_,l),j(h,z)}if(z=!0,p)for(var X=p.length-1;0<=X;X--){var fe=h.g=p[X];z=qe(fe,_,!0,h)&&z}if(fe=h.g=l,z=qe(fe,_,!0,h)&&z,z=qe(fe,_,!1,h)&&z,p)for(X=0;X<p.length;X++)fe=h.g=p[X],z=qe(fe,_,!1,h)&&z}ge.prototype.N=function(){if(ge.aa.N.call(this),this.i){var l=this.i,h;for(h in l.g){for(var p=l.g[h],_=0;_<p.length;_++)Z(p[_]);delete l.g[h],l.h--}}this.F=null},ge.prototype.K=function(l,h,p,_){return this.i.add(String(l),h,!1,p,_)},ge.prototype.L=function(l,h,p,_){return this.i.add(String(l),h,!0,p,_)};function qe(l,h,p,_){if(h=l.i.g[String(h)],!h)return!0;h=h.concat();for(var z=!0,X=0;X<h.length;++X){var fe=h[X];if(fe&&!fe.da&&fe.capture==p){var ct=fe.listener,Bt=fe.ha||fe.src;fe.fa&&ie(l.i,fe),z=ct.call(Bt,_)!==!1&&z}}return z&&!_.defaultPrevented}function bt(l,h,p){if(typeof l=="function")p&&(l=x(l,p));else if(l&&typeof l.handleEvent=="function")l=x(l.handleEvent,l);else throw Error("Invalid listener argument");return 2147483647<Number(h)?-1:c.setTimeout(l,h||0)}function re(l){l.g=bt(()=>{l.g=null,l.i&&(l.i=!1,re(l))},l.l);const h=l.h;l.h=null,l.m.apply(null,h)}class Ee extends P{constructor(h,p){super(),this.m=h,this.l=p,this.h=null,this.i=!1,this.g=null}j(h){this.h=arguments,this.g?this.i=!0:re(this)}N(){super.N(),this.g&&(c.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Se(l){P.call(this),this.h=l,this.g={}}T(Se,P);var Pe=[];function Ct(l){U(l.g,function(h,p){this.g.hasOwnProperty(p)&&Te(h)},l),l.g={}}Se.prototype.N=function(){Se.aa.N.call(this),Ct(this)},Se.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var vr=c.JSON.stringify,$r=c.JSON.parse,cr=class{stringify(l){return c.JSON.stringify(l,void 0)}parse(l){return c.JSON.parse(l,void 0)}};function Ut(){}Ut.prototype.h=null;function Es(l){return l.h||(l.h=l.i())}function Er(){}var Tr={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function Fr(){W.call(this,"d")}T(Fr,W);function Ur(){W.call(this,"c")}T(Ur,W);var Sr={},Br=null;function Me(){return Br=Br||new ge}Sr.La="serverreachability";function Q(l){W.call(this,Sr.La,l)}T(Q,W);function ce(l){const h=Me();be(h,new Q(h))}Sr.STAT_EVENT="statevent";function ve(l,h){W.call(this,Sr.STAT_EVENT,l),this.stat=h}T(ve,W);function Ie(l){const h=Me();be(h,new ve(h,l))}Sr.Ma="timingevent";function Le(l,h){W.call(this,Sr.Ma,l),this.size=h}T(Le,W);function ze(l,h){if(typeof l!="function")throw Error("Fn must not be null and must be a function");return c.setTimeout(function(){l()},h)}function Qe(){this.g=!0}Qe.prototype.xa=function(){this.g=!1};function Be(l,h,p,_,z,X){l.info(function(){if(l.g)if(X)for(var fe="",ct=X.split("&"),Bt=0;Bt<ct.length;Bt++){var Je=ct[Bt].split("=");if(1<Je.length){var Yt=Je[0];Je=Je[1];var Xt=Yt.split("_");fe=2<=Xt.length&&Xt[1]=="type"?fe+(Yt+"="+Je+"&"):fe+(Yt+"=redacted&")}}else fe=null;else fe=X;return"XMLHTTP REQ ("+_+") [attempt "+z+"]: "+h+`
`+p+`
`+fe})}function We(l,h,p,_,z,X,fe){l.info(function(){return"XMLHTTP RESP ("+_+") [ attempt "+z+"]: "+h+`
`+p+`
`+X+" "+fe})}function rt(l,h,p,_){l.info(function(){return"XMLHTTP TEXT ("+h+"): "+Nt(l,p)+(_?" "+_:"")})}function ut(l,h){l.info(function(){return"TIMEOUT: "+h})}Qe.prototype.info=function(){};function Nt(l,h){if(!l.g)return h;if(!h)return null;try{var p=JSON.parse(h);if(p){for(l=0;l<p.length;l++)if(Array.isArray(p[l])){var _=p[l];if(!(2>_.length)){var z=_[1];if(Array.isArray(z)&&!(1>z.length)){var X=z[0];if(X!="noop"&&X!="stop"&&X!="close")for(var fe=1;fe<z.length;fe++)z[fe]=""}}}}return vr(p)}catch{return h}}var lt={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},ht={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},Dt;function xe(){}T(xe,Ut),xe.prototype.g=function(){return new XMLHttpRequest},xe.prototype.i=function(){return{}},Dt=new xe;function ye(l,h,p,_){this.j=l,this.i=h,this.l=p,this.R=_||1,this.U=new Se(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new Pt}function Pt(){this.i=null,this.g="",this.h=!1}var Hd={},ol={};function ll(l,h,p){l.L=1,l.v=fi(is(h)),l.m=p,l.P=!0,Gd(l,null)}function Gd(l,h){l.F=Date.now(),gi(l),l.A=is(l.v);var p=l.A,_=l.R;Array.isArray(_)||(_=[String(_)]),ou(p.i,"t",_),l.C=0,p=l.j.J,l.h=new Pt,l.g=_u(l.j,p?h:null,!l.m),0<l.O&&(l.M=new Ee(x(l.Y,l,l.g),l.O)),h=l.U,p=l.g,_=l.ca;var z="readystatechange";Array.isArray(z)||(z&&(Pe[0]=z.toString()),z=Pe);for(var X=0;X<z.length;X++){var fe=ue(p,z[X],_||h.handleEvent,!1,h.h||h);if(!fe)break;h.g[fe.key]=fe}h=l.H?b(l.H):{},l.m?(l.u||(l.u="POST"),h["Content-Type"]="application/x-www-form-urlencoded",l.g.ea(l.A,l.u,l.m,h)):(l.u="GET",l.g.ea(l.A,l.u,null,h)),ce(),Be(l.i,l.u,l.A,l.l,l.R,l.m)}ye.prototype.ca=function(l){l=l.target;const h=this.M;h&&os(l)==3?h.j():this.Y(l)},ye.prototype.Y=function(l){try{if(l==this.g)e:{const Xt=os(this.g);var h=this.g.Ba();const Sa=this.g.Z();if(!(3>Xt)&&(Xt!=3||this.g&&(this.h.h||this.g.oa()||gu(this.g)))){this.J||Xt!=4||h==7||(h==8||0>=Sa?ce(3):ce(2)),cl(this);var p=this.g.Z();this.X=p;t:if(Kd(this)){var _=gu(this.g);l="";var z=_.length,X=os(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){ta(this),gn(this);var fe="";break t}this.h.i=new c.TextDecoder}for(h=0;h<z;h++)this.h.h=!0,l+=this.h.i.decode(_[h],{stream:!(X&&h==z-1)});_.length=0,this.h.g+=l,this.C=0,fe=this.h.g}else fe=this.g.oa();if(this.o=p==200,We(this.i,this.u,this.A,this.l,this.R,Xt,p),this.o){if(this.T&&!this.K){t:{if(this.g){var ct,Bt=this.g;if((ct=Bt.g?Bt.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!D(ct)){var Je=ct;break t}}Je=null}if(p=Je)rt(this.i,this.l,p,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,dl(this,p);else{this.o=!1,this.s=3,Ie(12),ta(this),gn(this);break e}}if(this.P){p=!0;let Rr;for(;!this.J&&this.C<fe.length;)if(Rr=Zp(this,fe),Rr==ol){Xt==4&&(this.s=4,Ie(14),p=!1),rt(this.i,this.l,null,"[Incomplete Response]");break}else if(Rr==Hd){this.s=4,Ie(15),rt(this.i,this.l,fe,"[Invalid Chunk]"),p=!1;break}else rt(this.i,this.l,Rr,null),dl(this,Rr);if(Kd(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),Xt!=4||fe.length!=0||this.h.h||(this.s=1,Ie(16),p=!1),this.o=this.o&&p,!p)rt(this.i,this.l,fe,"[Invalid Chunked Response]"),ta(this),gn(this);else if(0<fe.length&&!this.W){this.W=!0;var Yt=this.j;Yt.g==this&&Yt.ba&&!Yt.M&&(Yt.j.info("Great, no buffering proxy detected. Bytes received: "+fe.length),xl(Yt),Yt.M=!0,Ie(11))}}else rt(this.i,this.l,fe,null),dl(this,fe);Xt==4&&ta(this),this.o&&!this.J&&(Xt==4?wu(this.j,this):(this.o=!1,gi(this)))}else xx(this.g),p==400&&0<fe.indexOf("Unknown SID")?(this.s=3,Ie(12)):(this.s=0,Ie(13)),ta(this),gn(this)}}}catch{}finally{}};function Kd(l){return l.g?l.u=="GET"&&l.L!=2&&l.j.Ca:!1}function Zp(l,h){var p=l.C,_=h.indexOf(`
`,p);return _==-1?ol:(p=Number(h.substring(p,_)),isNaN(p)?Hd:(_+=1,_+p>h.length?ol:(h=h.slice(_,_+p),l.C=_+p,h)))}ye.prototype.cancel=function(){this.J=!0,ta(this)};function gi(l){l.S=Date.now()+l.I,Qd(l,l.I)}function Qd(l,h){if(l.B!=null)throw Error("WatchDog timer not null");l.B=ze(x(l.ba,l),h)}function cl(l){l.B&&(c.clearTimeout(l.B),l.B=null)}ye.prototype.ba=function(){this.B=null;const l=Date.now();0<=l-this.S?(ut(this.i,this.A),this.L!=2&&(ce(),Ie(17)),ta(this),this.s=2,gn(this)):Qd(this,this.S-l)};function gn(l){l.j.G==0||l.J||wu(l.j,l)}function ta(l){cl(l);var h=l.M;h&&typeof h.ma=="function"&&h.ma(),l.M=null,Ct(l.U),l.g&&(h=l.g,l.g=null,h.abort(),h.ma())}function dl(l,h){try{var p=l.j;if(p.G!=0&&(p.g==l||ul(p.h,l))){if(!l.K&&ul(p.h,l)&&p.G==3){try{var _=p.Da.g.parse(h)}catch{_=null}if(Array.isArray(_)&&_.length==3){var z=_;if(z[0]==0){e:if(!p.u){if(p.g)if(p.g.F+3e3<l.F)ji(p),wi(p);else break e;pl(p),Ie(18)}}else p.za=z[1],0<p.za-p.T&&37500>z[2]&&p.F&&p.v==0&&!p.C&&(p.C=ze(x(p.Za,p),6e3));if(1>=Jd(p.h)&&p.ca){try{p.ca()}catch{}p.ca=void 0}}else sa(p,11)}else if((l.K||p.g==l)&&ji(p),!D(h))for(z=p.Da.g.parse(h),h=0;h<z.length;h++){let Je=z[h];if(p.T=Je[0],Je=Je[1],p.G==2)if(Je[0]=="c"){p.K=Je[1],p.ia=Je[2];const Yt=Je[3];Yt!=null&&(p.la=Yt,p.j.info("VER="+p.la));const Xt=Je[4];Xt!=null&&(p.Aa=Xt,p.j.info("SVER="+p.Aa));const Sa=Je[5];Sa!=null&&typeof Sa=="number"&&0<Sa&&(_=1.5*Sa,p.L=_,p.j.info("backChannelRequestTimeoutMs_="+_)),_=p;const Rr=l.g;if(Rr){const _i=Rr.g?Rr.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(_i){var X=_.h;X.g||_i.indexOf("spdy")==-1&&_i.indexOf("quic")==-1&&_i.indexOf("h2")==-1||(X.j=X.l,X.g=new Set,X.h&&(hl(X,X.h),X.h=null))}if(_.D){const fl=Rr.g?Rr.g.getResponseHeader("X-HTTP-Session-Id"):null;fl&&(_.ya=fl,mt(_.I,_.D,fl))}}p.G=3,p.l&&p.l.ua(),p.ba&&(p.R=Date.now()-l.F,p.j.info("Handshake RTT: "+p.R+"ms")),_=p;var fe=l;if(_.qa=Nu(_,_.J?_.ia:null,_.W),fe.K){Zd(_.h,fe);var ct=fe,Bt=_.L;Bt&&(ct.I=Bt),ct.B&&(cl(ct),gi(ct)),_.g=fe}else yu(_);0<p.i.length&&ki(p)}else Je[0]!="stop"&&Je[0]!="close"||sa(p,7);else p.G==3&&(Je[0]=="stop"||Je[0]=="close"?Je[0]=="stop"?sa(p,7):gl(p):Je[0]!="noop"&&p.l&&p.l.ta(Je),p.v=0)}}ce(4)}catch{}}var ex=class{constructor(l,h){this.g=l,this.map=h}};function Yd(l){this.l=l||10,c.PerformanceNavigationTiming?(l=c.performance.getEntriesByType("navigation"),l=0<l.length&&(l[0].nextHopProtocol=="hq"||l[0].nextHopProtocol=="h2")):l=!!(c.chrome&&c.chrome.loadTimes&&c.chrome.loadTimes()&&c.chrome.loadTimes().wasFetchedViaSpdy),this.j=l?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function Xd(l){return l.h?!0:l.g?l.g.size>=l.j:!1}function Jd(l){return l.h?1:l.g?l.g.size:0}function ul(l,h){return l.h?l.h==h:l.g?l.g.has(h):!1}function hl(l,h){l.g?l.g.add(h):l.h=h}function Zd(l,h){l.h&&l.h==h?l.h=null:l.g&&l.g.has(h)&&l.g.delete(h)}Yd.prototype.cancel=function(){if(this.i=eu(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const l of this.g.values())l.cancel();this.g.clear()}};function eu(l){if(l.h!=null)return l.i.concat(l.h.D);if(l.g!=null&&l.g.size!==0){let h=l.i;for(const p of l.g.values())h=h.concat(p.D);return h}return I(l.i)}function tx(l){if(l.V&&typeof l.V=="function")return l.V();if(typeof Map<"u"&&l instanceof Map||typeof Set<"u"&&l instanceof Set)return Array.from(l.values());if(typeof l=="string")return l.split("");if(d(l)){for(var h=[],p=l.length,_=0;_<p;_++)h.push(l[_]);return h}h=[],p=0;for(_ in l)h[p++]=l[_];return h}function rx(l){if(l.na&&typeof l.na=="function")return l.na();if(!l.V||typeof l.V!="function"){if(typeof Map<"u"&&l instanceof Map)return Array.from(l.keys());if(!(typeof Set<"u"&&l instanceof Set)){if(d(l)||typeof l=="string"){var h=[];l=l.length;for(var p=0;p<l;p++)h.push(p);return h}h=[],p=0;for(const _ in l)h[p++]=_;return h}}}function tu(l,h){if(l.forEach&&typeof l.forEach=="function")l.forEach(h,void 0);else if(d(l)||typeof l=="string")Array.prototype.forEach.call(l,h,void 0);else for(var p=rx(l),_=tx(l),z=_.length,X=0;X<z;X++)h.call(void 0,_[X],p&&p[X],l)}var ru=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function sx(l,h){if(l){l=l.split("&");for(var p=0;p<l.length;p++){var _=l[p].indexOf("="),z=null;if(0<=_){var X=l[p].substring(0,_);z=l[p].substring(_+1)}else X=l[p];h(X,z?decodeURIComponent(z.replace(/\+/g," ")):"")}}}function ra(l){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,l instanceof ra){this.h=l.h,pi(this,l.j),this.o=l.o,this.g=l.g,xi(this,l.s),this.l=l.l;var h=l.i,p=new fn;p.i=h.i,h.g&&(p.g=new Map(h.g),p.h=h.h),su(this,p),this.m=l.m}else l&&(h=String(l).match(ru))?(this.h=!1,pi(this,h[1]||"",!0),this.o=pn(h[2]||""),this.g=pn(h[3]||"",!0),xi(this,h[4]),this.l=pn(h[5]||"",!0),su(this,h[6]||"",!0),this.m=pn(h[7]||"")):(this.h=!1,this.i=new fn(null,this.h))}ra.prototype.toString=function(){var l=[],h=this.j;h&&l.push(xn(h,au,!0),":");var p=this.g;return(p||h=="file")&&(l.push("//"),(h=this.o)&&l.push(xn(h,au,!0),"@"),l.push(encodeURIComponent(String(p)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),p=this.s,p!=null&&l.push(":",String(p))),(p=this.l)&&(this.g&&p.charAt(0)!="/"&&l.push("/"),l.push(xn(p,p.charAt(0)=="/"?ix:nx,!0))),(p=this.i.toString())&&l.push("?",p),(p=this.m)&&l.push("#",xn(p,lx)),l.join("")};function is(l){return new ra(l)}function pi(l,h,p){l.j=p?pn(h,!0):h,l.j&&(l.j=l.j.replace(/:$/,""))}function xi(l,h){if(h){if(h=Number(h),isNaN(h)||0>h)throw Error("Bad port number "+h);l.s=h}else l.s=null}function su(l,h,p){h instanceof fn?(l.i=h,cx(l.i,l.h)):(p||(h=xn(h,ox)),l.i=new fn(h,l.h))}function mt(l,h,p){l.i.set(h,p)}function fi(l){return mt(l,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),l}function pn(l,h){return l?h?decodeURI(l.replace(/%25/g,"%2525")):decodeURIComponent(l):""}function xn(l,h,p){return typeof l=="string"?(l=encodeURI(l).replace(h,ax),p&&(l=l.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),l):null}function ax(l){return l=l.charCodeAt(0),"%"+(l>>4&15).toString(16)+(l&15).toString(16)}var au=/[#\/\?@]/g,nx=/[#\?:]/g,ix=/[#\?]/g,ox=/[#\?@]/g,lx=/#/g;function fn(l,h){this.h=this.g=null,this.i=l||null,this.j=!!h}function Ts(l){l.g||(l.g=new Map,l.h=0,l.i&&sx(l.i,function(h,p){l.add(decodeURIComponent(h.replace(/\+/g," ")),p)}))}s=fn.prototype,s.add=function(l,h){Ts(this),this.i=null,l=Ea(this,l);var p=this.g.get(l);return p||this.g.set(l,p=[]),p.push(h),this.h+=1,this};function nu(l,h){Ts(l),h=Ea(l,h),l.g.has(h)&&(l.i=null,l.h-=l.g.get(h).length,l.g.delete(h))}function iu(l,h){return Ts(l),h=Ea(l,h),l.g.has(h)}s.forEach=function(l,h){Ts(this),this.g.forEach(function(p,_){p.forEach(function(z){l.call(h,z,_,this)},this)},this)},s.na=function(){Ts(this);const l=Array.from(this.g.values()),h=Array.from(this.g.keys()),p=[];for(let _=0;_<h.length;_++){const z=l[_];for(let X=0;X<z.length;X++)p.push(h[_])}return p},s.V=function(l){Ts(this);let h=[];if(typeof l=="string")iu(this,l)&&(h=h.concat(this.g.get(Ea(this,l))));else{l=Array.from(this.g.values());for(let p=0;p<l.length;p++)h=h.concat(l[p])}return h},s.set=function(l,h){return Ts(this),this.i=null,l=Ea(this,l),iu(this,l)&&(this.h-=this.g.get(l).length),this.g.set(l,[h]),this.h+=1,this},s.get=function(l,h){return l?(l=this.V(l),0<l.length?String(l[0]):h):h};function ou(l,h,p){nu(l,h),0<p.length&&(l.i=null,l.g.set(Ea(l,h),I(p)),l.h+=p.length)}s.toString=function(){if(this.i)return this.i;if(!this.g)return"";const l=[],h=Array.from(this.g.keys());for(var p=0;p<h.length;p++){var _=h[p];const X=encodeURIComponent(String(_)),fe=this.V(_);for(_=0;_<fe.length;_++){var z=X;fe[_]!==""&&(z+="="+encodeURIComponent(String(fe[_]))),l.push(z)}}return this.i=l.join("&")};function Ea(l,h){return h=String(h),l.j&&(h=h.toLowerCase()),h}function cx(l,h){h&&!l.j&&(Ts(l),l.i=null,l.g.forEach(function(p,_){var z=_.toLowerCase();_!=z&&(nu(this,_),ou(this,z,p))},l)),l.j=h}function dx(l,h){const p=new Qe;if(c.Image){const _=new Image;_.onload=v(Ss,p,"TestLoadImage: loaded",!0,h,_),_.onerror=v(Ss,p,"TestLoadImage: error",!1,h,_),_.onabort=v(Ss,p,"TestLoadImage: abort",!1,h,_),_.ontimeout=v(Ss,p,"TestLoadImage: timeout",!1,h,_),c.setTimeout(function(){_.ontimeout&&_.ontimeout()},1e4),_.src=l}else h(!1)}function ux(l,h){const p=new Qe,_=new AbortController,z=setTimeout(()=>{_.abort(),Ss(p,"TestPingServer: timeout",!1,h)},1e4);fetch(l,{signal:_.signal}).then(X=>{clearTimeout(z),X.ok?Ss(p,"TestPingServer: ok",!0,h):Ss(p,"TestPingServer: server error",!1,h)}).catch(()=>{clearTimeout(z),Ss(p,"TestPingServer: error",!1,h)})}function Ss(l,h,p,_,z){try{z&&(z.onload=null,z.onerror=null,z.onabort=null,z.ontimeout=null),_(p)}catch{}}function hx(){this.g=new cr}function mx(l,h,p){const _=p||"";try{tu(l,function(z,X){let fe=z;u(z)&&(fe=vr(z)),h.push(_+X+"="+encodeURIComponent(fe))})}catch(z){throw h.push(_+"type="+encodeURIComponent("_badmap")),z}}function bi(l){this.l=l.Ub||null,this.j=l.eb||!1}T(bi,Ut),bi.prototype.g=function(){return new yi(this.l,this.j)},bi.prototype.i=function(l){return function(){return l}}({});function yi(l,h){ge.call(this),this.D=l,this.o=h,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}T(yi,ge),s=yi.prototype,s.open=function(l,h){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=l,this.A=h,this.readyState=1,yn(this)},s.send=function(l){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const h={headers:this.u,method:this.B,credentials:this.m,cache:void 0};l&&(h.body=l),(this.D||c).fetch(new Request(this.A,h)).then(this.Sa.bind(this),this.ga.bind(this))},s.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,bn(this)),this.readyState=0},s.Sa=function(l){if(this.g&&(this.l=l,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=l.headers,this.readyState=2,yn(this)),this.g&&(this.readyState=3,yn(this),this.g)))if(this.responseType==="arraybuffer")l.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof c.ReadableStream<"u"&&"body"in l){if(this.j=l.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;lu(this)}else l.text().then(this.Ra.bind(this),this.ga.bind(this))};function lu(l){l.j.read().then(l.Pa.bind(l)).catch(l.ga.bind(l))}s.Pa=function(l){if(this.g){if(this.o&&l.value)this.response.push(l.value);else if(!this.o){var h=l.value?l.value:new Uint8Array(0);(h=this.v.decode(h,{stream:!l.done}))&&(this.response=this.responseText+=h)}l.done?bn(this):yn(this),this.readyState==3&&lu(this)}},s.Ra=function(l){this.g&&(this.response=this.responseText=l,bn(this))},s.Qa=function(l){this.g&&(this.response=l,bn(this))},s.ga=function(){this.g&&bn(this)};function bn(l){l.readyState=4,l.l=null,l.j=null,l.v=null,yn(l)}s.setRequestHeader=function(l,h){this.u.append(l,h)},s.getResponseHeader=function(l){return this.h&&this.h.get(l.toLowerCase())||""},s.getAllResponseHeaders=function(){if(!this.h)return"";const l=[],h=this.h.entries();for(var p=h.next();!p.done;)p=p.value,l.push(p[0]+": "+p[1]),p=h.next();return l.join(`\r
`)};function yn(l){l.onreadystatechange&&l.onreadystatechange.call(l)}Object.defineProperty(yi.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(l){this.m=l?"include":"same-origin"}});function cu(l){let h="";return U(l,function(p,_){h+=_,h+=":",h+=p,h+=`\r
`}),h}function ml(l,h,p){e:{for(_ in p){var _=!1;break e}_=!0}_||(p=cu(p),typeof l=="string"?p!=null&&encodeURIComponent(String(p)):mt(l,h,p))}function wt(l){ge.call(this),this.headers=new Map,this.o=l||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}T(wt,ge);var gx=/^https?$/i,px=["POST","PUT"];s=wt.prototype,s.Ha=function(l){this.J=l},s.ea=function(l,h,p,_){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+l);h=h?h.toUpperCase():"GET",this.D=l,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():Dt.g(),this.v=this.o?Es(this.o):Es(Dt),this.g.onreadystatechange=x(this.Ea,this);try{this.B=!0,this.g.open(h,String(l),!0),this.B=!1}catch(X){du(this,X);return}if(l=p||"",p=new Map(this.headers),_)if(Object.getPrototypeOf(_)===Object.prototype)for(var z in _)p.set(z,_[z]);else if(typeof _.keys=="function"&&typeof _.get=="function")for(const X of _.keys())p.set(X,_.get(X));else throw Error("Unknown input type for opt_headers: "+String(_));_=Array.from(p.keys()).find(X=>X.toLowerCase()=="content-type"),z=c.FormData&&l instanceof c.FormData,!(0<=Array.prototype.indexOf.call(px,h,void 0))||_||z||p.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[X,fe]of p)this.g.setRequestHeader(X,fe);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{mu(this),this.u=!0,this.g.send(l),this.u=!1}catch(X){du(this,X)}};function du(l,h){l.h=!1,l.g&&(l.j=!0,l.g.abort(),l.j=!1),l.l=h,l.m=5,uu(l),vi(l)}function uu(l){l.A||(l.A=!0,be(l,"complete"),be(l,"error"))}s.abort=function(l){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=l||7,be(this,"complete"),be(this,"abort"),vi(this))},s.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),vi(this,!0)),wt.aa.N.call(this)},s.Ea=function(){this.s||(this.B||this.u||this.j?hu(this):this.bb())},s.bb=function(){hu(this)};function hu(l){if(l.h&&typeof o<"u"&&(!l.v[1]||os(l)!=4||l.Z()!=2)){if(l.u&&os(l)==4)bt(l.Ea,0,l);else if(be(l,"readystatechange"),os(l)==4){l.h=!1;try{const fe=l.Z();e:switch(fe){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var h=!0;break e;default:h=!1}var p;if(!(p=h)){var _;if(_=fe===0){var z=String(l.D).match(ru)[1]||null;!z&&c.self&&c.self.location&&(z=c.self.location.protocol.slice(0,-1)),_=!gx.test(z?z.toLowerCase():"")}p=_}if(p)be(l,"complete"),be(l,"success");else{l.m=6;try{var X=2<os(l)?l.g.statusText:""}catch{X=""}l.l=X+" ["+l.Z()+"]",uu(l)}}finally{vi(l)}}}}function vi(l,h){if(l.g){mu(l);const p=l.g,_=l.v[0]?()=>{}:null;l.g=null,l.v=null,h||be(l,"ready");try{p.onreadystatechange=_}catch{}}}function mu(l){l.I&&(c.clearTimeout(l.I),l.I=null)}s.isActive=function(){return!!this.g};function os(l){return l.g?l.g.readyState:0}s.Z=function(){try{return 2<os(this)?this.g.status:-1}catch{return-1}},s.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},s.Oa=function(l){if(this.g){var h=this.g.responseText;return l&&h.indexOf(l)==0&&(h=h.substring(l.length)),$r(h)}};function gu(l){try{if(!l.g)return null;if("response"in l.g)return l.g.response;switch(l.H){case"":case"text":return l.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in l.g)return l.g.mozResponseArrayBuffer}return null}catch{return null}}function xx(l){const h={};l=(l.g&&2<=os(l)&&l.g.getAllResponseHeaders()||"").split(`\r
`);for(let _=0;_<l.length;_++){if(D(l[_]))continue;var p=A(l[_]);const z=p[0];if(p=p[1],typeof p!="string")continue;p=p.trim();const X=h[z]||[];h[z]=X,X.push(p)}y(h,function(_){return _.join(", ")})}s.Ba=function(){return this.m},s.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function vn(l,h,p){return p&&p.internalChannelParams&&p.internalChannelParams[l]||h}function pu(l){this.Aa=0,this.i=[],this.j=new Qe,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=vn("failFast",!1,l),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=vn("baseRetryDelayMs",5e3,l),this.cb=vn("retryDelaySeedMs",1e4,l),this.Wa=vn("forwardChannelMaxRetries",2,l),this.wa=vn("forwardChannelRequestTimeoutMs",2e4,l),this.pa=l&&l.xmlHttpFactory||void 0,this.Xa=l&&l.Tb||void 0,this.Ca=l&&l.useFetchStreams||!1,this.L=void 0,this.J=l&&l.supportsCrossDomainXhr||!1,this.K="",this.h=new Yd(l&&l.concurrentRequestLimit),this.Da=new hx,this.P=l&&l.fastHandshake||!1,this.O=l&&l.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=l&&l.Rb||!1,l&&l.xa&&this.j.xa(),l&&l.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&l&&l.detectBufferingProxy||!1,this.ja=void 0,l&&l.longPollingTimeout&&0<l.longPollingTimeout&&(this.ja=l.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}s=pu.prototype,s.la=8,s.G=1,s.connect=function(l,h,p,_){Ie(0),this.W=l,this.H=h||{},p&&_!==void 0&&(this.H.OSID=p,this.H.OAID=_),this.F=this.X,this.I=Nu(this,null,this.W),ki(this)};function gl(l){if(xu(l),l.G==3){var h=l.U++,p=is(l.I);if(mt(p,"SID",l.K),mt(p,"RID",h),mt(p,"TYPE","terminate"),wn(l,p),h=new ye(l,l.j,h),h.L=2,h.v=fi(is(p)),p=!1,c.navigator&&c.navigator.sendBeacon)try{p=c.navigator.sendBeacon(h.v.toString(),"")}catch{}!p&&c.Image&&(new Image().src=h.v,p=!0),p||(h.g=_u(h.j,null),h.g.ea(h.v)),h.F=Date.now(),gi(h)}ju(l)}function wi(l){l.g&&(xl(l),l.g.cancel(),l.g=null)}function xu(l){wi(l),l.u&&(c.clearTimeout(l.u),l.u=null),ji(l),l.h.cancel(),l.s&&(typeof l.s=="number"&&c.clearTimeout(l.s),l.s=null)}function ki(l){if(!Xd(l.h)&&!l.s){l.s=!0;var h=l.Ga;te||R(),Y||(te(),Y=!0),q.add(h,l),l.B=0}}function fx(l,h){return Jd(l.h)>=l.h.j-(l.s?1:0)?!1:l.s?(l.i=h.D.concat(l.i),!0):l.G==1||l.G==2||l.B>=(l.Va?0:l.Wa)?!1:(l.s=ze(x(l.Ga,l,h),ku(l,l.B)),l.B++,!0)}s.Ga=function(l){if(this.s)if(this.s=null,this.G==1){if(!l){this.U=Math.floor(1e5*Math.random()),l=this.U++;const z=new ye(this,this.j,l);let X=this.o;if(this.S&&(X?(X=b(X),j(X,this.S)):X=this.S),this.m!==null||this.O||(z.H=X,X=null),this.P)e:{for(var h=0,p=0;p<this.i.length;p++){t:{var _=this.i[p];if("__data__"in _.map&&(_=_.map.__data__,typeof _=="string")){_=_.length;break t}_=void 0}if(_===void 0)break;if(h+=_,4096<h){h=p;break e}if(h===4096||p===this.i.length-1){h=p+1;break e}}h=1e3}else h=1e3;h=bu(this,z,h),p=is(this.I),mt(p,"RID",l),mt(p,"CVER",22),this.D&&mt(p,"X-HTTP-Session-Id",this.D),wn(this,p),X&&(this.O?h="headers="+encodeURIComponent(String(cu(X)))+"&"+h:this.m&&ml(p,this.m,X)),hl(this.h,z),this.Ua&&mt(p,"TYPE","init"),this.P?(mt(p,"$req",h),mt(p,"SID","null"),z.T=!0,ll(z,p,null)):ll(z,p,h),this.G=2}}else this.G==3&&(l?fu(this,l):this.i.length==0||Xd(this.h)||fu(this))};function fu(l,h){var p;h?p=h.l:p=l.U++;const _=is(l.I);mt(_,"SID",l.K),mt(_,"RID",p),mt(_,"AID",l.T),wn(l,_),l.m&&l.o&&ml(_,l.m,l.o),p=new ye(l,l.j,p,l.B+1),l.m===null&&(p.H=l.o),h&&(l.i=h.D.concat(l.i)),h=bu(l,p,1e3),p.I=Math.round(.5*l.wa)+Math.round(.5*l.wa*Math.random()),hl(l.h,p),ll(p,_,h)}function wn(l,h){l.H&&U(l.H,function(p,_){mt(h,_,p)}),l.l&&tu({},function(p,_){mt(h,_,p)})}function bu(l,h,p){p=Math.min(l.i.length,p);var _=l.l?x(l.l.Na,l.l,l):null;e:{var z=l.i;let X=-1;for(;;){const fe=["count="+p];X==-1?0<p?(X=z[0].g,fe.push("ofs="+X)):X=0:fe.push("ofs="+X);let ct=!0;for(let Bt=0;Bt<p;Bt++){let Je=z[Bt].g;const Yt=z[Bt].map;if(Je-=X,0>Je)X=Math.max(0,z[Bt].g-100),ct=!1;else try{mx(Yt,fe,"req"+Je+"_")}catch{_&&_(Yt)}}if(ct){_=fe.join("&");break e}}}return l=l.i.splice(0,p),h.D=l,_}function yu(l){if(!l.g&&!l.u){l.Y=1;var h=l.Fa;te||R(),Y||(te(),Y=!0),q.add(h,l),l.v=0}}function pl(l){return l.g||l.u||3<=l.v?!1:(l.Y++,l.u=ze(x(l.Fa,l),ku(l,l.v)),l.v++,!0)}s.Fa=function(){if(this.u=null,vu(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var l=2*this.R;this.j.info("BP detection timer enabled: "+l),this.A=ze(x(this.ab,this),l)}},s.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,Ie(10),wi(this),vu(this))};function xl(l){l.A!=null&&(c.clearTimeout(l.A),l.A=null)}function vu(l){l.g=new ye(l,l.j,"rpc",l.Y),l.m===null&&(l.g.H=l.o),l.g.O=0;var h=is(l.qa);mt(h,"RID","rpc"),mt(h,"SID",l.K),mt(h,"AID",l.T),mt(h,"CI",l.F?"0":"1"),!l.F&&l.ja&&mt(h,"TO",l.ja),mt(h,"TYPE","xmlhttp"),wn(l,h),l.m&&l.o&&ml(h,l.m,l.o),l.L&&(l.g.I=l.L);var p=l.g;l=l.ia,p.L=1,p.v=fi(is(h)),p.m=null,p.P=!0,Gd(p,l)}s.Za=function(){this.C!=null&&(this.C=null,wi(this),pl(this),Ie(19))};function ji(l){l.C!=null&&(c.clearTimeout(l.C),l.C=null)}function wu(l,h){var p=null;if(l.g==h){ji(l),xl(l),l.g=null;var _=2}else if(ul(l.h,h))p=h.D,Zd(l.h,h),_=1;else return;if(l.G!=0){if(h.o)if(_==1){p=h.m?h.m.length:0,h=Date.now()-h.F;var z=l.B;_=Me(),be(_,new Le(_,p)),ki(l)}else yu(l);else if(z=h.s,z==3||z==0&&0<h.X||!(_==1&&fx(l,h)||_==2&&pl(l)))switch(p&&0<p.length&&(h=l.h,h.i=h.i.concat(p)),z){case 1:sa(l,5);break;case 4:sa(l,10);break;case 3:sa(l,6);break;default:sa(l,2)}}}function ku(l,h){let p=l.Ta+Math.floor(Math.random()*l.cb);return l.isActive()||(p*=2),p*h}function sa(l,h){if(l.j.info("Error code "+h),h==2){var p=x(l.fb,l),_=l.Xa;const z=!_;_=new ra(_||"//www.google.com/images/cleardot.gif"),c.location&&c.location.protocol=="http"||pi(_,"https"),fi(_),z?dx(_.toString(),p):ux(_.toString(),p)}else Ie(2);l.G=0,l.l&&l.l.sa(h),ju(l),xu(l)}s.fb=function(l){l?(this.j.info("Successfully pinged google.com"),Ie(2)):(this.j.info("Failed to ping google.com"),Ie(1))};function ju(l){if(l.G=0,l.ka=[],l.l){const h=eu(l.h);(h.length!=0||l.i.length!=0)&&(N(l.ka,h),N(l.ka,l.i),l.h.i.length=0,I(l.i),l.i.length=0),l.l.ra()}}function Nu(l,h,p){var _=p instanceof ra?is(p):new ra(p);if(_.g!="")h&&(_.g=h+"."+_.g),xi(_,_.s);else{var z=c.location;_=z.protocol,h=h?h+"."+z.hostname:z.hostname,z=+z.port;var X=new ra(null);_&&pi(X,_),h&&(X.g=h),z&&xi(X,z),p&&(X.l=p),_=X}return p=l.D,h=l.ya,p&&h&&mt(_,p,h),mt(_,"VER",l.la),wn(l,_),_}function _u(l,h,p){if(h&&!l.J)throw Error("Can't create secondary domain capable XhrIo object.");return h=l.Ca&&!l.pa?new wt(new bi({eb:p})):new wt(l.pa),h.Ha(l.J),h}s.isActive=function(){return!!this.l&&this.l.isActive(this)};function Eu(){}s=Eu.prototype,s.ua=function(){},s.ta=function(){},s.sa=function(){},s.ra=function(){},s.isActive=function(){return!0},s.Na=function(){};function Ni(){}Ni.prototype.g=function(l,h){return new wr(l,h)};function wr(l,h){ge.call(this),this.g=new pu(h),this.l=l,this.h=h&&h.messageUrlParams||null,l=h&&h.messageHeaders||null,h&&h.clientProtocolHeaderRequired&&(l?l["X-Client-Protocol"]="webchannel":l={"X-Client-Protocol":"webchannel"}),this.g.o=l,l=h&&h.initMessageHeaders||null,h&&h.messageContentType&&(l?l["X-WebChannel-Content-Type"]=h.messageContentType:l={"X-WebChannel-Content-Type":h.messageContentType}),h&&h.va&&(l?l["X-WebChannel-Client-Profile"]=h.va:l={"X-WebChannel-Client-Profile":h.va}),this.g.S=l,(l=h&&h.Sb)&&!D(l)&&(this.g.m=l),this.v=h&&h.supportsCrossDomainXhr||!1,this.u=h&&h.sendRawJson||!1,(h=h&&h.httpSessionIdParam)&&!D(h)&&(this.g.D=h,l=this.h,l!==null&&h in l&&(l=this.h,h in l&&delete l[h])),this.j=new Ta(this)}T(wr,ge),wr.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},wr.prototype.close=function(){gl(this.g)},wr.prototype.o=function(l){var h=this.g;if(typeof l=="string"){var p={};p.__data__=l,l=p}else this.u&&(p={},p.__data__=vr(l),l=p);h.i.push(new ex(h.Ya++,l)),h.G==3&&ki(h)},wr.prototype.N=function(){this.g.l=null,delete this.j,gl(this.g),delete this.g,wr.aa.N.call(this)};function Tu(l){Fr.call(this),l.__headers__&&(this.headers=l.__headers__,this.statusCode=l.__status__,delete l.__headers__,delete l.__status__);var h=l.__sm__;if(h){e:{for(const p in h){l=p;break e}l=void 0}(this.i=l)&&(l=this.i,h=h!==null&&l in h?h[l]:void 0),this.data=h}else this.data=l}T(Tu,Fr);function Su(){Ur.call(this),this.status=1}T(Su,Ur);function Ta(l){this.g=l}T(Ta,Eu),Ta.prototype.ua=function(){be(this.g,"a")},Ta.prototype.ta=function(l){be(this.g,new Tu(l))},Ta.prototype.sa=function(l){be(this.g,new Su)},Ta.prototype.ra=function(){be(this.g,"b")},Ni.prototype.createWebChannel=Ni.prototype.g,wr.prototype.send=wr.prototype.o,wr.prototype.open=wr.prototype.m,wr.prototype.close=wr.prototype.close,wm=function(){return new Ni},vm=function(){return Me()},ym=Sr,sc={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},lt.NO_ERROR=0,lt.TIMEOUT=8,lt.HTTP_ERROR=6,Oi=lt,ht.COMPLETE="complete",bm=ht,Er.EventType=Tr,Tr.OPEN="a",Tr.CLOSE="b",Tr.ERROR="c",Tr.MESSAGE="d",ge.prototype.listen=ge.prototype.K,Sn=Er,wt.prototype.listenOnce=wt.prototype.L,wt.prototype.getLastError=wt.prototype.Ka,wt.prototype.getLastErrorCode=wt.prototype.Ba,wt.prototype.getStatus=wt.prototype.Z,wt.prototype.getResponseJson=wt.prototype.Oa,wt.prototype.getResponseText=wt.prototype.oa,wt.prototype.send=wt.prototype.ea,wt.prototype.setWithCredentials=wt.prototype.Ha,fm=wt}).apply(typeof Ei<"u"?Ei:typeof self<"u"?self:typeof window<"u"?window:{});const Qu="@firebase/firestore";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class er{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}er.UNAUTHENTICATED=new er(null),er.GOOGLE_CREDENTIALS=new er("google-credentials-uid"),er.FIRST_PARTY=new er("first-party-uid"),er.MOCK_USER=new er("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let nn="10.14.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xa=new Pc("@firebase/firestore");function kn(){return xa.logLevel}function _e(s,...e){if(xa.logLevel<=Ke.DEBUG){const r=e.map(Vc);xa.debug(`Firestore (${nn}): ${s}`,...r)}}function ws(s,...e){if(xa.logLevel<=Ke.ERROR){const r=e.map(Vc);xa.error(`Firestore (${nn}): ${s}`,...r)}}function Ha(s,...e){if(xa.logLevel<=Ke.WARN){const r=e.map(Vc);xa.warn(`Firestore (${nn}): ${s}`,...r)}}function Vc(s){if(typeof s=="string")return s;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return function(r){return JSON.stringify(r)}(s)}catch{return s}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ve(s="Unexpected state"){const e=`FIRESTORE (${nn}) INTERNAL ASSERTION FAILED: `+s;throw ws(e),new Error(e)}function at(s,e){s||Ve()}function Ue(s,e){return s}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ae={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class we extends as{constructor(e,r){super(e,r),this.code=e,this.message=r,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xs{constructor(){this.promise=new Promise((e,r)=>{this.resolve=e,this.reject=r})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class km{constructor(e,r){this.user=r,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class Py{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,r){e.enqueueRetryable(()=>r(er.UNAUTHENTICATED))}shutdown(){}}class My{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,r){this.changeListener=r,e.enqueueRetryable(()=>r(this.token.user))}shutdown(){this.changeListener=null}}class Oy{constructor(e){this.t=e,this.currentUser=er.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,r){at(this.o===void 0);let a=this.i;const n=d=>this.i!==a?(a=this.i,r(d)):Promise.resolve();let i=new xs;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new xs,e.enqueueRetryable(()=>n(this.currentUser))};const o=()=>{const d=i;e.enqueueRetryable(async()=>{await d.promise,await n(this.currentUser)})},c=d=>{_e("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=d,this.o&&(this.auth.addAuthTokenListener(this.o),o())};this.t.onInit(d=>c(d)),setTimeout(()=>{if(!this.auth){const d=this.t.getImmediate({optional:!0});d?c(d):(_e("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new xs)}},0),o()}getToken(){const e=this.i,r=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(r).then(a=>this.i!==e?(_e("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):a?(at(typeof a.accessToken=="string"),new km(a.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return at(e===null||typeof e=="string"),new er(e)}}class Vy{constructor(e,r,a){this.l=e,this.h=r,this.P=a,this.type="FirstParty",this.user=er.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);const e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class Ly{constructor(e,r,a){this.l=e,this.h=r,this.P=a}getToken(){return Promise.resolve(new Vy(this.l,this.h,this.P))}start(e,r){e.enqueueRetryable(()=>r(er.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class Fy{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class Uy{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,r){at(this.o===void 0);const a=i=>{i.error!=null&&_e("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${i.error.message}`);const o=i.token!==this.R;return this.R=i.token,_e("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?r(i.token):Promise.resolve()};this.o=i=>{e.enqueueRetryable(()=>a(i))};const n=i=>{_e("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=i,this.o&&this.appCheck.addTokenListener(this.o)};this.A.onInit(i=>n(i)),setTimeout(()=>{if(!this.appCheck){const i=this.A.getImmediate({optional:!0});i?n(i):_e("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(r=>r?(at(typeof r.token=="string"),this.R=r.token,new Fy(r.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function By(s){const e=typeof self<"u"&&(self.crypto||self.msCrypto),r=new Uint8Array(s);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(r);else for(let a=0;a<s;a++)r[a]=Math.floor(256*Math.random());return r}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jm{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",r=Math.floor(256/e.length)*e.length;let a="";for(;a.length<20;){const n=By(40);for(let i=0;i<n.length;++i)a.length<20&&n[i]<r&&(a+=e.charAt(n[i]%e.length))}return a}}function Ze(s,e){return s<e?-1:s>e?1:0}function Ga(s,e,r){return s.length===e.length&&s.every((a,n)=>r(a,e[n]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rt{constructor(e,r){if(this.seconds=e,this.nanoseconds=r,r<0)throw new we(ae.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+r);if(r>=1e9)throw new we(ae.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+r);if(e<-62135596800)throw new we(ae.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new we(ae.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return Rt.fromMillis(Date.now())}static fromDate(e){return Rt.fromMillis(e.getTime())}static fromMillis(e){const r=Math.floor(e/1e3),a=Math.floor(1e6*(e-1e3*r));return new Rt(r,a)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?Ze(this.nanoseconds,e.nanoseconds):Ze(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fe{constructor(e){this.timestamp=e}static fromTimestamp(e){return new Fe(e)}static min(){return new Fe(new Rt(0,0))}static max(){return new Fe(new Rt(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qn{constructor(e,r,a){r===void 0?r=0:r>e.length&&Ve(),a===void 0?a=e.length-r:a>e.length-r&&Ve(),this.segments=e,this.offset=r,this.len=a}get length(){return this.len}isEqual(e){return qn.comparator(this,e)===0}child(e){const r=this.segments.slice(this.offset,this.limit());return e instanceof qn?e.forEach(a=>{r.push(a)}):r.push(e),this.construct(r)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let r=0;r<this.length;r++)if(this.get(r)!==e.get(r))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let r=0;r<this.length;r++)if(this.get(r)!==e.get(r))return!1;return!0}forEach(e){for(let r=this.offset,a=this.limit();r<a;r++)e(this.segments[r])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,r){const a=Math.min(e.length,r.length);for(let n=0;n<a;n++){const i=e.get(n),o=r.get(n);if(i<o)return-1;if(i>o)return 1}return e.length<r.length?-1:e.length>r.length?1:0}}class gt extends qn{construct(e,r,a){return new gt(e,r,a)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const r=[];for(const a of e){if(a.indexOf("//")>=0)throw new we(ae.INVALID_ARGUMENT,`Invalid segment (${a}). Paths must not contain // in them.`);r.push(...a.split("/").filter(n=>n.length>0))}return new gt(r)}static emptyPath(){return new gt([])}}const zy=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Ht extends qn{construct(e,r,a){return new Ht(e,r,a)}static isValidIdentifier(e){return zy.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Ht.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new Ht(["__name__"])}static fromServerFormat(e){const r=[];let a="",n=0;const i=()=>{if(a.length===0)throw new we(ae.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);r.push(a),a=""};let o=!1;for(;n<e.length;){const c=e[n];if(c==="\\"){if(n+1===e.length)throw new we(ae.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const d=e[n+1];if(d!=="\\"&&d!=="."&&d!=="`")throw new we(ae.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);a+=d,n+=2}else c==="`"?(o=!o,n++):c!=="."||o?(a+=c,n++):(i(),n++)}if(i(),o)throw new we(ae.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new Ht(r)}static emptyPath(){return new Ht([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ae{constructor(e){this.path=e}static fromPath(e){return new Ae(gt.fromString(e))}static fromName(e){return new Ae(gt.fromString(e).popFirst(5))}static empty(){return new Ae(gt.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&gt.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,r){return gt.comparator(e.path,r.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new Ae(new gt(e.slice()))}}function qy(s,e){const r=s.toTimestamp().seconds,a=s.toTimestamp().nanoseconds+1,n=Fe.fromTimestamp(a===1e9?new Rt(r+1,0):new Rt(r,a));return new Ks(n,Ae.empty(),e)}function Wy(s){return new Ks(s.readTime,s.key,-1)}class Ks{constructor(e,r,a){this.readTime=e,this.documentKey=r,this.largestBatchId=a}static min(){return new Ks(Fe.min(),Ae.empty(),-1)}static max(){return new Ks(Fe.max(),Ae.empty(),-1)}}function Hy(s,e){let r=s.readTime.compareTo(e.readTime);return r!==0?r:(r=Ae.comparator(s.documentKey,e.documentKey),r!==0?r:Ze(s.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Gy="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class Ky{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function ai(s){if(s.code!==ae.FAILED_PRECONDITION||s.message!==Gy)throw s;_e("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class de{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(r=>{this.isDone=!0,this.result=r,this.nextCallback&&this.nextCallback(r)},r=>{this.isDone=!0,this.error=r,this.catchCallback&&this.catchCallback(r)})}catch(e){return this.next(void 0,e)}next(e,r){return this.callbackAttached&&Ve(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(r,this.error):this.wrapSuccess(e,this.result):new de((a,n)=>{this.nextCallback=i=>{this.wrapSuccess(e,i).next(a,n)},this.catchCallback=i=>{this.wrapFailure(r,i).next(a,n)}})}toPromise(){return new Promise((e,r)=>{this.next(e,r)})}wrapUserFunction(e){try{const r=e();return r instanceof de?r:de.resolve(r)}catch(r){return de.reject(r)}}wrapSuccess(e,r){return e?this.wrapUserFunction(()=>e(r)):de.resolve(r)}wrapFailure(e,r){return e?this.wrapUserFunction(()=>e(r)):de.reject(r)}static resolve(e){return new de((r,a)=>{r(e)})}static reject(e){return new de((r,a)=>{a(e)})}static waitFor(e){return new de((r,a)=>{let n=0,i=0,o=!1;e.forEach(c=>{++n,c.next(()=>{++i,o&&i===n&&r()},d=>a(d))}),o=!0,i===n&&r()})}static or(e){let r=de.resolve(!1);for(const a of e)r=r.next(n=>n?de.resolve(n):a());return r}static forEach(e,r){const a=[];return e.forEach((n,i)=>{a.push(r.call(this,n,i))}),this.waitFor(a)}static mapArray(e,r){return new de((a,n)=>{const i=e.length,o=new Array(i);let c=0;for(let d=0;d<i;d++){const u=d;r(e[u]).next(m=>{o[u]=m,++c,c===i&&a(o)},m=>n(m))}})}static doWhile(e,r){return new de((a,n)=>{const i=()=>{e()===!0?r().next(()=>{i()},n):a()};i()})}}function Qy(s){const e=s.match(/Android ([\d.]+)/i),r=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(r)}function ni(s){return s.name==="IndexedDbTransactionError"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lc{constructor(e,r){this.previousValue=e,r&&(r.sequenceNumberHandler=a=>this.ie(a),this.se=a=>r.writeSequenceNumber(a))}ie(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.se&&this.se(e),e}}Lc.oe=-1;function Ro(s){return s==null}function no(s){return s===0&&1/s==-1/0}function Yy(s){return typeof s=="number"&&Number.isInteger(s)&&!no(s)&&s<=Number.MAX_SAFE_INTEGER&&s>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Yu(s){let e=0;for(const r in s)Object.prototype.hasOwnProperty.call(s,r)&&e++;return e}function Na(s,e){for(const r in s)Object.prototype.hasOwnProperty.call(s,r)&&e(r,s[r])}function Nm(s){for(const e in s)if(Object.prototype.hasOwnProperty.call(s,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yt{constructor(e,r){this.comparator=e,this.root=r||qt.EMPTY}insert(e,r){return new yt(this.comparator,this.root.insert(e,r,this.comparator).copy(null,null,qt.BLACK,null,null))}remove(e){return new yt(this.comparator,this.root.remove(e,this.comparator).copy(null,null,qt.BLACK,null,null))}get(e){let r=this.root;for(;!r.isEmpty();){const a=this.comparator(e,r.key);if(a===0)return r.value;a<0?r=r.left:a>0&&(r=r.right)}return null}indexOf(e){let r=0,a=this.root;for(;!a.isEmpty();){const n=this.comparator(e,a.key);if(n===0)return r+a.left.size;n<0?a=a.left:(r+=a.left.size+1,a=a.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((r,a)=>(e(r,a),!1))}toString(){const e=[];return this.inorderTraversal((r,a)=>(e.push(`${r}:${a}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Ti(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Ti(this.root,e,this.comparator,!1)}getReverseIterator(){return new Ti(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Ti(this.root,e,this.comparator,!0)}}class Ti{constructor(e,r,a,n){this.isReverse=n,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=r?a(e.key,r):1,r&&n&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(i===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const r={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return r}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class qt{constructor(e,r,a,n,i){this.key=e,this.value=r,this.color=a??qt.RED,this.left=n??qt.EMPTY,this.right=i??qt.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,r,a,n,i){return new qt(e??this.key,r??this.value,a??this.color,n??this.left,i??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,r,a){let n=this;const i=a(e,n.key);return n=i<0?n.copy(null,null,null,n.left.insert(e,r,a),null):i===0?n.copy(null,r,null,null,null):n.copy(null,null,null,null,n.right.insert(e,r,a)),n.fixUp()}removeMin(){if(this.left.isEmpty())return qt.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,r){let a,n=this;if(r(e,n.key)<0)n.left.isEmpty()||n.left.isRed()||n.left.left.isRed()||(n=n.moveRedLeft()),n=n.copy(null,null,null,n.left.remove(e,r),null);else{if(n.left.isRed()&&(n=n.rotateRight()),n.right.isEmpty()||n.right.isRed()||n.right.left.isRed()||(n=n.moveRedRight()),r(e,n.key)===0){if(n.right.isEmpty())return qt.EMPTY;a=n.right.min(),n=n.copy(a.key,a.value,null,null,n.right.removeMin())}n=n.copy(null,null,null,null,n.right.remove(e,r))}return n.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,qt.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,qt.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),r=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,r)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw Ve();const e=this.left.check();if(e!==this.right.check())throw Ve();return e+(this.isRed()?0:1)}}qt.EMPTY=null,qt.RED=!0,qt.BLACK=!1;qt.EMPTY=new class{constructor(){this.size=0}get key(){throw Ve()}get value(){throw Ve()}get color(){throw Ve()}get left(){throw Ve()}get right(){throw Ve()}copy(e,r,a,n,i){return this}insert(e,r,a){return new qt(e,r)}remove(e,r){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kt{constructor(e){this.comparator=e,this.data=new yt(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((r,a)=>(e(r),!1))}forEachInRange(e,r){const a=this.data.getIteratorFrom(e[0]);for(;a.hasNext();){const n=a.getNext();if(this.comparator(n.key,e[1])>=0)return;r(n.key)}}forEachWhile(e,r){let a;for(a=r!==void 0?this.data.getIteratorFrom(r):this.data.getIterator();a.hasNext();)if(!e(a.getNext().key))return}firstAfterOrEqual(e){const r=this.data.getIteratorFrom(e);return r.hasNext()?r.getNext().key:null}getIterator(){return new Xu(this.data.getIterator())}getIteratorFrom(e){return new Xu(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let r=this;return r.size<e.size&&(r=e,e=this),e.forEach(a=>{r=r.add(a)}),r}isEqual(e){if(!(e instanceof Kt)||this.size!==e.size)return!1;const r=this.data.getIterator(),a=e.data.getIterator();for(;r.hasNext();){const n=r.getNext().key,i=a.getNext().key;if(this.comparator(n,i)!==0)return!1}return!0}toArray(){const e=[];return this.forEach(r=>{e.push(r)}),e}toString(){const e=[];return this.forEach(r=>e.push(r)),"SortedSet("+e.toString()+")"}copy(e){const r=new Kt(this.comparator);return r.data=e,r}}class Xu{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nr{constructor(e){this.fields=e,e.sort(Ht.comparator)}static empty(){return new Nr([])}unionWith(e){let r=new Kt(Ht.comparator);for(const a of this.fields)r=r.add(a);for(const a of e)r=r.add(a);return new Nr(r.toArray())}covers(e){for(const r of this.fields)if(r.isPrefixOf(e))return!0;return!1}isEqual(e){return Ga(this.fields,e.fields,(r,a)=>r.isEqual(a))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _m extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qt{constructor(e){this.binaryString=e}static fromBase64String(e){const r=function(n){try{return atob(n)}catch(i){throw typeof DOMException<"u"&&i instanceof DOMException?new _m("Invalid base64 string: "+i):i}}(e);return new Qt(r)}static fromUint8Array(e){const r=function(n){let i="";for(let o=0;o<n.length;++o)i+=String.fromCharCode(n[o]);return i}(e);return new Qt(r)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(r){return btoa(r)}(this.binaryString)}toUint8Array(){return function(r){const a=new Uint8Array(r.length);for(let n=0;n<r.length;n++)a[n]=r.charCodeAt(n);return a}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return Ze(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Qt.EMPTY_BYTE_STRING=new Qt("");const Xy=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Qs(s){if(at(!!s),typeof s=="string"){let e=0;const r=Xy.exec(s);if(at(!!r),r[1]){let n=r[1];n=(n+"000000000").substr(0,9),e=Number(n)}const a=new Date(s);return{seconds:Math.floor(a.getTime()/1e3),nanos:e}}return{seconds:_t(s.seconds),nanos:_t(s.nanos)}}function _t(s){return typeof s=="number"?s:typeof s=="string"?Number(s):0}function fa(s){return typeof s=="string"?Qt.fromBase64String(s):Qt.fromUint8Array(s)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Fc(s){var e,r;return((r=(((e=s==null?void 0:s.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||r===void 0?void 0:r.stringValue)==="server_timestamp"}function Uc(s){const e=s.mapValue.fields.__previous_value__;return Fc(e)?Uc(e):e}function Wn(s){const e=Qs(s.mapValue.fields.__local_write_time__.timestampValue);return new Rt(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jy{constructor(e,r,a,n,i,o,c,d,u){this.databaseId=e,this.appId=r,this.persistenceKey=a,this.host=n,this.ssl=i,this.forceLongPolling=o,this.autoDetectLongPolling=c,this.longPollingOptions=d,this.useFetchStreams=u}}class Hn{constructor(e,r){this.projectId=e,this.database=r||"(default)"}static empty(){return new Hn("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(e){return e instanceof Hn&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Si={mapValue:{}};function ba(s){return"nullValue"in s?0:"booleanValue"in s?1:"integerValue"in s||"doubleValue"in s?2:"timestampValue"in s?3:"stringValue"in s?5:"bytesValue"in s?6:"referenceValue"in s?7:"geoPointValue"in s?8:"arrayValue"in s?9:"mapValue"in s?Fc(s)?4:ev(s)?9007199254740991:Zy(s)?10:11:Ve()}function rs(s,e){if(s===e)return!0;const r=ba(s);if(r!==ba(e))return!1;switch(r){case 0:case 9007199254740991:return!0;case 1:return s.booleanValue===e.booleanValue;case 4:return Wn(s).isEqual(Wn(e));case 3:return function(n,i){if(typeof n.timestampValue=="string"&&typeof i.timestampValue=="string"&&n.timestampValue.length===i.timestampValue.length)return n.timestampValue===i.timestampValue;const o=Qs(n.timestampValue),c=Qs(i.timestampValue);return o.seconds===c.seconds&&o.nanos===c.nanos}(s,e);case 5:return s.stringValue===e.stringValue;case 6:return function(n,i){return fa(n.bytesValue).isEqual(fa(i.bytesValue))}(s,e);case 7:return s.referenceValue===e.referenceValue;case 8:return function(n,i){return _t(n.geoPointValue.latitude)===_t(i.geoPointValue.latitude)&&_t(n.geoPointValue.longitude)===_t(i.geoPointValue.longitude)}(s,e);case 2:return function(n,i){if("integerValue"in n&&"integerValue"in i)return _t(n.integerValue)===_t(i.integerValue);if("doubleValue"in n&&"doubleValue"in i){const o=_t(n.doubleValue),c=_t(i.doubleValue);return o===c?no(o)===no(c):isNaN(o)&&isNaN(c)}return!1}(s,e);case 9:return Ga(s.arrayValue.values||[],e.arrayValue.values||[],rs);case 10:case 11:return function(n,i){const o=n.mapValue.fields||{},c=i.mapValue.fields||{};if(Yu(o)!==Yu(c))return!1;for(const d in o)if(o.hasOwnProperty(d)&&(c[d]===void 0||!rs(o[d],c[d])))return!1;return!0}(s,e);default:return Ve()}}function Gn(s,e){return(s.values||[]).find(r=>rs(r,e))!==void 0}function Ka(s,e){if(s===e)return 0;const r=ba(s),a=ba(e);if(r!==a)return Ze(r,a);switch(r){case 0:case 9007199254740991:return 0;case 1:return Ze(s.booleanValue,e.booleanValue);case 2:return function(i,o){const c=_t(i.integerValue||i.doubleValue),d=_t(o.integerValue||o.doubleValue);return c<d?-1:c>d?1:c===d?0:isNaN(c)?isNaN(d)?0:-1:1}(s,e);case 3:return Ju(s.timestampValue,e.timestampValue);case 4:return Ju(Wn(s),Wn(e));case 5:return Ze(s.stringValue,e.stringValue);case 6:return function(i,o){const c=fa(i),d=fa(o);return c.compareTo(d)}(s.bytesValue,e.bytesValue);case 7:return function(i,o){const c=i.split("/"),d=o.split("/");for(let u=0;u<c.length&&u<d.length;u++){const m=Ze(c[u],d[u]);if(m!==0)return m}return Ze(c.length,d.length)}(s.referenceValue,e.referenceValue);case 8:return function(i,o){const c=Ze(_t(i.latitude),_t(o.latitude));return c!==0?c:Ze(_t(i.longitude),_t(o.longitude))}(s.geoPointValue,e.geoPointValue);case 9:return Zu(s.arrayValue,e.arrayValue);case 10:return function(i,o){var c,d,u,m;const f=i.fields||{},x=o.fields||{},v=(c=f.value)===null||c===void 0?void 0:c.arrayValue,T=(d=x.value)===null||d===void 0?void 0:d.arrayValue,I=Ze(((u=v==null?void 0:v.values)===null||u===void 0?void 0:u.length)||0,((m=T==null?void 0:T.values)===null||m===void 0?void 0:m.length)||0);return I!==0?I:Zu(v,T)}(s.mapValue,e.mapValue);case 11:return function(i,o){if(i===Si.mapValue&&o===Si.mapValue)return 0;if(i===Si.mapValue)return 1;if(o===Si.mapValue)return-1;const c=i.fields||{},d=Object.keys(c),u=o.fields||{},m=Object.keys(u);d.sort(),m.sort();for(let f=0;f<d.length&&f<m.length;++f){const x=Ze(d[f],m[f]);if(x!==0)return x;const v=Ka(c[d[f]],u[m[f]]);if(v!==0)return v}return Ze(d.length,m.length)}(s.mapValue,e.mapValue);default:throw Ve()}}function Ju(s,e){if(typeof s=="string"&&typeof e=="string"&&s.length===e.length)return Ze(s,e);const r=Qs(s),a=Qs(e),n=Ze(r.seconds,a.seconds);return n!==0?n:Ze(r.nanos,a.nanos)}function Zu(s,e){const r=s.values||[],a=e.values||[];for(let n=0;n<r.length&&n<a.length;++n){const i=Ka(r[n],a[n]);if(i)return i}return Ze(r.length,a.length)}function Qa(s){return ac(s)}function ac(s){return"nullValue"in s?"null":"booleanValue"in s?""+s.booleanValue:"integerValue"in s?""+s.integerValue:"doubleValue"in s?""+s.doubleValue:"timestampValue"in s?function(r){const a=Qs(r);return`time(${a.seconds},${a.nanos})`}(s.timestampValue):"stringValue"in s?s.stringValue:"bytesValue"in s?function(r){return fa(r).toBase64()}(s.bytesValue):"referenceValue"in s?function(r){return Ae.fromName(r).toString()}(s.referenceValue):"geoPointValue"in s?function(r){return`geo(${r.latitude},${r.longitude})`}(s.geoPointValue):"arrayValue"in s?function(r){let a="[",n=!0;for(const i of r.values||[])n?n=!1:a+=",",a+=ac(i);return a+"]"}(s.arrayValue):"mapValue"in s?function(r){const a=Object.keys(r.fields||{}).sort();let n="{",i=!0;for(const o of a)i?i=!1:n+=",",n+=`${o}:${ac(r.fields[o])}`;return n+"}"}(s.mapValue):Ve()}function eh(s,e){return{referenceValue:`projects/${s.projectId}/databases/${s.database}/documents/${e.path.canonicalString()}`}}function nc(s){return!!s&&"integerValue"in s}function Bc(s){return!!s&&"arrayValue"in s}function th(s){return!!s&&"nullValue"in s}function rh(s){return!!s&&"doubleValue"in s&&isNaN(Number(s.doubleValue))}function Vi(s){return!!s&&"mapValue"in s}function Zy(s){var e,r;return((r=(((e=s==null?void 0:s.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||r===void 0?void 0:r.stringValue)==="__vector__"}function Rn(s){if(s.geoPointValue)return{geoPointValue:Object.assign({},s.geoPointValue)};if(s.timestampValue&&typeof s.timestampValue=="object")return{timestampValue:Object.assign({},s.timestampValue)};if(s.mapValue){const e={mapValue:{fields:{}}};return Na(s.mapValue.fields,(r,a)=>e.mapValue.fields[r]=Rn(a)),e}if(s.arrayValue){const e={arrayValue:{values:[]}};for(let r=0;r<(s.arrayValue.values||[]).length;++r)e.arrayValue.values[r]=Rn(s.arrayValue.values[r]);return e}return Object.assign({},s)}function ev(s){return(((s.mapValue||{}).fields||{}).__type__||{}).stringValue==="__max__"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class br{constructor(e){this.value=e}static empty(){return new br({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let r=this.value;for(let a=0;a<e.length-1;++a)if(r=(r.mapValue.fields||{})[e.get(a)],!Vi(r))return null;return r=(r.mapValue.fields||{})[e.lastSegment()],r||null}}set(e,r){this.getFieldsMap(e.popLast())[e.lastSegment()]=Rn(r)}setAll(e){let r=Ht.emptyPath(),a={},n=[];e.forEach((o,c)=>{if(!r.isImmediateParentOf(c)){const d=this.getFieldsMap(r);this.applyChanges(d,a,n),a={},n=[],r=c.popLast()}o?a[c.lastSegment()]=Rn(o):n.push(c.lastSegment())});const i=this.getFieldsMap(r);this.applyChanges(i,a,n)}delete(e){const r=this.field(e.popLast());Vi(r)&&r.mapValue.fields&&delete r.mapValue.fields[e.lastSegment()]}isEqual(e){return rs(this.value,e.value)}getFieldsMap(e){let r=this.value;r.mapValue.fields||(r.mapValue={fields:{}});for(let a=0;a<e.length;++a){let n=r.mapValue.fields[e.get(a)];Vi(n)&&n.mapValue.fields||(n={mapValue:{fields:{}}},r.mapValue.fields[e.get(a)]=n),r=n}return r.mapValue.fields}applyChanges(e,r,a){Na(r,(n,i)=>e[n]=i);for(const n of a)delete e[n]}clone(){return new br(Rn(this.value))}}function Em(s){const e=[];return Na(s.fields,(r,a)=>{const n=new Ht([r]);if(Vi(a)){const i=Em(a.mapValue).fields;if(i.length===0)e.push(n);else for(const o of i)e.push(n.child(o))}else e.push(n)}),new Nr(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sr{constructor(e,r,a,n,i,o,c){this.key=e,this.documentType=r,this.version=a,this.readTime=n,this.createTime=i,this.data=o,this.documentState=c}static newInvalidDocument(e){return new sr(e,0,Fe.min(),Fe.min(),Fe.min(),br.empty(),0)}static newFoundDocument(e,r,a,n){return new sr(e,1,r,Fe.min(),a,n,0)}static newNoDocument(e,r){return new sr(e,2,r,Fe.min(),Fe.min(),br.empty(),0)}static newUnknownDocument(e,r){return new sr(e,3,r,Fe.min(),Fe.min(),br.empty(),2)}convertToFoundDocument(e,r){return!this.createTime.isEqual(Fe.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=r,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=br.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=br.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=Fe.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof sr&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new sr(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class io{constructor(e,r){this.position=e,this.inclusive=r}}function sh(s,e,r){let a=0;for(let n=0;n<s.position.length;n++){const i=e[n],o=s.position[n];if(i.field.isKeyField()?a=Ae.comparator(Ae.fromName(o.referenceValue),r.key):a=Ka(o,r.data.field(i.field)),i.dir==="desc"&&(a*=-1),a!==0)break}return a}function ah(s,e){if(s===null)return e===null;if(e===null||s.inclusive!==e.inclusive||s.position.length!==e.position.length)return!1;for(let r=0;r<s.position.length;r++)if(!rs(s.position[r],e.position[r]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kn{constructor(e,r="asc"){this.field=e,this.dir=r}}function tv(s,e){return s.dir===e.dir&&s.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tm{}class At extends Tm{constructor(e,r,a){super(),this.field=e,this.op=r,this.value=a}static create(e,r,a){return e.isKeyField()?r==="in"||r==="not-in"?this.createKeyFieldInFilter(e,r,a):new sv(e,r,a):r==="array-contains"?new iv(e,a):r==="in"?new ov(e,a):r==="not-in"?new lv(e,a):r==="array-contains-any"?new cv(e,a):new At(e,r,a)}static createKeyFieldInFilter(e,r,a){return r==="in"?new av(e,a):new nv(e,a)}matches(e){const r=e.data.field(this.field);return this.op==="!="?r!==null&&this.matchesComparison(Ka(r,this.value)):r!==null&&ba(this.value)===ba(r)&&this.matchesComparison(Ka(r,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return Ve()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class Or extends Tm{constructor(e,r){super(),this.filters=e,this.op=r,this.ae=null}static create(e,r){return new Or(e,r)}matches(e){return Sm(this)?this.filters.find(r=>!r.matches(e))===void 0:this.filters.find(r=>r.matches(e))!==void 0}getFlattenedFilters(){return this.ae!==null||(this.ae=this.filters.reduce((e,r)=>e.concat(r.getFlattenedFilters()),[])),this.ae}getFilters(){return Object.assign([],this.filters)}}function Sm(s){return s.op==="and"}function Im(s){return rv(s)&&Sm(s)}function rv(s){for(const e of s.filters)if(e instanceof Or)return!1;return!0}function ic(s){if(s instanceof At)return s.field.canonicalString()+s.op.toString()+Qa(s.value);if(Im(s))return s.filters.map(e=>ic(e)).join(",");{const e=s.filters.map(r=>ic(r)).join(",");return`${s.op}(${e})`}}function Am(s,e){return s instanceof At?function(a,n){return n instanceof At&&a.op===n.op&&a.field.isEqual(n.field)&&rs(a.value,n.value)}(s,e):s instanceof Or?function(a,n){return n instanceof Or&&a.op===n.op&&a.filters.length===n.filters.length?a.filters.reduce((i,o,c)=>i&&Am(o,n.filters[c]),!0):!1}(s,e):void Ve()}function Cm(s){return s instanceof At?function(r){return`${r.field.canonicalString()} ${r.op} ${Qa(r.value)}`}(s):s instanceof Or?function(r){return r.op.toString()+" {"+r.getFilters().map(Cm).join(" ,")+"}"}(s):"Filter"}class sv extends At{constructor(e,r,a){super(e,r,a),this.key=Ae.fromName(a.referenceValue)}matches(e){const r=Ae.comparator(e.key,this.key);return this.matchesComparison(r)}}class av extends At{constructor(e,r){super(e,"in",r),this.keys=Dm("in",r)}matches(e){return this.keys.some(r=>r.isEqual(e.key))}}class nv extends At{constructor(e,r){super(e,"not-in",r),this.keys=Dm("not-in",r)}matches(e){return!this.keys.some(r=>r.isEqual(e.key))}}function Dm(s,e){var r;return(((r=e.arrayValue)===null||r===void 0?void 0:r.values)||[]).map(a=>Ae.fromName(a.referenceValue))}class iv extends At{constructor(e,r){super(e,"array-contains",r)}matches(e){const r=e.data.field(this.field);return Bc(r)&&Gn(r.arrayValue,this.value)}}class ov extends At{constructor(e,r){super(e,"in",r)}matches(e){const r=e.data.field(this.field);return r!==null&&Gn(this.value.arrayValue,r)}}class lv extends At{constructor(e,r){super(e,"not-in",r)}matches(e){if(Gn(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const r=e.data.field(this.field);return r!==null&&!Gn(this.value.arrayValue,r)}}class cv extends At{constructor(e,r){super(e,"array-contains-any",r)}matches(e){const r=e.data.field(this.field);return!(!Bc(r)||!r.arrayValue.values)&&r.arrayValue.values.some(a=>Gn(this.value.arrayValue,a))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dv{constructor(e,r=null,a=[],n=[],i=null,o=null,c=null){this.path=e,this.collectionGroup=r,this.orderBy=a,this.filters=n,this.limit=i,this.startAt=o,this.endAt=c,this.ue=null}}function nh(s,e=null,r=[],a=[],n=null,i=null,o=null){return new dv(s,e,r,a,n,i,o)}function zc(s){const e=Ue(s);if(e.ue===null){let r=e.path.canonicalString();e.collectionGroup!==null&&(r+="|cg:"+e.collectionGroup),r+="|f:",r+=e.filters.map(a=>ic(a)).join(","),r+="|ob:",r+=e.orderBy.map(a=>function(i){return i.field.canonicalString()+i.dir}(a)).join(","),Ro(e.limit)||(r+="|l:",r+=e.limit),e.startAt&&(r+="|lb:",r+=e.startAt.inclusive?"b:":"a:",r+=e.startAt.position.map(a=>Qa(a)).join(",")),e.endAt&&(r+="|ub:",r+=e.endAt.inclusive?"a:":"b:",r+=e.endAt.position.map(a=>Qa(a)).join(",")),e.ue=r}return e.ue}function qc(s,e){if(s.limit!==e.limit||s.orderBy.length!==e.orderBy.length)return!1;for(let r=0;r<s.orderBy.length;r++)if(!tv(s.orderBy[r],e.orderBy[r]))return!1;if(s.filters.length!==e.filters.length)return!1;for(let r=0;r<s.filters.length;r++)if(!Am(s.filters[r],e.filters[r]))return!1;return s.collectionGroup===e.collectionGroup&&!!s.path.isEqual(e.path)&&!!ah(s.startAt,e.startAt)&&ah(s.endAt,e.endAt)}function oc(s){return Ae.isDocumentKey(s.path)&&s.collectionGroup===null&&s.filters.length===0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class on{constructor(e,r=null,a=[],n=[],i=null,o="F",c=null,d=null){this.path=e,this.collectionGroup=r,this.explicitOrderBy=a,this.filters=n,this.limit=i,this.limitType=o,this.startAt=c,this.endAt=d,this.ce=null,this.le=null,this.he=null,this.startAt,this.endAt}}function uv(s,e,r,a,n,i,o,c){return new on(s,e,r,a,n,i,o,c)}function Po(s){return new on(s)}function ih(s){return s.filters.length===0&&s.limit===null&&s.startAt==null&&s.endAt==null&&(s.explicitOrderBy.length===0||s.explicitOrderBy.length===1&&s.explicitOrderBy[0].field.isKeyField())}function $m(s){return s.collectionGroup!==null}function Pn(s){const e=Ue(s);if(e.ce===null){e.ce=[];const r=new Set;for(const i of e.explicitOrderBy)e.ce.push(i),r.add(i.field.canonicalString());const a=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(o){let c=new Kt(Ht.comparator);return o.filters.forEach(d=>{d.getFlattenedFilters().forEach(u=>{u.isInequality()&&(c=c.add(u.field))})}),c})(e).forEach(i=>{r.has(i.canonicalString())||i.isKeyField()||e.ce.push(new Kn(i,a))}),r.has(Ht.keyField().canonicalString())||e.ce.push(new Kn(Ht.keyField(),a))}return e.ce}function Qr(s){const e=Ue(s);return e.le||(e.le=hv(e,Pn(s))),e.le}function hv(s,e){if(s.limitType==="F")return nh(s.path,s.collectionGroup,e,s.filters,s.limit,s.startAt,s.endAt);{e=e.map(n=>{const i=n.dir==="desc"?"asc":"desc";return new Kn(n.field,i)});const r=s.endAt?new io(s.endAt.position,s.endAt.inclusive):null,a=s.startAt?new io(s.startAt.position,s.startAt.inclusive):null;return nh(s.path,s.collectionGroup,e,s.filters,s.limit,r,a)}}function lc(s,e){const r=s.filters.concat([e]);return new on(s.path,s.collectionGroup,s.explicitOrderBy.slice(),r,s.limit,s.limitType,s.startAt,s.endAt)}function cc(s,e,r){return new on(s.path,s.collectionGroup,s.explicitOrderBy.slice(),s.filters.slice(),e,r,s.startAt,s.endAt)}function Mo(s,e){return qc(Qr(s),Qr(e))&&s.limitType===e.limitType}function Rm(s){return`${zc(Qr(s))}|lt:${s.limitType}`}function Da(s){return`Query(target=${function(r){let a=r.path.canonicalString();return r.collectionGroup!==null&&(a+=" collectionGroup="+r.collectionGroup),r.filters.length>0&&(a+=`, filters: [${r.filters.map(n=>Cm(n)).join(", ")}]`),Ro(r.limit)||(a+=", limit: "+r.limit),r.orderBy.length>0&&(a+=`, orderBy: [${r.orderBy.map(n=>function(o){return`${o.field.canonicalString()} (${o.dir})`}(n)).join(", ")}]`),r.startAt&&(a+=", startAt: ",a+=r.startAt.inclusive?"b:":"a:",a+=r.startAt.position.map(n=>Qa(n)).join(",")),r.endAt&&(a+=", endAt: ",a+=r.endAt.inclusive?"a:":"b:",a+=r.endAt.position.map(n=>Qa(n)).join(",")),`Target(${a})`}(Qr(s))}; limitType=${s.limitType})`}function Oo(s,e){return e.isFoundDocument()&&function(a,n){const i=n.key.path;return a.collectionGroup!==null?n.key.hasCollectionId(a.collectionGroup)&&a.path.isPrefixOf(i):Ae.isDocumentKey(a.path)?a.path.isEqual(i):a.path.isImmediateParentOf(i)}(s,e)&&function(a,n){for(const i of Pn(a))if(!i.field.isKeyField()&&n.data.field(i.field)===null)return!1;return!0}(s,e)&&function(a,n){for(const i of a.filters)if(!i.matches(n))return!1;return!0}(s,e)&&function(a,n){return!(a.startAt&&!function(o,c,d){const u=sh(o,c,d);return o.inclusive?u<=0:u<0}(a.startAt,Pn(a),n)||a.endAt&&!function(o,c,d){const u=sh(o,c,d);return o.inclusive?u>=0:u>0}(a.endAt,Pn(a),n))}(s,e)}function mv(s){return s.collectionGroup||(s.path.length%2==1?s.path.lastSegment():s.path.get(s.path.length-2))}function Pm(s){return(e,r)=>{let a=!1;for(const n of Pn(s)){const i=gv(n,e,r);if(i!==0)return i;a=a||n.field.isKeyField()}return 0}}function gv(s,e,r){const a=s.field.isKeyField()?Ae.comparator(e.key,r.key):function(i,o,c){const d=o.data.field(i),u=c.data.field(i);return d!==null&&u!==null?Ka(d,u):Ve()}(s.field,e,r);switch(s.dir){case"asc":return a;case"desc":return-1*a;default:return Ve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ln{constructor(e,r){this.mapKeyFn=e,this.equalsFn=r,this.inner={},this.innerSize=0}get(e){const r=this.mapKeyFn(e),a=this.inner[r];if(a!==void 0){for(const[n,i]of a)if(this.equalsFn(n,e))return i}}has(e){return this.get(e)!==void 0}set(e,r){const a=this.mapKeyFn(e),n=this.inner[a];if(n===void 0)return this.inner[a]=[[e,r]],void this.innerSize++;for(let i=0;i<n.length;i++)if(this.equalsFn(n[i][0],e))return void(n[i]=[e,r]);n.push([e,r]),this.innerSize++}delete(e){const r=this.mapKeyFn(e),a=this.inner[r];if(a===void 0)return!1;for(let n=0;n<a.length;n++)if(this.equalsFn(a[n][0],e))return a.length===1?delete this.inner[r]:a.splice(n,1),this.innerSize--,!0;return!1}forEach(e){Na(this.inner,(r,a)=>{for(const[n,i]of a)e(n,i)})}isEmpty(){return Nm(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pv=new yt(Ae.comparator);function ks(){return pv}const Mm=new yt(Ae.comparator);function In(...s){let e=Mm;for(const r of s)e=e.insert(r.key,r);return e}function Om(s){let e=Mm;return s.forEach((r,a)=>e=e.insert(r,a.overlayedDocument)),e}function ca(){return Mn()}function Vm(){return Mn()}function Mn(){return new ln(s=>s.toString(),(s,e)=>s.isEqual(e))}const xv=new yt(Ae.comparator),fv=new Kt(Ae.comparator);function He(...s){let e=fv;for(const r of s)e=e.add(r);return e}const bv=new Kt(Ze);function yv(){return bv}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Wc(s,e){if(s.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:no(e)?"-0":e}}function Lm(s){return{integerValue:""+s}}function vv(s,e){return Yy(e)?Lm(e):Wc(s,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vo{constructor(){this._=void 0}}function wv(s,e,r){return s instanceof oo?function(n,i){const o={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:n.seconds,nanos:n.nanoseconds}}}};return i&&Fc(i)&&(i=Uc(i)),i&&(o.fields.__previous_value__=i),{mapValue:o}}(r,e):s instanceof Qn?Um(s,e):s instanceof Yn?Bm(s,e):function(n,i){const o=Fm(n,i),c=oh(o)+oh(n.Pe);return nc(o)&&nc(n.Pe)?Lm(c):Wc(n.serializer,c)}(s,e)}function kv(s,e,r){return s instanceof Qn?Um(s,e):s instanceof Yn?Bm(s,e):r}function Fm(s,e){return s instanceof lo?function(a){return nc(a)||function(i){return!!i&&"doubleValue"in i}(a)}(e)?e:{integerValue:0}:null}class oo extends Vo{}class Qn extends Vo{constructor(e){super(),this.elements=e}}function Um(s,e){const r=zm(e);for(const a of s.elements)r.some(n=>rs(n,a))||r.push(a);return{arrayValue:{values:r}}}class Yn extends Vo{constructor(e){super(),this.elements=e}}function Bm(s,e){let r=zm(e);for(const a of s.elements)r=r.filter(n=>!rs(n,a));return{arrayValue:{values:r}}}class lo extends Vo{constructor(e,r){super(),this.serializer=e,this.Pe=r}}function oh(s){return _t(s.integerValue||s.doubleValue)}function zm(s){return Bc(s)&&s.arrayValue.values?s.arrayValue.values.slice():[]}function jv(s,e){return s.field.isEqual(e.field)&&function(a,n){return a instanceof Qn&&n instanceof Qn||a instanceof Yn&&n instanceof Yn?Ga(a.elements,n.elements,rs):a instanceof lo&&n instanceof lo?rs(a.Pe,n.Pe):a instanceof oo&&n instanceof oo}(s.transform,e.transform)}class Nv{constructor(e,r){this.version=e,this.transformResults=r}}class Mr{constructor(e,r){this.updateTime=e,this.exists=r}static none(){return new Mr}static exists(e){return new Mr(void 0,e)}static updateTime(e){return new Mr(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Li(s,e){return s.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(s.updateTime):s.exists===void 0||s.exists===e.isFoundDocument()}class Lo{}function qm(s,e){if(!s.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return s.isNoDocument()?new Hc(s.key,Mr.none()):new ii(s.key,s.data,Mr.none());{const r=s.data,a=br.empty();let n=new Kt(Ht.comparator);for(let i of e.fields)if(!n.has(i)){let o=r.field(i);o===null&&i.length>1&&(i=i.popLast(),o=r.field(i)),o===null?a.delete(i):a.set(i,o),n=n.add(i)}return new Js(s.key,a,new Nr(n.toArray()),Mr.none())}}function _v(s,e,r){s instanceof ii?function(n,i,o){const c=n.value.clone(),d=ch(n.fieldTransforms,i,o.transformResults);c.setAll(d),i.convertToFoundDocument(o.version,c).setHasCommittedMutations()}(s,e,r):s instanceof Js?function(n,i,o){if(!Li(n.precondition,i))return void i.convertToUnknownDocument(o.version);const c=ch(n.fieldTransforms,i,o.transformResults),d=i.data;d.setAll(Wm(n)),d.setAll(c),i.convertToFoundDocument(o.version,d).setHasCommittedMutations()}(s,e,r):function(n,i,o){i.convertToNoDocument(o.version).setHasCommittedMutations()}(0,e,r)}function On(s,e,r,a){return s instanceof ii?function(i,o,c,d){if(!Li(i.precondition,o))return c;const u=i.value.clone(),m=dh(i.fieldTransforms,d,o);return u.setAll(m),o.convertToFoundDocument(o.version,u).setHasLocalMutations(),null}(s,e,r,a):s instanceof Js?function(i,o,c,d){if(!Li(i.precondition,o))return c;const u=dh(i.fieldTransforms,d,o),m=o.data;return m.setAll(Wm(i)),m.setAll(u),o.convertToFoundDocument(o.version,m).setHasLocalMutations(),c===null?null:c.unionWith(i.fieldMask.fields).unionWith(i.fieldTransforms.map(f=>f.field))}(s,e,r,a):function(i,o,c){return Li(i.precondition,o)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):c}(s,e,r)}function Ev(s,e){let r=null;for(const a of s.fieldTransforms){const n=e.data.field(a.field),i=Fm(a.transform,n||null);i!=null&&(r===null&&(r=br.empty()),r.set(a.field,i))}return r||null}function lh(s,e){return s.type===e.type&&!!s.key.isEqual(e.key)&&!!s.precondition.isEqual(e.precondition)&&!!function(a,n){return a===void 0&&n===void 0||!(!a||!n)&&Ga(a,n,(i,o)=>jv(i,o))}(s.fieldTransforms,e.fieldTransforms)&&(s.type===0?s.value.isEqual(e.value):s.type!==1||s.data.isEqual(e.data)&&s.fieldMask.isEqual(e.fieldMask))}class ii extends Lo{constructor(e,r,a,n=[]){super(),this.key=e,this.value=r,this.precondition=a,this.fieldTransforms=n,this.type=0}getFieldMask(){return null}}class Js extends Lo{constructor(e,r,a,n,i=[]){super(),this.key=e,this.data=r,this.fieldMask=a,this.precondition=n,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function Wm(s){const e=new Map;return s.fieldMask.fields.forEach(r=>{if(!r.isEmpty()){const a=s.data.field(r);e.set(r,a)}}),e}function ch(s,e,r){const a=new Map;at(s.length===r.length);for(let n=0;n<r.length;n++){const i=s[n],o=i.transform,c=e.data.field(i.field);a.set(i.field,kv(o,c,r[n]))}return a}function dh(s,e,r){const a=new Map;for(const n of s){const i=n.transform,o=r.data.field(n.field);a.set(n.field,wv(i,o,e))}return a}class Hc extends Lo{constructor(e,r){super(),this.key=e,this.precondition=r,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class Tv extends Lo{constructor(e,r){super(),this.key=e,this.precondition=r,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sv{constructor(e,r,a,n){this.batchId=e,this.localWriteTime=r,this.baseMutations=a,this.mutations=n}applyToRemoteDocument(e,r){const a=r.mutationResults;for(let n=0;n<this.mutations.length;n++){const i=this.mutations[n];i.key.isEqual(e.key)&&_v(i,e,a[n])}}applyToLocalView(e,r){for(const a of this.baseMutations)a.key.isEqual(e.key)&&(r=On(a,e,r,this.localWriteTime));for(const a of this.mutations)a.key.isEqual(e.key)&&(r=On(a,e,r,this.localWriteTime));return r}applyToLocalDocumentSet(e,r){const a=Vm();return this.mutations.forEach(n=>{const i=e.get(n.key),o=i.overlayedDocument;let c=this.applyToLocalView(o,i.mutatedFields);c=r.has(n.key)?null:c;const d=qm(o,c);d!==null&&a.set(n.key,d),o.isValidDocument()||o.convertToNoDocument(Fe.min())}),a}keys(){return this.mutations.reduce((e,r)=>e.add(r.key),He())}isEqual(e){return this.batchId===e.batchId&&Ga(this.mutations,e.mutations,(r,a)=>lh(r,a))&&Ga(this.baseMutations,e.baseMutations,(r,a)=>lh(r,a))}}class Gc{constructor(e,r,a,n){this.batch=e,this.commitVersion=r,this.mutationResults=a,this.docVersions=n}static from(e,r,a){at(e.mutations.length===a.length);let n=function(){return xv}();const i=e.mutations;for(let o=0;o<i.length;o++)n=n.insert(i[o].key,a[o].version);return new Gc(e,r,a,n)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Iv{constructor(e,r){this.largestBatchId=e,this.mutation=r}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Av{constructor(e,r){this.count=e,this.unchangedNames=r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var It,Ye;function Cv(s){switch(s){default:return Ve();case ae.CANCELLED:case ae.UNKNOWN:case ae.DEADLINE_EXCEEDED:case ae.RESOURCE_EXHAUSTED:case ae.INTERNAL:case ae.UNAVAILABLE:case ae.UNAUTHENTICATED:return!1;case ae.INVALID_ARGUMENT:case ae.NOT_FOUND:case ae.ALREADY_EXISTS:case ae.PERMISSION_DENIED:case ae.FAILED_PRECONDITION:case ae.ABORTED:case ae.OUT_OF_RANGE:case ae.UNIMPLEMENTED:case ae.DATA_LOSS:return!0}}function Hm(s){if(s===void 0)return ws("GRPC error has no .code"),ae.UNKNOWN;switch(s){case It.OK:return ae.OK;case It.CANCELLED:return ae.CANCELLED;case It.UNKNOWN:return ae.UNKNOWN;case It.DEADLINE_EXCEEDED:return ae.DEADLINE_EXCEEDED;case It.RESOURCE_EXHAUSTED:return ae.RESOURCE_EXHAUSTED;case It.INTERNAL:return ae.INTERNAL;case It.UNAVAILABLE:return ae.UNAVAILABLE;case It.UNAUTHENTICATED:return ae.UNAUTHENTICATED;case It.INVALID_ARGUMENT:return ae.INVALID_ARGUMENT;case It.NOT_FOUND:return ae.NOT_FOUND;case It.ALREADY_EXISTS:return ae.ALREADY_EXISTS;case It.PERMISSION_DENIED:return ae.PERMISSION_DENIED;case It.FAILED_PRECONDITION:return ae.FAILED_PRECONDITION;case It.ABORTED:return ae.ABORTED;case It.OUT_OF_RANGE:return ae.OUT_OF_RANGE;case It.UNIMPLEMENTED:return ae.UNIMPLEMENTED;case It.DATA_LOSS:return ae.DATA_LOSS;default:return Ve()}}(Ye=It||(It={}))[Ye.OK=0]="OK",Ye[Ye.CANCELLED=1]="CANCELLED",Ye[Ye.UNKNOWN=2]="UNKNOWN",Ye[Ye.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Ye[Ye.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Ye[Ye.NOT_FOUND=5]="NOT_FOUND",Ye[Ye.ALREADY_EXISTS=6]="ALREADY_EXISTS",Ye[Ye.PERMISSION_DENIED=7]="PERMISSION_DENIED",Ye[Ye.UNAUTHENTICATED=16]="UNAUTHENTICATED",Ye[Ye.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Ye[Ye.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Ye[Ye.ABORTED=10]="ABORTED",Ye[Ye.OUT_OF_RANGE=11]="OUT_OF_RANGE",Ye[Ye.UNIMPLEMENTED=12]="UNIMPLEMENTED",Ye[Ye.INTERNAL=13]="INTERNAL",Ye[Ye.UNAVAILABLE=14]="UNAVAILABLE",Ye[Ye.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Dv(){return new TextEncoder}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $v=new ua([4294967295,4294967295],0);function uh(s){const e=Dv().encode(s),r=new xm;return r.update(e),new Uint8Array(r.digest())}function hh(s){const e=new DataView(s.buffer),r=e.getUint32(0,!0),a=e.getUint32(4,!0),n=e.getUint32(8,!0),i=e.getUint32(12,!0);return[new ua([r,a],0),new ua([n,i],0)]}class Kc{constructor(e,r,a){if(this.bitmap=e,this.padding=r,this.hashCount=a,r<0||r>=8)throw new An(`Invalid padding: ${r}`);if(a<0)throw new An(`Invalid hash count: ${a}`);if(e.length>0&&this.hashCount===0)throw new An(`Invalid hash count: ${a}`);if(e.length===0&&r!==0)throw new An(`Invalid padding when bitmap length is 0: ${r}`);this.Ie=8*e.length-r,this.Te=ua.fromNumber(this.Ie)}Ee(e,r,a){let n=e.add(r.multiply(ua.fromNumber(a)));return n.compare($v)===1&&(n=new ua([n.getBits(0),n.getBits(1)],0)),n.modulo(this.Te).toNumber()}de(e){return(this.bitmap[Math.floor(e/8)]&1<<e%8)!=0}mightContain(e){if(this.Ie===0)return!1;const r=uh(e),[a,n]=hh(r);for(let i=0;i<this.hashCount;i++){const o=this.Ee(a,n,i);if(!this.de(o))return!1}return!0}static create(e,r,a){const n=e%8==0?0:8-e%8,i=new Uint8Array(Math.ceil(e/8)),o=new Kc(i,n,r);return a.forEach(c=>o.insert(c)),o}insert(e){if(this.Ie===0)return;const r=uh(e),[a,n]=hh(r);for(let i=0;i<this.hashCount;i++){const o=this.Ee(a,n,i);this.Ae(o)}}Ae(e){const r=Math.floor(e/8),a=e%8;this.bitmap[r]|=1<<a}}class An extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fo{constructor(e,r,a,n,i){this.snapshotVersion=e,this.targetChanges=r,this.targetMismatches=a,this.documentUpdates=n,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,r,a){const n=new Map;return n.set(e,oi.createSynthesizedTargetChangeForCurrentChange(e,r,a)),new Fo(Fe.min(),n,new yt(Ze),ks(),He())}}class oi{constructor(e,r,a,n,i){this.resumeToken=e,this.current=r,this.addedDocuments=a,this.modifiedDocuments=n,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,r,a){return new oi(a,r,He(),He(),He())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fi{constructor(e,r,a,n){this.Re=e,this.removedTargetIds=r,this.key=a,this.Ve=n}}class Gm{constructor(e,r){this.targetId=e,this.me=r}}class Km{constructor(e,r,a=Qt.EMPTY_BYTE_STRING,n=null){this.state=e,this.targetIds=r,this.resumeToken=a,this.cause=n}}class mh{constructor(){this.fe=0,this.ge=ph(),this.pe=Qt.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return this.fe!==0}get be(){return this.we}De(e){e.approximateByteSize()>0&&(this.we=!0,this.pe=e)}ve(){let e=He(),r=He(),a=He();return this.ge.forEach((n,i)=>{switch(i){case 0:e=e.add(n);break;case 2:r=r.add(n);break;case 1:a=a.add(n);break;default:Ve()}}),new oi(this.pe,this.ye,e,r,a)}Ce(){this.we=!1,this.ge=ph()}Fe(e,r){this.we=!0,this.ge=this.ge.insert(e,r)}Me(e){this.we=!0,this.ge=this.ge.remove(e)}xe(){this.fe+=1}Oe(){this.fe-=1,at(this.fe>=0)}Ne(){this.we=!0,this.ye=!0}}class Rv{constructor(e){this.Le=e,this.Be=new Map,this.ke=ks(),this.qe=gh(),this.Qe=new yt(Ze)}Ke(e){for(const r of e.Re)e.Ve&&e.Ve.isFoundDocument()?this.$e(r,e.Ve):this.Ue(r,e.key,e.Ve);for(const r of e.removedTargetIds)this.Ue(r,e.key,e.Ve)}We(e){this.forEachTarget(e,r=>{const a=this.Ge(r);switch(e.state){case 0:this.ze(r)&&a.De(e.resumeToken);break;case 1:a.Oe(),a.Se||a.Ce(),a.De(e.resumeToken);break;case 2:a.Oe(),a.Se||this.removeTarget(r);break;case 3:this.ze(r)&&(a.Ne(),a.De(e.resumeToken));break;case 4:this.ze(r)&&(this.je(r),a.De(e.resumeToken));break;default:Ve()}})}forEachTarget(e,r){e.targetIds.length>0?e.targetIds.forEach(r):this.Be.forEach((a,n)=>{this.ze(n)&&r(n)})}He(e){const r=e.targetId,a=e.me.count,n=this.Je(r);if(n){const i=n.target;if(oc(i))if(a===0){const o=new Ae(i.path);this.Ue(r,o,sr.newNoDocument(o,Fe.min()))}else at(a===1);else{const o=this.Ye(r);if(o!==a){const c=this.Ze(e),d=c?this.Xe(c,e,o):1;if(d!==0){this.je(r);const u=d===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Qe=this.Qe.insert(r,u)}}}}}Ze(e){const r=e.me.unchangedNames;if(!r||!r.bits)return null;const{bits:{bitmap:a="",padding:n=0},hashCount:i=0}=r;let o,c;try{o=fa(a).toUint8Array()}catch(d){if(d instanceof _m)return Ha("Decoding the base64 bloom filter in existence filter failed ("+d.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw d}try{c=new Kc(o,n,i)}catch(d){return Ha(d instanceof An?"BloomFilter error: ":"Applying bloom filter failed: ",d),null}return c.Ie===0?null:c}Xe(e,r,a){return r.me.count===a-this.nt(e,r.targetId)?0:2}nt(e,r){const a=this.Le.getRemoteKeysForTarget(r);let n=0;return a.forEach(i=>{const o=this.Le.tt(),c=`projects/${o.projectId}/databases/${o.database}/documents/${i.path.canonicalString()}`;e.mightContain(c)||(this.Ue(r,i,null),n++)}),n}rt(e){const r=new Map;this.Be.forEach((i,o)=>{const c=this.Je(o);if(c){if(i.current&&oc(c.target)){const d=new Ae(c.target.path);this.ke.get(d)!==null||this.it(o,d)||this.Ue(o,d,sr.newNoDocument(d,e))}i.be&&(r.set(o,i.ve()),i.Ce())}});let a=He();this.qe.forEach((i,o)=>{let c=!0;o.forEachWhile(d=>{const u=this.Je(d);return!u||u.purpose==="TargetPurposeLimboResolution"||(c=!1,!1)}),c&&(a=a.add(i))}),this.ke.forEach((i,o)=>o.setReadTime(e));const n=new Fo(e,r,this.Qe,this.ke,a);return this.ke=ks(),this.qe=gh(),this.Qe=new yt(Ze),n}$e(e,r){if(!this.ze(e))return;const a=this.it(e,r.key)?2:0;this.Ge(e).Fe(r.key,a),this.ke=this.ke.insert(r.key,r),this.qe=this.qe.insert(r.key,this.st(r.key).add(e))}Ue(e,r,a){if(!this.ze(e))return;const n=this.Ge(e);this.it(e,r)?n.Fe(r,1):n.Me(r),this.qe=this.qe.insert(r,this.st(r).delete(e)),a&&(this.ke=this.ke.insert(r,a))}removeTarget(e){this.Be.delete(e)}Ye(e){const r=this.Ge(e).ve();return this.Le.getRemoteKeysForTarget(e).size+r.addedDocuments.size-r.removedDocuments.size}xe(e){this.Ge(e).xe()}Ge(e){let r=this.Be.get(e);return r||(r=new mh,this.Be.set(e,r)),r}st(e){let r=this.qe.get(e);return r||(r=new Kt(Ze),this.qe=this.qe.insert(e,r)),r}ze(e){const r=this.Je(e)!==null;return r||_e("WatchChangeAggregator","Detected inactive target",e),r}Je(e){const r=this.Be.get(e);return r&&r.Se?null:this.Le.ot(e)}je(e){this.Be.set(e,new mh),this.Le.getRemoteKeysForTarget(e).forEach(r=>{this.Ue(e,r,null)})}it(e,r){return this.Le.getRemoteKeysForTarget(e).has(r)}}function gh(){return new yt(Ae.comparator)}function ph(){return new yt(Ae.comparator)}const Pv={asc:"ASCENDING",desc:"DESCENDING"},Mv={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},Ov={and:"AND",or:"OR"};class Vv{constructor(e,r){this.databaseId=e,this.useProto3Json=r}}function dc(s,e){return s.useProto3Json||Ro(e)?e:{value:e}}function co(s,e){return s.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function Qm(s,e){return s.useProto3Json?e.toBase64():e.toUint8Array()}function Lv(s,e){return co(s,e.toTimestamp())}function Yr(s){return at(!!s),Fe.fromTimestamp(function(r){const a=Qs(r);return new Rt(a.seconds,a.nanos)}(s))}function Qc(s,e){return uc(s,e).canonicalString()}function uc(s,e){const r=function(n){return new gt(["projects",n.projectId,"databases",n.database])}(s).child("documents");return e===void 0?r:r.child(e)}function Ym(s){const e=gt.fromString(s);return at(tg(e)),e}function hc(s,e){return Qc(s.databaseId,e.path)}function Il(s,e){const r=Ym(e);if(r.get(1)!==s.databaseId.projectId)throw new we(ae.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+r.get(1)+" vs "+s.databaseId.projectId);if(r.get(3)!==s.databaseId.database)throw new we(ae.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+r.get(3)+" vs "+s.databaseId.database);return new Ae(Jm(r))}function Xm(s,e){return Qc(s.databaseId,e)}function Fv(s){const e=Ym(s);return e.length===4?gt.emptyPath():Jm(e)}function mc(s){return new gt(["projects",s.databaseId.projectId,"databases",s.databaseId.database]).canonicalString()}function Jm(s){return at(s.length>4&&s.get(4)==="documents"),s.popFirst(5)}function xh(s,e,r){return{name:hc(s,e),fields:r.value.mapValue.fields}}function Uv(s,e){let r;if("targetChange"in e){e.targetChange;const a=function(u){return u==="NO_CHANGE"?0:u==="ADD"?1:u==="REMOVE"?2:u==="CURRENT"?3:u==="RESET"?4:Ve()}(e.targetChange.targetChangeType||"NO_CHANGE"),n=e.targetChange.targetIds||[],i=function(u,m){return u.useProto3Json?(at(m===void 0||typeof m=="string"),Qt.fromBase64String(m||"")):(at(m===void 0||m instanceof Buffer||m instanceof Uint8Array),Qt.fromUint8Array(m||new Uint8Array))}(s,e.targetChange.resumeToken),o=e.targetChange.cause,c=o&&function(u){const m=u.code===void 0?ae.UNKNOWN:Hm(u.code);return new we(m,u.message||"")}(o);r=new Km(a,n,i,c||null)}else if("documentChange"in e){e.documentChange;const a=e.documentChange;a.document,a.document.name,a.document.updateTime;const n=Il(s,a.document.name),i=Yr(a.document.updateTime),o=a.document.createTime?Yr(a.document.createTime):Fe.min(),c=new br({mapValue:{fields:a.document.fields}}),d=sr.newFoundDocument(n,i,o,c),u=a.targetIds||[],m=a.removedTargetIds||[];r=new Fi(u,m,d.key,d)}else if("documentDelete"in e){e.documentDelete;const a=e.documentDelete;a.document;const n=Il(s,a.document),i=a.readTime?Yr(a.readTime):Fe.min(),o=sr.newNoDocument(n,i),c=a.removedTargetIds||[];r=new Fi([],c,o.key,o)}else if("documentRemove"in e){e.documentRemove;const a=e.documentRemove;a.document;const n=Il(s,a.document),i=a.removedTargetIds||[];r=new Fi([],i,n,null)}else{if(!("filter"in e))return Ve();{e.filter;const a=e.filter;a.targetId;const{count:n=0,unchangedNames:i}=a,o=new Av(n,i),c=a.targetId;r=new Gm(c,o)}}return r}function Bv(s,e){let r;if(e instanceof ii)r={update:xh(s,e.key,e.value)};else if(e instanceof Hc)r={delete:hc(s,e.key)};else if(e instanceof Js)r={update:xh(s,e.key,e.data),updateMask:Xv(e.fieldMask)};else{if(!(e instanceof Tv))return Ve();r={verify:hc(s,e.key)}}return e.fieldTransforms.length>0&&(r.updateTransforms=e.fieldTransforms.map(a=>function(i,o){const c=o.transform;if(c instanceof oo)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(c instanceof Qn)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:c.elements}};if(c instanceof Yn)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:c.elements}};if(c instanceof lo)return{fieldPath:o.field.canonicalString(),increment:c.Pe};throw Ve()}(0,a))),e.precondition.isNone||(r.currentDocument=function(n,i){return i.updateTime!==void 0?{updateTime:Lv(n,i.updateTime)}:i.exists!==void 0?{exists:i.exists}:Ve()}(s,e.precondition)),r}function zv(s,e){return s&&s.length>0?(at(e!==void 0),s.map(r=>function(n,i){let o=n.updateTime?Yr(n.updateTime):Yr(i);return o.isEqual(Fe.min())&&(o=Yr(i)),new Nv(o,n.transformResults||[])}(r,e))):[]}function qv(s,e){return{documents:[Xm(s,e.path)]}}function Wv(s,e){const r={structuredQuery:{}},a=e.path;let n;e.collectionGroup!==null?(n=a,r.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(n=a.popLast(),r.structuredQuery.from=[{collectionId:a.lastSegment()}]),r.parent=Xm(s,n);const i=function(u){if(u.length!==0)return eg(Or.create(u,"and"))}(e.filters);i&&(r.structuredQuery.where=i);const o=function(u){if(u.length!==0)return u.map(m=>function(x){return{field:$a(x.field),direction:Kv(x.dir)}}(m))}(e.orderBy);o&&(r.structuredQuery.orderBy=o);const c=dc(s,e.limit);return c!==null&&(r.structuredQuery.limit=c),e.startAt&&(r.structuredQuery.startAt=function(u){return{before:u.inclusive,values:u.position}}(e.startAt)),e.endAt&&(r.structuredQuery.endAt=function(u){return{before:!u.inclusive,values:u.position}}(e.endAt)),{_t:r,parent:n}}function Hv(s){let e=Fv(s.parent);const r=s.structuredQuery,a=r.from?r.from.length:0;let n=null;if(a>0){at(a===1);const m=r.from[0];m.allDescendants?n=m.collectionId:e=e.child(m.collectionId)}let i=[];r.where&&(i=function(f){const x=Zm(f);return x instanceof Or&&Im(x)?x.getFilters():[x]}(r.where));let o=[];r.orderBy&&(o=function(f){return f.map(x=>function(T){return new Kn(Ra(T.field),function(N){switch(N){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(T.direction))}(x))}(r.orderBy));let c=null;r.limit&&(c=function(f){let x;return x=typeof f=="object"?f.value:f,Ro(x)?null:x}(r.limit));let d=null;r.startAt&&(d=function(f){const x=!!f.before,v=f.values||[];return new io(v,x)}(r.startAt));let u=null;return r.endAt&&(u=function(f){const x=!f.before,v=f.values||[];return new io(v,x)}(r.endAt)),uv(e,n,o,i,c,"F",d,u)}function Gv(s,e){const r=function(n){switch(n){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return Ve()}}(e.purpose);return r==null?null:{"goog-listen-tags":r}}function Zm(s){return s.unaryFilter!==void 0?function(r){switch(r.unaryFilter.op){case"IS_NAN":const a=Ra(r.unaryFilter.field);return At.create(a,"==",{doubleValue:NaN});case"IS_NULL":const n=Ra(r.unaryFilter.field);return At.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const i=Ra(r.unaryFilter.field);return At.create(i,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const o=Ra(r.unaryFilter.field);return At.create(o,"!=",{nullValue:"NULL_VALUE"});default:return Ve()}}(s):s.fieldFilter!==void 0?function(r){return At.create(Ra(r.fieldFilter.field),function(n){switch(n){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return Ve()}}(r.fieldFilter.op),r.fieldFilter.value)}(s):s.compositeFilter!==void 0?function(r){return Or.create(r.compositeFilter.filters.map(a=>Zm(a)),function(n){switch(n){case"AND":return"and";case"OR":return"or";default:return Ve()}}(r.compositeFilter.op))}(s):Ve()}function Kv(s){return Pv[s]}function Qv(s){return Mv[s]}function Yv(s){return Ov[s]}function $a(s){return{fieldPath:s.canonicalString()}}function Ra(s){return Ht.fromServerFormat(s.fieldPath)}function eg(s){return s instanceof At?function(r){if(r.op==="=="){if(rh(r.value))return{unaryFilter:{field:$a(r.field),op:"IS_NAN"}};if(th(r.value))return{unaryFilter:{field:$a(r.field),op:"IS_NULL"}}}else if(r.op==="!="){if(rh(r.value))return{unaryFilter:{field:$a(r.field),op:"IS_NOT_NAN"}};if(th(r.value))return{unaryFilter:{field:$a(r.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:$a(r.field),op:Qv(r.op),value:r.value}}}(s):s instanceof Or?function(r){const a=r.getFilters().map(n=>eg(n));return a.length===1?a[0]:{compositeFilter:{op:Yv(r.op),filters:a}}}(s):Ve()}function Xv(s){const e=[];return s.fields.forEach(r=>e.push(r.canonicalString())),{fieldPaths:e}}function tg(s){return s.length>=4&&s.get(0)==="projects"&&s.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ls{constructor(e,r,a,n,i=Fe.min(),o=Fe.min(),c=Qt.EMPTY_BYTE_STRING,d=null){this.target=e,this.targetId=r,this.purpose=a,this.sequenceNumber=n,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=c,this.expectedCount=d}withSequenceNumber(e){return new Ls(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,r){return new Ls(this.target,this.targetId,this.purpose,this.sequenceNumber,r,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new Ls(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new Ls(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jv{constructor(e){this.ct=e}}function Zv(s){const e=Hv({parent:s.parent,structuredQuery:s.structuredQuery});return s.limitType==="LAST"?cc(e,e.limit,"L"):e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ew{constructor(){this.un=new tw}addToCollectionParentIndex(e,r){return this.un.add(r),de.resolve()}getCollectionParents(e,r){return de.resolve(this.un.getEntries(r))}addFieldIndex(e,r){return de.resolve()}deleteFieldIndex(e,r){return de.resolve()}deleteAllFieldIndexes(e){return de.resolve()}createTargetIndexes(e,r){return de.resolve()}getDocumentsMatchingTarget(e,r){return de.resolve(null)}getIndexType(e,r){return de.resolve(0)}getFieldIndexes(e,r){return de.resolve([])}getNextCollectionGroupToUpdate(e){return de.resolve(null)}getMinOffset(e,r){return de.resolve(Ks.min())}getMinOffsetFromCollectionGroup(e,r){return de.resolve(Ks.min())}updateCollectionGroup(e,r,a){return de.resolve()}updateIndexEntries(e,r){return de.resolve()}}class tw{constructor(){this.index={}}add(e){const r=e.lastSegment(),a=e.popLast(),n=this.index[r]||new Kt(gt.comparator),i=!n.has(a);return this.index[r]=n.add(a),i}has(e){const r=e.lastSegment(),a=e.popLast(),n=this.index[r];return n&&n.has(a)}getEntries(e){return(this.index[e]||new Kt(gt.comparator)).toArray()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ya{constructor(e){this.Ln=e}next(){return this.Ln+=2,this.Ln}static Bn(){return new Ya(0)}static kn(){return new Ya(-1)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rw{constructor(){this.changes=new ln(e=>e.toString(),(e,r)=>e.isEqual(r)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,r){this.assertNotApplied(),this.changes.set(e,sr.newInvalidDocument(e).setReadTime(r))}getEntry(e,r){this.assertNotApplied();const a=this.changes.get(r);return a!==void 0?de.resolve(a):this.getFromCache(e,r)}getEntries(e,r){return this.getAllFromCache(e,r)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sw{constructor(e,r){this.overlayedDocument=e,this.mutatedFields=r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aw{constructor(e,r,a,n){this.remoteDocumentCache=e,this.mutationQueue=r,this.documentOverlayCache=a,this.indexManager=n}getDocument(e,r){let a=null;return this.documentOverlayCache.getOverlay(e,r).next(n=>(a=n,this.remoteDocumentCache.getEntry(e,r))).next(n=>(a!==null&&On(a.mutation,n,Nr.empty(),Rt.now()),n))}getDocuments(e,r){return this.remoteDocumentCache.getEntries(e,r).next(a=>this.getLocalViewOfDocuments(e,a,He()).next(()=>a))}getLocalViewOfDocuments(e,r,a=He()){const n=ca();return this.populateOverlays(e,n,r).next(()=>this.computeViews(e,r,n,a).next(i=>{let o=In();return i.forEach((c,d)=>{o=o.insert(c,d.overlayedDocument)}),o}))}getOverlayedDocuments(e,r){const a=ca();return this.populateOverlays(e,a,r).next(()=>this.computeViews(e,r,a,He()))}populateOverlays(e,r,a){const n=[];return a.forEach(i=>{r.has(i)||n.push(i)}),this.documentOverlayCache.getOverlays(e,n).next(i=>{i.forEach((o,c)=>{r.set(o,c)})})}computeViews(e,r,a,n){let i=ks();const o=Mn(),c=function(){return Mn()}();return r.forEach((d,u)=>{const m=a.get(u.key);n.has(u.key)&&(m===void 0||m.mutation instanceof Js)?i=i.insert(u.key,u):m!==void 0?(o.set(u.key,m.mutation.getFieldMask()),On(m.mutation,u,m.mutation.getFieldMask(),Rt.now())):o.set(u.key,Nr.empty())}),this.recalculateAndSaveOverlays(e,i).next(d=>(d.forEach((u,m)=>o.set(u,m)),r.forEach((u,m)=>{var f;return c.set(u,new sw(m,(f=o.get(u))!==null&&f!==void 0?f:null))}),c))}recalculateAndSaveOverlays(e,r){const a=Mn();let n=new yt((o,c)=>o-c),i=He();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,r).next(o=>{for(const c of o)c.keys().forEach(d=>{const u=r.get(d);if(u===null)return;let m=a.get(d)||Nr.empty();m=c.applyToLocalView(u,m),a.set(d,m);const f=(n.get(c.batchId)||He()).add(d);n=n.insert(c.batchId,f)})}).next(()=>{const o=[],c=n.getReverseIterator();for(;c.hasNext();){const d=c.getNext(),u=d.key,m=d.value,f=Vm();m.forEach(x=>{if(!i.has(x)){const v=qm(r.get(x),a.get(x));v!==null&&f.set(x,v),i=i.add(x)}}),o.push(this.documentOverlayCache.saveOverlays(e,u,f))}return de.waitFor(o)}).next(()=>a)}recalculateAndSaveOverlaysForDocumentKeys(e,r){return this.remoteDocumentCache.getEntries(e,r).next(a=>this.recalculateAndSaveOverlays(e,a))}getDocumentsMatchingQuery(e,r,a,n){return function(o){return Ae.isDocumentKey(o.path)&&o.collectionGroup===null&&o.filters.length===0}(r)?this.getDocumentsMatchingDocumentQuery(e,r.path):$m(r)?this.getDocumentsMatchingCollectionGroupQuery(e,r,a,n):this.getDocumentsMatchingCollectionQuery(e,r,a,n)}getNextDocuments(e,r,a,n){return this.remoteDocumentCache.getAllFromCollectionGroup(e,r,a,n).next(i=>{const o=n-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,r,a.largestBatchId,n-i.size):de.resolve(ca());let c=-1,d=i;return o.next(u=>de.forEach(u,(m,f)=>(c<f.largestBatchId&&(c=f.largestBatchId),i.get(m)?de.resolve():this.remoteDocumentCache.getEntry(e,m).next(x=>{d=d.insert(m,x)}))).next(()=>this.populateOverlays(e,u,i)).next(()=>this.computeViews(e,d,u,He())).next(m=>({batchId:c,changes:Om(m)})))})}getDocumentsMatchingDocumentQuery(e,r){return this.getDocument(e,new Ae(r)).next(a=>{let n=In();return a.isFoundDocument()&&(n=n.insert(a.key,a)),n})}getDocumentsMatchingCollectionGroupQuery(e,r,a,n){const i=r.collectionGroup;let o=In();return this.indexManager.getCollectionParents(e,i).next(c=>de.forEach(c,d=>{const u=function(f,x){return new on(x,null,f.explicitOrderBy.slice(),f.filters.slice(),f.limit,f.limitType,f.startAt,f.endAt)}(r,d.child(i));return this.getDocumentsMatchingCollectionQuery(e,u,a,n).next(m=>{m.forEach((f,x)=>{o=o.insert(f,x)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(e,r,a,n){let i;return this.documentOverlayCache.getOverlaysForCollection(e,r.path,a.largestBatchId).next(o=>(i=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,r,a,i,n))).next(o=>{i.forEach((d,u)=>{const m=u.getKey();o.get(m)===null&&(o=o.insert(m,sr.newInvalidDocument(m)))});let c=In();return o.forEach((d,u)=>{const m=i.get(d);m!==void 0&&On(m.mutation,u,Nr.empty(),Rt.now()),Oo(r,u)&&(c=c.insert(d,u))}),c})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nw{constructor(e){this.serializer=e,this.hr=new Map,this.Pr=new Map}getBundleMetadata(e,r){return de.resolve(this.hr.get(r))}saveBundleMetadata(e,r){return this.hr.set(r.id,function(n){return{id:n.id,version:n.version,createTime:Yr(n.createTime)}}(r)),de.resolve()}getNamedQuery(e,r){return de.resolve(this.Pr.get(r))}saveNamedQuery(e,r){return this.Pr.set(r.name,function(n){return{name:n.name,query:Zv(n.bundledQuery),readTime:Yr(n.readTime)}}(r)),de.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iw{constructor(){this.overlays=new yt(Ae.comparator),this.Ir=new Map}getOverlay(e,r){return de.resolve(this.overlays.get(r))}getOverlays(e,r){const a=ca();return de.forEach(r,n=>this.getOverlay(e,n).next(i=>{i!==null&&a.set(n,i)})).next(()=>a)}saveOverlays(e,r,a){return a.forEach((n,i)=>{this.ht(e,r,i)}),de.resolve()}removeOverlaysForBatchId(e,r,a){const n=this.Ir.get(a);return n!==void 0&&(n.forEach(i=>this.overlays=this.overlays.remove(i)),this.Ir.delete(a)),de.resolve()}getOverlaysForCollection(e,r,a){const n=ca(),i=r.length+1,o=new Ae(r.child("")),c=this.overlays.getIteratorFrom(o);for(;c.hasNext();){const d=c.getNext().value,u=d.getKey();if(!r.isPrefixOf(u.path))break;u.path.length===i&&d.largestBatchId>a&&n.set(d.getKey(),d)}return de.resolve(n)}getOverlaysForCollectionGroup(e,r,a,n){let i=new yt((u,m)=>u-m);const o=this.overlays.getIterator();for(;o.hasNext();){const u=o.getNext().value;if(u.getKey().getCollectionGroup()===r&&u.largestBatchId>a){let m=i.get(u.largestBatchId);m===null&&(m=ca(),i=i.insert(u.largestBatchId,m)),m.set(u.getKey(),u)}}const c=ca(),d=i.getIterator();for(;d.hasNext()&&(d.getNext().value.forEach((u,m)=>c.set(u,m)),!(c.size()>=n)););return de.resolve(c)}ht(e,r,a){const n=this.overlays.get(a.key);if(n!==null){const o=this.Ir.get(n.largestBatchId).delete(a.key);this.Ir.set(n.largestBatchId,o)}this.overlays=this.overlays.insert(a.key,new Iv(r,a));let i=this.Ir.get(r);i===void 0&&(i=He(),this.Ir.set(r,i)),this.Ir.set(r,i.add(a.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ow{constructor(){this.sessionToken=Qt.EMPTY_BYTE_STRING}getSessionToken(e){return de.resolve(this.sessionToken)}setSessionToken(e,r){return this.sessionToken=r,de.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yc{constructor(){this.Tr=new Kt(Mt.Er),this.dr=new Kt(Mt.Ar)}isEmpty(){return this.Tr.isEmpty()}addReference(e,r){const a=new Mt(e,r);this.Tr=this.Tr.add(a),this.dr=this.dr.add(a)}Rr(e,r){e.forEach(a=>this.addReference(a,r))}removeReference(e,r){this.Vr(new Mt(e,r))}mr(e,r){e.forEach(a=>this.removeReference(a,r))}gr(e){const r=new Ae(new gt([])),a=new Mt(r,e),n=new Mt(r,e+1),i=[];return this.dr.forEachInRange([a,n],o=>{this.Vr(o),i.push(o.key)}),i}pr(){this.Tr.forEach(e=>this.Vr(e))}Vr(e){this.Tr=this.Tr.delete(e),this.dr=this.dr.delete(e)}yr(e){const r=new Ae(new gt([])),a=new Mt(r,e),n=new Mt(r,e+1);let i=He();return this.dr.forEachInRange([a,n],o=>{i=i.add(o.key)}),i}containsKey(e){const r=new Mt(e,0),a=this.Tr.firstAfterOrEqual(r);return a!==null&&e.isEqual(a.key)}}class Mt{constructor(e,r){this.key=e,this.wr=r}static Er(e,r){return Ae.comparator(e.key,r.key)||Ze(e.wr,r.wr)}static Ar(e,r){return Ze(e.wr,r.wr)||Ae.comparator(e.key,r.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lw{constructor(e,r){this.indexManager=e,this.referenceDelegate=r,this.mutationQueue=[],this.Sr=1,this.br=new Kt(Mt.Er)}checkEmpty(e){return de.resolve(this.mutationQueue.length===0)}addMutationBatch(e,r,a,n){const i=this.Sr;this.Sr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const o=new Sv(i,r,a,n);this.mutationQueue.push(o);for(const c of n)this.br=this.br.add(new Mt(c.key,i)),this.indexManager.addToCollectionParentIndex(e,c.key.path.popLast());return de.resolve(o)}lookupMutationBatch(e,r){return de.resolve(this.Dr(r))}getNextMutationBatchAfterBatchId(e,r){const a=r+1,n=this.vr(a),i=n<0?0:n;return de.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return de.resolve(this.mutationQueue.length===0?-1:this.Sr-1)}getAllMutationBatches(e){return de.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,r){const a=new Mt(r,0),n=new Mt(r,Number.POSITIVE_INFINITY),i=[];return this.br.forEachInRange([a,n],o=>{const c=this.Dr(o.wr);i.push(c)}),de.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,r){let a=new Kt(Ze);return r.forEach(n=>{const i=new Mt(n,0),o=new Mt(n,Number.POSITIVE_INFINITY);this.br.forEachInRange([i,o],c=>{a=a.add(c.wr)})}),de.resolve(this.Cr(a))}getAllMutationBatchesAffectingQuery(e,r){const a=r.path,n=a.length+1;let i=a;Ae.isDocumentKey(i)||(i=i.child(""));const o=new Mt(new Ae(i),0);let c=new Kt(Ze);return this.br.forEachWhile(d=>{const u=d.key.path;return!!a.isPrefixOf(u)&&(u.length===n&&(c=c.add(d.wr)),!0)},o),de.resolve(this.Cr(c))}Cr(e){const r=[];return e.forEach(a=>{const n=this.Dr(a);n!==null&&r.push(n)}),r}removeMutationBatch(e,r){at(this.Fr(r.batchId,"removed")===0),this.mutationQueue.shift();let a=this.br;return de.forEach(r.mutations,n=>{const i=new Mt(n.key,r.batchId);return a=a.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,n.key)}).next(()=>{this.br=a})}On(e){}containsKey(e,r){const a=new Mt(r,0),n=this.br.firstAfterOrEqual(a);return de.resolve(r.isEqual(n&&n.key))}performConsistencyCheck(e){return this.mutationQueue.length,de.resolve()}Fr(e,r){return this.vr(e)}vr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Dr(e){const r=this.vr(e);return r<0||r>=this.mutationQueue.length?null:this.mutationQueue[r]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cw{constructor(e){this.Mr=e,this.docs=function(){return new yt(Ae.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,r){const a=r.key,n=this.docs.get(a),i=n?n.size:0,o=this.Mr(r);return this.docs=this.docs.insert(a,{document:r.mutableCopy(),size:o}),this.size+=o-i,this.indexManager.addToCollectionParentIndex(e,a.path.popLast())}removeEntry(e){const r=this.docs.get(e);r&&(this.docs=this.docs.remove(e),this.size-=r.size)}getEntry(e,r){const a=this.docs.get(r);return de.resolve(a?a.document.mutableCopy():sr.newInvalidDocument(r))}getEntries(e,r){let a=ks();return r.forEach(n=>{const i=this.docs.get(n);a=a.insert(n,i?i.document.mutableCopy():sr.newInvalidDocument(n))}),de.resolve(a)}getDocumentsMatchingQuery(e,r,a,n){let i=ks();const o=r.path,c=new Ae(o.child("")),d=this.docs.getIteratorFrom(c);for(;d.hasNext();){const{key:u,value:{document:m}}=d.getNext();if(!o.isPrefixOf(u.path))break;u.path.length>o.length+1||Hy(Wy(m),a)<=0||(n.has(m.key)||Oo(r,m))&&(i=i.insert(m.key,m.mutableCopy()))}return de.resolve(i)}getAllFromCollectionGroup(e,r,a,n){Ve()}Or(e,r){return de.forEach(this.docs,a=>r(a))}newChangeBuffer(e){return new dw(this)}getSize(e){return de.resolve(this.size)}}class dw extends rw{constructor(e){super(),this.cr=e}applyChanges(e){const r=[];return this.changes.forEach((a,n)=>{n.isValidDocument()?r.push(this.cr.addEntry(e,n)):this.cr.removeEntry(a)}),de.waitFor(r)}getFromCache(e,r){return this.cr.getEntry(e,r)}getAllFromCache(e,r){return this.cr.getEntries(e,r)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uw{constructor(e){this.persistence=e,this.Nr=new ln(r=>zc(r),qc),this.lastRemoteSnapshotVersion=Fe.min(),this.highestTargetId=0,this.Lr=0,this.Br=new Yc,this.targetCount=0,this.kr=Ya.Bn()}forEachTarget(e,r){return this.Nr.forEach((a,n)=>r(n)),de.resolve()}getLastRemoteSnapshotVersion(e){return de.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return de.resolve(this.Lr)}allocateTargetId(e){return this.highestTargetId=this.kr.next(),de.resolve(this.highestTargetId)}setTargetsMetadata(e,r,a){return a&&(this.lastRemoteSnapshotVersion=a),r>this.Lr&&(this.Lr=r),de.resolve()}Kn(e){this.Nr.set(e.target,e);const r=e.targetId;r>this.highestTargetId&&(this.kr=new Ya(r),this.highestTargetId=r),e.sequenceNumber>this.Lr&&(this.Lr=e.sequenceNumber)}addTargetData(e,r){return this.Kn(r),this.targetCount+=1,de.resolve()}updateTargetData(e,r){return this.Kn(r),de.resolve()}removeTargetData(e,r){return this.Nr.delete(r.target),this.Br.gr(r.targetId),this.targetCount-=1,de.resolve()}removeTargets(e,r,a){let n=0;const i=[];return this.Nr.forEach((o,c)=>{c.sequenceNumber<=r&&a.get(c.targetId)===null&&(this.Nr.delete(o),i.push(this.removeMatchingKeysForTargetId(e,c.targetId)),n++)}),de.waitFor(i).next(()=>n)}getTargetCount(e){return de.resolve(this.targetCount)}getTargetData(e,r){const a=this.Nr.get(r)||null;return de.resolve(a)}addMatchingKeys(e,r,a){return this.Br.Rr(r,a),de.resolve()}removeMatchingKeys(e,r,a){this.Br.mr(r,a);const n=this.persistence.referenceDelegate,i=[];return n&&r.forEach(o=>{i.push(n.markPotentiallyOrphaned(e,o))}),de.waitFor(i)}removeMatchingKeysForTargetId(e,r){return this.Br.gr(r),de.resolve()}getMatchingKeysForTargetId(e,r){const a=this.Br.yr(r);return de.resolve(a)}containsKey(e,r){return de.resolve(this.Br.containsKey(r))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hw{constructor(e,r){this.qr={},this.overlays={},this.Qr=new Lc(0),this.Kr=!1,this.Kr=!0,this.$r=new ow,this.referenceDelegate=e(this),this.Ur=new uw(this),this.indexManager=new ew,this.remoteDocumentCache=function(n){return new cw(n)}(a=>this.referenceDelegate.Wr(a)),this.serializer=new Jv(r),this.Gr=new nw(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Kr=!1,Promise.resolve()}get started(){return this.Kr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let r=this.overlays[e.toKey()];return r||(r=new iw,this.overlays[e.toKey()]=r),r}getMutationQueue(e,r){let a=this.qr[e.toKey()];return a||(a=new lw(r,this.referenceDelegate),this.qr[e.toKey()]=a),a}getGlobalsCache(){return this.$r}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Gr}runTransaction(e,r,a){_e("MemoryPersistence","Starting transaction:",e);const n=new mw(this.Qr.next());return this.referenceDelegate.zr(),a(n).next(i=>this.referenceDelegate.jr(n).next(()=>i)).toPromise().then(i=>(n.raiseOnCommittedEvent(),i))}Hr(e,r){return de.or(Object.values(this.qr).map(a=>()=>a.containsKey(e,r)))}}class mw extends Ky{constructor(e){super(),this.currentSequenceNumber=e}}class Xc{constructor(e){this.persistence=e,this.Jr=new Yc,this.Yr=null}static Zr(e){return new Xc(e)}get Xr(){if(this.Yr)return this.Yr;throw Ve()}addReference(e,r,a){return this.Jr.addReference(a,r),this.Xr.delete(a.toString()),de.resolve()}removeReference(e,r,a){return this.Jr.removeReference(a,r),this.Xr.add(a.toString()),de.resolve()}markPotentiallyOrphaned(e,r){return this.Xr.add(r.toString()),de.resolve()}removeTarget(e,r){this.Jr.gr(r.targetId).forEach(n=>this.Xr.add(n.toString()));const a=this.persistence.getTargetCache();return a.getMatchingKeysForTargetId(e,r.targetId).next(n=>{n.forEach(i=>this.Xr.add(i.toString()))}).next(()=>a.removeTargetData(e,r))}zr(){this.Yr=new Set}jr(e){const r=this.persistence.getRemoteDocumentCache().newChangeBuffer();return de.forEach(this.Xr,a=>{const n=Ae.fromPath(a);return this.ei(e,n).next(i=>{i||r.removeEntry(n,Fe.min())})}).next(()=>(this.Yr=null,r.apply(e)))}updateLimboDocument(e,r){return this.ei(e,r).next(a=>{a?this.Xr.delete(r.toString()):this.Xr.add(r.toString())})}Wr(e){return 0}ei(e,r){return de.or([()=>de.resolve(this.Jr.containsKey(r)),()=>this.persistence.getTargetCache().containsKey(e,r),()=>this.persistence.Hr(e,r)])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jc{constructor(e,r,a,n){this.targetId=e,this.fromCache=r,this.$i=a,this.Ui=n}static Wi(e,r){let a=He(),n=He();for(const i of r.docChanges)switch(i.type){case 0:a=a.add(i.doc.key);break;case 1:n=n.add(i.doc.key)}return new Jc(e,r.fromCache,a,n)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gw{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pw{constructor(){this.Gi=!1,this.zi=!1,this.ji=100,this.Hi=function(){return bb()?8:Qy(or())>0?6:4}()}initialize(e,r){this.Ji=e,this.indexManager=r,this.Gi=!0}getDocumentsMatchingQuery(e,r,a,n){const i={result:null};return this.Yi(e,r).next(o=>{i.result=o}).next(()=>{if(!i.result)return this.Zi(e,r,n,a).next(o=>{i.result=o})}).next(()=>{if(i.result)return;const o=new gw;return this.Xi(e,r,o).next(c=>{if(i.result=c,this.zi)return this.es(e,r,o,c.size)})}).next(()=>i.result)}es(e,r,a,n){return a.documentReadCount<this.ji?(kn()<=Ke.DEBUG&&_e("QueryEngine","SDK will not create cache indexes for query:",Da(r),"since it only creates cache indexes for collection contains","more than or equal to",this.ji,"documents"),de.resolve()):(kn()<=Ke.DEBUG&&_e("QueryEngine","Query:",Da(r),"scans",a.documentReadCount,"local documents and returns",n,"documents as results."),a.documentReadCount>this.Hi*n?(kn()<=Ke.DEBUG&&_e("QueryEngine","The SDK decides to create cache indexes for query:",Da(r),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Qr(r))):de.resolve())}Yi(e,r){if(ih(r))return de.resolve(null);let a=Qr(r);return this.indexManager.getIndexType(e,a).next(n=>n===0?null:(r.limit!==null&&n===1&&(r=cc(r,null,"F"),a=Qr(r)),this.indexManager.getDocumentsMatchingTarget(e,a).next(i=>{const o=He(...i);return this.Ji.getDocuments(e,o).next(c=>this.indexManager.getMinOffset(e,a).next(d=>{const u=this.ts(r,c);return this.ns(r,u,o,d.readTime)?this.Yi(e,cc(r,null,"F")):this.rs(e,u,r,d)}))})))}Zi(e,r,a,n){return ih(r)||n.isEqual(Fe.min())?de.resolve(null):this.Ji.getDocuments(e,a).next(i=>{const o=this.ts(r,i);return this.ns(r,o,a,n)?de.resolve(null):(kn()<=Ke.DEBUG&&_e("QueryEngine","Re-using previous result from %s to execute query: %s",n.toString(),Da(r)),this.rs(e,o,r,qy(n,-1)).next(c=>c))})}ts(e,r){let a=new Kt(Pm(e));return r.forEach((n,i)=>{Oo(e,i)&&(a=a.add(i))}),a}ns(e,r,a,n){if(e.limit===null)return!1;if(a.size!==r.size)return!0;const i=e.limitType==="F"?r.last():r.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(n)>0)}Xi(e,r,a){return kn()<=Ke.DEBUG&&_e("QueryEngine","Using full collection scan to execute query:",Da(r)),this.Ji.getDocumentsMatchingQuery(e,r,Ks.min(),a)}rs(e,r,a,n){return this.Ji.getDocumentsMatchingQuery(e,a,n).next(i=>(r.forEach(o=>{i=i.insert(o.key,o)}),i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xw{constructor(e,r,a,n){this.persistence=e,this.ss=r,this.serializer=n,this.os=new yt(Ze),this._s=new ln(i=>zc(i),qc),this.us=new Map,this.cs=e.getRemoteDocumentCache(),this.Ur=e.getTargetCache(),this.Gr=e.getBundleCache(),this.ls(a)}ls(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new aw(this.cs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.cs.setIndexManager(this.indexManager),this.ss.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",r=>e.collect(r,this.os))}}function fw(s,e,r,a){return new xw(s,e,r,a)}async function rg(s,e){const r=Ue(s);return await r.persistence.runTransaction("Handle user change","readonly",a=>{let n;return r.mutationQueue.getAllMutationBatches(a).next(i=>(n=i,r.ls(e),r.mutationQueue.getAllMutationBatches(a))).next(i=>{const o=[],c=[];let d=He();for(const u of n){o.push(u.batchId);for(const m of u.mutations)d=d.add(m.key)}for(const u of i){c.push(u.batchId);for(const m of u.mutations)d=d.add(m.key)}return r.localDocuments.getDocuments(a,d).next(u=>({hs:u,removedBatchIds:o,addedBatchIds:c}))})})}function bw(s,e){const r=Ue(s);return r.persistence.runTransaction("Acknowledge batch","readwrite-primary",a=>{const n=e.batch.keys(),i=r.cs.newChangeBuffer({trackRemovals:!0});return function(c,d,u,m){const f=u.batch,x=f.keys();let v=de.resolve();return x.forEach(T=>{v=v.next(()=>m.getEntry(d,T)).next(I=>{const N=u.docVersions.get(T);at(N!==null),I.version.compareTo(N)<0&&(f.applyToRemoteDocument(I,u),I.isValidDocument()&&(I.setReadTime(u.commitVersion),m.addEntry(I)))})}),v.next(()=>c.mutationQueue.removeMutationBatch(d,f))}(r,a,e,i).next(()=>i.apply(a)).next(()=>r.mutationQueue.performConsistencyCheck(a)).next(()=>r.documentOverlayCache.removeOverlaysForBatchId(a,n,e.batch.batchId)).next(()=>r.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(a,function(c){let d=He();for(let u=0;u<c.mutationResults.length;++u)c.mutationResults[u].transformResults.length>0&&(d=d.add(c.batch.mutations[u].key));return d}(e))).next(()=>r.localDocuments.getDocuments(a,n))})}function sg(s){const e=Ue(s);return e.persistence.runTransaction("Get last remote snapshot version","readonly",r=>e.Ur.getLastRemoteSnapshotVersion(r))}function yw(s,e){const r=Ue(s),a=e.snapshotVersion;let n=r.os;return r.persistence.runTransaction("Apply remote event","readwrite-primary",i=>{const o=r.cs.newChangeBuffer({trackRemovals:!0});n=r.os;const c=[];e.targetChanges.forEach((m,f)=>{const x=n.get(f);if(!x)return;c.push(r.Ur.removeMatchingKeys(i,m.removedDocuments,f).next(()=>r.Ur.addMatchingKeys(i,m.addedDocuments,f)));let v=x.withSequenceNumber(i.currentSequenceNumber);e.targetMismatches.get(f)!==null?v=v.withResumeToken(Qt.EMPTY_BYTE_STRING,Fe.min()).withLastLimboFreeSnapshotVersion(Fe.min()):m.resumeToken.approximateByteSize()>0&&(v=v.withResumeToken(m.resumeToken,a)),n=n.insert(f,v),function(I,N,O){return I.resumeToken.approximateByteSize()===0||N.snapshotVersion.toMicroseconds()-I.snapshotVersion.toMicroseconds()>=3e8?!0:O.addedDocuments.size+O.modifiedDocuments.size+O.removedDocuments.size>0}(x,v,m)&&c.push(r.Ur.updateTargetData(i,v))});let d=ks(),u=He();if(e.documentUpdates.forEach(m=>{e.resolvedLimboDocuments.has(m)&&c.push(r.persistence.referenceDelegate.updateLimboDocument(i,m))}),c.push(vw(i,o,e.documentUpdates).next(m=>{d=m.Ps,u=m.Is})),!a.isEqual(Fe.min())){const m=r.Ur.getLastRemoteSnapshotVersion(i).next(f=>r.Ur.setTargetsMetadata(i,i.currentSequenceNumber,a));c.push(m)}return de.waitFor(c).next(()=>o.apply(i)).next(()=>r.localDocuments.getLocalViewOfDocuments(i,d,u)).next(()=>d)}).then(i=>(r.os=n,i))}function vw(s,e,r){let a=He(),n=He();return r.forEach(i=>a=a.add(i)),e.getEntries(s,a).next(i=>{let o=ks();return r.forEach((c,d)=>{const u=i.get(c);d.isFoundDocument()!==u.isFoundDocument()&&(n=n.add(c)),d.isNoDocument()&&d.version.isEqual(Fe.min())?(e.removeEntry(c,d.readTime),o=o.insert(c,d)):!u.isValidDocument()||d.version.compareTo(u.version)>0||d.version.compareTo(u.version)===0&&u.hasPendingWrites?(e.addEntry(d),o=o.insert(c,d)):_e("LocalStore","Ignoring outdated watch update for ",c,". Current version:",u.version," Watch version:",d.version)}),{Ps:o,Is:n}})}function ww(s,e){const r=Ue(s);return r.persistence.runTransaction("Get next mutation batch","readonly",a=>(e===void 0&&(e=-1),r.mutationQueue.getNextMutationBatchAfterBatchId(a,e)))}function kw(s,e){const r=Ue(s);return r.persistence.runTransaction("Allocate target","readwrite",a=>{let n;return r.Ur.getTargetData(a,e).next(i=>i?(n=i,de.resolve(n)):r.Ur.allocateTargetId(a).next(o=>(n=new Ls(e,o,"TargetPurposeListen",a.currentSequenceNumber),r.Ur.addTargetData(a,n).next(()=>n))))}).then(a=>{const n=r.os.get(a.targetId);return(n===null||a.snapshotVersion.compareTo(n.snapshotVersion)>0)&&(r.os=r.os.insert(a.targetId,a),r._s.set(e,a.targetId)),a})}async function gc(s,e,r){const a=Ue(s),n=a.os.get(e),i=r?"readwrite":"readwrite-primary";try{r||await a.persistence.runTransaction("Release target",i,o=>a.persistence.referenceDelegate.removeTarget(o,n))}catch(o){if(!ni(o))throw o;_e("LocalStore",`Failed to update sequence numbers for target ${e}: ${o}`)}a.os=a.os.remove(e),a._s.delete(n.target)}function fh(s,e,r){const a=Ue(s);let n=Fe.min(),i=He();return a.persistence.runTransaction("Execute query","readwrite",o=>function(d,u,m){const f=Ue(d),x=f._s.get(m);return x!==void 0?de.resolve(f.os.get(x)):f.Ur.getTargetData(u,m)}(a,o,Qr(e)).next(c=>{if(c)return n=c.lastLimboFreeSnapshotVersion,a.Ur.getMatchingKeysForTargetId(o,c.targetId).next(d=>{i=d})}).next(()=>a.ss.getDocumentsMatchingQuery(o,e,r?n:Fe.min(),r?i:He())).next(c=>(jw(a,mv(e),c),{documents:c,Ts:i})))}function jw(s,e,r){let a=s.us.get(e)||Fe.min();r.forEach((n,i)=>{i.readTime.compareTo(a)>0&&(a=i.readTime)}),s.us.set(e,a)}class bh{constructor(){this.activeTargetIds=yv()}fs(e){this.activeTargetIds=this.activeTargetIds.add(e)}gs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Vs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class Nw{constructor(){this.so=new bh,this.oo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,r,a){}addLocalQueryTarget(e,r=!0){return r&&this.so.fs(e),this.oo[e]||"not-current"}updateQueryState(e,r,a){this.oo[e]=r}removeLocalQueryTarget(e){this.so.gs(e)}isLocalQueryTarget(e){return this.so.activeTargetIds.has(e)}clearQueryState(e){delete this.oo[e]}getAllActiveQueryTargets(){return this.so.activeTargetIds}isActiveQueryTarget(e){return this.so.activeTargetIds.has(e)}start(){return this.so=new bh,Promise.resolve()}handleUserChange(e,r,a){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _w{_o(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yh{constructor(){this.ao=()=>this.uo(),this.co=()=>this.lo(),this.ho=[],this.Po()}_o(e){this.ho.push(e)}shutdown(){window.removeEventListener("online",this.ao),window.removeEventListener("offline",this.co)}Po(){window.addEventListener("online",this.ao),window.addEventListener("offline",this.co)}uo(){_e("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.ho)e(0)}lo(){_e("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.ho)e(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Ii=null;function Al(){return Ii===null?Ii=function(){return 268435456+Math.round(2147483648*Math.random())}():Ii++,"0x"+Ii.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ew={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tw{constructor(e){this.Io=e.Io,this.To=e.To}Eo(e){this.Ao=e}Ro(e){this.Vo=e}mo(e){this.fo=e}onMessage(e){this.po=e}close(){this.To()}send(e){this.Io(e)}yo(){this.Ao()}wo(){this.Vo()}So(e){this.fo(e)}bo(e){this.po(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Jt="WebChannelConnection";class Sw extends class{constructor(r){this.databaseInfo=r,this.databaseId=r.databaseId;const a=r.ssl?"https":"http",n=encodeURIComponent(this.databaseId.projectId),i=encodeURIComponent(this.databaseId.database);this.Do=a+"://"+r.host,this.vo=`projects/${n}/databases/${i}`,this.Co=this.databaseId.database==="(default)"?`project_id=${n}`:`project_id=${n}&database_id=${i}`}get Fo(){return!1}Mo(r,a,n,i,o){const c=Al(),d=this.xo(r,a.toUriEncodedString());_e("RestConnection",`Sending RPC '${r}' ${c}:`,d,n);const u={"google-cloud-resource-prefix":this.vo,"x-goog-request-params":this.Co};return this.Oo(u,i,o),this.No(r,d,u,n).then(m=>(_e("RestConnection",`Received RPC '${r}' ${c}: `,m),m),m=>{throw Ha("RestConnection",`RPC '${r}' ${c} failed with error: `,m,"url: ",d,"request:",n),m})}Lo(r,a,n,i,o,c){return this.Mo(r,a,n,i,o)}Oo(r,a,n){r["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+nn}(),r["Content-Type"]="text/plain",this.databaseInfo.appId&&(r["X-Firebase-GMPID"]=this.databaseInfo.appId),a&&a.headers.forEach((i,o)=>r[o]=i),n&&n.headers.forEach((i,o)=>r[o]=i)}xo(r,a){const n=Ew[r];return`${this.Do}/v1/${a}:${n}`}terminate(){}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}No(e,r,a,n){const i=Al();return new Promise((o,c)=>{const d=new fm;d.setWithCredentials(!0),d.listenOnce(bm.COMPLETE,()=>{try{switch(d.getLastErrorCode()){case Oi.NO_ERROR:const m=d.getResponseJson();_e(Jt,`XHR for RPC '${e}' ${i} received:`,JSON.stringify(m)),o(m);break;case Oi.TIMEOUT:_e(Jt,`RPC '${e}' ${i} timed out`),c(new we(ae.DEADLINE_EXCEEDED,"Request time out"));break;case Oi.HTTP_ERROR:const f=d.getStatus();if(_e(Jt,`RPC '${e}' ${i} failed with status:`,f,"response text:",d.getResponseText()),f>0){let x=d.getResponseJson();Array.isArray(x)&&(x=x[0]);const v=x==null?void 0:x.error;if(v&&v.status&&v.message){const T=function(N){const O=N.toLowerCase().replace(/_/g,"-");return Object.values(ae).indexOf(O)>=0?O:ae.UNKNOWN}(v.status);c(new we(T,v.message))}else c(new we(ae.UNKNOWN,"Server responded with status "+d.getStatus()))}else c(new we(ae.UNAVAILABLE,"Connection failed."));break;default:Ve()}}finally{_e(Jt,`RPC '${e}' ${i} completed.`)}});const u=JSON.stringify(n);_e(Jt,`RPC '${e}' ${i} sending request:`,n),d.send(r,"POST",u,a,15)})}Bo(e,r,a){const n=Al(),i=[this.Do,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=wm(),c=vm(),d={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},u=this.longPollingOptions.timeoutSeconds;u!==void 0&&(d.longPollingTimeout=Math.round(1e3*u)),this.useFetchStreams&&(d.useFetchStreams=!0),this.Oo(d.initMessageHeaders,r,a),d.encodeInitMessageHeaders=!0;const m=i.join("");_e(Jt,`Creating RPC '${e}' stream ${n}: ${m}`,d);const f=o.createWebChannel(m,d);let x=!1,v=!1;const T=new Tw({Io:N=>{v?_e(Jt,`Not sending because RPC '${e}' stream ${n} is closed:`,N):(x||(_e(Jt,`Opening RPC '${e}' stream ${n} transport.`),f.open(),x=!0),_e(Jt,`RPC '${e}' stream ${n} sending:`,N),f.send(N))},To:()=>f.close()}),I=(N,O,D)=>{N.listen(O,C=>{try{D(C)}catch(M){setTimeout(()=>{throw M},0)}})};return I(f,Sn.EventType.OPEN,()=>{v||(_e(Jt,`RPC '${e}' stream ${n} transport opened.`),T.yo())}),I(f,Sn.EventType.CLOSE,()=>{v||(v=!0,_e(Jt,`RPC '${e}' stream ${n} transport closed`),T.So())}),I(f,Sn.EventType.ERROR,N=>{v||(v=!0,Ha(Jt,`RPC '${e}' stream ${n} transport errored:`,N),T.So(new we(ae.UNAVAILABLE,"The operation could not be completed")))}),I(f,Sn.EventType.MESSAGE,N=>{var O;if(!v){const D=N.data[0];at(!!D);const C=D,M=C.error||((O=C[0])===null||O===void 0?void 0:O.error);if(M){_e(Jt,`RPC '${e}' stream ${n} received error:`,M);const V=M.status;let U=function(E){const j=It[E];if(j!==void 0)return Hm(j)}(V),y=M.message;U===void 0&&(U=ae.INTERNAL,y="Unknown error status: "+V+" with message "+M.message),v=!0,T.So(new we(U,y)),f.close()}else _e(Jt,`RPC '${e}' stream ${n} received:`,D),T.bo(D)}}),I(c,ym.STAT_EVENT,N=>{N.stat===sc.PROXY?_e(Jt,`RPC '${e}' stream ${n} detected buffering proxy`):N.stat===sc.NOPROXY&&_e(Jt,`RPC '${e}' stream ${n} detected no buffering proxy`)}),setTimeout(()=>{T.wo()},0),T}}function Cl(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Uo(s){return new Vv(s,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ag{constructor(e,r,a=1e3,n=1.5,i=6e4){this.ui=e,this.timerId=r,this.ko=a,this.qo=n,this.Qo=i,this.Ko=0,this.$o=null,this.Uo=Date.now(),this.reset()}reset(){this.Ko=0}Wo(){this.Ko=this.Qo}Go(e){this.cancel();const r=Math.floor(this.Ko+this.zo()),a=Math.max(0,Date.now()-this.Uo),n=Math.max(0,r-a);n>0&&_e("ExponentialBackoff",`Backing off for ${n} ms (base delay: ${this.Ko} ms, delay with jitter: ${r} ms, last attempt: ${a} ms ago)`),this.$o=this.ui.enqueueAfterDelay(this.timerId,n,()=>(this.Uo=Date.now(),e())),this.Ko*=this.qo,this.Ko<this.ko&&(this.Ko=this.ko),this.Ko>this.Qo&&(this.Ko=this.Qo)}jo(){this.$o!==null&&(this.$o.skipDelay(),this.$o=null)}cancel(){this.$o!==null&&(this.$o.cancel(),this.$o=null)}zo(){return(Math.random()-.5)*this.Ko}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ng{constructor(e,r,a,n,i,o,c,d){this.ui=e,this.Ho=a,this.Jo=n,this.connection=i,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=c,this.listener=d,this.state=0,this.Yo=0,this.Zo=null,this.Xo=null,this.stream=null,this.e_=0,this.t_=new ag(e,r)}n_(){return this.state===1||this.state===5||this.r_()}r_(){return this.state===2||this.state===3}start(){this.e_=0,this.state!==4?this.auth():this.i_()}async stop(){this.n_()&&await this.close(0)}s_(){this.state=0,this.t_.reset()}o_(){this.r_()&&this.Zo===null&&(this.Zo=this.ui.enqueueAfterDelay(this.Ho,6e4,()=>this.__()))}a_(e){this.u_(),this.stream.send(e)}async __(){if(this.r_())return this.close(0)}u_(){this.Zo&&(this.Zo.cancel(),this.Zo=null)}c_(){this.Xo&&(this.Xo.cancel(),this.Xo=null)}async close(e,r){this.u_(),this.c_(),this.t_.cancel(),this.Yo++,e!==4?this.t_.reset():r&&r.code===ae.RESOURCE_EXHAUSTED?(ws(r.toString()),ws("Using maximum backoff delay to prevent overloading the backend."),this.t_.Wo()):r&&r.code===ae.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.l_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.mo(r)}l_(){}auth(){this.state=1;const e=this.h_(this.Yo),r=this.Yo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([a,n])=>{this.Yo===r&&this.P_(a,n)},a=>{e(()=>{const n=new we(ae.UNKNOWN,"Fetching auth token failed: "+a.message);return this.I_(n)})})}P_(e,r){const a=this.h_(this.Yo);this.stream=this.T_(e,r),this.stream.Eo(()=>{a(()=>this.listener.Eo())}),this.stream.Ro(()=>{a(()=>(this.state=2,this.Xo=this.ui.enqueueAfterDelay(this.Jo,1e4,()=>(this.r_()&&(this.state=3),Promise.resolve())),this.listener.Ro()))}),this.stream.mo(n=>{a(()=>this.I_(n))}),this.stream.onMessage(n=>{a(()=>++this.e_==1?this.E_(n):this.onNext(n))})}i_(){this.state=5,this.t_.Go(async()=>{this.state=0,this.start()})}I_(e){return _e("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}h_(e){return r=>{this.ui.enqueueAndForget(()=>this.Yo===e?r():(_e("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class Iw extends ng{constructor(e,r,a,n,i,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",r,a,n,o),this.serializer=i}T_(e,r){return this.connection.Bo("Listen",e,r)}E_(e){return this.onNext(e)}onNext(e){this.t_.reset();const r=Uv(this.serializer,e),a=function(i){if(!("targetChange"in i))return Fe.min();const o=i.targetChange;return o.targetIds&&o.targetIds.length?Fe.min():o.readTime?Yr(o.readTime):Fe.min()}(e);return this.listener.d_(r,a)}A_(e){const r={};r.database=mc(this.serializer),r.addTarget=function(i,o){let c;const d=o.target;if(c=oc(d)?{documents:qv(i,d)}:{query:Wv(i,d)._t},c.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){c.resumeToken=Qm(i,o.resumeToken);const u=dc(i,o.expectedCount);u!==null&&(c.expectedCount=u)}else if(o.snapshotVersion.compareTo(Fe.min())>0){c.readTime=co(i,o.snapshotVersion.toTimestamp());const u=dc(i,o.expectedCount);u!==null&&(c.expectedCount=u)}return c}(this.serializer,e);const a=Gv(this.serializer,e);a&&(r.labels=a),this.a_(r)}R_(e){const r={};r.database=mc(this.serializer),r.removeTarget=e,this.a_(r)}}class Aw extends ng{constructor(e,r,a,n,i,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",r,a,n,o),this.serializer=i}get V_(){return this.e_>0}start(){this.lastStreamToken=void 0,super.start()}l_(){this.V_&&this.m_([])}T_(e,r){return this.connection.Bo("Write",e,r)}E_(e){return at(!!e.streamToken),this.lastStreamToken=e.streamToken,at(!e.writeResults||e.writeResults.length===0),this.listener.f_()}onNext(e){at(!!e.streamToken),this.lastStreamToken=e.streamToken,this.t_.reset();const r=zv(e.writeResults,e.commitTime),a=Yr(e.commitTime);return this.listener.g_(a,r)}p_(){const e={};e.database=mc(this.serializer),this.a_(e)}m_(e){const r={streamToken:this.lastStreamToken,writes:e.map(a=>Bv(this.serializer,a))};this.a_(r)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cw extends class{}{constructor(e,r,a,n){super(),this.authCredentials=e,this.appCheckCredentials=r,this.connection=a,this.serializer=n,this.y_=!1}w_(){if(this.y_)throw new we(ae.FAILED_PRECONDITION,"The client has already been terminated.")}Mo(e,r,a,n){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,o])=>this.connection.Mo(e,uc(r,a),n,i,o)).catch(i=>{throw i.name==="FirebaseError"?(i.code===ae.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),i):new we(ae.UNKNOWN,i.toString())})}Lo(e,r,a,n,i){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,c])=>this.connection.Lo(e,uc(r,a),n,o,c,i)).catch(o=>{throw o.name==="FirebaseError"?(o.code===ae.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new we(ae.UNKNOWN,o.toString())})}terminate(){this.y_=!0,this.connection.terminate()}}class Dw{constructor(e,r){this.asyncQueue=e,this.onlineStateHandler=r,this.state="Unknown",this.S_=0,this.b_=null,this.D_=!0}v_(){this.S_===0&&(this.C_("Unknown"),this.b_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.b_=null,this.F_("Backend didn't respond within 10 seconds."),this.C_("Offline"),Promise.resolve())))}M_(e){this.state==="Online"?this.C_("Unknown"):(this.S_++,this.S_>=1&&(this.x_(),this.F_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.C_("Offline")))}set(e){this.x_(),this.S_=0,e==="Online"&&(this.D_=!1),this.C_(e)}C_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}F_(e){const r=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.D_?(ws(r),this.D_=!1):_e("OnlineStateTracker",r)}x_(){this.b_!==null&&(this.b_.cancel(),this.b_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $w{constructor(e,r,a,n,i){this.localStore=e,this.datastore=r,this.asyncQueue=a,this.remoteSyncer={},this.O_=[],this.N_=new Map,this.L_=new Set,this.B_=[],this.k_=i,this.k_._o(o=>{a.enqueueAndForget(async()=>{_a(this)&&(_e("RemoteStore","Restarting streams for network reachability change."),await async function(d){const u=Ue(d);u.L_.add(4),await li(u),u.q_.set("Unknown"),u.L_.delete(4),await Bo(u)}(this))})}),this.q_=new Dw(a,n)}}async function Bo(s){if(_a(s))for(const e of s.B_)await e(!0)}async function li(s){for(const e of s.B_)await e(!1)}function ig(s,e){const r=Ue(s);r.N_.has(e.targetId)||(r.N_.set(e.targetId,e),rd(r)?td(r):cn(r).r_()&&ed(r,e))}function Zc(s,e){const r=Ue(s),a=cn(r);r.N_.delete(e),a.r_()&&og(r,e),r.N_.size===0&&(a.r_()?a.o_():_a(r)&&r.q_.set("Unknown"))}function ed(s,e){if(s.Q_.xe(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(Fe.min())>0){const r=s.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(r)}cn(s).A_(e)}function og(s,e){s.Q_.xe(e),cn(s).R_(e)}function td(s){s.Q_=new Rv({getRemoteKeysForTarget:e=>s.remoteSyncer.getRemoteKeysForTarget(e),ot:e=>s.N_.get(e)||null,tt:()=>s.datastore.serializer.databaseId}),cn(s).start(),s.q_.v_()}function rd(s){return _a(s)&&!cn(s).n_()&&s.N_.size>0}function _a(s){return Ue(s).L_.size===0}function lg(s){s.Q_=void 0}async function Rw(s){s.q_.set("Online")}async function Pw(s){s.N_.forEach((e,r)=>{ed(s,e)})}async function Mw(s,e){lg(s),rd(s)?(s.q_.M_(e),td(s)):s.q_.set("Unknown")}async function Ow(s,e,r){if(s.q_.set("Online"),e instanceof Km&&e.state===2&&e.cause)try{await async function(n,i){const o=i.cause;for(const c of i.targetIds)n.N_.has(c)&&(await n.remoteSyncer.rejectListen(c,o),n.N_.delete(c),n.Q_.removeTarget(c))}(s,e)}catch(a){_e("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),a),await uo(s,a)}else if(e instanceof Fi?s.Q_.Ke(e):e instanceof Gm?s.Q_.He(e):s.Q_.We(e),!r.isEqual(Fe.min()))try{const a=await sg(s.localStore);r.compareTo(a)>=0&&await function(i,o){const c=i.Q_.rt(o);return c.targetChanges.forEach((d,u)=>{if(d.resumeToken.approximateByteSize()>0){const m=i.N_.get(u);m&&i.N_.set(u,m.withResumeToken(d.resumeToken,o))}}),c.targetMismatches.forEach((d,u)=>{const m=i.N_.get(d);if(!m)return;i.N_.set(d,m.withResumeToken(Qt.EMPTY_BYTE_STRING,m.snapshotVersion)),og(i,d);const f=new Ls(m.target,d,u,m.sequenceNumber);ed(i,f)}),i.remoteSyncer.applyRemoteEvent(c)}(s,r)}catch(a){_e("RemoteStore","Failed to raise snapshot:",a),await uo(s,a)}}async function uo(s,e,r){if(!ni(e))throw e;s.L_.add(1),await li(s),s.q_.set("Offline"),r||(r=()=>sg(s.localStore)),s.asyncQueue.enqueueRetryable(async()=>{_e("RemoteStore","Retrying IndexedDB access"),await r(),s.L_.delete(1),await Bo(s)})}function cg(s,e){return e().catch(r=>uo(s,r,e))}async function zo(s){const e=Ue(s),r=Ys(e);let a=e.O_.length>0?e.O_[e.O_.length-1].batchId:-1;for(;Vw(e);)try{const n=await ww(e.localStore,a);if(n===null){e.O_.length===0&&r.o_();break}a=n.batchId,Lw(e,n)}catch(n){await uo(e,n)}dg(e)&&ug(e)}function Vw(s){return _a(s)&&s.O_.length<10}function Lw(s,e){s.O_.push(e);const r=Ys(s);r.r_()&&r.V_&&r.m_(e.mutations)}function dg(s){return _a(s)&&!Ys(s).n_()&&s.O_.length>0}function ug(s){Ys(s).start()}async function Fw(s){Ys(s).p_()}async function Uw(s){const e=Ys(s);for(const r of s.O_)e.m_(r.mutations)}async function Bw(s,e,r){const a=s.O_.shift(),n=Gc.from(a,e,r);await cg(s,()=>s.remoteSyncer.applySuccessfulWrite(n)),await zo(s)}async function zw(s,e){e&&Ys(s).V_&&await async function(a,n){if(function(o){return Cv(o)&&o!==ae.ABORTED}(n.code)){const i=a.O_.shift();Ys(a).s_(),await cg(a,()=>a.remoteSyncer.rejectFailedWrite(i.batchId,n)),await zo(a)}}(s,e),dg(s)&&ug(s)}async function vh(s,e){const r=Ue(s);r.asyncQueue.verifyOperationInProgress(),_e("RemoteStore","RemoteStore received new credentials");const a=_a(r);r.L_.add(3),await li(r),a&&r.q_.set("Unknown"),await r.remoteSyncer.handleCredentialChange(e),r.L_.delete(3),await Bo(r)}async function qw(s,e){const r=Ue(s);e?(r.L_.delete(2),await Bo(r)):e||(r.L_.add(2),await li(r),r.q_.set("Unknown"))}function cn(s){return s.K_||(s.K_=function(r,a,n){const i=Ue(r);return i.w_(),new Iw(a,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,n)}(s.datastore,s.asyncQueue,{Eo:Rw.bind(null,s),Ro:Pw.bind(null,s),mo:Mw.bind(null,s),d_:Ow.bind(null,s)}),s.B_.push(async e=>{e?(s.K_.s_(),rd(s)?td(s):s.q_.set("Unknown")):(await s.K_.stop(),lg(s))})),s.K_}function Ys(s){return s.U_||(s.U_=function(r,a,n){const i=Ue(r);return i.w_(),new Aw(a,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,n)}(s.datastore,s.asyncQueue,{Eo:()=>Promise.resolve(),Ro:Fw.bind(null,s),mo:zw.bind(null,s),f_:Uw.bind(null,s),g_:Bw.bind(null,s)}),s.B_.push(async e=>{e?(s.U_.s_(),await zo(s)):(await s.U_.stop(),s.O_.length>0&&(_e("RemoteStore",`Stopping write stream with ${s.O_.length} pending writes`),s.O_=[]))})),s.U_}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sd{constructor(e,r,a,n,i){this.asyncQueue=e,this.timerId=r,this.targetTimeMs=a,this.op=n,this.removalCallback=i,this.deferred=new xs,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,r,a,n,i){const o=Date.now()+a,c=new sd(e,r,o,n,i);return c.start(a),c}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new we(ae.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function ad(s,e){if(ws("AsyncQueue",`${e}: ${s}`),ni(s))return new we(ae.UNAVAILABLE,`${e}: ${s}`);throw s}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Va{constructor(e){this.comparator=e?(r,a)=>e(r,a)||Ae.comparator(r.key,a.key):(r,a)=>Ae.comparator(r.key,a.key),this.keyedMap=In(),this.sortedSet=new yt(this.comparator)}static emptySet(e){return new Va(e.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const r=this.keyedMap.get(e);return r?this.sortedSet.indexOf(r):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((r,a)=>(e(r),!1))}add(e){const r=this.delete(e.key);return r.copy(r.keyedMap.insert(e.key,e),r.sortedSet.insert(e,null))}delete(e){const r=this.get(e);return r?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(r)):this}isEqual(e){if(!(e instanceof Va)||this.size!==e.size)return!1;const r=this.sortedSet.getIterator(),a=e.sortedSet.getIterator();for(;r.hasNext();){const n=r.getNext().key,i=a.getNext().key;if(!n.isEqual(i))return!1}return!0}toString(){const e=[];return this.forEach(r=>{e.push(r.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,r){const a=new Va;return a.comparator=this.comparator,a.keyedMap=e,a.sortedSet=r,a}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wh{constructor(){this.W_=new yt(Ae.comparator)}track(e){const r=e.doc.key,a=this.W_.get(r);a?e.type!==0&&a.type===3?this.W_=this.W_.insert(r,e):e.type===3&&a.type!==1?this.W_=this.W_.insert(r,{type:a.type,doc:e.doc}):e.type===2&&a.type===2?this.W_=this.W_.insert(r,{type:2,doc:e.doc}):e.type===2&&a.type===0?this.W_=this.W_.insert(r,{type:0,doc:e.doc}):e.type===1&&a.type===0?this.W_=this.W_.remove(r):e.type===1&&a.type===2?this.W_=this.W_.insert(r,{type:1,doc:a.doc}):e.type===0&&a.type===1?this.W_=this.W_.insert(r,{type:2,doc:e.doc}):Ve():this.W_=this.W_.insert(r,e)}G_(){const e=[];return this.W_.inorderTraversal((r,a)=>{e.push(a)}),e}}class Xa{constructor(e,r,a,n,i,o,c,d,u){this.query=e,this.docs=r,this.oldDocs=a,this.docChanges=n,this.mutatedKeys=i,this.fromCache=o,this.syncStateChanged=c,this.excludesMetadataChanges=d,this.hasCachedResults=u}static fromInitialDocuments(e,r,a,n,i){const o=[];return r.forEach(c=>{o.push({type:0,doc:c})}),new Xa(e,r,Va.emptySet(r),o,a,n,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Mo(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const r=this.docChanges,a=e.docChanges;if(r.length!==a.length)return!1;for(let n=0;n<r.length;n++)if(r[n].type!==a[n].type||!r[n].doc.isEqual(a[n].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ww{constructor(){this.z_=void 0,this.j_=[]}H_(){return this.j_.some(e=>e.J_())}}class Hw{constructor(){this.queries=kh(),this.onlineState="Unknown",this.Y_=new Set}terminate(){(function(r,a){const n=Ue(r),i=n.queries;n.queries=kh(),i.forEach((o,c)=>{for(const d of c.j_)d.onError(a)})})(this,new we(ae.ABORTED,"Firestore shutting down"))}}function kh(){return new ln(s=>Rm(s),Mo)}async function nd(s,e){const r=Ue(s);let a=3;const n=e.query;let i=r.queries.get(n);i?!i.H_()&&e.J_()&&(a=2):(i=new Ww,a=e.J_()?0:1);try{switch(a){case 0:i.z_=await r.onListen(n,!0);break;case 1:i.z_=await r.onListen(n,!1);break;case 2:await r.onFirstRemoteStoreListen(n)}}catch(o){const c=ad(o,`Initialization of query '${Da(e.query)}' failed`);return void e.onError(c)}r.queries.set(n,i),i.j_.push(e),e.Z_(r.onlineState),i.z_&&e.X_(i.z_)&&od(r)}async function id(s,e){const r=Ue(s),a=e.query;let n=3;const i=r.queries.get(a);if(i){const o=i.j_.indexOf(e);o>=0&&(i.j_.splice(o,1),i.j_.length===0?n=e.J_()?0:1:!i.H_()&&e.J_()&&(n=2))}switch(n){case 0:return r.queries.delete(a),r.onUnlisten(a,!0);case 1:return r.queries.delete(a),r.onUnlisten(a,!1);case 2:return r.onLastRemoteStoreUnlisten(a);default:return}}function Gw(s,e){const r=Ue(s);let a=!1;for(const n of e){const i=n.query,o=r.queries.get(i);if(o){for(const c of o.j_)c.X_(n)&&(a=!0);o.z_=n}}a&&od(r)}function Kw(s,e,r){const a=Ue(s),n=a.queries.get(e);if(n)for(const i of n.j_)i.onError(r);a.queries.delete(e)}function od(s){s.Y_.forEach(e=>{e.next()})}var pc,jh;(jh=pc||(pc={})).ea="default",jh.Cache="cache";class ld{constructor(e,r,a){this.query=e,this.ta=r,this.na=!1,this.ra=null,this.onlineState="Unknown",this.options=a||{}}X_(e){if(!this.options.includeMetadataChanges){const a=[];for(const n of e.docChanges)n.type!==3&&a.push(n);e=new Xa(e.query,e.docs,e.oldDocs,a,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let r=!1;return this.na?this.ia(e)&&(this.ta.next(e),r=!0):this.sa(e,this.onlineState)&&(this.oa(e),r=!0),this.ra=e,r}onError(e){this.ta.error(e)}Z_(e){this.onlineState=e;let r=!1;return this.ra&&!this.na&&this.sa(this.ra,e)&&(this.oa(this.ra),r=!0),r}sa(e,r){if(!e.fromCache||!this.J_())return!0;const a=r!=="Offline";return(!this.options._a||!a)&&(!e.docs.isEmpty()||e.hasCachedResults||r==="Offline")}ia(e){if(e.docChanges.length>0)return!0;const r=this.ra&&this.ra.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!r)&&this.options.includeMetadataChanges===!0}oa(e){e=Xa.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.na=!0,this.ta.next(e)}J_(){return this.options.source!==pc.Cache}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hg{constructor(e){this.key=e}}class mg{constructor(e){this.key=e}}class Qw{constructor(e,r){this.query=e,this.Ta=r,this.Ea=null,this.hasCachedResults=!1,this.current=!1,this.da=He(),this.mutatedKeys=He(),this.Aa=Pm(e),this.Ra=new Va(this.Aa)}get Va(){return this.Ta}ma(e,r){const a=r?r.fa:new wh,n=r?r.Ra:this.Ra;let i=r?r.mutatedKeys:this.mutatedKeys,o=n,c=!1;const d=this.query.limitType==="F"&&n.size===this.query.limit?n.last():null,u=this.query.limitType==="L"&&n.size===this.query.limit?n.first():null;if(e.inorderTraversal((m,f)=>{const x=n.get(m),v=Oo(this.query,f)?f:null,T=!!x&&this.mutatedKeys.has(x.key),I=!!v&&(v.hasLocalMutations||this.mutatedKeys.has(v.key)&&v.hasCommittedMutations);let N=!1;x&&v?x.data.isEqual(v.data)?T!==I&&(a.track({type:3,doc:v}),N=!0):this.ga(x,v)||(a.track({type:2,doc:v}),N=!0,(d&&this.Aa(v,d)>0||u&&this.Aa(v,u)<0)&&(c=!0)):!x&&v?(a.track({type:0,doc:v}),N=!0):x&&!v&&(a.track({type:1,doc:x}),N=!0,(d||u)&&(c=!0)),N&&(v?(o=o.add(v),i=I?i.add(m):i.delete(m)):(o=o.delete(m),i=i.delete(m)))}),this.query.limit!==null)for(;o.size>this.query.limit;){const m=this.query.limitType==="F"?o.last():o.first();o=o.delete(m.key),i=i.delete(m.key),a.track({type:1,doc:m})}return{Ra:o,fa:a,ns:c,mutatedKeys:i}}ga(e,r){return e.hasLocalMutations&&r.hasCommittedMutations&&!r.hasLocalMutations}applyChanges(e,r,a,n){const i=this.Ra;this.Ra=e.Ra,this.mutatedKeys=e.mutatedKeys;const o=e.fa.G_();o.sort((m,f)=>function(v,T){const I=N=>{switch(N){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Ve()}};return I(v)-I(T)}(m.type,f.type)||this.Aa(m.doc,f.doc)),this.pa(a),n=n!=null&&n;const c=r&&!n?this.ya():[],d=this.da.size===0&&this.current&&!n?1:0,u=d!==this.Ea;return this.Ea=d,o.length!==0||u?{snapshot:new Xa(this.query,e.Ra,i,o,e.mutatedKeys,d===0,u,!1,!!a&&a.resumeToken.approximateByteSize()>0),wa:c}:{wa:c}}Z_(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({Ra:this.Ra,fa:new wh,mutatedKeys:this.mutatedKeys,ns:!1},!1)):{wa:[]}}Sa(e){return!this.Ta.has(e)&&!!this.Ra.has(e)&&!this.Ra.get(e).hasLocalMutations}pa(e){e&&(e.addedDocuments.forEach(r=>this.Ta=this.Ta.add(r)),e.modifiedDocuments.forEach(r=>{}),e.removedDocuments.forEach(r=>this.Ta=this.Ta.delete(r)),this.current=e.current)}ya(){if(!this.current)return[];const e=this.da;this.da=He(),this.Ra.forEach(a=>{this.Sa(a.key)&&(this.da=this.da.add(a.key))});const r=[];return e.forEach(a=>{this.da.has(a)||r.push(new mg(a))}),this.da.forEach(a=>{e.has(a)||r.push(new hg(a))}),r}ba(e){this.Ta=e.Ts,this.da=He();const r=this.ma(e.documents);return this.applyChanges(r,!0)}Da(){return Xa.fromInitialDocuments(this.query,this.Ra,this.mutatedKeys,this.Ea===0,this.hasCachedResults)}}class Yw{constructor(e,r,a){this.query=e,this.targetId=r,this.view=a}}class Xw{constructor(e){this.key=e,this.va=!1}}class Jw{constructor(e,r,a,n,i,o){this.localStore=e,this.remoteStore=r,this.eventManager=a,this.sharedClientState=n,this.currentUser=i,this.maxConcurrentLimboResolutions=o,this.Ca={},this.Fa=new ln(c=>Rm(c),Mo),this.Ma=new Map,this.xa=new Set,this.Oa=new yt(Ae.comparator),this.Na=new Map,this.La=new Yc,this.Ba={},this.ka=new Map,this.qa=Ya.kn(),this.onlineState="Unknown",this.Qa=void 0}get isPrimaryClient(){return this.Qa===!0}}async function Zw(s,e,r=!0){const a=yg(s);let n;const i=a.Fa.get(e);return i?(a.sharedClientState.addLocalQueryTarget(i.targetId),n=i.view.Da()):n=await gg(a,e,r,!0),n}async function e1(s,e){const r=yg(s);await gg(r,e,!0,!1)}async function gg(s,e,r,a){const n=await kw(s.localStore,Qr(e)),i=n.targetId,o=s.sharedClientState.addLocalQueryTarget(i,r);let c;return a&&(c=await t1(s,e,i,o==="current",n.resumeToken)),s.isPrimaryClient&&r&&ig(s.remoteStore,n),c}async function t1(s,e,r,a,n){s.Ka=(f,x,v)=>async function(I,N,O,D){let C=N.view.ma(O);C.ns&&(C=await fh(I.localStore,N.query,!1).then(({documents:y})=>N.view.ma(y,C)));const M=D&&D.targetChanges.get(N.targetId),V=D&&D.targetMismatches.get(N.targetId)!=null,U=N.view.applyChanges(C,I.isPrimaryClient,M,V);return _h(I,N.targetId,U.wa),U.snapshot}(s,f,x,v);const i=await fh(s.localStore,e,!0),o=new Qw(e,i.Ts),c=o.ma(i.documents),d=oi.createSynthesizedTargetChangeForCurrentChange(r,a&&s.onlineState!=="Offline",n),u=o.applyChanges(c,s.isPrimaryClient,d);_h(s,r,u.wa);const m=new Yw(e,r,o);return s.Fa.set(e,m),s.Ma.has(r)?s.Ma.get(r).push(e):s.Ma.set(r,[e]),u.snapshot}async function r1(s,e,r){const a=Ue(s),n=a.Fa.get(e),i=a.Ma.get(n.targetId);if(i.length>1)return a.Ma.set(n.targetId,i.filter(o=>!Mo(o,e))),void a.Fa.delete(e);a.isPrimaryClient?(a.sharedClientState.removeLocalQueryTarget(n.targetId),a.sharedClientState.isActiveQueryTarget(n.targetId)||await gc(a.localStore,n.targetId,!1).then(()=>{a.sharedClientState.clearQueryState(n.targetId),r&&Zc(a.remoteStore,n.targetId),xc(a,n.targetId)}).catch(ai)):(xc(a,n.targetId),await gc(a.localStore,n.targetId,!0))}async function s1(s,e){const r=Ue(s),a=r.Fa.get(e),n=r.Ma.get(a.targetId);r.isPrimaryClient&&n.length===1&&(r.sharedClientState.removeLocalQueryTarget(a.targetId),Zc(r.remoteStore,a.targetId))}async function a1(s,e,r){const a=u1(s);try{const n=await function(o,c){const d=Ue(o),u=Rt.now(),m=c.reduce((v,T)=>v.add(T.key),He());let f,x;return d.persistence.runTransaction("Locally write mutations","readwrite",v=>{let T=ks(),I=He();return d.cs.getEntries(v,m).next(N=>{T=N,T.forEach((O,D)=>{D.isValidDocument()||(I=I.add(O))})}).next(()=>d.localDocuments.getOverlayedDocuments(v,T)).next(N=>{f=N;const O=[];for(const D of c){const C=Ev(D,f.get(D.key).overlayedDocument);C!=null&&O.push(new Js(D.key,C,Em(C.value.mapValue),Mr.exists(!0)))}return d.mutationQueue.addMutationBatch(v,u,O,c)}).next(N=>{x=N;const O=N.applyToLocalDocumentSet(f,I);return d.documentOverlayCache.saveOverlays(v,N.batchId,O)})}).then(()=>({batchId:x.batchId,changes:Om(f)}))}(a.localStore,e);a.sharedClientState.addPendingMutation(n.batchId),function(o,c,d){let u=o.Ba[o.currentUser.toKey()];u||(u=new yt(Ze)),u=u.insert(c,d),o.Ba[o.currentUser.toKey()]=u}(a,n.batchId,r),await ci(a,n.changes),await zo(a.remoteStore)}catch(n){const i=ad(n,"Failed to persist write");r.reject(i)}}async function pg(s,e){const r=Ue(s);try{const a=await yw(r.localStore,e);e.targetChanges.forEach((n,i)=>{const o=r.Na.get(i);o&&(at(n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size<=1),n.addedDocuments.size>0?o.va=!0:n.modifiedDocuments.size>0?at(o.va):n.removedDocuments.size>0&&(at(o.va),o.va=!1))}),await ci(r,a,e)}catch(a){await ai(a)}}function Nh(s,e,r){const a=Ue(s);if(a.isPrimaryClient&&r===0||!a.isPrimaryClient&&r===1){const n=[];a.Fa.forEach((i,o)=>{const c=o.view.Z_(e);c.snapshot&&n.push(c.snapshot)}),function(o,c){const d=Ue(o);d.onlineState=c;let u=!1;d.queries.forEach((m,f)=>{for(const x of f.j_)x.Z_(c)&&(u=!0)}),u&&od(d)}(a.eventManager,e),n.length&&a.Ca.d_(n),a.onlineState=e,a.isPrimaryClient&&a.sharedClientState.setOnlineState(e)}}async function n1(s,e,r){const a=Ue(s);a.sharedClientState.updateQueryState(e,"rejected",r);const n=a.Na.get(e),i=n&&n.key;if(i){let o=new yt(Ae.comparator);o=o.insert(i,sr.newNoDocument(i,Fe.min()));const c=He().add(i),d=new Fo(Fe.min(),new Map,new yt(Ze),o,c);await pg(a,d),a.Oa=a.Oa.remove(i),a.Na.delete(e),cd(a)}else await gc(a.localStore,e,!1).then(()=>xc(a,e,r)).catch(ai)}async function i1(s,e){const r=Ue(s),a=e.batch.batchId;try{const n=await bw(r.localStore,e);fg(r,a,null),xg(r,a),r.sharedClientState.updateMutationState(a,"acknowledged"),await ci(r,n)}catch(n){await ai(n)}}async function o1(s,e,r){const a=Ue(s);try{const n=await function(o,c){const d=Ue(o);return d.persistence.runTransaction("Reject batch","readwrite-primary",u=>{let m;return d.mutationQueue.lookupMutationBatch(u,c).next(f=>(at(f!==null),m=f.keys(),d.mutationQueue.removeMutationBatch(u,f))).next(()=>d.mutationQueue.performConsistencyCheck(u)).next(()=>d.documentOverlayCache.removeOverlaysForBatchId(u,m,c)).next(()=>d.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(u,m)).next(()=>d.localDocuments.getDocuments(u,m))})}(a.localStore,e);fg(a,e,r),xg(a,e),a.sharedClientState.updateMutationState(e,"rejected",r),await ci(a,n)}catch(n){await ai(n)}}function xg(s,e){(s.ka.get(e)||[]).forEach(r=>{r.resolve()}),s.ka.delete(e)}function fg(s,e,r){const a=Ue(s);let n=a.Ba[a.currentUser.toKey()];if(n){const i=n.get(e);i&&(r?i.reject(r):i.resolve(),n=n.remove(e)),a.Ba[a.currentUser.toKey()]=n}}function xc(s,e,r=null){s.sharedClientState.removeLocalQueryTarget(e);for(const a of s.Ma.get(e))s.Fa.delete(a),r&&s.Ca.$a(a,r);s.Ma.delete(e),s.isPrimaryClient&&s.La.gr(e).forEach(a=>{s.La.containsKey(a)||bg(s,a)})}function bg(s,e){s.xa.delete(e.path.canonicalString());const r=s.Oa.get(e);r!==null&&(Zc(s.remoteStore,r),s.Oa=s.Oa.remove(e),s.Na.delete(r),cd(s))}function _h(s,e,r){for(const a of r)a instanceof hg?(s.La.addReference(a.key,e),l1(s,a)):a instanceof mg?(_e("SyncEngine","Document no longer in limbo: "+a.key),s.La.removeReference(a.key,e),s.La.containsKey(a.key)||bg(s,a.key)):Ve()}function l1(s,e){const r=e.key,a=r.path.canonicalString();s.Oa.get(r)||s.xa.has(a)||(_e("SyncEngine","New document in limbo: "+r),s.xa.add(a),cd(s))}function cd(s){for(;s.xa.size>0&&s.Oa.size<s.maxConcurrentLimboResolutions;){const e=s.xa.values().next().value;s.xa.delete(e);const r=new Ae(gt.fromString(e)),a=s.qa.next();s.Na.set(a,new Xw(r)),s.Oa=s.Oa.insert(r,a),ig(s.remoteStore,new Ls(Qr(Po(r.path)),a,"TargetPurposeLimboResolution",Lc.oe))}}async function ci(s,e,r){const a=Ue(s),n=[],i=[],o=[];a.Fa.isEmpty()||(a.Fa.forEach((c,d)=>{o.push(a.Ka(d,e,r).then(u=>{var m;if((u||r)&&a.isPrimaryClient){const f=u?!u.fromCache:(m=r==null?void 0:r.targetChanges.get(d.targetId))===null||m===void 0?void 0:m.current;a.sharedClientState.updateQueryState(d.targetId,f?"current":"not-current")}if(u){n.push(u);const f=Jc.Wi(d.targetId,u);i.push(f)}}))}),await Promise.all(o),a.Ca.d_(n),await async function(d,u){const m=Ue(d);try{await m.persistence.runTransaction("notifyLocalViewChanges","readwrite",f=>de.forEach(u,x=>de.forEach(x.$i,v=>m.persistence.referenceDelegate.addReference(f,x.targetId,v)).next(()=>de.forEach(x.Ui,v=>m.persistence.referenceDelegate.removeReference(f,x.targetId,v)))))}catch(f){if(!ni(f))throw f;_e("LocalStore","Failed to update sequence numbers: "+f)}for(const f of u){const x=f.targetId;if(!f.fromCache){const v=m.os.get(x),T=v.snapshotVersion,I=v.withLastLimboFreeSnapshotVersion(T);m.os=m.os.insert(x,I)}}}(a.localStore,i))}async function c1(s,e){const r=Ue(s);if(!r.currentUser.isEqual(e)){_e("SyncEngine","User change. New user:",e.toKey());const a=await rg(r.localStore,e);r.currentUser=e,function(i,o){i.ka.forEach(c=>{c.forEach(d=>{d.reject(new we(ae.CANCELLED,o))})}),i.ka.clear()}(r,"'waitForPendingWrites' promise is rejected due to a user change."),r.sharedClientState.handleUserChange(e,a.removedBatchIds,a.addedBatchIds),await ci(r,a.hs)}}function d1(s,e){const r=Ue(s),a=r.Na.get(e);if(a&&a.va)return He().add(a.key);{let n=He();const i=r.Ma.get(e);if(!i)return n;for(const o of i){const c=r.Fa.get(o);n=n.unionWith(c.view.Va)}return n}}function yg(s){const e=Ue(s);return e.remoteStore.remoteSyncer.applyRemoteEvent=pg.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=d1.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=n1.bind(null,e),e.Ca.d_=Gw.bind(null,e.eventManager),e.Ca.$a=Kw.bind(null,e.eventManager),e}function u1(s){const e=Ue(s);return e.remoteStore.remoteSyncer.applySuccessfulWrite=i1.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=o1.bind(null,e),e}class ho{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=Uo(e.databaseInfo.databaseId),this.sharedClientState=this.Wa(e),this.persistence=this.Ga(e),await this.persistence.start(),this.localStore=this.za(e),this.gcScheduler=this.ja(e,this.localStore),this.indexBackfillerScheduler=this.Ha(e,this.localStore)}ja(e,r){return null}Ha(e,r){return null}za(e){return fw(this.persistence,new pw,e.initialUser,this.serializer)}Ga(e){return new hw(Xc.Zr,this.serializer)}Wa(e){return new Nw}async terminate(){var e,r;(e=this.gcScheduler)===null||e===void 0||e.stop(),(r=this.indexBackfillerScheduler)===null||r===void 0||r.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}ho.provider={build:()=>new ho};class fc{async initialize(e,r){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(r),this.remoteStore=this.createRemoteStore(r),this.eventManager=this.createEventManager(r),this.syncEngine=this.createSyncEngine(r,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=a=>Nh(this.syncEngine,a,1),this.remoteStore.remoteSyncer.handleCredentialChange=c1.bind(null,this.syncEngine),await qw(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return function(){return new Hw}()}createDatastore(e){const r=Uo(e.databaseInfo.databaseId),a=function(i){return new Sw(i)}(e.databaseInfo);return function(i,o,c,d){return new Cw(i,o,c,d)}(e.authCredentials,e.appCheckCredentials,a,r)}createRemoteStore(e){return function(a,n,i,o,c){return new $w(a,n,i,o,c)}(this.localStore,this.datastore,e.asyncQueue,r=>Nh(this.syncEngine,r,0),function(){return yh.D()?new yh:new _w}())}createSyncEngine(e,r){return function(n,i,o,c,d,u,m){const f=new Jw(n,i,o,c,d,u);return m&&(f.Qa=!0),f}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,r)}async terminate(){var e,r;await async function(n){const i=Ue(n);_e("RemoteStore","RemoteStore shutting down."),i.L_.add(5),await li(i),i.k_.shutdown(),i.q_.set("Unknown")}(this.remoteStore),(e=this.datastore)===null||e===void 0||e.terminate(),(r=this.eventManager)===null||r===void 0||r.terminate()}}fc.provider={build:()=>new fc};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dd{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ya(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ya(this.observer.error,e):ws("Uncaught Error in snapshot listener:",e.toString()))}Za(){this.muted=!0}Ya(e,r){setTimeout(()=>{this.muted||e(r)},0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class h1{constructor(e,r,a,n,i){this.authCredentials=e,this.appCheckCredentials=r,this.asyncQueue=a,this.databaseInfo=n,this.user=er.UNAUTHENTICATED,this.clientId=jm.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(a,async o=>{_e("FirestoreClient","Received user=",o.uid),await this.authCredentialListener(o),this.user=o}),this.appCheckCredentials.start(a,o=>(_e("FirestoreClient","Received new app check token=",o),this.appCheckCredentialListener(o,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new xs;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(r){const a=ad(r,"Failed to shutdown persistence");e.reject(a)}}),e.promise}}async function Dl(s,e){s.asyncQueue.verifyOperationInProgress(),_e("FirestoreClient","Initializing OfflineComponentProvider");const r=s.configuration;await e.initialize(r);let a=r.initialUser;s.setCredentialChangeListener(async n=>{a.isEqual(n)||(await rg(e.localStore,n),a=n)}),e.persistence.setDatabaseDeletedListener(()=>s.terminate()),s._offlineComponents=e}async function Eh(s,e){s.asyncQueue.verifyOperationInProgress();const r=await m1(s);_e("FirestoreClient","Initializing OnlineComponentProvider"),await e.initialize(r,s.configuration),s.setCredentialChangeListener(a=>vh(e.remoteStore,a)),s.setAppCheckTokenChangeListener((a,n)=>vh(e.remoteStore,n)),s._onlineComponents=e}async function m1(s){if(!s._offlineComponents)if(s._uninitializedComponentsProvider){_e("FirestoreClient","Using user provided OfflineComponentProvider");try{await Dl(s,s._uninitializedComponentsProvider._offline)}catch(e){const r=e;if(!function(n){return n.name==="FirebaseError"?n.code===ae.FAILED_PRECONDITION||n.code===ae.UNIMPLEMENTED:!(typeof DOMException<"u"&&n instanceof DOMException)||n.code===22||n.code===20||n.code===11}(r))throw r;Ha("Error using user provided cache. Falling back to memory cache: "+r),await Dl(s,new ho)}}else _e("FirestoreClient","Using default OfflineComponentProvider"),await Dl(s,new ho);return s._offlineComponents}async function vg(s){return s._onlineComponents||(s._uninitializedComponentsProvider?(_e("FirestoreClient","Using user provided OnlineComponentProvider"),await Eh(s,s._uninitializedComponentsProvider._online)):(_e("FirestoreClient","Using default OnlineComponentProvider"),await Eh(s,new fc))),s._onlineComponents}function g1(s){return vg(s).then(e=>e.syncEngine)}async function mo(s){const e=await vg(s),r=e.eventManager;return r.onListen=Zw.bind(null,e.syncEngine),r.onUnlisten=r1.bind(null,e.syncEngine),r.onFirstRemoteStoreListen=e1.bind(null,e.syncEngine),r.onLastRemoteStoreUnlisten=s1.bind(null,e.syncEngine),r}function p1(s,e,r={}){const a=new xs;return s.asyncQueue.enqueueAndForget(async()=>function(i,o,c,d,u){const m=new dd({next:x=>{m.Za(),o.enqueueAndForget(()=>id(i,f));const v=x.docs.has(c);!v&&x.fromCache?u.reject(new we(ae.UNAVAILABLE,"Failed to get document because the client is offline.")):v&&x.fromCache&&d&&d.source==="server"?u.reject(new we(ae.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):u.resolve(x)},error:x=>u.reject(x)}),f=new ld(Po(c.path),m,{includeMetadataChanges:!0,_a:!0});return nd(i,f)}(await mo(s),s.asyncQueue,e,r,a)),a.promise}function x1(s,e,r={}){const a=new xs;return s.asyncQueue.enqueueAndForget(async()=>function(i,o,c,d,u){const m=new dd({next:x=>{m.Za(),o.enqueueAndForget(()=>id(i,f)),x.fromCache&&d.source==="server"?u.reject(new we(ae.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):u.resolve(x)},error:x=>u.reject(x)}),f=new ld(c,m,{includeMetadataChanges:!0,_a:!0});return nd(i,f)}(await mo(s),s.asyncQueue,e,r,a)),a.promise}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wg(s){const e={};return s.timeoutSeconds!==void 0&&(e.timeoutSeconds=s.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Th=new Map;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function kg(s,e,r){if(!r)throw new we(ae.INVALID_ARGUMENT,`Function ${s}() cannot be called with an empty ${e}.`)}function f1(s,e,r,a){if(e===!0&&a===!0)throw new we(ae.INVALID_ARGUMENT,`${s} and ${r} cannot be used together.`)}function Sh(s){if(!Ae.isDocumentKey(s))throw new we(ae.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${s} has ${s.length}.`)}function Ih(s){if(Ae.isDocumentKey(s))throw new we(ae.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${s} has ${s.length}.`)}function qo(s){if(s===void 0)return"undefined";if(s===null)return"null";if(typeof s=="string")return s.length>20&&(s=`${s.substring(0,20)}...`),JSON.stringify(s);if(typeof s=="number"||typeof s=="boolean")return""+s;if(typeof s=="object"){if(s instanceof Array)return"an array";{const e=function(a){return a.constructor?a.constructor.name:null}(s);return e?`a custom ${e} object`:"an object"}}return typeof s=="function"?"a function":Ve()}function Cr(s,e){if("_delegate"in s&&(s=s._delegate),!(s instanceof e)){if(e.name===s.constructor.name)throw new we(ae.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const r=qo(s);throw new we(ae.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${r}`)}}return s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ah{constructor(e){var r,a;if(e.host===void 0){if(e.ssl!==void 0)throw new we(ae.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=(r=e.ssl)===null||r===void 0||r;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new we(ae.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}f1("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=wg((a=e.experimentalLongPollingOptions)!==null&&a!==void 0?a:{}),function(i){if(i.timeoutSeconds!==void 0){if(isNaN(i.timeoutSeconds))throw new we(ae.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (must not be NaN)`);if(i.timeoutSeconds<5)throw new we(ae.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (minimum allowed value is 5)`);if(i.timeoutSeconds>30)throw new we(ae.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(a,n){return a.timeoutSeconds===n.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class Wo{constructor(e,r,a,n){this._authCredentials=e,this._appCheckCredentials=r,this._databaseId=a,this._app=n,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Ah({}),this._settingsFrozen=!1,this._terminateTask="notTerminated"}get app(){if(!this._app)throw new we(ae.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new we(ae.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Ah(e),e.credentials!==void 0&&(this._authCredentials=function(a){if(!a)return new Py;switch(a.type){case"firstParty":return new Ly(a.sessionIndex||"0",a.iamToken||null,a.authTokenFactory||null);case"provider":return a.client;default:throw new we(ae.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(r){const a=Th.get(r);a&&(_e("ComponentProvider","Removing Datastore"),Th.delete(r),a.terminate())}(this),Promise.resolve()}}function b1(s,e,r,a={}){var n;const i=(s=Cr(s,Wo))._getSettings(),o=`${e}:${r}`;if(i.host!=="firestore.googleapis.com"&&i.host!==o&&Ha("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),s._setSettings(Object.assign(Object.assign({},i),{host:o,ssl:!1})),a.mockUserToken){let c,d;if(typeof a.mockUserToken=="string")c=a.mockUserToken,d=er.MOCK_USER;else{c=dm(a.mockUserToken,(n=s._app)===null||n===void 0?void 0:n.options.projectId);const u=a.mockUserToken.sub||a.mockUserToken.user_id;if(!u)throw new we(ae.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");d=new er(u)}s._authCredentials=new My(new km(c,d))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zs{constructor(e,r,a){this.converter=r,this._query=a,this.type="query",this.firestore=e}withConverter(e){return new Zs(this.firestore,e,this._query)}}class hr{constructor(e,r,a){this.converter=r,this._key=a,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new zs(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new hr(this.firestore,e,this._key)}}class zs extends Zs{constructor(e,r,a){super(e,r,Po(a)),this._path=a,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new hr(this.firestore,null,new Ae(e))}withConverter(e){return new zs(this.firestore,e,this._path)}}function Xe(s,e,...r){if(s=St(s),kg("collection","path",e),s instanceof Wo){const a=gt.fromString(e,...r);return Ih(a),new zs(s,null,a)}{if(!(s instanceof hr||s instanceof zs))throw new we(ae.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const a=s._path.child(gt.fromString(e,...r));return Ih(a),new zs(s.firestore,null,a)}}function tt(s,e,...r){if(s=St(s),arguments.length===1&&(e=jm.newId()),kg("doc","path",e),s instanceof Wo){const a=gt.fromString(e,...r);return Sh(a),new hr(s,null,new Ae(a))}{if(!(s instanceof hr||s instanceof zs))throw new we(ae.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const a=s._path.child(gt.fromString(e,...r));return Sh(a),new hr(s.firestore,s instanceof zs?s.converter:null,new Ae(a))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ch{constructor(e=Promise.resolve()){this.Pu=[],this.Iu=!1,this.Tu=[],this.Eu=null,this.du=!1,this.Au=!1,this.Ru=[],this.t_=new ag(this,"async_queue_retry"),this.Vu=()=>{const a=Cl();a&&_e("AsyncQueue","Visibility state changed to "+a.visibilityState),this.t_.jo()},this.mu=e;const r=Cl();r&&typeof r.addEventListener=="function"&&r.addEventListener("visibilitychange",this.Vu)}get isShuttingDown(){return this.Iu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.fu(),this.gu(e)}enterRestrictedMode(e){if(!this.Iu){this.Iu=!0,this.Au=e||!1;const r=Cl();r&&typeof r.removeEventListener=="function"&&r.removeEventListener("visibilitychange",this.Vu)}}enqueue(e){if(this.fu(),this.Iu)return new Promise(()=>{});const r=new xs;return this.gu(()=>this.Iu&&this.Au?Promise.resolve():(e().then(r.resolve,r.reject),r.promise)).then(()=>r.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Pu.push(e),this.pu()))}async pu(){if(this.Pu.length!==0){try{await this.Pu[0](),this.Pu.shift(),this.t_.reset()}catch(e){if(!ni(e))throw e;_e("AsyncQueue","Operation failed with retryable error: "+e)}this.Pu.length>0&&this.t_.Go(()=>this.pu())}}gu(e){const r=this.mu.then(()=>(this.du=!0,e().catch(a=>{this.Eu=a,this.du=!1;const n=function(o){let c=o.message||"";return o.stack&&(c=o.stack.includes(o.message)?o.stack:o.message+`
`+o.stack),c}(a);throw ws("INTERNAL UNHANDLED ERROR: ",n),a}).then(a=>(this.du=!1,a))));return this.mu=r,r}enqueueAfterDelay(e,r,a){this.fu(),this.Ru.indexOf(e)>-1&&(r=0);const n=sd.createAndSchedule(this,e,r,a,i=>this.yu(i));return this.Tu.push(n),n}fu(){this.Eu&&Ve()}verifyOperationInProgress(){}async wu(){let e;do e=this.mu,await e;while(e!==this.mu)}Su(e){for(const r of this.Tu)if(r.timerId===e)return!0;return!1}bu(e){return this.wu().then(()=>{this.Tu.sort((r,a)=>r.targetTimeMs-a.targetTimeMs);for(const r of this.Tu)if(r.skipDelay(),e!=="all"&&r.timerId===e)break;return this.wu()})}Du(e){this.Ru.push(e)}yu(e){const r=this.Tu.indexOf(e);this.Tu.splice(r,1)}}function Dh(s){return function(r,a){if(typeof r!="object"||r===null)return!1;const n=r;for(const i of a)if(i in n&&typeof n[i]=="function")return!0;return!1}(s,["next","error","complete"])}class Xs extends Wo{constructor(e,r,a,n){super(e,r,a,n),this.type="firestore",this._queue=new Ch,this._persistenceKey=(n==null?void 0:n.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new Ch(e),this._firestoreClient=void 0,await e}}}function y1(s,e){const r=typeof s=="object"?s:Oc(),a=typeof s=="string"?s:"(default)",n=$o(r,"firestore").getImmediate({identifier:a});if(!n._initialized){const i=om("firestore");i&&b1(n,...i)}return n}function Ho(s){if(s._terminated)throw new we(ae.FAILED_PRECONDITION,"The client has already been terminated.");return s._firestoreClient||v1(s),s._firestoreClient}function v1(s){var e,r,a;const n=s._freezeSettings(),i=function(c,d,u,m){return new Jy(c,d,u,m.host,m.ssl,m.experimentalForceLongPolling,m.experimentalAutoDetectLongPolling,wg(m.experimentalLongPollingOptions),m.useFetchStreams)}(s._databaseId,((e=s._app)===null||e===void 0?void 0:e.options.appId)||"",s._persistenceKey,n);s._componentsProvider||!((r=n.localCache)===null||r===void 0)&&r._offlineComponentProvider&&(!((a=n.localCache)===null||a===void 0)&&a._onlineComponentProvider)&&(s._componentsProvider={_offline:n.localCache._offlineComponentProvider,_online:n.localCache._onlineComponentProvider}),s._firestoreClient=new h1(s._authCredentials,s._appCheckCredentials,s._queue,i,s._componentsProvider&&function(c){const d=c==null?void 0:c._online.build();return{_offline:c==null?void 0:c._offline.build(d),_online:d}}(s._componentsProvider))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ja{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Ja(Qt.fromBase64String(e))}catch(r){throw new we(ae.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+r)}}static fromUint8Array(e){return new Ja(Qt.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Go{constructor(...e){for(let r=0;r<e.length;++r)if(e[r].length===0)throw new we(ae.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Ht(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ud{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hd{constructor(e,r){if(!isFinite(e)||e<-90||e>90)throw new we(ae.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(r)||r<-180||r>180)throw new we(ae.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+r);this._lat=e,this._long=r}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return Ze(this._lat,e._lat)||Ze(this._long,e._long)}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class md{constructor(e){this._values=(e||[]).map(r=>r)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(a,n){if(a.length!==n.length)return!1;for(let i=0;i<a.length;++i)if(a[i]!==n[i])return!1;return!0}(this._values,e._values)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const w1=/^__.*__$/;class k1{constructor(e,r,a){this.data=e,this.fieldMask=r,this.fieldTransforms=a}toMutation(e,r){return this.fieldMask!==null?new Js(e,this.data,this.fieldMask,r,this.fieldTransforms):new ii(e,this.data,r,this.fieldTransforms)}}class jg{constructor(e,r,a){this.data=e,this.fieldMask=r,this.fieldTransforms=a}toMutation(e,r){return new Js(e,this.data,this.fieldMask,r,this.fieldTransforms)}}function Ng(s){switch(s){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Ve()}}class gd{constructor(e,r,a,n,i,o){this.settings=e,this.databaseId=r,this.serializer=a,this.ignoreUndefinedProperties=n,i===void 0&&this.vu(),this.fieldTransforms=i||[],this.fieldMask=o||[]}get path(){return this.settings.path}get Cu(){return this.settings.Cu}Fu(e){return new gd(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Mu(e){var r;const a=(r=this.path)===null||r===void 0?void 0:r.child(e),n=this.Fu({path:a,xu:!1});return n.Ou(e),n}Nu(e){var r;const a=(r=this.path)===null||r===void 0?void 0:r.child(e),n=this.Fu({path:a,xu:!1});return n.vu(),n}Lu(e){return this.Fu({path:void 0,xu:!0})}Bu(e){return go(e,this.settings.methodName,this.settings.ku||!1,this.path,this.settings.qu)}contains(e){return this.fieldMask.find(r=>e.isPrefixOf(r))!==void 0||this.fieldTransforms.find(r=>e.isPrefixOf(r.field))!==void 0}vu(){if(this.path)for(let e=0;e<this.path.length;e++)this.Ou(this.path.get(e))}Ou(e){if(e.length===0)throw this.Bu("Document fields must not be empty");if(Ng(this.Cu)&&w1.test(e))throw this.Bu('Document fields cannot begin and end with "__"')}}class j1{constructor(e,r,a){this.databaseId=e,this.ignoreUndefinedProperties=r,this.serializer=a||Uo(e)}Qu(e,r,a,n=!1){return new gd({Cu:e,methodName:r,qu:a,path:Ht.emptyPath(),xu:!1,ku:n},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function pd(s){const e=s._freezeSettings(),r=Uo(s._databaseId);return new j1(s._databaseId,!!e.ignoreUndefinedProperties,r)}function N1(s,e,r,a,n,i={}){const o=s.Qu(i.merge||i.mergeFields?2:0,e,r,n);xd("Data must be an object, but it was:",o,a);const c=_g(a,o);let d,u;if(i.merge)d=new Nr(o.fieldMask),u=o.fieldTransforms;else if(i.mergeFields){const m=[];for(const f of i.mergeFields){const x=bc(e,f,r);if(!o.contains(x))throw new we(ae.INVALID_ARGUMENT,`Field '${x}' is specified in your field mask but missing from your input data.`);Tg(m,x)||m.push(x)}d=new Nr(m),u=o.fieldTransforms.filter(f=>d.covers(f.field))}else d=null,u=o.fieldTransforms;return new k1(new br(c),d,u)}class Ko extends ud{_toFieldTransform(e){if(e.Cu!==2)throw e.Cu===1?e.Bu(`${this._methodName}() can only appear at the top level of your update data`):e.Bu(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof Ko}}function _1(s,e,r,a){const n=s.Qu(1,e,r);xd("Data must be an object, but it was:",n,a);const i=[],o=br.empty();Na(a,(d,u)=>{const m=fd(e,d,r);u=St(u);const f=n.Nu(m);if(u instanceof Ko)i.push(m);else{const x=di(u,f);x!=null&&(i.push(m),o.set(m,x))}});const c=new Nr(i);return new jg(o,c,n.fieldTransforms)}function E1(s,e,r,a,n,i){const o=s.Qu(1,e,r),c=[bc(e,a,r)],d=[n];if(i.length%2!=0)throw new we(ae.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let x=0;x<i.length;x+=2)c.push(bc(e,i[x])),d.push(i[x+1]);const u=[],m=br.empty();for(let x=c.length-1;x>=0;--x)if(!Tg(u,c[x])){const v=c[x];let T=d[x];T=St(T);const I=o.Nu(v);if(T instanceof Ko)u.push(v);else{const N=di(T,I);N!=null&&(u.push(v),m.set(v,N))}}const f=new Nr(u);return new jg(m,f,o.fieldTransforms)}function T1(s,e,r,a=!1){return di(r,s.Qu(a?4:3,e))}function di(s,e){if(Eg(s=St(s)))return xd("Unsupported field value:",e,s),_g(s,e);if(s instanceof ud)return function(a,n){if(!Ng(n.Cu))throw n.Bu(`${a._methodName}() can only be used with update() and set()`);if(!n.path)throw n.Bu(`${a._methodName}() is not currently supported inside arrays`);const i=a._toFieldTransform(n);i&&n.fieldTransforms.push(i)}(s,e),null;if(s===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),s instanceof Array){if(e.settings.xu&&e.Cu!==4)throw e.Bu("Nested arrays are not supported");return function(a,n){const i=[];let o=0;for(const c of a){let d=di(c,n.Lu(o));d==null&&(d={nullValue:"NULL_VALUE"}),i.push(d),o++}return{arrayValue:{values:i}}}(s,e)}return function(a,n){if((a=St(a))===null)return{nullValue:"NULL_VALUE"};if(typeof a=="number")return vv(n.serializer,a);if(typeof a=="boolean")return{booleanValue:a};if(typeof a=="string")return{stringValue:a};if(a instanceof Date){const i=Rt.fromDate(a);return{timestampValue:co(n.serializer,i)}}if(a instanceof Rt){const i=new Rt(a.seconds,1e3*Math.floor(a.nanoseconds/1e3));return{timestampValue:co(n.serializer,i)}}if(a instanceof hd)return{geoPointValue:{latitude:a.latitude,longitude:a.longitude}};if(a instanceof Ja)return{bytesValue:Qm(n.serializer,a._byteString)};if(a instanceof hr){const i=n.databaseId,o=a.firestore._databaseId;if(!o.isEqual(i))throw n.Bu(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${i.projectId}/${i.database}`);return{referenceValue:Qc(a.firestore._databaseId||n.databaseId,a._key.path)}}if(a instanceof md)return function(o,c){return{mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{values:o.toArray().map(d=>{if(typeof d!="number")throw c.Bu("VectorValues must only contain numeric values.");return Wc(c.serializer,d)})}}}}}}(a,n);throw n.Bu(`Unsupported field value: ${qo(a)}`)}(s,e)}function _g(s,e){const r={};return Nm(s)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Na(s,(a,n)=>{const i=di(n,e.Mu(a));i!=null&&(r[a]=i)}),{mapValue:{fields:r}}}function Eg(s){return!(typeof s!="object"||s===null||s instanceof Array||s instanceof Date||s instanceof Rt||s instanceof hd||s instanceof Ja||s instanceof hr||s instanceof ud||s instanceof md)}function xd(s,e,r){if(!Eg(r)||!function(n){return typeof n=="object"&&n!==null&&(Object.getPrototypeOf(n)===Object.prototype||Object.getPrototypeOf(n)===null)}(r)){const a=qo(r);throw a==="an object"?e.Bu(s+" a custom object"):e.Bu(s+" "+a)}}function bc(s,e,r){if((e=St(e))instanceof Go)return e._internalPath;if(typeof e=="string")return fd(s,e);throw go("Field path arguments must be of type string or ",s,!1,void 0,r)}const S1=new RegExp("[~\\*/\\[\\]]");function fd(s,e,r){if(e.search(S1)>=0)throw go(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,s,!1,void 0,r);try{return new Go(...e.split("."))._internalPath}catch{throw go(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,s,!1,void 0,r)}}function go(s,e,r,a,n){const i=a&&!a.isEmpty(),o=n!==void 0;let c=`Function ${e}() called with invalid data`;r&&(c+=" (via `toFirestore()`)"),c+=". ";let d="";return(i||o)&&(d+=" (found",i&&(d+=` in field ${a}`),o&&(d+=` in document ${n}`),d+=")"),new we(ae.INVALID_ARGUMENT,c+s+d)}function Tg(s,e){return s.some(r=>r.isEqual(e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sg{constructor(e,r,a,n,i){this._firestore=e,this._userDataWriter=r,this._key=a,this._document=n,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new hr(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new I1(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const r=this._document.data.field(Qo("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r)}}}class I1 extends Sg{data(){return super.data()}}function Qo(s,e){return typeof e=="string"?fd(s,e):e instanceof Go?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ig(s){if(s.limitType==="L"&&s.explicitOrderBy.length===0)throw new we(ae.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class bd{}class Ag extends bd{}function et(s,e,...r){let a=[];e instanceof bd&&a.push(e),a=a.concat(r),function(i){const o=i.filter(d=>d instanceof yd).length,c=i.filter(d=>d instanceof Yo).length;if(o>1||o>0&&c>0)throw new we(ae.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(a);for(const n of a)s=n._apply(s);return s}class Yo extends Ag{constructor(e,r,a){super(),this._field=e,this._op=r,this._value=a,this.type="where"}static _create(e,r,a){return new Yo(e,r,a)}_apply(e){const r=this._parse(e);return Cg(e._query,r),new Zs(e.firestore,e.converter,lc(e._query,r))}_parse(e){const r=pd(e.firestore);return function(i,o,c,d,u,m,f){let x;if(u.isKeyField()){if(m==="array-contains"||m==="array-contains-any")throw new we(ae.INVALID_ARGUMENT,`Invalid Query. You can't perform '${m}' queries on documentId().`);if(m==="in"||m==="not-in"){Rh(f,m);const v=[];for(const T of f)v.push($h(d,i,T));x={arrayValue:{values:v}}}else x=$h(d,i,f)}else m!=="in"&&m!=="not-in"&&m!=="array-contains-any"||Rh(f,m),x=T1(c,o,f,m==="in"||m==="not-in");return At.create(u,m,x)}(e._query,"where",r,e.firestore._databaseId,this._field,this._op,this._value)}}function Tt(s,e,r){const a=e,n=Qo("where",s);return Yo._create(n,a,r)}class yd extends bd{constructor(e,r){super(),this.type=e,this._queryConstraints=r}static _create(e,r){return new yd(e,r)}_parse(e){const r=this._queryConstraints.map(a=>a._parse(e)).filter(a=>a.getFilters().length>0);return r.length===1?r[0]:Or.create(r,this._getOperator())}_apply(e){const r=this._parse(e);return r.getFilters().length===0?e:(function(n,i){let o=n;const c=i.getFlattenedFilters();for(const d of c)Cg(o,d),o=lc(o,d)}(e._query,r),new Zs(e.firestore,e.converter,lc(e._query,r)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}class vd extends Ag{constructor(e,r){super(),this._field=e,this._direction=r,this.type="orderBy"}static _create(e,r){return new vd(e,r)}_apply(e){const r=function(n,i,o){if(n.startAt!==null)throw new we(ae.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(n.endAt!==null)throw new we(ae.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new Kn(i,o)}(e._query,this._field,this._direction);return new Zs(e.firestore,e.converter,function(n,i){const o=n.explicitOrderBy.concat([i]);return new on(n.path,n.collectionGroup,o,n.filters.slice(),n.limit,n.limitType,n.startAt,n.endAt)}(e._query,r))}}function ya(s,e="asc"){const r=e,a=Qo("orderBy",s);return vd._create(a,r)}function $h(s,e,r){if(typeof(r=St(r))=="string"){if(r==="")throw new we(ae.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!$m(e)&&r.indexOf("/")!==-1)throw new we(ae.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${r}' contains a '/' character.`);const a=e.path.child(gt.fromString(r));if(!Ae.isDocumentKey(a))throw new we(ae.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${a}' is not because it has an odd number of segments (${a.length}).`);return eh(s,new Ae(a))}if(r instanceof hr)return eh(s,r._key);throw new we(ae.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${qo(r)}.`)}function Rh(s,e){if(!Array.isArray(s)||s.length===0)throw new we(ae.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function Cg(s,e){const r=function(n,i){for(const o of n)for(const c of o.getFlattenedFilters())if(i.indexOf(c.op)>=0)return c.op;return null}(s.filters,function(n){switch(n){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(r!==null)throw r===e.op?new we(ae.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new we(ae.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${r.toString()}' filters.`)}class A1{convertValue(e,r="none"){switch(ba(e)){case 0:return null;case 1:return e.booleanValue;case 2:return _t(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,r);case 5:return e.stringValue;case 6:return this.convertBytes(fa(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,r);case 11:return this.convertObject(e.mapValue,r);case 10:return this.convertVectorValue(e.mapValue);default:throw Ve()}}convertObject(e,r){return this.convertObjectMap(e.fields,r)}convertObjectMap(e,r="none"){const a={};return Na(e,(n,i)=>{a[n]=this.convertValue(i,r)}),a}convertVectorValue(e){var r,a,n;const i=(n=(a=(r=e.fields)===null||r===void 0?void 0:r.value.arrayValue)===null||a===void 0?void 0:a.values)===null||n===void 0?void 0:n.map(o=>_t(o.doubleValue));return new md(i)}convertGeoPoint(e){return new hd(_t(e.latitude),_t(e.longitude))}convertArray(e,r){return(e.values||[]).map(a=>this.convertValue(a,r))}convertServerTimestamp(e,r){switch(r){case"previous":const a=Uc(e);return a==null?null:this.convertValue(a,r);case"estimate":return this.convertTimestamp(Wn(e));default:return null}}convertTimestamp(e){const r=Qs(e);return new Rt(r.seconds,r.nanos)}convertDocumentKey(e,r){const a=gt.fromString(e);at(tg(a));const n=new Hn(a.get(1),a.get(3)),i=new Ae(a.popFirst(5));return n.isEqual(r)||ws(`Document ${i} contains a document reference within a different database (${n.projectId}/${n.database}) which is not supported. It will be treated as a reference in the current database (${r.projectId}/${r.database}) instead.`),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function C1(s,e,r){let a;return a=s?s.toFirestore(e):e,a}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cn{constructor(e,r){this.hasPendingWrites=e,this.fromCache=r}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class Dg extends Sg{constructor(e,r,a,n,i,o){super(e,r,a,n,o),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const r=new Ui(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(r,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,r={}){if(this._document){const a=this._document.data.field(Qo("DocumentSnapshot.get",e));if(a!==null)return this._userDataWriter.convertValue(a,r.serverTimestamps)}}}class Ui extends Dg{data(e={}){return super.data(e)}}class $g{constructor(e,r,a,n){this._firestore=e,this._userDataWriter=r,this._snapshot=n,this.metadata=new Cn(n.hasPendingWrites,n.fromCache),this.query=a}get docs(){const e=[];return this.forEach(r=>e.push(r)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,r){this._snapshot.docs.forEach(a=>{e.call(r,new Ui(this._firestore,this._userDataWriter,a.key,a,new Cn(this._snapshot.mutatedKeys.has(a.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const r=!!e.includeMetadataChanges;if(r&&this._snapshot.excludesMetadataChanges)throw new we(ae.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===r||(this._cachedChanges=function(n,i){if(n._snapshot.oldDocs.isEmpty()){let o=0;return n._snapshot.docChanges.map(c=>{const d=new Ui(n._firestore,n._userDataWriter,c.doc.key,c.doc,new Cn(n._snapshot.mutatedKeys.has(c.doc.key),n._snapshot.fromCache),n.query.converter);return c.doc,{type:"added",doc:d,oldIndex:-1,newIndex:o++}})}{let o=n._snapshot.oldDocs;return n._snapshot.docChanges.filter(c=>i||c.type!==3).map(c=>{const d=new Ui(n._firestore,n._userDataWriter,c.doc.key,c.doc,new Cn(n._snapshot.mutatedKeys.has(c.doc.key),n._snapshot.fromCache),n.query.converter);let u=-1,m=-1;return c.type!==0&&(u=o.indexOf(c.doc.key),o=o.delete(c.doc.key)),c.type!==1&&(o=o.add(c.doc),m=o.indexOf(c.doc.key)),{type:D1(c.type),doc:d,oldIndex:u,newIndex:m}})}}(this,r),this._cachedChangesIncludeMetadataChanges=r),this._cachedChanges}}function D1(s){switch(s){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Ve()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function po(s){s=Cr(s,hr);const e=Cr(s.firestore,Xs);return p1(Ho(e),s._key).then(r=>Rg(e,s,r))}class wd extends A1{constructor(e){super(),this.firestore=e}convertBytes(e){return new Ja(e)}convertReference(e){const r=this.convertDocumentKey(e,this.firestore._databaseId);return new hr(this.firestore,null,r)}}function Ft(s){s=Cr(s,Zs);const e=Cr(s.firestore,Xs),r=Ho(e),a=new wd(e);return Ig(s._query),x1(r,s._query).then(n=>new $g(e,a,s,n))}function lr(s,e,r,...a){s=Cr(s,hr);const n=Cr(s.firestore,Xs),i=pd(n);let o;return o=typeof(e=St(e))=="string"||e instanceof Go?E1(i,"updateDoc",s._key,e,r,a):_1(i,"updateDoc",s._key,e),kd(n,[o.toMutation(s._key,Mr.exists(!0))])}function gr(s){return kd(Cr(s.firestore,Xs),[new Hc(s._key,Mr.none())])}function pr(s,e){const r=Cr(s.firestore,Xs),a=tt(s),n=C1(s.converter,e);return kd(r,[N1(pd(s.firestore),"addDoc",a._key,n,s.converter!==null,{}).toMutation(a._key,Mr.exists(!1))]).then(()=>a)}function $1(s,...e){var r,a,n;s=St(s);let i={includeMetadataChanges:!1,source:"default"},o=0;typeof e[o]!="object"||Dh(e[o])||(i=e[o],o++);const c={includeMetadataChanges:i.includeMetadataChanges,source:i.source};if(Dh(e[o])){const f=e[o];e[o]=(r=f.next)===null||r===void 0?void 0:r.bind(f),e[o+1]=(a=f.error)===null||a===void 0?void 0:a.bind(f),e[o+2]=(n=f.complete)===null||n===void 0?void 0:n.bind(f)}let d,u,m;if(s instanceof hr)u=Cr(s.firestore,Xs),m=Po(s._key.path),d={next:f=>{e[o]&&e[o](Rg(u,s,f))},error:e[o+1],complete:e[o+2]};else{const f=Cr(s,Zs);u=Cr(f.firestore,Xs),m=f._query;const x=new wd(u);d={next:v=>{e[o]&&e[o](new $g(u,x,f,v))},error:e[o+1],complete:e[o+2]},Ig(s._query)}return function(x,v,T,I){const N=new dd(I),O=new ld(v,N,T);return x.asyncQueue.enqueueAndForget(async()=>nd(await mo(x),O)),()=>{N.Za(),x.asyncQueue.enqueueAndForget(async()=>id(await mo(x),O))}}(Ho(u),m,c,d)}function kd(s,e){return function(a,n){const i=new xs;return a.asyncQueue.enqueueAndForget(async()=>a1(await g1(a),n,i)),i.promise}(Ho(s),e)}function Rg(s,e,r){const a=r.docs.get(e._key),n=new wd(s);return new Dg(s,n,e._key,a,new Cn(r.hasPendingWrites,r.fromCache),e.converter)}(function(e,r=!0){(function(n){nn=n})(ja),pa(new Gs("firestore",(a,{instanceIdentifier:n,options:i})=>{const o=a.getProvider("app").getImmediate(),c=new Xs(new Oy(a.getProvider("auth-internal")),new Uy(a.getProvider("app-check-internal")),function(u,m){if(!Object.prototype.hasOwnProperty.apply(u.options,["projectId"]))throw new we(ae.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Hn(u.options.projectId,m)}(o,n),o);return i=Object.assign({useFetchStreams:r},i),c._setSettings(i),c},"PUBLIC").setMultipleInstances(!0)),Kr(Qu,"4.7.3",e),Kr(Qu,"4.7.3","esm2017")})();var R1="firebase",P1="10.14.1";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Kr(R1,P1,"app");function jd(s,e){var r={};for(var a in s)Object.prototype.hasOwnProperty.call(s,a)&&e.indexOf(a)<0&&(r[a]=s[a]);if(s!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,a=Object.getOwnPropertySymbols(s);n<a.length;n++)e.indexOf(a[n])<0&&Object.prototype.propertyIsEnumerable.call(s,a[n])&&(r[a[n]]=s[a[n]]);return r}function Pg(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const M1=Pg,Mg=new ri("auth","Firebase",Pg());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xo=new Pc("@firebase/auth");function O1(s,...e){xo.logLevel<=Ke.WARN&&xo.warn(`Auth (${ja}): ${s}`,...e)}function Bi(s,...e){xo.logLevel<=Ke.ERROR&&xo.error(`Auth (${ja}): ${s}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function js(s,...e){throw Nd(s,...e)}function Xr(s,...e){return Nd(s,...e)}function Og(s,e,r){const a=Object.assign(Object.assign({},M1()),{[e]:r});return new ri("auth","Firebase",a).create(e,{appName:s.name})}function ha(s){return Og(s,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function Nd(s,...e){if(typeof s!="string"){const r=e[0],a=[...e.slice(1)];return a[0]&&(a[0].appName=s.name),s._errorFactory.create(r,...a)}return Mg.create(s,...e)}function Oe(s,e,...r){if(!s)throw Nd(e,...r)}function ms(s){const e="INTERNAL ASSERTION FAILED: "+s;throw Bi(e),new Error(e)}function Ns(s,e){s||ms(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yc(){var s;return typeof self<"u"&&((s=self.location)===null||s===void 0?void 0:s.href)||""}function V1(){return Ph()==="http:"||Ph()==="https:"}function Ph(){var s;return typeof self<"u"&&((s=self.location)===null||s===void 0?void 0:s.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function L1(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(V1()||pb()||"connection"in navigator)?navigator.onLine:!0}function F1(){if(typeof navigator>"u")return null;const s=navigator;return s.languages&&s.languages[0]||s.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ui{constructor(e,r){this.shortDelay=e,this.longDelay=r,Ns(r>e,"Short delay should be less than long delay!"),this.isMobile=hb()||xb()}get(){return L1()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _d(s,e){Ns(s.emulator,"Emulator should always be set here");const{url:r}=s.emulator;return e?`${r}${e.startsWith("/")?e.slice(1):e}`:r}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vg{static initialize(e,r,a){this.fetchImpl=e,r&&(this.headersImpl=r),a&&(this.responseImpl=a)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;ms("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;ms("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;ms("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const U1={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const B1=new ui(3e4,6e4);function Ed(s,e){return s.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:s.tenantId}):e}async function dn(s,e,r,a,n={}){return Lg(s,n,async()=>{let i={},o={};a&&(e==="GET"?o=a:i={body:JSON.stringify(a)});const c=si(Object.assign({key:s.config.apiKey},o)).slice(1),d=await s._getAdditionalHeaders();d["Content-Type"]="application/json",s.languageCode&&(d["X-Firebase-Locale"]=s.languageCode);const u=Object.assign({method:e,headers:d},i);return gb()||(u.referrerPolicy="no-referrer"),Vg.fetch()(Fg(s,s.config.apiHost,r,c),u)})}async function Lg(s,e,r){s._canInitEmulator=!1;const a=Object.assign(Object.assign({},U1),e);try{const n=new q1(s),i=await Promise.race([r(),n.promise]);n.clearNetworkTimeout();const o=await i.json();if("needConfirmation"in o)throw Ai(s,"account-exists-with-different-credential",o);if(i.ok&&!("errorMessage"in o))return o;{const c=i.ok?o.errorMessage:o.error.message,[d,u]=c.split(" : ");if(d==="FEDERATED_USER_ID_ALREADY_LINKED")throw Ai(s,"credential-already-in-use",o);if(d==="EMAIL_EXISTS")throw Ai(s,"email-already-in-use",o);if(d==="USER_DISABLED")throw Ai(s,"user-disabled",o);const m=a[d]||d.toLowerCase().replace(/[_\s]+/g,"-");if(u)throw Og(s,m,u);js(s,m)}}catch(n){if(n instanceof as)throw n;js(s,"network-request-failed",{message:String(n)})}}async function z1(s,e,r,a,n={}){const i=await dn(s,e,r,a,n);return"mfaPendingCredential"in i&&js(s,"multi-factor-auth-required",{_serverResponse:i}),i}function Fg(s,e,r,a){const n=`${e}${r}?${a}`;return s.config.emulator?_d(s.config,n):`${s.config.apiScheme}://${n}`}class q1{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((r,a)=>{this.timer=setTimeout(()=>a(Xr(this.auth,"network-request-failed")),B1.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function Ai(s,e,r){const a={appName:s.name};r.email&&(a.email=r.email),r.phoneNumber&&(a.phoneNumber=r.phoneNumber);const n=Xr(s,e,a);return n.customData._tokenResponse=r,n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function W1(s,e){return dn(s,"POST","/v1/accounts:delete",e)}async function Ug(s,e){return dn(s,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Vn(s){if(s)try{const e=new Date(Number(s));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function H1(s,e=!1){const r=St(s),a=await r.getIdToken(e),n=Td(a);Oe(n&&n.exp&&n.auth_time&&n.iat,r.auth,"internal-error");const i=typeof n.firebase=="object"?n.firebase:void 0,o=i==null?void 0:i.sign_in_provider;return{claims:n,token:a,authTime:Vn($l(n.auth_time)),issuedAtTime:Vn($l(n.iat)),expirationTime:Vn($l(n.exp)),signInProvider:o||null,signInSecondFactor:(i==null?void 0:i.sign_in_second_factor)||null}}function $l(s){return Number(s)*1e3}function Td(s){const[e,r,a]=s.split(".");if(e===void 0||r===void 0||a===void 0)return Bi("JWT malformed, contained fewer than 3 sections"),null;try{const n=nm(r);return n?JSON.parse(n):(Bi("Failed to decode base64 JWT payload"),null)}catch(n){return Bi("Caught error parsing JWT payload as JSON",n==null?void 0:n.toString()),null}}function Mh(s){const e=Td(s);return Oe(e,"internal-error"),Oe(typeof e.exp<"u","internal-error"),Oe(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Xn(s,e,r=!1){if(r)return e;try{return await e}catch(a){throw a instanceof as&&G1(a)&&s.auth.currentUser===s&&await s.auth.signOut(),a}}function G1({code:s}){return s==="auth/user-disabled"||s==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class K1{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){var r;if(e){const a=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),a}else{this.errorBackoff=3e4;const n=((r=this.user.stsTokenManager.expirationTime)!==null&&r!==void 0?r:0)-Date.now()-3e5;return Math.max(0,n)}}schedule(e=!1){if(!this.isRunning)return;const r=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},r)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(e==null?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vc{constructor(e,r){this.createdAt=e,this.lastLoginAt=r,this._initializeTime()}_initializeTime(){this.lastSignInTime=Vn(this.lastLoginAt),this.creationTime=Vn(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function fo(s){var e;const r=s.auth,a=await s.getIdToken(),n=await Xn(s,Ug(r,{idToken:a}));Oe(n==null?void 0:n.users.length,r,"internal-error");const i=n.users[0];s._notifyReloadListener(i);const o=!((e=i.providerUserInfo)===null||e===void 0)&&e.length?Bg(i.providerUserInfo):[],c=Y1(s.providerData,o),d=s.isAnonymous,u=!(s.email&&i.passwordHash)&&!(c!=null&&c.length),m=d?u:!1,f={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:c,metadata:new vc(i.createdAt,i.lastLoginAt),isAnonymous:m};Object.assign(s,f)}async function Q1(s){const e=St(s);await fo(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function Y1(s,e){return[...s.filter(a=>!e.some(n=>n.providerId===a.providerId)),...e]}function Bg(s){return s.map(e=>{var{providerId:r}=e,a=jd(e,["providerId"]);return{providerId:r,uid:a.rawId||"",displayName:a.displayName||null,email:a.email||null,phoneNumber:a.phoneNumber||null,photoURL:a.photoUrl||null}})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function X1(s,e){const r=await Lg(s,{},async()=>{const a=si({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:n,apiKey:i}=s.config,o=Fg(s,n,"/v1/token",`key=${i}`),c=await s._getAdditionalHeaders();return c["Content-Type"]="application/x-www-form-urlencoded",Vg.fetch()(o,{method:"POST",headers:c,body:a})});return{accessToken:r.access_token,expiresIn:r.expires_in,refreshToken:r.refresh_token}}async function J1(s,e){return dn(s,"POST","/v2/accounts:revokeToken",Ed(s,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class La{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){Oe(e.idToken,"internal-error"),Oe(typeof e.idToken<"u","internal-error"),Oe(typeof e.refreshToken<"u","internal-error");const r="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):Mh(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,r)}updateFromIdToken(e){Oe(e.length!==0,"internal-error");const r=Mh(e);this.updateTokensAndExpiration(e,null,r)}async getToken(e,r=!1){return!r&&this.accessToken&&!this.isExpired?this.accessToken:(Oe(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,r){const{accessToken:a,refreshToken:n,expiresIn:i}=await X1(e,r);this.updateTokensAndExpiration(a,n,Number(i))}updateTokensAndExpiration(e,r,a){this.refreshToken=r||null,this.accessToken=e||null,this.expirationTime=Date.now()+a*1e3}static fromJSON(e,r){const{refreshToken:a,accessToken:n,expirationTime:i}=r,o=new La;return a&&(Oe(typeof a=="string","internal-error",{appName:e}),o.refreshToken=a),n&&(Oe(typeof n=="string","internal-error",{appName:e}),o.accessToken=n),i&&(Oe(typeof i=="number","internal-error",{appName:e}),o.expirationTime=i),o}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new La,this.toJSON())}_performRefresh(){return ms("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Is(s,e){Oe(typeof s=="string"||typeof s>"u","internal-error",{appName:e})}class gs{constructor(e){var{uid:r,auth:a,stsTokenManager:n}=e,i=jd(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new K1(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=r,this.auth=a,this.stsTokenManager=n,this.accessToken=n.accessToken,this.displayName=i.displayName||null,this.email=i.email||null,this.emailVerified=i.emailVerified||!1,this.phoneNumber=i.phoneNumber||null,this.photoURL=i.photoURL||null,this.isAnonymous=i.isAnonymous||!1,this.tenantId=i.tenantId||null,this.providerData=i.providerData?[...i.providerData]:[],this.metadata=new vc(i.createdAt||void 0,i.lastLoginAt||void 0)}async getIdToken(e){const r=await Xn(this,this.stsTokenManager.getToken(this.auth,e));return Oe(r,this.auth,"internal-error"),this.accessToken!==r&&(this.accessToken=r,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),r}getIdTokenResult(e){return H1(this,e)}reload(){return Q1(this)}_assign(e){this!==e&&(Oe(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(r=>Object.assign({},r)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const r=new gs(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return r.metadata._copy(this.metadata),r}_onReload(e){Oe(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,r=!1){let a=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),a=!0),r&&await fo(this),await this.auth._persistUserIfCurrent(this),a&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(Vs(this.auth.app))return Promise.reject(ha(this.auth));const e=await this.getIdToken();return await Xn(this,W1(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,r){var a,n,i,o,c,d,u,m;const f=(a=r.displayName)!==null&&a!==void 0?a:void 0,x=(n=r.email)!==null&&n!==void 0?n:void 0,v=(i=r.phoneNumber)!==null&&i!==void 0?i:void 0,T=(o=r.photoURL)!==null&&o!==void 0?o:void 0,I=(c=r.tenantId)!==null&&c!==void 0?c:void 0,N=(d=r._redirectEventId)!==null&&d!==void 0?d:void 0,O=(u=r.createdAt)!==null&&u!==void 0?u:void 0,D=(m=r.lastLoginAt)!==null&&m!==void 0?m:void 0,{uid:C,emailVerified:M,isAnonymous:V,providerData:U,stsTokenManager:y}=r;Oe(C&&y,e,"internal-error");const b=La.fromJSON(this.name,y);Oe(typeof C=="string",e,"internal-error"),Is(f,e.name),Is(x,e.name),Oe(typeof M=="boolean",e,"internal-error"),Oe(typeof V=="boolean",e,"internal-error"),Is(v,e.name),Is(T,e.name),Is(I,e.name),Is(N,e.name),Is(O,e.name),Is(D,e.name);const E=new gs({uid:C,auth:e,email:x,emailVerified:M,displayName:f,isAnonymous:V,photoURL:T,phoneNumber:v,tenantId:I,stsTokenManager:b,createdAt:O,lastLoginAt:D});return U&&Array.isArray(U)&&(E.providerData=U.map(j=>Object.assign({},j))),N&&(E._redirectEventId=N),E}static async _fromIdTokenResponse(e,r,a=!1){const n=new La;n.updateFromServerResponse(r);const i=new gs({uid:r.localId,auth:e,stsTokenManager:n,isAnonymous:a});return await fo(i),i}static async _fromGetAccountInfoResponse(e,r,a){const n=r.users[0];Oe(n.localId!==void 0,"internal-error");const i=n.providerUserInfo!==void 0?Bg(n.providerUserInfo):[],o=!(n.email&&n.passwordHash)&&!(i!=null&&i.length),c=new La;c.updateFromIdToken(a);const d=new gs({uid:n.localId,auth:e,stsTokenManager:c,isAnonymous:o}),u={uid:n.localId,displayName:n.displayName||null,photoURL:n.photoUrl||null,email:n.email||null,emailVerified:n.emailVerified||!1,phoneNumber:n.phoneNumber||null,tenantId:n.tenantId||null,providerData:i,metadata:new vc(n.createdAt,n.lastLoginAt),isAnonymous:!(n.email&&n.passwordHash)&&!(i!=null&&i.length)};return Object.assign(d,u),d}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Oh=new Map;function ps(s){Ns(s instanceof Function,"Expected a class definition");let e=Oh.get(s);return e?(Ns(e instanceof s,"Instance stored in cache mismatched with class"),e):(e=new s,Oh.set(s,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zg{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,r){this.storage[e]=r}async _get(e){const r=this.storage[e];return r===void 0?null:r}async _remove(e){delete this.storage[e]}_addListener(e,r){}_removeListener(e,r){}}zg.type="NONE";const Vh=zg;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zi(s,e,r){return`firebase:${s}:${e}:${r}`}class Fa{constructor(e,r,a){this.persistence=e,this.auth=r,this.userKey=a;const{config:n,name:i}=this.auth;this.fullUserKey=zi(this.userKey,n.apiKey,i),this.fullPersistenceKey=zi("persistence",n.apiKey,i),this.boundEventHandler=r._onStorageEvent.bind(r),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);return e?gs._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const r=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,r)return this.setCurrentUser(r)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,r,a="authUser"){if(!r.length)return new Fa(ps(Vh),e,a);const n=(await Promise.all(r.map(async u=>{if(await u._isAvailable())return u}))).filter(u=>u);let i=n[0]||ps(Vh);const o=zi(a,e.config.apiKey,e.name);let c=null;for(const u of r)try{const m=await u._get(o);if(m){const f=gs._fromJSON(e,m);u!==i&&(c=f),i=u;break}}catch{}const d=n.filter(u=>u._shouldAllowMigration);return!i._shouldAllowMigration||!d.length?new Fa(i,e,a):(i=d[0],c&&await i._set(o,c.toJSON()),await Promise.all(r.map(async u=>{if(u!==i)try{await u._remove(o)}catch{}})),new Fa(i,e,a))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Lh(s){const e=s.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(Gg(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(qg(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(Qg(e))return"Blackberry";if(Yg(e))return"Webos";if(Wg(e))return"Safari";if((e.includes("chrome/")||Hg(e))&&!e.includes("edge/"))return"Chrome";if(Kg(e))return"Android";{const r=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,a=s.match(r);if((a==null?void 0:a.length)===2)return a[1]}return"Other"}function qg(s=or()){return/firefox\//i.test(s)}function Wg(s=or()){const e=s.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function Hg(s=or()){return/crios\//i.test(s)}function Gg(s=or()){return/iemobile/i.test(s)}function Kg(s=or()){return/android/i.test(s)}function Qg(s=or()){return/blackberry/i.test(s)}function Yg(s=or()){return/webos/i.test(s)}function Sd(s=or()){return/iphone|ipad|ipod/i.test(s)||/macintosh/i.test(s)&&/mobile/i.test(s)}function Z1(s=or()){var e;return Sd(s)&&!!(!((e=window.navigator)===null||e===void 0)&&e.standalone)}function ek(){return fb()&&document.documentMode===10}function Xg(s=or()){return Sd(s)||Kg(s)||Yg(s)||Qg(s)||/windows phone/i.test(s)||Gg(s)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Jg(s,e=[]){let r;switch(s){case"Browser":r=Lh(or());break;case"Worker":r=`${Lh(or())}-${s}`;break;default:r=s}const a=e.length?e.join(","):"FirebaseCore-web";return`${r}/JsCore/${ja}/${a}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tk{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,r){const a=i=>new Promise((o,c)=>{try{const d=e(i);o(d)}catch(d){c(d)}});a.onAbort=r,this.queue.push(a);const n=this.queue.length-1;return()=>{this.queue[n]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const r=[];try{for(const a of this.queue)await a(e),a.onAbort&&r.push(a.onAbort)}catch(a){r.reverse();for(const n of r)try{n()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:a==null?void 0:a.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function rk(s,e={}){return dn(s,"GET","/v2/passwordPolicy",Ed(s,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sk=6;class ak{constructor(e){var r,a,n,i;const o=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(r=o.minPasswordLength)!==null&&r!==void 0?r:sk,o.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=o.maxPasswordLength),o.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=o.containsLowercaseCharacter),o.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=o.containsUppercaseCharacter),o.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=o.containsNumericCharacter),o.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=o.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(n=(a=e.allowedNonAlphanumericCharacters)===null||a===void 0?void 0:a.join(""))!==null&&n!==void 0?n:"",this.forceUpgradeOnSignin=(i=e.forceUpgradeOnSignin)!==null&&i!==void 0?i:!1,this.schemaVersion=e.schemaVersion}validatePassword(e){var r,a,n,i,o,c;const d={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,d),this.validatePasswordCharacterOptions(e,d),d.isValid&&(d.isValid=(r=d.meetsMinPasswordLength)!==null&&r!==void 0?r:!0),d.isValid&&(d.isValid=(a=d.meetsMaxPasswordLength)!==null&&a!==void 0?a:!0),d.isValid&&(d.isValid=(n=d.containsLowercaseLetter)!==null&&n!==void 0?n:!0),d.isValid&&(d.isValid=(i=d.containsUppercaseLetter)!==null&&i!==void 0?i:!0),d.isValid&&(d.isValid=(o=d.containsNumericCharacter)!==null&&o!==void 0?o:!0),d.isValid&&(d.isValid=(c=d.containsNonAlphanumericCharacter)!==null&&c!==void 0?c:!0),d}validatePasswordLengthOptions(e,r){const a=this.customStrengthOptions.minPasswordLength,n=this.customStrengthOptions.maxPasswordLength;a&&(r.meetsMinPasswordLength=e.length>=a),n&&(r.meetsMaxPasswordLength=e.length<=n)}validatePasswordCharacterOptions(e,r){this.updatePasswordCharacterOptionsStatuses(r,!1,!1,!1,!1);let a;for(let n=0;n<e.length;n++)a=e.charAt(n),this.updatePasswordCharacterOptionsStatuses(r,a>="a"&&a<="z",a>="A"&&a<="Z",a>="0"&&a<="9",this.allowedNonAlphanumericCharacters.includes(a))}updatePasswordCharacterOptionsStatuses(e,r,a,n,i){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=r)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=a)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=n)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nk{constructor(e,r,a,n){this.app=e,this.heartbeatServiceProvider=r,this.appCheckServiceProvider=a,this.config=n,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Fh(this),this.idTokenSubscription=new Fh(this),this.beforeStateQueue=new tk(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=Mg,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=n.sdkClientVersion}_initializeWithPersistence(e,r){return r&&(this._popupRedirectResolver=ps(r)),this._initializationPromise=this.queue(async()=>{var a,n;if(!this._deleted&&(this.persistenceManager=await Fa.create(this,e),!this._deleted)){if(!((a=this._popupRedirectResolver)===null||a===void 0)&&a._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(r),this.lastNotifiedUid=((n=this.currentUser)===null||n===void 0?void 0:n.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const r=await Ug(this,{idToken:e}),a=await gs._fromGetAccountInfoResponse(this,r,e);await this.directlySetCurrentUser(a)}catch(r){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",r),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var r;if(Vs(this.app)){const o=this.app.settings.authIdToken;return o?new Promise(c=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(o).then(c,c))}):this.directlySetCurrentUser(null)}const a=await this.assertedPersistence.getCurrentUser();let n=a,i=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const o=(r=this.redirectUser)===null||r===void 0?void 0:r._redirectEventId,c=n==null?void 0:n._redirectEventId,d=await this.tryRedirectSignIn(e);(!o||o===c)&&(d!=null&&d.user)&&(n=d.user,i=!0)}if(!n)return this.directlySetCurrentUser(null);if(!n._redirectEventId){if(i)try{await this.beforeStateQueue.runMiddleware(n)}catch(o){n=a,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(o))}return n?this.reloadAndSetCurrentUserOrClear(n):this.directlySetCurrentUser(null)}return Oe(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===n._redirectEventId?this.directlySetCurrentUser(n):this.reloadAndSetCurrentUserOrClear(n)}async tryRedirectSignIn(e){let r=null;try{r=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return r}async reloadAndSetCurrentUserOrClear(e){try{await fo(e)}catch(r){if((r==null?void 0:r.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=F1()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(Vs(this.app))return Promise.reject(ha(this));const r=e?St(e):null;return r&&Oe(r.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(r&&r._clone(this))}async _updateCurrentUser(e,r=!1){if(!this._deleted)return e&&Oe(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),r||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return Vs(this.app)?Promise.reject(ha(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return Vs(this.app)?Promise.reject(ha(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(ps(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const r=this._getPasswordPolicyInternal();return r.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):r.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await rk(this),r=new ak(e);this.tenantId===null?this._projectPasswordPolicy=r:this._tenantPasswordPolicies[this.tenantId]=r}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new ri("auth","Firebase",e())}onAuthStateChanged(e,r,a){return this.registerStateListener(this.authStateSubscription,e,r,a)}beforeAuthStateChanged(e,r){return this.beforeStateQueue.pushCallback(e,r)}onIdTokenChanged(e,r,a){return this.registerStateListener(this.idTokenSubscription,e,r,a)}authStateReady(){return new Promise((e,r)=>{if(this.currentUser)e();else{const a=this.onAuthStateChanged(()=>{a(),e()},r)}})}async revokeAccessToken(e){if(this.currentUser){const r=await this.currentUser.getIdToken(),a={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:r};this.tenantId!=null&&(a.tenantId=this.tenantId),await J1(this,a)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)===null||e===void 0?void 0:e.toJSON()}}async _setRedirectUser(e,r){const a=await this.getOrInitRedirectPersistenceManager(r);return e===null?a.removeCurrentUser():a.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const r=e&&ps(e)||this._popupRedirectResolver;Oe(r,this,"argument-error"),this.redirectPersistenceManager=await Fa.create(this,[ps(r._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var r,a;return this._isInitialized&&await this.queue(async()=>{}),((r=this._currentUser)===null||r===void 0?void 0:r._redirectEventId)===e?this._currentUser:((a=this.redirectUser)===null||a===void 0?void 0:a._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,r;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const a=(r=(e=this.currentUser)===null||e===void 0?void 0:e.uid)!==null&&r!==void 0?r:null;this.lastNotifiedUid!==a&&(this.lastNotifiedUid=a,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,r,a,n){if(this._deleted)return()=>{};const i=typeof r=="function"?r:r.next.bind(r);let o=!1;const c=this._isInitialized?Promise.resolve():this._initializationPromise;if(Oe(c,this,"internal-error"),c.then(()=>{o||i(this.currentUser)}),typeof r=="function"){const d=e.addObserver(r,a,n);return()=>{o=!0,d()}}else{const d=e.addObserver(r);return()=>{o=!0,d()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return Oe(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=Jg(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const r={"X-Client-Version":this.clientVersion};this.app.options.appId&&(r["X-Firebase-gmpid"]=this.app.options.appId);const a=await((e=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getHeartbeatsHeader());a&&(r["X-Firebase-Client"]=a);const n=await this._getAppCheckToken();return n&&(r["X-Firebase-AppCheck"]=n),r}async _getAppCheckToken(){var e;const r=await((e=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getToken());return r!=null&&r.error&&O1(`Error while retrieving App Check token: ${r.error}`),r==null?void 0:r.token}}function Id(s){return St(s)}class Fh{constructor(e){this.auth=e,this.observer=null,this.addObserver=_b(r=>this.observer=r)}get next(){return Oe(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Ad={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function ik(s){Ad=s}function ok(s){return Ad.loadJS(s)}function lk(){return Ad.gapiScript}function ck(s){return`__${s}${Math.floor(Math.random()*1e6)}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function dk(s,e){const r=$o(s,"auth");if(r.isInitialized()){const n=r.getImmediate(),i=r.getOptions();if(so(i,e??{}))return n;js(n,"already-initialized")}return r.initialize({options:e})}function uk(s,e){const r=(e==null?void 0:e.persistence)||[],a=(Array.isArray(r)?r:[r]).map(ps);e!=null&&e.errorMap&&s._updateErrorMap(e.errorMap),s._initializeWithPersistence(a,e==null?void 0:e.popupRedirectResolver)}function hk(s,e,r){const a=Id(s);Oe(a._canInitEmulator,a,"emulator-config-failed"),Oe(/^https?:\/\//.test(e),a,"invalid-emulator-scheme");const n=!1,i=Zg(e),{host:o,port:c}=mk(e),d=c===null?"":`:${c}`;a.config.emulator={url:`${i}//${o}${d}/`},a.settings.appVerificationDisabledForTesting=!0,a.emulatorConfig=Object.freeze({host:o,port:c,protocol:i.replace(":",""),options:Object.freeze({disableWarnings:n})}),gk()}function Zg(s){const e=s.indexOf(":");return e<0?"":s.substr(0,e+1)}function mk(s){const e=Zg(s),r=/(\/\/)?([^?#/]+)/.exec(s.substr(e.length));if(!r)return{host:"",port:null};const a=r[2].split("@").pop()||"",n=/^(\[[^\]]+\])(:|$)/.exec(a);if(n){const i=n[1];return{host:i,port:Uh(a.substr(i.length+1))}}else{const[i,o]=a.split(":");return{host:i,port:Uh(o)}}}function Uh(s){if(!s)return null;const e=Number(s);return isNaN(e)?null:e}function gk(){function s(){const e=document.createElement("p"),r=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",r.position="fixed",r.width="100%",r.backgroundColor="#ffffff",r.border=".1em solid #000000",r.color="#b50000",r.bottom="0px",r.left="0px",r.margin="0px",r.zIndex="10000",r.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",s):s())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ep{constructor(e,r){this.providerId=e,this.signInMethod=r}toJSON(){return ms("not implemented")}_getIdTokenResponse(e){return ms("not implemented")}_linkToIdToken(e,r){return ms("not implemented")}_getReauthenticationResolver(e){return ms("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Ua(s,e){return z1(s,"POST","/v1/accounts:signInWithIdp",Ed(s,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pk="http://localhost";class va extends ep{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const r=new va(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(r.idToken=e.idToken),e.accessToken&&(r.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(r.nonce=e.nonce),e.pendingToken&&(r.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(r.accessToken=e.oauthToken,r.secret=e.oauthTokenSecret):js("argument-error"),r}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const r=typeof e=="string"?JSON.parse(e):e,{providerId:a,signInMethod:n}=r,i=jd(r,["providerId","signInMethod"]);if(!a||!n)return null;const o=new va(a,n);return o.idToken=i.idToken||void 0,o.accessToken=i.accessToken||void 0,o.secret=i.secret,o.nonce=i.nonce,o.pendingToken=i.pendingToken||null,o}_getIdTokenResponse(e){const r=this.buildRequest();return Ua(e,r)}_linkToIdToken(e,r){const a=this.buildRequest();return a.idToken=r,Ua(e,a)}_getReauthenticationResolver(e){const r=this.buildRequest();return r.autoCreate=!1,Ua(e,r)}buildRequest(){const e={requestUri:pk,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const r={};this.idToken&&(r.id_token=this.idToken),this.accessToken&&(r.access_token=this.accessToken),this.secret&&(r.oauth_token_secret=this.secret),r.providerId=this.providerId,this.nonce&&!this.pendingToken&&(r.nonce=this.nonce),e.postBody=si(r)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tp{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hi extends tp{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cs extends hi{constructor(){super("facebook.com")}static credential(e){return va._fromParams({providerId:Cs.PROVIDER_ID,signInMethod:Cs.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Cs.credentialFromTaggedObject(e)}static credentialFromError(e){return Cs.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Cs.credential(e.oauthAccessToken)}catch{return null}}}Cs.FACEBOOK_SIGN_IN_METHOD="facebook.com";Cs.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ds extends hi{constructor(){super("google.com"),this.addScope("profile")}static credential(e,r){return va._fromParams({providerId:Ds.PROVIDER_ID,signInMethod:Ds.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:r})}static credentialFromResult(e){return Ds.credentialFromTaggedObject(e)}static credentialFromError(e){return Ds.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:r,oauthAccessToken:a}=e;if(!r&&!a)return null;try{return Ds.credential(r,a)}catch{return null}}}Ds.GOOGLE_SIGN_IN_METHOD="google.com";Ds.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $s extends hi{constructor(){super("github.com")}static credential(e){return va._fromParams({providerId:$s.PROVIDER_ID,signInMethod:$s.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return $s.credentialFromTaggedObject(e)}static credentialFromError(e){return $s.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return $s.credential(e.oauthAccessToken)}catch{return null}}}$s.GITHUB_SIGN_IN_METHOD="github.com";$s.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rs extends hi{constructor(){super("twitter.com")}static credential(e,r){return va._fromParams({providerId:Rs.PROVIDER_ID,signInMethod:Rs.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:r})}static credentialFromResult(e){return Rs.credentialFromTaggedObject(e)}static credentialFromError(e){return Rs.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:r,oauthTokenSecret:a}=e;if(!r||!a)return null;try{return Rs.credential(r,a)}catch{return null}}}Rs.TWITTER_SIGN_IN_METHOD="twitter.com";Rs.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Za{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,r,a,n=!1){const i=await gs._fromIdTokenResponse(e,a,n),o=Bh(a);return new Za({user:i,providerId:o,_tokenResponse:a,operationType:r})}static async _forOperation(e,r,a){await e._updateTokensIfNecessary(a,!0);const n=Bh(a);return new Za({user:e,providerId:n,_tokenResponse:a,operationType:r})}}function Bh(s){return s.providerId?s.providerId:"phoneNumber"in s?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bo extends as{constructor(e,r,a,n){var i;super(r.code,r.message),this.operationType=a,this.user=n,Object.setPrototypeOf(this,bo.prototype),this.customData={appName:e.name,tenantId:(i=e.tenantId)!==null&&i!==void 0?i:void 0,_serverResponse:r.customData._serverResponse,operationType:a}}static _fromErrorAndOperation(e,r,a,n){return new bo(e,r,a,n)}}function rp(s,e,r,a){return(e==="reauthenticate"?r._getReauthenticationResolver(s):r._getIdTokenResponse(s)).catch(i=>{throw i.code==="auth/multi-factor-auth-required"?bo._fromErrorAndOperation(s,i,e,a):i})}async function xk(s,e,r=!1){const a=await Xn(s,e._linkToIdToken(s.auth,await s.getIdToken()),r);return Za._forOperation(s,"link",a)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function fk(s,e,r=!1){const{auth:a}=s;if(Vs(a.app))return Promise.reject(ha(a));const n="reauthenticate";try{const i=await Xn(s,rp(a,n,e,s),r);Oe(i.idToken,a,"internal-error");const o=Td(i.idToken);Oe(o,a,"internal-error");const{sub:c}=o;return Oe(s.uid===c,a,"user-mismatch"),Za._forOperation(s,n,i)}catch(i){throw(i==null?void 0:i.code)==="auth/user-not-found"&&js(a,"user-mismatch"),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function bk(s,e,r=!1){if(Vs(s.app))return Promise.reject(ha(s));const a="signIn",n=await rp(s,a,e),i=await Za._fromIdTokenResponse(s,a,n);return r||await s._updateCurrentUser(i.user),i}function yk(s,e,r,a){return St(s).onIdTokenChanged(e,r,a)}function vk(s,e,r){return St(s).beforeAuthStateChanged(e,r)}const yo="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sp{constructor(e,r){this.storageRetriever=e,this.type=r}_isAvailable(){try{return this.storage?(this.storage.setItem(yo,"1"),this.storage.removeItem(yo),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,r){return this.storage.setItem(e,JSON.stringify(r)),Promise.resolve()}_get(e){const r=this.storage.getItem(e);return Promise.resolve(r?JSON.parse(r):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wk=1e3,kk=10;class ap extends sp{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,r)=>this.onStorageEvent(e,r),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=Xg(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const r of Object.keys(this.listeners)){const a=this.storage.getItem(r),n=this.localCache[r];a!==n&&e(r,n,a)}}onStorageEvent(e,r=!1){if(!e.key){this.forAllChangedKeys((o,c,d)=>{this.notifyListeners(o,d)});return}const a=e.key;r?this.detachListener():this.stopPolling();const n=()=>{const o=this.storage.getItem(a);!r&&this.localCache[a]===o||this.notifyListeners(a,o)},i=this.storage.getItem(a);ek()&&i!==e.newValue&&e.newValue!==e.oldValue?setTimeout(n,kk):n()}notifyListeners(e,r){this.localCache[e]=r;const a=this.listeners[e];if(a)for(const n of Array.from(a))n(r&&JSON.parse(r))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,r,a)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:r,newValue:a}),!0)})},wk)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,r){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(r)}_removeListener(e,r){this.listeners[e]&&(this.listeners[e].delete(r),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,r){await super._set(e,r),this.localCache[e]=JSON.stringify(r)}async _get(e){const r=await super._get(e);return this.localCache[e]=JSON.stringify(r),r}async _remove(e){await super._remove(e),delete this.localCache[e]}}ap.type="LOCAL";const jk=ap;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class np extends sp{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,r){}_removeListener(e,r){}}np.type="SESSION";const ip=np;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Nk(s){return Promise.all(s.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(r){return{fulfilled:!1,reason:r}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xo{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const r=this.receivers.find(n=>n.isListeningto(e));if(r)return r;const a=new Xo(e);return this.receivers.push(a),a}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const r=e,{eventId:a,eventType:n,data:i}=r.data,o=this.handlersMap[n];if(!(o!=null&&o.size))return;r.ports[0].postMessage({status:"ack",eventId:a,eventType:n});const c=Array.from(o).map(async u=>u(r.origin,i)),d=await Nk(c);r.ports[0].postMessage({status:"done",eventId:a,eventType:n,response:d})}_subscribe(e,r){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(r)}_unsubscribe(e,r){this.handlersMap[e]&&r&&this.handlersMap[e].delete(r),(!r||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}Xo.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Cd(s="",e=10){let r="";for(let a=0;a<e;a++)r+=Math.floor(Math.random()*10);return s+r}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _k{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,r,a=50){const n=typeof MessageChannel<"u"?new MessageChannel:null;if(!n)throw new Error("connection_unavailable");let i,o;return new Promise((c,d)=>{const u=Cd("",20);n.port1.start();const m=setTimeout(()=>{d(new Error("unsupported_event"))},a);o={messageChannel:n,onMessage(f){const x=f;if(x.data.eventId===u)switch(x.data.status){case"ack":clearTimeout(m),i=setTimeout(()=>{d(new Error("timeout"))},3e3);break;case"done":clearTimeout(i),c(x.data.response);break;default:clearTimeout(m),clearTimeout(i),d(new Error("invalid_response"));break}}},this.handlers.add(o),n.port1.addEventListener("message",o.onMessage),this.target.postMessage({eventType:e,eventId:u,data:r},[n.port2])}).finally(()=>{o&&this.removeMessageHandler(o)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Jr(){return window}function Ek(s){Jr().location.href=s}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function op(){return typeof Jr().WorkerGlobalScope<"u"&&typeof Jr().importScripts=="function"}async function Tk(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function Sk(){var s;return((s=navigator==null?void 0:navigator.serviceWorker)===null||s===void 0?void 0:s.controller)||null}function Ik(){return op()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lp="firebaseLocalStorageDb",Ak=1,vo="firebaseLocalStorage",cp="fbase_key";class mi{constructor(e){this.request=e}toPromise(){return new Promise((e,r)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{r(this.request.error)})})}}function Jo(s,e){return s.transaction([vo],e?"readwrite":"readonly").objectStore(vo)}function Ck(){const s=indexedDB.deleteDatabase(lp);return new mi(s).toPromise()}function wc(){const s=indexedDB.open(lp,Ak);return new Promise((e,r)=>{s.addEventListener("error",()=>{r(s.error)}),s.addEventListener("upgradeneeded",()=>{const a=s.result;try{a.createObjectStore(vo,{keyPath:cp})}catch(n){r(n)}}),s.addEventListener("success",async()=>{const a=s.result;a.objectStoreNames.contains(vo)?e(a):(a.close(),await Ck(),e(await wc()))})})}async function zh(s,e,r){const a=Jo(s,!0).put({[cp]:e,value:r});return new mi(a).toPromise()}async function Dk(s,e){const r=Jo(s,!1).get(e),a=await new mi(r).toPromise();return a===void 0?null:a.value}function qh(s,e){const r=Jo(s,!0).delete(e);return new mi(r).toPromise()}const $k=800,Rk=3;class dp{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await wc(),this.db)}async _withRetries(e){let r=0;for(;;)try{const a=await this._openDb();return await e(a)}catch(a){if(r++>Rk)throw a;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return op()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=Xo._getInstance(Ik()),this.receiver._subscribe("keyChanged",async(e,r)=>({keyProcessed:(await this._poll()).includes(r.key)})),this.receiver._subscribe("ping",async(e,r)=>["keyChanged"])}async initializeSender(){var e,r;if(this.activeServiceWorker=await Tk(),!this.activeServiceWorker)return;this.sender=new _k(this.activeServiceWorker);const a=await this.sender._send("ping",{},800);a&&!((e=a[0])===null||e===void 0)&&e.fulfilled&&!((r=a[0])===null||r===void 0)&&r.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||Sk()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await wc();return await zh(e,yo,"1"),await qh(e,yo),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,r){return this._withPendingWrite(async()=>(await this._withRetries(a=>zh(a,e,r)),this.localCache[e]=r,this.notifyServiceWorker(e)))}async _get(e){const r=await this._withRetries(a=>Dk(a,e));return this.localCache[e]=r,r}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(r=>qh(r,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(n=>{const i=Jo(n,!1).getAll();return new mi(i).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const r=[],a=new Set;if(e.length!==0)for(const{fbase_key:n,value:i}of e)a.add(n),JSON.stringify(this.localCache[n])!==JSON.stringify(i)&&(this.notifyListeners(n,i),r.push(n));for(const n of Object.keys(this.localCache))this.localCache[n]&&!a.has(n)&&(this.notifyListeners(n,null),r.push(n));return r}notifyListeners(e,r){this.localCache[e]=r;const a=this.listeners[e];if(a)for(const n of Array.from(a))n(r)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),$k)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,r){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(r)}_removeListener(e,r){this.listeners[e]&&(this.listeners[e].delete(r),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}dp.type="LOCAL";const Pk=dp;new ui(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Mk(s,e){return e?ps(e):(Oe(s._popupRedirectResolver,s,"argument-error"),s._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dd extends ep{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return Ua(e,this._buildIdpRequest())}_linkToIdToken(e,r){return Ua(e,this._buildIdpRequest(r))}_getReauthenticationResolver(e){return Ua(e,this._buildIdpRequest())}_buildIdpRequest(e){const r={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(r.idToken=e),r}}function Ok(s){return bk(s.auth,new Dd(s),s.bypassAuthState)}function Vk(s){const{auth:e,user:r}=s;return Oe(r,e,"internal-error"),fk(r,new Dd(s),s.bypassAuthState)}async function Lk(s){const{auth:e,user:r}=s;return Oe(r,e,"internal-error"),xk(r,new Dd(s),s.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class up{constructor(e,r,a,n,i=!1){this.auth=e,this.resolver=a,this.user=n,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(r)?r:[r]}execute(){return new Promise(async(e,r)=>{this.pendingPromise={resolve:e,reject:r};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(a){this.reject(a)}})}async onAuthEvent(e){const{urlResponse:r,sessionId:a,postBody:n,tenantId:i,error:o,type:c}=e;if(o){this.reject(o);return}const d={auth:this.auth,requestUri:r,sessionId:a,tenantId:i||void 0,postBody:n||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(c)(d))}catch(u){this.reject(u)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return Ok;case"linkViaPopup":case"linkViaRedirect":return Lk;case"reauthViaPopup":case"reauthViaRedirect":return Vk;default:js(this.auth,"internal-error")}}resolve(e){Ns(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){Ns(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Fk=new ui(2e3,1e4);class Pa extends up{constructor(e,r,a,n,i){super(e,r,n,i),this.provider=a,this.authWindow=null,this.pollId=null,Pa.currentPopupAction&&Pa.currentPopupAction.cancel(),Pa.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return Oe(e,this.auth,"internal-error"),e}async onExecution(){Ns(this.filter.length===1,"Popup operations only handle one event");const e=Cd();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(r=>{this.reject(r)}),this.resolver._isIframeWebStorageSupported(this.auth,r=>{r||this.reject(Xr(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)===null||e===void 0?void 0:e.associatedEvent)||null}cancel(){this.reject(Xr(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Pa.currentPopupAction=null}pollUserCancellation(){const e=()=>{var r,a;if(!((a=(r=this.authWindow)===null||r===void 0?void 0:r.window)===null||a===void 0)&&a.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(Xr(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,Fk.get())};e()}}Pa.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Uk="pendingRedirect",qi=new Map;class Bk extends up{constructor(e,r,a=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],r,void 0,a),this.eventId=null}async execute(){let e=qi.get(this.auth._key());if(!e){try{const a=await zk(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(a)}catch(r){e=()=>Promise.reject(r)}qi.set(this.auth._key(),e)}return this.bypassAuthState||qi.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const r=await this.auth._redirectUserForId(e.eventId);if(r)return this.user=r,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function zk(s,e){const r=Hk(e),a=Wk(s);if(!await a._isAvailable())return!1;const n=await a._get(r)==="true";return await a._remove(r),n}function qk(s,e){qi.set(s._key(),e)}function Wk(s){return ps(s._redirectPersistence)}function Hk(s){return zi(Uk,s.config.apiKey,s.name)}async function Gk(s,e,r=!1){if(Vs(s.app))return Promise.reject(ha(s));const a=Id(s),n=Mk(a,e),o=await new Bk(a,n,r).execute();return o&&!r&&(delete o.user._redirectEventId,await a._persistUserIfCurrent(o.user),await a._setRedirectUser(null,e)),o}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Kk=10*60*1e3;class Qk{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let r=!1;return this.consumers.forEach(a=>{this.isEventForConsumer(e,a)&&(r=!0,this.sendToConsumer(e,a),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!Yk(e)||(this.hasHandledPotentialRedirect=!0,r||(this.queuedRedirectEvent=e,r=!0)),r}sendToConsumer(e,r){var a;if(e.error&&!hp(e)){const n=((a=e.error.code)===null||a===void 0?void 0:a.split("auth/")[1])||"internal-error";r.onError(Xr(this.auth,n))}else r.onAuthEvent(e)}isEventForConsumer(e,r){const a=r.eventId===null||!!e.eventId&&e.eventId===r.eventId;return r.filter.includes(e.type)&&a}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=Kk&&this.cachedEventUids.clear(),this.cachedEventUids.has(Wh(e))}saveEventToCache(e){this.cachedEventUids.add(Wh(e)),this.lastProcessedEventTime=Date.now()}}function Wh(s){return[s.type,s.eventId,s.sessionId,s.tenantId].filter(e=>e).join("-")}function hp({type:s,error:e}){return s==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function Yk(s){switch(s.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return hp(s);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Xk(s,e={}){return dn(s,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Jk=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,Zk=/^https?/;async function ej(s){if(s.config.emulator)return;const{authorizedDomains:e}=await Xk(s);for(const r of e)try{if(tj(r))return}catch{}js(s,"unauthorized-domain")}function tj(s){const e=yc(),{protocol:r,hostname:a}=new URL(e);if(s.startsWith("chrome-extension://")){const o=new URL(s);return o.hostname===""&&a===""?r==="chrome-extension:"&&s.replace("chrome-extension://","")===e.replace("chrome-extension://",""):r==="chrome-extension:"&&o.hostname===a}if(!Zk.test(r))return!1;if(Jk.test(s))return a===s;const n=s.replace(/\./g,"\\.");return new RegExp("^(.+\\."+n+"|"+n+")$","i").test(a)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rj=new ui(3e4,6e4);function Hh(){const s=Jr().___jsl;if(s!=null&&s.H){for(const e of Object.keys(s.H))if(s.H[e].r=s.H[e].r||[],s.H[e].L=s.H[e].L||[],s.H[e].r=[...s.H[e].L],s.CP)for(let r=0;r<s.CP.length;r++)s.CP[r]=null}}function sj(s){return new Promise((e,r)=>{var a,n,i;function o(){Hh(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{Hh(),r(Xr(s,"network-request-failed"))},timeout:rj.get()})}if(!((n=(a=Jr().gapi)===null||a===void 0?void 0:a.iframes)===null||n===void 0)&&n.Iframe)e(gapi.iframes.getContext());else if(!((i=Jr().gapi)===null||i===void 0)&&i.load)o();else{const c=ck("iframefcb");return Jr()[c]=()=>{gapi.load?o():r(Xr(s,"network-request-failed"))},ok(`${lk()}?onload=${c}`).catch(d=>r(d))}}).catch(e=>{throw Wi=null,e})}let Wi=null;function aj(s){return Wi=Wi||sj(s),Wi}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nj=new ui(5e3,15e3),ij="__/auth/iframe",oj="emulator/auth/iframe",lj={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},cj=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function dj(s){const e=s.config;Oe(e.authDomain,s,"auth-domain-config-required");const r=e.emulator?_d(e,oj):`https://${s.config.authDomain}/${ij}`,a={apiKey:e.apiKey,appName:s.name,v:ja},n=cj.get(s.config.apiHost);n&&(a.eid=n);const i=s._getFrameworks();return i.length&&(a.fw=i.join(",")),`${r}?${si(a).slice(1)}`}async function uj(s){const e=await aj(s),r=Jr().gapi;return Oe(r,s,"internal-error"),e.open({where:document.body,url:dj(s),messageHandlersFilter:r.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:lj,dontclear:!0},a=>new Promise(async(n,i)=>{await a.restyle({setHideOnLeave:!1});const o=Xr(s,"network-request-failed"),c=Jr().setTimeout(()=>{i(o)},nj.get());function d(){Jr().clearTimeout(c),n(a)}a.ping(d).then(d,()=>{i(o)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hj={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},mj=500,gj=600,pj="_blank",xj="http://localhost";class Gh{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function fj(s,e,r,a=mj,n=gj){const i=Math.max((window.screen.availHeight-n)/2,0).toString(),o=Math.max((window.screen.availWidth-a)/2,0).toString();let c="";const d=Object.assign(Object.assign({},hj),{width:a.toString(),height:n.toString(),top:i,left:o}),u=or().toLowerCase();r&&(c=Hg(u)?pj:r),qg(u)&&(e=e||xj,d.scrollbars="yes");const m=Object.entries(d).reduce((x,[v,T])=>`${x}${v}=${T},`,"");if(Z1(u)&&c!=="_self")return bj(e||"",c),new Gh(null);const f=window.open(e||"",c,m);Oe(f,s,"popup-blocked");try{f.focus()}catch{}return new Gh(f)}function bj(s,e){const r=document.createElement("a");r.href=s,r.target=e;const a=document.createEvent("MouseEvent");a.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),r.dispatchEvent(a)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yj="__/auth/handler",vj="emulator/auth/handler",wj=encodeURIComponent("fac");async function Kh(s,e,r,a,n,i){Oe(s.config.authDomain,s,"auth-domain-config-required"),Oe(s.config.apiKey,s,"invalid-api-key");const o={apiKey:s.config.apiKey,appName:s.name,authType:r,redirectUrl:a,v:ja,eventId:n};if(e instanceof tp){e.setDefaultLanguage(s.languageCode),o.providerId=e.providerId||"",Nb(e.getCustomParameters())||(o.customParameters=JSON.stringify(e.getCustomParameters()));for(const[m,f]of Object.entries({}))o[m]=f}if(e instanceof hi){const m=e.getScopes().filter(f=>f!=="");m.length>0&&(o.scopes=m.join(","))}s.tenantId&&(o.tid=s.tenantId);const c=o;for(const m of Object.keys(c))c[m]===void 0&&delete c[m];const d=await s._getAppCheckToken(),u=d?`#${wj}=${encodeURIComponent(d)}`:"";return`${kj(s)}?${si(c).slice(1)}${u}`}function kj({config:s}){return s.emulator?_d(s,vj):`https://${s.authDomain}/${yj}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Rl="webStorageSupport";class jj{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=ip,this._completeRedirectFn=Gk,this._overrideRedirectResult=qk}async _openPopup(e,r,a,n){var i;Ns((i=this.eventManagers[e._key()])===null||i===void 0?void 0:i.manager,"_initialize() not called before _openPopup()");const o=await Kh(e,r,a,yc(),n);return fj(e,o,Cd())}async _openRedirect(e,r,a,n){await this._originValidation(e);const i=await Kh(e,r,a,yc(),n);return Ek(i),new Promise(()=>{})}_initialize(e){const r=e._key();if(this.eventManagers[r]){const{manager:n,promise:i}=this.eventManagers[r];return n?Promise.resolve(n):(Ns(i,"If manager is not set, promise should be"),i)}const a=this.initAndGetManager(e);return this.eventManagers[r]={promise:a},a.catch(()=>{delete this.eventManagers[r]}),a}async initAndGetManager(e){const r=await uj(e),a=new Qk(e);return r.register("authEvent",n=>(Oe(n==null?void 0:n.authEvent,e,"invalid-auth-event"),{status:a.onEvent(n.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:a},this.iframes[e._key()]=r,a}_isIframeWebStorageSupported(e,r){this.iframes[e._key()].send(Rl,{type:Rl},n=>{var i;const o=(i=n==null?void 0:n[0])===null||i===void 0?void 0:i[Rl];o!==void 0&&r(!!o),js(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const r=e._key();return this.originValidationPromises[r]||(this.originValidationPromises[r]=ej(e)),this.originValidationPromises[r]}get _shouldInitProactively(){return Xg()||Wg()||Sd()}}const Nj=jj;var Qh="@firebase/auth",Yh="1.7.9";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _j{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)===null||e===void 0?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const r=this.auth.onIdTokenChanged(a=>{e((a==null?void 0:a.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,r),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const r=this.internalListeners.get(e);r&&(this.internalListeners.delete(e),r(),this.updateProactiveRefresh())}assertAuthConfigured(){Oe(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ej(s){switch(s){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function Tj(s){pa(new Gs("auth",(e,{options:r})=>{const a=e.getProvider("app").getImmediate(),n=e.getProvider("heartbeat"),i=e.getProvider("app-check-internal"),{apiKey:o,authDomain:c}=a.options;Oe(o&&!o.includes(":"),"invalid-api-key",{appName:a.name});const d={apiKey:o,authDomain:c,clientPlatform:s,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:Jg(s)},u=new nk(a,n,i,d);return uk(u,r),u},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,r,a)=>{e.getProvider("auth-internal").initialize()})),pa(new Gs("auth-internal",e=>{const r=Id(e.getProvider("auth").getImmediate());return(a=>new _j(a))(r)},"PRIVATE").setInstantiationMode("EXPLICIT")),Kr(Qh,Yh,Ej(s)),Kr(Qh,Yh,"esm2017")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Sj=5*60,Ij=cm("authIdTokenMaxAge")||Sj;let Xh=null;const Aj=s=>async e=>{const r=e&&await e.getIdTokenResult(),a=r&&(new Date().getTime()-Date.parse(r.issuedAtTime))/1e3;if(a&&a>Ij)return;const n=r==null?void 0:r.token;Xh!==n&&(Xh=n,await fetch(s,{method:n?"POST":"DELETE",headers:n?{Authorization:`Bearer ${n}`}:{}}))};function Cj(s=Oc()){const e=$o(s,"auth");if(e.isInitialized())return e.getImmediate();const r=dk(s,{popupRedirectResolver:Nj,persistence:[Pk,jk,ip]}),a=cm("authTokenSyncURL");if(a&&typeof isSecureContext=="boolean"&&isSecureContext){const i=new URL(a,location.origin);if(location.origin===i.origin){const o=Aj(i.toString());vk(r,o,()=>o(r.currentUser)),yk(r,c=>o(c))}}const n=im("auth");return n&&hk(r,`http://${n}`),r}function Dj(){var s,e;return(e=(s=document.getElementsByTagName("head"))===null||s===void 0?void 0:s[0])!==null&&e!==void 0?e:document}ik({loadJS(s){return new Promise((e,r)=>{const a=document.createElement("script");a.setAttribute("src",s),a.onload=e,a.onerror=n=>{const i=Xr("internal-error");i.customData=n,r(i)},a.type="text/javascript",a.charset="UTF-8",Dj().appendChild(a)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});Tj("Browser");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mp="firebasestorage.googleapis.com",gp="storageBucket",$j=2*60*1e3,Rj=10*60*1e3;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jt extends as{constructor(e,r,a=0){super(Pl(e),`Firebase Storage: ${r} (${Pl(e)})`),this.status_=a,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,jt.prototype)}get status(){return this.status_}set status(e){this.status_=e}_codeEquals(e){return Pl(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message=`${this._baseMessage}
${this.customData.serverResponse}`:this.message=this._baseMessage}}var kt;(function(s){s.UNKNOWN="unknown",s.OBJECT_NOT_FOUND="object-not-found",s.BUCKET_NOT_FOUND="bucket-not-found",s.PROJECT_NOT_FOUND="project-not-found",s.QUOTA_EXCEEDED="quota-exceeded",s.UNAUTHENTICATED="unauthenticated",s.UNAUTHORIZED="unauthorized",s.UNAUTHORIZED_APP="unauthorized-app",s.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",s.INVALID_CHECKSUM="invalid-checksum",s.CANCELED="canceled",s.INVALID_EVENT_NAME="invalid-event-name",s.INVALID_URL="invalid-url",s.INVALID_DEFAULT_BUCKET="invalid-default-bucket",s.NO_DEFAULT_BUCKET="no-default-bucket",s.CANNOT_SLICE_BLOB="cannot-slice-blob",s.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",s.NO_DOWNLOAD_URL="no-download-url",s.INVALID_ARGUMENT="invalid-argument",s.INVALID_ARGUMENT_COUNT="invalid-argument-count",s.APP_DELETED="app-deleted",s.INVALID_ROOT_OPERATION="invalid-root-operation",s.INVALID_FORMAT="invalid-format",s.INTERNAL_ERROR="internal-error",s.UNSUPPORTED_ENVIRONMENT="unsupported-environment"})(kt||(kt={}));function Pl(s){return"storage/"+s}function $d(){const s="An unknown error occurred, please check the error payload for server response.";return new jt(kt.UNKNOWN,s)}function Pj(s){return new jt(kt.OBJECT_NOT_FOUND,"Object '"+s+"' does not exist.")}function Mj(s){return new jt(kt.QUOTA_EXCEEDED,"Quota for bucket '"+s+"' exceeded, please view quota on https://firebase.google.com/pricing/.")}function Oj(){const s="User is not authenticated, please authenticate using Firebase Authentication and try again.";return new jt(kt.UNAUTHENTICATED,s)}function Vj(){return new jt(kt.UNAUTHORIZED_APP,"This app does not have permission to access Firebase Storage on this project.")}function Lj(s){return new jt(kt.UNAUTHORIZED,"User does not have permission to access '"+s+"'.")}function Fj(){return new jt(kt.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function Uj(){return new jt(kt.CANCELED,"User canceled the upload/download.")}function Bj(s){return new jt(kt.INVALID_URL,"Invalid URL '"+s+"'.")}function zj(s){return new jt(kt.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+s+"'.")}function qj(){return new jt(kt.NO_DEFAULT_BUCKET,"No default bucket found. Did you set the '"+gp+"' property when initializing the app?")}function Wj(){return new jt(kt.CANNOT_SLICE_BLOB,"Cannot slice blob for upload. Please retry the upload.")}function Hj(){return new jt(kt.NO_DOWNLOAD_URL,"The given file does not have any download URLs.")}function Gj(s){return new jt(kt.UNSUPPORTED_ENVIRONMENT,`${s} is missing. Make sure to install the required polyfills. See https://firebase.google.com/docs/web/environments-js-sdk#polyfills for more information.`)}function kc(s){return new jt(kt.INVALID_ARGUMENT,s)}function pp(){return new jt(kt.APP_DELETED,"The Firebase app was deleted.")}function Kj(s){return new jt(kt.INVALID_ROOT_OPERATION,"The operation '"+s+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}function Ln(s,e){return new jt(kt.INVALID_FORMAT,"String does not match format '"+s+"': "+e)}function jn(s){throw new jt(kt.INTERNAL_ERROR,"Internal error: "+s)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _r{constructor(e,r){this.bucket=e,this.path_=r}get path(){return this.path_}get isRoot(){return this.path.length===0}fullServerUrl(){const e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(e,r){let a;try{a=_r.makeFromUrl(e,r)}catch{return new _r(e,"")}if(a.path==="")return a;throw zj(e)}static makeFromUrl(e,r){let a=null;const n="([A-Za-z0-9.\\-_]+)";function i(M){M.path.charAt(M.path.length-1)==="/"&&(M.path_=M.path_.slice(0,-1))}const o="(/(.*))?$",c=new RegExp("^gs://"+n+o,"i"),d={bucket:1,path:3};function u(M){M.path_=decodeURIComponent(M.path)}const m="v[A-Za-z0-9_]+",f=r.replace(/[.]/g,"\\."),x="(/([^?#]*).*)?$",v=new RegExp(`^https?://${f}/${m}/b/${n}/o${x}`,"i"),T={bucket:1,path:3},I=r===mp?"(?:storage.googleapis.com|storage.cloud.google.com)":r,N="([^?#]*)",O=new RegExp(`^https?://${I}/${n}/${N}`,"i"),C=[{regex:c,indices:d,postModify:i},{regex:v,indices:T,postModify:u},{regex:O,indices:{bucket:1,path:2},postModify:u}];for(let M=0;M<C.length;M++){const V=C[M],U=V.regex.exec(e);if(U){const y=U[V.indices.bucket];let b=U[V.indices.path];b||(b=""),a=new _r(y,b),V.postModify(a);break}}if(a==null)throw Bj(e);return a}}class Qj{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(e=!1){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Yj(s,e,r){let a=1,n=null,i=null,o=!1,c=0;function d(){return c===2}let u=!1;function m(...N){u||(u=!0,e.apply(null,N))}function f(N){n=setTimeout(()=>{n=null,s(v,d())},N)}function x(){i&&clearTimeout(i)}function v(N,...O){if(u){x();return}if(N){x(),m.call(null,N,...O);return}if(d()||o){x(),m.call(null,N,...O);return}a<64&&(a*=2);let C;c===1?(c=2,C=0):C=(a+Math.random())*1e3,f(C)}let T=!1;function I(N){T||(T=!0,x(),!u&&(n!==null?(N||(c=2),clearTimeout(n),f(0)):N||(c=1)))}return f(0),i=setTimeout(()=>{o=!0,I(!0)},r),I}function Xj(s){s(!1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Jj(s){return s!==void 0}function Zj(s){return typeof s=="object"&&!Array.isArray(s)}function Rd(s){return typeof s=="string"||s instanceof String}function Jh(s){return Pd()&&s instanceof Blob}function Pd(){return typeof Blob<"u"}function Zh(s,e,r,a){if(a<e)throw kc(`Invalid value for '${s}'. Expected ${e} or greater.`);if(a>r)throw kc(`Invalid value for '${s}'. Expected ${r} or less.`)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Zo(s,e,r){let a=e;return r==null&&(a=`https://${e}`),`${r}://${a}/v0${s}`}function xp(s){const e=encodeURIComponent;let r="?";for(const a in s)if(s.hasOwnProperty(a)){const n=e(a)+"="+e(s[a]);r=r+n+"&"}return r=r.slice(0,-1),r}var ma;(function(s){s[s.NO_ERROR=0]="NO_ERROR",s[s.NETWORK_ERROR=1]="NETWORK_ERROR",s[s.ABORT=2]="ABORT"})(ma||(ma={}));/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function e2(s,e){const r=s>=500&&s<600,n=[408,429].indexOf(s)!==-1,i=e.indexOf(s)!==-1;return r||n||i}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class t2{constructor(e,r,a,n,i,o,c,d,u,m,f,x=!0){this.url_=e,this.method_=r,this.headers_=a,this.body_=n,this.successCodes_=i,this.additionalRetryCodes_=o,this.callback_=c,this.errorCallback_=d,this.timeout_=u,this.progressCallback_=m,this.connectionFactory_=f,this.retry=x,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((v,T)=>{this.resolve_=v,this.reject_=T,this.start_()})}start_(){const e=(a,n)=>{if(n){a(!1,new Ci(!1,null,!0));return}const i=this.connectionFactory_();this.pendingConnection_=i;const o=c=>{const d=c.loaded,u=c.lengthComputable?c.total:-1;this.progressCallback_!==null&&this.progressCallback_(d,u)};this.progressCallback_!==null&&i.addUploadProgressListener(o),i.send(this.url_,this.method_,this.body_,this.headers_).then(()=>{this.progressCallback_!==null&&i.removeUploadProgressListener(o),this.pendingConnection_=null;const c=i.getErrorCode()===ma.NO_ERROR,d=i.getStatus();if(!c||e2(d,this.additionalRetryCodes_)&&this.retry){const m=i.getErrorCode()===ma.ABORT;a(!1,new Ci(!1,null,m));return}const u=this.successCodes_.indexOf(d)!==-1;a(!0,new Ci(u,i))})},r=(a,n)=>{const i=this.resolve_,o=this.reject_,c=n.connection;if(n.wasSuccessCode)try{const d=this.callback_(c,c.getResponse());Jj(d)?i(d):i()}catch(d){o(d)}else if(c!==null){const d=$d();d.serverResponse=c.getErrorText(),this.errorCallback_?o(this.errorCallback_(c,d)):o(d)}else if(n.canceled){const d=this.appDelete_?pp():Uj();o(d)}else{const d=Fj();o(d)}};this.canceled_?r(!1,new Ci(!1,null,!0)):this.backoffId_=Yj(e,r,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,this.backoffId_!==null&&Xj(this.backoffId_),this.pendingConnection_!==null&&this.pendingConnection_.abort()}}class Ci{constructor(e,r,a){this.wasSuccessCode=e,this.connection=r,this.canceled=!!a}}function r2(s,e){e!==null&&e.length>0&&(s.Authorization="Firebase "+e)}function s2(s,e){s["X-Firebase-Storage-Version"]="webjs/"+(e??"AppManager")}function a2(s,e){e&&(s["X-Firebase-GMPID"]=e)}function n2(s,e){e!==null&&(s["X-Firebase-AppCheck"]=e)}function i2(s,e,r,a,n,i,o=!0){const c=xp(s.urlParams),d=s.url+c,u=Object.assign({},s.headers);return a2(u,e),r2(u,r),s2(u,i),n2(u,a),new t2(d,s.method,u,s.body,s.successCodes,s.additionalRetryCodes,s.handler,s.errorHandler,s.timeout,s.progressCallback,n,o)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function o2(){return typeof BlobBuilder<"u"?BlobBuilder:typeof WebKitBlobBuilder<"u"?WebKitBlobBuilder:void 0}function l2(...s){const e=o2();if(e!==void 0){const r=new e;for(let a=0;a<s.length;a++)r.append(s[a]);return r.getBlob()}else{if(Pd())return new Blob(s);throw new jt(kt.UNSUPPORTED_ENVIRONMENT,"This browser doesn't seem to support creating Blobs")}}function c2(s,e,r){return s.webkitSlice?s.webkitSlice(e,r):s.mozSlice?s.mozSlice(e,r):s.slice?s.slice(e,r):null}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function d2(s){if(typeof atob>"u")throw Gj("base-64");return atob(s)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Hr={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"};class Ml{constructor(e,r){this.data=e,this.contentType=r||null}}function u2(s,e){switch(s){case Hr.RAW:return new Ml(fp(e));case Hr.BASE64:case Hr.BASE64URL:return new Ml(bp(s,e));case Hr.DATA_URL:return new Ml(m2(e),g2(e))}throw $d()}function fp(s){const e=[];for(let r=0;r<s.length;r++){let a=s.charCodeAt(r);if(a<=127)e.push(a);else if(a<=2047)e.push(192|a>>6,128|a&63);else if((a&64512)===55296)if(!(r<s.length-1&&(s.charCodeAt(r+1)&64512)===56320))e.push(239,191,189);else{const i=a,o=s.charCodeAt(++r);a=65536|(i&1023)<<10|o&1023,e.push(240|a>>18,128|a>>12&63,128|a>>6&63,128|a&63)}else(a&64512)===56320?e.push(239,191,189):e.push(224|a>>12,128|a>>6&63,128|a&63)}return new Uint8Array(e)}function h2(s){let e;try{e=decodeURIComponent(s)}catch{throw Ln(Hr.DATA_URL,"Malformed data URL.")}return fp(e)}function bp(s,e){switch(s){case Hr.BASE64:{const n=e.indexOf("-")!==-1,i=e.indexOf("_")!==-1;if(n||i)throw Ln(s,"Invalid character '"+(n?"-":"_")+"' found: is it base64url encoded?");break}case Hr.BASE64URL:{const n=e.indexOf("+")!==-1,i=e.indexOf("/")!==-1;if(n||i)throw Ln(s,"Invalid character '"+(n?"+":"/")+"' found: is it base64 encoded?");e=e.replace(/-/g,"+").replace(/_/g,"/");break}}let r;try{r=d2(e)}catch(n){throw n.message.includes("polyfill")?n:Ln(s,"Invalid character found")}const a=new Uint8Array(r.length);for(let n=0;n<r.length;n++)a[n]=r.charCodeAt(n);return a}class yp{constructor(e){this.base64=!1,this.contentType=null;const r=e.match(/^data:([^,]+)?,/);if(r===null)throw Ln(Hr.DATA_URL,"Must be formatted 'data:[<mediatype>][;base64],<data>");const a=r[1]||null;a!=null&&(this.base64=p2(a,";base64"),this.contentType=this.base64?a.substring(0,a.length-7):a),this.rest=e.substring(e.indexOf(",")+1)}}function m2(s){const e=new yp(s);return e.base64?bp(Hr.BASE64,e.rest):h2(e.rest)}function g2(s){return new yp(s).contentType}function p2(s,e){return s.length>=e.length?s.substring(s.length-e.length)===e:!1}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ps{constructor(e,r){let a=0,n="";Jh(e)?(this.data_=e,a=e.size,n=e.type):e instanceof ArrayBuffer?(r?this.data_=new Uint8Array(e):(this.data_=new Uint8Array(e.byteLength),this.data_.set(new Uint8Array(e))),a=this.data_.length):e instanceof Uint8Array&&(r?this.data_=e:(this.data_=new Uint8Array(e.length),this.data_.set(e)),a=e.length),this.size_=a,this.type_=n}size(){return this.size_}type(){return this.type_}slice(e,r){if(Jh(this.data_)){const a=this.data_,n=c2(a,e,r);return n===null?null:new Ps(n)}else{const a=new Uint8Array(this.data_.buffer,e,r-e);return new Ps(a,!0)}}static getBlob(...e){if(Pd()){const r=e.map(a=>a instanceof Ps?a.data_:a);return new Ps(l2.apply(null,r))}else{const r=e.map(o=>Rd(o)?u2(Hr.RAW,o).data:o.data_);let a=0;r.forEach(o=>{a+=o.byteLength});const n=new Uint8Array(a);let i=0;return r.forEach(o=>{for(let c=0;c<o.length;c++)n[i++]=o[c]}),new Ps(n,!0)}}uploadData(){return this.data_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vp(s){let e;try{e=JSON.parse(s)}catch{return null}return Zj(e)?e:null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function x2(s){if(s.length===0)return null;const e=s.lastIndexOf("/");return e===-1?"":s.slice(0,e)}function f2(s,e){const r=e.split("/").filter(a=>a.length>0).join("/");return s.length===0?r:s+"/"+r}function wp(s){const e=s.lastIndexOf("/",s.length-2);return e===-1?s:s.slice(e+1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function b2(s,e){return e}class dr{constructor(e,r,a,n){this.server=e,this.local=r||e,this.writable=!!a,this.xform=n||b2}}let Di=null;function y2(s){return!Rd(s)||s.length<2?s:wp(s)}function kp(){if(Di)return Di;const s=[];s.push(new dr("bucket")),s.push(new dr("generation")),s.push(new dr("metageneration")),s.push(new dr("name","fullPath",!0));function e(i,o){return y2(o)}const r=new dr("name");r.xform=e,s.push(r);function a(i,o){return o!==void 0?Number(o):o}const n=new dr("size");return n.xform=a,s.push(n),s.push(new dr("timeCreated")),s.push(new dr("updated")),s.push(new dr("md5Hash",null,!0)),s.push(new dr("cacheControl",null,!0)),s.push(new dr("contentDisposition",null,!0)),s.push(new dr("contentEncoding",null,!0)),s.push(new dr("contentLanguage",null,!0)),s.push(new dr("contentType",null,!0)),s.push(new dr("metadata","customMetadata",!0)),Di=s,Di}function v2(s,e){function r(){const a=s.bucket,n=s.fullPath,i=new _r(a,n);return e._makeStorageReference(i)}Object.defineProperty(s,"ref",{get:r})}function w2(s,e,r){const a={};a.type="file";const n=r.length;for(let i=0;i<n;i++){const o=r[i];a[o.local]=o.xform(a,e[o.server])}return v2(a,s),a}function jp(s,e,r){const a=vp(e);return a===null?null:w2(s,a,r)}function k2(s,e,r,a){const n=vp(e);if(n===null||!Rd(n.downloadTokens))return null;const i=n.downloadTokens;if(i.length===0)return null;const o=encodeURIComponent;return i.split(",").map(u=>{const m=s.bucket,f=s.fullPath,x="/b/"+o(m)+"/o/"+o(f),v=Zo(x,r,a),T=xp({alt:"media",token:u});return v+T})[0]}function j2(s,e){const r={},a=e.length;for(let n=0;n<a;n++){const i=e[n];i.writable&&(r[i.server]=s[i.local])}return JSON.stringify(r)}class Md{constructor(e,r,a,n){this.url=e,this.method=r,this.handler=a,this.timeout=n,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Np(s){if(!s)throw $d()}function N2(s,e){function r(a,n){const i=jp(s,n,e);return Np(i!==null),i}return r}function _2(s,e){function r(a,n){const i=jp(s,n,e);return Np(i!==null),k2(i,n,s.host,s._protocol)}return r}function _p(s){function e(r,a){let n;return r.getStatus()===401?r.getErrorText().includes("Firebase App Check token is invalid")?n=Vj():n=Oj():r.getStatus()===402?n=Mj(s.bucket):r.getStatus()===403?n=Lj(s.path):n=a,n.status=r.getStatus(),n.serverResponse=a.serverResponse,n}return e}function Ep(s){const e=_p(s);function r(a,n){let i=e(a,n);return a.getStatus()===404&&(i=Pj(s.path)),i.serverResponse=n.serverResponse,i}return r}function E2(s,e,r){const a=e.fullServerUrl(),n=Zo(a,s.host,s._protocol),i="GET",o=s.maxOperationRetryTime,c=new Md(n,i,_2(s,r),o);return c.errorHandler=Ep(e),c}function T2(s,e){const r=e.fullServerUrl(),a=Zo(r,s.host,s._protocol),n="DELETE",i=s.maxOperationRetryTime;function o(d,u){}const c=new Md(a,n,o,i);return c.successCodes=[200,204],c.errorHandler=Ep(e),c}function S2(s,e){return s&&s.contentType||e&&e.type()||"application/octet-stream"}function I2(s,e,r){const a=Object.assign({},r);return a.fullPath=s.path,a.size=e.size(),a.contentType||(a.contentType=S2(null,e)),a}function A2(s,e,r,a,n){const i=e.bucketOnlyServerUrl(),o={"X-Goog-Upload-Protocol":"multipart"};function c(){let C="";for(let M=0;M<2;M++)C=C+Math.random().toString().slice(2);return C}const d=c();o["Content-Type"]="multipart/related; boundary="+d;const u=I2(e,a,n),m=j2(u,r),f="--"+d+`\r
Content-Type: application/json; charset=utf-8\r
\r
`+m+`\r
--`+d+`\r
Content-Type: `+u.contentType+`\r
\r
`,x=`\r
--`+d+"--",v=Ps.getBlob(f,a,x);if(v===null)throw Wj();const T={name:u.fullPath},I=Zo(i,s.host,s._protocol),N="POST",O=s.maxUploadRetryTime,D=new Md(I,N,N2(s,r),O);return D.urlParams=T,D.headers=o,D.body=v.uploadData(),D.errorHandler=_p(e),D}class C2{constructor(){this.sent_=!1,this.xhr_=new XMLHttpRequest,this.initXhr(),this.errorCode_=ma.NO_ERROR,this.sendPromise_=new Promise(e=>{this.xhr_.addEventListener("abort",()=>{this.errorCode_=ma.ABORT,e()}),this.xhr_.addEventListener("error",()=>{this.errorCode_=ma.NETWORK_ERROR,e()}),this.xhr_.addEventListener("load",()=>{e()})})}send(e,r,a,n){if(this.sent_)throw jn("cannot .send() more than once");if(this.sent_=!0,this.xhr_.open(r,e,!0),n!==void 0)for(const i in n)n.hasOwnProperty(i)&&this.xhr_.setRequestHeader(i,n[i].toString());return a!==void 0?this.xhr_.send(a):this.xhr_.send(),this.sendPromise_}getErrorCode(){if(!this.sent_)throw jn("cannot .getErrorCode() before sending");return this.errorCode_}getStatus(){if(!this.sent_)throw jn("cannot .getStatus() before sending");try{return this.xhr_.status}catch{return-1}}getResponse(){if(!this.sent_)throw jn("cannot .getResponse() before sending");return this.xhr_.response}getErrorText(){if(!this.sent_)throw jn("cannot .getErrorText() before sending");return this.xhr_.statusText}abort(){this.xhr_.abort()}getResponseHeader(e){return this.xhr_.getResponseHeader(e)}addUploadProgressListener(e){this.xhr_.upload!=null&&this.xhr_.upload.addEventListener("progress",e)}removeUploadProgressListener(e){this.xhr_.upload!=null&&this.xhr_.upload.removeEventListener("progress",e)}}class D2 extends C2{initXhr(){this.xhr_.responseType="text"}}function Od(){return new D2}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wa{constructor(e,r){this._service=e,r instanceof _r?this._location=r:this._location=_r.makeFromUrl(r,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,r){return new wa(e,r)}get root(){const e=new _r(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return wp(this._location.path)}get storage(){return this._service}get parent(){const e=x2(this._location.path);if(e===null)return null;const r=new _r(this._location.bucket,e);return new wa(this._service,r)}_throwIfRoot(e){if(this._location.path==="")throw Kj(e)}}function $2(s,e,r){s._throwIfRoot("uploadBytes");const a=A2(s.storage,s._location,kp(),new Ps(e,!0),r);return s.storage.makeRequestWithTokens(a,Od).then(n=>({metadata:n,ref:s}))}function R2(s){s._throwIfRoot("getDownloadURL");const e=E2(s.storage,s._location,kp());return s.storage.makeRequestWithTokens(e,Od).then(r=>{if(r===null)throw Hj();return r})}function P2(s){s._throwIfRoot("deleteObject");const e=T2(s.storage,s._location);return s.storage.makeRequestWithTokens(e,Od)}function M2(s,e){const r=f2(s._location.path,e),a=new _r(s._location.bucket,r);return new wa(s.storage,a)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function O2(s){return/^[A-Za-z]+:\/\//.test(s)}function V2(s,e){return new wa(s,e)}function Tp(s,e){if(s instanceof Vd){const r=s;if(r._bucket==null)throw qj();const a=new wa(r,r._bucket);return e!=null?Tp(a,e):a}else return e!==void 0?M2(s,e):s}function L2(s,e){if(e&&O2(e)){if(s instanceof Vd)return V2(s,e);throw kc("To use ref(service, url), the first argument must be a Storage instance.")}else return Tp(s,e)}function e0(s,e){const r=e==null?void 0:e[gp];return r==null?null:_r.makeFromBucketSpec(r,s)}function F2(s,e,r,a={}){s.host=`${e}:${r}`,s._protocol="http";const{mockUserToken:n}=a;n&&(s._overrideAuthToken=typeof n=="string"?n:dm(n,s.app.options.projectId))}class Vd{constructor(e,r,a,n,i){this.app=e,this._authProvider=r,this._appCheckProvider=a,this._url=n,this._firebaseVersion=i,this._bucket=null,this._host=mp,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=$j,this._maxUploadRetryTime=Rj,this._requests=new Set,n!=null?this._bucket=_r.makeFromBucketSpec(n,this._host):this._bucket=e0(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,this._url!=null?this._bucket=_r.makeFromBucketSpec(this._url,e):this._bucket=e0(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){Zh("time",0,Number.POSITIVE_INFINITY,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){Zh("time",0,Number.POSITIVE_INFINITY,e),this._maxOperationRetryTime=e}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const e=this._authProvider.getImmediate({optional:!0});if(e){const r=await e.getToken();if(r!==null)return r.accessToken}return null}async _getAppCheckToken(){const e=this._appCheckProvider.getImmediate({optional:!0});return e?(await e.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(e=>e.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new wa(this,e)}_makeRequest(e,r,a,n,i=!0){if(this._deleted)return new Qj(pp());{const o=i2(e,this._appId,a,n,r,this._firebaseVersion,i);return this._requests.add(o),o.getPromise().then(()=>this._requests.delete(o),()=>this._requests.delete(o)),o}}async makeRequestWithTokens(e,r){const[a,n]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,r,a,n).getPromise()}}const t0="@firebase/storage",r0="0.13.2";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Sp="storage";function U2(s,e,r){return s=St(s),$2(s,e,r)}function B2(s){return s=St(s),R2(s)}function z2(s){return s=St(s),P2(s)}function Ip(s,e){return s=St(s),L2(s,e)}function q2(s=Oc(),e){s=St(s);const a=$o(s,Sp).getImmediate({identifier:e}),n=om("storage");return n&&W2(a,...n),a}function W2(s,e,r,a={}){F2(s,e,r,a)}function H2(s,{instanceIdentifier:e}){const r=s.getProvider("app").getImmediate(),a=s.getProvider("auth-internal"),n=s.getProvider("app-check-internal");return new Vd(r,a,n,e,ja)}function G2(){pa(new Gs(Sp,H2,"PUBLIC").setMultipleInstances(!0)),Kr(t0,r0,""),Kr(t0,r0,"esm2017")}G2();const cs={apiKey:"your-api-key",authDomain:"your-auth-domain",projectId:"your-project-id",storageBucket:"your-storage-bucket",messagingSenderId:"your-messaging-sender-id",appId:"your-app-id"};console.log("Firebase config check:",{hasApiKey:!!cs.apiKey&&cs.apiKey!=="your-api-key",authDomain:cs.authDomain,projectId:cs.projectId,hasStorageBucket:!!cs.storageBucket&&cs.storageBucket!=="your-storage-bucket",hasAppId:!!cs.appId&&cs.appId!=="your-app-id"});console.log("Raw env values:",{VITE_FIREBASE_API_KEY:void 0,VITE_FIREBASE_AUTH_DOMAIN:void 0,VITE_FIREBASE_PROJECT_ID:void 0,VITE_FIREBASE_STORAGE_BUCKET:void 0});const Ld=mm(cs);Cj(Ld);const ke=y1(Ld),Ap=q2(Ld);console.log("Firestore db initialized:",!!ke);const jc={1:"Dex",2:"Enowk",3:"Xenia",4:"Olenka",5:"Sydney"},en=new Map,yr=s=>{var r,a;const e=en.get(s);return e!==void 0?e||jc[s]||((r=Ge.find(n=>n.id===s))==null?void 0:r.login)||s:jc[s]||((a=Ge.find(n=>n.id===s))==null?void 0:a.login)||s},fs=async s=>{var e;try{const r=await N_(s);if(r)return en.set(s,r),r;const a=jc[s]||((e=Ge.find(n=>n.id===s))==null?void 0:e.login)||s;return en.set(s,null),a}catch(r){return console.error("Error fetching user nickname:",r),yr(s)}},Nc=s=>{en.delete(s)},s0=()=>{en.clear()},a0=["fast","smart","bright","cool","wise","bold","calm","eager","easy","fair","glad","kind","lucky","nice","proud","silly","vivid","warm","young","happy","prime","neo","super","mega","ultra","hyper","max","top","pro","maxi"],Ol="!@#$%&*",K2=(s=10)=>{const e="ABCDEFGHIJKLMNOPQRSTUVWXYZ",r="abcdefghijklmnopqrstuvwxyz",a="0123456789",n=r+a+e+Ol;let i="";i+=r[Math.floor(Math.random()*r.length)],i+=a[Math.floor(Math.random()*a.length)],i+=e[Math.floor(Math.random()*e.length)],i+=Ol[Math.floor(Math.random()*Ol.length)];for(let o=i.length;o<s;o++)i+=n[Math.floor(Math.random()*n.length)];return i.split("").sort(()=>Math.random()-.5).join("")},Q2=(s,e=[])=>{const r=s.split(" ")[0].toLowerCase().replace(/[^a-zа-яё0-9]/gi,"").slice(0,8);if(!e.includes(r))return r;const a=Math.floor(Math.random()*90+10),n=`${r}${a}`;if(!e.includes(n))return n;const i=a0[Math.floor(Math.random()*a0.length)],o=`${i}${r}`;return e.includes(o)?`${i}${r}${a}`:o},n0=(s,e=[])=>{const r=e.map(i=>i.login),a=Q2(s,r),n=K2(12);return{login:a,password:n}},el=s=>{const[e,r]=k.useState(()=>yr(s));return k.useEffect(()=>{en.has(s)||fs(s).then(n=>r(n));const a=n=>{const i=n,{userId:o}=i.detail||{};(!o||o===s)&&r(yr(s))};return window.addEventListener("nicknameUpdated",a),()=>window.removeEventListener("nicknameUpdated",a)},[s]),e};function wo(s){"@babel/helpers - typeof";return wo=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},wo(s)}function ss(s){if(s===null||s===!0||s===!1)return NaN;var e=Number(s);return isNaN(e)?e:e<0?Math.ceil(e):Math.floor(e)}function vt(s,e){if(e.length<s)throw new TypeError(s+" argument"+(s>1?"s":"")+" required, but only "+e.length+" present")}function Vt(s){vt(1,arguments);var e=Object.prototype.toString.call(s);return s instanceof Date||wo(s)==="object"&&e==="[object Date]"?new Date(s.getTime()):typeof s=="number"||e==="[object Number]"?new Date(s):((typeof s=="string"||e==="[object String]")&&typeof console<"u"&&(console.warn("Starting with v2.0.0-beta.1 date-fns doesn't accept strings as date arguments. Please use `parseISO` to parse strings. See: https://github.com/date-fns/date-fns/blob/master/docs/upgradeGuide.md#string-arguments"),console.warn(new Error().stack)),new Date(NaN))}function Y2(s,e){vt(2,arguments);var r=Vt(s).getTime(),a=ss(e);return new Date(r+a)}var X2={};function un(){return X2}function ko(s,e){var r,a,n,i,o,c,d,u;vt(1,arguments);var m=un(),f=ss((r=(a=(n=(i=e==null?void 0:e.weekStartsOn)!==null&&i!==void 0?i:e==null||(o=e.locale)===null||o===void 0||(c=o.options)===null||c===void 0?void 0:c.weekStartsOn)!==null&&n!==void 0?n:m.weekStartsOn)!==null&&a!==void 0?a:(d=m.locale)===null||d===void 0||(u=d.options)===null||u===void 0?void 0:u.weekStartsOn)!==null&&r!==void 0?r:0);if(!(f>=0&&f<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");var x=Vt(s),v=x.getDay(),T=(v<f?7:0)+v-f;return x.setDate(x.getDate()-T),x.setHours(0,0,0,0),x}function J2(s){var e=new Date(Date.UTC(s.getFullYear(),s.getMonth(),s.getDate(),s.getHours(),s.getMinutes(),s.getSeconds(),s.getMilliseconds()));return e.setUTCFullYear(s.getFullYear()),s.getTime()-e.getTime()}function i0(s){vt(1,arguments);var e=Vt(s);return e.setHours(0,0,0,0),e}var Cp=6e4,Dp=36e5;function Z2(s,e){vt(2,arguments);var r=i0(s),a=i0(e);return r.getTime()===a.getTime()}function eN(s){return vt(1,arguments),s instanceof Date||wo(s)==="object"&&Object.prototype.toString.call(s)==="[object Date]"}function tN(s){if(vt(1,arguments),!eN(s)&&typeof s!="number")return!1;var e=Vt(s);return!isNaN(Number(e))}function rN(s,e){var r;vt(1,arguments);var a=s||{},n=Vt(a.start),i=Vt(a.end),o=i.getTime();if(!(n.getTime()<=o))throw new RangeError("Invalid interval");var c=[],d=n;d.setHours(0,0,0,0);var u=Number((r=void 0)!==null&&r!==void 0?r:1);if(u<1||isNaN(u))throw new RangeError("`options.step` must be a number greater than 1");for(;d.getTime()<=o;)c.push(Vt(d)),d.setDate(d.getDate()+u),d.setHours(0,0,0,0);return c}function sN(s,e){var r,a,n,i,o,c,d,u;vt(1,arguments);var m=un(),f=ss((r=(a=(n=(i=e==null?void 0:e.weekStartsOn)!==null&&i!==void 0?i:e==null||(o=e.locale)===null||o===void 0||(c=o.options)===null||c===void 0?void 0:c.weekStartsOn)!==null&&n!==void 0?n:m.weekStartsOn)!==null&&a!==void 0?a:(d=m.locale)===null||d===void 0||(u=d.options)===null||u===void 0?void 0:u.weekStartsOn)!==null&&r!==void 0?r:0);if(!(f>=0&&f<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");var x=Vt(s),v=x.getDay(),T=(v<f?-7:0)+6-(v-f);return x.setDate(x.getDate()+T),x.setHours(23,59,59,999),x}function aN(s,e){vt(2,arguments);var r=ss(e);return Y2(s,-r)}var nN=864e5;function iN(s){vt(1,arguments);var e=Vt(s),r=e.getTime();e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0);var a=e.getTime(),n=r-a;return Math.floor(n/nN)+1}function jo(s){vt(1,arguments);var e=1,r=Vt(s),a=r.getUTCDay(),n=(a<e?7:0)+a-e;return r.setUTCDate(r.getUTCDate()-n),r.setUTCHours(0,0,0,0),r}function $p(s){vt(1,arguments);var e=Vt(s),r=e.getUTCFullYear(),a=new Date(0);a.setUTCFullYear(r+1,0,4),a.setUTCHours(0,0,0,0);var n=jo(a),i=new Date(0);i.setUTCFullYear(r,0,4),i.setUTCHours(0,0,0,0);var o=jo(i);return e.getTime()>=n.getTime()?r+1:e.getTime()>=o.getTime()?r:r-1}function oN(s){vt(1,arguments);var e=$p(s),r=new Date(0);r.setUTCFullYear(e,0,4),r.setUTCHours(0,0,0,0);var a=jo(r);return a}var lN=6048e5;function cN(s){vt(1,arguments);var e=Vt(s),r=jo(e).getTime()-oN(e).getTime();return Math.round(r/lN)+1}function tn(s,e){var r,a,n,i,o,c,d,u;vt(1,arguments);var m=un(),f=ss((r=(a=(n=(i=e==null?void 0:e.weekStartsOn)!==null&&i!==void 0?i:e==null||(o=e.locale)===null||o===void 0||(c=o.options)===null||c===void 0?void 0:c.weekStartsOn)!==null&&n!==void 0?n:m.weekStartsOn)!==null&&a!==void 0?a:(d=m.locale)===null||d===void 0||(u=d.options)===null||u===void 0?void 0:u.weekStartsOn)!==null&&r!==void 0?r:0);if(!(f>=0&&f<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");var x=Vt(s),v=x.getUTCDay(),T=(v<f?7:0)+v-f;return x.setUTCDate(x.getUTCDate()-T),x.setUTCHours(0,0,0,0),x}function Rp(s,e){var r,a,n,i,o,c,d,u;vt(1,arguments);var m=Vt(s),f=m.getUTCFullYear(),x=un(),v=ss((r=(a=(n=(i=e==null?void 0:e.firstWeekContainsDate)!==null&&i!==void 0?i:e==null||(o=e.locale)===null||o===void 0||(c=o.options)===null||c===void 0?void 0:c.firstWeekContainsDate)!==null&&n!==void 0?n:x.firstWeekContainsDate)!==null&&a!==void 0?a:(d=x.locale)===null||d===void 0||(u=d.options)===null||u===void 0?void 0:u.firstWeekContainsDate)!==null&&r!==void 0?r:1);if(!(v>=1&&v<=7))throw new RangeError("firstWeekContainsDate must be between 1 and 7 inclusively");var T=new Date(0);T.setUTCFullYear(f+1,0,v),T.setUTCHours(0,0,0,0);var I=tn(T,e),N=new Date(0);N.setUTCFullYear(f,0,v),N.setUTCHours(0,0,0,0);var O=tn(N,e);return m.getTime()>=I.getTime()?f+1:m.getTime()>=O.getTime()?f:f-1}function dN(s,e){var r,a,n,i,o,c,d,u;vt(1,arguments);var m=un(),f=ss((r=(a=(n=(i=e==null?void 0:e.firstWeekContainsDate)!==null&&i!==void 0?i:e==null||(o=e.locale)===null||o===void 0||(c=o.options)===null||c===void 0?void 0:c.firstWeekContainsDate)!==null&&n!==void 0?n:m.firstWeekContainsDate)!==null&&a!==void 0?a:(d=m.locale)===null||d===void 0||(u=d.options)===null||u===void 0?void 0:u.firstWeekContainsDate)!==null&&r!==void 0?r:1),x=Rp(s,e),v=new Date(0);v.setUTCFullYear(x,0,f),v.setUTCHours(0,0,0,0);var T=tn(v,e);return T}var uN=6048e5;function hN(s,e){vt(1,arguments);var r=Vt(s),a=tn(r,e).getTime()-dN(r,e).getTime();return Math.round(a/uN)+1}function st(s,e){for(var r=s<0?"-":"",a=Math.abs(s).toString();a.length<e;)a="0"+a;return r+a}var As={y:function(e,r){var a=e.getUTCFullYear(),n=a>0?a:1-a;return st(r==="yy"?n%100:n,r.length)},M:function(e,r){var a=e.getUTCMonth();return r==="M"?String(a+1):st(a+1,2)},d:function(e,r){return st(e.getUTCDate(),r.length)},a:function(e,r){var a=e.getUTCHours()/12>=1?"pm":"am";switch(r){case"a":case"aa":return a.toUpperCase();case"aaa":return a;case"aaaaa":return a[0];case"aaaa":default:return a==="am"?"a.m.":"p.m."}},h:function(e,r){return st(e.getUTCHours()%12||12,r.length)},H:function(e,r){return st(e.getUTCHours(),r.length)},m:function(e,r){return st(e.getUTCMinutes(),r.length)},s:function(e,r){return st(e.getUTCSeconds(),r.length)},S:function(e,r){var a=r.length,n=e.getUTCMilliseconds(),i=Math.floor(n*Math.pow(10,a-3));return st(i,r.length)}},Ia={midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},mN={G:function(e,r,a){var n=e.getUTCFullYear()>0?1:0;switch(r){case"G":case"GG":case"GGG":return a.era(n,{width:"abbreviated"});case"GGGGG":return a.era(n,{width:"narrow"});case"GGGG":default:return a.era(n,{width:"wide"})}},y:function(e,r,a){if(r==="yo"){var n=e.getUTCFullYear(),i=n>0?n:1-n;return a.ordinalNumber(i,{unit:"year"})}return As.y(e,r)},Y:function(e,r,a,n){var i=Rp(e,n),o=i>0?i:1-i;if(r==="YY"){var c=o%100;return st(c,2)}return r==="Yo"?a.ordinalNumber(o,{unit:"year"}):st(o,r.length)},R:function(e,r){var a=$p(e);return st(a,r.length)},u:function(e,r){var a=e.getUTCFullYear();return st(a,r.length)},Q:function(e,r,a){var n=Math.ceil((e.getUTCMonth()+1)/3);switch(r){case"Q":return String(n);case"QQ":return st(n,2);case"Qo":return a.ordinalNumber(n,{unit:"quarter"});case"QQQ":return a.quarter(n,{width:"abbreviated",context:"formatting"});case"QQQQQ":return a.quarter(n,{width:"narrow",context:"formatting"});case"QQQQ":default:return a.quarter(n,{width:"wide",context:"formatting"})}},q:function(e,r,a){var n=Math.ceil((e.getUTCMonth()+1)/3);switch(r){case"q":return String(n);case"qq":return st(n,2);case"qo":return a.ordinalNumber(n,{unit:"quarter"});case"qqq":return a.quarter(n,{width:"abbreviated",context:"standalone"});case"qqqqq":return a.quarter(n,{width:"narrow",context:"standalone"});case"qqqq":default:return a.quarter(n,{width:"wide",context:"standalone"})}},M:function(e,r,a){var n=e.getUTCMonth();switch(r){case"M":case"MM":return As.M(e,r);case"Mo":return a.ordinalNumber(n+1,{unit:"month"});case"MMM":return a.month(n,{width:"abbreviated",context:"formatting"});case"MMMMM":return a.month(n,{width:"narrow",context:"formatting"});case"MMMM":default:return a.month(n,{width:"wide",context:"formatting"})}},L:function(e,r,a){var n=e.getUTCMonth();switch(r){case"L":return String(n+1);case"LL":return st(n+1,2);case"Lo":return a.ordinalNumber(n+1,{unit:"month"});case"LLL":return a.month(n,{width:"abbreviated",context:"standalone"});case"LLLLL":return a.month(n,{width:"narrow",context:"standalone"});case"LLLL":default:return a.month(n,{width:"wide",context:"standalone"})}},w:function(e,r,a,n){var i=hN(e,n);return r==="wo"?a.ordinalNumber(i,{unit:"week"}):st(i,r.length)},I:function(e,r,a){var n=cN(e);return r==="Io"?a.ordinalNumber(n,{unit:"week"}):st(n,r.length)},d:function(e,r,a){return r==="do"?a.ordinalNumber(e.getUTCDate(),{unit:"date"}):As.d(e,r)},D:function(e,r,a){var n=iN(e);return r==="Do"?a.ordinalNumber(n,{unit:"dayOfYear"}):st(n,r.length)},E:function(e,r,a){var n=e.getUTCDay();switch(r){case"E":case"EE":case"EEE":return a.day(n,{width:"abbreviated",context:"formatting"});case"EEEEE":return a.day(n,{width:"narrow",context:"formatting"});case"EEEEEE":return a.day(n,{width:"short",context:"formatting"});case"EEEE":default:return a.day(n,{width:"wide",context:"formatting"})}},e:function(e,r,a,n){var i=e.getUTCDay(),o=(i-n.weekStartsOn+8)%7||7;switch(r){case"e":return String(o);case"ee":return st(o,2);case"eo":return a.ordinalNumber(o,{unit:"day"});case"eee":return a.day(i,{width:"abbreviated",context:"formatting"});case"eeeee":return a.day(i,{width:"narrow",context:"formatting"});case"eeeeee":return a.day(i,{width:"short",context:"formatting"});case"eeee":default:return a.day(i,{width:"wide",context:"formatting"})}},c:function(e,r,a,n){var i=e.getUTCDay(),o=(i-n.weekStartsOn+8)%7||7;switch(r){case"c":return String(o);case"cc":return st(o,r.length);case"co":return a.ordinalNumber(o,{unit:"day"});case"ccc":return a.day(i,{width:"abbreviated",context:"standalone"});case"ccccc":return a.day(i,{width:"narrow",context:"standalone"});case"cccccc":return a.day(i,{width:"short",context:"standalone"});case"cccc":default:return a.day(i,{width:"wide",context:"standalone"})}},i:function(e,r,a){var n=e.getUTCDay(),i=n===0?7:n;switch(r){case"i":return String(i);case"ii":return st(i,r.length);case"io":return a.ordinalNumber(i,{unit:"day"});case"iii":return a.day(n,{width:"abbreviated",context:"formatting"});case"iiiii":return a.day(n,{width:"narrow",context:"formatting"});case"iiiiii":return a.day(n,{width:"short",context:"formatting"});case"iiii":default:return a.day(n,{width:"wide",context:"formatting"})}},a:function(e,r,a){var n=e.getUTCHours(),i=n/12>=1?"pm":"am";switch(r){case"a":case"aa":return a.dayPeriod(i,{width:"abbreviated",context:"formatting"});case"aaa":return a.dayPeriod(i,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return a.dayPeriod(i,{width:"narrow",context:"formatting"});case"aaaa":default:return a.dayPeriod(i,{width:"wide",context:"formatting"})}},b:function(e,r,a){var n=e.getUTCHours(),i;switch(n===12?i=Ia.noon:n===0?i=Ia.midnight:i=n/12>=1?"pm":"am",r){case"b":case"bb":return a.dayPeriod(i,{width:"abbreviated",context:"formatting"});case"bbb":return a.dayPeriod(i,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return a.dayPeriod(i,{width:"narrow",context:"formatting"});case"bbbb":default:return a.dayPeriod(i,{width:"wide",context:"formatting"})}},B:function(e,r,a){var n=e.getUTCHours(),i;switch(n>=17?i=Ia.evening:n>=12?i=Ia.afternoon:n>=4?i=Ia.morning:i=Ia.night,r){case"B":case"BB":case"BBB":return a.dayPeriod(i,{width:"abbreviated",context:"formatting"});case"BBBBB":return a.dayPeriod(i,{width:"narrow",context:"formatting"});case"BBBB":default:return a.dayPeriod(i,{width:"wide",context:"formatting"})}},h:function(e,r,a){if(r==="ho"){var n=e.getUTCHours()%12;return n===0&&(n=12),a.ordinalNumber(n,{unit:"hour"})}return As.h(e,r)},H:function(e,r,a){return r==="Ho"?a.ordinalNumber(e.getUTCHours(),{unit:"hour"}):As.H(e,r)},K:function(e,r,a){var n=e.getUTCHours()%12;return r==="Ko"?a.ordinalNumber(n,{unit:"hour"}):st(n,r.length)},k:function(e,r,a){var n=e.getUTCHours();return n===0&&(n=24),r==="ko"?a.ordinalNumber(n,{unit:"hour"}):st(n,r.length)},m:function(e,r,a){return r==="mo"?a.ordinalNumber(e.getUTCMinutes(),{unit:"minute"}):As.m(e,r)},s:function(e,r,a){return r==="so"?a.ordinalNumber(e.getUTCSeconds(),{unit:"second"}):As.s(e,r)},S:function(e,r){return As.S(e,r)},X:function(e,r,a,n){var i=n._originalDate||e,o=i.getTimezoneOffset();if(o===0)return"Z";switch(r){case"X":return l0(o);case"XXXX":case"XX":return ia(o);case"XXXXX":case"XXX":default:return ia(o,":")}},x:function(e,r,a,n){var i=n._originalDate||e,o=i.getTimezoneOffset();switch(r){case"x":return l0(o);case"xxxx":case"xx":return ia(o);case"xxxxx":case"xxx":default:return ia(o,":")}},O:function(e,r,a,n){var i=n._originalDate||e,o=i.getTimezoneOffset();switch(r){case"O":case"OO":case"OOO":return"GMT"+o0(o,":");case"OOOO":default:return"GMT"+ia(o,":")}},z:function(e,r,a,n){var i=n._originalDate||e,o=i.getTimezoneOffset();switch(r){case"z":case"zz":case"zzz":return"GMT"+o0(o,":");case"zzzz":default:return"GMT"+ia(o,":")}},t:function(e,r,a,n){var i=n._originalDate||e,o=Math.floor(i.getTime()/1e3);return st(o,r.length)},T:function(e,r,a,n){var i=n._originalDate||e,o=i.getTime();return st(o,r.length)}};function o0(s,e){var r=s>0?"-":"+",a=Math.abs(s),n=Math.floor(a/60),i=a%60;if(i===0)return r+String(n);var o=e;return r+String(n)+o+st(i,2)}function l0(s,e){if(s%60===0){var r=s>0?"-":"+";return r+st(Math.abs(s)/60,2)}return ia(s,e)}function ia(s,e){var r=e||"",a=s>0?"-":"+",n=Math.abs(s),i=st(Math.floor(n/60),2),o=st(n%60,2);return a+i+r+o}var c0=function(e,r){switch(e){case"P":return r.date({width:"short"});case"PP":return r.date({width:"medium"});case"PPP":return r.date({width:"long"});case"PPPP":default:return r.date({width:"full"})}},Pp=function(e,r){switch(e){case"p":return r.time({width:"short"});case"pp":return r.time({width:"medium"});case"ppp":return r.time({width:"long"});case"pppp":default:return r.time({width:"full"})}},gN=function(e,r){var a=e.match(/(P+)(p+)?/)||[],n=a[1],i=a[2];if(!i)return c0(e,r);var o;switch(n){case"P":o=r.dateTime({width:"short"});break;case"PP":o=r.dateTime({width:"medium"});break;case"PPP":o=r.dateTime({width:"long"});break;case"PPPP":default:o=r.dateTime({width:"full"});break}return o.replace("{{date}}",c0(n,r)).replace("{{time}}",Pp(i,r))},pN={p:Pp,P:gN},xN=["D","DD"],fN=["YY","YYYY"];function bN(s){return xN.indexOf(s)!==-1}function yN(s){return fN.indexOf(s)!==-1}function d0(s,e,r){if(s==="YYYY")throw new RangeError("Use `yyyy` instead of `YYYY` (in `".concat(e,"`) for formatting years to the input `").concat(r,"`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md"));if(s==="YY")throw new RangeError("Use `yy` instead of `YY` (in `".concat(e,"`) for formatting years to the input `").concat(r,"`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md"));if(s==="D")throw new RangeError("Use `d` instead of `D` (in `".concat(e,"`) for formatting days of the month to the input `").concat(r,"`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md"));if(s==="DD")throw new RangeError("Use `dd` instead of `DD` (in `".concat(e,"`) for formatting days of the month to the input `").concat(r,"`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md"))}var vN={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},wN=function(e,r,a){var n,i=vN[e];return typeof i=="string"?n=i:r===1?n=i.one:n=i.other.replace("{{count}}",r.toString()),a!=null&&a.addSuffix?a.comparison&&a.comparison>0?"in "+n:n+" ago":n};function Ba(s){return function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=e.width?String(e.width):s.defaultWidth,a=s.formats[r]||s.formats[s.defaultWidth];return a}}var kN={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},jN={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},NN={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},_N={date:Ba({formats:kN,defaultWidth:"full"}),time:Ba({formats:jN,defaultWidth:"full"}),dateTime:Ba({formats:NN,defaultWidth:"full"})},EN={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},TN=function(e,r,a,n){return EN[e]};function qr(s){return function(e,r){var a=r!=null&&r.context?String(r.context):"standalone",n;if(a==="formatting"&&s.formattingValues){var i=s.defaultFormattingWidth||s.defaultWidth,o=r!=null&&r.width?String(r.width):i;n=s.formattingValues[o]||s.formattingValues[i]}else{var c=s.defaultWidth,d=r!=null&&r.width?String(r.width):s.defaultWidth;n=s.values[d]||s.values[c]}var u=s.argumentCallback?s.argumentCallback(e):e;return n[u]}}var SN={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},IN={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},AN={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},CN={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},DN={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},$N={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},RN=function(e,r){var a=Number(e),n=a%100;if(n>20||n<10)switch(n%10){case 1:return a+"st";case 2:return a+"nd";case 3:return a+"rd"}return a+"th"},PN={ordinalNumber:RN,era:qr({values:SN,defaultWidth:"wide"}),quarter:qr({values:IN,defaultWidth:"wide",argumentCallback:function(e){return e-1}}),month:qr({values:AN,defaultWidth:"wide"}),day:qr({values:CN,defaultWidth:"wide"}),dayPeriod:qr({values:DN,defaultWidth:"wide",formattingValues:$N,defaultFormattingWidth:"wide"})};function Wr(s){return function(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},a=r.width,n=a&&s.matchPatterns[a]||s.matchPatterns[s.defaultMatchWidth],i=e.match(n);if(!i)return null;var o=i[0],c=a&&s.parsePatterns[a]||s.parsePatterns[s.defaultParseWidth],d=Array.isArray(c)?ON(c,function(f){return f.test(o)}):MN(c,function(f){return f.test(o)}),u;u=s.valueCallback?s.valueCallback(d):d,u=r.valueCallback?r.valueCallback(u):u;var m=e.slice(o.length);return{value:u,rest:m}}}function MN(s,e){for(var r in s)if(s.hasOwnProperty(r)&&e(s[r]))return r}function ON(s,e){for(var r=0;r<s.length;r++)if(e(s[r]))return r}function Mp(s){return function(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},a=e.match(s.matchPattern);if(!a)return null;var n=a[0],i=e.match(s.parsePattern);if(!i)return null;var o=s.valueCallback?s.valueCallback(i[0]):i[0];o=r.valueCallback?r.valueCallback(o):o;var c=e.slice(n.length);return{value:o,rest:c}}}var VN=/^(\d+)(th|st|nd|rd)?/i,LN=/\d+/i,FN={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},UN={any:[/^b/i,/^(a|c)/i]},BN={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},zN={any:[/1/i,/2/i,/3/i,/4/i]},qN={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},WN={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},HN={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},GN={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},KN={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},QN={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},YN={ordinalNumber:Mp({matchPattern:VN,parsePattern:LN,valueCallback:function(e){return parseInt(e,10)}}),era:Wr({matchPatterns:FN,defaultMatchWidth:"wide",parsePatterns:UN,defaultParseWidth:"any"}),quarter:Wr({matchPatterns:BN,defaultMatchWidth:"wide",parsePatterns:zN,defaultParseWidth:"any",valueCallback:function(e){return e+1}}),month:Wr({matchPatterns:qN,defaultMatchWidth:"wide",parsePatterns:WN,defaultParseWidth:"any"}),day:Wr({matchPatterns:HN,defaultMatchWidth:"wide",parsePatterns:GN,defaultParseWidth:"any"}),dayPeriod:Wr({matchPatterns:KN,defaultMatchWidth:"any",parsePatterns:QN,defaultParseWidth:"any"})},XN={code:"en-US",formatDistance:wN,formatLong:_N,formatRelative:TN,localize:PN,match:YN,options:{weekStartsOn:0,firstWeekContainsDate:1}},JN=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,ZN=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,e5=/^'([^]*?)'?$/,t5=/''/g,r5=/[a-zA-Z]/;function No(s,e,r){var a,n,i,o,c,d,u,m,f,x,v,T,I,N,O,D,C,M;vt(2,arguments);var V=String(e),U=un(),y=(a=(n=r==null?void 0:r.locale)!==null&&n!==void 0?n:U.locale)!==null&&a!==void 0?a:XN,b=ss((i=(o=(c=(d=r==null?void 0:r.firstWeekContainsDate)!==null&&d!==void 0?d:r==null||(u=r.locale)===null||u===void 0||(m=u.options)===null||m===void 0?void 0:m.firstWeekContainsDate)!==null&&c!==void 0?c:U.firstWeekContainsDate)!==null&&o!==void 0?o:(f=U.locale)===null||f===void 0||(x=f.options)===null||x===void 0?void 0:x.firstWeekContainsDate)!==null&&i!==void 0?i:1);if(!(b>=1&&b<=7))throw new RangeError("firstWeekContainsDate must be between 1 and 7 inclusively");var E=ss((v=(T=(I=(N=r==null?void 0:r.weekStartsOn)!==null&&N!==void 0?N:r==null||(O=r.locale)===null||O===void 0||(D=O.options)===null||D===void 0?void 0:D.weekStartsOn)!==null&&I!==void 0?I:U.weekStartsOn)!==null&&T!==void 0?T:(C=U.locale)===null||C===void 0||(M=C.options)===null||M===void 0?void 0:M.weekStartsOn)!==null&&v!==void 0?v:0);if(!(E>=0&&E<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");if(!y.localize)throw new RangeError("locale must contain localize property");if(!y.formatLong)throw new RangeError("locale must contain formatLong property");var j=Vt(s);if(!tN(j))throw new RangeError("Invalid time value");var A=J2(j),w=aN(j,A),g={firstWeekContainsDate:b,weekStartsOn:E,locale:y,_originalDate:j},$=V.match(ZN).map(function(L){var ee=L[0];if(ee==="p"||ee==="P"){var te=pN[ee];return te(L,y.formatLong)}return L}).join("").match(JN).map(function(L){if(L==="''")return"'";var ee=L[0];if(ee==="'")return s5(L);var te=mN[ee];if(te)return!(r!=null&&r.useAdditionalWeekYearTokens)&&yN(L)&&d0(L,e,String(s)),!(r!=null&&r.useAdditionalDayOfYearTokens)&&bN(L)&&d0(L,e,String(s)),te(w,L,y.localize,g);if(ee.match(r5))throw new RangeError("Format string contains an unescaped latin alphabet character `"+ee+"`");return L}).join("");return $}function s5(s){var e=s.match(e5);return e?e[1].replace(t5,"'"):s}function a5(s,e){vt(2,arguments);var r=Vt(s),a=Vt(e);return r.getTime()<a.getTime()}function kr(s,e){var r;vt(1,arguments);var a=ss((r=void 0)!==null&&r!==void 0?r:2);if(a!==2&&a!==1&&a!==0)throw new RangeError("additionalDigits must be 0, 1 or 2");if(!(typeof s=="string"||Object.prototype.toString.call(s)==="[object String]"))return new Date(NaN);var n=l5(s),i;if(n.date){var o=c5(n.date,a);i=d5(o.restDateString,o.year)}if(!i||isNaN(i.getTime()))return new Date(NaN);var c=i.getTime(),d=0,u;if(n.time&&(d=u5(n.time),isNaN(d)))return new Date(NaN);if(n.timezone){if(u=h5(n.timezone),isNaN(u))return new Date(NaN)}else{var m=new Date(c+d),f=new Date(0);return f.setFullYear(m.getUTCFullYear(),m.getUTCMonth(),m.getUTCDate()),f.setHours(m.getUTCHours(),m.getUTCMinutes(),m.getUTCSeconds(),m.getUTCMilliseconds()),f}return new Date(c+d+u)}var $i={dateTimeDelimiter:/[T ]/,timeZoneDelimiter:/[Z ]/i,timezone:/([Z+-].*)$/},n5=/^-?(?:(\d{3})|(\d{2})(?:-?(\d{2}))?|W(\d{2})(?:-?(\d{1}))?|)$/,i5=/^(\d{2}(?:[.,]\d*)?)(?::?(\d{2}(?:[.,]\d*)?))?(?::?(\d{2}(?:[.,]\d*)?))?$/,o5=/^([+-])(\d{2})(?::?(\d{2}))?$/;function l5(s){var e={},r=s.split($i.dateTimeDelimiter),a;if(r.length>2)return e;if(/:/.test(r[0])?a=r[0]:(e.date=r[0],a=r[1],$i.timeZoneDelimiter.test(e.date)&&(e.date=s.split($i.timeZoneDelimiter)[0],a=s.substr(e.date.length,s.length))),a){var n=$i.timezone.exec(a);n?(e.time=a.replace(n[1],""),e.timezone=n[1]):e.time=a}return e}function c5(s,e){var r=new RegExp("^(?:(\\d{4}|[+-]\\d{"+(4+e)+"})|(\\d{2}|[+-]\\d{"+(2+e)+"})$)"),a=s.match(r);if(!a)return{year:NaN,restDateString:""};var n=a[1]?parseInt(a[1]):null,i=a[2]?parseInt(a[2]):null;return{year:i===null?n:i*100,restDateString:s.slice((a[1]||a[2]).length)}}function d5(s,e){if(e===null)return new Date(NaN);var r=s.match(n5);if(!r)return new Date(NaN);var a=!!r[4],n=Nn(r[1]),i=Nn(r[2])-1,o=Nn(r[3]),c=Nn(r[4]),d=Nn(r[5])-1;if(a)return f5(e,c,d)?m5(e,c,d):new Date(NaN);var u=new Date(0);return!p5(e,i,o)||!x5(e,n)?new Date(NaN):(u.setUTCFullYear(e,i,Math.max(n,o)),u)}function Nn(s){return s?parseInt(s):1}function u5(s){var e=s.match(i5);if(!e)return NaN;var r=Vl(e[1]),a=Vl(e[2]),n=Vl(e[3]);return b5(r,a,n)?r*Dp+a*Cp+n*1e3:NaN}function Vl(s){return s&&parseFloat(s.replace(",","."))||0}function h5(s){if(s==="Z")return 0;var e=s.match(o5);if(!e)return 0;var r=e[1]==="+"?-1:1,a=parseInt(e[2]),n=e[3]&&parseInt(e[3])||0;return y5(a,n)?r*(a*Dp+n*Cp):NaN}function m5(s,e,r){var a=new Date(0);a.setUTCFullYear(s,0,4);var n=a.getUTCDay()||7,i=(e-1)*7+r+1-n;return a.setUTCDate(a.getUTCDate()+i),a}var g5=[31,null,31,30,31,30,31,31,30,31,30,31];function Op(s){return s%400===0||s%4===0&&s%100!==0}function p5(s,e,r){return e>=0&&e<=11&&r>=1&&r<=(g5[e]||(Op(s)?29:28))}function x5(s,e){return e>=1&&e<=(Op(s)?366:365)}function f5(s,e,r){return e>=1&&e<=53&&r>=0&&r<=6}function b5(s,e,r){return s===24?e===0&&r===0:r>=0&&r<60&&e>=0&&e<60&&s>=0&&s<25}function y5(s,e){return e>=0&&e<=59}function u0(s,e,r){vt(2,arguments);var a=tn(s,r),n=tn(e,r);return a.getTime()===n.getTime()}function _n(s,e){if(s.one!==void 0&&e===1)return s.one;var r=e%10,a=e%100;return r===1&&a!==11?s.singularNominative.replace("{{count}}",String(e)):r>=2&&r<=4&&(a<10||a>20)?s.singularGenitive.replace("{{count}}",String(e)):s.pluralGenitive.replace("{{count}}",String(e))}function ur(s){return function(e,r){return r!=null&&r.addSuffix?r.comparison&&r.comparison>0?s.future?_n(s.future,e):"через "+_n(s.regular,e):s.past?_n(s.past,e):_n(s.regular,e)+" назад":_n(s.regular,e)}}var v5={lessThanXSeconds:ur({regular:{one:"меньше секунды",singularNominative:"меньше {{count}} секунды",singularGenitive:"меньше {{count}} секунд",pluralGenitive:"меньше {{count}} секунд"},future:{one:"меньше, чем через секунду",singularNominative:"меньше, чем через {{count}} секунду",singularGenitive:"меньше, чем через {{count}} секунды",pluralGenitive:"меньше, чем через {{count}} секунд"}}),xSeconds:ur({regular:{singularNominative:"{{count}} секунда",singularGenitive:"{{count}} секунды",pluralGenitive:"{{count}} секунд"},past:{singularNominative:"{{count}} секунду назад",singularGenitive:"{{count}} секунды назад",pluralGenitive:"{{count}} секунд назад"},future:{singularNominative:"через {{count}} секунду",singularGenitive:"через {{count}} секунды",pluralGenitive:"через {{count}} секунд"}}),halfAMinute:function(e,r){return r!=null&&r.addSuffix?r.comparison&&r.comparison>0?"через полминуты":"полминуты назад":"полминуты"},lessThanXMinutes:ur({regular:{one:"меньше минуты",singularNominative:"меньше {{count}} минуты",singularGenitive:"меньше {{count}} минут",pluralGenitive:"меньше {{count}} минут"},future:{one:"меньше, чем через минуту",singularNominative:"меньше, чем через {{count}} минуту",singularGenitive:"меньше, чем через {{count}} минуты",pluralGenitive:"меньше, чем через {{count}} минут"}}),xMinutes:ur({regular:{singularNominative:"{{count}} минута",singularGenitive:"{{count}} минуты",pluralGenitive:"{{count}} минут"},past:{singularNominative:"{{count}} минуту назад",singularGenitive:"{{count}} минуты назад",pluralGenitive:"{{count}} минут назад"},future:{singularNominative:"через {{count}} минуту",singularGenitive:"через {{count}} минуты",pluralGenitive:"через {{count}} минут"}}),aboutXHours:ur({regular:{singularNominative:"около {{count}} часа",singularGenitive:"около {{count}} часов",pluralGenitive:"около {{count}} часов"},future:{singularNominative:"приблизительно через {{count}} час",singularGenitive:"приблизительно через {{count}} часа",pluralGenitive:"приблизительно через {{count}} часов"}}),xHours:ur({regular:{singularNominative:"{{count}} час",singularGenitive:"{{count}} часа",pluralGenitive:"{{count}} часов"}}),xDays:ur({regular:{singularNominative:"{{count}} день",singularGenitive:"{{count}} дня",pluralGenitive:"{{count}} дней"}}),aboutXWeeks:ur({regular:{singularNominative:"около {{count}} недели",singularGenitive:"около {{count}} недель",pluralGenitive:"около {{count}} недель"},future:{singularNominative:"приблизительно через {{count}} неделю",singularGenitive:"приблизительно через {{count}} недели",pluralGenitive:"приблизительно через {{count}} недель"}}),xWeeks:ur({regular:{singularNominative:"{{count}} неделя",singularGenitive:"{{count}} недели",pluralGenitive:"{{count}} недель"}}),aboutXMonths:ur({regular:{singularNominative:"около {{count}} месяца",singularGenitive:"около {{count}} месяцев",pluralGenitive:"около {{count}} месяцев"},future:{singularNominative:"приблизительно через {{count}} месяц",singularGenitive:"приблизительно через {{count}} месяца",pluralGenitive:"приблизительно через {{count}} месяцев"}}),xMonths:ur({regular:{singularNominative:"{{count}} месяц",singularGenitive:"{{count}} месяца",pluralGenitive:"{{count}} месяцев"}}),aboutXYears:ur({regular:{singularNominative:"около {{count}} года",singularGenitive:"около {{count}} лет",pluralGenitive:"около {{count}} лет"},future:{singularNominative:"приблизительно через {{count}} год",singularGenitive:"приблизительно через {{count}} года",pluralGenitive:"приблизительно через {{count}} лет"}}),xYears:ur({regular:{singularNominative:"{{count}} год",singularGenitive:"{{count}} года",pluralGenitive:"{{count}} лет"}}),overXYears:ur({regular:{singularNominative:"больше {{count}} года",singularGenitive:"больше {{count}} лет",pluralGenitive:"больше {{count}} лет"},future:{singularNominative:"больше, чем через {{count}} год",singularGenitive:"больше, чем через {{count}} года",pluralGenitive:"больше, чем через {{count}} лет"}}),almostXYears:ur({regular:{singularNominative:"почти {{count}} год",singularGenitive:"почти {{count}} года",pluralGenitive:"почти {{count}} лет"},future:{singularNominative:"почти через {{count}} год",singularGenitive:"почти через {{count}} года",pluralGenitive:"почти через {{count}} лет"}})},w5=function(e,r,a){return v5[e](r,a)},k5={full:"EEEE, d MMMM y 'г.'",long:"d MMMM y 'г.'",medium:"d MMM y 'г.'",short:"dd.MM.y"},j5={full:"H:mm:ss zzzz",long:"H:mm:ss z",medium:"H:mm:ss",short:"H:mm"},N5={any:"{{date}}, {{time}}"},_5={date:Ba({formats:k5,defaultWidth:"full"}),time:Ba({formats:j5,defaultWidth:"full"}),dateTime:Ba({formats:N5,defaultWidth:"any"})},Fd=["воскресенье","понедельник","вторник","среду","четверг","пятницу","субботу"];function E5(s){var e=Fd[s];switch(s){case 0:return"'в прошлое "+e+" в' p";case 1:case 2:case 4:return"'в прошлый "+e+" в' p";case 3:case 5:case 6:return"'в прошлую "+e+" в' p"}}function h0(s){var e=Fd[s];return s===2?"'во "+e+" в' p":"'в "+e+" в' p"}function T5(s){var e=Fd[s];switch(s){case 0:return"'в следующее "+e+" в' p";case 1:case 2:case 4:return"'в следующий "+e+" в' p";case 3:case 5:case 6:return"'в следующую "+e+" в' p"}}var S5={lastWeek:function(e,r,a){var n=e.getUTCDay();return u0(e,r,a)?h0(n):E5(n)},yesterday:"'вчера в' p",today:"'сегодня в' p",tomorrow:"'завтра в' p",nextWeek:function(e,r,a){var n=e.getUTCDay();return u0(e,r,a)?h0(n):T5(n)},other:"P"},I5=function(e,r,a,n){var i=S5[e];return typeof i=="function"?i(r,a,n):i},A5={narrow:["до н.э.","н.э."],abbreviated:["до н. э.","н. э."],wide:["до нашей эры","нашей эры"]},C5={narrow:["1","2","3","4"],abbreviated:["1-й кв.","2-й кв.","3-й кв.","4-й кв."],wide:["1-й квартал","2-й квартал","3-й квартал","4-й квартал"]},D5={narrow:["Я","Ф","М","А","М","И","И","А","С","О","Н","Д"],abbreviated:["янв.","фев.","март","апр.","май","июнь","июль","авг.","сент.","окт.","нояб.","дек."],wide:["январь","февраль","март","апрель","май","июнь","июль","август","сентябрь","октябрь","ноябрь","декабрь"]},$5={narrow:["Я","Ф","М","А","М","И","И","А","С","О","Н","Д"],abbreviated:["янв.","фев.","мар.","апр.","мая","июн.","июл.","авг.","сент.","окт.","нояб.","дек."],wide:["января","февраля","марта","апреля","мая","июня","июля","августа","сентября","октября","ноября","декабря"]},R5={narrow:["В","П","В","С","Ч","П","С"],short:["вс","пн","вт","ср","чт","пт","сб"],abbreviated:["вск","пнд","втр","срд","чтв","птн","суб"],wide:["воскресенье","понедельник","вторник","среда","четверг","пятница","суббота"]},P5={narrow:{am:"ДП",pm:"ПП",midnight:"полн.",noon:"полд.",morning:"утро",afternoon:"день",evening:"веч.",night:"ночь"},abbreviated:{am:"ДП",pm:"ПП",midnight:"полн.",noon:"полд.",morning:"утро",afternoon:"день",evening:"веч.",night:"ночь"},wide:{am:"ДП",pm:"ПП",midnight:"полночь",noon:"полдень",morning:"утро",afternoon:"день",evening:"вечер",night:"ночь"}},M5={narrow:{am:"ДП",pm:"ПП",midnight:"полн.",noon:"полд.",morning:"утра",afternoon:"дня",evening:"веч.",night:"ночи"},abbreviated:{am:"ДП",pm:"ПП",midnight:"полн.",noon:"полд.",morning:"утра",afternoon:"дня",evening:"веч.",night:"ночи"},wide:{am:"ДП",pm:"ПП",midnight:"полночь",noon:"полдень",morning:"утра",afternoon:"дня",evening:"вечера",night:"ночи"}},O5=function(e,r){var a=Number(e),n=r==null?void 0:r.unit,i;return n==="date"?i="-е":n==="week"||n==="minute"||n==="second"?i="-я":i="-й",a+i},V5={ordinalNumber:O5,era:qr({values:A5,defaultWidth:"wide"}),quarter:qr({values:C5,defaultWidth:"wide",argumentCallback:function(e){return e-1}}),month:qr({values:D5,defaultWidth:"wide",formattingValues:$5,defaultFormattingWidth:"wide"}),day:qr({values:R5,defaultWidth:"wide"}),dayPeriod:qr({values:P5,defaultWidth:"any",formattingValues:M5,defaultFormattingWidth:"wide"})},L5=/^(\d+)(-?(е|я|й|ое|ье|ая|ья|ый|ой|ий|ый))?/i,F5=/\d+/i,U5={narrow:/^((до )?н\.?\s?э\.?)/i,abbreviated:/^((до )?н\.?\s?э\.?)/i,wide:/^(до нашей эры|нашей эры|наша эра)/i},B5={any:[/^д/i,/^н/i]},z5={narrow:/^[1234]/i,abbreviated:/^[1234](-?[ыои]?й?)? кв.?/i,wide:/^[1234](-?[ыои]?й?)? квартал/i},q5={any:[/1/i,/2/i,/3/i,/4/i]},W5={narrow:/^[яфмаисонд]/i,abbreviated:/^(янв|фев|март?|апр|ма[йя]|июн[ья]?|июл[ья]?|авг|сент?|окт|нояб?|дек)\.?/i,wide:/^(январ[ья]|феврал[ья]|марта?|апрел[ья]|ма[йя]|июн[ья]|июл[ья]|августа?|сентябр[ья]|октябр[ья]|октябр[ья]|ноябр[ья]|декабр[ья])/i},H5={narrow:[/^я/i,/^ф/i,/^м/i,/^а/i,/^м/i,/^и/i,/^и/i,/^а/i,/^с/i,/^о/i,/^н/i,/^я/i],any:[/^я/i,/^ф/i,/^мар/i,/^ап/i,/^ма[йя]/i,/^июн/i,/^июл/i,/^ав/i,/^с/i,/^о/i,/^н/i,/^д/i]},G5={narrow:/^[впсч]/i,short:/^(вс|во|пн|по|вт|ср|чт|че|пт|пя|сб|су)\.?/i,abbreviated:/^(вск|вос|пнд|пон|втр|вто|срд|сре|чтв|чет|птн|пят|суб).?/i,wide:/^(воскресень[ея]|понедельника?|вторника?|сред[аы]|четверга?|пятниц[аы]|суббот[аы])/i},K5={narrow:[/^в/i,/^п/i,/^в/i,/^с/i,/^ч/i,/^п/i,/^с/i],any:[/^в[ос]/i,/^п[он]/i,/^в/i,/^ср/i,/^ч/i,/^п[ят]/i,/^с[уб]/i]},Q5={narrow:/^([дп]п|полн\.?|полд\.?|утр[оа]|день|дня|веч\.?|ноч[ьи])/i,abbreviated:/^([дп]п|полн\.?|полд\.?|утр[оа]|день|дня|веч\.?|ноч[ьи])/i,wide:/^([дп]п|полночь|полдень|утр[оа]|день|дня|вечера?|ноч[ьи])/i},Y5={any:{am:/^дп/i,pm:/^пп/i,midnight:/^полн/i,noon:/^полд/i,morning:/^у/i,afternoon:/^д[ен]/i,evening:/^в/i,night:/^н/i}},X5={ordinalNumber:Mp({matchPattern:L5,parsePattern:F5,valueCallback:function(e){return parseInt(e,10)}}),era:Wr({matchPatterns:U5,defaultMatchWidth:"wide",parsePatterns:B5,defaultParseWidth:"any"}),quarter:Wr({matchPatterns:z5,defaultMatchWidth:"wide",parsePatterns:q5,defaultParseWidth:"any",valueCallback:function(e){return e+1}}),month:Wr({matchPatterns:W5,defaultMatchWidth:"wide",parsePatterns:H5,defaultParseWidth:"any"}),day:Wr({matchPatterns:G5,defaultMatchWidth:"wide",parsePatterns:K5,defaultParseWidth:"any"}),dayPeriod:Wr({matchPatterns:Q5,defaultMatchWidth:"wide",parsePatterns:Y5,defaultParseWidth:"any"})},J5={code:"ru",formatDistance:w5,formatLong:_5,formatRelative:I5,localize:V5,match:X5,options:{weekStartsOn:1,firstWeekContainsDate:1}};const oe=(s,e="dd.MM.yyyy")=>{try{const r=typeof s=="string"?kr(s):s;return!r||Number.isNaN(r.getTime())?"":No(r,e,{locale:J5})}catch{return""}},hn=(s=new Date)=>{const e=ko(s,{weekStartsOn:1}),r=sN(s,{weekStartsOn:1});return{start:e,end:r}},_o=(s=new Date)=>{const{start:e,end:r}=hn(s);return rN({start:e,end:r})},Eo=s=>{const e=new Date,r=new Date(e);r.setHours(0,0,0,0),r.setDate(r.getDate()-(s-1));const a=new Date(e);return a.setHours(23,59,59,999),{start:r,end:a}},Z5=(s,e)=>{const r=typeof s=="string"?kr(s):s,a=typeof e=="string"?kr(e):e;return Z2(r,a)},tl=s=>s.reduce((e,r)=>{const[a,n]=r.start.split(":").map(Number),[i,o]=r.end.split(":").map(Number),c=a*60+n;let u=(i*60+o-c)/60;if(u<0&&(u+=24),r.breaks&&r.breaks.length>0){const m=r.breaks.reduce((f,x)=>{const[v,T]=x.start.split(":").map(Number),[I,N]=x.end.split(":").map(Number),O=v*60+T;let C=(I*60+N-O)/60;return C<0&&(C+=24),f+C},0);u-=m}return e+u},0),fr=s=>{const[e,r]=s.split(":").map(Number);return e*60+r},m0=(s,e)=>{if(!s||!e)return[];const r=kr(s),a=kr(e);if(a5(a,r))return[];const n=[],i=new Date(r);for(;i<=a;)n.push(oe(i,"yyyy-MM-dd")),i.setDate(i.getDate()+1);return n},e_=s=>{const e=Array.from(new Set(s.filter(Boolean)));return e.sort(),e},Ri=(s,e)=>{const r=fr(s.start),a=fr(s.end),n=fr(e.start),i=fr(e.end),o=s.endDate||a<=r,c=e.endDate||i<=n;if(!o&&!c)return r<i&&a>n;const d=24*60,u=o?a+d:a,m=c?i+d:i;return r<m&&u>n},bs=()=>{const s=new Date,e=3*60,r=s.getTimezoneOffset();return new Date(s.getTime()+(e+r)*60*1e3)},g0=s=>{const e=Math.floor(s),r=Math.round((s-e)*60);return e===0&&r===0?"0ч":e===0?`${r}м`:r===0?`${e}ч`:`${e}ч ${r}м`},Ot=(s,e,r,a)=>{const n=s,i=e||s;if(i<r||n>a)return 0;const o=n>r?n:r,c=i<a?i:a,d=kr(o),m=kr(c).getTime()-d.getTime();return Math.floor(m/(1e3*60*60*24))+1},t_=30,p0=s=>s.toString().padStart(2,"0"),r_=()=>{const s=new Date;return s.setDate(s.getDate()-t_),{dateOnly:`${s.getFullYear()} -${p0(s.getMonth()+1)} -${p0(s.getDate())} `,iso:s.toISOString()}},Pi=async(s,e,r)=>{const a=Xe(ke,s),n=et(a,Tt(e,"<",r)),i=await Ft(n);await Promise.all(i.docs.map(o=>gr(tt(ke,s,o.id))))},s_=async()=>{try{const{dateOnly:s,iso:e}=r_();await Promise.all([Pi("workSlots","date",s),Pi("dayStatuses","date",s),Pi("earnings","date",s),Pi("referrals","createdAt",e)])}catch(s){console.error("Failed to cleanup old data",s)}},Gr=async(s,e)=>{const r=Xe(ke,"workSlots");let a;s&&e||s?a=et(r,Tt("userId","==",s)):e?a=et(r,Tt("date","==",e)):a=et(r);let i=(await Ft(a)).docs.map(o=>{const c=o.data(),d=((c==null?void 0:c.slots)||[]).map(u=>u.break&&!u.breaks?{...u,breaks:[u.break],break:void 0}:u);return{id:o.id,userId:(c==null?void 0:c.userId)||"",date:(c==null?void 0:c.date)||"",slots:d,participants:(c==null?void 0:c.participants)||[],...(c==null?void 0:c.comment)&&{comment:c.comment},...(c==null?void 0:c.category)&&{category:c.category}}});return s&&e&&(i=i.filter(o=>o.date===e)),i.sort((o,c)=>o.date.localeCompare(c.date)),i},Vp=async s=>{try{console.log("addWorkSlot: Starting, db initialized:",!!ke);const e=Xe(ke,"workSlots");console.log("addWorkSlot: Collection reference created");const r=Object.fromEntries(Object.entries(s).filter(([n,i])=>i!==void 0));console.log("addWorkSlot: Clean slot prepared:",r),console.log("addWorkSlot: Calling addDoc...");const a=await pr(e,r);return console.log("addWorkSlot: Work slot added successfully:",a.id),a}catch(e){throw console.error("addWorkSlot: Error caught:",e),console.error("addWorkSlot: Error code:",e==null?void 0:e.code),console.error("addWorkSlot: Error message:",e==null?void 0:e.message),console.error("addWorkSlot: Full error:",JSON.stringify(e,null,2)),e}},Lp=async(s,e)=>{const r=tt(ke,"workSlots",s),a=Object.fromEntries(Object.entries(e).filter(([n,i])=>i!==void 0));await lr(r,a)},rl=async s=>{const e=tt(ke,"workSlots",s);await gr(e)},mn=async(s,e)=>{const r=Xe(ke,"dayStatuses");let a;s?a=et(r,Tt("userId","==",s)):a=et(r);let i=(await Ft(a)).docs.map(o=>{const c=o.data();return{id:o.id,userId:(c==null?void 0:c.userId)||"",date:(c==null?void 0:c.date)||"",type:(c==null?void 0:c.type)||"dayoff",...(c==null?void 0:c.comment)&&{comment:c.comment},...(c==null?void 0:c.endDate)&&{endDate:c.endDate}}});return i.sort((o,c)=>o.date.localeCompare(c.date)),i},sl=async s=>{try{const e=Xe(ke,"dayStatuses"),r=Object.fromEntries(Object.entries(s).filter(([n,i])=>i!==void 0));console.log("Adding day status:",r);const a=await pr(e,r);return console.log("Day status added successfully:",a.id),a}catch(e){throw console.error("Error in addDayStatus:",e),e}},qs=async(s,e)=>{const r=tt(ke,"dayStatuses",s),a=Object.fromEntries(Object.entries(e).filter(([n,i])=>i!==void 0));await lr(r,a)},al=async s=>{const e=tt(ke,"dayStatuses",s);await gr(e)},_c=async s=>{const e=Xe(ke,"restrictions");let r;s!==void 0?r=et(e,Tt("isActive","==",s)):r=et(e);const n=(await Ft(r)).docs.map(i=>{const o=i.data();return{id:i.id,type:(o==null?void 0:o.type)||"all",startDate:(o==null?void 0:o.startDate)||"",endDate:o==null?void 0:o.endDate,startTime:o==null?void 0:o.startTime,blockFutureDates:(o==null?void 0:o.blockFutureDates)||!1,comment:o==null?void 0:o.comment,createdBy:(o==null?void 0:o.createdBy)||"",createdAt:(o==null?void 0:o.createdAt)||"",isActive:(o==null?void 0:o.isActive)??!0}});return n.sort((i,o)=>i.startDate.localeCompare(o.startDate)),n},a_=async s=>{try{const e=Xe(ke,"restrictions"),r=Object.fromEntries(Object.entries(s).filter(([n,i])=>i!==void 0));return await pr(e,r)}catch(e){throw console.error("Error adding restriction:",e),e}},n_=async(s,e)=>{const r=tt(ke,"restrictions",s),a=Object.fromEntries(Object.entries(e).filter(([n,i])=>i!==void 0));await lr(r,a)},i_=async s=>{const e=tt(ke,"restrictions",s);await gr(e)},Ec=async(s,e,r)=>{try{const a=await _c(!0),n=new Date;for(const i of a){if(i.type!=="all"&&i.type!==s)continue;const o=new Date(e),c=new Date(`${i.startDate}${i.startTime?`T${i.startTime}`:""} `);if(i.blockFutureDates&&n>=c){const m=new Date(i.startDate),f=new Date(m);if(f.setDate(m.getDate()+1),o.toDateString()===f.toDateString())return{restricted:!0,restriction:i,reason:`После ${oe(c,"dd.MM.yyyy")}${i.startTime?` ${i.startTime}`:""} запрещено создавать ${Ll(s)} на следующий день ${oe(f,"dd.MM.yyyy")} `}}const d=new Date(i.startDate);let u=!1;if(i.endDate){const m=new Date(i.endDate);u=o>=d&&o<=m}else u=o.getTime()===d.getTime();if(u){if(!i.startTime)return{restricted:!0,restriction:i,reason:`Запрещено создавать ${Ll(s)} на ${oe(o,"dd.MM.yyyy")} `};if(r&&i.startTime){const m=r,f=i.startTime;if(m>=f)return{restricted:!0,restriction:i,reason:`Запрещено создавать ${Ll(s)} после ${f} на ${oe(o,"dd.MM.yyyy")} `}}}}return{restricted:!1}}catch(a){return console.error("Error checking restrictions:",a),{restricted:!1}}},Ll=s=>({slots:"слоты",dayoff:"выходные",sick:"больничные",vacation:"отпуска",absence:"отсутствия",truancy:"прогулы",internship:"стажировки",all:"любые записи"})[s],nl="approvalRequests",Ud=s=>{const e=s.data(),r=new Date().toISOString();return{id:s.id,entity:(e==null?void 0:e.entity)||"slot",action:(e==null?void 0:e.action)||"create",status:(e==null?void 0:e.status)||"pending",authorId:(e==null?void 0:e.authorId)||"",targetUserId:(e==null?void 0:e.targetUserId)||"",before:(e==null?void 0:e.before)??null,after:(e==null?void 0:e.after)??null,comment:e==null?void 0:e.comment,adminComment:e==null?void 0:e.adminComment,reviewedBy:e==null?void 0:e.reviewedBy,createdAt:(e==null?void 0:e.createdAt)||r,updatedAt:(e==null?void 0:e.updatedAt)||(e==null?void 0:e.createdAt)||r,processedAt:e==null?void 0:e.processedAt}},o_=async s=>{const e=s.before,r=s.after;switch(s.action){case"create":{if(!r)throw new Error("No slot payload for creation");const{id:a,...n}=r;await Vp(n);return}case"update":{const a=(r==null?void 0:r.id)||(e==null?void 0:e.id);if(!a||!r)throw new Error("No slot payload for update");const{id:n,...i}=r;await Lp(a,i);return}case"delete":{if(!(e!=null&&e.id))throw new Error("No slot id for delete");await rl(e.id);return}default:return}},l_=async s=>{const e=s.before,r=s.after;switch(s.action){case"create":{if(!r)throw new Error("No status payload for creation");const{id:a,...n}=r;await sl(n);return}case"update":{const a=(r==null?void 0:r.id)||(e==null?void 0:e.id);if(!a||!r)throw new Error("No status payload for update");const{id:n,...i}=r;await qs(a,i);return}case"delete":{if(!(e!=null&&e.id))throw new Error("No status id for delete");await al(e.id);return}default:return}},c_=async s=>{const e=s.before,r=s.after;switch(s.action){case"create":{if(!r)throw new Error("No earning payload for creation");const{id:a,...n}=r;await Fp(n);return}case"update":{const a=(r==null?void 0:r.id)||(e==null?void 0:e.id);if(!a||!r)throw new Error("No earning payload for update");const{id:n,...i}=r;await Up(a,i);return}case"delete":{if(!(e!=null&&e.id))throw new Error("No earning id for delete");await Bp(e.id);return}default:return}},d_=async s=>{const e=s.before,r=s.after;switch(s.action){case"create":{if(!r)throw new Error("No referral payload for creation");const{id:a,...n}=r;await qp(n);return}case"update":{const a=(r==null?void 0:r.id)||(e==null?void 0:e.id);if(!a||!r)throw new Error("No referral payload for update");const{id:n,...i}=r;await Wp(a,i);return}case"delete":{if(!(e!=null&&e.id))throw new Error("No referral id for delete");await m_(e.id);return}default:return}},u_=async s=>{const e=s.after;switch(s.action){case"update":{if(!e||!e.nickname)throw new Error("No nickname payload for update");await __(s.targetUserId,e.nickname);return}case"delete":{await E_(s.targetUserId);return}default:return}},$t=async s=>{const e=Xe(ke,nl),r=new Date().toISOString(),a={...s,status:"pending",createdAt:r,updatedAt:r},n=Object.fromEntries(Object.entries(a).filter(([,o])=>o!==void 0));return await pr(e,n)},h_=async(s,e,r)=>{const a=Xe(ke,nl);let n;n=et(a);let o=(await Ft(n)).docs.map(Ud);return o.sort((c,d)=>d.createdAt.localeCompare(c.createdAt)),o},x0=async(s,e,r)=>{const a=tt(ke,nl,s),n=await po(a);if(!n.exists())return;const i=Ud(n);if(i.status!=="pending")return;i.entity==="slot"?await o_(i):i.entity==="status"?await l_(i):i.entity==="earning"?await c_(i):i.entity==="referral"?await d_(i):i.entity==="login"&&(await u_(i),Nc(i.targetUserId),await fs(i.targetUserId));const o={status:"approved",reviewedBy:e,updatedAt:new Date().toISOString(),processedAt:new Date().toISOString()},c=i.adminComment;c!==void 0&&(o.adminComment=c),await lr(a,o)},f0=async(s,e,r)=>{const a=tt(ke,nl,s),n=await po(a);!n.exists()||Ud(n).status!=="pending"||await lr(a,{status:"rejected",adminComment:r,reviewedBy:e,updatedAt:new Date().toISOString(),processedAt:new Date().toISOString()})},Jn=async(s,e,r)=>{const a=Xe(ke,"earnings");let n;s?n=et(a):e&&r?n=et(a,Tt("date",">=",e),Tt("date","<=",r)):n=et(a);let o=(await Ft(n)).docs.map(c=>{const d=c.data();return{id:c.id,userId:(d==null?void 0:d.userId)||"",date:(d==null?void 0:d.date)||"",amount:(d==null?void 0:d.amount)||0,poolAmount:(d==null?void 0:d.poolAmount)||0,slotId:(d==null?void 0:d.slotId)||"",walletType:(d==null?void 0:d.walletType)||"personal",isDeving:(d==null?void 0:d.isDeving)||!1,extraWalletsCount:(d==null?void 0:d.extraWalletsCount)||0,extraWalletsAmount:(d==null?void 0:d.extraWalletsAmount)||0,category:(d==null?void 0:d.category)||"other",participants:(d==null?void 0:d.participants)||[]}});return s&&(o=o.filter(c=>(c.participants&&c.participants.length>0?[...c.participants,c.userId]:[c.userId]).includes(s))),s&&e&&r?o=o.filter(c=>c.date>=e&&c.date<=r):!s&&e&&r&&(o=o.filter(c=>c.date>=e&&c.date<=r)),o.sort((c,d)=>d.date.localeCompare(c.date)),o},Fp=async s=>{try{const e=Xe(ke,"earnings"),r=Object.fromEntries(Object.entries(s).filter(([n,i])=>i!==void 0));console.log("Adding earnings:",r);const a=await pr(e,r);return console.log("Earnings added successfully:",a.id),a}catch(e){throw console.error("Error in addEarnings:",e),e}},Up=async(s,e)=>{const r=tt(ke,"earnings",s),a=Object.fromEntries(Object.entries(e).filter(([n,i])=>i!==void 0));await lr(r,a)},Bp=async s=>{const e=tt(ke,"earnings",s);await gr(e)},zp=async s=>{const e=Xe(ke,"ratings");let r=et(e);return s&&(r=et(r,Tt("userId","==",s))),(await Ft(r)).docs.map(n=>{const i=n.data();return{id:n.id,userId:i.userId||"",earnings:i.earnings||0,messages:i.messages||0,initiatives:i.initiatives||0,signals:i.signals||0,profitableSignals:i.profitableSignals||0,referrals:i.referrals||0,daysOff:i.daysOff||0,sickDays:i.sickDays||0,vacationDays:i.vacationDays||0,absenceDays:i.absenceDays||0,truancyDays:i.truancyDays||0,internshipDays:i.internshipDays||0,poolAmount:i.poolAmount||0,rating:i.rating||0,lastUpdated:i.lastUpdated||new Date().toISOString()}})},qp=async s=>{try{const e=Xe(ke,"referrals"),r=Object.fromEntries(Object.entries(s).filter(([n,i])=>i!==void 0));console.log("Adding referral:",r);const a=await pr(e,r);return console.log("Referral added successfully:",a.id),a}catch(e){throw console.error("Error in addReferral:",e),e}},Bd=async(s,e,r)=>{const a=Xe(ke,"referrals");let n;n=et(a,ya("createdAt","desc"));let o=(await Ft(n)).docs.map(c=>{const d=c.data();return{id:c.id,referralId:d.referralId,ownerId:d.ownerId,name:d.name,age:d.age,createdAt:d.createdAt,comment:d.comment,phone:d.phone,tgAccount:d.tgAccount,source:d.source,status:d.status||"active"}});return e&&r&&(o=o.filter(c=>c.createdAt>=e&&c.createdAt<=r)),o.sort((c,d)=>c.createdAt<d.createdAt?1:-1)},Wp=async(s,e)=>{const r=tt(ke,"referrals",s),a=Object.fromEntries(Object.entries(e).filter(([n,i])=>i!==void 0));await lr(r,a)},m_=async s=>{const e=tt(ke,"referrals",s);await gr(e)},g_=async s=>{if(console.log("📝 Service site: Creating call:",{category:s.category,userId:s.userId,status:s.status,createdAt:s.createdAt}),!ke)throw console.error("❌ Service site: Firestore db is not initialized"),new Error("Firestore database is not initialized");const e=Xe(ke,"calls"),r=await pr(e,s);return console.log("✅ Service site: Call created successfully with ID:",r.id),console.log("📊 Service site: Call data saved to Firestore:",s),r.id},p_=async s=>{const e=Xe(ke,"calls"),r=[];r.push(ya("createdAt","desc"));let a;return r.length>0?a=et(e,...r):a=et(e,ya("createdAt","desc")),(await Ft(a)).docs.map(o=>{var v,T,I,N,O,D,C;const c=o.data(),d=c.category||"memecoins",u=!c.details&&c.ticker?{memecoins:{coinName:c.pair||c.ticker,ticker:c.ticker||"",network:c.network||"solana",contract:c.contract,signalType:c.sentiment||"buy",reason:c.comment||c.risks||"",entryCap:c.entryPoint||"",targets:c.target||"",stopLoss:c.cancelConditions,riskLevel:c.riskLevel||"medium",risks:c.risks||"",holdPlan:"short",liquidityLocked:!1,traderComment:c.comment}}:{},m=c.details||u||{},f=c.riskLevel||((v=m.memecoins)==null?void 0:v.riskLevel)||((T=m.polymarket)==null?void 0:T.riskLevel)||((I=m.staking)==null?void 0:I.protocolRisk)||((N=m.spot)==null?void 0:N.riskLevel)||((O=m.futures)==null?void 0:O.riskLevel),x=c.sentiment||(((D=m.futures)==null?void 0:D.direction)==="long"?"buy":((C=m.futures)==null?void 0:C.direction)==="short"?"sell":void 0);return{id:o.id,userId:c.userId||"",category:d,details:m,sentiment:x,riskLevel:f,comment:c.comment,createdAt:c.createdAt||new Date().toISOString(),status:c.status||"active",maxProfit:c.maxProfit,currentPnL:c.currentPnL,currentMarketCap:c.currentMarketCap,signalMarketCap:c.signalMarketCap,currentPrice:c.currentPrice,entryPrice:c.entryPrice,tags:c.tags||[]}})},Tc=async(s,e)=>{const r=tt(ke,"calls",s);await lr(r,e)},x_=async s=>{const e=tt(ke,"calls",s);await gr(e)},f_=async s=>{const e=Xe(ke,"tasks");return(await pr(e,s)).id},Hp=async s=>{const e=Xe(ke,"tasks"),r=[];s!=null&&s.status&&r.push(Tt("status","==",s.status)),s!=null&&s.category&&r.push(Tt("category","==",s.category)),s!=null&&s.createdBy&&r.push(Tt("createdBy","==",s.createdBy)),r.push(ya("createdAt","desc"));let a;r.length>0?a=et(e,...r):a=et(e,ya("createdAt","desc"));const n=await Ft(a),i=x=>x==="high"||x==="low"||x==="urgent"?x:"medium",o=x=>x==="completed"||x==="closed"?x:"in_progress",c=(x=[])=>x.filter(v=>v==null?void 0:v.userId).slice(0,10).map(v=>({userId:v.userId,priority:i(v.priority),comment:v.comment,instruction:v.instruction}));let d=n.docs.map(x=>{const v=x.data(),I=((Array.isArray(v.assignees)?v.assignees:(v.assignedTo||[]).map(C=>({userId:C,priority:"medium"})))||[]).map(C=>({userId:C.userId||"",priority:i(C.priority),comment:C.comment})).filter(C=>!!C.userId),N=I.map(C=>C.userId),O=Array.isArray(v.coExecutors)?v.coExecutors:Array.isArray(v.executors)?v.executors:[],D=(v.stages||[]).map(C=>({id:C.id||`stage - ${Date.now()} `,name:C.name||"Этап",description:C.description,responsible:C.responsible==="all"?"all":Array.isArray(C.responsible)?C.responsible:(C.assignees||[]).map(M=>M.userId),assignees:c(C.assignees),stagePriority:i(C.stagePriority),requiresApproval:C.requiresApproval??!0,approvals:C.approvals||[],comments:C.comments||[],status:C.status||"pending"}));return{id:x.id,title:v.title||"",description:v.description,category:v.category||"trading",status:o(v.status),createdBy:v.createdBy||"",assignedTo:N,assignees:I,approvals:v.approvals||[],createdAt:v.createdAt||new Date().toISOString(),updatedAt:v.updatedAt||new Date().toISOString(),completedAt:v.completedAt,closedAt:v.closedAt,completedBy:v.completedBy,priority:i(v.priority),dueDate:v.dueDate||new Date().toISOString().split("T")[0],dueTime:v.dueTime||"12:00",startTime:v.startTime,mainExecutor:v.mainExecutor,leadExecutor:v.leadExecutor,deputies:v.deputies||[],coExecutors:O,executors:v.executors||[],curators:v.curators||[],leads:v.leads||[],stages:D,currentStageId:v.currentStageId,awaitingStageId:v.awaitingStageId,comments:v.comments||[],expectedResult:v.expectedResult,requiresApproval:v.requiresApproval??!0}});const u=new Date,m=new Date(u.getTime()-12*60*60*1e3),f=d.filter(x=>x.status==="closed"&&x.closedAt?new Date(x.closedAt)<m:!1);if(f.length>0&&(await Promise.all(f.map(x=>Gp(x.id))),d=d.filter(x=>!f.find(v=>v.id===x.id))),s!=null&&s.assignedTo)if(Array.isArray(s.assignedTo)){const x=s.assignedTo;x.length>0&&(d=d.filter(v=>x.some(T=>v.assignedTo.includes(T))))}else d=d.filter(x=>x.assignedTo.includes(s.assignedTo));return d},b_=async(s,e)=>{const r=tt(ke,"tasks",s),a=Object.fromEntries(Object.entries({...e,updatedAt:new Date().toISOString()}).filter(([n,i])=>i!==void 0));await lr(r,a)},Gp=async s=>{const e=tt(ke,"tasks",s);await gr(e)},y_=async(s,e=!1)=>{const r=Xe(ke,"notes");let a;!e&&s?a=et(r,Tt("userId","==",s)):a=et(r);const i=(await Ft(a)).docs.map(o=>{const c=o.data();return{id:o.id,userId:c.userId||"",title:c.title||"",text:c.text||"",priority:c.priority==="low"||c.priority==="high"?c.priority:"medium",createdAt:c.createdAt||new Date().toISOString(),updatedAt:c.updatedAt||new Date().toISOString()}});return i.sort((o,c)=>(c.updatedAt||"").localeCompare(o.updatedAt||"")),s&&!e?i.filter(o=>o.userId===s):i},v_=async s=>{const e=Xe(ke,"notes"),r={...s,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};return(await pr(e,r)).id},w_=async(s,e)=>{const r=tt(ke,"notes",s),a=Object.fromEntries(Object.entries({...e,updatedAt:new Date().toISOString()}).filter(([n,i])=>i!==void 0));await lr(r,a)},k_=async s=>{const e=tt(ke,"notes",s);await gr(e)},j_=async s=>{const e=Xe(ke,"userActivities");return(await pr(e,s)).id},Sc=async(s,e)=>{const r=tt(ke,"userActivities",s),a=Object.fromEntries(Object.entries(e).filter(([n,i])=>i!==void 0));await lr(r,a)},Fl=async(s,e,r)=>{await Sc(s,{logoutAt:e,sessionDuration:r,isActive:!1})},il=async s=>{const e=Xe(ke,"userNicknames"),r=et(e,Tt("userId","==",s)),a=await Ft(r);if(a.empty)return null;const n=a.docs[0].data();return{id:a.docs[0].id,userId:n.userId||"",nickname:n.nickname||"",createdAt:n.createdAt||new Date().toISOString(),updatedAt:n.updatedAt||new Date().toISOString()}},N_=async s=>{const e=await il(s);return(e==null?void 0:e.nickname)||null},__=async(s,e)=>{const r=Xe(ke,"userNicknames"),a=await il(s),n=new Date().toISOString();if(a){const i=tt(ke,"userNicknames",a.id);return await lr(i,{nickname:e,updatedAt:n}),a.id}else return(await pr(r,{userId:s,nickname:e,createdAt:n,updatedAt:n})).id},E_=async s=>{const e=await il(s);e&&await gr(tt(ke,"userNicknames",e.id))},Kp=async(s,e)=>{const r=Xe(ke,"userConflicts");let a;return s&&e!==void 0?a=et(r,Tt("isActive","==",e),Tt("userId","==",s)):s?a=et(r,Tt("userId","==",s)):e!==void 0?a=et(r,Tt("isActive","==",e)):a=et(r),(await Ft(a)).docs.map(i=>{const o=i.data();return{id:i.id,userId:(o==null?void 0:o.userId)||"",restrictedUserId:(o==null?void 0:o.restrictedUserId)||"",reason:(o==null?void 0:o.reason)||"",createdBy:(o==null?void 0:o.createdBy)||"",createdAt:(o==null?void 0:o.createdAt)||"",isActive:(o==null?void 0:o.isActive)??!0}})},T_=async s=>{const e=Xe(ke,"userConflicts");return await pr(e,s)},b0=async(s,e)=>{const r=tt(ke,"userConflicts",s);await lr(r,e)},S_=async s=>{const e=tt(ke,"userConflicts",s);await gr(e)},y0=async(s,e)=>{const r=Xe(ke,"accessBlocks");let a;a=et(r,Tt("isActive","==",e));let i=(await Ft(a)).docs.map(o=>{const c=o.data();return{id:o.id,userId:c==null?void 0:c.userId,reason:(c==null?void 0:c.reason)||"",createdBy:(c==null?void 0:c.createdBy)||"",createdAt:(c==null?void 0:c.createdAt)||"",expiresAt:c==null?void 0:c.expiresAt,isActive:(c==null?void 0:c.isActive)??!0,blockFeatures:(c==null?void 0:c.blockFeatures)||[]}});return s!=null?i=i.filter(o=>o.userId===s):i=i.filter(o=>!o.userId),i},I_=async s=>{const e=Xe(ke,"accessBlocks");let r;return r=et(e,Tt("isActive","==",s)),(await Ft(r)).docs.map(n=>{const i=n.data();return{id:n.id,userId:i==null?void 0:i.userId,reason:(i==null?void 0:i.reason)||"",createdBy:(i==null?void 0:i.createdBy)||"",createdAt:(i==null?void 0:i.createdAt)||"",expiresAt:i==null?void 0:i.expiresAt,isActive:(i==null?void 0:i.isActive)??!0,blockFeatures:(i==null?void 0:i.blockFeatures)||[]}})},A_=async s=>{const e=Xe(ke,"accessBlocks");return await pr(e,s)},To=async(s,e)=>{const r=tt(ke,"accessBlocks",s);await lr(r,e)},C_=async s=>{const e=tt(ke,"accessBlocks",s);await gr(e)},zd=async(s,e)=>{try{const r=await y0(void 0,!0);for(const n of r){if(n.expiresAt&&new Date(n.expiresAt)<new Date){await To(n.id,{isActive:!1});continue}if(n.blockFeatures.includes("all"))return{hasAccess:!1,reason:n.reason,expiresAt:n.expiresAt};if(n.blockFeatures.includes(e))return{hasAccess:!1,reason:n.reason,expiresAt:n.expiresAt};if(e==="tools"&&n.blockFeatures.includes("tools"))return{hasAccess:!1,reason:n.reason,expiresAt:n.expiresAt};if(e==="call"&&n.blockFeatures.includes("call"))return{hasAccess:!1,reason:n.reason,expiresAt:n.expiresAt};if(e==="avf_hub"&&n.blockFeatures.includes("avf_hub"))return{hasAccess:!1,reason:n.reason,expiresAt:n.expiresAt};if(e==="about"&&n.blockFeatures.includes("about"))return{hasAccess:!1,reason:n.reason,expiresAt:n.expiresAt};const i=["tools_meme_evaluation","tools_ai_ao_alerts","tools_signals_trigger_bot"];if(i.includes(e)&&n.blockFeatures.includes("tools"))return{hasAccess:!1,reason:n.reason,expiresAt:n.expiresAt};if(i.includes(e)&&n.blockFeatures.includes(e))return{hasAccess:!1,reason:n.reason,expiresAt:n.expiresAt}}const a=await y0(s,!0);for(const n of a){if(n.expiresAt&&new Date(n.expiresAt)<new Date){await To(n.id,{isActive:!1});continue}if(n.blockFeatures.includes("all"))return{hasAccess:!1,reason:n.reason,expiresAt:n.expiresAt};if(n.blockFeatures.includes(e))return{hasAccess:!1,reason:n.reason,expiresAt:n.expiresAt};if(e==="tools"&&n.blockFeatures.includes("tools"))return{hasAccess:!1,reason:n.reason,expiresAt:n.expiresAt};if(e==="call"&&n.blockFeatures.includes("call"))return{hasAccess:!1,reason:n.reason,expiresAt:n.expiresAt};if(e==="avf_hub"&&n.blockFeatures.includes("avf_hub"))return{hasAccess:!1,reason:n.reason,expiresAt:n.expiresAt};if(e==="about"&&n.blockFeatures.includes("about"))return{hasAccess:!1,reason:n.reason,expiresAt:n.expiresAt};const i=["tools_meme_evaluation","tools_ai_ao_alerts","tools_signals_trigger_bot"];if(i.includes(e)&&n.blockFeatures.includes("tools"))return{hasAccess:!1,reason:n.reason,expiresAt:n.expiresAt};if(i.includes(e)&&n.blockFeatures.includes(e))return{hasAccess:!1,reason:n.reason,expiresAt:n.expiresAt}}return{hasAccess:!0,reason:void 0,expiresAt:void 0}}catch(r){return console.error("Error checking user access:",r),{hasAccess:!0,reason:void 0,expiresAt:void 0}}},qd=async()=>{const s=Xe(ke,"users");return(await Ft(s)).docs.map(a=>({id:a.id,...a.data()})).sort((a,n)=>a.name.localeCompare(n.name))},D_=async s=>{const e=Xe(ke,"users"),r=Object.fromEntries(Object.entries(s).filter(([n,i])=>i!==void 0));return(await pr(e,r)).id},$_=async(s,e)=>{const r=tt(ke,"users",s),a=Object.fromEntries(Object.entries(e).filter(([n,i])=>i!==void 0));await lr(r,a)},R_=async s=>{console.log(`[deleteUser] Starting deletion for user: ${s}`);const e=[{name:"workSlots",field:"userId"},{name:"workSlots",field:"participants"},{name:"dayStatuses",field:"userId"},{name:"earnings",field:"userId"},{name:"earnings",field:"participants"},{name:"ratings",field:"userId"},{name:"tasks",field:"createdBy"},{name:"tasks",field:"assignedTo"},{name:"userActivities",field:"userId"},{name:"userNicknames",field:"userId"},{name:"notes",field:"userId"},{name:"messages",field:"userId"},{name:"userConflicts",field:"userId"},{name:"userConflicts",field:"restrictedUserId"},{name:"accessBlocks",field:"userId"}],r=new Set;for(const{name:i,field:o}of e)try{const c=Xe(ke,i),d=et(c,Tt(o,"==",s));(await Ft(d)).docs.forEach(m=>r.add(m.id))}catch(c){console.error(`[deleteUser] Error querying ${i}.${o}:`,c)}for(const i of r)try{for(const{name:o}of e)try{const c=tt(ke,o,i);if((await po(c)).exists()){await gr(c),console.log(`[deleteUser] Deleted ${o}/${i}`);break}}catch{}}catch(o){console.error(`[deleteUser] Error deleting document ${i}:`,o)}const a=tt(ke,"users",s);(await po(a)).exists()&&(await gr(a),console.log(`[deleteUser] Deleted user document: ${s}`)),console.log(`[deleteUser] Completed deletion for user: ${s}`)},Ul=[{value:"solana",label:"Solana"},{value:"ethereum",label:"ETH"},{value:"bsc",label:"BSC"},{value:"ton",label:"TON"},{value:"base",label:"Base"},{value:"sui",label:"SUI"},{value:"monad",label:"Monad"},{value:"polygon",label:"Polygon"}],la={memecoins:{label:"Мемкоины",gradient:"from-emerald-400 via-teal-500 to-cyan-400",gradientDark:"from-emerald-500 via-teal-600 to-cyan-500",icon:t.jsx(Lr,{className:"w-5 h-5"}),pastelBg:"bg-emerald-50",pastelBorder:"border-emerald-200",pastelText:"text-emerald-800"},futures:{label:"Фьючерсы",gradient:"from-sky-300 to-indigo-400",gradientDark:"from-sky-600 to-indigo-500",icon:t.jsx(ka,{className:"w-5 h-5"}),pastelBg:"bg-sky-50",pastelBorder:"border-sky-100",pastelText:"text-sky-800"},nft:{label:"NFT",gradient:"from-purple-300 to-pink-300",gradientDark:"from-purple-600 to-pink-500",icon:t.jsx(_s,{className:"w-5 h-5"}),pastelBg:"bg-purple-50",pastelBorder:"border-purple-100",pastelText:"text-purple-800"},spot:{label:"Спот",gradient:"from-amber-300 to-orange-300",gradientDark:"from-amber-600 to-orange-500",icon:t.jsx(jr,{className:"w-5 h-5"}),pastelBg:"bg-amber-50",pastelBorder:"border-amber-100",pastelText:"text-amber-800"},polymarket:{label:"Polymarket",gradient:"from-rose-300 to-red-300",gradientDark:"from-rose-600 to-red-500",icon:t.jsx(rr,{className:"w-5 h-5"}),pastelBg:"bg-rose-50",pastelBorder:"border-rose-100",pastelText:"text-rose-800"},staking:{label:"Стейкинг",gradient:"from-emerald-300 to-green-400",gradientDark:"from-emerald-600 to-green-500",icon:t.jsx(xt,{className:"w-5 h-5"}),pastelBg:"bg-emerald-50",pastelBorder:"border-emerald-100",pastelText:"text-emerald-800"},airdrop:{label:"AirDrop",gradient:"from-gray-300 to-gray-400",gradientDark:"from-gray-500 to-gray-400",icon:t.jsx(ts,{className:"w-5 h-5"}),pastelBg:"bg-gray-50",pastelBorder:"border-gray-100",pastelText:"text-gray-800"}},Zt=(s,e)=>e==="dark"?la[s].gradientDark:la[s].gradient,v0={low:"bg-emerald-500/10 text-emerald-600 border border-emerald-500/20",medium:"bg-blue-500/10 text-blue-600 border border-blue-500/20",high:"bg-amber-500/10 text-amber-600 border border-amber-500/20",ultra:"bg-red-500/10 text-red-600 border border-red-500/20"},w0={memecoins:{border:"border-emerald-400/40",bg:"bg-emerald-500/10",text:"text-emerald-400",chipBg:"bg-emerald-400/30"},futures:{border:"border-blue-500/30",bg:"bg-blue-500/5",text:"text-blue-400",chipBg:"bg-blue-500/20"},nft:{border:"border-purple-500/30",bg:"bg-purple-500/5",text:"text-purple-400",chipBg:"bg-purple-500/20"},spot:{border:"border-amber-500/30",bg:"bg-amber-500/5",text:"text-amber-400",chipBg:"bg-amber-500/20"},polymarket:{border:"border-rose-500/30",bg:"bg-rose-500/5",text:"text-rose-400",chipBg:"bg-rose-500/20"},staking:{border:"border-cyan-500/30",bg:"bg-cyan-500/5",text:"text-cyan-400",chipBg:"bg-cyan-500/20"},airdrop:{border:"border-gray-500/30",bg:"bg-gray-500/5",text:"text-gray-400",chipBg:"bg-gray-500/20"}},Ic=s=>{var e;return((e=s.details)==null?void 0:e[s.category])||{}},P_=s=>s.riskLevel||Ic(s).riskLevel||Ic(s).protocolRisk||"medium",M_=(s,e)=>s?s.length>e?`${s.slice(0,e)}...`:s:"",O_={memecoins:{basic:{title:"Контракт и сеть",icon:t.jsx(Ji,{className:"w-4 h-4"}),description:"Адрес токена и блокчейн"},strategy:{title:"Стратегия",icon:t.jsx(it,{className:"w-4 h-4"}),description:"Тип торговой стратегии"},entry:{title:"Зона входа",icon:t.jsx(ds,{className:"w-4 h-4"}),description:"Условия для входа в позицию"},targets:{title:"Цели и риски",icon:t.jsx(rr,{className:"w-4 h-4"}),description:"План прибыли и стоп-лосс"},additional:{title:"Комментарий",icon:t.jsx(Y0,{className:"w-4 h-4"}),description:"Дополнительные заметки"}},futures:{basic:{title:"Основная информация",icon:t.jsx(Wt,{className:"w-4 h-4"}),description:"Данные о паре и направлении"},entry:{title:"Зоны входа",icon:t.jsx(ds,{className:"w-4 h-4"}),description:"Условия входа"},targets:{title:"Цели и риски",icon:t.jsx(it,{className:"w-4 h-4"}),description:"План прибыли и стоп-лоссы"},additional:{title:"Дополнительно",icon:t.jsx(oa,{className:"w-4 h-4"}),description:"Комментарии и детали"}},nft:{basic:{title:"Основная информация",icon:t.jsx(Wt,{className:"w-4 h-4"}),description:"Данные о NFT"},entry:{title:"Условия входа",icon:t.jsx(ds,{className:"w-4 h-4"}),description:"Редкость и атрибуты"},targets:{title:"Цели и риски",icon:t.jsx(it,{className:"w-4 h-4"}),description:"План продажи и оценка рисков"},additional:{title:"Дополнительно",icon:t.jsx(oa,{className:"w-4 h-4"}),description:"Анализ и комментарии"}},spot:{basic:{title:"Основная информация",icon:t.jsx(Wt,{className:"w-4 h-4"}),description:"Данные о монете"},entry:{title:"Зона входа",icon:t.jsx(ds,{className:"w-4 h-4"}),description:"Условия входа в позицию"},targets:{title:"Цели и риски",icon:t.jsx(it,{className:"w-4 h-4"}),description:"План прибыли и стоп-лоссы"},additional:{title:"Дополнительно",icon:t.jsx(oa,{className:"w-4 h-4"}),description:"Анализ и комментарии"}},polymarket:{basic:{title:"Основная информация",icon:t.jsx(Wt,{className:"w-4 h-4"}),description:"Данные о событии"},entry:{title:"Условия входа",icon:t.jsx(ds,{className:"w-4 h-4"}),description:"Позиция и цена входа"},targets:{title:"Цели и риски",icon:t.jsx(it,{className:"w-4 h-4"}),description:"План прибыли и риски"},additional:{title:"Дополнительно",icon:t.jsx(oa,{className:"w-4 h-4"}),description:"Комментарии и детали"}},staking:{basic:{title:"Основная информация",icon:t.jsx(Wt,{className:"w-4 h-4"}),description:"Данные о стейкинге"},entry:{title:"Условия входа",icon:t.jsx(ds,{className:"w-4 h-4"}),description:"Платформа и условия"},targets:{title:"Риски и анализ",icon:t.jsx(nr,{className:"w-4 h-4"}),description:"Оценка рисков"},additional:{title:"Дополнительно",icon:t.jsx(oa,{className:"w-4 h-4"}),description:"Комментарии и детали"}},airdrop:{basic:{title:"Проект",icon:t.jsx(Wt,{className:"w-4 h-4"}),description:"Информация о проекте"},details:{title:"Детали дропа",icon:t.jsx(rr,{className:"w-4 h-4"}),description:"Задачи и вознаграждения"},links:{title:"Ссылки и сроки",icon:t.jsx(Ji,{className:"w-4 h-4"}),description:"Полезные ссылки"},analysis:{title:"Анализ",icon:t.jsx(xt,{className:"w-4 h-4"}),description:"Почему заходим и риски"}}},V_={memecoins:[{key:"contract",label:"Адрес (контракт)",placeholder:"0x... или адрес токена",section:"basic"},{key:"network",label:"Сеть",type:"select",options:Ul,section:"basic"},{key:"holdPlan",label:"Тип стратегии",type:"select",options:[{value:"flip",label:"Флип"},{value:"short",label:"Краткосрок"},{value:"medium",label:"Среднесрок"},{value:"long",label:"Дальнесрок"}],section:"strategy"},{key:"entryCap",label:"Зона входа в капитализации",placeholder:"10M-15M",section:"entry"},{key:"targets",label:"Цели",placeholder:"20M / 30M / 50M",section:"targets"},{key:"stopLoss",label:"Стоп-лосс",placeholder:"5M или -25%",section:"targets"},{key:"trailingPercent",label:"Процент трейлинга",placeholder:"например: 5% или 10%",section:"targets"},{key:"riskLevel",label:"Риск уровень",type:"select",options:[{value:"low",label:"Низкий"},{value:"medium",label:"Средний"},{value:"high",label:"Высокий"},{value:"ultra",label:"Ультра-высокий"}],section:"targets"},{key:"liquidityLocked",label:"Отметка о ликвидности",type:"checkbox",section:"targets"},{key:"traderComment",label:"Комментарий трейдера",type:"textarea",placeholder:"Доп. наблюдения, планы...",section:"additional"}],futures:[{key:"pair",label:"Пара",placeholder:"BTC/USDT",section:"basic",required:!0},{key:"direction",label:"Направление",type:"select",options:[{value:"long",label:"Long"},{value:"short",label:"Short"}],section:"basic",required:!0},{key:"leverage",label:"Рекомендованное плечо",placeholder:"x3 - x10",section:"basic",required:!0},{key:"entryZone",label:"Зоны входа",placeholder:"69000 - 70000",section:"entry",required:!0},{key:"targets",label:"Цели",placeholder:"71000 / 72500 / 74000",section:"targets",required:!0},{key:"stopLoss",label:"Рекомендованный SL",placeholder:"68000",section:"targets",required:!0},{key:"riskLevel",label:"Риск уровень",type:"select",options:[{value:"low",label:"Низкий"},{value:"medium",label:"Средний"},{value:"high",label:"Высокий"},{value:"ultra",label:"Ультра-высокий"}],section:"targets",required:!0},{key:"reason",label:"Причина входа",placeholder:"Тренд, объемы, дивергенция...",type:"textarea",section:"additional"},{key:"risks",label:"Риски",placeholder:"Резкий вброс, низкая волатильность",type:"textarea",section:"additional"},{key:"traderComment",label:"Комментарий трейдера",type:"textarea",placeholder:"Доп. наблюдения, планы...",section:"additional"}],nft:[{key:"nftLink",label:"NFT (ссылка)",placeholder:"https://.../item",section:"basic",required:!0},{key:"network",label:"Сеть",type:"select",options:Ul,section:"basic",required:!0},{key:"rarity",label:"Редкость / атрибуты",placeholder:"Rank < 5%",section:"entry",required:!0},{key:"targets",label:"Цели",placeholder:"2 ETH / 3 ETH / 5 ETH",section:"targets",required:!0},{key:"riskLevel",label:"Риск уровень",type:"select",options:[{value:"low",label:"Низкий"},{value:"medium",label:"Средний"},{value:"high",label:"Высокий"},{value:"ultra",label:"Ультра-высокий"}],section:"targets",required:!0},{key:"reason",label:"Причина входа",placeholder:"Минт, хайп, инсайд",type:"textarea",section:"additional"},{key:"risks",label:"Риски",placeholder:"Падение спроса, фальшивый объём",type:"textarea",section:"additional"},{key:"traderComment",label:"Комментарий трейдера",type:"textarea",placeholder:"Что смотрим, когда фиксируем",section:"additional"}],spot:[{key:"coin",label:"Монета",placeholder:"BTC",section:"basic",required:!0},{key:"entryZone",label:"Зона входа",placeholder:"500M или 0.000012",section:"entry",required:!0},{key:"targets",label:"Цели",placeholder:"550M / 650M / 750M",section:"targets",required:!0},{key:"stopLoss",label:"Рекомендованный SL",placeholder:"-10% или 450M",section:"targets",required:!0},{key:"holdingHorizon",label:"Горизонт удержания",type:"select",options:[{value:"short",label:"Краткосрок"},{value:"medium",label:"Среднесрок"},{value:"long",label:"Долгосрок"}],section:"targets",required:!0},{key:"riskLevel",label:"Риск-уровень",type:"select",options:[{value:"low",label:"Низкий"},{value:"medium",label:"Средний"},{value:"high",label:"Высокий"},{value:"ultra",label:"Ультра-высокий"}],section:"targets",required:!0},{key:"reason",label:"Причина входа",placeholder:"Фундаментал, хайп",type:"textarea",section:"additional"},{key:"risks",label:"Риски",placeholder:"Регуляторика, конкуренты",type:"textarea",section:"additional"},{key:"traderComment",label:"Комментарий трейдера",type:"textarea",placeholder:"Условия фиксации, обновления",section:"additional"}],polymarket:[{key:"event",label:"Событие",placeholder:"Trump wins 2025",section:"basic"},{key:"eventDeadline",label:"Срок исхода события",placeholder:"31.12.2025",section:"basic"},{key:"positionType",label:"Тип позиции",type:"select",options:[{value:"yes",label:"Yes"},{value:"no",label:"No"}],section:"entry"},{key:"entryPrice",label:"Цена входа (%)",placeholder:"42%",section:"entry"},{key:"expectedProbability",label:"Ожидаемая вероятность (%)",placeholder:"65%",section:"entry"},{key:"targetPlan",label:"Цель",placeholder:"Продажа до события или удержание",section:"targets"},{key:"riskLevel",label:"Риск",type:"select",options:[{value:"low",label:"Низкий"},{value:"medium",label:"Средний"},{value:"high",label:"Высокий"},{value:"ultra",label:"Ультра-высокий"}],section:"targets"},{key:"risks",label:"Риски",placeholder:"Неопределённость новостей, низкая ликвидность",type:"textarea",section:"targets"},{key:"reason",label:"Причина входа",placeholder:"Аналитика, инсайд",type:"textarea",section:"additional"}],staking:[{key:"coin",label:"Монета",placeholder:"SOL",section:"basic"},{key:"platform",label:"Платформа",placeholder:"Jito, Lido...",section:"entry"},{key:"term",label:"Срок стейкинга",type:"select",options:[{value:"flexible",label:"Гибкий"},{value:"30d",label:"30 дней"},{value:"90d",label:"90 дней"},{value:"180d",label:"180 дней"},{value:"365d",label:"365 дней"},{value:"fixed",label:"Фиксированный"}],section:"entry"},{key:"fixedTermCustom",label:"Срок фиксированного стейкинга",placeholder:"Укажите срок (например, 45 дней)",section:"entry"},{key:"apy",label:"APY",placeholder:"12-18%",section:"entry"},{key:"minDeposit",label:"Минимальный депозит",placeholder:"100 USDT",section:"entry"},{key:"protocolRisk",label:"Риски протокола",type:"select",options:[{value:"low",label:"Низкие"},{value:"medium",label:"Средние"},{value:"high",label:"Высокие"},{value:"ultra",label:"Ультра"}],section:"targets"},{key:"risks",label:"Риски",placeholder:"Смарт-контракт, ликвидность",type:"textarea",section:"targets"},{key:"reason",label:"Причина",placeholder:"Рост доходности",type:"textarea",section:"additional"},{key:"traderComment",label:"Комментарий трейдера",type:"textarea",placeholder:"Тактика выхода, дополнительные условия",section:"additional"}],airdrop:[{key:"projectName",label:"Название проекта",placeholder:"Project Name",section:"basic",required:!0},{key:"network",label:"Сеть",type:"select",options:[...Ul,{value:"other",label:"Другое"}],section:"basic"},{key:"rewardType",label:"Тип награды",type:"select",options:[{value:"token",label:"Токены"},{value:"points",label:"Поинты"},{value:"nft",label:"NFT"},{value:"other",label:"Другое"}],section:"details"},{key:"expectedValue",label:"Ожидаемая стоимость",placeholder:"$100 - $1000",section:"details"},{key:"tasks",label:"Список задач",placeholder:"Свапы, бридж, подписка...",type:"textarea",section:"details",required:!0},{key:"link",label:"Ссылка на активность",placeholder:"https://...",section:"links",required:!0},{key:"deadline",label:"Дедлайн",placeholder:"31.12.2025",section:"links"},{key:"reason",label:"Почему заходим (Lust)",placeholder:"Большие инвестиции, проект от Binance...",type:"textarea",section:"analysis",required:!0},{key:"risks",label:"Риски",placeholder:"Скам, долгое ожидание, затраты на газ",type:"textarea",section:"analysis"},{key:"traderComment",label:"Комментарий",type:"textarea",placeholder:"Лайфхаки, как лучше делать",section:"analysis"}]},k0=()=>({memecoins:{network:"solana",contract:"",holdPlan:"short",entryCap:"",targets:"",stopLoss:"",trailingPercent:"",riskLevel:"medium",liquidityLocked:!1,traderComment:""},futures:{pair:"",direction:"long",leverage:"",entryZone:"",targets:"",stopLoss:"",riskLevel:"medium",reason:"",risks:"",traderComment:""},nft:{nftLink:"",network:"ethereum",rarity:"",targets:"",riskLevel:"medium",reason:"",risks:"",traderComment:""},spot:{coin:"",entryZone:"",targets:"",stopLoss:"",holdingHorizon:"medium",riskLevel:"medium",reason:"",risks:"",traderComment:""},polymarket:{event:"",positionType:"yes",entryPrice:"",expectedProbability:"",reason:"",eventDeadline:"",riskLevel:"medium",risks:"",targetPlan:""},staking:{coin:"",platform:"",term:"flexible",fixedTermCustom:"",apy:"",minDeposit:"",protocolRisk:"medium",reason:"",risks:"",traderComment:""},airdrop:{projectName:"",network:"solana",rewardType:"token",expectedValue:"",tasks:"",deadline:"",link:"",reason:"",risks:"",traderComment:""}}),j0=(s,e)=>({memecoins:{...s.memecoins,...(e==null?void 0:e.memecoins)||{}},futures:{...s.futures,...(e==null?void 0:e.futures)||{}},nft:{...s.nft,...(e==null?void 0:e.nft)||{}},spot:{...s.spot,...(e==null?void 0:e.spot)||{}},polymarket:{...s.polymarket,...(e==null?void 0:e.polymarket)||{}},staking:{...s.staking,...(e==null?void 0:e.staking)||{}},airdrop:{...s.airdrop,...(e==null?void 0:e.airdrop)||{}}}),L_=({onSuccess:s,onCancel:e,callToEdit:r,initialCategory:a,category:n,onCategoryChange:i,showCategorySelector:o=!0})=>{const{theme:c}=Re(),{user:d}=ot(),[u,m]=k.useState(!1),[f,x]=k.useState(""),[v,T]=k.useState(!1),I=j0(k0(),r==null?void 0:r.details),[N,O]=k.useState((r==null?void 0:r.category)||a||"memecoins"),[D,C]=k.useState(I),M=n??N,V=q=>{O(q),i==null||i(q)};k.useEffect(()=>{const q=j0(k0(),r==null?void 0:r.details);if(C(q),!n){const R=(r==null?void 0:r.category)||a||"memecoins";O(R),i==null||i(R)}},[r,a,n]);const U=c==="dark"?"text-white":"text-gray-900",y=c==="dark"?"border-gray-800":"border-gray-200",b=c==="dark"?"text-gray-400":"text-gray-500",E=b,j=c==="dark"?"bg-[#121212]":"bg-white",A=(q,R)=>{C(S=>({...S,[M]:{...S[M],[q]:R}}))},w=q=>(q==null?void 0:q.riskLevel)||(q==null?void 0:q.protocolRisk)||void 0,g=q=>{if(q!=null&&q.signalType)return q.signalType;if((q==null?void 0:q.direction)==="long")return"buy";if((q==null?void 0:q.direction)==="short")return"sell"},$=q=>{const R=Ic(q),S=P_(q),P=Zt(q.category,c),W=[],K=(H,me,G)=>{me&&W.push({label:H,value:me,icon:G})};switch(q.category){case"memecoins":K("Контракт",M_(R.contract,20),t.jsx(Ji,{className:"w-4 h-4"})),K("Сеть",R.network?String(R.network).toUpperCase():"",t.jsx(Mu,{className:"w-4 h-4"})),K("Стратегия",R.holdPlan==="flip"?"Флип":R.holdPlan==="short"?"Краткосрок":R.holdPlan==="medium"?"Среднесрок":"Дальнесрок",t.jsx(it,{className:"w-4 h-4"})),K("Зона входа",R.entryCap,t.jsx(ds,{className:"w-4 h-4"})),K("Цели",R.targets,t.jsx(rr,{className:"w-4 h-4"})),K("Стоп-лосс",R.stopLoss,t.jsx(vl,{className:"w-4 h-4"})),K("Трейлинг",R.trailingPercent,t.jsx(kl,{className:"w-4 h-4"})),K("Ликвидность",R.liquidityLocked?"Залочена":"Не залочена",t.jsx(xt,{className:"w-4 h-4"}));break;case"futures":K("Пара",R.pair,t.jsx(Ms,{className:"w-4 h-4"})),K("Направление",R.direction?R.direction.toUpperCase():"",t.jsx(it,{className:"w-4 h-4"})),K("Плечо",R.leverage,t.jsx(Hl,{className:"w-4 h-4"})),K("Зона входа",R.entryZone,t.jsx(ds,{className:"w-4 h-4"})),K("Цели",R.targets,t.jsx(rr,{className:"w-4 h-4"})),K("SL",R.stopLoss,t.jsx(vl,{className:"w-4 h-4"}));break;case"nft":K("Ссылка",R.nftLink,t.jsx(Ji,{className:"w-4 h-4"})),K("Сеть",R.network?String(R.network).toUpperCase():"",t.jsx(Mf,{className:"w-4 h-4"})),K("Редкость",R.rarity,t.jsx(ts,{className:"w-4 h-4"})),K("Цели",R.targets,t.jsx(rr,{className:"w-4 h-4"}));break;case"spot":K("Монета",R.coin,t.jsx(jr,{className:"w-4 h-4"})),K("Зона входа",R.entryZone,t.jsx(ds,{className:"w-4 h-4"})),K("Цели",R.targets,t.jsx(rr,{className:"w-4 h-4"})),K("SL",R.stopLoss,t.jsx(vl,{className:"w-4 h-4"})),K("Горизонт",R.holdingHorizon,t.jsx(vf,{className:"w-4 h-4"}));break;case"polymarket":K("Событие",R.event,t.jsx(Mi,{className:"w-4 h-4"})),K("Тип",R.positionType?R.positionType.toUpperCase():"",t.jsx(xt,{className:"w-4 h-4"})),K("Вход %",R.entryPrice,t.jsx(kl,{className:"w-4 h-4"})),K("Ожидание %",R.expectedProbability,t.jsx(Hl,{className:"w-4 h-4"})),K("Цель",R.targetPlan,t.jsx(rr,{className:"w-4 h-4"}));break;case"staking":K("Монета",R.coin,t.jsx(jr,{className:"w-4 h-4"})),K("Платформа",R.platform,t.jsx($u,{className:"w-4 h-4"})),K("Срок",R.term==="fixed"&&R.fixedTermCustom?R.fixedTermCustom:R.term==="flexible"?"Гибкий":R.term,t.jsx(ff,{className:"w-4 h-4"})),K("APY",R.apy,t.jsx(kl,{className:"w-4 h-4"})),K("Мин. депозит",R.minDeposit,t.jsx(jr,{className:"w-4 h-4"}));break;case"airdrop":K("Проект",R.projectName,t.jsx($u,{className:"w-4 h-4"})),K("Сеть",R.network?String(R.network).toUpperCase():"",t.jsx(Mu,{className:"w-4 h-4"})),K("Награда",R.rewardType,t.jsx(rr,{className:"w-4 h-4"})),K("Ценность",R.expectedValue,t.jsx(jr,{className:"w-4 h-4"})),K("Задачи",R.tasks,t.jsx(Mi,{className:"w-4 h-4"})),K("Дедлайн",R.deadline,t.jsx(an,{className:"w-4 h-4"}));break}const he=W.filter(H=>H.value);return he.length?t.jsxs("div",{className:`rounded-2xl border ${y} ${c==="dark"?"bg-gray-900/60":"bg-white"}`,children:[t.jsxs("div",{className:`flex items-center gap-2 px-4 py-3 border-b ${y} ${c==="dark"?"bg-white/5":"bg-gray-50"}`,children:[t.jsx("div",{className:`p-1.5 rounded-lg bg-gradient-to-br ${P} text-white`,children:t.jsx(ts,{className:"w-3.5 h-3.5"})}),t.jsx("p",{className:`text-sm font-semibold ${U}`,children:"Ключевые метрики"}),t.jsxs("span",{className:`ml-auto text-[11px] font-semibold px-3 py-1 rounded-full ${v0[S]}`,children:["Риск: ",S]})]}),t.jsx("div",{className:"divide-y divide-gray-200/70 dark:divide-white/10",children:he.map(H=>t.jsx("div",{className:"flex items-center justify-between gap-3 px-4 py-3",children:t.jsxs("div",{className:"flex items-start gap-3",children:[t.jsx("div",{className:`p-2 rounded-xl bg-gradient-to-br ${P} text-white`,children:H.icon}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("p",{className:`text-xs uppercase tracking-wide ${E}`,children:H.label}),t.jsx("p",{className:`${U} font-semibold whitespace-pre-wrap break-words`,children:H.value})]})]})},H.label))})]}):null},L=()=>{const q=D[M],R={[M]:q},S=g(q),P=w(q);return{id:"preview",userId:(d==null?void 0:d.id)||"unknown",category:M,details:R,createdAt:new Date().toISOString(),status:"active",tags:[],sentiment:S,riskLevel:P}},ee=()=>{T(!0)},te=async q=>{q.preventDefault(),x(""),m(!0);try{const R=D[M],S={...r==null?void 0:r.details,[M]:R},W={userId:(r==null?void 0:r.userId)||(d==null?void 0:d.id)||"unknown",category:M,details:S,createdAt:(r==null?void 0:r.createdAt)||new Date().toISOString(),status:(r==null?void 0:r.status)||"active",tags:(r==null?void 0:r.tags)||[]},K=g(R);K&&(W.sentiment=K);const he=w(R);he&&(W.riskLevel=he),(r==null?void 0:r.maxProfit)!==void 0&&(W.maxProfit=r.maxProfit),(r==null?void 0:r.currentPnL)!==void 0&&(W.currentPnL=r.currentPnL),(r==null?void 0:r.currentMarketCap)!==void 0&&(W.currentMarketCap=r.currentMarketCap),(r==null?void 0:r.signalMarketCap)!==void 0&&(W.signalMarketCap=r.signalMarketCap),(r==null?void 0:r.currentPrice)!==void 0&&(W.currentPrice=r.currentPrice),(r==null?void 0:r.entryPrice)!==void 0&&(W.entryPrice=r.entryPrice),r?await Tc(r.id,W):await g_(W),s==null||s()}catch(R){console.error("Error creating call:",R);const S=(R==null?void 0:R.message)||(R==null?void 0:R.code)||"Ошибка при сохранении сигнала";x(S)}finally{m(!1)}},Y=q=>{const S=(D[M]||{})[q.key],P=`w-full px-4 py-2.5 rounded-lg border ${y} ${c==="dark"?"bg-gray-800/80":"bg-gray-50"} ${U} focus:outline-none focus:ring-2 focus:ring-[#4E6E49] transition-all`;if(q.type==="textarea")return t.jsx("textarea",{value:S||"",onChange:W=>A(q.key,W.target.value),className:`${P} min-h-[100px] resize-y`,placeholder:q.placeholder});if(q.type==="select"&&q.options){const W=q.options.length<=3?"grid-cols-1 sm:grid-cols-3":q.options.length<=4?"grid-cols-2 sm:grid-cols-4":"grid-cols-2 sm:grid-cols-3",K=Zt(M,c);return t.jsx("div",{className:`grid ${W} gap-2 sm:gap-3`,children:q.options.map(he=>{const H=S===he.value;return t.jsx("button",{type:"button",onClick:()=>A(q.key,he.value),className:`px-3 py-3 sm:py-2.5 rounded-lg border-2 text-sm font-medium transition-all duration-300 min-h-[44px] sm:min-h-[40px] hover:shadow-md focus:outline-none focus:ring-2 focus:ring-[#4E6E49]/30 ${H?`bg-gradient-to-r ${K} text-white shadow-md border-transparent`:`${c==="dark"?"bg-gray-800 border-gray-700 text-gray-300 hover:bg-gray-700 hover:border-gray-600":"bg-white border-gray-200 text-gray-700 hover:bg-gray-50 hover:border-gray-400"}`}`,children:he.label},he.value)})})}return q.type==="checkbox"?t.jsxs("label",{className:"inline-flex items-center gap-3 cursor-pointer select-none p-3 sm:p-3 rounded-lg border transition-all duration-200 min-h-[48px] sm:min-h-[44px] hover:shadow-sm ${theme === 'dark' ? 'bg-gray-800/50 border-gray-700 hover:bg-gray-800' : 'bg-gray-50 border-gray-200 hover:bg-gray-100'}",children:[t.jsx("input",{type:"checkbox",checked:!!S,onChange:W=>A(q.key,W.target.checked),className:"accent-[#4E6E49] w-5 h-5 sm:w-4 sm:h-4"}),t.jsx("span",{className:`font-medium ${U} text-sm sm:text-base`,children:q.label})]}):t.jsxs("div",{className:"relative",children:[t.jsx("input",{type:"text",value:S||"",onChange:W=>A(q.key,W.target.value),className:P,placeholder:q.placeholder}),q.key==="contract"&&S&&t.jsx("button",{type:"button",onClick:()=>{navigator.clipboard.writeText(String(S))},className:`absolute right-2 top-1/2 -translate-y-1/2 p-2 rounded-lg transition-colors ${c==="dark"?"hover:bg-gray-700 text-gray-400":"hover:bg-gray-200 text-gray-500"}`,title:"Скопировать контракт",children:t.jsx(Ws,{className:"w-4 h-4"})})]})};return t.jsx(t.Fragment,{children:t.jsxs("form",{onSubmit:te,className:"space-y-5",children:[f&&t.jsxs("div",{className:`p-4 rounded-xl ${c==="dark"?"bg-red-900/30 border border-red-700/50 text-red-300":"bg-red-50 border border-red-200 text-red-800"} flex items-center gap-3 animate-in shake`,children:[t.jsx(nr,{className:"w-5 h-5 shrink-0"}),f]}),o&&t.jsxs("div",{className:`relative rounded-2xl border ${y} ${c==="dark"?"bg-gray-900/60":"bg-white"} p-5 overflow-hidden`,children:[t.jsx("div",{className:`absolute top-0 left-0 right-0 h-1 bg-gradient-to-r ${Zt(M,c)}`}),t.jsxs("div",{className:"flex items-center gap-3 mb-5",children:[t.jsx("div",{className:`w-11 h-11 rounded-xl flex items-center justify-center text-white shadow-lg bg-gradient-to-br ${Zt(M,c)}`,children:t.jsx(rr,{className:"w-5 h-5"})}),t.jsxs("div",{children:[t.jsx("p",{className:`text-lg font-bold ${U}`,children:"Тип сигнала"}),t.jsx("p",{className:`text-xs ${b}`,children:"Выберите категорию для вашего сигнала"})]})]}),t.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-2.5",children:Object.keys(la).map(q=>{const R=la[q],S=Zt(q,c),P=M===q;return t.jsxs("button",{type:"button",onClick:()=>V(q),className:`relative p-4 rounded-xl border-2 transition-all duration-300 group overflow-hidden ${P?`border-transparent shadow-lg shadow-${S.split(" ")[0].replace("from-","").split("-")[0]}-500/20 scale-[1.02]`:`border-gray-700 hover:border-gray-600 hover:shadow-lg hover:-translate-y-0.5 ${c==="dark"?"bg-gray-800/30":"bg-gray-50"}`}`,children:[P&&t.jsx("div",{className:`absolute inset-0 bg-gradient-to-br ${S} opacity-30 rounded-xl`}),!P&&c==="dark"&&t.jsx("div",{className:`absolute inset-0 bg-gradient-to-br ${S.replace("from-","from-").replace(" to-"," to-")} opacity-5 rounded-xl`}),t.jsxs("div",{className:"relative flex flex-col items-center gap-2.5 text-center",children:[t.jsx("div",{className:`w-12 h-12 rounded-xl flex items-center justify-center transition-all duration-300 ${P?`bg-gradient-to-br ${S} text-white shadow-md`:`${c==="dark"?"bg-gray-700/50 text-gray-400":"bg-gray-100 text-gray-500"} group-hover:${c==="dark"?"bg-gray-600":"bg-gray-200"}`}`,children:t.jsx("div",{className:"w-5 h-5",children:R.icon})}),t.jsxs("div",{className:"w-full",children:[t.jsx("span",{className:`text-sm font-bold block transition-colors ${P?`bg-gradient-to-r ${S} bg-clip-text text-transparent`:U}`,children:R.label}),P&&t.jsx("span",{className:`text-[10px] bg-gradient-to-r ${S} bg-clip-text text-transparent font-medium`,children:"Выбрано"})]})]})]},q)})})]}),t.jsxs("div",{className:`relative rounded-2xl border ${y} ${c==="dark"?"bg-gray-900/60":"bg-white"} p-5 overflow-hidden`,children:[t.jsx("div",{className:`absolute top-0 left-0 right-0 h-1 bg-gradient-to-r ${Zt(M,c)}`}),t.jsx("div",{className:`absolute top-0 right-0 w-32 h-32 bg-gradient-to-bl ${Zt(M,c).replace("from-","").replace(" to-","/10 to-")} to-transparent rounded-full blur-2xl opacity-30`}),t.jsx("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4 mb-6 relative",children:t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:`w-11 h-11 rounded-xl flex items-center justify-center text-white shadow-lg bg-gradient-to-br ${Zt(M,c)}`,children:t.jsx(Mi,{className:"w-5 h-5"})}),t.jsxs("div",{children:[t.jsx("p",{className:`text-lg font-bold ${U}`,children:la[M].label}),t.jsx("p",{className:`text-xs ${b}`,children:"Заполните детали сигнала"})]})]})}),t.jsx("div",{className:"space-y-6",children:Object.entries(O_[M]).map(([q,R])=>{const S=V_[M].filter(P=>P.section===q);return S.length===0?null:t.jsxs("div",{className:"relative space-y-4",children:[t.jsxs("div",{className:"flex items-center gap-3 pb-3 border-b border-gray-200/50 dark:border-gray-700/50",children:[t.jsx("div",{className:`p-2 rounded-lg bg-gradient-to-br ${Zt(M,c)} text-white`,children:R.icon}),t.jsxs("div",{className:"flex-1",children:[t.jsx("h3",{className:`text-base font-bold ${U}`,children:R.title}),R.description&&t.jsx("p",{className:`text-xs ${b}`,children:R.description})]}),t.jsx("div",{className:`h-px flex-1 bg-gradient-to-r from-transparent ${Zt(M,c).replace("from-","via-")} to-transparent opacity-20`})]}),t.jsx("div",{className:"grid grid-cols-1 gap-4",children:S.map(P=>t.jsxs("div",{className:"space-y-2",children:[P.type!=="checkbox"&&t.jsxs("label",{className:`text-sm font-semibold ${U} flex items-center gap-2`,children:[P.label,P.required&&t.jsx("span",{className:"text-red-500",children:"*"})]}),Y(P)]},P.key))})]},q)})}),t.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 mt-8 pt-6 border-t border-gray-200/50 dark:border-gray-700/50",children:[t.jsxs("button",{type:"button",onClick:ee,className:`px-5 py-3.5 rounded-xl font-semibold border-2 transition-all duration-300 flex items-center justify-center gap-2 ${y} ${c==="dark"?"text-white hover:bg-gray-800 hover:border-gray-600":"text-gray-700 hover:bg-gray-50 hover:border-gray-400"} hover:shadow-lg active:scale-[0.98]`,children:[t.jsx(Wa,{className:"w-4 h-4"}),t.jsx("span",{children:"Предпросмотр"})]}),t.jsx("button",{type:"submit",disabled:u,className:`flex-1 py-3.5 rounded-xl font-bold transition-all duration-300 flex items-center justify-center gap-2 shadow-lg ${u?"bg-gray-400 text-gray-200 cursor-not-allowed":`bg-gradient-to-r ${Zt(M,c)} text-white hover:shadow-xl hover:scale-[1.01] active:scale-[0.98]`}`,children:u?t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"}),t.jsx("span",{children:"Сохранение..."})]}):r?t.jsxs(t.Fragment,{children:[t.jsx(Zr,{className:"w-4 h-4"}),t.jsx("span",{children:"Обновить сигнал"})]}):t.jsxs(t.Fragment,{children:[t.jsx(Lr,{className:"w-4 h-4"}),t.jsx("span",{children:"Создать сигнал"})]})}),e&&t.jsx("button",{type:"button",onClick:e,className:`px-5 py-3.5 rounded-xl font-semibold border-2 transition-all duration-300 ${y} ${c==="dark"?"text-gray-300 hover:bg-gray-800 hover:text-white":"text-gray-600 hover:bg-gray-100 hover:text-gray-900"} hover:shadow-lg active:scale-[0.98]`,children:"Отмена"})]})]}),v&&(()=>{const q=L(),R=Ge.find(S=>S.id===q.userId);return t.jsxs("div",{className:"fixed inset-0 bg-black/70 backdrop-blur-xl z-[80] flex items-start sm:items-center justify-center p-4 overflow-y-auto",children:[t.jsxs("div",{className:"fixed inset-0 overflow-hidden pointer-events-none",children:[t.jsx("div",{className:"absolute top-1/4 left-1/4 w-96 h-96 bg-emerald-500/10 rounded-full blur-3xl animate-pulse"}),t.jsx("div",{className:"absolute bottom-1/4 right-1/4 w-96 h-96 bg-cyan-500/10 rounded-full blur-3xl animate-pulse",style:{animationDelay:"1s"}})]}),t.jsxs("div",{className:`relative ${j} rounded-3xl shadow-2xl shadow-black/50 border ${y} max-w-2xl w-full max-h-[90vh] overflow-hidden animate-in zoom-in-95 duration-300`,children:[t.jsx("div",{className:`h-2 bg-gradient-to-r ${Zt(M,c)}`}),t.jsxs("div",{className:"p-6 flex items-center justify-between sticky top-0 z-10 ${bgColor} border-b ${borderColor}",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:`w-10 h-10 rounded-xl bg-gradient-to-br ${Zt(M,c)} flex items-center justify-center text-white shadow-lg`,children:t.jsx(Wa,{className:"w-5 h-5"})}),t.jsxs("div",{children:[t.jsx("h2",{className:`text-xl font-bold ${U}`,children:"Предпросмотр"}),t.jsx("p",{className:`text-xs ${b}`,children:"Проверьте сигнал перед публикацией"})]})]}),t.jsx("button",{onClick:()=>T(!1),className:`p-2 rounded-xl transition-all ${c==="dark"?"hover:bg-gray-800 text-gray-400 hover:text-white":"hover:bg-gray-100 text-gray-500 hover:text-gray-900"}`,children:t.jsx(pt,{className:"w-5 h-5"})})]}),t.jsxs("div",{className:"px-6 pb-6 pt-4 overflow-y-auto max-h-[calc(90vh-100px)]",children:[t.jsxs("div",{className:`relative rounded-2xl border-2 overflow-hidden mb-6 ${w0[M].border} ${w0[M].bg}`,children:[t.jsx("div",{className:"absolute top-0 right-0 w-32 h-32 bg-gradient-to-bl from-white/5 to-transparent rounded-full blur-xl"}),t.jsx("div",{className:"absolute bottom-0 left-0 w-24 h-24 bg-gradient-to-tr from-emerald-500/5 to-transparent rounded-full blur-xl"}),t.jsxs("div",{className:`relative px-5 py-4 flex flex-wrap items-center justify-between gap-3 border-b ${c==="dark"?"border-white/10 bg-white/5":"border-white/70 bg-white/70"}`,children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:`p-1.5 rounded-lg bg-gradient-to-br ${Zt(M,c)} text-white`,children:la[M].icon}),t.jsx("span",{className:`text-sm font-bold ${U}`,children:la[M].label})]}),t.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[t.jsx("span",{className:"px-3 py-1.5 rounded-full text-xs font-bold bg-emerald-500/15 text-emerald-500 border border-emerald-500/30",children:"Активен"}),t.jsxs("span",{className:`px-3 py-1.5 rounded-full text-xs font-semibold ${v0[q.riskLevel||"medium"]}`,children:["Риск: ",q.riskLevel||"medium"]})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("span",{className:`px-3 py-1.5 rounded-lg text-xs font-medium ${c==="dark"?"bg-gray-800/70 text-gray-300 border border-white/10":"bg-gray-100 text-gray-600 border-gray-200"}`,children:"Только что"}),R&&t.jsxs("div",{className:"flex items-center gap-2 px-2 py-1 rounded-lg border border-white/10 bg-black/5 dark:bg-white/5",children:[R.avatar?t.jsx("img",{src:R.avatar,className:"w-7 h-7 rounded-full object-cover",alt:R.name}):t.jsx("div",{className:"w-7 h-7 rounded-full bg-gradient-to-r from-[#4E6E49] to-emerald-600 text-white flex items-center justify-center text-xs font-bold",children:R.name[0]}),t.jsx("span",{className:`text-xs font-medium ${E}`,children:R.name})]})]})]}),t.jsx("div",{className:"relative p-5 space-y-5",children:$(q)})]}),t.jsxs("div",{className:"flex gap-3",children:[t.jsxs("button",{type:"button",onClick:()=>T(!1),className:`flex-1 px-4 py-3.5 rounded-xl font-semibold border-2 transition-all duration-300 flex items-center justify-center gap-2 shadow-lg ${u?"bg-gray-400 text-gray-200 cursor-not-allowed":`bg-gradient-to-r ${Zt(M,c)} text-white hover:shadow-xl`}`,children:[t.jsx(pt,{className:"w-4 h-4"}),"Назад"]}),t.jsxs("button",{type:"button",onClick:()=>{T(!1);const S=document.querySelector("form");S==null||S.requestSubmit()},disabled:u,className:`flex-1 py-3.5 rounded-xl font-bold transition-all duration-300 flex items-center justify-center gap-2 shadow-lg ${u?"bg-gray-400 text-gray-200 cursor-not-allowed":`bg-gradient-to-r ${Zt(M,c)} text-white hover:shadow-xl`}`,children:[t.jsx(Zr,{className:"w-4 h-4"}),"Опубликовать"]})]})]})]})]})})()]})})},Bl=({value:s,onChange:e,options:r,placeholder:a="Select...",searchable:n=!1,icon:i})=>{const{theme:o}=Re(),[c,d]=k.useState(!1),[u,m]=k.useState(""),f=k.useRef(null),x=r.find(T=>T.value===s);k.useEffect(()=>{const T=I=>{f.current&&!f.current.contains(I.target)&&d(!1)};return document.addEventListener("mousedown",T),()=>document.removeEventListener("mousedown",T)},[]);const v=r.filter(T=>T.label.toLowerCase().includes(u.toLowerCase())||T.meta&&T.meta.toLowerCase().includes(u.toLowerCase()));return t.jsxs("div",{className:"relative min-w-[180px]",ref:f,children:[t.jsxs("button",{onClick:()=>d(!c),className:`w-full flex items-center justify-between gap-3 px-4 py-2.5 rounded-xl border transition-all ${o==="dark"?"bg-[#151a21] border-white/5 text-gray-300 hover:border-emerald-500/30":"bg-white border-gray-200 text-gray-700 hover:border-emerald-500"}`,children:[t.jsxs("div",{className:"flex items-center gap-2.5 overflow-hidden",children:[i&&t.jsx("div",{className:x?"text-emerald-500":"text-gray-500",children:i}),x?t.jsxs("div",{className:"flex items-center gap-2",children:[x.icon&&t.jsx("div",{className:"flex items-center justify-center",children:x.icon}),t.jsx("span",{className:"text-sm font-bold truncate",children:x.label})]}):t.jsx("span",{className:"text-sm font-semibold text-gray-500",children:a})]}),t.jsx(Dr,{size:16,className:`text-gray-500 transition-transform ${c?"rotate-180":""}`})]}),c&&t.jsxs("div",{className:`absolute z-50 top-full mt-2 w-full min-w-[200px] rounded-2xl border shadow-2xl overflow-hidden animate-in fade-in slide-in-from-top-2 duration-200 ${o==="dark"?"bg-[#1a1f26] border-white/10":"bg-white border-gray-200"}`,children:[n&&t.jsx("div",{className:"p-3 border-b border-white/5",children:t.jsxs("div",{className:"relative",children:[t.jsx(es,{size:14,className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-500"}),t.jsx("input",{type:"text",placeholder:"Поиск...",value:u,onChange:T=>m(T.target.value),className:`w-full pl-9 pr-8 py-2 rounded-lg text-xs font-medium outline-none transition-all ${o==="dark"?"bg-black/20 text-gray-300 focus:bg-black/40":"bg-gray-100 text-gray-700 focus:bg-gray-200"}`,autoFocus:!0}),u&&t.jsx("button",{onClick:()=>m(""),className:"absolute right-2 top-1/2 -translate-y-1/2 p-1 hover:text-rose-500",children:t.jsx(pt,{size:12})})]})}),t.jsxs("div",{className:"max-h-[300px] overflow-y-auto p-1.5 custom-scrollbar",children:[v.map(T=>t.jsxs("button",{onClick:()=>{e(T.value),d(!1)},className:`w-full flex items-center justify-between gap-3 px-3 py-2 rounded-lg transition-all text-left ${T.value===s?o==="dark"?"bg-emerald-500/10 text-emerald-400":"bg-emerald-50 text-emerald-600":o==="dark"?"hover:bg-white/5 text-gray-300":"hover:bg-gray-50 text-gray-700"}`,children:[t.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[T.icon&&t.jsx("div",{className:`w-6 h-6 rounded-full flex items-center justify-center text-[10px] ${T.chip||(o==="dark"?"bg-white/5":"bg-gray-100")}`,children:T.icon}),t.jsxs("div",{className:"flex flex-col min-w-0",children:[t.jsx("span",{className:"text-xs font-bold truncate",children:T.label}),T.meta&&t.jsx("span",{className:"text-[9px] opacity-50 truncate",children:T.meta})]})]}),T.value===s&&t.jsx(Zr,{size:14})]},T.value)),v.length===0&&t.jsx("div",{className:"p-4 text-center",children:t.jsx("p",{className:"text-[10px] text-gray-500",children:"Ничего не найдено"})})]})]})]})},ea=()=>{const[s,e]=k.useState([]),[r,a]=k.useState(!0),[n,i]=k.useState(null);return k.useEffect(()=>{(async()=>{try{a(!0);const c=await qd(),d=new Map;Ge.forEach(u=>{d.set(u.id,u)}),c.forEach(u=>{d.set(u.id,u)}),e(Array.from(d.values())),i(null)}catch(c){console.error("Error loading users:",c),i(c instanceof Error?c:new Error("Unknown error")),e(Ge)}finally{a(!1)}})()},[]),{users:s,loading:r,error:n}},So="modal-open";let Fn=0;const F_=()=>{typeof document>"u"||(Fn===0&&(document.body.classList.add(So),document.documentElement.classList.add(So)),Fn+=1)},U_=()=>{typeof document>"u"||(Fn=Math.max(Fn-1,0),Fn===0&&(document.body.classList.remove(So),document.documentElement.classList.remove(So)))},ns=(s=!0)=>{const[e,r]=k.useState(!1),a=k.useCallback(()=>{F_(),r(!0)},[]),n=k.useCallback(()=>{U_(),r(!1)},[]);return k.useEffect(()=>{if(s)return a(),()=>{n()}},[s,a,n]),{lockScroll:a,unlockScroll:n,isLocked:e}},N0=["memecoins","polymarket","nft","staking","spot","futures","airdrop"],aa={memecoins:{label:"Мемкоины",gradient:"from-emerald-400 via-teal-500 to-cyan-400",gradientDark:"from-emerald-500 via-teal-600 to-cyan-500",chip:"bg-emerald-500/10 text-emerald-400",icon:t.jsx(Lr,{className:"w-5 h-5 text-white"}),cardGradient:"from-emerald-500/20 via-teal-400/10 to-cyan-500/5"},futures:{label:"Фьючерсы",gradient:"from-blue-400 to-indigo-500",gradientDark:"from-blue-600 to-indigo-500",chip:"bg-blue-500/10 text-blue-600",icon:t.jsx(ka,{className:"w-5 h-5 text-white"}),cardGradient:"from-blue-500/20 via-indigo-500/10 to-transparent"},nft:{label:"NFT",gradient:"from-purple-400 to-pink-500",gradientDark:"from-purple-600 to-pink-500",chip:"bg-purple-500/10 text-purple-600",icon:t.jsx(_s,{className:"w-5 h-5 text-white"}),cardGradient:"from-purple-500/20 via-pink-500/10 to-transparent"},spot:{label:"Спот",gradient:"from-amber-400 to-orange-500",gradientDark:"from-amber-600 to-orange-500",chip:"bg-amber-500/10 text-amber-600",icon:t.jsx(jr,{className:"w-5 h-5 text-white"}),cardGradient:"from-amber-500/20 via-orange-500/10 to-transparent"},airdrop:{label:"AirDrop",gradient:"from-gray-300 to-gray-400",gradientDark:"from-gray-400 to-gray-300",chip:"bg-gray-500/10 text-gray-600",icon:t.jsx(ts,{className:"w-5 h-5 text-white"}),cardGradient:"from-gray-500/20 via-gray-400/10 to-transparent"},polymarket:{label:"Polymarket",gradient:"from-rose-400 to-red-500",gradientDark:"from-rose-600 to-red-500",chip:"bg-rose-500/10 text-rose-600",icon:t.jsx(Hl,{className:"w-5 h-5 text-white"}),cardGradient:"from-rose-500/20 via-red-500/10 to-transparent"},staking:{label:"Стейкинг",gradient:"from-emerald-400 to-green-500",gradientDark:"from-emerald-600 to-green-500",chip:"bg-emerald-500/10 text-emerald-600",icon:t.jsx(xt,{className:"w-5 h-5 text-white"}),cardGradient:"from-emerald-500/20 via-green-500/10 to-transparent"}},En={low:"bg-emerald-500/10 text-emerald-600 border border-emerald-500/20",medium:"bg-blue-500/10 text-blue-600 border border-blue-500/20",high:"bg-amber-500/10 text-amber-600 border border-amber-500/20",ultra:"bg-red-500/10 text-red-600 border border-red-500/20"},B_={low:"Low Risk",medium:"Medium Risk",high:"High Risk",ultra:"Ultra Risk"},z_=()=>{const{theme:s}=Re(),{user:e}=ot(),r=(e==null?void 0:e.id)==="1",[a,n]=k.useState([]),[i,o]=k.useState(!0),[c,d]=k.useState(!1),[u,m]=k.useState(!1),[f,x]=k.useState(null),[v,T]=k.useState(null),[I,N]=k.useState(null),[O,D]=k.useState("memecoins"),[C,M]=k.useState(!0),[V,U]=k.useState(""),[y]=k.useState("all"),[b,E]=k.useState("all"),[j,A]=k.useState("all"),[w,g]=k.useState("all");ns(c||u||!!v),k.useEffect(()=>{$()},[]);const $=async()=>{o(!0);try{const F=await p_();n(F)}catch(F){console.error("Error loading calls:",F),n([])}finally{o(!1)}},L=s==="dark"?"text-white":"text-gray-900",ee=s==="dark"?"bg-[#0a0a0a]":"bg-white",te=s==="dark"?"text-gray-400":"text-gray-600",Y=s==="dark"?"border-white/10":"border-gray-100",q=s==="dark"?"bg-white/5 backdrop-blur-md":"bg-white",R=()=>{d(!1),N(null),$()},S=()=>{d(!1),N(null)},P=async(F,B)=>{try{await Tc(F,{status:B}),await $()}catch(Ne){console.error("Error updating status:",Ne),alert("Ошибка при обновлении статуса")}},W=F=>{N(F),D(F.category),d(!0)},K=F=>{x(F),m(!0)},he=async()=>{if(f)try{await x_(f),m(!1),x(null),$()}catch(F){console.error("Error deleting call:",F),alert("Ошибка при удалении сигнала")}},H=async()=>{if(v)try{await Tc(v,{status:"cancelled"}),T(null),$()}catch(F){console.error("Error cancelling call:",F),alert("Ошибка при отмене сигнала")}},me=F=>{var B;return((B=F.details)==null?void 0:B[F.category])||{}},G=F=>{const B=me(F);switch(F.category){case"memecoins":return B.contract?`${B.contract.slice(0,6)}...${B.contract.slice(-4)}`:"Мемкоин";case"futures":return B.pair||"Фьючерс";case"nft":return B.collectionLink||"NFT коллекция";case"spot":return B.coin||"Спот";case"polymarket":return B.event||"Polymarket событие";case"staking":return B.coin||"Стейкинг";case"airdrop":return B.projectName||"AirDrop";default:return"Сигнал"}},se=F=>F.riskLevel||me(F).riskLevel||me(F).protocolRisk||"medium",Z=F=>{const B=me(F);return[F.category,F.status,F.comment,B.contract,B.pair,B.reason,B.targets,B.event,B.marketplace,B.platform,B.entryCap,B.entryZone,B.network].filter(Boolean).join(" ").toLowerCase()},ne=a.filter(F=>y!=="all"&&F.status!==y||b!=="all"&&F.category!==b||j!=="all"&&se(F)!==j||w!=="all"&&F.userId!==w?!1:V.trim()?Z(F).includes(V.toLowerCase()):!0),ie=k.useMemo(()=>({total:a.length,active:a.filter(F=>F.status==="active").length,completed:a.filter(F=>F.status==="completed").length,cancelled:a.filter(F=>F.status==="cancelled").length}),[a]),Ce=[{value:"all",label:"Все сферы",icon:t.jsx(Ms,{size:14})},...N0.map(F=>({value:F,label:aa[F].label,icon:aa[F].icon,chip:aa[F].chip}))],je=[{value:"all",label:"Любой риск",icon:t.jsx(Bn,{size:14})},{value:"low",label:"Low Risk",icon:t.jsx(xt,{size:14}),chip:En.low},{value:"medium",label:"Medium Risk",icon:t.jsx(xt,{size:14}),chip:En.medium},{value:"high",label:"High Risk",icon:t.jsx(nr,{size:14}),chip:En.high},{value:"ultra",label:"Ultra Risk",icon:t.jsx(Ar,{size:14}),chip:En.ultra}],{users:le}=ea(),ue=[{value:"all",label:"Все трейдеры",icon:t.jsx(Pr,{size:16})},...le.map(F=>({value:F.id,label:F.name,meta:F.login,icon:F.avatar?t.jsx("img",{src:F.avatar,className:"w-full h-full object-cover rounded-full"}):t.jsx(Pr,{size:10})}))];return t.jsxs("div",{className:"space-y-6 pb-20",children:[t.jsx("div",{className:"sm:hidden px-4 py-4 border-b",style:{borderColor:s==="dark"?"rgba(255,255,255,0.1)":"rgba(0,0,0,0.1)"},children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center gap-2.5",children:[t.jsx(Ms,{className:"w-7 h-7 text-emerald-500"}),t.jsx("h1",{className:`text-xl font-bold ${L}`,children:"AVF HUB"})]}),t.jsxs("button",{onClick:()=>{N(null),D("memecoins"),M(!0),d(!0)},className:"flex items-center gap-1.5 px-4 py-2 rounded-lg font-bold text-white shadow-lg transition-all hover:scale-105 active:scale-95 bg-emerald-500 hover:bg-emerald-600",children:[t.jsx(mr,{size:16}),t.jsx("span",{children:"Call"})]})]})}),t.jsx("div",{className:"hidden sm:block px-4 sm:px-6 lg:px-8 py-6",children:t.jsxs("div",{className:"flex flex-row items-center justify-between gap-4 mb-2",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(Ms,{className:"w-8 h-8 text-emerald-500"}),t.jsx("h1",{className:`text-3xl font-bold ${L}`,children:"AVF HUB"})]}),t.jsxs("button",{onClick:()=>{N(null),D("memecoins"),M(!0),d(!0)},className:"flex items-center gap-2 px-6 py-2.5 rounded-xl font-bold text-white shadow-lg transition-all hover:scale-105 active:scale-95 bg-emerald-500 hover:bg-emerald-600",children:[t.jsx(mr,{size:18}),t.jsx("span",{children:"Call"})]})]})}),t.jsxs("div",{className:"px-4 sm:px-6 lg:px-8 mb-6",children:[t.jsx("div",{className:"mb-3",children:t.jsx("h3",{className:`text-sm font-semibold ${te}`,children:"Создать сигнал"})}),t.jsx("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-2",children:N0.map(F=>{const B=aa[F],Ne=s==="dark"?B.gradientDark:B.gradient,Te={memecoins:"border-emerald-500/40",futures:"border-blue-500/40",nft:"border-purple-500/40",spot:"border-amber-500/40",airdrop:"border-gray-500/40",polymarket:"border-rose-500/40",staking:"border-emerald-500/40"},pe={memecoins:"from-emerald-500/15 via-teal-500/5 to-cyan-500/5",futures:"from-blue-500/15 via-indigo-500/5 to-transparent",nft:"from-purple-500/15 via-pink-500/5 to-transparent",spot:"from-amber-500/15 via-orange-500/5 to-transparent",airdrop:"from-gray-400/15 via-gray-300/5 to-transparent",polymarket:"from-rose-500/15 via-red-500/5 to-transparent",staking:"from-emerald-500/15 via-green-500/5 to-transparent"};return t.jsxs("button",{onClick:()=>{N(null),D(F),M(!1),d(!0)},className:`flex items-center gap-3 px-4 py-3 rounded-lg border ${Te[F]} bg-gradient-to-br ${pe[F]} transition-all hover:scale-[1.02]`,children:[t.jsx("div",{className:`w-10 h-10 rounded-lg flex items-center justify-center bg-gradient-to-br ${Ne} text-white shadow-md shrink-0`,children:B.icon}),t.jsx("span",{className:`text-sm font-medium truncate ${L}`,children:B.label})]},F)})})]}),t.jsx("div",{className:"px-4 sm:px-6 lg:px-8 mb-6",children:t.jsxs("div",{className:`relative rounded-xl border ${Y} ${q} shadow-xl`,children:[t.jsx(es,{className:`absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 ${te}`}),t.jsx("input",{type:"text",value:V,onChange:F=>U(F.target.value),placeholder:"Поиск по тикеру, событию, сети или причине...",className:`w-full pl-12 pr-4 py-3 bg-transparent ${L} placeholder:${te} focus:outline-none`})]})}),t.jsx("div",{className:"px-4 sm:px-6 lg:px-8 mb-6",children:t.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[t.jsx("div",{className:"w-full sm:w-auto min-w-[200px]",children:t.jsx(Bl,{value:b,onChange:F=>E(F),options:Ce,placeholder:"Все сферы",icon:t.jsx(Ms,{size:16})})}),t.jsx("div",{className:"w-full sm:w-auto min-w-[180px]",children:t.jsx(Bl,{value:j,onChange:F=>A(F),options:je,placeholder:"Любой риск",icon:t.jsx(Bn,{size:16})})}),t.jsx("div",{className:"w-full sm:w-auto min-w-[220px]",children:t.jsx(Bl,{value:w,onChange:F=>g(F),options:ue,placeholder:"Все трейдеры",searchable:!0,icon:t.jsx(Pr,{size:16})})})]})}),t.jsx("div",{className:"px-4 sm:px-6 lg:px-8 mb-4",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("h2",{className:`text-xl font-bold ${L}`,children:"Лента сигналов"}),t.jsxs("p",{className:`text-sm ${te}`,children:["Показано ",ne.length," из ",ie.active," активных"]})]})}),t.jsx("div",{className:"px-4 sm:px-6 lg:px-8",children:i?t.jsxs("div",{className:"text-center py-12",children:[t.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-4 border-emerald-500 border-t-transparent mx-auto mb-4"}),t.jsx("p",{className:te,children:"Загрузка сигналов..."})]}):ne.length===0?t.jsxs("div",{className:"text-center py-12",children:[t.jsx(ts,{className:`w-16 h-16 mx-auto mb-4 ${te}`}),t.jsx("p",{className:`text-xl font-bold ${L} mb-2`,children:"Нет сигналов"}),t.jsx("p",{className:te,children:"Попробуйте изменить фильтры"})]}):t.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:ne.map(F=>{const B=aa[F.category],Ne=me(F),Te=se(F),pe=le.find(De=>De.id===F.userId);return t.jsx("div",{className:`p-4 rounded-xl border ${Y} ${q} shadow-lg hover:shadow-xl transition-all group`,children:t.jsxs("div",{className:`flex items-start justify-between gap-4 ${F.status!=="active"?"opacity-60":""}`,children:[t.jsxs("div",{className:"flex items-start gap-3 flex-1",children:[t.jsx("div",{className:`p-2.5 rounded-xl bg-gradient-to-br ${B.gradient} bg-opacity-10 text-white shrink-0`,children:B.icon}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-1 flex-wrap",children:[t.jsx("h3",{className:`font-bold ${L} truncate`,children:G(F)}),t.jsx("span",{className:`px-2 py-0.5 rounded text-[10px] font-bold uppercase tracking-wider ${En[Te]}`,children:B_[Te]}),t.jsx("span",{className:`px-2 py-0.5 rounded text-[10px] font-medium border ${Y} ${te}`,children:B.label}),F.status==="completed"&&t.jsxs("span",{className:"flex items-center gap-1 text-[10px] font-bold uppercase tracking-wider bg-emerald-500/10 text-emerald-500 px-2 py-0.5 rounded-full",children:[t.jsx(Ir,{className:"w-3 h-3"}),"Завершен"]}),F.status==="cancelled"&&t.jsxs("span",{className:"flex items-center gap-1 text-[10px] font-bold uppercase tracking-wider bg-rose-500/10 text-rose-500 px-2 py-0.5 rounded-full",children:[t.jsx(Os,{className:"w-3 h-3"}),"Отменен"]})]}),t.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-y-2 gap-x-6 mt-3 max-w-3xl",children:[Ne.entryPrice&&t.jsxs("div",{className:"flex flex-col",children:[t.jsx("span",{className:`text-[10px] uppercase font-bold tracking-wider ${te} mb-0.5`,children:"Вход"}),t.jsx("span",{className:`text-sm font-medium ${L}`,children:Ne.entryPrice})]}),Ne.targets&&t.jsxs("div",{className:"flex flex-col",children:[t.jsx("span",{className:`text-[10px] uppercase font-bold tracking-wider ${te} mb-0.5`,children:"Цель"}),t.jsx("span",{className:"text-sm font-medium text-emerald-500",children:Ne.targets})]}),Ne.stopLoss&&t.jsxs("div",{className:"flex flex-col",children:[t.jsx("span",{className:`text-[10px] uppercase font-bold tracking-wider ${te} mb-0.5`,children:"Стоп"}),t.jsx("span",{className:"text-sm font-medium text-rose-500",children:Ne.stopLoss})]}),pe&&t.jsxs("div",{className:"flex flex-col",children:[t.jsx("span",{className:`text-[10px] uppercase font-bold tracking-wider ${te} mb-0.5`,children:"Автор"}),t.jsxs("div",{className:"flex items-center gap-1.5",children:[pe.avatar?t.jsx("img",{src:pe.avatar,className:"w-4 h-4 rounded-full object-cover"}):t.jsx("div",{className:"w-4 h-4 rounded-full bg-emerald-500 text-[8px] flex items-center justify-center text-white",children:pe.name[0]}),t.jsx("span",{className:`text-sm font-medium ${L}`,children:pe.name})]})]})]})]})]}),t.jsxs("div",{className:"flex items-center gap-1 sm:gap-2 opacity-100 sm:opacity-0 sm:group-hover:opacity-100 transition-opacity",children:[t.jsx("button",{onClick:()=>{const De=`🚀 ${B.label}: ${G(F)}
`+(Ne.entryPrice?`📍 Вход: ${Ne.entryPrice}
`:"")+(Ne.targets?`🎯 Цели: ${Ne.targets}
`:"")+(Ne.stopLoss?`🛑 Стоп: ${Ne.stopLoss}
`:"")+(Ne.contract?`📝 CA: ${Ne.contract}
`:"")+(Ne.link?`🔗 Ссылка: ${Ne.link}
`:"")+`👤 Трейдер: ${(pe==null?void 0:pe.name)||"Admin"}`;navigator.clipboard.writeText(De)},className:`p-2 rounded-lg transition-colors ${s==="dark"?"hover:bg-emerald-500/20 text-emerald-400 hover:text-emerald-300":"hover:bg-emerald-50 text-emerald-600 hover:text-emerald-700"}`,title:"Копировать сигнал",children:t.jsx(Ws,{className:"w-4 h-4"})}),(r||(e==null?void 0:e.id)===F.userId)&&F.status==="active"&&t.jsxs(t.Fragment,{children:[t.jsx("button",{onClick:()=>P(F.id,"completed"),className:`p-2 rounded-lg transition-colors ${s==="dark"?"hover:bg-emerald-500/20 text-emerald-400":"hover:bg-emerald-50 text-emerald-600"}`,title:"Завершить (Цели достигнуты)",children:t.jsx(Ir,{className:"w-4 h-4"})}),t.jsx("button",{onClick:()=>P(F.id,"cancelled"),className:`p-2 rounded-lg transition-colors ${s==="dark"?"hover:bg-rose-500/20 text-rose-400":"hover:bg-rose-50 text-rose-600"}`,title:"Отменить сигнал",children:t.jsx(Os,{className:"w-4 h-4"})})]}),(r||(e==null?void 0:e.id)===F.userId)&&F.status!=="active"&&t.jsx("button",{onClick:()=>P(F.id,"active"),className:`p-2 rounded-lg transition-colors ${s==="dark"?"hover:bg-blue-500/20 text-blue-400":"hover:bg-blue-50 text-blue-600"}`,title:"Вернуть в работу",children:t.jsx(Sf,{className:"w-4 h-4"})}),(r||(e==null?void 0:e.id)===F.userId)&&t.jsx("button",{onClick:()=>W(F),className:`p-2 rounded-lg transition-colors ${s==="dark"?"hover:bg-white/10 text-gray-400 hover:text-white":"hover:bg-gray-100 text-gray-500 hover:text-gray-900"}`,title:"Редактировать",children:t.jsx(ar,{className:"w-4 h-4"})}),r&&t.jsx("button",{onClick:()=>K(F.id),className:`p-2 rounded-lg transition-colors ${s==="dark"?"hover:bg-red-500/20 text-red-400":"hover:bg-red-50 text-red-600"}`,title:"Удалить",children:t.jsx(Et,{className:"w-4 h-4"})})]})]})},F.id)})})}),c&&t.jsxs("div",{className:"fixed inset-0 bg-black/70 backdrop-blur-xl z-[70] flex items-start sm:items-center justify-center p-4 overflow-y-auto",children:[t.jsxs("div",{className:"fixed inset-0 overflow-hidden pointer-events-none",children:[t.jsx("div",{className:"absolute top-1/4 left-1/4 w-96 h-96 bg-emerald-500/5 rounded-full blur-3xl animate-pulse"}),t.jsx("div",{className:"absolute bottom-1/4 right-1/4 w-96 h-96 bg-teal-500/5 rounded-full blur-3xl animate-pulse",style:{animationDelay:"0.5s"}})]}),t.jsxs("div",{className:`relative ${ee} rounded-3xl shadow-2xl shadow-black/50 border ${Y} max-w-4xl w-full max-h-[90vh] overflow-hidden animate-in zoom-in-95 duration-300`,children:[t.jsx("div",{className:`h-1.5 transition-all duration-300 ${O==="memecoins"?"bg-gradient-to-r from-teal-400 via-cyan-500 to-emerald-400":O==="polymarket"?"bg-gradient-to-r from-rose-500 via-red-500 to-orange-500":O==="nft"?"bg-gradient-to-r from-purple-500 via-pink-500 to-rose-500":O==="futures"?"bg-gradient-to-r from-blue-500 via-indigo-500 to-cyan-500":O==="spot"?"bg-gradient-to-r from-amber-500 via-orange-500 to-yellow-500":O==="staking"?"bg-gradient-to-r from-emerald-500 via-green-500 to-emerald-400":"bg-gradient-to-r from-gray-400 via-gray-300 to-gray-200"}`}),t.jsxs("div",{className:"flex flex-col h-full",children:[t.jsxs("div",{className:`p-5 flex items-center justify-between sticky top-0 z-20 ${ee} border-b ${Y}`,children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:`w-10 h-10 rounded-xl flex items-center justify-center text-white shadow-lg transition-all duration-300 ${O==="memecoins"?"bg-gradient-to-br from-teal-400 to-emerald-500 shadow-teal-400/30":O==="polymarket"?"bg-gradient-to-br from-rose-500 to-red-600 shadow-rose-500/30":O==="nft"?"bg-gradient-to-br from-purple-500 to-pink-600 shadow-purple-500/30":O==="futures"?"bg-gradient-to-br from-blue-500 to-indigo-600 shadow-blue-500/30":O==="spot"?"bg-gradient-to-br from-amber-500 to-orange-600 shadow-amber-500/30":O==="staking"?"bg-gradient-to-br from-emerald-500 to-green-600 shadow-emerald-500/30":"bg-gradient-to-br from-gray-400 to-gray-300 shadow-gray-400/30"}`,children:aa[O].icon}),t.jsxs("div",{children:[t.jsx("h2",{className:`text-xl font-bold ${L}`,children:I?"Редактировать сигнал":"Новый сигнал"}),t.jsx("p",{className:`text-xs ${te}`,children:I?"Измените данные сигнала":`Создайте сигнал: ${aa[O].label}`})]})]}),t.jsx("button",{onClick:S,className:`p-2.5 rounded-xl transition-all duration-200 ${s==="dark"?"hover:bg-gray-800 text-gray-400 hover:text-white":"hover:bg-gray-100 text-gray-500 hover:text-gray-900"}`,children:t.jsx(pt,{className:"w-5 h-5"})})]}),t.jsx("div",{className:"px-6 pb-6 pt-4 overflow-y-auto flex-1 max-h-[calc(90vh-80px)]",children:t.jsx(L_,{callToEdit:I,onSuccess:R,onCancel:S,initialCategory:O,category:O,onCategoryChange:D,showCategorySelector:C})})]})]})]}),u&&t.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-[70] flex items-start sm:items-center justify-center p-4 overflow-y-auto overscroll-contain",children:t.jsx("div",{className:`${ee} rounded-2xl shadow-2xl border ${Y} max-w-md w-full animate-in zoom-in-95 duration-200`,children:t.jsxs("div",{className:"p-6 space-y-4",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"p-3 rounded-full bg-red-500/10 text-red-500",children:t.jsx(nr,{className:"w-6 h-6"})}),t.jsxs("div",{children:[t.jsx("h3",{className:`text-xl font-bold ${L}`,children:"Удалить сигнал?"}),t.jsx("p",{className:te,children:"Это действие нельзя отменить"})]})]}),t.jsxs("div",{className:"flex gap-3 pt-2",children:[t.jsx("button",{onClick:()=>{m(!1),x(null)},className:`flex-1 px-4 py-3 rounded-xl border ${Y} font-medium ${s==="dark"?"text-white hover:bg-white/5":"text-gray-800 hover:bg-gray-50"}`,children:"Отмена"}),t.jsx("button",{onClick:he,className:"flex-1 px-4 py-3 rounded-xl bg-red-600 text-white font-bold hover:bg-red-700 shadow-lg shadow-red-600/20",children:"Удалить"})]})]})})}),v&&t.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-[70] flex items-start sm:items-center justify-center p-4 overflow-y-auto overscroll-contain",children:t.jsx("div",{className:`${ee} rounded-2xl shadow-2xl border ${Y} max-w-md w-full`,children:t.jsxs("div",{className:"p-6 space-y-4",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"p-3 rounded-full bg-amber-500/10 text-amber-500",children:t.jsx(nr,{className:"w-6 h-6"})}),t.jsxs("div",{children:[t.jsx("h3",{className:`text-xl font-bold ${L}`,children:"Отменить сигнал?"}),t.jsx("p",{className:te,children:"Статус станет «Отменен», запись останется в списке."})]})]}),t.jsxs("div",{className:"flex gap-3 pt-2",children:[t.jsx("button",{onClick:()=>T(null),className:`flex-1 px-4 py-3 rounded-xl border ${Y} font-medium ${s==="dark"?"text-white hover:bg-white/5":"text-gray-800 hover:bg-gray-50"}`,children:"Отмена"}),t.jsx("button",{onClick:H,className:"flex-1 px-4 py-3 rounded-xl bg-amber-500 text-white font-bold hover:bg-amber-600 shadow-lg shadow-amber-500/20",children:"Отменить"})]})]})})})]})},q_=Zn()(ei(s=>({selectedDate:null,selectedWeekStart:null,viewMode:"table",setSelectedDate:e=>{s({selectedDate:e})},setSelectedWeekStart:e=>{s({selectedWeekStart:e})},setViewMode:e=>{s({viewMode:e})},resetDate:()=>{s({selectedDate:null,selectedWeekStart:null})}}),{name:"schedule-date-storage"})),ys=({userId:s,className:e="",fallback:r="unknown",formatter:a})=>{const i=el(s)||r;return t.jsx("span",{className:e,children:a?a(i):i})},W_=({selectedUserId:s,slotFilter:e,onEditSlot:r,onEditStatus:a,refreshKey:n,initialWeekStart:i,onDateChange:o})=>{const{theme:c}=Re(),{user:d}=ot(),{isAdmin:u}=ft(),m=["truancy","absence","internship"],[f,x]=k.useState([]),[v,T]=k.useState([]),[I,N]=k.useState(()=>i?new Date(i):new Date),[O,D]=k.useState(!0),[C,M]=k.useState({}),V=oe(new Date,"yyyy-MM-dd"),U=_o(I),y=s?Ge.filter(S=>S.id===s):Ge;k.useEffect(()=>{i&&N(new Date(i))},[i]),k.useEffect(()=>{b()},[s,I,n]),k.useEffect(()=>{const S=()=>{b(!0)};return window.addEventListener("focus",S),()=>window.removeEventListener("focus",S)},[]);const b=async(S=!1)=>{S||D(!0);try{const P=new Date(U[0]);P.setHours(0,0,0,0);const W=new Date(U[6]);W.setHours(23,59,59,999);const K=oe(P,"yyyy-MM-dd"),he=oe(W,"yyyy-MM-dd"),[H,me]=await Promise.all([Gr(),mn()]),G=H.filter(ie=>ie.date>=K&&ie.date<=he),se=me.filter(ie=>{const Ce=ie.date,je=ie.endDate||ie.date;return Ce<=he&&je>=K}),Z=s?G.filter(ie=>ie.userId===s):G,ne=s?se.filter(ie=>ie.userId===s):se;x(Z),T(ne)}catch(P){console.error("Error loading data:",P)}finally{S||D(!1)}},E=async S=>{if(!u&&(d==null?void 0:d.id)!==S.userId){alert("Только администратор может удалять чужие слоты");return}if(u){confirm("Удалить слот?")&&(await rl(S.id),b());return}confirm("Отправить на согласование удаление слота?")&&(await $t({entity:"slot",action:"delete",authorId:(d==null?void 0:d.id)||S.userId,targetUserId:S.userId,before:S,after:null,comment:S.comment}),b())},j=async(S,P)=>{if(["truancy","absence","internship"].includes(S.type)){if(!u){alert("Только администратор может удалять этот тип статуса");return}}else if(!u&&(d==null?void 0:d.id)!==S.userId){alert("Только администратор может удалять чужие статусы");return}if(S.endDate&&P){const K=S.date,he=S.endDate;if(P===K){if(confirm(u?"Удалить первый день диапазона?":"Отправить на согласование удаление первого дня диапазона?")){const H=new Date(K+"T00:00:00");H.setDate(H.getDate()+1);const me=oe(H,"yyyy-MM-dd");u?await qs(S.id,{...S,date:me}):await $t({entity:"status",action:"update",authorId:(d==null?void 0:d.id)||S.userId,targetUserId:S.userId,before:S,after:{...S,date:me},comment:S.comment}),b()}return}if(P===he){if(confirm(u?"Удалить последний день диапазона?":"Отправить на согласование удаление последнего дня диапазона?")){const H=new Date(he+"T00:00:00");H.setDate(H.getDate()-1);const me=oe(H,"yyyy-MM-dd");u?await qs(S.id,{...S,endDate:me}):await $t({entity:"status",action:"update",authorId:(d==null?void 0:d.id)||S.userId,targetUserId:S.userId,before:S,after:{...S,endDate:me},comment:S.comment}),b()}return}if(P>K&&P<he){if(confirm(u?"Удалить этот день? Диапазон будет разбит на две части.":"Отправить на согласование удаление этого дня? Диапазон будет разбит на две части.")){const H=new Date(P+"T00:00:00");H.setDate(H.getDate()-1);const me=oe(H,"yyyy-MM-dd");if(u){await qs(S.id,{...S,endDate:me});const G=new Date(P+"T00:00:00");G.setDate(G.getDate()+1);const se=oe(G,"yyyy-MM-dd");await sl({userId:S.userId,date:se,endDate:he,type:S.type,comment:S.comment})}else{await $t({entity:"status",action:"update",authorId:(d==null?void 0:d.id)||S.userId,targetUserId:S.userId,before:S,after:{...S,endDate:me},comment:S.comment});const G=new Date(P+"T00:00:00");G.setDate(G.getDate()+1);const se=oe(G,"yyyy-MM-dd");await $t({entity:"status",action:"create",authorId:(d==null?void 0:d.id)||S.userId,targetUserId:S.userId,before:null,after:{id:"",userId:S.userId,date:se,endDate:he,type:S.type,comment:S.comment},comment:S.comment})}b()}return}}u?confirm("Удалить статус?")&&(await al(S.id),b()):confirm("Отправить на согласование удаление статуса?")&&(await $t({entity:"status",action:"delete",authorId:(d==null?void 0:d.id)||S.userId,targetUserId:S.userId,before:S,after:null,comment:S.comment}),b())},A=S=>{const P=bs(),W=new Date(P);W.setHours(0,0,0,0);const K=new Date(S.date);if(K.setHours(0,0,0,0),K>W)return!0;if(K.getTime()===W.getTime()){const G=bs(),se=G.getHours()*60+G.getMinutes();return S.slots.some(Z=>{if(Z.endDate){const je=new Date(Z.endDate);if(je.setHours(0,0,0,0),new Date(W).setHours(23,59,59),je>W)return!0;if(je.getTime()===W.getTime()){const[ue,F]=Z.end.split(":").map(Number);return ue*60+F>se}return!1}const[ne,ie]=Z.end.split(":").map(Number);return ne*60+ie>se})}const he=bs(),H=he.getHours()*60+he.getMinutes();return S.slots.some(G=>{if(G.endDate){const se=new Date(G.endDate);if(se.setHours(0,0,0,0),se>W)return!0;if(se.getTime()===W.getTime()){const[Z,ne]=G.end.split(":").map(Number);return Z*60+ne>H}return!1}return!1})},w=(S,P)=>{const W=f.find(K=>K.userId===S&&K.date===P)||null;if(W&&e!=="all"){const K=A(W);if(e==="upcoming"&&!K||e==="completed"&&K)return null}return W},g=(S,P)=>v.find(W=>W.userId!==S?!1:W.endDate?W.date<=P&&W.endDate>=P:W.date===P)||null,$=S=>{const{start:P,end:W}=hn(I),K=oe(P,"yyyy-MM-dd"),he=oe(W,"yyyy-MM-dd"),me=f.filter(ne=>ne.userId===S).filter(ne=>ne.date>=K&&ne.date<=he),G=me.reduce((ne,ie)=>ne+tl(ie.slots),0),Z=me.reduce((ne,ie)=>ne+ie.slots.reduce((Ce,je)=>je.breaks&&je.breaks.length>0?Ce+je.breaks.reduce((le,ue)=>{const[F,B]=ue.start.split(":").map(Number),[Ne,Te]=ue.end.split(":").map(Number);return le+(Ne*60+Te)-(F*60+B)},0):Ce,0),0)/60;return{totalHours:G,totalBreakHours:Z}},L=S=>{const P=new Date(I);if(S==="prev"?P.setDate(P.getDate()-7):P.setDate(P.getDate()+7),N(P),o){const W=_o(P),K=oe(W[0],"yyyy-MM-dd");o(null,K)}},ee=S=>{M(P=>({...P,[S]:!P[S]}))};if(O)return t.jsx("div",{className:`rounded-lg p-8 text-center ${c==="dark"?"bg-[#1a1a1a]":"bg-white"}`,children:t.jsx("p",{className:c==="dark"?"text-gray-400":"text-gray-600",children:"Загрузка..."})});const te=c==="dark"?"text-white":"text-gray-900",Y=c==="dark"?"text-gray-400":"text-gray-500",q={dayoff:{label:"Выходной",tone:"bg-green-500/10 text-green-500 border border-green-500/20"},sick:{label:"Больничный",tone:"bg-purple-500/10 text-purple-500 border border-purple-500/20"},vacation:{label:"Отпуск",tone:"bg-blue-500/10 text-blue-500 border border-blue-500/20"},absence:{label:"Отсутствие",tone:"bg-orange-500/10 text-orange-500 border border-orange-500/20"},truancy:{label:"Прогул",tone:"bg-red-500/10 text-red-500 border border-red-500/20"},internship:{label:"Стажировка",tone:"bg-yellow-500/10 text-yellow-500 border border-yellow-500/20"}},R={memecoins:{bg:"bg-emerald-100 dark:bg-emerald-900/40",text:"text-emerald-700 dark:text-emerald-300",border:"border-emerald-300 dark:border-emerald-700"},futures:{bg:"bg-blue-100 dark:bg-blue-900/40",text:"text-blue-700 dark:text-blue-300",border:"border-blue-300 dark:border-blue-700"},nft:{bg:"bg-purple-100 dark:bg-purple-900/40",text:"text-purple-700 dark:text-purple-300",border:"border-purple-300 dark:border-purple-700"},spot:{bg:"bg-amber-100 dark:bg-amber-900/40",text:"text-amber-700 dark:text-amber-300",border:"border-amber-300 dark:border-amber-700"},airdrop:{bg:"bg-cyan-100 dark:bg-cyan-900/40",text:"text-cyan-700 dark:text-cyan-300",border:"border-cyan-300 dark:border-cyan-700"},polymarket:{bg:"bg-pink-100 dark:bg-pink-900/40",text:"text-pink-700 dark:text-pink-300",border:"border-pink-300 dark:border-pink-700"},staking:{bg:"bg-indigo-100 dark:bg-indigo-900/40",text:"text-indigo-700 dark:text-indigo-300",border:"border-indigo-300 dark:border-indigo-700"}};return t.jsxs("div",{className:`rounded-2xl ${c==="dark"?"bg-[#0b1015]":"bg-white"} overflow-visible`,children:[t.jsxs("div",{className:`p-4 border-b ${c==="dark"?"border-white/5":"border-gray-100"} flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between`,children:[t.jsxs("div",{className:"flex flex-wrap items-center gap-2 sm:gap-3",children:[t.jsx("button",{onClick:()=>L("prev"),className:`p-1.5 sm:p-2 rounded-xl border transition-all ${c==="dark"?"bg-white/5 border-white/10 hover:bg-white/10 text-white":"bg-white border-gray-200 hover:bg-gray-50 text-gray-900 shadow-sm"}`,children:t.jsx(z0,{className:"w-4 h-4 sm:w-5 sm:h-5 text-purple-500"})}),t.jsxs("button",{onClick:()=>{const S=new Date,P=ko(S,{weekStartsOn:1}),W=No(S,"yyyy-MM-dd"),K=No(P,"yyyy-MM-dd");N(P),o&&o(W,K)},className:`flex items-center gap-1.5 px-3 py-2 rounded-xl border text-xs sm:text-sm font-semibold transition-all ${c==="dark"?"bg-white/5 border-white/10 hover:bg-white/10 text-white":"bg-white border-gray-200 hover:bg-gray-50 text-gray-900 shadow-sm"}`,title:"Вернуться к текущей неделе",children:[t.jsx(Z0,{className:"w-3.5 h-3.5 text-purple-500"}),t.jsx("span",{className:"hidden sm:inline",children:"Актуальная неделя"})]}),t.jsx("button",{onClick:()=>L("next"),className:`p-1.5 sm:p-2 rounded-xl border transition-all ${c==="dark"?"bg-white/5 border-white/10 hover:bg-white/10 text-white":"bg-white border-gray-200 hover:bg-gray-50 text-gray-900 shadow-sm"}`,children:t.jsx(Qi,{className:"w-4 h-4 sm:w-5 sm:h-5 text-purple-500"})})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(ir,{className:`w-5 h-5 ${c==="dark"?"text-emerald-500":"text-emerald-600"}`}),t.jsxs("span",{className:`${te} font-black text-lg tracking-tight`,children:[oe(U[0],"d MMMM")," — ",oe(U[6],"d MMMM yyyy")]})]}),t.jsx("div",{className:"w-full sm:w-auto flex justify-end sm:justify-start"})]}),t.jsx("div",{className:"overflow-x-auto",children:t.jsx("div",{className:"min-w-full inline-block align-middle",children:t.jsxs("table",{className:"w-full border-collapse",children:[t.jsx("thead",{className:"sticky top-0 z-30",children:t.jsxs("tr",{className:`${c==="dark"?"bg-[#0b1015]":"bg-white"}`,children:[t.jsx("th",{className:`p-3 text-left text-[10px] font-bold uppercase tracking-wider ${Y} sticky left-0 z-30 ${c==="dark"?"bg-[#0b1015]":"bg-white"}`,children:"Участник"}),U.map(S=>{const P=oe(S,"yyyy-MM-dd")===V;return t.jsx("th",{className:"p-1 min-w-[100px] lg:min-w-[120px]",children:t.jsxs("div",{className:`mx-auto w-full p-1.5 rounded-xl border transition-colors ${P?"bg-emerald-500/10 border-emerald-500/50 text-emerald-500":c==="dark"?"bg-[#151a21] border-white/5 text-gray-400":"bg-gray-50 border-gray-100 text-gray-500"}`,children:[t.jsx("div",{className:"text-[9px] uppercase font-bold opacity-70 mb-0.5",children:oe(S,"EEE")}),t.jsx("div",{className:"text-xs font-black",children:oe(S,"dd.MM")})]})},S.toISOString())}),t.jsx("th",{className:`p-3 text-center text-[10px] font-bold uppercase tracking-wider ${Y} min-w-[110px]`,children:"Итоги"})]})}),t.jsx("tbody",{className:`divide-y ${c==="dark"?"divide-white/5":"divide-gray-100"}`,children:y.map((S,P)=>{const W=$(S.id),K=P%2===0?c==="dark"?"bg-[#0f141a]":"bg-gray-50/30":"transparent";return t.jsxs("tr",{className:`${K} hover:bg-emerald-500/5 transition-colors group`,children:[t.jsx("td",{className:`p-2 sticky left-0 z-20 ${K} group-hover:bg-[#1a2029] transition-colors align-middle`,children:t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsxs("div",{className:"relative",children:[S.avatar?t.jsx("img",{src:S.avatar,alt:S.name||S.id,className:"w-8 h-8 rounded-full object-cover border border-emerald-500/20 shadow-sm",onError:he=>{const H=he.target;H.style.display="none";const me=H.nextElementSibling;me&&(me.style.display="flex")}}):null,t.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center font-bold text-xs ${c==="dark"?"bg-[#1f2937] text-gray-300":"bg-gray-200 text-gray-600"} ${S.avatar?"absolute inset-0 hidden":""}`,children:t.jsx(ys,{userId:S.id,formatter:he=>he.charAt(0).toUpperCase()})})]}),t.jsxs("div",{children:[t.jsx("div",{className:`font-bold text-[13px] leading-tight ${te}`,children:t.jsx(ys,{userId:S.id})}),t.jsx("div",{className:"text-[9px] text-gray-500 font-medium uppercase tracking-tight",children:"Member"})]})]})}),U.map(he=>{var se,Z;const H=oe(he,"yyyy-MM-dd"),me=w(S.id,H),G=g(S.id,H);return t.jsx("td",{className:"p-1.5 align-middle",children:me?t.jsx("div",{className:"flex flex-col items-center gap-1.5",children:me.slots.map((ne,ie)=>{var le,ue,F,B;const Ce=`${me.id}-${ie}`,je=C[Ce];return t.jsxs("div",{className:"w-full flex flex-col items-center gap-1.5 group/timecard",children:[t.jsxs("div",{className:`w-full max-w-[120px] rounded-xl p-2 text-[10px] font-bold transition-all relative shadow-md ${c==="dark"?"bg-[#1a1f26] border border-white/5 text-gray-200":"bg-gray-100 text-gray-700"}`,children:[t.jsxs("div",{className:"flex flex-col items-center gap-1.5 w-full",children:[t.jsxs("div",{className:"flex items-center gap-1 opacity-80 justify-center",children:[t.jsx(Lt,{className:"w-3 h-3 flex-shrink-0"}),t.jsxs("span",{className:"whitespace-nowrap tracking-tight",children:[ne.start," - ",ne.end]})]}),t.jsxs("div",{className:"flex items-center gap-1 flex-wrap justify-center",children:[me.category&&t.jsx("span",{className:`text-[9px] px-1.5 py-0.5 rounded-full border font-medium truncate ${((le=R[me.category])==null?void 0:le.bg)||"bg-gray-100 dark:bg-gray-800"} ${((ue=R[me.category])==null?void 0:ue.text)||"text-gray-700 dark:text-gray-300"} ${((F=R[me.category])==null?void 0:F.border)||"border-gray-300 dark:border-gray-600"}`,children:((B=us[me.category])==null?void 0:B.label)||me.category}),me.comment&&t.jsxs("div",{className:"relative group",children:[t.jsx(Wt,{className:"w-3 h-3 text-white/60 hover:text-white cursor-help flex-shrink-0"}),t.jsxs("div",{className:"absolute left-1/2 -translate-x-1/2 bottom-full mb-1 px-3 py-2 bg-gray-900 text-white text-[10px] rounded-lg max-w-xs whitespace-normal break-words opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all z-50 shadow-lg border border-white/10",children:[me.comment,t.jsx("div",{className:"absolute left-1/2 -translate-x-1/2 top-full border-3 border-transparent border-t-gray-900"})]})]})]}),ne.breaks&&ne.breaks.length>0&&t.jsx("button",{onClick:()=>ee(Ce),className:"p-0.5 hover:bg-white/10 rounded-md transition-colors w-full flex justify-center",children:je?t.jsx(ti,{className:"w-3 h-3"}):t.jsx(Dr,{className:"w-3 h-3"})})]}),je&&ne.breaks&&ne.breaks.length>0&&t.jsx("div",{className:"mt-1.5 pt-1.5 border-t border-white/10 space-y-0.5 w-full text-center",children:ne.breaks.map((Ne,Te)=>t.jsxs("div",{className:"text-[9px] opacity-70 font-medium",children:[Ne.start," - ",Ne.end]},Te))})]}),t.jsxs("div",{className:"flex items-center gap-2 opacity-0 group-hover/timecard:opacity-100 transition-opacity duration-200",children:[t.jsx("button",{onClick:()=>r(me),className:`transition-all hover:scale-110 ${c==="dark"?"text-blue-400 hover:text-blue-300":"text-blue-600 hover:text-blue-500"}`,children:t.jsx(ar,{className:"w-3.5 h-3.5"})}),t.jsx("button",{onClick:()=>E(me),className:`transition-all hover:scale-110 ${c==="dark"?"text-rose-500 hover:text-rose-400":"text-rose-600 hover:text-rose-500"}`,children:t.jsx(Et,{className:"w-3.5 h-3.5"})})]})]},ie)})}):G?t.jsxs("div",{className:"flex flex-col items-center gap-1.5 group/status",children:[t.jsxs("div",{className:`w-full max-w-[120px] rounded-lg p-2 text-[10px] font-black text-center border shadow-sm flex items-center justify-center gap-1 ${c==="dark"?"bg-[#2A3441]/40":"bg-white"} ${((se=q[G.type])==null?void 0:se.tone)||""}`,children:[t.jsx("span",{children:((Z=q[G.type])==null?void 0:Z.label)||G.type}),G.comment&&t.jsxs("div",{className:"relative group/stat",children:[t.jsx(Wt,{className:"w-3 h-3 opacity-60 hover:opacity-100 cursor-help"}),t.jsxs("div",{className:"absolute left-1/2 -translate-x-1/2 bottom-full mb-1 px-3 py-2 bg-gray-900 text-white text-[10px] rounded-lg max-w-xs whitespace-normal break-words opacity-0 invisible group-hover/stat:opacity-100 group-hover/stat:visible transition-all z-50 shadow-lg border border-white/10",children:[G.comment,t.jsx("div",{className:"absolute left-1/2 -translate-x-1/2 top-full border-3 border-transparent border-t-gray-900"})]})]})]}),t.jsx("div",{className:"flex items-center gap-2 opacity-0 group-hover/status:opacity-100 transition-opacity duration-200",children:u&&m.includes(G.type)?t.jsxs(t.Fragment,{children:[t.jsx("button",{onClick:()=>a(G),className:`transition-all hover:scale-110 ${c==="dark"?"text-blue-400 hover:text-blue-300":"text-blue-600 hover:text-blue-500"}`,title:"Редактировать (только для админа)",children:t.jsx(ar,{className:"w-3.5 h-3.5"})}),t.jsx("button",{onClick:()=>j(G,H),className:`transition-all hover:scale-110 ${c==="dark"?"text-rose-500 hover:text-rose-400":"text-rose-600 hover:text-rose-500"}`,title:"Удалить (только для админа)",children:t.jsx(Et,{className:"w-3.5 h-3.5"})})]}):u||(S==null?void 0:S.id)===G.userId?t.jsxs(t.Fragment,{children:[t.jsx("button",{onClick:()=>a(G),className:`transition-all hover:scale-110 ${c==="dark"?"text-blue-400 hover:text-blue-300":"text-blue-600 hover:text-blue-500"}`,children:t.jsx(ar,{className:"w-3.5 h-3.5"})}),t.jsx("button",{onClick:()=>j(G,H),className:`transition-all hover:scale-110 ${c==="dark"?"text-rose-500 hover:text-rose-400":"text-rose-600 hover:text-rose-500"}`,children:t.jsx(Et,{className:"w-3.5 h-3.5"})})]}):null})]}):t.jsx("div",{className:"h-8 w-full max-w-[120px] mx-auto rounded-lg border border-dashed border-gray-700/20 dark:border-white/5 opacity-20"})},H)}),t.jsx("td",{className:"p-2 align-middle",children:t.jsxs("div",{className:"space-y-1 py-1 min-w-[110px] text-center ml-2",children:[t.jsxs("div",{className:`text-[12px] font-medium leading-tight ${te}`,children:["Часов: ",W.totalHours.toFixed(1)]}),t.jsxs("div",{className:`text-[12px] font-medium leading-tight ${te}`,children:["Перерывов: ",W.totalBreakHours.toFixed(1)," ч"]})]})})]},S.id)})})]})})})]})},H_=({selectedUserId:s,slotFilter:e,onEditSlot:r,onEditStatus:a,refreshKey:n,initialWeekStart:i,onDateChange:o})=>{const{theme:c}=Re(),{user:d}=ot(),{isAdmin:u}=ft(),{users:m}=ea(),f=["truancy","absence","internship"],[x,v]=k.useState([]),[T,I]=k.useState([]),[N,O]=k.useState(()=>i?new Date(i):new Date),[D,C]=k.useState(!0),[M,V]=k.useState({}),U={artyom:"1",adel:"2",kseniya:"3",olga:"4",anastasia:"5"},y=S=>{const P=m.find(W=>W.id===S)||m.find(W=>U[S]===W.id);return{member:P,displayName:yr((P==null?void 0:P.id)||S)}},b=_o(N),E=new Date;k.useEffect(()=>{i&&O(new Date(i))},[i]),k.useEffect(()=>{j()},[s,N,n]),k.useEffect(()=>{const S=()=>{j(!0)};return window.addEventListener("focus",S),()=>window.removeEventListener("focus",S)},[]);const j=async(S=!1)=>{S||C(!0);try{const P=new Date(b[0]);P.setHours(0,0,0,0);const W=new Date(b[6]);W.setHours(23,59,59,999);const K=oe(P,"yyyy-MM-dd"),he=oe(W,"yyyy-MM-dd"),[H,me]=await Promise.all([Gr(),mn()]),G=H.filter(ie=>ie.date>=K&&ie.date<=he),se=me.filter(ie=>{const Ce=ie.date,je=ie.endDate||ie.date;return Ce<=he&&je>=K}),Z=s?G.filter(ie=>ie.userId===s):G,ne=s?se.filter(ie=>ie.userId===s):se;console.log("Loaded slots (week view):",{weekStart:K,weekEnd:he,allSlotsCount:H.length,weekSlotsCount:G.length,filteredSlotsCount:Z.length,selectedUserId:s}),v(Z),I(ne)}catch(P){console.error("Error loading data:",P)}finally{S||C(!1)}},A=async S=>{if(!u&&(d==null?void 0:d.id)!==S.userId){alert("Только администратор может удалять чужие слоты");return}if(u){confirm("Удалить слот?")&&(await rl(S.id),await new Promise(P=>setTimeout(P,100)),await j());return}confirm("Отправить на согласование удаление слота?")&&(await $t({entity:"slot",action:"delete",authorId:(d==null?void 0:d.id)||S.userId,targetUserId:S.userId,before:S,after:null,comment:S.comment}),await j())},w=async(S,P)=>{if(f.includes(S.type)){if(!u){alert("Только администратор может удалять этот тип статуса");return}}else if(!u&&(d==null?void 0:d.id)!==S.userId){alert("Только администратор может удалять чужие статусы");return}if(S.endDate&&P){const W=S.date,K=S.endDate;if(P===W){if(confirm(u?"Удалить первый день диапазона?":"Отправить на согласование удаление первого дня диапазона?")){const he=new Date(kr(W));he.setDate(he.getDate()+1);const H=oe(he,"yyyy-MM-dd");u?await qs(S.id,{...S,date:H}):await $t({entity:"status",action:"update",authorId:(d==null?void 0:d.id)||S.userId,targetUserId:S.userId,before:S,after:{...S,date:H},comment:S.comment}),j()}return}if(P===K){if(confirm(u?"Удалить последний день диапазона?":"Отправить на согласование удаление последнего дня диапазона?")){const he=new Date(kr(K));he.setDate(he.getDate()-1);const H=oe(he,"yyyy-MM-dd");u?await qs(S.id,{...S,endDate:H}):await $t({entity:"status",action:"update",authorId:(d==null?void 0:d.id)||S.userId,targetUserId:S.userId,before:S,after:{...S,endDate:H},comment:S.comment}),j()}return}if(P>W&&P<K){if(confirm(u?"Удалить этот день? Диапазон будет разбит на две части.":"Отправить на согласование удаление этого дня? Диапазон будет разбит на две части.")){const he=new Date(kr(P));he.setDate(he.getDate()-1);const H=oe(he,"yyyy-MM-dd");if(u){await qs(S.id,{...S,endDate:H});const me=new Date(kr(P));me.setDate(me.getDate()+1);const G=oe(me,"yyyy-MM-dd");await sl({userId:S.userId,date:G,endDate:K,type:S.type,comment:S.comment})}else{await $t({entity:"status",action:"update",authorId:(d==null?void 0:d.id)||S.userId,targetUserId:S.userId,before:S,after:{...S,endDate:H},comment:S.comment});const me=new Date(kr(P));me.setDate(me.getDate()+1);const G=oe(me,"yyyy-MM-dd");await $t({entity:"status",action:"create",authorId:(d==null?void 0:d.id)||S.userId,targetUserId:S.userId,before:null,after:{id:"",userId:S.userId,date:G,endDate:K,type:S.type,comment:S.comment},comment:S.comment})}j()}return}}u?confirm("Удалить статус?")&&(await al(S.id),await new Promise(W=>setTimeout(W,100)),await j()):confirm("Отправить на согласование удаление статуса?")&&(await $t({entity:"status",action:"delete",authorId:(d==null?void 0:d.id)||S.userId,targetUserId:S.userId,before:S,after:null,comment:S.comment}),await j())},g=S=>{const P=bs(),W=new Date(P);W.setHours(0,0,0,0);const K=new Date(S.date);if(K.setHours(0,0,0,0),K>W)return!0;if(K.getTime()===W.getTime()){const G=bs(),se=G.getHours()*60+G.getMinutes();return S.slots.some(Z=>{if(Z.endDate){const je=new Date(Z.endDate);if(je.setHours(0,0,0,0),new Date(W).setHours(23,59,59),je>W)return!0;if(je.getTime()===W.getTime()){const[ue,F]=Z.end.split(":").map(Number);return ue*60+F>se}return!1}const[ne,ie]=Z.end.split(":").map(Number);return ne*60+ie>se})}const he=bs(),H=he.getHours()*60+he.getMinutes();return S.slots.some(G=>{if(G.endDate){const se=new Date(G.endDate);if(se.setHours(0,0,0,0),se>W)return!0;if(se.getTime()===W.getTime()){const[Z,ne]=G.end.split(":").map(Number);return Z*60+ne>H}return!1}return!1})},$=S=>{let P=x.filter(W=>W.date===S);return e!=="all"&&(P=P.filter(W=>{const K=g(W);return e==="upcoming"?K:e==="completed"?!K:!0})),P},L=S=>T.filter(P=>P.endDate?P.date<=S&&P.endDate>=S:P.date===S),ee=S=>{const P=new Date(N);S==="prev"?P.setDate(P.getDate()-7):P.setDate(P.getDate()+7),O(P);const W=ko(P,{weekStartsOn:1});o==null||o(null,oe(W,"yyyy-MM-dd"))},te=S=>{V(P=>({...P,[S]:!P[S]}))};if(D)return t.jsx("div",{className:`rounded-lg p-8 text-center ${c==="dark"?"bg-[#1a1a1a]":"bg-white"} `,children:t.jsx("p",{className:c==="dark"?"text-gray-400":"text-gray-600",children:"Загрузка..."})});const Y=c==="dark"?"text-white":"text-gray-900",q={dayoff:{label:"Выходной",tone:"bg-green-500/10 text-green-500 border border-green-500/20"},sick:{label:"Больничный",tone:"bg-purple-500/10 text-purple-500 border border-purple-500/20"},vacation:{label:"Отпуск",tone:"bg-blue-500/10 text-blue-500 border border-blue-500/20"},absence:{label:"Отсутствие",tone:"bg-orange-500/10 text-orange-500 border border-orange-500/20"},truancy:{label:"Прогул",tone:"bg-red-500/10 text-red-500 border border-red-500/20"},internship:{label:"Стажировка",tone:"bg-yellow-500/10 text-yellow-500 border border-yellow-500/20"},working:{label:"Рабочий",tone:"bg-emerald-500/10 text-emerald-500 border border-emerald-500/20"},weekend:{label:"Выходной",tone:"bg-green-500/10 text-green-500 border border-green-500/20"}},R={memecoins:{bg:"bg-emerald-100 dark:bg-emerald-900/40",text:"text-emerald-700 dark:text-emerald-300",border:"border-emerald-300 dark:border-emerald-700"},futures:{bg:"bg-blue-100 dark:bg-blue-900/40",text:"text-blue-700 dark:text-blue-300",border:"border-blue-300 dark:border-blue-700"},nft:{bg:"bg-purple-100 dark:bg-purple-900/40",text:"text-purple-700 dark:text-purple-300",border:"border-purple-300 dark:border-purple-700"},spot:{bg:"bg-amber-100 dark:bg-amber-900/40",text:"text-amber-700 dark:text-amber-300",border:"border-amber-300 dark:border-amber-700"},airdrop:{bg:"bg-cyan-100 dark:bg-cyan-900/40",text:"text-cyan-700 dark:text-cyan-300",border:"border-cyan-300 dark:border-cyan-700"},polymarket:{bg:"bg-pink-100 dark:bg-pink-900/40",text:"text-pink-700 dark:text-pink-300",border:"border-pink-300 dark:border-pink-700"},staking:{bg:"bg-indigo-100 dark:bg-indigo-900/40",text:"text-indigo-700 dark:text-indigo-300",border:"border-indigo-300 dark:border-indigo-700"}};return t.jsxs("div",{className:`rounded-2xl ${c==="dark"?"bg-transparent":"bg-white"} overflow-visible`,children:[t.jsxs("div",{className:`p-3 sm: p-4 border-b ${c==="dark"?"border-white/5":"border-gray-100"} flex flex-col gap-2 sm: gap-3 sm: flex-row sm: items-center sm: justify-between`,children:[t.jsxs("div",{className:"flex flex-wrap items-center gap-2 sm:gap-3",children:[t.jsx("button",{onClick:()=>ee("prev"),className:`p-1.5 sm: p-2 rounded-xl border transition - all ${c==="dark"?"bg-white/5 border-white/10 hover:bg-white/10 text-white":"bg-white border-gray-200 hover:bg-gray-50 text-gray-900 shadow-sm"} `,children:t.jsx(z0,{className:"w-4 h-4 sm:w-5 sm:h-5 text-purple-500"})}),t.jsxs("button",{onClick:()=>{const P=ko(new Date,{weekStartsOn:1});O(P),o==null||o(null,oe(P,"yyyy-MM-dd"))},className:`flex items-center gap-1.5 px-3 py-2 rounded-xl border text-xs sm: text-sm font-semibold transition - all ${c==="dark"?"bg-white/5 border-white/10 hover:bg-white/10 text-white":"bg-white border-gray-200 hover:bg-gray-50 text-gray-900 shadow-sm"} `,title:"Вернуться к сегодняшнему дню",children:[t.jsx(Z0,{className:"w-3.5 h-3.5 text-purple-500"}),t.jsx("span",{className:"hidden sm:inline",children:"Актуальный день"})]}),t.jsx("button",{onClick:()=>ee("next"),className:`p-1.5 sm: p-2 rounded-xl border transition - all ${c==="dark"?"bg-white/5 border-white/10 hover:bg-white/10 text-white":"bg-white border-gray-200 hover:bg-gray-50 text-gray-900 shadow-sm"} `,children:t.jsx(Qi,{className:"w-4 h-4 sm:w-5 sm:h-5 text-purple-500"})})]}),t.jsxs("span",{className:`${Y} font-black text-lg tracking-tight whitespace-nowrap`,children:[oe(b[0],"d MMMM")," — ",oe(b[6],"d MMMM yyyy")]}),t.jsxs("button",{onClick:()=>ee("next"),className:`px-4 py-2 text-sm font-bold rounded-xl transition - all flex items-center gap-2 hover: scale-105 active: scale-95 ${c==="dark"?"bg-[#151a21] text-gray-300 hover:text-white hover:bg-[#1f2937]":"bg-gray-50 text-gray-600 hover:bg-gray-100"} `,children:[t.jsx("span",{children:"След. неделя"}),t.jsx(Dr,{className:"w-4 h-4 -rotate-90"})]})]}),t.jsx("div",{className:"p-3 sm:p-4 space-y-3 sm:space-y-4",children:b.map(S=>{const P=oe(S,"yyyy-MM-dd"),W=$(P),K=L(P),he=Z5(S,E),H="relative rounded-xl p-4 sm:p-5 border transition-all duration-300",me=c==="dark"?"bg-[#0b1015] border-white/5 shadow-md":"bg-gray-50 border-gray-200 shadow-sm",G=c==="dark"?"border-emerald-500/50 bg-emerald-500/5 ring-1 ring-emerald-500/20":"border-emerald-300 bg-emerald-50 ring-2 ring-emerald-200/70";return t.jsxs("div",{className:`${H} ${me} ${he?G:""} `,children:[he&&t.jsxs("div",{className:"absolute top-3 right-3 inline-flex items-center gap-2 px-3 py-1 rounded-full bg-emerald-500 text-white text-xs font-semibold shadow-lg ring-2 ring-white/50 dark:ring-emerald-200/30",children:[t.jsx("span",{className:"w-2 h-2 rounded-full bg-white animate-ping"}),t.jsx("span",{className:"relative",children:"Сегодня"})]}),t.jsx("h3",{className:`text-lg font-semibold mb-3 ${Y} `,children:oe(S,"dd.MM.yyyy")}),t.jsxs("div",{className:"space-y-3 sm:space-y-4",children:[K.map(se=>{var ne,ie;const{displayName:Z}=y(se.userId);return t.jsxs("div",{className:`relative flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 p-4 rounded-2xl border-2 transition-all duration-300 hover:shadow-xl backdrop-blur text-center sm:text-left ring-1 ring-inset ring-black/5 dark:ring-white/5 ${((ne=q[se.type])==null?void 0:ne.tone)||""}`,children:[t.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2 justify-center sm:justify-start w-full",children:[t.jsx("span",{className:"font-semibold text-base sm:text-lg",children:Z}),t.jsxs("span",{className:"inline-flex items-center gap-2 px-3 py-1 rounded-full bg-white/70 dark:bg-white/10 text-xs sm:text-sm font-semibold",children:[((ie=q[se.type])==null?void 0:ie.label)||se.type,se.comment&&t.jsxs("div",{className:"relative group/statuscomm ml-1",children:[t.jsx(Wt,{className:"w-3.5 h-3.5 opacity-60 hover:opacity-100 cursor-help"}),t.jsxs("div",{className:"absolute left-1/2 -translate-x-1/2 bottom-full mb-2 px-3 py-2 bg-gray-900 text-white text-xs rounded-lg max-w-xs whitespace-normal break-words opacity-0 invisible group-hover/statuscomm:opacity-100 group-hover/statuscomm:visible transition-all z-[100] shadow-xl border border-white/10",children:[se.comment,t.jsx("div",{className:"absolute left-1/2 -translate-x-1/2 top-full border-4 border-transparent border-t-gray-900"})]})]})]})]}),t.jsx("div",{className:"flex gap-2 justify-center sm:justify-end w-full",children:u&&f.includes(se.type)?t.jsxs(t.Fragment,{children:[t.jsx("button",{onClick:()=>a(se),className:`p-1 rounded transition-colors ${c==="dark"?"bg-white/10 hover:bg-white/20 text-white":"bg-white border border-gray-200 text-gray-700 hover:bg-gray-100"}`,title:"Редактировать (только для админа)",children:t.jsx(ar,{className:"w-4 h-4 text-current"})}),t.jsx("button",{onClick:()=>w(se,P),className:`p-1 rounded transition-colors ${c==="dark"?"bg-white/10 hover:bg-white/20 text-white":"bg-white border border-gray-200 text-gray-700 hover:bg-gray-100"}`,title:"Удалить (только для админа)",children:t.jsx(Et,{className:"w-4 h-4 text-current"})})]}):u||(d==null?void 0:d.id)===se.userId?t.jsxs(t.Fragment,{children:[t.jsx("button",{onClick:()=>a(se),className:`p-1 rounded transition-colors ${c==="dark"?"bg-white/10 hover:bg-white/20 text-white":"bg-white border border-gray-200 text-gray-700 hover:bg-gray-100"}`,children:t.jsx(ar,{className:"w-4 h-4 text-white"})}),t.jsx("button",{onClick:()=>w(se,P),className:`p-1 rounded transition-colors ${c==="dark"?"bg-white/10 hover:bg-white/20 text-white":"bg-white border border-gray-200 text-gray-700 hover:bg-gray-100"}`,children:t.jsx(Et,{className:"w-4 h-4 text-current"})})]}):t.jsxs(t.Fragment,{children:[t.jsx("button",{disabled:!0,className:`p-1 cursor-not-allowed rounded ${c==="dark"?"bg-white/5 text-white/60":"bg-gray-100 text-gray-400 border border-gray-200"}`,title:"Вы можете редактировать только свои статусы",children:t.jsx(ar,{className:"w-4 h-4 text-current opacity-60"})}),t.jsx("button",{disabled:!0,className:`p-1 cursor-not-allowed rounded ${c==="dark"?"bg-white/5 text-white/60":"bg-gray-100 text-gray-400 border border-gray-200"}`,title:"Вы можете удалять только свои статусы",children:t.jsx(Et,{className:"w-4 h-4 text-current opacity-60"})})]})})]},se.id)}),W.map(se=>{const{member:Z,displayName:ne}=y(se.userId),ie=g(se),Ce=ie?"bg-gradient-to-r from-emerald-500 to-teal-600 border-emerald-300/40":"bg-gradient-to-r from-slate-500 to-slate-700 border-slate-300/40",je=ie?ir:Ir;return t.jsxs("div",{className:`group relative space-y-2 sm:space-y-3 p-3 sm:p-4 ${Ce} rounded-lg sm:rounded-xl shadow-xl border-2 transition-all duration-300 hover:shadow-2xl active:scale-[0.98] sm:hover:scale-[1.03] mb-2 sm:mb-3 hover:z-50 ${ie?"hover:border-emerald-200/80 ring-2 ring-emerald-200/40 hover:ring-4 hover:ring-emerald-200/60":"hover:border-slate-200/80 ring-2 ring-slate-200/40 hover:ring-4 hover:ring-slate-200/60"}`,children:[t.jsxs("div",{className:"flex items-center justify-center sm:justify-start border-b border-white/20 pb-2 sm:pb-3",children:[t.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 min-w-0 flex-1",children:[t.jsxs("div",{className:"relative flex-shrink-0 group/avatar",children:[Z!=null&&Z.avatar?t.jsx("img",{src:Z.avatar,alt:ne,className:`w-8 h-8 sm: w-9 sm: h-9 md: w-10 md: h-10 lg: w-11 lg: h-11 rounded-full object - cover border-2 shadow-xl transition - all duration-300 group-hover/avatar: scale-110 group-hover/avatar: shadow-2xl ${ie?"border-white/50 ring-2 ring-white/40 ring-offset-2 ring-offset-emerald-400/30 group-hover/avatar:ring-4 group-hover/avatar:ring-white/60":"border-white/40 ring-2 ring-white/30 ring-offset-2 ring-offset-slate-400/30 group-hover/avatar:ring-4 group-hover/avatar:ring-white/50"} `,onError:le=>{const ue=le.target;ue.style.display="none";const F=ue.nextElementSibling;F&&(F.style.display="flex")}}):null,t.jsx("div",{className:`w-8 h-8 sm: w-9 sm: h-9 md: w-10 md: h-10 lg: w-11 lg: h-11 rounded-full flex items-center justify-center font-bold text-xs sm: text-sm transition - all duration-300 shadow-xl group-hover/avatar: scale-110 group-hover/avatar: shadow-2xl ${ie?"bg-white/25 backdrop-blur-md border-2 border-white/40 ring-2 ring-white/30 group-hover/avatar:ring-4 group-hover/avatar:ring-white/60":"bg-white/15 backdrop-blur-md border-2 border-white/30 ring-2 ring-white/20 group-hover/avatar:ring-4 group-hover/avatar:ring-white/50"} ${Z!=null&&Z.avatar?"absolute inset-0 hidden":""} `,children:ne.charAt(0).toUpperCase()})]}),t.jsx("span",{className:"text-white font-bold text-sm sm:text-base group-hover:scale-105 transition-transform duration-300 truncate text-center sm:text-left w-full sm:w-auto",children:ne})]}),t.jsx("div",{className:"flex gap-2",children:u||(d==null?void 0:d.id)===se.userId?t.jsxs(t.Fragment,{children:[t.jsx("button",{onClick:()=>r(se),className:"p-1.5 bg-white/20 hover:bg-white/30 rounded-lg transition-colors",children:t.jsx(ar,{className:"w-4 h-4 text-white"})}),t.jsx("button",{onClick:()=>A(se),className:"p-1.5 bg-white/20 hover:bg-white/30 rounded-lg transition-colors",children:t.jsx(Et,{className:"w-4 h-4 text-white"})})]}):t.jsxs(t.Fragment,{children:[t.jsx("button",{disabled:!0,className:"p-1.5 bg-white/10 cursor-not-allowed rounded-lg",title:"Вы можете редактировать только свои слоты",children:t.jsx(ar,{className:"w-4 h-4 text-white/50"})}),t.jsx("button",{disabled:!0,className:"p-1.5 bg-white/10 cursor-not-allowed rounded-lg",title:"Вы можете удалять только свои слоты",children:t.jsx(Et,{className:"w-4 h-4 text-white/50"})})]})})]}),t.jsx("div",{className:"space-y-2",children:se.slots.map((le,ue)=>{var F,B,Ne,Te;return t.jsxs("div",{className:"space-y-1.5",children:[t.jsx("div",{className:`bg-white/25 backdrop-blur-md rounded-md sm: rounded-lg px-2 sm: px-3 py-1.5 sm: py-2 border-2 transition - all duration-300 hover: scale-105 hover: shadow-xl ${ie?"border-white/40 ring-2 ring-white/20 hover:border-white/60 hover:ring-4 hover:ring-white/40":"border-white/30 ring-2 ring-white/10 hover:border-white/50 hover:ring-4 hover:ring-white/30"} `,children:t.jsxs("div",{className:"flex items-center gap-1.5 sm:gap-2 flex-wrap",children:[t.jsx(je,{className:`w-3.5 h-3.5 sm: w-4 sm: h-4 text-white flex-shrink - 0 ${ie?"animate-pulse":""} `}),t.jsxs("span",{className:"text-white font-bold text-xs sm:text-sm whitespace-nowrap",children:[le.start," - ",le.end]}),le.endDate&&t.jsxs("span",{className:"text-white/80 font-medium text-[10px] sm:text-xs whitespace-nowrap",children:["(до ",oe(new Date(le.endDate),"dd.MM"),")"]}),se.category&&t.jsx("span",{className:`text-[10px] px-1.5 py-0.5 rounded-full border font-medium whitespace-nowrap ${((F=R[se.category])==null?void 0:F.bg)||"bg-white/20"} ${((B=R[se.category])==null?void 0:B.text)||"text-white"} ${((Ne=R[se.category])==null?void 0:Ne.border)||"border-white/30"} `,children:((Te=us[se.category])==null?void 0:Te.label)||se.category}),se.comment&&t.jsxs("div",{className:"relative group",children:[t.jsx(Wt,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4 text-white/60 hover:text-white cursor-help flex-shrink-0"}),t.jsxs("div",{className:"absolute left-1/2 -translate-x-1/2 bottom-full mb-2 px-3 py-2 bg-gray-900 text-white text-xs rounded-lg max-w-xs whitespace-normal break-words opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all z-50 shadow-lg border border-white/10",children:[se.comment,t.jsx("div",{className:"absolute left-1/2 -translate-x-1/2 top-full border-4 border-transparent border-t-gray-900"})]})]})]})}),le.breaks&&le.breaks.length>0&&t.jsx("div",{className:"flex justify-center",children:t.jsx("button",{onClick:()=>te(se.id),className:`p-1 rounded-md transition - all duration-200 hover: scale-110 ${M[se.id]?"text-white hover:text-white/80":"text-white/70 hover:text-white"} `,title:M[se.id]?"Скрыть перерывы":"Показать перерывы",children:M[se.id]?t.jsx(ti,{className:"w-4 h-4"}):t.jsx(Dr,{className:"w-4 h-4"})})}),le.breaks&&le.breaks.length>0&&M[se.id]&&t.jsxs("div",{className:"space-y-1 w-full",children:[t.jsx("div",{className:`text-[10px] ${c==="dark"?"text-gray-300":"text-gray-700"} font-medium text-center sm:text-left`,children:"Перерывы:"}),le.breaks.map((pe,De)=>t.jsx("div",{className:`${c==="dark"?"bg-gray-700/95":"bg-white"} ${c==="dark"?"text-gray-200":"text-gray-900"} border-2 ${c==="dark"?"border-orange-500/60":"border-orange-300"} rounded-md sm:rounded-lg px-2 sm:px-3 py-1 sm:py-1.5 text-[10px] sm:text-xs font-semibold shadow-lg transition-all duration-300 hover:scale-105 hover:shadow-xl ${c==="dark"?"hover:border-orange-400/80 hover:shadow-orange-500/30 ring-2 ring-orange-500/20 hover:ring-4 hover:ring-orange-400/40":"hover:border-orange-400 hover:shadow-orange-400/30 ring-2 ring-orange-300/20 hover:ring-4 hover:ring-orange-300/40"} w-full`,children:t.jsxs("span",{className:"flex items-center gap-1 sm:gap-1.5 justify-center flex-wrap w-full",children:[t.jsx("span",{className:`w-1 h-1 sm:w-1.5 sm:h-1.5 rounded-full ${c==="dark"?"bg-orange-400":"bg-orange-500"} animate-pulse flex-shrink-0`}),t.jsxs("span",{className:"whitespace-nowrap",children:[pe.start," - ",pe.end]})]})},De))]})]},ue)})})]},se.id)}),W.length===0&&K.length===0&&P===oe(E,"yyyy-MM-dd")&&t.jsx("div",{className:`rounded-lg px-3 py-2 text-xs font-semibold ring-1 ring-inset ring-black/5 dark:ring-white/10 ${q.absence.tone}`,children:"Отсутствие"}),W.length===0&&K.length===0&&P!==oe(E,"yyyy-MM-dd")&&t.jsx("p",{className:`text-sm ${c==="dark"?"text-gray-400":"text-gray-600"}`,children:"Нет данных"})]})]},P)})})]})},Qp=({selectedUserId:s,onSelect:e})=>{const{theme:r}=Re(),[a,n]=k.useState(!1),[i,o]=k.useState(""),[c,d]=k.useState([]),u=k.useRef(null),m=Cc.useMemo(()=>{const T=new Map;return Ge.forEach(I=>{T.set(I.id,I)}),c.forEach(I=>{T.set(I.id,I)}),Array.from(T.values())},[c]),f=m.find(T=>T.id===s),x=el(s||"");k.useEffect(()=>{(async()=>{try{const I=await qd();d(I)}catch(I){console.error("Error loading users for selector:",I)}})()},[]),k.useEffect(()=>{const T=I=>{u.current&&!u.current.contains(I.target)&&n(!1)};return document.addEventListener("mousedown",T),()=>document.removeEventListener("mousedown",T)},[]);const v=m.filter(T=>{const I=T.name.toLowerCase(),N=T.login.toLowerCase(),O=i.toLowerCase();return I.includes(O)||N.includes(O)});return t.jsxs("div",{className:"relative w-full",ref:u,children:[t.jsxs("button",{onClick:()=>n(!a),className:`w-full flex items-center justify-between gap-3 px-4 py-2.5 rounded-xl border transition-all ${r==="dark"?"bg-[#151a21] border-white/5 text-gray-300 hover:border-emerald-500/30":"bg-gray-50 border-gray-200 text-gray-700 hover:border-emerald-500"}`,children:[t.jsx("div",{className:"flex items-center gap-2.5 overflow-hidden",children:f?t.jsxs(t.Fragment,{children:[f.avatar?t.jsx("img",{src:f.avatar,alt:"",className:"w-5 h-5 rounded-full object-cover flex-shrink-0"}):t.jsx("div",{className:"w-5 h-5 rounded-full flex items-center justify-center text-[10px] bg-emerald-500/20 text-emerald-500 flex-shrink-0",children:t.jsx(Pr,{size:12})}),t.jsx("span",{className:"text-sm font-bold truncate",children:x||f.name})]}):t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"w-5 h-5 rounded-full flex items-center justify-center border border-dashed border-gray-500 flex-shrink-0",children:t.jsx(Pr,{size:12,className:"text-gray-500"})}),t.jsx("span",{className:"text-sm font-semibold text-gray-500",children:"Все участники..."})]})}),t.jsx(Dr,{size:16,className:`text-gray-500 transition-transform ${a?"rotate-180":""}`})]}),a&&t.jsxs("div",{className:`absolute z-50 top-full mt-2 w-full min-w-[240px] rounded-2xl border shadow-2xl overflow-hidden animate-in fade-in slide-in-from-top-2 duration-200 ${r==="dark"?"bg-[#1a1f26] border-white/10":"bg-white border-gray-200"}`,children:[t.jsx("div",{className:"p-3 border-b border-white/5",children:t.jsxs("div",{className:"relative",children:[t.jsx(es,{size:14,className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-500"}),t.jsx("input",{type:"text",placeholder:"Поиск участника...",value:i,onChange:T=>o(T.target.value),className:`w-full pl-9 pr-8 py-2 rounded-lg text-xs font-medium outline-none transition-all ${r==="dark"?"bg-black/20 text-gray-300 focus:bg-black/40":"bg-gray-100 text-gray-700 focus:bg-gray-200"}`,autoFocus:!0}),i&&t.jsx("button",{onClick:()=>o(""),className:"absolute right-2 top-1/2 -translate-y-1/2 p-1 hover:text-rose-500",children:t.jsx(pt,{size:12})})]})}),t.jsxs("div",{className:"max-h-[300px] overflow-y-auto p-1.5 custom-scrollbar",children:[t.jsxs("button",{onClick:()=>{e(null),n(!1)},className:`w-full flex items-center gap-3 px-3 py-2 rounded-lg transition-all text-left ${s?r==="dark"?"hover:bg-white/5 text-gray-400":"hover:bg-gray-50 text-gray-600":r==="dark"?"bg-emerald-500/10 text-emerald-400":"bg-emerald-50 text-emerald-600"}`,children:[t.jsx("div",{className:"w-6 h-6 rounded-full flex items-center justify-center border border-dashed border-gray-500 text-[10px]",children:t.jsx(Pr,{size:12})}),t.jsx("span",{className:"text-xs font-bold",children:"Все участники"})]}),v.map(T=>t.jsx(G_,{member:T,isSelected:s===T.id,onSelect:I=>{e(I),n(!1)},theme:r},T.id)),v.length===0&&t.jsx("div",{className:"p-4 text-center",children:t.jsx("p",{className:"text-[10px] text-gray-500",children:"Никого не нашли :("})})]})]})]})},G_=({member:s,isSelected:e,onSelect:r,theme:a})=>{const n=el(s.id);return t.jsxs("button",{onClick:()=>r(s.id),className:`w-full flex items-center gap-3 px-3 py-2 rounded-lg transition-all text-left group ${e?a==="dark"?"bg-emerald-500/10 text-emerald-400":"bg-emerald-50 text-emerald-600":a==="dark"?"hover:bg-white/5 text-gray-300":"hover:bg-gray-50 text-gray-700"}`,children:[t.jsx("div",{className:"relative",children:s.avatar?t.jsx("img",{src:s.avatar,alt:"",className:"w-6 h-6 rounded-full object-cover group-hover:ring-2 ring-emerald-500/30 transition-all"}):t.jsx("div",{className:`w-6 h-6 rounded-full flex items-center justify-center text-[10px] ${e?"bg-emerald-500/20 text-emerald-500":"bg-gray-500/10 text-gray-500"}`,children:s.name[0]})}),t.jsxs("div",{className:"flex flex-col min-w-0",children:[t.jsx("span",{className:"text-xs font-bold truncate",children:n||s.name}),t.jsx("span",{className:"text-[9px] opacity-50 truncate",children:s.login})]})]})},K_=({selectedCategory:s,onSelect:e,error:r})=>{const{theme:a}=Re(),[n,i]=k.useState(!1),[o,c]=k.useState(""),d=k.useRef(null);k.useEffect(()=>{const v=T=>{d.current&&!d.current.contains(T.target)&&i(!1)};return document.addEventListener("mousedown",v),()=>document.removeEventListener("mousedown",v)},[]);const m=Object.keys(us).filter(v=>{const I=us[v].label.toLowerCase(),N=o.toLowerCase();return I.includes(N)}),f=s?us[s]:null,x=v=>{const T={emerald:"text-emerald-500 bg-emerald-500/10 border-emerald-500/20",blue:"text-blue-500 bg-blue-500/10 border-blue-500/20",purple:"text-purple-500 bg-purple-500/10 border-purple-500/20",amber:"text-amber-500 bg-amber-500/10 border-amber-500/20",cyan:"text-cyan-500 bg-cyan-500/10 border-cyan-500/20",pink:"text-pink-500 bg-pink-500/10 border-pink-500/20",indigo:"text-indigo-500 bg-indigo-500/10 border-indigo-500/20"},I=us[v];return T[I.accent]||"text-gray-500 bg-gray-500/10"};return t.jsxs("div",{className:"relative w-full",ref:d,children:[t.jsxs("button",{type:"button",onClick:()=>i(!n),className:`w-full flex items-center justify-between gap-3 px-3 sm:px-4 py-2 sm:py-2.5 rounded-lg border transition-all ${r?"border-red-500 ring-1 ring-red-500":a==="dark"?"bg-gray-700 border-gray-800 text-white hover:border-gray-600":"bg-white border-gray-300 text-gray-900 hover:border-gray-400"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`,children:[t.jsx("div",{className:"flex items-center gap-2.5 overflow-hidden",children:s&&f?t.jsxs(t.Fragment,{children:[t.jsx("div",{className:`w-5 h-5 rounded-md flex items-center justify-center border text-[10px] flex-shrink-0 ${x(s)}`,children:f.label[0]}),t.jsx("span",{className:"text-sm font-medium truncate",children:f.label})]}):t.jsxs(t.Fragment,{children:[t.jsx("div",{className:`w-5 h-5 rounded-md flex items-center justify-center border border-dashed flex-shrink-0 ${a==="dark"?"border-gray-600":"border-gray-300"}`,children:t.jsx(K0,{size:12,className:a==="dark"?"text-gray-400":"text-gray-500"})}),t.jsx("span",{className:`text-sm ${a==="dark"?"text-gray-400":"text-gray-500"}`,children:"Выберите сферу..."})]})}),t.jsx(Dr,{size:16,className:`text-gray-500 transition-transform ${n?"rotate-180":""}`})]}),n&&t.jsxs("div",{className:`absolute z-50 top-full mt-2 w-full min-w-[240px] rounded-xl border shadow-2xl overflow-hidden animate-in fade-in slide-in-from-top-2 duration-200 ${a==="dark"?"bg-[#1a1f26] border-white/10":"bg-white border-gray-200"}`,children:[t.jsx("div",{className:"p-2 border-b border-white/5",children:t.jsxs("div",{className:"relative",children:[t.jsx(es,{size:14,className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-500"}),t.jsx("input",{type:"text",placeholder:"Поиск...",value:o,onChange:v=>c(v.target.value),className:`w-full pl-9 pr-8 py-2 rounded-lg text-xs font-medium outline-none transition-all ${a==="dark"?"bg-black/20 text-gray-300 focus:bg-black/40":"bg-gray-100 text-gray-700 focus:bg-gray-200"}`,autoFocus:!0})]})}),t.jsxs("div",{className:"max-h-[300px] overflow-y-auto p-1.5 custom-scrollbar space-y-1",children:[t.jsxs("button",{type:"button",onClick:()=>{e(""),i(!1)},className:`w-full flex items-center gap-3 px-3 py-2 rounded-lg transition-all text-left ${s?a==="dark"?"hover:bg-white/5 text-gray-400":"hover:bg-gray-50 text-gray-600":a==="dark"?"bg-white/10 text-white":"bg-gray-100 text-gray-900"}`,children:[t.jsx("span",{className:"text-xs font-medium",children:"Не выбрано"}),!s&&t.jsx(Zr,{size:14,className:"ml-auto"})]}),m.map(v=>{const T=us[v],I=s===v;return t.jsxs("button",{type:"button",onClick:()=>{e(v),i(!1)},className:`w-full flex items-center gap-3 px-3 py-2 rounded-lg transition-all text-left group ${I?a==="dark"?"bg-emerald-500/10":"bg-emerald-50":a==="dark"?"hover:bg-white/5":"hover:bg-gray-50"}`,children:[t.jsx("div",{className:`w-8 h-8 rounded-lg flex items-center justify-center border text-xs font-bold transition-transform group-hover:scale-105 ${x(v)}`,children:T.label[0]}),t.jsx("div",{className:"flex flex-col min-w-0 flex-1",children:t.jsx("span",{className:`text-sm font-semibold truncate ${I?a==="dark"?"text-emerald-400":"text-emerald-700":a==="dark"?"text-gray-200":"text-gray-700"}`,children:T.label})}),I&&t.jsx(Zr,{size:14,className:a==="dark"?"text-emerald-400":"text-emerald-600"})]},v)}),m.length===0&&t.jsx("div",{className:"p-4 text-center",children:t.jsx("p",{className:"text-[10px] text-gray-500",children:"Ничего не найдено"})})]})]})]})},Q_=({slot:s,onClose:e,onSave:r})=>{var Br,Me;const{user:a}=ot(),{theme:n}=Re(),{isAdmin:i}=ft(),o=n==="dark"?"text-white":"text-gray-900",c=(s==null?void 0:s.date)||oe(new Date,"yyyy-MM-dd"),[d,u]=k.useState(c),[m,f]=k.useState(s!=null&&s.userId?[s.userId]:[]),[x,v]=k.useState(((Br=s==null?void 0:s.slots)==null?void 0:Br.map(Q=>{const ce=Q;return ce.break&&!ce.breaks?{...Q,breaks:[ce.break]}:Q}))||[]),[T,I]=k.useState(""),[N,O]=k.useState(""),[D,C]=k.useState(!1),[M,V]=k.useState(""),[U,y]=k.useState(""),[b,E]=k.useState(null),[j,A]=k.useState(null),[w,g]=k.useState(null),[$,L]=k.useState(null),[ee,te]=k.useState((s==null?void 0:s.comment)||""),[Y,q]=k.useState(!1),[R,S]=k.useState([]),[P,W]=k.useState(!1),[K,he]=k.useState([]),[H,me]=k.useState("single"),[G,se]=k.useState(c),[Z,ne]=k.useState(c),[ie,Ce]=k.useState(c),[je,le]=k.useState([]),[ue,F]=k.useState(""),[B,Ne]=k.useState(!1),[Te,pe]=k.useState((s==null?void 0:s.category)||"");ns();const De=["Пн","Вт","Ср","Чт","Пт","Сб","Вс"],$e=i&&!s;k.useEffect(()=>{console.log("SlotForm mounted, user:",a==null?void 0:a.name,"slots count:",x.length)},[]),k.useEffect(()=>{if(Y&&d){const Q=new Date(d),ce=Q.getDay()===0?6:Q.getDay()-1;S([ce])}},[Y,d]),k.useEffect(()=>{P||he([])},[P]),k.useEffect(()=>{H!=="single"&&(q(!1),S([]),W(!1),he([]))},[H]);const nt=()=>{var ze;if(!T||!N){F("Заполните время начала и окончания");return}const Q=fr(T)>=fr(N),ce=D||Q;if(Q&&!D){F('Время окончания должно быть позже времени начала. Включите "Переходит через полночь" для слотов, переходящих на следующий день.');return}let ve;if(ce&&d){const Qe=new Date(d);Qe.setDate(Qe.getDate()+1),ve=oe(Qe,"yyyy-MM-dd")}const Ie=b!==null?((ze=x[b])==null?void 0:ze.breaks)||[]:[],Le={start:T,end:N,...ve&&{endDate:ve},breaks:Ie};if(b!==null){const Qe=[...x];Qe[b]=Le,v(Qe)}else v([...x,Le]);I(""),O(""),C(!1),V(""),y(""),E(null),A(null),F("")},dt=Q=>{const ce=x[Q];if(!ce)return;const ve=!!ce.endDate||fr(ce.end)<=fr(ce.start);I(ce.start),O(ce.end),C(ve),E(Q),A(null),g(null),L(null),V(""),y(""),F("")},ge=()=>{E(null),I(""),O(""),C(!1),F("")},be=Q=>{if(!M||!U){F("Заполните время начала и окончания перерыва");return}const ce=x[Q];if(!ce)return;if(M>=U){F("Время окончания перерыва должно быть позже времени начала");return}const ve=fr(M),Ie=fr(U),Le=fr(ce.start),ze=fr(ce.end),Qe=ce.endDate||ze<=Le;let Be=!1;if(Qe){const lt=ve>=Le&&ve<1440&&Ie>ve&&Ie<=1440&&Ie>ve,ht=ve>=0&&ve<=ze&&Ie>ve&&Ie<=ze,Dt=ve>=Le&&ve<1440&&Ie>0&&Ie<=ze&&ve>Ie;Be=lt||ht||Dt}else Be=ve>=Le&&Ie<=ze&&Ie>ve;if(!Be){F(`Перерыв должен быть в пределах времени слота (${ce.start} - ${ce.end})`);return}const We=ce.breaks||[];for(let Nt=0;Nt<We.length;Nt++){if(w===Q&&$===Nt)continue;const lt=We[Nt];if(M>=lt.start&&M<lt.end||U>lt.start&&U<=lt.end||M<=lt.start&&U>=lt.end){F("Перерывы не должны пересекаться");return}}let rt;w===Q&&$!==null?(rt=[...We],rt[$]={start:M,end:U},rt.sort((Nt,lt)=>Nt.start.localeCompare(lt.start))):rt=[...We,{start:M,end:U}].sort((Nt,lt)=>Nt.start.localeCompare(lt.start));const ut=[...x];ut[Q]={...ce,breaks:rt},v(ut),V(""),y(""),A(null),g(null),L(null),F("")},qe=(Q,ce)=>{const ve=x[Q];if(!ve||!ve.breaks||!ve.breaks[ce])return;const Ie=ve.breaks[ce];g(Q),L(ce),A(Q),V(Ie.start),y(Ie.end),F("")},bt=()=>{V(""),y(""),A(null),g(null),L(null),F("")},re=(Q,ce)=>{const ve=x[Q];if(!ve||!ve.breaks)return;const Ie=ve.breaks.filter((ze,Qe)=>Qe!==ce),Le=[...x];Le[Q]={...ve,breaks:Ie.length>0?Ie:void 0},v(Le)},Ee=Q=>{v(x.filter((ce,ve)=>ve!==Q)),b===Q&&ge()},Se=Q=>{R.includes(Q)?S(R.filter(ce=>ce!==Q)):S([...R,Q])},Pe=Q=>{K.includes(Q)?he(K.filter(ce=>ce!==Q)):he([...K,Q])},Ct=Q=>{f(ce=>ce.includes(Q)?ce.filter(ve=>ve!==Q):[...ce,Q])},vr=()=>{m.length===Ge.length?f([]):f(Ge.map(Q=>Q.id))},$r=()=>{if(!ie)return;const Q=e_([...je,ie]);le(Q),Ce("")},cr=Q=>{le(ce=>ce.filter(ve=>ve!==Q))},Ut=()=>{if($e){if(H==="range")return m0(G,Z);if(H==="multiple")return je}if(H==="single"){if(Y&&R.length>0){const Q=[],ce=new Date(d),ve=new Date(ce.getFullYear(),ce.getMonth()+1,0),Ie=R[0],Le=new Date(ce);for(;Le<=ve;)(Le.getDay()===0?6:Le.getDay()-1)===Ie&&Q.push(oe(Le,"yyyy-MM-dd")),Le.setDate(Le.getDate()+1);return Q}if(P&&K.length>0){const Q=[],ce=new Date(d),ve=ce.getDay()===0?6:ce.getDay()-1;ce.setDate(ce.getDate()-ve);for(let Ie=0;Ie<7;Ie++){const Le=new Date(ce);Le.setDate(ce.getDate()+Ie);const ze=Le.getDay()===0?6:Le.getDay()-1;K.includes(ze)&&Q.push(oe(Le,"yyyy-MM-dd"))}return Q}return[d]}return H==="range"?m0(G,Z):je},Es=()=>s?[s.userId]:$e?m:i&&!a?m.length>0?m:[]:a!=null&&a.id?[a.id]:[],Er=Q=>yr(Q),Tr=async(Q,ce,ve)=>{if(ve){const ze=await Kp(ve,!0);for(const Qe of ze){const Be=await Gr(Qe.restrictedUserId,Q);for(const We of ce){for(const rt of Be)if(Ri(We,rt.slots[0]))return`Ваше время пересекается со слотом ${Er(Qe.restrictedUserId)} (${rt.slots[0].start}-${rt.slots[0].end}). ${Qe.reason||"Выберите другое время."}`;if(We.endDate){const rt=await Gr(Qe.restrictedUserId,We.endDate);for(const ut of rt)if(Ri(We,ut.slots[0]))return`Ваше время пересекается со слотом ${Er(Qe.restrictedUserId)} (${ut.slots[0].start}-${ut.slots[0].end}). ${Qe.reason||"Выберите другое время."}`}}}}const Le=(await Gr(void 0,Q)).filter(ze=>ze.id!==(s==null?void 0:s.id));for(const ze of ce){for(const Qe of Le)if(Ri(ze,Qe.slots[0])&&Qe.participants.length>=3)return`Слот ${ze.start}-${ze.end} уже занят максимальным количеством участников (3)`;if(ze.endDate){const Be=(await Gr(void 0,ze.endDate)).filter(We=>We.id!==(s==null?void 0:s.id));for(const We of Be)if(Ri(ze,We.slots[0])&&We.participants.length>=3)return`Слот ${ze.start}-${ze.end} (до ${ze.endDate}) уже занят максимальным количеством участников (3)`}}return null},Fr=async()=>{if(console.log("handleSave called"),!i&&!a){console.log("No user found"),F("Пользователь не найден");return}if(x.length===0){F("Добавьте хотя бы один временной интервал");return}if(s&&!i&&a&&s.userId!==a.id){F("Вы можете редактировать только свои слоты"),Ne(!1);return}const Q=Es();if(Q.length===0){F("Выберите хотя бы одного участника");return}const ce=Ut();if(ce.length===0){F("Выберите даты");return}if(!s&&!Te){F("Выберите сферу деятельности");return}const ve=new Date;ve.setHours(0,0,0,0);const Ie=oe(ve,"yyyy-MM-dd"),Le=Be=>Be<Ie,ze=(Be,We)=>{const rt=new Date(Be),ut=new Date(We);return rt.setHours(0,0,0,0),ut.setHours(0,0,0,0),Math.round((ut.getTime()-rt.getTime())/(1e3*60*60*24))},Qe=async(Be,We,rt=[Be])=>{const ut=x.map(ht=>{const Dt=!ht.endDate&&fr(ht.end)<=fr(ht.start),xe=ht.endDate?ze(d,ht.endDate):Dt?1:0;if(xe>0){const ye=new Date(We);return ye.setDate(ye.getDate()+xe),{...ht,endDate:oe(ye,"yyyy-MM-dd")}}return{...ht,...ht.endDate?{endDate:ht.endDate}:{}}});if(!i){const ht=ut.length>0?ut[0].start:void 0,Dt=await Ec("slots",We,ht);if(Dt.restricted)throw new Error(`[${Er(Be)} • ${oe(new Date(We),"dd.MM.yyyy")}] ${Dt.reason}`);for(const xe of ut)if(xe.endDate&&xe.endDate!==We){const ye=await Ec("slots",xe.endDate);if(ye.restricted)throw new Error(`[${Er(Be)} • ${oe(new Date(xe.endDate),"dd.MM.yyyy")}] ${ye.reason}`)}}const Nt=await Tr(We,ut,Be);if(Nt)throw new Error(`[${Er(Be)} • ${oe(new Date(We),"dd.MM.yyyy")}] ${Nt}`);const lt={id:(s==null?void 0:s.id)||"",userId:Be,date:We,slots:ut,...ee&&{comment:ee},participants:rt,...Te?{category:Te}:s!=null&&s.category?{category:s.category}:{}};if(i)if(s){const{id:ht,...Dt}=lt;await Lp(s.id,Dt)}else{const{id:ht,...Dt}=lt;await Vp(Dt)}else await $t({entity:"slot",action:s?"update":"create",authorId:(a==null?void 0:a.id)||Be,targetUserId:Be,before:s||null,after:lt,comment:ee||void 0})};console.log("Starting save process..."),F(""),Ne(!0);try{if(s){await Qe(s.userId,d,s.participants||[s.userId]),r();return}if(P&&K.length>0){const Be=Ut();for(const We of Be)if(!Le(We))for(const rt of Q)await Qe(rt,We)}else if(Y&&R.length>0){const Be=new Date(d),We=Be.getMonth(),rt=Be.getFullYear(),ut=new Date(rt,We+1,0).getDate();for(let Nt=1;Nt<=ut;Nt++){const lt=new Date(rt,We,Nt),ht=lt.getDay()===0?6:lt.getDay()-1;if(R.includes(ht)){const Dt=oe(lt,"yyyy-MM-dd");if(Le(Dt))continue;for(const xe of Q)await Qe(xe,Dt)}}}else if($e&&H!=="single")for(const Be of ce)for(const We of Q)await Qe(We,Be);else for(const Be of Q)await Qe(Be,d);r()}catch(Be){console.error("Error saving slot:",Be);const We=Be.message||Be.code||"Ошибка при сохранении";F(We)}finally{Ne(!1)}},Ur=$e?Ut():[d],Sr=x.map(Q=>`${Q.start}–${Q.end}${Q.endDate?" (+1)":""}`);return t.jsx(t.Fragment,{children:t.jsx("div",{className:"fixed inset-0 bg-slate-950/75 backdrop-blur-xl flex items-start sm:items-center justify-center z-[70] p-4 sm:p-6 touch-manipulation overflow-y-auto",children:t.jsx("div",{className:`w-full max-w-5xl rounded-3xl shadow-[0_24px_80px_rgba(0,0,0,0.45)] border ${n==="dark"?"bg-gradient-to-br from-[#0c1320] via-[#0b1220] to-[#08111b] border-white/10":"bg-gradient-to-br from-white via-slate-50 to-white border-slate-200"} max-h-[90vh] overflow-y-auto`,children:t.jsxs("div",{className:"p-4 sm:p-6 lg:p-7 flex flex-col h-full min-h-0 overflow-y-auto",children:[t.jsxs("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between",children:[t.jsxs("div",{className:"space-y-1",children:[t.jsx("div",{className:"flex items-center gap-2 text-xs font-semibold text-[#4E6E49] tracking-tight",children:t.jsx("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full bg-[#4E6E49]/10 text-[#4E6E49] border border-[#4E6E49]/30",children:s?"Редактирование слота":"Создание слота"})}),t.jsx("h3",{className:`text-2xl sm:text-3xl font-bold ${o}`,children:s?"Редактировать слот":"Добавить слот"})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsxs("div",{className:`px-3 py-2 rounded-xl border text-xs sm:text-sm ${n==="dark"?"border-white/10 bg-white/5 text-gray-200":"border-slate-200 bg-slate-50 text-slate-700"}`,children:[s?"Редактирование":"Создание"," · ",x.length||0," интервал(ов)"]}),t.jsx("button",{onClick:e,className:`p-2.5 rounded-full border ${n==="dark"?"border-white/10 text-gray-200 hover:bg-white/5":"border-slate-200 text-slate-600 hover:bg-slate-100"} transition-colors touch-manipulation`,"aria-label":"Закрыть",children:t.jsx(pt,{className:"w-4 h-4 sm:w-5 sm:h-5"})})]})]}),t.jsxs("div",{className:"mt-5 grid lg:grid-cols-[0.9fr_1.6fr] gap-4 lg:gap-6 flex-1 min-h-0",children:[t.jsxs("aside",{className:`rounded-2xl border ${n==="dark"?"border-white/10 bg-white/5":"border-slate-200 bg-white"} p-4 sm:p-5 space-y-4 sticky top-0 self-start max-h-full overflow-y-auto`,children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("p",{className:"text-sm font-semibold",children:"Навигация"}),t.jsx("span",{className:"text-[11px] uppercase tracking-wide text-[#4E6E49] font-semibold",children:"4 шага"})]}),t.jsx("div",{className:"space-y-2",children:[{label:"Участники",detail:m.length>0?t.jsx("div",{className:"flex flex-wrap gap-x-1",children:m.map((Q,ce)=>t.jsxs("span",{children:[t.jsx(ys,{userId:Q}),ce<m.length-1?",":""]},Q))}):"Не выбрано",done:m.length>0||!!s},{label:"Даты",detail:Ur.slice(0,2).map(Q=>oe(Q,"dd.MM")).join(", ")||"Выберите дату",done:Ur.length>0},{label:"Время",detail:Sr.slice(0,2).join(" · ")||"Добавьте интервал",done:x.length>0},{label:"Сфера",detail:Te?((Me=us[Te])==null?void 0:Me.label)||Te:"Выберите сферу",done:!!Te},{label:"Комментарий",detail:ee?"Заполнен":"Необязателен",done:!!ee}].map((Q,ce)=>t.jsxs("div",{className:`flex items-start gap-3 rounded-xl border px-3 py-3 ${n==="dark"?"border-white/10 bg-white/5 text-gray-200 hover:border-white/30":"border-slate-200 bg-white text-gray-800 hover:border-slate-300"}`,children:[t.jsx("span",{className:`mt-0.5 inline-flex h-6 w-6 items-center justify-center rounded-full text-xs font-bold ${Q.done?"bg-[#4E6E49] text-white":n==="dark"?"bg-slate-800 text-gray-300":"bg-slate-200 text-slate-700"}`,children:ce+1}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("p",{className:"text-sm font-semibold",children:Q.label}),t.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400 truncate",children:Q.detail})]})]},Q.label))})]}),t.jsxs("div",{className:"space-y-4 overflow-y-auto overscroll-contain pr-1 pb-6 flex-1 min-h-0",children:[$e&&t.jsxs("div",{children:[t.jsx("label",{className:`block text-xs sm:text-sm font-medium mb-2 ${n==="dark"?"text-gray-300":"text-gray-700"}`,children:"Участники"}),t.jsxs("div",{className:"space-y-3",children:[t.jsx("div",{className:"flex flex-wrap gap-2",children:Ge.map(Q=>t.jsxs("label",{className:`px-3 py-1.5 rounded-full border cursor-pointer text-sm flex items-center gap-2 ${m.includes(Q.id)?"bg-[#4E6E49] border-[#4E6E49] text-white":n==="dark"?"bg-gray-700 border-gray-800 text-gray-200":"bg-gray-100 border-gray-300 text-gray-700"}`,children:[t.jsx("input",{type:"checkbox",checked:m.includes(Q.id),onChange:()=>Ct(Q.id),className:"hidden"}),t.jsx(ys,{userId:Q.id})]},Q.id))}),t.jsx("button",{type:"button",onClick:vr,className:"text-sm text-[#4E6E49] hover:text-[#4E6E49]",children:m.length===Ge.length?"Снять выделение":"Выбрать всех"})]})]}),$e&&t.jsxs("div",{children:[t.jsx("p",{className:`text-xs sm:text-sm font-medium mb-2 ${n==="dark"?"text-gray-300":"text-gray-700"}`,children:"Формат выбора дат"}),t.jsx("div",{className:"flex flex-wrap gap-4",children:[{value:"single",label:"Один день"},{value:"range",label:"Диапазон дат"},{value:"multiple",label:"Конкретные даты"}].map(Q=>t.jsxs("label",{className:"flex items-center gap-2 text-sm cursor-pointer",children:[t.jsx("input",{type:"radio",value:Q.value,checked:H===Q.value,onChange:ce=>me(ce.target.value)}),t.jsx("span",{className:n==="dark"?"text-gray-200":"text-gray-700",children:Q.label})]},Q.value))})]}),(!$e||H==="single")&&t.jsxs("div",{children:[t.jsx("label",{className:`block text-xs sm:text-sm font-medium mb-2 ${n==="dark"?"text-gray-300":"text-gray-700"}`,children:"Дата"}),t.jsx("input",{type:"date",value:d,onChange:Q=>u(Q.target.value),className:`w-full px-3 sm:px-4 py-2 sm:py-2.5 text-sm sm:text-base rounded-lg border touch-manipulation ${n==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`})]}),$e&&H==="range"&&t.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:`block text-xs sm:text-sm font-medium mb-2 ${n==="dark"?"text-gray-300":"text-gray-700"}`,children:"Начало диапазона"}),t.jsx("input",{type:"date",value:G,onChange:Q=>se(Q.target.value),className:`w-full px-3 sm:px-4 py-2 sm:py-2.5 text-sm sm:text-base rounded-lg border touch-manipulation ${n==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`})]}),t.jsxs("div",{children:[t.jsx("label",{className:`block text-xs sm:text-sm font-medium mb-2 ${n==="dark"?"text-gray-300":"text-gray-700"}`,children:"Конец диапазона"}),t.jsx("input",{type:"date",value:Z,min:G,onChange:Q=>ne(Q.target.value),className:`w-full px-3 sm:px-4 py-2 sm:py-2.5 text-sm sm:text-base rounded-lg border touch-manipulation ${n==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`})]})]}),$e&&H==="multiple"&&t.jsxs("div",{children:[t.jsx("label",{className:`block text-xs sm:text-sm font-medium mb-2 ${n==="dark"?"text-gray-300":"text-gray-700"}`,children:"Выбранные даты"}),t.jsxs("div",{className:"flex flex-col gap-3",children:[t.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[t.jsx("input",{type:"date",value:ie,onChange:Q=>Ce(Q.target.value),className:`flex-1 px-3 sm:px-4 py-2 sm:py-2.5 text-sm sm:text-base rounded-lg border touch-manipulation ${n==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`}),t.jsx("button",{type:"button",onClick:$r,className:"px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg transition-colors",children:"Добавить"})]}),je.length>0?t.jsx("div",{className:"flex flex-wrap gap-2",children:je.map(Q=>t.jsxs("span",{className:"inline-flex items-center gap-2 px-3 py-1.5 rounded-full bg-gray-100 text-gray-800 text-sm",children:[oe(Q,"dd.MM.yyyy"),t.jsx("button",{type:"button",onClick:()=>cr(Q),className:"text-red-500 hover:text-red-600",children:"x"})]},Q))}):t.jsx("p",{className:"text-sm text-gray-500",children:"Пока не выбрано ни одной даты"})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:`block text-xs sm:text-sm font-medium mb-2 ${n==="dark"?"text-gray-300":"text-gray-700"}`,children:"Временные слоты"}),t.jsxs("div",{className:"space-y-2 mb-2",children:[t.jsx("div",{className:"flex flex-col sm:flex-row gap-2",children:t.jsxs("div",{className:"flex gap-2 flex-1",children:[t.jsx("input",{type:"time",value:T,onChange:Q=>I(Q.target.value),className:`flex-1 px-3 sm:px-4 py-2 sm:py-2.5 text-sm sm:text-base rounded-lg border touch-manipulation ${n==="dark"?"bg-gray-700 border-gray-500 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`,placeholder:"Начало"}),t.jsx("span",{className:"mx-1 sm:mx-2 text-gray-500 text-sm sm:text-base flex items-center",children:"—"}),t.jsx("input",{type:"time",value:N,onChange:Q=>O(Q.target.value),className:`flex-1 px-3 sm:px-4 py-2 sm:py-2.5 text-sm sm:text-base rounded-lg border touch-manipulation ${n==="dark"?"bg-gray-700 border-gray-500 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`,placeholder:"Окончание"})]})}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("input",{type:"checkbox",id:"crossMidnight",checked:D,onChange:Q=>{C(Q.target.checked)},className:`w-4 h-4 rounded border-2 ${n==="dark"?"border-gray-800 bg-gray-700 checked:bg-[#4E6E49] checked:border-[#4E6E49]":"border-gray-300 bg-white checked:bg-[#4E6E49] checked:border-[#4E6E49]"} focus:ring-2 focus:ring-[#4E6E49] cursor-pointer touch-manipulation`}),t.jsx("label",{htmlFor:"crossMidnight",className:`text-xs sm:text-sm font-medium cursor-pointer ${n==="dark"?"text-gray-300":"text-gray-700"}`,children:"Переходит через полночь (на следующий день)"})]}),t.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[t.jsx("button",{onClick:nt,className:"w-full px-4 py-2 bg-[#4E6E49] hover:bg-[#4E6E49] text-white rounded-lg transition-colors flex items-center justify-center gap-2",children:b!==null?t.jsxs(t.Fragment,{children:[t.jsx(ar,{className:"w-4 h-4"}),"Сохранить слот"]}):t.jsxs(t.Fragment,{children:[t.jsx(mr,{className:"w-4 h-4"}),"Добавить слот"]})}),b!==null&&t.jsx("button",{onClick:ge,className:`w-full sm:w-auto px-4 py-2 rounded-lg border ${n==="dark"?"border-gray-700 text-gray-200 hover:bg-gray-700":"border-gray-300 text-gray-800 hover:bg-gray-100"}`,children:"Отмена"})]})]}),t.jsx("div",{className:"space-y-3",children:x.map((Q,ce)=>t.jsxs("div",{className:`flex flex-col gap-2 p-3 rounded-lg ${n==="dark"?"bg-gray-700":"bg-gray-100"}`,children:[t.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-2",children:[t.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[t.jsxs("span",{className:o,children:[Q.start," - ",Q.end]}),Q.endDate&&t.jsxs("span",{className:`text-xs px-2 py-0.5 rounded-full ${n==="dark"?"bg-blue-500/20 text-blue-400 border border-blue-500/30":"bg-blue-100 text-blue-700 border border-blue-300"}`,children:["до ",oe(new Date(Q.endDate),"dd.MM.yyyy")]})]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx("button",{onClick:()=>dt(ce),className:"p-1 text-blue-500 hover:bg-blue-500 hover:text-white rounded transition-colors flex-shrink-0",title:"Редактировать слот",children:t.jsx(ar,{className:"w-4 h-4"})}),t.jsx("button",{onClick:()=>Ee(ce),className:"p-1 text-red-500 hover:bg-red-500 hover:text-white rounded transition-colors flex-shrink-0",title:"Удалить слот",children:t.jsx(Et,{className:"w-4 h-4"})})]})]}),Q.breaks&&Q.breaks.length>0&&t.jsxs("div",{className:"ml-4 space-y-1",children:[t.jsx("span",{className:`text-xs ${n==="dark"?"text-gray-400":"text-gray-600"}`,children:"Перерывы:"}),Q.breaks.map((ve,Ie)=>w===ce&&$===Ie?null:t.jsxs("div",{className:"flex items-center justify-between gap-2",children:[t.jsxs("span",{className:`text-sm ${n==="dark"?"text-gray-300":"text-gray-700"}`,children:[ve.start," - ",ve.end]}),t.jsxs("div",{className:"flex gap-1",children:[t.jsx("button",{onClick:()=>qe(ce,Ie),className:"p-1 text-blue-400 hover:bg-blue-400 hover:text-white rounded transition-colors",title:"Редактировать перерыв",children:t.jsx(ar,{className:"w-3 h-3"})}),t.jsx("button",{onClick:()=>re(ce,Ie),className:"p-1 text-red-400 hover:bg-red-400 hover:text-white rounded transition-colors",title:"Удалить перерыв",children:t.jsx(pt,{className:"w-3 h-3"})})]})]},Ie))]}),t.jsx("div",{className:"ml-4 space-y-2 border-t pt-2 border-gray-500 border-opacity-30",children:j===ce?t.jsxs("div",{className:"space-y-2",children:[t.jsxs("div",{className:"flex gap-2",children:[t.jsx("input",{type:"time",value:M,onChange:ve=>V(ve.target.value),className:`flex-1 px-3 py-1.5 text-sm rounded-lg border ${n==="dark"?"bg-gray-600 border-gray-500 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`,placeholder:"Начало"}),t.jsx("input",{type:"time",value:U,onChange:ve=>y(ve.target.value),className:`flex-1 px-3 py-1.5 text-sm rounded-lg border ${n==="dark"?"bg-gray-600 border-gray-500 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`,placeholder:"Конец"})]}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx("button",{onClick:()=>be(ce),className:"flex-1 px-3 py-1.5 text-sm bg-[#4E6E49] hover:bg-[#4E6E49] text-white rounded-lg transition-colors",children:w===ce&&$!==null?"Сохранить":"Добавить перерыв"}),t.jsx("button",{onClick:bt,className:"px-3 py-1.5 text-sm bg-gray-500 hover:bg-gray-600 text-white rounded-lg transition-colors",children:"Отмена"})]})]}):t.jsxs("button",{onClick:()=>{A(ce),V(""),y(""),g(null),L(null),F("")},className:"w-full px-3 py-1.5 text-sm bg-blue-500 hover:bg-blue-600 text-white rounded-lg transition-colors flex items-center justify-center gap-1",children:[t.jsx(mr,{className:"w-3 h-3"}),"Добавить перерыв"]})})]},ce))}),x.length>0&&t.jsxs("p",{className:`text-sm mt-2 ${n==="dark"?"text-gray-400":"text-gray-600"}`,children:["Всего часов: ",tl(x).toFixed(1)]})]}),t.jsxs("div",{children:[t.jsxs("label",{className:`block text-xs sm:text-sm font-medium mb-2 ${n==="dark"?"text-gray-300":"text-gray-700"}`,children:["Сфера деятельности ",t.jsx("span",{className:"text-red-500",children:"*"})]}),t.jsx(K_,{selectedCategory:Te,onSelect:Q=>{pe(Q),F("")},error:!s&&!Te&&!!ue&&ue.includes("сферу")})]}),(!$e||H==="single")&&t.jsxs("div",{children:[t.jsx("p",{className:`text-xs sm:text-sm font-medium mb-3 ${n==="dark"?"text-gray-300":"text-gray-700"}`,children:"Повторы"}),t.jsxs("div",{className:"grid sm:grid-cols-2 gap-3",children:[t.jsxs("button",{type:"button",onClick:()=>{W(!P),F("")},className:`text-left rounded-xl border px-4 py-4 transition-all shadow-sm flex items-start gap-3 h-full ${P?"bg-blue-100 text-blue-800 border-blue-200 dark:bg-blue-900/30 dark:text-blue-100 dark:border-blue-800 ring-2 ring-blue-500/50 shadow-lg":n==="dark"?"border-white/10 bg-white/5 text-gray-200 hover:border-white/30":"border-slate-200 bg-white text-gray-800 hover:border-slate-300"}`,children:[t.jsx(B0,{className:"w-5 h-5 flex-shrink-0 mt-0.5"}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("p",{className:"font-semibold text-sm",children:"Повтор на неделю"}),t.jsx("p",{className:"text-xs mt-1 opacity-80",children:"Актуальная неделя по дням"}),P&&t.jsx("div",{className:"mt-3 flex flex-wrap gap-2",children:De.map((Q,ce)=>t.jsx("button",{type:"button",onClick:ve=>{ve.stopPropagation(),Pe(ce)},className:`px-2 py-1 rounded-lg text-xs transition-colors ${K.includes(ce)?"bg-blue-600 text-white":n==="dark"?"bg-gray-700 text-gray-300":"bg-gray-200 text-gray-700"}`,children:Q},ce))})]})]}),t.jsxs("button",{type:"button",onClick:()=>{q(!Y),F("")},className:`text-left rounded-xl border px-4 py-4 transition-all shadow-sm flex items-start gap-3 h-full ${Y?"bg-purple-100 text-purple-800 border-purple-200 dark:bg-purple-900/30 dark:text-purple-100 dark:border-purple-800 ring-2 ring-purple-500/50 shadow-lg":n==="dark"?"border-white/10 bg-white/5 text-gray-200 hover:border-white/30":"border-slate-200 bg-white text-gray-800 hover:border-slate-300"}`,children:[t.jsx(ir,{className:"w-5 h-5 flex-shrink-0 mt-0.5"}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("p",{className:"font-semibold text-sm",children:"Повтор по месяцу"}),t.jsx("p",{className:"text-xs mt-1 opacity-80",children:"На месяц вперед по дням"}),Y&&t.jsx("div",{className:"mt-3 flex flex-wrap gap-2",children:De.map((Q,ce)=>t.jsx("button",{type:"button",onClick:ve=>{ve.stopPropagation(),Se(ce)},className:`px-2 py-1 rounded-lg text-xs transition-colors ${R.includes(ce)?"bg-purple-600 text-white":n==="dark"?"bg-gray-700 text-gray-300":"bg-gray-200 text-gray-700"}`,children:Q},ce))})]})]})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:`block text-xs sm:text-sm font-medium mb-2 ${n==="dark"?"text-gray-300":"text-gray-700"}`,children:"Комментарий"}),t.jsx("textarea",{value:ee,onChange:Q=>te(Q.target.value),rows:3,className:`w-full px-3 sm:px-4 py-2 sm:py-2.5 text-sm sm:text-base rounded-lg border touch-manipulation resize-y ${n==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`,placeholder:"Добавьте комментарий (необязательно)"})]}),ue&&t.jsx("div",{className:"p-3 bg-red-500 text-white rounded-lg text-sm",children:ue}),t.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 sm:gap-3 pt-2",children:[t.jsxs("button",{onClick:Q=>{console.log("Save button clicked!",{loading:B,slotsCount:x.length,disabled:B||x.length===0}),Q.preventDefault(),Fr()},disabled:B||x.length===0||!s&&!Te,className:"flex-1 px-4 py-2.5 sm:py-2 bg-[#4E6E49] hover:bg-[#4E6E49] disabled:bg-gray-400 disabled:cursor-not-allowed text-white rounded-lg sm:rounded-xl transition-colors text-sm sm:text-base font-medium touch-manipulation active:scale-95 disabled:active:scale-100 relative overflow-hidden",children:[t.jsx("span",{className:`relative z-10 flex items-center justify-center gap-2 ${B?"invisible":""}`,children:B?"":s?"Обновить слот":"Отправить на согласование"}),B&&t.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:t.jsxs("div",{className:"flex items-center gap-2 text-white",children:[t.jsx("div",{className:"w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin"}),t.jsx("span",{children:"Сохранение..."})]})})]}),t.jsx("button",{onClick:e,className:`px-4 py-2.5 sm:py-2 rounded-lg sm:rounded-xl transition-colors text-sm sm:text-base font-medium touch-manipulation active:scale-95 ${n==="dark"?"bg-gray-700 hover:bg-gray-600 active:bg-gray-500":"bg-gray-200 hover:bg-gray-300 active:bg-gray-400"}`,children:"Отмена"})]})]})]})]})})})})},_0=[{key:"working",label:"Рабочий",icon:"💼",color:"from-emerald-500 to-teal-600",bgColor:"bg-emerald-500/10 border-emerald-500/20 text-emerald-600"},{key:"vacation",label:"Отпуск",icon:"🏖️",color:"from-blue-500 to-indigo-600",bgColor:"bg-blue-500/10 border-blue-500/20 text-blue-600"},{key:"sick",label:"Больничный",icon:"🤒",color:"from-orange-500 to-red-600",bgColor:"bg-orange-500/10 border-orange-500/20 text-orange-600"},{key:"weekend",label:"Выходной",icon:"🎉",color:"from-purple-500 to-pink-600",bgColor:"bg-purple-500/10 border-purple-500/20 text-purple-600"},{key:"dayoff",label:"День отдыха",icon:"🌴",color:"from-green-500 to-emerald-600",bgColor:"bg-green-500/10 border-green-500/20 text-green-600"},{key:"absence",label:"Отсутствие",icon:"❓",color:"from-amber-500 to-orange-600",bgColor:"bg-amber-500/10 border-amber-500/20 text-amber-600"},{key:"internship",label:"Стажировка",icon:"🎓",color:"from-yellow-500 to-amber-600",bgColor:"bg-yellow-500/10 border-yellow-500/20 text-yellow-600"},{key:"truancy",label:"Прогул",icon:"🚫",color:"from-red-500 to-rose-600",bgColor:"bg-red-500/10 border-red-500/20 text-red-600"}],Y_=({onClose:s,onSave:e,status:r,editingStatus:a})=>{const{user:n}=ot(),{isAdmin:i}=ft(),{theme:o}=Re(),c=o==="dark"?"text-white":"text-gray-900",d=o==="dark"?"border-gray-700":"border-gray-200",u=o==="dark"?"bg-gray-700/50":"bg-gray-100",m=!!r,[f,x]=k.useState((r==null?void 0:r.date)||oe(new Date,"yyyy-MM-dd")),[v,T]=k.useState((r==null?void 0:r.type)||null),[I,N]=k.useState((r==null?void 0:r.comment)||""),[O,D]=k.useState(""),[C,M]=k.useState(!1);ns();const V=_0.find(b=>b.key===v),U=!m||i&&(r==null?void 0:r.status)==="pending",y=async()=>{if(!v){D("Пожалуйста, выберите тип статуса");return}if(i&&m&&(r==null?void 0:r.status)==="approved"){D("Нельзя изменять одобренный статус");return}M(!0),D("");try{const b={date:f,type:v,comment:I,userId:(n==null?void 0:n.id)||"",status:i&&m?"approved":"pending"};m&&(r!=null&&r.id)?await qs(r.id,b):await sl(b),e(),s()}catch(b){console.error("Error saving day status:",b),D("Ошибка при сохранении. Попробуйте снова.")}finally{M(!1)}};return t.jsx(t.Fragment,{children:t.jsx("div",{className:"fixed inset-0 bg-slate-950/80 backdrop-blur-xl flex items-start sm:items-center justify-center z-[70] p-4 sm:p-6 touch-manipulation overflow-y-auto overscroll-contain modal-scroll",children:t.jsxs("div",{className:`relative w-full max-w-md rounded-2xl shadow-2xl ${o==="dark"?"bg-gray-800":"bg-white"}`,children:[t.jsxs("div",{className:`flex items-center justify-between p-4 sm:p-5 border-b ${d}`,children:[t.jsx("h2",{className:`text-lg sm:text-xl font-bold ${c}`,children:m?"Редактировать статус":"Добавить статус дня"}),t.jsx("button",{onClick:s,className:`p-2 rounded-lg transition-colors ${o==="dark"?"hover:bg-gray-700":"hover:bg-gray-100"}`,children:t.jsx(pt,{className:"w-5 h-5 text-gray-500"})})]}),t.jsxs("div",{className:"p-4 sm:p-5 space-y-4 sm:space-y-5",children:[O&&t.jsx("div",{className:"p-3 rounded-lg bg-red-500/10 border border-red-500/20",children:t.jsx("p",{className:"text-sm text-red-500",children:O})}),t.jsxs("div",{className:"space-y-2",children:[t.jsx("label",{className:`block text-sm font-medium ${c}`,children:"Дата"}),t.jsx("input",{type:"date",value:f,onChange:b=>x(b.target.value),disabled:!U,className:`w-full px-3 sm:px-4 py-2.5 sm:py-3 rounded-xl border ${o==="dark"?"bg-gray-700 border-gray-600 text-white":"bg-gray-50 border-gray-300 text-gray-900"} disabled:opacity-50 focus:ring-2 focus:ring-emerald-500/20 focus:border-emerald-500 transition-all`})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx("label",{className:`block text-sm font-medium ${c}`,children:"Тип статуса"}),t.jsx("div",{className:"grid grid-cols-2 gap-2 sm:gap-3",children:_0.map(b=>t.jsxs("button",{onClick:()=>U&&T(b.key),disabled:!U,className:`relative p-3 sm:p-4 rounded-xl border-2 transition-all touch-manipulation ${v===b.key?`${b.bgColor} border-current`:`${u} ${o==="dark"?"border-gray-700 hover:border-gray-600":"border-gray-200 hover:border-gray-300"}`} disabled:opacity-50 active:scale-[0.98]`,children:[t.jsx("div",{className:"text-2xl sm:text-3xl mb-1 sm:mb-2",children:b.icon}),t.jsx("div",{className:`text-xs sm:text-sm font-semibold ${v===b.key?"currentColor":o==="dark"?"text-gray-300":"text-gray-700"}`,children:b.label})]},b.key))})]}),v&&t.jsx("div",{className:`p-3 sm:p-4 rounded-xl border ${V==null?void 0:V.bgColor}`,children:t.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[t.jsx("span",{className:"text-lg sm:text-xl",children:V==null?void 0:V.icon}),t.jsxs("span",{className:"font-semibold",children:["Выбрано: ",V==null?void 0:V.label]})]})}),t.jsxs("div",{className:"space-y-2",children:[t.jsxs("label",{className:`block text-sm font-medium ${c}`,children:["Комментарий ",t.jsx("span",{className:"text-gray-400 font-normal",children:"(необязательно)"})]}),t.jsx("textarea",{value:I,onChange:b=>N(b.target.value),disabled:!U,placeholder:"Добавить заметку...",rows:3,className:`w-full px-3 sm:px-4 py-2.5 sm:py-3 rounded-xl border resize-none ${o==="dark"?"bg-gray-700 border-gray-600 text-white placeholder-gray-500":"bg-gray-50 border-gray-300 text-gray-900 placeholder-gray-400"} disabled:opacity-50 focus:ring-2 focus:ring-emerald-500/20 focus:border-emerald-500 transition-all`})]}),t.jsxs("div",{className:`flex flex-col sm:flex-row gap-3 pt-4 border-t ${d}`,children:[t.jsxs("button",{onClick:y,disabled:C||!v,className:`flex-1 px-4 py-2.5 sm:py-2 ${v?`bg-gradient-to-r ${V==null?void 0:V.color}`:"bg-gray-400"} hover:opacity-90 disabled:opacity-50 disabled:cursor-not-allowed text-white rounded-lg sm:rounded-xl transition-colors text-sm sm:text-base font-medium touch-manipulation active:scale-95 disabled:active:scale-100 relative overflow-hidden`,children:[t.jsx("span",{className:`relative z-10 flex items-center justify-center gap-2 ${C?"invisible":""}`,children:C?"":i?"Сохранить":"Отправить на согласование"}),C&&t.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:t.jsxs("div",{className:"flex items-center gap-2 text-white",children:[t.jsx("div",{className:"w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin"}),t.jsx("span",{children:"Сохранение..."})]})})]}),t.jsx("button",{onClick:s,className:`px-4 py-2.5 sm:py-2 rounded-lg sm:rounded-xl transition-colors text-sm sm:text-base font-medium touch-manipulation active:scale-95 ${o==="dark"?"bg-gray-700 hover:bg-gray-600 active:bg-gray-500":"bg-gray-200 hover:bg-gray-300 active:bg-gray-400"}`,children:"Отмена"})]})]})]})})})},X_=({onClose:s,onSave:e})=>{const{user:r}=ot(),{theme:a}=Re(),{isAdmin:n}=ft(),i=a==="dark"?"text-white":"text-gray-900",[o,c]=k.useState(n?[]:r!=null&&r.id?[r.id]:[]),[d,u]=k.useState("slots"),[m,f]=k.useState(!1),[x,v]=k.useState(!1),[T,I]=k.useState(!1),[N,O]=k.useState([]),[D,C]=k.useState([]),[M,V]=k.useState(""),[U,y]=k.useState(""),[b,E]=k.useState(""),[j,A]=k.useState(""),[w,g]=k.useState(!1);ns();const $=["Пн","Вт","Ср","Чт","Пт","Сб","Вс"],L=m?N.length>0?N.map(P=>$[P]).join(", "):"Дни недели":x?D[0]?`${oe(D[0],"dd.MM")} +${Math.max(D.length-1,0)}`:"Добавьте даты":T?U&&b?`${oe(U,"dd.MM")}–${oe(b,"dd.MM")}`:"Укажите диапазон":"Выберите режим",ee=o.map(P=>yr(P)).join(", "),te=P=>{c(W=>W.includes(P)?W.filter(K=>K!==P):[...W,P])},Y=(P,W,K)=>{if(W&&K.some(Boolean)){A("Снимите галочку с другой функции, чтобы активировать эту");return}P(W),W||A("")},q=()=>{if(!M){A("Выберите дату");return}if(D.includes(M)){A("Эта дата уже добавлена");return}C([...D,M].sort()),V(""),A("")},R=P=>C(D.filter(W=>W!==P)),S=async()=>{if(!n&&!r){A("Пользователь не найден");return}const P=n?o:r?[r.id]:[];if(P.length===0){A("Выберите хотя бы одного участника");return}if(!m&&!x&&!T){A("Выберите способ удаления");return}if(m&&N.length===0){A("Выберите день недели");return}if(x&&D.length===0){A("Добавьте хотя бы одну дату");return}if(T){if(!U||!b){A("Укажите начальную и конечную дату диапазона");return}if(U>b){A("Начальная дата должна быть раньше конечной");return}}A(""),g(!0);try{const W=await Promise.all(P.map(le=>Gr(le))),K=await Promise.all(P.map(le=>mn(le))),he=W.flat(),H=K.flat(),me=(le,ue)=>!U||!b?!1:!((ue||le)<U||le>b),G=(le,ue)=>D.length===0?!1:ue?D.some(F=>F>=le&&F<=(ue||le)):D.includes(le),se=(le,ue)=>{if(N.length===0)return!1;const F=[],B=new Date(le+"T00:00:00"),Ne=ue?new Date(ue+"T00:00:00"):new Date(le+"T00:00:00");let Te=B;for(;Te<=Ne;)F.push(oe(Te,"yyyy-MM-dd")),Te.setDate(Te.getDate()+1);return F.some(pe=>{const De=new Date(pe+"T00:00:00"),$e=De.getDay()===0?6:De.getDay()-1;return N.includes($e)})};let Z=[];if(d==="slots"?Z=he.filter(le=>!!(m&&se(le.date)||x&&D.includes(le.date)||T&&me(le.date))).map(le=>le.id):Z=H.filter(le=>le.type!==d?!1:!!(m&&se(le.date,le.endDate)||x&&G(le.date,le.endDate)||T&&me(le.date,le.endDate))).map(le=>le.id),Z.length===0){A("Ничего не найдено под выбранные условия"),g(!1);return}const ne=P.length>1?`${P.length} участников`:yr(P[0])||"участника",ie=N.map(le=>$[le]).join(", "),Ce=d==="slots"?"слоты":d==="dayoff"?"выходные":d==="sick"?"больничные":d==="vacation"?"отпуска":"прогулы",je=m?`по дням недели (${ie})`:x?`по датам: ${D.map(le=>oe(le,"dd.MM")).join(", ")}`:`по диапазону ${oe(U,"dd.MM")} — ${oe(b,"dd.MM")}`;if(!confirm(`Удалить ${Ce} (${Z.length}) ${je} для ${ne}?`)){g(!1);return}if(n){if(d==="slots")for(const le of Z)await rl(le);else for(const le of Z)await al(le);await new Promise(le=>setTimeout(le,100))}else if(d==="slots")for(const le of Z){const ue=he.find(F=>F.id===le);ue&&await $t({entity:"slot",action:"delete",authorId:(r==null?void 0:r.id)||"",targetUserId:ue.userId,before:ue,after:null,comment:`Удаление слота ${oe(ue.date,"dd.MM.yyyy")}`})}else for(const le of Z){const ue=H.find(F=>F.id===le);ue&&await $t({entity:"status",action:"delete",authorId:(r==null?void 0:r.id)||"",targetUserId:ue.userId,before:ue,after:null,comment:`Удаление ${d==="dayoff"?"выходного":d==="sick"?"больничного":d==="vacation"?"отпуска":"прогула"} ${oe(ue.date,"dd.MM.yyyy")}`})}e(),s()}catch(W){console.error("Error deleting items:",W),A("Ошибка при удалении")}finally{g(!1)}};return t.jsx("div",{className:"fixed inset-0 bg-slate-950/75 backdrop-blur-xl flex items-start sm:items-center justify-center z-[70] p-4 sm:p-6 overflow-y-auto overscroll-contain modal-scroll",children:t.jsx("div",{className:`w-full max-w-5xl rounded-3xl shadow-[0_24px_80px_rgba(0,0,0,0.45)] border ${a==="dark"?"bg-gradient-to-br from-[#0c1320] via-[#0b1220] to-[#08111b] border-white/10":"bg-gradient-to-br from-white via-slate-50 to-white border-slate-200"} max-h-[85dvh] sm:max-h-[calc(100dvh-96px)] overflow-y-auto`,children:t.jsxs("div",{className:"p-5 sm:p-6 lg:p-7 flex flex-col h-full min-h-0 overflow-y-auto modal-scroll",children:[t.jsxs("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between",children:[t.jsxs("div",{className:"space-y-1",children:[t.jsx("div",{className:"flex items-center gap-2 text-xs font-semibold text-[#4E6E49] tracking-tight",children:t.jsx("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full bg-[#4E6E49]/10 text-[#4E6E49] border border-[#4E6E49]/30",children:"Очистить расписание"})}),t.jsx("h3",{className:`text-2xl sm:text-3xl font-bold ${i}`,children:"Удаление слотов и отсутствий"})]}),t.jsx("button",{onClick:s,className:`p-2.5 rounded-full border ${a==="dark"?"border-white/10 text-gray-200 hover:bg-white/5":"border-slate-200 text-slate-600 hover:bg-slate-100"}`,children:t.jsx(pt,{className:"w-5 h-5"})})]}),t.jsxs("div",{className:"mt-5 grid lg:grid-cols-[0.95fr_1.45fr] gap-4 lg:gap-6 flex-1 overflow-hidden",children:[t.jsxs("aside",{className:`rounded-2xl border ${a==="dark"?"border-white/10 bg-white/5":"border-slate-200 bg-white"} p-4 sm:p-5 space-y-4 sticky top-0 self-start max-h-full overflow-y-auto`,children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("p",{className:"text-sm font-semibold",children:"Навигация"}),t.jsx("span",{className:"text-[11px] uppercase tracking-wide text-[#4E6E49] font-semibold",children:"3 шага"})]}),t.jsx("div",{className:"space-y-2",children:[{label:"Участники",detail:ee||"Не выбрано",done:o.length>0||!n},{label:"Тип удаления",detail:d==="slots"?"Слоты":d==="dayoff"?"Выходные":d==="sick"?"Больничные":d==="vacation"?"Отпуска":"Прогулы",done:!0},{label:"Режим",detail:L,done:L!=="Выберите режим"}].map((P,W)=>t.jsxs("div",{className:`flex items-start gap-3 rounded-xl border px-3 py-3 ${a==="dark"?"border-white/10 bg-white/5":"border-slate-200 bg-slate-50"}`,children:[t.jsx("span",{className:`mt-0.5 inline-flex h-6 w-6 items-center justify-center rounded-full text-xs font-bold ${P.done?"bg-[#4E6E49] text-white":a==="dark"?"bg-slate-800 text-gray-300":"bg-slate-200 text-slate-700"}`,children:W+1}),t.jsxs("div",{className:"flex-1",children:[t.jsx("p",{className:"text-sm font-semibold",children:P.label}),t.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 truncate",children:P.detail||"—"})]})]},P.label))}),t.jsxs("div",{className:`rounded-xl border px-3 py-3 space-y-2 ${a==="dark"?"border-emerald-900/50 bg-emerald-900/20":"border-emerald-100 bg-emerald-50"}`,children:[t.jsx("p",{className:"text-xs uppercase tracking-wide text-emerald-600 font-semibold",children:"Подсказка"}),t.jsx("p",{className:"text-sm text-emerald-700 dark:text-emerald-200",children:"Один режим за раз: дни недели, конкретные даты или диапазон."})]})]}),t.jsxs("div",{className:"space-y-4 overflow-y-auto overscroll-contain pr-1 pb-6 flex-1 min-h-0",children:[t.jsxs("div",{className:"space-y-2",children:[t.jsx("p",{className:`text-sm font-semibold ${i}`,children:"Что удаляем"}),t.jsx("div",{className:"flex flex-wrap gap-2",children:[{key:"slots",label:"Слоты"},{key:"dayoff",label:"Выходные"},{key:"sick",label:"Больничные"},{key:"vacation",label:"Отпуска"},...n?[{key:"absence",label:"Прогулы"}]:[]].map(P=>t.jsx("button",{onClick:()=>u(P.key),className:`px-3 py-1.5 rounded-lg border text-sm ${d===P.key?"bg-red-500 text-white border-red-500":a==="dark"?"bg-gray-700 text-gray-200 border-gray-700 hover:bg-gray-600":"bg-gray-100 text-gray-800 border-gray-200 hover:bg-gray-200"}`,children:P.label},P.key))})]}),n&&t.jsxs("div",{className:"space-y-2",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("p",{className:`text-sm font-semibold ${i}`,children:"Участники"}),t.jsx("button",{onClick:()=>c(P=>P.length===Ge.length?[]:Ge.map(W=>W.id)),className:"text-xs text-[#4E6E49] font-semibold",children:o.length===Ge.length?"Снять выделение":"Выбрать всех"})]}),t.jsx("div",{className:"flex flex-wrap gap-2",children:Ge.map(P=>{const W=o.includes(P.id);return t.jsx("button",{onClick:()=>te(P.id),className:`px-3 py-1.5 rounded-lg transition-colors text-sm ${W?"bg-red-500 text-white":a==="dark"?"bg-gray-700 text-gray-300 hover:bg-gray-600":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:yr(P.id)},P.id)})})]}),t.jsxs("label",{className:"flex items-center gap-2",children:[t.jsx("input",{type:"checkbox",checked:m,onChange:P=>Y(f,P.target.checked,[x,T]),className:"w-4 h-4"}),t.jsx("span",{className:`${a==="dark"?"text-gray-300":"text-gray-700"}`,children:"Удалить по дню недели"})]}),m&&t.jsxs("div",{className:"ml-6",children:[t.jsx("p",{className:`text-sm mb-2 ${a==="dark"?"text-gray-400":"text-gray-600"}`,children:"Выберите дни недели:"}),t.jsx("div",{className:"flex gap-2 flex-wrap",children:$.map((P,W)=>{const K=N.includes(W);return t.jsx("button",{onClick:()=>O(he=>K?he.filter(H=>H!==W):[...he,W]),className:`px-3 py-1 rounded-lg transition-colors ${K?"bg-red-500 text-white":a==="dark"?"bg-gray-700 text-gray-300":"bg-gray-200 text-gray-700"}`,children:P},P)})})]}),t.jsxs("label",{className:"flex items-center gap-2",children:[t.jsx("input",{type:"checkbox",checked:x,onChange:P=>Y(v,P.target.checked,[m,T]),className:"w-4 h-4"}),t.jsx("span",{className:`${a==="dark"?"text-gray-300":"text-gray-700"}`,children:"Удалить по конкретным датам"})]}),x&&t.jsxs("div",{className:"ml-6 space-y-3",children:[t.jsxs("div",{className:"flex gap-2",children:[t.jsx("input",{type:"date",value:M,onChange:P=>V(P.target.value),className:`flex-1 px-4 py-2 rounded-lg border ${a==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-red-500`}),t.jsx("button",{onClick:q,className:"px-4 py-2 bg-[#4E6E49] hover:bg-[#4E6E49] text-white rounded-lg transition-colors",children:"Добавить"})]}),D.length>0&&t.jsxs("div",{className:"space-y-2",children:[t.jsxs("p",{className:`text-sm ${a==="dark"?"text-gray-400":"text-gray-600"}`,children:["Выбранные даты (",D.length,"):"]}),t.jsx("div",{className:"flex flex-wrap gap-2",children:D.map(P=>t.jsxs("div",{className:`flex items-center gap-2 px-3 py-1 rounded-lg ${a==="dark"?"bg-gray-700":"bg-gray-100"}`,children:[t.jsx("span",{className:i,children:oe(P,"dd.MM.yyyy")}),t.jsx("button",{onClick:()=>R(P),className:"p-1 text-red-500 hover:bg-red-500 hover:text-white rounded transition-colors",children:t.jsx(pt,{className:"w-3 h-3"})})]},P))})]})]}),t.jsxs("label",{className:"flex items-center gap-2",children:[t.jsx("input",{type:"checkbox",checked:T,onChange:P=>Y(I,P.target.checked,[m,x]),className:"w-4 h-4"}),t.jsx("span",{className:`${a==="dark"?"text-gray-300":"text-gray-700"}`,children:"Удалить по диапазону дат"})]}),T&&t.jsxs("div",{className:"ml-6 space-y-3",children:[t.jsxs("div",{className:"flex gap-2",children:[t.jsxs("div",{className:"flex-1",children:[t.jsx("label",{className:`block text-xs mb-1 ${a==="dark"?"text-gray-400":"text-gray-600"}`,children:"Начальная дата"}),t.jsx("input",{type:"date",value:U,onChange:P=>y(P.target.value),className:`w-full px-4 py-2 rounded-lg border ${a==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-red-500`})]}),t.jsxs("div",{className:"flex-1",children:[t.jsx("label",{className:`block text-xs mb-1 ${a==="dark"?"text-gray-400":"text-gray-600"}`,children:"Конечная дата"}),t.jsx("input",{type:"date",value:b,onChange:P=>E(P.target.value),min:U,className:`w-full px-4 py-2 rounded-lg border ${a==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-red-500`})]})]}),U&&b&&t.jsxs("p",{className:`text-sm ${a==="dark"?"text-gray-400":"text-gray-600"}`,children:["Будет удалено: с ",oe(U,"dd.MM.yyyy")," по ",oe(b,"dd.MM.yyyy")]})]}),j&&t.jsx("div",{className:"p-3 bg-red-500 text-white rounded-lg text-sm",children:j}),t.jsxs("div",{className:"flex gap-3",children:[t.jsxs("button",{onClick:S,disabled:w||!m&&!x&&!T,className:"flex-1 px-4 py-2 bg-red-500 hover:bg-red-600 disabled:bg-gray-400 disabled:cursor-not-allowed text-white rounded-lg transition-colors flex items-center justify-center gap-2",children:[t.jsx(Et,{className:"w-4 h-4"}),w?n?"Удаление...":"Отправка на согласование...":n?"Очистить расписание":"Отправить на согласование"]}),t.jsx("button",{onClick:s,className:`px-4 py-2 rounded-lg transition-colors ${a==="dark"?"bg-gray-700 hover:bg-gray-600":"bg-gray-200 hover:bg-gray-300"}`,children:"Отмена"})]})]})]})]})})})},J_=({onClose:s,onSave:e})=>{const{user:r}=ot(),{theme:a}=Re(),{isAdmin:n}=ft(),i=a==="dark"?"text-white":"text-gray-900",[o,c]=k.useState("all"),[d,u]=k.useState(oe(new Date,"yyyy-MM-dd")),[m,f]=k.useState(oe(new Date,"yyyy-MM-dd")),[x,v]=k.useState(!1),[T,I]=k.useState(""),[N,O]=k.useState(!1),[D,C]=k.useState(""),[M,V]=k.useState(""),[U,y]=k.useState(!1),[b,E]=k.useState(!0),[j,A]=k.useState(!1),[w,g]=k.useState([]),[$,L]=k.useState(!1),[ee,te]=k.useState(!1),[Y,q]=k.useState(null);ns(),k.useEffect(()=>{x||f(d)},[x,d]),k.useEffect(()=>{R()},[]);const R=async()=>{if(n){L(!0);try{const H=await _c();g(H)}catch(H){console.error("Error loading restrictions:",H)}finally{L(!1)}}},S=H=>{q(H),c(H.type),u(H.startDate),f(H.endDate||H.startDate),v(!!H.endDate),I(H.startTime||""),O(!!H.startTime),C(H.comment||""),E(H.isActive),A(H.blockFutureDates||!1),te(!0),V("")},P=async H=>{if(confirm("Вы уверены, что хотите удалить это ограничение?"))try{await i_(H),await R(),V("")}catch(me){console.error("Error deleting restriction:",me),V(me.message||"Ошибка при удалении ограничения")}},W=()=>{q(null),c("all"),u(oe(new Date,"yyyy-MM-dd")),f(oe(new Date,"yyyy-MM-dd")),v(!1),I(""),O(!1),C(""),E(!0),A(!1),te(!0),V("")},K={slots:"Слоты",dayoff:"Выходные",sick:"Больничные",vacation:"Отпуска",absence:"Отсутствие",truancy:"Прогулы",internship:"Стажировка",all:"Всё"},he=async()=>{if(console.log("handleSave called, isAdmin:",n,"user:",r),!n){V("Только администратор может управлять ограничениями. Активируйте админ режим на странице входа.");return}if(!d){V("Выберите дату начала ограничения");return}if(x&&m&&d>m){V("Дата окончания должна быть позже даты начала");return}try{const H=await _c(!0),me=Y==null?void 0:Y.id;if(H.some(se=>{if(se.id===me)return!1;const Z=new Date(se.startDate),ne=se.endDate?new Date(se.endDate):Z,ie=new Date(d),je=!((x&&m?new Date(m):ie)<Z||ie>ne),le=se.type===o||se.type==="all"||o==="all";return je&&le})){V("Уже существует пересекающееся ограничение для этого типа/периода");return}}catch(H){console.error("Error checking restrictions:",H)}V(""),y(!0);try{const H={type:o,startDate:d,...x&&m!==d&&{endDate:m},...N&&T&&{startTime:T},...j&&{blockFutureDates:j},...D&&{comment:D},createdBy:(r==null?void 0:r.id)||"admin",createdAt:(Y==null?void 0:Y.createdAt)||new Date().toISOString(),isActive:b};Y?await n_(Y.id,H):await a_(H),await R(),te(!1),e()}catch(H){console.error("Error saving restriction:",H),V(H.message||"Ошибка при сохранении ограничения")}finally{y(!1)}};return t.jsx("div",{className:"fixed inset-0 bg-slate-950/75 backdrop-blur-xl flex items-start sm:items-center justify-center z-[70] p-4 sm:p-6 touch-manipulation overflow-y-auto",children:t.jsx("div",{className:`w-full max-w-2xl rounded-3xl shadow-[0_24px_80px_rgba(0,0,0,0.45)] border ${a==="dark"?"bg-gradient-to-br from-[#0c1320] via-[#0b1220] to-[#08111b] border-white/10":"bg-gradient-to-br from-white via-slate-50 to-white border-slate-200"} max-h-[90vh] overflow-y-auto`,children:t.jsxs("div",{className:"p-4 sm:p-6 lg:p-7 flex flex-col h-full min-h-0 overflow-y-auto",children:[t.jsxs("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between",children:[t.jsxs("div",{className:"space-y-1",children:[t.jsx("div",{className:"flex items-center gap-2 text-xs font-semibold text-orange-600 tracking-tight",children:t.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full bg-orange-500/10 text-orange-600 border border-orange-500/30",children:[t.jsx(xt,{className:"w-3 h-3"}),"Управление ограничениями"]})}),t.jsx("h3",{className:`text-2xl sm:text-3xl font-bold ${i}`,children:"Ограничения для команды"}),t.jsx("p",{className:`text-sm ${a==="dark"?"text-gray-400":"text-gray-600"}`,children:"Запретить участникам создавать определённые записи в указанный период"})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsxs("div",{className:`px-3 py-2 rounded-xl border text-xs sm:text-sm ${a==="dark"?"border-white/10 bg-white/5 text-gray-200":"border-slate-200 bg-slate-50 text-slate-700"}`,children:["Админ · Управление ",n?"(активен)":"(не активен)"]}),t.jsx("button",{onClick:s,className:`p-2.5 rounded-full border ${a==="dark"?"border-white/10 text-gray-200 hover:bg-white/5":"border-slate-200 text-slate-600 hover:bg-slate-100"} transition-colors touch-manipulation`,"aria-label":"Закрыть",children:t.jsx(pt,{className:"w-4 h-4 sm:w-5 sm:h-5"})})]})]}),t.jsxs("div",{className:"mt-5 space-y-6 flex-1 min-h-0",children:[t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsx("h4",{className:`text-lg font-semibold ${i}`,children:"Существующие ограничения"}),t.jsxs("div",{className:"flex gap-2",children:[t.jsxs("button",{onClick:W,className:`flex items-center gap-2 px-3 py-2 rounded-lg text-sm font-medium transition-colors ${ee?"bg-orange-500 text-white":a==="dark"?"bg-gray-700 text-gray-200 hover:bg-gray-600":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:[t.jsx(mr,{className:"w-4 h-4"}),ee?"Создать новое":"Создать ограничение"]}),t.jsxs("button",{onClick:async()=>{const H=oe(new Date,"yyyy-MM-dd"),me=await Ec("slots",H,"10:00");alert(`Test result: ${me.restricted?"BLOCKED":"ALLOWED"}
${me.reason||"No restrictions"}`)},className:"flex items-center gap-2 px-3 py-2 rounded-lg text-sm font-medium bg-blue-500 text-white hover:bg-blue-600 transition-colors",children:[t.jsx(xt,{className:"w-4 h-4"}),"Тест ограничений"]})]})]}),$?t.jsx("div",{className:`p-6 rounded-xl border ${a==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-gray-50"} text-center`,children:t.jsx("p",{className:a==="dark"?"text-gray-400":"text-gray-600",children:"Загрузка..."})}):w.length===0?t.jsxs("div",{className:`p-6 rounded-xl border ${a==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-gray-50"} text-center`,children:[t.jsx(nr,{className:`w-8 h-8 mx-auto mb-2 ${a==="dark"?"text-gray-400":"text-gray-500"}`}),t.jsx("p",{className:a==="dark"?"text-gray-400":"text-gray-600",children:"Нет активных ограничений"})]}):t.jsx("div",{className:"space-y-3",children:w.map(H=>t.jsx("div",{className:`p-4 rounded-xl border transition-all ${H.isActive?a==="dark"?"border-orange-500/30 bg-orange-500/5":"border-orange-200 bg-orange-50":a==="dark"?"border-gray-600 bg-gray-800/50":"border-gray-300 bg-gray-100"}`,children:t.jsxs("div",{className:"flex items-start justify-between",children:[t.jsxs("div",{className:"flex-1",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[t.jsxs("span",{className:`inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium ${H.isActive?"bg-orange-100 text-orange-800 dark:bg-orange-900/50 dark:text-orange-200":"bg-gray-100 text-gray-600 dark:bg-gray-700 dark:text-gray-400"}`,children:[H.isActive?t.jsx(nr,{className:"w-3 h-3"}):t.jsx(xt,{className:"w-3 h-3"}),K[H.type]]}),!H.isActive&&t.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Неактивно"})]}),t.jsxs("div",{className:"space-y-1 text-sm",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(ir,{className:"w-4 h-4 text-gray-500"}),t.jsx("span",{className:i,children:H.endDate?`${oe(H.startDate,"dd.MM.yyyy")} - ${oe(H.endDate,"dd.MM.yyyy")}`:oe(H.startDate,"dd.MM.yyyy")})]}),H.startTime&&t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(Lt,{className:"w-4 h-4 text-gray-500"}),t.jsxs("span",{className:a==="dark"?"text-gray-300":"text-gray-700",children:["С ",H.startTime]})]}),H.blockFutureDates&&t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(nr,{className:"w-4 h-4 text-amber-500"}),t.jsx("span",{className:`text-xs ${a==="dark"?"text-amber-300":"text-amber-700"}`,children:"Блокировка следующего дня после наступления времени ограничения"})]}),H.comment&&t.jsx("div",{className:"text-gray-600 dark:text-gray-400 italic",children:H.comment})]})]}),t.jsxs("div",{className:"flex items-center gap-1 ml-4",children:[t.jsx("button",{onClick:()=>S(H),className:"p-2 text-blue-500 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded-lg transition-colors",title:"Редактировать",children:t.jsx(ar,{className:"w-4 h-4"})}),t.jsx("button",{onClick:()=>P(H.id),className:"p-2 text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition-colors",title:"Удалить",children:t.jsx(Et,{className:"w-4 h-4"})})]})]})},H.id))})]}),ee&&t.jsxs("div",{className:"border-t pt-6",children:[t.jsx("h4",{className:`text-lg font-semibold mb-4 ${i}`,children:Y?"Редактировать ограничение":"Создать новое ограничение"}),t.jsxs("div",{children:[t.jsx("label",{className:`block text-xs sm:text-sm font-medium mb-3 ${a==="dark"?"text-gray-300":"text-gray-700"}`,children:"Что запретить"}),t.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-3",children:Object.entries(K).map(([H,me])=>t.jsxs("label",{className:`relative flex items-center gap-3 p-3 rounded-xl border cursor-pointer transition-all ${o===H?"bg-orange-100 text-orange-800 border-orange-200 dark:bg-orange-900/30 dark:text-orange-100 dark:border-orange-800 ring-2 ring-orange-500/50 shadow-lg":a==="dark"?"border-white/10 bg-white/5 text-gray-200 hover:border-white/30":"border-slate-200 bg-white text-gray-800 hover:border-slate-300"}`,children:[t.jsx("input",{type:"radio",value:H,checked:o===H,onChange:G=>c(G.target.value),className:"hidden"}),t.jsx("span",{className:`text-sm font-semibold ${o===H?"text-orange-700 dark:text-orange-200":""}`,children:me})]},H))})]}),t.jsxs("div",{children:[t.jsx("label",{className:`block text-xs sm:text-sm font-medium mb-3 ${a==="dark"?"text-gray-300":"text-gray-700"}`,children:"Период ограничения"}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsxs("label",{className:"flex items-center gap-2 text-sm cursor-pointer",children:[t.jsx("input",{type:"radio",checked:!x,onChange:()=>v(!1),className:`w-4 h-4 rounded border-2 ${a==="dark"?"border-gray-800 bg-gray-700 checked:bg-[#4E6E49] checked:border-[#4E6E49]":"border-gray-300 bg-white checked:bg-[#4E6E49] checked:border-[#4E6E49]"} focus:ring-2 focus:ring-[#4E6E49] cursor-pointer touch-manipulation`}),t.jsx("span",{className:a==="dark"?"text-gray-200":"text-gray-700",children:"Один день"})]}),t.jsxs("label",{className:"flex items-center gap-2 text-sm cursor-pointer",children:[t.jsx("input",{type:"radio",checked:x,onChange:()=>v(!0),className:`w-4 h-4 rounded border-2 ${a==="dark"?"border-gray-800 bg-gray-700 checked:bg-[#4E6E49] checked:border-[#4E6E49]":"border-gray-300 bg-white checked:bg-[#4E6E49] checked:border-[#4E6E49]"} focus:ring-2 focus:ring-[#4E6E49] cursor-pointer touch-manipulation`}),t.jsx("span",{className:a==="dark"?"text-gray-200":"text-gray-700",children:"Диапазон дат"})]})]}),t.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:`block text-xs sm:text-sm font-medium mb-2 ${a==="dark"?"text-gray-300":"text-gray-700"}`,children:"Дата начала"}),t.jsx("input",{type:"date",value:d,onChange:H=>u(H.target.value),className:`w-full px-3 sm:px-4 py-2 sm:py-2.5 text-sm sm:text-base rounded-lg border touch-manipulation ${a==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`})]}),x&&t.jsxs("div",{children:[t.jsx("label",{className:`block text-xs sm:text-sm font-medium mb-2 ${a==="dark"?"text-gray-300":"text-gray-700"}`,children:"Дата окончания"}),t.jsx("input",{type:"date",value:m,min:d,onChange:H=>f(H.target.value),className:`w-full px-3 sm:px-4 py-2 sm:py-2.5 text-sm sm:text-base rounded-lg border touch-manipulation ${a==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`})]})]})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:`block text-xs sm:text-sm font-medium mb-3 ${a==="dark"?"text-gray-300":"text-gray-700"}`,children:"Временное ограничение"}),t.jsxs("div",{className:"space-y-3",children:[t.jsxs("label",{className:"flex items-center gap-2 text-sm cursor-pointer",children:[t.jsx("input",{type:"checkbox",checked:N,onChange:H=>O(H.target.checked),className:`w-4 h-4 rounded border-2 ${a==="dark"?"border-gray-800 bg-gray-700 checked:bg-[#4E6E49] checked:border-[#4E6E49]":"border-gray-300 bg-white checked:bg-[#4E6E49] checked:border-[#4E6E49]"} focus:ring-2 focus:ring-[#4E6E49] cursor-pointer touch-manipulation`}),t.jsx("span",{className:a==="dark"?"text-gray-200":"text-gray-700",children:"Запретить начиная с определённого времени"})]}),N&&t.jsxs("div",{className:"ml-6",children:[t.jsx("label",{className:`block text-xs sm:text-sm font-medium mb-2 ${a==="dark"?"text-gray-300":"text-gray-700"}`,children:"Время начала ограничения"}),t.jsx("input",{type:"time",value:T,onChange:H=>I(H.target.value),className:`w-full max-w-xs px-3 sm:px-4 py-2 sm:py-2.5 text-sm sm:text-base rounded-lg border touch-manipulation ${a==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`})]})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:`block text-xs sm:text-sm font-medium mb-2 ${a==="dark"?"text-gray-300":"text-gray-700"}`,children:"Комментарий"}),t.jsx("textarea",{value:D,onChange:H=>C(H.target.value),rows:3,className:`w-full px-3 sm:px-4 py-2 sm:py-2.5 text-sm sm:text-base rounded-lg border touch-manipulation resize-y ${a==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`,placeholder:"Причина ограничения (необязательно)"})]}),Y&&t.jsx("div",{children:t.jsxs("label",{className:"flex items-center gap-2 text-sm cursor-pointer",children:[t.jsx("input",{type:"checkbox",checked:b,onChange:H=>E(H.target.checked),className:`w-4 h-4 rounded border-2 ${a==="dark"?"border-gray-800 bg-gray-700 checked:bg-[#4E6E49] checked:border-[#4E6E49]":"border-gray-300 bg-white checked:bg-[#4E6E49] checked:border-[#4E6E49]"} focus:ring-2 focus:ring-[#4E6E49] cursor-pointer touch-manipulation`}),t.jsx("span",{className:a==="dark"?"text-gray-200":"text-gray-700",children:"Ограничение активно"})]})}),t.jsxs("div",{children:[t.jsxs("label",{className:"flex items-center gap-2 text-sm cursor-pointer",children:[t.jsx("input",{type:"checkbox",checked:j,onChange:H=>A(H.target.checked),className:`w-4 h-4 rounded border-2 ${a==="dark"?"border-gray-800 bg-gray-700 checked:bg-[#4E6E49] checked:border-[#4E6E49]":"border-gray-300 bg-white checked:bg-[#4E6E49] checked:border-[#4E6E49]"} focus:ring-2 focus:ring-[#4E6E49] cursor-pointer touch-manipulation`}),t.jsx("span",{className:a==="dark"?"text-gray-200":"text-gray-700",children:"После наступления даты/времени ограничения блокировать создание записей только на следующий день"})]}),j&&t.jsx("p",{className:`mt-2 text-xs ${a==="dark"?"text-gray-400":"text-gray-600"}`,children:"Пример: после 14.12 21:00 нельзя будет создавать слоты/отпуска только на 15.12 (следующий день)"})]}),M&&t.jsx("div",{className:"p-3 bg-red-500 text-white rounded-lg text-sm",children:M}),t.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 sm:gap-3 pt-2",children:[t.jsx("button",{onClick:he,disabled:U,className:"flex-1 px-4 py-2.5 sm:py-2 bg-orange-500 hover:bg-orange-600 disabled:bg-gray-400 disabled:cursor-not-allowed text-white rounded-lg sm:rounded-xl transition-colors text-sm sm:text-base font-medium touch-manipulation active:scale-95 disabled:active:scale-100",children:U?"Сохранение...":Y?"Сохранить изменения":"Создать ограничение"}),t.jsx("button",{onClick:s,className:`px-4 py-2.5 sm:py-2 rounded-lg sm:rounded-xl transition-colors text-sm sm:text-base font-medium touch-manipulation active:scale-95 ${a==="dark"?"bg-gray-700 hover:bg-gray-600 active:bg-gray-500":"bg-gray-200 hover:bg-gray-300 active:bg-gray-400"}`,children:"Отмена"})]})]})]})]})})})},Z_=({onClose:s})=>{const{theme:e}=Re(),{user:r}=ot(),{isAdmin:a}=ft();ns();const[n,i]=k.useState([]),[o,c]=k.useState(!0),[d,u]=k.useState(!1),[m,f]=k.useState(""),[x,v]=k.useState(null),[T,I]=k.useState(!1),[N,O]=k.useState({userId:"",restrictedUserId:"",reason:"",isActive:!0});k.useEffect(()=>{D()},[]);const D=async()=>{try{const j=await Kp();i(j)}catch(j){console.error("Error loading conflicts:",j)}finally{c(!1)}},C=async j=>{if(j.preventDefault(),!r&&!a){f("Пользователь не найден (необходима авторизация)");return}u(!0),f("");try{const A={...N,createdBy:(r==null?void 0:r.id)||"admin",createdAt:new Date().toISOString()};x?await b0(x.id,A):await T_(A),await D(),y(),I(!1),v(null)}catch(A){console.error("Error saving conflict:",A),f(A.message||"Ошибка при сохранении конфликта")}finally{u(!1)}},M=j=>{v(j),O({userId:j.userId,restrictedUserId:j.restrictedUserId,reason:j.reason||"",isActive:j.isActive}),f(""),I(!0)},V=async j=>{if(confirm("Удалить конфликт?"))try{await S_(j),await D()}catch(A){console.error("Error deleting conflict:",A)}},U=async j=>{try{await b0(j.id,{isActive:!j.isActive}),await D()}catch(A){console.error("Error toggling conflict status:",A)}},y=()=>{f(""),O({userId:"",restrictedUserId:"",reason:"",isActive:!0})},b=j=>{const A=Ge.find(w=>w.id===j);return(A==null?void 0:A.name)||j},E=Ge.filter(j=>j.id!==N.userId);return o?t.jsx("div",{className:"flex items-center justify-center p-8",children:t.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-4 border-[#4E6E49] border-t-transparent"})}):t.jsx("div",{className:"fixed inset-0 bg-slate-950/75 backdrop-blur-xl flex items-start sm:items-center justify-center z-[70] p-4 overflow-y-auto touch-manipulation",children:t.jsxs("div",{className:`w-full max-w-4xl rounded-3xl shadow-[0_24px_80px_rgba(0,0,0,0.45)] border ${e==="dark"?"bg-gradient-to-br from-[#0c1320] via-[#0b1220] to-[#08111b] border-white/10":"bg-gradient-to-br from-white via-slate-50 to-white border-slate-200"} max-h-[90vh] overflow-hidden flex flex-col`,children:[t.jsx("div",{className:"p-6 border-b border-white/10",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"w-10 h-10 rounded-xl flex items-center justify-center bg-red-500/10 text-red-500",children:t.jsx(Xl,{className:"w-5 h-5"})}),t.jsxs("div",{children:[t.jsx("h3",{className:`text-xl font-bold ${e==="dark"?"text-white":"text-gray-900"}`,children:"Управление конфликтами пользователей"}),t.jsx("p",{className:`text-sm ${e==="dark"?"text-gray-400":"text-gray-600"}`,children:"Настройте ограничения на совместную работу пользователей"})]})]}),t.jsx("button",{onClick:s,className:`p-2 rounded-full border ${e==="dark"?"border-white/10 text-gray-200 hover:bg-white/5":"border-slate-200 text-slate-600 hover:bg-slate-100"} transition-colors`,children:t.jsx(pt,{className:"w-5 h-5"})})]})}),t.jsx("div",{className:"flex-1 overflow-y-auto",children:t.jsx("div",{className:"p-6",children:t.jsxs("div",{className:"space-y-6",children:[(T||x)&&t.jsxs("div",{className:`rounded-2xl border p-6 ${e==="dark"?"border-white/10 bg-white/5":"border-slate-200 bg-slate-50"}`,children:[t.jsx("h4",{className:`text-lg font-semibold mb-4 ${e==="dark"?"text-white":"text-gray-900"}`,children:x?"Редактировать конфликт":"Добавить конфликт"}),m&&t.jsxs("div",{className:"mb-4 p-3 rounded-lg bg-red-500/10 border border-red-500/20 flex items-start gap-3",children:[t.jsx(Ki,{className:"w-5 h-5 text-red-500 shrink-0 mt-0.5"}),t.jsx("p",{className:"text-sm text-red-500",children:m})]}),t.jsxs("form",{onSubmit:C,className:"space-y-4",children:[t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:`block text-sm font-medium mb-2 ${e==="dark"?"text-gray-300":"text-gray-700"}`,children:"Пользователь"}),t.jsxs("select",{value:N.userId,onChange:j=>O(A=>({...A,userId:j.target.value})),className:`w-full px-3 py-2 rounded-lg border ${e==="dark"?"bg-gray-700 border-gray-600 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`,required:!0,children:[t.jsx("option",{value:"",children:"Выберите пользователя"}),Ge.map(j=>t.jsx("option",{value:j.id,children:j.name},j.id))]})]}),t.jsxs("div",{children:[t.jsx("label",{className:`block text-sm font-medium mb-2 ${e==="dark"?"text-gray-300":"text-gray-700"}`,children:"Запрещено работать с"}),t.jsxs("select",{value:N.restrictedUserId,onChange:j=>O(A=>({...A,restrictedUserId:j.target.value})),className:`w-full px-3 py-2 rounded-lg border ${e==="dark"?"bg-gray-700 border-gray-600 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`,required:!0,children:[t.jsx("option",{value:"",children:"Выберите пользователя"}),E.map(j=>t.jsx("option",{value:j.id,children:j.name},j.id))]})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:`block text-sm font-medium mb-2 ${e==="dark"?"text-gray-300":"text-gray-700"}`,children:"Причина (опционально)"}),t.jsx("textarea",{value:N.reason,onChange:j=>O(A=>({...A,reason:j.target.value})),className:`w-full px-3 py-2 rounded-lg border resize-none ${e==="dark"?"bg-gray-700 border-gray-600 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`,rows:3,placeholder:"Объяснение ограничения..."})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("input",{type:"checkbox",id:"isActive",checked:N.isActive,onChange:j=>O(A=>({...A,isActive:j.target.checked})),className:"rounded border-gray-300 text-[#4E6E49] focus:ring-[#4E6E49]"}),t.jsx("label",{htmlFor:"isActive",className:`text-sm ${e==="dark"?"text-gray-300":"text-gray-700"}`,children:"Активно"})]}),t.jsxs("div",{className:"flex gap-3 pt-4",children:[t.jsx("button",{type:"submit",disabled:d,className:"flex-1 px-4 py-2 bg-[#4E6E49] hover:bg-[#4E6E49] text-white rounded-lg transition-colors disabled:opacity-50 flex items-center justify-center gap-2",children:d?t.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-white border-t-transparent"}):t.jsxs(t.Fragment,{children:[t.jsx(Rc,{className:"w-4 h-4"}),x?"Сохранить":"Добавить"]})}),t.jsx("button",{type:"button",onClick:()=>{y(),I(!1),v(null)},className:`px-4 py-2 rounded-lg border ${e==="dark"?"border-gray-600 text-gray-200 hover:bg-gray-700":"border-gray-300 text-gray-700 hover:bg-gray-100"} transition-colors`,children:"Отмена"})]})]})]}),t.jsxs("div",{className:`rounded-2xl border ${e==="dark"?"border-white/10 bg-white/5":"border-slate-200 bg-white"}`,children:[t.jsx("div",{className:"p-6 border-b border-white/10",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("h4",{className:`text-lg font-semibold ${e==="dark"?"text-white":"text-gray-900"}`,children:["Активные конфликты (",n.filter(j=>j.isActive).length,")"]}),t.jsxs("button",{onClick:()=>{f(""),I(!0)},className:"px-4 py-2 bg-[#4E6E49] hover:bg-[#4E6E49] text-white rounded-lg transition-colors flex items-center gap-2",children:[t.jsx(mr,{className:"w-4 h-4"}),"Добавить конфликт"]})]})}),t.jsx("div",{className:"p-6",children:n.length===0?t.jsxs("div",{className:"text-center py-8",children:[t.jsx(Xl,{className:`w-12 h-12 mx-auto mb-4 ${e==="dark"?"text-gray-600":"text-gray-400"}`}),t.jsx("p",{className:`text-lg ${e==="dark"?"text-gray-400":"text-gray-600"}`,children:"Нет настроенных конфликтов"})]}):t.jsx("div",{className:"space-y-4",children:n.map(j=>t.jsxs("div",{className:`flex items-center justify-between p-4 rounded-xl border ${j.isActive?e==="dark"?"border-red-500/30 bg-red-500/10":"border-red-200 bg-red-50":e==="dark"?"border-gray-600 bg-gray-700/50":"border-gray-200 bg-gray-50"}`,children:[t.jsxs("div",{className:"flex-1",children:[t.jsxs("div",{className:`font-medium ${e==="dark"?"text-white":"text-gray-900"}`,children:[b(j.userId)," ↔ ",b(j.restrictedUserId)]}),j.reason&&t.jsx("div",{className:`text-sm mt-1 ${e==="dark"?"text-gray-400":"text-gray-600"}`,children:j.reason}),t.jsxs("div",{className:"text-xs mt-1 text-gray-500",children:["Создано: ",new Date(j.createdAt).toLocaleDateString("ru-RU")]})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("button",{onClick:()=>U(j),className:`px-3 py-1 rounded-full text-xs font-medium transition-colors ${j.isActive?"bg-red-500 text-white":e==="dark"?"bg-gray-600 text-gray-300":"bg-gray-200 text-gray-700"}`,children:j.isActive?"Активен":"Неактивен"}),t.jsx("button",{onClick:()=>M(j),className:`p-2 rounded-lg ${e==="dark"?"hover:bg-gray-700 text-gray-400":"hover:bg-gray-100 text-gray-600"} transition-colors`,children:t.jsx(ar,{className:"w-4 h-4"})}),t.jsx("button",{onClick:()=>V(j.id),className:"p-2 rounded-lg text-red-500 hover:bg-red-500 hover:text-white transition-colors",children:t.jsx(Et,{className:"w-4 h-4"})})]})]},j.id))})})]})]})})})]})})},E0=[{value:"all",label:"Весь сайт",description:"Полная блокировка доступа ко всему сайту"},{value:"tools",label:"Раздел Tools",description:"Скрыть раздел Tools из меню"},{value:"tools_meme_evaluation",label:"Tools → Meme Evaluation",description:"Заблокировать просмотр оценки мемов"},{value:"tools_ai_ao_alerts",label:"Tools → AI-AO Alerts",description:"Заблокировать AI - AO Alerts"},{value:"tools_signals_trigger_bot",label:"Tools → Signals Trigger Bot",description:"Заблокировать Signals Trigger Bot"},{value:"avf_hub",label:"AVF HUB",description:"Блокировать доступ к разделу AVF HUB"},{value:"about",label:"О нас (AVF INFO)",description:"Блокировать доступ к разделу О нас"},{value:"slots",label:"Управление слотами",description:"Блокировать создание/редактирование слотов"},{value:"earnings",label:"Доходы",description:"Блокировать добавление доходов"},{value:"tasks",label:"Задачи",description:"Блокировать управление задачами"},{value:"rating",label:"Рейтинг",description:"Блокировать просмотр рейтинга"},{value:"profile",label:"Профиль",description:"Блокировать редактирование профиля"}],e4=({onClose:s})=>{const{theme:e}=Re(),{user:r}=ot(),{isAdmin:a}=ft();ns();const[n,i]=k.useState([]),[o,c]=k.useState(!0),[d,u]=k.useState(!1),[m,f]=k.useState(""),[x,v]=k.useState(null),[T,I]=k.useState(!1),[N,O]=k.useState({userId:"",reason:"",expiresAt:"",blockFeatures:[],isActive:!0});k.useEffect(()=>{D()},[]);const D=async()=>{try{const w=await I_(!0);i(w)}catch(w){console.error("Error loading blocks:",w)}finally{c(!1)}},C=async w=>{if(w.preventDefault(),!r&&!a){f("Пользователь не найден (необходима авторизация)");return}u(!0),f("");try{const g={reason:N.reason,blockFeatures:N.blockFeatures,isActive:N.isActive,createdBy:(r==null?void 0:r.id)||"admin",createdAt:new Date().toISOString(),userId:N.userId||"",...N.expiresAt?{expiresAt:N.expiresAt}:{}};x?await To(x.id,g):await A_(g),await D(),b(),I(!1),v(null)}catch(g){console.error("Error saving block:",g),f(g.message||"Ошибка при сохранении блокировки")}finally{u(!1)}},M=w=>{v(w),O({userId:w.userId||"",reason:w.reason,expiresAt:w.expiresAt||"",blockFeatures:w.blockFeatures,isActive:w.isActive}),f(""),I(!0)},V=async w=>{if(confirm("Удалить блокировку доступа?"))try{await C_(w),await D()}catch(g){console.error("Error deleting block:",g)}},U=async w=>{try{await To(w.id,{isActive:!w.isActive}),await D()}catch(g){console.error("Error toggling block status:",g)}},y=w=>{O(g=>({...g,blockFeatures:g.blockFeatures.includes(w)?g.blockFeatures.filter($=>$!==w):[...g.blockFeatures,w]}))},b=()=>{f(""),O({userId:"",reason:"",expiresAt:"",blockFeatures:[],isActive:!0})},E=w=>{if(!w)return"Все пользователи";const g=Ge.find($=>$.id===w);return(g==null?void 0:g.name)||w},j=w=>{const g=E0.find($=>$.value===w);return(g==null?void 0:g.label)||w},A=w=>w?new Date(w)<new Date:!1;return o?t.jsx("div",{className:"flex items-center justify-center p-8",children:t.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-4 border-[#4E6E49] border-t-transparent"})}):t.jsx("div",{className:"fixed inset-0 bg-slate-950/75 backdrop-blur-xl flex items-start sm:items-center justify-center z-[70] p-4 overflow-y-auto touch-manipulation",children:t.jsxs("div",{className:`w-full max-w-4xl rounded-3xl shadow-[0_24px_80px_rgba(0,0,0,0.45)] border ${e==="dark"?"bg-gradient-to-br from-[#0c1320] via-[#0b1220] to-[#08111b] border-white/10":"bg-gradient-to-br from-white via-slate-50 to-white border-slate-200"} max-h-[90vh] overflow-hidden flex flex-col`,children:[t.jsx("div",{className:"p-6 border-b border-white/10",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"w-10 h-10 rounded-xl flex items-center justify-center bg-red-500/10 text-red-500",children:t.jsx(Co,{className:"w-5 h-5"})}),t.jsxs("div",{children:[t.jsx("h3",{className:`text-xl font-bold ${e==="dark"?"text-white":"text-gray-900"}`,children:"Управление доступом"}),t.jsx("p",{className:`text-sm ${e==="dark"?"text-gray-400":"text-gray-600"}`,children:"Блокировка доступа к функциям сайта"})]})]}),t.jsx("button",{onClick:s,className:`p-2 rounded-full border ${e==="dark"?"border-white/10 text-gray-200 hover:bg-white/5":"border-slate-200 text-slate-600 hover:bg-slate-100"} transition-colors`,children:t.jsx(pt,{className:"w-5 h-5"})})]})}),t.jsx("div",{className:"flex-1 overflow-y-auto",children:t.jsx("div",{className:"p-6",children:t.jsxs("div",{className:"space-y-6",children:[(T||x)&&t.jsxs("div",{className:`rounded-2xl border p-6 ${e==="dark"?"border-white/10 bg-white/5":"border-slate-200 bg-slate-50"}`,children:[t.jsx("h4",{className:`text-lg font-semibold mb-4 ${e==="dark"?"text-white":"text-gray-900"}`,children:x?"Редактировать блокировку":"Добавить блокировку"}),m&&t.jsxs("div",{className:"mb-4 p-3 rounded-lg bg-red-500/10 border border-red-500/20 flex items-start gap-3",children:[t.jsx(Ki,{className:"w-5 h-5 text-red-500 shrink-0 mt-0.5"}),t.jsx("p",{className:"text-sm text-red-500",children:m})]}),t.jsxs("form",{onSubmit:C,className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:`block text-sm font-medium mb-2 ${e==="dark"?"text-gray-300":"text-gray-700"}`,children:"Пользователь (оставьте пустым для блокировки всем)"}),t.jsxs("select",{value:N.userId,onChange:w=>O(g=>({...g,userId:w.target.value})),className:`w-full px-3 py-2 rounded-lg border ${e==="dark"?"bg-gray-700 border-gray-600 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`,children:[t.jsx("option",{value:"",children:"Все пользователи"}),Ge.map(w=>t.jsx("option",{value:w.id,children:w.name},w.id))]})]}),t.jsxs("div",{children:[t.jsx("label",{className:`block text-sm font-medium mb-2 ${e==="dark"?"text-gray-300":"text-gray-700"}`,children:"Блокируемые функции"}),t.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:E0.map(w=>t.jsxs("label",{className:`flex items-start gap-3 p-3 rounded-lg border cursor-pointer transition-colors ${N.blockFeatures.includes(w.value)?e==="dark"?"border-red-500/50 bg-red-500/10":"border-red-200 bg-red-50":e==="dark"?"border-gray-600 hover:border-gray-500":"border-gray-200 hover:border-gray-300"}`,children:[t.jsx("input",{type:"checkbox",checked:N.blockFeatures.includes(w.value),onChange:()=>y(w.value),className:"mt-0.5 rounded border-gray-300 text-red-500 focus:ring-red-500"}),t.jsxs("div",{className:"flex-1",children:[t.jsx("div",{className:`font-medium text-sm ${e==="dark"?"text-white":"text-gray-900"}`,children:w.label}),t.jsx("div",{className:`text-xs ${e==="dark"?"text-gray-400":"text-gray-600"}`,children:w.description})]})]},w.value))})]}),t.jsxs("div",{children:[t.jsx("label",{className:`block text-sm font-medium mb-2 ${e==="dark"?"text-gray-300":"text-gray-700"}`,children:"Причина блокировки *"}),t.jsx("textarea",{value:N.reason,onChange:w=>O(g=>({...g,reason:w.target.value})),className:`w-full px-3 py-2 rounded-lg border resize-none ${e==="dark"?"bg-gray-700 border-gray-600 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`,rows:3,placeholder:"Объяснение блокировки...",required:!0})]}),t.jsxs("div",{children:[t.jsx("label",{className:`block text-sm font-medium mb-2 ${e==="dark"?"text-gray-300":"text-gray-700"}`,children:"Дата окончания (опционально)"}),t.jsx("input",{type:"datetime-local",value:N.expiresAt,onChange:w=>O(g=>({...g,expiresAt:w.target.value})),className:`w-full px-3 py-2 rounded-lg border ${e==="dark"?"bg-gray-700 border-gray-600 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("input",{type:"checkbox",id:"isActive",checked:N.isActive,onChange:w=>O(g=>({...g,isActive:w.target.checked})),className:"rounded border-gray-300 text-red-500 focus:ring-red-500"}),t.jsx("label",{htmlFor:"isActive",className:`text-sm ${e==="dark"?"text-gray-300":"text-gray-700"}`,children:"Активна"})]}),t.jsxs("div",{className:"flex gap-3 pt-4",children:[t.jsx("button",{type:"submit",disabled:d||N.blockFeatures.length===0,className:"flex-1 px-4 py-2 bg-red-500 hover:bg-red-600 text-white rounded-lg transition-colors disabled:opacity-50 flex items-center justify-center gap-2",children:d?t.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-white border-t-transparent"}):t.jsxs(t.Fragment,{children:[t.jsx(Rc,{className:"w-4 h-4"}),x?"Сохранить":"Заблокировать"]})}),t.jsx("button",{type:"button",onClick:()=>{b(),I(!1),v(null)},className:`px-4 py-2 rounded-lg border ${e==="dark"?"border-gray-600 text-gray-200 hover:bg-gray-700":"border-gray-300 text-gray-700 hover:bg-gray-100"} transition-colors`,children:"Отмена"})]})]})]}),t.jsxs("div",{className:`rounded-2xl border ${e==="dark"?"border-white/10 bg-white/5":"border-slate-200 bg-white"}`,children:[t.jsx("div",{className:"p-6 border-b border-white/10",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("h4",{className:`text-lg font-semibold ${e==="dark"?"text-white":"text-gray-900"}`,children:["Активные блокировки (",n.filter(w=>w.isActive).length,")"]}),t.jsxs("button",{onClick:()=>{f(""),I(!0)},className:"px-4 py-2 bg-red-500 hover:bg-red-600 text-white rounded-lg transition-colors flex items-center gap-2",children:[t.jsx(mr,{className:"w-4 h-4"}),"Добавить блокировку"]})]})}),t.jsx("div",{className:"p-6",children:n.length===0?t.jsxs("div",{className:"text-center py-8",children:[t.jsx(xt,{className:`w-12 h-12 mx-auto mb-4 ${e==="dark"?"text-gray-600":"text-gray-400"}`}),t.jsx("p",{className:`text-lg ${e==="dark"?"text-gray-400":"text-gray-600"}`,children:"Нет активных блокировок"})]}):t.jsx("div",{className:"space-y-4",children:n.map(w=>t.jsxs("div",{className:`flex items-center justify-between p-4 rounded-xl border ${w.isActive&&!A(w.expiresAt)?e==="dark"?"border-red-500/30 bg-red-500/10":"border-red-200 bg-red-50":e==="dark"?"border-gray-600 bg-gray-700/50":"border-gray-200 bg-gray-50"}`,children:[t.jsxs("div",{className:"flex-1",children:[t.jsx("div",{className:`font-medium ${e==="dark"?"text-white":"text-gray-900"}`,children:E(w.userId)}),t.jsx("div",{className:`text-sm mt-1 ${e==="dark"?"text-gray-400":"text-gray-600"}`,children:w.reason}),t.jsxs("div",{className:"flex items-center gap-4 mt-2",children:[t.jsxs("div",{className:"text-xs text-gray-500",children:["Функции: ",w.blockFeatures.map(g=>j(g)).join(", ")]}),w.expiresAt&&t.jsxs("div",{className:`flex items-center gap-1 text-xs ${A(w.expiresAt)?"text-gray-500":"text-amber-600"}`,children:[t.jsx(Lt,{className:"w-3 h-3"}),A(w.expiresAt)?"Истекла":`До ${new Date(w.expiresAt).toLocaleString("ru-RU")}`]})]})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("button",{onClick:()=>U(w),className:`px-3 py-1 rounded-full text-xs font-medium transition-colors ${w.isActive&&!A(w.expiresAt)?"bg-red-500 text-white":e==="dark"?"bg-gray-600 text-gray-300":"bg-gray-200 text-gray-700"}`,children:w.isActive&&!A(w.expiresAt)?"Активна":"Неактивна"}),t.jsx("button",{onClick:()=>M(w),className:`p-2 rounded-lg ${e==="dark"?"hover:bg-gray-700 text-gray-400":"hover:bg-gray-100 text-gray-600"} transition-colors`,children:t.jsx(ar,{className:"w-4 h-4"})}),t.jsx("button",{onClick:()=>V(w.id),className:"p-2 rounded-lg text-red-500 hover:bg-red-500 hover:text-white transition-colors",children:t.jsx(Et,{className:"w-4 h-4"})})]})]},w.id))})})]})]})})})]})})},t4=()=>{const{theme:s}=Re(),{isAdmin:e}=ft(),{viewMode:r,setViewMode:a,selectedWeekStart:n,setSelectedDate:i,setSelectedWeekStart:o}=q_(),[c,d]=k.useState(r||"table"),[u,m]=k.useState(null),[f]=k.useState("all"),[x,v]=k.useState(!1),[T,I]=k.useState(!1),[N,O]=k.useState(!1),[D,C]=k.useState(!1),[M,V]=k.useState(!1),[U,y]=k.useState(!1),[b,E]=k.useState(null),[j,A]=k.useState(null),[w,g]=k.useState(null),[$,L]=k.useState(null),[ee,te]=k.useState(0),[Y,q]=k.useState({slotsThisWeek:0,activeMembers:0,upcomingSlots:0,completedSlots:0,recommendedWeek:0,recommendedDay:0,mostActive:"",leastActive:[],remainingSlots:0,todaySlots:0}),[R,S]=k.useState({nextStart:null,activeEnd:null}),[P,W]=k.useState({nextStart:"—",activeRemaining:"—"});k.useEffect(()=>{d(r||"table")},[r]),k.useEffect(()=>{m(n)},[n]),k.useEffect(()=>{G()},[]),k.useEffect(()=>{const pe=(nt,dt)=>{if(!nt)return"—";const ge=nt.getTime()-Date.now();if(ge<=0)return dt?"Слот завершён":"Уже начался";const be=Math.floor(ge/6e4),qe=Math.floor(be/(60*24)),bt=Math.floor(be%(60*24)/60),re=be%60;return qe>0?`${qe}д ${bt}ч`:bt>0?`${bt}ч ${re}м`:`${Math.max(re,1)}м`},De=()=>{W({nextStart:pe(R.nextStart,!1),activeRemaining:pe(R.activeEnd,!0)})};De();const $e=setInterval(De,6e4);return()=>clearInterval($e)},[R]);const K=pe=>{const De=bs(),$e=new Date(De);$e.setHours(0,0,0,0);const nt=new Date(pe.date);if(nt.setHours(0,0,0,0),nt>$e)return!0;if(nt.getTime()===$e.getTime()){const qe=bs(),bt=qe.getHours()*60+qe.getMinutes();return pe.slots.some(re=>{if(re.endDate){const Ct=new Date(re.endDate);if(Ct.setHours(0,0,0,0),Ct>$e)return!0;if(Ct.getTime()===$e.getTime()){const[vr,$r]=re.end.split(":").map(Number);return vr*60+$r>bt}return!1}const[Ee,Se]=re.end.split(":").map(Number);return Ee*60+Se>bt})}const dt=bs(),ge=dt.getHours()*60+dt.getMinutes();return pe.slots.some(qe=>{if(qe.endDate){const bt=new Date(qe.endDate);if(bt.setHours(0,0,0,0),bt>$e)return!0;if(bt.getTime()===$e.getTime()){const[re,Ee]=qe.end.split(":").map(Number);return re*60+Ee>ge}return!1}return!1})},he={1:"Dex",2:"Enowk",3:"Xenia",4:"Olenka",5:"Sydney"},H={artyom:"1",adel:"2",kseniya:"3",olga:"4",anastasia:"5"},me=pe=>{const De=Ge.find($e=>$e.id===pe)||Ge.find($e=>H[pe]===$e.id);return he[(De==null?void 0:De.id)||pe]||(De==null?void 0:De.name)||pe},G=async()=>{var pe,De;try{const $e=new Date,nt=_o($e),dt=oe(nt[0],"yyyy-MM-dd"),ge=oe(nt[6],"yyyy-MM-dd"),be=oe($e,"yyyy-MM-dd"),[qe,bt]=await Promise.all([Gr(),mn()]),re=qe.filter(Me=>Me.date>=dt&&Me.date<=ge),Ee=qe.filter(Me=>Me.date===be),Se=new Set([...re.flatMap(Me=>[Me.userId,...Me.participants||[]]),...bt.map(Me=>Me.userId)]),Pe=re.filter(K).length,Ct=re.length-Pe,vr=Math.max(0,15-re.length),$r=Math.max(0,3-Ee.length),cr={};Ge.forEach(Me=>{cr[Me.id]=0}),re.forEach(Me=>{const Q=new Set([Me.userId,...Me.participants||[]]);let ce=0;Me.slots.forEach(ve=>{const Ie=new Date(`2000-01-01T${ve.start}`);let Le=new Date(`2000-01-01T${ve.end}`);ve.endDate,Le<Ie&&Le.setDate(Le.getDate()+1),ce+=(Le.getTime()-Ie.getTime())/(1e3*60)}),Q.forEach(ve=>{cr[ve]!==void 0&&(cr[ve]=(cr[ve]||0)+ce)})});const Ut=Object.entries(cr).sort((Me,Q)=>Q[1]-Me[1]),Es=((pe=Ut[0])==null?void 0:pe[1])>0?me(Ut[0][0]):"Нет данных",Er=Object.entries(cr).filter(([Me,Q])=>Q>0).sort((Me,Q)=>Me[1]-Q[1]).slice(0,3).map(([Me])=>me(Me)),Tr=qe.flatMap(Me=>{const Q=Me.date;return(Me.slots||[]).map(ce=>{const ve=new Date(`${Q}T${ce.start}`);let Ie=ce.endDate?new Date(`${ce.endDate}T${ce.end}`):new Date(`${Q}T${ce.end}`);if(!ce.endDate&&Ie.getTime()<=ve.getTime()){const Le=new Date(Q);Le.setDate(Le.getDate()+1),Ie=new Date(`${oe(Le,"yyyy-MM-dd")}T${ce.end}`)}return{start:ve,end:Ie}})}),Fr=Tr.filter(Me=>$e>=Me.start&&$e<=Me.end),Ur=Fr.length?new Date(Math.min(...Fr.map(Me=>Me.end.getTime()))):null,Br=((De=Tr.filter(Me=>Me.start>$e).sort((Me,Q)=>Me.start.getTime()-Q.start.getTime())[0])==null?void 0:De.start)||null;q({slotsThisWeek:re.length,activeMembers:Se.size,upcomingSlots:Pe,completedSlots:Ct,recommendedWeek:vr,recommendedDay:$r,mostActive:Es,leastActive:Er,remainingSlots:Pe,todaySlots:Ee.length}),S({nextStart:Br,activeEnd:Ur})}catch($e){console.error("Error loading stats:",$e)}},se=()=>{g(null),v(!0)},Z=pe=>{g(pe),v(!0)},ne=()=>{E(null),L(null),O(!0)},ie=pe=>{L(pe),E(pe.type),O(!0)},Ce=()=>{I(!0)},je=()=>{C(!0)},le=()=>{V(!0)},ue=()=>{y(!0)},F=()=>{v(!1),I(!1),O(!1),C(!1),V(!1),y(!1),E(null),g(null),L(null),G(),te(pe=>pe+1)},B=pe=>{d(pe),a(pe)},Ne=(pe,De)=>{m(De),i(pe),o(De)},Te=[{label:"Сколько ещё добавить слотов",value:`${Math.max(Y.recommendedDay,0)} в день`,note:`Неделя: ${Math.max(Y.recommendedWeek,0)} до цели 15`,icon:t.jsx(Dn,{className:"w-5 h-5 text-emerald-400"}),tone:"emerald",bgClass:"bg-emerald-500/5",borderClass:"border-emerald-500/20"},{label:"Сколько осталось слотов",value:Y.remainingSlots,note:"предстоящие",icon:t.jsx(If,{className:"w-5 h-5 text-blue-400"}),tone:"blue",bgClass:"bg-blue-500/5",borderClass:"border-blue-500/20"},{label:"Активные члены",value:Y.activeMembers,note:"за неделю",icon:t.jsx(Gt,{className:"w-5 h-5 text-purple-400"}),tone:"purple",bgClass:"bg-purple-500/5",borderClass:"border-purple-500/20"},{label:"Завершено слотов на неделе",value:Y.completedSlots,note:"факт",icon:t.jsx(Ru,{className:"w-5 h-5 text-emerald-400"}),tone:"emerald",bgClass:"bg-emerald-500/5",borderClass:"border-emerald-500/20"},{label:"Таймер ближайшего слота",value:P.nextStart,note:"до старта",icon:t.jsx(an,{className:"w-5 h-5 text-sky-400"}),tone:"sky",bgClass:"bg-sky-500/5",borderClass:"border-sky-500/20"},{label:"До окончания активного слота",value:P.activeRemaining,note:"если слот идёт",icon:t.jsx(Lt,{className:"w-5 h-5 text-pink-400"}),tone:"pink",bgClass:"bg-pink-500/5",borderClass:"border-pink-500/20"},{label:"Самый активный член недели",value:Y.mostActive||"Нет данных",note:"по слотам",icon:t.jsx(Ms,{className:"w-5 h-5 text-amber-400"}),tone:"amber",bgClass:"bg-amber-500/5",borderClass:"border-amber-500/20"},{label:"Самые неактивные члены недели",value:Y.leastActive.length?Y.leastActive.join(", "):"Нет данных",note:"минимум слотов",icon:t.jsx(hf,{className:"w-5 h-5 text-slate-400"}),tone:"slate",bgClass:"bg-slate-500/5",borderClass:"border-slate-500/20"}];return t.jsxs("div",{className:"space-y-6 relative",children:[t.jsxs("div",{className:"space-y-6",children:[t.jsx("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsx("div",{className:"p-3 bg-emerald-500/10 rounded-2xl border border-emerald-500/20",children:t.jsx(Ru,{className:"w-8 h-8 text-emerald-500"})}),t.jsxs("div",{children:[t.jsx("h1",{className:`text-2xl md:text-3xl font-black tracking-tight ${s==="dark"?"text-white":"text-gray-900"}`,children:"AVF Schedule"}),t.jsx("p",{className:`text-sm font-medium ${s==="dark"?"text-gray-400":"text-gray-500"}`,children:"Управление сменами и активностью ApeVault Frontier"})]})]})}),t.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:Te.map((pe,De)=>t.jsxs("div",{className:`relative overflow-hidden rounded-2xl p-5 border transition-all duration-300 hover:shadow-lg group ${s==="dark"?`${pe.bgClass} ${pe.borderClass} hover:border-opacity-50`:"bg-white border-gray-100 hover:border-emerald-500/20"}`,children:[t.jsxs("div",{className:"flex justify-between items-start mb-4",children:[t.jsx("span",{className:`text-[10px] font-bold uppercase tracking-wider ${s==="dark"?"text-gray-400":"text-gray-500"}`,children:pe.label}),t.jsx("div",{className:`p-2 rounded-xl transition-colors ${s==="dark"?"bg-white/5 group-hover:bg-white/10":"bg-gray-100 group-hover:bg-gray-200"}`,children:pe.icon})]}),t.jsxs("div",{className:"space-y-1",children:[t.jsx("div",{className:`text-2xl font-black tracking-tight ${s==="dark"?"text-white":"text-gray-900"}`,children:pe.value}),t.jsx("div",{className:"text-[11px] font-medium text-gray-500",children:pe.note})]})]},De))})]}),t.jsx("div",{className:"z-40",children:t.jsx("div",{className:`p-2 rounded-2xl border shadow-xl ${s==="dark"?"bg-[#0b1015] border-white/10":"bg-white border-gray-200"}`,children:t.jsxs("div",{className:"flex flex-col lg:flex-row items-center justify-between gap-4 p-2",children:[t.jsxs("div",{className:`flex items-center gap-1 p-1 rounded-xl border ${s==="dark"?"bg-[#151a21] border-white/5":"bg-gray-50 border-gray-200"}`,children:[t.jsxs("button",{onClick:()=>B("table"),className:`flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-bold transition-all ${c==="table"?"bg-[#2A3441] text-white shadow-lg ring-1 ring-white/10":"text-gray-400 hover:text-gray-200"}`,children:[t.jsx(Qf,{className:"w-4 h-4"}),t.jsx("span",{children:"Таблица"})]}),t.jsxs("button",{onClick:()=>B("week"),className:`flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-bold transition-all ${c==="week"?"bg-[#4E6E49] text-white shadow-lg shadow-emerald-900/20":"text-gray-400 hover:text-gray-200"}`,children:[t.jsx(ir,{className:"w-4 h-4"}),t.jsx("span",{children:"Неделя"})]})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsxs("button",{onClick:se,className:"flex items-center gap-2 px-6 py-2.5 rounded-xl bg-emerald-500 hover:bg-emerald-600 text-white font-bold text-sm transition-all shadow-lg shadow-emerald-500/20 hover:scale-105 active:scale-95",children:[t.jsx(Bf,{className:"w-4 h-4"}),t.jsx("span",{children:"Добавить слот"})]}),t.jsxs("button",{onClick:ne,className:`flex items-center gap-2 px-4 py-2.5 rounded-xl border font-bold text-sm transition-all hover:scale-105 active:scale-95 ${s==="dark"?"border-white/10 bg-white/5 text-gray-300 hover:bg-white/10 hover:text-white":"border-gray-200 bg-gray-50 text-gray-600 hover:bg-gray-100"}`,children:[t.jsx(Xl,{className:"w-4 h-4"}),t.jsx("span",{className:"hidden sm:inline",children:"Отсутствие"})]}),t.jsx("button",{onClick:Ce,className:"p-2.5 rounded-xl border border-rose-500/20 bg-rose-500/10 text-rose-500 hover:bg-rose-500/20 transition-all",title:"Очистить",children:t.jsx(Et,{className:"w-5 h-5"})})]}),t.jsx("div",{className:"flex items-center gap-2 w-full lg:w-72",children:t.jsx(Qp,{selectedUserId:j,onSelect:A})}),e&&t.jsx("div",{className:"flex gap-1",children:[{icon:t.jsx(xt,{className:"w-4 h-4"}),action:je,title:"Ограничения"},{icon:t.jsx(xt,{className:"w-4 h-4"}),action:le,title:"Конфликты"},{icon:t.jsx(Co,{className:"w-4 h-4"}),action:ue,title:"Блокировки"}].map((pe,De)=>t.jsx("button",{onClick:pe.action,title:pe.title,className:`p-2.5 rounded-xl border ${s==="dark"?"border-white/10 bg-white/5 text-gray-400 hover:text-white":"border-gray-200 text-gray-500"}`,children:pe.icon},De))})]})})}),t.jsx("div",{className:`rounded-2xl border ${s==="dark"?"bg-[#0b1015] border-white/5":"bg-white border-gray-200"}`,children:t.jsx("div",{className:"p-0",children:c==="table"?t.jsx(W_,{selectedUserId:j,slotFilter:f,refreshKey:ee,initialWeekStart:u,onDateChange:Ne,onEditSlot:Z,onEditStatus:ie}):t.jsx(H_,{selectedUserId:j,slotFilter:f,refreshKey:ee,initialWeekStart:u,onEditSlot:Z,onEditStatus:ie})})}),x&&t.jsx(Q_,{slot:w,onClose:F,onSave:F}),T&&t.jsx(X_,{onClose:F,onSave:F}),N&&t.jsx(Y_,{type:b||void 0,status:$,onClose:F,onSave:F}),D&&t.jsx(J_,{onClose:F,onSave:F}),M&&t.jsx(Z_,{onClose:()=>V(!1)}),U&&t.jsx(e4,{onClose:()=>y(!1)})]})},tr=s=>s.map(([e,r])=>({max:e,percent:r/100})),r4={memecoins_regular:tr([[1e3,30],[6e3,40],[12e3,50],[1/0,60]]),memecoins_deving:tr([[1e4,15],[2e4,20],[3e4,25],[6e4,30],[1/0,40]]),polymarket:tr([[1e3,30],[6e3,40],[12e3,50],[1/0,60]]),nft:tr([[1e3,25],[6e3,35],[12e3,40],[2e4,50],[1/0,60]]),staking:tr([[1e3,15],[3e3,20],[5e3,25],[1e4,35],[1/0,40]]),spot:tr([[1e3,20],[5e3,25],[2e4,35],[5e4,45],[1/0,60]]),futures:tr([[1e3,15],[5e3,25],[2e4,35],[5e4,50],[1/0,60]]),airdrop:tr([[1e3,25],[3e3,30],[5e3,35],[1e4,40],[1/0,50]])},s4={memecoins_regular:tr([[1e3,15],[3e3,20],[5e3,25],[1e4,30],[1/0,35]]),memecoins_deving:tr([[1e4,15],[2e4,20],[3e4,25],[6e4,30],[1/0,40]]),polymarket:tr([[1e3,25],[3e3,30],[5e3,35],[1e4,40],[1/0,45]]),nft:tr([[1e3,15],[3e3,20],[5e3,25],[1e4,30],[1/0,40]]),staking:tr([[1e3,10],[3e3,15],[5e3,20],[1e4,25],[1/0,30]]),spot:tr([[1e3,10],[5e3,15],[2e4,20],[5e4,25],[1/0,30]]),futures:tr([[1e3,10],[5e3,15],[2e4,20],[5e4,25],[1/0,30]]),airdrop:tr([[1e3,15],[3e3,20],[5e3,25],[1e4,30],[1/0,40]])},a4=(s,e)=>s==="memecoins"?e?"memecoins_deving":"memecoins_regular":s,n4=(s,e,r,a=!1)=>{if(s<=0)return{poolShare:0,percent:0};if(r==="pool")return{poolShare:s,percent:1};const n=r==="general"?r4:s4,i=a4(e,a),o=n[i]||n.other;if(!o)return{poolShare:s*.45,percent:.45};const c=o.find(d=>s<=d.max)||o[o.length-1];return{poolShare:s*c.percent,percent:c.percent}},i4=(s,e,r=0,a=0)=>e==="general"?s+r*s:e==="pool"?s:s+a,o4=({onClose:s,onSave:e,editingEarning:r})=>{var je,le;const{user:a}=ot(),{isAdmin:n}=ft(),{theme:i}=Re(),o=i==="dark"?"text-white":"text-gray-900",c=!!r,[d,u]=k.useState((r==null?void 0:r.date)||oe(new Date,"yyyy-MM-dd")),[m,f]=k.useState((r==null?void 0:r.amount.toString())||""),[x,v]=k.useState((r==null?void 0:r.walletType)||"general"),[T,I]=k.useState((r==null?void 0:r.isDeving)||!1),[N,O]=k.useState(((je=r==null?void 0:r.extraWalletsCount)==null?void 0:je.toString())||""),[D,C]=k.useState(((le=r==null?void 0:r.extraWalletsAmount)==null?void 0:le.toString())||""),[M,V]=k.useState((r==null?void 0:r.category)||"memecoins"),[U,y]=k.useState(r?r.participants.length>1:!1),[b,E]=k.useState(r?r.participants.filter(ue=>ue!==r.userId):[]),[j,A]=k.useState(""),[w,g]=k.useState(!1);ns();const $=(ue,F="w-4 h-4")=>{switch(ue){case"memecoins":return t.jsx(Lr,{className:F});case"futures":return t.jsx(ka,{className:F});case"nft":return t.jsx(_s,{className:F});case"spot":return t.jsx(jr,{className:F});case"polymarket":return t.jsx(Vr,{className:F});case"staking":return t.jsx(Hs,{className:F});case"airdrop":return t.jsx(sn,{className:F});default:return t.jsx(ts,{className:F})}},L=()=>{var ue;return c&&r?(ue=r.participants)!=null&&ue.length?r.participants:[r.userId]:U&&b.length?b:a!=null&&a.id?[a.id]:[]},ee=parseFloat(m||"0"),te=parseFloat(N||"0"),Y=parseFloat(D||"0"),q=i4(ee,x,te,Y),{poolShare:R,percent:S}=n4(q,M,x,T),W=(()=>{const ue=L();return ue.length?(q-R)/ue.length:0})(),K=!c||n&&(r==null?void 0:r.status)==="pending",he=async()=>{const ue=L();if(!m||ue.length===0){A("Пожалуйста, заполните все обязательные поля");return}if(n&&c&&(r==null?void 0:r.status)==="approved"){A("Нельзя изменять одобренный заработок");return}g(!0),A("");try{const F={date:d,amount:ee,extraWalletsCount:te,extraWalletsAmount:Y,category:M,walletType:x,isDeving:M==="memecoins"?T:!1,participants:ue,userId:(a==null?void 0:a.id)||"",status:n&&c?"approved":"pending",perParticipant:W,poolAmount:R};c&&(r!=null&&r.id)?await Up(r.id,F):await Fp(F),e(),s()}catch(F){console.error("Error saving earnings:",F),A("Ошибка при сохранении. Попробуйте снова.")}finally{g(!1)}},H=ue=>{const F=ue.target.checked;y(F),F||E([])},me=a!=null&&a.id?yr(a.id):"",G=i==="dark"?"bg-black/60 backdrop-blur-sm":"bg-gray-900/50 backdrop-blur-sm",se=i==="dark"?"bg-gray-800":"bg-white",Z=i==="dark"?"border-gray-700 bg-gray-800":"border-gray-200 bg-white",ne=i==="dark"?"bg-gray-700 border-gray-600 text-white":"bg-gray-50 border-gray-300 text-gray-900",ie=i==="dark"?"bg-gray-700 border-gray-600 text-white placeholder-gray-500":"bg-gray-50 border-gray-300 text-gray-900 placeholder-gray-400",Ce=i==="dark"?"border-gray-700 text-gray-200 hover:bg-gray-800":"border-gray-300 text-gray-800 hover:bg-gray-100";return t.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 touch-manipulation",children:[t.jsx("div",{className:`absolute inset-0 ${G}`,onClick:s}),t.jsxs("div",{className:`relative w-full max-w-md max-h-[90vh] overflow-y-auto rounded-2xl shadow-2xl ${se}`,children:[t.jsxs("div",{className:`sticky top-0 z-10 flex items-center justify-between p-4 border-b backdrop-blur-md bg-opacity-90 ${Z}`,children:[t.jsx("h2",{className:`text-xl font-bold ${o}`,children:c?"Редактировать заработок":"Добавить заработок"}),t.jsx("button",{onClick:s,className:`p-2 rounded-lg transition-colors ${i==="dark"?"hover:bg-gray-700":"hover:bg-gray-100"}`,children:t.jsx(pt,{className:"w-5 h-5 text-gray-500"})})]}),t.jsxs("div",{className:"p-4 space-y-4",children:[j&&t.jsx("div",{className:"p-3 rounded-lg bg-red-500/10 border border-red-500/20",children:t.jsx("p",{className:"text-sm text-red-500",children:j})}),t.jsxs("div",{className:"space-y-3",children:[t.jsx("label",{className:`block text-sm font-medium ${o}`,children:"Дата"}),t.jsx("input",{type:"date",value:d,onChange:ue=>u(ue.target.value),disabled:!K,className:`w-full px-3 py-2.5 rounded-xl border ${ne} disabled:opacity-50 focus:ring-2 focus:ring-emerald-500/20 focus:border-emerald-500 transition-all`})]}),t.jsxs("div",{className:"space-y-3",children:[t.jsx("label",{className:`block text-sm font-medium ${o}`,children:"Категория"}),t.jsx("div",{className:"grid grid-cols-4 gap-2",children:["memecoins","futures","nft","spot","polymarket","staking","airdrop"].map(ue=>{var F,B;return t.jsxs("button",{onClick:()=>V(ue),disabled:!K,className:`flex flex-col items-center gap-1 p-2 rounded-xl border transition-all ${M===ue?"border-emerald-500 bg-emerald-500/10":`border-transparent ${i==="dark"?"bg-gray-700 hover:bg-gray-600":"bg-gray-100 hover:bg-gray-200"}`} disabled:opacity-50 touch-manipulation`,children:[t.jsx("div",{className:`w-8 h-8 rounded-lg bg-gradient-to-br ${((F=hs[ue])==null?void 0:F.gradient)||"from-gray-400 to-gray-600"} flex items-center justify-center text-white shadow-md`,children:$(ue,"w-4 h-4")}),t.jsx("span",{className:`text-[10px] font-medium truncate w-full text-center ${i==="dark"?"text-gray-300":"text-gray-700"}`,children:((B=hs[ue])==null?void 0:B.shortName)||ue})]},ue)})})]}),M==="memecoins"&&t.jsxs("div",{className:"flex items-center gap-3 p-3 rounded-xl border border-emerald-500/20 bg-emerald-500/5",children:[t.jsx("input",{type:"checkbox",id:"isDeving",checked:T,onChange:ue=>I(ue.target.checked),disabled:!K,className:"w-4 h-4 text-emerald-500 rounded focus:ring-emerald-500/20"}),t.jsx("label",{htmlFor:"isDeving",className:`text-sm ${i==="dark"?"text-gray-300":"text-gray-700"}`,children:"Deving (Дэвинг)"})]}),t.jsxs("div",{className:"space-y-3",children:[t.jsx("label",{className:`block text-sm font-medium ${o}`,children:"Тип кошелька"}),t.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[t.jsxs("button",{onClick:()=>v("general"),disabled:!K,className:`flex items-center justify-center gap-2 p-3 rounded-xl border transition-all ${x==="general"?"border-emerald-500 bg-emerald-500/10 text-emerald-500":`border-transparent ${i==="dark"?"bg-gray-700 text-gray-300":"bg-gray-100 text-gray-700"}`}`,children:[t.jsx(Gt,{className:"w-5 h-5"}),t.jsx("span",{className:"font-medium text-sm",children:"Общий"})]}),t.jsxs("button",{onClick:()=>v("personal"),disabled:!K,className:`flex items-center justify-center gap-2 p-3 rounded-xl border transition-all ${x==="personal"?"border-emerald-500 bg-emerald-500/10 text-emerald-500":`border-transparent ${i==="dark"?"bg-gray-700 text-gray-300":"bg-gray-100 text-gray-700"}`}`,children:[t.jsx(to,{className:"w-5 h-5"}),t.jsx("span",{className:"font-medium text-sm",children:"Личный"})]}),t.jsxs("button",{onClick:()=>v("pool"),disabled:!K,className:`flex items-center justify-center gap-2 p-3 rounded-xl border transition-all ${x==="pool"?"border-emerald-500 bg-emerald-500/10 text-emerald-500":`border-transparent ${i==="dark"?"bg-gray-700 text-gray-300":"bg-gray-100 text-gray-700"}`}`,children:[t.jsx(jr,{className:"w-5 h-5"}),t.jsx("span",{className:"font-medium text-sm",children:"Пул"})]})]})]}),t.jsxs("div",{className:"space-y-3",children:[t.jsx("label",{className:`block text-sm font-medium ${o}`,children:x==="general"?"Прибыль с основного кошелька (₽)":x==="pool"?"Сумма в пул (₽)":"Ваш заработок (₽)"}),t.jsx("input",{type:"number",value:m,onChange:ue=>f(ue.target.value),disabled:!K,placeholder:"0.00",className:`w-full px-3 py-2.5 rounded-xl border ${ie} disabled:opacity-50 focus:ring-2 focus:ring-emerald-500/20 focus:border-emerald-500 transition-all`})]}),t.jsx("div",{className:"grid grid-cols-2 gap-3",children:x==="general"?t.jsx(t.Fragment,{children:t.jsxs("div",{className:"space-y-3 col-span-2",children:[t.jsx("label",{className:`block text-sm font-medium ${o}`,children:"Кол-во копи-кошельков"}),t.jsx("input",{type:"number",value:N,onChange:ue=>O(ue.target.value),disabled:!K,placeholder:"0",className:`w-full px-3 py-2.5 rounded-xl border ${ie} disabled:opacity-50 focus:ring-2 focus:ring-emerald-500/20 focus:border-emerald-500 transition-all`})]})}):x==="personal"?t.jsxs("div",{className:"space-y-3 col-span-2",children:[t.jsx("label",{className:`block text-sm font-medium ${o}`,children:"Заработок с доп. кошельков (₽)"}),t.jsx("input",{type:"number",value:D,onChange:ue=>C(ue.target.value),disabled:!K,placeholder:"0.00",className:`w-full px-3 py-2.5 rounded-xl border ${ie} disabled:opacity-50 focus:ring-2 focus:ring-emerald-500/20 focus:border-emerald-500 transition-all`})]}):null}),t.jsxs("div",{className:`p-4 rounded-xl space-y-2 ${i==="dark"?"bg-gray-700/50":"bg-gray-100"}`,children:[t.jsxs("div",{className:"flex justify-between text-sm",children:[t.jsx("span",{className:i==="dark"?"text-gray-400":"text-gray-600",children:"Общий результат:"}),t.jsxs("span",{className:`font-medium ${i==="dark"?"text-white":"text-gray-900"}`,children:[q.toFixed(2)," ₽"]})]}),t.jsxs("div",{className:"flex justify-between text-sm",children:[t.jsxs("span",{className:i==="dark"?"text-gray-400":"text-gray-600",children:["В пул (",(S*100).toFixed(0),"%):"]}),t.jsxs("span",{className:"text-red-400",children:["-",R.toFixed(2)," ₽"]})]}),t.jsxs("div",{className:"flex justify-between text-sm font-medium pt-2 border-t border-current border-opacity-10",children:[t.jsx("span",{className:i==="dark"?"text-gray-300":"text-gray-800",children:"Чистый доход на участника:"}),t.jsxs("span",{className:"text-emerald-500",children:[W.toFixed(2)," ₽"]})]})]}),t.jsxs("div",{className:"flex items-center gap-3 p-3 rounded-xl border border-emerald-500/20 bg-emerald-500/5",children:[t.jsx("input",{type:"checkbox",id:"multipleParticipants",checked:U,onChange:H,disabled:!K,className:"w-4 h-4 text-emerald-500 rounded focus:ring-emerald-500/20"}),t.jsx("label",{htmlFor:"multipleParticipants",className:`text-sm ${i==="dark"?"text-gray-300":"text-gray-700"}`,children:"Несколько участников"})]}),U&&t.jsxs("div",{className:"space-y-3",children:[t.jsx("label",{className:`block text-sm font-medium ${o}`,children:"Участники"}),t.jsx("div",{className:"grid grid-cols-2 gap-2",children:Ge.filter(ue=>ue.id!==(a==null?void 0:a.id)).map(ue=>t.jsx("button",{onClick:()=>{K&&E(F=>F.includes(ue.id)?F.filter(B=>B!==ue.id):[...F,ue.id])},disabled:!K,className:`p-2 rounded-lg text-left text-sm transition-all ${b.includes(ue.id)?"bg-emerald-500/10 border border-emerald-500/50 text-emerald-600 dark:text-emerald-400":i==="dark"?"bg-gray-700 hover:bg-gray-600 text-gray-300":"bg-gray-100 hover:bg-gray-200 text-gray-700"} disabled:opacity-50`,children:t.jsx("span",{className:"font-medium",children:yr(ue.id)||ue.name})},ue.id))})]}),t.jsxs("div",{className:"flex items-center justify-between pt-2",children:[t.jsxs("span",{className:`text-sm ${i==="dark"?"text-gray-400":"text-gray-600"}`,children:["Вы: ",t.jsx("span",{className:"font-medium text-emerald-500",children:me})]}),U&&b.length>0&&t.jsxs("span",{className:`text-sm ${i==="dark"?"text-gray-400":"text-gray-600"}`,children:["+ ",b.length," участн."]})]}),t.jsxs("div",{className:"flex gap-3 pt-2",children:[t.jsxs("button",{onClick:he,disabled:w,className:"flex-1 px-4 py-2.5 sm:py-2 bg-[#4E6E49] hover:bg-[#4E6E49] disabled:bg-gray-400 disabled:cursor-not-allowed text-white rounded-lg sm:rounded-xl transition-colors text-sm sm:text-base font-medium touch-manipulation active:scale-95 disabled:active:scale-100 relative overflow-hidden",children:[t.jsx("span",{className:`relative z-10 flex items-center justify-center gap-2 ${w?"invisible":""}`,children:c?"Сохранить":"Сохранить все"}),w&&t.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:t.jsxs("div",{className:"flex items-center gap-2 text-white",children:[t.jsx("div",{className:"w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin"}),t.jsx("span",{children:"Сохранение..."})]})})]}),t.jsx("button",{type:"button",onClick:s,className:`flex-1 px-4 py-2.5 sm:py-2 rounded-lg sm:rounded-xl border text-sm sm:text-base font-medium transition-colors touch-manipulation active:scale-95 ${Ce}`,children:"Отмена"})]})]})]})]})},l4=({earnings:s})=>{const{theme:e}=Re(),r=.45,a=hn(),n=oe(a.start,"yyyy-MM-dd"),i=oe(a.end,"yyyy-MM-dd"),o=oe(new Date(new Date().getFullYear(),new Date().getMonth(),1),"yyyy-MM-dd"),c=oe(new Date(new Date().getFullYear(),new Date().getMonth()+1,0),"yyyy-MM-dd"),d=(f,x,v)=>{const T=s.filter(D=>(D.participants&&D.participants.length>0?[...D.participants,D.userId]:[D.userId]).includes(f)&&D.date>=x&&D.date<=v),I=T.reduce((D,C)=>{const M=C.participants&&C.participants.length>0?C.participants.length:1,V=C.poolAmount||C.amount*r,U=Math.max(C.amount-V,0);return D+U/M},0),N=T.reduce((D,C)=>{const M=C.participants&&C.participants.length>0?C.participants.length:1,V=C.poolAmount||C.amount*r;return D+V/M},0),O=Array.from(new Set(T.map(D=>D.category))).filter(D=>D!=="other");return{totalEarnings:I,totalPool:N,count:T.length,categories:O}},u=Ge.map(f=>{const x=d(f.id,o,c),v=d(f.id,n,i);return{...f,...x,weeklyNet:v.totalEarnings}}).sort((f,x)=>x.totalEarnings-f.totalEarnings),m=5e4;return t.jsx("div",{className:`overflow-hidden rounded-3xl border shadow-2xl ${e==="dark"?"bg-[#0b1015] border-white/5":"bg-white border-gray-100"}`,children:t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"w-full text-left border-collapse",children:[t.jsx("thead",{children:t.jsxs("tr",{className:e==="dark"?"bg-white/5":"bg-gray-50",children:[t.jsx("th",{className:"px-6 py-5 text-[10px] font-black uppercase tracking-widest text-gray-500",children:"Ранг"}),t.jsx("th",{className:"px-6 py-5 text-[10px] font-black uppercase tracking-widest text-gray-500",children:"Участник"}),t.jsx("th",{className:"px-6 py-5 text-[10px] font-black uppercase tracking-widest text-gray-500",children:"Сферы"}),t.jsx("th",{className:"px-6 py-5 text-[10px] font-black uppercase tracking-widest text-gray-500 text-right",children:"Сумма пула"}),t.jsx("th",{className:"px-6 py-5 text-[10px] font-black uppercase tracking-widest text-gray-500 text-right",children:"Чистые средства"}),t.jsx("th",{className:"px-6 py-5 text-[10px] font-black uppercase tracking-widest text-gray-500 text-right",children:"KPI"})]})}),t.jsx("tbody",{className:"divide-y divide-white/5",children:u.map((f,x)=>{const v=f.weeklyNet/m*100,T=x===0?"text-amber-500":x===1?"text-gray-400":x===2?"text-orange-500":"text-gray-600",I=f.avatar;return t.jsxs("tr",{className:`group transition-all duration-300 ${e==="dark"?"hover:bg-white/[0.02]":"hover:bg-gray-50"}`,children:[t.jsx("td",{className:"px-6 py-5",children:t.jsxs("span",{className:`text-sm font-black ${T}`,children:["#",x+1]})}),t.jsx("td",{className:"px-6 py-5",children:t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"relative",children:I?t.jsx("img",{src:I,alt:"",className:"w-9 h-9 rounded-full object-cover ring-2 ring-white/5"}):t.jsx("div",{className:"w-9 h-9 rounded-full bg-emerald-500/20 flex items-center justify-center text-sm font-black text-emerald-500",children:f.name[0]})}),t.jsxs("div",{children:[t.jsx("p",{className:`text-sm font-black ${e==="dark"?"text-white":"text-gray-900"}`,children:yr(f.id)}),t.jsx("p",{className:"text-[10px] font-bold text-gray-500 uppercase tracking-widest",children:"Frontier Team"})]})]})}),t.jsx("td",{className:"px-6 py-5",children:t.jsx("div",{className:"flex flex-wrap gap-1.5",children:f.categories.length>0?f.categories.map(N=>{var O;return t.jsx("span",{className:`px-2 py-0.5 rounded-md text-[9px] font-black uppercase tracking-tight border ${e==="dark"?"bg-white/5 border-white/10 text-gray-400":"bg-gray-100 border-gray-200 text-gray-600"}`,children:((O=hs[N])==null?void 0:O.label)||N},N)}):t.jsx("span",{className:"text-[10px] text-gray-500 font-bold uppercase",children:"—"})})}),t.jsx("td",{className:"px-6 py-5 text-right",children:t.jsxs("span",{className:`text-sm font-black ${e==="dark"?"text-gray-300":"text-gray-700"}`,children:[f.totalPool.toLocaleString()," ₽"]})}),t.jsx("td",{className:"px-6 py-5 text-right",children:t.jsxs("span",{className:"text-sm font-black text-emerald-500",children:[f.totalEarnings.toLocaleString()," ₽"]})}),t.jsx("td",{className:"px-6 py-5 text-right w-48",children:t.jsxs("div",{className:"flex items-center justify-end gap-3",children:[t.jsx("div",{className:`w-24 h-1.5 rounded-full overflow-hidden ${e==="dark"?"bg-white/5":"bg-gray-100"}`,children:t.jsx("div",{className:`h-full rounded-full transition-all duration-1000 ${e==="dark"?"bg-white":"bg-black"}`,style:{width:`${Math.min(v,100)}%`}})}),t.jsxs("span",{className:"text-[10px] font-black text-gray-500",children:[v.toFixed(0),"%"]})]})})]},f.id)})})]})})})},c4=({earnings:s,onEdit:e,onDelete:r})=>{const{theme:a}=Re(),{user:n}=ot(),{isAdmin:i}=ft(),[o,c]=k.useState(null),d=.45,u=(C,M="w-4 h-4")=>{switch(C){case"memecoins":return t.jsx(Lr,{className:M});case"futures":return t.jsx(ka,{className:M});case"nft":return t.jsx(_s,{className:M});case"spot":return t.jsx(jr,{className:M});case"polymarket":return t.jsx(Vr,{className:M});case"staking":return t.jsx(Hs,{className:M});case"airdrop":return t.jsx(sn,{className:M});default:return t.jsx(ts,{className:M})}},m=async C=>{if(confirm("Вы уверены, что хотите удалить эту запись о заработке?")){c(C.id);try{i?await Bp(C.id):await $t({entity:"earning",action:"delete",authorId:(n==null?void 0:n.id)||C.userId,targetUserId:C.userId,before:C,after:null}),r()}catch(M){console.error("Error deleting earnings:",M),alert("Ошибка при удалении записи")}finally{c(null)}}},f=C=>C.participants&&C.participants.length>0?C.participants:[C.userId],x=C=>C.poolAmount||C.amount*d,v=C=>Math.max(C.amount-x(C),0),T=C=>{const M=f(C);return M.length?v(C)/M.length:v(C)},I=C=>hs[C]||hs.other,N=C=>yr(C)||C,O=C=>i||C.userId===(n==null?void 0:n.id),D=[...s].sort((C,M)=>M.date.localeCompare(C.date));return D.length===0?t.jsxs("div",{className:`rounded-2xl p-8 text-center border-2 ${a==="dark"?"bg-[#1a1a1a] border-gray-800":"bg-white border-gray-200"} shadow-md`,children:[t.jsx("p",{className:`${a==="dark"?"text-gray-400":"text-gray-600"} text-lg`,children:"Пока нет записей о заработке"}),t.jsx("p",{className:"text-gray-500 text-sm mt-2",children:"Добавьте первую запись, чтобы начать отслеживать доходы команды"})]}):t.jsxs("div",{className:`rounded-3xl overflow-hidden border shadow-2xl ${a==="dark"?"bg-[#0b1015] border-white/5":"bg-white border-gray-100"}`,children:[t.jsx("div",{className:"p-6 border-b border-white/5 flex items-center justify-between",children:t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"p-2 bg-blue-500/10 rounded-xl",children:t.jsx(Kl,{className:"w-5 h-5 text-blue-400"})}),t.jsx("h3",{className:`text-lg font-black tracking-tight ${a==="dark"?"text-white":"text-gray-900"}`,children:"История выплат"})]})}),t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"w-full text-left border-collapse",children:[t.jsx("thead",{children:t.jsxs("tr",{className:a==="dark"?"bg-white/5":"bg-gray-50",children:[t.jsx("th",{className:"px-6 py-4 text-[10px] font-black uppercase tracking-wider text-gray-500 whitespace-nowrap",children:"Дата"}),t.jsx("th",{className:"px-6 py-4 text-[10px] font-black uppercase tracking-wider text-gray-500",children:"Сфера"}),t.jsx("th",{className:"px-6 py-4 text-[10px] font-black uppercase tracking-wider text-gray-500",children:"Команда"}),t.jsx("th",{className:"px-6 py-4 text-[10px] font-black uppercase tracking-wider text-gray-500 text-right",children:"Выплата"}),t.jsx("th",{className:"px-6 py-4 text-[10px] font-black uppercase tracking-wider text-gray-500 text-right",children:"В Пул"}),t.jsx("th",{className:"px-6 py-4 text-[10px] font-black uppercase tracking-wider text-gray-500 text-center",children:"Действия"})]})}),t.jsx("tbody",{className:"divide-y divide-white/5",children:D.map(C=>{const M=f(C),V=I(C.category),U=v(C),y=T(C),b=O(C);return t.jsxs("tr",{className:`group/row transition-colors ${a==="dark"?"hover:bg-white/[0.02]":"hover:bg-gray-50"}`,children:[t.jsx("td",{className:"px-6 py-5 whitespace-nowrap",children:t.jsx("span",{className:`text-[12px] font-bold ${a==="dark"?"text-gray-400":"text-gray-600"}`,children:oe(new Date(C.date+"T00:00:00"),"dd.MM")})}),t.jsx("td",{className:"px-6 py-5",children:t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"p-1.5 bg-white/5 rounded-lg",children:u(C.category,"w-3.5 h-3.5 text-gray-400")}),t.jsx("span",{className:`text-xs font-bold ${a==="dark"?"text-gray-300":"text-gray-900"}`,children:V.label})]})}),t.jsx("td",{className:"px-6 py-5",children:t.jsx("div",{className:"flex flex-wrap gap-1.5 max-w-[200px]",children:M.map(E=>t.jsx("span",{className:`px-2 py-0.5 rounded-md text-[10px] font-black tracking-tight border ${a==="dark"?"border-white/5 bg-white/5 text-gray-400":"border-gray-100 bg-gray-50 text-gray-600"}`,children:N(E)},E))})}),t.jsx("td",{className:"px-6 py-5 text-right",children:t.jsxs("div",{className:"flex flex-col items-end",children:[t.jsxs("span",{className:"text-sm font-black text-emerald-500",children:[U.toFixed(0)," ₽"]}),M.length>1&&t.jsxs("span",{className:"text-[10px] font-medium text-gray-500",children:["по ",y.toFixed(0)," ₽"]})]})}),t.jsx("td",{className:"px-6 py-5 text-right",children:t.jsxs("span",{className:"text-sm font-bold text-purple-400 opacity-60",children:[x(C).toFixed(0)," ₽"]})}),t.jsx("td",{className:"px-6 py-5 text-center",children:b?t.jsxs("div",{className:"flex items-center justify-center gap-2 opacity-0 group-hover/row:opacity-100 transition-opacity duration-200",children:[t.jsx("button",{onClick:()=>e(C),className:"p-2 rounded-xl border border-blue-500/20 bg-blue-500/5 text-blue-400 hover:bg-blue-500/20 transition-all",children:t.jsx(Kl,{className:"w-3.5 h-3.5"})}),t.jsx("button",{onClick:()=>m(C),disabled:o===C.id,className:"p-2 rounded-xl border border-rose-500/20 bg-rose-500/5 text-rose-500 hover:bg-rose-500/20 transition-all disabled:opacity-50",children:t.jsx(Et,{className:"w-3.5 h-3.5"})})]}):t.jsx("span",{className:"text-gray-700 text-xs",children:"—"})})]},C.id)})})]})})]})},d4=()=>{const{theme:s}=Re(),[e,r]=k.useState(!1),[a,n]=k.useState(null),[i,o]=k.useState([]),[c,d]=k.useState(!0),[u,m]=k.useState({weekTotal:0,weekPool:0,weekNet:0,monthTotal:0,monthPool:0,monthNet:0}),f=.45,x=Object.keys(hs),v=s==="dark"?"bg-[#1a1a1a]":"bg-white",T=g=>g.poolAmount||g.amount*f,I=g=>Math.max(g.amount-T(g),0),N=g=>{var $;return($=g.participants)!=null&&$.length?g.participants:[g.userId]},O=()=>{const g=hn(),$=oe(g.start,"yyyy-MM-dd"),L=oe(g.end,"yyyy-MM-dd"),ee=oe(new Date(new Date().getFullYear(),new Date().getMonth(),1),"yyyy-MM-dd"),te=oe(new Date(new Date().getFullYear(),new Date().getMonth()+1,0),"yyyy-MM-dd"),Y=i.filter(R=>R.date>=$&&R.date<=L),q=i.filter(R=>R.date>=ee&&R.date<=te);m({weekTotal:Y.reduce((R,S)=>R+S.amount,0),weekPool:Y.reduce((R,S)=>R+T(S),0),weekNet:Y.reduce((R,S)=>R+I(S),0),monthTotal:q.reduce((R,S)=>R+S.amount,0),monthPool:q.reduce((R,S)=>R+T(S),0),monthNet:q.reduce((R,S)=>R+I(S),0)})};k.useEffect(()=>{C()},[]),k.useEffect(()=>{O()},[i]);const{users:D}=ea();k.useEffect(()=>{const g=async $=>{const L=$,{userId:ee}=L.detail||{};if(ee)await fs(ee);else for(const te of D)await fs(te.id);o(te=>[...te])};return window.addEventListener("nicknameUpdated",g),()=>{window.removeEventListener("nicknameUpdated",g)}},[D]);const C=async()=>{d(!0);try{const g=await Jn();o(g)}catch(g){console.error("Error loading earnings:",g)}finally{d(!1)}},M=g=>{n(g),r(!0)},V=()=>{r(!1),n(null)},U=()=>{r(!1),n(null),C()},y=x.map(g=>{const $=i.filter(R=>R.category===g),L=$.reduce((R,S)=>R+S.amount,0),ee=$.reduce((R,S)=>R+T(S),0),te=$.reduce((R,S)=>R+I(S),0),Y=new Map;$.forEach(R=>{const S=N(R),P=I(R)/Math.max(S.length,1);S.forEach(W=>{Y.set(W,(Y.get(W)||0)+P)})});const q=Array.from(Y.entries()).sort((R,S)=>S[1]-R[1]).slice(0,2);return{key:g,gross:L,pool:ee,net:te,count:$.length,topParticipants:q}}).filter(g=>g.key!=="other"),b=y.reduce((g,$)=>g+$.net,0),E=y.map(g=>({...g,share:b>0?g.net/b*100:0})).sort((g,$)=>$.share-g.share),j=D.map(g=>{const $=i.filter(Y=>N(Y).includes(g.id)),L=$.reduce((Y,q)=>{const R=I(q)/Math.max(N(q).length,1);return Y+R},0),ee=$.reduce((Y,q)=>{const R=T(q)/Math.max(N(q).length,1);return Y+R},0),te=$.reduce((Y,q)=>{const R=q.amount/Math.max(N(q).length,1);return Y+R},0);return{...g,net:L,poolShare:ee,grossContribution:te}}).sort((g,$)=>$.net-g.net),A=[...y].sort((g,$)=>$.net-g.net)[0],w=j[0];return t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsx("div",{className:"p-3 bg-emerald-500/10 rounded-2xl border border-emerald-500/20",children:t.jsx(qa,{className:"w-8 h-8 text-emerald-500"})}),t.jsxs("div",{children:[t.jsx("h1",{className:`text-2xl md:text-3xl font-black tracking-tight ${s==="dark"?"text-white":"text-gray-900"}`,children:"AVF Profit"}),t.jsx("p",{className:`text-sm font-medium ${s==="dark"?"text-gray-400":"text-gray-500"}`,children:"Мониторинг доходов и распределение пула"})]})]}),t.jsxs("button",{onClick:()=>r(!0),className:"flex items-center gap-2 px-6 py-3 rounded-xl bg-emerald-500 hover:bg-emerald-600 text-white font-bold text-sm transition-all shadow-lg shadow-emerald-500/20 hover:scale-105 active:scale-95",children:[t.jsx(mr,{className:"w-4 h-4"}),t.jsx("span",{children:"Добавить заработок"})]})]}),t.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[{label:"НЕДЕЛЯ (ЧИСТЫМИ)",value:`${u.weekNet.toLocaleString()} ₽`,badgeIcon:t.jsx(Ar,{className:"w-4 h-4 text-emerald-500"}),changeType:"positive",icon:t.jsx(it,{className:"w-5 h-5 text-emerald-400"}),bgClass:"bg-emerald-500/5",borderClass:"border-emerald-500/10"},{label:"НЕДЕЛЯ (ПУЛ)",value:`${u.weekPool.toLocaleString()} ₽`,badgeIcon:t.jsx(Hs,{className:"w-4 h-4 text-blue-400"}),icon:t.jsx(Tn,{className:"w-5 h-5 text-blue-400"}),bgClass:"bg-blue-500/5",borderClass:"border-blue-500/10"},{label:"МЕСЯЦ (ЧИСТЫМИ)",value:`${u.monthNet.toLocaleString()} ₽`,isTrend:!0,icon:t.jsx(to,{className:"w-5 h-5 text-purple-400"}),bgClass:"bg-purple-500/5",borderClass:"border-purple-500/10"},{label:"МЕСЯЦ (ПУЛ)",value:`${u.monthPool.toLocaleString()} ₽`,isCoins:!0,icon:t.jsx(jr,{className:"w-5 h-5 text-orange-400"}),bgClass:"bg-orange-500/5",borderClass:"border-orange-500/10",change:void 0,badgeIcon:void 0}].map((g,$)=>t.jsxs("div",{className:`relative overflow-hidden rounded-2xl p-5 border transition-all duration-300 hover:shadow-xl group ${s==="dark"?`${g.bgClass} ${g.borderClass} hover:border-white/20`:"bg-white border-gray-100 hover:border-emerald-500/20 shadow-sm"}`,children:[t.jsxs("div",{className:"flex justify-between items-start mb-6",children:[t.jsx("span",{className:`text-[10px] font-black uppercase tracking-widest ${s==="dark"?"text-gray-500":"text-gray-400"}`,children:g.label}),g.change&&t.jsx("span",{className:"px-2 py-0.5 rounded-full bg-emerald-500/10 text-emerald-500 text-[10px] font-black",children:g.change}),"badgeIcon"in g&&g.badgeIcon&&t.jsx("div",{className:"p-1 bg-emerald-500/10 rounded-lg",children:g.badgeIcon}),g.isTrend&&t.jsx(it,{className:"w-4 h-4 text-purple-500/40"}),g.isCoins&&t.jsx(Tn,{className:"w-4 h-4 text-orange-500/40"})]}),t.jsx("div",{className:"flex items-end justify-between",children:t.jsx("div",{className:`text-2xl md:text-3xl font-black tracking-tight ${s==="dark"?"text-white":"text-gray-900"}`,children:g.value})})]},$))})]}),t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-12 gap-6",children:[t.jsxs("div",{className:`lg:col-span-3 rounded-2xl p-6 ${v} border ${s==="dark"?"border-white/5":"border-gray-100"} shadow-xl`,children:[t.jsxs("div",{className:"flex items-center gap-3 mb-8",children:[t.jsx("div",{className:"p-2 bg-[#4E6E49]/10 rounded-lg",children:t.jsx(Ff,{className:"w-5 h-5 text-[#4E6E49]"})}),t.jsx("h3",{className:`text-sm font-black uppercase tracking-widest ${s==="dark"?"text-white":"text-gray-900"}`,children:"Доли заработка"})]}),t.jsx("div",{className:"space-y-6",children:E.map(g=>{const $=hs[g.key];return t.jsxs("div",{className:"space-y-2",children:[t.jsxs("div",{className:"flex justify-between items-center text-[11px] font-black uppercase",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:`w-2 h-2 rounded-full ${$.accent==="emerald"?"bg-emerald-500":$.accent==="blue"?"bg-blue-500":$.accent==="purple"?"bg-purple-500":$.accent==="amber"?"bg-amber-500":$.accent==="pink"?"bg-pink-500":$.accent==="indigo"?"bg-indigo-500":$.accent==="cyan"?"bg-cyan-500":"bg-gray-500"}`}),t.jsx("span",{className:s==="dark"?"text-gray-300":"text-gray-700",children:$.label})]}),t.jsxs("span",{className:s==="dark"?"text-white":"text-gray-900",children:[g.share.toFixed(0),"%"]})]}),t.jsx("div",{className:"h-1.5 w-full bg-white/5 rounded-full overflow-hidden",children:t.jsx("div",{className:`h-full rounded-full ${$.accent==="emerald"?"bg-emerald-500":$.accent==="blue"?"bg-blue-500":$.accent==="purple"?"bg-purple-500":$.accent==="amber"?"bg-amber-500":$.accent==="pink"?"bg-pink-500":$.accent==="indigo"?"bg-indigo-500":$.accent==="cyan"?"bg-cyan-500":"bg-gray-500"}`,style:{width:`${g.share}%`}})})]},g.key)})})]}),t.jsxs("div",{className:`lg:col-span-9 rounded-2xl p-6 ${v} border ${s==="dark"?"border-white/5":"border-gray-100"} shadow-xl`,children:[t.jsx("div",{className:"flex items-center justify-between mb-8",children:t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"p-2 bg-blue-500/10 rounded-lg",children:t.jsx(Vr,{className:"w-5 h-5 text-blue-400"})}),t.jsx("h3",{className:`text-sm font-black uppercase tracking-widest ${s==="dark"?"text-white":"text-gray-900"}`,children:"Детализация дохода по сферам"})]})}),t.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:E.map(g=>{const $=hs[g.key];return t.jsxs("div",{className:`p-4 rounded-xl border ${s==="dark"?"bg-black/20 border-white/5 hover:border-white/10":"bg-gray-50 border-gray-200"} transition-all group`,children:[t.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[t.jsx("div",{className:`w-2 h-2 rounded-full ${$.accent==="emerald"?"bg-emerald-500":$.accent==="blue"?"bg-blue-500":$.accent==="purple"?"bg-purple-500":$.accent==="amber"?"bg-amber-500":$.accent==="pink"?"bg-pink-500":$.accent==="indigo"?"bg-indigo-500":$.accent==="cyan"?"bg-cyan-500":"bg-gray-500"}`}),t.jsx("span",{className:`text-xs font-black uppercase tracking-widest ${s==="dark"?"text-white":"text-gray-900"}`,children:$.label})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-[9px] font-black text-gray-500 uppercase mb-1",children:"ЧИСТЫМИ"}),t.jsxs("p",{className:`text-sm font-black ${s==="dark"?"text-white":"text-gray-900"}`,children:[g.net.toLocaleString()," ₽"]})]}),t.jsxs("div",{className:"text-right",children:[t.jsx("p",{className:"text-[9px] font-black text-gray-500 uppercase mb-1",children:"В ПУЛ"}),t.jsxs("p",{className:`text-sm font-black ${s==="dark"?"text-white":"text-gray-900"}`,children:[g.pool.toLocaleString()," ₽"]})]})]}),t.jsx("div",{className:"h-1 w-full bg-white/5 rounded-full overflow-hidden",children:t.jsx("div",{className:`h-full rounded-full transition-all duration-500 ${$.accent==="emerald"?"bg-emerald-500 focus:bg-emerald-400":$.accent==="blue"?"bg-blue-500 focus:bg-blue-400":$.accent==="purple"?"bg-purple-500 focus:bg-purple-400":$.accent==="amber"?"bg-amber-500 focus:bg-amber-400":$.accent==="pink"?"bg-pink-500 focus:bg-pink-400":$.accent==="indigo"?"bg-indigo-500 focus:bg-indigo-400":$.accent==="cyan"?"bg-cyan-500 focus:bg-cyan-400":"bg-gray-500"}`,style:{width:`${g.share}%`}})})]},g.key)})})]})]}),t.jsxs("div",{id:"earn-insights",className:`relative overflow-hidden rounded-3xl p-8 ${s==="dark"?"bg-[#0b1015] border-white/5":"bg-white border-gray-100"} border shadow-2xl`,children:[t.jsx("div",{className:"absolute top-0 right-0 w-64 h-64 bg-emerald-500/5 blur-3xl rounded-full -mr-32 -mt-32"}),t.jsxs("div",{className:"relative z-10 space-y-8",children:[t.jsxs("div",{children:[t.jsx("h3",{className:`text-lg font-black tracking-tight ${s==="dark"?"text-white":"text-gray-900"}`,children:"Инсайты Эффективности"}),t.jsx("p",{className:"text-xs text-gray-500",children:"Аналитика доходности по направлениям и участникам"})]}),t.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[{label:"Топ категория",value:A?hs[A.key].label:"—",note:"+14% ROI",icon:t.jsx(it,{className:"w-5 h-5 text-emerald-500"})},{label:"Лидер недели",value:w?w.name:"—",note:w?`${w.net.toLocaleString()} ₽ чистого`:"Нет данных",icon:t.jsx(ts,{className:"w-5 h-5 text-amber-500"})},{label:"Доля пула в работе",value:u.monthTotal?`${Math.round(u.monthPool/u.monthTotal*100)}%`:"68%",note:u.monthTotal?`Доступно ${u.monthPool.toLocaleString()} ₽`:"Доступно 0 ₽",icon:t.jsx(Tn,{className:"w-5 h-5 text-blue-500"})},{label:"Средняя выплата",value:i.length?`${(i.reduce((g,$)=>g+I($),0)/i.length).toFixed(0)} ₽`:"0 ₽",note:"↑ 5%",icon:t.jsx(qa,{className:"w-5 h-5 text-emerald-500"})}].map((g,$)=>t.jsx("div",{className:`p-5 rounded-2xl border ${s==="dark"?"bg-white/5 border-white/5 shadow-inner":"bg-gray-50 border-gray-100"}`,children:t.jsxs("div",{className:"flex flex-col h-full justify-between",children:[t.jsxs("div",{className:"flex justify-between items-start mb-4",children:[t.jsx("span",{className:"text-[10px] font-black uppercase tracking-widest text-gray-500",children:g.label}),g.icon]}),t.jsxs("div",{className:"space-y-1",children:[t.jsx("p",{className:`text-lg font-black leading-tight ${s==="dark"?"text-white":"text-gray-900"}`,children:g.value}),t.jsx("p",{className:"text-[10px] font-black uppercase tracking-widest text-[#4E6E49]",children:g.note})]})]})},$))})]})]}),t.jsx("div",{className:"pt-8 border-t border-white/5",children:c?t.jsx("div",{className:`rounded-2xl p-12 text-center border border-dashed ${s==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-gray-50"}`,children:t.jsxs("div",{className:"flex flex-col items-center gap-4",children:[t.jsx("div",{className:"w-10 h-10 border-4 border-emerald-500/20 border-t-emerald-500 rounded-full animate-spin"}),t.jsx("p",{className:`text-sm font-medium ${s==="dark"?"text-gray-400":"text-gray-500"}`,children:"Загрузка данных..."})]})}):t.jsx("div",{className:"space-y-12",children:t.jsxs("div",{id:"earn-history",className:"space-y-8",children:[t.jsx("div",{className:"flex items-center justify-between",children:t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"p-2 bg-emerald-500/10 rounded-xl",children:t.jsx(it,{className:"w-5 h-5 text-emerald-500"})}),t.jsx("h3",{className:`text-lg font-black tracking-tight ${s==="dark"?"text-white":"text-gray-900"}`,children:"Лидеры по доходу"})]})}),t.jsx(l4,{earnings:i}),t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"p-2 bg-purple-500/10 rounded-xl",children:t.jsx(Tn,{className:"w-5 h-5 text-purple-400"})}),t.jsx("h3",{className:`text-lg font-black tracking-tight ${s==="dark"?"text-white":"text-gray-900"}`,children:"Личные Накопления"})]}),t.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-5 gap-4",children:j.map(g=>t.jsxs("div",{className:`relative overflow-hidden rounded-2xl p-5 border shadow-xl ${s==="dark"?"bg-white/5 border-white/5":"bg-white border-gray-100"}`,children:[t.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[t.jsx("div",{className:"relative",children:g.avatar?t.jsx("img",{src:g.avatar,alt:"",className:"w-8 h-8 rounded-full object-cover ring-2 ring-white/10"}):t.jsx("div",{className:"w-8 h-8 rounded-full bg-emerald-500/20 flex items-center justify-center text-xs font-black text-emerald-500",children:g.name[0]})}),t.jsxs("div",{children:[t.jsx("p",{className:`text-sm font-black truncate max-w-[100px] ${s==="dark"?"text-white":"text-gray-900"}`,children:g.name}),t.jsx("p",{className:"text-[10px] text-gray-500 font-bold uppercase tracking-widest",children:g.login})]})]}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"space-y-1",children:[t.jsx("p",{className:"text-[9px] font-black text-gray-500 uppercase tracking-widest",children:"Всего заработано"}),t.jsxs("p",{className:"text-base font-black text-emerald-500",children:[g.grossContribution.toLocaleString()," ₽"]})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[t.jsxs("div",{className:"space-y-1",children:[t.jsx("p",{className:"text-[8px] font-black text-gray-500 uppercase tracking-widest",children:"В ПУЛ"}),t.jsxs("p",{className:`text-[11px] font-black ${s==="dark"?"text-gray-300":"text-gray-700"}`,children:[g.poolShare.toLocaleString()," ₽"]})]}),t.jsxs("div",{className:"space-y-1 text-right",children:[t.jsx("p",{className:"text-[8px] font-black text-gray-500 uppercase tracking-widest",children:"ПОЛУЧЕНО"}),t.jsxs("p",{className:`text-[11px] font-black ${s==="dark"?"text-gray-300":"text-gray-700"}`,children:[g.net.toLocaleString()," ₽"]})]})]}),t.jsx("div",{className:"h-1 w-full bg-white/5 rounded-full overflow-hidden",children:t.jsx("div",{className:"h-full bg-emerald-500 rounded-full",style:{width:`${Math.min(g.net/g.grossContribution*100,100)}%`}})})]})]},g.id))})]}),t.jsx("div",{className:"pt-8 border-t border-white/5",children:t.jsx(c4,{earnings:i,onEdit:M,onDelete:C})})]})})}),e&&t.jsx(o4,{onClose:V,onSave:U,editingEarning:a})]})},Yp=(s,e=0,r=0,a=0,n=0,i=0)=>{console.log("calculateRating input:",{userId:s.userId,weeklyDaysOff:a,weeklySickDays:n,data_sickDays:s.sickDays,data_vacationDays:s.vacationDays,ninetyDayVacationDays:i,data_absenceDays:s.absenceDays,weeklyHours:e,weeklyEarnings:r});let o=0,c=0;a<2?(c=5,o+=5):a>3&&(c=-15,o-=15),console.log("DaysOff calculation:",{weeklyDaysOff:a,daysOffPoints:c,currentRating:o});let d=0;n<3&&s.sickDays<=9?(d=5,o+=5):(n>4||s.sickDays>10)&&(d=-15,o-=15),console.log("SickDays calculation:",{weeklySickDays:n,monthlySickDays:s.sickDays,sickDaysPoints:d,currentRating:o});let u=0;s.vacationDays<12&&i<=30?(u=10,o+=10):(s.vacationDays>12||i>30)&&(u=-10,o-=10),console.log("Vacation calculation:",{monthlyVacationDays:s.vacationDays,ninetyDayVacationDays:i,vacationDaysPoints:u,currentRating:o});let m=0;s.absenceDays>2&&(m=30),console.log("Absence penalty:",{absenceDays:s.absenceDays,absencePenalty:m,currentRating:o}),console.log("Internship calculation:",{internshipDays:s.internshipDays,internshipDaysPoints:0,currentRating:o}),e>=20?o+=25:e>=15&&(o+=15),r>=6e3?o+=30:r>=3e3&&(o+=15);const x=Math.min(s.referrals*5,30);return o+=x,o=Math.max(0,o-m),console.log("Final rating calculation:",{ratingAfterAbsencePenalty:o,finalRating:Math.min(o,100)}),Math.min(o,100)},Xp=(s,e=0,r=0,a=0,n=0,i=0)=>{let o=0;a<2?o=5:a>3&&(o=-15);let c=0;n<3&&s.sickDays<=9?c=5:(n>4||s.sickDays>10)&&(c=-15);let d=0;s.vacationDays<12&&i<=30?d=10:(s.vacationDays>12||i>30)&&(d=-10);let u=0;s.absenceDays>2&&(u=-30);const m=0;let f=0;e>=20?f=25:e>=15&&(f=15);let x=0;r>=6e3?x=30:r>=3e3&&(x=15);const v=Math.min(s.referrals*5,30),T=o+c+d+f+x+v,I=Math.min(Math.max(0,T+u),100);return{daysOff:a,daysOffPoints:o,sickDays:s.sickDays,sickDaysPoints:c,vacationDays:s.vacationDays,vacationDaysPoints:d,absenceDays:s.absenceDays,absenceDaysPoints:u,internshipDays:s.internshipDays,internshipDaysPoints:m,weeklyHours:e,weeklyHoursPoints:f,weeklyEarnings:r,weeklyEarningsPoints:x,referrals:s.referrals,referralsPoints:v,signals:s.signals,initiatives:s.initiatives,poolAmount:s.poolAmount,truancyDays:s.truancyDays,totalRating:I}},u4=s=>s<20?{status:"excluded",label:"Исключен",description:"Участник исключается из сообщества",color:"#dc2626"}:s>=21&&s<=45?{status:"warning",label:"Исправиться",description:"Необходимо улучшить показатели",color:"#f59e0b"}:{status:"ok",label:"В команде",description:"Участник в команде",color:"#10b981"},h4=({rating:s,place:e})=>{var C;console.log("RatingCard render - userId:",s.userId,"breakdown:",s.breakdown);const{theme:r}=Re(),[a,n]=k.useState(null),i=r==="dark"?"text-white":"text-gray-900",o=r==="dark"?"text-gray-400":"text-gray-600",c=r==="dark"?"bg-[#0f0f0f]":"bg-white",d=r==="dark"?"border-white/10":"border-gray-200",u=r==="dark"?"hover:bg-white/5":"hover:bg-gray-50",m=r==="dark"?"bg-white/5":"bg-gray-50/80",f=s.rating<=0?"4%":`${Math.min(s.rating,100)}%`,x=s.rating>=80?"bg-emerald-500":s.rating>=60?"bg-blue-500":s.rating>=40?"bg-amber-500":"bg-rose-500",v=s.breakdown?[{icon:t.jsx(Lt,{className:"w-5 h-5"}),label:"Часы работы",value:g0(s.breakdown.weeklyHours),points:s.breakdown.weeklyHoursPoints,maxPoints:25,what:`Отработано ${g0(s.breakdown.weeklyHours)} за неделю.`,why:"Часы показывают твой вклад в общее время команды. Норма — 20+ часов.",how:s.breakdown.weeklyHoursPoints<25?"Увеличь активность, бери больше слотов или задач. Цель: 20+ часов.":"Отличный результат, поддерживай этот темп!",color:"bg-blue-200 text-blue-900"},{icon:t.jsx(qa,{className:"w-5 h-5"}),label:"Заработок",value:`${s.breakdown.weeklyEarnings.toFixed(2)} ₽`,points:s.breakdown.weeklyEarningsPoints,maxPoints:30,what:`Заработано ${s.breakdown.weeklyEarnings.toFixed(2)} ₽ за неделю.`,why:"Доход — ключевой показатель эффективности твоих действий.",how:s.breakdown.weeklyEarningsPoints<30?"Анализируй рынок, ищи профитные сигналы, участвуй в активностях. Цель: 6000+ ₽.":"Супер! Твой доход на высоте.",color:"bg-emerald-200 text-emerald-900"},{icon:t.jsx(Gt,{className:"w-5 h-5"}),label:"Рефералы",value:`${s.breakdown.referrals} чел.`,points:s.breakdown.referralsPoints,maxPoints:30,what:`Привлечено ${s.breakdown.referrals} рефералов за 30 дней.`,why:"Рост комьюнити важен для масштабирования и новых возможностей.",how:s.breakdown.referralsPoints<30?"Приглашай активных друзей, делись ссылкой. Цель: 6 человек.":"Отличная работа по расширению команды!",color:"bg-pink-200 text-pink-900"},{icon:t.jsx(Ar,{className:"w-5 h-5"}),label:"Сигналы/Коллы",value:`${s.breakdown.signals}`,points:0,maxPoints:0,what:`Дано ${s.breakdown.signals} сигналов.`,why:"Активность в трейдинге и генерация идей.",how:"Продолжай искать и публиковать качественные сигналы.",color:"bg-yellow-200 text-yellow-900"},{icon:t.jsx(Q0,{className:"w-5 h-5"}),label:"Инициативы",value:`${s.breakdown.initiatives}`,points:0,maxPoints:0,what:`Предложено ${s.breakdown.initiatives} инициатив.`,why:"Проактивность помогает развивать проект.",how:"Предлагай идеи по улучшению процессов.",color:"bg-indigo-200 text-indigo-900"},{icon:t.jsx(qa,{className:"w-5 h-5"}),label:"Пул",value:`${s.breakdown.poolAmount.toFixed(2)} ₽`,points:0,maxPoints:0,what:`Отправлено в пул: ${s.breakdown.poolAmount.toFixed(2)} ₽.`,why:"Вклад в общий пул команды.",how:"Увеличивай отчисления с доходов.",color:"bg-green-200 text-green-900"},{icon:t.jsx(ir,{className:"w-5 h-5"}),label:"Выходные",value:`${s.breakdown.daysOff} дн.`,points:s.breakdown.daysOffPoints,maxPoints:5,what:`Использовано ${s.breakdown.daysOff} выходных на этой неделе.`,why:"Важен баланс, но частые выходные снижают вовлеченность.",how:s.breakdown.daysOffPoints<=0?"Старайся брать не более 2-3 выходных в неделю.":"График в норме.",color:"bg-amber-200 text-amber-900"},{icon:t.jsx(Tf,{className:"w-5 h-5"}),label:"Больничные",value:`${s.breakdown.sickDays} дн.`,points:s.breakdown.sickDaysPoints,maxPoints:5,what:`Всего ${s.breakdown.sickDays} дней больничного за месяц (из них ${s.breakdown.sickDays} на неделе).`,why:"Здоровье важно, но длительные отсутствия влияют на процесс.",how:s.breakdown.sickDaysPoints<=0?"Выздоравливай! Но следи, чтобы больничные не становились частой практикой без причины.":"Всё в порядке.",color:"bg-purple-200 text-purple-900"},{icon:t.jsx(Uf,{className:"w-5 h-5"}),label:"Отпуск",value:`${s.breakdown.vacationDays} дн.`,points:s.breakdown.vacationDaysPoints,maxPoints:10,what:`Использовано ${s.breakdown.vacationDays} дней отпуска за месяц.`,why:"Отдых нужен для перезагрузки, но в меру.",how:s.breakdown.vacationDaysPoints<=0?"Планируй отпуск заранее и не превышай лимиты (12 дней/мес).":"Режим отдыха соблюдается.",color:"bg-orange-200 text-orange-900"},{icon:t.jsx(nr,{className:"w-5 h-5"}),label:"Прогулы (Absence)",value:`${s.breakdown.absenceDays} дн.`,points:s.breakdown.absenceDaysPoints,maxPoints:0,what:`Зафиксировано ${s.breakdown.absenceDays} дней отсутствия (Absence).`,why:"Отсутствие без уважительной причины влияет на рейтинг.",how:s.breakdown.absenceDays>0?"Избегай отсутствия без предупреждения.":"Дисциплина в норме.",color:"bg-red-100 text-red-800"},{icon:t.jsx(nr,{className:"w-5 h-5"}),label:"Прогулы (Truancy)",value:`${s.breakdown.truancyDays} дн.`,points:0,maxPoints:0,what:`Зафиксировано ${s.breakdown.truancyDays} прогулов (Truancy).`,why:"Грубое нарушение дисциплины.",how:s.breakdown.truancyDays>0?"Прогулы недопустимы.":"Прогулов нет.",color:"bg-red-300 text-red-900"}]:[],T=v.filter(M=>!M.label.includes("Прогулы")).reduce((M,V)=>M+V.points,0),I=((C=v.find(M=>M.label==="Прогулы (Absence)"))==null?void 0:C.points)||0,N=Math.max(0,Math.min(100,T+I)),O=u4(s.rating),D=(()=>{if(!e)return null;const M=e.rank;return t.jsxs("div",{className:`inline-flex px-3 py-1.5 rounded-xl text-sm font-bold border-2 ${M===1?"bg-amber-500/10 border-amber-500/50 text-amber-600 dark:text-amber-400":M===2?"bg-slate-500/10 border-slate-500/50 text-slate-500 dark:text-slate-400":M===3?"bg-orange-500/10 border-orange-500/50 text-orange-500 dark:text-orange-400":"bg-gray-500/10 border-gray-500/50 text-gray-500 dark:text-gray-400"}`,children:[M," ","место"]})})();return t.jsxs("div",{className:`relative rounded-2xl p-6 ${c} shadow-xl border ${d} transition-all duration-300 hover:shadow-2xl hover:-translate-y-1 overflow-hidden`,children:[t.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-emerald-500/5 via-transparent to-blue-500/5 pointer-events-none"}),t.jsxs("div",{className:"relative mb-6 flex flex-col gap-4",children:[t.jsxs("div",{className:"flex items-start justify-between gap-3",children:[t.jsxs("div",{className:"min-w-0 flex-1",children:[t.jsx("p",{className:`text-[10px] uppercase tracking-[0.15em] font-bold ${o} mb-2`,children:"Участник команды"}),t.jsx("h3",{className:`text-3xl font-black ${i} truncate mb-2 bg-gradient-to-r from-emerald-600 to-blue-600 bg-clip-text text-transparent dark:from-emerald-400 dark:to-blue-400`,children:t.jsx(ys,{userId:s.userId,fallback:"unknown"})}),D]}),t.jsxs("div",{className:"flex flex-col items-end gap-1",children:[t.jsxs("span",{className:"text-4xl font-black bg-gradient-to-br from-emerald-600 to-blue-600 bg-clip-text text-transparent dark:from-emerald-400 dark:to-blue-400",children:[s.rating.toFixed(1),"%"]}),t.jsx("span",{className:`text-[10px] uppercase tracking-wider font-bold ${o}`,children:"Рейтинг"})]})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx("div",{className:"relative w-full h-8 bg-gradient-to-r from-gray-200/50 to-gray-300/50 dark:from-gray-800/50 dark:to-gray-700/50 rounded-2xl overflow-hidden shadow-inner backdrop-blur-sm",children:t.jsxs("div",{className:`h-full transition-all duration-700 ease-out flex items-center justify-end pr-3 ${x} relative overflow-hidden`,style:{width:f,minWidth:s.rating<=0?"50px":void 0},children:[t.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-white/20 to-transparent"}),s.rating>=5&&t.jsxs("span",{className:"text-sm font-black text-white drop-shadow-lg relative z-10",children:[s.rating.toFixed(1),"%"]})]})}),t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsx("span",{className:`text-xs font-semibold ${o}`,children:"Общий прогресс"}),t.jsxs("span",{className:`text-xs font-black ${i} px-2 py-0.5 rounded-lg ${r==="dark"?"bg-white/10":"bg-gray-100"}`,children:[N,"/100"]})]})]}),t.jsxs("div",{className:"mt-2",children:[t.jsxs("div",{className:"inline-flex items-center gap-2 px-4 py-2 rounded-xl border-2 text-sm font-bold shadow-lg backdrop-blur-sm",style:{backgroundColor:`${O.color}20`,borderColor:`${O.color}60`,color:O.color},children:[t.jsx("div",{className:"w-2.5 h-2.5 rounded-full animate-pulse shadow-lg",style:{backgroundColor:O.color,boxShadow:`0 0 10px ${O.color}`}}),t.jsx("span",{className:"uppercase tracking-wide text-xs",children:O.label})]}),t.jsx("p",{className:`text-xs mt-2 ${o} font-medium`,children:O.description})]})]}),s.breakdown&&t.jsxs("div",{className:"space-y-3 mb-6",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[t.jsx(it,{className:`w-5 h-5 ${o}`}),t.jsx("h4",{className:`text-lg font-semibold ${i}`,children:"Детальный разбор рейтинга"})]}),v.map((M,V)=>{const U=M.maxPoints>0?M.points/M.maxPoints*100:0,y=a===V;return t.jsxs("div",{className:`rounded-lg border ${d} overflow-hidden transition-all ${y?"shadow-md":""}`,children:[t.jsx("button",{onClick:()=>n(y?null:V),className:`w-full p-4 flex items-center justify-between ${u} transition-colors`,children:t.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[t.jsx("div",{className:`p-2 rounded-lg ${M.color} flex-shrink-0`,children:M.icon}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsxs("div",{className:"flex items-center justify-between mb-1",children:[t.jsx("span",{className:`font-semibold ${i} truncate`,children:M.label}),t.jsxs("span",{className:`font-bold ml-2 ${M.points>0?"text-[#4E6E49]":"text-red-500"}`,children:[M.points,"/",M.maxPoints]})]}),t.jsx("div",{className:"w-full bg-gray-200 dark:bg-gray-800 rounded-full h-2 overflow-hidden",children:t.jsx("div",{className:`h-full transition-all duration-300 ${M.color}`,style:{width:`${U}%`}})}),t.jsx("div",{className:"flex items-center justify-between mt-1",children:t.jsx("span",{className:`text-xs ${o} truncate mr-2`,children:M.value})})]}),t.jsx(Wt,{className:`w-4 h-4 flex-shrink-0 ml-2 ${o} transition-transform ${y?"rotate-180":""}`})]})}),y&&t.jsx("div",{className:`px-4 pb-4 pt-2 border-t ${d} ${m}`,children:t.jsxs("div",{className:"space-y-3 mt-1",children:[t.jsxs("div",{children:[t.jsx("span",{className:`text-[10px] uppercase font-bold tracking-wider opacity-60 ${i}`,children:"Что это"}),t.jsx("p",{className:`text-sm ${r==="dark"?"text-gray-300":"text-gray-700"} leading-relaxed`,children:M.what})]}),t.jsxs("div",{children:[t.jsx("span",{className:`text-[10px] uppercase font-bold tracking-wider opacity-60 ${i}`,children:"Почему это важно"}),t.jsx("p",{className:`text-sm ${r==="dark"?"text-gray-300":"text-gray-700"} leading-relaxed`,children:M.why})]}),t.jsxs("div",{children:[t.jsx("span",{className:`text-[10px] uppercase font-bold tracking-wider opacity-60 ${i}`,children:"Как улучшить"}),t.jsx("div",{className:`mt-1 p-2 rounded-lg border ${r==="dark"?"bg-white/5 border-white/10":"bg-emerald-50 border-emerald-100"}`,children:t.jsx("p",{className:`text-sm ${M.points<M.maxPoints?"text-emerald-600 dark:text-emerald-400":"text-gray-500 dark:text-gray-400"} font-medium`,children:M.how})})]})]})})]},V)})]}),t.jsxs("div",{className:`pt-4 border-t ${d}`,children:[t.jsx("h4",{className:`text-sm font-semibold mb-3 ${i}`,children:"Дополнительная статистика"}),t.jsxs("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[t.jsxs("div",{className:`p-3 rounded-lg ${m}`,children:[t.jsx("div",{className:`text-xs ${o} mb-1`,children:"Заработок (месяц)"}),t.jsxs("div",{className:`text-lg font-bold ${i}`,children:[s.earnings.toFixed(0)," ₽"]})]}),t.jsxs("div",{className:`p-3 rounded-lg ${m}`,children:[t.jsx("div",{className:`text-xs ${o} mb-1`,children:"В пул"}),t.jsxs("div",{className:`text-lg font-bold ${i}`,children:[s.poolAmount.toFixed(0)," ₽"]})]}),t.jsxs("div",{className:`p-3 rounded-lg ${m}`,children:[t.jsx("div",{className:`text-xs ${o} mb-1`,children:"Прогулы (неделя)"}),t.jsxs("div",{className:`text-lg font-bold ${i}`,children:[s.absenceDays," дней"]})]}),t.jsxs("div",{className:`p-3 rounded-lg ${m}`,children:[t.jsx("div",{className:`text-xs ${o} mb-1`,children:"Сигналы"}),t.jsxs("div",{className:`text-lg font-bold ${i}`,children:[s.signals,"/",s.profitableSignals]})]})]})]})]})},m4=()=>{var O;const{theme:s}=Re(),{users:e,loading:r}=ea(),[a,n]=k.useState([]),[i,o]=k.useState(!0),[c,d]=k.useState([]);k.useEffect(()=>{!r&&e.length>0&&u()},[e,r]);const u=async()=>{var D;o(!0);try{const C=hn(),M=oe(C.start,"yyyy-MM-dd"),V=oe(C.end,"yyyy-MM-dd"),U=Eo(30),y=oe(U.start,"yyyy-MM-dd"),b=oe(U.end,"yyyy-MM-dd"),E=U.start.toISOString(),j=U.end.toISOString(),A=Eo(90),w=oe(A.start,"yyyy-MM-dd"),g=oe(A.end,"yyyy-MM-dd"),$=await Bd(void 0,E,j);d($);const L=[];console.log("Rating.tsx - allMembers:",e),console.log("Rating.tsx - allMembers.length:",e.length),console.log("Rating.tsx - usersLoading:",r);const ee=["ydiEgmNj2sCBirUjWeiv"],te=e.filter(Y=>!ee.includes(Y.id));console.log("Rating.tsx - activeMembers after filter:",te.length);for(const Y of te){console.log("Rating.tsx - Processing member:",Y.id,Y.name);const R=(await Jn(Y.id,M,V)).reduce((ge,be)=>{const qe=be.participants&&be.participants.length>0?be.participants.length:1;return ge+be.amount/qe},0),S=await Jn(Y.id,y,b),P=S.reduce((ge,be)=>{const qe=be.participants&&be.participants.length>0?be.participants.length:1;return ge+be.amount/qe},0),W=S.reduce((ge,be)=>{const qe=be.participants&&be.participants.length>0?be.participants.length:1;return ge+be.poolAmount/qe},0),K=await mn(Y.id),he=K.filter(ge=>{const be=ge.date,qe=ge.endDate||ge.date;return be<=b&&qe>=y}),H=he.filter(ge=>ge.type==="dayoff").reduce((ge,be)=>ge+Ot(be.date,be.endDate,y,b),0),me=he.filter(ge=>ge.type==="sick").reduce((ge,be)=>ge+Ot(be.date,be.endDate,y,b),0),G=he.filter(ge=>ge.type==="vacation").reduce((ge,be)=>ge+Ot(be.date,be.endDate,y,b),0),se=he.filter(ge=>ge.type==="absence").reduce((ge,be)=>ge+Ot(be.date,be.endDate,y,b),0),Z=he.filter(ge=>ge.type==="truancy").reduce((ge,be)=>ge+Ot(be.date,be.endDate,y,b),0),ne=he.filter(ge=>ge.type==="internship").reduce((ge,be)=>ge+Ot(be.date,be.endDate,y,b),0),ie=K.filter(ge=>{const be=ge.date,qe=ge.endDate||ge.date;return be<=V&&qe>=M}),Ce=ie.filter(ge=>ge.type==="dayoff").reduce((ge,be)=>ge+Ot(be.date,be.endDate,M,V),0),je=ie.filter(ge=>ge.type==="sick").reduce((ge,be)=>ge+Ot(be.date,be.endDate,M,V),0),ue=K.filter(ge=>{const be=ge.date,qe=ge.endDate||ge.date;return be<=g&&qe>=w}).filter(ge=>ge.type==="vacation").reduce((ge,be)=>ge+Ot(be.date,be.endDate,w,g),0),Ne=(await Gr(Y.id)).filter(ge=>ge.date>=M&&ge.date<=V).reduce((ge,be)=>ge+tl(be.slots),0),pe=(await zp(Y.id))[0]||{userId:Y.id,earnings:0,messages:0,initiatives:0,signals:0,profitableSignals:0,referrals:0,daysOff:0,sickDays:0,vacationDays:0,absenceDays:0,internshipDays:0,poolAmount:0,rating:0,lastUpdated:new Date().toISOString()},De=$.filter(ge=>ge.ownerId===Y.id).length,$e={userId:Y.id,earnings:P,messages:pe.messages||0,initiatives:pe.initiatives||0,signals:pe.signals||0,profitableSignals:pe.profitableSignals||0,referrals:De,daysOff:H,sickDays:me,vacationDays:G,absenceDays:se,truancyDays:Z,internshipDays:ne,poolAmount:W,lastUpdated:new Date().toISOString()},nt=Yp($e,Ne,R,Ce,je,ue),dt=Xp($e,Ne,R,Ce,je,ue);L.push({...$e,rating:nt,breakdown:dt})}L.sort((Y,q)=>q.rating-Y.rating),console.log("Rating.tsx - allRatings after sort:",L),console.log("Rating.tsx - allRatings length:",L.length),console.log("Rating.tsx - first rating breakdown:",(D=L[0])==null?void 0:D.breakdown),n(L)}catch(C){console.error("Error loading ratings:",C)}finally{o(!1)}},m=a.reduce((D,C)=>D+C.rating,0)/(a.length||1),f=s==="dark"?"text-white":"text-gray-900",x=k.useMemo(()=>[...a].sort((D,C)=>C.rating-D.rating),[a]),v=k.useMemo(()=>{var U,y;if(!a.length)return{top:0,median:0,count:0,high:0};const D=[...a].sort((b,E)=>E.rating-b.rating),C=((U=D[0])==null?void 0:U.rating)||0,M=((y=D[Math.floor((D.length-1)/2)])==null?void 0:y.rating)||C,V=D.filter(b=>b.rating>=80).length;return{top:C,median:M,count:D.length,high:V}},[a]),T=x[0],I=T?yr(T.userId):"—";k.useEffect(()=>{r||(async()=>{s0();for(const C of e)await fs(C.id)})()},[e,r]),k.useEffect(()=>{const D=async C=>{const M=C,{userId:V}=M.detail||{};if(V)await fs(V),n(U=>[...U]);else{s0();for(const U of e)await fs(U.id);n(U=>[...U])}};return window.addEventListener("nicknameUpdated",D),()=>{window.removeEventListener("nicknameUpdated",D)}},[e]);const N=[{label:"Средний КПД команды",value:`${m.toFixed(1)}%`,note:"за текущую неделю",icon:t.jsx(it,{className:"w-5 h-5 text-emerald-400"}),bgClass:"bg-emerald-500/5",borderClass:"border-emerald-500/20"},{label:"Лидер недели",value:I,note:T?`${T.rating.toFixed(1)}%`:"—",icon:t.jsx(gf,{className:"w-5 h-5 text-amber-400"}),bgClass:"bg-amber-500/5",borderClass:"border-amber-500/20"},{label:"Участников 80%+",value:`${v.high}`,note:"высокий уровень",icon:t.jsx(rr,{className:"w-5 h-5 text-blue-400"}),bgClass:"bg-blue-500/5",borderClass:"border-blue-500/20"},{label:"Рефералы за 30 дней",value:`${c.length}`,note:"новые участники",icon:t.jsx(tm,{className:"w-5 h-5 text-pink-400"}),bgClass:"bg-pink-500/5",borderClass:"border-pink-500/20"}];return t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"space-y-6",children:[t.jsx("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsx("div",{className:"p-3 bg-emerald-500/10 rounded-2xl border border-emerald-500/20",children:t.jsx(it,{className:"w-8 h-8 text-emerald-500"})}),t.jsxs("div",{children:[t.jsx("h1",{className:`text-2xl md:text-3xl font-black tracking-tight ${f}`,children:"AVF Rating"}),t.jsx("p",{className:`text-sm font-medium ${s==="dark"?"text-gray-400":"text-gray-500"}`,children:"Рейтинг эффективности команды ApeVault Frontier"})]})]})}),t.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:N.map((D,C)=>t.jsxs("div",{className:`relative overflow-hidden rounded-2xl p-5 border transition-all duration-300 hover:shadow-lg group ${s==="dark"?`${D.bgClass} ${D.borderClass} hover:border-opacity-50`:"bg-white border-gray-100 hover:border-emerald-500/20"}`,children:[t.jsxs("div",{className:"flex justify-between items-start mb-4",children:[t.jsx("span",{className:`text-[10px] font-bold uppercase tracking-wider ${s==="dark"?"text-gray-400":"text-gray-500"}`,children:D.label}),t.jsx("div",{className:`p-2 rounded-xl transition-colors ${s==="dark"?"bg-white/5 group-hover:bg-white/10":"bg-gray-100 group-hover:bg-gray-200"}`,children:D.icon})]}),t.jsxs("div",{className:"space-y-1",children:[t.jsx("div",{className:`text-2xl font-black tracking-tight ${f}`,children:D.value}),t.jsx("div",{className:"text-[11px] font-medium text-gray-500",children:D.note})]})]},C))})]}),t.jsxs("div",{className:`rounded-2xl p-6 border ${s==="dark"?"bg-[#0b1015] border-white/5":"bg-white border-gray-100"} shadow-xl`,children:[t.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[t.jsx("div",{className:"p-2 bg-emerald-500/10 rounded-xl",children:t.jsx(Vr,{className:"w-5 h-5 text-emerald-400"})}),t.jsxs("div",{children:[t.jsx("h3",{className:`text-lg font-black tracking-tight ${f}`,children:"Детальная статистика"}),t.jsx("p",{className:`text-sm ${s==="dark"?"text-gray-400":"text-gray-500"}`,children:"Карточки участников с полными данными"})]})]}),i?t.jsx("div",{className:`rounded-xl p-12 text-center border border-dashed ${s==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-gray-50"}`,children:t.jsxs("div",{className:"flex flex-col items-center gap-4",children:[t.jsx("div",{className:"w-10 h-10 border-4 border-emerald-500/20 border-t-emerald-500 rounded-full animate-spin"}),t.jsx("p",{className:`text-sm font-medium ${s==="dark"?"text-gray-400":"text-gray-500"}`,children:"Загрузка рейтинга..."})]})}):t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-6",children:[{label:"Топ-1",value:(O=x[0])!=null&&O.rating?`${x[0].rating.toFixed(1)}%`:"—"},{label:"Средний рейтинг",value:`${m.toFixed(1)}%`},{label:"Медиана",value:`${v.median.toFixed(1)}%`},{label:"Участников",value:x.length}].map(D=>t.jsxs("div",{className:`rounded-xl border px-4 py-3 ${s==="dark"?"bg-white/5 border-white/10":"bg-gray-50 border-gray-200"}`,children:[t.jsx("p",{className:`text-[11px] uppercase tracking-wide font-bold ${s==="dark"?"text-gray-400":"text-gray-500"}`,children:D.label}),t.jsx("p",{className:`text-2xl font-black ${f}`,children:D.value})]},D.label))}),t.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-2 gap-6",children:x.map((D,C)=>t.jsx(h4,{rating:D,place:{rank:C+1}},D.userId))})]})]})]})},Ac={trading:bf,learning:Fs,technical:kf,stream:J0,research:Nf,organization:yf},g4=({loading:s,message:e="Сохранение...",onComplete:r})=>{const[a,n]=k.useState(0),[i,o]=k.useState(!1);return k.useEffect(()=>{if(!s){n(100),o(!0),r==null||r();const f=setTimeout(()=>{o(!1)},1e3);return()=>clearTimeout(f)}n(0),o(!1);const c=2e3,d=50;let u=0;const m=setInterval(()=>{u+=100/(c/d);const f=Math.random()>.7?5:0;n(Math.min(u+f,85))},d);return()=>clearInterval(m)},[s,r]),!s&&!i&&a===0?null:t.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center pointer-events-none",children:[t.jsx("div",{className:`absolute inset-0 transition-all duration-300 ${s||i?"bg-black/40 backdrop-blur-sm":"bg-transparent"}`}),t.jsxs("div",{className:`relative transform transition-all duration-300 ${i?"scale-110":"scale-100"}`,children:[t.jsxs("div",{className:"relative w-24 h-24",children:[t.jsxs("svg",{className:"w-full h-full transform -rotate-90",children:[t.jsx("circle",{cx:"48",cy:"48",r:"40",fill:"none",stroke:"rgba(255,255,255,0.1)",strokeWidth:"6"}),t.jsx("circle",{cx:"48",cy:"48",r:"40",fill:"none",stroke:i?"#10B981":"#4E6E49",strokeWidth:"6",strokeLinecap:"round",strokeDasharray:`${2*Math.PI*40}`,strokeDashoffset:`${2*Math.PI*40*(1-a/100)}`,className:"transition-all duration-300 ease-out",style:{filter:i?"drop-shadow(0 0 8px rgba(16, 185, 129, 0.6))":"drop-shadow(0 0 6px rgba(78, 110, 73, 0.4))"}})]}),t.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:i?t.jsx("div",{className:"w-10 h-10 text-emerald-400 animate-bounce-in",children:t.jsx("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"3",strokeLinecap:"round",strokeLinejoin:"round",children:t.jsx("polyline",{points:"20 6 9 17 4 12"})})}):s?t.jsxs("div",{className:"w-8 h-8 relative",children:[t.jsx("div",{className:"absolute inset-0 border-3 border-emerald-400/30 rounded-full"}),t.jsx("div",{className:"absolute inset-0 border-3 border-transparent border-t-emerald-400 rounded-full animate-spin"})]}):null})]}),t.jsx("div",{className:`absolute -bottom-10 left-1/2 transform -translate-x-1/2 whitespace-nowrap transition-all duration-300 ${i?"translate-y-0 opacity-100":"translate-y-2 opacity-0"}`,children:t.jsx("span",{className:"text-white text-sm font-medium drop-shadow-lg",children:i?"Сохранено!":e})}),i&&t.jsx(t.Fragment,{children:[...Array(6)].map((c,d)=>t.jsx("div",{className:"absolute w-2 h-2 bg-emerald-400 rounded-full animate-particle",style:{top:"50%",left:"50%","--angle":`${d*60}deg`,animationDelay:`${d*.1}s`}},d))})]}),!i&&s&&t.jsx("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none",children:t.jsx("div",{className:"w-32 h-32 bg-emerald-500/20 rounded-full animate-ping"})}),t.jsx("style",{children:`
        @keyframes bounce-in {
          0% { transform: scale(0); opacity: 0; }
          50% { transform: scale(1.2); }
          100% { transform: scale(1); opacity: 1; }
        }

        @keyframes particle {
          0% {
            transform: translate(-50%, -50%) rotate(var(--angle)) translateX(0);
            opacity: 1;
          }
          100% {
            transform: translate(-50%, -50%) rotate(var(--angle)) translateX(40px);
            opacity: 0;
          }
        }

        .animate-bounce-in {
          animation: bounce-in 0.4s ease-out forwards;
        }

        .animate-particle {
          animation: particle 0.6s ease-out forwards;
        }
      `})]})},p4=({onClose:s,onSave:e,editingTask:r})=>{var H,me;const{user:a}=ot(),{theme:n}=Re(),i=!!r,o=n==="dark"?"text-white":"text-gray-900",c=n==="dark"?"bg-[#1a1a1a]":"bg-white",d=n==="dark"?"bg-gray-800":"bg-gray-50",u=n==="dark"?"border-gray-800":"border-gray-300",[m,f]=k.useState((r==null?void 0:r.title)||""),[x,v]=k.useState((r==null?void 0:r.description)||""),[T,I]=k.useState((r==null?void 0:r.category)||"trading"),[N,O]=k.useState((r==null?void 0:r.priority)||"medium"),[D,C]=k.useState((r==null?void 0:r.expectedResult)||""),[M,V]=k.useState((r==null?void 0:r.dueDate)||oe(new Date,"yyyy-MM-dd")),[U,y]=k.useState((r==null?void 0:r.dueTime)||"12:00"),b=G=>({...G,assignees:G.assignees||[],approvals:G.approvals||[],requiresApproval:G.requiresApproval??!0,stagePriority:G.stagePriority||"medium",status:G.status||"pending"}),[E,j]=k.useState((H=r==null?void 0:r.stages)!=null&&H.length?r.stages.map(b):[b({id:"stage-1",name:"Этап 1",description:"",responsible:"all",assignees:[],approvals:[],stagePriority:"medium",requiresApproval:!0,status:"pending"})]),[A,w]=k.useState((r==null?void 0:r.currentStageId)||((me=E[0])==null?void 0:me.id)||"stage-1"),[g,$]=k.useState(""),[L,ee]=k.useState(!1);ns();const te=[{value:"urgent",label:"Экстренный",desc:"Нужно прямо сейчас",tone:n==="dark"?"bg-rose-600/20 border-rose-500/50 text-rose-100":"bg-rose-50 border-rose-200 text-rose-700"},{value:"high",label:"Высокий",desc:"Быстрый старт",tone:n==="dark"?"bg-red-500/15 border-red-500/40 text-red-100":"bg-red-50 border-red-200 text-red-700"},{value:"medium",label:"Средний",desc:"Плановый слот",tone:n==="dark"?"bg-amber-500/15 border-amber-500/40 text-amber-100":"bg-amber-50 border-amber-200 text-amber-700"},{value:"low",label:"Низкий",desc:"Фон",tone:n==="dark"?"bg-gray-500/15 border-gray-500/40 text-gray-100":"bg-gray-50 border-gray-200 text-gray-700"}],Y=(G,se)=>{j(Z=>Z.map(ne=>ne.id===G?{...ne,...se}:ne))},q=(G,se)=>{j(Z=>Z.map(ne=>ne.id!==G?ne:ne.assignees.find(Ce=>Ce.userId===se)?{...ne,assignees:ne.assignees.filter(Ce=>Ce.userId!==se)}:ne.assignees.length>=10?ne:{...ne,assignees:[...ne.assignees,{userId:se,priority:"medium"}]}))},R=(G,se,Z,ne)=>{j(ie=>ie.map(Ce=>{if(Ce.id!==G)return Ce;const je=Ce.assignees.map(le=>le.userId===se?{...le,[Z]:ne}:le);return{...Ce,assignees:je}}))},S=()=>{const G=b({id:`stage-${Date.now()}`,name:`Этап ${E.length+1}`,description:"",responsible:"all",assignees:[],approvals:[],stagePriority:"medium",requiresApproval:!0,status:"pending"});j(se=>[...se,G]),A||w(G.id)},P=G=>{var Z;if(E.length===1)return;const se=E.filter(ne=>ne.id!==G);j(se),A===G&&w(((Z=se[0])==null?void 0:Z.id)||"")},W=()=>m.trim()?!M||!U?"Укажите дедлайн (дата и время)":new Set(E.flatMap(se=>se.assignees.map(Z=>Z.userId))).size===0?"Добавьте исполнителей в этапах":"":"Введите название задачи",K=(G,se)=>{const Z=G.assignees,ne=Z.map(Ce=>Ce.userId),ie=ne.map(Ce=>{const je=Z.find(le=>le.userId===Ce);return{userId:Ce,status:"pending",updatedAt:se,...je!=null&&je.comment?{comment:je.comment}:{}}});return{id:G.id,name:G.name,description:G.description,responsible:ne,assignees:Z,stagePriority:G.stagePriority||"medium",requiresApproval:!0,approvals:ie,comments:G.comments||[],status:"pending"}},he=async()=>{var Z;const G=W();if(G){$(G);return}if(!a){$("Пользователь не найден");return}$(""),ee(!0);const se=new Date().toISOString();try{const ne=E.map(le=>K(le,se)),ie=Array.from(new Set(ne.flatMap(le=>{var ue;return((ue=le.assignees)==null?void 0:ue.map(F=>F.userId))||[]}))),Ce=ie.map(le=>({userId:le,status:"pending",updatedAt:se})),je={title:m.trim(),description:x.trim()||void 0,category:T,priority:N,assignedTo:ie,assignees:ie.map(le=>({userId:le,priority:"medium"})),approvals:Ce,stages:ne,currentStageId:A||((Z=ne[0])==null?void 0:Z.id),dueDate:M,dueTime:U,expectedResult:D.trim()||void 0,updatedAt:se};if(i&&r)await b_(r.id,je);else{const le={...je,status:"in_progress",createdBy:a.id,createdAt:se};await f_(le)}e()}catch(ne){console.error("Error saving task:",ne),$("Ошибка при сохранении задачи")}finally{ee(!1)}};return t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-start sm:items-center justify-center z-[70] p-4 overflow-y-auto overscroll-contain modal-scroll touch-pan-y",children:t.jsx("div",{className:`${c} rounded-xl sm:rounded-2xl shadow-2xl w-full max-w-2xl max-h-[calc(100vh-48px)] sm:max-h-[calc(100vh-64px)] overflow-y-auto border-2 touch-pan-y ${n==="dark"?"border-[#4E6E49]/30 bg-gradient-to-br from-[#1a1a1a] via-[#1a1a1a] to-[#0A0A0A]":"border-green-200 bg-gradient-to-br from-white via-green-50/30 to-white"} relative`,children:t.jsxs("div",{className:"flex flex-col h-full min-h-0",children:[t.jsxs("div",{className:`sticky top-0 ${c} border-b ${u} p-4 sm:p-6 flex items-center justify-between z-10`,children:[t.jsxs("h2",{className:`text-xl sm:text-2xl font-bold ${o} flex items-center gap-2`,children:[t.jsx(Xi,{className:"w-5 h-5 sm:w-6 sm:h-6"}),i?"Редактировать задачу":"Новая задача"]}),t.jsx("button",{onClick:s,className:`p-2 rounded-lg transition-colors ${n==="dark"?"hover:bg-gray-700":"hover:bg-gray-100"}`,children:t.jsx(pt,{className:"w-5 h-5"})})]}),t.jsxs("div",{className:"p-4 sm:p-6 space-y-4 sm:space-y-6 flex-1 min-h-0 overflow-y-auto overscroll-contain modal-scroll touch-pan-y pb-10",children:[g&&t.jsxs("div",{className:"p-3 rounded-lg bg-red-500/10 border border-red-500/30 flex items-center gap-2 text-red-500",children:[t.jsx($f,{className:"w-5 h-5 flex-shrink-0"}),t.jsx("span",{className:"text-sm",children:g})]}),t.jsxs("div",{children:[t.jsx("label",{className:`block text-sm font-medium mb-2 ${o}`,children:"Название *"}),t.jsx("input",{value:m,onChange:G=>f(G.target.value),className:`w-full px-4 py-2.5 rounded-lg border ${u} ${d} ${o} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]/50`,placeholder:"Введите название задачи"})]}),t.jsxs("div",{children:[t.jsx("label",{className:`block text-sm font-medium mb-2 ${o}`,children:"Описание"}),t.jsx("textarea",{value:x,onChange:G=>v(G.target.value),rows:4,className:`w-full px-4 py-2.5 rounded-lg border ${u} ${d} ${o} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]/50`,placeholder:"Кратко опишите задачу"})]}),t.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[t.jsxs("div",{className:"space-y-3",children:[t.jsxs("label",{className:`block text-sm font-medium ${o} flex items-center gap-2`,children:[t.jsx(Ql,{className:"w-4 h-4"}),"Категория"]}),t.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2 sm:gap-3",children:Object.entries(Gi).map(([G,{label:se}])=>{const Z=Ac[G],ne=T===G;return t.jsxs("button",{type:"button",onClick:()=>I(G),className:`p-3 rounded-lg border-2 text-sm font-semibold transition-all text-center ${ne?n==="dark"?"border-[#4E6E49] bg-[#4E6E49]/15 text-[#4E6E49]":"border-[#4E6E49] bg-green-50 text-[#4E6E49]":n==="dark"?"border-gray-800 bg-gray-900 text-gray-200 hover:border-[#4E6E49]/40":"border-gray-200 bg-white text-gray-800 hover:border-[#4E6E49]/40"} flex items-center justify-center gap-2`,children:[t.jsx(Z,{className:"w-4 h-4"}),t.jsx("span",{children:se})]},G)})})]}),t.jsxs("div",{className:"space-y-3",children:[t.jsxs("label",{className:`block text-sm font-medium ${o} flex items-center gap-2`,children:[t.jsx(ts,{className:"w-4 h-4"}),"Приоритет"]}),t.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2",children:te.map(G=>t.jsxs("button",{type:"button",onClick:()=>O(G.value),className:`p-3 rounded-lg border-2 text-left transition-all ${G.tone} ${N===G.value?"ring-2 ring-offset-2 ring-[#4E6E49] dark:ring-offset-[#1a1a1a]":""}`,children:[t.jsxs("div",{className:"flex items-center justify-between gap-2",children:[t.jsx("span",{className:"font-semibold text-sm",children:G.label}),N===G.value&&t.jsx("span",{className:"text-xs font-semibold",children:"выбрано"})]}),t.jsx("p",{className:"text-xs mt-1 opacity-80",children:G.desc})]},G.value))})]})]}),t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("label",{className:`block text-sm font-medium ${o}`,children:"Этапы и исполнители"}),t.jsxs("button",{type:"button",onClick:S,className:`px-3 py-1.5 rounded-lg text-xs font-semibold ${n==="dark"?"bg-gray-700 hover:bg-gray-600 text-gray-200":"bg-gray-200 hover:bg-gray-300 text-gray-800"}`,children:[t.jsx(mr,{className:"w-4 h-4 inline"})," Добавить этап"]})]}),t.jsx("div",{className:"space-y-3",children:E.map((G,se)=>t.jsxs("div",{className:`p-3 rounded-lg border-2 ${u} ${d}`,children:[t.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[t.jsx("input",{value:G.name,onChange:Z=>Y(G.id,{name:Z.target.value}),className:`flex-1 px-3 py-2 rounded-lg border ${u} ${n==="dark"?"bg-[#0f0f0f] text-gray-100":"bg-white text-gray-800"}`,placeholder:`Этап ${se+1}`}),E.length>1&&t.jsx("button",{onClick:()=>P(G.id),className:`p-2 rounded-lg ${n==="dark"?"bg-red-500/20 text-red-200":"bg-red-100 text-red-700"}`,children:t.jsx(Jf,{className:"w-4 h-4"})})]}),t.jsx("textarea",{value:G.description||"",onChange:Z=>Y(G.id,{description:Z.target.value}),rows:2,className:`w-full px-3 py-2 rounded-lg border ${u} ${n==="dark"?"bg-[#0f0f0f] text-gray-100":"bg-white text-gray-800"}`,placeholder:"Описание этапа (опционально)"}),t.jsxs("div",{className:"mt-3 space-y-2",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("label",{className:`text-sm font-medium ${o} flex items-center gap-2`,children:[t.jsx(Gt,{className:"w-4 h-4"}),"Исполнители этапа"]}),t.jsxs("span",{className:"text-[11px] text-gray-500",children:[G.assignees.length,"/10"]})]}),t.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-2",children:Ge.map(Z=>{const ne=G.assignees.some(ie=>ie.userId===Z.id);return t.jsx("button",{type:"button",onClick:()=>q(G.id,Z.id),className:`p-2 rounded-lg border text-left text-sm transition-all ${ne?n==="dark"?"border-[#4E6E49] bg-[#4E6E49]/20":"border-[#4E6E49] bg-green-50":`${u} ${d}`}`,children:t.jsx("span",{className:ne?"text-[#4E6E49]":o,children:yr(Z.id)})},Z.id)})}),G.assignees.length>0&&t.jsx("div",{className:"space-y-2",children:G.assignees.map(Z=>{const ne=Ge.find(ie=>ie.id===Z.userId);return t.jsxs("div",{className:`p-2 rounded-lg border ${u} ${n==="dark"?"bg-[#0f0f0f]":"bg-white"}`,children:[t.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2",children:[t.jsx("div",{className:"text-sm font-medium",children:(ne==null?void 0:ne.name)||Z.userId}),t.jsxs("select",{value:Z.priority,onChange:ie=>R(G.id,Z.userId,"priority",ie.target.value),className:`px-3 py-1.5 rounded-lg border ${u} ${n==="dark"?"bg-[#1a1a1a] text-gray-100":"bg-white text-gray-700"}`,children:[t.jsx("option",{value:"urgent",children:"Экстренный"}),t.jsx("option",{value:"high",children:"Высокий"}),t.jsx("option",{value:"medium",children:"Средний"}),t.jsx("option",{value:"low",children:"Низкий"})]})]}),t.jsx("textarea",{value:Z.comment||"",onChange:ie=>R(G.id,Z.userId,"comment",ie.target.value),rows:2,className:`mt-2 w-full px-3 py-2 rounded-lg border ${u} ${n==="dark"?"bg-[#1a1a1a] text-gray-100":"bg-white text-gray-700"}`,placeholder:"Комментарий для исполнителя (опционально)"})]},Z.userId)})})]})]},G.id))})]}),t.jsxs("div",{children:[t.jsxs("label",{className:`block text-sm font-medium mb-2 ${o} flex items-center gap-2`,children:[t.jsx(rr,{className:"w-4 h-4"}),"Какой результат должен быть"]}),t.jsx("textarea",{value:D,onChange:G=>C(G.target.value),rows:3,className:`w-full px-4 py-2.5 rounded-lg border ${u} ${d} ${o} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]/50`,placeholder:"Опишите ожидаемый итог"})]}),t.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[t.jsxs("div",{className:"space-y-1",children:[t.jsxs("label",{className:`block text-sm font-medium ${o} flex items-center gap-2`,children:[t.jsx(ir,{className:"w-4 h-4"}),"Дата дедлайна *"]}),t.jsx("input",{type:"date",value:M,onChange:G=>V(G.target.value),min:oe(new Date,"yyyy-MM-dd"),className:`w-full px-4 py-2.5 rounded-lg border ${u} ${d} ${o} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]/50`})]}),t.jsxs("div",{className:"space-y-1",children:[t.jsxs("label",{className:`block text-sm font-medium ${o} flex items-center gap-2`,children:[t.jsx(Lt,{className:"w-4 h-4"}),"Время дедлайна *"]}),t.jsx("input",{type:"time",value:U,onChange:G=>y(G.target.value),className:`w-full px-4 py-2.5 rounded-lg border ${u} ${d} ${o} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]/50`})]})]}),t.jsxs("div",{className:`flex flex-col sm:flex-row gap-3 pt-4 border-t ${u}`,children:[t.jsxs("button",{onClick:he,disabled:L,className:`flex-1 px-6 py-3 rounded-lg font-semibold transition-all relative overflow-hidden ${L?"bg-gray-400 cursor-not-allowed":"bg-gradient-to-r from-[#4E6E49] to-emerald-700 hover:from-[#4E6E49] hover:to-emerald-700 text-white shadow-lg hover:shadow-xl"}`,children:[t.jsx("span",{className:`relative z-10 flex items-center justify-center gap-2 ${L?"invisible":""}`,children:i?"Сохранить":"Создать задачу"}),L&&t.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:t.jsxs("div",{className:"flex items-center gap-2 text-white",children:[t.jsx("div",{className:"w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin"}),t.jsx("span",{children:"Сохранение..."})]})})]}),t.jsx("button",{onClick:s,className:`px-6 py-3 rounded-lg font-semibold transition-colors ${n==="dark"?"bg-gray-700 hover:bg-gray-600 text-gray-300":"bg-gray-200 hover:bg-gray-300 text-gray-700"}`,children:"Отмена"})]})]})]})})}),t.jsx(g4,{loading:L,message:"Сохранение задачи..."})]})},x4=({selectedCategory:s,selectedStatus:e,selectedUsers:r,onCategoryChange:a,onStatusChange:n,onUsersChange:i,onAddTask:o})=>{var y;const{theme:c}=Re(),[d,u]=k.useState(!1),[m,f]=k.useState(!1),x=c==="dark"?"bg-[#151a21]/50":"bg-white",v=c==="dark"?"border-white/5":"border-gray-200",T=c==="dark"?"text-white":"text-gray-900",I=c==="dark"?"text-gray-400":"text-gray-600",N=c==="dark"?"bg-[#0f1216]":"bg-gray-100",O=c==="dark"?"bg-[#1a1f26]":"bg-white",D=c==="dark"?"hover:bg-white/10":"hover:bg-gray-100",C=[{value:"all",label:"Все"},{value:"in_progress",label:"В работе"},{value:"completed",label:"Выполнено"},{value:"closed",label:"Закрыто"}],M=Object.entries(Gi).map(([b,{label:E}])=>({key:b,label:E})),V=s==="all"?"Все":((y=Gi[s])==null?void 0:y.label)||"Категория",U=s==="all"?Ql:Ac[s];return t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{className:"flex items-center justify-between gap-3 lg:hidden",children:[t.jsxs("button",{onClick:()=>u(!d),className:`flex items-center gap-2 px-4 py-2.5 rounded-xl border font-medium transition-all flex-1 justify-center ${c==="dark"?"bg-white/5 border-white/10 text-white hover:bg-white/10":"bg-gray-100 border-gray-200 text-gray-900 hover:bg-gray-200"}`,children:[t.jsx(W0,{className:"w-4 h-4"}),t.jsx("span",{children:"Фильтры"}),d?t.jsx(pt,{className:"w-4 h-4"}):t.jsx(Dr,{className:"w-4 h-4"})]}),t.jsxs("button",{onClick:o,className:`flex items-center gap-2 px-4 py-2.5 rounded-xl border font-medium transition-all flex-1 justify-center ${c==="dark"?"bg-emerald-500/10 border-emerald-500/20 text-emerald-400 hover:bg-emerald-500/20":"bg-emerald-50 border-emerald-200 text-emerald-600 hover:bg-emerald-100"}`,children:[t.jsx(mr,{className:"w-4 h-4"}),t.jsx("span",{children:"Новая"})]})]}),t.jsxs("div",{className:`rounded-xl border ${v} ${x} shadow-lg transition-all duration-300 ${d?"block":"hidden lg:block"}`,children:[t.jsx("div",{className:"p-2 sm:p-3",children:t.jsx("div",{className:`flex p-1 rounded-lg ${N} overflow-x-auto scrollbar-hide`,children:C.map(b=>t.jsx("button",{onClick:()=>n(b.value),className:`px-3 py-1.5 rounded-md text-xs sm:text-sm font-medium transition-all whitespace-nowrap flex-shrink-0 ${e===b.value?c==="dark"?"bg-[#2A3441] text-white shadow":"bg-white text-gray-900 shadow":c==="dark"?"text-gray-400 hover:text-white":"text-gray-500 hover:text-gray-900"}`,children:b.label},b.value))})}),t.jsxs("div",{className:"px-2 sm:px-3 pb-3 flex flex-col sm:flex-row gap-3",children:[t.jsxs("div",{className:"relative flex-1",children:[t.jsxs("button",{onClick:()=>f(!m),className:`w-full flex items-center justify-between gap-2 px-3 py-2 rounded-lg text-sm font-medium border ${v} ${N} ${T} cursor-pointer focus:outline-none focus:ring-2 focus:ring-emerald-500/50`,children:[t.jsxs("span",{className:"flex items-center gap-2",children:[t.jsx(U,{className:"w-4 h-4 text-emerald-400"}),t.jsx("span",{children:V})]}),t.jsx(Dr,{className:`w-4 h-4 ${I} transition-transform ${m?"rotate-180":""}`})]}),m&&t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"fixed inset-0 z-10",onClick:()=>f(!1)}),t.jsxs("div",{className:`absolute top-full left-0 right-0 mt-1 ${O} border ${v} rounded-lg shadow-xl z-20 overflow-hidden`,children:[t.jsxs("button",{onClick:()=>{a("all"),f(!1)},className:`w-full flex items-center gap-2 px-3 py-2 text-sm font-medium transition-colors ${D} ${s==="all"?c==="dark"?"bg-white/10 text-white":"bg-gray-100 text-gray-900":I}`,children:[t.jsx(Ql,{className:"w-4 h-4"}),t.jsx("span",{children:"Все категории"})]}),M.map(({key:b,label:E})=>{const j=Ac[b];return t.jsxs("button",{onClick:()=>{a(b),f(!1)},className:`w-full flex items-center gap-2 px-3 py-2 text-sm font-medium transition-colors ${D} ${s===b?c==="dark"?"bg-white/10 text-white":"bg-gray-100 text-gray-900":I}`,children:[t.jsx(j,{className:"w-4 h-4"}),t.jsx("span",{children:E})]},b)})]})]})]}),t.jsx("div",{className:"w-full sm:w-48",children:t.jsx(Qp,{selectedUserId:r[0]||null,onSelect:b=>i(b?[b]:[])})})]})]}),t.jsx("div",{className:"hidden lg:block",children:t.jsxs("button",{onClick:o,className:`flex items-center gap-2 px-5 py-2.5 rounded-xl border font-medium transition-all ${c==="dark"?"bg-emerald-500/10 border-emerald-500/20 text-emerald-400 hover:bg-emerald-500/20":"bg-emerald-50 border-emerald-200 text-emerald-600 hover:bg-emerald-100"}`,children:[t.jsx(mr,{className:"w-4 h-4"}),t.jsx("span",{children:"Новая задача"})]})})]})},f4=({tasks:s,onEdit:e,onDelete:r})=>{const{theme:a}=Re(),{users:n}=ea(),i=u=>n.find(m=>m.id===u),o=u=>{const m=i(u);return m?m.name:"Unknown"},c=u=>{switch(u){case"in_progress":return"bg-yellow-500/10 text-yellow-500 border-yellow-500/20";case"completed":return"bg-emerald-500/10 text-emerald-500 border-emerald-500/20";case"closed":return"bg-slate-500/10 text-slate-400 border-slate-500/20";default:return"bg-gray-500/10 text-gray-400 border-gray-500/20"}},d=u=>{const m={trading:"bg-emerald-500/10 text-emerald-400 border-emerald-500/20",research:"bg-blue-500/10 text-blue-400 border-blue-500/20",content:"bg-purple-500/10 text-purple-400 border-purple-500/20",stream:"bg-pink-500/10 text-pink-400 border-pink-500/20",other:"bg-gray-500/10 text-gray-400 border-gray-500/20",learning:"bg-indigo-500/10 text-indigo-400 border-indigo-500/20"};return m[u]||m.other};return s.length===0?t.jsx("div",{className:`text-center py-20 rounded-3xl border-2 border-dashed ${a==="dark"?"border-white/5 text-gray-500":"border-gray-200 text-gray-500"}`,children:t.jsxs("div",{className:"flex flex-col items-center gap-3",children:[t.jsx("div",{className:`p-4 rounded-full ${a==="dark"?"bg-white/5":"bg-gray-100"}`,children:t.jsx(Lt,{className:"w-8 h-8 opacity-50"})}),t.jsx("p",{children:"Задач пока нет"})]})}):t.jsx("div",{className:"w-full overflow-x-auto",children:t.jsxs("table",{className:"w-full border-separate border-spacing-y-3 -mt-3",children:[t.jsx("thead",{children:t.jsxs("tr",{className:`text-xs uppercase tracking-wider text-left ${a==="dark"?"text-gray-500":"text-gray-400"}`,children:[t.jsx("th",{className:"px-6 py-2 font-medium w-20",children:"#ID"}),t.jsx("th",{className:"px-6 py-2 font-medium",children:"Задача"}),t.jsx("th",{className:"px-6 py-2 font-medium",children:"Категория"}),t.jsx("th",{className:"px-6 py-2 font-medium",children:"Исполнитель"}),t.jsx("th",{className:"px-6 py-2 font-medium text-center",children:"Статус"}),t.jsx("th",{className:"px-6 py-2 font-medium text-right",children:"Действия"})]})}),t.jsx("tbody",{children:s.map(u=>{var m,f;return t.jsxs("tr",{className:`group transition-all duration-200 ${a==="dark"?"bg-[#151a21]/80 hover:bg-[#1a2029] hover:shadow-lg hover:shadow-black/20":"bg-white hover:bg-gray-50 hover:shadow-md"}`,children:[t.jsx("td",{className:`px-6 py-5 rounded-l-2xl border-y border-l ${a==="dark"?"border-white/5":"border-gray-100"}`,children:t.jsxs("span",{className:`font-mono text-xs opacity-50 ${a==="dark"?"text-gray-400":"text-gray-500"}`,children:["#",u.id.slice(0,4)]})}),t.jsx("td",{className:`px-6 py-5 border-y ${a==="dark"?"border-white/5":"border-gray-100"}`,children:t.jsxs("div",{className:"flex flex-col gap-1",children:[t.jsx("span",{className:`font-bold text-[15px] ${a==="dark"?"text-gray-200":"text-gray-800"}`,children:u.title}),t.jsxs("div",{className:"flex items-center gap-2 text-[11px] text-gray-500 font-medium",children:[t.jsx(Lt,{className:"w-3 h-3"}),u.dueDate?t.jsxs("span",{className:a==="dark"?"text-gray-500":"text-gray-400",children:[oe(new Date(u.dueDate),"d MMM")," ",u.dueTime?`, ${u.dueTime}`:""]}):t.jsx("span",{children:"Без срока"})]})]})}),t.jsx("td",{className:`px-6 py-5 border-y ${a==="dark"?"border-white/5":"border-gray-100"}`,children:t.jsx("span",{className:`px-3 py-1.5 rounded-lg text-[11px] font-bold tracking-wide uppercase border ${d(u.category)}`,children:((m=Gi[u.category])==null?void 0:m.label)||u.category})}),t.jsx("td",{className:`px-6 py-5 border-y ${a==="dark"?"border-white/5":"border-gray-100"}`,children:t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"w-8 h-8 rounded-full bg-gradient-to-br from-[#4E6E49] to-[#3d5639] flex items-center justify-center text-[10px] text-white font-bold shadow-inner",children:o(u.mainExecutor||u.assignedTo[0]).charAt(0)}),t.jsxs("div",{className:"flex flex-col",children:[t.jsx("span",{className:`text-sm font-medium ${a==="dark"?"text-gray-300":"text-gray-700"}`,children:o(u.mainExecutor||u.assignedTo[0])}),u.assignedTo.length>1&&t.jsxs("span",{className:"text-[10px] text-gray-500",children:["+",u.assignedTo.length-1," ещё"]})]})]})}),t.jsx("td",{className:`px-6 py-5 border-y text-center ${a==="dark"?"border-white/5":"border-gray-100"}`,children:t.jsxs("span",{className:`inline-flex items-center gap-1.5 px-3 py-1.5 rounded-full text-[11px] font-bold uppercase tracking-wide border ${c(u.status)}`,children:[t.jsx("span",{className:`w-1.5 h-1.5 rounded-full ${u.status==="in_progress"?"bg-yellow-500 animate-pulse":u.status==="completed"?"bg-emerald-500":"bg-slate-400"}`}),((f=cf[u.status])==null?void 0:f.label)||u.status]})}),t.jsx("td",{className:`px-6 py-5 rounded-r-2xl border-y border-r text-right ${a==="dark"?"border-white/5":"border-gray-100"}`,children:t.jsxs("div",{className:"flex items-center justify-end gap-1 opacity-0 group-hover:opacity-100 transition-all duration-200 translate-x-2 group-hover:translate-x-0",children:[t.jsx("button",{onClick:()=>e(u),className:`p-2 rounded-lg transition-colors ${a==="dark"?"hover:bg-white/10 text-gray-500 hover:text-white":"hover:bg-gray-100 text-gray-400 hover:text-gray-900"}`,children:t.jsx(Lf,{className:"w-4 h-4"})}),t.jsx("button",{onClick:()=>r(u.id),className:`p-2 rounded-lg transition-colors ${a==="dark"?"hover:bg-red-500/10 text-gray-500 hover:text-red-400":"hover:bg-red-50 text-gray-400 hover:text-red-600"}`,children:t.jsx(Et,{className:"w-4 h-4"})})]})})]},u.id)})})]})})},b4=()=>{const{theme:s}=Re(),{user:e}=ot(),[r,a]=k.useState(!1),[n,i]=k.useState(null),[o,c]=k.useState([]),[d,u]=k.useState(!0),[m,f]=k.useState("all"),[x,v]=k.useState("all"),[T,I]=k.useState([]),N=s==="dark"?"text-white":"text-gray-900";k.useEffect(()=>{O()},[e]),k.useEffect(()=>{O()},[m,x,T]);const O=async()=>{u(!0);try{const g={};m!=="all"&&(g.category=m),x!=="all"&&(g.status=x),T.length>0&&(g.assignedTo=T);const $=await Hp(g);c($)}catch(g){console.error("Error loading tasks:",g)}finally{u(!1)}},D=g=>{i(g),a(!0)},C=async g=>{if(confirm("Вы уверены, что хотите удалить эту задачу?"))try{await Gp(g),O()}catch($){console.error("Error deleting task:",$)}},M=()=>{a(!1),i(null)},V=()=>{a(!1),i(null),O()},U=o.filter(g=>!(m!=="all"&&g.category!==m||x!=="all"&&g.status!==x||T.length>0&&!T.some($=>g.assignedTo.includes($)))),y=new Date,b=oe(y,"yyyy-MM-dd"),E=new Date(y.getTime()-7*24*60*60*1e3),j=new Date(y.getTime()-30*24*60*60*1e3),A={totalToday:o.filter(g=>g.createdAt.startsWith(b)).length,totalWeek:o.filter(g=>new Date(g.createdAt)>=E).length,totalMonth:o.filter(g=>new Date(g.createdAt)>=j).length,inProgress:o.filter(g=>g.status==="in_progress").length,completedToday:o.filter(g=>{var $;return g.status==="completed"&&(($=g.completedAt)==null?void 0:$.startsWith(b))}).length,completedWeek:o.filter(g=>g.status==="completed"&&g.completedAt&&new Date(g.completedAt)>=E).length,closedMonth:o.filter(g=>g.status==="closed"&&new Date(g.createdAt)>=j).length},w=o.filter(g=>g.status!=="completed"&&g.status!=="closed"&&g.dueDate).sort((g,$)=>new Date(`${g.dueDate}T${g.dueTime}`).getTime()-new Date(`${$.dueDate}T${$.dueTime}`).getTime())[0];return t.jsxs("div",{className:"space-y-8 animate-fade-in pb-12 font-sans",children:[t.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsx("div",{className:"p-3 rounded-2xl bg-emerald-500/10 border border-emerald-500/20",children:t.jsx(da,{className:"w-8 h-8 text-emerald-500"})}),t.jsxs("div",{children:[t.jsx("h1",{className:`text-3xl font-black ${N} flex items-center gap-3`,children:"AVF Tasks"}),t.jsx("p",{className:s==="dark"?"text-gray-400":"text-gray-500",children:"Управление задачами и заданиями команды ApeVault Frontier"})]})]}),t.jsx("div",{className:"ml-auto flex items-center gap-4"})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[t.jsxs("div",{className:`relative overflow-hidden rounded-2xl p-5 border transition-all duration-300 hover:shadow-lg group ${s==="dark"?"bg-emerald-500/5 border-emerald-500/20 hover:border-emerald-500/50":"bg-white border-gray-100 hover:border-emerald-500/20"}`,children:[t.jsxs("div",{className:"flex justify-between items-start mb-4",children:[t.jsx("span",{className:`text-[10px] font-bold uppercase tracking-wider ${s==="dark"?"text-gray-400":"text-gray-500"}`,children:"Всего задач сегодня"}),t.jsx("div",{className:`p-2 rounded-xl transition-colors ${s==="dark"?"bg-white/5 group-hover:bg-white/10":"bg-gray-100 group-hover:bg-gray-200"}`,children:t.jsx(ir,{className:"w-5 h-5 text-emerald-400"})})]}),t.jsxs("div",{className:"space-y-1",children:[t.jsx("div",{className:`text-2xl font-black tracking-tight ${N}`,children:A.totalToday}),t.jsx("div",{className:"text-[11px] font-medium text-emerald-400 bg-emerald-500/10 w-fit px-2 py-0.5 rounded-full border border-emerald-500/20",children:"↗ Активность ↑"})]})]}),t.jsxs("div",{className:`relative overflow-hidden rounded-2xl p-5 border transition-all duration-300 hover:shadow-lg group ${s==="dark"?"bg-blue-500/5 border-blue-500/20 hover:border-blue-500/50":"bg-white border-gray-100 hover:border-blue-500/20"}`,children:[t.jsxs("div",{className:"flex justify-between items-start mb-4",children:[t.jsx("span",{className:`text-[10px] font-bold uppercase tracking-wider ${s==="dark"?"text-gray-400":"text-gray-500"}`,children:"Всего на неделе"}),t.jsx("div",{className:`p-2 rounded-xl transition-colors ${s==="dark"?"bg-white/5 group-hover:bg-white/10":"bg-gray-100 group-hover:bg-gray-200"}`,children:t.jsx(K0,{className:"w-5 h-5 text-blue-400"})})]}),t.jsxs("div",{className:"space-y-1",children:[t.jsx("div",{className:`text-2xl font-black tracking-tight ${N}`,children:A.totalWeek}),t.jsx("div",{className:"text-[11px] font-medium text-gray-500",children:"Общий объем"})]})]}),t.jsxs("div",{className:`relative overflow-hidden rounded-2xl p-5 border transition-all duration-300 hover:shadow-lg group ${s==="dark"?"bg-indigo-500/5 border-indigo-500/20 hover:border-indigo-500/50":"bg-white border-gray-100 hover:border-indigo-500/20"}`,children:[t.jsxs("div",{className:"flex justify-between items-start mb-4",children:[t.jsx("span",{className:`text-[10px] font-bold uppercase tracking-wider ${s==="dark"?"text-gray-400":"text-gray-500"}`,children:"Всего в месяце"}),t.jsx("div",{className:`p-2 rounded-xl transition-colors ${s==="dark"?"bg-white/5 group-hover:bg-white/10":"bg-gray-100 group-hover:bg-gray-200"}`,children:t.jsx(G0,{className:"w-5 h-5 text-indigo-400"})})]}),t.jsxs("div",{className:"space-y-1",children:[t.jsx("div",{className:`text-2xl font-black tracking-tight ${N}`,children:A.totalMonth}),t.jsx("div",{className:"text-[11px] font-medium text-gray-500",children:"Накопительный итог"})]})]}),t.jsxs("div",{className:`relative overflow-hidden rounded-2xl p-5 border transition-all duration-300 hover:shadow-lg group ${s==="dark"?"bg-amber-500/5 border-amber-500/20 hover:border-amber-500/50":"bg-white border-gray-100 hover:border-amber-500/20"}`,children:[t.jsxs("div",{className:"flex justify-between items-start mb-4",children:[t.jsx("span",{className:`text-[10px] font-bold uppercase tracking-wider ${s==="dark"?"text-gray-400":"text-gray-500"}`,children:"Задач в работе"}),t.jsx("div",{className:`p-2 rounded-xl transition-colors ${s==="dark"?"bg-white/5 group-hover:bg-white/10":"bg-gray-100 group-hover:bg-gray-200"}`,children:t.jsx(Ar,{className:"w-5 h-5 text-amber-400"})})]}),t.jsxs("div",{className:"space-y-1",children:[t.jsx("div",{className:`text-2xl font-black tracking-tight ${N}`,children:A.inProgress}),t.jsx("div",{className:"text-[11px] font-medium text-amber-400 bg-amber-500/10 w-fit px-2 py-0.5 rounded-full border border-amber-500/20",children:"Требуют внимания"})]})]}),t.jsxs("div",{className:`relative overflow-hidden rounded-2xl p-5 border transition-all duration-300 hover:shadow-lg group ${s==="dark"?"bg-teal-500/5 border-teal-500/20 hover:border-teal-500/50":"bg-white border-gray-100 hover:border-teal-500/20"}`,children:[t.jsxs("div",{className:"flex justify-between items-start mb-4",children:[t.jsx("span",{className:`text-[10px] font-bold uppercase tracking-wider ${s==="dark"?"text-gray-400":"text-gray-500"}`,children:"Закрыто сегодня"}),t.jsx("div",{className:`p-2 rounded-xl transition-colors ${s==="dark"?"bg-white/5 group-hover:bg-white/10":"bg-gray-100 group-hover:bg-gray-200"}`,children:t.jsx(Ir,{className:"w-5 h-5 text-teal-400"})})]}),t.jsx("div",{className:"space-y-2",children:t.jsx("div",{className:`text-2xl font-black tracking-tight ${N}`,children:A.completedToday})})]}),t.jsxs("div",{className:`relative overflow-hidden rounded-2xl p-5 border transition-all duration-300 hover:shadow-lg group ${s==="dark"?"bg-cyan-500/5 border-cyan-500/20 hover:border-cyan-500/50":"bg-white border-gray-100 hover:border-cyan-500/20"}`,children:[t.jsxs("div",{className:"flex justify-between items-start mb-4",children:[t.jsx("span",{className:`text-[10px] font-bold uppercase tracking-wider ${s==="dark"?"text-gray-400":"text-gray-500"}`,children:"Закрыто на неделе"}),t.jsx("div",{className:`p-2 rounded-xl transition-colors ${s==="dark"?"bg-white/5 group-hover:bg-white/10":"bg-gray-100 group-hover:bg-gray-200"}`,children:t.jsx(Ir,{className:"w-5 h-5 text-cyan-400"})})]}),t.jsx("div",{className:"space-y-2",children:t.jsx("div",{className:`text-2xl font-black tracking-tight ${N}`,children:A.completedWeek})})]}),t.jsxs("div",{className:`relative overflow-hidden rounded-2xl p-5 border transition-all duration-300 hover:shadow-lg group ${s==="dark"?"bg-sky-500/5 border-sky-500/20 hover:border-sky-500/50":"bg-white border-gray-100 hover:border-sky-500/20"}`,children:[t.jsxs("div",{className:"flex justify-between items-start mb-4",children:[t.jsx("span",{className:`text-[10px] font-bold uppercase tracking-wider ${s==="dark"?"text-gray-400":"text-gray-500"}`,children:"Закрыто в месяце"}),t.jsx("div",{className:`p-2 rounded-xl transition-colors ${s==="dark"?"bg-white/5 group-hover:bg-white/10":"bg-gray-100 group-hover:bg-gray-200"}`,children:t.jsx(L0,{className:"w-5 h-5 text-sky-400"})})]}),t.jsx("div",{className:"space-y-2",children:t.jsx("div",{className:`text-2xl font-black tracking-tight ${N}`,children:A.closedMonth})})]}),t.jsxs("div",{className:`relative overflow-hidden rounded-2xl p-5 border transition-all duration-300 hover:shadow-lg group ${s==="dark"?"bg-rose-500/5 border-rose-500/20 hover:border-rose-500/50":"bg-white border-gray-100 hover:border-rose-500/20"}`,children:[t.jsxs("div",{className:"flex justify-between items-start mb-4",children:[t.jsx("span",{className:`text-[10px] font-bold uppercase tracking-wider ${s==="dark"?"text-gray-400":"text-gray-500"}`,children:"Ближайший дедлайн"}),t.jsx("div",{className:`p-2 rounded-xl transition-colors ${s==="dark"?"bg-white/5 group-hover:bg-white/10":"bg-gray-100 group-hover:bg-gray-200"}`,children:t.jsx(an,{className:"w-5 h-5 text-rose-400"})})]}),t.jsxs("div",{className:"space-y-1",children:[t.jsx("div",{className:`text-2xl font-black tracking-tight ${N}`,children:w?t.jsxs(t.Fragment,{children:[w.dueDate===b?"Сегодня":oe(new Date(w.dueDate),"d MMM"),w.dueTime&&`, ${w.dueTime}`]}):"Нет"}),t.jsx("div",{className:"text-[11px] font-medium truncate text-gray-500",children:w?w.title:"Все сроки соблюдены"})]})]})]}),t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("h2",{className:`text-2xl font-black ${N}`,children:"Мои задачи"}),t.jsxs("span",{className:"px-2.5 py-1 rounded-md bg-gray-800/80 text-gray-400 text-xs font-medium border border-white/5 shadow-sm",children:[A.inProgress," активных"]})]}),t.jsxs("div",{className:`rounded-3xl border p-4 sm:p-6 ${s==="dark"?"bg-[#0f1216] border-white/5":"bg-gray-50 border-gray-200"}`,children:[t.jsx("div",{className:"mb-6",children:t.jsx(x4,{selectedCategory:m,selectedStatus:x,selectedUsers:T,onCategoryChange:f,onStatusChange:v,onUsersChange:I,onAddTask:()=>a(!0)})}),d?t.jsx("div",{className:"py-20 text-center text-gray-500 animate-pulse",children:"Загрузка задач..."}):t.jsx(f4,{tasks:U,onEdit:D,onDelete:C})]})]}),r&&t.jsx(p4,{onClose:M,onSave:V,editingTask:n})]})},y4=s=>{const e=new Map;return Ge.forEach(r=>{e.set(r.id,r)}),s.forEach(r=>{e.set(r.id,r)}),Array.from(e.values())},v4=()=>{const{theme:s}=Re(),{isAdmin:e}=ft(),[r,a]=k.useState([]),[n,i]=k.useState(!0),[o,c]=k.useState(!1),[d,u]=k.useState(null),[m,f]=k.useState({name:"",login:"",password:"",avatar:""}),[x,v]=k.useState(null),[T,I]=k.useState({}),[N,O]=k.useState(null),[D,C]=k.useState(null),M=async()=>{try{i(!0);const R=await qd(),S=y4(R);a(S)}catch(R){console.error("Error loading users:",R),a(Ge)}finally{i(!1)}};k.useEffect(()=>{M()},[]);const V=async R=>{if(R.preventDefault(),!m.name||!m.login||!m.password){alert("Заполните все обязательные поля");return}try{d?await $_(d.id,m):(await D_({name:m.name,login:m.login,password:m.password,avatar:m.avatar||void 0}),C(null)),await M(),E()}catch(S){console.error("Error saving user:",S),alert("Ошибка при сохранении пользователя")}},U=async R=>{try{confirm("Вы уверены, что хотите удалить этого пользователя? Это действие удалит все его данные (слоты, заработок, задачи, рейтинг и т.д.).")&&(await R_(R),await M(),v(null))}catch(S){console.error("Error deleting user:",S),alert("Ошибка при удалении пользователя")}},y=R=>{u(R),f({name:R.name,login:R.login,password:R.password,avatar:R.avatar||""}),c(!0)},b=()=>{u(null);const R=n0("",r);f({name:"",login:R.login,password:R.password,avatar:""}),C(R),c(!0)},E=()=>{c(!1),u(null),f({name:"",login:"",password:"",avatar:""}),C(null)},j=()=>{const R=r.length>0?r:Ge,S=n0(m.name||"user",R);f({...m,login:S.login,password:S.password}),C(S)},A=R=>{I(S=>({...S,[R]:!S[R]}))},w=(R,S,P)=>{navigator.clipboard.writeText(`Логин: ${R}
Пароль: ${S}`),O(P),setTimeout(()=>O(null),2e3)},g=R=>{navigator.clipboard.writeText(R)},$=s==="dark"?"text-white":"text-gray-900",L=s==="dark"?"text-gray-300":"text-gray-700",ee=s==="dark"?"bg-[#1a1a1a]":"bg-white",te=s==="dark"?"border-gray-800":"border-gray-200",Y=s==="dark"?"hover:bg-gray-800":"hover:bg-gray-50",q=s==="dark"?"text-gray-500":"text-gray-400";return e?t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("h2",{className:`text-xl font-bold ${$}`,children:"Управление участниками"}),t.jsxs("button",{onClick:b,className:`flex items-center gap-2 px-4 py-2 rounded-xl font-medium transition-all ${s==="dark"?"bg-emerald-600 hover:bg-emerald-500 text-white":"bg-emerald-500 hover:bg-emerald-600 text-white"}`,children:[t.jsx(mr,{size:18}),"Добавить участника"]})]}),n?t.jsx("div",{className:`p-8 text-center ${L}`,children:"Загрузка..."}):r.length===0?t.jsxs("div",{className:`p-8 text-center rounded-xl border ${ee} ${te}`,children:[t.jsx(Pr,{className:`w-12 h-12 mx-auto mb-3 opacity-30 ${L}`}),t.jsx("p",{className:L,children:"Нет участников. Добавьте первого!"})]}):t.jsx("div",{className:`rounded-xl border overflow-hidden ${ee} ${te}`,children:t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"w-full",children:[t.jsx("thead",{className:s==="dark"?"bg-gray-800/50":"bg-gray-50",children:t.jsxs("tr",{children:[t.jsx("th",{className:`px-4 py-3 text-left text-sm font-semibold ${L}`,children:"Участник"}),t.jsx("th",{className:`px-4 py-3 text-left text-sm font-semibold ${L}`,children:"Логин"}),t.jsx("th",{className:`px-4 py-3 text-left text-sm font-semibold ${L}`,children:"Пароль"}),t.jsx("th",{className:`px-4 py-3 text-left text-sm font-semibold ${L}`,children:"Фото"}),t.jsx("th",{className:`px-4 py-3 text-right text-sm font-semibold ${L}`,children:"Действия"})]})}),t.jsx("tbody",{className:"divide-y divide-gray-700/50",children:r.map(R=>t.jsxs("tr",{className:Y,children:[t.jsx("td",{className:`px-4 py-3 ${L}`,children:t.jsxs("div",{className:"flex items-center gap-3",children:[R.avatar?t.jsx("img",{src:R.avatar,alt:"",className:"w-8 h-8 rounded-full object-cover"}):t.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center text-sm font-medium ${s==="dark"?"bg-gray-700 text-gray-300":"bg-gray-200 text-gray-700"}`,children:R.name[0]}),t.jsx("span",{className:"font-medium",children:R.name})]})}),t.jsx("td",{className:`px-4 py-3 ${L}`,children:t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("span",{className:"text-sm font-mono",children:R.login}),t.jsx("button",{onClick:()=>g(R.login),className:`p-1 rounded transition-colors ${s==="dark"?"hover:bg-gray-700 text-gray-500":"hover:bg-gray-200 text-gray-400"}`,title:"Копировать логин",children:t.jsx(Ws,{size:14})})]})}),t.jsx("td",{className:`px-4 py-3 ${L}`,children:t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("span",{className:"text-sm font-mono",children:T[R.id]?R.password:"••••••••••••"}),t.jsx("button",{onClick:()=>A(R.id),className:`p-1 rounded transition-colors ${s==="dark"?"hover:bg-gray-700 text-gray-500":"hover:bg-gray-200 text-gray-400"}`,title:T[R.id]?"Скрыть пароль":"Показать пароль",children:T[R.id]?t.jsx(Yi,{size:14}):t.jsx(Wa,{size:14})}),t.jsx("button",{onClick:()=>w(R.login,R.password,R.id),className:`p-1 rounded transition-colors ${N===R.id?"text-emerald-500":s==="dark"?"hover:bg-gray-700 text-gray-500":"hover:bg-gray-200 text-gray-400"}`,title:"Копировать учётные данные",children:N===R.id?t.jsx(Zr,{size:14}):t.jsx(Ws,{size:14})})]})}),t.jsx("td",{className:`px-4 py-3 text-sm ${L}`,children:R.avatar?t.jsx("span",{className:"text-emerald-500",children:"Есть"}):t.jsx("span",{className:"text-gray-500",children:"Нет"})}),t.jsx("td",{className:"px-4 py-3 text-right",children:t.jsxs("div",{className:"flex items-center justify-end gap-2",children:[t.jsx("button",{onClick:()=>y(R),className:`p-2 rounded-lg transition-colors ${s==="dark"?"hover:bg-gray-700 text-gray-400":"hover:bg-gray-100 text-gray-600"}`,title:"Редактировать",children:t.jsx(Kl,{size:16})}),x===R.id?t.jsx("button",{onClick:()=>U(R.id),className:"p-2 rounded-lg bg-red-500/20 text-red-500 hover:bg-red-500/30 transition-colors",title:"Подтвердить удаление",children:t.jsx(Rc,{size:16})}):t.jsx("button",{onClick:()=>v(R.id),className:`p-2 rounded-lg transition-colors ${s==="dark"?"hover:bg-red-500/20 text-red-400":"hover:bg-red-100 text-red-600"}`,title:"Удалить",children:t.jsx(Et,{size:16})}),x===R.id&&t.jsx("button",{onClick:()=>v(null),className:`p-2 rounded-lg transition-colors ${s==="dark"?"hover:bg-gray-700 text-gray-400":"hover:bg-gray-100 text-gray-600"}`,title:"Отмена",children:t.jsx(pt,{size:16})})]})})]},R.id))})]})})}),o&&t.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:t.jsxs("div",{className:`rounded-2xl w-full max-w-md ${ee} border-2 ${te} shadow-2xl`,children:[t.jsxs("div",{className:`flex items-center justify-between p-4 border-b ${s==="dark"?"border-gray-800":"border-gray-200"}`,children:[t.jsx("h3",{className:`text-lg font-bold ${$}`,children:d?"Редактирование участника":"Новый участник"}),t.jsx("button",{onClick:E,className:`p-1 rounded-lg ${s==="dark"?"hover:bg-gray-800":"hover:bg-gray-100"}`,children:t.jsx(pt,{size:20,className:L})})]}),t.jsxs("form",{onSubmit:V,className:"p-4 space-y-4",children:[t.jsxs("div",{children:[t.jsxs("label",{className:`block text-sm font-medium mb-1.5 ${L}`,children:["Имя ",t.jsx("span",{className:"text-red-500",children:"*"})]}),t.jsx("input",{type:"text",value:m.name,onChange:R=>f({...m,name:R.target.value}),className:`w-full px-4 py-2.5 rounded-xl border outline-none transition-all ${s==="dark"?"bg-[#2a2a2a] border-gray-700 text-white focus:border-emerald-500":"bg-gray-50 border-gray-300 text-gray-900 focus:border-emerald-500"}`,placeholder:"Введите имя участника",required:!0})]}),t.jsxs("div",{className:`p-4 rounded-xl border ${s==="dark"?"bg-gray-800/50 border-gray-700":"bg-gray-50 border-gray-200"}`,children:[t.jsxs("div",{className:"flex items-center justify-between mb-3",children:[t.jsx("span",{className:`text-sm font-medium ${L}`,children:"Учётные данные для входа"}),!d&&t.jsxs("button",{type:"button",onClick:j,className:`flex items-center gap-1 text-xs px-2 py-1 rounded-lg transition-colors ${s==="dark"?"bg-gray-700 hover:bg-gray-600 text-gray-300":"bg-gray-200 hover:bg-gray-300 text-gray-700"}`,children:[t.jsx(zf,{size:12}),"Сгенерировать заново"]})]}),t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{children:[t.jsxs("label",{className:`block text-xs font-medium mb-1 ${q}`,children:["Логин ",t.jsx("span",{className:"text-red-500",children:"*"})]}),t.jsx("div",{className:"relative",children:t.jsx("input",{type:"text",value:m.login,onChange:R=>f({...m,login:R.target.value}),className:`w-full px-4 py-2.5 rounded-xl border outline-none transition-all font-mono text-sm ${s==="dark"?"bg-[#2a2a2a] border-gray-700 text-white focus:border-emerald-500":"bg-white border-gray-300 text-gray-900 focus:border-emerald-500"}`,placeholder:"login",required:!0})})]}),t.jsxs("div",{children:[t.jsxs("label",{className:`block text-xs font-medium mb-1 ${q}`,children:["Пароль ",t.jsx("span",{className:"text-red-500",children:"*"})]}),t.jsxs("div",{className:"relative",children:[t.jsx("input",{type:T.form?"text":"password",value:m.password,onChange:R=>f({...m,password:R.target.value}),className:`w-full px-4 py-2.5 rounded-xl border outline-none transition-all font-mono text-sm ${s==="dark"?"bg-[#2a2a2a] border-gray-700 text-white focus:border-emerald-500":"bg-white border-gray-300 text-gray-900 focus:border-emerald-500"}`,placeholder:"••••••••••••",required:!0}),t.jsx("button",{type:"button",onClick:()=>I(R=>({...R,form:!R.form})),className:`absolute right-3 top-1/2 -translate-y-1/2 ${s==="dark"?"text-gray-500 hover:text-gray-400":"text-gray-400 hover:text-gray-500"}`,children:T.form?t.jsx(Yi,{size:16}):t.jsx(Wa,{size:16})})]})]}),!d&&D&&t.jsx("div",{className:`text-xs p-2 rounded-lg ${s==="dark"?"bg-emerald-900/30 text-emerald-400":"bg-emerald-50 text-emerald-600"}`,children:"Учётные данные сгенерированы автоматически. Скопируйте их перед закрытием формы."})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:`block text-sm font-medium mb-1.5 ${L}`,children:"Фото (URL)"}),t.jsxs("div",{className:"relative",children:[t.jsx(_s,{size:16,className:`absolute left-3 top-1/2 -translate-y-1/2 ${L}`}),t.jsx("input",{type:"url",value:m.avatar,onChange:R=>f({...m,avatar:R.target.value}),className:`w-full pl-10 pr-4 py-2.5 rounded-xl border outline-none transition-all ${s==="dark"?"bg-[#2a2a2a] border-gray-700 text-white focus:border-emerald-500":"bg-gray-50 border-gray-300 text-gray-900 focus:border-emerald-500"}`,placeholder:"https://example.com/avatar.jpg"})]}),m.avatar&&t.jsx("div",{className:"mt-2",children:t.jsx("img",{src:m.avatar,alt:"Preview",className:"w-12 h-12 rounded-full object-cover border-2 border-emerald-500",onError:R=>{R.target.style.display="none"}})})]}),t.jsxs("div",{className:"flex gap-3 pt-2",children:[t.jsx("button",{type:"button",onClick:E,className:`flex-1 px-4 py-2.5 rounded-xl font-medium transition-all ${s==="dark"?"bg-gray-800 hover:bg-gray-700 text-gray-300":"bg-gray-100 hover:bg-gray-200 text-gray-700"}`,children:"Отмена"}),t.jsx("button",{type:"submit",className:`flex-1 px-4 py-2.5 rounded-xl font-medium transition-all ${s==="dark"?"bg-emerald-600 hover:bg-emerald-500 text-white":"bg-emerald-500 hover:bg-emerald-600 text-white"}`,children:d?"Сохранить":"Добавить"})]})]})]})})]}):t.jsx("div",{className:`p-4 rounded-xl border ${ee} ${te}`,children:t.jsx("p",{className:L,children:"Доступ запрещён. Только для администраторов."})})},w4=()=>{const{theme:s}=Re(),{isAdmin:e}=ft(),r=s==="dark"?"text-white":"text-gray-900",a=s==="dark"?"text-gray-300":"text-gray-700",n=s==="dark"?"bg-[#1a1a1a]":"bg-white";return e?t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:`rounded-2xl p-6 ${n} shadow-lg border-2 ${s==="dark"?"border-purple-500/30":"border-purple-200"}`,children:[t.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[t.jsx("div",{className:`p-2 rounded-xl ${s==="dark"?"bg-purple-500/20":"bg-purple-100"}`,children:t.jsx(Gt,{className:`w-6 h-6 ${s==="dark"?"text-purple-400":"text-purple-600"}`})}),t.jsx("h2",{className:`text-xl font-semibold ${r}`,children:"Участники команды"})]}),t.jsx(v4,{})]}),t.jsxs("div",{className:`rounded-2xl p-6 ${n} shadow-lg border-2 ${s==="dark"?"border-orange-500/30":"border-orange-200"}`,children:[t.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[t.jsx("div",{className:`p-2 rounded-xl ${s==="dark"?"bg-orange-500/20":"bg-orange-100"}`,children:t.jsx(nr,{className:`w-6 h-6 ${s==="dark"?"text-orange-400":"text-orange-600"}`})}),t.jsx("h2",{className:`text-xl font-semibold ${r}`,children:"Ограничения"}),t.jsxs("a",{href:"/management?tab=restrictions",className:`ml-auto flex items-center gap-2 px-4 py-2 rounded-xl font-medium transition-all ${s==="dark"?"bg-orange-600 hover:bg-orange-500 text-white":"bg-orange-500 hover:bg-orange-600 text-white"}`,children:[t.jsx(oa,{size:18}),"Управление"]})]}),t.jsx("p",{className:`text-sm ${a} mb-4`,children:"Запретить участникам создавать определённые записи (слоты, выходные, больничные и т.д.) в указанный период"}),t.jsx("div",{className:`p-4 rounded-xl ${s==="dark"?"bg-gray-800/50":"bg-gray-50"}`,children:t.jsx("p",{className:`text-sm ${a}`,children:"Нажмите «Управление» для просмотра, создания и редактирования ограничений"})})]})]}):t.jsx("div",{className:`rounded-2xl p-8 ${n} shadow-xl border-2 ${s==="dark"?"border-red-500/30 bg-gradient-to-br from-[#1a1a1a] to-[#0A0A0A]":"border-red-200 bg-gradient-to-br from-white to-red-50/20"} relative overflow-hidden`,children:t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:`inline-flex p-4 rounded-2xl mb-4 ${s==="dark"?"bg-red-500/20":"bg-red-100"}`,children:t.jsx(ga,{className:`w-12 h-12 ${s==="dark"?"text-red-400":"text-red-600"}`})}),t.jsx("h2",{className:`text-2xl font-bold mb-2 ${r}`,children:"Доступ запрещен"}),t.jsx("p",{className:a,children:'Эта страница доступна только администраторам. Для входа используйте режим "Админ" на странице входа.'})]})})},Wd=Zn()(ei((s,e)=>({viewedUserId:null,setViewedUser:r=>{s({viewedUserId:r})},resetViewedUser:()=>{s({viewedUserId:null})},isViewingOtherUser:()=>e().viewedUserId!==null}),{name:"viewed-user-storage"})),Jp=(s,e,r)=>e&&r?r:s,k4=()=>{const{user:s}=ot(),{isAdmin:e}=ft(),{viewedUserId:r}=Wd();return Jp(s==null?void 0:s.id,e,r)},j4=()=>{var F;const{theme:s}=Re(),{user:e,logout:r}=ot(),{isAdmin:a,deactivateAdmin:n}=ft(),{isViewingOtherUser:i}=Wd(),o=k4(),c=A0(),d=o||(e==null?void 0:e.id)||"admin",[u,m]=k.useState(!1),[f,x]=k.useState(!1),[v,T]=k.useState([]),[I,N]=k.useState(null),[O,D]=k.useState(null),[C,M]=k.useState(null),[V,U]=k.useState([]),[y,b]=k.useState({id:"",userId:"",title:"",text:"",priority:"medium",createdAt:"",updatedAt:""}),[E,j]=k.useState(!0),[A,w]=k.useState(!1),[g,$]=k.useState(""),[L,ee]=k.useState(!1),[te,Y]=k.useState(!1),q=el(d),R=o?Ge.find(B=>B.id===o):null,S=e||(a?{name:"Администратор",login:"admin",password:Dc}:null),P=o?(F=Ge.find(B=>B.id===o))==null?void 0:F.avatar:void 0,W=S!=null&&S.name?S.name.charAt(0).toUpperCase():"A",K=s==="dark"?"text-white":"text-gray-900";k.useEffect(()=>{(e||a)&&he()},[e,a]);const he=async()=>{if(!(!e&&!a)){j(!0);try{const B=o||(e==null?void 0:e.id)||"admin",Ne=await Hp({assignedTo:B});if(T(Ne),e){const Te=hn(),pe=oe(Te.start,"yyyy-MM-dd"),De=oe(Te.end,"yyyy-MM-dd"),$e=Eo(30),nt=oe($e.start,"yyyy-MM-dd"),dt=oe($e.end,"yyyy-MM-dd"),ge=$e.start.toISOString(),be=$e.end.toISOString(),qe=Eo(90),bt=oe(qe.start,"yyyy-MM-dd"),re=oe(qe.end,"yyyy-MM-dd"),Ee=await Jn(B,pe,De),Se=Ee.reduce((xe,ye)=>{const Pt=ye.participants&&ye.participants.length>0?ye.participants.length:1;return xe+ye.amount/Pt},0),Pe=Ee.reduce((xe,ye)=>{const Pt=ye.participants&&ye.participants.length>0?ye.participants.length:1;return xe+ye.poolAmount/Pt},0),Ct=await Jn(B,nt,dt),vr=Ct.reduce((xe,ye)=>{const Pt=ye.participants&&ye.participants.length>0?ye.participants.length:1;return xe+ye.amount/Pt},0),$r=Ct.reduce((xe,ye)=>{const Pt=ye.participants&&ye.participants.length>0?ye.participants.length:1;return xe+ye.poolAmount/Pt},0),cr=await mn(B),Ut=cr.filter(xe=>{const ye=xe.date,Pt=xe.endDate||xe.date;return ye<=dt&&Pt>=nt}),Es=Ut.filter(xe=>xe.type==="dayoff").reduce((xe,ye)=>xe+Ot(ye.date,ye.endDate,nt,dt),0),Er=Ut.filter(xe=>xe.type==="sick").reduce((xe,ye)=>xe+Ot(ye.date,ye.endDate,nt,dt),0),Tr=Ut.filter(xe=>xe.type==="vacation").reduce((xe,ye)=>xe+Ot(ye.date,ye.endDate,nt,dt),0),Fr=Ut.filter(xe=>xe.type==="absence").reduce((xe,ye)=>xe+Ot(ye.date,ye.endDate,nt,dt),0),Ur=Ut.filter(xe=>xe.type==="truancy").reduce((xe,ye)=>xe+Ot(ye.date,ye.endDate,nt,dt),0),Sr=Ut.filter(xe=>xe.type==="internship").reduce((xe,ye)=>xe+Ot(ye.date,ye.endDate,nt,dt),0),Br=cr.filter(xe=>{const ye=xe.date,Pt=xe.endDate||xe.date;return ye<=De&&Pt>=pe}),Me=Br.filter(xe=>xe.type==="dayoff").reduce((xe,ye)=>xe+Ot(ye.date,ye.endDate,pe,De),0),Q=Br.filter(xe=>xe.type==="sick").reduce((xe,ye)=>xe+Ot(ye.date,ye.endDate,pe,De),0),ve=cr.filter(xe=>{const ye=xe.date,Pt=xe.endDate||xe.date;return ye<=re&&Pt>=bt}).filter(xe=>xe.type==="vacation").reduce((xe,ye)=>xe+Ot(ye.date,ye.endDate,bt,re),0),ze=(await Gr(B)).filter(xe=>xe.date>=pe&&xe.date<=De).reduce((xe,ye)=>xe+tl(ye.slots),0),Be=(await zp(B))[0]||{userId:B,earnings:0,messages:0,initiatives:0,signals:0,profitableSignals:0,referrals:0,daysOff:0,sickDays:0,vacationDays:0,absenceDays:0,internshipDays:0,poolAmount:0,rating:0,lastUpdated:new Date().toISOString()},rt=(await Bd(void 0,ge,be)).filter(xe=>xe.ownerId===B).length,ut={userId:B,earnings:vr,messages:Be.messages||0,initiatives:Be.initiatives||0,signals:Be.signals||0,profitableSignals:Be.profitableSignals||0,referrals:rt,daysOff:Es,sickDays:Er,vacationDays:Tr,absenceDays:Fr,truancyDays:Ur,internshipDays:Sr,poolAmount:$r,lastUpdated:new Date().toISOString()};console.log("Profile.tsx calculateRating call for user:",B,{weeklyHours:ze,weeklyEarnings:Se,weeklyDaysOff:Me,weeklySickDays:Q,ninetyDayVacationDays:ve,updatedData:ut});const Nt=Yp(ut,ze,Se,Me,Q,ve),lt=Xp(ut,ze,Se,Me,Q,ve);N({...ut,rating:Nt}),D(lt),M({total:vr,pool:$r,net:Math.max(0,vr-$r),weekly:{gross:Se,pool:Pe,net:Math.max(0,Se-Pe)}});const ht=B?`notes-cache-${B}`:null,Dt=xe=>{if(ht)try{localStorage.setItem(ht,JSON.stringify(xe))}catch(ye){console.error("Error caching notes locally",ye)}};try{if(B){const xe=await y_(B,a);U(xe),Dt(xe)}}catch(xe){if(console.error("Error loading notes",xe),ht)try{const ye=localStorage.getItem(ht);if(ye){const Pt=JSON.parse(ye);U(Pt)}}catch(ye){console.error("Error loading cached notes",ye)}}}}catch(B){console.error("Error loading profile data:",B)}finally{j(!1)}}},H=async()=>{if(!y.title.trim()&&!y.text.trim())return;const B=`notes-cache-${d}`,Ne=Te=>{if(B)try{localStorage.setItem(B,JSON.stringify(Te))}catch(pe){console.error("Error caching notes locally",pe)}};try{if(y.id){await w_(y.id,{title:y.title,text:y.text,priority:y.priority});const Te=V.map(pe=>pe.id===y.id?{...pe,title:y.title,text:y.text,priority:y.priority,updatedAt:new Date().toISOString()}:pe);U(Te),Ne(Te)}else{const Te=await v_({userId:d,title:y.title,text:y.text,priority:y.priority}),pe=new Date().toISOString(),De=[{id:Te,userId:d,title:y.title,text:y.text,priority:y.priority,createdAt:pe,updatedAt:pe},...V];U(De),Ne(De)}}catch(Te){console.error("Error saving note",Te)}finally{b({id:"",userId:"",title:"",text:"",priority:"medium",createdAt:"",updatedAt:""})}},me=B=>{const Ne=V.find(Te=>Te.id===B);Ne&&b(Ne)},G=async B=>{const Ne=e!=null&&e.id?`notes-cache-${e.id}`:null,Te=pe=>{if(Ne)try{localStorage.setItem(Ne,JSON.stringify(pe))}catch(De){console.error("Error caching notes locally",De)}};try{await k_(B);const pe=V.filter(De=>De.id!==B);U(pe),Te(pe),y.id===B&&b({id:"",userId:"",title:"",text:"",priority:"medium",createdAt:"",updatedAt:""})}catch(pe){console.error("Error deleting note",pe)}},se=()=>{a&&n(),r(),c("/login")},Z=()=>{e!=null&&e.password&&(navigator.clipboard.writeText(e.password),x(!0),setTimeout(()=>x(!1),2e3))},ne=()=>{const B=S==null?void 0:S.login;B&&(navigator.clipboard.writeText(B),w(!0),setTimeout(()=>w(!1),2e3))},ie=async()=>{if(!g.trim())return;const B=g.trim(),Ne=q||"";if(B===Ne){ee(!1),$("");return}Y(!0);try{const Te=await il(d);await $t({entity:"login",action:"update",authorId:d,targetUserId:d,before:Te||{id:"",userId:d,nickname:Ne,createdAt:"",updatedAt:""},after:{id:"",userId:d,nickname:B,createdAt:"",updatedAt:""},comment:`Запрос на изменение ника с "${Ne}" на "${B}"`}),ee(!1),$(""),alert("Запрос на изменение ника отправлен на согласование администратору")}catch(Te){console.error("Error requesting nickname change:",Te),alert("Ошибка при отправке запроса на изменение ника")}finally{Y(!1)}},Ce=v.filter(B=>B.status==="in_progress").length,je=v.filter(B=>B.status==="completed").length,le=v.filter(B=>B.status==="closed").length,ue={in_progress:{label:"В работе",classes:s==="dark"?"bg-blue-500/15 text-blue-100 border-blue-500/30":"bg-blue-50 text-blue-900 border-blue-200"},completed:{label:"Выполнена",classes:s==="dark"?"bg-emerald-500/15 text-emerald-50 border-emerald-500/30":"bg-emerald-50 text-emerald-900 border-emerald-200"},closed:{label:"Закрыта",classes:s==="dark"?"bg-gray-600/20 text-gray-100 border-gray-500/40":"bg-gray-50 text-gray-800 border-gray-200"}};return S?t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsx("div",{className:"p-3 bg-[#4E6E49]/10 rounded-2xl border border-[#4E6E49]/20 shadow-lg shadow-[#4E6E49]/5 flex items-center justify-center min-w-[80px] min-h-[80px]",children:P?t.jsx("img",{src:P,alt:S==null?void 0:S.name,className:"w-14 h-14 rounded-xl object-cover"}):t.jsx("div",{className:"w-14 h-14 rounded-xl bg-gradient-to-br from-[#4E6E49] to-emerald-600 flex items-center justify-center text-2xl font-black text-white",children:W})}),t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[t.jsx("span",{className:"text-[10px] font-black uppercase tracking-[0.2em] text-[#4E6E49]",children:"Личный кабинет"}),i()&&t.jsx("span",{className:"px-2 py-0.5 rounded-md bg-amber-500/10 text-amber-500 text-[9px] font-black tracking-widest uppercase border border-amber-500/20",children:"Просмотр"})]}),t.jsx("h1",{className:`text-2xl md:text-4xl font-black tracking-tight ${s==="dark"?"text-white":"text-gray-900"}`,children:i()?(R==null?void 0:R.name)||"Пользователь":S.name}),t.jsx("p",{className:`text-sm font-medium ${s==="dark"?"text-gray-400":"text-gray-500"}`,children:"Закрытый контур. Ваши данные и показатели."})]})]}),t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsxs(zr,{to:"/rules",className:`flex items-center gap-2 px-5 py-2.5 rounded-xl border transition-all font-bold text-sm ${s==="dark"?"bg-white/5 border-white/10 hover:bg-white/10 text-white":"bg-white border-gray-200 hover:bg-gray-50 text-gray-900 shadow-sm"}`,children:[t.jsx(Fs,{className:"w-4 h-4"}),t.jsx("span",{children:"Правила"})]}),t.jsxs("button",{onClick:se,className:"flex items-center gap-2 px-5 py-2.5 rounded-xl bg-rose-500 hover:bg-rose-600 text-white font-bold text-sm transition-all shadow-lg shadow-rose-500/20 hover:scale-105 active:scale-95",children:[t.jsx(Gl,{className:"w-4 h-4"}),t.jsx("span",{children:"Выйти"})]})]})]}),t.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[{label:"Рейтинг (КПД)",value:I?`${I.rating.toFixed(1)}%`:"—",note:I!=null&&I.rating&&I.rating>=70?"Высокая эффективность":"Требуется рост",icon:t.jsx(Ar,{className:"w-5 h-5 text-amber-400"}),bgClass:"bg-amber-500/5",borderClass:"border-amber-500/10"},{label:"Задачи в работе",value:Ce,note:`${v.length} всего задач`,icon:t.jsx(da,{className:"w-5 h-5 text-blue-400"}),bgClass:"bg-blue-500/5",borderClass:"border-blue-500/10"},{label:"Недельный доход",value:C?`${Math.round(C.weekly.net).toLocaleString()} ₽`:"0 ₽",note:C!=null&&C.weekly.net&&C.weekly.net>=1e4?"Доступно к выводу":"Ниже порога",icon:t.jsx(to,{className:"w-5 h-5 text-emerald-400"}),bgClass:"bg-emerald-500/5",borderClass:"border-emerald-500/10"},{label:"Статус аккаунта",value:a?"Admin":"Member",note:"Постоянный доступ",icon:t.jsx(xt,{className:"w-5 h-5 text-purple-400"}),bgClass:"bg-purple-500/5",borderClass:"border-purple-500/10"}].map((B,Ne)=>t.jsxs("div",{className:`relative overflow-hidden rounded-2xl p-5 border transition-all duration-300 hover:shadow-xl group ${s==="dark"?`${B.bgClass} ${B.borderClass} hover:border-white/20`:"bg-white border-gray-100 hover:border-[#4E6E49]/20 shadow-sm"}`,children:[t.jsxs("div",{className:"flex justify-between items-start mb-6",children:[t.jsx("span",{className:`text-[10px] font-black uppercase tracking-widest ${s==="dark"?"text-gray-500":"text-gray-400"}`,children:B.label}),t.jsx("div",{className:`p-2 rounded-xl ${s==="dark"?"bg-white/5":"bg-gray-50"}`,children:B.icon})]}),t.jsxs("div",{className:"space-y-1",children:[t.jsx("div",{className:`text-2xl md:text-3xl font-black tracking-tight ${s==="dark"?"text-white":"text-gray-900"}`,children:B.value}),t.jsx("div",{className:"text-[11px] font-bold text-gray-500",children:B.note})]})]},Ne))})]}),E?t.jsx("div",{className:`rounded-xl p-8 text-center ${s==="dark"?"bg-white/5 text-white":"bg-white text-gray-800"} shadow`,children:"Загрузка..."}):t.jsx("div",{className:"space-y-5",children:t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-[1.05fr_0.95fr] gap-4 items-stretch",children:[t.jsxs("div",{className:"space-y-4 flex flex-col",children:[t.jsxs("div",{className:`rounded-2xl p-6 border ${s==="dark"?"border-white/5 bg-[#1a1a1a]":"border-gray-200 bg-white"} shadow flex-1`,children:[t.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[t.jsx("div",{className:`p-2.5 rounded-xl ${s==="dark"?"bg-[#4E6E49]/10 text-[#4E6E49]":"bg-[#4E6E49]/5 text-[#4E6E49]"}`,children:t.jsx(Pr,{className:"w-5 h-5"})}),t.jsxs("div",{children:[t.jsx("h2",{className:`text-sm font-black uppercase tracking-widest ${s==="dark"?"text-white":"text-gray-900"}`,children:"Профиль"}),t.jsx("p",{className:`text-xs ${s==="dark"?"text-gray-500":"text-gray-400"}`,children:"Доступ и учетные данные"})]})]}),t.jsxs("div",{className:"grid sm:grid-cols-2 gap-4",children:[t.jsxs("div",{className:`p-4 rounded-xl border ${s==="dark"?"border-white/5 bg-black/20":"border-gray-100 bg-gray-50"} shadow-sm`,children:[t.jsx("p",{className:`text-[10px] font-black uppercase tracking-widest ${s==="dark"?"text-gray-500":"text-gray-400"}`,children:"Имя"}),t.jsx("p",{className:`mt-1 text-lg font-black ${s==="dark"?"text-white":"text-gray-900"}`,children:S.name})]}),t.jsxs("div",{className:`p-4 rounded-xl border ${s==="dark"?"border-white/5 bg-black/20":"border-gray-100 bg-gray-50"} shadow-sm`,children:[t.jsxs("div",{className:"flex items-center justify-between mb-1",children:[t.jsx("p",{className:`text-[10px] font-black uppercase tracking-widest ${s==="dark"?"text-gray-500":"text-gray-400"}`,children:"Ник"}),!L&&e&&!a&&t.jsxs("button",{onClick:async()=>{ee(!0),$(q||"")},className:`text-[10px] px-2 py-1 rounded-lg border transition-all font-black uppercase tracking-wider ${s==="dark"?"border-white/5 bg-white/5 hover:border-white/10 text-white":"border-gray-200 bg-white hover:border-gray-300 text-gray-700"}`,children:[t.jsx(wl,{className:"w-3 h-3 inline mr-1"}),"Изменить"]})]}),L?t.jsxs("div",{className:"space-y-2 mt-1",children:[t.jsx("input",{type:"text",value:g,onChange:B=>$(B.target.value),placeholder:"Введите новый ник",className:`w-full px-3 py-2 rounded-lg border ${s==="dark"?"border-white/10 bg-white/5 text-white":"border-gray-200 bg-white text-gray-900"} text-sm`,disabled:te}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx("button",{onClick:ie,disabled:te||!g.trim(),className:`px-3 py-1.5 rounded-lg text-xs font-semibold transition ${te||!g.trim()?"opacity-50 cursor-not-allowed":"bg-[#4E6E49] text-white hover:bg-[#3d5639]"}`,children:te?"Отправка...":"Отправить на согласование"}),t.jsx("button",{onClick:()=>{ee(!1),$("")},disabled:te,className:`px-3 py-1.5 rounded-lg text-xs font-semibold border transition ${s==="dark"?"border-white/10 bg-white/5 hover:border-white/30 text-white":"border-gray-200 bg-white hover:border-gray-300 text-gray-700"}`,children:"Отмена"})]}),t.jsx("p",{className:`text-xs ${s==="dark"?"text-gray-400":"text-gray-500"}`,children:"Изменение ника требует согласования администратора"})]}):t.jsx("div",{className:"flex items-center gap-2 mt-1",children:t.jsx("p",{className:`text-lg font-black ${s==="dark"?"text-white":"text-gray-900"}`,children:e!=null&&e.id?t.jsx(ys,{userId:e.id}):"—"})})]}),t.jsxs("div",{className:`p-4 rounded-xl border ${s==="dark"?"border-white/5 bg-black/20":"border-gray-100 bg-gray-50"} shadow-sm`,children:[t.jsx("p",{className:`text-[10px] font-black uppercase tracking-widest ${s==="dark"?"text-gray-500":"text-gray-400"}`,children:"Логин"}),t.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[t.jsx("p",{className:`text-lg font-black ${s==="dark"?"text-white":"text-gray-900"}`,children:S.login}),t.jsx("button",{onClick:ne,className:`p-2 rounded-lg border transition-all ${A?"bg-[#4E6E49] text-white border-[#4E6E49]":s==="dark"?"border-white/5 bg-white/5 hover:border-white/10":"border-gray-200 bg-white hover:border-gray-300"}`,title:"Скопировать логин",children:A?t.jsx(Zr,{className:"w-4 h-4"}):t.jsx(Ws,{className:"w-4 h-4"})})]})]})]}),t.jsxs("div",{className:"mt-4 space-y-2",children:[t.jsx("label",{className:`text-[10px] font-black uppercase tracking-widest ${s==="dark"?"text-gray-500":"text-gray-400"} block`,children:"Пароль"}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:`flex-1 px-4 py-3 rounded-xl border ${s==="dark"?"border-white/5 bg-black/20 text-white":"border-gray-200 bg-white text-gray-900"} font-mono text-sm`,children:u?S.password:"•".repeat(S.password.length)}),t.jsx("button",{onClick:()=>m(!u),className:`p-3 rounded-xl border ${s==="dark"?"border-white/5 bg-white/5 hover:border-white/10":"border-gray-200 bg-white hover:border-gray-300"} transition-all`,title:u?"Скрыть пароль":"Показать пароль",children:u?t.jsx(Yi,{className:"w-5 h-5"}):t.jsx(Wa,{className:"w-5 h-5"})}),t.jsx("button",{onClick:Z,className:`p-3 rounded-xl border transition-all ${f?"bg-[#4E6E49] text-white border-[#4E6E49]":s==="dark"?"border-white/5 bg-white/5 hover:border-white/10":"border-gray-200 bg-white hover:border-gray-300"}`,title:"Скопировать пароль",children:f?t.jsx(Zr,{className:"w-5 h-5"}):t.jsx(Ws,{className:"w-5 h-5"})})]})]}),t.jsx("div",{className:"mt-4 grid gap-3 sm:grid-cols-1",children:t.jsxs("div",{className:`p-4 rounded-xl border ${s==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white"} shadow-sm`,children:[t.jsx("p",{className:`text-xs font-semibold uppercase tracking-wide ${s==="dark"?"text-gray-400":"text-gray-500"}`,children:"Учебная панель (преподаватель)"}),t.jsxs("div",{className:"mt-2 space-y-2 text-sm",children:[t.jsxs("div",{className:`${s==="dark"?"text-gray-300":"text-gray-700"}`,children:[t.jsx("span",{className:"font-semibold",children:"Имя: "}),t.jsx("span",{className:"font-medium",children:"в разработке"})]}),t.jsxs("div",{className:`${s==="dark"?"text-gray-300":"text-gray-700"}`,children:[t.jsx("span",{className:"font-semibold",children:"Логин: "}),t.jsx("span",{className:"font-medium",children:"в разработке"})]}),t.jsxs("div",{className:`${s==="dark"?"text-gray-300":"text-gray-700"}`,children:[t.jsx("span",{className:"font-semibold",children:"Пароль: "}),t.jsx("span",{className:"font-medium",children:"в разработке"})]})]})]})})]}),t.jsxs("div",{className:`rounded-2xl p-6 border ${s==="dark"?"border-white/5 bg-[#1a1a1a]":"border-gray-200 bg-white"} shadow flex-1`,children:[t.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[t.jsx("div",{className:`p-2.5 rounded-xl ${s==="dark"?"bg-[#4E6E49]/10 text-[#4E6E49]":"bg-[#4E6E49]/5 text-[#4E6E49]"}`,children:t.jsx(da,{className:"w-5 h-5"})}),t.jsxs("div",{children:[t.jsx("h2",{className:`text-sm font-black uppercase tracking-widest ${s==="dark"?"text-white":"text-gray-900"}`,children:"Мои задачи"}),t.jsx("p",{className:`text-xs ${s==="dark"?"text-gray-500":"text-gray-400"}`,children:"Сводка по статусам"})]})]}),t.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-3 mb-6",children:[{label:"В работе",value:Ce,classes:s==="dark"?"bg-blue-500/5 border-blue-500/10 text-blue-400":"bg-blue-50 border-blue-100 text-blue-600"},{label:"Выполнено",value:je,classes:s==="dark"?"bg-emerald-500/5 border-emerald-500/10 text-emerald-400":"bg-emerald-50 border-emerald-100 text-emerald-600"},{label:"Закрыто",value:le,classes:s==="dark"?"bg-gray-500/5 border-gray-500/10 text-gray-400":"bg-gray-50 border-gray-100 text-gray-600"},{label:"Всего",value:v.length,classes:s==="dark"?"bg-purple-500/5 border-purple-500/10 text-purple-400":"bg-purple-50 border-purple-100 text-purple-600"}].map(({label:B,value:Ne,classes:Te})=>t.jsxs("div",{className:`p-4 rounded-xl border shadow-sm transition-all hover:translate-y-[-2px] ${Te}`,children:[t.jsx("div",{className:"text-[9px] font-black uppercase tracking-widest mb-2 opacity-70",children:B}),t.jsx("div",{className:`text-2xl font-black ${s==="dark"?"text-white":"text-gray-900"}`,children:Ne})]},B))}),v.length>0&&t.jsxs("div",{className:"space-y-3 mb-6",children:[t.jsx("p",{className:`text-[10px] font-black uppercase tracking-widest ${s==="dark"?"text-gray-500":"text-gray-400"}`,children:"Активные задачи"}),t.jsx("div",{className:"space-y-2",children:v.slice(0,3).map(B=>t.jsxs("div",{className:`p-3 rounded-lg border ${s==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-gray-50"} shadow-sm`,children:[t.jsxs("div",{className:"flex items-start justify-between gap-2",children:[t.jsxs("div",{className:"min-w-0",children:[t.jsx("p",{className:`text-sm font-semibold ${K} truncate`,children:B.title}),t.jsxs("p",{className:`text-xs ${s==="dark"?"text-gray-400":"text-gray-600"}`,children:["Дедлайн: ",B.dueDate?oe(new Date(B.dueDate),"dd.MM.yyyy"):"—"," ",B.dueTime||""]})]}),t.jsx("span",{className:`text-[11px] px-2 py-1 rounded-full border ${ue[B.status].classes}`,children:ue[B.status].label})]}),B.description&&t.jsx("p",{className:`text-xs mt-2 ${s==="dark"?"text-gray-300":"text-gray-600"} line-clamp-2`,children:B.description})]},B.id))})]}),t.jsxs("div",{className:"mt-6 space-y-4",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(Kf,{className:"w-4 h-4 text-[#4E6E49]"}),t.jsx("p",{className:`text-[10px] font-black uppercase tracking-widest ${s==="dark"?"text-gray-500":"text-gray-400"}`,children:"Мои заметки"})]}),t.jsxs("div",{className:"grid gap-2 sm:grid-cols-2",children:[t.jsx("input",{type:"text",value:y.title,onChange:B=>b({...y,title:B.target.value}),placeholder:"Заголовок",className:`px-3 py-2 rounded-lg border ${s==="dark"?"border-white/10 bg-white/5 text-white":"border-gray-200 bg-white text-gray-900"} text-sm`}),t.jsx("div",{className:"flex gap-2",children:["low","medium","high"].map(B=>t.jsx("button",{onClick:()=>b({...y,priority:B}),className:`px-3 py-2 rounded-lg border text-sm flex-1 ${y.priority===B?"border-[#4E6E49] bg-[#4E6E49]/10 text-[#4E6E49]":s==="dark"?"border-white/10 bg-white/5 text-white":"border-gray-200 bg-white text-gray-800"}`,children:B==="low"?"Низкий":B==="medium"?"Средний":"Высокий"},B))})]}),t.jsx("textarea",{value:y.text,onChange:B=>b({...y,text:B.target.value}),rows:3,placeholder:"Текст заметки",className:`w-full px-3 py-2 rounded-lg border ${s==="dark"?"border-white/10 bg-white/5 text-white":"border-gray-200 bg-white text-gray-900"} text-sm`}),t.jsxs("div",{className:"flex gap-2",children:[t.jsxs("button",{onClick:H,className:`px-4 py-2 rounded-lg font-semibold flex items-center gap-2 ${e!=null&&e.id?s==="dark"?"bg-[#4E6E49]/20 text-[#4E6E49] border border-[#4E6E49]/40":"bg-gradient-to-r from-[#4E6E49] to-emerald-500 text-white":"bg-gray-300 text-gray-600 cursor-not-allowed"}`,disabled:!(e!=null&&e.id),children:[t.jsx(wl,{className:"w-4 h-4"}),y.id?"Сохранить":"Добавить"]}),y.id&&t.jsx("button",{onClick:()=>b({id:"",userId:"",title:"",text:"",priority:"medium",createdAt:"",updatedAt:""}),className:`px-4 py-2 rounded-lg font-semibold border ${s==="dark"?"border-white/15 text-gray-200":"border-gray-200 text-gray-700"}`,children:"Отмена"})]}),V.length>0&&t.jsx("div",{className:"space-y-2",children:V.map(B=>t.jsx("div",{className:`p-3 rounded-lg border ${s==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-gray-50"} flex flex-col gap-1`,children:t.jsxs("div",{className:"flex items-start justify-between gap-2",children:[t.jsxs("div",{className:"min-w-0",children:[t.jsx("p",{className:`text-sm font-semibold ${K} truncate`,children:B.title||"Без названия"}),t.jsx("p",{className:`text-xs ${s==="dark"?"text-gray-400":"text-gray-600"} whitespace-pre-line`,children:B.text})]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx("span",{className:`text-[11px] px-2 py-1 rounded-full border ${B.priority==="high"?"border-rose-200 bg-rose-50 text-rose-700 dark:border-rose-500/40 dark:bg-rose-500/15 dark:text-rose-50":B.priority==="medium"?"border-amber-200 bg-amber-50 text-amber-700 dark:border-amber-500/40 dark:bg-amber-500/15 dark:text-amber-50":"border-emerald-200 bg-emerald-50 text-emerald-700 dark:border-emerald-500/40 dark:bg-emerald-500/15 dark:text-emerald-50"}`,children:B.priority==="high"?"Высокий":B.priority==="medium"?"Средний":"Низкий"}),t.jsx("button",{onClick:()=>me(B.id),className:`p-1 rounded border ${s==="dark"?"border-white/10 text-gray-200":"border-gray-200 text-gray-700"}`,title:"Редактировать",children:t.jsx(wl,{className:"w-4 h-4"})}),t.jsx("button",{onClick:()=>G(B.id),className:`p-1 rounded border ${s==="dark"?"border-white/10 text-red-200":"border-gray-200 text-red-600"}`,title:"Удалить",children:t.jsx(Et,{className:"w-4 h-4"})})]})]})},B.id))})]}),t.jsx("div",{className:"mt-4",children:t.jsxs("button",{onClick:()=>c("/tasks"),className:`w-full px-4 py-3 rounded-lg font-semibold transition-all flex items-center justify-center gap-2 ${s==="dark"?"bg-gradient-to-r from-[#4E6E49]/20 to-emerald-700/20 text-[#4E6E49] border border-[#4E6E49]/40":"bg-gradient-to-r from-green-50 to-emerald-50 text-[#4E6E49] border border-green-200"}`,children:[t.jsx(da,{className:"w-4 h-4"}),"Перейти к задачам"]})})]})]}),t.jsxs("div",{className:"space-y-4 flex flex-col",children:[C&&t.jsxs("div",{className:`rounded-2xl p-6 border ${s==="dark"?"border-white/5 bg-[#1a1a1a]":"border-gray-200 bg-white"} shadow flex-1`,children:[t.jsxs("div",{className:"flex items-center justify-between mb-6",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:`p-2.5 rounded-xl ${s==="dark"?"bg-emerald-500/10 text-emerald-500":"bg-emerald-50 text-emerald-600"}`,children:t.jsx(qa,{className:"w-5 h-5"})}),t.jsxs("div",{children:[t.jsx("h2",{className:`text-sm font-black uppercase tracking-widest ${s==="dark"?"text-white":"text-gray-900"}`,children:"Мой заработок"}),t.jsx("p",{className:`text-xs ${s==="dark"?"text-gray-500":"text-gray-400"}`,children:"Суммы с учётом долей"})]})]}),t.jsx("div",{className:`px-3 py-1.5 rounded-full text-[10px] font-black uppercase tracking-widest border ${C.weekly.net>=1e4?"border-emerald-500/20 bg-emerald-500/5 text-emerald-500":"border-amber-500/20 bg-amber-500/5 text-amber-500"}`,children:C.weekly.net>=1e4?"Вывод доступен":"Ожидание порога"})]}),t.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4 mb-6",children:[{label:"Всего заработано",value:C.total,icon:t.jsx(it,{className:"w-3 h-3"})},{label:"Отправлено в пул",value:C.pool,icon:t.jsx(Tn,{className:"w-3 h-3"})},{label:"Чистыми",value:C.net,icon:t.jsx(to,{className:"w-3 h-3"})}].map(B=>t.jsxs("div",{className:`p-4 rounded-xl border shadow-sm ${s==="dark"?"border-white/5 bg-black/20":"border-gray-100 bg-gray-50"}`,children:[t.jsxs("div",{className:"flex items-center gap-2 mb-2 opacity-70",children:[B.icon,t.jsx("p",{className:"text-[9px] font-black uppercase tracking-widest",children:B.label})]}),t.jsxs("p",{className:`text-xl font-black ${s==="dark"?"text-white":"text-gray-900"}`,children:[Math.round(B.value).toLocaleString("ru-RU")," ₽"]})]},B.label))}),t.jsxs("div",{className:`p-5 rounded-xl border ${s==="dark"?"border-white/5 bg-emerald-500/5":"border-emerald-100 bg-emerald-50/50"} flex flex-col gap-4`,children:[t.jsxs("div",{className:"flex items-center justify-between gap-2 flex-wrap",children:[t.jsxs("div",{children:[t.jsx("p",{className:`text-xs font-black uppercase tracking-wider ${s==="dark"?"text-emerald-500/80":"text-emerald-700"}`,children:"Активная неделя"}),t.jsx("p",{className:`text-[10px] ${s==="dark"?"text-gray-400":"text-gray-600"}`,children:"Пн, Ср, Пт, Сб — дни вывода"})]}),t.jsx("span",{className:`text-[9px] font-black uppercase tracking-widest px-3 py-1 rounded-full border ${C.weekly.net>=1e4?"border-emerald-500/20 bg-emerald-500/10 text-emerald-500":"border-amber-500/20 bg-amber-500/10 text-amber-500"}`,children:C.weekly.net>=1e4?"Доступно к выводу":"Перенос суммы"})]}),t.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3",children:[{label:"Заработано",value:C.weekly.gross},{label:"В пул",value:C.weekly.pool},{label:"Чистыми",value:C.weekly.net}].map(B=>t.jsxs("div",{className:`p-3 rounded-lg border ${s==="dark"?"border-white/5 bg-white/5":"border-white/80 bg-white/80"} shadow-sm`,children:[t.jsx("p",{className:"text-[9px] font-black uppercase tracking-widest opacity-70",children:B.label}),t.jsxs("p",{className:`text-base font-black ${s==="dark"?"text-white":"text-gray-900"}`,children:[Math.round(B.value).toLocaleString("ru-RU")," ₽"]})]},B.label))}),C.weekly.net<1e4&&t.jsx("p",{className:`text-[10px] font-medium ${s==="dark"?"text-amber-500/80":"text-amber-700"}`,children:"Менее 10 000 ₽ чистыми — вывод недоступен, сумма переносится."})]})]}),I&&O&&t.jsxs("div",{className:`rounded-2xl p-6 border ${s==="dark"?"border-white/5 bg-[#1a1a1a]":"border-gray-200 bg-white"} shadow flex-1`,children:[t.jsxs("div",{className:"flex items-center justify-between mb-6",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:`p-2.5 rounded-xl ${s==="dark"?"bg-purple-500/10 text-purple-400":"bg-purple-50 text-purple-600"}`,children:t.jsx(it,{className:"w-5 h-5"})}),t.jsxs("div",{children:[t.jsx("h2",{className:`text-sm font-black uppercase tracking-widest ${s==="dark"?"text-white":"text-gray-900"}`,children:"Рейтинг"}),t.jsx("p",{className:`text-xs ${s==="dark"?"text-gray-500":"text-gray-400"}`,children:"Еженедельная оценка"})]})]}),t.jsxs("div",{className:"px-3 py-1.5 rounded-full text-[10px] font-black uppercase tracking-widest border border-purple-500/20 bg-purple-500/5 text-purple-500",children:[I.rating.toFixed(1),"%"]})]}),t.jsxs("div",{className:`p-5 rounded-xl border ${s==="dark"?"border-white/5 bg-black/20":"border-gray-100 bg-gray-50"} mb-6`,children:[t.jsxs("div",{className:`text-4xl font-black ${s==="dark"?"text-white":"text-gray-900"}`,children:[I.rating.toFixed(1),"%"]}),t.jsx("p",{className:`text-xs mt-1 ${s==="dark"?"text-gray-400":"text-gray-600"} font-medium`,children:I.rating>=70?"Отличный результат":I.rating>=50?"Хороший темп":"Требуется усиление показателей"})]}),t.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-3",children:[{label:"Выходные",value:`${O.daysOff} дн`,pts:O.daysOffPoints,classes:s==="dark"?"bg-slate-500/5 border-slate-500/10 text-slate-400":"bg-slate-50 border-slate-100 text-slate-600"},{label:"Больничные",value:`${I.sickDays} дн`,pts:O.sickDaysPoints,classes:s==="dark"?"bg-amber-500/5 border-amber-500/10 text-amber-500":"bg-amber-50 border-amber-100 text-amber-600"},{label:"Отпуск",value:`${I.vacationDays} дн`,pts:O.vacationDaysPoints,classes:s==="dark"?"bg-orange-500/5 border-orange-500/10 text-orange-500":"bg-orange-50 border-orange-100 text-orange-600"},{label:"Отсутствия",value:`${O.absenceDays} дн`,pts:O.absenceDaysPoints,classes:s==="dark"?"bg-red-500/5 border-red-500/10 text-red-500":"bg-red-50 border-red-100 text-red-600"},{label:"Прогулы",value:`${O.truancyDays} дн`,pts:0,classes:s==="dark"?"bg-red-900/5 border-red-900/10 text-red-900":"bg-red-100 border-red-200 text-red-800"},{label:"Часы",value:`${O.weeklyHours.toFixed(1)} ч`,pts:O.weeklyHoursPoints,classes:s==="dark"?"bg-blue-500/5 border-blue-500/10 text-blue-400":"bg-blue-50 border-blue-100 text-blue-600"},{label:"Заработок",value:`${(O.weeklyEarnings/1e3).toFixed(1)}k ₽`,pts:O.weeklyEarningsPoints,classes:s==="dark"?"bg-emerald-500/5 border-emerald-500/10 text-emerald-400":"bg-emerald-50 border-emerald-100 text-emerald-600"},{label:"Рефералы",value:`${I.referrals}`,pts:O.referralsPoints,classes:s==="dark"?"bg-purple-500/5 border-purple-500/10 text-purple-400":"bg-purple-50 border-purple-100 text-purple-600"},{label:"Сигналы",value:`${O.signals}`,pts:0,classes:s==="dark"?"bg-yellow-500/5 border-yellow-500/10 text-yellow-500":"bg-yellow-50 border-yellow-100 text-yellow-600"},{label:"Инициативы",value:`${O.initiatives}`,pts:0,classes:s==="dark"?"bg-indigo-500/5 border-indigo-500/10 text-indigo-400":"bg-indigo-50 border-indigo-100 text-indigo-600"},{label:"Пул",value:`${(O.poolAmount/1e3).toFixed(1)}k ₽`,pts:0,classes:s==="dark"?"bg-green-500/5 border-green-500/10 text-green-400":"bg-green-50 border-green-100 text-green-600"}].map(B=>t.jsxs("div",{className:`p-3 rounded-xl border shadow-sm transition-all hover:scale-[1.02] ${B.classes}`,children:[t.jsx("div",{className:"text-[8px] font-black uppercase tracking-widest opacity-80 mb-1",children:B.label}),t.jsx("div",{className:`text-sm font-black ${s==="dark"?"text-white":"text-gray-900"}`,children:B.value}),B.pts!==0&&t.jsxs("div",{className:"text-[10px] font-black mt-1",children:[B.pts.toFixed(1),"%"]})]},B.label))}),t.jsxs("div",{className:`mt-4 p-4 rounded-xl border ${s==="dark"?"border-white/10 bg-white/5":"border-gray-100 bg-gray-50"}`,children:[t.jsxs("h3",{className:`text-sm font-bold ${K} mb-2 flex items-center gap-2`,children:[t.jsx(Wt,{className:"w-4 h-4"}),"Как считается рейтинг"]}),t.jsx("p",{className:`text-xs ${s==="dark"?"text-gray-300":"text-gray-700"}`,children:"11 параметров: выходные, больничные, отпуск, отсутствие, прогулы (месяц), часы, доход, рефералы, сигналы, инициативы, пул (неделя). Максимум 100%."})]})]})]})]})})]}):t.jsx("div",{className:"text-center py-12",children:t.jsx("p",{className:K,children:"Необходима авторизация"})})},N4=()=>{const{theme:s}=Re(),e=s==="dark"?"text-white":"text-gray-900",r=s==="dark"?"text-gray-400":"text-gray-500",a=[{title:"Финансовая грамотность",icon:Ef,note:"Управление рисками и анализ вместо эмоций.",accent:"text-emerald-400",bg:"bg-emerald-500/5 border-emerald-500/20"},{title:"Приватность",icon:ga,note:"Защита цифровой идентичности и личных границ.",accent:"text-blue-400",bg:"bg-blue-500/5 border-blue-500/20"},{title:"Образование",icon:Fs,note:"От основ блокчейна до  DeFi-стратегий.",accent:"text-amber-400",bg:"bg-amber-500/5 border-amber-500/20"},{title:"Прозрачность",icon:xt,note:"Честные сделки и открытость внутри клуба.",accent:"text-purple-400",bg:"bg-purple-500/5 border-purple-500/20"},{title:"Инновации",icon:Ar,note:"Тестируем новые протоколы и не боимся быть первыми.",accent:"text-pink-400",bg:"bg-pink-500/5 border-pink-500/20"},{title:"Критическое мышление",icon:rr,note:"Анализируем, проверяем, не следуем за хайпом.",accent:"text-cyan-400",bg:"bg-cyan-500/5 border-cyan-500/20"},{title:"Глобальность",icon:_f,note:"Сотрудничество ради свободы в рамках закона.",accent:"text-lime-400",bg:"bg-lime-500/5 border-lime-500/20"},{title:"Ответственность",icon:Gt,note:"Зрелость и самоконтроль в принятии решений.",accent:"text-slate-400",bg:"bg-slate-500/5 border-slate-500/20"}],n=s==="dark"?"bg-[#151a21]/60 border-white/5 backdrop-blur-md":"bg-white border-gray-100 shadow-sm";return t.jsxs("div",{className:"space-y-8 animate-fade-in pb-12 font-sans",children:[t.jsx("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsx("div",{className:"p-3 rounded-2xl bg-[#4E6E49]/10 border border-[#4E6E49]/20",children:t.jsx(Wt,{className:"w-8 h-8 text-[#4E6E49]"})}),t.jsxs("div",{children:[t.jsx("h1",{className:`text-3xl font-black ${e} flex items-center gap-3`,children:"AVF INFO"}),t.jsx("p",{className:r,children:"О нас, наши ценности и правила сообщества"})]})]})}),t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[t.jsxs("div",{className:`col-span-1 lg:col-span-2 rounded-3xl p-8 border relative overflow-hidden group ${n}`,children:[t.jsx("div",{className:"absolute top-0 right-0 w-64 h-64 bg-[#4E6E49]/10 rounded-full blur-3xl -mr-16 -mt-16 pointer-events-none group-hover:bg-[#4E6E49]/20 transition-all duration-500"}),t.jsxs("div",{className:"relative z-10 space-y-6",children:[t.jsxs("div",{className:"inline-flex items-center gap-2 px-3 py-1 rounded-full bg-[#4E6E49]/10 border border-[#4E6E49]/20 text-[#4E6E49] text-xs font-bold uppercase tracking-wider",children:[t.jsx(ts,{className:"w-3 h-3"}),"ApeVault Community"]}),t.jsxs("h2",{className:`text-4xl sm:text-5xl font-black tracking-tight leading-tight ${e}`,children:["Где знания ",t.jsx("br",{}),t.jsx("span",{className:"text-transparent bg-clip-text bg-gradient-to-r from-[#4E6E49] to-emerald-400",children:"превращаются в действие"})]}),t.jsxs("p",{className:`text-lg leading-relaxed max-w-2xl ${r}`,children:["ApeVault Frontier — закрытая среда для тех, кто понимает рынок глубже заголовков и хайпа.",t.jsx("br",{}),t.jsx("br",{}),"Мы создаём пространство для аккуратного входа в рынок, глубокой аналитики и совместного роста, где во главу угла поставлены качество решений и ответственность за результат.",t.jsx("br",{}),t.jsx("br",{}),"Здесь решения принимаются осознанно, а рост строится системно."]})]})]}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:`rounded-3xl p-6 border ${n} relative overflow-hidden`,children:[t.jsxs("div",{className:"flex justify-between items-start mb-2",children:[t.jsx("span",{className:`text-xs font-bold uppercase tracking-wider ${r}`,children:"Участников"}),t.jsx(Gt,{className:"w-5 h-5 text-indigo-500"})]}),t.jsx("div",{className:`text-4xl font-black ${e}`,children:"50+"}),t.jsx("div",{className:"text-xs text-indigo-400 mt-2 font-medium",children:"Активное комьюнити"})]}),t.jsxs("div",{className:`rounded-3xl p-6 border ${n} relative overflow-hidden`,children:[t.jsxs("div",{className:"flex justify-between items-start mb-2",children:[t.jsx("span",{className:`text-xs font-bold uppercase tracking-wider ${r}`,children:"Сессий / Неделю"}),t.jsx(ir,{className:"w-5 h-5 text-emerald-500"})]}),t.jsx("div",{className:`text-4xl font-black ${e}`,children:"10+"}),t.jsx("div",{className:"text-xs text-emerald-400 mt-2 font-medium",children:"Регулярные созвоны"})]}),t.jsxs("div",{className:`rounded-3xl p-6 border ${n} relative overflow-hidden`,children:[t.jsxs("div",{className:"flex justify-between items-start mb-2",children:[t.jsx("span",{className:`text-xs font-bold uppercase tracking-wider ${r}`,children:"База знаний"}),t.jsx(Fs,{className:"w-5 h-5 text-amber-500"})]}),t.jsx("div",{className:`text-4xl font-black ${e}`,children:"100+"}),t.jsx("div",{className:"text-xs text-amber-400 mt-2 font-medium",children:"Уроков и материалов"})]})]})]}),t.jsxs("div",{className:"space-y-4",children:[t.jsx("h2",{className:`text-2xl font-black ${e} text-center md:text-left`,children:"Наши принципы"}),t.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:a.map((i,o)=>t.jsxs("div",{className:`relative overflow-hidden rounded-2xl p-5 border transition-all duration-300 hover:shadow-lg group ${s==="dark"?`${i.bg} hover:border-opacity-50`:"bg-white border-gray-100 hover:border-emerald-500/20"}`,children:[t.jsx("div",{className:"flex justify-between items-start mb-3",children:t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(i.icon,{className:`w-4 h-4 ${i.accent}`}),t.jsx("span",{className:`text-xs font-bold uppercase tracking-wider ${s==="dark"?"text-gray-300":"text-gray-600"}`,children:i.title})]})}),t.jsx("div",{className:"space-y-1",children:t.jsx("div",{className:`text-sm font-medium leading-relaxed ${r}`,children:i.note})})]},o))})]}),t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[t.jsxs("div",{className:`rounded-3xl border p-8 relative overflow-hidden flex flex-col justify-between ${n}`,children:[t.jsx("div",{className:"absolute top-0 right-0 w-64 h-64 bg-emerald-500/10 rounded-full blur-3xl -mr-16 -mt-16 pointer-events-none"}),t.jsxs("div",{className:"relative z-10",children:[t.jsxs("div",{className:"inline-flex items-center gap-2 px-3 py-1 rounded-full bg-emerald-500/10 border border-emerald-500/20 text-emerald-400 text-xs font-bold uppercase tracking-wider mb-6",children:[t.jsx(G0,{className:"w-3 h-3"}),"Стратегии"]}),t.jsx("h3",{className:`text-3xl font-black mb-4 ${e}`,children:"Наши стратегии"}),t.jsx("p",{className:`${r} mb-8 max-w-md`,children:"Авторские методики торговли и инвестирования, проверенные временем. Изучите наши подходы к рынку."})]}),t.jsxs(zr,{to:"/fasol-signals-strategy",className:"relative z-10 w-full sm:w-auto inline-flex items-center justify-center gap-2 px-6 py-3.5 bg-gradient-to-r from-emerald-500 to-teal-600 hover:from-emerald-400 hover:to-teal-500 text-white font-bold rounded-xl transition-all shadow-lg shadow-emerald-500/20 active:scale-95",children:[t.jsx("span",{children:"Смотреть стратегии"}),t.jsx(Dn,{className:"w-4 h-4"})]})]}),t.jsxs("div",{className:`rounded-3xl border p-8 relative overflow-hidden flex flex-col justify-between ${n}`,children:[t.jsx("div",{className:"absolute top-0 right-0 w-64 h-64 bg-indigo-500/10 rounded-full blur-3xl -mr-16 -mt-16 pointer-events-none"}),t.jsxs("div",{className:"relative z-10",children:[t.jsxs("div",{className:"inline-flex items-center gap-2 px-3 py-1 rounded-full bg-indigo-500/10 border border-indigo-500/20 text-indigo-400 text-xs font-bold uppercase tracking-wider mb-6",children:[t.jsx(Fs,{className:"w-3 h-3"}),"Регламент"]}),t.jsx("h3",{className:`text-3xl font-black mb-4 ${e}`,children:"Правила сообщества"}),t.jsx("p",{className:`${r} mb-8 max-w-md`,children:"Мы подробно описали процессы, безопасность и принципы взаимодействия. Прозрачные правила — залог доверия и эффективности."})]}),t.jsxs(zr,{to:"/rules",className:"relative z-10 w-full sm:w-auto inline-flex items-center justify-center gap-2 px-6 py-3.5 bg-gradient-to-r from-indigo-500 to-purple-600 hover:from-indigo-400 hover:to-purple-500 text-white font-bold rounded-xl transition-all shadow-lg shadow-indigo-500/20 active:scale-95",children:[t.jsx("span",{children:"Читать правила"}),t.jsx(Dn,{className:"w-4 h-4"})]})]})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[t.jsxs("div",{className:`rounded-3xl p-6 border flex items-center gap-5 ${n} hover:border-[#4E6E49]/30 transition-colors`,children:[t.jsx("div",{className:"w-14 h-14 rounded-full bg-gradient-to-br from-rose-500 to-orange-500 flex items-center justify-center text-white shadow-lg",children:t.jsx(Gt,{className:"w-7 h-7"})}),t.jsxs("div",{children:[t.jsx("div",{className:"text-xs font-bold uppercase text-rose-500 mb-1",children:"Администратор"}),t.jsx("div",{className:`text-xl font-black ${e}`,children:"@artyommedoed"}),t.jsx("div",{className:`text-sm ${r} mt-1`,children:"Вопросы доступов и регламентов"})]})]}),t.jsxs("a",{href:"https://t.me/+vPZdPwPaaKI1MjAy",target:"_blank",rel:"noopener noreferrer",className:`rounded-3xl p-6 border flex items-center gap-5 group ${n} hover:border-emerald-500/30 transition-colors cursor-pointer`,children:[t.jsx("div",{className:"w-14 h-14 rounded-full bg-gradient-to-br from-[#4E6E49] to-emerald-400 flex items-center justify-center text-white shadow-lg group-hover:scale-110 transition-transform",children:t.jsx(Cf,{className:"w-7 h-7"})}),t.jsxs("div",{children:[t.jsx("div",{className:"text-xs font-bold uppercase text-emerald-500 mb-1",children:"Обратная связь"}),t.jsxs("div",{className:`text-xl font-black ${e} flex items-center gap-2`,children:["Командный чат",t.jsx(Dn,{className:"w-5 h-5 opacity-50 group-hover:opacity-100 group-hover:translate-x-1 group-hover:-translate-y-1 transition-all"})]}),t.jsx("div",{className:`text-sm ${r} mt-1`,children:"Оперативные вопросы и общение"})]})]})]})]})},ls=({title:s,description:e,children:r})=>{const{theme:a}=Re(),n=a==="dark"?"text-white":"text-gray-900",i=a==="dark"?"text-gray-400":"text-gray-600";return t.jsx("div",{className:"section-card rounded-3xl p-6 sm:p-7 border border-white/60 dark:border-white/10 shadow-xl relative overflow-hidden",children:t.jsxs("div",{className:"relative z-10 space-y-4",children:[t.jsxs("div",{className:"flex items-start gap-3",children:[t.jsx("div",{className:"p-2 rounded-xl bg-gradient-to-br from-[#4E6E49]/20 to-emerald-500/15 text-[#4E6E49]",children:t.jsx(Fs,{className:"w-5 h-5"})}),t.jsxs("div",{className:"space-y-1",children:[t.jsx("h2",{className:`text-xl sm:text-2xl font-extrabold ${n}`,children:s}),e&&t.jsx("p",{className:`text-sm ${i}`,children:e})]})]}),r]})})},_4=()=>{const{theme:s}=Re(),e=s==="dark"?"text-white":"text-gray-900",r=s==="dark"?"text-gray-400":"text-gray-600",a=["последовательной эскалации","объективности и равного применения","недопустимости злоупотребления полномочиями","исключения спорных трактовок и субъективности"],n=["единичные опоздания (не более 1 раза за календарную неделю)","некорректное выполнение инструкций без последствий вследствие заболевания или сбоев в ПО","нарушение регламента общения, не приводящее к конфликту"],i=["повторяющиеся нарушения регламента","несоблюдение правил торговой сессии","недостаточная подготовка к сессии","игнорирование инструкций ведущего","нарушение процедур безопасности данных или доступа"],o=["оскорбления участников","провокации и попытки вызвать конфликт","манипуляции и мошеннические действия","действия, создающие финансовые, репутационные или организационные риски","подрыв дисциплины и порядка в сообществе"],c=[{term:"Нарушение",text:"любое действие или бездействие, противоречащее регламентам ApeVault"},{term:"Предупреждение",text:"официальное уведомление о нарушении"},{term:"Выговор",text:"фиксируемая мера повышенной строгости при повторных нарушениях"},{term:"Ведущий торговой сессии",text:"управляет процессом и следит за соблюдением регламента на сессии"},{term:"Ответственный за сообщество",text:"назначенное лицо, управляющее дисциплиной и коммуникацией"},{term:"Повторное нарушение",text:"нарушение в течение 30 календарных дней после предыдущего"}];return t.jsxs("div",{className:"space-y-7 sm:space-y-8",children:[t.jsxs("div",{className:"section-card rounded-3xl p-6 sm:p-8 border border-white/60 dark:border-white/10 shadow-2xl relative overflow-hidden",children:[t.jsx("div",{className:"accent-dots"}),t.jsx("div",{className:"absolute inset-y-0 right-0 w-1/3 pointer-events-none bg-gradient-to-l from-[#4E6E49]/12 to-transparent blur-3xl"}),t.jsxs("div",{className:"relative z-10 flex flex-col gap-5 lg:flex-row lg:items-center lg:justify-between",children:[t.jsxs("div",{className:"space-y-4 max-w-3xl",children:[t.jsx("div",{className:"inline-flex items-center gap-2 px-3 py-1.5 rounded-full border border-white/50 dark:border-white/10 bg-white/70 dark:bg-white/5 text-xs font-semibold uppercase tracking-[0.16em] text-[#4E6E49]",children:"ApeVault Standard Operating Code — ASOC"}),t.jsx("h1",{className:`text-3xl sm:text-4xl lg:text-5xl font-extrabold leading-tight ${e}`,children:"Кодекс операционных процедур и регламентов платформы ApeVault"}),t.jsx("p",{className:`text-sm sm:text-base ${r}`,children:"Единые правила ответственности, дисциплинарных мер и прозрачных процедур для команды ApeVault."}),t.jsx("div",{className:"flex flex-wrap gap-2",children:["Ответственность","Прозрачность","Безопасность","Справедливость"].map(d=>t.jsx("span",{className:`px-3 py-1.5 rounded-full text-xs font-semibold border ${s==="dark"?"border-white/10 bg-white/5 text-white":"border-gray-200 bg-white text-gray-900"}`,children:d},d))})]}),t.jsxs("div",{className:`rounded-3xl border shadow-xl p-4 sm:p-5 w-full lg:max-w-sm ${s==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white"}`,children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"p-3 rounded-2xl bg-gradient-to-br from-[#4E6E49] to-emerald-600 text-white shadow-lg",children:t.jsx(Hs,{className:"w-6 h-6"})}),t.jsxs("div",{children:[t.jsx("p",{className:"text-xs uppercase tracking-wide text-[#4E6E49] font-semibold",children:"Назначение раздела"}),t.jsx("p",{className:`text-base font-semibold ${e}`,children:"Поддержание порядка и профессионализма команды"})]})]}),t.jsxs("div",{className:"mt-4 space-y-3",children:[t.jsxs("div",{className:"flex items-center gap-2 text-sm font-semibold text-[#4E6E49]",children:[t.jsx(Dn,{className:"w-4 h-4"}),"Публичная версия правил доступна на сайте"]}),t.jsx("p",{className:`text-xs ${r}`,children:"Используйте кнопку «Правила» в навигации или в профиле, чтобы быстро открыть этот раздел."}),t.jsxs("a",{href:"/rules.pdf",download:!0,className:`inline-flex items-center gap-2 px-4 py-2.5 rounded-xl border transition-all shadow-sm hover:shadow-md hover:-translate-y-0.5 ${s==="dark"?"border-white/20 bg-white/10 text-white hover:bg-white/15":"border-[#4E6E49]/30 bg-[#4E6E49]/10 text-[#4E6E49] hover:bg-[#4E6E49]/15"}`,children:[t.jsx(jf,{className:"w-4 h-4"}),t.jsx("span",{className:"text-sm font-semibold",children:"Скачать правила (PDF)"})]})]})]})]})]}),t.jsxs(ls,{title:"Политика ответственности и меры дисциплинарного воздействия",description:"Единый порядок применения мер для поддержания порядка, прозрачности и профессионального уровня.",children:[t.jsxs("div",{className:`grid gap-4 sm:grid-cols-2 ${s==="dark"?"text-gray-200":"text-gray-900"}`,children:[t.jsxs("div",{className:`rounded-2xl border p-4 sm:p-5 ${s==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white"}`,children:[t.jsxs("div",{className:"flex items-center gap-2 text-sm font-semibold text-[#4E6E49]",children:[t.jsx(Pu,{className:"w-4 h-4"}),"Цели дисциплинарной политики"]}),t.jsx("p",{className:`text-sm mt-2 ${r}`,children:"Обеспечить соблюдение регламентов, процедур и рабочих стандартов команды."})]}),t.jsxs("div",{className:`rounded-2xl border p-4 sm:p-5 ${s==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white"}`,children:[t.jsxs("div",{className:"flex items-center gap-2 text-sm font-semibold text-[#4E6E49]",children:[t.jsx(Wf,{className:"w-4 h-4"}),"Принципы применения мер"]}),t.jsx("ul",{className:`text-sm mt-2 space-y-1 ${r}`,children:a.map(d=>t.jsxs("li",{children:["• ",d]},d))})]})]}),t.jsx("div",{className:`mt-3 text-sm ${r}`,children:"Меры ответственности применяются в зависимости от тяжести, регулярности и последствий нарушения."})]}),t.jsx(ls,{title:"Унифицированный регламент торговой деятельности ApeVault",description:"Нормы поведения на торговых сессиях, полномочия ведущего, перерывы, записи и конфиденциальность.",children:t.jsxs("div",{className:`space-y-4 text-sm ${r}`,children:[t.jsxs("div",{className:`rounded-2xl border p-4 sm:p-5 ${s==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white"}`,children:[t.jsx("p",{className:"text-base font-semibold text-[#4E6E49]",children:"1. Общие положения"}),t.jsxs("ul",{className:"mt-2 space-y-1",children:[t.jsx("li",{children:"• Регламент задаёт нормы участия, дисциплину, полномочия ведущего и ответственность."}),t.jsx("li",{children:"• Все участники обязаны ознакомиться с разделом до начала торговой деятельности."})]})]}),t.jsxs("div",{className:`rounded-2xl border p-4 sm:p-5 ${s==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white"}`,children:[t.jsx("p",{className:"text-base font-semibold text-[#4E6E49]",children:"2. Права и полномочия ведущего"}),t.jsx("p",{className:"mt-2 font-semibold text-[#4E6E49]",children:"Полномочия:"}),t.jsxs("ul",{className:"mt-1 space-y-1",children:[t.jsx("li",{children:"• Давать обязательные распоряжения по порядку, действиям, стратегии и дисциплине."}),t.jsx("li",{children:"• Требовать соблюдения тайминга, регламента и корректного поведения."}),t.jsx("li",{children:"• Приостанавливать участие нарушающих участников."}),t.jsx("li",{children:"• Объявлять перерывы и завершение сессии."}),t.jsx("li",{children:"• Фиксировать нарушения, выдавать предупреждения/выговоры, вводить временный запрет на участие."})]}),t.jsx("p",{className:"mt-3 font-semibold text-[#4E6E49]",children:"Ограничения:"}),t.jsxs("ul",{className:"mt-1 space-y-1",children:[t.jsx("li",{children:"• Не изменяет дисциплинарные меры, установленные регламентом."}),t.jsx("li",{children:"• Не принимает решения об исключении из команды (решает ответственный за команду)."}),t.jsx("li",{children:"• Не меняет торговую стратегию вне утверждённой методологии или плана сессии."})]})]}),t.jsxs("div",{className:`rounded-2xl border p-4 sm:p-5 space-y-3 ${s==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white"}`,children:[t.jsx("p",{className:"text-base font-semibold text-[#4E6E49]",children:"3. Порядок проведения сессии"}),t.jsxs("div",{children:[t.jsx("p",{className:"font-semibold",children:"Начало и окончание:"}),t.jsxs("ul",{className:"mt-1 space-y-1",children:[t.jsx("li",{children:"• Старт строго по времени слота."}),t.jsx("li",{children:"• Подключение за 3–5 минут до старта обязательно."}),t.jsx("li",{children:"• Окончание объявляет ведущий, не позднее 30 минут после окончания слота."})]})]}),t.jsxs("div",{children:[t.jsx("p",{className:"font-semibold",children:"Поведение во время торгов:"}),t.jsx("p",{className:"text-xs uppercase tracking-wide opacity-70 mt-1",children:"Запрещено:"}),t.jsxs("ul",{className:"space-y-1",children:[t.jsx("li",{children:"• Перебивать ведущего или участников."}),t.jsx("li",{children:"• Отвлекать команду сторонними вопросами."}),t.jsx("li",{children:"• Включать микрофон без необходимости, создавать шум."}),t.jsx("li",{children:"• Саботировать процесс или предлагать несогласованные решения."}),t.jsx("li",{children:"• Коммуницировать с кем-либо вне участников сессии."})]}),t.jsx("p",{className:"text-xs uppercase tracking-wide opacity-70 mt-2",children:"Обязано:"}),t.jsxs("ul",{className:"space-y-1",children:[t.jsx("li",{children:"• Следовать инструкциям ведущего и оперативно исполнять распоряжения."}),t.jsx("li",{children:"• Сохранять корректность и нейтральность в коммуникации."}),t.jsx("li",{children:"• Обеспечивать техническую готовность: связь, устройство, ПО."})]})]})]}),t.jsxs("div",{className:`rounded-2xl border p-4 sm:p-5 space-y-2 ${s==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white"}`,children:[t.jsx("p",{className:"text-base font-semibold text-[#4E6E49]",children:"4. Политика перерывов"}),t.jsxs("ul",{className:"space-y-1",children:[t.jsx("li",{children:"• Краткий перерыв — до 10 минут каждые 45 минут."}),t.jsx("li",{children:"• Большой перерыв — до 45 минут каждые 3 часа активной торговли."}),t.jsx("li",{children:"• Все перерывы объявляет ведущий."}),t.jsx("li",{children:"• Самовольные перерывы запрещены; нарушение дисциплины, если не согласовано в трекере слотов и с ответственным."})]})]}),t.jsxs("div",{className:`rounded-2xl border p-4 sm:p-5 space-y-2 ${s==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white"}`,children:[t.jsx("p",{className:"text-base font-semibold text-[#4E6E49]",children:"5. Правила записи сессий"}),t.jsxs("ul",{className:"space-y-1",children:[t.jsx("li",{children:"• Запись включает только ведущий или ответственный за сообщество."}),t.jsx("li",{children:"• Хранение — в закрытом архиве команды; доступ: ведущий, управляющий сообществом, ответственные аналитики."}),t.jsx("li",{children:"• Распространение вне команды запрещено."}),t.jsx("li",{children:"• Срок хранения определяет ведущий: до 3 лет, но ≥14 календарных дней."})]})]}),t.jsxs("div",{className:`rounded-2xl border p-4 sm:p-5 space-y-2 ${s==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white"}`,children:[t.jsx("p",{className:"text-base font-semibold text-[#4E6E49]",children:"6. Конфликт интересов"}),t.jsxs("ul",{className:"space-y-1",children:[t.jsx("li",{children:"• Запрещено действовать в интересах сторонних групп/конкурентов."}),t.jsx("li",{children:"• Запрещено передавать стратегию, аналитику, материалы, алгоритмы, сигналы и методики ApeVault третьим лицам."}),t.jsx("li",{children:"• Запрещено получать вознаграждение за внешние консультации, использующие опыт или данные ApeVault."}),t.jsx("li",{children:"• Запрещено участвовать в параллельных торговых группах, если это создаёт риск конфликта или утечки информации."})]})]}),t.jsxs("div",{className:`rounded-2xl border p-4 sm:p-5 space-y-2 ${s==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white"}`,children:[t.jsx("p",{className:"text-base font-semibold text-[#4E6E49]",children:"7. Конфиденциальность"}),t.jsxs("ul",{className:"space-y-1",children:[t.jsx("li",{children:"• Все материалы, данные, аналитика, торговые решения и внутренняя коммуникация — интеллектуальная собственность ApeVault."}),t.jsx("li",{children:"• Запрещено копировать, распространять или передавать информацию третьим лицам."}),t.jsx("li",{children:"• Запрещено создавать производные материалы без согласования с ответственным."}),t.jsx("li",{children:"• Запрещено публиковать скриншоты, отчёты или содержимое сессий в открытых источниках (кроме чата команды)."}),t.jsx("li",{children:"• Требование к среде: наушники и отсутствие посторонних рядом; не допускать, чтобы экран/звук были доступны третьим лицам."}),t.jsx("li",{className:"font-semibold text-[#4E6E49]",children:"Нарушение положений конфиденциальности — основание для немедленного исключения."})]})]})]})}),t.jsx(ls,{title:"Классификация нарушений",description:"Три уровня тяжести определяют, как быстро применяются ограничения.",children:t.jsxs("div",{className:"grid gap-4 lg:grid-cols-3",children:[t.jsxs("div",{className:`rounded-2xl border p-4 sm:p-5 ${s==="dark"?"border-white/10 bg-white/5":"border-amber-100 bg-white/95"}`,children:[t.jsxs("div",{className:"flex items-center gap-2 text-sm font-semibold text-amber-600 dark:text-amber-300",children:[t.jsx(Wt,{className:"w-4 h-4"}),"Незначительные"]}),t.jsx("ul",{className:`text-sm mt-2 space-y-1 ${r}`,children:n.map(d=>t.jsxs("li",{children:["• ",d]},d))})]}),t.jsxs("div",{className:`rounded-2xl border p-4 sm:p-5 ${s==="dark"?"border-white/10 bg-white/5":"border-orange-100 bg-white/95"}`,children:[t.jsxs("div",{className:"flex items-center gap-2 text-sm font-semibold text-orange-600 dark:text-orange-300",children:[t.jsx(nr,{className:"w-4 h-4"}),"Средние"]}),t.jsx("ul",{className:`text-sm mt-2 space-y-1 ${r}`,children:i.map(d=>t.jsxs("li",{children:["• ",d]},d))})]}),t.jsxs("div",{className:`rounded-2xl border p-4 sm:p-5 ${s==="dark"?"border-white/10 bg-white/5":"border-rose-100 bg-white/95"}`,children:[t.jsxs("div",{className:"flex items-center gap-2 text-sm font-semibold text-rose-600 dark:text-rose-300",children:[t.jsx(ga,{className:"w-4 h-4"}),"Грубые"]}),t.jsx("ul",{className:`text-sm mt-2 space-y-1 ${r}`,children:o.map(d=>t.jsxs("li",{children:["• ",d]},d))})]})]})}),t.jsx(ls,{title:"Меры дисциплинарного воздействия и ограничения",description:"Применяются последовательно, кроме случаев грубых нарушений.",children:t.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[t.jsxs("div",{className:`rounded-2xl border p-4 sm:p-5 space-y-2 ${s==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white"}`,children:[t.jsxs("div",{className:"flex items-center gap-2 text-sm font-semibold text-[#4E6E49]",children:[t.jsx(Pu,{className:"w-4 h-4"}),"Порядок эскалации"]}),t.jsxs("ul",{className:`text-sm space-y-1 ${r}`,children:[t.jsx("li",{children:"• Напоминания — не более 1 в неделю, без последствий."}),t.jsx("li",{children:"• Предупреждения — не более 2 в неделю, при повторении незначительных или единичном среднем нарушении."}),t.jsx("li",{children:"• Выговоры — не более 2 в неделю, назначаются ведущим сессии или ответственным за сообщество."})]})]}),t.jsxs("div",{className:`rounded-2xl border p-4 sm:p-5 space-y-2 ${s==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white"}`,children:[t.jsxs("div",{className:"flex items-center gap-2 text-sm font-semibold text-[#4E6E49]",children:[t.jsx(ga,{className:"w-4 h-4"}),"Ограничительные меры"]}),t.jsxs("ul",{className:`text-sm space-y-1 ${r}`,children:[t.jsx("li",{children:"• Ограничение доступа к торговым сессиям: 1-е — ≥3 дней; повторное — 1 неделя; систематическое — 2 недели; дальше — исключение без восстановления."}),t.jsx("li",{children:"• Немедленное исключение без эскалации за грубое нарушение, оскорбления, провокации или угрозу финансам/безопасности/репутации."})]})]})]})}),t.jsx(ls,{title:"Финансовые последствия",description:"Что происходит при систематических нарушениях и невыполнении мер.",children:t.jsx("div",{className:`rounded-2xl border p-4 sm:p-5 space-y-2 ${s==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white"}`,children:t.jsxs("ul",{className:`text-sm space-y-2 ${r}`,children:[t.jsx("li",{children:"• При систематических нарушениях и игнорировании мер может быть отказано в удовлетворении заявки на вывод средств, включая заработок за успешные сессии."}),t.jsx("li",{children:"• Перераспределение заработка: удержанные средства делятся между участниками, кроме тех, кто допустил два и более нарушений в неделю или более 6 нарушений в месяц."}),t.jsx("li",{children:"• Добровольно внесённые в пул или кошелёк команды средства не возвращаются при досрочном выходе или исключении за нарушения."})]})})}),t.jsx(ls,{title:"Фиксация нарушений и апелляции",description:"Прозрачный процесс учёта нарушений и возможность обжаловать решение.",children:t.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[t.jsxs("div",{className:`rounded-2xl border p-4 sm:p-5 space-y-2 ${s==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white"}`,children:[t.jsxs("div",{className:"flex items-center gap-2 text-sm font-semibold text-[#4E6E49]",children:[t.jsx(Mi,{className:"w-4 h-4"}),"Порядок фиксации"]}),t.jsxs("ul",{className:`text-sm space-y-1 ${r}`,children:[t.jsx("li",{children:"• Все нарушения фиксируются ответственным за сообщество в отдельной ветви командного чата Telegram."}),t.jsx("li",{children:"• Обязательная фиксация: дата и время, тип нарушения, краткое описание ситуации, применённая мера."})]})]}),t.jsxs("div",{className:`rounded-2xl border p-4 sm:p-5 space-y-2 ${s==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white"}`,children:[t.jsxs("div",{className:"flex items-center gap-2 text-sm font-semibold text-[#4E6E49]",children:[t.jsx(Lt,{className:"w-4 h-4"}),"Процедура апелляции"]}),t.jsxs("ul",{className:`text-sm space-y-1 ${r}`,children:[t.jsx("li",{children:"• Апелляция подаётся в течение 24 часов с момента уведомления о мере."}),t.jsx("li",{children:"• Подача: ответственному за сообщество или назначенному куратору."}),t.jsx("li",{children:"• Рассмотрение: до 60 часов; решение окончательное."})]})]})]})}),t.jsx(ls,{title:"Принцип равного применения",description:"Меры действуют одинаково для всех участников.",children:t.jsx("div",{className:`rounded-2xl border p-4 sm:p-5 space-y-1 ${s==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white"}`,children:t.jsx("p",{className:`text-sm ${r}`,children:"Дисциплинарные меры применяются ко всем участникам независимо от стажа, роли в проекте, вклада, личных отношений или результатов торговых сессий. Привилегии и исключения не допускаются."})})}),t.jsx(ls,{title:"Определения",description:"Ключевые термины, чтобы избежать двусмысленностей.",children:t.jsx("div",{className:"grid gap-4 md:grid-cols-2",children:c.map(d=>t.jsxs("div",{className:`rounded-2xl border p-4 sm:p-5 space-y-1 ${s==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white"}`,children:[t.jsx("p",{className:"text-sm font-semibold text-[#4E6E49]",children:d.term}),t.jsx("p",{className:`text-sm ${r}`,children:d.text})]},d.term))})}),t.jsx(ls,{title:"Заключительные положения",description:"Кто может обновлять раздел и обязанность ознакомления.",children:t.jsx("div",{className:`rounded-2xl border p-4 sm:p-5 space-y-2 ${s==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white"}`,children:t.jsxs("ul",{className:`text-sm space-y-1 ${r}`,children:[t.jsx("li",{children:"• Ответственный за сообщество или исполняющий обязанности оставляет за собой право корректировать и обновлять раздел при изменении процессов или структуры платформы."}),t.jsx("li",{children:"• Все участники обязаны ознакомиться с настоящей политикой и соблюдать её безусловно."})]})})})]})},E4={create:"Создание",update:"Изменение",delete:"Удаление"},T4={slot:"Слот",status:"Статус",earning:"Заработок",referral:"Реферал",login:"Ник"},S4={pending:"bg-amber-50 text-amber-900 border border-amber-200 shadow-inner dark:bg-amber-900/25 dark:text-amber-50 dark:border-amber-700",approved:"bg-emerald-50 text-emerald-900 border border-emerald-200 shadow-inner dark:bg-emerald-900/25 dark:text-emerald-50 dark:border-emerald-700",rejected:"bg-rose-50 text-rose-900 border border-rose-200 shadow-inner dark:bg-rose-900/25 dark:text-rose-50 dark:border-rose-700"},I4={pending:t.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-semibold bg-amber-100 text-amber-900 dark:bg-amber-900/40 dark:text-amber-100",children:[t.jsx(Lt,{className:"w-3 h-3"})," На согласовании"]}),approved:t.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-semibold bg-emerald-100 text-emerald-900 dark:bg-emerald-900/40 dark:text-emerald-100",children:[t.jsx(Ir,{className:"w-3 h-3"})," Принято"]}),rejected:t.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-semibold bg-rose-100 text-rose-900 dark:bg-rose-900/40 dark:text-rose-100",children:[t.jsx(Xf,{className:"w-3 h-3"})," Отклонено"]})},rn=(s,e=!1)=>{if(!s)return"—";try{return oe(s,e?"dd.MM.yyyy HH:mm":"dd.MM.yyyy")}catch{return"—"}},T0=s=>{var a,n,i;if(!s)return"—";const e=(n=(a=s.slots)==null?void 0:a.map(o=>`${o.start}-${o.end}${o.endDate?` (до ${rn(o.endDate)})`:""}`))==null?void 0:n.join(", "),r=s.category?` [${((i=us[s.category])==null?void 0:i.label)||s.category}]`:"";return`${rn(s.date)}${e?` · ${e}`:""}${r}`},S0=s=>{if(!s)return"—";const e=s.type==="dayoff"?"Выходной":s.type==="sick"?"Больничный":"Отпуск",r=s.endDate?` (${rn(s.endDate)})`:"";return`${rn(s.date)} · ${e}${r}`},A4=()=>{const{user:s}=ot(),{isAdmin:e}=ft(),[r,a]=k.useState([]),[n,i]=k.useState([]),[o,c]=k.useState(!0),[d,u]=k.useState(null),[m,f]=k.useState(!1),[x,v]=k.useState([]),[T,I]=k.useState(null),[N,O]=k.useState("pending"),D=async()=>{c(!0),I(null);try{const w=await h_();let g=w;if(e){const ee=new Date;ee.setHours(ee.getHours()-60),g=w.filter(te=>new Date(te.createdAt)>=ee)}const $=new Date;$.setDate($.getDate()-30);const L=w.filter(ee=>ee.status!=="pending"&&ee.processedAt&&new Date(ee.processedAt)>=$);a(g),i(L)}catch(w){console.error("Не удалось загрузить заявки на согласование",w),I("Не удалось загрузить заявки")}finally{c(!1)}};k.useEffect(()=>{D()},[]);const C=async w=>{if(!d){u(w),I(null);try{const g=r.find($=>$.id===w);await x0(w,(s==null?void 0:s.id)||"admin"),(g==null?void 0:g.entity)==="login"&&(Nc(g.targetUserId),await fs(g.targetUserId),window.dispatchEvent(new CustomEvent("nicknameUpdated",{detail:{userId:g.targetUserId}}))),await D(),v($=>$.filter(L=>L!==w))}catch(g){console.error("Ошибка при подтверждении",g),I(`Не удалось подтвердить заявку: ${(g==null?void 0:g.message)||g}`),await D()}finally{u(null)}}},M=async w=>{if(d)return;const g=prompt("Комментарий для отклонения заявки","Уточните детали")||"Отклонено без комментария";u(w),I(null);try{await f0(w,(s==null?void 0:s.id)||"admin",g),await D()}catch($){console.error("Ошибка при отклонении",$),I("Не удалось отклонить заявку")}finally{u(null)}},V=async()=>{if(!(m||d||x.length===0)){f(!0),I(null);try{for(const w of x){const g=r.find($=>$.id===w);await x0(w,(s==null?void 0:s.id)||"admin"),(g==null?void 0:g.entity)==="login"&&(Nc(g.targetUserId),await fs(g.targetUserId),window.dispatchEvent(new CustomEvent("nicknameUpdated",{detail:{userId:g.targetUserId}})))}await D(),v([])}catch(w){console.error("Ошибка при подтверждении выбранных",w),I(`Не удалось подтвердить выбранные заявки: ${(w==null?void 0:w.message)||w}`),await D()}finally{f(!1)}}},U=async()=>{if(m||d||x.length===0)return;const w=prompt("Комментарий для отклонения выбранных заявок","Отклонено без комментария")||"Отклонено без комментария";if(w!==null){f(!0),I(null);try{for(const g of x)await f0(g,(s==null?void 0:s.id)||"admin",w);await D(),v([])}catch(g){console.error("Ошибка при отклонении выбранных",g),I(`Не удалось отклонить выбранные заявки: ${(g==null?void 0:g.message)||g}`),await D()}finally{f(!1)}}},y=w=>{v(g=>g.includes(w)?g.filter($=>$!==w):[...g,w])},b=()=>{const w=r.filter($=>$.status==="pending").map($=>$.id),g=w.every($=>x.includes($));v(g?[]:w)},E=w=>{if(w.entity==="login"){const g=w.before,$=w.after,L=(g==null?void 0:g.nickname)||"—",ee=($==null?void 0:$.nickname)||"—";return`${L} → ${ee}`}if(w.entity==="slot"){const g=w.before,$=w.after;return`${T0(g)} → ${T0($)}`}if(w.entity==="status"){const g=w.before,$=w.after;return`${S0(g)} → ${S0($)}`}return w.after?"Изменение":w.before?"Удаление":"Создание"},j=(w,g=!0)=>t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-800 text-sm",children:[t.jsx("thead",{className:"bg-gray-50 dark:bg-gray-900/40",children:t.jsxs("tr",{children:[t.jsx("th",{className:"px-4 py-3 text-left font-semibold text-gray-700 dark:text-gray-200",children:"Статус"}),t.jsx("th",{className:"px-4 py-3 text-left font-semibold text-gray-700 dark:text-gray-200",children:"Тип"}),t.jsx("th",{className:"px-4 py-3 text-left font-semibold text-gray-700 dark:text-gray-200",children:"Действие"}),t.jsx("th",{className:"px-4 py-3 text-left font-semibold text-gray-700 dark:text-gray-200",children:"Кто"}),t.jsx("th",{className:"px-4 py-3 text-left font-semibold text-gray-700 dark:text-gray-200",children:"Изменение"}),t.jsx("th",{className:"px-4 py-3 text-left font-semibold text-gray-700 dark:text-gray-200",children:"Время"}),t.jsx("th",{className:"px-4 py-3 text-left font-semibold text-gray-700 dark:text-gray-200",children:"Комментарий"}),g&&t.jsx("th",{className:"px-4 py-3 text-left font-semibold text-gray-700 dark:text-gray-200",children:"Действия"}),g&&t.jsx("th",{className:"px-4 py-3 text-left font-semibold text-gray-700 dark:text-gray-200",children:t.jsx("button",{onClick:b,className:"inline-flex items-center gap-1 text-sm text-[#4E6E49] hover:text-emerald-700",title:"Выбрать все на согласовании",children:r.some($=>$.status==="pending")?t.jsxs(t.Fragment,{children:[r.filter($=>$.status==="pending").every($=>x.includes($.id))?t.jsx(da,{className:"w-4 h-4"}):t.jsx(jl,{className:"w-4 h-4"})," Все"]}):t.jsx(jl,{className:"w-4 h-4 opacity-50"})})})]})}),t.jsxs("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-800",children:[w.map($=>t.jsxs("tr",{className:`bg-white dark:bg-[#0f1624] ${S4[$.status]}`,children:[t.jsx("td",{className:"px-4 py-3 align-top",children:I4[$.status]}),t.jsx("td",{className:"px-4 py-3 align-top font-semibold",children:T4[$.entity]}),t.jsx("td",{className:"px-4 py-3 align-top",children:E4[$.action]}),t.jsx("td",{className:"px-4 py-3 align-top",children:t.jsxs("div",{className:"flex flex-col gap-1",children:[t.jsx("span",{className:"font-semibold",children:t.jsx(ys,{userId:$.targetUserId})}),t.jsxs("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:["Автор: ",t.jsx(ys,{userId:$.authorId})]})]})}),t.jsxs("td",{className:"px-4 py-3 align-top",children:[t.jsx("div",{className:"text-xs sm:text-sm font-medium",children:E($)}),$.after&&$.entity==="slot"&&$.after.comment&&t.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:["Комментарий слота: ",$.after.comment]}),$.after&&$.entity==="status"&&$.after.comment&&t.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:["Комментарий статуса: ",$.after.comment]})]}),t.jsx("td",{className:"px-4 py-3 align-top",children:t.jsxs("div",{className:"flex flex-col gap-1 text-xs",children:[t.jsxs("span",{className:"text-gray-500 dark:text-gray-400",children:["Создано: ",t.jsx("span",{className:"text-gray-700 dark:text-gray-200",children:rn($.createdAt,!0)})]}),$.processedAt&&t.jsxs("span",{className:"text-gray-500 dark:text-gray-400",children:["Обработано: ",t.jsx("span",{className:"text-gray-700 dark:text-gray-200",children:rn($.processedAt,!0)})]}),$.reviewedBy&&$.status!=="pending"&&t.jsxs("span",{className:"text-gray-500 dark:text-gray-400",children:["Админ: ",t.jsx(ys,{userId:$.reviewedBy})]})]})}),t.jsxs("td",{className:"px-4 py-3 align-top",children:[t.jsx("div",{className:"text-xs sm:text-sm text-gray-700 dark:text-gray-200 whitespace-pre-wrap",children:$.comment||"—"}),$.adminComment&&t.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:["Ответ админа: ",$.adminComment]})]}),g&&t.jsx("td",{className:"px-4 py-3 align-top",children:$.status==="pending"?t.jsxs("div",{className:"flex flex-col gap-2",children:[t.jsx("button",{onClick:()=>C($.id),disabled:!!d,className:"px-3 py-2 rounded-lg bg-emerald-600 hover:bg-emerald-700 disabled:bg-emerald-400 text-white text-xs sm:text-sm font-semibold",children:d===$.id?"Применяем...":"Подтвердить"}),t.jsx("button",{onClick:()=>M($.id),disabled:!!d,className:"px-3 py-2 rounded-lg bg-rose-600 hover:bg-rose-700 disabled:bg-rose-400 text-white text-xs sm:text-sm font-semibold",children:d===$.id?"Отклоняем...":"Отклонить"})]}):t.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Выполнено"})}),g&&t.jsx("td",{className:"px-4 py-3 align-top",children:$.status==="pending"?t.jsxs("button",{onClick:()=>y($.id),className:"inline-flex items-center gap-1 text-sm text-[#4E6E49] hover:text-emerald-700",children:[x.includes($.id)?t.jsx(da,{className:"w-4 h-4"}):t.jsx(jl,{className:"w-4 h-4"}),t.jsx("span",{className:"sr-only",children:"Выбрать заявку"})]}):t.jsx("span",{className:"text-xs text-gray-400",children:"—"})})]},$.id)),w.length===0&&t.jsx("tr",{children:t.jsx("td",{colSpan:g?8:7,className:"px-4 py-6 text-center text-sm text-gray-500 dark:text-gray-400",children:N==="pending"?"Нет заявок на согласование":"Нет заявок в архиве"})})]})]})});if(o)return t.jsx("div",{className:"rounded-xl border border-gray-200 dark:border-gray-800 p-6 text-center text-sm text-gray-600 dark:text-gray-300",children:"Загружаем заявки..."});const A=N==="pending"?r:n;return t.jsxs("div",{className:"rounded-xl border border-gray-200 dark:border-gray-800 overflow-hidden shadow-sm",children:[t.jsxs("div",{className:"p-4 sm:p-5 border-b border-gray-200 dark:border-gray-800 flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-lg font-semibold",children:"Согласования"}),t.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Заявки на изменение слотов и статусов"})]}),t.jsx("div",{className:"flex items-center gap-2",children:t.jsxs("div",{className:"flex rounded-lg bg-gray-100 dark:bg-gray-800 p-1",children:[t.jsxs("button",{onClick:()=>O("pending"),className:`px-3 py-1.5 rounded-md text-sm font-medium transition-colors ${N==="pending"?"bg-white dark:bg-gray-700 text-gray-900 dark:text-white shadow-sm":"text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white"}`,children:["Ожидают (",r.filter(w=>w.status==="pending").length,")"]}),t.jsxs("button",{onClick:()=>O("archive"),className:`px-3 py-1.5 rounded-md text-sm font-medium transition-colors flex items-center gap-1.5 ${N==="archive"?"bg-white dark:bg-gray-700 text-gray-900 dark:text-white shadow-sm":"text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white"}`,children:[t.jsx(L0,{className:"w-3.5 h-3.5"}),"Архив"]})]})})]}),N==="pending"&&t.jsxs("div",{className:"px-4 sm:px-5 py-3 bg-gray-50 dark:bg-gray-900/20 border-b border-gray-200 dark:border-gray-800 flex items-center gap-3 flex-wrap",children:[t.jsxs("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:["Выбрано: ",x.length]}),t.jsx("button",{onClick:V,disabled:m||d!==null||x.length===0,className:"text-sm px-3 py-1.5 rounded-lg bg-emerald-600 hover:bg-emerald-700 disabled:bg-emerald-400 text-white font-semibold",children:m?"Применяем...":`Принять (${x.length})`}),t.jsx("button",{onClick:U,disabled:m||d!==null||x.length===0,className:"text-sm px-3 py-1.5 rounded-lg bg-rose-600 hover:bg-rose-700 disabled:bg-rose-400 text-white font-semibold",children:m?"Отклоняем...":`Отклонить (${x.length})`})]}),T&&t.jsx("div",{className:"px-4 py-3 bg-rose-100 text-rose-900 dark:bg-rose-900/30 dark:text-rose-100 text-sm",children:T}),j(A,N==="pending"),t.jsx("div",{className:"px-4 py-3 border-t border-gray-200 dark:border-gray-800 flex justify-end",children:t.jsx("button",{onClick:D,className:"text-sm px-3 py-2 rounded-lg bg-gray-100 hover:bg-gray-200 dark:bg-gray-800 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-200",children:"Обновить"})})]})},C4=()=>{const{isAdmin:s}=ft();return s?t.jsxs("div",{className:"max-w-6xl mx-auto px-4 sm:px-6 py-6 sm:py-8 space-y-6",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Администрирование"}),t.jsx("h1",{className:"text-2xl sm:text-3xl font-bold",children:"Согласования изменений"}),t.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Подтверждайте или отклоняйте изменения слотов, перерывов и статусов участников."})]}),t.jsx(A4,{})]}):t.jsx(Hi,{to:"/management",replace:!0})},zl=({number:s,title:e,children:r,icon:a,isOpen:n,onToggle:i})=>{const{theme:o}=Re();return t.jsxs("div",{className:`overflow-hidden rounded-2xl border transition-all duration-300 ${o==="dark"?"bg-[#1a212a]/50 border-white/5 shadow-inner":"bg-white border-gray-100 shadow-sm"}`,children:[t.jsxs("button",{onClick:i,className:"w-full flex items-center justify-between p-5 text-left transition-colors hover:bg-white/5",children:[t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsx("div",{className:`flex items-center justify-center w-10 h-10 rounded-xl font-black text-lg ${o==="dark"?"bg-blue-500/20 text-blue-400":"bg-blue-50 text-blue-600"}`,children:s}),t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:o==="dark"?"text-gray-400":"text-gray-500",children:a}),t.jsx("h3",{className:`text-lg font-bold ${o==="dark"?"text-white":"text-gray-900"}`,children:e})]})]}),n?t.jsx(ti,{className:"w-5 h-5 text-gray-500"}):t.jsx(Dr,{className:"w-5 h-5 text-gray-500"})]}),n&&t.jsx("div",{className:`p-6 pt-0 border-t ${o==="dark"?"border-white/5":"border-gray-50"}`,children:t.jsx("div",{className:`mt-4 space-y-4 ${o==="dark"?"text-gray-300":"text-gray-600"}`,children:r})})]})},D4=()=>{const{theme:s}=Re(),[e,r]=k.useState(1),a=i=>{r(e===i?null:i)},n=s==="dark"?"text-white":"text-gray-900";return t.jsxs("div",{className:"space-y-8 animate-fade-in",children:[t.jsxs("div",{className:`relative overflow-hidden rounded-3xl p-8 border ${s==="dark"?"bg-gradient-to-br from-[#1a212a] to-[#0f1216] border-blue-500/20 shadow-2xl":"bg-gradient-to-br from-white to-blue-50/30 border-blue-500/10 shadow-xl"}`,children:[t.jsx("div",{className:"absolute top-0 right-0 w-64 h-64 bg-blue-500/5 blur-3xl rounded-full -mr-20 -mt-20 pointer-events-none"}),t.jsxs("div",{className:"relative flex flex-col md:flex-row gap-8 items-start",children:[t.jsx("div",{className:`p-4 rounded-2xl ${s==="dark"?"bg-blue-500/10":"bg-blue-500/5"}`,children:t.jsx(Vr,{className:`w-12 h-12 ${s==="dark"?"text-blue-400":"text-blue-500"}`})}),t.jsxs("div",{className:"flex-1 space-y-4",children:[t.jsx("h2",{className:`text-2xl md:text-3xl font-black ${n}`,children:"AVF Late Volume"}),t.jsx("p",{className:`text-lg leading-relaxed ${s==="dark"?"text-gray-300":"text-gray-600"}`,children:"AVF Late Volume — это контекстная торговая стратегия, ориентированная на инструменты, которые уже реализовали основной импульс, но сохраняют повышенное внимание рынка. Стратегия допускает и структурно предусматривает глубокую временную просадку с последующим набором при сохранении ключевых рыночных метрик."}),t.jsxs("div",{className:"flex flex-wrap gap-4 pt-2",children:[t.jsxs("div",{className:`flex items-center gap-2 px-3 py-1.5 rounded-full text-xs font-bold ${s==="dark"?"bg-white/5 text-gray-400 border border-white/10":"bg-gray-100 text-gray-600 border border-gray-200"}`,children:[t.jsx(it,{className:"w-3.5 h-3.5"}),"POST-IMPULSE"]}),t.jsxs("div",{className:`flex items-center gap-2 px-3 py-1.5 rounded-full text-xs font-bold ${s==="dark"?"bg-white/5 text-gray-400 border border-white/10":"bg-gray-100 text-gray-600 border border-gray-200"}`,children:[t.jsx(es,{className:"w-3.5 h-3.5"}),"GMGN SCREENING"]}),t.jsxs("div",{className:`flex items-center gap-2 px-3 py-1.5 rounded-full text-xs font-bold ${s==="dark"?"bg-white/10 text-blue-400 border border-blue-500/20":"bg-blue-50 text-blue-600 border border-blue-200"}`,children:[t.jsx(Wt,{className:"w-3.5 h-3.5"}),"DEEP DISCOUNT"]})]})]})]})]}),t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[t.jsxs("div",{className:"lg:col-span-2 space-y-4",children:[t.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[t.jsx($c,{className:`w-6 h-6 ${s==="dark"?"text-blue-400":"text-blue-500"}`}),t.jsx("h3",{className:`text-xl font-black ${n}`,children:"Алгоритм работы"})]}),t.jsxs(zl,{number:1,title:"Фильтрация: Капитализация и Просадка",icon:t.jsx(rr,{className:"w-5 h-5"}),isOpen:e===1,onToggle:()=>a(1),children:[t.jsx("p",{children:"На первом этапе применяются жёсткие количественные фильтры для отсева нежизнеспособных активов:"}),t.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[t.jsxs("div",{className:`p-4 rounded-xl border ${s==="dark"?"bg-white/5 border-white/10":"bg-gray-50 border-gray-200"}`,children:[t.jsx("p",{className:"text-[10px] font-bold uppercase tracking-wider text-gray-500 mb-1",children:"ATH Cap"}),t.jsx("p",{className:`text-lg font-black ${n}`,children:"≥ 500k USD"})]}),t.jsxs("div",{className:`p-4 rounded-xl border ${s==="dark"?"bg-white/5 border-white/10":"bg-gray-50 border-gray-200"}`,children:[t.jsx("p",{className:"text-[10px] font-bold uppercase tracking-wider text-gray-500 mb-1",children:"Просадка"}),t.jsx("p",{className:"text-lg font-black text-rose-500",children:"-50% ... -90%"})]}),t.jsxs("div",{className:`p-4 rounded-xl border ${s==="dark"?"bg-white/5 border-white/10":"bg-gray-50 border-gray-200"}`,children:[t.jsx("p",{className:"text-[10px] font-bold uppercase tracking-wider text-gray-500 mb-1",children:"Current Cap"}),t.jsx("p",{className:`text-lg font-black ${n}`,children:"≥ 20k USD"})]})]}),t.jsx("div",{className:`mt-4 p-4 rounded-xl border-l-4 ${s==="dark"?"bg-blue-500/5 border-blue-500/50":"bg-blue-50 border-blue-500/30"}`,children:t.jsxs("p",{className:"text-sm italic",children:[t.jsx("strong",{children:"Смысл:"})," Если токен уже достигал значимой капитализации, это означает, что рынок признавал ценность нарратива. Текущая глубокая просадка при сохранении минимальной капитализации формирует асимметричную зону входа — цену страха, а не отсутствия интереса."]})})]}),t.jsx(zl,{number:2,title:"Проверка жизнеспособности нарратива",icon:t.jsx(Gt,{className:"w-5 h-5"}),isOpen:e===2,onToggle:()=>a(2),children:t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[t.jsx(Yl,{className:"w-4 h-4 text-sky-400"}),t.jsx("h4",{className:"font-bold",children:"Социальный фильтр (X / Twitter)"})]}),t.jsxs("ul",{className:"space-y-2 list-disc list-inside text-sm pl-2",children:[t.jsx("li",{children:"Поиск по тикеру или адресу контракта"}),t.jsxs("li",{children:["Минимум ",t.jsx("strong",{children:"3 упоминания"})," за последние 24 часа"]}),t.jsxs("li",{children:["Источник — аккаунты с ",t.jsx("strong",{children:"5 000+ подписчиков"})]}),t.jsx("li",{children:"Приоритет: обзоры, обсуждения, аналитические треды"}),t.jsx("li",{className:"text-rose-400",children:"Исключаются автоматические call-каналы и спам"})]})]}),t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[t.jsx(em,{className:"w-4 h-4 text-blue-400"}),t.jsx("h4",{className:"font-bold",children:"Telegram-сообщество"})]}),t.jsxs("ul",{className:"space-y-2 list-disc list-inside text-sm pl-2",children:[t.jsxs("li",{children:["Онлайн-активность: ",t.jsx("strong",{children:"≥ 10%"})," от участников"]}),t.jsx("li",{children:"Характер: фокус на развитии и будущем"}),t.jsx("li",{className:"text-rose-400 text-[11px] uppercase font-bold mt-1",children:"Исключаем при:"}),t.jsx("li",{className:"text-rose-400/80 ml-4",children:'Панические настроения, "некрологи", полное молчание'})]})]})]})}),t.jsxs(zl,{number:3,title:"Распределение холдеров и китов",icon:t.jsx(Hs,{className:"w-5 h-5"}),isOpen:e===3,onToggle:()=>a(3),children:[t.jsx("p",{className:"text-sm",children:"Цель — исключить активы с централизованным контролем ликвидности."}),t.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 mt-2",children:[t.jsxs("div",{className:`p-4 rounded-xl border ${s==="dark"?"bg-emerald-500/5 border-emerald-500/20":"bg-emerald-50 border-emerald-500/20"}`,children:[t.jsx("p",{className:"text-[10px] font-bold uppercase tracking-wider text-emerald-500 mb-1",children:"Max Holder"}),t.jsx("p",{className:`text-lg font-black ${n}`,children:"≤ 3% эмиссии"})]}),t.jsxs("div",{className:`p-4 rounded-xl border ${s==="dark"?"bg-emerald-500/5 border-emerald-500/20":"bg-emerald-50 border-emerald-500/20"}`,children:[t.jsx("p",{className:"text-[10px] font-bold uppercase tracking-wider text-emerald-500 mb-1",children:"Top-10 Holders"}),t.jsx("p",{className:`text-lg font-black ${n}`,children:"≤ 20% всего"})]})]}),t.jsx("p",{className:"text-sm font-medium mt-2 text-rose-400",children:"* При признаках массового распределения позиций крупными держателями актив исключается."})]})]}),t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:`rounded-2xl p-6 border ${s==="dark"?"bg-[#151a21]/80 border-white/5":"bg-white border-gray-100"} shadow-lg space-y-4`,children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(U0,{className:"w-6 h-6 text-amber-500"}),t.jsx("h3",{className:`text-lg font-black ${n}`,children:"Управление позицией"})]}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-xs font-bold text-gray-500 uppercase tracking-widest mb-2",children:"Усреднение"}),t.jsxs("div",{className:`space-y-2 p-3 rounded-xl ${s==="dark"?"bg-white/5":"bg-gray-50"}`,children:[t.jsxs("div",{className:"flex justify-between text-sm",children:[t.jsx("span",{children:"1-й добор"}),t.jsx("span",{className:"font-bold text-amber-500",children:"-15%...-25%"})]}),t.jsxs("div",{className:"flex justify-between text-sm",children:[t.jsx("span",{children:"2-й добор"}),t.jsx("span",{className:"font-bold text-amber-500",children:"-40%...-50%"})]}),t.jsx("div",{className:"mt-2 pt-2 border-t border-white/5 text-[11px] text-rose-400 font-bold uppercase",children:"3-й добор ЗАПРЕЩЕН"})]})]}),t.jsxs("div",{children:[t.jsx("p",{className:"text-xs font-bold text-gray-500 uppercase tracking-widest mb-2",children:"Диверсификация"}),t.jsxs("div",{className:`space-y-2 p-3 rounded-xl ${s==="dark"?"bg-white/5":"bg-gray-50"}`,children:[t.jsx("p",{className:"text-sm",children:"Дробление между адресами"}),t.jsxs("p",{className:"text-[11px] font-medium text-gray-400",children:["Max ",t.jsx("span",{className:"text-amber-500 font-bold",children:"0.5%"})," эмиссии на один кошелек"]})]})]})]})]}),t.jsxs("div",{className:`rounded-2xl p-6 border ${s==="dark"?"bg-blue-500/5 border-blue-500/20":"bg-blue-50 border-blue-500/20"} shadow-lg space-y-4`,children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(Ki,{className:"w-6 h-6 text-blue-500"}),t.jsx("h3",{className:`text-lg font-black ${n}`,children:"Экспресс-чек"})]}),t.jsxs("div",{className:`space-y-1.5 ${s==="dark"?"text-gray-400":"text-gray-600"} text-sm`,children:[t.jsxs("p",{className:"flex items-center gap-2",children:[t.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-blue-500"}),"ATH-кап ≥ 500k USD"]}),t.jsxs("p",{className:"flex items-center gap-2",children:[t.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-blue-500"}),"Current кап ",">"," 20k USD"]}),t.jsxs("p",{className:"flex items-center gap-2",children:[t.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-blue-500"}),"Просадка 50–90%"]}),t.jsxs("p",{className:"flex items-center gap-2",children:[t.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-blue-500"}),"3+ упоминания в X (5k+)"]}),t.jsxs("p",{className:"flex items-center gap-2",children:[t.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-blue-500"}),"Топ-1 ","<"," 3%, Топ-10 ≤ 20%"]})]})]})]})]}),t.jsx("div",{className:`rounded-2xl p-6 border-l-8 ${s==="dark"?"bg-[#0b1015] border-blue-500/50":"bg-gray-50 border-blue-500/30"}`,children:t.jsxs("div",{className:"flex gap-4 items-start",children:[t.jsx(Ki,{className:"w-8 h-8 text-blue-500 shrink-0"}),t.jsxs("div",{className:"space-y-2",children:[t.jsx("h4",{className:`text-lg font-black ${n}`,children:"Итоговая логика стратегии"}),t.jsx("p",{className:`text-sm leading-relaxed ${s==="dark"?"text-gray-400":"text-gray-500"}`,children:"Эта стратегия — это не охота за разворотами и не ставка на удачу. Это системная работа с активами, которые уже были признаны рынком, временно торгуются в зоне страха, но сохраняют интерес, ликвидность и распределённое владение. Любое отклонение от фильтров разрушает её статистическое преимущество."})]})]})})]})},Aa=({number:s,title:e,children:r,icon:a,isOpen:n,onToggle:i})=>{const{theme:o}=Re();return t.jsxs("div",{className:`overflow-hidden rounded-2xl border transition-all duration-300 ${o==="dark"?"bg-[#1a212a]/50 border-white/5 shadow-inner":"bg-white border-gray-100 shadow-sm"}`,children:[t.jsxs("button",{onClick:i,className:"w-full flex items-center justify-between p-5 text-left transition-colors hover:bg-white/5",children:[t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsx("div",{className:`flex items-center justify-center w-10 h-10 rounded-xl font-black text-lg ${o==="dark"?"bg-orange-500/20 text-orange-400":"bg-orange-50 text-orange-600"}`,children:s}),t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:o==="dark"?"text-gray-300":"text-gray-600",children:a}),t.jsx("h3",{className:`text-lg font-bold ${o==="dark"?"text-white":"text-gray-900"}`,children:e})]})]}),n?t.jsx(ti,{className:"w-5 h-5 text-gray-500"}):t.jsx(Dr,{className:"w-5 h-5 text-gray-500"})]}),n&&t.jsx("div",{className:`p-6 pt-0 border-t ${o==="dark"?"border-white/5":"border-gray-50"}`,children:t.jsx("div",{className:`mt-4 space-y-4 ${o==="dark"?"text-gray-300":"text-gray-600"}`,children:r})})]})},$4=()=>{const{theme:s}=Re(),[e,r]=k.useState(1),a=i=>{r(e===i?null:i)},n=s==="dark"?"text-white":"text-gray-900";return t.jsxs("div",{className:"space-y-12 animate-fade-in",children:[t.jsxs("div",{className:`relative overflow-hidden rounded-3xl p-8 border ${s==="dark"?"bg-gradient-to-br from-[#1a212a] to-[#0f1216] border-orange-500/20 shadow-2xl":"bg-gradient-to-br from-white to-orange-50/30 border-orange-500/10 shadow-xl"}`,children:[t.jsx("div",{className:"absolute top-0 right-0 w-64 h-64 bg-orange-500/5 blur-3xl rounded-full -mr-20 -mt-20 pointer-events-none"}),t.jsxs("div",{className:"relative flex flex-col md:flex-row gap-8 items-start",children:[t.jsx("div",{className:`p-4 rounded-2xl ${s==="dark"?"bg-orange-500/10":"bg-orange-500/5"}`,children:t.jsx(Ar,{className:`w-12 h-12 ${s==="dark"?"text-orange-400":"text-orange-500"}`})}),t.jsxs("div",{className:"flex-1 space-y-4",children:[t.jsx("h2",{className:`text-2xl md:text-3xl font-black ${n}`,children:"AVF Intraday"}),t.jsx("p",{className:`text-lg leading-relaxed ${s==="dark"?"text-gray-300":"text-gray-600"}`,children:"AVF Intraday — это системная стратегия внутридневной торговли в Solana-сегменте, ориентированная на поиск и отработку свежих токенов с горизонтом удержания позиции от 1 часа до 1 торгового дня."}),t.jsx("p",{className:`text-sm opacity-80 ${s==="dark"?"text-gray-300":"text-gray-600"}`,children:"Это не скальпинг и не погоня за хаями. Ключ — быстрое, но взвешенное принятие решений на основе чётких метрик и алгоритма."}),t.jsxs("div",{className:"flex flex-wrap gap-4 pt-2",children:[t.jsxs("div",{className:`flex items-center gap-2 px-3 py-1.5 rounded-full text-xs font-bold ${s==="dark"?"bg-white/5 text-gray-400 border border-white/10":"bg-gray-100 text-gray-600 border border-gray-200"}`,children:[t.jsx(Lt,{className:"w-3.5 h-3.5"}),"1H - 24H"]}),t.jsxs("div",{className:`flex items-center gap-2 px-3 py-1.5 rounded-full text-xs font-bold ${s==="dark"?"bg-white/5 text-gray-400 border border-white/10":"bg-gray-100 text-gray-600 border border-gray-200"}`,children:[t.jsx(es,{className:"w-3.5 h-3.5"}),"SOLANA MIGRATED"]}),t.jsxs("div",{className:`flex items-center gap-2 px-3 py-1.5 rounded-full text-xs font-bold ${s==="dark"?"bg-white/10 text-orange-400 border border-orange-500/20":"bg-orange-50 text-orange-600 border border-orange-200"}`,children:[t.jsx(it,{className:"w-3.5 h-3.5"}),"DCA / RETRACE"]})]})]})]})]}),t.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[{title:"Любая фаза",desc:"При слабых объёмах, стагнации и во флете.",icon:t.jsx(Ir,{className:"w-5 h-5 text-emerald-500"})},{title:"Стабильность",icon:t.jsx(it,{className:"w-5 h-5 text-blue-500"}),desc:"Забираем повторяемую прибыль на умеренных сетапах."},{title:"Ежедневно",icon:t.jsx(Lt,{className:"w-5 h-5 text-amber-500"}),desc:"Десятки новых мемов и раннеров каждый день в Solana."},{title:"Микро-деп",icon:t.jsx(X0,{className:"w-5 h-5 text-purple-500"}),desc:"Входы возможны от $5–10."}].map((i,o)=>t.jsxs("div",{className:`p-5 rounded-2xl border ${s==="dark"?"bg-white/5 border-white/5":"bg-white border-gray-100"} shadow-sm`,children:[t.jsx("div",{className:"mb-3",children:i.icon}),t.jsx("h4",{className:"font-bold text-sm mb-1",children:i.title}),t.jsx("p",{className:"text-xs text-gray-500 leading-relaxed",children:i.desc})]},o))}),t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[t.jsxs("div",{className:`rounded-2xl p-6 border-l-8 ${s==="dark"?"bg-[#0b1015] border-orange-500/50":"bg-gray-50 border-orange-500/30"} flex gap-4 items-start`,children:[t.jsx(H0,{className:"w-8 h-8 text-orange-500 shrink-0"}),t.jsxs("div",{className:"space-y-2",children:[t.jsx("h4",{className:`text-lg font-black ${n}`,children:"Суть стратегии"}),t.jsx("p",{className:`text-xs leading-relaxed ${s==="dark"?"text-gray-300":"text-gray-600"}`,children:"Это не про угадывание, это рабочая рутина. Результат достигается анализом, а не спешкой. Один пропущенный красный флаг перечеркивает серию прибыльных сделок. Если токен требует оправданий — он не торгуется."})]})]}),t.jsxs("div",{className:`rounded-2xl p-6 border ${s==="dark"?"bg-blue-500/5 border-blue-500/20":"bg-blue-50 border-blue-500/20"} flex gap-4 items-start`,children:[t.jsx(Bn,{className:"w-8 h-8 text-blue-500 shrink-0"}),t.jsxs("div",{className:"space-y-2",children:[t.jsx("h4",{className:`text-lg font-black ${n}`,children:"Кому подходит?"}),t.jsx("p",{className:`text-xs leading-relaxed ${s==="dark"?"text-gray-300":"text-gray-600"}`,children:"Трейдерам, ценящим структуру и понятные правила. Новичкам с небольшим депо и опытным филлерам, желающим диверсифицировать стиль через 15–60 минут после старта токена."})]})]})]}),t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[t.jsxs("div",{className:"lg:col-span-2 space-y-4",children:[t.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[t.jsx($c,{className:`w-6 h-6 ${s==="dark"?"text-orange-400":"text-orange-500"}`}),t.jsx("h3",{className:`text-xl font-black ${n}`,children:"Алгоритм работы"})]}),t.jsxs(Aa,{number:1,title:"Поиск свежих токенов",icon:t.jsx(es,{className:"w-5 h-5"}),isOpen:e===1,onToggle:()=>a(1),children:[t.jsx("p",{className:"text-sm font-medium mb-2",children:"Отбор на самой ранней стадии свободы:"}),t.jsxs("ul",{className:"space-y-2 text-sm list-disc list-inside pl-2",children:[t.jsxs("li",{children:["Открываем ",t.jsx("strong",{children:"GMGN"})," или ",t.jsx("strong",{children:"Axiom"})]}),t.jsxs("li",{children:["Вкладка ",t.jsx("strong",{children:"Migrated"})," (с Launchpad в торговлю)"]}),t.jsx("li",{children:"Фильтруем по интересующим Launchpad’ам"}),t.jsxs("li",{children:["Возраст токена: ",t.jsx("strong",{children:"1 – 60 минут"})]}),t.jsx("li",{className:"text-orange-400 font-bold",children:"Токены старше 1 часа — исключаются."})]})]}),t.jsx(Aa,{number:2,title:"Скрининг базовых метрик",icon:t.jsx(rr,{className:"w-5 h-5"}),isOpen:e===2,onToggle:()=>a(2),children:t.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[t.jsxs("div",{className:`p-4 rounded-xl border ${s==="dark"?"bg-white/5 border-white/10":"bg-gray-50 border-gray-200"}`,children:[t.jsx("p",{className:"text-[10px] font-bold uppercase tracking-wider text-gray-500 mb-1",children:"Market Cap"}),t.jsx("p",{className:`text-lg font-black ${n}`,children:"50k - 100k USD"}),t.jsxs("p",{className:"text-[10px] text-orange-400 font-medium",children:[">","100k — риск перегретости"]})]}),t.jsxs("div",{className:`p-4 rounded-xl border ${s==="dark"?"bg-white/5 border-white/10":"bg-gray-50 border-gray-200"}`,children:[t.jsx("p",{className:"text-[10px] font-bold uppercase tracking-wider text-gray-500 mb-1",children:"Объёмы"}),t.jsx("p",{className:`text-lg font-black ${n}`,children:"Активные"}),t.jsx("p",{className:"text-[10px] text-emerald-500 font-medium",children:"Рост в 2-4 раза за короткий период"})]}),t.jsxs("div",{className:`p-4 rounded-xl border ${s==="dark"?"bg-white/5 border-white/10":"bg-gray-50 border-gray-200"}`,children:[t.jsx("p",{className:"text-[10px] font-bold uppercase tracking-wider text-gray-500 mb-1",children:"Холдеры"}),t.jsx("p",{className:`text-lg font-black ${n}`,children:"+300 / 40м"}),t.jsx("p",{className:"text-[10px] text-emerald-500 font-medium",children:"Минимум +300 за 30-40 мин"})]})]})}),t.jsx(Aa,{number:3,title:"Проверка нарратива и социального фона",icon:t.jsx(Yl,{className:"w-5 h-5"}),isOpen:e===3,onToggle:()=>a(3),children:t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"flex gap-4",children:[t.jsx("div",{className:`p-3 rounded-xl ${s==="dark"?"bg-white/5":"bg-gray-50"}`,children:t.jsx(Yl,{className:"w-5 h-5 text-sky-400"})}),t.jsxs("div",{className:"flex-1",children:[t.jsx("h4",{className:"font-bold text-sm",children:"Анализ Twitter / X"}),t.jsx("p",{className:"text-xs text-gray-500 leading-relaxed",children:"Наличие свежих постов, комментарии, репосты, поддержка со стороны реальных коллеров."})]})]}),t.jsxs("div",{className:"flex gap-4",children:[t.jsx("div",{className:`p-3 rounded-xl ${s==="dark"?"bg-white/5":"bg-gray-50"}`,children:t.jsx(em,{className:"w-5 h-5 text-blue-400"})}),t.jsxs("div",{className:"flex-1",children:[t.jsx("h4",{className:"font-bold text-sm",children:"Telegram-группа"}),t.jsx("p",{className:"text-xs text-gray-500 leading-relaxed",children:"Активность админ-состава, живое обсуждение, отсутствие явной бот-активности."})]})]})]})}),t.jsx(Aa,{number:4,title:"Техническая оценка графика",icon:t.jsx(Vr,{className:"w-5 h-5"}),isOpen:e===4,onToggle:()=>a(4),children:t.jsxs("ul",{className:"space-y-3 text-sm list-disc list-inside pl-2",children:[t.jsx("li",{children:'Органичное движение: плавный рост, отсутствие "одной ракеты" (свеча 200%+).'}),t.jsxs("li",{children:["Сравнение объёмов на ",t.jsx("strong",{children:"1m TF"})," за последние 10–15 минут."]}),t.jsx("li",{className:"text-rose-400 font-bold p-3 rounded-xl bg-rose-400/5 border border-rose-400/20 list-none",children:"КРИТИЧЕСКИЙ СИГНАЛ: Если объёмы падают (напр. с 5k до 500), активность затухает — вход запрещён."})]})}),t.jsx(Aa,{number:5,title:"Уровни Фибоначчи + Структура",icon:t.jsx(U0,{className:"w-5 h-5"}),isOpen:e===5,onToggle:()=>a(5),children:t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:`p-4 rounded-xl border border-l-4 border-orange-500/50 ${s==="dark"?"bg-orange-500/5":"bg-orange-50"}`,children:[t.jsx("p",{className:"text-sm font-bold text-orange-500 uppercase tracking-widest mb-1",children:"Правило входа"}),t.jsx("p",{className:"text-sm",children:"Вход только на подтверждённом откате. Вход в растущий график ЗАПРЕЩЁН."})]}),t.jsx("p",{className:"text-sm font-medium",children:"Тянем Фибу от начала импульса до хая. Ключевые уровни входа:"}),t.jsx("div",{className:"flex flex-wrap gap-2",children:["0.5","0.618","0.786"].map(i=>t.jsx("div",{className:`px-4 py-2 rounded-lg border font-black text-sm ${s==="dark"?"bg-white/5 border-white/10 text-orange-400":"bg-orange-50 border-orange-200 text-orange-600"}`,children:i},i))}),t.jsx("p",{className:"text-xs text-gray-500",children:"Приоритет — совпадение уровня с локальной поддержкой или проторговкой."})]})}),t.jsx(Aa,{number:6,title:"Контроль позиции и выход",icon:t.jsx(mf,{className:"w-5 h-5"}),isOpen:e===6,onToggle:()=>a(6),children:t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[t.jsxs("div",{className:`p-4 rounded-xl border ${s==="dark"?"bg-emerald-500/5 border-emerald-500/20":"bg-emerald-50 border-emerald-500/20"}`,children:[t.jsx("h5",{className:"text-xs font-bold text-emerald-500 uppercase tracking-widest mb-2",children:"Цели (TP)"}),t.jsx("p",{className:"text-lg font-black ${headingColor}",children:"20% – 70%"}),t.jsx("p",{className:"text-[10px] text-gray-500",children:"Основная прибыль в этом диапазоне, остаток по ситуации."})]}),t.jsxs("div",{className:`p-4 rounded-xl border ${s==="dark"?"bg-rose-500/5 border-rose-500/20":"bg-rose-50 border-rose-500/20"}`,children:[t.jsx("h5",{className:"text-xs font-bold text-rose-500 uppercase tracking-widest mb-2",children:"Сигнал Выхода"}),t.jsx("p",{className:"text-sm font-bold",children:"Деградация объёмов"}),t.jsx("p",{className:"text-[10px] text-gray-500",children:"Резкое снижение активности или ончейн-фиксация."})]})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx("p",{className:"text-sm font-bold uppercase tracking-widest opacity-50",children:"В процессе удержания:"}),t.jsxs("ul",{className:"text-xs space-y-2 list-disc list-inside text-gray-500",children:[t.jsx("li",{children:"Мониторинг X: прекращение активности = сигнал слабости."}),t.jsx("li",{children:"Ончейн: проверка фиксации прибыли топ-холдерами."}),t.jsx("li",{children:"Никаких пересиживаний минуса: стратегия не терпит ухудшения условий."})]})]})]})})]}),t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:`rounded-2xl p-6 border ${s==="dark"?"bg-rose-500/5 border-rose-500/20":"bg-rose-50 border-rose-500/20"} shadow-lg space-y-4`,children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(Os,{className:"w-6 h-6 text-rose-500"}),t.jsx("h3",{className:`text-lg font-black ${n}`,children:"Красные флаги"})]}),t.jsx("p",{className:"text-[10px] text-rose-400 uppercase font-black tracking-widest",children:"Автоматический отказ от сделки"}),t.jsx("div",{className:"space-y-3",children:[{label:"График",val:"Ракета 200%+ или пробой всех уровней Фибо одной свечой вниз."},{label:"Объём",val:"Резкое падение (напр. 40k → 3k за 10 мин)."},{label:"Ликвидность",val:"Объёмы значительно меньше капитализации (Cap 1M — Vol 100k)."},{label:"Холдеры",val:"Один холдер > 2%, бандлы > 30 SOL, или Top-10 > 20%."},{label:"PNL Холдеров",val:"Большинство уже сидит на x5+ при капе < 100k."},{label:"DEV",val:"Запускает 3–5 токенов в сутки без миграции."}].map((i,o)=>t.jsxs("div",{className:"space-y-1 pb-2 border-b border-rose-500/10 last:border-0",children:[t.jsx("p",{className:"text-[9px] font-black text-rose-500/70 uppercase",children:i.label}),t.jsx("p",{className:"text-xs font-medium text-gray-500 leading-tight",children:i.val})]},o))})]}),t.jsxs("div",{className:`rounded-2xl p-6 border ${s==="dark"?"bg-amber-500/5 border-amber-500/20":"bg-amber-50 border-amber-500/20"} shadow-lg space-y-4`,children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(nr,{className:"w-6 h-6 text-amber-500"}),t.jsx("h3",{className:`text-lg font-black ${n}`,children:"Жёлтые флаги"})]}),t.jsx("p",{className:"text-[10px] text-amber-500 uppercase font-black tracking-widest",children:"Требуют осторожности"}),t.jsxs("div",{className:"space-y-3 text-xs text-gray-500",children:[t.jsxs("p",{children:[t.jsx("span",{className:"font-bold text-amber-500",children:"Бандлы 100–200 SOL:"})," Оценить, плавно ли команда ведёт график."]}),t.jsxs("p",{children:[t.jsx("span",{className:"font-bold text-amber-500",children:"Нет ссылки на X:"})," Требуется ручной поиск. Если нарратив не читается — отказ."]}),t.jsxs("p",{children:[t.jsx("span",{className:"font-bold text-amber-500",children:"Слабый нарратив:"})," Если идея не вызывает интереса, лучше переключиться."]})]})]}),t.jsxs("div",{className:`rounded-2xl p-6 border ${s==="dark"?"bg-white/5 border-white/5":"bg-white border-gray-100"} shadow-lg space-y-4`,children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(Rf,{className:"w-6 h-6 text-gray-500"}),t.jsx("h3",{className:`text-lg font-black ${n}`,children:"Типичные ошибки"})]}),t.jsxs("ul",{className:"space-y-2 text-xs text-gray-500 list-disc list-inside",children:[t.jsx("li",{children:"Вход в ракету вместо отката."}),t.jsx("li",{children:'Игнорирование падения объёмов "в надежде".'}),t.jsx("li",{children:"Заход при перегруженном распределении."}),t.jsx("li",{children:'Оправдание плохих метрик "сильным графиком".'}),t.jsx("li",{children:'Попытка "досидеть", когда сетап уже сломан.'})]})]})]})]})]})},Ca=({number:s,title:e,children:r,icon:a,isOpen:n,onToggle:i})=>{const{theme:o}=Re();return t.jsxs("div",{className:`overflow-hidden rounded-2xl border transition-all duration-300 ${o==="dark"?"bg-[#1a212a]/50 border-white/5 shadow-inner":"bg-white border-gray-100 shadow-sm"}`,children:[t.jsxs("button",{onClick:i,className:"w-full flex items-center justify-between p-5 text-left transition-colors hover:bg-white/5",children:[t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsx("div",{className:`flex items-center justify-center w-10 h-10 rounded-xl font-black text-lg ${o==="dark"?"bg-emerald-500/20 text-emerald-400":"bg-emerald-50 text-emerald-600"}`,children:s}),t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:o==="dark"?"text-gray-300":"text-gray-600",children:a}),t.jsx("h3",{className:`text-lg font-bold ${o==="dark"?"text-white":"text-gray-900"}`,children:e})]})]}),n?t.jsx(ti,{className:"w-5 h-5 text-gray-500"}):t.jsx(Dr,{className:"w-5 h-5 text-gray-500"})]}),n&&t.jsx("div",{className:`p-6 pt-0 border-t ${o==="dark"?"border-white/5":"border-gray-50"}`,children:t.jsx("div",{className:`mt-4 space-y-4 ${o==="dark"?"text-gray-300":"text-gray-600"}`,children:r})})]})},R4=()=>{const{theme:s}=Re(),[e,r]=k.useState(1),a=i=>{r(e===i?null:i)},n=s==="dark"?"text-white":"text-gray-900";return t.jsxs("div",{className:"space-y-12 animate-fade-in",children:[t.jsxs("div",{className:`relative overflow-hidden rounded-3xl p-8 border ${s==="dark"?"bg-gradient-to-br from-[#151a21] to-[#0b1015] border-emerald-500/20 shadow-2xl":"bg-gradient-to-br from-white to-emerald-50/30 border-emerald-500/10 shadow-xl"}`,children:[t.jsx("div",{className:"absolute top-0 right-0 w-64 h-64 bg-emerald-500/5 blur-3xl rounded-full -mr-20 -mt-20 pointer-events-none"}),t.jsxs("div",{className:"relative flex flex-col md:flex-row gap-8 items-start",children:[t.jsx("div",{className:`p-4 rounded-2xl ${s==="dark"?"bg-emerald-500/10":"bg-emerald-500/5"}`,children:t.jsx(an,{className:"w-12 h-12 text-emerald-500"})}),t.jsxs("div",{className:"flex-1 space-y-4",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("h2",{className:`text-2xl md:text-3xl font-black ${n}`,children:"AVF FLIP-1S"}),t.jsx("span",{className:"px-3 py-1 rounded-full bg-emerald-500/20 text-emerald-400 text-[10px] font-black uppercase tracking-widest border border-emerald-500/20",children:"Scalping"})]}),t.jsx("p",{className:`text-lg leading-relaxed ${s==="dark"?"text-gray-300":"text-gray-600"}`,children:"Flip на секундном таймфрейме — это сверхбыстрая стратегия скальпинга, заточенная под мгновенный откуп резких просадок на графике."}),t.jsxs("p",{className:`text-sm opacity-80 ${s==="dark"?"text-gray-300":"text-gray-600"}`,children:["Цель — не угадать рост токена, а активно отработать момент сильного падения, которое с высокой вероятностью откупается. Сделки длятся ",t.jsx("strong",{children:"от 1 до 5 секунд"}),"."]})]})]})]}),t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[t.jsxs("div",{className:`rounded-2xl p-6 border-l-8 ${s==="dark"?"bg-[#0b1015] border-emerald-500/50":"bg-gray-50 border-emerald-500/30"} flex gap-4 items-start`,children:[t.jsx(Ms,{className:"w-8 h-8 text-emerald-500 shrink-0"}),t.jsxs("div",{className:"space-y-2",children:[t.jsx("h4",{className:`text-lg font-black ${n}`,children:"Почему это работает?"}),t.jsx("p",{className:`text-xs leading-relaxed ${s==="dark"?"text-gray-300":"text-gray-600"}`,children:"Большинство трейдеров используют медленные источники (DexScreener/DexTool), которые отстают на 5-7 секунд. Резкие сливы (10-20% эмиссии) создают глубокие просадки, видимые только в быстрых терминалах (GMGN, Alpha One, Fasol)."})]})]}),t.jsxs("div",{className:`rounded-2xl p-6 border ${s==="dark"?"bg-blue-500/5 border-blue-500/20":"bg-blue-50 border-blue-500/20"} flex gap-4 items-start`,children:[t.jsx(X0,{className:"w-8 h-8 text-blue-500 shrink-0"}),t.jsxs("div",{className:"space-y-2",children:[t.jsx("h4",{className:`text-lg font-black ${n}`,children:"Кому подходит?"}),t.jsxs("p",{className:`text-xs leading-relaxed ${s==="dark"?"text-gray-300":"text-gray-600"}`,children:["Любому трейдеру, готовому тренировать внимание и дисциплину. Работает на любом депозите, но идеальный старт — ",t.jsx("strong",{children:"от 50 долларов"}),". Важен только импульс и откуп в моменте."]})]})]})]}),t.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[{title:"Освоение",desc:"От 1 недели до месяца. Не сравнивайте свой путь с чужим.",icon:t.jsx(Lr,{className:"w-5 h-5 text-purple-500"})},{title:"Потенциал",icon:t.jsx(it,{className:"w-5 h-5 text-blue-500"}),desc:"Возможен выход на $1000/день через месяц практики."},{title:"Тайминг",icon:t.jsx(Lt,{className:"w-5 h-5 text-amber-500"}),desc:"Сделки 1-5 сек. Важна концентрация, а не глубокий ресерч."}].map((i,o)=>t.jsxs("div",{className:`p-5 rounded-2xl border ${s==="dark"?"bg-white/5 border-white/5":"bg-white border-gray-100"} shadow-sm`,children:[t.jsx("div",{className:"mb-3",children:i.icon}),t.jsx("h4",{className:"font-bold text-sm mb-1",children:i.title}),t.jsx("p",{className:"text-xs text-gray-500 leading-relaxed",children:i.desc})]},o))}),t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[t.jsxs("div",{className:"lg:col-span-2 space-y-4",children:[t.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[t.jsx($c,{className:`w-6 h-6 ${s==="dark"?"text-emerald-400":"text-emerald-500"}`}),t.jsx("h3",{className:`text-xl font-black ${n}`,children:"Где искать и что делать"})]}),t.jsx(Ca,{number:1,title:"Где искать токены?",icon:t.jsx(es,{className:"w-5 h-5"}),isOpen:e===1,onToggle:()=>a(1),children:t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[t.jsxs("div",{className:`p-4 rounded-xl border ${s==="dark"?"bg-white/5 border-white/10":"bg-gray-50 border-gray-200"}`,children:[t.jsx("h5",{className:"text-xs font-bold uppercase mb-2 text-emerald-500",children:"Миграции Axiom"}),t.jsx("p",{className:"text-xs text-gray-500 leading-relaxed",children:"Jupiter Studio, Believe, Moonshot. Главное — открыть график до просадки."})]}),t.jsxs("div",{className:`p-4 rounded-xl border ${s==="dark"?"bg-white/5 border-white/10":"bg-gray-50 border-gray-200"}`,children:[t.jsx("h5",{className:"text-xs font-bold uppercase mb-2 text-blue-500",children:"Photon (Тренды)"}),t.jsx("p",{className:"text-xs text-gray-500 leading-relaxed",children:"Вкладка тренды, режим 1м/5м. Сортировка по объёму для поиска резкой активности."})]})]}),t.jsxs("div",{className:`p-4 rounded-xl border border-l-4 border-amber-500/50 ${s==="dark"?"bg-amber-500/5":"bg-amber-50"}`,children:[t.jsx("p",{className:"text-xs font-bold uppercase mb-1",children:"Признаки нужного токена:"}),t.jsxs("ul",{className:"text-xs space-y-1 list-disc list-inside text-gray-600",children:[t.jsx("li",{children:"Зелёные свечи подряд"}),t.jsxs("li",{children:["Объём за 5 минут: ",t.jsx("strong",{children:"$50,000+"})]}),t.jsx("li",{children:"Резкий взлет цены (памп)"})]})]})]})}),t.jsxs(Ca,{number:2,title:"Какой график и токен нужен?",icon:t.jsx(Vr,{className:"w-5 h-5"}),isOpen:e===2,onToggle:()=>a(2),children:[t.jsx("div",{className:"flex flex-wrap gap-2 mb-4",children:["Секундный TF","Высокая волатильность","Просадка > 20%","Откуп 1-3 сек"].map(i=>t.jsx("span",{className:`px-3 py-1 rounded-lg border text-[10px] font-bold ${s==="dark"?"bg-white/5 border-white/10":"bg-gray-50 border-gray-200"}`,children:i},i))}),t.jsx("p",{className:"text-sm",children:"Если таких признаков нет — токен не подходит для FLIP-1S."})]}),t.jsx(Ca,{number:3,title:"Сигналы на вход",icon:t.jsx(Ar,{className:"w-5 h-5"}),isOpen:e===3,onToggle:()=>a(3),children:t.jsxs("div",{className:`p-4 rounded-xl border border-l-4 border-emerald-500/50 ${s==="dark"?"bg-emerald-500/5":"bg-emerald-50"}`,children:[t.jsx("p",{className:"text-sm font-bold uppercase mb-2 tracking-widest text-emerald-500",children:"Резкая просадка"}),t.jsxs("p",{className:"text-sm",children:["Трейд работает только при падении на ",t.jsx("strong",{children:"20% за 1-2 секунды"}),". Заходим, когда свеча падает или на мгновенном начале отскока."]})]})}),t.jsx(Ca,{number:4,title:"Идеальный вход",icon:t.jsx(rr,{className:"w-5 h-5"}),isOpen:e===4,onToggle:()=>a(4),children:t.jsxs("div",{className:"space-y-3",children:[t.jsx("p",{className:"text-sm font-medium",children:"Последовательность успеха:"}),t.jsx("div",{className:"flex flex-col gap-2",children:["Токен только вылетел в миграции","Появился всплеск объёма","График улетает вверх","Резкая просадка (1-2 сек)","Сильный откуп (1-3 сек)"].map((i,o)=>t.jsxs("div",{className:"flex items-center gap-3 text-xs",children:[t.jsx("div",{className:"w-5 h-5 rounded-full bg-emerald-500/20 text-emerald-500 flex items-center justify-center font-bold text-[10px]",children:o+1}),i]},o))}),t.jsx("p",{className:"text-xs text-emerald-500 font-bold mt-2",children:"Важно: Купить на просадке, а не после того, как график уже вернулся на хай."})]})}),t.jsx(Ca,{number:5,title:"Когда НЕ заходить?",icon:t.jsx(rm,{className:"w-5 h-5"}),isOpen:e===5,onToggle:()=>a(5),children:t.jsxs("ul",{className:"space-y-2 text-sm text-gray-500",children:[t.jsxs("li",{className:"flex gap-2",children:["❌ ",t.jsx("span",{children:"Момент пропущен и токен уже откупился."})]}),t.jsxs("li",{className:"flex gap-2",children:["❌ ",t.jsx("span",{children:"Просадка плавная, а не резкая."})]}),t.jsxs("li",{className:"flex gap-2",children:["❌ ",t.jsxs("span",{children:["Токен упал на ",t.jsx("strong",{children:"-50%"})," от хая (затяжной слив)."]})]}),t.jsxs("li",{className:"flex gap-2",children:["❌ ",t.jsx("span",{children:"Нет откупа за 2-3 секунды — выход в ноль/минус."})]})]})}),t.jsx(Ca,{number:6,title:"Аномальные просадки (Advanced)",icon:t.jsx(nr,{className:"w-5 h-5"}),isOpen:e===6,onToggle:()=>a(6),children:t.jsxs("div",{className:`p-4 rounded-xl border border-dashed ${s==="dark"?"border-orange-500/30":"border-orange-500/20"}`,children:[t.jsx("p",{className:"text-xs italic text-gray-500 mb-3",children:"Только для профи. Сделки до 15-20 секунд при падении с 200к до 20к."}),t.jsxs("ul",{className:"text-xs space-y-1 list-disc list-inside text-gray-600",children:[t.jsx("li",{children:"Нормальный DEV (не скам)"}),t.jsx("li",{children:"Просадка 80-90%"}),t.jsx("li",{children:"Ликвидность не убита"})]})]})})]}),t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:`rounded-2xl p-6 border ${s==="dark"?"bg-[#151a21]/80 border-white/5":"bg-white border-gray-100"} shadow-lg space-y-4`,children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(Wt,{className:"w-6 h-6 text-blue-500"}),t.jsx("h3",{className:`text-lg font-black ${n}`,children:"Экспресс-чек"})]}),t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{className:"space-y-1 pb-2 border-b border-white/5",children:[t.jsx("p",{className:"text-[9px] font-black text-blue-500 uppercase tracking-widest",children:"Объёмы"}),t.jsx("p",{className:"text-xs text-gray-500",children:"За 5 мин — $50,000+. Серия зелёных свечей вверх."})]}),t.jsxs("div",{className:"space-y-1 pb-2 border-b border-white/5",children:[t.jsx("p",{className:"text-[9px] font-black text-blue-500 uppercase tracking-widest",children:"Метрики"}),t.jsxs("p",{className:"text-xs text-gray-500",children:["DEV ","<"," 2%. Тор-10 холдеров ","<"," 50%. Ликвидность ",">"," $20k."]})]}),t.jsxs("div",{className:"space-y-1 pb-2 border-b border-white/5",children:[t.jsx("p",{className:"text-[9px] font-black text-blue-500 uppercase tracking-widest",children:"Позиция"}),t.jsxs("p",{className:"text-xs text-gray-500",children:["Вход ","<"," 1% от ликвидности. Макс 30% депозита."]})]})]})]}),t.jsxs("div",{className:`rounded-2xl p-6 border ${s==="dark"?"bg-rose-500/5 border-rose-500/20":"bg-rose-50 border-rose-500/20"} shadow-lg space-y-4`,children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(Os,{className:"w-6 h-6 text-rose-500"}),t.jsx("h3",{className:`text-lg font-black ${n}`,children:"Типовые ошибки"})]}),t.jsxs("div",{className:"space-y-4 text-xs text-gray-500",children:[t.jsxs("div",{children:[t.jsx("p",{className:"font-bold text-rose-500",children:"Вход после откупа"}),t.jsx("p",{className:"leading-relaxed",children:"Заход на росте приводит к потере на следующем сливе. Жди только дна."})]}),t.jsxs("div",{children:[t.jsx("p",{className:"font-bold text-rose-500",children:"Засаживание (Hope)"}),t.jsx("p",{className:"leading-relaxed",children:"Надежда на отскок более 2-3 секунд. Не откупилось — выходи сразу."})]}),t.jsxs("div",{children:[t.jsx("p",{className:"font-bold text-rose-500",children:"Тильт-усреднение"}),t.jsx("p",{className:"leading-relaxed",children:"Попытка отбиться после минуса через увеличение позы. Стоп после -30%."})]})]})]}),t.jsxs("div",{className:`p-6 rounded-2xl border-2 border-dashed ${s==="dark"?"border-orange-500/30":"border-orange-500/20"} space-y-4`,children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(Bn,{className:"w-5 h-5 text-orange-500"}),t.jsx("h4",{className:"font-bold text-sm",children:"Дисциплина рисков"})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{className:"space-y-1",children:[t.jsx("p",{className:"text-[10px] text-gray-500 font-bold",children:"СТОП СЕССИИ"}),t.jsx("p",{className:"text-xs font-black text-rose-500",children:"-30% (Пауза 2ч)"})]}),t.jsxs("div",{className:"space-y-1",children:[t.jsx("p",{className:"text-[10px] text-gray-500 font-bold",children:"СТОП ДНЯ"}),t.jsx("p",{className:"text-xs font-black text-rose-500",children:"-50% (Отдых)"})]})]})]})]})]}),t.jsx("div",{className:`rounded-2xl p-6 border-l-8 ${s==="dark"?"bg-[#0b1015] border-emerald-500/50":"bg-gray-50 border-emerald-500/30"}`,children:t.jsxs("div",{className:"flex gap-4 items-start",children:[t.jsx(H0,{className:"w-8 h-8 text-emerald-500 shrink-0"}),t.jsxs("div",{className:"space-y-2",children:[t.jsx("h4",{className:`text-lg font-black ${n}`,children:"Финальное напутствие"}),t.jsx("p",{className:`text-sm leading-relaxed ${s==="dark"?"text-gray-300":"text-gray-600"}`,children:"FLIP-1S требует максимального спокойствия. Это механический процесс откупа неэффективности рынка. Если вы успеваете реагировать быстрее, чем DexScreener отображает свечу — вы уже в прибыли. Не торопите прогресс, результат придет через сотни микро-сделок."})]})]})})]})},P4=()=>{const{theme:s}=Re(),[e,r]=k.useState("late-volume"),a=s==="dark"?"text-white":"text-gray-900",n=[{title:"Психология",icon:t.jsx(Du,{className:"w-5 h-5 text-purple-400"}),desc:"Управление эмоциями и FOMO"},{title:"Интрадей-торговля",icon:t.jsx(Ar,{className:"w-5 h-5 text-amber-400"}),desc:"Быстрые сделки внутри дня"},{title:"Среднесрок и геймхантинг",icon:t.jsx(Lt,{className:"w-5 h-5 text-blue-400"}),desc:"Поиск долгосрочных нарративов"},{title:"Флип",icon:t.jsx(qf,{className:"w-5 h-5 text-emerald-400"}),desc:"Стратегии быстрого перезахода"},{title:"Фибоначчи",icon:t.jsx(yl,{className:"w-5 h-5 text-rose-400"}),desc:"Технический анализ уровней"},{title:"Нарративы",icon:t.jsx(Y0,{className:"w-5 h-5 text-sky-400"}),desc:"Анализ рыночных трендов"},{title:"Ончейн-анализ",icon:t.jsx(es,{className:"w-5 h-5 text-indigo-400"}),desc:"Отслеживание кошельков и китов"}],i=[{id:"late-volume",name:"AVF Late Volume",icon:t.jsx(yl,{className:"w-4 h-4"})},{id:"intraday",name:"AVF Intraday",icon:t.jsx(Ar,{className:"w-4 h-4"})},{id:"flip",name:"AVF FLIP-1S",icon:t.jsx(an,{className:"w-4 h-4"})}];return t.jsxs("div",{className:"space-y-16 pb-20",children:[t.jsxs("section",{className:"space-y-6",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"p-2 bg-purple-500/10 rounded-xl border border-purple-500/20",children:t.jsx(Fs,{className:"w-6 h-6 text-purple-500"})}),t.jsxs("div",{children:[t.jsx("h3",{className:`text-xl font-black ${a}`,children:"Уроки"}),t.jsx("p",{className:`text-sm ${s==="dark"?"text-gray-400":"text-gray-500"}`,children:"Образовательная база для работы с мемкоинами"})]})]}),t.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4",children:n.map((o,c)=>t.jsxs("div",{className:`group p-5 rounded-2xl border transition-all duration-300 hover:shadow-lg ${s==="dark"?"bg-[#151a21]/50 border-white/5 hover:border-purple-500/30":"bg-white border-gray-100 hover:border-purple-500/20"}`,children:[t.jsx("div",{className:`p-2.5 rounded-xl w-fit mb-4 ${s==="dark"?"bg-white/5":"bg-gray-50"} group-hover:scale-110 transition-transform`,children:o.icon}),t.jsx("h4",{className:`font-bold mb-1 ${a}`,children:o.title}),t.jsx("p",{className:"text-xs text-gray-500 line-clamp-2",children:o.desc})]},c))})]}),t.jsxs("section",{className:"space-y-6",children:[t.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"p-2 bg-blue-500/10 rounded-xl border border-blue-500/20",children:t.jsx(Q0,{className:"w-6 h-6 text-blue-500"})}),t.jsxs("div",{children:[t.jsx("h3",{className:`text-xl font-black ${a}`,children:"Стратегии"}),t.jsx("p",{className:`text-sm ${s==="dark"?"text-gray-400":"text-gray-500"}`,children:"Проверенные методики отбора и управления позициями"})]})]}),t.jsx("div",{className:`flex p-1 rounded-xl w-fit ${s==="dark"?"bg-white/5 border border-white/5":"bg-gray-100"}`,children:i.map(o=>t.jsxs("button",{onClick:()=>r(o.id),className:`flex items-center gap-2 px-4 py-2 rounded-lg text-xs font-bold transition-all duration-300 ${e===o.id?"bg-blue-500 text-white shadow-md":"text-gray-500 hover:text-gray-400"}`,children:[o.icon,o.name]},o.id))})]}),t.jsx("div",{className:`rounded-3xl border p-1 sm:p-2 ${s==="dark"?"bg-[#0b1015]/50 border-white/5":"bg-white border-gray-100"} shadow-xl`,children:t.jsx("div",{className:`p-6 sm:p-8 rounded-[2.5rem] ${s==="dark"?"bg-[#151a21]/50":"bg-gray-50/50"}`,children:e==="late-volume"?t.jsx(D4,{}):e==="intraday"?t.jsx($4,{}):t.jsx(R4,{})})})]}),t.jsxs("section",{className:"space-y-6",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"p-2 bg-amber-500/10 rounded-xl border border-amber-500/20",children:t.jsx(tb,{className:"w-6 h-6 text-amber-500"})}),t.jsxs("div",{children:[t.jsx("h3",{className:`text-xl font-black ${a}`,children:"Инструменты"}),t.jsx("p",{className:`text-sm ${s==="dark"?"text-gray-400":"text-gray-500"}`,children:"Вспомогательные сервисы и скрипты"})]})]}),t.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4",children:[{name:"Sniper",url:"https://www.sniper.xyz",desc:"Терминал с демо-торговлей для отработки навыков",icon:t.jsx(Yf,{className:"w-5 h-5 text-green-400"})},{name:"Axiom",url:"https://axiom.trade",desc:"Профессиональный терминал для анализа и выбора монет",icon:t.jsx(yl,{className:"w-5 h-5 text-blue-400"})},{name:"GMGN",url:"https://gmgn.ai",desc:"Профессиональный терминал для анализа и выбора монет",icon:t.jsx(Ar,{className:"w-5 h-5 text-yellow-400"})},{name:"DexScreener",url:"https://dexscreener.com",desc:"Мониторинг графиков и поиск новых пар",icon:t.jsx(Pf,{className:"w-5 h-5 text-slate-400"})},{name:"Alpha One",url:"https://t.me/alpha_web3_bot",desc:"ТГ-терминал с сигналами и AI-агентом",icon:t.jsx(xf,{className:"w-5 h-5 text-purple-400"})},{name:"Fasol",url:"https://t.me/Fasol_robot",desc:"Торговый бот с гибкими алертами",icon:t.jsx(F0,{className:"w-5 h-5 text-red-400"})},{name:"Solscan",url:"https://solscan.io",desc:"Эксплорер блокчейна Solana",icon:t.jsx(es,{className:"w-5 h-5 text-teal-400"})},{name:"Etherscan",url:"https://etherscan.io",desc:"Эксплорер блокчейна Ethereum",icon:t.jsx(Wl,{className:"w-5 h-5 text-indigo-400"})},{name:"BscScan",url:"https://bscscan.com",desc:"Эксплорер блокчейна BSC",icon:t.jsx(Wl,{className:"w-5 h-5 text-yellow-500"})},{name:"Bubblemaps",url:"https://bubblemaps.io",desc:"Визуализация связей кошельков",icon:t.jsx(Hf,{className:"w-5 h-5 text-pink-400"})},{name:"Frontrun",url:"https://chromewebstore.google.com/detail/frontrun/kifcalgkjaphbpbcgokommchjiimejah",desc:"Анализ кошельков и защита от фронтрана",icon:t.jsx(Bn,{className:"w-5 h-5 text-orange-400"})},{name:"Nansen",url:"https://www.nansen.ai",desc:"Smart Money и глубокая аналитика",icon:t.jsx(Du,{className:"w-5 h-5 text-cyan-400"})},{name:"HolderScan",url:"https://holderscan.com",desc:"Анализ холдеров и кластеров",icon:t.jsx(Gt,{className:"w-5 h-5 text-emerald-400"})},{name:"RugCheck",url:"https://rugcheck.xyz",desc:"Проверка токенов на безопасность",icon:t.jsx(Hs,{className:"w-5 h-5 text-red-500"})},{name:"SolSniffer",url:"https://www.solsniffer.com",desc:"Сниффер новых токенов Solana",icon:t.jsx(Ms,{className:"w-5 h-5 text-violet-400"})},{name:"KolScan",url:"https://kolscan.io",desc:"Трекинг KOL-ов и инфлюенсеров",icon:t.jsx(it,{className:"w-5 h-5 text-fuchsia-400"})}].map((o,c)=>t.jsxs("a",{href:o.url,target:"_blank",rel:"noopener noreferrer",className:`group relative p-5 rounded-2xl border transition-all duration-300 hover:shadow-lg ${s==="dark"?"bg-[#151a21]/50 border-white/5 hover:border-blue-500/30":"bg-white border-gray-100 hover:border-blue-500/20"}`,children:[t.jsx("div",{className:"absolute top-4 right-4 opacity-0 group-hover:opacity-100 transition-opacity",children:t.jsx(q0,{className:`w-4 h-4 ${s==="dark"?"text-gray-400":"text-gray-500"}`})}),t.jsx("div",{className:`p-2.5 rounded-xl w-fit mb-4 ${s==="dark"?"bg-white/5":"bg-gray-50"} group-hover:scale-110 transition-transform`,children:o.icon}),t.jsx("h4",{className:`font-bold mb-1 ${a} flex items-center gap-2`,children:o.name}),t.jsx("p",{className:"text-xs text-gray-500 line-clamp-2 leading-relaxed",children:o.desc})]},c))})]})]})},M4=()=>{var i;const{theme:s}=Re(),[e,r]=k.useState("memecoins"),a=s==="dark"?"text-white":"text-gray-900",n=[{id:"memecoins",label:"Мемкоины",icon:t.jsx(Lr,{className:"w-4 h-4"})},{id:"polymarket",label:"Polymarket",icon:t.jsx(Vr,{className:"w-4 h-4"})},{id:"nft",label:"NFT",icon:t.jsx(_s,{className:"w-4 h-4"})},{id:"staking",label:"Стейкинг",icon:t.jsx(Wl,{className:"w-4 h-4"})},{id:"spot",label:"Спот",icon:t.jsx(eb,{className:"w-4 h-4"})},{id:"futures",label:"Фьючерсы",icon:t.jsx(Ar,{className:"w-4 h-4"})},{id:"airdrop",label:"AirDrop",icon:t.jsx(sn,{className:"w-4 h-4"})}];return t.jsxs("div",{className:"space-y-8 pb-12",children:[t.jsxs("div",{className:`relative overflow-hidden rounded-3xl border ${s==="dark"?"border-blue-500/30 bg-[#151a21]/80 backdrop-blur-xl shadow-[0_8px_32px_rgba(0,0,0,0.4)]":"border-blue-500/20 bg-white/80 backdrop-blur-xl shadow-[0_8px_32px_rgba(0,0,0,0.08)]"}`,children:[t.jsxs("div",{className:"absolute inset-0 pointer-events-none",children:[t.jsx("div",{className:"absolute -left-16 -bottom-10 w-80 h-80 bg-blue-500/10 blur-3xl"}),t.jsx("div",{className:`absolute inset-0 ${s==="dark"?"bg-[radial-gradient(circle_at_50%_0%,rgba(255,255,255,0.05),transparent_45%)]":"bg-[radial-gradient(circle_at_50%_0%,rgba(59,130,246,0.05),transparent_45%)]"}`})]}),t.jsx("div",{className:"relative p-6 sm:p-8 flex flex-col lg:flex-row items-center justify-between gap-6",children:t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsx("div",{className:`p-3 rounded-2xl ${s==="dark"?"bg-white/10 border-white/20":"bg-blue-500/10 border-blue-500/30"}`,children:t.jsx(it,{className:`w-8 h-8 ${s==="dark"?"text-white":"text-blue-500"}`})}),t.jsxs("div",{children:[t.jsx("h1",{className:`text-3xl font-black ${a} whitespace-nowrap`,children:"AVF Контур"}),t.jsx("p",{className:`text-sm font-medium ${s==="dark"?"text-gray-400":"text-gray-500"}`,children:"Стратегические направления и инструменты ApeVault Frontier"})]})]})})]}),t.jsx("div",{className:"overflow-x-auto pb-2 scrollbar-hide -mx-4 px-4 sm:mx-0 sm:px-0",children:t.jsx("div",{className:"flex items-center gap-2 p-1.5 rounded-2xl bg-white/5 border border-white/5 w-fit backdrop-blur-sm min-w-max",children:n.map(o=>t.jsxs("button",{onClick:()=>r(o.id),className:`flex items-center gap-2 px-6 py-2.5 rounded-xl text-sm font-bold transition-all duration-300 ${e===o.id?"bg-blue-500 text-white shadow-lg shadow-blue-500/25":"text-gray-400 hover:bg-white/5 hover:text-white"}`,children:[o.icon,o.label]},o.id))})}),t.jsx("div",{className:"animate-fade-in",children:e==="memecoins"?t.jsx(P4,{}):t.jsxs("div",{className:"py-20 text-center space-y-4",children:[t.jsx("div",{className:"flex justify-center",children:t.jsx(ka,{className:"w-16 h-16 text-gray-700 animate-pulse"})}),t.jsxs("h3",{className:`text-xl font-black ${a}`,children:[(i=n.find(o=>o.id===e))==null?void 0:i.label," — В разработке"]}),t.jsx("p",{className:"text-gray-500 max-w-md mx-auto px-4",children:"Мы готовим новые контентные модули и стратегии для данного направления. Следите за обновлениями в AVF Контур."})]})})]})},O4=async s=>{const e=Xe(ke,"events");let r;return r=et(e,ya("createdAt","desc")),(await Ft(r)).docs.map(i=>{const o=i.data();return{id:i.id,title:o.title||"",description:o.description||"",category:o.category||"memecoins",dates:o.dates||[],time:o.time||"",endTime:o.endTime||"",recurrence:o.recurrence||{type:"none",startDate:""},links:o.links||[],requiredParticipants:o.requiredParticipants||[],recommendedParticipants:o.recommendedParticipants||[],going:o.going||[],notGoing:o.notGoing||[],files:o.files||[],createdBy:o.createdBy||"",createdAt:o.createdAt||new Date().toISOString(),updatedAt:o.updatedAt||new Date().toISOString()}})},V4=async s=>{const e=Xe(ke,"events"),r=new Date().toISOString(),a={...s,requiredParticipants:s.requiredParticipants||[],recommendedParticipants:s.recommendedParticipants||[],going:[],notGoing:[],createdAt:r,updatedAt:r};return(await pr(e,a)).id},Ma=async(s,e)=>{const r=tt(ke,"events",s),a={...e,updatedAt:new Date().toISOString()};await lr(r,a)},L4=async s=>{const e=tt(ke,"events",s);await gr(e)},F4=s=>{const e=Xe(ke,"events"),r=et(e,ya("createdAt","desc"));return $1(r,a=>{const n=a.docs.map(i=>{const o=i.data();return{id:i.id,title:o.title||"",description:o.description||"",category:o.category||"memecoins",dates:o.dates||[],time:o.time||"",endTime:o.endTime||"",recurrence:o.recurrence||{type:"none",startDate:""},links:o.links||[],requiredParticipants:o.requiredParticipants||[],going:o.going||[],notGoing:o.notGoing||[],files:o.files||[],createdBy:o.createdBy||"",createdAt:o.createdAt||new Date().toISOString(),updatedAt:o.updatedAt||new Date().toISOString()}});s(n)})},U4={memecoins:Lr,polymarket:Vr,nft:_s,staking:xt,spot:jr,futures:it,airdrop:sn},B4=k.memo(({event:s,isAdmin:e,onEdit:r,onDelete:a})=>{const{theme:n}=Re(),{user:i}=ot(),{users:o}=ea(),c=Oa[s.category],d=U4[s.category]||Lr,u=n==="dark"?"text-white":"text-gray-900",m=n==="dark"?"text-gray-400":"text-gray-600",f=n==="dark"?"border-white/10":"border-gray-100",x=n==="dark"?"bg-white/5 backdrop-blur-md":"bg-white",[v,T]=k.useState(new Date);k.useEffect(()=>{const ee=setInterval(()=>{T(new Date)},1e3);return()=>clearInterval(ee)},[]);const I=v.toISOString().split("T")[0],N=v.toTimeString().slice(0,5),O=s.dates.includes(I)&&s.time<=N&&(s.endTime?s.endTime>N:!0),C=s.dates.filter(ee=>ee>=I).sort()[0],V=(()=>{if(!C)return null;const te=new Date(`${C}T${s.time}`).getTime()-v.getTime();if(te<0)return null;const Y=Math.floor(te/(1e3*60*60*24)),q=Math.floor(te%(1e3*60*60*24)/(1e3*60*60)),R=Math.floor(te%(1e3*60*60)/(1e3*60)),S=Math.floor(te%(1e3*60)/1e3),P=[];return Y>0&&P.push(`${Y}д`),q>0&&P.push(`${q}ч`),(R>0||q>0)&&P.push(`${R}м`),P.push(`${S}с`),P.join(" ")})(),U=s.requiredParticipants.map(ee=>{const te=o.find(Y=>Y.id===ee);return(te==null?void 0:te.name)||"Unknown"}).filter(Boolean),y=(s.recommendedParticipants||[]).map(ee=>{const te=o.find(Y=>Y.id===ee);return(te==null?void 0:te.name)||"Unknown"}).filter(Boolean),b=i&&s.requiredParticipants.includes(i.id),E=i&&(s.recommendedParticipants||[]).includes(i.id),j=ee=>No(kr(ee),"dd.MM.yyyy"),A=async ee=>{if(!i)return;const te=[...s.going],Y=[...s.notGoing];try{if(ee)if(te.includes(i.id)){const q=te.filter(R=>R!==i.id);await Ma(s.id,{going:q})}else{const q=[...te,i.id],R=Y.filter(S=>S!==i.id);await Ma(s.id,{going:q,notGoing:R})}else if(Y.includes(i.id)){const q=Y.filter(R=>R!==i.id);await Ma(s.id,{notGoing:q})}else{const q=[...Y,i.id],R=te.filter(S=>S!==i.id);await Ma(s.id,{going:R,notGoing:q})}}catch(q){console.error("Failed to RSVP:",q),alert("Ошибка при сохранении ответа")}},w=s.going.map(ee=>{var te;return(te=o.find(Y=>Y.id===ee))==null?void 0:te.name}).filter(Boolean),g=s.notGoing.map(ee=>{var te;return(te=o.find(Y=>Y.id===ee))==null?void 0:te.name}).filter(Boolean),$=i&&s.going.includes(i.id),L=i&&s.notGoing.includes(i.id);return t.jsxs("div",{className:`relative p-5 rounded-2xl border ${f} ${x} shadow-sm hover:shadow-xl transition-all group overflow-hidden`,children:[t.jsx("div",{className:`absolute -right-20 -top-20 w-64 h-64 bg-gradient-to-br ${c.cardGradient} blur-3xl opacity-50 group-hover:opacity-100 transition-opacity duration-500`}),t.jsxs("div",{className:"relative flex flex-col lg:flex-row lg:items-start gap-6",children:[t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsxs("div",{className:"flex items-start gap-4",children:[t.jsx("div",{className:`p-4 rounded-2xl bg-gradient-to-br ${c.gradient} shadow-lg shadow-emerald-500/10 text-white shrink-0`,children:t.jsx(d,{className:"w-6 h-6 sm:w-7 sm:h-7"})}),t.jsx("div",{className:"flex-1 min-w-0",children:t.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2",children:[t.jsx("h3",{className:`text-xl sm:text-2xl font-black ${u} tracking-tight leading-tight`,children:s.title}),t.jsx("span",{className:`w-fit px-3 py-1 rounded-full text-[10px] font-black uppercase tracking-widest bg-gradient-to-r ${c.gradient} text-white shadow-sm ring-1 ring-white/20`,children:c.label})]})})]}),t.jsxs("div",{className:"flex flex-wrap items-center gap-5 text-sm sm:text-base mt-4 pl-1",children:[t.jsxs("div",{className:"flex items-center gap-2.5",children:[t.jsx("div",{className:`p-2 rounded-xl ${n==="dark"?"bg-white/5":"bg-gray-100"}`,children:t.jsx(ir,{size:16,className:"text-emerald-500"})}),t.jsx("span",{className:`font-bold ${m}`,children:s.dates.length===1?j(s.dates[0]):`${j(s.dates[0])} — ${j(s.dates[s.dates.length-1])}`})]}),t.jsxs("div",{className:"flex items-center gap-2.5",children:[t.jsx("div",{className:`p-2 rounded-xl ${n==="dark"?"bg-white/5":"bg-gray-100"}`,children:t.jsx(Lt,{size:16,className:"text-emerald-500"})}),t.jsxs("span",{className:`font-bold ${m}`,children:[s.time,s.endTime?` — ${s.endTime}`:""]})]})]}),s.description&&t.jsx("div",{className:"mt-5 pl-1",children:t.jsx("p",{className:`text-[15px] ${n==="dark"?"text-gray-300":"text-gray-600"} leading-relaxed`,children:s.description})}),t.jsxs("div",{className:"mt-6 flex flex-wrap gap-3",children:[s.links.map((ee,te)=>t.jsxs("a",{href:ee.url,target:"_blank",rel:"noopener noreferrer",className:`flex items-center gap-2 px-4 py-2.5 rounded-xl text-sm font-bold transition-all ${n==="dark"?"bg-emerald-500/10 text-emerald-400 hover:bg-emerald-500/20 border border-emerald-500/20":"bg-emerald-50 text-emerald-700 hover:bg-emerald-100 border border-emerald-100"}`,children:[t.jsx(q0,{size:14}),ee.name]},te)),s.files.map(ee=>t.jsxs("a",{href:ee.url,target:"_blank",rel:"noopener noreferrer",className:`flex items-center gap-2 px-4 py-2.5 rounded-xl text-sm font-bold transition-all ${n==="dark"?"bg-white/5 text-gray-300 hover:bg-white/10 border border-white/5":"bg-gray-50 text-gray-700 hover:bg-gray-100 border border-gray-100"}`,children:[t.jsx(Xi,{size:14}),ee.name]},ee.id))]}),i&&t.jsxs("div",{className:"hidden lg:flex mt-6 flex-col sm:flex-row gap-2",children:[t.jsxs("button",{onClick:()=>A(!0),className:`flex-1 flex items-center justify-center gap-2 px-4 py-2.5 rounded-xl text-sm font-bold transition-all shadow-md ${$?"bg-emerald-500 text-white shadow-emerald-500/20 ring-1 ring-emerald-500 ring-offset-1 ring-offset-transparent":"bg-emerald-500/10 text-emerald-500 hover:bg-emerald-500/20 shadow-none"}`,children:[t.jsx(Ir,{size:16}),t.jsx("span",{children:"Я буду"})]}),t.jsxs("button",{onClick:()=>A(!1),className:`flex-1 flex items-center justify-center gap-2 px-4 py-2.5 rounded-xl text-sm font-bold transition-all shadow-md ${L?"bg-rose-500 text-white shadow-rose-500/20 ring-1 ring-rose-500 ring-offset-1 ring-offset-transparent":"bg-rose-500/10 text-rose-500 hover:bg-rose-500/20 shadow-none"}`,children:[t.jsx(Os,{size:16}),t.jsx("span",{children:"Меня не будет"})]})]})]}),t.jsxs("div",{className:"lg:w-72 flex flex-col gap-5",children:[t.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-1 gap-2",children:[O&&t.jsxs("div",{className:"flex items-center justify-between p-4 rounded-2xl bg-emerald-500/10 border border-emerald-500/20 shadow-inner",children:[t.jsx("span",{className:"text-[10px] font-black uppercase text-emerald-500 tracking-wider",children:"Идет сейчас"}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"w-2 h-2 rounded-full bg-emerald-500 animate-pulse"}),t.jsx(an,{size:16,className:"text-emerald-500"})]})]}),V&&!O&&t.jsxs("div",{className:"flex items-center justify-between p-4 rounded-2xl bg-amber-500/10 border border-amber-500/20 shadow-inner",children:[t.jsx("span",{className:"text-[10px] font-black uppercase text-amber-500 tracking-wider",children:"Начнется через"}),t.jsx("span",{className:"text-sm font-black text-amber-500",children:V})]}),$&&t.jsxs("div",{className:"flex items-center justify-between p-4 rounded-2xl bg-emerald-500/10 border border-emerald-500/20 shadow-inner",children:[t.jsx("span",{className:"text-[10px] font-black uppercase text-emerald-500 tracking-wider",children:"Вы идете"}),t.jsx(Ir,{size:16,className:"text-emerald-500"})]}),L&&t.jsxs("div",{className:"flex items-center justify-between p-4 rounded-2xl bg-rose-500/10 border border-rose-500/20 shadow-inner",children:[t.jsx("span",{className:"text-[10px] font-black uppercase text-rose-500 tracking-wider",children:"Вы не идете"}),t.jsx(Os,{size:16,className:"text-rose-500"})]}),!$&&!L&&(b||E)&&t.jsxs("div",{className:"flex items-center justify-between p-4 rounded-2xl bg-blue-500/10 border border-blue-500/20 shadow-inner",children:[t.jsx("span",{className:"text-[10px] font-black uppercase text-blue-500 tracking-wider",children:b?"Вы участвуете":"Рекомендовано вам"}),t.jsx(Gt,{size:16,className:"text-blue-500"})]})]}),w.length>0&&t.jsxs("div",{className:`p-5 rounded-2xl ${n==="dark"?"bg-emerald-500/5 shadow-inner":"bg-emerald-50/50"} border ${n==="dark"?"border-emerald-500/20":"border-emerald-100"}`,children:[t.jsxs("div",{className:"flex items-center gap-2 mb-3.5",children:[t.jsx(Ir,{size:14,className:"text-emerald-500"}),t.jsxs("p",{className:"text-[10px] font-black uppercase tracking-widest text-emerald-500",children:["Будут (",w.length,")"]})]}),t.jsx("div",{className:"flex flex-wrap gap-2",children:w.map((ee,te)=>t.jsx("span",{className:`px-3 py-1.5 rounded-xl text-xs font-bold ${n==="dark"?"bg-emerald-500/10 text-emerald-400":"bg-white text-emerald-700 shadow-sm border border-emerald-100"}`,children:ee},te))})]}),g.length>0&&t.jsxs("div",{className:`p-5 rounded-2xl ${n==="dark"?"bg-rose-500/5 shadow-inner":"bg-rose-50/50"} border ${n==="dark"?"border-rose-500/20":"border-rose-100"}`,children:[t.jsxs("div",{className:"flex items-center gap-2 mb-3.5",children:[t.jsx(Os,{size:14,className:"text-rose-500"}),t.jsxs("p",{className:"text-[10px] font-black uppercase tracking-widest text-rose-500",children:["Не смогут (",g.length,")"]})]}),t.jsx("div",{className:"flex flex-wrap gap-2",children:g.map((ee,te)=>t.jsx("span",{className:`px-3 py-1.5 rounded-xl text-xs font-bold ${n==="dark"?"bg-rose-500/10 text-rose-400":"bg-white text-rose-700 shadow-sm border border-rose-100"}`,children:ee},te))})]}),U.length>0&&t.jsxs("div",{className:`p-5 rounded-2xl ${n==="dark"?"bg-white/5 shadow-inner":"bg-gray-50"} border ${f}`,children:[t.jsxs("div",{className:"flex items-center gap-2 mb-3.5",children:[t.jsx(Gt,{size:14,className:m}),t.jsx("p",{className:`text-[10px] font-black uppercase tracking-widest ${m}`,children:"Обязательные"})]}),t.jsx("div",{className:"flex flex-wrap gap-2",children:U.map((ee,te)=>t.jsx("span",{className:`px-3 py-1.5 rounded-xl text-xs font-bold ${n==="dark"?"bg-white/10 text-gray-300":"bg-white text-gray-700 shadow-sm"}`,children:ee},te))})]}),y.length>0&&t.jsxs("div",{className:`p-5 rounded-2xl ${n==="dark"?"bg-white/5 shadow-inner":"bg-gray-50"} border ${f}`,children:[t.jsxs("div",{className:"flex items-center gap-2 mb-3.5",children:[t.jsx(Gt,{size:14,className:m}),t.jsx("p",{className:`text-[10px] font-black uppercase tracking-widest ${m}`,children:"Рекомендованные"})]}),t.jsx("div",{className:"flex flex-wrap gap-2",children:y.map((ee,te)=>t.jsx("span",{className:`px-3 py-1.5 rounded-xl text-xs font-bold ${n==="dark"?"bg-white/10 text-gray-300":"bg-white text-gray-700 shadow-sm"}`,children:ee},te))})]}),e&&t.jsxs("div",{className:"flex items-center gap-3 mt-auto pt-4 border-t border-white/5 lg:border-none",children:[t.jsxs("button",{onClick:()=>r(s),className:`flex-1 flex items-center justify-center gap-2 px-5 py-3 rounded-2xl text-sm font-black transition-all ${n==="dark"?"bg-white/5 hover:bg-white/10 text-gray-400 hover:text-white":"bg-gray-50 hover:bg-gray-100 text-gray-500 hover:text-gray-900"}`,children:[t.jsx(ar,{size:16}),"Изменить"]}),t.jsx("button",{onClick:()=>a(s.id),className:`p-3 rounded-2xl transition-all ${n==="dark"?"bg-red-500/10 hover:bg-red-500/20 text-red-400":"bg-red-50 hover:bg-red-100 text-red-600"}`,children:t.jsx(Et,{size:20})})]})]})]}),i&&t.jsxs("div",{className:"lg:hidden mt-6 flex flex-col sm:flex-row gap-2",children:[t.jsxs("button",{onClick:()=>A(!0),className:`flex-1 flex items-center justify-center gap-2 px-4 py-3.5 rounded-xl text-sm font-bold transition-all shadow-md ${$?"bg-emerald-500 text-white shadow-emerald-500/20 ring-1 ring-emerald-500 ring-offset-1 ring-offset-transparent":"bg-emerald-500/10 text-emerald-500 hover:bg-emerald-500/20 shadow-none"}`,children:[t.jsx(Ir,{size:18}),t.jsx("span",{children:"Я буду"})]}),t.jsxs("button",{onClick:()=>A(!1),className:`flex-1 flex items-center justify-center gap-2 px-4 py-3.5 rounded-xl text-sm font-bold transition-all shadow-md ${L?"bg-rose-500 text-white shadow-rose-500/20 ring-1 ring-rose-500 ring-offset-1 ring-offset-transparent":"bg-rose-500/10 text-rose-500 hover:bg-rose-500/20 shadow-none"}`,children:[t.jsx(Os,{size:18}),t.jsx("span",{children:"Меня не будет"})]})]})]})}),z4=async(s,e)=>{const r=Ip(Ap,e),a=await U2(r,s);return{url:await B2(a.ref),fileName:s.name}},q4=async s=>{const e=Ip(Ap,s);await z2(e)},I0={memecoins:Lr,polymarket:Vr,nft:_s,staking:xt,spot:jr,futures:it,airdrop:sn},W4=({event:s,onClose:e})=>{var bt;const{user:r}=ot(),{theme:a}=Re(),{users:n}=ea(),{lockScroll:i,unlockScroll:o}=ns();k.useEffect(()=>(i(),o),[i,o]);const[c,d]=k.useState(!1),[u,m]=k.useState(!1),[f,x]=k.useState((s==null?void 0:s.title)||""),[v,T]=k.useState((s==null?void 0:s.description)||""),[I,N]=k.useState((s==null?void 0:s.category)||"memecoins"),[O,D]=k.useState((s==null?void 0:s.dates)||[]),[C,M]=k.useState((s==null?void 0:s.time)||"12:00"),[V,U]=k.useState((s==null?void 0:s.endTime)||""),[y,b]=k.useState((s==null?void 0:s.recurrence)||{type:"none",startDate:""}),[E,j]=k.useState((s==null?void 0:s.links)||[]),[A,w]=k.useState((s==null?void 0:s.requiredParticipants)||[]),[g,$]=k.useState((s==null?void 0:s.recommendedParticipants)||[]),[L]=k.useState((s==null?void 0:s.going)||[]),[ee]=k.useState((s==null?void 0:s.notGoing)||[]),[te,Y]=k.useState((s==null?void 0:s.files)||[]),[q,R]=k.useState(((bt=s==null?void 0:s.recurrence)==null?void 0:bt.endDate)||""),[S,P]=k.useState(""),[W,K]=k.useState(""),[he,H]=k.useState(""),me=k.useRef(null),[G,se]=k.useState([]),Z=a==="dark"?"text-white":"text-gray-900",ne=a==="dark"?"text-gray-400":"text-gray-600",ie=a==="dark"?"border-white/10":"border-gray-200",Ce=a==="dark"?"bg-gray-800":"bg-white",je=a==="dark"?"bg-white/5":"bg-gray-50",le=Oa[I],ue=I0[I],F=()=>{S&&!O.includes(S)&&(D(re=>[...re,S].sort()),P(""))},B=()=>{if(!y||y.type==="none"||!y.startDate)return;const re=new Date(y.startDate),Ee=[];if(y.type==="daily"&&q){const Se=new Date(q),Pe=new Date(re);for(;Pe<=Se;)Ee.push(Pe.toISOString().split("T")[0]),Pe.setDate(Pe.getDate()+1)}else if(y.type==="weekly"&&q){const Se=new Date(q),Pe=new Date(re);for(;Pe<=Se;)Ee.push(Pe.toISOString().split("T")[0]),Pe.setDate(Pe.getDate()+7)}else if(y.type==="range"&&q){const Se=new Date(q),Pe=new Date(re);for(;Pe<=Se;)Ee.push(Pe.toISOString().split("T")[0]),Pe.setDate(Pe.getDate()+1)}else if(y.type==="until"&&q){const Se=new Date(q),Pe=new Date(re);for(;Pe<=Se;)Ee.push(Pe.toISOString().split("T")[0]),Pe.setDate(Pe.getDate()+1)}Ee.length>0&&D(Se=>Array.from(new Set([...Se,...Ee])).sort())},Ne=re=>{D(Ee=>Ee.filter(Se=>Se!==re))},Te=()=>{W&&!E.find(re=>re.url===W)&&(j(re=>[...re,{url:W.trim(),name:he.trim()||`Ссылка ${re.length+1}`}]),K(""),H(""))},pe=re=>{j(Ee=>Ee.filter(Se=>Se.url!==re))},De=re=>{const Ee=Array.from(re.target.files||[]);se(Se=>[...Se,...Ee])},$e=re=>{se(Ee=>Ee.filter((Se,Pe)=>Pe!==re))},nt=async re=>{if(window.confirm(`Удалить файл "${re.name}"?`))try{await q4(re.url),Y(Ee=>Ee.filter(Se=>Se.id!==re.id))}catch(Ee){console.error("Failed to delete file:",Ee)}},dt=async re=>{if(G.length===0)return[];m(!0);const Ee=[];try{for(const Se of G){const Pe=`events/${re}/${Date.now()}_${Se.name}`,Ct=await z4(Se,Pe);Ee.push({id:Date.now().toString()+Math.random().toString(36).slice(2),name:Ct.fileName,url:Ct.url,type:Se.type,size:Se.size})}return Ee}finally{m(!1)}},ge=async re=>{if(re.preventDefault(),!f.trim()||O.length===0){alert("Заполните обязательные поля: название и даты");return}d(!0);try{let Ee=s==null?void 0:s.id;if(s){const Se=await dt(s.id),Pe=[...te,...Se];await Ma(s.id,{title:f,description:v,category:I,dates:O,time:C,endTime:V,recurrence:{type:(y==null?void 0:y.type)||"none",startDate:(y==null?void 0:y.startDate)||"",endDate:q},links:E.map(Ct=>({...Ct,url:Ct.url.trim()})),requiredParticipants:A,recommendedParticipants:g,going:L,notGoing:ee,files:Pe})}else{Ee=await V4({title:f,description:v,category:I,dates:O,time:C,endTime:V,recurrence:{type:(y==null?void 0:y.type)||"none",startDate:(y==null?void 0:y.startDate)||"",endDate:q},links:E.map(Pe=>({...Pe,url:Pe.url.trim()})),requiredParticipants:A,recommendedParticipants:g,going:[],notGoing:[],files:[],createdBy:(r==null?void 0:r.id)||""});const Se=await dt(Ee);Se.length>0&&await Ma(Ee,{files:Se})}e()}catch(Ee){console.error("Failed to save event:",Ee),alert("Ошибка при сохранении события")}finally{d(!1)}},be=re=>{$(Ee=>Ee.includes(re)?Ee.filter(Se=>Se!==re):(w(Se=>Se.filter(Pe=>Pe!==re)),[...Ee,re]))},qe=re=>{w(Ee=>Ee.includes(re)?Ee.filter(Se=>Se!==re):($(Se=>Se.filter(Pe=>Pe!==re)),[...Ee,re]))};return t.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[t.jsx("div",{className:"absolute inset-0 bg-black/60 backdrop-blur-sm",onClick:e}),t.jsxs("div",{className:`relative w-full max-w-2xl max-h-[90vh] overflow-y-auto rounded-2xl ${Ce} shadow-2xl`,children:[t.jsxs("div",{className:`sticky top-0 z-10 flex items-center justify-between p-6 border-b ${ie}`,children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:`p-2.5 rounded-xl bg-gradient-to-br ${le.gradient} bg-opacity-10 text-white`,children:t.jsx(ue,{size:20})}),t.jsx("h2",{className:`text-xl font-bold ${Z}`,children:s?"Редактирование события":"Новое событие"})]}),t.jsx("button",{onClick:e,className:`p-2 rounded-lg transition-all ${a==="dark"?"hover:bg-white/10":"hover:bg-gray-100"}`,children:t.jsx(pt,{size:20,className:ne})})]}),t.jsxs("form",{onSubmit:ge,className:"p-6 space-y-6",children:[t.jsxs("div",{children:[t.jsx("label",{className:`block text-sm font-medium mb-2 ${Z}`,children:"Название *"}),t.jsx("input",{type:"text",value:f,onChange:re=>x(re.target.value),placeholder:"Введите название события",className:`w-full px-4 py-3 rounded-xl border ${ie} ${je} ${Z} placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-emerald-500`,required:!0})]}),t.jsxs("div",{children:[t.jsx("label",{className:`block text-sm font-medium mb-2 ${Z}`,children:"Категория"}),t.jsx("div",{className:"flex flex-wrap gap-2",children:Object.keys(Oa).map(re=>{const Ee=Oa[re],Se=I0[re];return t.jsxs("button",{type:"button",onClick:()=>N(re),className:`flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-medium transition-all ${I===re?`bg-gradient-to-r ${Ee.gradient} text-white`:a==="dark"?"bg-white/10 text-gray-300 hover:bg-white/20":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:[t.jsx(Se,{size:16}),Ee.label]},re)})})]}),t.jsxs("div",{children:[t.jsx("label",{className:`block text-sm font-medium mb-2 ${Z}`,children:"Описание"}),t.jsx("textarea",{value:v,onChange:re=>T(re.target.value),placeholder:"Опишите событие...",rows:3,className:`w-full px-4 py-3 rounded-xl border ${ie} ${je} ${Z} placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-emerald-500 resize-none`})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:`block text-sm font-medium mb-2 ${Z}`,children:"Даты *"}),t.jsxs("div",{className:"space-y-2",children:[t.jsxs("div",{className:"flex gap-2",children:[t.jsxs("div",{className:"relative flex-1",children:[t.jsx(ir,{size:18,className:`absolute left-4 top-1/2 -translate-y-1/2 ${ne} sm:block hidden`}),t.jsx("input",{type:"date",value:S,onChange:re=>P(re.target.value),className:`w-full sm:pl-12 px-4 py-2.5 rounded-xl border ${ie} ${je} ${Z} focus:outline-none focus:ring-2 focus:ring-emerald-500`})]}),t.jsx("button",{type:"button",onClick:F,disabled:!S,className:"px-4 py-2.5 rounded-xl bg-emerald-500 text-white font-bold hover:bg-emerald-600 transition-all disabled:opacity-50 disabled:cursor-not-allowed shadow-lg shadow-emerald-500/20",children:t.jsx(mr,{size:20})})]}),O.length>0&&t.jsx("div",{className:"flex flex-wrap gap-2",children:O.map(re=>t.jsxs("span",{className:"flex items-center gap-1.5 px-3 py-1 rounded-full text-sm bg-emerald-500/10 text-emerald-500 border border-emerald-500/20",children:[t.jsx(ir,{size:12}),new Date(re).toLocaleDateString("ru-RU"),t.jsx("button",{type:"button",onClick:()=>Ne(re),className:"ml-1 hover:text-red-400",children:t.jsx(pt,{size:12})})]},re))})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:`block text-sm font-medium mb-2 ${Z}`,children:"Время начала"}),t.jsx("input",{type:"time",value:C,onChange:re=>M(re.target.value),className:`w-full px-4 py-3 rounded-xl border ${ie} ${je} ${Z} focus:outline-none focus:ring-2 focus:ring-emerald-500`})]}),t.jsxs("div",{children:[t.jsx("label",{className:`block text-sm font-medium mb-2 ${Z}`,children:"Время окончания"}),t.jsx("input",{type:"time",value:V,onChange:re=>U(re.target.value),className:`w-full px-4 py-3 rounded-xl border ${ie} ${je} ${Z} focus:outline-none focus:ring-2 focus:ring-emerald-500`})]})]}),t.jsxs("div",{className:`p-4 rounded-xl border ${ie} ${je}`,children:[t.jsx("label",{className:`block text-sm font-bold mb-4 ${Z} uppercase tracking-wider`,children:"Повторение события"}),t.jsxs("div",{className:"space-y-4",children:[t.jsx("div",{className:"flex flex-wrap gap-2",children:[{id:"none",label:"Нет"},{id:"daily",label:"Ежедневно"},{id:"weekly",label:"Еженедельно"},{id:"range",label:"Диапазон дат"},{id:"until",label:"До даты"}].map(re=>t.jsx("button",{type:"button",onClick:()=>b(Ee=>({...Ee,type:re.id})),className:`px-4 py-2 rounded-lg text-sm font-medium transition-all ${(y==null?void 0:y.type)===re.id?"bg-emerald-500 text-white shadow-lg shadow-emerald-500/20":a==="dark"?"bg-white/10 text-gray-300 hover:bg-white/20":"bg-white text-gray-700 hover:bg-gray-50"}`,children:re.label},re.id))}),(y==null?void 0:y.type)!=="none"&&t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 animate-in fade-in slide-in-from-top-2",children:[t.jsxs("div",{children:[t.jsx("label",{className:`block text-xs font-medium mb-1.5 ${ne}`,children:"Дата начала"}),t.jsx("input",{type:"date",value:y==null?void 0:y.startDate,onChange:re=>b(Ee=>({...Ee,startDate:re.target.value})),className:`w-full px-3 py-2 rounded-lg border ${ie} ${a==="dark"?"bg-gray-800":"bg-white"} ${Z} focus:outline-none focus:ring-2 focus:ring-emerald-500 text-sm`})]}),((y==null?void 0:y.type)==="daily"||(y==null?void 0:y.type)==="weekly"||(y==null?void 0:y.type)==="range"||(y==null?void 0:y.type)==="until")&&t.jsxs("div",{children:[t.jsx("label",{className:`block text-xs font-medium mb-1.5 ${ne}`,children:y.type==="range"?"Дата окончания":"Повторять до"}),t.jsx("input",{type:"date",value:q,onChange:re=>R(re.target.value),className:`w-full px-3 py-2 rounded-lg border ${ie} ${a==="dark"?"bg-gray-800":"bg-white"} ${Z} focus:outline-none focus:ring-2 focus:ring-emerald-500 text-sm`})]}),t.jsx("div",{className:"md:col-span-2",children:t.jsx("button",{type:"button",onClick:B,disabled:!(y!=null&&y.startDate)||!q,className:"w-full py-2.5 rounded-lg bg-emerald-500/10 text-emerald-500 font-bold hover:bg-emerald-500/20 transition-all text-sm border border-emerald-500/20 disabled:opacity-50",children:"Применить и добавить даты"})})]})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:`block text-sm font-medium mb-2 ${Z}`,children:"Ссылки"}),E.length>0&&t.jsx("div",{className:"space-y-2 mb-4",children:E.map((re,Ee)=>t.jsxs("div",{className:`flex items-center gap-3 p-3 rounded-lg border ${ie}`,children:[t.jsx(Ou,{size:16,className:ne}),t.jsxs("a",{href:re.url,target:"_blank",rel:"noopener noreferrer",className:`flex-1 text-sm truncate ${a==="dark"?"text-emerald-400 hover:text-emerald-300":"text-emerald-600 hover:text-emerald-500"}`,children:[re.name," ",t.jsxs("span",{className:"text-[10px] opacity-50 ml-1",children:["(",re.url,")"]})]}),t.jsx("button",{type:"button",onClick:()=>pe(re.url),className:`p-1.5 rounded-lg transition-all ${a==="dark"?"hover:bg-red-500/20 text-red-400":"hover:bg-red-50 text-red-600"}`,children:t.jsx(pt,{size:14})})]},Ee))}),t.jsx("div",{className:"space-y-3",children:t.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[t.jsxs("div",{className:"relative flex-[2]",children:[t.jsx(Ou,{size:18,className:`absolute left-4 top-1/2 -translate-y-1/2 ${ne}`}),t.jsx("input",{type:"url",value:W,onChange:re=>K(re.target.value),placeholder:"https://...",className:`w-full pl-12 pr-4 py-3 rounded-xl border ${ie} ${je} ${Z} placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-emerald-500`})]}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx("div",{className:"relative flex-1",children:t.jsx("input",{type:"text",value:he,onChange:re=>H(re.target.value),placeholder:"Название",className:`w-full px-4 py-3 rounded-xl border ${ie} ${je} ${Z} placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-emerald-500`})}),t.jsx("button",{type:"button",onClick:Te,disabled:!W.trim(),className:"px-5 py-3 rounded-xl bg-emerald-500 text-white font-bold hover:bg-emerald-600 transition-all disabled:opacity-50 disabled:cursor-not-allowed shadow-lg shadow-emerald-500/20",children:t.jsx(mr,{size:20})})]})]})})]}),t.jsxs("div",{children:[t.jsx("label",{className:`block text-sm font-medium mb-2 ${Z}`,children:"Обязательные участники"}),t.jsx("div",{className:"flex flex-wrap gap-2",children:n.map(re=>t.jsx("button",{type:"button",onClick:()=>qe(re.id),className:`px-3 py-1.5 rounded-lg text-sm font-medium transition-all ${A.includes(re.id)?"bg-emerald-500 text-white":a==="dark"?"bg-white/10 text-gray-300 hover:bg-white/20":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:re.name},re.id))})]}),t.jsxs("div",{children:[t.jsx("label",{className:`block text-sm font-medium mb-2 ${Z}`,children:"Рекомендованные участники"}),t.jsx("div",{className:"flex flex-wrap gap-2",children:n.map(re=>t.jsx("button",{type:"button",onClick:()=>be(re.id),className:`px-3 py-1.5 rounded-lg text-sm font-medium transition-all ${g.includes(re.id)?"bg-blue-500 text-white":a==="dark"?"bg-white/10 text-gray-300 hover:bg-white/20":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:re.name},re.id))})]}),t.jsxs("div",{children:[t.jsx("label",{className:`block text-sm font-medium mb-2 ${Z}`,children:"Файлы"}),te.length>0&&t.jsx("div",{className:"space-y-2 mb-4",children:te.map(re=>t.jsxs("div",{className:`flex items-center gap-3 p-3 rounded-lg border ${ie}`,children:[t.jsx(Xi,{size:18,className:ne}),t.jsx("span",{className:`flex-1 text-sm truncate ${Z}`,children:re.name}),t.jsx("button",{type:"button",onClick:()=>nt(re),className:`p-1.5 rounded-lg transition-all ${a==="dark"?"hover:bg-red-500/20 text-red-400":"hover:bg-red-50 text-red-600"}`,children:t.jsx(Et,{size:14})})]},re.id))}),G.length>0&&t.jsx("div",{className:"space-y-2 mb-4",children:G.map((re,Ee)=>t.jsxs("div",{className:`flex items-center gap-3 p-3 rounded-lg border ${ie}`,children:[t.jsx(Xi,{size:18,className:ne}),t.jsx("span",{className:`flex-1 text-sm truncate ${Z}`,children:re.name}),t.jsxs("span",{className:`text-xs ${ne}`,children:[(re.size/1024).toFixed(1)," KB"]}),t.jsx("button",{type:"button",onClick:()=>$e(Ee),className:`p-1.5 rounded-lg transition-all ${a==="dark"?"hover:bg-red-500/20 text-red-400":"hover:bg-red-50 text-red-600"}`,children:t.jsx(pt,{size:14})})]},Ee))}),t.jsxs("button",{type:"button",onClick:()=>{var re;return(re=me.current)==null?void 0:re.click()},className:`flex items-center gap-2 px-4 py-3 rounded-xl border border-dashed ${ie} ${a==="dark"?"hover:bg-white/5":"hover:bg-gray-50"} transition-all`,children:[t.jsx(Zf,{size:18,className:ne}),t.jsx("span",{className:`text-sm ${ne}`,children:"Загрузить файлы"})]}),t.jsx("input",{ref:me,type:"file",multiple:!0,onChange:De,className:"hidden",accept:".pdf,.doc,.docx,.xls,.xlsx,.ppt,.pptx,.txt,.zip,.7z,.rar,.png,.jpg,.jpeg,.gif"})]}),t.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-end gap-3 pt-6 border-t ${borderColor}",children:[t.jsx("button",{type:"button",onClick:e,className:`w-full sm:w-auto px-8 py-3 rounded-xl font-bold transition-all ${a==="dark"?"hover:bg-white/10 text-gray-400":"hover:bg-gray-100 text-gray-600"}`,children:"Отмена"}),t.jsx("button",{type:"submit",disabled:c||u,className:"w-full sm:w-auto flex items-center justify-center gap-2 px-10 py-3 rounded-xl bg-gradient-to-r from-emerald-500 to-cyan-500 text-white font-black shadow-lg shadow-emerald-500/25 transition-all hover:shadow-emerald-500/40 disabled:opacity-50",children:c||u?t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin"}),t.jsx("span",{children:"Сохранение..."})]}):t.jsx(t.Fragment,{children:"Сохранить"})})]})]})]})]})},H4={memecoins:Lr,polymarket:Vr,nft:_s,staking:xt,spot:jr,futures:it,airdrop:sn},G4=()=>{const{user:s}=ot(),{isAdmin:e}=ft(),{theme:r}=Re(),[a,n]=k.useState([]),[i,o]=k.useState(!0),[c,d]=k.useState(null),[u,m]=k.useState(!1),[f,x]=k.useState("all"),[v,T]=k.useState("all"),[I,N]=k.useState(!1),[O,D]=k.useState(!1),[C,M]=k.useState("date"),V=async()=>{try{const $=await O4();n($)}catch($){console.error("Failed to fetch events:",$)}finally{o(!1)}};k.useEffect(()=>{const $=F4(L=>{n(L),o(!1)});return()=>$()},[]);const U=k.useMemo(()=>{let $=[...a];f!=="all"&&($=$.filter(Y=>Y.category===f)),O&&s&&($=$.filter(Y=>Y.requiredParticipants.includes(s.id)));const L=new Date,ee=L.toISOString().split("T")[0],te=L.toTimeString().slice(0,5);return v!=="all"&&($=$.filter(Y=>{const q=Y.dates.every(me=>me<ee),R=Y.dates.includes(ee),S=Y.dates.filter(me=>me>ee),P=R&&Y.time<=te,W=R&&Y.endTime?Y.endTime<=te:!1,K=P&&!W,he=S.length>0||R&&Y.time>te,H=q||R&&W;return v==="ongoing"?K:v==="past"?H:v==="upcoming"?he:!0})),C==="date"?$.sort((Y,q)=>{const R=Y.dates.sort(),S=q.dates.sort(),P=R[0],W=S[0];return P.localeCompare(W)}):$.sort((Y,q)=>new Date(q.createdAt).getTime()-new Date(Y.createdAt).getTime()),$},[a,f,O,C,s]),y=async $=>{if(window.confirm("Удалить это событие?"))try{await L4($),n(L=>L.filter(ee=>ee.id!==$))}catch(L){console.error("Failed to delete event:",L)}},b=()=>{m(!1),d(null),V()},E=r==="dark"?"text-white":"text-gray-900",j=r==="dark"?"text-gray-400":"text-gray-600",A=r==="dark"?"border-white/10":"border-gray-200",w=r==="dark"?"bg-gray-900":"bg-gray-50",g=r==="dark"?"bg-gray-800":"bg-white";return t.jsx("div",{className:`min-h-screen ${w} p-6`,children:t.jsxs("div",{className:"max-w-6xl mx-auto",children:[t.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-6 mb-8",children:[t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsx("div",{className:"p-3 rounded-xl bg-gradient-to-br from-emerald-400 to-cyan-500 text-white shadow-lg shadow-emerald-500/20",children:t.jsx(ir,{size:24})}),t.jsxs("div",{children:[t.jsx("h1",{className:`text-2xl font-bold ${E}`,children:"События"}),t.jsx("p",{className:`text-sm ${j}`,children:"Анонсы мероприятий и важные даты"})]})]}),t.jsxs("div",{className:"flex items-center gap-2 sm:gap-3",children:[t.jsx("button",{onClick:()=>N(!I),className:`p-3 rounded-xl border ${A} transition-all ${r==="dark"?"hover:bg-white/5":"hover:bg-gray-100"} ${I?"bg-emerald-500/10 border-emerald-500/30":""}`,children:t.jsx(W0,{size:20,className:I?"text-emerald-500":j})}),e&&t.jsxs("button",{onClick:()=>m(!0),className:"flex-1 sm:flex-none flex items-center justify-center gap-2 px-6 py-3 rounded-xl bg-gradient-to-r from-emerald-500 to-cyan-500 text-white font-bold hover:shadow-lg hover:shadow-emerald-500/25 transition-all",children:[t.jsx(mr,{size:20}),t.jsx("span",{className:"hidden sm:inline",children:"Создать"}),t.jsx("span",{className:"sm:hidden text-sm",children:"Создать"})]})]})]}),t.jsx("div",{className:`mb-6 p-5 rounded-2xl border ${A} ${g} shadow-sm transition-all duration-300 ${I?"opacity-100 translate-y-0":"hidden opacity-0 -translate-y-4"}`,children:t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"space-y-3",children:[t.jsx("span",{className:`text-xs font-black uppercase tracking-widest ${j}`,children:"По категории"}),t.jsxs("div",{className:"flex flex-wrap gap-2",children:[t.jsx("button",{onClick:()=>x("all"),className:`px-4 py-2 rounded-xl text-sm font-bold transition-all ${f==="all"?"bg-emerald-500 text-white shadow-lg shadow-emerald-500/20":r==="dark"?"bg-white/5 text-gray-400 hover:bg-white/10":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:"Все"}),Object.keys(Oa).map($=>{const L=H4[$],ee=Oa[$];return t.jsxs("button",{onClick:()=>x($),className:`flex items-center gap-2 px-4 py-2 rounded-xl text-sm font-bold transition-all ${f===$?`bg-gradient-to-r ${ee.gradient} text-white shadow-lg shadow-emerald-500/20`:r==="dark"?"bg-white/5 text-gray-400 hover:bg-white/10":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:[t.jsx(L,{size:16}),ee.label]},$)})]})]}),t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[t.jsxs("div",{className:"space-y-3",children:[t.jsx("span",{className:`text-xs font-black uppercase tracking-widest ${j}`,children:"По статусу"}),t.jsx("div",{className:"flex flex-wrap gap-2",children:[{id:"all",label:"Все"},{id:"upcoming",label:"Предстоящие"},{id:"ongoing",label:"Идущие"},{id:"past",label:"Прошедшие"}].map($=>t.jsx("button",{onClick:()=>T($.id),className:`px-4 py-2 rounded-xl text-sm font-bold transition-all ${v===$.id?"bg-emerald-500 text-white shadow-lg shadow-emerald-500/20":r==="dark"?"bg-white/5 text-gray-400 hover:bg-white/10":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:$.label},$.id))})]}),t.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-end gap-6 sm:col-span-2",children:[t.jsxs("div",{className:"space-y-3 flex-1 w-full",children:[t.jsx("span",{className:`text-xs font-black uppercase tracking-widest ${j}`,children:"Сортировать"}),t.jsxs("select",{value:C,onChange:$=>M($.target.value),className:`w-full min-w-[200px] px-4 py-2 rounded-xl text-sm font-bold border ${A} focus:ring-2 focus:ring-emerald-500 outline-none transition-all ${r==="dark"?"bg-white/5 text-white":"bg-gray-50 text-gray-900"}`,children:[t.jsx("option",{value:"date",children:"По ближайшей дате"}),t.jsx("option",{value:"created",children:"По дате создания"})]})]}),t.jsxs("label",{className:"flex items-center gap-3 p-2 rounded-xl cursor-pointer hover:bg-white/5 transition-all",children:[t.jsxs("div",{className:"relative",children:[t.jsx("input",{type:"checkbox",checked:O,onChange:$=>D($.target.checked),className:"sr-only peer"}),t.jsx("div",{className:"w-10 h-6 bg-gray-600 rounded-full peer peer-checked:after:translate-x-full after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-emerald-500"})]}),t.jsx("span",{className:`text-sm font-bold ${E}`,children:"Только мои"})]})]})]})]})}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-8",children:[t.jsxs("div",{className:`p-4 rounded-xl border ${A} ${g}`,children:[t.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[t.jsx("div",{className:"p-2 rounded-lg bg-emerald-500/10",children:t.jsx(ir,{size:18,className:"text-emerald-500"})}),t.jsx("span",{className:`text-sm ${j}`,children:"Всего событий"})]}),t.jsx("p",{className:`text-2xl font-bold ${E}`,children:a.length})]}),t.jsxs("div",{className:`p-4 rounded-xl border ${A} ${g}`,children:[t.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[t.jsx("div",{className:"p-2 rounded-lg bg-blue-500/10",children:t.jsx(Lt,{size:18,className:"text-blue-500"})}),t.jsx("span",{className:`text-sm ${j}`,children:"Предстоящих"})]}),t.jsx("p",{className:`text-2xl font-bold ${E}`,children:a.filter($=>$.dates.some(L=>L>=new Date().toISOString().split("T")[0])).length})]}),t.jsxs("div",{className:`p-4 rounded-xl border ${A} ${g}`,children:[t.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[t.jsx("div",{className:"p-2 rounded-lg bg-purple-500/10",children:t.jsx(Gt,{size:18,className:"text-purple-500"})}),t.jsx("span",{className:`text-sm ${j}`,children:"С участием"})]}),t.jsx("p",{className:`text-2xl font-bold ${E}`,children:a.filter($=>s&&$.requiredParticipants.includes(s.id)).length})]})]}),i?t.jsx("div",{className:"flex items-center justify-center py-20",children:t.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-emerald-500"})}):U.length===0?t.jsxs("div",{className:`text-center py-20 ${g} rounded-xl border ${A}`,children:[t.jsx(ir,{size:48,className:`mx-auto mb-4 ${j}`}),t.jsx("h3",{className:`text-lg font-semibold ${E} mb-2`,children:"Событий не найдено"}),t.jsx("p",{className:`text-sm ${j}`,children:f!=="all"||O?"Попробуйте изменить фильтры":"Создайте первое событие"})]}):t.jsx("div",{className:"space-y-4",children:U.map($=>t.jsx(B4,{event:$,isAdmin:e,onEdit:L=>{d(L),m(!0)},onDelete:y},$.id))}),u&&t.jsx(W4,{event:c,onClose:b})]})})},K4=({count:s,theme:e})=>{const r=o=>o>=30?100:o>=20?75:o>=10?50:o>=5?25:o/5*25,a=o=>o>=30?"bg-emerald-500 shadow-[0_0_15px_rgba(16,185,129,0.5)]":o>=20?"bg-yellow-500 shadow-[0_0_15px_rgba(234,179,8,0.5)]":o>=10?"bg-orange-500 shadow-[0_0_15px_rgba(249,115,22,0.5)]":o>=5?"bg-rose-500 shadow-[0_0_15px_rgba(244,63,94,0.5)]":"bg-gray-400",n=r(s),i=a(s);return t.jsxs("div",{className:`relative p-6 rounded-[2rem] border transition-all duration-500 ${e==="dark"?"bg-[#0b1015] border-white/5 hover:border-emerald-500/20":"bg-white border-gray-100 hover:border-emerald-500/10"} shadow-2xl group overflow-hidden`,children:[t.jsx("div",{className:"absolute top-0 right-0 w-32 h-32 bg-emerald-500/5 blur-[50px] rounded-full pointer-events-none"}),t.jsxs("div",{className:"flex items-center justify-between mb-8",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:`p-2.5 rounded-xl ${e==="dark"?"bg-emerald-500/10 text-emerald-400":"bg-emerald-50 text-emerald-600"}`,children:t.jsx(pf,{className:"w-5 h-5"})}),t.jsxs("div",{children:[t.jsx("h4",{className:`text-sm font-black uppercase tracking-widest ${e==="dark"?"text-white":"text-gray-900"}`,children:"Месячный драйв"}),t.jsx("p",{className:"text-[10px] font-bold text-gray-500 uppercase tracking-tighter",children:"Счетчик обнуляется каждый месяц"})]})]}),t.jsxs("div",{className:"text-right",children:[t.jsx("span",{className:`text-3xl font-black tracking-tighter ${e==="dark"?"text-white":"text-gray-900"}`,children:s}),t.jsx("span",{className:"text-sm font-bold text-gray-500",children:" / 30"})]})]}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:`relative h-14 w-full rounded-2xl overflow-hidden p-1.5 ${e==="dark"?"bg-white/5 border border-white/5":"bg-gray-100 border border-gray-200"}`,children:[t.jsx("div",{className:`h-full rounded-xl transition-all duration-1000 ease-out ${i}`,style:{width:`${n}%`}}),[5,10,20,30].map(o=>t.jsx("div",{className:"absolute top-0 bottom-0 border-r border-white/10 dark:border-white/5",style:{left:`${o/30*100}%`}},o))]}),t.jsx("div",{className:"flex justify-between px-1",children:[5,10,20,30].map(o=>t.jsxs("div",{className:`flex flex-col items-center gap-1 transition-all duration-300 ${s>=o?"opacity-100":"opacity-40"}`,children:[t.jsx("span",{className:`text-[10px] font-black tracking-tighter ${e==="dark"?"text-gray-400":"text-gray-600"}`,children:o}),t.jsx("div",{className:`w-1 h-1 rounded-full ${s>=o?"bg-emerald-500":"bg-gray-500"}`})]},o))})]})]})},Q4=({referral:s,onClose:e,onSave:r,theme:a})=>{const{user:n}=ot(),{isAdmin:i}=ft(),[o,c]=k.useState({name:"",phone:"",tgAccount:"",source:"",status:"active"}),[d,u]=k.useState(!1),[m,f]=k.useState(""),x=k.useMemo(()=>(s==null?void 0:s.referralId)||`REF-${Math.random().toString(36).slice(2,8).toUpperCase()}`,[s]);k.useEffect(()=>{s&&c({name:s.name,phone:s.phone||"",tgAccount:s.tgAccount||"",source:s.source||"",status:s.status||"active"})},[s]);const v=async I=>{I.preventDefault(),u(!0),f("");const N={...o,referralId:x,ownerId:(s==null?void 0:s.ownerId)||(n==null?void 0:n.id)||"",age:18,createdAt:(s==null?void 0:s.createdAt)||new Date().toISOString()};try{s?i?await Wp(s.id,N):await $t({entity:"referral",action:"update",authorId:(n==null?void 0:n.id)||"",targetUserId:s.ownerId,before:s,after:{id:s.id,...N}}):i?await qp(N):await $t({entity:"referral",action:"create",authorId:(n==null?void 0:n.id)||"",targetUserId:(n==null?void 0:n.id)||"",before:null,after:{id:"",...N}}),r()}catch{f("Ошибка при сохранении")}finally{u(!1)}},T=`w-full px-5 py-4 rounded-2xl border transition-all duration-300 focus:outline-none focus:ring-4 focus:ring-emerald-500/10 ${a==="dark"?"bg-white/5 border-white/10 text-white placeholder-gray-600 focus:border-emerald-500":"bg-gray-50 border-gray-200 text-gray-900 placeholder-gray-400 focus:border-emerald-500"}`;return t.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4",children:[t.jsx("div",{className:"absolute inset-0 bg-black/60 backdrop-blur-md",onClick:e}),t.jsx("div",{className:`relative w-full max-w-lg overflow-hidden rounded-[2.5rem] ${a==="dark"?"bg-[#0b0f17]":"bg-white"} shadow-2xl border ${a==="dark"?"border-white/10":"border-gray-200"} animate-in zoom-in duration-300`,children:t.jsxs("div",{className:"p-10",children:[t.jsxs("div",{className:"flex items-center justify-between mb-8",children:[t.jsxs("h3",{className:`text-2xl font-black tracking-tight ${a==="dark"?"text-white":"text-gray-900"}`,children:[s?"Редактировать":"Добавить"," реферала"]}),t.jsx("button",{onClick:e,className:"p-2 rounded-xl hover:bg-white/5 transition-colors",children:t.jsx(X4,{className:"w-6 h-6 text-gray-400"})})]}),t.jsxs("form",{onSubmit:v,className:"space-y-6",children:[t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{className:"space-y-2",children:[t.jsx("label",{className:"text-[10px] font-black uppercase tracking-widest text-gray-500 ml-2",children:"Имя"}),t.jsx("input",{required:!0,className:T,value:o.name,onChange:I=>c(N=>({...N,name:I.target.value})),placeholder:"Имя Фамилия"})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx("label",{className:"text-[10px] font-black uppercase tracking-widest text-gray-500 ml-2",children:"Телефон"}),t.jsx("input",{required:!0,className:T,value:o.phone,onChange:I=>c(N=>({...N,phone:I.target.value})),placeholder:"79000000000"})]})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{className:"space-y-2",children:[t.jsx("label",{className:"text-[10px] font-black uppercase tracking-widest text-gray-500 ml-2",children:"Telegram"}),t.jsx("input",{required:!0,className:T,value:o.tgAccount,onChange:I=>c(N=>({...N,tgAccount:I.target.value})),placeholder:"@username"})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx("label",{className:"text-[10px] font-black uppercase tracking-widest text-gray-500 ml-2",children:"Источник"}),t.jsx("input",{required:!0,className:T,value:o.source,onChange:I=>c(N=>({...N,source:I.target.value})),placeholder:"Откуда узнал?"})]})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{className:"space-y-2",children:[t.jsx("label",{className:"text-[10px] font-black uppercase tracking-widest text-gray-500 ml-2",children:"ID (Авто)"}),t.jsx("input",{readOnly:!0,className:`${T} opacity-50 cursor-not-allowed`,value:x})]}),i&&t.jsxs("div",{className:"space-y-2",children:[t.jsx("label",{className:"text-[10px] font-black uppercase tracking-widest text-gray-500 ml-2",children:"Статус"}),t.jsxs("select",{className:T,value:o.status,onChange:I=>c(N=>({...N,status:I.target.value})),children:[t.jsx("option",{value:"active",children:"Активный"}),t.jsx("option",{value:"inactive",children:"Неактивный"}),t.jsx("option",{value:"deleted",children:"Удаленный"})]})]})]}),m&&t.jsx("div",{className:"p-4 rounded-xl bg-red-500/10 border border-red-500/20 text-red-500 text-xs font-bold text-center",children:m}),t.jsx("button",{type:"submit",disabled:d,className:"w-full relative group overflow-hidden py-5 rounded-[1.25rem] bg-emerald-500 text-white font-black transition-all duration-300 shadow-[0_20px_40px_-10px_rgba(16,185,129,0.3)] hover:shadow-[0_25px_50px_-12px_rgba(16,185,129,0.4)] hover:-translate-y-0.5 active:translate-y-0 active:scale-95 disabled:opacity-50",children:t.jsx("span",{className:"relative z-10 flex items-center justify-center gap-2",children:d?"Сохранение...":s?"Обновить данные":"Создать реферала"})})]})]})})]})},Y4=()=>{const{theme:s}=Re(),{user:e}=ot(),{isAdmin:r}=ft(),{users:a}=ea(),[n,i]=k.useState([]),[o,c]=k.useState(!0),[d,u]=k.useState(!1),[m,f]=k.useState(null),[x,v]=k.useState(!1),T=async()=>{c(!0);const V=await Bd();i(V),c(!1)};k.useEffect(()=>{T()},[]);const I=k.useMemo(()=>n.filter(V=>V.ownerId===(e==null?void 0:e.id)),[n,e]),N=k.useMemo(()=>a.map(V=>{const U=n.filter(y=>y.ownerId===V.id);return{userId:V.id,name:V.name,total:U.length,active:U.filter(y=>y.status==="active"||!y.status).length,inactive:U.filter(y=>y.status==="inactive").length,deleted:U.filter(y=>y.status==="deleted").length}}).sort((V,U)=>U.total-V.total),[a,n]),O=k.useMemo(()=>{const V=new Date,U=new Date(V.getFullYear(),V.getMonth(),1).toISOString();return I.filter(y=>y.createdAt>=U&&(y.status==="active"||!y.status)).length},[I]),D=()=>{if(!r)return;const V=`Кто пригласил	ID	Имя	Телефон	Источник	TG	Статус
`,U=n.map(y=>{var E;return`${((E=a.find(j=>j.id===y.ownerId))==null?void 0:E.name)||"—"}	${y.referralId}	${y.name}	${y.phone||"—"}	${y.source||"—"}	${y.tgAccount||"—"}	${y.status||"active"}`}).join(`
`);navigator.clipboard.writeText(V+U),v(!0),setTimeout(()=>v(!1),2e3)},C=s==="dark"?"text-white":"text-gray-900",M=s==="dark"?"text-gray-400":"text-gray-500";return o?t.jsx("div",{className:"flex items-center justify-center min-h-[60vh]",children:t.jsx("div",{className:"w-12 h-12 border-4 border-emerald-500/20 border-t-emerald-500 rounded-full animate-spin"})}):t.jsxs("div",{className:"space-y-8 animate-in fade-in duration-700",children:[t.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-6",children:[t.jsxs("div",{className:"flex items-center gap-5",children:[t.jsxs("div",{className:"relative",children:[t.jsx("div",{className:"absolute inset-0 bg-pink-500/20 blur-2xl rounded-full"}),t.jsx("div",{className:`relative p-4 rounded-2xl border ${s==="dark"?"bg-pink-500/10 border-pink-500/20 text-pink-400":"bg-pink-50 border-pink-100 text-pink-600 shadow-sm"}`,children:t.jsx(Gt,{className:"w-8 h-8"})})]}),t.jsxs("div",{children:[t.jsx("h1",{className:`text-3xl md:text-4xl font-black tracking-tight ${C}`,children:"AVF Referrals"}),t.jsx("p",{className:`text-sm font-medium ${M}`,children:"Система приглашений и управления рефералами"})]})]}),t.jsxs("button",{onClick:()=>{f(null),u(!0)},className:"flex items-center gap-3 px-8 py-4 rounded-2xl bg-emerald-500 text-white font-black transition-all duration-300 shadow-[0_20px_40px_-10px_rgba(16,185,129,0.3)] hover:shadow-[0_25px_50px_-12px_rgba(16,185,129,0.4)] hover:-translate-y-1 active:translate-y-0 active:scale-95",children:[t.jsx(tm,{className:"w-5 h-5"}),t.jsx("span",{children:"Добавить реферала"})]})]}),t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[t.jsx("div",{className:"lg:col-span-1",children:t.jsx(K4,{count:O,theme:s})}),t.jsxs("div",{className:`lg:col-span-2 rounded-[2rem] border p-8 flex flex-col justify-center gap-6 ${s==="dark"?"bg-[#0b1015] border-white/5":"bg-white border-gray-100"} shadow-2xl`,children:[t.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[t.jsx(xt,{className:"w-6 h-6 text-emerald-500"}),t.jsx("h3",{className:`text-xl font-black tracking-tight ${C}`,children:"Ваша активность"})]}),t.jsxs("p",{className:`text-sm leading-relaxed ${M}`,children:["Приглашайте новых участников и заряжайте батарею! Каждые 5 рефералов открывают новый уровень энергии. Максимальный заряд — ",t.jsx("span",{className:"text-emerald-500 font-black",children:"100% (30 рефералов)"}),". Статистика обнуляется каждое 1-е число месяца."]}),t.jsx("div",{className:"flex flex-wrap gap-4 mt-2",children:["RED: 5 (25%)","ORANGE: 10 (50%)","YELLOW: 20 (75%)","GREEN: 30 (100%)"].map((V,U)=>t.jsx("div",{className:`px-4 py-2 rounded-xl text-[10px] font-black tracking-widest uppercase ${s==="dark"?"bg-white/5 text-gray-400":"bg-gray-50 text-gray-600"}`,children:V},U))})]})]}),t.jsxs("div",{className:"space-y-12",children:[r&&t.jsxs("div",{className:`rounded-[2.5rem] border overflow-hidden ${s==="dark"?"bg-[#0b1015] border-white/5":"bg-white border-gray-100"} shadow-2xl`,children:[t.jsxs("div",{className:"p-8 border-b border-white/5 flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(xt,{className:"w-5 h-5 text-emerald-500"}),t.jsx("h3",{className:`text-xl font-black tracking-tight ${C}`,children:"Панель управления (Admin)"})]}),t.jsx("button",{onClick:D,className:`p-3 rounded-xl transition-all ${x?"bg-emerald-500 text-white":s==="dark"?"bg-white/5 text-gray-400 hover:text-white":"bg-gray-50 text-gray-500 hover:text-emerald-500"}`,children:x?t.jsx(Zr,{className:"w-5 h-5"}):t.jsx(Ws,{className:"w-5 h-5"})})]}),t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"w-full text-left border-collapse",children:[t.jsx("thead",{children:t.jsx("tr",{className:s==="dark"?"bg-white/[0.02]":"bg-gray-50",children:["Кто пригласил","ID","Имя","Телефон","Источник","TG","Статус",""].map(V=>t.jsx("th",{className:"px-6 py-5 text-[10px] font-black uppercase tracking-widest text-gray-500",children:V},V))})}),t.jsx("tbody",{className:"divide-y divide-white/5",children:n.map(V=>{var U;return t.jsxs("tr",{className:`group transition-colors ${s==="dark"?"hover:bg-white/[0.02]":"hover:bg-gray-50/50"}`,children:[t.jsx("td",{className:"px-6 py-4",children:t.jsx("span",{className:`text-sm font-bold ${C}`,children:((U=a.find(y=>y.id===V.ownerId))==null?void 0:U.name)||"—"})}),t.jsx("td",{className:"px-6 py-4",children:t.jsx("span",{className:"text-xs font-mono font-bold text-emerald-500",children:V.referralId})}),t.jsx("td",{className:"px-6 py-4 text-sm font-medium",children:V.name}),t.jsx("td",{className:"px-6 py-4 text-sm font-medium",children:V.phone||"—"}),t.jsx("td",{className:"px-6 py-4 text-sm font-medium",children:V.source||"—"}),t.jsx("td",{className:"px-6 py-4",children:t.jsx("span",{className:"text-xs font-bold text-pink-500",children:V.tgAccount||"—"})}),t.jsx("td",{className:"px-6 py-4",children:t.jsx("span",{className:`px-3 py-1 rounded-full text-[10px] font-black uppercase tracking-widest ${V.status==="active"||!V.status?"bg-emerald-500/10 text-emerald-500":V.status==="inactive"?"bg-amber-500/10 text-amber-500":"bg-rose-500/10 text-rose-500"}`,children:V.status||"active"})}),t.jsx("td",{className:"px-6 py-4 text-right",children:t.jsx("button",{onClick:()=>{f(V),u(!0)},className:`p-2 rounded-lg opacity-0 group-hover:opacity-100 transition-all ${s==="dark"?"hover:bg-white/10 text-gray-400 hover:text-white":"hover:bg-emerald-50 text-gray-400 hover:text-emerald-500"}`,children:t.jsx(J4,{className:"w-4 h-4"})})})]},V.id)})})]})})]}),!r&&t.jsxs("div",{className:`rounded-[2.5rem] border overflow-hidden ${s==="dark"?"bg-[#0b1015] border-white/5":"bg-white border-gray-100"} shadow-2xl`,children:[t.jsx("div",{className:"p-8 border-b border-white/5 flex items-center justify-between",children:t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(Pr,{className:"w-5 h-5 text-pink-500"}),t.jsx("h3",{className:`text-xl font-black tracking-tight ${C}`,children:"Ваши рефералы"})]})}),t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"w-full text-left border-collapse",children:[t.jsx("thead",{children:t.jsx("tr",{className:s==="dark"?"bg-white/[0.02]":"bg-gray-50",children:["ID","Имя","Телефон","Источник","TG","Статус"].map(V=>t.jsx("th",{className:"px-6 py-5 text-[10px] font-black uppercase tracking-widest text-gray-500",children:V},V))})}),t.jsx("tbody",{className:"divide-y divide-white/5",children:I.length>0?I.map(V=>t.jsxs("tr",{className:`group transition-colors ${s==="dark"?"hover:bg-white/[0.02]":"hover:bg-gray-50/50"}`,children:[t.jsx("td",{className:"px-6 py-4",children:t.jsx("span",{className:"text-xs font-mono font-bold text-emerald-500",children:V.referralId})}),t.jsx("td",{className:"px-6 py-4 text-sm font-medium",children:V.name}),t.jsx("td",{className:"px-6 py-4 text-sm font-medium",children:V.phone||"—"}),t.jsx("td",{className:"px-6 py-4 text-sm font-medium",children:V.source||"—"}),t.jsx("td",{className:"px-6 py-4",children:t.jsx("span",{className:"text-xs font-bold text-pink-500",children:V.tgAccount||"—"})}),t.jsx("td",{className:"px-6 py-4",children:t.jsx("span",{className:`px-3 py-1 rounded-full text-[10px] font-black uppercase tracking-widest ${V.status==="active"||!V.status?"bg-emerald-500/10 text-emerald-500":V.status==="inactive"?"bg-amber-500/10 text-amber-500":"bg-rose-500/10 text-rose-500"}`,children:V.status||"active"})})]},V.id)):t.jsx("tr",{children:t.jsx("td",{colSpan:6,className:"px-6 py-12 text-center text-gray-500 font-bold uppercase tracking-widest text-xs",children:"Рефералов пока нет"})})})]})})]}),t.jsxs("div",{className:`rounded-[2.5rem] border overflow-hidden ${s==="dark"?"bg-[#0b1015] border-white/5":"bg-white border-gray-100"} shadow-2xl`,children:[t.jsx("div",{className:"p-8 border-b border-white/5",children:t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(it,{className:"w-5 h-5 text-emerald-500"}),t.jsx("h3",{className:`text-xl font-black tracking-tight ${C}`,children:"Общая статистика"})]})}),t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"w-full text-left border-collapse",children:[t.jsx("thead",{children:t.jsx("tr",{className:s==="dark"?"bg-white/[0.02]":"bg-gray-50",children:["Участник","Всего","Активные","Неактивные","Удаленные"].map(V=>t.jsx("th",{className:"px-6 py-5 text-[10px] font-black uppercase tracking-widest text-gray-500",children:V},V))})}),t.jsx("tbody",{className:"divide-y divide-white/5",children:N.map(V=>t.jsxs("tr",{className:`group transition-colors ${s==="dark"?"hover:bg-white/[0.02]":"hover:bg-gray-50/50"} ${V.userId===(e==null?void 0:e.id)?s==="dark"?"bg-emerald-500/5":"bg-emerald-50/50":""}`,children:[t.jsxs("td",{className:"px-6 py-4 flex items-center gap-3",children:[t.jsx("div",{className:`w-8 h-8 rounded-lg flex items-center justify-center font-black text-xs ${s==="dark"?"bg-white/5 text-emerald-400":"bg-emerald-50 text-emerald-600"}`,children:V.name[0]}),t.jsx("span",{className:`text-sm font-bold ${C}`,children:V.name})]}),t.jsx("td",{className:"px-6 py-4 font-black",children:V.total}),t.jsx("td",{className:"px-6 py-4 text-emerald-500 font-bold",children:V.active}),t.jsx("td",{className:"px-6 py-4 text-amber-500 font-bold",children:V.inactive}),t.jsx("td",{className:"px-6 py-4 text-rose-500 font-bold",children:V.deleted})]},V.userId))})]})})]})]}),d&&t.jsx(Q4,{referral:m,onClose:()=>{u(!1),f(null)},onSave:()=>{u(!1),f(null),T()},theme:s})]})},X4=({className:s})=>t.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:s,children:[t.jsx("path",{d:"M18 6 6 18"}),t.jsx("path",{d:"m6 6 12 12"})]}),J4=({className:s})=>t.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:s,children:[t.jsx("path",{d:"M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z"}),t.jsx("path",{d:"m15 5 4 4"})]}),Z4=()=>{const{theme:s}=Re(),e=s==="dark"?"text-white":"text-gray-900";return t.jsxs("div",{className:"space-y-6",children:[t.jsx("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsx("div",{className:"p-3 bg-emerald-500/10 rounded-2xl border border-emerald-500/20",children:t.jsx(ka,{className:"w-8 h-8 text-emerald-500"})}),t.jsxs("div",{children:[t.jsx("h1",{className:`text-2xl md:text-3xl font-black tracking-tight ${e}`,children:"Анализ токенов"}),t.jsx("p",{className:`text-sm font-medium ${s==="dark"?"text-gray-400":"text-gray-500"}`,children:"Инструменты анализа и статистики токенов"})]})]})}),t.jsxs("div",{className:`flex flex-col items-center justify-center min-h-[400px] rounded-3xl border ${s==="dark"?"bg-[#0b1015] border-white/5":"bg-white border-gray-100"}`,children:[t.jsx("div",{className:"p-4 bg-emerald-500/10 rounded-full mb-4",children:t.jsx(wf,{className:"w-12 h-12 text-emerald-500"})}),t.jsx("h2",{className:`text-xl font-bold mb-2 ${e}`,children:"Раздел в разработке"}),t.jsx("p",{className:`text-center max-w-md ${s==="dark"?"text-gray-400":"text-gray-500"}`,children:"Мы работаем над созданием мощных инструментов для анализа токенов. Следите за обновлениями!"})]})]})},xr=({children:s})=>{const{isAuthenticated:e,user:r}=ot(),{isAdmin:a}=ft(),{theme:n}=Re(),i=C0(),[o,c]=k.useState(null),[d,u]=k.useState(""),[m,f]=k.useState();if(!e&&!a)return t.jsx(Hi,{to:"/login",replace:!0});const x=v=>v==="/admin"?"admin":v==="/management"?"slots":v==="/earnings"?"earnings":v==="/tasks"?"tasks":v==="/rating"?"rating":v==="/profile"?"profile":v==="/approvals"?"admin":v==="/call"?"avf_hub":v==="/about"?"about":v==="/meme-evaluation"?"tools_meme_evaluation":v==="/ai-ao-alerts"?"tools_ai_ao_alerts":v==="/signals-trigger-bot"?"tools_signals_trigger_bot":v.startsWith("/tools")?"tools":"login";if(k.useEffect(()=>{(async()=>{if(!r||a){c(!0);return}const T=x(i.pathname);try{const I=await zd(r.id,T);c(I.hasAccess),u(I.reason||"Доступ запрещен"),f(I.expiresAt)}catch(I){console.error("Error checking access:",I),c(!0)}})()},[r,a,i.pathname]),o===null)return t.jsx("div",{className:`flex items-center justify-center min-h-screen ${n==="dark"?"bg-slate-950":"bg-gray-100"}`,children:t.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-4 border-[#4E6E49] border-t-transparent"})});if(!o){const v=V=>{if(!V)return"навсегда";const U=new Date(V);return U<=new Date?"навсегда":U.toLocaleString("ru-RU",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})},T=n==="dark"?"bg-slate-950":"bg-gray-100",I=n==="dark"?"bg-gradient-to-br from-[#0c1320] via-[#0b1220] to-[#08111b] border-white/10":"bg-white border-slate-200",N=n==="dark"?"text-white":"text-gray-900",O=n==="dark"?"text-gray-400":"text-gray-600",D=n==="dark"?"bg-red-900/30":"bg-red-100",C=n==="dark"?"text-red-400":"text-red-600",M=n==="dark"?"bg-gray-800":"bg-gray-50";return t.jsx("div",{className:`flex items-center justify-center min-h-screen p-4 ${T}`,children:t.jsxs("div",{className:`max-w-md w-full ${I} rounded-2xl shadow-2xl border p-8 text-center`,children:[t.jsxs("div",{className:"mb-6",children:[t.jsx("div",{className:`w-16 h-16 ${D} rounded-full flex items-center justify-center mx-auto mb-4`,children:t.jsx(Co,{className:`w-8 h-8 ${C}`})}),t.jsx("h2",{className:`text-xl font-bold ${N} mb-2`,children:"Доступ запрещен"}),t.jsx("p",{className:`${O}`,children:d})]}),m&&t.jsx("div",{className:`${M} rounded-lg p-4 mb-4`,children:t.jsxs("div",{className:`flex items-center justify-center gap-2 text-sm ${O}`,children:[t.jsx(Lt,{className:"w-4 h-4"}),t.jsxs("span",{children:["Блокировка до: ",v(m)]})]})})]})})}return t.jsx(t.Fragment,{children:s})},eE=()=>{const{user:s}=ot(),{theme:e}=Re(),[r,a]=k.useState(""),[n,i]=k.useState(),[o,c]=k.useState(!0),[d,u]=k.useState(!1);if(k.useEffect(()=>{(async()=>{if(!s){c(!1);return}try{const y=await zd(s.id,"all");y.hasAccess?u(!1):(a(y.reason||"Доступ заблокирован"),i(y.expiresAt),u(!0))}catch(y){console.error("Error checking access:",y),a("Ошибка проверки доступа"),u(!0)}finally{c(!1)}})()},[s]),!d)return null;if(o)return t.jsx("div",{className:`fixed inset-0 flex items-center justify-center z-50 ${e==="dark"?"bg-slate-950":"bg-gray-100"}`,children:t.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-4 border-[#4E6E49] border-t-transparent"})});if(!r)return null;const m=U=>{if(!U)return"навсегда";const y=new Date(U);return y<=new Date?"навсегда":y.toLocaleString("ru-RU",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})},f=e==="dark"?"bg-slate-950":"bg-gray-100",x=e==="dark"?"bg-gradient-to-br from-[#0c1320] via-[#0b1220] to-[#08111b] border-white/10":"bg-white border-slate-200",v=e==="dark"?"text-white":"text-gray-900",T=e==="dark"?"text-gray-400":"text-gray-600",I=e==="dark"?"bg-red-900/30":"bg-red-100",N=e==="dark"?"text-red-400":"text-red-600",O=e==="dark"?"bg-gray-800":"bg-gray-50",D=e==="dark"?"bg-amber-900/20 border-amber-800":"bg-amber-50 border-amber-200",C=e==="dark"?"text-amber-200":"text-amber-800",M=e==="dark"?"text-amber-300":"text-amber-700",V=e==="dark"?"text-amber-400":"text-amber-600";return t.jsx("div",{className:`fixed inset-0 ${f} flex items-center justify-center z-50 p-4`,children:t.jsxs("div",{className:`max-w-md w-full ${x} rounded-2xl shadow-2xl border p-8 text-center`,children:[t.jsxs("div",{className:"mb-6",children:[t.jsx("div",{className:`w-16 h-16 ${I} rounded-full flex items-center justify-center mx-auto mb-4`,children:t.jsx(Co,{className:`w-8 h-8 ${N}`})}),t.jsx("h1",{className:`text-2xl font-bold ${v} mb-2`,children:"Доступ заблокирован"}),t.jsx("p",{className:`${T} mb-4`,children:r})]}),t.jsx("div",{className:`${O} rounded-lg p-4 mb-6`,children:t.jsxs("div",{className:`flex items-center justify-center gap-2 text-sm ${T}`,children:[t.jsx(Lt,{className:"w-4 h-4"}),t.jsxs("span",{children:["Блокировка до: ",m(n)]})]})}),t.jsx("div",{className:`${D} border rounded-lg p-4`,children:t.jsxs("div",{className:"flex items-start gap-3",children:[t.jsx(nr,{className:`w-5 h-5 ${V} flex-shrink-0 mt-0.5`}),t.jsxs("div",{className:"text-left",children:[t.jsx("p",{className:`text-sm font-medium ${C} mb-1`,children:"Свяжитесь с администратором"}),t.jsx("p",{className:`text-sm ${M}`,children:"Для восстановления доступа обратитесь к администратору системы"})]})]})}),t.jsx("div",{className:"mt-6 text-xs text-gray-500 dark:text-gray-500",children:"ApeVault Team"})]})})},tE=s=>s.includes("Chrome")&&!s.includes("Edg")&&!s.includes("OPR")?"Chrome":s.includes("Firefox")?"Firefox":s.includes("Safari")&&!s.includes("Chrome")?"Safari":s.includes("Edg")?"Edge":s.includes("OPR")?"Opera":"Unknown",rE=()=>{const{user:s}=ot(),e=k.useRef(null),r=k.useRef(Date.now()),a=k.useRef(!1);k.useEffect(()=>{if(!(s!=null&&s.id)||a.current)return;(async()=>{a.current=!0,r.current=Date.now();const d=navigator.userAgent,u=tE(d);try{const m=await j_({userId:s.id,loginAt:new Date().toISOString(),browser:u,userAgent:d,isActive:!0,pageViews:[]});e.current=m}catch(m){console.error("Failed to track user activity:",m)}})();const i=()=>{if(e.current){const d=Date.now(),u=Math.floor((d-r.current)/1e3);Fl(e.current,new Date().toISOString(),u).catch(m=>console.error("Failed to update activity on unload:",m))}},o=setInterval(async()=>{if(e.current&&!document.hidden){const d=Date.now(),u=Math.floor((d-r.current)/1e3);try{await Sc(e.current,{sessionDuration:u,isActive:!0})}catch(m){console.error("Failed to update activity duration:",m)}}},3e4),c=async()=>{if(document.hidden&&e.current){const d=Date.now(),u=Math.floor((d-r.current)/1e3);try{await Fl(e.current,new Date().toISOString(),u)}catch(m){console.error("Failed to update activity on visibility change:",m)}}else if(!document.hidden&&e.current)try{await Sc(e.current,{isActive:!0})}catch(d){console.error("Failed to reactivate activity:",d)}};return window.addEventListener("beforeunload",i),document.addEventListener("visibilitychange",c),()=>{if(clearInterval(o),window.removeEventListener("beforeunload",i),document.removeEventListener("visibilitychange",c),e.current){const d=Date.now(),u=Math.floor((d-r.current)/1e3);Fl(e.current,new Date().toISOString(),u).catch(m=>console.error("Failed to update activity on unmount:",m))}}},[s==null?void 0:s.id])},sE=({children:s})=>{const{theme:e,toggleTheme:r}=Re(),{isAdmin:a,activateAdmin:n,deactivateAdmin:i}=ft(),{user:o,logout:c}=ot(),{viewedUserId:d}=Wd(),u=C0(),[m,f]=k.useState(!1),[x,v]=k.useState(!1),[T,I]=k.useState(!1),[N,O]=k.useState(()=>localStorage.getItem("sidebarCollapsed")==="true"),[D]=k.useState([]),[C,M]=k.useState(new Set),[V,U]=k.useState(!0),y=Jp(o==null?void 0:o.id,a,d);rE(),k.useEffect(()=>{(async()=>{U(!0);try{if(!o||a){M(new Set(["slots","earnings","tasks","rating","referrals","profile","admin","tools","tools_strategies","tools_ai_ao_alerts","tools_our_deals_analysis"]));return}const ee=["slots","earnings","tasks","rating","referrals","profile","about","tools","tools_strategies","tools_events","avf_hub"],te=new Set;for(const Y of ee)try{(await zd(y||"",Y)).hasAccess&&te.add(Y)}catch{te.add(Y)}M(te)}finally{U(!1)}})()},[o,a,y]);const b=[{path:"/call",label:"AVF HUB",icon:J0,feature:"avf_hub"},{path:"/management",label:"AVF Schedule",icon:ir,feature:"slots"},{path:"/tasks",label:"AVF Tasks",icon:da,feature:"tasks"},{path:"/earnings",label:"AVF Profit",icon:qa,feature:"earnings"},{path:"/rating",label:"AVF Score",icon:it,feature:"rating"},{path:"/referrals",label:"AVF Referrals",icon:Gt,feature:"referrals"},{path:"/about",label:"AVF INFO",icon:Wt,feature:"about"},...a?[{path:"/approvals",label:"AVF Check",icon:Ir,feature:"admin"},{path:"/admin",label:"AVF Admin",icon:xt,feature:"admin"}]:[]],E=b.filter(L=>!L.feature||C.has(L.feature)||a),j=[{path:"/strategies",label:"AVF Контур",icon:it,feature:"tools_strategies"},{path:"/token-analysis",label:"Анализ токенов",icon:ka,feature:"tools_strategies"},{path:"/events",label:"События",icon:B0,feature:"tools_events"}],A=j.filter(L=>C.has(L.feature)||a),w=j.some(L=>u.pathname===L.path),g=()=>{const L=!N;O(L),localStorage.setItem("sidebarCollapsed",String(L))},$=L=>L.split(" ").map(ee=>ee[0]).join("").toUpperCase().substring(0,2);return t.jsxs("div",{className:`min-h-screen ${e==="dark"?"dark bg-[#0b0f17]":"bg-[#f8fafc]"}`,children:[t.jsxs("div",{className:"absolute inset-0 pointer-events-none -z-10 overflow-hidden",children:[t.jsx("div",{className:"absolute -top-24 -left-12 w-80 h-80 bg-gradient-to-br from-[#4E6E49]/25 via-transparent to-transparent blur-3xl"}),t.jsx("div",{className:"absolute top-8 right-0 w-[520px] h-[520px] bg-gradient-to-bl from-blue-500/12 via-purple-500/10 to-transparent blur-3xl"}),t.jsx("div",{className:"absolute bottom-[-120px] left-12 w-96 h-96 bg-gradient-to-tr from-amber-400/10 to-[#4E6E49]/12 blur-3xl"}),t.jsx("div",{className:"floating-grid"})]}),t.jsxs("div",{className:"flex flex-col lg:flex-row min-h-screen",children:[t.jsxs("aside",{className:`hidden xl:flex ${N?"w-20":"w-72"} h-screen fixed left-0 top-0 flex-col glass-panel border-r border-white/40 dark:border-white/10 z-50 transition-all duration-500 ease-[cubic-bezier(0.4,0,0.2,1)] ${N?"overflow-visible":""}`,children:[t.jsx("div",{className:"accent-dots"}),t.jsx("button",{onClick:g,className:`absolute top-6 -right-0 transition-all duration-500 z-50 ${N?"right-1/2 translate-x-1/2":"right-4"} p-2 rounded-xl bg-[#4E6E49]/10 hover:bg-[#4E6E49]/20 text-[#4E6E49] dark:text-gray-400 dark:hover:text-white border border-[#4E6E49]/20 dark:border-white/10 group`,children:N?t.jsx(Vf,{className:"w-5 h-5 transition-transform group-hover:scale-110"}):t.jsx(Of,{className:"w-5 h-5 transition-transform group-hover:scale-110"})}),t.jsx("div",{className:`p-6 pb-2 transition-all duration-500 origin-left overflow-hidden ${N?"opacity-0 scale-90 w-0 px-0 translate-x-[-100%]":"opacity-100 scale-100"}`,children:t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"w-10 h-10 flex items-center justify-center",children:t.jsx("img",{src:$n,alt:"ApeVault",className:"w-9 h-9 object-contain rounded-xl filter drop-shadow-[0_0_8px_rgba(78,110,73,0.3)]"})}),t.jsxs("div",{className:"flex flex-col whitespace-nowrap",children:[t.jsx("span",{className:"text-sm font-black tracking-widest text-[#4E6E49] dark:text-white uppercase transition-opacity duration-300",children:"ApeVault"}),t.jsx("span",{className:"text-[10px] font-bold text-gray-400 -mt-1 uppercase tracking-tighter transition-opacity duration-300",children:"Frontier"})]})]})}),t.jsxs("div",{className:`relative z-10 px-6 pb-4 flex items-center gap-2 transition-all duration-500 ${N?"flex-col px-4 items-center":""}`,children:[t.jsx("button",{onClick:r,className:"flex-1 flex items-center justify-center p-2 rounded-xl border border-gray-200 dark:border-white/10 hover:bg-gray-100 dark:hover:bg-white/5 transition-colors w-full",children:e==="dark"?t.jsx(eo,{className:"w-4 h-4 text-amber-300"}):t.jsx(Zi,{className:"w-4 h-4 text-gray-700"})}),!N&&t.jsxs("button",{onClick:()=>I(!T),className:`flex-1 flex items-center justify-center relative p-2 rounded-xl border border-gray-200 dark:border-white/10 hover:bg-gray-100 dark:hover:bg-white/5 transition-colors w-full ${T?"bg-amber-500/10":""}`,children:[t.jsx(F0,{className:"w-4 h-4"}),D.length>0&&t.jsx("span",{className:"absolute top-2 right-[35%] w-2 h-2 bg-red-500 rounded-full"})]})]}),T&&t.jsx("div",{className:"mx-4 mb-4 p-3 glass-panel rounded-xl border border-white/20 shadow-xl max-h-60 overflow-y-auto space-y-2 relative z-20",children:D.length===0?t.jsx("p",{className:"text-[10px] text-gray-500",children:"Нет уведомлений"}):D.map(L=>t.jsxs("div",{className:"text-[10px] p-2 rounded-lg bg-black/5 dark:bg-white/5",children:[t.jsx("p",{className:"font-bold",children:L.text}),t.jsx("p",{className:"opacity-60",children:L.time})]},L.id))}),t.jsx("div",{className:`h-px w-full bg-gradient-to-r from-transparent via-gray-200/50 dark:via-white/10 to-transparent my-2 transition-opacity duration-500 ${N?"opacity-0":"opacity-100"}`}),t.jsx("nav",{className:"relative z-10 flex-1 px-4 py-4 space-y-1 overflow-visible no-scrollbar",children:t.jsxs(t.Fragment,{children:[(a||C.has("tools")||V)&&t.jsxs("div",{className:"space-y-1 relative group/tools",children:[t.jsxs("button",{onClick:()=>!N&&f(!m),className:`w-full flex items-center gap-3 px-4 py-3 rounded-xl transition-all duration-300 ${w?"bg-[#4E6E49]/15 text-[#4E6E49]":"text-gray-500 hover:bg-gray-100/50 dark:hover:bg-white/5"} ${N?"justify-center px-0":""}`,children:[t.jsx(oa,{className:`w-4 h-4 transition-transform duration-500 ${N?"group-hover/tools:rotate-90":""}`}),!N&&t.jsxs(t.Fragment,{children:[t.jsx("span",{className:"font-bold flex-1 text-left",children:"Tools"}),t.jsx(Dr,{className:`w-4 h-4 transition-transform ${m?"rotate-180":""}`})]})]}),N&&t.jsx("div",{className:"absolute left-full top-0 invisible group-hover/tools:visible opacity-0 group-hover/tools:opacity-100 transition-all duration-300 translate-x-3 group-hover/tools:translate-x-1 z-[100]",children:t.jsxs("div",{className:"ml-2 glass-panel border border-white/40 dark:border-white/10 rounded-2xl p-2 min-w-[200px] shadow-2xl backdrop-blur-2xl",children:[t.jsx("div",{className:"px-3 py-2 mb-1 border-b border-white/10",children:t.jsx("p",{className:"text-[10px] font-black uppercase tracking-widest text-[#4E6E49]",children:"Инструменты"})}),A.map(L=>t.jsxs(zr,{to:L.path,className:`flex items-center gap-3 px-3 py-2.5 rounded-xl text-sm font-bold transition-all ${u.pathname===L.path?"bg-[#4E6E49] text-white":"text-gray-500 hover:bg-[#4E6E49]/10 hover:text-[#4E6E49]"}`,children:[t.jsx(L.icon,{className:"w-3.5 h-3.5"}),t.jsx("span",{children:L.label})]},L.path))]})}),m&&!N&&t.jsxs("div",{className:"absolute left-0 top-full mt-1 pl-4 pr-2 py-2 glass-panel border border-white/40 dark:border-white/10 rounded-xl shadow-2xl backdrop-blur-2xl z-[100] min-w-[200px] animate-in fade-in slide-in-from-top-2 duration-200",children:[t.jsx("div",{className:"px-3 py-2 mb-1 border-b border-white/10",children:t.jsx("p",{className:"text-[10px] font-black uppercase tracking-widest text-[#4E6E49]",children:"Инструменты"})}),A.map(L=>t.jsxs(zr,{to:L.path,className:`flex items-center gap-3 px-3 py-2.5 rounded-xl text-sm font-bold transition-all ${u.pathname===L.path?"bg-[#4E6E49] text-white":"text-gray-500 hover:bg-[#4E6E49]/10 hover:text-[#4E6E49]"}`,children:[t.jsx(L.icon,{className:"w-3.5 h-3.5"}),t.jsx("span",{children:L.label})]},L.path))]})]}),b.filter(L=>a||V?!0:!L.feature||C.has(L.feature)).map(L=>t.jsxs(zr,{to:L.path,className:`flex items-center gap-3 px-4 py-3 rounded-xl transition-all duration-300 ${u.pathname===L.path?"bg-[#4E6E49] text-white shadow-lg shadow-[#4E6E49]/30":"text-gray-500 hover:bg-gray-100/50 dark:hover:bg-white/5 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white"} ${N?"justify-center px-0":""}`,children:[t.jsx(L.icon,{className:"w-4 h-4"}),!N&&t.jsx("span",{className:"font-bold text-sm tracking-tight",children:L.label})]},L.path))]})}),t.jsxs("div",{className:`relative z-10 m-4 space-y-2 transition-all duration-500 ${N?"m-2 space-y-4":""}`,children:[t.jsxs(zr,{to:"/profile",className:`p-4 rounded-2xl flex items-center gap-3 transition-all group ${u.pathname==="/profile"?"bg-[#4E6E49]/10 border border-[#4E6E49]/30":"border border-gray-200/50 dark:border-white/5 hover:bg-gray-100/50 dark:hover:bg-white/5"} ${N?"p-0 h-12 w-12 items-center justify-center mx-auto border-0":""}`,children:[t.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center text-[#4E6E49] font-bold shadow-inner shrink-0 ${e==="dark"?"bg-emerald-500/20 text-[#4E6E49]":"bg-[#4E6E49]/10 text-[#4E6E49]"}`,children:o!=null&&o.avatar?t.jsx("img",{src:o.avatar,className:"w-full h-full rounded-full object-cover"}):$((o==null?void 0:o.name)||"User")}),!N&&t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("p",{className:"text-sm font-bold truncate dark:text-white",children:(o==null?void 0:o.name)||"Administrator"}),t.jsx("p",{className:"text-[10px] text-gray-500 font-medium truncate",children:(o==null?void 0:o.login)||"admin@apevault.io"})]}),t.jsx(Qi,{className:"w-4 h-4 text-gray-400 group-hover:text-[#4E6E49] transition-colors"})]})]}),t.jsxs("div",{className:"flex gap-2 transition-all duration-500 flex-col gap-4 px-2",children:[t.jsxs("button",{onClick:()=>{c(),i(),window.location.href="/login"},className:`flex items-center justify-center gap-2 py-2.5 rounded-xl border border-red-500/20 bg-red-500/5 text-red-500 hover:bg-red-500/10 transition-colors text-xs font-bold ${N?"w-10 h-10 px-0 border-0":"w-full"}`,children:[t.jsx(Gl,{className:"w-3.5 h-3.5"}),!N&&t.jsx("span",{children:"Выйти"})]}),(o==null?void 0:o.name)==="Артём"&&!a&&t.jsxs("button",{onClick:()=>n(Dc),className:`flex items-center justify-center gap-2 py-2.5 rounded-xl border border-[#4E6E49]/20 bg-[#4E6E49]/5 text-[#4E6E49] hover:bg-[#4E6E49]/10 transition-colors text-xs font-bold ${N?"w-10 h-10 px-0 border-0":"w-full"}`,children:[t.jsx(xt,{className:"w-3.5 h-3.5"}),!N&&t.jsx("span",{children:"Админ"})]}),a&&t.jsxs("button",{onClick:i,className:`flex items-center justify-center gap-2 py-2.5 rounded-xl border border-amber-500/20 bg-amber-500/5 text-amber-500 hover:bg-amber-500/10 transition-colors text-xs font-bold ${N?"w-10 h-10 px-0 border-0":"w-full"}`,children:[t.jsx(rm,{className:"w-3.5 h-3.5"}),!N&&t.jsx("span",{children:"Стоп"})]})]})]})]}),t.jsx("div",{className:`flex-1 ${N?"xl:pl-20":"xl:pl-72"} min-h-screen transition-all duration-500 ease-[cubic-bezier(0.4,0,0.2,1)]`,children:t.jsxs("main",{className:"page-shell lg:pb-14 pb-6 lg:pt-3 transition-all duration-300",children:[t.jsx("div",{className:"xl:hidden h-[65px]"})," ",s]})}),t.jsxs("div",{className:`xl:hidden fixed top-0 left-0 right-0 z-50 px-4 py-3 border-b flex items-center justify-between transition-colors duration-300 backdrop-blur-xl ${e==="dark"?"bg-[#0b0f17]/80 border-white/10":"bg-white/80 border-gray-200"}`,children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"w-8 h-8 flex items-center justify-center",children:t.jsx("img",{src:$n,alt:"ApeVault",className:"w-7 h-7 object-contain rounded-xl filter drop-shadow-[0_0_8px_rgba(78,110,73,0.3)]"})}),t.jsx("span",{className:`text-sm font-black tracking-widest uppercase ${e==="dark"?"text-white":"text-gray-900"}`,children:"ApeVault"})]}),t.jsx("button",{onClick:()=>v(!0),className:`p-2 rounded-xl transition-colors ${e==="dark"?"bg-[#4E6E49]/10 text-white hover:bg-[#4E6E49]/20":"bg-[#4E6E49]/10 text-[#4E6E49] hover:bg-[#4E6E49]/20"}`,children:t.jsx(Df,{className:"w-6 h-6"})})]}),x&&t.jsxs("div",{className:`fixed inset-0 z-[100] flex flex-col animate-in slide-in-from-right duration-300 ${e==="dark"?"bg-[#0b0f17]":"bg-white"}`,children:[t.jsxs("div",{className:`flex items-center justify-between px-4 py-3 border-b ${e==="dark"?"border-white/10":"border-gray-100"}`,children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"w-8 h-8 flex items-center justify-center",children:t.jsx("img",{src:$n,alt:"ApeVault",className:"w-7 h-7 object-contain rounded-xl"})}),t.jsx("span",{className:`text-sm font-black tracking-widest uppercase ${e==="dark"?"text-white":"text-gray-900"}`,children:"Menu"})]}),t.jsx("button",{onClick:()=>v(!1),className:`p-2 rounded-xl transition-colors ${e==="dark"?"bg-white/5 text-white hover:bg-white/10":"bg-gray-100 text-gray-900 hover:bg-gray-200"}`,children:t.jsx(pt,{className:"w-6 h-6"})})]}),t.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-6",children:[t.jsxs("div",{className:`flex items-center gap-3 p-4 rounded-2xl border ${e==="dark"?"bg-white/5 border-white/10":"bg-gray-50 border-gray-100"}`,children:[t.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center text-[#4E6E49] font-bold",children:o!=null&&o.avatar?t.jsx("img",{src:o.avatar,className:"w-full h-full rounded-full object-cover"}):$((o==null?void 0:o.name)||"User")}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("p",{className:`text-sm font-bold truncate ${e==="dark"?"text-white":"text-gray-900"}`,children:(o==null?void 0:o.name)||"Guest"}),t.jsx(zr,{to:"/profile",onClick:()=>v(!1),className:"text-xs text-[#4E6E49] hover:underline",children:"Перейти в профиль"})]})]}),(a||C.has("tools"))&&t.jsxs("div",{className:"space-y-3",children:[t.jsx("p",{className:"text-xs font-bold text-gray-500 uppercase tracking-wider px-2",children:"Инструменты"}),t.jsx("div",{className:"grid grid-cols-2 gap-3",children:A.map(L=>t.jsxs(zr,{to:L.path,onClick:()=>v(!1),className:`flex flex-col items-center justify-center gap-2 p-3 rounded-xl border transition-all ${u.pathname===L.path?"border-[#4E6E49]/50 bg-[#4E6E49]/10":e==="dark"?"border-white/10 bg-white/5 hover:bg-white/10":"border-gray-100 bg-gray-50 hover:bg-gray-100"}`,children:[t.jsx(L.icon,{className:`w-6 h-6 ${u.pathname===L.path?"text-[#4E6E49]":"text-gray-400"}`}),t.jsx("span",{className:`text-xs font-medium text-center ${e==="dark"?"text-gray-300":"text-gray-700"}`,children:L.label})]},L.path))})]}),t.jsxs("div",{className:"space-y-3",children:[t.jsx("p",{className:"text-xs font-bold text-gray-500 uppercase tracking-wider px-2 pt-2",children:"Функции"}),t.jsx("div",{className:"space-y-2",children:E.map(L=>t.jsxs(zr,{to:L.path,onClick:()=>v(!1),className:`flex items-center gap-3 p-3 rounded-xl transition-all ${u.pathname===L.path?"bg-[#4E6E49] text-white shadow-lg":e==="dark"?"text-gray-400 hover:bg-white/5 hover:text-white":"text-gray-500 hover:bg-gray-100 hover:text-gray-900"}`,children:[t.jsx(L.icon,{className:"w-5 h-5"}),t.jsx("span",{className:"font-bold text-sm",children:L.label}),t.jsx(Qi,{className:"w-4 h-4 ml-auto opacity-50"})]},L.path))})]}),t.jsxs("button",{onClick:r,className:`w-full flex items-center justify-between p-4 rounded-xl border ${e==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-gray-50"}`,children:[t.jsx("span",{className:`text-sm font-medium ${e==="dark"?"text-gray-300":"text-gray-700"}`,children:"Тема оформления"}),e==="dark"?t.jsx(eo,{className:"w-4 h-4 text-amber-300"}):t.jsx(Zi,{className:"w-4 h-4 text-gray-600"})]}),t.jsxs("button",{onClick:()=>{c(),i(),window.location.href="/login"},className:`w-full flex items-center justify-center gap-2 p-4 rounded-xl border font-bold ${e==="dark"?"border-red-500/20 bg-red-500/10 text-red-500":"border-red-200 bg-red-50 text-red-600"}`,children:[t.jsx(Gl,{className:"w-4 h-4"}),t.jsx("span",{children:"Выйти из аккаунта"})]})]})]})]})]})},aE=()=>t.jsx(sE,{children:t.jsx(wx,{})});function nE(){const{isAuthenticated:s}=ot(),{isAdmin:e}=ft(),{theme:r}=Re();return k.useEffect(()=>{document.body.classList.toggle("dark",r==="dark")},[r]),k.useEffect(()=>{s_().catch(a=>console.error("Cleanup failed",a))},[]),t.jsxs(kx,{children:[t.jsx(eE,{}),t.jsxs(jx,{children:[t.jsx(zt,{path:"/login",element:!s&&!e?t.jsx(sb,{}):t.jsx(Hi,{to:"/management",replace:!0})}),t.jsxs(zt,{element:t.jsx(aE,{}),children:[t.jsx(zt,{path:"/call",element:t.jsx(xr,{children:t.jsx(z_,{})})}),t.jsx(zt,{path:"/management",element:t.jsx(xr,{children:t.jsx(t4,{})})}),t.jsx(zt,{path:"/earnings",element:t.jsx(xr,{children:t.jsx(d4,{})})}),t.jsx(zt,{path:"/rating",element:t.jsx(xr,{children:t.jsx(m4,{})})}),t.jsx(zt,{path:"/referrals",element:t.jsx(xr,{children:t.jsx(Y4,{})})}),t.jsx(zt,{path:"/tasks",element:t.jsx(xr,{children:t.jsx(b4,{})})}),t.jsx(zt,{path:"/about",element:t.jsx(xr,{children:t.jsx(N4,{})})}),t.jsx(zt,{path:"/rules",element:t.jsx(xr,{children:t.jsx(_4,{})})}),t.jsx(zt,{path:"/approvals",element:t.jsx(xr,{children:t.jsx(C4,{})})}),t.jsx(zt,{path:"/admin",element:t.jsx(xr,{children:t.jsx(w4,{})})}),t.jsx(zt,{path:"/profile",element:t.jsx(xr,{children:t.jsx(j4,{})})}),t.jsx(zt,{path:"/strategies",element:t.jsx(xr,{children:t.jsx(M4,{})})}),t.jsx(zt,{path:"/events",element:t.jsx(xr,{children:t.jsx(G4,{})})}),t.jsx(zt,{path:"/token-analysis",element:t.jsx(xr,{children:t.jsx(Z4,{})})})]}),t.jsx(zt,{path:"/",element:t.jsx(Hi,{to:s||e?"/management":"/login",replace:!0})})]})]})}ql.createRoot(document.getElementById("root")).render(t.jsx(Cc.StrictMode,{children:t.jsx(nE,{})}));
