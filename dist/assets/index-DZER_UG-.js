var Vy=Object.defineProperty;var Fy=(s,e,t)=>e in s?Vy(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t;var Je=(s,e,t)=>Fy(s,typeof e!="symbol"?e+"":e,t);import{r as I,a as Uy,g as By,R as Ep,u as Sp,b as zy,L as zs,N as dl,c as Tp,O as Hy,B as Wy,d as qy,e as us}from"./react-vendor-C1CKHd5q.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))r(a);new MutationObserver(a=>{for(const i of a)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function t(a){const i={};return a.integrity&&(i.integrity=a.integrity),a.referrerPolicy&&(i.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?i.credentials="include":a.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(a){if(a.ep)return;a.ep=!0;const i=t(a);fetch(a.href,i)}})();var Ip={exports:{}},ql={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Gy=I,Ky=Symbol.for("react.element"),Yy=Symbol.for("react.fragment"),Qy=Object.prototype.hasOwnProperty,Xy=Gy.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Jy={key:!0,ref:!0,__self:!0,__source:!0};function Ap(s,e,t){var r,a={},i=null,o=null;t!==void 0&&(i=""+t),e.key!==void 0&&(i=""+e.key),e.ref!==void 0&&(o=e.ref);for(r in e)Qy.call(e,r)&&!Jy.hasOwnProperty(r)&&(a[r]=e[r]);if(s&&s.defaultProps)for(r in e=s.defaultProps,e)a[r]===void 0&&(a[r]=e[r]);return{$$typeof:Ky,type:s,key:i,ref:o,props:a,_owner:Xy.current}}ql.Fragment=Yy;ql.jsx=Ap;ql.jsxs=Ap;Ip.exports=ql;var n=Ip.exports,fd={},vm=Uy;fd.createRoot=vm.createRoot,fd.hydrateRoot=vm.hydrateRoot;const Zy={},wm=s=>{let e;const t=new Set,r=(u,m)=>{const g=typeof u=="function"?u(e):u;if(!Object.is(g,e)){const p=e;e=m??(typeof g!="object"||g===null)?g:Object.assign({},e,g),t.forEach(j=>j(e,p))}},a=()=>e,c={setState:r,getState:a,getInitialState:()=>h,subscribe:u=>(t.add(u),()=>t.delete(u)),destroy:()=>{(Zy?"production":void 0)!=="production"&&console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),t.clear()}},h=e=s(r,a,c);return c},ev=s=>s?wm(s):wm;var Cp={exports:{}},Dp={},Mp={exports:{}},$p={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ba=I;function tv(s,e){return s===e&&(s!==0||1/s===1/e)||s!==s&&e!==e}var sv=typeof Object.is=="function"?Object.is:tv,rv=ba.useState,nv=ba.useEffect,av=ba.useLayoutEffect,iv=ba.useDebugValue;function ov(s,e){var t=e(),r=rv({inst:{value:t,getSnapshot:e}}),a=r[0].inst,i=r[1];return av(function(){a.value=t,a.getSnapshot=e,Fc(a)&&i({inst:a})},[s,t,e]),nv(function(){return Fc(a)&&i({inst:a}),s(function(){Fc(a)&&i({inst:a})})},[s]),iv(t),t}function Fc(s){var e=s.getSnapshot;s=s.value;try{var t=e();return!sv(s,t)}catch{return!0}}function lv(s,e){return e()}var cv=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?lv:ov;$p.useSyncExternalStore=ba.useSyncExternalStore!==void 0?ba.useSyncExternalStore:cv;Mp.exports=$p;var dv=Mp.exports;/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Gl=I,hv=dv;function uv(s,e){return s===e&&(s!==0||1/s===1/e)||s!==s&&e!==e}var mv=typeof Object.is=="function"?Object.is:uv,gv=hv.useSyncExternalStore,fv=Gl.useRef,pv=Gl.useEffect,xv=Gl.useMemo,bv=Gl.useDebugValue;Dp.useSyncExternalStoreWithSelector=function(s,e,t,r,a){var i=fv(null);if(i.current===null){var o={hasValue:!1,value:null};i.current=o}else o=i.current;i=xv(function(){function c(p){if(!h){if(h=!0,u=p,p=r(p),a!==void 0&&o.hasValue){var j=o.value;if(a(j,p))return m=j}return m=p}if(j=m,mv(u,p))return j;var _=r(p);return a!==void 0&&a(j,_)?(u=p,j):(u=p,m=_)}var h=!1,u,m,g=t===void 0?null:t;return[function(){return c(e())},g===null?void 0:function(){return c(g())}]},[e,t,r,a]);var l=gv(s,i[0],i[1]);return pv(function(){o.hasValue=!0,o.value=l},[l]),bv(l),l};Cp.exports=Dp;var yv=Cp.exports;const vv=By(yv),Rp={},{useDebugValue:wv}=Ep,{useSyncExternalStoreWithSelector:kv}=vv;let km=!1;const _v=s=>s;function Nv(s,e=_v,t){(Rp?"production":void 0)!=="production"&&t&&!km&&(console.warn("[DEPRECATED] Use `createWithEqualityFn` instead of `create` or use `useStoreWithEqualityFn` instead of `useStore`. They can be imported from 'zustand/traditional'. https://github.com/pmndrs/zustand/discussions/1937"),km=!0);const r=kv(s.subscribe,s.getState,s.getServerState||s.getInitialState,e,t);return wv(r),r}const jv=s=>{(Rp?"production":void 0)!=="production"&&typeof s!="function"&&console.warn("[DEPRECATED] Passing a vanilla store will be unsupported in a future version. Instead use `import { useStore } from 'zustand'`.");const e=typeof s=="function"?ev(s):s,t=(r,a)=>Nv(e,r,a);return Object.assign(t,e),t},lh=s=>jv,Ev={};function Sv(s,e){let t;try{t=s()}catch{return}return{getItem:a=>{var i;const o=c=>c===null?null:JSON.parse(c,void 0),l=(i=t.getItem(a))!=null?i:null;return l instanceof Promise?l.then(o):o(l)},setItem:(a,i)=>t.setItem(a,JSON.stringify(i,void 0)),removeItem:a=>t.removeItem(a)}}const Ti=s=>e=>{try{const t=s(e);return t instanceof Promise?t:{then(r){return Ti(r)(t)},catch(r){return this}}}catch(t){return{then(r){return this},catch(r){return Ti(r)(t)}}}},Tv=(s,e)=>(t,r,a)=>{let i={getStorage:()=>localStorage,serialize:JSON.stringify,deserialize:JSON.parse,partialize:y=>y,version:0,merge:(y,M)=>({...M,...y}),...e},o=!1;const l=new Set,c=new Set;let h;try{h=i.getStorage()}catch{}if(!h)return s((...y)=>{console.warn(`[zustand persist middleware] Unable to update item '${i.name}', the given storage is currently unavailable.`),t(...y)},r,a);const u=Ti(i.serialize),m=()=>{const y=i.partialize({...r()});let M;const D=u({state:y,version:i.version}).then(T=>h.setItem(i.name,T)).catch(T=>{M=T});if(M)throw M;return D},g=a.setState;a.setState=(y,M)=>{g(y,M),m()};const p=s((...y)=>{t(...y),m()},r,a);let j;const _=()=>{var y;if(!h)return;o=!1,l.forEach(D=>D(r()));const M=((y=i.onRehydrateStorage)==null?void 0:y.call(i,r()))||void 0;return Ti(h.getItem.bind(h))(i.name).then(D=>{if(D)return i.deserialize(D)}).then(D=>{if(D)if(typeof D.version=="number"&&D.version!==i.version){if(i.migrate)return i.migrate(D.state,D.version);console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return D.state}).then(D=>{var T;return j=i.merge(D,(T=r())!=null?T:p),t(j,!0),m()}).then(()=>{M==null||M(j,void 0),o=!0,c.forEach(D=>D(j))}).catch(D=>{M==null||M(void 0,D)})};return a.persist={setOptions:y=>{i={...i,...y},y.getStorage&&(h=y.getStorage())},clearStorage:()=>{h==null||h.removeItem(i.name)},getOptions:()=>i,rehydrate:()=>_(),hasHydrated:()=>o,onHydrate:y=>(l.add(y),()=>{l.delete(y)}),onFinishHydration:y=>(c.add(y),()=>{c.delete(y)})},_(),j||p},Iv=(s,e)=>(t,r,a)=>{let i={storage:Sv(()=>localStorage),partialize:_=>_,version:0,merge:(_,y)=>({...y,..._}),...e},o=!1;const l=new Set,c=new Set;let h=i.storage;if(!h)return s((..._)=>{console.warn(`[zustand persist middleware] Unable to update item '${i.name}', the given storage is currently unavailable.`),t(..._)},r,a);const u=()=>{const _=i.partialize({...r()});return h.setItem(i.name,{state:_,version:i.version})},m=a.setState;a.setState=(_,y)=>{m(_,y),u()};const g=s((..._)=>{t(..._),u()},r,a);a.getInitialState=()=>g;let p;const j=()=>{var _,y;if(!h)return;o=!1,l.forEach(D=>{var T;return D((T=r())!=null?T:g)});const M=((y=i.onRehydrateStorage)==null?void 0:y.call(i,(_=r())!=null?_:g))||void 0;return Ti(h.getItem.bind(h))(i.name).then(D=>{if(D)if(typeof D.version=="number"&&D.version!==i.version){if(i.migrate)return[!0,i.migrate(D.state,D.version)];console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return[!1,D.state];return[!1,void 0]}).then(D=>{var T;const[R,P]=D;if(p=i.merge(P,(T=r())!=null?T:g),t(p,!0),R)return u()}).then(()=>{M==null||M(p,void 0),p=r(),o=!0,c.forEach(D=>D(p))}).catch(D=>{M==null||M(void 0,D)})};return a.persist={setOptions:_=>{i={...i,..._},_.storage&&(h=_.storage)},clearStorage:()=>{h==null||h.removeItem(i.name)},getOptions:()=>i,rehydrate:()=>j(),hasHydrated:()=>o,onHydrate:_=>(l.add(_),()=>{l.delete(_)}),onFinishHydration:_=>(c.add(_),()=>{c.delete(_)})},i.skipHydration||j(),p||g},Av=(s,e)=>"getStorage"in e||"serialize"in e||"deserialize"in e?((Ev?"production":void 0)!=="production"&&console.warn("[DEPRECATED] `getStorage`, `serialize` and `deserialize` options are deprecated. Use `storage` option instead."),Tv(s,e)):Iv(s,e),ch=Av,_r={memecoins:{label:"Мемкоины",accent:"emerald",icon:"rocket"},futures:{label:"Фьючерсы",accent:"blue",icon:"line"},nft:{label:"NFT",accent:"purple",icon:"image"},spot:{label:"Спот",accent:"amber",icon:"coins"},polymarket:{label:"PolyMarket",accent:"pink",icon:"barchart"},staking:{label:"Стейкинг",accent:"indigo",icon:"shield"},other:{label:"Другое",accent:"gray",icon:"sparkles"}},Re=[{id:"1",name:"Артём",login:"artyom03",password:"248artdex",avatar:"/avatars/artyom.jpg"},{id:"2",name:"Enowk",login:"adel05",password:"058adeldex",avatar:"/avatars/adel.jpg"},{id:"3",name:"Ксения",login:"ksen03",password:"907ksendex",avatar:"/avatars/kseniya.jpg"},{id:"4",name:"Ольга",login:"olga04",password:"638olgadex",avatar:"/avatars/olga.jpg"},{id:"5",name:"Анастасия",login:"anastasia05",password:"638anastadex",avatar:"/avatars/anastasia.jpg"}],Ii={trading:{label:"Торговля",icon:"candles",color:"green"},learning:{label:"Обучение",icon:"book",color:"blue"},technical:{label:"ТЧ",icon:"cpu",color:"purple"},stream:{label:"Стрим",icon:"broadcast",color:"red"},research:{label:"Изучение",icon:"flask",color:"yellow"},organization:{label:"Ресёрч",icon:"clipboard",color:"indigo"}},Mn={in_progress:{label:"В работе",color:"blue"},completed:{label:"Выполнено",color:"green"},closed:{label:"Закрыто",color:"gray"}},_t=lh()(ch(s=>({user:null,isAuthenticated:!1,login:(e,t)=>{const r=Re.find(a=>a.login===e&&a.password===t);return r?(s({user:r,isAuthenticated:!0}),!0):!1},logout:()=>s({user:null,isAuthenticated:!1})}),{name:"apevault-auth"})),dh="4747",Ct=lh()(ch(s=>({isAdmin:!1,activateAdmin:e=>e===dh?(s({isAdmin:!0}),!0):!1,deactivateAdmin:()=>s({isAdmin:!1})}),{name:"apevault-admin"})),lt=lh()(ch(s=>({theme:"light",toggleTheme:()=>s(e=>{const t=e.theme==="light"?"dark":"light";return document.body.classList.toggle("dark",t==="dark"),{theme:t}}),setTheme:e=>s(()=>(document.body.classList.toggle("dark",e==="dark"),{theme:e}))}),{name:"apevault-theme"}));/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var Cv={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Dv=s=>s.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().trim(),pe=(s,e)=>{const t=I.forwardRef(({color:r="currentColor",size:a=24,strokeWidth:i=2,absoluteStrokeWidth:o,className:l="",children:c,...h},u)=>I.createElement("svg",{ref:u,...Cv,width:a,height:a,stroke:r,strokeWidth:o?Number(i)*24/Number(a):i,className:["lucide",`lucide-${Dv(s)}`,l].join(" "),...h},[...e.map(([m,g])=>I.createElement(m,g)),...Array.isArray(c)?c:[c]]));return t.displayName=`${s}`,t};/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hh=pe("Activity",[["path",{d:"M22 12h-4l-3 9L9 3l-3 9H2",key:"d5dnw9"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Kl=pe("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xt=pe("AlertTriangle",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z",key:"c3ski4"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Mv=pe("Archive",[["rect",{width:"20",height:"5",x:"2",y:"3",rx:"1",key:"1wp1u1"}],["path",{d:"M4 8v11a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8",key:"1s80jp"}],["path",{d:"M10 12h4",key:"a56b0p"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $v=pe("ArrowDownRight",[["path",{d:"m7 7 10 10",key:"1fmybs"}],["path",{d:"M17 7v10H7",key:"6fjiku"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Js=pe("ArrowUpRight",[["path",{d:"M7 7h10v10",key:"1tivn9"}],["path",{d:"M7 17 17 7",key:"1vkiza"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const uh=pe("BarChart3",[["path",{d:"M3 3v18h18",key:"1s2lah"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Rv=pe("Bell",[["path",{d:"M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9",key:"1qo2s2"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ya=pe("BookOpen",[["path",{d:"M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z",key:"vv98re"}],["path",{d:"M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z",key:"1cyq3y"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hl=pe("Building2",[["path",{d:"M6 22V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v18Z",key:"1b4qmf"}],["path",{d:"M6 12H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h2",key:"i71pzd"}],["path",{d:"M18 9h2a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2h-2",key:"10jefs"}],["path",{d:"M10 6h4",key:"1itunk"}],["path",{d:"M10 10h4",key:"tcdvrf"}],["path",{d:"M10 14h4",key:"kelpxr"}],["path",{d:"M10 18h4",key:"1ulq68"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pd=pe("CalendarCheck",[["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",ry:"2",key:"eu3xkr"}],["line",{x1:"16",x2:"16",y1:"2",y2:"6",key:"m3sa8f"}],["line",{x1:"8",x2:"8",y1:"2",y2:"6",key:"18kwsl"}],["line",{x1:"3",x2:"21",y1:"10",y2:"10",key:"xt86sb"}],["path",{d:"m9 16 2 2 4-4",key:"19s6y9"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ul=pe("CalendarClock",[["path",{d:"M21 7.5V6a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h3.5",key:"1osxxc"}],["path",{d:"M16 2v4",key:"4m81vk"}],["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M3 10h5",key:"r794hk"}],["path",{d:"M17.5 17.5 16 16.25V14",key:"re2vv1"}],["path",{d:"M22 16a6 6 0 1 1-12 0 6 6 0 0 1 12 0Z",key:"ame013"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pv=pe("CalendarDays",[["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",ry:"2",key:"eu3xkr"}],["line",{x1:"16",x2:"16",y1:"2",y2:"6",key:"m3sa8f"}],["line",{x1:"8",x2:"8",y1:"2",y2:"6",key:"18kwsl"}],["line",{x1:"3",x2:"21",y1:"10",y2:"10",key:"xt86sb"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 18h.01",key:"lrp35t"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M16 18h.01",key:"kzsmim"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fr=pe("Calendar",[["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",ry:"2",key:"eu3xkr"}],["line",{x1:"16",x2:"16",y1:"2",y2:"6",key:"m3sa8f"}],["line",{x1:"8",x2:"8",y1:"2",y2:"6",key:"18kwsl"}],["line",{x1:"3",x2:"21",y1:"10",y2:"10",key:"xt86sb"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ov=pe("CandlestickChart",[["path",{d:"M9 5v4",key:"14uxtq"}],["rect",{width:"4",height:"6",x:"7",y:"9",rx:"1",key:"f4fvz0"}],["path",{d:"M9 15v2",key:"r5rk32"}],["path",{d:"M17 3v2",key:"1l2re6"}],["rect",{width:"4",height:"8",x:"15",y:"5",rx:"1",key:"z38je5"}],["path",{d:"M17 13v3",key:"5l0wba"}],["path",{d:"M3 3v18h18",key:"1s2lah"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qi=pe("CheckCircle2",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Lv=pe("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Sr=pe("CheckSquare",[["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}],["path",{d:"M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11",key:"1jnkn4"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ls=pe("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const an=pe("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vv=pe("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qo=pe("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pp=pe("ChevronUp",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fv=pe("CircleDot",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _m=pe("ClipboardCheck",[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}],["path",{d:"m9 14 2 2 4-4",key:"df797q"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Uv=pe("ClipboardList",[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}],["path",{d:"M12 11h4",key:"1jrz19"}],["path",{d:"M12 16h4",key:"n85exb"}],["path",{d:"M8 11h.01",key:"1dfujw"}],["path",{d:"M8 16h.01",key:"18s6g9"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const on=pe("Clock3",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16.5 12",key:"1aq6pp"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ks=pe("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fs=pe("Coins",[["circle",{cx:"8",cy:"8",r:"6",key:"3yglwk"}],["path",{d:"M18.09 10.37A6 6 0 1 1 10.34 18",key:"t5s6rm"}],["path",{d:"M7 6h1v4",key:"1obek4"}],["path",{d:"m16.71 13.88.7.71-2.82 2.82",key:"1rbuyh"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ai=pe("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bv=pe("Cpu",[["rect",{x:"4",y:"4",width:"16",height:"16",rx:"2",key:"1vbyd7"}],["rect",{x:"9",y:"9",width:"6",height:"6",key:"o3kz5p"}],["path",{d:"M15 2v2",key:"13l42r"}],["path",{d:"M15 20v2",key:"15mkzm"}],["path",{d:"M2 15h2",key:"1gxd5l"}],["path",{d:"M2 9h2",key:"1bbxkp"}],["path",{d:"M20 15h2",key:"19e6y8"}],["path",{d:"M20 9h2",key:"19tzq7"}],["path",{d:"M9 2v2",key:"165o2o"}],["path",{d:"M9 20v2",key:"i2bqo8"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const va=pe("DollarSign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zv=pe("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Op=pe("EyeOff",[["path",{d:"M9.88 9.88a3 3 0 1 0 4.24 4.24",key:"1jxqfv"}],["path",{d:"M10.73 5.08A10.43 10.43 0 0 1 12 5c7 0 10 7 10 7a13.16 13.16 0 0 1-1.67 2.68",key:"9wicm4"}],["path",{d:"M6.61 6.61A13.526 13.526 0 0 0 2 12s3 7 10 7a9.74 9.74 0 0 0 5.39-1.61",key:"1jreej"}],["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ml=pe("Eye",[["path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",key:"rwhkz3"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Hv=pe("FileCode",[["path",{d:"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z",key:"1nnpy2"}],["polyline",{points:"14 2 14 8 20 8",key:"1ew0cm"}],["path",{d:"m10 13-2 2 2 2",key:"17smn8"}],["path",{d:"m14 17 2-2-2-2",key:"14mezr"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Lp=pe("FileText",[["path",{d:"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z",key:"1nnpy2"}],["polyline",{points:"14 2 14 8 20 8",key:"1ew0cm"}],["line",{x1:"16",x2:"8",y1:"13",y2:"13",key:"14keom"}],["line",{x1:"16",x2:"8",y1:"17",y2:"17",key:"17nazh"}],["line",{x1:"10",x2:"8",y1:"9",y2:"9",key:"1a5vjj"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mh=pe("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Wv=pe("FlaskConical",[["path",{d:"M10 2v7.527a2 2 0 0 1-.211.896L4.72 20.55a1 1 0 0 0 .9 1.45h12.76a1 1 0 0 0 .9-1.45l-5.069-10.127A2 2 0 0 1 14 9.527V2",key:"pzvekw"}],["path",{d:"M8.5 2h7",key:"csnxdl"}],["path",{d:"M7 16h10",key:"wp8him"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $n=pe("Gauge",[["path",{d:"m12 14 4-4",key:"9kzdfg"}],["path",{d:"M3.34 19a10 10 0 1 1 17.32 0",key:"19p75a"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vp=pe("Globe2",[["path",{d:"M21.54 15H17a2 2 0 0 0-2 2v4.54",key:"1djwo0"}],["path",{d:"M7 3.34V5a3 3 0 0 0 3 3v0a2 2 0 0 1 2 2v0c0 1.1.9 2 2 2v0a2 2 0 0 0 2-2v0c0-1.1.9-2 2-2h3.17",key:"1fi5u6"}],["path",{d:"M11 21.95V18a2 2 0 0 0-2-2v0a2 2 0 0 1-2-2v-1a2 2 0 0 0-2-2H2.05",key:"xsiumc"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fp=pe("Hash",[["line",{x1:"4",x2:"20",y1:"9",y2:"9",key:"4lhtct"}],["line",{x1:"4",x2:"20",y1:"15",y2:"15",key:"vyu0kd"}],["line",{x1:"10",x2:"8",y1:"3",y2:"21",key:"1ggp8o"}],["line",{x1:"16",x2:"14",y1:"3",y2:"21",key:"weycgp"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qv=pe("Heart",[["path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z",key:"c3ymky"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gv=pe("Home",[["path",{d:"m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"y5dka4"}],["polyline",{points:"9 22 9 12 15 12 15 22",key:"e2us08"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Kv=pe("Hourglass",[["path",{d:"M5 22h14",key:"ehvnwv"}],["path",{d:"M5 2h14",key:"pdyrp9"}],["path",{d:"M17 22v-4.172a2 2 0 0 0-.586-1.414L12 12l-4.414 4.414A2 2 0 0 0 7 17.828V22",key:"1d314k"}],["path",{d:"M7 2v4.172a2 2 0 0 0 .586 1.414L12 12l4.414-4.414A2 2 0 0 0 17 6.172V2",key:"1vvvr6"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Yl=pe("Image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $s=pe("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Yv=pe("Key",[["circle",{cx:"7.5",cy:"15.5",r:"5.5",key:"yqb3hr"}],["path",{d:"m21 2-9.6 9.6",key:"1j0ho8"}],["path",{d:"m15.5 7.5 3 3L22 7l-3-3",key:"1rn1fs"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qv=pe("Layers",[["path",{d:"m12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83Z",key:"8b97xw"}],["path",{d:"m22 17.65-9.17 4.16a2 2 0 0 1-1.66 0L2 17.65",key:"dd6zsq"}],["path",{d:"m22 12.65-9.17 4.16a2 2 0 0 1-1.66 0L2 12.65",key:"ep9fru"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xv=pe("LayoutGrid",[["rect",{width:"7",height:"7",x:"3",y:"3",rx:"1",key:"1g98yp"}],["rect",{width:"7",height:"7",x:"14",y:"3",rx:"1",key:"6d4xhi"}],["rect",{width:"7",height:"7",x:"14",y:"14",rx:"1",key:"nxv5o0"}],["rect",{width:"7",height:"7",x:"3",y:"14",rx:"1",key:"1bb6yr"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Nm=pe("LayoutList",[["rect",{width:"7",height:"7",x:"3",y:"3",rx:"1",key:"1g98yp"}],["rect",{width:"7",height:"7",x:"3",y:"14",rx:"1",key:"1bb6yr"}],["path",{d:"M14 4h7",key:"3xa0d5"}],["path",{d:"M14 9h7",key:"1icrd9"}],["path",{d:"M14 15h7",key:"1mj8o2"}],["path",{d:"M14 20h7",key:"11slyb"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ql=pe("LineChart",[["path",{d:"M3 3v18h18",key:"1s2lah"}],["path",{d:"m19 9-5 5-4-4-3 3",key:"2osh9i"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xd=pe("Link2",[["path",{d:"M9 17H7A5 5 0 0 1 7 7h2",key:"8i5ue5"}],["path",{d:"M15 7h2a5 5 0 1 1 0 10h-2",key:"1b9ql8"}],["line",{x1:"8",x2:"16",y1:"12",y2:"12",key:"1jonct"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Jv=pe("List",[["line",{x1:"8",x2:"21",y1:"6",y2:"6",key:"7ey8pc"}],["line",{x1:"8",x2:"21",y1:"12",y2:"12",key:"rjfblc"}],["line",{x1:"8",x2:"21",y1:"18",y2:"18",key:"c3b1m8"}],["line",{x1:"3",x2:"3.01",y1:"6",y2:"6",key:"1g7gq3"}],["line",{x1:"3",x2:"3.01",y1:"12",y2:"12",key:"1pjlvk"}],["line",{x1:"3",x2:"3.01",y1:"18",y2:"18",key:"28t2mc"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ci=pe("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Up=pe("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zv=pe("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ks=pe("MapPin",[["path",{d:"M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z",key:"2oe9fu"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ew=pe("MessageCircle",[["path",{d:"m3 21 1.9-5.7a8.5 8.5 0 1 1 3.8 3.8z",key:"v2veuj"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const na=pe("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bd=pe("Moon",[["path",{d:"M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z",key:"a7tn18"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tw=pe("MoreVertical",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bp=pe("Network",[["rect",{x:"16",y:"16",width:"6",height:"6",rx:"1",key:"4q2zg0"}],["rect",{x:"2",y:"16",width:"6",height:"6",rx:"1",key:"8cvhb9"}],["rect",{x:"9",y:"2",width:"6",height:"6",rx:"1",key:"1egb70"}],["path",{d:"M5 16v-3a1 1 0 0 1 1-1h12a1 1 0 0 1 1 1v3",key:"1jsf9p"}],["path",{d:"M12 12V8",key:"2874zd"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const da=pe("Octagon",[["polygon",{points:"7.86 2 16.14 2 22 7.86 22 16.14 16.14 22 7.86 22 2 16.14 2 7.86 7.86 2",key:"h1p8hx"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sw=pe("Palette",[["circle",{cx:"13.5",cy:"6.5",r:".5",key:"1xcu5"}],["circle",{cx:"17.5",cy:"10.5",r:".5",key:"736e4u"}],["circle",{cx:"8.5",cy:"7.5",r:".5",key:"clrty"}],["circle",{cx:"6.5",cy:"12.5",r:".5",key:"1s4xz9"}],["path",{d:"M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10c.926 0 1.648-.746 1.648-1.688 0-.437-.18-.835-.437-1.125-.29-.289-.438-.652-.438-1.125a1.64 1.64 0 0 1 1.668-1.668h1.996c3.051 0 5.555-2.503 5.555-5.554C21.965 6.012 17.461 2 12 2z",key:"12rzf8"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rw=pe("PanelLeftClose",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["path",{d:"M9 3v18",key:"fh3hqa"}],["path",{d:"m16 15-3-3 3-3",key:"14y99z"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nw=pe("PanelLeftOpen",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["path",{d:"M9 3v18",key:"fh3hqa"}],["path",{d:"m14 9 3 3-3 3",key:"8010ee"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Uc=pe("PenLine",[["path",{d:"M12 20h9",key:"t2du7b"}],["path",{d:"M16.5 3.5a2.12 2.12 0 0 1 3 3L7 19l-4 1 1-4Z",key:"ymcmye"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ps=pe("PenSquare",[["path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1qinfi"}],["path",{d:"M18.5 2.5a2.12 2.12 0 0 1 3 3L12 15l-4 1 1-4Z",key:"w2jsv5"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jm=pe("Pen",[["path",{d:"M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z",key:"5qss01"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const en=pe("Percent",[["line",{x1:"19",x2:"5",y1:"5",y2:"19",key:"1x9vlm"}],["circle",{cx:"6.5",cy:"6.5",r:"2.5",key:"4mh3h7"}],["circle",{cx:"17.5",cy:"17.5",r:"2.5",key:"1mdrzq"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const aw=pe("PieChart",[["path",{d:"M21.21 15.89A10 10 0 1 1 8 2.83",key:"k2fpak"}],["path",{d:"M22 12A10 10 0 0 0 12 2v10z",key:"1rfc4y"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Eo=pe("PiggyBank",[["path",{d:"M19 5c-1.5 0-2.8 1.4-3 2-3.5-1.5-11-.3-11 5 0 1.8 0 3 2 4.5V20h4v-2h3v2h4v-4c1-.5 1.7-1 2-2h2v-4h-2c0-1-.5-1.5-1-2h0V5z",key:"uf6l00"}],["path",{d:"M2 9v1c0 1.1.9 2 2 2h1",key:"nm575m"}],["path",{d:"M16 11h0",key:"k2aug8"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const iw=pe("Plane",[["path",{d:"M17.8 19.2 16 11l3.5-3.5C21 6 21.5 4 21 3c-1-.5-3 0-4.5 1.5L13 8 4.8 6.2c-.5-.1-.9.1-1.1.5l-.3.5c-.2.5-.1 1 .3 1.3L9 12l-2 3H4l-1 1 3 2 2 3 1-1v-3l3-2 3.5 5.3c.3.4.8.5 1.3.3l.5-.2c.4-.3.6-.7.5-1.2z",key:"1v9wt8"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zp=pe("PlusCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}],["path",{d:"M12 8v8",key:"napkw2"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Cr=pe("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Hp=pe("Radio",[["path",{d:"M4.9 19.1C1 15.2 1 8.8 4.9 4.9",key:"1vaf9d"}],["path",{d:"M7.8 16.2c-2.3-2.3-2.3-6.1 0-8.5",key:"u1ii0m"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}],["path",{d:"M16.2 7.8c2.3 2.3 2.3 6.1 0 8.5",key:"1j5fej"}],["path",{d:"M19.1 4.9C23 8.8 23 15.1 19.1 19",key:"10b0cb"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ow=pe("RefreshCcw",[["path",{d:"M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"14sxne"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16",key:"1hlbsb"}],["path",{d:"M16 16h5v5",key:"ccwih5"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xi=pe("Rocket",[["path",{d:"M4.5 16.5c-1.5 1.26-2 5-2 5s3.74-.5 5-2c.71-.84.7-2.13-.09-2.91a2.18 2.18 0 0 0-2.91-.09z",key:"m3kijz"}],["path",{d:"m12 15-3-3a22 22 0 0 1 2-3.95A12.88 12.88 0 0 1 22 2c0 2.72-.78 7.5-6 11a22.35 22.35 0 0 1-4 2z",key:"1fmvmk"}],["path",{d:"M9 12H4s.55-3.03 2-4c1.62-1.08 5 0 5 0",key:"1f8sc4"}],["path",{d:"M12 15v5s3.03-.55 4-2c1.08-1.62 0-5 0-5",key:"qeys4"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gh=pe("Save",[["path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z",key:"1owoqh"}],["polyline",{points:"17 21 17 13 7 13 7 21",key:"1md35c"}],["polyline",{points:"7 3 7 8 15 8",key:"8nz8an"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lw=pe("Scale",[["path",{d:"m16 16 3-8 3 8c-.87.65-1.92 1-3 1s-2.13-.35-3-1Z",key:"7g6ntu"}],["path",{d:"m2 16 3-8 3 8c-.87.65-1.92 1-3 1s-2.13-.35-3-1Z",key:"ijws7r"}],["path",{d:"M7 21h10",key:"1b0cd5"}],["path",{d:"M12 3v18",key:"108xh3"}],["path",{d:"M3 7h2c2 0 5-1 7-2 2 1 5 2 7 2h2",key:"3gwbw2"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vr=pe("ScrollText",[["path",{d:"M8 21h12a2 2 0 0 0 2-2v-2H10v2a2 2 0 1 1-4 0V5a2 2 0 1 0-4 0v3h4",key:"13a6an"}],["path",{d:"M19 17V5a2 2 0 0 0-2-2H4",key:"zz82l3"}],["path",{d:"M15 8h-5",key:"1khuty"}],["path",{d:"M15 12h-5",key:"r7krc0"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fh=pe("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Yr=pe("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qa=pe("ShieldAlert",[["path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10",key:"1irkt0"}],["path",{d:"M12 8v4",key:"1got3b"}],["path",{d:"M12 16h.01",key:"1drbdi"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ji=pe("ShieldCheck",[["path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10",key:"1irkt0"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ph=pe("ShieldX",[["path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10",key:"1irkt0"}],["path",{d:"m14.5 9-5 5",key:"1m49dw"}],["path",{d:"m9.5 9 5 5",key:"wyx7zg"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ot=pe("Shield",[["path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10",key:"1irkt0"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Em=pe("SlidersHorizontal",[["line",{x1:"21",x2:"14",y1:"4",y2:"4",key:"obuewd"}],["line",{x1:"10",x2:"3",y1:"4",y2:"4",key:"1q6298"}],["line",{x1:"21",x2:"12",y1:"12",y2:"12",key:"1iu8h1"}],["line",{x1:"8",x2:"3",y1:"12",y2:"12",key:"ntss68"}],["line",{x1:"21",x2:"16",y1:"20",y2:"20",key:"14d8ph"}],["line",{x1:"12",x2:"3",y1:"20",y2:"20",key:"m0wm8r"}],["line",{x1:"14",x2:"14",y1:"2",y2:"6",key:"14e1ph"}],["line",{x1:"8",x2:"8",y1:"10",y2:"14",key:"1i6ji0"}],["line",{x1:"16",x2:"16",y1:"18",y2:"22",key:"1lctlv"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xs=pe("Sparkles",[["path",{d:"m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z",key:"17u4zn"}],["path",{d:"M5 3v4",key:"bklmnn"}],["path",{d:"M19 17v4",key:"iiml17"}],["path",{d:"M3 5h4",key:"nem4j1"}],["path",{d:"M17 19h4",key:"lbex7p"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bc=pe("Square",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cw=pe("StickyNote",[["path",{d:"M15.5 3H5a2 2 0 0 0-2 2v14c0 1.1.9 2 2 2h14a2 2 0 0 0 2-2V8.5L15.5 3Z",key:"1wis1t"}],["path",{d:"M15 3v6h6",key:"edgan2"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yd=pe("Sun",[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"m4.93 4.93 1.41 1.41",key:"149t6j"}],["path",{d:"m17.66 17.66 1.41 1.41",key:"ptbguv"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"m6.34 17.66-1.41 1.41",key:"1m8zz5"}],["path",{d:"m19.07 4.93-1.41 1.41",key:"1shlcs"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dw=pe("Table2",[["path",{d:"M9 3H5a2 2 0 0 0-2 2v4m6-6h10a2 2 0 0 1 2 2v4M9 3v18m0 0h10a2 2 0 0 0 2-2V9M9 21H5a2 2 0 0 1-2-2V9m0 0h18",key:"gugj83"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hw=pe("Table",[["path",{d:"M12 3v18",key:"108xh3"}],["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M3 15h18",key:"5xshup"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const uw=pe("Tag",[["path",{d:"M12 2H2v10l9.29 9.29c.94.94 2.48.94 3.42 0l6.58-6.58c.94-.94.94-2.48 0-3.42L12 2Z",key:"14b2ls"}],["path",{d:"M7 7h.01",key:"7u93v4"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const os=pe("Target",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mw=pe("Terminal",[["polyline",{points:"4 17 10 11 4 5",key:"akl6gq"}],["line",{x1:"12",x2:"20",y1:"19",y2:"19",key:"q2wloq"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gw=pe("ThumbsDown",[["path",{d:"M17 14V2",key:"8ymqnk"}],["path",{d:"M9 18.12 10 14H4.17a2 2 0 0 1-1.92-2.56l2.33-8A2 2 0 0 1 6.5 2H20a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2h-2.76a2 2 0 0 0-1.79 1.11L12 22h0a3.13 3.13 0 0 1-3-3.88Z",key:"s6e0r"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xh=pe("Timer",[["line",{x1:"10",x2:"14",y1:"2",y2:"2",key:"14vaq8"}],["line",{x1:"12",x2:"15",y1:"14",y2:"11",key:"17fdiu"}],["circle",{cx:"12",cy:"14",r:"8",key:"1e1u0o"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bt=pe("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fw=pe("Trash",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ut=pe("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pw=pe("Trophy",[["path",{d:"M6 9H4.5a2.5 2.5 0 0 1 0-5H6",key:"17hqa7"}],["path",{d:"M18 9h1.5a2.5 2.5 0 0 0 0-5H18",key:"lmptdp"}],["path",{d:"M4 22h16",key:"57wxv0"}],["path",{d:"M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22",key:"1nw9bq"}],["path",{d:"M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22",key:"1np0yb"}],["path",{d:"M18 2H6v7a6 6 0 0 0 12 0V2Z",key:"u46fv3"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xw=pe("UserPlus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vd=pe("UserX",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"17",x2:"22",y1:"8",y2:"13",key:"3nzzx3"}],["line",{x1:"22",x2:"17",y1:"8",y2:"13",key:"1swrse"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Rn=pe("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qn=pe("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bw=pe("Wallet",[["path",{d:"M21 12V7H5a2 2 0 0 1 0-4h14v4",key:"195gfw"}],["path",{d:"M3 5v14a2 2 0 0 0 2 2h16v-5",key:"195n9w"}],["path",{d:"M18 12a2 2 0 0 0 0 4h4v-4Z",key:"vllfpd"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ha=pe("Wand2",[["path",{d:"m21.64 3.64-1.28-1.28a1.21 1.21 0 0 0-1.72 0L2.36 18.64a1.21 1.21 0 0 0 0 1.72l1.28 1.28a1.2 1.2 0 0 0 1.72 0L21.64 5.36a1.2 1.2 0 0 0 0-1.72Z",key:"1bcowg"}],["path",{d:"m14 7 3 3",key:"1r5n42"}],["path",{d:"M5 6v4",key:"ilb8ba"}],["path",{d:"M19 14v4",key:"blhpug"}],["path",{d:"M10 2v2",key:"7u0qdc"}],["path",{d:"M7 8H3",key:"zfb6yr"}],["path",{d:"M21 16h-4",key:"1cnmox"}],["path",{d:"M11 3H9",key:"1obp7u"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ft=pe("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yw=pe("ZapOff",[["polyline",{points:"12.41 6.75 13 2 10.57 4.92",key:"122m05"}],["polyline",{points:"18.57 12.91 21 10 15.66 10",key:"16r43o"}],["polyline",{points:"8 8 3 14 12 14 11 22 16 16",key:"tmh4bc"}],["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vw=pe("Zap",[["polygon",{points:"13 2 3 14 12 14 11 22 21 10 12 10 13 2",key:"45s27k"}]]),wd="/assets/logo-CxzOhvKg.png",ww=()=>{const[s,e]=I.useState("member"),[t,r]=I.useState(""),[a,i]=I.useState(""),[o,l]=I.useState(!1),[c,h]=I.useState(!1),[u,m]=I.useState(""),{login:g,user:p,isAuthenticated:j}=_t(),{theme:_,toggleTheme:y}=lt(),{activateAdmin:M}=Ct(),D=Sp(),[T]=zy();I.useEffect(()=>{document.body.classList.toggle("dark",_==="dark")},[_]),I.useEffect(()=>{const P=localStorage.getItem("apevault_remembered");if(P)try{const{login:C,password:N,type:b}=JSON.parse(P);r(C),i(N),e(b||"member"),h(!0)}catch(C){console.error("Error loading remembered credentials:",C)}},[]),I.useEffect(()=>{var P,C,N;if(j&&p){D("/management");return}if((P=window.Telegram)!=null&&P.WebApp){window.Telegram.WebApp.ready(),window.Telegram.WebApp.expand();const v=T.get("tgWebAppData")||window.Telegram.WebApp.initData,S=T.get("login"),E=T.get("password");if(S&&E&&g(S,E)){D("/management");return}if(v)try{const Q=new URLSearchParams(v).get("user");if(Q){const V=JSON.parse(decodeURIComponent(Q)).id;sessionStorage.setItem("telegram_user_id",String(V));const X=localStorage.getItem("apevault-auth");if(X)try{const he=JSON.parse(X);if((C=he.state)!=null&&C.user){const B=he.state.user;if(g(B.login,B.password)){D("/management");return}}}catch(he){console.error("Error parsing saved auth:",he)}}}catch(w){console.error("Error parsing Telegram initData:",w)}const k=(N=window.Telegram.WebApp.initDataUnsafe)==null?void 0:N.user;k&&sessionStorage.setItem("telegram_user_id",String(k.id))}},[T,j,p,D,g]);const R=P=>{if(P.preventDefault(),m(""),!a){m("Пожалуйста, введите пароль");return}if(s==="admin")M(a)?(c?localStorage.setItem("apevault_remembered",JSON.stringify({login:"",password:a,type:"admin"})):localStorage.removeItem("apevault_remembered"),D("/management")):m("Неверный пароль администратора");else{if(!t){m("Пожалуйста, введите логин");return}g(t,a)?(c?localStorage.setItem("apevault_remembered",JSON.stringify({login:t,password:a,type:"member"})):localStorage.removeItem("apevault_remembered"),D("/management")):m("Неверный логин или пароль")}};return n.jsxs("div",{className:`min-h-screen flex flex-col xl:flex-row ${_==="dark"?"bg-[#0b0f17]":"bg-white"}`,children:[n.jsxs("div",{className:"hidden xl:flex flex-1 relative bg-[#0b0f17] items-center justify-center p-12 overflow-hidden",children:[n.jsxs("div",{className:"absolute inset-0 pointer-events-none",children:[n.jsx("div",{className:"absolute -top-24 -left-24 w-[620px] h-[620px] bg-gradient-to-br from-[#4E6E49]/35 via-emerald-400/22 to-transparent blur-[110px]"}),n.jsx("div",{className:"absolute top-[-120px] right-[-180px] w-[780px] h-[780px] bg-gradient-to-bl from-blue-500/24 via-purple-500/22 to-transparent blur-[140px]"}),n.jsx("div",{className:"floating-grid opacity-30"})]}),n.jsxs("div",{className:"relative z-10 flex flex-col items-center text-center max-w-md",children:[n.jsx("div",{className:"w-24 h-24 sm:w-32 sm:h-32 mb-8 flex items-center justify-center animate-pulse-subtle",children:n.jsx("img",{src:wd,alt:"ApeVault",className:"w-20 h-20 sm:w-24 sm:h-24 object-contain filter drop-shadow-[0_0_15px_rgba(16,185,129,0.4)]"})}),n.jsxs("h1",{className:"text-4xl lg:text-5xl font-black text-white mb-6 tracking-tight",children:["ApeVault ",n.jsx("span",{className:"text-emerald-500",children:"Frontier"})]}),n.jsx("p",{className:"text-lg text-gray-400 font-medium leading-relaxed",children:"Единая командная панель для управления ресурсами, аналитикой и оперативного взаимодействия."}),n.jsx("div",{className:"mt-20 inline-flex items-center gap-2 px-4 py-2 rounded-full bg-white/5 border border-white/10 text-[10px] font-bold text-gray-400 uppercase tracking-widest"})]})]}),n.jsxs("div",{className:`flex-1 flex flex-col min-h-screen relative p-6 sm:p-12 lg:p-20 ${_==="dark"?"bg-[#0b0f17]":"bg-white"}`,children:[n.jsxs("div",{className:"xl:hidden flex items-center justify-between mb-12",children:[n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx("img",{src:wd,alt:"Logo",className:"w-10 h-10 object-contain"}),n.jsx("span",{className:`font-black tracking-tight ${_==="dark"?"text-white":"text-gray-900"}`,children:"ApeVault Frontier"})]}),n.jsx("button",{onClick:y,className:"p-2 rounded-xl bg-gray-100 dark:bg-white/5 text-gray-700 dark:text-amber-300",children:_==="dark"?n.jsx(yd,{className:"w-5 h-5"}):n.jsx(bd,{className:"w-5 h-5"})})]}),n.jsx("div",{className:"hidden xl:flex justify-end absolute top-8 right-8",children:n.jsx("button",{onClick:y,className:`p-3 rounded-full shadow-lg transition-all border ${_==="dark"?"bg-white/5 border-white/10 text-amber-300 hover:bg-white/10":"bg-white border-gray-100 text-gray-700 hover:bg-gray-50"}`,children:_==="dark"?n.jsx(yd,{className:"w-6 h-6"}):n.jsx(bd,{className:"w-6 h-6"})})}),n.jsxs("div",{className:"flex-1 flex flex-col justify-center max-w-md mx-auto w-full",children:[n.jsxs("div",{className:"mb-10 text-center",children:[n.jsx("h2",{className:`text-4xl font-extrabold mb-3 tracking-tight ${_==="dark"?"text-white":"text-gray-900"}`,children:"Добро пожаловать"}),n.jsxs("p",{className:"text-gray-500 dark:text-gray-400 font-medium",children:["Введите данные для входа в ",n.jsx("span",{className:"text-emerald-500 font-bold",children:"ApeVault"})]})]}),n.jsxs("div",{className:"flex p-1 bg-gray-100 dark:bg-white/5 rounded-2xl mb-8",children:[n.jsxs("button",{onClick:()=>e("member"),className:`flex-1 flex items-center justify-center gap-2 py-3 rounded-xl font-bold transition-all ${s==="member"?"bg-white dark:bg-[#4E6E49] text-[#4E6E49] dark:text-white shadow-sm":"text-gray-500 hover:text-gray-700 dark:hover:text-gray-300"}`,children:[n.jsx(qn,{className:"w-4 h-4"}),n.jsx("span",{children:"Участник"})]}),n.jsxs("button",{onClick:()=>e("admin"),className:`flex-1 flex items-center justify-center gap-2 py-3 rounded-xl font-bold transition-all ${s==="admin"?"bg-white dark:bg-[#4E6E49] text-[#4E6E49] dark:text-white shadow-sm":"text-gray-500 hover:text-gray-700 dark:hover:text-gray-300"}`,children:[n.jsx(Ot,{className:"w-4 h-4"}),n.jsx("span",{children:"Админ"})]})]}),n.jsxs("form",{onSubmit:R,className:"space-y-6",children:[s==="member"&&n.jsxs("div",{className:"space-y-2",children:[n.jsx("label",{className:`text-sm font-bold block ${_==="dark"?"text-gray-400":"text-gray-600"}`,children:"Логин / Email"}),n.jsxs("div",{className:"relative group",children:[n.jsx("div",{className:"absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none text-gray-400 group-focus-within:text-emerald-500 transition-colors",children:n.jsx(Rn,{className:"w-5 h-5"})}),n.jsx("input",{type:"text",value:t,onChange:P=>r(P.target.value),placeholder:"agent@apevault.io",className:`w-full pl-12 pr-4 py-4 rounded-2xl border transition-all focus:outline-none focus:ring-4 focus:ring-emerald-500/10 ${_==="dark"?"bg-white/5 border-white/10 text-white placeholder-gray-600 focus:border-emerald-500":"bg-gray-50 border-gray-200 text-gray-900 placeholder-gray-400 focus:border-emerald-500"}`})]})]}),n.jsxs("div",{className:"space-y-2",children:[n.jsx("label",{className:`text-sm font-bold block ${_==="dark"?"text-gray-400":"text-gray-600"}`,children:"Пароль"}),n.jsxs("div",{className:"relative group",children:[n.jsx("div",{className:"absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none text-gray-400 group-focus-within:text-emerald-500 transition-colors",children:n.jsx(Ci,{className:"w-5 h-5"})}),n.jsx("input",{type:o?"text":"password",value:a,onChange:P=>i(P.target.value),placeholder:"••••••••",className:`w-full pl-12 pr-12 py-4 rounded-2xl border transition-all focus:outline-none focus:ring-4 focus:ring-emerald-500/10 ${_==="dark"?"bg-white/5 border-white/10 text-white placeholder-gray-600 focus:border-emerald-500":"bg-gray-50 border-gray-200 text-gray-900 placeholder-gray-400 focus:border-emerald-500"}`}),n.jsx("button",{type:"button",onClick:()=>l(!o),className:"absolute inset-y-0 right-0 pr-4 flex items-center text-gray-400 hover:text-emerald-500 transition-colors",children:o?n.jsx(Op,{className:"w-5 h-5"}):n.jsx(ml,{className:"w-5 h-5"})})]})]}),n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("label",{className:"flex items-center gap-3 cursor-pointer group",children:[n.jsxs("div",{className:"relative",children:[n.jsx("input",{type:"checkbox",checked:c,onChange:P=>h(P.target.checked),className:"sr-only"}),n.jsx("div",{className:`w-5 h-5 rounded border transition-all flex items-center justify-center ${c?"bg-emerald-500 border-emerald-500":"border-gray-300 dark:border-white/20"}`,children:c&&n.jsx("div",{className:"w-2.5 h-2.5 bg-white rounded-sm"})})]}),n.jsx("span",{className:`text-sm font-bold ${_==="dark"?"text-gray-400":"text-gray-500"}`,children:"Запомнить меня"})]}),n.jsx("a",{href:"https://t.me/artyommedoed",target:"_blank",rel:"noopener noreferrer",className:"text-sm font-bold text-emerald-500 hover:text-emerald-600",children:"Забыли пароль?"})]}),u&&n.jsx("div",{className:"p-4 rounded-2xl bg-red-500/10 border border-red-500/20 text-red-500 text-sm font-bold animate-shake",children:u}),n.jsx("button",{type:"submit",className:"w-full py-4 px-6 rounded-2xl bg-emerald-500 hover:bg-emerald-600 text-white font-black text-lg transition-all shadow-lg shadow-emerald-500/20 hover:scale-[1.02] active:scale-[0.98]",children:"Войти в Систему"})]}),n.jsx("div",{className:"mt-12 pt-8 border-t border-gray-100 dark:border-white/5",children:n.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[n.jsxs("a",{href:"https://t.me/artyommedoed",target:"_blank",rel:"noopener noreferrer",className:`flex items-center justify-center gap-2 py-3 px-4 rounded-2xl border transition-all font-bold text-sm ${_==="dark"?"border-white/10 bg-white/5 text-white hover:bg-white/10":"border-gray-200 bg-white text-gray-700 hover:bg-gray-50 shadow-sm"}`,children:[n.jsx(Ot,{className:"w-4 h-4 text-emerald-500"}),n.jsx("span",{children:"Связаться с Админом"})]}),n.jsxs("a",{href:"/rules.pdf",download:!0,className:`flex items-center justify-center gap-2 py-3 px-4 rounded-2xl border transition-all font-bold text-sm ${_==="dark"?"border-white/10 bg-white/5 text-white hover:bg-white/10":"border-gray-200 bg-white text-gray-700 hover:bg-gray-50 shadow-sm"}`,children:[n.jsx(ya,{className:"w-4 h-4 text-emerald-500"}),n.jsx("span",{children:"Правила Команды"})]})]})})]})]})]})};var Sm={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Wp=function(s){const e=[];let t=0;for(let r=0;r<s.length;r++){let a=s.charCodeAt(r);a<128?e[t++]=a:a<2048?(e[t++]=a>>6|192,e[t++]=a&63|128):(a&64512)===55296&&r+1<s.length&&(s.charCodeAt(r+1)&64512)===56320?(a=65536+((a&1023)<<10)+(s.charCodeAt(++r)&1023),e[t++]=a>>18|240,e[t++]=a>>12&63|128,e[t++]=a>>6&63|128,e[t++]=a&63|128):(e[t++]=a>>12|224,e[t++]=a>>6&63|128,e[t++]=a&63|128)}return e},kw=function(s){const e=[];let t=0,r=0;for(;t<s.length;){const a=s[t++];if(a<128)e[r++]=String.fromCharCode(a);else if(a>191&&a<224){const i=s[t++];e[r++]=String.fromCharCode((a&31)<<6|i&63)}else if(a>239&&a<365){const i=s[t++],o=s[t++],l=s[t++],c=((a&7)<<18|(i&63)<<12|(o&63)<<6|l&63)-65536;e[r++]=String.fromCharCode(55296+(c>>10)),e[r++]=String.fromCharCode(56320+(c&1023))}else{const i=s[t++],o=s[t++];e[r++]=String.fromCharCode((a&15)<<12|(i&63)<<6|o&63)}}return e.join("")},qp={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(s,e){if(!Array.isArray(s))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let a=0;a<s.length;a+=3){const i=s[a],o=a+1<s.length,l=o?s[a+1]:0,c=a+2<s.length,h=c?s[a+2]:0,u=i>>2,m=(i&3)<<4|l>>4;let g=(l&15)<<2|h>>6,p=h&63;c||(p=64,o||(g=64)),r.push(t[u],t[m],t[g],t[p])}return r.join("")},encodeString(s,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(s):this.encodeByteArray(Wp(s),e)},decodeString(s,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(s):kw(this.decodeStringToByteArray(s,e))},decodeStringToByteArray(s,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let a=0;a<s.length;){const i=t[s.charAt(a++)],l=a<s.length?t[s.charAt(a)]:0;++a;const h=a<s.length?t[s.charAt(a)]:64;++a;const m=a<s.length?t[s.charAt(a)]:64;if(++a,i==null||l==null||h==null||m==null)throw new _w;const g=i<<2|l>>4;if(r.push(g),h!==64){const p=l<<4&240|h>>2;if(r.push(p),m!==64){const j=h<<6&192|m;r.push(j)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let s=0;s<this.ENCODED_VALS.length;s++)this.byteToCharMap_[s]=this.ENCODED_VALS.charAt(s),this.charToByteMap_[this.byteToCharMap_[s]]=s,this.byteToCharMapWebSafe_[s]=this.ENCODED_VALS_WEBSAFE.charAt(s),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[s]]=s,s>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(s)]=s,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(s)]=s)}}};class _w extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const Nw=function(s){const e=Wp(s);return qp.encodeByteArray(e,!0)},gl=function(s){return Nw(s).replace(/\./g,"")},Gp=function(s){try{return qp.decodeString(s,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jw(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ew=()=>jw().__FIREBASE_DEFAULTS__,Sw=()=>{if(typeof process>"u"||typeof Sm>"u")return;const s=Sm.__FIREBASE_DEFAULTS__;if(s)return JSON.parse(s)},Tw=()=>{if(typeof document>"u")return;let s;try{s=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=s&&Gp(s[1]);return e&&JSON.parse(e)},Xl=()=>{try{return Ew()||Sw()||Tw()}catch(s){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${s}`);return}},Kp=s=>{var e,t;return(t=(e=Xl())===null||e===void 0?void 0:e.emulatorHosts)===null||t===void 0?void 0:t[s]},Yp=s=>{const e=Kp(s);if(!e)return;const t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),r]:[e.substring(0,t),r]},Qp=()=>{var s;return(s=Xl())===null||s===void 0?void 0:s.config},Xp=s=>{var e;return(e=Xl())===null||e===void 0?void 0:e[`_${s}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Iw{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,r)=>{t?this.reject(t):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,r))}}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Jp(s,e){if(s.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const t={alg:"none",type:"JWT"},r=e||"demo-project",a=s.iat||0,i=s.sub||s.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o=Object.assign({iss:`https://securetoken.google.com/${r}`,aud:r,iat:a,exp:a+3600,auth_time:a,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}}},s);return[gl(JSON.stringify(t)),gl(JSON.stringify(o)),""].join(".")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ds(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function Aw(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(ds())}function Cw(){var s;const e=(s=Xl())===null||s===void 0?void 0:s.forceEnvironment;if(e==="node")return!0;if(e==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function Dw(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function Mw(){const s=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof s=="object"&&s.id!==void 0}function $w(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function Rw(){const s=ds();return s.indexOf("MSIE ")>=0||s.indexOf("Trident/")>=0}function Pw(){return!Cw()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function Ow(){try{return typeof indexedDB=="object"}catch{return!1}}function Lw(){return new Promise((s,e)=>{try{let t=!0;const r="validate-browser-context-for-indexeddb-analytics-module",a=self.indexedDB.open(r);a.onsuccess=()=>{a.result.close(),t||self.indexedDB.deleteDatabase(r),s(!0)},a.onupgradeneeded=()=>{t=!1},a.onerror=()=>{var i;e(((i=a.error)===null||i===void 0?void 0:i.message)||"")}}catch(t){e(t)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Vw="FirebaseError";class dr extends Error{constructor(e,t,r){super(t),this.code=e,this.customData=r,this.name=Vw,Object.setPrototypeOf(this,dr.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Zi.prototype.create)}}class Zi{constructor(e,t,r){this.service=e,this.serviceName=t,this.errors=r}create(e,...t){const r=t[0]||{},a=`${this.service}/${e}`,i=this.errors[e],o=i?Fw(i,r):"Error",l=`${this.serviceName}: ${o} (${a}).`;return new dr(a,l,r)}}function Fw(s,e){return s.replace(Uw,(t,r)=>{const a=e[r];return a!=null?String(a):`<${r}?>`})}const Uw=/\{\$([^}]+)}/g;function Bw(s){for(const e in s)if(Object.prototype.hasOwnProperty.call(s,e))return!1;return!0}function fl(s,e){if(s===e)return!0;const t=Object.keys(s),r=Object.keys(e);for(const a of t){if(!r.includes(a))return!1;const i=s[a],o=e[a];if(Tm(i)&&Tm(o)){if(!fl(i,o))return!1}else if(i!==o)return!1}for(const a of r)if(!t.includes(a))return!1;return!0}function Tm(s){return s!==null&&typeof s=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function eo(s){const e=[];for(const[t,r]of Object.entries(s))Array.isArray(r)?r.forEach(a=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(a))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}function zw(s,e){const t=new Hw(s,e);return t.subscribe.bind(t)}class Hw{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(r=>{this.error(r)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,r){let a;if(e===void 0&&t===void 0&&r===void 0)throw new Error("Missing Observer.");Ww(e,["next","error","complete"])?a=e:a={next:e,error:t,complete:r},a.next===void 0&&(a.next=zc),a.error===void 0&&(a.error=zc),a.complete===void 0&&(a.complete=zc);const i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?a.error(this.finalError):a.complete()}catch{}}),this.observers.push(a),i}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function Ww(s,e){if(typeof s!="object"||s===null)return!1;for(const t of e)if(t in s&&typeof s[t]=="function")return!0;return!1}function zc(){}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hs(s){return s&&s._delegate?s._delegate:s}class mn{constructor(e,t,r){this.name=e,this.instanceFactory=t,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const En="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qw{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const r=new Iw;if(this.instancesDeferred.set(t,r),this.isInitialized(t)||this.shouldAutoInitialize())try{const a=this.getOrInitializeService({instanceIdentifier:t});a&&r.resolve(a)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const r=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),a=(t=e==null?void 0:e.optional)!==null&&t!==void 0?t:!1;if(this.isInitialized(r)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:r})}catch(i){if(a)return null;throw i}else{if(a)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(Kw(e))try{this.getOrInitializeService({instanceIdentifier:En})}catch{}for(const[t,r]of this.instancesDeferred.entries()){const a=this.normalizeInstanceIdentifier(t);try{const i=this.getOrInitializeService({instanceIdentifier:a});r.resolve(i)}catch{}}}}clearInstance(e=En){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=En){return this.instances.has(e)}getOptions(e=En){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const a=this.getOrInitializeService({instanceIdentifier:r,options:t});for(const[i,o]of this.instancesDeferred.entries()){const l=this.normalizeInstanceIdentifier(i);r===l&&o.resolve(a)}return a}onInit(e,t){var r;const a=this.normalizeInstanceIdentifier(t),i=(r=this.onInitCallbacks.get(a))!==null&&r!==void 0?r:new Set;i.add(e),this.onInitCallbacks.set(a,i);const o=this.instances.get(a);return o&&e(o,a),()=>{i.delete(e)}}invokeOnInitCallbacks(e,t){const r=this.onInitCallbacks.get(t);if(r)for(const a of r)try{a(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:Gw(e),options:t}),this.instances.set(e,r),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=En){return this.component?this.component.multipleInstances?e:En:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function Gw(s){return s===En?void 0:s}function Kw(s){return s.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yw{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new qw(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var rt;(function(s){s[s.DEBUG=0]="DEBUG",s[s.VERBOSE=1]="VERBOSE",s[s.INFO=2]="INFO",s[s.WARN=3]="WARN",s[s.ERROR=4]="ERROR",s[s.SILENT=5]="SILENT"})(rt||(rt={}));const Qw={debug:rt.DEBUG,verbose:rt.VERBOSE,info:rt.INFO,warn:rt.WARN,error:rt.ERROR,silent:rt.SILENT},Xw=rt.INFO,Jw={[rt.DEBUG]:"log",[rt.VERBOSE]:"log",[rt.INFO]:"info",[rt.WARN]:"warn",[rt.ERROR]:"error"},Zw=(s,e,...t)=>{if(e<s.logLevel)return;const r=new Date().toISOString(),a=Jw[e];if(a)console[a](`[${r}]  ${s.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class bh{constructor(e){this.name=e,this._logLevel=Xw,this._logHandler=Zw,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in rt))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?Qw[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,rt.DEBUG,...e),this._logHandler(this,rt.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,rt.VERBOSE,...e),this._logHandler(this,rt.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,rt.INFO,...e),this._logHandler(this,rt.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,rt.WARN,...e),this._logHandler(this,rt.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,rt.ERROR,...e),this._logHandler(this,rt.ERROR,...e)}}const e1=(s,e)=>e.some(t=>s instanceof t);let Im,Am;function t1(){return Im||(Im=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function s1(){return Am||(Am=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const Zp=new WeakMap,kd=new WeakMap,e0=new WeakMap,Hc=new WeakMap,yh=new WeakMap;function r1(s){const e=new Promise((t,r)=>{const a=()=>{s.removeEventListener("success",i),s.removeEventListener("error",o)},i=()=>{t(ln(s.result)),a()},o=()=>{r(s.error),a()};s.addEventListener("success",i),s.addEventListener("error",o)});return e.then(t=>{t instanceof IDBCursor&&Zp.set(t,s)}).catch(()=>{}),yh.set(e,s),e}function n1(s){if(kd.has(s))return;const e=new Promise((t,r)=>{const a=()=>{s.removeEventListener("complete",i),s.removeEventListener("error",o),s.removeEventListener("abort",o)},i=()=>{t(),a()},o=()=>{r(s.error||new DOMException("AbortError","AbortError")),a()};s.addEventListener("complete",i),s.addEventListener("error",o),s.addEventListener("abort",o)});kd.set(s,e)}let _d={get(s,e,t){if(s instanceof IDBTransaction){if(e==="done")return kd.get(s);if(e==="objectStoreNames")return s.objectStoreNames||e0.get(s);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return ln(s[e])},set(s,e,t){return s[e]=t,!0},has(s,e){return s instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in s}};function a1(s){_d=s(_d)}function i1(s){return s===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const r=s.call(Wc(this),e,...t);return e0.set(r,e.sort?e.sort():[e]),ln(r)}:s1().includes(s)?function(...e){return s.apply(Wc(this),e),ln(Zp.get(this))}:function(...e){return ln(s.apply(Wc(this),e))}}function o1(s){return typeof s=="function"?i1(s):(s instanceof IDBTransaction&&n1(s),e1(s,t1())?new Proxy(s,_d):s)}function ln(s){if(s instanceof IDBRequest)return r1(s);if(Hc.has(s))return Hc.get(s);const e=o1(s);return e!==s&&(Hc.set(s,e),yh.set(e,s)),e}const Wc=s=>yh.get(s);function l1(s,e,{blocked:t,upgrade:r,blocking:a,terminated:i}={}){const o=indexedDB.open(s,e),l=ln(o);return r&&o.addEventListener("upgradeneeded",c=>{r(ln(o.result),c.oldVersion,c.newVersion,ln(o.transaction),c)}),t&&o.addEventListener("blocked",c=>t(c.oldVersion,c.newVersion,c)),l.then(c=>{i&&c.addEventListener("close",()=>i()),a&&c.addEventListener("versionchange",h=>a(h.oldVersion,h.newVersion,h))}).catch(()=>{}),l}const c1=["get","getKey","getAll","getAllKeys","count"],d1=["put","add","delete","clear"],qc=new Map;function Cm(s,e){if(!(s instanceof IDBDatabase&&!(e in s)&&typeof e=="string"))return;if(qc.get(e))return qc.get(e);const t=e.replace(/FromIndex$/,""),r=e!==t,a=d1.includes(t);if(!(t in(r?IDBIndex:IDBObjectStore).prototype)||!(a||c1.includes(t)))return;const i=async function(o,...l){const c=this.transaction(o,a?"readwrite":"readonly");let h=c.store;return r&&(h=h.index(l.shift())),(await Promise.all([h[t](...l),a&&c.done]))[0]};return qc.set(e,i),i}a1(s=>({...s,get:(e,t,r)=>Cm(e,t)||s.get(e,t,r),has:(e,t)=>!!Cm(e,t)||s.has(e,t)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class h1{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(u1(t)){const r=t.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(t=>t).join(" ")}}function u1(s){const e=s.getComponent();return(e==null?void 0:e.type)==="VERSION"}const Nd="@firebase/app",Dm="0.10.13";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Dr=new bh("@firebase/app"),m1="@firebase/app-compat",g1="@firebase/analytics-compat",f1="@firebase/analytics",p1="@firebase/app-check-compat",x1="@firebase/app-check",b1="@firebase/auth",y1="@firebase/auth-compat",v1="@firebase/database",w1="@firebase/data-connect",k1="@firebase/database-compat",_1="@firebase/functions",N1="@firebase/functions-compat",j1="@firebase/installations",E1="@firebase/installations-compat",S1="@firebase/messaging",T1="@firebase/messaging-compat",I1="@firebase/performance",A1="@firebase/performance-compat",C1="@firebase/remote-config",D1="@firebase/remote-config-compat",M1="@firebase/storage",$1="@firebase/storage-compat",R1="@firebase/firestore",P1="@firebase/vertexai-preview",O1="@firebase/firestore-compat",L1="firebase",V1="10.14.1";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jd="[DEFAULT]",F1={[Nd]:"fire-core",[m1]:"fire-core-compat",[f1]:"fire-analytics",[g1]:"fire-analytics-compat",[x1]:"fire-app-check",[p1]:"fire-app-check-compat",[b1]:"fire-auth",[y1]:"fire-auth-compat",[v1]:"fire-rtdb",[w1]:"fire-data-connect",[k1]:"fire-rtdb-compat",[_1]:"fire-fn",[N1]:"fire-fn-compat",[j1]:"fire-iid",[E1]:"fire-iid-compat",[S1]:"fire-fcm",[T1]:"fire-fcm-compat",[I1]:"fire-perf",[A1]:"fire-perf-compat",[C1]:"fire-rc",[D1]:"fire-rc-compat",[M1]:"fire-gcs",[$1]:"fire-gcs-compat",[R1]:"fire-fst",[O1]:"fire-fst-compat",[P1]:"fire-vertex","fire-js":"fire-js",[L1]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pl=new Map,U1=new Map,Ed=new Map;function Mm(s,e){try{s.container.addComponent(e)}catch(t){Dr.debug(`Component ${e.name} failed to register with FirebaseApp ${s.name}`,t)}}function Vn(s){const e=s.name;if(Ed.has(e))return Dr.debug(`There were multiple attempts to register component ${e}.`),!1;Ed.set(e,s);for(const t of pl.values())Mm(t,s);for(const t of U1.values())Mm(t,s);return!0}function Jl(s,e){const t=s.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),s.container.getProvider(e)}function tn(s){return s.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const B1={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},cn=new Zi("app","Firebase",B1);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class z1{constructor(e,t,r){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new mn("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw cn.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Gn=V1;function t0(s,e={}){let t=s;typeof e!="object"&&(e={name:e});const r=Object.assign({name:jd,automaticDataCollectionEnabled:!1},e),a=r.name;if(typeof a!="string"||!a)throw cn.create("bad-app-name",{appName:String(a)});if(t||(t=Qp()),!t)throw cn.create("no-options");const i=pl.get(a);if(i){if(fl(t,i.options)&&fl(r,i.config))return i;throw cn.create("duplicate-app",{appName:a})}const o=new Yw(a);for(const c of Ed.values())o.addComponent(c);const l=new z1(t,r,o);return pl.set(a,l),l}function vh(s=jd){const e=pl.get(s);if(!e&&s===jd&&Qp())return t0();if(!e)throw cn.create("no-app",{appName:s});return e}function tr(s,e,t){var r;let a=(r=F1[s])!==null&&r!==void 0?r:s;t&&(a+=`-${t}`);const i=a.match(/\s|\//),o=e.match(/\s|\//);if(i||o){const l=[`Unable to register library "${a}" with version "${e}":`];i&&l.push(`library name "${a}" contains illegal characters (whitespace or "/")`),i&&o&&l.push("and"),o&&l.push(`version name "${e}" contains illegal characters (whitespace or "/")`),Dr.warn(l.join(" "));return}Vn(new mn(`${a}-version`,()=>({library:a,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const H1="firebase-heartbeat-database",W1=1,Di="firebase-heartbeat-store";let Gc=null;function s0(){return Gc||(Gc=l1(H1,W1,{upgrade:(s,e)=>{switch(e){case 0:try{s.createObjectStore(Di)}catch(t){console.warn(t)}}}}).catch(s=>{throw cn.create("idb-open",{originalErrorMessage:s.message})})),Gc}async function q1(s){try{const t=(await s0()).transaction(Di),r=await t.objectStore(Di).get(r0(s));return await t.done,r}catch(e){if(e instanceof dr)Dr.warn(e.message);else{const t=cn.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});Dr.warn(t.message)}}}async function $m(s,e){try{const r=(await s0()).transaction(Di,"readwrite");await r.objectStore(Di).put(e,r0(s)),await r.done}catch(t){if(t instanceof dr)Dr.warn(t.message);else{const r=cn.create("idb-set",{originalErrorMessage:t==null?void 0:t.message});Dr.warn(r.message)}}}function r0(s){return`${s.name}!${s.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const G1=1024,K1=30*24*60*60*1e3;class Y1{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new X1(t),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){var e,t;try{const a=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),i=Rm();return((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===i||this._heartbeatsCache.heartbeats.some(o=>o.date===i)?void 0:(this._heartbeatsCache.heartbeats.push({date:i,agent:a}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(o=>{const l=new Date(o.date).valueOf();return Date.now()-l<=K1}),this._storage.overwrite(this._heartbeatsCache))}catch(r){Dr.warn(r)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const t=Rm(),{heartbeatsToSend:r,unsentEntries:a}=Q1(this._heartbeatsCache.heartbeats),i=gl(JSON.stringify({version:2,heartbeats:r}));return this._heartbeatsCache.lastSentHeartbeatDate=t,a.length>0?(this._heartbeatsCache.heartbeats=a,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(t){return Dr.warn(t),""}}}function Rm(){return new Date().toISOString().substring(0,10)}function Q1(s,e=G1){const t=[];let r=s.slice();for(const a of s){const i=t.find(o=>o.agent===a.agent);if(i){if(i.dates.push(a.date),Pm(t)>e){i.dates.pop();break}}else if(t.push({agent:a.agent,dates:[a.date]}),Pm(t)>e){t.pop();break}r=r.slice(1)}return{heartbeatsToSend:t,unsentEntries:r}}class X1{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return Ow()?Lw().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const t=await q1(this.app);return t!=null&&t.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){const a=await this.read();return $m(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:a.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){var t;if(await this._canUseIndexedDBPromise){const a=await this.read();return $m(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:a.lastSentHeartbeatDate,heartbeats:[...a.heartbeats,...e.heartbeats]})}else return}}function Pm(s){return gl(JSON.stringify({version:2,heartbeats:s})).length}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function J1(s){Vn(new mn("platform-logger",e=>new h1(e),"PRIVATE")),Vn(new mn("heartbeat",e=>new Y1(e),"PRIVATE")),tr(Nd,Dm,s),tr(Nd,Dm,"esm2017"),tr("fire-js","")}J1("");var Om=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var Pn,n0;(function(){var s;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(N,b){function v(){}v.prototype=b.prototype,N.D=b.prototype,N.prototype=new v,N.prototype.constructor=N,N.C=function(S,E,k){for(var w=Array(arguments.length-2),Q=2;Q<arguments.length;Q++)w[Q-2]=arguments[Q];return b.prototype[E].apply(S,w)}}function t(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(r,t),r.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function a(N,b,v){v||(v=0);var S=Array(16);if(typeof b=="string")for(var E=0;16>E;++E)S[E]=b.charCodeAt(v++)|b.charCodeAt(v++)<<8|b.charCodeAt(v++)<<16|b.charCodeAt(v++)<<24;else for(E=0;16>E;++E)S[E]=b[v++]|b[v++]<<8|b[v++]<<16|b[v++]<<24;b=N.g[0],v=N.g[1],E=N.g[2];var k=N.g[3],w=b+(k^v&(E^k))+S[0]+3614090360&4294967295;b=v+(w<<7&4294967295|w>>>25),w=k+(E^b&(v^E))+S[1]+3905402710&4294967295,k=b+(w<<12&4294967295|w>>>20),w=E+(v^k&(b^v))+S[2]+606105819&4294967295,E=k+(w<<17&4294967295|w>>>15),w=v+(b^E&(k^b))+S[3]+3250441966&4294967295,v=E+(w<<22&4294967295|w>>>10),w=b+(k^v&(E^k))+S[4]+4118548399&4294967295,b=v+(w<<7&4294967295|w>>>25),w=k+(E^b&(v^E))+S[5]+1200080426&4294967295,k=b+(w<<12&4294967295|w>>>20),w=E+(v^k&(b^v))+S[6]+2821735955&4294967295,E=k+(w<<17&4294967295|w>>>15),w=v+(b^E&(k^b))+S[7]+4249261313&4294967295,v=E+(w<<22&4294967295|w>>>10),w=b+(k^v&(E^k))+S[8]+1770035416&4294967295,b=v+(w<<7&4294967295|w>>>25),w=k+(E^b&(v^E))+S[9]+2336552879&4294967295,k=b+(w<<12&4294967295|w>>>20),w=E+(v^k&(b^v))+S[10]+4294925233&4294967295,E=k+(w<<17&4294967295|w>>>15),w=v+(b^E&(k^b))+S[11]+2304563134&4294967295,v=E+(w<<22&4294967295|w>>>10),w=b+(k^v&(E^k))+S[12]+1804603682&4294967295,b=v+(w<<7&4294967295|w>>>25),w=k+(E^b&(v^E))+S[13]+4254626195&4294967295,k=b+(w<<12&4294967295|w>>>20),w=E+(v^k&(b^v))+S[14]+2792965006&4294967295,E=k+(w<<17&4294967295|w>>>15),w=v+(b^E&(k^b))+S[15]+1236535329&4294967295,v=E+(w<<22&4294967295|w>>>10),w=b+(E^k&(v^E))+S[1]+4129170786&4294967295,b=v+(w<<5&4294967295|w>>>27),w=k+(v^E&(b^v))+S[6]+3225465664&4294967295,k=b+(w<<9&4294967295|w>>>23),w=E+(b^v&(k^b))+S[11]+643717713&4294967295,E=k+(w<<14&4294967295|w>>>18),w=v+(k^b&(E^k))+S[0]+3921069994&4294967295,v=E+(w<<20&4294967295|w>>>12),w=b+(E^k&(v^E))+S[5]+3593408605&4294967295,b=v+(w<<5&4294967295|w>>>27),w=k+(v^E&(b^v))+S[10]+38016083&4294967295,k=b+(w<<9&4294967295|w>>>23),w=E+(b^v&(k^b))+S[15]+3634488961&4294967295,E=k+(w<<14&4294967295|w>>>18),w=v+(k^b&(E^k))+S[4]+3889429448&4294967295,v=E+(w<<20&4294967295|w>>>12),w=b+(E^k&(v^E))+S[9]+568446438&4294967295,b=v+(w<<5&4294967295|w>>>27),w=k+(v^E&(b^v))+S[14]+3275163606&4294967295,k=b+(w<<9&4294967295|w>>>23),w=E+(b^v&(k^b))+S[3]+4107603335&4294967295,E=k+(w<<14&4294967295|w>>>18),w=v+(k^b&(E^k))+S[8]+1163531501&4294967295,v=E+(w<<20&4294967295|w>>>12),w=b+(E^k&(v^E))+S[13]+2850285829&4294967295,b=v+(w<<5&4294967295|w>>>27),w=k+(v^E&(b^v))+S[2]+4243563512&4294967295,k=b+(w<<9&4294967295|w>>>23),w=E+(b^v&(k^b))+S[7]+1735328473&4294967295,E=k+(w<<14&4294967295|w>>>18),w=v+(k^b&(E^k))+S[12]+2368359562&4294967295,v=E+(w<<20&4294967295|w>>>12),w=b+(v^E^k)+S[5]+4294588738&4294967295,b=v+(w<<4&4294967295|w>>>28),w=k+(b^v^E)+S[8]+2272392833&4294967295,k=b+(w<<11&4294967295|w>>>21),w=E+(k^b^v)+S[11]+1839030562&4294967295,E=k+(w<<16&4294967295|w>>>16),w=v+(E^k^b)+S[14]+4259657740&4294967295,v=E+(w<<23&4294967295|w>>>9),w=b+(v^E^k)+S[1]+2763975236&4294967295,b=v+(w<<4&4294967295|w>>>28),w=k+(b^v^E)+S[4]+1272893353&4294967295,k=b+(w<<11&4294967295|w>>>21),w=E+(k^b^v)+S[7]+4139469664&4294967295,E=k+(w<<16&4294967295|w>>>16),w=v+(E^k^b)+S[10]+3200236656&4294967295,v=E+(w<<23&4294967295|w>>>9),w=b+(v^E^k)+S[13]+681279174&4294967295,b=v+(w<<4&4294967295|w>>>28),w=k+(b^v^E)+S[0]+3936430074&4294967295,k=b+(w<<11&4294967295|w>>>21),w=E+(k^b^v)+S[3]+3572445317&4294967295,E=k+(w<<16&4294967295|w>>>16),w=v+(E^k^b)+S[6]+76029189&4294967295,v=E+(w<<23&4294967295|w>>>9),w=b+(v^E^k)+S[9]+3654602809&4294967295,b=v+(w<<4&4294967295|w>>>28),w=k+(b^v^E)+S[12]+3873151461&4294967295,k=b+(w<<11&4294967295|w>>>21),w=E+(k^b^v)+S[15]+530742520&4294967295,E=k+(w<<16&4294967295|w>>>16),w=v+(E^k^b)+S[2]+3299628645&4294967295,v=E+(w<<23&4294967295|w>>>9),w=b+(E^(v|~k))+S[0]+4096336452&4294967295,b=v+(w<<6&4294967295|w>>>26),w=k+(v^(b|~E))+S[7]+1126891415&4294967295,k=b+(w<<10&4294967295|w>>>22),w=E+(b^(k|~v))+S[14]+2878612391&4294967295,E=k+(w<<15&4294967295|w>>>17),w=v+(k^(E|~b))+S[5]+4237533241&4294967295,v=E+(w<<21&4294967295|w>>>11),w=b+(E^(v|~k))+S[12]+1700485571&4294967295,b=v+(w<<6&4294967295|w>>>26),w=k+(v^(b|~E))+S[3]+2399980690&4294967295,k=b+(w<<10&4294967295|w>>>22),w=E+(b^(k|~v))+S[10]+4293915773&4294967295,E=k+(w<<15&4294967295|w>>>17),w=v+(k^(E|~b))+S[1]+2240044497&4294967295,v=E+(w<<21&4294967295|w>>>11),w=b+(E^(v|~k))+S[8]+1873313359&4294967295,b=v+(w<<6&4294967295|w>>>26),w=k+(v^(b|~E))+S[15]+4264355552&4294967295,k=b+(w<<10&4294967295|w>>>22),w=E+(b^(k|~v))+S[6]+2734768916&4294967295,E=k+(w<<15&4294967295|w>>>17),w=v+(k^(E|~b))+S[13]+1309151649&4294967295,v=E+(w<<21&4294967295|w>>>11),w=b+(E^(v|~k))+S[4]+4149444226&4294967295,b=v+(w<<6&4294967295|w>>>26),w=k+(v^(b|~E))+S[11]+3174756917&4294967295,k=b+(w<<10&4294967295|w>>>22),w=E+(b^(k|~v))+S[2]+718787259&4294967295,E=k+(w<<15&4294967295|w>>>17),w=v+(k^(E|~b))+S[9]+3951481745&4294967295,N.g[0]=N.g[0]+b&4294967295,N.g[1]=N.g[1]+(E+(w<<21&4294967295|w>>>11))&4294967295,N.g[2]=N.g[2]+E&4294967295,N.g[3]=N.g[3]+k&4294967295}r.prototype.u=function(N,b){b===void 0&&(b=N.length);for(var v=b-this.blockSize,S=this.B,E=this.h,k=0;k<b;){if(E==0)for(;k<=v;)a(this,N,k),k+=this.blockSize;if(typeof N=="string"){for(;k<b;)if(S[E++]=N.charCodeAt(k++),E==this.blockSize){a(this,S),E=0;break}}else for(;k<b;)if(S[E++]=N[k++],E==this.blockSize){a(this,S),E=0;break}}this.h=E,this.o+=b},r.prototype.v=function(){var N=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);N[0]=128;for(var b=1;b<N.length-8;++b)N[b]=0;var v=8*this.o;for(b=N.length-8;b<N.length;++b)N[b]=v&255,v/=256;for(this.u(N),N=Array(16),b=v=0;4>b;++b)for(var S=0;32>S;S+=8)N[v++]=this.g[b]>>>S&255;return N};function i(N,b){var v=l;return Object.prototype.hasOwnProperty.call(v,N)?v[N]:v[N]=b(N)}function o(N,b){this.h=b;for(var v=[],S=!0,E=N.length-1;0<=E;E--){var k=N[E]|0;S&&k==b||(v[E]=k,S=!1)}this.g=v}var l={};function c(N){return-128<=N&&128>N?i(N,function(b){return new o([b|0],0>b?-1:0)}):new o([N|0],0>N?-1:0)}function h(N){if(isNaN(N)||!isFinite(N))return m;if(0>N)return y(h(-N));for(var b=[],v=1,S=0;N>=v;S++)b[S]=N/v|0,v*=4294967296;return new o(b,0)}function u(N,b){if(N.length==0)throw Error("number format error: empty string");if(b=b||10,2>b||36<b)throw Error("radix out of range: "+b);if(N.charAt(0)=="-")return y(u(N.substring(1),b));if(0<=N.indexOf("-"))throw Error('number format error: interior "-" character');for(var v=h(Math.pow(b,8)),S=m,E=0;E<N.length;E+=8){var k=Math.min(8,N.length-E),w=parseInt(N.substring(E,E+k),b);8>k?(k=h(Math.pow(b,k)),S=S.j(k).add(h(w))):(S=S.j(v),S=S.add(h(w)))}return S}var m=c(0),g=c(1),p=c(16777216);s=o.prototype,s.m=function(){if(_(this))return-y(this).m();for(var N=0,b=1,v=0;v<this.g.length;v++){var S=this.i(v);N+=(0<=S?S:4294967296+S)*b,b*=4294967296}return N},s.toString=function(N){if(N=N||10,2>N||36<N)throw Error("radix out of range: "+N);if(j(this))return"0";if(_(this))return"-"+y(this).toString(N);for(var b=h(Math.pow(N,6)),v=this,S="";;){var E=R(v,b).g;v=M(v,E.j(b));var k=((0<v.g.length?v.g[0]:v.h)>>>0).toString(N);if(v=E,j(v))return k+S;for(;6>k.length;)k="0"+k;S=k+S}},s.i=function(N){return 0>N?0:N<this.g.length?this.g[N]:this.h};function j(N){if(N.h!=0)return!1;for(var b=0;b<N.g.length;b++)if(N.g[b]!=0)return!1;return!0}function _(N){return N.h==-1}s.l=function(N){return N=M(this,N),_(N)?-1:j(N)?0:1};function y(N){for(var b=N.g.length,v=[],S=0;S<b;S++)v[S]=~N.g[S];return new o(v,~N.h).add(g)}s.abs=function(){return _(this)?y(this):this},s.add=function(N){for(var b=Math.max(this.g.length,N.g.length),v=[],S=0,E=0;E<=b;E++){var k=S+(this.i(E)&65535)+(N.i(E)&65535),w=(k>>>16)+(this.i(E)>>>16)+(N.i(E)>>>16);S=w>>>16,k&=65535,w&=65535,v[E]=w<<16|k}return new o(v,v[v.length-1]&-2147483648?-1:0)};function M(N,b){return N.add(y(b))}s.j=function(N){if(j(this)||j(N))return m;if(_(this))return _(N)?y(this).j(y(N)):y(y(this).j(N));if(_(N))return y(this.j(y(N)));if(0>this.l(p)&&0>N.l(p))return h(this.m()*N.m());for(var b=this.g.length+N.g.length,v=[],S=0;S<2*b;S++)v[S]=0;for(S=0;S<this.g.length;S++)for(var E=0;E<N.g.length;E++){var k=this.i(S)>>>16,w=this.i(S)&65535,Q=N.i(E)>>>16,ae=N.i(E)&65535;v[2*S+2*E]+=w*ae,D(v,2*S+2*E),v[2*S+2*E+1]+=k*ae,D(v,2*S+2*E+1),v[2*S+2*E+1]+=w*Q,D(v,2*S+2*E+1),v[2*S+2*E+2]+=k*Q,D(v,2*S+2*E+2)}for(S=0;S<b;S++)v[S]=v[2*S+1]<<16|v[2*S];for(S=b;S<2*b;S++)v[S]=0;return new o(v,0)};function D(N,b){for(;(N[b]&65535)!=N[b];)N[b+1]+=N[b]>>>16,N[b]&=65535,b++}function T(N,b){this.g=N,this.h=b}function R(N,b){if(j(b))throw Error("division by zero");if(j(N))return new T(m,m);if(_(N))return b=R(y(N),b),new T(y(b.g),y(b.h));if(_(b))return b=R(N,y(b)),new T(y(b.g),b.h);if(30<N.g.length){if(_(N)||_(b))throw Error("slowDivide_ only works with positive integers.");for(var v=g,S=b;0>=S.l(N);)v=P(v),S=P(S);var E=C(v,1),k=C(S,1);for(S=C(S,2),v=C(v,2);!j(S);){var w=k.add(S);0>=w.l(N)&&(E=E.add(v),k=w),S=C(S,1),v=C(v,1)}return b=M(N,E.j(b)),new T(E,b)}for(E=m;0<=N.l(b);){for(v=Math.max(1,Math.floor(N.m()/b.m())),S=Math.ceil(Math.log(v)/Math.LN2),S=48>=S?1:Math.pow(2,S-48),k=h(v),w=k.j(b);_(w)||0<w.l(N);)v-=S,k=h(v),w=k.j(b);j(k)&&(k=g),E=E.add(k),N=M(N,w)}return new T(E,N)}s.A=function(N){return R(this,N).h},s.and=function(N){for(var b=Math.max(this.g.length,N.g.length),v=[],S=0;S<b;S++)v[S]=this.i(S)&N.i(S);return new o(v,this.h&N.h)},s.or=function(N){for(var b=Math.max(this.g.length,N.g.length),v=[],S=0;S<b;S++)v[S]=this.i(S)|N.i(S);return new o(v,this.h|N.h)},s.xor=function(N){for(var b=Math.max(this.g.length,N.g.length),v=[],S=0;S<b;S++)v[S]=this.i(S)^N.i(S);return new o(v,this.h^N.h)};function P(N){for(var b=N.g.length+1,v=[],S=0;S<b;S++)v[S]=N.i(S)<<1|N.i(S-1)>>>31;return new o(v,N.h)}function C(N,b){var v=b>>5;b%=32;for(var S=N.g.length-v,E=[],k=0;k<S;k++)E[k]=0<b?N.i(k+v)>>>b|N.i(k+v+1)<<32-b:N.i(k+v);return new o(E,N.h)}r.prototype.digest=r.prototype.v,r.prototype.reset=r.prototype.s,r.prototype.update=r.prototype.u,n0=r,o.prototype.add=o.prototype.add,o.prototype.multiply=o.prototype.j,o.prototype.modulo=o.prototype.A,o.prototype.compare=o.prototype.l,o.prototype.toNumber=o.prototype.m,o.prototype.toString=o.prototype.toString,o.prototype.getBits=o.prototype.i,o.fromNumber=h,o.fromString=u,Pn=o}).apply(typeof Om<"u"?Om:typeof self<"u"?self:typeof window<"u"?window:{});var So=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var a0,oi,i0,Xo,Sd,o0,l0,c0;(function(){var s,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(d,f,x){return d==Array.prototype||d==Object.prototype||(d[f]=x.value),d};function t(d){d=[typeof globalThis=="object"&&globalThis,d,typeof window=="object"&&window,typeof self=="object"&&self,typeof So=="object"&&So];for(var f=0;f<d.length;++f){var x=d[f];if(x&&x.Math==Math)return x}throw Error("Cannot find global object")}var r=t(this);function a(d,f){if(f)e:{var x=r;d=d.split(".");for(var A=0;A<d.length-1;A++){var ee=d[A];if(!(ee in x))break e;x=x[ee]}d=d[d.length-1],A=x[d],f=f(A),f!=A&&f!=null&&e(x,d,{configurable:!0,writable:!0,value:f})}}function i(d,f){d instanceof String&&(d+="");var x=0,A=!1,ee={next:function(){if(!A&&x<d.length){var le=x++;return{value:f(le,d[le]),done:!1}}return A=!0,{done:!0,value:void 0}}};return ee[Symbol.iterator]=function(){return ee},ee}a("Array.prototype.values",function(d){return d||function(){return i(this,function(f,x){return x})}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var o=o||{},l=this||self;function c(d){var f=typeof d;return f=f!="object"?f:d?Array.isArray(d)?"array":f:"null",f=="array"||f=="object"&&typeof d.length=="number"}function h(d){var f=typeof d;return f=="object"&&d!=null||f=="function"}function u(d,f,x){return d.call.apply(d.bind,arguments)}function m(d,f,x){if(!d)throw Error();if(2<arguments.length){var A=Array.prototype.slice.call(arguments,2);return function(){var ee=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(ee,A),d.apply(f,ee)}}return function(){return d.apply(f,arguments)}}function g(d,f,x){return g=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?u:m,g.apply(null,arguments)}function p(d,f){var x=Array.prototype.slice.call(arguments,1);return function(){var A=x.slice();return A.push.apply(A,arguments),d.apply(this,A)}}function j(d,f){function x(){}x.prototype=f.prototype,d.aa=f.prototype,d.prototype=new x,d.prototype.constructor=d,d.Qb=function(A,ee,le){for(var Ee=Array(arguments.length-2),vt=2;vt<arguments.length;vt++)Ee[vt-2]=arguments[vt];return f.prototype[ee].apply(A,Ee)}}function _(d){const f=d.length;if(0<f){const x=Array(f);for(let A=0;A<f;A++)x[A]=d[A];return x}return[]}function y(d,f){for(let x=1;x<arguments.length;x++){const A=arguments[x];if(c(A)){const ee=d.length||0,le=A.length||0;d.length=ee+le;for(let Ee=0;Ee<le;Ee++)d[ee+Ee]=A[Ee]}else d.push(A)}}class M{constructor(f,x){this.i=f,this.j=x,this.h=0,this.g=null}get(){let f;return 0<this.h?(this.h--,f=this.g,this.g=f.next,f.next=null):f=this.i(),f}}function D(d){return/^[\s\xa0]*$/.test(d)}function T(){var d=l.navigator;return d&&(d=d.userAgent)?d:""}function R(d){return R[" "](d),d}R[" "]=function(){};var P=T().indexOf("Gecko")!=-1&&!(T().toLowerCase().indexOf("webkit")!=-1&&T().indexOf("Edge")==-1)&&!(T().indexOf("Trident")!=-1||T().indexOf("MSIE")!=-1)&&T().indexOf("Edge")==-1;function C(d,f,x){for(const A in d)f.call(x,d[A],A,d)}function N(d,f){for(const x in d)f.call(void 0,d[x],x,d)}function b(d){const f={};for(const x in d)f[x]=d[x];return f}const v="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function S(d,f){let x,A;for(let ee=1;ee<arguments.length;ee++){A=arguments[ee];for(x in A)d[x]=A[x];for(let le=0;le<v.length;le++)x=v[le],Object.prototype.hasOwnProperty.call(A,x)&&(d[x]=A[x])}}function E(d){var f=1;d=d.split(":");const x=[];for(;0<f&&d.length;)x.push(d.shift()),f--;return d.length&&x.push(d.join(":")),x}function k(d){l.setTimeout(()=>{throw d},0)}function w(){var d=B;let f=null;return d.g&&(f=d.g,d.g=d.g.next,d.g||(d.h=null),f.next=null),f}class Q{constructor(){this.h=this.g=null}add(f,x){const A=ae.get();A.set(f,x),this.h?this.h.next=A:this.g=A,this.h=A}}var ae=new M(()=>new V,d=>d.reset());class V{constructor(){this.next=this.g=this.h=null}set(f,x){this.h=f,this.g=x,this.next=null}reset(){this.next=this.g=this.h=null}}let X,he=!1,B=new Q,te=()=>{const d=l.Promise.resolve(void 0);X=()=>{d.then(ve)}};var ve=()=>{for(var d;d=w();){try{d.h.call(d.g)}catch(x){k(x)}var f=ae;f.j(d),100>f.h&&(f.h++,d.next=f.g,f.g=d)}he=!1};function W(){this.s=this.s,this.C=this.C}W.prototype.s=!1,W.prototype.ma=function(){this.s||(this.s=!0,this.N())},W.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function F(d,f){this.type=d,this.g=this.target=f,this.defaultPrevented=!1}F.prototype.h=function(){this.defaultPrevented=!0};var re=function(){if(!l.addEventListener||!Object.defineProperty)return!1;var d=!1,f=Object.defineProperty({},"passive",{get:function(){d=!0}});try{const x=()=>{};l.addEventListener("test",x,f),l.removeEventListener("test",x,f)}catch{}return d}();function de(d,f){if(F.call(this,d?d.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,d){var x=this.type=d.type,A=d.changedTouches&&d.changedTouches.length?d.changedTouches[0]:null;if(this.target=d.target||d.srcElement,this.g=f,f=d.relatedTarget){if(P){e:{try{R(f.nodeName);var ee=!0;break e}catch{}ee=!1}ee||(f=null)}}else x=="mouseover"?f=d.fromElement:x=="mouseout"&&(f=d.toElement);this.relatedTarget=f,A?(this.clientX=A.clientX!==void 0?A.clientX:A.pageX,this.clientY=A.clientY!==void 0?A.clientY:A.pageY,this.screenX=A.screenX||0,this.screenY=A.screenY||0):(this.clientX=d.clientX!==void 0?d.clientX:d.pageX,this.clientY=d.clientY!==void 0?d.clientY:d.pageY,this.screenX=d.screenX||0,this.screenY=d.screenY||0),this.button=d.button,this.key=d.key||"",this.ctrlKey=d.ctrlKey,this.altKey=d.altKey,this.shiftKey=d.shiftKey,this.metaKey=d.metaKey,this.pointerId=d.pointerId||0,this.pointerType=typeof d.pointerType=="string"?d.pointerType:$[d.pointerType]||"",this.state=d.state,this.i=d,d.defaultPrevented&&de.aa.h.call(this)}}j(de,F);var $={2:"touch",3:"pen",4:"mouse"};de.prototype.h=function(){de.aa.h.call(this);var d=this.i;d.preventDefault?d.preventDefault():d.returnValue=!1};var O="closure_listenable_"+(1e6*Math.random()|0),J=0;function Y(d,f,x,A,ee){this.listener=d,this.proxy=null,this.src=f,this.type=x,this.capture=!!A,this.ha=ee,this.key=++J,this.da=this.fa=!1}function Z(d){d.da=!0,d.listener=null,d.proxy=null,d.src=null,d.ha=null}function L(d){this.src=d,this.g={},this.h=0}L.prototype.add=function(d,f,x,A,ee){var le=d.toString();d=this.g[le],d||(d=this.g[le]=[],this.h++);var Ee=ge(d,f,A,ee);return-1<Ee?(f=d[Ee],x||(f.fa=!1)):(f=new Y(f,this.src,le,!!A,ee),f.fa=x,d.push(f)),f};function fe(d,f){var x=f.type;if(x in d.g){var A=d.g[x],ee=Array.prototype.indexOf.call(A,f,void 0),le;(le=0<=ee)&&Array.prototype.splice.call(A,ee,1),le&&(Z(f),d.g[x].length==0&&(delete d.g[x],d.h--))}}function ge(d,f,x,A){for(var ee=0;ee<d.length;++ee){var le=d[ee];if(!le.da&&le.listener==f&&le.capture==!!x&&le.ha==A)return ee}return-1}var H="closure_lm_"+(1e6*Math.random()|0),se={};function je(d,f,x,A,ee){if(Array.isArray(f)){for(var le=0;le<f.length;le++)je(d,f[le],x,A,ee);return null}return x=Oe(x),d&&d[O]?d.K(f,x,h(A)?!!A.capture:!1,ee):Se(d,f,x,!1,A,ee)}function Se(d,f,x,A,ee,le){if(!f)throw Error("Invalid event type");var Ee=h(ee)?!!ee.capture:!!ee,vt=ue(d);if(vt||(d[H]=vt=new L(d)),x=vt.add(f,x,A,Ee,le),x.proxy)return x;if(A=G(),x.proxy=A,A.src=d,A.listener=x,d.addEventListener)re||(ee=Ee),ee===void 0&&(ee=!1),d.addEventListener(f.toString(),A,ee);else if(d.attachEvent)d.attachEvent(ce(f.toString()),A);else if(d.addListener&&d.removeListener)d.addListener(A);else throw Error("addEventListener and attachEvent are unavailable.");return x}function G(){function d(x){return f.call(d.src,d.listener,x)}const f=ke;return d}function xe(d,f,x,A,ee){if(Array.isArray(f))for(var le=0;le<f.length;le++)xe(d,f[le],x,A,ee);else A=h(A)?!!A.capture:!!A,x=Oe(x),d&&d[O]?(d=d.i,f=String(f).toString(),f in d.g&&(le=d.g[f],x=ge(le,x,A,ee),-1<x&&(Z(le[x]),Array.prototype.splice.call(le,x,1),le.length==0&&(delete d.g[f],d.h--)))):d&&(d=ue(d))&&(f=d.g[f.toString()],d=-1,f&&(d=ge(f,x,A,ee)),(x=-1<d?f[d]:null)&&z(x))}function z(d){if(typeof d!="number"&&d&&!d.da){var f=d.src;if(f&&f[O])fe(f.i,d);else{var x=d.type,A=d.proxy;f.removeEventListener?f.removeEventListener(x,A,d.capture):f.detachEvent?f.detachEvent(ce(x),A):f.addListener&&f.removeListener&&f.removeListener(A),(x=ue(f))?(fe(x,d),x.h==0&&(x.src=null,f[H]=null)):Z(d)}}}function ce(d){return d in se?se[d]:se[d]="on"+d}function ke(d,f){if(d.da)d=!0;else{f=new de(f,this);var x=d.listener,A=d.ha||d.src;d.fa&&z(d),d=x.call(A,f)}return d}function ue(d){return d=d[H],d instanceof L?d:null}var $e="__closure_events_fn_"+(1e9*Math.random()>>>0);function Oe(d){return typeof d=="function"?d:(d[$e]||(d[$e]=function(f){return d.handleEvent(f)}),d[$e])}function U(){W.call(this),this.i=new L(this),this.M=this,this.F=null}j(U,W),U.prototype[O]=!0,U.prototype.removeEventListener=function(d,f,x,A){xe(this,d,f,x,A)};function _e(d,f){var x,A=d.F;if(A)for(x=[];A;A=A.F)x.push(A);if(d=d.M,A=f.type||f,typeof f=="string")f=new F(f,d);else if(f instanceof F)f.target=f.target||d;else{var ee=f;f=new F(A,d),S(f,ee)}if(ee=!0,x)for(var le=x.length-1;0<=le;le--){var Ee=f.g=x[le];ee=Pe(Ee,A,!0,f)&&ee}if(Ee=f.g=d,ee=Pe(Ee,A,!0,f)&&ee,ee=Pe(Ee,A,!1,f)&&ee,x)for(le=0;le<x.length;le++)Ee=f.g=x[le],ee=Pe(Ee,A,!1,f)&&ee}U.prototype.N=function(){if(U.aa.N.call(this),this.i){var d=this.i,f;for(f in d.g){for(var x=d.g[f],A=0;A<x.length;A++)Z(x[A]);delete d.g[f],d.h--}}this.F=null},U.prototype.K=function(d,f,x,A){return this.i.add(String(d),f,!1,x,A)},U.prototype.L=function(d,f,x,A){return this.i.add(String(d),f,!0,x,A)};function Pe(d,f,x,A){if(f=d.i.g[String(f)],!f)return!0;f=f.concat();for(var ee=!0,le=0;le<f.length;++le){var Ee=f[le];if(Ee&&!Ee.da&&Ee.capture==x){var vt=Ee.listener,Qt=Ee.ha||Ee.src;Ee.fa&&fe(d.i,Ee),ee=vt.call(Qt,A)!==!1&&ee}}return ee&&!A.defaultPrevented}function K(d,f,x){if(typeof d=="function")x&&(d=g(d,x));else if(d&&typeof d.handleEvent=="function")d=g(d.handleEvent,d);else throw Error("Invalid listener argument");return 2147483647<Number(f)?-1:l.setTimeout(d,f||0)}function q(d){d.g=K(()=>{d.g=null,d.i&&(d.i=!1,q(d))},d.l);const f=d.h;d.h=null,d.m.apply(null,f)}class Ce extends W{constructor(f,x){super(),this.m=f,this.l=x,this.h=null,this.i=!1,this.g=null}j(f){this.h=arguments,this.g?this.i=!0:q(this)}N(){super.N(),this.g&&(l.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Le(d){W.call(this),this.h=d,this.g={}}j(Le,W);var Ue=[];function ye(d){C(d.g,function(f,x){this.g.hasOwnProperty(x)&&z(f)},d),d.g={}}Le.prototype.N=function(){Le.aa.N.call(this),ye(this)},Le.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var mt=l.JSON.stringify,qe=l.JSON.parse,et=class{stringify(d){return l.JSON.stringify(d,void 0)}parse(d){return l.JSON.parse(d,void 0)}};function Te(){}Te.prototype.h=null;function Ve(d){return d.h||(d.h=d.i())}function wt(){}var ct={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function Cs(){F.call(this,"d")}j(Cs,F);function Yt(){F.call(this,"c")}j(Yt,F);var ie={},Ne=null;function Ae(){return Ne=Ne||new U}ie.La="serverreachability";function Ze(d){F.call(this,ie.La,d)}j(Ze,F);function Xe(d){const f=Ae();_e(f,new Ze(f))}ie.STAT_EVENT="statevent";function st(d,f){F.call(this,ie.STAT_EVENT,d),this.stat=f}j(st,F);function ze(d){const f=Ae();_e(f,new st(f,d))}ie.Ma="timingevent";function Be(d,f){F.call(this,ie.Ma,d),this.size=f}j(Be,F);function Ge(d,f){if(typeof d!="function")throw Error("Fn must not be null and must be a function");return l.setTimeout(function(){d()},f)}function at(){this.g=!0}at.prototype.xa=function(){this.g=!1};function yt(d,f,x,A,ee,le){d.info(function(){if(d.g)if(le)for(var Ee="",vt=le.split("&"),Qt=0;Qt<vt.length;Qt++){var dt=vt[Qt].split("=");if(1<dt.length){var ss=dt[0];dt=dt[1];var rs=ss.split("_");Ee=2<=rs.length&&rs[1]=="type"?Ee+(ss+"="+dt+"&"):Ee+(ss+"=redacted&")}}else Ee=null;else Ee=le;return"XMLHTTP REQ ("+A+") [attempt "+ee+"]: "+f+`
`+x+`
`+Ee})}function St(d,f,x,A,ee,le,Ee){d.info(function(){return"XMLHTTP RESP ("+A+") [ attempt "+ee+"]: "+f+`
`+x+`
`+le+" "+Ee})}function ne(d,f,x,A){d.info(function(){return"XMLHTTP TEXT ("+f+"): "+Qe(d,x)+(A?" "+A:"")})}function me(d,f){d.info(function(){return"TIMEOUT: "+f})}at.prototype.info=function(){};function Qe(d,f){if(!d.g)return f;if(!f)return null;try{var x=JSON.parse(f);if(x){for(d=0;d<x.length;d++)if(Array.isArray(x[d])){var A=x[d];if(!(2>A.length)){var ee=A[1];if(Array.isArray(ee)&&!(1>ee.length)){var le=ee[0];if(le!="noop"&&le!="stop"&&le!="close")for(var Ee=1;Ee<ee.length;Ee++)ee[Ee]=""}}}}return mt(x)}catch{return f}}var ys={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},ur={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},Tc;function mo(){}j(mo,Te),mo.prototype.g=function(){return new XMLHttpRequest},mo.prototype.i=function(){return{}},Tc=new mo;function Br(d,f,x,A){this.j=d,this.i=f,this.l=x,this.R=A||1,this.U=new Le(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new Pu}function Pu(){this.i=null,this.g="",this.h=!1}var Ou={},Ic={};function Ac(d,f,x){d.L=1,d.v=xo(mr(f)),d.m=x,d.P=!0,Lu(d,null)}function Lu(d,f){d.F=Date.now(),go(d),d.A=mr(d.v);var x=d.A,A=d.R;Array.isArray(A)||(A=[String(A)]),Ju(x.i,"t",A),d.C=0,x=d.j.J,d.h=new Pu,d.g=pm(d.j,x?f:null,!d.m),0<d.O&&(d.M=new Ce(g(d.Y,d,d.g),d.O)),f=d.U,x=d.g,A=d.ca;var ee="readystatechange";Array.isArray(ee)||(ee&&(Ue[0]=ee.toString()),ee=Ue);for(var le=0;le<ee.length;le++){var Ee=je(x,ee[le],A||f.handleEvent,!1,f.h||f);if(!Ee)break;f.g[Ee.key]=Ee}f=d.H?b(d.H):{},d.m?(d.u||(d.u="POST"),f["Content-Type"]="application/x-www-form-urlencoded",d.g.ea(d.A,d.u,d.m,f)):(d.u="GET",d.g.ea(d.A,d.u,null,f)),Xe(),yt(d.i,d.u,d.A,d.l,d.R,d.m)}Br.prototype.ca=function(d){d=d.target;const f=this.M;f&&gr(d)==3?f.j():this.Y(d)},Br.prototype.Y=function(d){try{if(d==this.g)e:{const rs=gr(this.g);var f=this.g.Ba();const ea=this.g.Z();if(!(3>rs)&&(rs!=3||this.g&&(this.h.h||this.g.oa()||am(this.g)))){this.J||rs!=4||f==7||(f==8||0>=ea?Xe(3):Xe(2)),Cc(this);var x=this.g.Z();this.X=x;t:if(Vu(this)){var A=am(this.g);d="";var ee=A.length,le=gr(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){vn(this),Ba(this);var Ee="";break t}this.h.i=new l.TextDecoder}for(f=0;f<ee;f++)this.h.h=!0,d+=this.h.i.decode(A[f],{stream:!(le&&f==ee-1)});A.length=0,this.h.g+=d,this.C=0,Ee=this.h.g}else Ee=this.g.oa();if(this.o=x==200,St(this.i,this.u,this.A,this.l,this.R,rs,x),this.o){if(this.T&&!this.K){t:{if(this.g){var vt,Qt=this.g;if((vt=Qt.g?Qt.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!D(vt)){var dt=vt;break t}}dt=null}if(x=dt)ne(this.i,this.l,x,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Dc(this,x);else{this.o=!1,this.s=3,ze(12),vn(this),Ba(this);break e}}if(this.P){x=!0;let Bs;for(;!this.J&&this.C<Ee.length;)if(Bs=vy(this,Ee),Bs==Ic){rs==4&&(this.s=4,ze(14),x=!1),ne(this.i,this.l,null,"[Incomplete Response]");break}else if(Bs==Ou){this.s=4,ze(15),ne(this.i,this.l,Ee,"[Invalid Chunk]"),x=!1;break}else ne(this.i,this.l,Bs,null),Dc(this,Bs);if(Vu(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),rs!=4||Ee.length!=0||this.h.h||(this.s=1,ze(16),x=!1),this.o=this.o&&x,!x)ne(this.i,this.l,Ee,"[Invalid Chunked Response]"),vn(this),Ba(this);else if(0<Ee.length&&!this.W){this.W=!0;var ss=this.j;ss.g==this&&ss.ba&&!ss.M&&(ss.j.info("Great, no buffering proxy detected. Bytes received: "+Ee.length),Lc(ss),ss.M=!0,ze(11))}}else ne(this.i,this.l,Ee,null),Dc(this,Ee);rs==4&&vn(this),this.o&&!this.J&&(rs==4?um(this.j,this):(this.o=!1,go(this)))}else Oy(this.g),x==400&&0<Ee.indexOf("Unknown SID")?(this.s=3,ze(12)):(this.s=0,ze(13)),vn(this),Ba(this)}}}catch{}finally{}};function Vu(d){return d.g?d.u=="GET"&&d.L!=2&&d.j.Ca:!1}function vy(d,f){var x=d.C,A=f.indexOf(`
`,x);return A==-1?Ic:(x=Number(f.substring(x,A)),isNaN(x)?Ou:(A+=1,A+x>f.length?Ic:(f=f.slice(A,A+x),d.C=A+x,f)))}Br.prototype.cancel=function(){this.J=!0,vn(this)};function go(d){d.S=Date.now()+d.I,Fu(d,d.I)}function Fu(d,f){if(d.B!=null)throw Error("WatchDog timer not null");d.B=Ge(g(d.ba,d),f)}function Cc(d){d.B&&(l.clearTimeout(d.B),d.B=null)}Br.prototype.ba=function(){this.B=null;const d=Date.now();0<=d-this.S?(me(this.i,this.A),this.L!=2&&(Xe(),ze(17)),vn(this),this.s=2,Ba(this)):Fu(this,this.S-d)};function Ba(d){d.j.G==0||d.J||um(d.j,d)}function vn(d){Cc(d);var f=d.M;f&&typeof f.ma=="function"&&f.ma(),d.M=null,ye(d.U),d.g&&(f=d.g,d.g=null,f.abort(),f.ma())}function Dc(d,f){try{var x=d.j;if(x.G!=0&&(x.g==d||Mc(x.h,d))){if(!d.K&&Mc(x.h,d)&&x.G==3){try{var A=x.Da.g.parse(f)}catch{A=null}if(Array.isArray(A)&&A.length==3){var ee=A;if(ee[0]==0){e:if(!x.u){if(x.g)if(x.g.F+3e3<d.F)_o(x),wo(x);else break e;Oc(x),ze(18)}}else x.za=ee[1],0<x.za-x.T&&37500>ee[2]&&x.F&&x.v==0&&!x.C&&(x.C=Ge(g(x.Za,x),6e3));if(1>=zu(x.h)&&x.ca){try{x.ca()}catch{}x.ca=void 0}}else kn(x,11)}else if((d.K||x.g==d)&&_o(x),!D(f))for(ee=x.Da.g.parse(f),f=0;f<ee.length;f++){let dt=ee[f];if(x.T=dt[0],dt=dt[1],x.G==2)if(dt[0]=="c"){x.K=dt[1],x.ia=dt[2];const ss=dt[3];ss!=null&&(x.la=ss,x.j.info("VER="+x.la));const rs=dt[4];rs!=null&&(x.Aa=rs,x.j.info("SVER="+x.Aa));const ea=dt[5];ea!=null&&typeof ea=="number"&&0<ea&&(A=1.5*ea,x.L=A,x.j.info("backChannelRequestTimeoutMs_="+A)),A=x;const Bs=d.g;if(Bs){const jo=Bs.g?Bs.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(jo){var le=A.h;le.g||jo.indexOf("spdy")==-1&&jo.indexOf("quic")==-1&&jo.indexOf("h2")==-1||(le.j=le.l,le.g=new Set,le.h&&($c(le,le.h),le.h=null))}if(A.D){const Vc=Bs.g?Bs.g.getResponseHeader("X-HTTP-Session-Id"):null;Vc&&(A.ya=Vc,Nt(A.I,A.D,Vc))}}x.G=3,x.l&&x.l.ua(),x.ba&&(x.R=Date.now()-d.F,x.j.info("Handshake RTT: "+x.R+"ms")),A=x;var Ee=d;if(A.qa=fm(A,A.J?A.ia:null,A.W),Ee.K){Hu(A.h,Ee);var vt=Ee,Qt=A.L;Qt&&(vt.I=Qt),vt.B&&(Cc(vt),go(vt)),A.g=Ee}else dm(A);0<x.i.length&&ko(x)}else dt[0]!="stop"&&dt[0]!="close"||kn(x,7);else x.G==3&&(dt[0]=="stop"||dt[0]=="close"?dt[0]=="stop"?kn(x,7):Pc(x):dt[0]!="noop"&&x.l&&x.l.ta(dt),x.v=0)}}Xe(4)}catch{}}var wy=class{constructor(d,f){this.g=d,this.map=f}};function Uu(d){this.l=d||10,l.PerformanceNavigationTiming?(d=l.performance.getEntriesByType("navigation"),d=0<d.length&&(d[0].nextHopProtocol=="hq"||d[0].nextHopProtocol=="h2")):d=!!(l.chrome&&l.chrome.loadTimes&&l.chrome.loadTimes()&&l.chrome.loadTimes().wasFetchedViaSpdy),this.j=d?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function Bu(d){return d.h?!0:d.g?d.g.size>=d.j:!1}function zu(d){return d.h?1:d.g?d.g.size:0}function Mc(d,f){return d.h?d.h==f:d.g?d.g.has(f):!1}function $c(d,f){d.g?d.g.add(f):d.h=f}function Hu(d,f){d.h&&d.h==f?d.h=null:d.g&&d.g.has(f)&&d.g.delete(f)}Uu.prototype.cancel=function(){if(this.i=Wu(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const d of this.g.values())d.cancel();this.g.clear()}};function Wu(d){if(d.h!=null)return d.i.concat(d.h.D);if(d.g!=null&&d.g.size!==0){let f=d.i;for(const x of d.g.values())f=f.concat(x.D);return f}return _(d.i)}function ky(d){if(d.V&&typeof d.V=="function")return d.V();if(typeof Map<"u"&&d instanceof Map||typeof Set<"u"&&d instanceof Set)return Array.from(d.values());if(typeof d=="string")return d.split("");if(c(d)){for(var f=[],x=d.length,A=0;A<x;A++)f.push(d[A]);return f}f=[],x=0;for(A in d)f[x++]=d[A];return f}function _y(d){if(d.na&&typeof d.na=="function")return d.na();if(!d.V||typeof d.V!="function"){if(typeof Map<"u"&&d instanceof Map)return Array.from(d.keys());if(!(typeof Set<"u"&&d instanceof Set)){if(c(d)||typeof d=="string"){var f=[];d=d.length;for(var x=0;x<d;x++)f.push(x);return f}f=[],x=0;for(const A in d)f[x++]=A;return f}}}function qu(d,f){if(d.forEach&&typeof d.forEach=="function")d.forEach(f,void 0);else if(c(d)||typeof d=="string")Array.prototype.forEach.call(d,f,void 0);else for(var x=_y(d),A=ky(d),ee=A.length,le=0;le<ee;le++)f.call(void 0,A[le],x&&x[le],d)}var Gu=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Ny(d,f){if(d){d=d.split("&");for(var x=0;x<d.length;x++){var A=d[x].indexOf("="),ee=null;if(0<=A){var le=d[x].substring(0,A);ee=d[x].substring(A+1)}else le=d[x];f(le,ee?decodeURIComponent(ee.replace(/\+/g," ")):"")}}}function wn(d){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,d instanceof wn){this.h=d.h,fo(this,d.j),this.o=d.o,this.g=d.g,po(this,d.s),this.l=d.l;var f=d.i,x=new Wa;x.i=f.i,f.g&&(x.g=new Map(f.g),x.h=f.h),Ku(this,x),this.m=d.m}else d&&(f=String(d).match(Gu))?(this.h=!1,fo(this,f[1]||"",!0),this.o=za(f[2]||""),this.g=za(f[3]||"",!0),po(this,f[4]),this.l=za(f[5]||"",!0),Ku(this,f[6]||"",!0),this.m=za(f[7]||"")):(this.h=!1,this.i=new Wa(null,this.h))}wn.prototype.toString=function(){var d=[],f=this.j;f&&d.push(Ha(f,Yu,!0),":");var x=this.g;return(x||f=="file")&&(d.push("//"),(f=this.o)&&d.push(Ha(f,Yu,!0),"@"),d.push(encodeURIComponent(String(x)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),x=this.s,x!=null&&d.push(":",String(x))),(x=this.l)&&(this.g&&x.charAt(0)!="/"&&d.push("/"),d.push(Ha(x,x.charAt(0)=="/"?Sy:Ey,!0))),(x=this.i.toString())&&d.push("?",x),(x=this.m)&&d.push("#",Ha(x,Iy)),d.join("")};function mr(d){return new wn(d)}function fo(d,f,x){d.j=x?za(f,!0):f,d.j&&(d.j=d.j.replace(/:$/,""))}function po(d,f){if(f){if(f=Number(f),isNaN(f)||0>f)throw Error("Bad port number "+f);d.s=f}else d.s=null}function Ku(d,f,x){f instanceof Wa?(d.i=f,Ay(d.i,d.h)):(x||(f=Ha(f,Ty)),d.i=new Wa(f,d.h))}function Nt(d,f,x){d.i.set(f,x)}function xo(d){return Nt(d,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),d}function za(d,f){return d?f?decodeURI(d.replace(/%25/g,"%2525")):decodeURIComponent(d):""}function Ha(d,f,x){return typeof d=="string"?(d=encodeURI(d).replace(f,jy),x&&(d=d.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),d):null}function jy(d){return d=d.charCodeAt(0),"%"+(d>>4&15).toString(16)+(d&15).toString(16)}var Yu=/[#\/\?@]/g,Ey=/[#\?:]/g,Sy=/[#\?]/g,Ty=/[#\?@]/g,Iy=/#/g;function Wa(d,f){this.h=this.g=null,this.i=d||null,this.j=!!f}function zr(d){d.g||(d.g=new Map,d.h=0,d.i&&Ny(d.i,function(f,x){d.add(decodeURIComponent(f.replace(/\+/g," ")),x)}))}s=Wa.prototype,s.add=function(d,f){zr(this),this.i=null,d=Jn(this,d);var x=this.g.get(d);return x||this.g.set(d,x=[]),x.push(f),this.h+=1,this};function Qu(d,f){zr(d),f=Jn(d,f),d.g.has(f)&&(d.i=null,d.h-=d.g.get(f).length,d.g.delete(f))}function Xu(d,f){return zr(d),f=Jn(d,f),d.g.has(f)}s.forEach=function(d,f){zr(this),this.g.forEach(function(x,A){x.forEach(function(ee){d.call(f,ee,A,this)},this)},this)},s.na=function(){zr(this);const d=Array.from(this.g.values()),f=Array.from(this.g.keys()),x=[];for(let A=0;A<f.length;A++){const ee=d[A];for(let le=0;le<ee.length;le++)x.push(f[A])}return x},s.V=function(d){zr(this);let f=[];if(typeof d=="string")Xu(this,d)&&(f=f.concat(this.g.get(Jn(this,d))));else{d=Array.from(this.g.values());for(let x=0;x<d.length;x++)f=f.concat(d[x])}return f},s.set=function(d,f){return zr(this),this.i=null,d=Jn(this,d),Xu(this,d)&&(this.h-=this.g.get(d).length),this.g.set(d,[f]),this.h+=1,this},s.get=function(d,f){return d?(d=this.V(d),0<d.length?String(d[0]):f):f};function Ju(d,f,x){Qu(d,f),0<x.length&&(d.i=null,d.g.set(Jn(d,f),_(x)),d.h+=x.length)}s.toString=function(){if(this.i)return this.i;if(!this.g)return"";const d=[],f=Array.from(this.g.keys());for(var x=0;x<f.length;x++){var A=f[x];const le=encodeURIComponent(String(A)),Ee=this.V(A);for(A=0;A<Ee.length;A++){var ee=le;Ee[A]!==""&&(ee+="="+encodeURIComponent(String(Ee[A]))),d.push(ee)}}return this.i=d.join("&")};function Jn(d,f){return f=String(f),d.j&&(f=f.toLowerCase()),f}function Ay(d,f){f&&!d.j&&(zr(d),d.i=null,d.g.forEach(function(x,A){var ee=A.toLowerCase();A!=ee&&(Qu(this,A),Ju(this,ee,x))},d)),d.j=f}function Cy(d,f){const x=new at;if(l.Image){const A=new Image;A.onload=p(Hr,x,"TestLoadImage: loaded",!0,f,A),A.onerror=p(Hr,x,"TestLoadImage: error",!1,f,A),A.onabort=p(Hr,x,"TestLoadImage: abort",!1,f,A),A.ontimeout=p(Hr,x,"TestLoadImage: timeout",!1,f,A),l.setTimeout(function(){A.ontimeout&&A.ontimeout()},1e4),A.src=d}else f(!1)}function Dy(d,f){const x=new at,A=new AbortController,ee=setTimeout(()=>{A.abort(),Hr(x,"TestPingServer: timeout",!1,f)},1e4);fetch(d,{signal:A.signal}).then(le=>{clearTimeout(ee),le.ok?Hr(x,"TestPingServer: ok",!0,f):Hr(x,"TestPingServer: server error",!1,f)}).catch(()=>{clearTimeout(ee),Hr(x,"TestPingServer: error",!1,f)})}function Hr(d,f,x,A,ee){try{ee&&(ee.onload=null,ee.onerror=null,ee.onabort=null,ee.ontimeout=null),A(x)}catch{}}function My(){this.g=new et}function $y(d,f,x){const A=x||"";try{qu(d,function(ee,le){let Ee=ee;h(ee)&&(Ee=mt(ee)),f.push(A+le+"="+encodeURIComponent(Ee))})}catch(ee){throw f.push(A+"type="+encodeURIComponent("_badmap")),ee}}function bo(d){this.l=d.Ub||null,this.j=d.eb||!1}j(bo,Te),bo.prototype.g=function(){return new yo(this.l,this.j)},bo.prototype.i=function(d){return function(){return d}}({});function yo(d,f){U.call(this),this.D=d,this.o=f,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}j(yo,U),s=yo.prototype,s.open=function(d,f){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=d,this.A=f,this.readyState=1,Ga(this)},s.send=function(d){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const f={headers:this.u,method:this.B,credentials:this.m,cache:void 0};d&&(f.body=d),(this.D||l).fetch(new Request(this.A,f)).then(this.Sa.bind(this),this.ga.bind(this))},s.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,qa(this)),this.readyState=0},s.Sa=function(d){if(this.g&&(this.l=d,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=d.headers,this.readyState=2,Ga(this)),this.g&&(this.readyState=3,Ga(this),this.g)))if(this.responseType==="arraybuffer")d.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof l.ReadableStream<"u"&&"body"in d){if(this.j=d.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;Zu(this)}else d.text().then(this.Ra.bind(this),this.ga.bind(this))};function Zu(d){d.j.read().then(d.Pa.bind(d)).catch(d.ga.bind(d))}s.Pa=function(d){if(this.g){if(this.o&&d.value)this.response.push(d.value);else if(!this.o){var f=d.value?d.value:new Uint8Array(0);(f=this.v.decode(f,{stream:!d.done}))&&(this.response=this.responseText+=f)}d.done?qa(this):Ga(this),this.readyState==3&&Zu(this)}},s.Ra=function(d){this.g&&(this.response=this.responseText=d,qa(this))},s.Qa=function(d){this.g&&(this.response=d,qa(this))},s.ga=function(){this.g&&qa(this)};function qa(d){d.readyState=4,d.l=null,d.j=null,d.v=null,Ga(d)}s.setRequestHeader=function(d,f){this.u.append(d,f)},s.getResponseHeader=function(d){return this.h&&this.h.get(d.toLowerCase())||""},s.getAllResponseHeaders=function(){if(!this.h)return"";const d=[],f=this.h.entries();for(var x=f.next();!x.done;)x=x.value,d.push(x[0]+": "+x[1]),x=f.next();return d.join(`\r
`)};function Ga(d){d.onreadystatechange&&d.onreadystatechange.call(d)}Object.defineProperty(yo.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(d){this.m=d?"include":"same-origin"}});function em(d){let f="";return C(d,function(x,A){f+=A,f+=":",f+=x,f+=`\r
`}),f}function Rc(d,f,x){e:{for(A in x){var A=!1;break e}A=!0}A||(x=em(x),typeof d=="string"?x!=null&&encodeURIComponent(String(x)):Nt(d,f,x))}function Mt(d){U.call(this),this.headers=new Map,this.o=d||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}j(Mt,U);var Ry=/^https?$/i,Py=["POST","PUT"];s=Mt.prototype,s.Ha=function(d){this.J=d},s.ea=function(d,f,x,A){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+d);f=f?f.toUpperCase():"GET",this.D=d,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():Tc.g(),this.v=this.o?Ve(this.o):Ve(Tc),this.g.onreadystatechange=g(this.Ea,this);try{this.B=!0,this.g.open(f,String(d),!0),this.B=!1}catch(le){tm(this,le);return}if(d=x||"",x=new Map(this.headers),A)if(Object.getPrototypeOf(A)===Object.prototype)for(var ee in A)x.set(ee,A[ee]);else if(typeof A.keys=="function"&&typeof A.get=="function")for(const le of A.keys())x.set(le,A.get(le));else throw Error("Unknown input type for opt_headers: "+String(A));A=Array.from(x.keys()).find(le=>le.toLowerCase()=="content-type"),ee=l.FormData&&d instanceof l.FormData,!(0<=Array.prototype.indexOf.call(Py,f,void 0))||A||ee||x.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[le,Ee]of x)this.g.setRequestHeader(le,Ee);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{nm(this),this.u=!0,this.g.send(d),this.u=!1}catch(le){tm(this,le)}};function tm(d,f){d.h=!1,d.g&&(d.j=!0,d.g.abort(),d.j=!1),d.l=f,d.m=5,sm(d),vo(d)}function sm(d){d.A||(d.A=!0,_e(d,"complete"),_e(d,"error"))}s.abort=function(d){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=d||7,_e(this,"complete"),_e(this,"abort"),vo(this))},s.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),vo(this,!0)),Mt.aa.N.call(this)},s.Ea=function(){this.s||(this.B||this.u||this.j?rm(this):this.bb())},s.bb=function(){rm(this)};function rm(d){if(d.h&&typeof o<"u"&&(!d.v[1]||gr(d)!=4||d.Z()!=2)){if(d.u&&gr(d)==4)K(d.Ea,0,d);else if(_e(d,"readystatechange"),gr(d)==4){d.h=!1;try{const Ee=d.Z();e:switch(Ee){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var f=!0;break e;default:f=!1}var x;if(!(x=f)){var A;if(A=Ee===0){var ee=String(d.D).match(Gu)[1]||null;!ee&&l.self&&l.self.location&&(ee=l.self.location.protocol.slice(0,-1)),A=!Ry.test(ee?ee.toLowerCase():"")}x=A}if(x)_e(d,"complete"),_e(d,"success");else{d.m=6;try{var le=2<gr(d)?d.g.statusText:""}catch{le=""}d.l=le+" ["+d.Z()+"]",sm(d)}}finally{vo(d)}}}}function vo(d,f){if(d.g){nm(d);const x=d.g,A=d.v[0]?()=>{}:null;d.g=null,d.v=null,f||_e(d,"ready");try{x.onreadystatechange=A}catch{}}}function nm(d){d.I&&(l.clearTimeout(d.I),d.I=null)}s.isActive=function(){return!!this.g};function gr(d){return d.g?d.g.readyState:0}s.Z=function(){try{return 2<gr(this)?this.g.status:-1}catch{return-1}},s.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},s.Oa=function(d){if(this.g){var f=this.g.responseText;return d&&f.indexOf(d)==0&&(f=f.substring(d.length)),qe(f)}};function am(d){try{if(!d.g)return null;if("response"in d.g)return d.g.response;switch(d.H){case"":case"text":return d.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in d.g)return d.g.mozResponseArrayBuffer}return null}catch{return null}}function Oy(d){const f={};d=(d.g&&2<=gr(d)&&d.g.getAllResponseHeaders()||"").split(`\r
`);for(let A=0;A<d.length;A++){if(D(d[A]))continue;var x=E(d[A]);const ee=x[0];if(x=x[1],typeof x!="string")continue;x=x.trim();const le=f[ee]||[];f[ee]=le,le.push(x)}N(f,function(A){return A.join(", ")})}s.Ba=function(){return this.m},s.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function Ka(d,f,x){return x&&x.internalChannelParams&&x.internalChannelParams[d]||f}function im(d){this.Aa=0,this.i=[],this.j=new at,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=Ka("failFast",!1,d),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=Ka("baseRetryDelayMs",5e3,d),this.cb=Ka("retryDelaySeedMs",1e4,d),this.Wa=Ka("forwardChannelMaxRetries",2,d),this.wa=Ka("forwardChannelRequestTimeoutMs",2e4,d),this.pa=d&&d.xmlHttpFactory||void 0,this.Xa=d&&d.Tb||void 0,this.Ca=d&&d.useFetchStreams||!1,this.L=void 0,this.J=d&&d.supportsCrossDomainXhr||!1,this.K="",this.h=new Uu(d&&d.concurrentRequestLimit),this.Da=new My,this.P=d&&d.fastHandshake||!1,this.O=d&&d.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=d&&d.Rb||!1,d&&d.xa&&this.j.xa(),d&&d.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&d&&d.detectBufferingProxy||!1,this.ja=void 0,d&&d.longPollingTimeout&&0<d.longPollingTimeout&&(this.ja=d.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}s=im.prototype,s.la=8,s.G=1,s.connect=function(d,f,x,A){ze(0),this.W=d,this.H=f||{},x&&A!==void 0&&(this.H.OSID=x,this.H.OAID=A),this.F=this.X,this.I=fm(this,null,this.W),ko(this)};function Pc(d){if(om(d),d.G==3){var f=d.U++,x=mr(d.I);if(Nt(x,"SID",d.K),Nt(x,"RID",f),Nt(x,"TYPE","terminate"),Ya(d,x),f=new Br(d,d.j,f),f.L=2,f.v=xo(mr(x)),x=!1,l.navigator&&l.navigator.sendBeacon)try{x=l.navigator.sendBeacon(f.v.toString(),"")}catch{}!x&&l.Image&&(new Image().src=f.v,x=!0),x||(f.g=pm(f.j,null),f.g.ea(f.v)),f.F=Date.now(),go(f)}gm(d)}function wo(d){d.g&&(Lc(d),d.g.cancel(),d.g=null)}function om(d){wo(d),d.u&&(l.clearTimeout(d.u),d.u=null),_o(d),d.h.cancel(),d.s&&(typeof d.s=="number"&&l.clearTimeout(d.s),d.s=null)}function ko(d){if(!Bu(d.h)&&!d.s){d.s=!0;var f=d.Ga;X||te(),he||(X(),he=!0),B.add(f,d),d.B=0}}function Ly(d,f){return zu(d.h)>=d.h.j-(d.s?1:0)?!1:d.s?(d.i=f.D.concat(d.i),!0):d.G==1||d.G==2||d.B>=(d.Va?0:d.Wa)?!1:(d.s=Ge(g(d.Ga,d,f),mm(d,d.B)),d.B++,!0)}s.Ga=function(d){if(this.s)if(this.s=null,this.G==1){if(!d){this.U=Math.floor(1e5*Math.random()),d=this.U++;const ee=new Br(this,this.j,d);let le=this.o;if(this.S&&(le?(le=b(le),S(le,this.S)):le=this.S),this.m!==null||this.O||(ee.H=le,le=null),this.P)e:{for(var f=0,x=0;x<this.i.length;x++){t:{var A=this.i[x];if("__data__"in A.map&&(A=A.map.__data__,typeof A=="string")){A=A.length;break t}A=void 0}if(A===void 0)break;if(f+=A,4096<f){f=x;break e}if(f===4096||x===this.i.length-1){f=x+1;break e}}f=1e3}else f=1e3;f=cm(this,ee,f),x=mr(this.I),Nt(x,"RID",d),Nt(x,"CVER",22),this.D&&Nt(x,"X-HTTP-Session-Id",this.D),Ya(this,x),le&&(this.O?f="headers="+encodeURIComponent(String(em(le)))+"&"+f:this.m&&Rc(x,this.m,le)),$c(this.h,ee),this.Ua&&Nt(x,"TYPE","init"),this.P?(Nt(x,"$req",f),Nt(x,"SID","null"),ee.T=!0,Ac(ee,x,null)):Ac(ee,x,f),this.G=2}}else this.G==3&&(d?lm(this,d):this.i.length==0||Bu(this.h)||lm(this))};function lm(d,f){var x;f?x=f.l:x=d.U++;const A=mr(d.I);Nt(A,"SID",d.K),Nt(A,"RID",x),Nt(A,"AID",d.T),Ya(d,A),d.m&&d.o&&Rc(A,d.m,d.o),x=new Br(d,d.j,x,d.B+1),d.m===null&&(x.H=d.o),f&&(d.i=f.D.concat(d.i)),f=cm(d,x,1e3),x.I=Math.round(.5*d.wa)+Math.round(.5*d.wa*Math.random()),$c(d.h,x),Ac(x,A,f)}function Ya(d,f){d.H&&C(d.H,function(x,A){Nt(f,A,x)}),d.l&&qu({},function(x,A){Nt(f,A,x)})}function cm(d,f,x){x=Math.min(d.i.length,x);var A=d.l?g(d.l.Na,d.l,d):null;e:{var ee=d.i;let le=-1;for(;;){const Ee=["count="+x];le==-1?0<x?(le=ee[0].g,Ee.push("ofs="+le)):le=0:Ee.push("ofs="+le);let vt=!0;for(let Qt=0;Qt<x;Qt++){let dt=ee[Qt].g;const ss=ee[Qt].map;if(dt-=le,0>dt)le=Math.max(0,ee[Qt].g-100),vt=!1;else try{$y(ss,Ee,"req"+dt+"_")}catch{A&&A(ss)}}if(vt){A=Ee.join("&");break e}}}return d=d.i.splice(0,x),f.D=d,A}function dm(d){if(!d.g&&!d.u){d.Y=1;var f=d.Fa;X||te(),he||(X(),he=!0),B.add(f,d),d.v=0}}function Oc(d){return d.g||d.u||3<=d.v?!1:(d.Y++,d.u=Ge(g(d.Fa,d),mm(d,d.v)),d.v++,!0)}s.Fa=function(){if(this.u=null,hm(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var d=2*this.R;this.j.info("BP detection timer enabled: "+d),this.A=Ge(g(this.ab,this),d)}},s.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,ze(10),wo(this),hm(this))};function Lc(d){d.A!=null&&(l.clearTimeout(d.A),d.A=null)}function hm(d){d.g=new Br(d,d.j,"rpc",d.Y),d.m===null&&(d.g.H=d.o),d.g.O=0;var f=mr(d.qa);Nt(f,"RID","rpc"),Nt(f,"SID",d.K),Nt(f,"AID",d.T),Nt(f,"CI",d.F?"0":"1"),!d.F&&d.ja&&Nt(f,"TO",d.ja),Nt(f,"TYPE","xmlhttp"),Ya(d,f),d.m&&d.o&&Rc(f,d.m,d.o),d.L&&(d.g.I=d.L);var x=d.g;d=d.ia,x.L=1,x.v=xo(mr(f)),x.m=null,x.P=!0,Lu(x,d)}s.Za=function(){this.C!=null&&(this.C=null,wo(this),Oc(this),ze(19))};function _o(d){d.C!=null&&(l.clearTimeout(d.C),d.C=null)}function um(d,f){var x=null;if(d.g==f){_o(d),Lc(d),d.g=null;var A=2}else if(Mc(d.h,f))x=f.D,Hu(d.h,f),A=1;else return;if(d.G!=0){if(f.o)if(A==1){x=f.m?f.m.length:0,f=Date.now()-f.F;var ee=d.B;A=Ae(),_e(A,new Be(A,x)),ko(d)}else dm(d);else if(ee=f.s,ee==3||ee==0&&0<f.X||!(A==1&&Ly(d,f)||A==2&&Oc(d)))switch(x&&0<x.length&&(f=d.h,f.i=f.i.concat(x)),ee){case 1:kn(d,5);break;case 4:kn(d,10);break;case 3:kn(d,6);break;default:kn(d,2)}}}function mm(d,f){let x=d.Ta+Math.floor(Math.random()*d.cb);return d.isActive()||(x*=2),x*f}function kn(d,f){if(d.j.info("Error code "+f),f==2){var x=g(d.fb,d),A=d.Xa;const ee=!A;A=new wn(A||"//www.google.com/images/cleardot.gif"),l.location&&l.location.protocol=="http"||fo(A,"https"),xo(A),ee?Cy(A.toString(),x):Dy(A.toString(),x)}else ze(2);d.G=0,d.l&&d.l.sa(f),gm(d),om(d)}s.fb=function(d){d?(this.j.info("Successfully pinged google.com"),ze(2)):(this.j.info("Failed to ping google.com"),ze(1))};function gm(d){if(d.G=0,d.ka=[],d.l){const f=Wu(d.h);(f.length!=0||d.i.length!=0)&&(y(d.ka,f),y(d.ka,d.i),d.h.i.length=0,_(d.i),d.i.length=0),d.l.ra()}}function fm(d,f,x){var A=x instanceof wn?mr(x):new wn(x);if(A.g!="")f&&(A.g=f+"."+A.g),po(A,A.s);else{var ee=l.location;A=ee.protocol,f=f?f+"."+ee.hostname:ee.hostname,ee=+ee.port;var le=new wn(null);A&&fo(le,A),f&&(le.g=f),ee&&po(le,ee),x&&(le.l=x),A=le}return x=d.D,f=d.ya,x&&f&&Nt(A,x,f),Nt(A,"VER",d.la),Ya(d,A),A}function pm(d,f,x){if(f&&!d.J)throw Error("Can't create secondary domain capable XhrIo object.");return f=d.Ca&&!d.pa?new Mt(new bo({eb:x})):new Mt(d.pa),f.Ha(d.J),f}s.isActive=function(){return!!this.l&&this.l.isActive(this)};function xm(){}s=xm.prototype,s.ua=function(){},s.ta=function(){},s.sa=function(){},s.ra=function(){},s.isActive=function(){return!0},s.Na=function(){};function No(){}No.prototype.g=function(d,f){return new Ss(d,f)};function Ss(d,f){U.call(this),this.g=new im(f),this.l=d,this.h=f&&f.messageUrlParams||null,d=f&&f.messageHeaders||null,f&&f.clientProtocolHeaderRequired&&(d?d["X-Client-Protocol"]="webchannel":d={"X-Client-Protocol":"webchannel"}),this.g.o=d,d=f&&f.initMessageHeaders||null,f&&f.messageContentType&&(d?d["X-WebChannel-Content-Type"]=f.messageContentType:d={"X-WebChannel-Content-Type":f.messageContentType}),f&&f.va&&(d?d["X-WebChannel-Client-Profile"]=f.va:d={"X-WebChannel-Client-Profile":f.va}),this.g.S=d,(d=f&&f.Sb)&&!D(d)&&(this.g.m=d),this.v=f&&f.supportsCrossDomainXhr||!1,this.u=f&&f.sendRawJson||!1,(f=f&&f.httpSessionIdParam)&&!D(f)&&(this.g.D=f,d=this.h,d!==null&&f in d&&(d=this.h,f in d&&delete d[f])),this.j=new Zn(this)}j(Ss,U),Ss.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},Ss.prototype.close=function(){Pc(this.g)},Ss.prototype.o=function(d){var f=this.g;if(typeof d=="string"){var x={};x.__data__=d,d=x}else this.u&&(x={},x.__data__=mt(d),d=x);f.i.push(new wy(f.Ya++,d)),f.G==3&&ko(f)},Ss.prototype.N=function(){this.g.l=null,delete this.j,Pc(this.g),delete this.g,Ss.aa.N.call(this)};function bm(d){Cs.call(this),d.__headers__&&(this.headers=d.__headers__,this.statusCode=d.__status__,delete d.__headers__,delete d.__status__);var f=d.__sm__;if(f){e:{for(const x in f){d=x;break e}d=void 0}(this.i=d)&&(d=this.i,f=f!==null&&d in f?f[d]:void 0),this.data=f}else this.data=d}j(bm,Cs);function ym(){Yt.call(this),this.status=1}j(ym,Yt);function Zn(d){this.g=d}j(Zn,xm),Zn.prototype.ua=function(){_e(this.g,"a")},Zn.prototype.ta=function(d){_e(this.g,new bm(d))},Zn.prototype.sa=function(d){_e(this.g,new ym)},Zn.prototype.ra=function(){_e(this.g,"b")},No.prototype.createWebChannel=No.prototype.g,Ss.prototype.send=Ss.prototype.o,Ss.prototype.open=Ss.prototype.m,Ss.prototype.close=Ss.prototype.close,c0=function(){return new No},l0=function(){return Ae()},o0=ie,Sd={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},ys.NO_ERROR=0,ys.TIMEOUT=8,ys.HTTP_ERROR=6,Xo=ys,ur.COMPLETE="complete",i0=ur,wt.EventType=ct,ct.OPEN="a",ct.CLOSE="b",ct.ERROR="c",ct.MESSAGE="d",U.prototype.listen=U.prototype.K,oi=wt,Mt.prototype.listenOnce=Mt.prototype.L,Mt.prototype.getLastError=Mt.prototype.Ka,Mt.prototype.getLastErrorCode=Mt.prototype.Ba,Mt.prototype.getStatus=Mt.prototype.Z,Mt.prototype.getResponseJson=Mt.prototype.Oa,Mt.prototype.getResponseText=Mt.prototype.oa,Mt.prototype.send=Mt.prototype.ea,Mt.prototype.setWithCredentials=Mt.prototype.Ha,a0=Mt}).apply(typeof So<"u"?So:typeof self<"u"?self:typeof window<"u"?window:{});const Lm="@firebase/firestore";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class is{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}is.UNAUTHENTICATED=new is(null),is.GOOGLE_CREDENTIALS=new is("google-credentials-uid"),is.FIRST_PARTY=new is("first-party-uid"),is.MOCK_USER=new is("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let $a="10.14.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Fn=new bh("@firebase/firestore");function Xa(){return Fn.logLevel}function Me(s,...e){if(Fn.logLevel<=rt.DEBUG){const t=e.map(wh);Fn.debug(`Firestore (${$a}): ${s}`,...t)}}function Mr(s,...e){if(Fn.logLevel<=rt.ERROR){const t=e.map(wh);Fn.error(`Firestore (${$a}): ${s}`,...t)}}function wa(s,...e){if(Fn.logLevel<=rt.WARN){const t=e.map(wh);Fn.warn(`Firestore (${$a}): ${s}`,...t)}}function wh(s){if(typeof s=="string")return s;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return function(t){return JSON.stringify(t)}(s)}catch{return s}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function We(s="Unexpected state"){const e=`FIRESTORE (${$a}) INTERNAL ASSERTION FAILED: `+s;throw Mr(e),new Error(e)}function xt(s,e){s||We()}function Ye(s,e){return s}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const be={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Ie extends dr{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tr{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class d0{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class Z1{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(is.UNAUTHENTICATED))}shutdown(){}}class ek{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class tk{constructor(e){this.t=e,this.currentUser=is.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){xt(this.o===void 0);let r=this.i;const a=c=>this.i!==r?(r=this.i,t(c)):Promise.resolve();let i=new Tr;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new Tr,e.enqueueRetryable(()=>a(this.currentUser))};const o=()=>{const c=i;e.enqueueRetryable(async()=>{await c.promise,await a(this.currentUser)})},l=c=>{Me("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=c,this.o&&(this.auth.addAuthTokenListener(this.o),o())};this.t.onInit(c=>l(c)),setTimeout(()=>{if(!this.auth){const c=this.t.getImmediate({optional:!0});c?l(c):(Me("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new Tr)}},0),o()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(r=>this.i!==e?(Me("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(xt(typeof r.accessToken=="string"),new d0(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return xt(e===null||typeof e=="string"),new is(e)}}class sk{constructor(e,t,r){this.l=e,this.h=t,this.P=r,this.type="FirstParty",this.user=is.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);const e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class rk{constructor(e,t,r){this.l=e,this.h=t,this.P=r}getToken(){return Promise.resolve(new sk(this.l,this.h,this.P))}start(e,t){e.enqueueRetryable(()=>t(is.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class nk{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class ak{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,t){xt(this.o===void 0);const r=i=>{i.error!=null&&Me("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${i.error.message}`);const o=i.token!==this.R;return this.R=i.token,Me("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?t(i.token):Promise.resolve()};this.o=i=>{e.enqueueRetryable(()=>r(i))};const a=i=>{Me("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=i,this.o&&this.appCheck.addTokenListener(this.o)};this.A.onInit(i=>a(i)),setTimeout(()=>{if(!this.appCheck){const i=this.A.getImmediate({optional:!0});i?a(i):Me("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(xt(typeof t.token=="string"),this.R=t.token,new nk(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ik(s){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(s);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let r=0;r<s;r++)t[r]=Math.floor(256*Math.random());return t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class h0{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length;let r="";for(;r.length<20;){const a=ik(40);for(let i=0;i<a.length;++i)r.length<20&&a[i]<t&&(r+=e.charAt(a[i]%e.length))}return r}}function ht(s,e){return s<e?-1:s>e?1:0}function ka(s,e,t){return s.length===e.length&&s.every((r,a)=>t(r,e[a]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zt{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new Ie(be.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new Ie(be.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new Ie(be.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new Ie(be.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return zt.fromMillis(Date.now())}static fromDate(e){return zt.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),r=Math.floor(1e6*(e-1e3*t));return new zt(t,r)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?ht(this.nanoseconds,e.nanoseconds):ht(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ke{constructor(e){this.timestamp=e}static fromTimestamp(e){return new Ke(e)}static min(){return new Ke(new zt(0,0))}static max(){return new Ke(new zt(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mi{constructor(e,t,r){t===void 0?t=0:t>e.length&&We(),r===void 0?r=e.length-t:r>e.length-t&&We(),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return Mi.comparator(this,e)===0}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof Mi?e.forEach(r=>{t.push(r)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const r=Math.min(e.length,t.length);for(let a=0;a<r;a++){const i=e.get(a),o=t.get(a);if(i<o)return-1;if(i>o)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class Et extends Mi{construct(e,t,r){return new Et(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const r of e){if(r.indexOf("//")>=0)throw new Ie(be.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(a=>a.length>0))}return new Et(t)}static emptyPath(){return new Et([])}}const ok=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Zt extends Mi{construct(e,t,r){return new Zt(e,t,r)}static isValidIdentifier(e){return ok.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Zt.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new Zt(["__name__"])}static fromServerFormat(e){const t=[];let r="",a=0;const i=()=>{if(r.length===0)throw new Ie(be.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""};let o=!1;for(;a<e.length;){const l=e[a];if(l==="\\"){if(a+1===e.length)throw new Ie(be.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const c=e[a+1];if(c!=="\\"&&c!=="."&&c!=="`")throw new Ie(be.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=c,a+=2}else l==="`"?(o=!o,a++):l!=="."||o?(r+=l,a++):(i(),a++)}if(i(),o)throw new Ie(be.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new Zt(t)}static emptyPath(){return new Zt([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fe{constructor(e){this.path=e}static fromPath(e){return new Fe(Et.fromString(e))}static fromName(e){return new Fe(Et.fromString(e).popFirst(5))}static empty(){return new Fe(Et.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&Et.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return Et.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new Fe(new Et(e.slice()))}}function lk(s,e){const t=s.toTimestamp().seconds,r=s.toTimestamp().nanoseconds+1,a=Ke.fromTimestamp(r===1e9?new zt(t+1,0):new zt(t,r));return new gn(a,Fe.empty(),e)}function ck(s){return new gn(s.readTime,s.key,-1)}class gn{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new gn(Ke.min(),Fe.empty(),-1)}static max(){return new gn(Ke.max(),Fe.empty(),-1)}}function dk(s,e){let t=s.readTime.compareTo(e.readTime);return t!==0?t:(t=Fe.comparator(s.documentKey,e.documentKey),t!==0?t:ht(s.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hk="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class uk{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function to(s){if(s.code!==be.FAILED_PRECONDITION||s.message!==hk)throw s;Me("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class we{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&We(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new we((r,a)=>{this.nextCallback=i=>{this.wrapSuccess(e,i).next(r,a)},this.catchCallback=i=>{this.wrapFailure(t,i).next(r,a)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof we?t:we.resolve(t)}catch(t){return we.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):we.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):we.reject(t)}static resolve(e){return new we((t,r)=>{t(e)})}static reject(e){return new we((t,r)=>{r(e)})}static waitFor(e){return new we((t,r)=>{let a=0,i=0,o=!1;e.forEach(l=>{++a,l.next(()=>{++i,o&&i===a&&t()},c=>r(c))}),o=!0,i===a&&t()})}static or(e){let t=we.resolve(!1);for(const r of e)t=t.next(a=>a?we.resolve(a):r());return t}static forEach(e,t){const r=[];return e.forEach((a,i)=>{r.push(t.call(this,a,i))}),this.waitFor(r)}static mapArray(e,t){return new we((r,a)=>{const i=e.length,o=new Array(i);let l=0;for(let c=0;c<i;c++){const h=c;t(e[h]).next(u=>{o[h]=u,++l,l===i&&r(o)},u=>a(u))}})}static doWhile(e,t){return new we((r,a)=>{const i=()=>{e()===!0?t().next(()=>{i()},a):r()};i()})}}function mk(s){const e=s.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}function so(s){return s.name==="IndexedDbTransactionError"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kh{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=r=>this.ie(r),this.se=r=>t.writeSequenceNumber(r))}ie(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.se&&this.se(e),e}}kh.oe=-1;function Zl(s){return s==null}function xl(s){return s===0&&1/s==-1/0}function gk(s){return typeof s=="number"&&Number.isInteger(s)&&!xl(s)&&s<=Number.MAX_SAFE_INTEGER&&s>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Vm(s){let e=0;for(const t in s)Object.prototype.hasOwnProperty.call(s,t)&&e++;return e}function Kn(s,e){for(const t in s)Object.prototype.hasOwnProperty.call(s,t)&&e(t,s[t])}function u0(s){for(const e in s)if(Object.prototype.hasOwnProperty.call(s,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class At{constructor(e,t){this.comparator=e,this.root=t||Jt.EMPTY}insert(e,t){return new At(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Jt.BLACK,null,null))}remove(e){return new At(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Jt.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const r=this.comparator(e,t.key);if(r===0)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){const a=this.comparator(e,r.key);if(a===0)return t+r.left.size;a<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){const e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new To(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new To(this.root,e,this.comparator,!1)}getReverseIterator(){return new To(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new To(this.root,e,this.comparator,!0)}}class To{constructor(e,t,r,a){this.isReverse=a,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?r(e.key,t):1,t&&a&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(i===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Jt{constructor(e,t,r,a,i){this.key=e,this.value=t,this.color=r??Jt.RED,this.left=a??Jt.EMPTY,this.right=i??Jt.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,a,i){return new Jt(e??this.key,t??this.value,r??this.color,a??this.left,i??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let a=this;const i=r(e,a.key);return a=i<0?a.copy(null,null,null,a.left.insert(e,t,r),null):i===0?a.copy(null,t,null,null,null):a.copy(null,null,null,null,a.right.insert(e,t,r)),a.fixUp()}removeMin(){if(this.left.isEmpty())return Jt.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let r,a=this;if(t(e,a.key)<0)a.left.isEmpty()||a.left.isRed()||a.left.left.isRed()||(a=a.moveRedLeft()),a=a.copy(null,null,null,a.left.remove(e,t),null);else{if(a.left.isRed()&&(a=a.rotateRight()),a.right.isEmpty()||a.right.isRed()||a.right.left.isRed()||(a=a.moveRedRight()),t(e,a.key)===0){if(a.right.isEmpty())return Jt.EMPTY;r=a.right.min(),a=a.copy(r.key,r.value,null,null,a.right.removeMin())}a=a.copy(null,null,null,null,a.right.remove(e,t))}return a.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Jt.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Jt.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw We();const e=this.left.check();if(e!==this.right.check())throw We();return e+(this.isRed()?0:1)}}Jt.EMPTY=null,Jt.RED=!0,Jt.BLACK=!1;Jt.EMPTY=new class{constructor(){this.size=0}get key(){throw We()}get value(){throw We()}get color(){throw We()}get left(){throw We()}get right(){throw We()}copy(e,t,r,a,i){return this}insert(e,t,r){return new Jt(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class es{constructor(e){this.comparator=e,this.data=new At(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const a=r.getNext();if(this.comparator(a.key,e[1])>=0)return;t(a.key)}}forEachWhile(e,t){let r;for(r=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new Fm(this.data.getIterator())}getIteratorFrom(e){return new Fm(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(r=>{t=t.add(r)}),t}isEqual(e){if(!(e instanceof es)||this.size!==e.size)return!1;const t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){const a=t.getNext().key,i=r.getNext().key;if(this.comparator(a,i)!==0)return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new es(this.comparator);return t.data=e,t}}class Fm{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ts{constructor(e){this.fields=e,e.sort(Zt.comparator)}static empty(){return new Ts([])}unionWith(e){let t=new es(Zt.comparator);for(const r of this.fields)t=t.add(r);for(const r of e)t=t.add(r);return new Ts(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return ka(this.fields,e.fields,(t,r)=>t.isEqual(r))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class m0 extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ts{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(a){try{return atob(a)}catch(i){throw typeof DOMException<"u"&&i instanceof DOMException?new m0("Invalid base64 string: "+i):i}}(e);return new ts(t)}static fromUint8Array(e){const t=function(a){let i="";for(let o=0;o<a.length;++o)i+=String.fromCharCode(a[o]);return i}(e);return new ts(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(t){return btoa(t)}(this.binaryString)}toUint8Array(){return function(t){const r=new Uint8Array(t.length);for(let a=0;a<t.length;a++)r[a]=t.charCodeAt(a);return r}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return ht(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}ts.EMPTY_BYTE_STRING=new ts("");const fk=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function fn(s){if(xt(!!s),typeof s=="string"){let e=0;const t=fk.exec(s);if(xt(!!t),t[1]){let a=t[1];a=(a+"000000000").substr(0,9),e=Number(a)}const r=new Date(s);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:Rt(s.seconds),nanos:Rt(s.nanos)}}function Rt(s){return typeof s=="number"?s:typeof s=="string"?Number(s):0}function Un(s){return typeof s=="string"?ts.fromBase64String(s):ts.fromUint8Array(s)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _h(s){var e,t;return((t=(((e=s==null?void 0:s.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||t===void 0?void 0:t.stringValue)==="server_timestamp"}function Nh(s){const e=s.mapValue.fields.__previous_value__;return _h(e)?Nh(e):e}function $i(s){const e=fn(s.mapValue.fields.__local_write_time__.timestampValue);return new zt(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pk{constructor(e,t,r,a,i,o,l,c,h){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=a,this.ssl=i,this.forceLongPolling=o,this.autoDetectLongPolling=l,this.longPollingOptions=c,this.useFetchStreams=h}}class Ri{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new Ri("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(e){return e instanceof Ri&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Io={mapValue:{}};function Bn(s){return"nullValue"in s?0:"booleanValue"in s?1:"integerValue"in s||"doubleValue"in s?2:"timestampValue"in s?3:"stringValue"in s?5:"bytesValue"in s?6:"referenceValue"in s?7:"geoPointValue"in s?8:"arrayValue"in s?9:"mapValue"in s?_h(s)?4:bk(s)?9007199254740991:xk(s)?10:11:We()}function or(s,e){if(s===e)return!0;const t=Bn(s);if(t!==Bn(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return s.booleanValue===e.booleanValue;case 4:return $i(s).isEqual($i(e));case 3:return function(a,i){if(typeof a.timestampValue=="string"&&typeof i.timestampValue=="string"&&a.timestampValue.length===i.timestampValue.length)return a.timestampValue===i.timestampValue;const o=fn(a.timestampValue),l=fn(i.timestampValue);return o.seconds===l.seconds&&o.nanos===l.nanos}(s,e);case 5:return s.stringValue===e.stringValue;case 6:return function(a,i){return Un(a.bytesValue).isEqual(Un(i.bytesValue))}(s,e);case 7:return s.referenceValue===e.referenceValue;case 8:return function(a,i){return Rt(a.geoPointValue.latitude)===Rt(i.geoPointValue.latitude)&&Rt(a.geoPointValue.longitude)===Rt(i.geoPointValue.longitude)}(s,e);case 2:return function(a,i){if("integerValue"in a&&"integerValue"in i)return Rt(a.integerValue)===Rt(i.integerValue);if("doubleValue"in a&&"doubleValue"in i){const o=Rt(a.doubleValue),l=Rt(i.doubleValue);return o===l?xl(o)===xl(l):isNaN(o)&&isNaN(l)}return!1}(s,e);case 9:return ka(s.arrayValue.values||[],e.arrayValue.values||[],or);case 10:case 11:return function(a,i){const o=a.mapValue.fields||{},l=i.mapValue.fields||{};if(Vm(o)!==Vm(l))return!1;for(const c in o)if(o.hasOwnProperty(c)&&(l[c]===void 0||!or(o[c],l[c])))return!1;return!0}(s,e);default:return We()}}function Pi(s,e){return(s.values||[]).find(t=>or(t,e))!==void 0}function _a(s,e){if(s===e)return 0;const t=Bn(s),r=Bn(e);if(t!==r)return ht(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return ht(s.booleanValue,e.booleanValue);case 2:return function(i,o){const l=Rt(i.integerValue||i.doubleValue),c=Rt(o.integerValue||o.doubleValue);return l<c?-1:l>c?1:l===c?0:isNaN(l)?isNaN(c)?0:-1:1}(s,e);case 3:return Um(s.timestampValue,e.timestampValue);case 4:return Um($i(s),$i(e));case 5:return ht(s.stringValue,e.stringValue);case 6:return function(i,o){const l=Un(i),c=Un(o);return l.compareTo(c)}(s.bytesValue,e.bytesValue);case 7:return function(i,o){const l=i.split("/"),c=o.split("/");for(let h=0;h<l.length&&h<c.length;h++){const u=ht(l[h],c[h]);if(u!==0)return u}return ht(l.length,c.length)}(s.referenceValue,e.referenceValue);case 8:return function(i,o){const l=ht(Rt(i.latitude),Rt(o.latitude));return l!==0?l:ht(Rt(i.longitude),Rt(o.longitude))}(s.geoPointValue,e.geoPointValue);case 9:return Bm(s.arrayValue,e.arrayValue);case 10:return function(i,o){var l,c,h,u;const m=i.fields||{},g=o.fields||{},p=(l=m.value)===null||l===void 0?void 0:l.arrayValue,j=(c=g.value)===null||c===void 0?void 0:c.arrayValue,_=ht(((h=p==null?void 0:p.values)===null||h===void 0?void 0:h.length)||0,((u=j==null?void 0:j.values)===null||u===void 0?void 0:u.length)||0);return _!==0?_:Bm(p,j)}(s.mapValue,e.mapValue);case 11:return function(i,o){if(i===Io.mapValue&&o===Io.mapValue)return 0;if(i===Io.mapValue)return 1;if(o===Io.mapValue)return-1;const l=i.fields||{},c=Object.keys(l),h=o.fields||{},u=Object.keys(h);c.sort(),u.sort();for(let m=0;m<c.length&&m<u.length;++m){const g=ht(c[m],u[m]);if(g!==0)return g;const p=_a(l[c[m]],h[u[m]]);if(p!==0)return p}return ht(c.length,u.length)}(s.mapValue,e.mapValue);default:throw We()}}function Um(s,e){if(typeof s=="string"&&typeof e=="string"&&s.length===e.length)return ht(s,e);const t=fn(s),r=fn(e),a=ht(t.seconds,r.seconds);return a!==0?a:ht(t.nanos,r.nanos)}function Bm(s,e){const t=s.values||[],r=e.values||[];for(let a=0;a<t.length&&a<r.length;++a){const i=_a(t[a],r[a]);if(i)return i}return ht(t.length,r.length)}function Na(s){return Td(s)}function Td(s){return"nullValue"in s?"null":"booleanValue"in s?""+s.booleanValue:"integerValue"in s?""+s.integerValue:"doubleValue"in s?""+s.doubleValue:"timestampValue"in s?function(t){const r=fn(t);return`time(${r.seconds},${r.nanos})`}(s.timestampValue):"stringValue"in s?s.stringValue:"bytesValue"in s?function(t){return Un(t).toBase64()}(s.bytesValue):"referenceValue"in s?function(t){return Fe.fromName(t).toString()}(s.referenceValue):"geoPointValue"in s?function(t){return`geo(${t.latitude},${t.longitude})`}(s.geoPointValue):"arrayValue"in s?function(t){let r="[",a=!0;for(const i of t.values||[])a?a=!1:r+=",",r+=Td(i);return r+"]"}(s.arrayValue):"mapValue"in s?function(t){const r=Object.keys(t.fields||{}).sort();let a="{",i=!0;for(const o of r)i?i=!1:a+=",",a+=`${o}:${Td(t.fields[o])}`;return a+"}"}(s.mapValue):We()}function zm(s,e){return{referenceValue:`projects/${s.projectId}/databases/${s.database}/documents/${e.path.canonicalString()}`}}function Id(s){return!!s&&"integerValue"in s}function jh(s){return!!s&&"arrayValue"in s}function Hm(s){return!!s&&"nullValue"in s}function Wm(s){return!!s&&"doubleValue"in s&&isNaN(Number(s.doubleValue))}function Jo(s){return!!s&&"mapValue"in s}function xk(s){var e,t;return((t=(((e=s==null?void 0:s.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||t===void 0?void 0:t.stringValue)==="__vector__"}function pi(s){if(s.geoPointValue)return{geoPointValue:Object.assign({},s.geoPointValue)};if(s.timestampValue&&typeof s.timestampValue=="object")return{timestampValue:Object.assign({},s.timestampValue)};if(s.mapValue){const e={mapValue:{fields:{}}};return Kn(s.mapValue.fields,(t,r)=>e.mapValue.fields[t]=pi(r)),e}if(s.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(s.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=pi(s.arrayValue.values[t]);return e}return Object.assign({},s)}function bk(s){return(((s.mapValue||{}).fields||{}).__type__||{}).stringValue==="__max__"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _s{constructor(e){this.value=e}static empty(){return new _s({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!Jo(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=pi(t)}setAll(e){let t=Zt.emptyPath(),r={},a=[];e.forEach((o,l)=>{if(!t.isImmediateParentOf(l)){const c=this.getFieldsMap(t);this.applyChanges(c,r,a),r={},a=[],t=l.popLast()}o?r[l.lastSegment()]=pi(o):a.push(l.lastSegment())});const i=this.getFieldsMap(t);this.applyChanges(i,r,a)}delete(e){const t=this.field(e.popLast());Jo(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return or(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let a=t.mapValue.fields[e.get(r)];Jo(a)&&a.mapValue.fields||(a={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=a),t=a}return t.mapValue.fields}applyChanges(e,t,r){Kn(t,(a,i)=>e[a]=i);for(const a of r)delete e[a]}clone(){return new _s(pi(this.value))}}function g0(s){const e=[];return Kn(s.fields,(t,r)=>{const a=new Zt([t]);if(Jo(r)){const i=g0(r.mapValue).fields;if(i.length===0)e.push(a);else for(const o of i)e.push(a.child(o))}else e.push(a)}),new Ts(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ls{constructor(e,t,r,a,i,o,l){this.key=e,this.documentType=t,this.version=r,this.readTime=a,this.createTime=i,this.data=o,this.documentState=l}static newInvalidDocument(e){return new ls(e,0,Ke.min(),Ke.min(),Ke.min(),_s.empty(),0)}static newFoundDocument(e,t,r,a){return new ls(e,1,t,Ke.min(),r,a,0)}static newNoDocument(e,t){return new ls(e,2,t,Ke.min(),Ke.min(),_s.empty(),0)}static newUnknownDocument(e,t){return new ls(e,3,t,Ke.min(),Ke.min(),_s.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(Ke.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=_s.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=_s.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=Ke.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof ls&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new ls(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bl{constructor(e,t){this.position=e,this.inclusive=t}}function qm(s,e,t){let r=0;for(let a=0;a<s.position.length;a++){const i=e[a],o=s.position[a];if(i.field.isKeyField()?r=Fe.comparator(Fe.fromName(o.referenceValue),t.key):r=_a(o,t.data.field(i.field)),i.dir==="desc"&&(r*=-1),r!==0)break}return r}function Gm(s,e){if(s===null)return e===null;if(e===null||s.inclusive!==e.inclusive||s.position.length!==e.position.length)return!1;for(let t=0;t<s.position.length;t++)if(!or(s.position[t],e.position[t]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Oi{constructor(e,t="asc"){this.field=e,this.dir=t}}function yk(s,e){return s.dir===e.dir&&s.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class f0{}class Vt extends f0{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,r):new wk(e,t,r):t==="array-contains"?new Nk(e,r):t==="in"?new jk(e,r):t==="not-in"?new Ek(e,r):t==="array-contains-any"?new Sk(e,r):new Vt(e,t,r)}static createKeyFieldInFilter(e,t,r){return t==="in"?new kk(e,r):new _k(e,r)}matches(e){const t=e.data.field(this.field);return this.op==="!="?t!==null&&this.matchesComparison(_a(t,this.value)):t!==null&&Bn(this.value)===Bn(t)&&this.matchesComparison(_a(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return We()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class Gs extends f0{constructor(e,t){super(),this.filters=e,this.op=t,this.ae=null}static create(e,t){return new Gs(e,t)}matches(e){return p0(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.ae!==null||(this.ae=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.ae}getFilters(){return Object.assign([],this.filters)}}function p0(s){return s.op==="and"}function x0(s){return vk(s)&&p0(s)}function vk(s){for(const e of s.filters)if(e instanceof Gs)return!1;return!0}function Ad(s){if(s instanceof Vt)return s.field.canonicalString()+s.op.toString()+Na(s.value);if(x0(s))return s.filters.map(e=>Ad(e)).join(",");{const e=s.filters.map(t=>Ad(t)).join(",");return`${s.op}(${e})`}}function b0(s,e){return s instanceof Vt?function(r,a){return a instanceof Vt&&r.op===a.op&&r.field.isEqual(a.field)&&or(r.value,a.value)}(s,e):s instanceof Gs?function(r,a){return a instanceof Gs&&r.op===a.op&&r.filters.length===a.filters.length?r.filters.reduce((i,o,l)=>i&&b0(o,a.filters[l]),!0):!1}(s,e):void We()}function y0(s){return s instanceof Vt?function(t){return`${t.field.canonicalString()} ${t.op} ${Na(t.value)}`}(s):s instanceof Gs?function(t){return t.op.toString()+" {"+t.getFilters().map(y0).join(" ,")+"}"}(s):"Filter"}class wk extends Vt{constructor(e,t,r){super(e,t,r),this.key=Fe.fromName(r.referenceValue)}matches(e){const t=Fe.comparator(e.key,this.key);return this.matchesComparison(t)}}class kk extends Vt{constructor(e,t){super(e,"in",t),this.keys=v0("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class _k extends Vt{constructor(e,t){super(e,"not-in",t),this.keys=v0("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function v0(s,e){var t;return(((t=e.arrayValue)===null||t===void 0?void 0:t.values)||[]).map(r=>Fe.fromName(r.referenceValue))}class Nk extends Vt{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return jh(t)&&Pi(t.arrayValue,this.value)}}class jk extends Vt{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return t!==null&&Pi(this.value.arrayValue,t)}}class Ek extends Vt{constructor(e,t){super(e,"not-in",t)}matches(e){if(Pi(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return t!==null&&!Pi(this.value.arrayValue,t)}}class Sk extends Vt{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!jh(t)||!t.arrayValue.values)&&t.arrayValue.values.some(r=>Pi(this.value.arrayValue,r))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tk{constructor(e,t=null,r=[],a=[],i=null,o=null,l=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=a,this.limit=i,this.startAt=o,this.endAt=l,this.ue=null}}function Km(s,e=null,t=[],r=[],a=null,i=null,o=null){return new Tk(s,e,t,r,a,i,o)}function Eh(s){const e=Ye(s);if(e.ue===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(r=>Ad(r)).join(","),t+="|ob:",t+=e.orderBy.map(r=>function(i){return i.field.canonicalString()+i.dir}(r)).join(","),Zl(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(r=>Na(r)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(r=>Na(r)).join(",")),e.ue=t}return e.ue}function Sh(s,e){if(s.limit!==e.limit||s.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<s.orderBy.length;t++)if(!yk(s.orderBy[t],e.orderBy[t]))return!1;if(s.filters.length!==e.filters.length)return!1;for(let t=0;t<s.filters.length;t++)if(!b0(s.filters[t],e.filters[t]))return!1;return s.collectionGroup===e.collectionGroup&&!!s.path.isEqual(e.path)&&!!Gm(s.startAt,e.startAt)&&Gm(s.endAt,e.endAt)}function Cd(s){return Fe.isDocumentKey(s.path)&&s.collectionGroup===null&&s.filters.length===0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ra{constructor(e,t=null,r=[],a=[],i=null,o="F",l=null,c=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=a,this.limit=i,this.limitType=o,this.startAt=l,this.endAt=c,this.ce=null,this.le=null,this.he=null,this.startAt,this.endAt}}function Ik(s,e,t,r,a,i,o,l){return new Ra(s,e,t,r,a,i,o,l)}function Th(s){return new Ra(s)}function Ym(s){return s.filters.length===0&&s.limit===null&&s.startAt==null&&s.endAt==null&&(s.explicitOrderBy.length===0||s.explicitOrderBy.length===1&&s.explicitOrderBy[0].field.isKeyField())}function w0(s){return s.collectionGroup!==null}function xi(s){const e=Ye(s);if(e.ce===null){e.ce=[];const t=new Set;for(const i of e.explicitOrderBy)e.ce.push(i),t.add(i.field.canonicalString());const r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(o){let l=new es(Zt.comparator);return o.filters.forEach(c=>{c.getFlattenedFilters().forEach(h=>{h.isInequality()&&(l=l.add(h.field))})}),l})(e).forEach(i=>{t.has(i.canonicalString())||i.isKeyField()||e.ce.push(new Oi(i,r))}),t.has(Zt.keyField().canonicalString())||e.ce.push(new Oi(Zt.keyField(),r))}return e.ce}function sr(s){const e=Ye(s);return e.le||(e.le=Ak(e,xi(s))),e.le}function Ak(s,e){if(s.limitType==="F")return Km(s.path,s.collectionGroup,e,s.filters,s.limit,s.startAt,s.endAt);{e=e.map(a=>{const i=a.dir==="desc"?"asc":"desc";return new Oi(a.field,i)});const t=s.endAt?new bl(s.endAt.position,s.endAt.inclusive):null,r=s.startAt?new bl(s.startAt.position,s.startAt.inclusive):null;return Km(s.path,s.collectionGroup,e,s.filters,s.limit,t,r)}}function Dd(s,e){const t=s.filters.concat([e]);return new Ra(s.path,s.collectionGroup,s.explicitOrderBy.slice(),t,s.limit,s.limitType,s.startAt,s.endAt)}function Md(s,e,t){return new Ra(s.path,s.collectionGroup,s.explicitOrderBy.slice(),s.filters.slice(),e,t,s.startAt,s.endAt)}function ec(s,e){return Sh(sr(s),sr(e))&&s.limitType===e.limitType}function k0(s){return`${Eh(sr(s))}|lt:${s.limitType}`}function aa(s){return`Query(target=${function(t){let r=t.path.canonicalString();return t.collectionGroup!==null&&(r+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(r+=`, filters: [${t.filters.map(a=>y0(a)).join(", ")}]`),Zl(t.limit)||(r+=", limit: "+t.limit),t.orderBy.length>0&&(r+=`, orderBy: [${t.orderBy.map(a=>function(o){return`${o.field.canonicalString()} (${o.dir})`}(a)).join(", ")}]`),t.startAt&&(r+=", startAt: ",r+=t.startAt.inclusive?"b:":"a:",r+=t.startAt.position.map(a=>Na(a)).join(",")),t.endAt&&(r+=", endAt: ",r+=t.endAt.inclusive?"a:":"b:",r+=t.endAt.position.map(a=>Na(a)).join(",")),`Target(${r})`}(sr(s))}; limitType=${s.limitType})`}function tc(s,e){return e.isFoundDocument()&&function(r,a){const i=a.key.path;return r.collectionGroup!==null?a.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(i):Fe.isDocumentKey(r.path)?r.path.isEqual(i):r.path.isImmediateParentOf(i)}(s,e)&&function(r,a){for(const i of xi(r))if(!i.field.isKeyField()&&a.data.field(i.field)===null)return!1;return!0}(s,e)&&function(r,a){for(const i of r.filters)if(!i.matches(a))return!1;return!0}(s,e)&&function(r,a){return!(r.startAt&&!function(o,l,c){const h=qm(o,l,c);return o.inclusive?h<=0:h<0}(r.startAt,xi(r),a)||r.endAt&&!function(o,l,c){const h=qm(o,l,c);return o.inclusive?h>=0:h>0}(r.endAt,xi(r),a))}(s,e)}function Ck(s){return s.collectionGroup||(s.path.length%2==1?s.path.lastSegment():s.path.get(s.path.length-2))}function _0(s){return(e,t)=>{let r=!1;for(const a of xi(s)){const i=Dk(a,e,t);if(i!==0)return i;r=r||a.field.isKeyField()}return 0}}function Dk(s,e,t){const r=s.field.isKeyField()?Fe.comparator(e.key,t.key):function(i,o,l){const c=o.data.field(i),h=l.data.field(i);return c!==null&&h!==null?_a(c,h):We()}(s.field,e,t);switch(s.dir){case"asc":return r;case"desc":return-1*r;default:return We()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pa{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r!==void 0){for(const[a,i]of r)if(this.equalsFn(a,e))return i}}has(e){return this.get(e)!==void 0}set(e,t){const r=this.mapKeyFn(e),a=this.inner[r];if(a===void 0)return this.inner[r]=[[e,t]],void this.innerSize++;for(let i=0;i<a.length;i++)if(this.equalsFn(a[i][0],e))return void(a[i]=[e,t]);a.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r===void 0)return!1;for(let a=0;a<r.length;a++)if(this.equalsFn(r[a][0],e))return r.length===1?delete this.inner[t]:r.splice(a,1),this.innerSize--,!0;return!1}forEach(e){Kn(this.inner,(t,r)=>{for(const[a,i]of r)e(a,i)})}isEmpty(){return u0(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Mk=new At(Fe.comparator);function $r(){return Mk}const N0=new At(Fe.comparator);function li(...s){let e=N0;for(const t of s)e=e.insert(t.key,t);return e}function j0(s){let e=N0;return s.forEach((t,r)=>e=e.insert(t,r.overlayedDocument)),e}function An(){return bi()}function E0(){return bi()}function bi(){return new Pa(s=>s.toString(),(s,e)=>s.isEqual(e))}const $k=new At(Fe.comparator),Rk=new es(Fe.comparator);function tt(...s){let e=Rk;for(const t of s)e=e.add(t);return e}const Pk=new es(ht);function Ok(){return Pk}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ih(s,e){if(s.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:xl(e)?"-0":e}}function S0(s){return{integerValue:""+s}}function Lk(s,e){return gk(e)?S0(e):Ih(s,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sc{constructor(){this._=void 0}}function Vk(s,e,t){return s instanceof yl?function(a,i){const o={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:a.seconds,nanos:a.nanoseconds}}}};return i&&_h(i)&&(i=Nh(i)),i&&(o.fields.__previous_value__=i),{mapValue:o}}(t,e):s instanceof Li?I0(s,e):s instanceof Vi?A0(s,e):function(a,i){const o=T0(a,i),l=Qm(o)+Qm(a.Pe);return Id(o)&&Id(a.Pe)?S0(l):Ih(a.serializer,l)}(s,e)}function Fk(s,e,t){return s instanceof Li?I0(s,e):s instanceof Vi?A0(s,e):t}function T0(s,e){return s instanceof vl?function(r){return Id(r)||function(i){return!!i&&"doubleValue"in i}(r)}(e)?e:{integerValue:0}:null}class yl extends sc{}class Li extends sc{constructor(e){super(),this.elements=e}}function I0(s,e){const t=C0(e);for(const r of s.elements)t.some(a=>or(a,r))||t.push(r);return{arrayValue:{values:t}}}class Vi extends sc{constructor(e){super(),this.elements=e}}function A0(s,e){let t=C0(e);for(const r of s.elements)t=t.filter(a=>!or(a,r));return{arrayValue:{values:t}}}class vl extends sc{constructor(e,t){super(),this.serializer=e,this.Pe=t}}function Qm(s){return Rt(s.integerValue||s.doubleValue)}function C0(s){return jh(s)&&s.arrayValue.values?s.arrayValue.values.slice():[]}function Uk(s,e){return s.field.isEqual(e.field)&&function(r,a){return r instanceof Li&&a instanceof Li||r instanceof Vi&&a instanceof Vi?ka(r.elements,a.elements,or):r instanceof vl&&a instanceof vl?or(r.Pe,a.Pe):r instanceof yl&&a instanceof yl}(s.transform,e.transform)}class Bk{constructor(e,t){this.version=e,this.transformResults=t}}class qs{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new qs}static exists(e){return new qs(void 0,e)}static updateTime(e){return new qs(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Zo(s,e){return s.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(s.updateTime):s.exists===void 0||s.exists===e.isFoundDocument()}class rc{}function D0(s,e){if(!s.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return s.isNoDocument()?new Ah(s.key,qs.none()):new ro(s.key,s.data,qs.none());{const t=s.data,r=_s.empty();let a=new es(Zt.comparator);for(let i of e.fields)if(!a.has(i)){let o=t.field(i);o===null&&i.length>1&&(i=i.popLast(),o=t.field(i)),o===null?r.delete(i):r.set(i,o),a=a.add(i)}return new yn(s.key,r,new Ts(a.toArray()),qs.none())}}function zk(s,e,t){s instanceof ro?function(a,i,o){const l=a.value.clone(),c=Jm(a.fieldTransforms,i,o.transformResults);l.setAll(c),i.convertToFoundDocument(o.version,l).setHasCommittedMutations()}(s,e,t):s instanceof yn?function(a,i,o){if(!Zo(a.precondition,i))return void i.convertToUnknownDocument(o.version);const l=Jm(a.fieldTransforms,i,o.transformResults),c=i.data;c.setAll(M0(a)),c.setAll(l),i.convertToFoundDocument(o.version,c).setHasCommittedMutations()}(s,e,t):function(a,i,o){i.convertToNoDocument(o.version).setHasCommittedMutations()}(0,e,t)}function yi(s,e,t,r){return s instanceof ro?function(i,o,l,c){if(!Zo(i.precondition,o))return l;const h=i.value.clone(),u=Zm(i.fieldTransforms,c,o);return h.setAll(u),o.convertToFoundDocument(o.version,h).setHasLocalMutations(),null}(s,e,t,r):s instanceof yn?function(i,o,l,c){if(!Zo(i.precondition,o))return l;const h=Zm(i.fieldTransforms,c,o),u=o.data;return u.setAll(M0(i)),u.setAll(h),o.convertToFoundDocument(o.version,u).setHasLocalMutations(),l===null?null:l.unionWith(i.fieldMask.fields).unionWith(i.fieldTransforms.map(m=>m.field))}(s,e,t,r):function(i,o,l){return Zo(i.precondition,o)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):l}(s,e,t)}function Hk(s,e){let t=null;for(const r of s.fieldTransforms){const a=e.data.field(r.field),i=T0(r.transform,a||null);i!=null&&(t===null&&(t=_s.empty()),t.set(r.field,i))}return t||null}function Xm(s,e){return s.type===e.type&&!!s.key.isEqual(e.key)&&!!s.precondition.isEqual(e.precondition)&&!!function(r,a){return r===void 0&&a===void 0||!(!r||!a)&&ka(r,a,(i,o)=>Uk(i,o))}(s.fieldTransforms,e.fieldTransforms)&&(s.type===0?s.value.isEqual(e.value):s.type!==1||s.data.isEqual(e.data)&&s.fieldMask.isEqual(e.fieldMask))}class ro extends rc{constructor(e,t,r,a=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=a,this.type=0}getFieldMask(){return null}}class yn extends rc{constructor(e,t,r,a,i=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=a,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function M0(s){const e=new Map;return s.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){const r=s.data.field(t);e.set(t,r)}}),e}function Jm(s,e,t){const r=new Map;xt(s.length===t.length);for(let a=0;a<t.length;a++){const i=s[a],o=i.transform,l=e.data.field(i.field);r.set(i.field,Fk(o,l,t[a]))}return r}function Zm(s,e,t){const r=new Map;for(const a of s){const i=a.transform,o=t.data.field(a.field);r.set(a.field,Vk(i,o,e))}return r}class Ah extends rc{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class Wk extends rc{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qk{constructor(e,t,r,a){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=a}applyToRemoteDocument(e,t){const r=t.mutationResults;for(let a=0;a<this.mutations.length;a++){const i=this.mutations[a];i.key.isEqual(e.key)&&zk(i,e,r[a])}}applyToLocalView(e,t){for(const r of this.baseMutations)r.key.isEqual(e.key)&&(t=yi(r,e,t,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(t=yi(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const r=E0();return this.mutations.forEach(a=>{const i=e.get(a.key),o=i.overlayedDocument;let l=this.applyToLocalView(o,i.mutatedFields);l=t.has(a.key)?null:l;const c=D0(o,l);c!==null&&r.set(a.key,c),o.isValidDocument()||o.convertToNoDocument(Ke.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),tt())}isEqual(e){return this.batchId===e.batchId&&ka(this.mutations,e.mutations,(t,r)=>Xm(t,r))&&ka(this.baseMutations,e.baseMutations,(t,r)=>Xm(t,r))}}class Ch{constructor(e,t,r,a){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=a}static from(e,t,r){xt(e.mutations.length===r.length);let a=function(){return $k}();const i=e.mutations;for(let o=0;o<i.length;o++)a=a.insert(i[o].key,r[o].version);return new Ch(e,t,r,a)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gk{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kk{constructor(e,t){this.count=e,this.unchangedNames=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Lt,it;function Yk(s){switch(s){default:return We();case be.CANCELLED:case be.UNKNOWN:case be.DEADLINE_EXCEEDED:case be.RESOURCE_EXHAUSTED:case be.INTERNAL:case be.UNAVAILABLE:case be.UNAUTHENTICATED:return!1;case be.INVALID_ARGUMENT:case be.NOT_FOUND:case be.ALREADY_EXISTS:case be.PERMISSION_DENIED:case be.FAILED_PRECONDITION:case be.ABORTED:case be.OUT_OF_RANGE:case be.UNIMPLEMENTED:case be.DATA_LOSS:return!0}}function $0(s){if(s===void 0)return Mr("GRPC error has no .code"),be.UNKNOWN;switch(s){case Lt.OK:return be.OK;case Lt.CANCELLED:return be.CANCELLED;case Lt.UNKNOWN:return be.UNKNOWN;case Lt.DEADLINE_EXCEEDED:return be.DEADLINE_EXCEEDED;case Lt.RESOURCE_EXHAUSTED:return be.RESOURCE_EXHAUSTED;case Lt.INTERNAL:return be.INTERNAL;case Lt.UNAVAILABLE:return be.UNAVAILABLE;case Lt.UNAUTHENTICATED:return be.UNAUTHENTICATED;case Lt.INVALID_ARGUMENT:return be.INVALID_ARGUMENT;case Lt.NOT_FOUND:return be.NOT_FOUND;case Lt.ALREADY_EXISTS:return be.ALREADY_EXISTS;case Lt.PERMISSION_DENIED:return be.PERMISSION_DENIED;case Lt.FAILED_PRECONDITION:return be.FAILED_PRECONDITION;case Lt.ABORTED:return be.ABORTED;case Lt.OUT_OF_RANGE:return be.OUT_OF_RANGE;case Lt.UNIMPLEMENTED:return be.UNIMPLEMENTED;case Lt.DATA_LOSS:return be.DATA_LOSS;default:return We()}}(it=Lt||(Lt={}))[it.OK=0]="OK",it[it.CANCELLED=1]="CANCELLED",it[it.UNKNOWN=2]="UNKNOWN",it[it.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",it[it.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",it[it.NOT_FOUND=5]="NOT_FOUND",it[it.ALREADY_EXISTS=6]="ALREADY_EXISTS",it[it.PERMISSION_DENIED=7]="PERMISSION_DENIED",it[it.UNAUTHENTICATED=16]="UNAUTHENTICATED",it[it.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",it[it.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",it[it.ABORTED=10]="ABORTED",it[it.OUT_OF_RANGE=11]="OUT_OF_RANGE",it[it.UNIMPLEMENTED=12]="UNIMPLEMENTED",it[it.INTERNAL=13]="INTERNAL",it[it.UNAVAILABLE=14]="UNAVAILABLE",it[it.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Qk(){return new TextEncoder}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Xk=new Pn([4294967295,4294967295],0);function eg(s){const e=Qk().encode(s),t=new n0;return t.update(e),new Uint8Array(t.digest())}function tg(s){const e=new DataView(s.buffer),t=e.getUint32(0,!0),r=e.getUint32(4,!0),a=e.getUint32(8,!0),i=e.getUint32(12,!0);return[new Pn([t,r],0),new Pn([a,i],0)]}class Dh{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new ci(`Invalid padding: ${t}`);if(r<0)throw new ci(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new ci(`Invalid hash count: ${r}`);if(e.length===0&&t!==0)throw new ci(`Invalid padding when bitmap length is 0: ${t}`);this.Ie=8*e.length-t,this.Te=Pn.fromNumber(this.Ie)}Ee(e,t,r){let a=e.add(t.multiply(Pn.fromNumber(r)));return a.compare(Xk)===1&&(a=new Pn([a.getBits(0),a.getBits(1)],0)),a.modulo(this.Te).toNumber()}de(e){return(this.bitmap[Math.floor(e/8)]&1<<e%8)!=0}mightContain(e){if(this.Ie===0)return!1;const t=eg(e),[r,a]=tg(t);for(let i=0;i<this.hashCount;i++){const o=this.Ee(r,a,i);if(!this.de(o))return!1}return!0}static create(e,t,r){const a=e%8==0?0:8-e%8,i=new Uint8Array(Math.ceil(e/8)),o=new Dh(i,a,t);return r.forEach(l=>o.insert(l)),o}insert(e){if(this.Ie===0)return;const t=eg(e),[r,a]=tg(t);for(let i=0;i<this.hashCount;i++){const o=this.Ee(r,a,i);this.Ae(o)}}Ae(e){const t=Math.floor(e/8),r=e%8;this.bitmap[t]|=1<<r}}class ci extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nc{constructor(e,t,r,a,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=a,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,r){const a=new Map;return a.set(e,no.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new nc(Ke.min(),a,new At(ht),$r(),tt())}}class no{constructor(e,t,r,a,i){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=a,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new no(r,t,tt(),tt(),tt())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class el{constructor(e,t,r,a){this.Re=e,this.removedTargetIds=t,this.key=r,this.Ve=a}}class R0{constructor(e,t){this.targetId=e,this.me=t}}class P0{constructor(e,t,r=ts.EMPTY_BYTE_STRING,a=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=a}}class sg{constructor(){this.fe=0,this.ge=ng(),this.pe=ts.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return this.fe!==0}get be(){return this.we}De(e){e.approximateByteSize()>0&&(this.we=!0,this.pe=e)}ve(){let e=tt(),t=tt(),r=tt();return this.ge.forEach((a,i)=>{switch(i){case 0:e=e.add(a);break;case 2:t=t.add(a);break;case 1:r=r.add(a);break;default:We()}}),new no(this.pe,this.ye,e,t,r)}Ce(){this.we=!1,this.ge=ng()}Fe(e,t){this.we=!0,this.ge=this.ge.insert(e,t)}Me(e){this.we=!0,this.ge=this.ge.remove(e)}xe(){this.fe+=1}Oe(){this.fe-=1,xt(this.fe>=0)}Ne(){this.we=!0,this.ye=!0}}class Jk{constructor(e){this.Le=e,this.Be=new Map,this.ke=$r(),this.qe=rg(),this.Qe=new At(ht)}Ke(e){for(const t of e.Re)e.Ve&&e.Ve.isFoundDocument()?this.$e(t,e.Ve):this.Ue(t,e.key,e.Ve);for(const t of e.removedTargetIds)this.Ue(t,e.key,e.Ve)}We(e){this.forEachTarget(e,t=>{const r=this.Ge(t);switch(e.state){case 0:this.ze(t)&&r.De(e.resumeToken);break;case 1:r.Oe(),r.Se||r.Ce(),r.De(e.resumeToken);break;case 2:r.Oe(),r.Se||this.removeTarget(t);break;case 3:this.ze(t)&&(r.Ne(),r.De(e.resumeToken));break;case 4:this.ze(t)&&(this.je(t),r.De(e.resumeToken));break;default:We()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Be.forEach((r,a)=>{this.ze(a)&&t(a)})}He(e){const t=e.targetId,r=e.me.count,a=this.Je(t);if(a){const i=a.target;if(Cd(i))if(r===0){const o=new Fe(i.path);this.Ue(t,o,ls.newNoDocument(o,Ke.min()))}else xt(r===1);else{const o=this.Ye(t);if(o!==r){const l=this.Ze(e),c=l?this.Xe(l,e,o):1;if(c!==0){this.je(t);const h=c===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Qe=this.Qe.insert(t,h)}}}}}Ze(e){const t=e.me.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:r="",padding:a=0},hashCount:i=0}=t;let o,l;try{o=Un(r).toUint8Array()}catch(c){if(c instanceof m0)return wa("Decoding the base64 bloom filter in existence filter failed ("+c.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw c}try{l=new Dh(o,a,i)}catch(c){return wa(c instanceof ci?"BloomFilter error: ":"Applying bloom filter failed: ",c),null}return l.Ie===0?null:l}Xe(e,t,r){return t.me.count===r-this.nt(e,t.targetId)?0:2}nt(e,t){const r=this.Le.getRemoteKeysForTarget(t);let a=0;return r.forEach(i=>{const o=this.Le.tt(),l=`projects/${o.projectId}/databases/${o.database}/documents/${i.path.canonicalString()}`;e.mightContain(l)||(this.Ue(t,i,null),a++)}),a}rt(e){const t=new Map;this.Be.forEach((i,o)=>{const l=this.Je(o);if(l){if(i.current&&Cd(l.target)){const c=new Fe(l.target.path);this.ke.get(c)!==null||this.it(o,c)||this.Ue(o,c,ls.newNoDocument(c,e))}i.be&&(t.set(o,i.ve()),i.Ce())}});let r=tt();this.qe.forEach((i,o)=>{let l=!0;o.forEachWhile(c=>{const h=this.Je(c);return!h||h.purpose==="TargetPurposeLimboResolution"||(l=!1,!1)}),l&&(r=r.add(i))}),this.ke.forEach((i,o)=>o.setReadTime(e));const a=new nc(e,t,this.Qe,this.ke,r);return this.ke=$r(),this.qe=rg(),this.Qe=new At(ht),a}$e(e,t){if(!this.ze(e))return;const r=this.it(e,t.key)?2:0;this.Ge(e).Fe(t.key,r),this.ke=this.ke.insert(t.key,t),this.qe=this.qe.insert(t.key,this.st(t.key).add(e))}Ue(e,t,r){if(!this.ze(e))return;const a=this.Ge(e);this.it(e,t)?a.Fe(t,1):a.Me(t),this.qe=this.qe.insert(t,this.st(t).delete(e)),r&&(this.ke=this.ke.insert(t,r))}removeTarget(e){this.Be.delete(e)}Ye(e){const t=this.Ge(e).ve();return this.Le.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}xe(e){this.Ge(e).xe()}Ge(e){let t=this.Be.get(e);return t||(t=new sg,this.Be.set(e,t)),t}st(e){let t=this.qe.get(e);return t||(t=new es(ht),this.qe=this.qe.insert(e,t)),t}ze(e){const t=this.Je(e)!==null;return t||Me("WatchChangeAggregator","Detected inactive target",e),t}Je(e){const t=this.Be.get(e);return t&&t.Se?null:this.Le.ot(e)}je(e){this.Be.set(e,new sg),this.Le.getRemoteKeysForTarget(e).forEach(t=>{this.Ue(e,t,null)})}it(e,t){return this.Le.getRemoteKeysForTarget(e).has(t)}}function rg(){return new At(Fe.comparator)}function ng(){return new At(Fe.comparator)}const Zk={asc:"ASCENDING",desc:"DESCENDING"},e2={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},t2={and:"AND",or:"OR"};class s2{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function $d(s,e){return s.useProto3Json||Zl(e)?e:{value:e}}function wl(s,e){return s.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function O0(s,e){return s.useProto3Json?e.toBase64():e.toUint8Array()}function r2(s,e){return wl(s,e.toTimestamp())}function rr(s){return xt(!!s),Ke.fromTimestamp(function(t){const r=fn(t);return new zt(r.seconds,r.nanos)}(s))}function Mh(s,e){return Rd(s,e).canonicalString()}function Rd(s,e){const t=function(a){return new Et(["projects",a.projectId,"databases",a.database])}(s).child("documents");return e===void 0?t:t.child(e)}function L0(s){const e=Et.fromString(s);return xt(z0(e)),e}function Pd(s,e){return Mh(s.databaseId,e.path)}function Kc(s,e){const t=L0(e);if(t.get(1)!==s.databaseId.projectId)throw new Ie(be.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+s.databaseId.projectId);if(t.get(3)!==s.databaseId.database)throw new Ie(be.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+s.databaseId.database);return new Fe(F0(t))}function V0(s,e){return Mh(s.databaseId,e)}function n2(s){const e=L0(s);return e.length===4?Et.emptyPath():F0(e)}function Od(s){return new Et(["projects",s.databaseId.projectId,"databases",s.databaseId.database]).canonicalString()}function F0(s){return xt(s.length>4&&s.get(4)==="documents"),s.popFirst(5)}function ag(s,e,t){return{name:Pd(s,e),fields:t.value.mapValue.fields}}function a2(s,e){let t;if("targetChange"in e){e.targetChange;const r=function(h){return h==="NO_CHANGE"?0:h==="ADD"?1:h==="REMOVE"?2:h==="CURRENT"?3:h==="RESET"?4:We()}(e.targetChange.targetChangeType||"NO_CHANGE"),a=e.targetChange.targetIds||[],i=function(h,u){return h.useProto3Json?(xt(u===void 0||typeof u=="string"),ts.fromBase64String(u||"")):(xt(u===void 0||u instanceof Buffer||u instanceof Uint8Array),ts.fromUint8Array(u||new Uint8Array))}(s,e.targetChange.resumeToken),o=e.targetChange.cause,l=o&&function(h){const u=h.code===void 0?be.UNKNOWN:$0(h.code);return new Ie(u,h.message||"")}(o);t=new P0(r,a,i,l||null)}else if("documentChange"in e){e.documentChange;const r=e.documentChange;r.document,r.document.name,r.document.updateTime;const a=Kc(s,r.document.name),i=rr(r.document.updateTime),o=r.document.createTime?rr(r.document.createTime):Ke.min(),l=new _s({mapValue:{fields:r.document.fields}}),c=ls.newFoundDocument(a,i,o,l),h=r.targetIds||[],u=r.removedTargetIds||[];t=new el(h,u,c.key,c)}else if("documentDelete"in e){e.documentDelete;const r=e.documentDelete;r.document;const a=Kc(s,r.document),i=r.readTime?rr(r.readTime):Ke.min(),o=ls.newNoDocument(a,i),l=r.removedTargetIds||[];t=new el([],l,o.key,o)}else if("documentRemove"in e){e.documentRemove;const r=e.documentRemove;r.document;const a=Kc(s,r.document),i=r.removedTargetIds||[];t=new el([],i,a,null)}else{if(!("filter"in e))return We();{e.filter;const r=e.filter;r.targetId;const{count:a=0,unchangedNames:i}=r,o=new Kk(a,i),l=r.targetId;t=new R0(l,o)}}return t}function i2(s,e){let t;if(e instanceof ro)t={update:ag(s,e.key,e.value)};else if(e instanceof Ah)t={delete:Pd(s,e.key)};else if(e instanceof yn)t={update:ag(s,e.key,e.data),updateMask:f2(e.fieldMask)};else{if(!(e instanceof Wk))return We();t={verify:Pd(s,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(r=>function(i,o){const l=o.transform;if(l instanceof yl)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(l instanceof Li)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:l.elements}};if(l instanceof Vi)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:l.elements}};if(l instanceof vl)return{fieldPath:o.field.canonicalString(),increment:l.Pe};throw We()}(0,r))),e.precondition.isNone||(t.currentDocument=function(a,i){return i.updateTime!==void 0?{updateTime:r2(a,i.updateTime)}:i.exists!==void 0?{exists:i.exists}:We()}(s,e.precondition)),t}function o2(s,e){return s&&s.length>0?(xt(e!==void 0),s.map(t=>function(a,i){let o=a.updateTime?rr(a.updateTime):rr(i);return o.isEqual(Ke.min())&&(o=rr(i)),new Bk(o,a.transformResults||[])}(t,e))):[]}function l2(s,e){return{documents:[V0(s,e.path)]}}function c2(s,e){const t={structuredQuery:{}},r=e.path;let a;e.collectionGroup!==null?(a=r,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(a=r.popLast(),t.structuredQuery.from=[{collectionId:r.lastSegment()}]),t.parent=V0(s,a);const i=function(h){if(h.length!==0)return B0(Gs.create(h,"and"))}(e.filters);i&&(t.structuredQuery.where=i);const o=function(h){if(h.length!==0)return h.map(u=>function(g){return{field:ia(g.field),direction:u2(g.dir)}}(u))}(e.orderBy);o&&(t.structuredQuery.orderBy=o);const l=$d(s,e.limit);return l!==null&&(t.structuredQuery.limit=l),e.startAt&&(t.structuredQuery.startAt=function(h){return{before:h.inclusive,values:h.position}}(e.startAt)),e.endAt&&(t.structuredQuery.endAt=function(h){return{before:!h.inclusive,values:h.position}}(e.endAt)),{_t:t,parent:a}}function d2(s){let e=n2(s.parent);const t=s.structuredQuery,r=t.from?t.from.length:0;let a=null;if(r>0){xt(r===1);const u=t.from[0];u.allDescendants?a=u.collectionId:e=e.child(u.collectionId)}let i=[];t.where&&(i=function(m){const g=U0(m);return g instanceof Gs&&x0(g)?g.getFilters():[g]}(t.where));let o=[];t.orderBy&&(o=function(m){return m.map(g=>function(j){return new Oi(oa(j.field),function(y){switch(y){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(j.direction))}(g))}(t.orderBy));let l=null;t.limit&&(l=function(m){let g;return g=typeof m=="object"?m.value:m,Zl(g)?null:g}(t.limit));let c=null;t.startAt&&(c=function(m){const g=!!m.before,p=m.values||[];return new bl(p,g)}(t.startAt));let h=null;return t.endAt&&(h=function(m){const g=!m.before,p=m.values||[];return new bl(p,g)}(t.endAt)),Ik(e,a,o,i,l,"F",c,h)}function h2(s,e){const t=function(a){switch(a){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return We()}}(e.purpose);return t==null?null:{"goog-listen-tags":t}}function U0(s){return s.unaryFilter!==void 0?function(t){switch(t.unaryFilter.op){case"IS_NAN":const r=oa(t.unaryFilter.field);return Vt.create(r,"==",{doubleValue:NaN});case"IS_NULL":const a=oa(t.unaryFilter.field);return Vt.create(a,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const i=oa(t.unaryFilter.field);return Vt.create(i,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const o=oa(t.unaryFilter.field);return Vt.create(o,"!=",{nullValue:"NULL_VALUE"});default:return We()}}(s):s.fieldFilter!==void 0?function(t){return Vt.create(oa(t.fieldFilter.field),function(a){switch(a){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return We()}}(t.fieldFilter.op),t.fieldFilter.value)}(s):s.compositeFilter!==void 0?function(t){return Gs.create(t.compositeFilter.filters.map(r=>U0(r)),function(a){switch(a){case"AND":return"and";case"OR":return"or";default:return We()}}(t.compositeFilter.op))}(s):We()}function u2(s){return Zk[s]}function m2(s){return e2[s]}function g2(s){return t2[s]}function ia(s){return{fieldPath:s.canonicalString()}}function oa(s){return Zt.fromServerFormat(s.fieldPath)}function B0(s){return s instanceof Vt?function(t){if(t.op==="=="){if(Wm(t.value))return{unaryFilter:{field:ia(t.field),op:"IS_NAN"}};if(Hm(t.value))return{unaryFilter:{field:ia(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(Wm(t.value))return{unaryFilter:{field:ia(t.field),op:"IS_NOT_NAN"}};if(Hm(t.value))return{unaryFilter:{field:ia(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:ia(t.field),op:m2(t.op),value:t.value}}}(s):s instanceof Gs?function(t){const r=t.getFilters().map(a=>B0(a));return r.length===1?r[0]:{compositeFilter:{op:g2(t.op),filters:r}}}(s):We()}function f2(s){const e=[];return s.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function z0(s){return s.length>=4&&s.get(0)==="projects"&&s.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sn{constructor(e,t,r,a,i=Ke.min(),o=Ke.min(),l=ts.EMPTY_BYTE_STRING,c=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=a,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=l,this.expectedCount=c}withSequenceNumber(e){return new sn(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new sn(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new sn(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new sn(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class p2{constructor(e){this.ct=e}}function x2(s){const e=d2({parent:s.parent,structuredQuery:s.structuredQuery});return s.limitType==="LAST"?Md(e,e.limit,"L"):e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class b2{constructor(){this.un=new y2}addToCollectionParentIndex(e,t){return this.un.add(t),we.resolve()}getCollectionParents(e,t){return we.resolve(this.un.getEntries(t))}addFieldIndex(e,t){return we.resolve()}deleteFieldIndex(e,t){return we.resolve()}deleteAllFieldIndexes(e){return we.resolve()}createTargetIndexes(e,t){return we.resolve()}getDocumentsMatchingTarget(e,t){return we.resolve(null)}getIndexType(e,t){return we.resolve(0)}getFieldIndexes(e,t){return we.resolve([])}getNextCollectionGroupToUpdate(e){return we.resolve(null)}getMinOffset(e,t){return we.resolve(gn.min())}getMinOffsetFromCollectionGroup(e,t){return we.resolve(gn.min())}updateCollectionGroup(e,t,r){return we.resolve()}updateIndexEntries(e,t){return we.resolve()}}class y2{constructor(){this.index={}}add(e){const t=e.lastSegment(),r=e.popLast(),a=this.index[t]||new es(Et.comparator),i=!a.has(r);return this.index[t]=a.add(r),i}has(e){const t=e.lastSegment(),r=e.popLast(),a=this.index[t];return a&&a.has(r)}getEntries(e){return(this.index[e]||new es(Et.comparator)).toArray()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ja{constructor(e){this.Ln=e}next(){return this.Ln+=2,this.Ln}static Bn(){return new ja(0)}static kn(){return new ja(-1)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class v2{constructor(){this.changes=new Pa(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,ls.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const r=this.changes.get(t);return r!==void 0?we.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class w2{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class k2{constructor(e,t,r,a){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=a}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(a=>(r=a,this.remoteDocumentCache.getEntry(e,t))).next(a=>(r!==null&&yi(r.mutation,a,Ts.empty(),zt.now()),a))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.getLocalViewOfDocuments(e,r,tt()).next(()=>r))}getLocalViewOfDocuments(e,t,r=tt()){const a=An();return this.populateOverlays(e,a,t).next(()=>this.computeViews(e,t,a,r).next(i=>{let o=li();return i.forEach((l,c)=>{o=o.insert(l,c.overlayedDocument)}),o}))}getOverlayedDocuments(e,t){const r=An();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,tt()))}populateOverlays(e,t,r){const a=[];return r.forEach(i=>{t.has(i)||a.push(i)}),this.documentOverlayCache.getOverlays(e,a).next(i=>{i.forEach((o,l)=>{t.set(o,l)})})}computeViews(e,t,r,a){let i=$r();const o=bi(),l=function(){return bi()}();return t.forEach((c,h)=>{const u=r.get(h.key);a.has(h.key)&&(u===void 0||u.mutation instanceof yn)?i=i.insert(h.key,h):u!==void 0?(o.set(h.key,u.mutation.getFieldMask()),yi(u.mutation,h,u.mutation.getFieldMask(),zt.now())):o.set(h.key,Ts.empty())}),this.recalculateAndSaveOverlays(e,i).next(c=>(c.forEach((h,u)=>o.set(h,u)),t.forEach((h,u)=>{var m;return l.set(h,new w2(u,(m=o.get(h))!==null&&m!==void 0?m:null))}),l))}recalculateAndSaveOverlays(e,t){const r=bi();let a=new At((o,l)=>o-l),i=tt();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(o=>{for(const l of o)l.keys().forEach(c=>{const h=t.get(c);if(h===null)return;let u=r.get(c)||Ts.empty();u=l.applyToLocalView(h,u),r.set(c,u);const m=(a.get(l.batchId)||tt()).add(c);a=a.insert(l.batchId,m)})}).next(()=>{const o=[],l=a.getReverseIterator();for(;l.hasNext();){const c=l.getNext(),h=c.key,u=c.value,m=E0();u.forEach(g=>{if(!i.has(g)){const p=D0(t.get(g),r.get(g));p!==null&&m.set(g,p),i=i.add(g)}}),o.push(this.documentOverlayCache.saveOverlays(e,h,m))}return we.waitFor(o)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,t,r,a){return function(o){return Fe.isDocumentKey(o.path)&&o.collectionGroup===null&&o.filters.length===0}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):w0(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,a):this.getDocumentsMatchingCollectionQuery(e,t,r,a)}getNextDocuments(e,t,r,a){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,a).next(i=>{const o=a-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,a-i.size):we.resolve(An());let l=-1,c=i;return o.next(h=>we.forEach(h,(u,m)=>(l<m.largestBatchId&&(l=m.largestBatchId),i.get(u)?we.resolve():this.remoteDocumentCache.getEntry(e,u).next(g=>{c=c.insert(u,g)}))).next(()=>this.populateOverlays(e,h,i)).next(()=>this.computeViews(e,c,h,tt())).next(u=>({batchId:l,changes:j0(u)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new Fe(t)).next(r=>{let a=li();return r.isFoundDocument()&&(a=a.insert(r.key,r)),a})}getDocumentsMatchingCollectionGroupQuery(e,t,r,a){const i=t.collectionGroup;let o=li();return this.indexManager.getCollectionParents(e,i).next(l=>we.forEach(l,c=>{const h=function(m,g){return new Ra(g,null,m.explicitOrderBy.slice(),m.filters.slice(),m.limit,m.limitType,m.startAt,m.endAt)}(t,c.child(i));return this.getDocumentsMatchingCollectionQuery(e,h,r,a).next(u=>{u.forEach((m,g)=>{o=o.insert(m,g)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(e,t,r,a){let i;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next(o=>(i=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,i,a))).next(o=>{i.forEach((c,h)=>{const u=h.getKey();o.get(u)===null&&(o=o.insert(u,ls.newInvalidDocument(u)))});let l=li();return o.forEach((c,h)=>{const u=i.get(c);u!==void 0&&yi(u.mutation,h,Ts.empty(),zt.now()),tc(t,h)&&(l=l.insert(c,h))}),l})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _2{constructor(e){this.serializer=e,this.hr=new Map,this.Pr=new Map}getBundleMetadata(e,t){return we.resolve(this.hr.get(t))}saveBundleMetadata(e,t){return this.hr.set(t.id,function(a){return{id:a.id,version:a.version,createTime:rr(a.createTime)}}(t)),we.resolve()}getNamedQuery(e,t){return we.resolve(this.Pr.get(t))}saveNamedQuery(e,t){return this.Pr.set(t.name,function(a){return{name:a.name,query:x2(a.bundledQuery),readTime:rr(a.readTime)}}(t)),we.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class N2{constructor(){this.overlays=new At(Fe.comparator),this.Ir=new Map}getOverlay(e,t){return we.resolve(this.overlays.get(t))}getOverlays(e,t){const r=An();return we.forEach(t,a=>this.getOverlay(e,a).next(i=>{i!==null&&r.set(a,i)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((a,i)=>{this.ht(e,t,i)}),we.resolve()}removeOverlaysForBatchId(e,t,r){const a=this.Ir.get(r);return a!==void 0&&(a.forEach(i=>this.overlays=this.overlays.remove(i)),this.Ir.delete(r)),we.resolve()}getOverlaysForCollection(e,t,r){const a=An(),i=t.length+1,o=new Fe(t.child("")),l=this.overlays.getIteratorFrom(o);for(;l.hasNext();){const c=l.getNext().value,h=c.getKey();if(!t.isPrefixOf(h.path))break;h.path.length===i&&c.largestBatchId>r&&a.set(c.getKey(),c)}return we.resolve(a)}getOverlaysForCollectionGroup(e,t,r,a){let i=new At((h,u)=>h-u);const o=this.overlays.getIterator();for(;o.hasNext();){const h=o.getNext().value;if(h.getKey().getCollectionGroup()===t&&h.largestBatchId>r){let u=i.get(h.largestBatchId);u===null&&(u=An(),i=i.insert(h.largestBatchId,u)),u.set(h.getKey(),h)}}const l=An(),c=i.getIterator();for(;c.hasNext()&&(c.getNext().value.forEach((h,u)=>l.set(h,u)),!(l.size()>=a)););return we.resolve(l)}ht(e,t,r){const a=this.overlays.get(r.key);if(a!==null){const o=this.Ir.get(a.largestBatchId).delete(r.key);this.Ir.set(a.largestBatchId,o)}this.overlays=this.overlays.insert(r.key,new Gk(t,r));let i=this.Ir.get(t);i===void 0&&(i=tt(),this.Ir.set(t,i)),this.Ir.set(t,i.add(r.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class j2{constructor(){this.sessionToken=ts.EMPTY_BYTE_STRING}getSessionToken(e){return we.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,we.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $h{constructor(){this.Tr=new es(Ht.Er),this.dr=new es(Ht.Ar)}isEmpty(){return this.Tr.isEmpty()}addReference(e,t){const r=new Ht(e,t);this.Tr=this.Tr.add(r),this.dr=this.dr.add(r)}Rr(e,t){e.forEach(r=>this.addReference(r,t))}removeReference(e,t){this.Vr(new Ht(e,t))}mr(e,t){e.forEach(r=>this.removeReference(r,t))}gr(e){const t=new Fe(new Et([])),r=new Ht(t,e),a=new Ht(t,e+1),i=[];return this.dr.forEachInRange([r,a],o=>{this.Vr(o),i.push(o.key)}),i}pr(){this.Tr.forEach(e=>this.Vr(e))}Vr(e){this.Tr=this.Tr.delete(e),this.dr=this.dr.delete(e)}yr(e){const t=new Fe(new Et([])),r=new Ht(t,e),a=new Ht(t,e+1);let i=tt();return this.dr.forEachInRange([r,a],o=>{i=i.add(o.key)}),i}containsKey(e){const t=new Ht(e,0),r=this.Tr.firstAfterOrEqual(t);return r!==null&&e.isEqual(r.key)}}class Ht{constructor(e,t){this.key=e,this.wr=t}static Er(e,t){return Fe.comparator(e.key,t.key)||ht(e.wr,t.wr)}static Ar(e,t){return ht(e.wr,t.wr)||Fe.comparator(e.key,t.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class E2{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.Sr=1,this.br=new es(Ht.Er)}checkEmpty(e){return we.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,r,a){const i=this.Sr;this.Sr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const o=new qk(i,t,r,a);this.mutationQueue.push(o);for(const l of a)this.br=this.br.add(new Ht(l.key,i)),this.indexManager.addToCollectionParentIndex(e,l.key.path.popLast());return we.resolve(o)}lookupMutationBatch(e,t){return we.resolve(this.Dr(t))}getNextMutationBatchAfterBatchId(e,t){const r=t+1,a=this.vr(r),i=a<0?0:a;return we.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return we.resolve(this.mutationQueue.length===0?-1:this.Sr-1)}getAllMutationBatches(e){return we.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const r=new Ht(t,0),a=new Ht(t,Number.POSITIVE_INFINITY),i=[];return this.br.forEachInRange([r,a],o=>{const l=this.Dr(o.wr);i.push(l)}),we.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new es(ht);return t.forEach(a=>{const i=new Ht(a,0),o=new Ht(a,Number.POSITIVE_INFINITY);this.br.forEachInRange([i,o],l=>{r=r.add(l.wr)})}),we.resolve(this.Cr(r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,a=r.length+1;let i=r;Fe.isDocumentKey(i)||(i=i.child(""));const o=new Ht(new Fe(i),0);let l=new es(ht);return this.br.forEachWhile(c=>{const h=c.key.path;return!!r.isPrefixOf(h)&&(h.length===a&&(l=l.add(c.wr)),!0)},o),we.resolve(this.Cr(l))}Cr(e){const t=[];return e.forEach(r=>{const a=this.Dr(r);a!==null&&t.push(a)}),t}removeMutationBatch(e,t){xt(this.Fr(t.batchId,"removed")===0),this.mutationQueue.shift();let r=this.br;return we.forEach(t.mutations,a=>{const i=new Ht(a.key,t.batchId);return r=r.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,a.key)}).next(()=>{this.br=r})}On(e){}containsKey(e,t){const r=new Ht(t,0),a=this.br.firstAfterOrEqual(r);return we.resolve(t.isEqual(a&&a.key))}performConsistencyCheck(e){return this.mutationQueue.length,we.resolve()}Fr(e,t){return this.vr(e)}vr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Dr(e){const t=this.vr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class S2{constructor(e){this.Mr=e,this.docs=function(){return new At(Fe.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const r=t.key,a=this.docs.get(r),i=a?a.size:0,o=this.Mr(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:o}),this.size+=o-i,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const r=this.docs.get(t);return we.resolve(r?r.document.mutableCopy():ls.newInvalidDocument(t))}getEntries(e,t){let r=$r();return t.forEach(a=>{const i=this.docs.get(a);r=r.insert(a,i?i.document.mutableCopy():ls.newInvalidDocument(a))}),we.resolve(r)}getDocumentsMatchingQuery(e,t,r,a){let i=$r();const o=t.path,l=new Fe(o.child("")),c=this.docs.getIteratorFrom(l);for(;c.hasNext();){const{key:h,value:{document:u}}=c.getNext();if(!o.isPrefixOf(h.path))break;h.path.length>o.length+1||dk(ck(u),r)<=0||(a.has(u.key)||tc(t,u))&&(i=i.insert(u.key,u.mutableCopy()))}return we.resolve(i)}getAllFromCollectionGroup(e,t,r,a){We()}Or(e,t){return we.forEach(this.docs,r=>t(r))}newChangeBuffer(e){return new T2(this)}getSize(e){return we.resolve(this.size)}}class T2 extends v2{constructor(e){super(),this.cr=e}applyChanges(e){const t=[];return this.changes.forEach((r,a)=>{a.isValidDocument()?t.push(this.cr.addEntry(e,a)):this.cr.removeEntry(r)}),we.waitFor(t)}getFromCache(e,t){return this.cr.getEntry(e,t)}getAllFromCache(e,t){return this.cr.getEntries(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class I2{constructor(e){this.persistence=e,this.Nr=new Pa(t=>Eh(t),Sh),this.lastRemoteSnapshotVersion=Ke.min(),this.highestTargetId=0,this.Lr=0,this.Br=new $h,this.targetCount=0,this.kr=ja.Bn()}forEachTarget(e,t){return this.Nr.forEach((r,a)=>t(a)),we.resolve()}getLastRemoteSnapshotVersion(e){return we.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return we.resolve(this.Lr)}allocateTargetId(e){return this.highestTargetId=this.kr.next(),we.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.Lr&&(this.Lr=t),we.resolve()}Kn(e){this.Nr.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.kr=new ja(t),this.highestTargetId=t),e.sequenceNumber>this.Lr&&(this.Lr=e.sequenceNumber)}addTargetData(e,t){return this.Kn(t),this.targetCount+=1,we.resolve()}updateTargetData(e,t){return this.Kn(t),we.resolve()}removeTargetData(e,t){return this.Nr.delete(t.target),this.Br.gr(t.targetId),this.targetCount-=1,we.resolve()}removeTargets(e,t,r){let a=0;const i=[];return this.Nr.forEach((o,l)=>{l.sequenceNumber<=t&&r.get(l.targetId)===null&&(this.Nr.delete(o),i.push(this.removeMatchingKeysForTargetId(e,l.targetId)),a++)}),we.waitFor(i).next(()=>a)}getTargetCount(e){return we.resolve(this.targetCount)}getTargetData(e,t){const r=this.Nr.get(t)||null;return we.resolve(r)}addMatchingKeys(e,t,r){return this.Br.Rr(t,r),we.resolve()}removeMatchingKeys(e,t,r){this.Br.mr(t,r);const a=this.persistence.referenceDelegate,i=[];return a&&t.forEach(o=>{i.push(a.markPotentiallyOrphaned(e,o))}),we.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this.Br.gr(t),we.resolve()}getMatchingKeysForTargetId(e,t){const r=this.Br.yr(t);return we.resolve(r)}containsKey(e,t){return we.resolve(this.Br.containsKey(t))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class A2{constructor(e,t){this.qr={},this.overlays={},this.Qr=new kh(0),this.Kr=!1,this.Kr=!0,this.$r=new j2,this.referenceDelegate=e(this),this.Ur=new I2(this),this.indexManager=new b2,this.remoteDocumentCache=function(a){return new S2(a)}(r=>this.referenceDelegate.Wr(r)),this.serializer=new p2(t),this.Gr=new _2(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Kr=!1,Promise.resolve()}get started(){return this.Kr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new N2,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.qr[e.toKey()];return r||(r=new E2(t,this.referenceDelegate),this.qr[e.toKey()]=r),r}getGlobalsCache(){return this.$r}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Gr}runTransaction(e,t,r){Me("MemoryPersistence","Starting transaction:",e);const a=new C2(this.Qr.next());return this.referenceDelegate.zr(),r(a).next(i=>this.referenceDelegate.jr(a).next(()=>i)).toPromise().then(i=>(a.raiseOnCommittedEvent(),i))}Hr(e,t){return we.or(Object.values(this.qr).map(r=>()=>r.containsKey(e,t)))}}class C2 extends uk{constructor(e){super(),this.currentSequenceNumber=e}}class Rh{constructor(e){this.persistence=e,this.Jr=new $h,this.Yr=null}static Zr(e){return new Rh(e)}get Xr(){if(this.Yr)return this.Yr;throw We()}addReference(e,t,r){return this.Jr.addReference(r,t),this.Xr.delete(r.toString()),we.resolve()}removeReference(e,t,r){return this.Jr.removeReference(r,t),this.Xr.add(r.toString()),we.resolve()}markPotentiallyOrphaned(e,t){return this.Xr.add(t.toString()),we.resolve()}removeTarget(e,t){this.Jr.gr(t.targetId).forEach(a=>this.Xr.add(a.toString()));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(a=>{a.forEach(i=>this.Xr.add(i.toString()))}).next(()=>r.removeTargetData(e,t))}zr(){this.Yr=new Set}jr(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return we.forEach(this.Xr,r=>{const a=Fe.fromPath(r);return this.ei(e,a).next(i=>{i||t.removeEntry(a,Ke.min())})}).next(()=>(this.Yr=null,t.apply(e)))}updateLimboDocument(e,t){return this.ei(e,t).next(r=>{r?this.Xr.delete(t.toString()):this.Xr.add(t.toString())})}Wr(e){return 0}ei(e,t){return we.or([()=>we.resolve(this.Jr.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Hr(e,t)])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ph{constructor(e,t,r,a){this.targetId=e,this.fromCache=t,this.$i=r,this.Ui=a}static Wi(e,t){let r=tt(),a=tt();for(const i of t.docChanges)switch(i.type){case 0:r=r.add(i.doc.key);break;case 1:a=a.add(i.doc.key)}return new Ph(e,t.fromCache,r,a)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class D2{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class M2{constructor(){this.Gi=!1,this.zi=!1,this.ji=100,this.Hi=function(){return Pw()?8:mk(ds())>0?6:4}()}initialize(e,t){this.Ji=e,this.indexManager=t,this.Gi=!0}getDocumentsMatchingQuery(e,t,r,a){const i={result:null};return this.Yi(e,t).next(o=>{i.result=o}).next(()=>{if(!i.result)return this.Zi(e,t,a,r).next(o=>{i.result=o})}).next(()=>{if(i.result)return;const o=new D2;return this.Xi(e,t,o).next(l=>{if(i.result=l,this.zi)return this.es(e,t,o,l.size)})}).next(()=>i.result)}es(e,t,r,a){return r.documentReadCount<this.ji?(Xa()<=rt.DEBUG&&Me("QueryEngine","SDK will not create cache indexes for query:",aa(t),"since it only creates cache indexes for collection contains","more than or equal to",this.ji,"documents"),we.resolve()):(Xa()<=rt.DEBUG&&Me("QueryEngine","Query:",aa(t),"scans",r.documentReadCount,"local documents and returns",a,"documents as results."),r.documentReadCount>this.Hi*a?(Xa()<=rt.DEBUG&&Me("QueryEngine","The SDK decides to create cache indexes for query:",aa(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,sr(t))):we.resolve())}Yi(e,t){if(Ym(t))return we.resolve(null);let r=sr(t);return this.indexManager.getIndexType(e,r).next(a=>a===0?null:(t.limit!==null&&a===1&&(t=Md(t,null,"F"),r=sr(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next(i=>{const o=tt(...i);return this.Ji.getDocuments(e,o).next(l=>this.indexManager.getMinOffset(e,r).next(c=>{const h=this.ts(t,l);return this.ns(t,h,o,c.readTime)?this.Yi(e,Md(t,null,"F")):this.rs(e,h,t,c)}))})))}Zi(e,t,r,a){return Ym(t)||a.isEqual(Ke.min())?we.resolve(null):this.Ji.getDocuments(e,r).next(i=>{const o=this.ts(t,i);return this.ns(t,o,r,a)?we.resolve(null):(Xa()<=rt.DEBUG&&Me("QueryEngine","Re-using previous result from %s to execute query: %s",a.toString(),aa(t)),this.rs(e,o,t,lk(a,-1)).next(l=>l))})}ts(e,t){let r=new es(_0(e));return t.forEach((a,i)=>{tc(e,i)&&(r=r.add(i))}),r}ns(e,t,r,a){if(e.limit===null)return!1;if(r.size!==t.size)return!0;const i=e.limitType==="F"?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(a)>0)}Xi(e,t,r){return Xa()<=rt.DEBUG&&Me("QueryEngine","Using full collection scan to execute query:",aa(t)),this.Ji.getDocumentsMatchingQuery(e,t,gn.min(),r)}rs(e,t,r,a){return this.Ji.getDocumentsMatchingQuery(e,r,a).next(i=>(t.forEach(o=>{i=i.insert(o.key,o)}),i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $2{constructor(e,t,r,a){this.persistence=e,this.ss=t,this.serializer=a,this.os=new At(ht),this._s=new Pa(i=>Eh(i),Sh),this.us=new Map,this.cs=e.getRemoteDocumentCache(),this.Ur=e.getTargetCache(),this.Gr=e.getBundleCache(),this.ls(r)}ls(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new k2(this.cs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.cs.setIndexManager(this.indexManager),this.ss.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.os))}}function R2(s,e,t,r){return new $2(s,e,t,r)}async function H0(s,e){const t=Ye(s);return await t.persistence.runTransaction("Handle user change","readonly",r=>{let a;return t.mutationQueue.getAllMutationBatches(r).next(i=>(a=i,t.ls(e),t.mutationQueue.getAllMutationBatches(r))).next(i=>{const o=[],l=[];let c=tt();for(const h of a){o.push(h.batchId);for(const u of h.mutations)c=c.add(u.key)}for(const h of i){l.push(h.batchId);for(const u of h.mutations)c=c.add(u.key)}return t.localDocuments.getDocuments(r,c).next(h=>({hs:h,removedBatchIds:o,addedBatchIds:l}))})})}function P2(s,e){const t=Ye(s);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{const a=e.batch.keys(),i=t.cs.newChangeBuffer({trackRemovals:!0});return function(l,c,h,u){const m=h.batch,g=m.keys();let p=we.resolve();return g.forEach(j=>{p=p.next(()=>u.getEntry(c,j)).next(_=>{const y=h.docVersions.get(j);xt(y!==null),_.version.compareTo(y)<0&&(m.applyToRemoteDocument(_,h),_.isValidDocument()&&(_.setReadTime(h.commitVersion),u.addEntry(_)))})}),p.next(()=>l.mutationQueue.removeMutationBatch(c,m))}(t,r,e,i).next(()=>i.apply(r)).next(()=>t.mutationQueue.performConsistencyCheck(r)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(r,a,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,function(l){let c=tt();for(let h=0;h<l.mutationResults.length;++h)l.mutationResults[h].transformResults.length>0&&(c=c.add(l.batch.mutations[h].key));return c}(e))).next(()=>t.localDocuments.getDocuments(r,a))})}function W0(s){const e=Ye(s);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Ur.getLastRemoteSnapshotVersion(t))}function O2(s,e){const t=Ye(s),r=e.snapshotVersion;let a=t.os;return t.persistence.runTransaction("Apply remote event","readwrite-primary",i=>{const o=t.cs.newChangeBuffer({trackRemovals:!0});a=t.os;const l=[];e.targetChanges.forEach((u,m)=>{const g=a.get(m);if(!g)return;l.push(t.Ur.removeMatchingKeys(i,u.removedDocuments,m).next(()=>t.Ur.addMatchingKeys(i,u.addedDocuments,m)));let p=g.withSequenceNumber(i.currentSequenceNumber);e.targetMismatches.get(m)!==null?p=p.withResumeToken(ts.EMPTY_BYTE_STRING,Ke.min()).withLastLimboFreeSnapshotVersion(Ke.min()):u.resumeToken.approximateByteSize()>0&&(p=p.withResumeToken(u.resumeToken,r)),a=a.insert(m,p),function(_,y,M){return _.resumeToken.approximateByteSize()===0||y.snapshotVersion.toMicroseconds()-_.snapshotVersion.toMicroseconds()>=3e8?!0:M.addedDocuments.size+M.modifiedDocuments.size+M.removedDocuments.size>0}(g,p,u)&&l.push(t.Ur.updateTargetData(i,p))});let c=$r(),h=tt();if(e.documentUpdates.forEach(u=>{e.resolvedLimboDocuments.has(u)&&l.push(t.persistence.referenceDelegate.updateLimboDocument(i,u))}),l.push(L2(i,o,e.documentUpdates).next(u=>{c=u.Ps,h=u.Is})),!r.isEqual(Ke.min())){const u=t.Ur.getLastRemoteSnapshotVersion(i).next(m=>t.Ur.setTargetsMetadata(i,i.currentSequenceNumber,r));l.push(u)}return we.waitFor(l).next(()=>o.apply(i)).next(()=>t.localDocuments.getLocalViewOfDocuments(i,c,h)).next(()=>c)}).then(i=>(t.os=a,i))}function L2(s,e,t){let r=tt(),a=tt();return t.forEach(i=>r=r.add(i)),e.getEntries(s,r).next(i=>{let o=$r();return t.forEach((l,c)=>{const h=i.get(l);c.isFoundDocument()!==h.isFoundDocument()&&(a=a.add(l)),c.isNoDocument()&&c.version.isEqual(Ke.min())?(e.removeEntry(l,c.readTime),o=o.insert(l,c)):!h.isValidDocument()||c.version.compareTo(h.version)>0||c.version.compareTo(h.version)===0&&h.hasPendingWrites?(e.addEntry(c),o=o.insert(l,c)):Me("LocalStore","Ignoring outdated watch update for ",l,". Current version:",h.version," Watch version:",c.version)}),{Ps:o,Is:a}})}function V2(s,e){const t=Ye(s);return t.persistence.runTransaction("Get next mutation batch","readonly",r=>(e===void 0&&(e=-1),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function F2(s,e){const t=Ye(s);return t.persistence.runTransaction("Allocate target","readwrite",r=>{let a;return t.Ur.getTargetData(r,e).next(i=>i?(a=i,we.resolve(a)):t.Ur.allocateTargetId(r).next(o=>(a=new sn(e,o,"TargetPurposeListen",r.currentSequenceNumber),t.Ur.addTargetData(r,a).next(()=>a))))}).then(r=>{const a=t.os.get(r.targetId);return(a===null||r.snapshotVersion.compareTo(a.snapshotVersion)>0)&&(t.os=t.os.insert(r.targetId,r),t._s.set(e,r.targetId)),r})}async function Ld(s,e,t){const r=Ye(s),a=r.os.get(e),i=t?"readwrite":"readwrite-primary";try{t||await r.persistence.runTransaction("Release target",i,o=>r.persistence.referenceDelegate.removeTarget(o,a))}catch(o){if(!so(o))throw o;Me("LocalStore",`Failed to update sequence numbers for target ${e}: ${o}`)}r.os=r.os.remove(e),r._s.delete(a.target)}function ig(s,e,t){const r=Ye(s);let a=Ke.min(),i=tt();return r.persistence.runTransaction("Execute query","readwrite",o=>function(c,h,u){const m=Ye(c),g=m._s.get(u);return g!==void 0?we.resolve(m.os.get(g)):m.Ur.getTargetData(h,u)}(r,o,sr(e)).next(l=>{if(l)return a=l.lastLimboFreeSnapshotVersion,r.Ur.getMatchingKeysForTargetId(o,l.targetId).next(c=>{i=c})}).next(()=>r.ss.getDocumentsMatchingQuery(o,e,t?a:Ke.min(),t?i:tt())).next(l=>(U2(r,Ck(e),l),{documents:l,Ts:i})))}function U2(s,e,t){let r=s.us.get(e)||Ke.min();t.forEach((a,i)=>{i.readTime.compareTo(r)>0&&(r=i.readTime)}),s.us.set(e,r)}class og{constructor(){this.activeTargetIds=Ok()}fs(e){this.activeTargetIds=this.activeTargetIds.add(e)}gs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Vs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class B2{constructor(){this.so=new og,this.oo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e,t=!0){return t&&this.so.fs(e),this.oo[e]||"not-current"}updateQueryState(e,t,r){this.oo[e]=t}removeLocalQueryTarget(e){this.so.gs(e)}isLocalQueryTarget(e){return this.so.activeTargetIds.has(e)}clearQueryState(e){delete this.oo[e]}getAllActiveQueryTargets(){return this.so.activeTargetIds}isActiveQueryTarget(e){return this.so.activeTargetIds.has(e)}start(){return this.so=new og,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class z2{_o(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lg{constructor(){this.ao=()=>this.uo(),this.co=()=>this.lo(),this.ho=[],this.Po()}_o(e){this.ho.push(e)}shutdown(){window.removeEventListener("online",this.ao),window.removeEventListener("offline",this.co)}Po(){window.addEventListener("online",this.ao),window.addEventListener("offline",this.co)}uo(){Me("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.ho)e(0)}lo(){Me("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.ho)e(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Ao=null;function Yc(){return Ao===null?Ao=function(){return 268435456+Math.round(2147483648*Math.random())}():Ao++,"0x"+Ao.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const H2={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class W2{constructor(e){this.Io=e.Io,this.To=e.To}Eo(e){this.Ao=e}Ro(e){this.Vo=e}mo(e){this.fo=e}onMessage(e){this.po=e}close(){this.To()}send(e){this.Io(e)}yo(){this.Ao()}wo(){this.Vo()}So(e){this.fo(e)}bo(e){this.po(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ns="WebChannelConnection";class q2 extends class{constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const r=t.ssl?"https":"http",a=encodeURIComponent(this.databaseId.projectId),i=encodeURIComponent(this.databaseId.database);this.Do=r+"://"+t.host,this.vo=`projects/${a}/databases/${i}`,this.Co=this.databaseId.database==="(default)"?`project_id=${a}`:`project_id=${a}&database_id=${i}`}get Fo(){return!1}Mo(t,r,a,i,o){const l=Yc(),c=this.xo(t,r.toUriEncodedString());Me("RestConnection",`Sending RPC '${t}' ${l}:`,c,a);const h={"google-cloud-resource-prefix":this.vo,"x-goog-request-params":this.Co};return this.Oo(h,i,o),this.No(t,c,h,a).then(u=>(Me("RestConnection",`Received RPC '${t}' ${l}: `,u),u),u=>{throw wa("RestConnection",`RPC '${t}' ${l} failed with error: `,u,"url: ",c,"request:",a),u})}Lo(t,r,a,i,o,l){return this.Mo(t,r,a,i,o)}Oo(t,r,a){t["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+$a}(),t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),r&&r.headers.forEach((i,o)=>t[o]=i),a&&a.headers.forEach((i,o)=>t[o]=i)}xo(t,r){const a=H2[t];return`${this.Do}/v1/${r}:${a}`}terminate(){}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}No(e,t,r,a){const i=Yc();return new Promise((o,l)=>{const c=new a0;c.setWithCredentials(!0),c.listenOnce(i0.COMPLETE,()=>{try{switch(c.getLastErrorCode()){case Xo.NO_ERROR:const u=c.getResponseJson();Me(ns,`XHR for RPC '${e}' ${i} received:`,JSON.stringify(u)),o(u);break;case Xo.TIMEOUT:Me(ns,`RPC '${e}' ${i} timed out`),l(new Ie(be.DEADLINE_EXCEEDED,"Request time out"));break;case Xo.HTTP_ERROR:const m=c.getStatus();if(Me(ns,`RPC '${e}' ${i} failed with status:`,m,"response text:",c.getResponseText()),m>0){let g=c.getResponseJson();Array.isArray(g)&&(g=g[0]);const p=g==null?void 0:g.error;if(p&&p.status&&p.message){const j=function(y){const M=y.toLowerCase().replace(/_/g,"-");return Object.values(be).indexOf(M)>=0?M:be.UNKNOWN}(p.status);l(new Ie(j,p.message))}else l(new Ie(be.UNKNOWN,"Server responded with status "+c.getStatus()))}else l(new Ie(be.UNAVAILABLE,"Connection failed."));break;default:We()}}finally{Me(ns,`RPC '${e}' ${i} completed.`)}});const h=JSON.stringify(a);Me(ns,`RPC '${e}' ${i} sending request:`,a),c.send(t,"POST",h,r,15)})}Bo(e,t,r){const a=Yc(),i=[this.Do,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=c0(),l=l0(),c={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},h=this.longPollingOptions.timeoutSeconds;h!==void 0&&(c.longPollingTimeout=Math.round(1e3*h)),this.useFetchStreams&&(c.useFetchStreams=!0),this.Oo(c.initMessageHeaders,t,r),c.encodeInitMessageHeaders=!0;const u=i.join("");Me(ns,`Creating RPC '${e}' stream ${a}: ${u}`,c);const m=o.createWebChannel(u,c);let g=!1,p=!1;const j=new W2({Io:y=>{p?Me(ns,`Not sending because RPC '${e}' stream ${a} is closed:`,y):(g||(Me(ns,`Opening RPC '${e}' stream ${a} transport.`),m.open(),g=!0),Me(ns,`RPC '${e}' stream ${a} sending:`,y),m.send(y))},To:()=>m.close()}),_=(y,M,D)=>{y.listen(M,T=>{try{D(T)}catch(R){setTimeout(()=>{throw R},0)}})};return _(m,oi.EventType.OPEN,()=>{p||(Me(ns,`RPC '${e}' stream ${a} transport opened.`),j.yo())}),_(m,oi.EventType.CLOSE,()=>{p||(p=!0,Me(ns,`RPC '${e}' stream ${a} transport closed`),j.So())}),_(m,oi.EventType.ERROR,y=>{p||(p=!0,wa(ns,`RPC '${e}' stream ${a} transport errored:`,y),j.So(new Ie(be.UNAVAILABLE,"The operation could not be completed")))}),_(m,oi.EventType.MESSAGE,y=>{var M;if(!p){const D=y.data[0];xt(!!D);const T=D,R=T.error||((M=T[0])===null||M===void 0?void 0:M.error);if(R){Me(ns,`RPC '${e}' stream ${a} received error:`,R);const P=R.status;let C=function(v){const S=Lt[v];if(S!==void 0)return $0(S)}(P),N=R.message;C===void 0&&(C=be.INTERNAL,N="Unknown error status: "+P+" with message "+R.message),p=!0,j.So(new Ie(C,N)),m.close()}else Me(ns,`RPC '${e}' stream ${a} received:`,D),j.bo(D)}}),_(l,o0.STAT_EVENT,y=>{y.stat===Sd.PROXY?Me(ns,`RPC '${e}' stream ${a} detected buffering proxy`):y.stat===Sd.NOPROXY&&Me(ns,`RPC '${e}' stream ${a} detected no buffering proxy`)}),setTimeout(()=>{j.wo()},0),j}}function Qc(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ac(s){return new s2(s,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class q0{constructor(e,t,r=1e3,a=1.5,i=6e4){this.ui=e,this.timerId=t,this.ko=r,this.qo=a,this.Qo=i,this.Ko=0,this.$o=null,this.Uo=Date.now(),this.reset()}reset(){this.Ko=0}Wo(){this.Ko=this.Qo}Go(e){this.cancel();const t=Math.floor(this.Ko+this.zo()),r=Math.max(0,Date.now()-this.Uo),a=Math.max(0,t-r);a>0&&Me("ExponentialBackoff",`Backing off for ${a} ms (base delay: ${this.Ko} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.$o=this.ui.enqueueAfterDelay(this.timerId,a,()=>(this.Uo=Date.now(),e())),this.Ko*=this.qo,this.Ko<this.ko&&(this.Ko=this.ko),this.Ko>this.Qo&&(this.Ko=this.Qo)}jo(){this.$o!==null&&(this.$o.skipDelay(),this.$o=null)}cancel(){this.$o!==null&&(this.$o.cancel(),this.$o=null)}zo(){return(Math.random()-.5)*this.Ko}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class G0{constructor(e,t,r,a,i,o,l,c){this.ui=e,this.Ho=r,this.Jo=a,this.connection=i,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=l,this.listener=c,this.state=0,this.Yo=0,this.Zo=null,this.Xo=null,this.stream=null,this.e_=0,this.t_=new q0(e,t)}n_(){return this.state===1||this.state===5||this.r_()}r_(){return this.state===2||this.state===3}start(){this.e_=0,this.state!==4?this.auth():this.i_()}async stop(){this.n_()&&await this.close(0)}s_(){this.state=0,this.t_.reset()}o_(){this.r_()&&this.Zo===null&&(this.Zo=this.ui.enqueueAfterDelay(this.Ho,6e4,()=>this.__()))}a_(e){this.u_(),this.stream.send(e)}async __(){if(this.r_())return this.close(0)}u_(){this.Zo&&(this.Zo.cancel(),this.Zo=null)}c_(){this.Xo&&(this.Xo.cancel(),this.Xo=null)}async close(e,t){this.u_(),this.c_(),this.t_.cancel(),this.Yo++,e!==4?this.t_.reset():t&&t.code===be.RESOURCE_EXHAUSTED?(Mr(t.toString()),Mr("Using maximum backoff delay to prevent overloading the backend."),this.t_.Wo()):t&&t.code===be.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.l_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.mo(t)}l_(){}auth(){this.state=1;const e=this.h_(this.Yo),t=this.Yo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,a])=>{this.Yo===t&&this.P_(r,a)},r=>{e(()=>{const a=new Ie(be.UNKNOWN,"Fetching auth token failed: "+r.message);return this.I_(a)})})}P_(e,t){const r=this.h_(this.Yo);this.stream=this.T_(e,t),this.stream.Eo(()=>{r(()=>this.listener.Eo())}),this.stream.Ro(()=>{r(()=>(this.state=2,this.Xo=this.ui.enqueueAfterDelay(this.Jo,1e4,()=>(this.r_()&&(this.state=3),Promise.resolve())),this.listener.Ro()))}),this.stream.mo(a=>{r(()=>this.I_(a))}),this.stream.onMessage(a=>{r(()=>++this.e_==1?this.E_(a):this.onNext(a))})}i_(){this.state=5,this.t_.Go(async()=>{this.state=0,this.start()})}I_(e){return Me("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}h_(e){return t=>{this.ui.enqueueAndForget(()=>this.Yo===e?t():(Me("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class G2 extends G0{constructor(e,t,r,a,i,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,a,o),this.serializer=i}T_(e,t){return this.connection.Bo("Listen",e,t)}E_(e){return this.onNext(e)}onNext(e){this.t_.reset();const t=a2(this.serializer,e),r=function(i){if(!("targetChange"in i))return Ke.min();const o=i.targetChange;return o.targetIds&&o.targetIds.length?Ke.min():o.readTime?rr(o.readTime):Ke.min()}(e);return this.listener.d_(t,r)}A_(e){const t={};t.database=Od(this.serializer),t.addTarget=function(i,o){let l;const c=o.target;if(l=Cd(c)?{documents:l2(i,c)}:{query:c2(i,c)._t},l.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){l.resumeToken=O0(i,o.resumeToken);const h=$d(i,o.expectedCount);h!==null&&(l.expectedCount=h)}else if(o.snapshotVersion.compareTo(Ke.min())>0){l.readTime=wl(i,o.snapshotVersion.toTimestamp());const h=$d(i,o.expectedCount);h!==null&&(l.expectedCount=h)}return l}(this.serializer,e);const r=h2(this.serializer,e);r&&(t.labels=r),this.a_(t)}R_(e){const t={};t.database=Od(this.serializer),t.removeTarget=e,this.a_(t)}}class K2 extends G0{constructor(e,t,r,a,i,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,a,o),this.serializer=i}get V_(){return this.e_>0}start(){this.lastStreamToken=void 0,super.start()}l_(){this.V_&&this.m_([])}T_(e,t){return this.connection.Bo("Write",e,t)}E_(e){return xt(!!e.streamToken),this.lastStreamToken=e.streamToken,xt(!e.writeResults||e.writeResults.length===0),this.listener.f_()}onNext(e){xt(!!e.streamToken),this.lastStreamToken=e.streamToken,this.t_.reset();const t=o2(e.writeResults,e.commitTime),r=rr(e.commitTime);return this.listener.g_(r,t)}p_(){const e={};e.database=Od(this.serializer),this.a_(e)}m_(e){const t={streamToken:this.lastStreamToken,writes:e.map(r=>i2(this.serializer,r))};this.a_(t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Y2 extends class{}{constructor(e,t,r,a){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=a,this.y_=!1}w_(){if(this.y_)throw new Ie(be.FAILED_PRECONDITION,"The client has already been terminated.")}Mo(e,t,r,a){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,o])=>this.connection.Mo(e,Rd(t,r),a,i,o)).catch(i=>{throw i.name==="FirebaseError"?(i.code===be.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),i):new Ie(be.UNKNOWN,i.toString())})}Lo(e,t,r,a,i){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,l])=>this.connection.Lo(e,Rd(t,r),a,o,l,i)).catch(o=>{throw o.name==="FirebaseError"?(o.code===be.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new Ie(be.UNKNOWN,o.toString())})}terminate(){this.y_=!0,this.connection.terminate()}}class Q2{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.S_=0,this.b_=null,this.D_=!0}v_(){this.S_===0&&(this.C_("Unknown"),this.b_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.b_=null,this.F_("Backend didn't respond within 10 seconds."),this.C_("Offline"),Promise.resolve())))}M_(e){this.state==="Online"?this.C_("Unknown"):(this.S_++,this.S_>=1&&(this.x_(),this.F_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.C_("Offline")))}set(e){this.x_(),this.S_=0,e==="Online"&&(this.D_=!1),this.C_(e)}C_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}F_(e){const t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.D_?(Mr(t),this.D_=!1):Me("OnlineStateTracker",t)}x_(){this.b_!==null&&(this.b_.cancel(),this.b_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class X2{constructor(e,t,r,a,i){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.O_=[],this.N_=new Map,this.L_=new Set,this.B_=[],this.k_=i,this.k_._o(o=>{r.enqueueAndForget(async()=>{Yn(this)&&(Me("RemoteStore","Restarting streams for network reachability change."),await async function(c){const h=Ye(c);h.L_.add(4),await ao(h),h.q_.set("Unknown"),h.L_.delete(4),await ic(h)}(this))})}),this.q_=new Q2(r,a)}}async function ic(s){if(Yn(s))for(const e of s.B_)await e(!0)}async function ao(s){for(const e of s.B_)await e(!1)}function K0(s,e){const t=Ye(s);t.N_.has(e.targetId)||(t.N_.set(e.targetId,e),Fh(t)?Vh(t):Oa(t).r_()&&Lh(t,e))}function Oh(s,e){const t=Ye(s),r=Oa(t);t.N_.delete(e),r.r_()&&Y0(t,e),t.N_.size===0&&(r.r_()?r.o_():Yn(t)&&t.q_.set("Unknown"))}function Lh(s,e){if(s.Q_.xe(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(Ke.min())>0){const t=s.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}Oa(s).A_(e)}function Y0(s,e){s.Q_.xe(e),Oa(s).R_(e)}function Vh(s){s.Q_=new Jk({getRemoteKeysForTarget:e=>s.remoteSyncer.getRemoteKeysForTarget(e),ot:e=>s.N_.get(e)||null,tt:()=>s.datastore.serializer.databaseId}),Oa(s).start(),s.q_.v_()}function Fh(s){return Yn(s)&&!Oa(s).n_()&&s.N_.size>0}function Yn(s){return Ye(s).L_.size===0}function Q0(s){s.Q_=void 0}async function J2(s){s.q_.set("Online")}async function Z2(s){s.N_.forEach((e,t)=>{Lh(s,e)})}async function e_(s,e){Q0(s),Fh(s)?(s.q_.M_(e),Vh(s)):s.q_.set("Unknown")}async function t_(s,e,t){if(s.q_.set("Online"),e instanceof P0&&e.state===2&&e.cause)try{await async function(a,i){const o=i.cause;for(const l of i.targetIds)a.N_.has(l)&&(await a.remoteSyncer.rejectListen(l,o),a.N_.delete(l),a.Q_.removeTarget(l))}(s,e)}catch(r){Me("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),r),await kl(s,r)}else if(e instanceof el?s.Q_.Ke(e):e instanceof R0?s.Q_.He(e):s.Q_.We(e),!t.isEqual(Ke.min()))try{const r=await W0(s.localStore);t.compareTo(r)>=0&&await function(i,o){const l=i.Q_.rt(o);return l.targetChanges.forEach((c,h)=>{if(c.resumeToken.approximateByteSize()>0){const u=i.N_.get(h);u&&i.N_.set(h,u.withResumeToken(c.resumeToken,o))}}),l.targetMismatches.forEach((c,h)=>{const u=i.N_.get(c);if(!u)return;i.N_.set(c,u.withResumeToken(ts.EMPTY_BYTE_STRING,u.snapshotVersion)),Y0(i,c);const m=new sn(u.target,c,h,u.sequenceNumber);Lh(i,m)}),i.remoteSyncer.applyRemoteEvent(l)}(s,t)}catch(r){Me("RemoteStore","Failed to raise snapshot:",r),await kl(s,r)}}async function kl(s,e,t){if(!so(e))throw e;s.L_.add(1),await ao(s),s.q_.set("Offline"),t||(t=()=>W0(s.localStore)),s.asyncQueue.enqueueRetryable(async()=>{Me("RemoteStore","Retrying IndexedDB access"),await t(),s.L_.delete(1),await ic(s)})}function X0(s,e){return e().catch(t=>kl(s,t,e))}async function oc(s){const e=Ye(s),t=pn(e);let r=e.O_.length>0?e.O_[e.O_.length-1].batchId:-1;for(;s_(e);)try{const a=await V2(e.localStore,r);if(a===null){e.O_.length===0&&t.o_();break}r=a.batchId,r_(e,a)}catch(a){await kl(e,a)}J0(e)&&Z0(e)}function s_(s){return Yn(s)&&s.O_.length<10}function r_(s,e){s.O_.push(e);const t=pn(s);t.r_()&&t.V_&&t.m_(e.mutations)}function J0(s){return Yn(s)&&!pn(s).n_()&&s.O_.length>0}function Z0(s){pn(s).start()}async function n_(s){pn(s).p_()}async function a_(s){const e=pn(s);for(const t of s.O_)e.m_(t.mutations)}async function i_(s,e,t){const r=s.O_.shift(),a=Ch.from(r,e,t);await X0(s,()=>s.remoteSyncer.applySuccessfulWrite(a)),await oc(s)}async function o_(s,e){e&&pn(s).V_&&await async function(r,a){if(function(o){return Yk(o)&&o!==be.ABORTED}(a.code)){const i=r.O_.shift();pn(r).s_(),await X0(r,()=>r.remoteSyncer.rejectFailedWrite(i.batchId,a)),await oc(r)}}(s,e),J0(s)&&Z0(s)}async function cg(s,e){const t=Ye(s);t.asyncQueue.verifyOperationInProgress(),Me("RemoteStore","RemoteStore received new credentials");const r=Yn(t);t.L_.add(3),await ao(t),r&&t.q_.set("Unknown"),await t.remoteSyncer.handleCredentialChange(e),t.L_.delete(3),await ic(t)}async function l_(s,e){const t=Ye(s);e?(t.L_.delete(2),await ic(t)):e||(t.L_.add(2),await ao(t),t.q_.set("Unknown"))}function Oa(s){return s.K_||(s.K_=function(t,r,a){const i=Ye(t);return i.w_(),new G2(r,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,a)}(s.datastore,s.asyncQueue,{Eo:J2.bind(null,s),Ro:Z2.bind(null,s),mo:e_.bind(null,s),d_:t_.bind(null,s)}),s.B_.push(async e=>{e?(s.K_.s_(),Fh(s)?Vh(s):s.q_.set("Unknown")):(await s.K_.stop(),Q0(s))})),s.K_}function pn(s){return s.U_||(s.U_=function(t,r,a){const i=Ye(t);return i.w_(),new K2(r,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,a)}(s.datastore,s.asyncQueue,{Eo:()=>Promise.resolve(),Ro:n_.bind(null,s),mo:o_.bind(null,s),f_:a_.bind(null,s),g_:i_.bind(null,s)}),s.B_.push(async e=>{e?(s.U_.s_(),await oc(s)):(await s.U_.stop(),s.O_.length>0&&(Me("RemoteStore",`Stopping write stream with ${s.O_.length} pending writes`),s.O_=[]))})),s.U_}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Uh{constructor(e,t,r,a,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=a,this.removalCallback=i,this.deferred=new Tr,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,a,i){const o=Date.now()+r,l=new Uh(e,t,o,a,i);return l.start(r),l}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new Ie(be.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Bh(s,e){if(Mr("AsyncQueue",`${e}: ${s}`),so(s))return new Ie(be.UNAVAILABLE,`${e}: ${s}`);throw s}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ua{constructor(e){this.comparator=e?(t,r)=>e(t,r)||Fe.comparator(t.key,r.key):(t,r)=>Fe.comparator(t.key,r.key),this.keyedMap=li(),this.sortedSet=new At(this.comparator)}static emptySet(e){return new ua(e.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof ua)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){const a=t.getNext().key,i=r.getNext().key;if(!a.isEqual(i))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){const r=new ua;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dg{constructor(){this.W_=new At(Fe.comparator)}track(e){const t=e.doc.key,r=this.W_.get(t);r?e.type!==0&&r.type===3?this.W_=this.W_.insert(t,e):e.type===3&&r.type!==1?this.W_=this.W_.insert(t,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.W_=this.W_.insert(t,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.W_=this.W_.remove(t):e.type===1&&r.type===2?this.W_=this.W_.insert(t,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):We():this.W_=this.W_.insert(t,e)}G_(){const e=[];return this.W_.inorderTraversal((t,r)=>{e.push(r)}),e}}class Ea{constructor(e,t,r,a,i,o,l,c,h){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=a,this.mutatedKeys=i,this.fromCache=o,this.syncStateChanged=l,this.excludesMetadataChanges=c,this.hasCachedResults=h}static fromInitialDocuments(e,t,r,a,i){const o=[];return t.forEach(l=>{o.push({type:0,doc:l})}),new Ea(e,t,ua.emptySet(t),o,r,a,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&ec(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let a=0;a<t.length;a++)if(t[a].type!==r[a].type||!t[a].doc.isEqual(r[a].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class c_{constructor(){this.z_=void 0,this.j_=[]}H_(){return this.j_.some(e=>e.J_())}}class d_{constructor(){this.queries=hg(),this.onlineState="Unknown",this.Y_=new Set}terminate(){(function(t,r){const a=Ye(t),i=a.queries;a.queries=hg(),i.forEach((o,l)=>{for(const c of l.j_)c.onError(r)})})(this,new Ie(be.ABORTED,"Firestore shutting down"))}}function hg(){return new Pa(s=>k0(s),ec)}async function ex(s,e){const t=Ye(s);let r=3;const a=e.query;let i=t.queries.get(a);i?!i.H_()&&e.J_()&&(r=2):(i=new c_,r=e.J_()?0:1);try{switch(r){case 0:i.z_=await t.onListen(a,!0);break;case 1:i.z_=await t.onListen(a,!1);break;case 2:await t.onFirstRemoteStoreListen(a)}}catch(o){const l=Bh(o,`Initialization of query '${aa(e.query)}' failed`);return void e.onError(l)}t.queries.set(a,i),i.j_.push(e),e.Z_(t.onlineState),i.z_&&e.X_(i.z_)&&zh(t)}async function tx(s,e){const t=Ye(s),r=e.query;let a=3;const i=t.queries.get(r);if(i){const o=i.j_.indexOf(e);o>=0&&(i.j_.splice(o,1),i.j_.length===0?a=e.J_()?0:1:!i.H_()&&e.J_()&&(a=2))}switch(a){case 0:return t.queries.delete(r),t.onUnlisten(r,!0);case 1:return t.queries.delete(r),t.onUnlisten(r,!1);case 2:return t.onLastRemoteStoreUnlisten(r);default:return}}function h_(s,e){const t=Ye(s);let r=!1;for(const a of e){const i=a.query,o=t.queries.get(i);if(o){for(const l of o.j_)l.X_(a)&&(r=!0);o.z_=a}}r&&zh(t)}function u_(s,e,t){const r=Ye(s),a=r.queries.get(e);if(a)for(const i of a.j_)i.onError(t);r.queries.delete(e)}function zh(s){s.Y_.forEach(e=>{e.next()})}var Vd,ug;(ug=Vd||(Vd={})).ea="default",ug.Cache="cache";class sx{constructor(e,t,r){this.query=e,this.ta=t,this.na=!1,this.ra=null,this.onlineState="Unknown",this.options=r||{}}X_(e){if(!this.options.includeMetadataChanges){const r=[];for(const a of e.docChanges)a.type!==3&&r.push(a);e=new Ea(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.na?this.ia(e)&&(this.ta.next(e),t=!0):this.sa(e,this.onlineState)&&(this.oa(e),t=!0),this.ra=e,t}onError(e){this.ta.error(e)}Z_(e){this.onlineState=e;let t=!1;return this.ra&&!this.na&&this.sa(this.ra,e)&&(this.oa(this.ra),t=!0),t}sa(e,t){if(!e.fromCache||!this.J_())return!0;const r=t!=="Offline";return(!this.options._a||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}ia(e){if(e.docChanges.length>0)return!0;const t=this.ra&&this.ra.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}oa(e){e=Ea.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.na=!0,this.ta.next(e)}J_(){return this.options.source!==Vd.Cache}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rx{constructor(e){this.key=e}}class nx{constructor(e){this.key=e}}class m_{constructor(e,t){this.query=e,this.Ta=t,this.Ea=null,this.hasCachedResults=!1,this.current=!1,this.da=tt(),this.mutatedKeys=tt(),this.Aa=_0(e),this.Ra=new ua(this.Aa)}get Va(){return this.Ta}ma(e,t){const r=t?t.fa:new dg,a=t?t.Ra:this.Ra;let i=t?t.mutatedKeys:this.mutatedKeys,o=a,l=!1;const c=this.query.limitType==="F"&&a.size===this.query.limit?a.last():null,h=this.query.limitType==="L"&&a.size===this.query.limit?a.first():null;if(e.inorderTraversal((u,m)=>{const g=a.get(u),p=tc(this.query,m)?m:null,j=!!g&&this.mutatedKeys.has(g.key),_=!!p&&(p.hasLocalMutations||this.mutatedKeys.has(p.key)&&p.hasCommittedMutations);let y=!1;g&&p?g.data.isEqual(p.data)?j!==_&&(r.track({type:3,doc:p}),y=!0):this.ga(g,p)||(r.track({type:2,doc:p}),y=!0,(c&&this.Aa(p,c)>0||h&&this.Aa(p,h)<0)&&(l=!0)):!g&&p?(r.track({type:0,doc:p}),y=!0):g&&!p&&(r.track({type:1,doc:g}),y=!0,(c||h)&&(l=!0)),y&&(p?(o=o.add(p),i=_?i.add(u):i.delete(u)):(o=o.delete(u),i=i.delete(u)))}),this.query.limit!==null)for(;o.size>this.query.limit;){const u=this.query.limitType==="F"?o.last():o.first();o=o.delete(u.key),i=i.delete(u.key),r.track({type:1,doc:u})}return{Ra:o,fa:r,ns:l,mutatedKeys:i}}ga(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,a){const i=this.Ra;this.Ra=e.Ra,this.mutatedKeys=e.mutatedKeys;const o=e.fa.G_();o.sort((u,m)=>function(p,j){const _=y=>{switch(y){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return We()}};return _(p)-_(j)}(u.type,m.type)||this.Aa(u.doc,m.doc)),this.pa(r),a=a!=null&&a;const l=t&&!a?this.ya():[],c=this.da.size===0&&this.current&&!a?1:0,h=c!==this.Ea;return this.Ea=c,o.length!==0||h?{snapshot:new Ea(this.query,e.Ra,i,o,e.mutatedKeys,c===0,h,!1,!!r&&r.resumeToken.approximateByteSize()>0),wa:l}:{wa:l}}Z_(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({Ra:this.Ra,fa:new dg,mutatedKeys:this.mutatedKeys,ns:!1},!1)):{wa:[]}}Sa(e){return!this.Ta.has(e)&&!!this.Ra.has(e)&&!this.Ra.get(e).hasLocalMutations}pa(e){e&&(e.addedDocuments.forEach(t=>this.Ta=this.Ta.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.Ta=this.Ta.delete(t)),this.current=e.current)}ya(){if(!this.current)return[];const e=this.da;this.da=tt(),this.Ra.forEach(r=>{this.Sa(r.key)&&(this.da=this.da.add(r.key))});const t=[];return e.forEach(r=>{this.da.has(r)||t.push(new nx(r))}),this.da.forEach(r=>{e.has(r)||t.push(new rx(r))}),t}ba(e){this.Ta=e.Ts,this.da=tt();const t=this.ma(e.documents);return this.applyChanges(t,!0)}Da(){return Ea.fromInitialDocuments(this.query,this.Ra,this.mutatedKeys,this.Ea===0,this.hasCachedResults)}}class g_{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}}class f_{constructor(e){this.key=e,this.va=!1}}class p_{constructor(e,t,r,a,i,o){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=a,this.currentUser=i,this.maxConcurrentLimboResolutions=o,this.Ca={},this.Fa=new Pa(l=>k0(l),ec),this.Ma=new Map,this.xa=new Set,this.Oa=new At(Fe.comparator),this.Na=new Map,this.La=new $h,this.Ba={},this.ka=new Map,this.qa=ja.kn(),this.onlineState="Unknown",this.Qa=void 0}get isPrimaryClient(){return this.Qa===!0}}async function x_(s,e,t=!0){const r=dx(s);let a;const i=r.Fa.get(e);return i?(r.sharedClientState.addLocalQueryTarget(i.targetId),a=i.view.Da()):a=await ax(r,e,t,!0),a}async function b_(s,e){const t=dx(s);await ax(t,e,!0,!1)}async function ax(s,e,t,r){const a=await F2(s.localStore,sr(e)),i=a.targetId,o=s.sharedClientState.addLocalQueryTarget(i,t);let l;return r&&(l=await y_(s,e,i,o==="current",a.resumeToken)),s.isPrimaryClient&&t&&K0(s.remoteStore,a),l}async function y_(s,e,t,r,a){s.Ka=(m,g,p)=>async function(_,y,M,D){let T=y.view.ma(M);T.ns&&(T=await ig(_.localStore,y.query,!1).then(({documents:N})=>y.view.ma(N,T)));const R=D&&D.targetChanges.get(y.targetId),P=D&&D.targetMismatches.get(y.targetId)!=null,C=y.view.applyChanges(T,_.isPrimaryClient,R,P);return gg(_,y.targetId,C.wa),C.snapshot}(s,m,g,p);const i=await ig(s.localStore,e,!0),o=new m_(e,i.Ts),l=o.ma(i.documents),c=no.createSynthesizedTargetChangeForCurrentChange(t,r&&s.onlineState!=="Offline",a),h=o.applyChanges(l,s.isPrimaryClient,c);gg(s,t,h.wa);const u=new g_(e,t,o);return s.Fa.set(e,u),s.Ma.has(t)?s.Ma.get(t).push(e):s.Ma.set(t,[e]),h.snapshot}async function v_(s,e,t){const r=Ye(s),a=r.Fa.get(e),i=r.Ma.get(a.targetId);if(i.length>1)return r.Ma.set(a.targetId,i.filter(o=>!ec(o,e))),void r.Fa.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(a.targetId),r.sharedClientState.isActiveQueryTarget(a.targetId)||await Ld(r.localStore,a.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(a.targetId),t&&Oh(r.remoteStore,a.targetId),Fd(r,a.targetId)}).catch(to)):(Fd(r,a.targetId),await Ld(r.localStore,a.targetId,!0))}async function w_(s,e){const t=Ye(s),r=t.Fa.get(e),a=t.Ma.get(r.targetId);t.isPrimaryClient&&a.length===1&&(t.sharedClientState.removeLocalQueryTarget(r.targetId),Oh(t.remoteStore,r.targetId))}async function k_(s,e,t){const r=I_(s);try{const a=await function(o,l){const c=Ye(o),h=zt.now(),u=l.reduce((p,j)=>p.add(j.key),tt());let m,g;return c.persistence.runTransaction("Locally write mutations","readwrite",p=>{let j=$r(),_=tt();return c.cs.getEntries(p,u).next(y=>{j=y,j.forEach((M,D)=>{D.isValidDocument()||(_=_.add(M))})}).next(()=>c.localDocuments.getOverlayedDocuments(p,j)).next(y=>{m=y;const M=[];for(const D of l){const T=Hk(D,m.get(D.key).overlayedDocument);T!=null&&M.push(new yn(D.key,T,g0(T.value.mapValue),qs.exists(!0)))}return c.mutationQueue.addMutationBatch(p,h,M,l)}).next(y=>{g=y;const M=y.applyToLocalDocumentSet(m,_);return c.documentOverlayCache.saveOverlays(p,y.batchId,M)})}).then(()=>({batchId:g.batchId,changes:j0(m)}))}(r.localStore,e);r.sharedClientState.addPendingMutation(a.batchId),function(o,l,c){let h=o.Ba[o.currentUser.toKey()];h||(h=new At(ht)),h=h.insert(l,c),o.Ba[o.currentUser.toKey()]=h}(r,a.batchId,t),await io(r,a.changes),await oc(r.remoteStore)}catch(a){const i=Bh(a,"Failed to persist write");t.reject(i)}}async function ix(s,e){const t=Ye(s);try{const r=await O2(t.localStore,e);e.targetChanges.forEach((a,i)=>{const o=t.Na.get(i);o&&(xt(a.addedDocuments.size+a.modifiedDocuments.size+a.removedDocuments.size<=1),a.addedDocuments.size>0?o.va=!0:a.modifiedDocuments.size>0?xt(o.va):a.removedDocuments.size>0&&(xt(o.va),o.va=!1))}),await io(t,r,e)}catch(r){await to(r)}}function mg(s,e,t){const r=Ye(s);if(r.isPrimaryClient&&t===0||!r.isPrimaryClient&&t===1){const a=[];r.Fa.forEach((i,o)=>{const l=o.view.Z_(e);l.snapshot&&a.push(l.snapshot)}),function(o,l){const c=Ye(o);c.onlineState=l;let h=!1;c.queries.forEach((u,m)=>{for(const g of m.j_)g.Z_(l)&&(h=!0)}),h&&zh(c)}(r.eventManager,e),a.length&&r.Ca.d_(a),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function __(s,e,t){const r=Ye(s);r.sharedClientState.updateQueryState(e,"rejected",t);const a=r.Na.get(e),i=a&&a.key;if(i){let o=new At(Fe.comparator);o=o.insert(i,ls.newNoDocument(i,Ke.min()));const l=tt().add(i),c=new nc(Ke.min(),new Map,new At(ht),o,l);await ix(r,c),r.Oa=r.Oa.remove(i),r.Na.delete(e),Hh(r)}else await Ld(r.localStore,e,!1).then(()=>Fd(r,e,t)).catch(to)}async function N_(s,e){const t=Ye(s),r=e.batch.batchId;try{const a=await P2(t.localStore,e);lx(t,r,null),ox(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),await io(t,a)}catch(a){await to(a)}}async function j_(s,e,t){const r=Ye(s);try{const a=await function(o,l){const c=Ye(o);return c.persistence.runTransaction("Reject batch","readwrite-primary",h=>{let u;return c.mutationQueue.lookupMutationBatch(h,l).next(m=>(xt(m!==null),u=m.keys(),c.mutationQueue.removeMutationBatch(h,m))).next(()=>c.mutationQueue.performConsistencyCheck(h)).next(()=>c.documentOverlayCache.removeOverlaysForBatchId(h,u,l)).next(()=>c.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(h,u)).next(()=>c.localDocuments.getDocuments(h,u))})}(r.localStore,e);lx(r,e,t),ox(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),await io(r,a)}catch(a){await to(a)}}function ox(s,e){(s.ka.get(e)||[]).forEach(t=>{t.resolve()}),s.ka.delete(e)}function lx(s,e,t){const r=Ye(s);let a=r.Ba[r.currentUser.toKey()];if(a){const i=a.get(e);i&&(t?i.reject(t):i.resolve(),a=a.remove(e)),r.Ba[r.currentUser.toKey()]=a}}function Fd(s,e,t=null){s.sharedClientState.removeLocalQueryTarget(e);for(const r of s.Ma.get(e))s.Fa.delete(r),t&&s.Ca.$a(r,t);s.Ma.delete(e),s.isPrimaryClient&&s.La.gr(e).forEach(r=>{s.La.containsKey(r)||cx(s,r)})}function cx(s,e){s.xa.delete(e.path.canonicalString());const t=s.Oa.get(e);t!==null&&(Oh(s.remoteStore,t),s.Oa=s.Oa.remove(e),s.Na.delete(t),Hh(s))}function gg(s,e,t){for(const r of t)r instanceof rx?(s.La.addReference(r.key,e),E_(s,r)):r instanceof nx?(Me("SyncEngine","Document no longer in limbo: "+r.key),s.La.removeReference(r.key,e),s.La.containsKey(r.key)||cx(s,r.key)):We()}function E_(s,e){const t=e.key,r=t.path.canonicalString();s.Oa.get(t)||s.xa.has(r)||(Me("SyncEngine","New document in limbo: "+t),s.xa.add(r),Hh(s))}function Hh(s){for(;s.xa.size>0&&s.Oa.size<s.maxConcurrentLimboResolutions;){const e=s.xa.values().next().value;s.xa.delete(e);const t=new Fe(Et.fromString(e)),r=s.qa.next();s.Na.set(r,new f_(t)),s.Oa=s.Oa.insert(t,r),K0(s.remoteStore,new sn(sr(Th(t.path)),r,"TargetPurposeLimboResolution",kh.oe))}}async function io(s,e,t){const r=Ye(s),a=[],i=[],o=[];r.Fa.isEmpty()||(r.Fa.forEach((l,c)=>{o.push(r.Ka(c,e,t).then(h=>{var u;if((h||t)&&r.isPrimaryClient){const m=h?!h.fromCache:(u=t==null?void 0:t.targetChanges.get(c.targetId))===null||u===void 0?void 0:u.current;r.sharedClientState.updateQueryState(c.targetId,m?"current":"not-current")}if(h){a.push(h);const m=Ph.Wi(c.targetId,h);i.push(m)}}))}),await Promise.all(o),r.Ca.d_(a),await async function(c,h){const u=Ye(c);try{await u.persistence.runTransaction("notifyLocalViewChanges","readwrite",m=>we.forEach(h,g=>we.forEach(g.$i,p=>u.persistence.referenceDelegate.addReference(m,g.targetId,p)).next(()=>we.forEach(g.Ui,p=>u.persistence.referenceDelegate.removeReference(m,g.targetId,p)))))}catch(m){if(!so(m))throw m;Me("LocalStore","Failed to update sequence numbers: "+m)}for(const m of h){const g=m.targetId;if(!m.fromCache){const p=u.os.get(g),j=p.snapshotVersion,_=p.withLastLimboFreeSnapshotVersion(j);u.os=u.os.insert(g,_)}}}(r.localStore,i))}async function S_(s,e){const t=Ye(s);if(!t.currentUser.isEqual(e)){Me("SyncEngine","User change. New user:",e.toKey());const r=await H0(t.localStore,e);t.currentUser=e,function(i,o){i.ka.forEach(l=>{l.forEach(c=>{c.reject(new Ie(be.CANCELLED,o))})}),i.ka.clear()}(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),await io(t,r.hs)}}function T_(s,e){const t=Ye(s),r=t.Na.get(e);if(r&&r.va)return tt().add(r.key);{let a=tt();const i=t.Ma.get(e);if(!i)return a;for(const o of i){const l=t.Fa.get(o);a=a.unionWith(l.view.Va)}return a}}function dx(s){const e=Ye(s);return e.remoteStore.remoteSyncer.applyRemoteEvent=ix.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=T_.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=__.bind(null,e),e.Ca.d_=h_.bind(null,e.eventManager),e.Ca.$a=u_.bind(null,e.eventManager),e}function I_(s){const e=Ye(s);return e.remoteStore.remoteSyncer.applySuccessfulWrite=N_.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=j_.bind(null,e),e}class _l{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=ac(e.databaseInfo.databaseId),this.sharedClientState=this.Wa(e),this.persistence=this.Ga(e),await this.persistence.start(),this.localStore=this.za(e),this.gcScheduler=this.ja(e,this.localStore),this.indexBackfillerScheduler=this.Ha(e,this.localStore)}ja(e,t){return null}Ha(e,t){return null}za(e){return R2(this.persistence,new M2,e.initialUser,this.serializer)}Ga(e){return new A2(Rh.Zr,this.serializer)}Wa(e){return new B2}async terminate(){var e,t;(e=this.gcScheduler)===null||e===void 0||e.stop(),(t=this.indexBackfillerScheduler)===null||t===void 0||t.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}_l.provider={build:()=>new _l};class Ud{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>mg(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=S_.bind(null,this.syncEngine),await l_(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return function(){return new d_}()}createDatastore(e){const t=ac(e.databaseInfo.databaseId),r=function(i){return new q2(i)}(e.databaseInfo);return function(i,o,l,c){return new Y2(i,o,l,c)}(e.authCredentials,e.appCheckCredentials,r,t)}createRemoteStore(e){return function(r,a,i,o,l){return new X2(r,a,i,o,l)}(this.localStore,this.datastore,e.asyncQueue,t=>mg(this.syncEngine,t,0),function(){return lg.D()?new lg:new z2}())}createSyncEngine(e,t){return function(a,i,o,l,c,h,u){const m=new p_(a,i,o,l,c,h);return u&&(m.Qa=!0),m}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){var e,t;await async function(a){const i=Ye(a);Me("RemoteStore","RemoteStore shutting down."),i.L_.add(5),await ao(i),i.k_.shutdown(),i.q_.set("Unknown")}(this.remoteStore),(e=this.datastore)===null||e===void 0||e.terminate(),(t=this.eventManager)===null||t===void 0||t.terminate()}}Ud.provider={build:()=>new Ud};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hx{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ya(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ya(this.observer.error,e):Mr("Uncaught Error in snapshot listener:",e.toString()))}Za(){this.muted=!0}Ya(e,t){setTimeout(()=>{this.muted||e(t)},0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class A_{constructor(e,t,r,a,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=a,this.user=is.UNAUTHENTICATED,this.clientId=h0.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(r,async o=>{Me("FirestoreClient","Received user=",o.uid),await this.authCredentialListener(o),this.user=o}),this.appCheckCredentials.start(r,o=>(Me("FirestoreClient","Received new app check token=",o),this.appCheckCredentialListener(o,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new Tr;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const r=Bh(t,"Failed to shutdown persistence");e.reject(r)}}),e.promise}}async function Xc(s,e){s.asyncQueue.verifyOperationInProgress(),Me("FirestoreClient","Initializing OfflineComponentProvider");const t=s.configuration;await e.initialize(t);let r=t.initialUser;s.setCredentialChangeListener(async a=>{r.isEqual(a)||(await H0(e.localStore,a),r=a)}),e.persistence.setDatabaseDeletedListener(()=>s.terminate()),s._offlineComponents=e}async function fg(s,e){s.asyncQueue.verifyOperationInProgress();const t=await C_(s);Me("FirestoreClient","Initializing OnlineComponentProvider"),await e.initialize(t,s.configuration),s.setCredentialChangeListener(r=>cg(e.remoteStore,r)),s.setAppCheckTokenChangeListener((r,a)=>cg(e.remoteStore,a)),s._onlineComponents=e}async function C_(s){if(!s._offlineComponents)if(s._uninitializedComponentsProvider){Me("FirestoreClient","Using user provided OfflineComponentProvider");try{await Xc(s,s._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!function(a){return a.name==="FirebaseError"?a.code===be.FAILED_PRECONDITION||a.code===be.UNIMPLEMENTED:!(typeof DOMException<"u"&&a instanceof DOMException)||a.code===22||a.code===20||a.code===11}(t))throw t;wa("Error using user provided cache. Falling back to memory cache: "+t),await Xc(s,new _l)}}else Me("FirestoreClient","Using default OfflineComponentProvider"),await Xc(s,new _l);return s._offlineComponents}async function ux(s){return s._onlineComponents||(s._uninitializedComponentsProvider?(Me("FirestoreClient","Using user provided OnlineComponentProvider"),await fg(s,s._uninitializedComponentsProvider._online)):(Me("FirestoreClient","Using default OnlineComponentProvider"),await fg(s,new Ud))),s._onlineComponents}function D_(s){return ux(s).then(e=>e.syncEngine)}async function mx(s){const e=await ux(s),t=e.eventManager;return t.onListen=x_.bind(null,e.syncEngine),t.onUnlisten=v_.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=b_.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=w_.bind(null,e.syncEngine),t}function M_(s,e,t={}){const r=new Tr;return s.asyncQueue.enqueueAndForget(async()=>function(i,o,l,c,h){const u=new hx({next:g=>{u.Za(),o.enqueueAndForget(()=>tx(i,m));const p=g.docs.has(l);!p&&g.fromCache?h.reject(new Ie(be.UNAVAILABLE,"Failed to get document because the client is offline.")):p&&g.fromCache&&c&&c.source==="server"?h.reject(new Ie(be.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):h.resolve(g)},error:g=>h.reject(g)}),m=new sx(Th(l.path),u,{includeMetadataChanges:!0,_a:!0});return ex(i,m)}(await mx(s),s.asyncQueue,e,t,r)),r.promise}function $_(s,e,t={}){const r=new Tr;return s.asyncQueue.enqueueAndForget(async()=>function(i,o,l,c,h){const u=new hx({next:g=>{u.Za(),o.enqueueAndForget(()=>tx(i,m)),g.fromCache&&c.source==="server"?h.reject(new Ie(be.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):h.resolve(g)},error:g=>h.reject(g)}),m=new sx(l,u,{includeMetadataChanges:!0,_a:!0});return ex(i,m)}(await mx(s),s.asyncQueue,e,t,r)),r.promise}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gx(s){const e={};return s.timeoutSeconds!==void 0&&(e.timeoutSeconds=s.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pg=new Map;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fx(s,e,t){if(!t)throw new Ie(be.INVALID_ARGUMENT,`Function ${s}() cannot be called with an empty ${e}.`)}function R_(s,e,t,r){if(e===!0&&r===!0)throw new Ie(be.INVALID_ARGUMENT,`${s} and ${t} cannot be used together.`)}function xg(s){if(!Fe.isDocumentKey(s))throw new Ie(be.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${s} has ${s.length}.`)}function bg(s){if(Fe.isDocumentKey(s))throw new Ie(be.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${s} has ${s.length}.`)}function lc(s){if(s===void 0)return"undefined";if(s===null)return"null";if(typeof s=="string")return s.length>20&&(s=`${s.substring(0,20)}...`),JSON.stringify(s);if(typeof s=="number"||typeof s=="boolean")return""+s;if(typeof s=="object"){if(s instanceof Array)return"an array";{const e=function(r){return r.constructor?r.constructor.name:null}(s);return e?`a custom ${e} object`:"an object"}}return typeof s=="function"?"a function":We()}function Rr(s,e){if("_delegate"in s&&(s=s._delegate),!(s instanceof e)){if(e.name===s.constructor.name)throw new Ie(be.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=lc(s);throw new Ie(be.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yg{constructor(e){var t,r;if(e.host===void 0){if(e.ssl!==void 0)throw new Ie(be.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=(t=e.ssl)===null||t===void 0||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new Ie(be.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}R_("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=gx((r=e.experimentalLongPollingOptions)!==null&&r!==void 0?r:{}),function(i){if(i.timeoutSeconds!==void 0){if(isNaN(i.timeoutSeconds))throw new Ie(be.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (must not be NaN)`);if(i.timeoutSeconds<5)throw new Ie(be.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (minimum allowed value is 5)`);if(i.timeoutSeconds>30)throw new Ie(be.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(r,a){return r.timeoutSeconds===a.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class cc{constructor(e,t,r,a){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=a,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new yg({}),this._settingsFrozen=!1,this._terminateTask="notTerminated"}get app(){if(!this._app)throw new Ie(be.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new Ie(be.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new yg(e),e.credentials!==void 0&&(this._authCredentials=function(r){if(!r)return new Z1;switch(r.type){case"firstParty":return new rk(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new Ie(be.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const r=pg.get(t);r&&(Me("ComponentProvider","Removing Datastore"),pg.delete(t),r.terminate())}(this),Promise.resolve()}}function P_(s,e,t,r={}){var a;const i=(s=Rr(s,cc))._getSettings(),o=`${e}:${t}`;if(i.host!=="firestore.googleapis.com"&&i.host!==o&&wa("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),s._setSettings(Object.assign(Object.assign({},i),{host:o,ssl:!1})),r.mockUserToken){let l,c;if(typeof r.mockUserToken=="string")l=r.mockUserToken,c=is.MOCK_USER;else{l=Jp(r.mockUserToken,(a=s._app)===null||a===void 0?void 0:a.options.projectId);const h=r.mockUserToken.sub||r.mockUserToken.user_id;if(!h)throw new Ie(be.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");c=new is(h)}s._authCredentials=new ek(new d0(l,c))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qn{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new Qn(this.firestore,e,this._query)}}class js{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new dn(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new js(this.firestore,e,this._key)}}class dn extends Qn{constructor(e,t,r){super(e,t,Th(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new js(this.firestore,null,new Fe(e))}withConverter(e){return new dn(this.firestore,e,this._path)}}function ut(s,e,...t){if(s=hs(s),fx("collection","path",e),s instanceof cc){const r=Et.fromString(e,...t);return bg(r),new dn(s,null,r)}{if(!(s instanceof js||s instanceof dn))throw new Ie(be.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=s._path.child(Et.fromString(e,...t));return bg(r),new dn(s.firestore,null,r)}}function bt(s,e,...t){if(s=hs(s),arguments.length===1&&(e=h0.newId()),fx("doc","path",e),s instanceof cc){const r=Et.fromString(e,...t);return xg(r),new js(s,null,new Fe(r))}{if(!(s instanceof js||s instanceof dn))throw new Ie(be.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=s._path.child(Et.fromString(e,...t));return xg(r),new js(s.firestore,s instanceof dn?s.converter:null,new Fe(r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vg{constructor(e=Promise.resolve()){this.Pu=[],this.Iu=!1,this.Tu=[],this.Eu=null,this.du=!1,this.Au=!1,this.Ru=[],this.t_=new q0(this,"async_queue_retry"),this.Vu=()=>{const r=Qc();r&&Me("AsyncQueue","Visibility state changed to "+r.visibilityState),this.t_.jo()},this.mu=e;const t=Qc();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this.Vu)}get isShuttingDown(){return this.Iu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.fu(),this.gu(e)}enterRestrictedMode(e){if(!this.Iu){this.Iu=!0,this.Au=e||!1;const t=Qc();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this.Vu)}}enqueue(e){if(this.fu(),this.Iu)return new Promise(()=>{});const t=new Tr;return this.gu(()=>this.Iu&&this.Au?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Pu.push(e),this.pu()))}async pu(){if(this.Pu.length!==0){try{await this.Pu[0](),this.Pu.shift(),this.t_.reset()}catch(e){if(!so(e))throw e;Me("AsyncQueue","Operation failed with retryable error: "+e)}this.Pu.length>0&&this.t_.Go(()=>this.pu())}}gu(e){const t=this.mu.then(()=>(this.du=!0,e().catch(r=>{this.Eu=r,this.du=!1;const a=function(o){let l=o.message||"";return o.stack&&(l=o.stack.includes(o.message)?o.stack:o.message+`
`+o.stack),l}(r);throw Mr("INTERNAL UNHANDLED ERROR: ",a),r}).then(r=>(this.du=!1,r))));return this.mu=t,t}enqueueAfterDelay(e,t,r){this.fu(),this.Ru.indexOf(e)>-1&&(t=0);const a=Uh.createAndSchedule(this,e,t,r,i=>this.yu(i));return this.Tu.push(a),a}fu(){this.Eu&&We()}verifyOperationInProgress(){}async wu(){let e;do e=this.mu,await e;while(e!==this.mu)}Su(e){for(const t of this.Tu)if(t.timerId===e)return!0;return!1}bu(e){return this.wu().then(()=>{this.Tu.sort((t,r)=>t.targetTimeMs-r.targetTimeMs);for(const t of this.Tu)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.wu()})}Du(e){this.Ru.push(e)}yu(e){const t=this.Tu.indexOf(e);this.Tu.splice(t,1)}}class La extends cc{constructor(e,t,r,a){super(e,t,r,a),this.type="firestore",this._queue=new vg,this._persistenceKey=(a==null?void 0:a.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new vg(e),this._firestoreClient=void 0,await e}}}function O_(s,e){const t=typeof s=="object"?s:vh(),r=typeof s=="string"?s:"(default)",a=Jl(t,"firestore").getImmediate({identifier:r});if(!a._initialized){const i=Yp("firestore");i&&P_(a,...i)}return a}function Wh(s){if(s._terminated)throw new Ie(be.FAILED_PRECONDITION,"The client has already been terminated.");return s._firestoreClient||L_(s),s._firestoreClient}function L_(s){var e,t,r;const a=s._freezeSettings(),i=function(l,c,h,u){return new pk(l,c,h,u.host,u.ssl,u.experimentalForceLongPolling,u.experimentalAutoDetectLongPolling,gx(u.experimentalLongPollingOptions),u.useFetchStreams)}(s._databaseId,((e=s._app)===null||e===void 0?void 0:e.options.appId)||"",s._persistenceKey,a);s._componentsProvider||!((t=a.localCache)===null||t===void 0)&&t._offlineComponentProvider&&(!((r=a.localCache)===null||r===void 0)&&r._onlineComponentProvider)&&(s._componentsProvider={_offline:a.localCache._offlineComponentProvider,_online:a.localCache._onlineComponentProvider}),s._firestoreClient=new A_(s._authCredentials,s._appCheckCredentials,s._queue,i,s._componentsProvider&&function(l){const c=l==null?void 0:l._online.build();return{_offline:l==null?void 0:l._offline.build(c),_online:c}}(s._componentsProvider))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sa{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Sa(ts.fromBase64String(e))}catch(t){throw new Ie(be.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new Sa(ts.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dc{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new Ie(be.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Zt(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qh{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gh{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new Ie(be.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new Ie(be.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return ht(this._lat,e._lat)||ht(this._long,e._long)}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kh{constructor(e){this._values=(e||[]).map(t=>t)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(r,a){if(r.length!==a.length)return!1;for(let i=0;i<r.length;++i)if(r[i]!==a[i])return!1;return!0}(this._values,e._values)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const V_=/^__.*__$/;class F_{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return this.fieldMask!==null?new yn(e,this.data,this.fieldMask,t,this.fieldTransforms):new ro(e,this.data,t,this.fieldTransforms)}}class px{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new yn(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function xx(s){switch(s){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw We()}}class Yh{constructor(e,t,r,a,i,o){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=a,i===void 0&&this.vu(),this.fieldTransforms=i||[],this.fieldMask=o||[]}get path(){return this.settings.path}get Cu(){return this.settings.Cu}Fu(e){return new Yh(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Mu(e){var t;const r=(t=this.path)===null||t===void 0?void 0:t.child(e),a=this.Fu({path:r,xu:!1});return a.Ou(e),a}Nu(e){var t;const r=(t=this.path)===null||t===void 0?void 0:t.child(e),a=this.Fu({path:r,xu:!1});return a.vu(),a}Lu(e){return this.Fu({path:void 0,xu:!0})}Bu(e){return Nl(e,this.settings.methodName,this.settings.ku||!1,this.path,this.settings.qu)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}vu(){if(this.path)for(let e=0;e<this.path.length;e++)this.Ou(this.path.get(e))}Ou(e){if(e.length===0)throw this.Bu("Document fields must not be empty");if(xx(this.Cu)&&V_.test(e))throw this.Bu('Document fields cannot begin and end with "__"')}}class U_{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||ac(e)}Qu(e,t,r,a=!1){return new Yh({Cu:e,methodName:t,qu:r,path:Zt.emptyPath(),xu:!1,ku:a},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function Qh(s){const e=s._freezeSettings(),t=ac(s._databaseId);return new U_(s._databaseId,!!e.ignoreUndefinedProperties,t)}function B_(s,e,t,r,a,i={}){const o=s.Qu(i.merge||i.mergeFields?2:0,e,t,a);Xh("Data must be an object, but it was:",o,r);const l=bx(r,o);let c,h;if(i.merge)c=new Ts(o.fieldMask),h=o.fieldTransforms;else if(i.mergeFields){const u=[];for(const m of i.mergeFields){const g=Bd(e,m,t);if(!o.contains(g))throw new Ie(be.INVALID_ARGUMENT,`Field '${g}' is specified in your field mask but missing from your input data.`);vx(u,g)||u.push(g)}c=new Ts(u),h=o.fieldTransforms.filter(m=>c.covers(m.field))}else c=null,h=o.fieldTransforms;return new F_(new _s(l),c,h)}class hc extends qh{_toFieldTransform(e){if(e.Cu!==2)throw e.Cu===1?e.Bu(`${this._methodName}() can only appear at the top level of your update data`):e.Bu(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof hc}}function z_(s,e,t,r){const a=s.Qu(1,e,t);Xh("Data must be an object, but it was:",a,r);const i=[],o=_s.empty();Kn(r,(c,h)=>{const u=Jh(e,c,t);h=hs(h);const m=a.Nu(u);if(h instanceof hc)i.push(u);else{const g=oo(h,m);g!=null&&(i.push(u),o.set(u,g))}});const l=new Ts(i);return new px(o,l,a.fieldTransforms)}function H_(s,e,t,r,a,i){const o=s.Qu(1,e,t),l=[Bd(e,r,t)],c=[a];if(i.length%2!=0)throw new Ie(be.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let g=0;g<i.length;g+=2)l.push(Bd(e,i[g])),c.push(i[g+1]);const h=[],u=_s.empty();for(let g=l.length-1;g>=0;--g)if(!vx(h,l[g])){const p=l[g];let j=c[g];j=hs(j);const _=o.Nu(p);if(j instanceof hc)h.push(p);else{const y=oo(j,_);y!=null&&(h.push(p),u.set(p,y))}}const m=new Ts(h);return new px(u,m,o.fieldTransforms)}function W_(s,e,t,r=!1){return oo(t,s.Qu(r?4:3,e))}function oo(s,e){if(yx(s=hs(s)))return Xh("Unsupported field value:",e,s),bx(s,e);if(s instanceof qh)return function(r,a){if(!xx(a.Cu))throw a.Bu(`${r._methodName}() can only be used with update() and set()`);if(!a.path)throw a.Bu(`${r._methodName}() is not currently supported inside arrays`);const i=r._toFieldTransform(a);i&&a.fieldTransforms.push(i)}(s,e),null;if(s===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),s instanceof Array){if(e.settings.xu&&e.Cu!==4)throw e.Bu("Nested arrays are not supported");return function(r,a){const i=[];let o=0;for(const l of r){let c=oo(l,a.Lu(o));c==null&&(c={nullValue:"NULL_VALUE"}),i.push(c),o++}return{arrayValue:{values:i}}}(s,e)}return function(r,a){if((r=hs(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return Lk(a.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){const i=zt.fromDate(r);return{timestampValue:wl(a.serializer,i)}}if(r instanceof zt){const i=new zt(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:wl(a.serializer,i)}}if(r instanceof Gh)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof Sa)return{bytesValue:O0(a.serializer,r._byteString)};if(r instanceof js){const i=a.databaseId,o=r.firestore._databaseId;if(!o.isEqual(i))throw a.Bu(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${i.projectId}/${i.database}`);return{referenceValue:Mh(r.firestore._databaseId||a.databaseId,r._key.path)}}if(r instanceof Kh)return function(o,l){return{mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{values:o.toArray().map(c=>{if(typeof c!="number")throw l.Bu("VectorValues must only contain numeric values.");return Ih(l.serializer,c)})}}}}}}(r,a);throw a.Bu(`Unsupported field value: ${lc(r)}`)}(s,e)}function bx(s,e){const t={};return u0(s)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Kn(s,(r,a)=>{const i=oo(a,e.Mu(r));i!=null&&(t[r]=i)}),{mapValue:{fields:t}}}function yx(s){return!(typeof s!="object"||s===null||s instanceof Array||s instanceof Date||s instanceof zt||s instanceof Gh||s instanceof Sa||s instanceof js||s instanceof qh||s instanceof Kh)}function Xh(s,e,t){if(!yx(t)||!function(a){return typeof a=="object"&&a!==null&&(Object.getPrototypeOf(a)===Object.prototype||Object.getPrototypeOf(a)===null)}(t)){const r=lc(t);throw r==="an object"?e.Bu(s+" a custom object"):e.Bu(s+" "+r)}}function Bd(s,e,t){if((e=hs(e))instanceof dc)return e._internalPath;if(typeof e=="string")return Jh(s,e);throw Nl("Field path arguments must be of type string or ",s,!1,void 0,t)}const q_=new RegExp("[~\\*/\\[\\]]");function Jh(s,e,t){if(e.search(q_)>=0)throw Nl(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,s,!1,void 0,t);try{return new dc(...e.split("."))._internalPath}catch{throw Nl(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,s,!1,void 0,t)}}function Nl(s,e,t,r,a){const i=r&&!r.isEmpty(),o=a!==void 0;let l=`Function ${e}() called with invalid data`;t&&(l+=" (via `toFirestore()`)"),l+=". ";let c="";return(i||o)&&(c+=" (found",i&&(c+=` in field ${r}`),o&&(c+=` in document ${a}`),c+=")"),new Ie(be.INVALID_ARGUMENT,l+s+c)}function vx(s,e){return s.some(t=>t.isEqual(e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wx{constructor(e,t,r,a,i){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=a,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new js(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new G_(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(uc("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}}class G_ extends wx{data(){return super.data()}}function uc(s,e){return typeof e=="string"?Jh(s,e):e instanceof dc?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function K_(s){if(s.limitType==="L"&&s.explicitOrderBy.length===0)throw new Ie(be.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class Zh{}class kx extends Zh{}function nt(s,e,...t){let r=[];e instanceof Zh&&r.push(e),r=r.concat(t),function(i){const o=i.filter(c=>c instanceof eu).length,l=i.filter(c=>c instanceof mc).length;if(o>1||o>0&&l>0)throw new Ie(be.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(const a of r)s=a._apply(s);return s}class mc extends kx{constructor(e,t,r){super(),this._field=e,this._op=t,this._value=r,this.type="where"}static _create(e,t,r){return new mc(e,t,r)}_apply(e){const t=this._parse(e);return _x(e._query,t),new Qn(e.firestore,e.converter,Dd(e._query,t))}_parse(e){const t=Qh(e.firestore);return function(i,o,l,c,h,u,m){let g;if(h.isKeyField()){if(u==="array-contains"||u==="array-contains-any")throw new Ie(be.INVALID_ARGUMENT,`Invalid Query. You can't perform '${u}' queries on documentId().`);if(u==="in"||u==="not-in"){kg(m,u);const p=[];for(const j of m)p.push(wg(c,i,j));g={arrayValue:{values:p}}}else g=wg(c,i,m)}else u!=="in"&&u!=="not-in"&&u!=="array-contains-any"||kg(m,u),g=W_(l,o,m,u==="in"||u==="not-in");return Vt.create(h,u,g)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}}function $t(s,e,t){const r=e,a=uc("where",s);return mc._create(a,r,t)}class eu extends Zh{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new eu(e,t)}_parse(e){const t=this._queryConstraints.map(r=>r._parse(e)).filter(r=>r.getFilters().length>0);return t.length===1?t[0]:Gs.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return t.getFilters().length===0?e:(function(a,i){let o=a;const l=i.getFlattenedFilters();for(const c of l)_x(o,c),o=Dd(o,c)}(e._query,t),new Qn(e.firestore,e.converter,Dd(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}class tu extends kx{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new tu(e,t)}_apply(e){const t=function(a,i,o){if(a.startAt!==null)throw new Ie(be.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(a.endAt!==null)throw new Ie(be.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new Oi(i,o)}(e._query,this._field,this._direction);return new Qn(e.firestore,e.converter,function(a,i){const o=a.explicitOrderBy.concat([i]);return new Ra(a.path,a.collectionGroup,o,a.filters.slice(),a.limit,a.limitType,a.startAt,a.endAt)}(e._query,t))}}function Pr(s,e="asc"){const t=e,r=uc("orderBy",s);return tu._create(r,t)}function wg(s,e,t){if(typeof(t=hs(t))=="string"){if(t==="")throw new Ie(be.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!w0(e)&&t.indexOf("/")!==-1)throw new Ie(be.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);const r=e.path.child(Et.fromString(t));if(!Fe.isDocumentKey(r))throw new Ie(be.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return zm(s,new Fe(r))}if(t instanceof js)return zm(s,t._key);throw new Ie(be.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${lc(t)}.`)}function kg(s,e){if(!Array.isArray(s)||s.length===0)throw new Ie(be.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function _x(s,e){const t=function(a,i){for(const o of a)for(const l of o.getFlattenedFilters())if(i.indexOf(l.op)>=0)return l.op;return null}(s.filters,function(a){switch(a){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(t!==null)throw t===e.op?new Ie(be.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new Ie(be.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}class Y_{convertValue(e,t="none"){switch(Bn(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Rt(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Un(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw We()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const r={};return Kn(e,(a,i)=>{r[a]=this.convertValue(i,t)}),r}convertVectorValue(e){var t,r,a;const i=(a=(r=(t=e.fields)===null||t===void 0?void 0:t.value.arrayValue)===null||r===void 0?void 0:r.values)===null||a===void 0?void 0:a.map(o=>Rt(o.doubleValue));return new Kh(i)}convertGeoPoint(e){return new Gh(Rt(e.latitude),Rt(e.longitude))}convertArray(e,t){return(e.values||[]).map(r=>this.convertValue(r,t))}convertServerTimestamp(e,t){switch(t){case"previous":const r=Nh(e);return r==null?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp($i(e));default:return null}}convertTimestamp(e){const t=fn(e);return new zt(t.seconds,t.nanos)}convertDocumentKey(e,t){const r=Et.fromString(e);xt(z0(r));const a=new Ri(r.get(1),r.get(3)),i=new Fe(r.popFirst(5));return a.isEqual(t)||Mr(`Document ${i} contains a document reference within a different database (${a.projectId}/${a.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Q_(s,e,t){let r;return r=s?s.toFirestore(e):e,r}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class di{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class Nx extends wx{constructor(e,t,r,a,i,o){super(e,t,r,a,o),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new tl(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const r=this._document.data.field(uc("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}}class tl extends Nx{data(e={}){return super.data(e)}}class X_{constructor(e,t,r,a){this._firestore=e,this._userDataWriter=t,this._snapshot=a,this.metadata=new di(a.hasPendingWrites,a.fromCache),this.query=r}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new tl(this._firestore,this._userDataWriter,r.key,r,new di(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new Ie(be.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(a,i){if(a._snapshot.oldDocs.isEmpty()){let o=0;return a._snapshot.docChanges.map(l=>{const c=new tl(a._firestore,a._userDataWriter,l.doc.key,l.doc,new di(a._snapshot.mutatedKeys.has(l.doc.key),a._snapshot.fromCache),a.query.converter);return l.doc,{type:"added",doc:c,oldIndex:-1,newIndex:o++}})}{let o=a._snapshot.oldDocs;return a._snapshot.docChanges.filter(l=>i||l.type!==3).map(l=>{const c=new tl(a._firestore,a._userDataWriter,l.doc.key,l.doc,new di(a._snapshot.mutatedKeys.has(l.doc.key),a._snapshot.fromCache),a.query.converter);let h=-1,u=-1;return l.type!==0&&(h=o.indexOf(l.doc.key),o=o.delete(l.doc.key)),l.type!==1&&(o=o.add(l.doc),u=o.indexOf(l.doc.key)),{type:J_(l.type),doc:c,oldIndex:h,newIndex:u}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function J_(s){switch(s){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return We()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jx(s){s=Rr(s,js);const e=Rr(s.firestore,La);return M_(Wh(e),s._key).then(t=>Z_(e,s,t))}class Ex extends Y_{constructor(e){super(),this.firestore=e}convertBytes(e){return new Sa(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new js(this.firestore,null,t)}}function Kt(s){s=Rr(s,Qn);const e=Rr(s.firestore,La),t=Wh(e),r=new Ex(e);return K_(s._query),$_(t,s._query).then(a=>new X_(e,r,s,a))}function bs(s,e,t,...r){s=Rr(s,js);const a=Rr(s.firestore,La),i=Qh(a);let o;return o=typeof(e=hs(e))=="string"||e instanceof dc?H_(i,"updateDoc",s._key,e,t,r):z_(i,"updateDoc",s._key,e),su(a,[o.toMutation(s._key,qs.exists(!0))])}function As(s){return su(Rr(s.firestore,La),[new Ah(s._key,qs.none())])}function Es(s,e){const t=Rr(s.firestore,La),r=bt(s),a=Q_(s.converter,e);return su(t,[B_(Qh(s.firestore),"addDoc",r._key,a,s.converter!==null,{}).toMutation(r._key,qs.exists(!1))]).then(()=>r)}function su(s,e){return function(r,a){const i=new Tr;return r.asyncQueue.enqueueAndForget(async()=>k_(await D_(r),a,i)),i.promise}(Wh(s),e)}function Z_(s,e,t){const r=t.docs.get(e._key),a=new Ex(s);return new Nx(s,a,e._key,r,new di(t.hasPendingWrites,t.fromCache),e.converter)}(function(e,t=!0){(function(a){$a=a})(Gn),Vn(new mn("firestore",(r,{instanceIdentifier:a,options:i})=>{const o=r.getProvider("app").getImmediate(),l=new La(new tk(r.getProvider("auth-internal")),new ak(r.getProvider("app-check-internal")),function(h,u){if(!Object.prototype.hasOwnProperty.apply(h.options,["projectId"]))throw new Ie(be.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Ri(h.options.projectId,u)}(o,a),o);return i=Object.assign({useFetchStreams:t},i),l._setSettings(i),l},"PUBLIC").setMultipleInstances(!0)),tr(Lm,"4.7.3",e),tr(Lm,"4.7.3","esm2017")})();var eN="firebase",tN="10.14.1";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */tr(eN,tN,"app");function ru(s,e){var t={};for(var r in s)Object.prototype.hasOwnProperty.call(s,r)&&e.indexOf(r)<0&&(t[r]=s[r]);if(s!=null&&typeof Object.getOwnPropertySymbols=="function")for(var a=0,r=Object.getOwnPropertySymbols(s);a<r.length;a++)e.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(s,r[a])&&(t[r[a]]=s[r[a]]);return t}function Sx(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const sN=Sx,Tx=new Zi("auth","Firebase",Sx());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jl=new bh("@firebase/auth");function rN(s,...e){jl.logLevel<=rt.WARN&&jl.warn(`Auth (${Gn}): ${s}`,...e)}function sl(s,...e){jl.logLevel<=rt.ERROR&&jl.error(`Auth (${Gn}): ${s}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Or(s,...e){throw nu(s,...e)}function nr(s,...e){return nu(s,...e)}function Ix(s,e,t){const r=Object.assign(Object.assign({},sN()),{[e]:t});return new Zi("auth","Firebase",r).create(e,{appName:s.name})}function On(s){return Ix(s,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function nu(s,...e){if(typeof s!="string"){const t=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=s.name),s._errorFactory.create(t,...r)}return Tx.create(s,...e)}function He(s,e,...t){if(!s)throw nu(e,...t)}function Nr(s){const e="INTERNAL ASSERTION FAILED: "+s;throw sl(e),new Error(e)}function Lr(s,e){s||Nr(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zd(){var s;return typeof self<"u"&&((s=self.location)===null||s===void 0?void 0:s.href)||""}function nN(){return _g()==="http:"||_g()==="https:"}function _g(){var s;return typeof self<"u"&&((s=self.location)===null||s===void 0?void 0:s.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function aN(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(nN()||Mw()||"connection"in navigator)?navigator.onLine:!0}function iN(){if(typeof navigator>"u")return null;const s=navigator;return s.languages&&s.languages[0]||s.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lo{constructor(e,t){this.shortDelay=e,this.longDelay=t,Lr(t>e,"Short delay should be less than long delay!"),this.isMobile=Aw()||$w()}get(){return aN()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function au(s,e){Lr(s.emulator,"Emulator should always be set here");const{url:t}=s.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ax{static initialize(e,t,r){this.fetchImpl=e,t&&(this.headersImpl=t),r&&(this.responseImpl=r)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;Nr("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;Nr("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;Nr("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const oN={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lN=new lo(3e4,6e4);function iu(s,e){return s.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:s.tenantId}):e}async function Va(s,e,t,r,a={}){return Cx(s,a,async()=>{let i={},o={};r&&(e==="GET"?o=r:i={body:JSON.stringify(r)});const l=eo(Object.assign({key:s.config.apiKey},o)).slice(1),c=await s._getAdditionalHeaders();c["Content-Type"]="application/json",s.languageCode&&(c["X-Firebase-Locale"]=s.languageCode);const h=Object.assign({method:e,headers:c},i);return Dw()||(h.referrerPolicy="no-referrer"),Ax.fetch()(Dx(s,s.config.apiHost,t,l),h)})}async function Cx(s,e,t){s._canInitEmulator=!1;const r=Object.assign(Object.assign({},oN),e);try{const a=new dN(s),i=await Promise.race([t(),a.promise]);a.clearNetworkTimeout();const o=await i.json();if("needConfirmation"in o)throw Co(s,"account-exists-with-different-credential",o);if(i.ok&&!("errorMessage"in o))return o;{const l=i.ok?o.errorMessage:o.error.message,[c,h]=l.split(" : ");if(c==="FEDERATED_USER_ID_ALREADY_LINKED")throw Co(s,"credential-already-in-use",o);if(c==="EMAIL_EXISTS")throw Co(s,"email-already-in-use",o);if(c==="USER_DISABLED")throw Co(s,"user-disabled",o);const u=r[c]||c.toLowerCase().replace(/[_\s]+/g,"-");if(h)throw Ix(s,u,h);Or(s,u)}}catch(a){if(a instanceof dr)throw a;Or(s,"network-request-failed",{message:String(a)})}}async function cN(s,e,t,r,a={}){const i=await Va(s,e,t,r,a);return"mfaPendingCredential"in i&&Or(s,"multi-factor-auth-required",{_serverResponse:i}),i}function Dx(s,e,t,r){const a=`${e}${t}?${r}`;return s.config.emulator?au(s.config,a):`${s.config.apiScheme}://${a}`}class dN{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,r)=>{this.timer=setTimeout(()=>r(nr(this.auth,"network-request-failed")),lN.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function Co(s,e,t){const r={appName:s.name};t.email&&(r.email=t.email),t.phoneNumber&&(r.phoneNumber=t.phoneNumber);const a=nr(s,e,r);return a.customData._tokenResponse=t,a}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function hN(s,e){return Va(s,"POST","/v1/accounts:delete",e)}async function Mx(s,e){return Va(s,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vi(s){if(s)try{const e=new Date(Number(s));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function uN(s,e=!1){const t=hs(s),r=await t.getIdToken(e),a=ou(r);He(a&&a.exp&&a.auth_time&&a.iat,t.auth,"internal-error");const i=typeof a.firebase=="object"?a.firebase:void 0,o=i==null?void 0:i.sign_in_provider;return{claims:a,token:r,authTime:vi(Jc(a.auth_time)),issuedAtTime:vi(Jc(a.iat)),expirationTime:vi(Jc(a.exp)),signInProvider:o||null,signInSecondFactor:(i==null?void 0:i.sign_in_second_factor)||null}}function Jc(s){return Number(s)*1e3}function ou(s){const[e,t,r]=s.split(".");if(e===void 0||t===void 0||r===void 0)return sl("JWT malformed, contained fewer than 3 sections"),null;try{const a=Gp(t);return a?JSON.parse(a):(sl("Failed to decode base64 JWT payload"),null)}catch(a){return sl("Caught error parsing JWT payload as JSON",a==null?void 0:a.toString()),null}}function Ng(s){const e=ou(s);return He(e,"internal-error"),He(typeof e.exp<"u","internal-error"),He(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Fi(s,e,t=!1){if(t)return e;try{return await e}catch(r){throw r instanceof dr&&mN(r)&&s.auth.currentUser===s&&await s.auth.signOut(),r}}function mN({code:s}){return s==="auth/user-disabled"||s==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gN{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){const r=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),r}else{this.errorBackoff=3e4;const a=((t=this.user.stsTokenManager.expirationTime)!==null&&t!==void 0?t:0)-Date.now()-3e5;return Math.max(0,a)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(e==null?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hd{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=vi(this.lastLoginAt),this.creationTime=vi(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function El(s){var e;const t=s.auth,r=await s.getIdToken(),a=await Fi(s,Mx(t,{idToken:r}));He(a==null?void 0:a.users.length,t,"internal-error");const i=a.users[0];s._notifyReloadListener(i);const o=!((e=i.providerUserInfo)===null||e===void 0)&&e.length?$x(i.providerUserInfo):[],l=pN(s.providerData,o),c=s.isAnonymous,h=!(s.email&&i.passwordHash)&&!(l!=null&&l.length),u=c?h:!1,m={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:l,metadata:new Hd(i.createdAt,i.lastLoginAt),isAnonymous:u};Object.assign(s,m)}async function fN(s){const e=hs(s);await El(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function pN(s,e){return[...s.filter(r=>!e.some(a=>a.providerId===r.providerId)),...e]}function $x(s){return s.map(e=>{var{providerId:t}=e,r=ru(e,["providerId"]);return{providerId:t,uid:r.rawId||"",displayName:r.displayName||null,email:r.email||null,phoneNumber:r.phoneNumber||null,photoURL:r.photoUrl||null}})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function xN(s,e){const t=await Cx(s,{},async()=>{const r=eo({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:a,apiKey:i}=s.config,o=Dx(s,a,"/v1/token",`key=${i}`),l=await s._getAdditionalHeaders();return l["Content-Type"]="application/x-www-form-urlencoded",Ax.fetch()(o,{method:"POST",headers:l,body:r})});return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}}async function bN(s,e){return Va(s,"POST","/v2/accounts:revokeToken",iu(s,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ma{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){He(e.idToken,"internal-error"),He(typeof e.idToken<"u","internal-error"),He(typeof e.refreshToken<"u","internal-error");const t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):Ng(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){He(e.length!==0,"internal-error");const t=Ng(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return!t&&this.accessToken&&!this.isExpired?this.accessToken:(He(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:r,refreshToken:a,expiresIn:i}=await xN(e,t);this.updateTokensAndExpiration(r,a,Number(i))}updateTokensAndExpiration(e,t,r){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+r*1e3}static fromJSON(e,t){const{refreshToken:r,accessToken:a,expirationTime:i}=t,o=new ma;return r&&(He(typeof r=="string","internal-error",{appName:e}),o.refreshToken=r),a&&(He(typeof a=="string","internal-error",{appName:e}),o.accessToken=a),i&&(He(typeof i=="number","internal-error",{appName:e}),o.expirationTime=i),o}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new ma,this.toJSON())}_performRefresh(){return Nr("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Wr(s,e){He(typeof s=="string"||typeof s>"u","internal-error",{appName:e})}class jr{constructor(e){var{uid:t,auth:r,stsTokenManager:a}=e,i=ru(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new gN(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=r,this.stsTokenManager=a,this.accessToken=a.accessToken,this.displayName=i.displayName||null,this.email=i.email||null,this.emailVerified=i.emailVerified||!1,this.phoneNumber=i.phoneNumber||null,this.photoURL=i.photoURL||null,this.isAnonymous=i.isAnonymous||!1,this.tenantId=i.tenantId||null,this.providerData=i.providerData?[...i.providerData]:[],this.metadata=new Hd(i.createdAt||void 0,i.lastLoginAt||void 0)}async getIdToken(e){const t=await Fi(this,this.stsTokenManager.getToken(this.auth,e));return He(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return uN(this,e)}reload(){return fN(this)}_assign(e){this!==e&&(He(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>Object.assign({},t)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new jr(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){He(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),t&&await El(this),await this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(tn(this.auth.app))return Promise.reject(On(this.auth));const e=await this.getIdToken();return await Fi(this,hN(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var r,a,i,o,l,c,h,u;const m=(r=t.displayName)!==null&&r!==void 0?r:void 0,g=(a=t.email)!==null&&a!==void 0?a:void 0,p=(i=t.phoneNumber)!==null&&i!==void 0?i:void 0,j=(o=t.photoURL)!==null&&o!==void 0?o:void 0,_=(l=t.tenantId)!==null&&l!==void 0?l:void 0,y=(c=t._redirectEventId)!==null&&c!==void 0?c:void 0,M=(h=t.createdAt)!==null&&h!==void 0?h:void 0,D=(u=t.lastLoginAt)!==null&&u!==void 0?u:void 0,{uid:T,emailVerified:R,isAnonymous:P,providerData:C,stsTokenManager:N}=t;He(T&&N,e,"internal-error");const b=ma.fromJSON(this.name,N);He(typeof T=="string",e,"internal-error"),Wr(m,e.name),Wr(g,e.name),He(typeof R=="boolean",e,"internal-error"),He(typeof P=="boolean",e,"internal-error"),Wr(p,e.name),Wr(j,e.name),Wr(_,e.name),Wr(y,e.name),Wr(M,e.name),Wr(D,e.name);const v=new jr({uid:T,auth:e,email:g,emailVerified:R,displayName:m,isAnonymous:P,photoURL:j,phoneNumber:p,tenantId:_,stsTokenManager:b,createdAt:M,lastLoginAt:D});return C&&Array.isArray(C)&&(v.providerData=C.map(S=>Object.assign({},S))),y&&(v._redirectEventId=y),v}static async _fromIdTokenResponse(e,t,r=!1){const a=new ma;a.updateFromServerResponse(t);const i=new jr({uid:t.localId,auth:e,stsTokenManager:a,isAnonymous:r});return await El(i),i}static async _fromGetAccountInfoResponse(e,t,r){const a=t.users[0];He(a.localId!==void 0,"internal-error");const i=a.providerUserInfo!==void 0?$x(a.providerUserInfo):[],o=!(a.email&&a.passwordHash)&&!(i!=null&&i.length),l=new ma;l.updateFromIdToken(r);const c=new jr({uid:a.localId,auth:e,stsTokenManager:l,isAnonymous:o}),h={uid:a.localId,displayName:a.displayName||null,photoURL:a.photoUrl||null,email:a.email||null,emailVerified:a.emailVerified||!1,phoneNumber:a.phoneNumber||null,tenantId:a.tenantId||null,providerData:i,metadata:new Hd(a.createdAt,a.lastLoginAt),isAnonymous:!(a.email&&a.passwordHash)&&!(i!=null&&i.length)};return Object.assign(c,h),c}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jg=new Map;function Er(s){Lr(s instanceof Function,"Expected a class definition");let e=jg.get(s);return e?(Lr(e instanceof s,"Instance stored in cache mismatched with class"),e):(e=new s,jg.set(s,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rx{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return t===void 0?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}Rx.type="NONE";const Eg=Rx;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rl(s,e,t){return`firebase:${s}:${e}:${t}`}class ga{constructor(e,t,r){this.persistence=e,this.auth=t,this.userKey=r;const{config:a,name:i}=this.auth;this.fullUserKey=rl(this.userKey,a.apiKey,i),this.fullPersistenceKey=rl("persistence",a.apiKey,i),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);return e?jr._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,r="authUser"){if(!t.length)return new ga(Er(Eg),e,r);const a=(await Promise.all(t.map(async h=>{if(await h._isAvailable())return h}))).filter(h=>h);let i=a[0]||Er(Eg);const o=rl(r,e.config.apiKey,e.name);let l=null;for(const h of t)try{const u=await h._get(o);if(u){const m=jr._fromJSON(e,u);h!==i&&(l=m),i=h;break}}catch{}const c=a.filter(h=>h._shouldAllowMigration);return!i._shouldAllowMigration||!c.length?new ga(i,e,r):(i=c[0],l&&await i._set(o,l.toJSON()),await Promise.all(t.map(async h=>{if(h!==i)try{await h._remove(o)}catch{}})),new ga(i,e,r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Sg(s){const e=s.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(Vx(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(Px(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(Ux(e))return"Blackberry";if(Bx(e))return"Webos";if(Ox(e))return"Safari";if((e.includes("chrome/")||Lx(e))&&!e.includes("edge/"))return"Chrome";if(Fx(e))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=s.match(t);if((r==null?void 0:r.length)===2)return r[1]}return"Other"}function Px(s=ds()){return/firefox\//i.test(s)}function Ox(s=ds()){const e=s.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function Lx(s=ds()){return/crios\//i.test(s)}function Vx(s=ds()){return/iemobile/i.test(s)}function Fx(s=ds()){return/android/i.test(s)}function Ux(s=ds()){return/blackberry/i.test(s)}function Bx(s=ds()){return/webos/i.test(s)}function lu(s=ds()){return/iphone|ipad|ipod/i.test(s)||/macintosh/i.test(s)&&/mobile/i.test(s)}function yN(s=ds()){var e;return lu(s)&&!!(!((e=window.navigator)===null||e===void 0)&&e.standalone)}function vN(){return Rw()&&document.documentMode===10}function zx(s=ds()){return lu(s)||Fx(s)||Bx(s)||Ux(s)||/windows phone/i.test(s)||Vx(s)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Hx(s,e=[]){let t;switch(s){case"Browser":t=Sg(ds());break;case"Worker":t=`${Sg(ds())}-${s}`;break;default:t=s}const r=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${Gn}/${r}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wN{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const r=i=>new Promise((o,l)=>{try{const c=e(i);o(c)}catch(c){l(c)}});r.onAbort=t,this.queue.push(r);const a=this.queue.length-1;return()=>{this.queue[a]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const r of this.queue)await r(e),r.onAbort&&t.push(r.onAbort)}catch(r){t.reverse();for(const a of t)try{a()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:r==null?void 0:r.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function kN(s,e={}){return Va(s,"GET","/v2/passwordPolicy",iu(s,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _N=6;class NN{constructor(e){var t,r,a,i;const o=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(t=o.minPasswordLength)!==null&&t!==void 0?t:_N,o.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=o.maxPasswordLength),o.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=o.containsLowercaseCharacter),o.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=o.containsUppercaseCharacter),o.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=o.containsNumericCharacter),o.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=o.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(a=(r=e.allowedNonAlphanumericCharacters)===null||r===void 0?void 0:r.join(""))!==null&&a!==void 0?a:"",this.forceUpgradeOnSignin=(i=e.forceUpgradeOnSignin)!==null&&i!==void 0?i:!1,this.schemaVersion=e.schemaVersion}validatePassword(e){var t,r,a,i,o,l;const c={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,c),this.validatePasswordCharacterOptions(e,c),c.isValid&&(c.isValid=(t=c.meetsMinPasswordLength)!==null&&t!==void 0?t:!0),c.isValid&&(c.isValid=(r=c.meetsMaxPasswordLength)!==null&&r!==void 0?r:!0),c.isValid&&(c.isValid=(a=c.containsLowercaseLetter)!==null&&a!==void 0?a:!0),c.isValid&&(c.isValid=(i=c.containsUppercaseLetter)!==null&&i!==void 0?i:!0),c.isValid&&(c.isValid=(o=c.containsNumericCharacter)!==null&&o!==void 0?o:!0),c.isValid&&(c.isValid=(l=c.containsNonAlphanumericCharacter)!==null&&l!==void 0?l:!0),c}validatePasswordLengthOptions(e,t){const r=this.customStrengthOptions.minPasswordLength,a=this.customStrengthOptions.maxPasswordLength;r&&(t.meetsMinPasswordLength=e.length>=r),a&&(t.meetsMaxPasswordLength=e.length<=a)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let r;for(let a=0;a<e.length;a++)r=e.charAt(a),this.updatePasswordCharacterOptionsStatuses(t,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,t,r,a,i){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=a)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jN{constructor(e,t,r,a){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=r,this.config=a,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Tg(this),this.idTokenSubscription=new Tg(this),this.beforeStateQueue=new wN(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=Tx,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=a.sdkClientVersion}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=Er(t)),this._initializationPromise=this.queue(async()=>{var r,a;if(!this._deleted&&(this.persistenceManager=await ga.create(this,e),!this._deleted)){if(!((r=this._popupRedirectResolver)===null||r===void 0)&&r._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(t),this.lastNotifiedUid=((a=this.currentUser)===null||a===void 0?void 0:a.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const t=await Mx(this,{idToken:e}),r=await jr._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(r)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var t;if(tn(this.app)){const o=this.app.settings.authIdToken;return o?new Promise(l=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(o).then(l,l))}):this.directlySetCurrentUser(null)}const r=await this.assertedPersistence.getCurrentUser();let a=r,i=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const o=(t=this.redirectUser)===null||t===void 0?void 0:t._redirectEventId,l=a==null?void 0:a._redirectEventId,c=await this.tryRedirectSignIn(e);(!o||o===l)&&(c!=null&&c.user)&&(a=c.user,i=!0)}if(!a)return this.directlySetCurrentUser(null);if(!a._redirectEventId){if(i)try{await this.beforeStateQueue.runMiddleware(a)}catch(o){a=r,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(o))}return a?this.reloadAndSetCurrentUserOrClear(a):this.directlySetCurrentUser(null)}return He(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===a._redirectEventId?this.directlySetCurrentUser(a):this.reloadAndSetCurrentUserOrClear(a)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await El(e)}catch(t){if((t==null?void 0:t.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=iN()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(tn(this.app))return Promise.reject(On(this));const t=e?hs(e):null;return t&&He(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&He(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return tn(this.app)?Promise.reject(On(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return tn(this.app)?Promise.reject(On(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(Er(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await kN(this),t=new NN(e);this.tenantId===null?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new Zi("auth","Firebase",e())}onAuthStateChanged(e,t,r){return this.registerStateListener(this.authStateSubscription,e,t,r)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,r){return this.registerStateListener(this.idTokenSubscription,e,t,r)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const r=this.onAuthStateChanged(()=>{r(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){const t=await this.currentUser.getIdToken(),r={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};this.tenantId!=null&&(r.tenantId=this.tenantId),await bN(this,r)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)===null||e===void 0?void 0:e.toJSON()}}async _setRedirectUser(e,t){const r=await this.getOrInitRedirectPersistenceManager(t);return e===null?r.removeCurrentUser():r.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&Er(e)||this._popupRedirectResolver;He(t,this,"argument-error"),this.redirectPersistenceManager=await ga.create(this,[Er(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,r;return this._isInitialized&&await this.queue(async()=>{}),((t=this._currentUser)===null||t===void 0?void 0:t._redirectEventId)===e?this._currentUser:((r=this.redirectUser)===null||r===void 0?void 0:r._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const r=(t=(e=this.currentUser)===null||e===void 0?void 0:e.uid)!==null&&t!==void 0?t:null;this.lastNotifiedUid!==r&&(this.lastNotifiedUid=r,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,r,a){if(this._deleted)return()=>{};const i=typeof t=="function"?t:t.next.bind(t);let o=!1;const l=this._isInitialized?Promise.resolve():this._initializationPromise;if(He(l,this,"internal-error"),l.then(()=>{o||i(this.currentUser)}),typeof t=="function"){const c=e.addObserver(t,r,a);return()=>{o=!0,c()}}else{const c=e.addObserver(t);return()=>{o=!0,c()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return He(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=Hx(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);const r=await((e=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getHeartbeatsHeader());r&&(t["X-Firebase-Client"]=r);const a=await this._getAppCheckToken();return a&&(t["X-Firebase-AppCheck"]=a),t}async _getAppCheckToken(){var e;const t=await((e=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getToken());return t!=null&&t.error&&rN(`Error while retrieving App Check token: ${t.error}`),t==null?void 0:t.token}}function cu(s){return hs(s)}class Tg{constructor(e){this.auth=e,this.observer=null,this.addObserver=zw(t=>this.observer=t)}get next(){return He(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let du={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function EN(s){du=s}function SN(s){return du.loadJS(s)}function TN(){return du.gapiScript}function IN(s){return`__${s}${Math.floor(Math.random()*1e6)}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function AN(s,e){const t=Jl(s,"auth");if(t.isInitialized()){const a=t.getImmediate(),i=t.getOptions();if(fl(i,e??{}))return a;Or(a,"already-initialized")}return t.initialize({options:e})}function CN(s,e){const t=(e==null?void 0:e.persistence)||[],r=(Array.isArray(t)?t:[t]).map(Er);e!=null&&e.errorMap&&s._updateErrorMap(e.errorMap),s._initializeWithPersistence(r,e==null?void 0:e.popupRedirectResolver)}function DN(s,e,t){const r=cu(s);He(r._canInitEmulator,r,"emulator-config-failed"),He(/^https?:\/\//.test(e),r,"invalid-emulator-scheme");const a=!1,i=Wx(e),{host:o,port:l}=MN(e),c=l===null?"":`:${l}`;r.config.emulator={url:`${i}//${o}${c}/`},r.settings.appVerificationDisabledForTesting=!0,r.emulatorConfig=Object.freeze({host:o,port:l,protocol:i.replace(":",""),options:Object.freeze({disableWarnings:a})}),$N()}function Wx(s){const e=s.indexOf(":");return e<0?"":s.substr(0,e+1)}function MN(s){const e=Wx(s),t=/(\/\/)?([^?#/]+)/.exec(s.substr(e.length));if(!t)return{host:"",port:null};const r=t[2].split("@").pop()||"",a=/^(\[[^\]]+\])(:|$)/.exec(r);if(a){const i=a[1];return{host:i,port:Ig(r.substr(i.length+1))}}else{const[i,o]=r.split(":");return{host:i,port:Ig(o)}}}function Ig(s){if(!s)return null;const e=Number(s);return isNaN(e)?null:e}function $N(){function s(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",s):s())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qx{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return Nr("not implemented")}_getIdTokenResponse(e){return Nr("not implemented")}_linkToIdToken(e,t){return Nr("not implemented")}_getReauthenticationResolver(e){return Nr("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function fa(s,e){return cN(s,"POST","/v1/accounts:signInWithIdp",iu(s,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const RN="http://localhost";class zn extends qx{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new zn(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):Or("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:a}=t,i=ru(t,["providerId","signInMethod"]);if(!r||!a)return null;const o=new zn(r,a);return o.idToken=i.idToken||void 0,o.accessToken=i.accessToken||void 0,o.secret=i.secret,o.nonce=i.nonce,o.pendingToken=i.pendingToken||null,o}_getIdTokenResponse(e){const t=this.buildRequest();return fa(e,t)}_linkToIdToken(e,t){const r=this.buildRequest();return r.idToken=t,fa(e,r)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,fa(e,t)}buildRequest(){const e={requestUri:RN,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=eo(t)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gx{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class co extends Gx{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qr extends co{constructor(){super("facebook.com")}static credential(e){return zn._fromParams({providerId:Qr.PROVIDER_ID,signInMethod:Qr.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Qr.credentialFromTaggedObject(e)}static credentialFromError(e){return Qr.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Qr.credential(e.oauthAccessToken)}catch{return null}}}Qr.FACEBOOK_SIGN_IN_METHOD="facebook.com";Qr.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xr extends co{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return zn._fromParams({providerId:Xr.PROVIDER_ID,signInMethod:Xr.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return Xr.credentialFromTaggedObject(e)}static credentialFromError(e){return Xr.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:r}=e;if(!t&&!r)return null;try{return Xr.credential(t,r)}catch{return null}}}Xr.GOOGLE_SIGN_IN_METHOD="google.com";Xr.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jr extends co{constructor(){super("github.com")}static credential(e){return zn._fromParams({providerId:Jr.PROVIDER_ID,signInMethod:Jr.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Jr.credentialFromTaggedObject(e)}static credentialFromError(e){return Jr.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Jr.credential(e.oauthAccessToken)}catch{return null}}}Jr.GITHUB_SIGN_IN_METHOD="github.com";Jr.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zr extends co{constructor(){super("twitter.com")}static credential(e,t){return zn._fromParams({providerId:Zr.PROVIDER_ID,signInMethod:Zr.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return Zr.credentialFromTaggedObject(e)}static credentialFromError(e){return Zr.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:r}=e;if(!t||!r)return null;try{return Zr.credential(t,r)}catch{return null}}}Zr.TWITTER_SIGN_IN_METHOD="twitter.com";Zr.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ta{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,r,a=!1){const i=await jr._fromIdTokenResponse(e,r,a),o=Ag(r);return new Ta({user:i,providerId:o,_tokenResponse:r,operationType:t})}static async _forOperation(e,t,r){await e._updateTokensIfNecessary(r,!0);const a=Ag(r);return new Ta({user:e,providerId:a,_tokenResponse:r,operationType:t})}}function Ag(s){return s.providerId?s.providerId:"phoneNumber"in s?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sl extends dr{constructor(e,t,r,a){var i;super(t.code,t.message),this.operationType=r,this.user=a,Object.setPrototypeOf(this,Sl.prototype),this.customData={appName:e.name,tenantId:(i=e.tenantId)!==null&&i!==void 0?i:void 0,_serverResponse:t.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,t,r,a){return new Sl(e,t,r,a)}}function Kx(s,e,t,r){return(e==="reauthenticate"?t._getReauthenticationResolver(s):t._getIdTokenResponse(s)).catch(i=>{throw i.code==="auth/multi-factor-auth-required"?Sl._fromErrorAndOperation(s,i,e,r):i})}async function PN(s,e,t=!1){const r=await Fi(s,e._linkToIdToken(s.auth,await s.getIdToken()),t);return Ta._forOperation(s,"link",r)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function ON(s,e,t=!1){const{auth:r}=s;if(tn(r.app))return Promise.reject(On(r));const a="reauthenticate";try{const i=await Fi(s,Kx(r,a,e,s),t);He(i.idToken,r,"internal-error");const o=ou(i.idToken);He(o,r,"internal-error");const{sub:l}=o;return He(s.uid===l,r,"user-mismatch"),Ta._forOperation(s,a,i)}catch(i){throw(i==null?void 0:i.code)==="auth/user-not-found"&&Or(r,"user-mismatch"),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function LN(s,e,t=!1){if(tn(s.app))return Promise.reject(On(s));const r="signIn",a=await Kx(s,r,e),i=await Ta._fromIdTokenResponse(s,r,a);return t||await s._updateCurrentUser(i.user),i}function VN(s,e,t,r){return hs(s).onIdTokenChanged(e,t,r)}function FN(s,e,t){return hs(s).beforeAuthStateChanged(e,t)}const Tl="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yx{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(Tl,"1"),this.storage.removeItem(Tl),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const UN=1e3,BN=10;class Qx extends Yx{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=zx(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const r=this.storage.getItem(t),a=this.localCache[t];r!==a&&e(t,a,r)}}onStorageEvent(e,t=!1){if(!e.key){this.forAllChangedKeys((o,l,c)=>{this.notifyListeners(o,c)});return}const r=e.key;t?this.detachListener():this.stopPolling();const a=()=>{const o=this.storage.getItem(r);!t&&this.localCache[r]===o||this.notifyListeners(r,o)},i=this.storage.getItem(r);vN()&&i!==e.newValue&&e.newValue!==e.oldValue?setTimeout(a,BN):a()}notifyListeners(e,t){this.localCache[e]=t;const r=this.listeners[e];if(r)for(const a of Array.from(r))a(t&&JSON.parse(t))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,r)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:r}),!0)})},UN)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}Qx.type="LOCAL";const zN=Qx;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xx extends Yx{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}Xx.type="SESSION";const Jx=Xx;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function HN(s){return Promise.all(s.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gc{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(a=>a.isListeningto(e));if(t)return t;const r=new gc(e);return this.receivers.push(r),r}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:r,eventType:a,data:i}=t.data,o=this.handlersMap[a];if(!(o!=null&&o.size))return;t.ports[0].postMessage({status:"ack",eventId:r,eventType:a});const l=Array.from(o).map(async h=>h(t.origin,i)),c=await HN(l);t.ports[0].postMessage({status:"done",eventId:r,eventType:a,response:c})}_subscribe(e,t){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),(!t||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}gc.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hu(s="",e=10){let t="";for(let r=0;r<e;r++)t+=Math.floor(Math.random()*10);return s+t}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class WN{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,r=50){const a=typeof MessageChannel<"u"?new MessageChannel:null;if(!a)throw new Error("connection_unavailable");let i,o;return new Promise((l,c)=>{const h=hu("",20);a.port1.start();const u=setTimeout(()=>{c(new Error("unsupported_event"))},r);o={messageChannel:a,onMessage(m){const g=m;if(g.data.eventId===h)switch(g.data.status){case"ack":clearTimeout(u),i=setTimeout(()=>{c(new Error("timeout"))},3e3);break;case"done":clearTimeout(i),l(g.data.response);break;default:clearTimeout(u),clearTimeout(i),c(new Error("invalid_response"));break}}},this.handlers.add(o),a.port1.addEventListener("message",o.onMessage),this.target.postMessage({eventType:e,eventId:h,data:t},[a.port2])}).finally(()=>{o&&this.removeMessageHandler(o)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ar(){return window}function qN(s){ar().location.href=s}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Zx(){return typeof ar().WorkerGlobalScope<"u"&&typeof ar().importScripts=="function"}async function GN(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function KN(){var s;return((s=navigator==null?void 0:navigator.serviceWorker)===null||s===void 0?void 0:s.controller)||null}function YN(){return Zx()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const eb="firebaseLocalStorageDb",QN=1,Il="firebaseLocalStorage",tb="fbase_key";class ho{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function fc(s,e){return s.transaction([Il],e?"readwrite":"readonly").objectStore(Il)}function XN(){const s=indexedDB.deleteDatabase(eb);return new ho(s).toPromise()}function Wd(){const s=indexedDB.open(eb,QN);return new Promise((e,t)=>{s.addEventListener("error",()=>{t(s.error)}),s.addEventListener("upgradeneeded",()=>{const r=s.result;try{r.createObjectStore(Il,{keyPath:tb})}catch(a){t(a)}}),s.addEventListener("success",async()=>{const r=s.result;r.objectStoreNames.contains(Il)?e(r):(r.close(),await XN(),e(await Wd()))})})}async function Cg(s,e,t){const r=fc(s,!0).put({[tb]:e,value:t});return new ho(r).toPromise()}async function JN(s,e){const t=fc(s,!1).get(e),r=await new ho(t).toPromise();return r===void 0?null:r.value}function Dg(s,e){const t=fc(s,!0).delete(e);return new ho(t).toPromise()}const ZN=800,ej=3;class sb{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await Wd(),this.db)}async _withRetries(e){let t=0;for(;;)try{const r=await this._openDb();return await e(r)}catch(r){if(t++>ej)throw r;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return Zx()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=gc._getInstance(YN()),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){var e,t;if(this.activeServiceWorker=await GN(),!this.activeServiceWorker)return;this.sender=new WN(this.activeServiceWorker);const r=await this.sender._send("ping",{},800);r&&!((e=r[0])===null||e===void 0)&&e.fulfilled&&!((t=r[0])===null||t===void 0)&&t.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||KN()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await Wd();return await Cg(e,Tl,"1"),await Dg(e,Tl),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(r=>Cg(r,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(r=>JN(r,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>Dg(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(a=>{const i=fc(a,!1).getAll();return new ho(i).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const t=[],r=new Set;if(e.length!==0)for(const{fbase_key:a,value:i}of e)r.add(a),JSON.stringify(this.localCache[a])!==JSON.stringify(i)&&(this.notifyListeners(a,i),t.push(a));for(const a of Object.keys(this.localCache))this.localCache[a]&&!r.has(a)&&(this.notifyListeners(a,null),t.push(a));return t}notifyListeners(e,t){this.localCache[e]=t;const r=this.listeners[e];if(r)for(const a of Array.from(r))a(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),ZN)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}sb.type="LOCAL";const tj=sb;new lo(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sj(s,e){return e?Er(e):(He(s._popupRedirectResolver,s,"argument-error"),s._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uu extends qx{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return fa(e,this._buildIdpRequest())}_linkToIdToken(e,t){return fa(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return fa(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function rj(s){return LN(s.auth,new uu(s),s.bypassAuthState)}function nj(s){const{auth:e,user:t}=s;return He(t,e,"internal-error"),ON(t,new uu(s),s.bypassAuthState)}async function aj(s){const{auth:e,user:t}=s;return He(t,e,"internal-error"),PN(t,new uu(s),s.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rb{constructor(e,t,r,a,i=!1){this.auth=e,this.resolver=r,this.user=a,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(r){this.reject(r)}})}async onAuthEvent(e){const{urlResponse:t,sessionId:r,postBody:a,tenantId:i,error:o,type:l}=e;if(o){this.reject(o);return}const c={auth:this.auth,requestUri:t,sessionId:r,tenantId:i||void 0,postBody:a||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(l)(c))}catch(h){this.reject(h)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return rj;case"linkViaPopup":case"linkViaRedirect":return aj;case"reauthViaPopup":case"reauthViaRedirect":return nj;default:Or(this.auth,"internal-error")}}resolve(e){Lr(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){Lr(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ij=new lo(2e3,1e4);class la extends rb{constructor(e,t,r,a,i){super(e,t,a,i),this.provider=r,this.authWindow=null,this.pollId=null,la.currentPopupAction&&la.currentPopupAction.cancel(),la.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return He(e,this.auth,"internal-error"),e}async onExecution(){Lr(this.filter.length===1,"Popup operations only handle one event");const e=hu();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(t=>{this.reject(t)}),this.resolver._isIframeWebStorageSupported(this.auth,t=>{t||this.reject(nr(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)===null||e===void 0?void 0:e.associatedEvent)||null}cancel(){this.reject(nr(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,la.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,r;if(!((r=(t=this.authWindow)===null||t===void 0?void 0:t.window)===null||r===void 0)&&r.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(nr(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,ij.get())};e()}}la.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const oj="pendingRedirect",nl=new Map;class lj extends rb{constructor(e,t,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,r),this.eventId=null}async execute(){let e=nl.get(this.auth._key());if(!e){try{const r=await cj(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(r)}catch(t){e=()=>Promise.reject(t)}nl.set(this.auth._key(),e)}return this.bypassAuthState||nl.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function cj(s,e){const t=uj(e),r=hj(s);if(!await r._isAvailable())return!1;const a=await r._get(t)==="true";return await r._remove(t),a}function dj(s,e){nl.set(s._key(),e)}function hj(s){return Er(s._redirectPersistence)}function uj(s){return rl(oj,s.config.apiKey,s.name)}async function mj(s,e,t=!1){if(tn(s.app))return Promise.reject(On(s));const r=cu(s),a=sj(r,e),o=await new lj(r,a,t).execute();return o&&!t&&(delete o.user._redirectEventId,await r._persistUserIfCurrent(o.user),await r._setRedirectUser(null,e)),o}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gj=10*60*1e3;class fj{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(t=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!pj(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var r;if(e.error&&!nb(e)){const a=((r=e.error.code)===null||r===void 0?void 0:r.split("auth/")[1])||"internal-error";t.onError(nr(this.auth,a))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const r=t.eventId===null||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=gj&&this.cachedEventUids.clear(),this.cachedEventUids.has(Mg(e))}saveEventToCache(e){this.cachedEventUids.add(Mg(e)),this.lastProcessedEventTime=Date.now()}}function Mg(s){return[s.type,s.eventId,s.sessionId,s.tenantId].filter(e=>e).join("-")}function nb({type:s,error:e}){return s==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function pj(s){switch(s.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return nb(s);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function xj(s,e={}){return Va(s,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bj=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,yj=/^https?/;async function vj(s){if(s.config.emulator)return;const{authorizedDomains:e}=await xj(s);for(const t of e)try{if(wj(t))return}catch{}Or(s,"unauthorized-domain")}function wj(s){const e=zd(),{protocol:t,hostname:r}=new URL(e);if(s.startsWith("chrome-extension://")){const o=new URL(s);return o.hostname===""&&r===""?t==="chrome-extension:"&&s.replace("chrome-extension://","")===e.replace("chrome-extension://",""):t==="chrome-extension:"&&o.hostname===r}if(!yj.test(t))return!1;if(bj.test(s))return r===s;const a=s.replace(/\./g,"\\.");return new RegExp("^(.+\\."+a+"|"+a+")$","i").test(r)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kj=new lo(3e4,6e4);function $g(){const s=ar().___jsl;if(s!=null&&s.H){for(const e of Object.keys(s.H))if(s.H[e].r=s.H[e].r||[],s.H[e].L=s.H[e].L||[],s.H[e].r=[...s.H[e].L],s.CP)for(let t=0;t<s.CP.length;t++)s.CP[t]=null}}function _j(s){return new Promise((e,t)=>{var r,a,i;function o(){$g(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{$g(),t(nr(s,"network-request-failed"))},timeout:kj.get()})}if(!((a=(r=ar().gapi)===null||r===void 0?void 0:r.iframes)===null||a===void 0)&&a.Iframe)e(gapi.iframes.getContext());else if(!((i=ar().gapi)===null||i===void 0)&&i.load)o();else{const l=IN("iframefcb");return ar()[l]=()=>{gapi.load?o():t(nr(s,"network-request-failed"))},SN(`${TN()}?onload=${l}`).catch(c=>t(c))}}).catch(e=>{throw al=null,e})}let al=null;function Nj(s){return al=al||_j(s),al}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jj=new lo(5e3,15e3),Ej="__/auth/iframe",Sj="emulator/auth/iframe",Tj={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},Ij=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function Aj(s){const e=s.config;He(e.authDomain,s,"auth-domain-config-required");const t=e.emulator?au(e,Sj):`https://${s.config.authDomain}/${Ej}`,r={apiKey:e.apiKey,appName:s.name,v:Gn},a=Ij.get(s.config.apiHost);a&&(r.eid=a);const i=s._getFrameworks();return i.length&&(r.fw=i.join(",")),`${t}?${eo(r).slice(1)}`}async function Cj(s){const e=await Nj(s),t=ar().gapi;return He(t,s,"internal-error"),e.open({where:document.body,url:Aj(s),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:Tj,dontclear:!0},r=>new Promise(async(a,i)=>{await r.restyle({setHideOnLeave:!1});const o=nr(s,"network-request-failed"),l=ar().setTimeout(()=>{i(o)},jj.get());function c(){ar().clearTimeout(l),a(r)}r.ping(c).then(c,()=>{i(o)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Dj={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},Mj=500,$j=600,Rj="_blank",Pj="http://localhost";class Rg{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function Oj(s,e,t,r=Mj,a=$j){const i=Math.max((window.screen.availHeight-a)/2,0).toString(),o=Math.max((window.screen.availWidth-r)/2,0).toString();let l="";const c=Object.assign(Object.assign({},Dj),{width:r.toString(),height:a.toString(),top:i,left:o}),h=ds().toLowerCase();t&&(l=Lx(h)?Rj:t),Px(h)&&(e=e||Pj,c.scrollbars="yes");const u=Object.entries(c).reduce((g,[p,j])=>`${g}${p}=${j},`,"");if(yN(h)&&l!=="_self")return Lj(e||"",l),new Rg(null);const m=window.open(e||"",l,u);He(m,s,"popup-blocked");try{m.focus()}catch{}return new Rg(m)}function Lj(s,e){const t=document.createElement("a");t.href=s,t.target=e;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),t.dispatchEvent(r)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Vj="__/auth/handler",Fj="emulator/auth/handler",Uj=encodeURIComponent("fac");async function Pg(s,e,t,r,a,i){He(s.config.authDomain,s,"auth-domain-config-required"),He(s.config.apiKey,s,"invalid-api-key");const o={apiKey:s.config.apiKey,appName:s.name,authType:t,redirectUrl:r,v:Gn,eventId:a};if(e instanceof Gx){e.setDefaultLanguage(s.languageCode),o.providerId=e.providerId||"",Bw(e.getCustomParameters())||(o.customParameters=JSON.stringify(e.getCustomParameters()));for(const[u,m]of Object.entries({}))o[u]=m}if(e instanceof co){const u=e.getScopes().filter(m=>m!=="");u.length>0&&(o.scopes=u.join(","))}s.tenantId&&(o.tid=s.tenantId);const l=o;for(const u of Object.keys(l))l[u]===void 0&&delete l[u];const c=await s._getAppCheckToken(),h=c?`#${Uj}=${encodeURIComponent(c)}`:"";return`${Bj(s)}?${eo(l).slice(1)}${h}`}function Bj({config:s}){return s.emulator?au(s,Fj):`https://${s.authDomain}/${Vj}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Zc="webStorageSupport";class zj{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=Jx,this._completeRedirectFn=mj,this._overrideRedirectResult=dj}async _openPopup(e,t,r,a){var i;Lr((i=this.eventManagers[e._key()])===null||i===void 0?void 0:i.manager,"_initialize() not called before _openPopup()");const o=await Pg(e,t,r,zd(),a);return Oj(e,o,hu())}async _openRedirect(e,t,r,a){await this._originValidation(e);const i=await Pg(e,t,r,zd(),a);return qN(i),new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:a,promise:i}=this.eventManagers[t];return a?Promise.resolve(a):(Lr(i,"If manager is not set, promise should be"),i)}const r=this.initAndGetManager(e);return this.eventManagers[t]={promise:r},r.catch(()=>{delete this.eventManagers[t]}),r}async initAndGetManager(e){const t=await Cj(e),r=new fj(e);return t.register("authEvent",a=>(He(a==null?void 0:a.authEvent,e,"invalid-auth-event"),{status:r.onEvent(a.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:r},this.iframes[e._key()]=t,r}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(Zc,{type:Zc},a=>{var i;const o=(i=a==null?void 0:a[0])===null||i===void 0?void 0:i[Zc];o!==void 0&&t(!!o),Or(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=vj(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return zx()||Ox()||lu()}}const Hj=zj;var Og="@firebase/auth",Lg="1.7.9";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wj{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)===null||e===void 0?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(r=>{e((r==null?void 0:r.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){He(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qj(s){switch(s){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function Gj(s){Vn(new mn("auth",(e,{options:t})=>{const r=e.getProvider("app").getImmediate(),a=e.getProvider("heartbeat"),i=e.getProvider("app-check-internal"),{apiKey:o,authDomain:l}=r.options;He(o&&!o.includes(":"),"invalid-api-key",{appName:r.name});const c={apiKey:o,authDomain:l,clientPlatform:s,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:Hx(s)},h=new jN(r,a,i,c);return CN(h,t),h},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,r)=>{e.getProvider("auth-internal").initialize()})),Vn(new mn("auth-internal",e=>{const t=cu(e.getProvider("auth").getImmediate());return(r=>new Wj(r))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),tr(Og,Lg,qj(s)),tr(Og,Lg,"esm2017")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Kj=5*60,Yj=Xp("authIdTokenMaxAge")||Kj;let Vg=null;const Qj=s=>async e=>{const t=e&&await e.getIdTokenResult(),r=t&&(new Date().getTime()-Date.parse(t.issuedAtTime))/1e3;if(r&&r>Yj)return;const a=t==null?void 0:t.token;Vg!==a&&(Vg=a,await fetch(s,{method:a?"POST":"DELETE",headers:a?{Authorization:`Bearer ${a}`}:{}}))};function Xj(s=vh()){const e=Jl(s,"auth");if(e.isInitialized())return e.getImmediate();const t=AN(s,{popupRedirectResolver:Hj,persistence:[tj,zN,Jx]}),r=Xp("authTokenSyncURL");if(r&&typeof isSecureContext=="boolean"&&isSecureContext){const i=new URL(r,location.origin);if(location.origin===i.origin){const o=Qj(i.toString());FN(t,o,()=>o(t.currentUser)),VN(t,l=>o(l))}}const a=Kp("auth");return a&&DN(t,`http://${a}`),t}function Jj(){var s,e;return(e=(s=document.getElementsByTagName("head"))===null||s===void 0?void 0:s[0])!==null&&e!==void 0?e:document}EN({loadJS(s){return new Promise((e,t)=>{const r=document.createElement("script");r.setAttribute("src",s),r.onload=e,r.onerror=a=>{const i=nr("internal-error");i.customData=a,t(i)},r.type="text/javascript",r.charset="UTF-8",Jj().appendChild(r)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});Gj("Browser");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ab="firebasestorage.googleapis.com",Zj="storageBucket",e4=2*60*1e3,t4=10*60*1e3;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hr extends dr{constructor(e,t,r=0){super(ed(e),`Firebase Storage: ${t} (${ed(e)})`),this.status_=r,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,hr.prototype)}get status(){return this.status_}set status(e){this.status_=e}_codeEquals(e){return ed(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message=`${this._baseMessage}
${this.customData.serverResponse}`:this.message=this._baseMessage}}var lr;(function(s){s.UNKNOWN="unknown",s.OBJECT_NOT_FOUND="object-not-found",s.BUCKET_NOT_FOUND="bucket-not-found",s.PROJECT_NOT_FOUND="project-not-found",s.QUOTA_EXCEEDED="quota-exceeded",s.UNAUTHENTICATED="unauthenticated",s.UNAUTHORIZED="unauthorized",s.UNAUTHORIZED_APP="unauthorized-app",s.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",s.INVALID_CHECKSUM="invalid-checksum",s.CANCELED="canceled",s.INVALID_EVENT_NAME="invalid-event-name",s.INVALID_URL="invalid-url",s.INVALID_DEFAULT_BUCKET="invalid-default-bucket",s.NO_DEFAULT_BUCKET="no-default-bucket",s.CANNOT_SLICE_BLOB="cannot-slice-blob",s.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",s.NO_DOWNLOAD_URL="no-download-url",s.INVALID_ARGUMENT="invalid-argument",s.INVALID_ARGUMENT_COUNT="invalid-argument-count",s.APP_DELETED="app-deleted",s.INVALID_ROOT_OPERATION="invalid-root-operation",s.INVALID_FORMAT="invalid-format",s.INTERNAL_ERROR="internal-error",s.UNSUPPORTED_ENVIRONMENT="unsupported-environment"})(lr||(lr={}));function ed(s){return"storage/"+s}function s4(){const s="An unknown error occurred, please check the error payload for server response.";return new hr(lr.UNKNOWN,s)}function r4(){return new hr(lr.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function n4(){return new hr(lr.CANCELED,"User canceled the upload/download.")}function a4(s){return new hr(lr.INVALID_URL,"Invalid URL '"+s+"'.")}function i4(s){return new hr(lr.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+s+"'.")}function Fg(s){return new hr(lr.INVALID_ARGUMENT,s)}function ib(){return new hr(lr.APP_DELETED,"The Firebase app was deleted.")}function o4(s){return new hr(lr.INVALID_ROOT_OPERATION,"The operation '"+s+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hs{constructor(e,t){this.bucket=e,this.path_=t}get path(){return this.path_}get isRoot(){return this.path.length===0}fullServerUrl(){const e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(e,t){let r;try{r=Hs.makeFromUrl(e,t)}catch{return new Hs(e,"")}if(r.path==="")return r;throw i4(e)}static makeFromUrl(e,t){let r=null;const a="([A-Za-z0-9.\\-_]+)";function i(R){R.path.charAt(R.path.length-1)==="/"&&(R.path_=R.path_.slice(0,-1))}const o="(/(.*))?$",l=new RegExp("^gs://"+a+o,"i"),c={bucket:1,path:3};function h(R){R.path_=decodeURIComponent(R.path)}const u="v[A-Za-z0-9_]+",m=t.replace(/[.]/g,"\\."),g="(/([^?#]*).*)?$",p=new RegExp(`^https?://${m}/${u}/b/${a}/o${g}`,"i"),j={bucket:1,path:3},_=t===ab?"(?:storage.googleapis.com|storage.cloud.google.com)":t,y="([^?#]*)",M=new RegExp(`^https?://${_}/${a}/${y}`,"i"),T=[{regex:l,indices:c,postModify:i},{regex:p,indices:j,postModify:h},{regex:M,indices:{bucket:1,path:2},postModify:h}];for(let R=0;R<T.length;R++){const P=T[R],C=P.regex.exec(e);if(C){const N=C[P.indices.bucket];let b=C[P.indices.path];b||(b=""),r=new Hs(N,b),P.postModify(r);break}}if(r==null)throw a4(e);return r}}class l4{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(e=!1){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function c4(s,e,t){let r=1,a=null,i=null,o=!1,l=0;function c(){return l===2}let h=!1;function u(...y){h||(h=!0,e.apply(null,y))}function m(y){a=setTimeout(()=>{a=null,s(p,c())},y)}function g(){i&&clearTimeout(i)}function p(y,...M){if(h){g();return}if(y){g(),u.call(null,y,...M);return}if(c()||o){g(),u.call(null,y,...M);return}r<64&&(r*=2);let T;l===1?(l=2,T=0):T=(r+Math.random())*1e3,m(T)}let j=!1;function _(y){j||(j=!0,g(),!h&&(a!==null?(y||(l=2),clearTimeout(a),m(0)):y||(l=1)))}return m(0),i=setTimeout(()=>{o=!0,_(!0)},t),_}function d4(s){s(!1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function h4(s){return s!==void 0}function Ug(s,e,t,r){if(r<e)throw Fg(`Invalid value for '${s}'. Expected ${e} or greater.`);if(r>t)throw Fg(`Invalid value for '${s}'. Expected ${t} or less.`)}function u4(s){const e=encodeURIComponent;let t="?";for(const r in s)if(s.hasOwnProperty(r)){const a=e(r)+"="+e(s[r]);t=t+a+"&"}return t=t.slice(0,-1),t}var Al;(function(s){s[s.NO_ERROR=0]="NO_ERROR",s[s.NETWORK_ERROR=1]="NETWORK_ERROR",s[s.ABORT=2]="ABORT"})(Al||(Al={}));/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function m4(s,e){const t=s>=500&&s<600,a=[408,429].indexOf(s)!==-1,i=e.indexOf(s)!==-1;return t||a||i}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class g4{constructor(e,t,r,a,i,o,l,c,h,u,m,g=!0){this.url_=e,this.method_=t,this.headers_=r,this.body_=a,this.successCodes_=i,this.additionalRetryCodes_=o,this.callback_=l,this.errorCallback_=c,this.timeout_=h,this.progressCallback_=u,this.connectionFactory_=m,this.retry=g,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((p,j)=>{this.resolve_=p,this.reject_=j,this.start_()})}start_(){const e=(r,a)=>{if(a){r(!1,new Do(!1,null,!0));return}const i=this.connectionFactory_();this.pendingConnection_=i;const o=l=>{const c=l.loaded,h=l.lengthComputable?l.total:-1;this.progressCallback_!==null&&this.progressCallback_(c,h)};this.progressCallback_!==null&&i.addUploadProgressListener(o),i.send(this.url_,this.method_,this.body_,this.headers_).then(()=>{this.progressCallback_!==null&&i.removeUploadProgressListener(o),this.pendingConnection_=null;const l=i.getErrorCode()===Al.NO_ERROR,c=i.getStatus();if(!l||m4(c,this.additionalRetryCodes_)&&this.retry){const u=i.getErrorCode()===Al.ABORT;r(!1,new Do(!1,null,u));return}const h=this.successCodes_.indexOf(c)!==-1;r(!0,new Do(h,i))})},t=(r,a)=>{const i=this.resolve_,o=this.reject_,l=a.connection;if(a.wasSuccessCode)try{const c=this.callback_(l,l.getResponse());h4(c)?i(c):i()}catch(c){o(c)}else if(l!==null){const c=s4();c.serverResponse=l.getErrorText(),this.errorCallback_?o(this.errorCallback_(l,c)):o(c)}else if(a.canceled){const c=this.appDelete_?ib():n4();o(c)}else{const c=r4();o(c)}};this.canceled_?t(!1,new Do(!1,null,!0)):this.backoffId_=c4(e,t,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,this.backoffId_!==null&&d4(this.backoffId_),this.pendingConnection_!==null&&this.pendingConnection_.abort()}}class Do{constructor(e,t,r){this.wasSuccessCode=e,this.connection=t,this.canceled=!!r}}function f4(s,e){e!==null&&e.length>0&&(s.Authorization="Firebase "+e)}function p4(s,e){s["X-Firebase-Storage-Version"]="webjs/"+(e??"AppManager")}function x4(s,e){e&&(s["X-Firebase-GMPID"]=e)}function b4(s,e){e!==null&&(s["X-Firebase-AppCheck"]=e)}function y4(s,e,t,r,a,i,o=!0){const l=u4(s.urlParams),c=s.url+l,h=Object.assign({},s.headers);return x4(h,e),f4(h,t),p4(h,i),b4(h,r),new g4(c,s.method,h,s.body,s.successCodes,s.additionalRetryCodes,s.handler,s.errorHandler,s.timeout,s.progressCallback,a,o)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function v4(s){if(s.length===0)return null;const e=s.lastIndexOf("/");return e===-1?"":s.slice(0,e)}function w4(s){const e=s.lastIndexOf("/",s.length-2);return e===-1?s:s.slice(e+1)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cl{constructor(e,t){this._service=e,t instanceof Hs?this._location=t:this._location=Hs.makeFromUrl(t,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,t){return new Cl(e,t)}get root(){const e=new Hs(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return w4(this._location.path)}get storage(){return this._service}get parent(){const e=v4(this._location.path);if(e===null)return null;const t=new Hs(this._location.bucket,e);return new Cl(this._service,t)}_throwIfRoot(e){if(this._location.path==="")throw o4(e)}}function Bg(s,e){const t=e==null?void 0:e[Zj];return t==null?null:Hs.makeFromBucketSpec(t,s)}function k4(s,e,t,r={}){s.host=`${e}:${t}`,s._protocol="http";const{mockUserToken:a}=r;a&&(s._overrideAuthToken=typeof a=="string"?a:Jp(a,s.app.options.projectId))}class _4{constructor(e,t,r,a,i){this.app=e,this._authProvider=t,this._appCheckProvider=r,this._url=a,this._firebaseVersion=i,this._bucket=null,this._host=ab,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=e4,this._maxUploadRetryTime=t4,this._requests=new Set,a!=null?this._bucket=Hs.makeFromBucketSpec(a,this._host):this._bucket=Bg(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,this._url!=null?this._bucket=Hs.makeFromBucketSpec(this._url,e):this._bucket=Bg(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){Ug("time",0,Number.POSITIVE_INFINITY,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){Ug("time",0,Number.POSITIVE_INFINITY,e),this._maxOperationRetryTime=e}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const e=this._authProvider.getImmediate({optional:!0});if(e){const t=await e.getToken();if(t!==null)return t.accessToken}return null}async _getAppCheckToken(){const e=this._appCheckProvider.getImmediate({optional:!0});return e?(await e.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(e=>e.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new Cl(this,e)}_makeRequest(e,t,r,a,i=!0){if(this._deleted)return new l4(ib());{const o=y4(e,this._appId,r,a,t,this._firebaseVersion,i);return this._requests.add(o),o.getPromise().then(()=>this._requests.delete(o),()=>this._requests.delete(o)),o}}async makeRequestWithTokens(e,t){const[r,a]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,t,r,a).getPromise()}}const zg="@firebase/storage",Hg="0.13.2";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ob="storage";function N4(s=vh(),e){s=hs(s);const r=Jl(s,ob).getImmediate({identifier:e}),a=Yp("storage");return a&&j4(r,...a),r}function j4(s,e,t,r={}){k4(s,e,t,r)}function E4(s,{instanceIdentifier:e}){const t=s.getProvider("app").getImmediate(),r=s.getProvider("auth-internal"),a=s.getProvider("app-check-internal");return new _4(t,r,a,e,Gn)}function S4(){Vn(new mn(ob,E4,"PUBLIC").setMultipleInstances(!0)),tr(zg,Hg,""),tr(zg,Hg,"esm2017")}S4();const xr={apiKey:"AIzaSyAwXWcGulx8NIxWhi4XubIwh_RDNeCpHr8",authDomain:"apevault-teams.firebaseapp.com",projectId:"apevault-teams",storageBucket:"apevault-teams.firebasestorage.app",messagingSenderId:"515829779788",appId:"1:515829779788:web:d001cd40196ab1995893e9"};console.log("Firebase config check:",{hasApiKey:!!xr.apiKey&&xr.apiKey!=="your-api-key",authDomain:xr.authDomain,projectId:xr.projectId,hasStorageBucket:!!xr.storageBucket&&xr.storageBucket!=="your-storage-bucket",hasAppId:!!xr.appId&&xr.appId!=="your-app-id"});console.log("Raw env values:",{VITE_FIREBASE_API_KEY:"AIzaSyAwXWcGulx8NIxWhi4XubIwh_RDNeCpHr8",VITE_FIREBASE_AUTH_DOMAIN:"apevault-teams.firebaseapp.com",VITE_FIREBASE_PROJECT_ID:"apevault-teams",VITE_FIREBASE_STORAGE_BUCKET:"apevault-teams.firebasestorage.app"});const mu=t0(xr);Xj(mu);const De=O_(mu);N4(mu);console.log("Firestore db initialized:",!!De);const qd={1:"Dex",2:"Enowk",3:"Xenia",4:"Olenka",5:"Sydney"},Ia=new Map,Tt=s=>{var t,r;const e=Ia.get(s);return e!==void 0?e||qd[s]||((t=Re.find(a=>a.id===s))==null?void 0:t.login)||s:qd[s]||((r=Re.find(a=>a.id===s))==null?void 0:r.login)||s},Ir=async s=>{var e;try{const t=await eS(s);if(t)return Ia.set(s,t),t;const r=qd[s]||((e=Re.find(a=>a.id===s))==null?void 0:e.login)||s;return Ia.set(s,null),r}catch(t){return console.error("Error fetching user nickname:",t),Tt(s)}},Gd=s=>{Ia.delete(s)},Wg=()=>{Ia.clear()},pc=s=>{const[e,t]=I.useState(()=>Tt(s));return I.useEffect(()=>{Ia.has(s)||Ir(s).then(a=>t(a));const r=a=>{const i=a,{userId:o}=i.detail||{};(!o||o===s)&&t(Tt(s))};return window.addEventListener("nicknameUpdated",r),()=>window.removeEventListener("nicknameUpdated",r)},[s]),e};function Dl(s){"@babel/helpers - typeof";return Dl=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Dl(s)}function cr(s){if(s===null||s===!0||s===!1)return NaN;var e=Number(s);return isNaN(e)?e:e<0?Math.ceil(e):Math.floor(e)}function Dt(s,e){if(e.length<s)throw new TypeError(s+" argument"+(s>1?"s":"")+" required, but only "+e.length+" present")}function qt(s){Dt(1,arguments);var e=Object.prototype.toString.call(s);return s instanceof Date||Dl(s)==="object"&&e==="[object Date]"?new Date(s.getTime()):typeof s=="number"||e==="[object Number]"?new Date(s):((typeof s=="string"||e==="[object String]")&&typeof console<"u"&&(console.warn("Starting with v2.0.0-beta.1 date-fns doesn't accept strings as date arguments. Please use `parseISO` to parse strings. See: https://github.com/date-fns/date-fns/blob/master/docs/upgradeGuide.md#string-arguments"),console.warn(new Error().stack)),new Date(NaN))}function T4(s,e){Dt(2,arguments);var t=qt(s).getTime(),r=cr(e);return new Date(t+r)}var I4={};function Fa(){return I4}function A4(s,e){var t,r,a,i,o,l,c,h;Dt(1,arguments);var u=Fa(),m=cr((t=(r=(a=(i=e==null?void 0:e.weekStartsOn)!==null&&i!==void 0?i:e==null||(o=e.locale)===null||o===void 0||(l=o.options)===null||l===void 0?void 0:l.weekStartsOn)!==null&&a!==void 0?a:u.weekStartsOn)!==null&&r!==void 0?r:(c=u.locale)===null||c===void 0||(h=c.options)===null||h===void 0?void 0:h.weekStartsOn)!==null&&t!==void 0?t:0);if(!(m>=0&&m<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");var g=qt(s),p=g.getDay(),j=(p<m?7:0)+p-m;return g.setDate(g.getDate()-j),g.setHours(0,0,0,0),g}function C4(s){var e=new Date(Date.UTC(s.getFullYear(),s.getMonth(),s.getDate(),s.getHours(),s.getMinutes(),s.getSeconds(),s.getMilliseconds()));return e.setUTCFullYear(s.getFullYear()),s.getTime()-e.getTime()}function qg(s){Dt(1,arguments);var e=qt(s);return e.setHours(0,0,0,0),e}var lb=6e4,cb=36e5;function D4(s,e){Dt(2,arguments);var t=qg(s),r=qg(e);return t.getTime()===r.getTime()}function M4(s){return Dt(1,arguments),s instanceof Date||Dl(s)==="object"&&Object.prototype.toString.call(s)==="[object Date]"}function $4(s){if(Dt(1,arguments),!M4(s)&&typeof s!="number")return!1;var e=qt(s);return!isNaN(Number(e))}function R4(s,e){var t;Dt(1,arguments);var r=s||{},a=qt(r.start),i=qt(r.end),o=i.getTime();if(!(a.getTime()<=o))throw new RangeError("Invalid interval");var l=[],c=a;c.setHours(0,0,0,0);var h=Number((t=void 0)!==null&&t!==void 0?t:1);if(h<1||isNaN(h))throw new RangeError("`options.step` must be a number greater than 1");for(;c.getTime()<=o;)l.push(qt(c)),c.setDate(c.getDate()+h),c.setHours(0,0,0,0);return l}function P4(s,e){var t,r,a,i,o,l,c,h;Dt(1,arguments);var u=Fa(),m=cr((t=(r=(a=(i=e==null?void 0:e.weekStartsOn)!==null&&i!==void 0?i:e==null||(o=e.locale)===null||o===void 0||(l=o.options)===null||l===void 0?void 0:l.weekStartsOn)!==null&&a!==void 0?a:u.weekStartsOn)!==null&&r!==void 0?r:(c=u.locale)===null||c===void 0||(h=c.options)===null||h===void 0?void 0:h.weekStartsOn)!==null&&t!==void 0?t:0);if(!(m>=0&&m<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");var g=qt(s),p=g.getDay(),j=(p<m?-7:0)+6-(p-m);return g.setDate(g.getDate()+j),g.setHours(23,59,59,999),g}function O4(s,e){Dt(2,arguments);var t=cr(e);return T4(s,-t)}var L4=864e5;function V4(s){Dt(1,arguments);var e=qt(s),t=e.getTime();e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0);var r=e.getTime(),a=t-r;return Math.floor(a/L4)+1}function Ml(s){Dt(1,arguments);var e=1,t=qt(s),r=t.getUTCDay(),a=(r<e?7:0)+r-e;return t.setUTCDate(t.getUTCDate()-a),t.setUTCHours(0,0,0,0),t}function db(s){Dt(1,arguments);var e=qt(s),t=e.getUTCFullYear(),r=new Date(0);r.setUTCFullYear(t+1,0,4),r.setUTCHours(0,0,0,0);var a=Ml(r),i=new Date(0);i.setUTCFullYear(t,0,4),i.setUTCHours(0,0,0,0);var o=Ml(i);return e.getTime()>=a.getTime()?t+1:e.getTime()>=o.getTime()?t:t-1}function F4(s){Dt(1,arguments);var e=db(s),t=new Date(0);t.setUTCFullYear(e,0,4),t.setUTCHours(0,0,0,0);var r=Ml(t);return r}var U4=6048e5;function B4(s){Dt(1,arguments);var e=qt(s),t=Ml(e).getTime()-F4(e).getTime();return Math.round(t/U4)+1}function Aa(s,e){var t,r,a,i,o,l,c,h;Dt(1,arguments);var u=Fa(),m=cr((t=(r=(a=(i=e==null?void 0:e.weekStartsOn)!==null&&i!==void 0?i:e==null||(o=e.locale)===null||o===void 0||(l=o.options)===null||l===void 0?void 0:l.weekStartsOn)!==null&&a!==void 0?a:u.weekStartsOn)!==null&&r!==void 0?r:(c=u.locale)===null||c===void 0||(h=c.options)===null||h===void 0?void 0:h.weekStartsOn)!==null&&t!==void 0?t:0);if(!(m>=0&&m<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");var g=qt(s),p=g.getUTCDay(),j=(p<m?7:0)+p-m;return g.setUTCDate(g.getUTCDate()-j),g.setUTCHours(0,0,0,0),g}function hb(s,e){var t,r,a,i,o,l,c,h;Dt(1,arguments);var u=qt(s),m=u.getUTCFullYear(),g=Fa(),p=cr((t=(r=(a=(i=e==null?void 0:e.firstWeekContainsDate)!==null&&i!==void 0?i:e==null||(o=e.locale)===null||o===void 0||(l=o.options)===null||l===void 0?void 0:l.firstWeekContainsDate)!==null&&a!==void 0?a:g.firstWeekContainsDate)!==null&&r!==void 0?r:(c=g.locale)===null||c===void 0||(h=c.options)===null||h===void 0?void 0:h.firstWeekContainsDate)!==null&&t!==void 0?t:1);if(!(p>=1&&p<=7))throw new RangeError("firstWeekContainsDate must be between 1 and 7 inclusively");var j=new Date(0);j.setUTCFullYear(m+1,0,p),j.setUTCHours(0,0,0,0);var _=Aa(j,e),y=new Date(0);y.setUTCFullYear(m,0,p),y.setUTCHours(0,0,0,0);var M=Aa(y,e);return u.getTime()>=_.getTime()?m+1:u.getTime()>=M.getTime()?m:m-1}function z4(s,e){var t,r,a,i,o,l,c,h;Dt(1,arguments);var u=Fa(),m=cr((t=(r=(a=(i=e==null?void 0:e.firstWeekContainsDate)!==null&&i!==void 0?i:e==null||(o=e.locale)===null||o===void 0||(l=o.options)===null||l===void 0?void 0:l.firstWeekContainsDate)!==null&&a!==void 0?a:u.firstWeekContainsDate)!==null&&r!==void 0?r:(c=u.locale)===null||c===void 0||(h=c.options)===null||h===void 0?void 0:h.firstWeekContainsDate)!==null&&t!==void 0?t:1),g=hb(s,e),p=new Date(0);p.setUTCFullYear(g,0,m),p.setUTCHours(0,0,0,0);var j=Aa(p,e);return j}var H4=6048e5;function W4(s,e){Dt(1,arguments);var t=qt(s),r=Aa(t,e).getTime()-z4(t,e).getTime();return Math.round(r/H4)+1}function ft(s,e){for(var t=s<0?"-":"",r=Math.abs(s).toString();r.length<e;)r="0"+r;return t+r}var qr={y:function(e,t){var r=e.getUTCFullYear(),a=r>0?r:1-r;return ft(t==="yy"?a%100:a,t.length)},M:function(e,t){var r=e.getUTCMonth();return t==="M"?String(r+1):ft(r+1,2)},d:function(e,t){return ft(e.getUTCDate(),t.length)},a:function(e,t){var r=e.getUTCHours()/12>=1?"pm":"am";switch(t){case"a":case"aa":return r.toUpperCase();case"aaa":return r;case"aaaaa":return r[0];case"aaaa":default:return r==="am"?"a.m.":"p.m."}},h:function(e,t){return ft(e.getUTCHours()%12||12,t.length)},H:function(e,t){return ft(e.getUTCHours(),t.length)},m:function(e,t){return ft(e.getUTCMinutes(),t.length)},s:function(e,t){return ft(e.getUTCSeconds(),t.length)},S:function(e,t){var r=t.length,a=e.getUTCMilliseconds(),i=Math.floor(a*Math.pow(10,r-3));return ft(i,t.length)}},ta={midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},q4={G:function(e,t,r){var a=e.getUTCFullYear()>0?1:0;switch(t){case"G":case"GG":case"GGG":return r.era(a,{width:"abbreviated"});case"GGGGG":return r.era(a,{width:"narrow"});case"GGGG":default:return r.era(a,{width:"wide"})}},y:function(e,t,r){if(t==="yo"){var a=e.getUTCFullYear(),i=a>0?a:1-a;return r.ordinalNumber(i,{unit:"year"})}return qr.y(e,t)},Y:function(e,t,r,a){var i=hb(e,a),o=i>0?i:1-i;if(t==="YY"){var l=o%100;return ft(l,2)}return t==="Yo"?r.ordinalNumber(o,{unit:"year"}):ft(o,t.length)},R:function(e,t){var r=db(e);return ft(r,t.length)},u:function(e,t){var r=e.getUTCFullYear();return ft(r,t.length)},Q:function(e,t,r){var a=Math.ceil((e.getUTCMonth()+1)/3);switch(t){case"Q":return String(a);case"QQ":return ft(a,2);case"Qo":return r.ordinalNumber(a,{unit:"quarter"});case"QQQ":return r.quarter(a,{width:"abbreviated",context:"formatting"});case"QQQQQ":return r.quarter(a,{width:"narrow",context:"formatting"});case"QQQQ":default:return r.quarter(a,{width:"wide",context:"formatting"})}},q:function(e,t,r){var a=Math.ceil((e.getUTCMonth()+1)/3);switch(t){case"q":return String(a);case"qq":return ft(a,2);case"qo":return r.ordinalNumber(a,{unit:"quarter"});case"qqq":return r.quarter(a,{width:"abbreviated",context:"standalone"});case"qqqqq":return r.quarter(a,{width:"narrow",context:"standalone"});case"qqqq":default:return r.quarter(a,{width:"wide",context:"standalone"})}},M:function(e,t,r){var a=e.getUTCMonth();switch(t){case"M":case"MM":return qr.M(e,t);case"Mo":return r.ordinalNumber(a+1,{unit:"month"});case"MMM":return r.month(a,{width:"abbreviated",context:"formatting"});case"MMMMM":return r.month(a,{width:"narrow",context:"formatting"});case"MMMM":default:return r.month(a,{width:"wide",context:"formatting"})}},L:function(e,t,r){var a=e.getUTCMonth();switch(t){case"L":return String(a+1);case"LL":return ft(a+1,2);case"Lo":return r.ordinalNumber(a+1,{unit:"month"});case"LLL":return r.month(a,{width:"abbreviated",context:"standalone"});case"LLLLL":return r.month(a,{width:"narrow",context:"standalone"});case"LLLL":default:return r.month(a,{width:"wide",context:"standalone"})}},w:function(e,t,r,a){var i=W4(e,a);return t==="wo"?r.ordinalNumber(i,{unit:"week"}):ft(i,t.length)},I:function(e,t,r){var a=B4(e);return t==="Io"?r.ordinalNumber(a,{unit:"week"}):ft(a,t.length)},d:function(e,t,r){return t==="do"?r.ordinalNumber(e.getUTCDate(),{unit:"date"}):qr.d(e,t)},D:function(e,t,r){var a=V4(e);return t==="Do"?r.ordinalNumber(a,{unit:"dayOfYear"}):ft(a,t.length)},E:function(e,t,r){var a=e.getUTCDay();switch(t){case"E":case"EE":case"EEE":return r.day(a,{width:"abbreviated",context:"formatting"});case"EEEEE":return r.day(a,{width:"narrow",context:"formatting"});case"EEEEEE":return r.day(a,{width:"short",context:"formatting"});case"EEEE":default:return r.day(a,{width:"wide",context:"formatting"})}},e:function(e,t,r,a){var i=e.getUTCDay(),o=(i-a.weekStartsOn+8)%7||7;switch(t){case"e":return String(o);case"ee":return ft(o,2);case"eo":return r.ordinalNumber(o,{unit:"day"});case"eee":return r.day(i,{width:"abbreviated",context:"formatting"});case"eeeee":return r.day(i,{width:"narrow",context:"formatting"});case"eeeeee":return r.day(i,{width:"short",context:"formatting"});case"eeee":default:return r.day(i,{width:"wide",context:"formatting"})}},c:function(e,t,r,a){var i=e.getUTCDay(),o=(i-a.weekStartsOn+8)%7||7;switch(t){case"c":return String(o);case"cc":return ft(o,t.length);case"co":return r.ordinalNumber(o,{unit:"day"});case"ccc":return r.day(i,{width:"abbreviated",context:"standalone"});case"ccccc":return r.day(i,{width:"narrow",context:"standalone"});case"cccccc":return r.day(i,{width:"short",context:"standalone"});case"cccc":default:return r.day(i,{width:"wide",context:"standalone"})}},i:function(e,t,r){var a=e.getUTCDay(),i=a===0?7:a;switch(t){case"i":return String(i);case"ii":return ft(i,t.length);case"io":return r.ordinalNumber(i,{unit:"day"});case"iii":return r.day(a,{width:"abbreviated",context:"formatting"});case"iiiii":return r.day(a,{width:"narrow",context:"formatting"});case"iiiiii":return r.day(a,{width:"short",context:"formatting"});case"iiii":default:return r.day(a,{width:"wide",context:"formatting"})}},a:function(e,t,r){var a=e.getUTCHours(),i=a/12>=1?"pm":"am";switch(t){case"a":case"aa":return r.dayPeriod(i,{width:"abbreviated",context:"formatting"});case"aaa":return r.dayPeriod(i,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return r.dayPeriod(i,{width:"narrow",context:"formatting"});case"aaaa":default:return r.dayPeriod(i,{width:"wide",context:"formatting"})}},b:function(e,t,r){var a=e.getUTCHours(),i;switch(a===12?i=ta.noon:a===0?i=ta.midnight:i=a/12>=1?"pm":"am",t){case"b":case"bb":return r.dayPeriod(i,{width:"abbreviated",context:"formatting"});case"bbb":return r.dayPeriod(i,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return r.dayPeriod(i,{width:"narrow",context:"formatting"});case"bbbb":default:return r.dayPeriod(i,{width:"wide",context:"formatting"})}},B:function(e,t,r){var a=e.getUTCHours(),i;switch(a>=17?i=ta.evening:a>=12?i=ta.afternoon:a>=4?i=ta.morning:i=ta.night,t){case"B":case"BB":case"BBB":return r.dayPeriod(i,{width:"abbreviated",context:"formatting"});case"BBBBB":return r.dayPeriod(i,{width:"narrow",context:"formatting"});case"BBBB":default:return r.dayPeriod(i,{width:"wide",context:"formatting"})}},h:function(e,t,r){if(t==="ho"){var a=e.getUTCHours()%12;return a===0&&(a=12),r.ordinalNumber(a,{unit:"hour"})}return qr.h(e,t)},H:function(e,t,r){return t==="Ho"?r.ordinalNumber(e.getUTCHours(),{unit:"hour"}):qr.H(e,t)},K:function(e,t,r){var a=e.getUTCHours()%12;return t==="Ko"?r.ordinalNumber(a,{unit:"hour"}):ft(a,t.length)},k:function(e,t,r){var a=e.getUTCHours();return a===0&&(a=24),t==="ko"?r.ordinalNumber(a,{unit:"hour"}):ft(a,t.length)},m:function(e,t,r){return t==="mo"?r.ordinalNumber(e.getUTCMinutes(),{unit:"minute"}):qr.m(e,t)},s:function(e,t,r){return t==="so"?r.ordinalNumber(e.getUTCSeconds(),{unit:"second"}):qr.s(e,t)},S:function(e,t){return qr.S(e,t)},X:function(e,t,r,a){var i=a._originalDate||e,o=i.getTimezoneOffset();if(o===0)return"Z";switch(t){case"X":return Kg(o);case"XXXX":case"XX":return Sn(o);case"XXXXX":case"XXX":default:return Sn(o,":")}},x:function(e,t,r,a){var i=a._originalDate||e,o=i.getTimezoneOffset();switch(t){case"x":return Kg(o);case"xxxx":case"xx":return Sn(o);case"xxxxx":case"xxx":default:return Sn(o,":")}},O:function(e,t,r,a){var i=a._originalDate||e,o=i.getTimezoneOffset();switch(t){case"O":case"OO":case"OOO":return"GMT"+Gg(o,":");case"OOOO":default:return"GMT"+Sn(o,":")}},z:function(e,t,r,a){var i=a._originalDate||e,o=i.getTimezoneOffset();switch(t){case"z":case"zz":case"zzz":return"GMT"+Gg(o,":");case"zzzz":default:return"GMT"+Sn(o,":")}},t:function(e,t,r,a){var i=a._originalDate||e,o=Math.floor(i.getTime()/1e3);return ft(o,t.length)},T:function(e,t,r,a){var i=a._originalDate||e,o=i.getTime();return ft(o,t.length)}};function Gg(s,e){var t=s>0?"-":"+",r=Math.abs(s),a=Math.floor(r/60),i=r%60;if(i===0)return t+String(a);var o=e;return t+String(a)+o+ft(i,2)}function Kg(s,e){if(s%60===0){var t=s>0?"-":"+";return t+ft(Math.abs(s)/60,2)}return Sn(s,e)}function Sn(s,e){var t=e||"",r=s>0?"-":"+",a=Math.abs(s),i=ft(Math.floor(a/60),2),o=ft(a%60,2);return r+i+t+o}var Yg=function(e,t){switch(e){case"P":return t.date({width:"short"});case"PP":return t.date({width:"medium"});case"PPP":return t.date({width:"long"});case"PPPP":default:return t.date({width:"full"})}},ub=function(e,t){switch(e){case"p":return t.time({width:"short"});case"pp":return t.time({width:"medium"});case"ppp":return t.time({width:"long"});case"pppp":default:return t.time({width:"full"})}},G4=function(e,t){var r=e.match(/(P+)(p+)?/)||[],a=r[1],i=r[2];if(!i)return Yg(e,t);var o;switch(a){case"P":o=t.dateTime({width:"short"});break;case"PP":o=t.dateTime({width:"medium"});break;case"PPP":o=t.dateTime({width:"long"});break;case"PPPP":default:o=t.dateTime({width:"full"});break}return o.replace("{{date}}",Yg(a,t)).replace("{{time}}",ub(i,t))},K4={p:ub,P:G4},Y4=["D","DD"],Q4=["YY","YYYY"];function X4(s){return Y4.indexOf(s)!==-1}function J4(s){return Q4.indexOf(s)!==-1}function Qg(s,e,t){if(s==="YYYY")throw new RangeError("Use `yyyy` instead of `YYYY` (in `".concat(e,"`) for formatting years to the input `").concat(t,"`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md"));if(s==="YY")throw new RangeError("Use `yy` instead of `YY` (in `".concat(e,"`) for formatting years to the input `").concat(t,"`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md"));if(s==="D")throw new RangeError("Use `d` instead of `D` (in `".concat(e,"`) for formatting days of the month to the input `").concat(t,"`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md"));if(s==="DD")throw new RangeError("Use `dd` instead of `DD` (in `".concat(e,"`) for formatting days of the month to the input `").concat(t,"`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md"))}var Z4={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},eE=function(e,t,r){var a,i=Z4[e];return typeof i=="string"?a=i:t===1?a=i.one:a=i.other.replace("{{count}}",t.toString()),r!=null&&r.addSuffix?r.comparison&&r.comparison>0?"in "+a:a+" ago":a};function pa(s){return function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=e.width?String(e.width):s.defaultWidth,r=s.formats[t]||s.formats[s.defaultWidth];return r}}var tE={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},sE={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},rE={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},nE={date:pa({formats:tE,defaultWidth:"full"}),time:pa({formats:sE,defaultWidth:"full"}),dateTime:pa({formats:rE,defaultWidth:"full"})},aE={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},iE=function(e,t,r,a){return aE[e]};function Zs(s){return function(e,t){var r=t!=null&&t.context?String(t.context):"standalone",a;if(r==="formatting"&&s.formattingValues){var i=s.defaultFormattingWidth||s.defaultWidth,o=t!=null&&t.width?String(t.width):i;a=s.formattingValues[o]||s.formattingValues[i]}else{var l=s.defaultWidth,c=t!=null&&t.width?String(t.width):s.defaultWidth;a=s.values[c]||s.values[l]}var h=s.argumentCallback?s.argumentCallback(e):e;return a[h]}}var oE={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},lE={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},cE={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},dE={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},hE={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},uE={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},mE=function(e,t){var r=Number(e),a=r%100;if(a>20||a<10)switch(a%10){case 1:return r+"st";case 2:return r+"nd";case 3:return r+"rd"}return r+"th"},gE={ordinalNumber:mE,era:Zs({values:oE,defaultWidth:"wide"}),quarter:Zs({values:lE,defaultWidth:"wide",argumentCallback:function(e){return e-1}}),month:Zs({values:cE,defaultWidth:"wide"}),day:Zs({values:dE,defaultWidth:"wide"}),dayPeriod:Zs({values:hE,defaultWidth:"wide",formattingValues:uE,defaultFormattingWidth:"wide"})};function er(s){return function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=t.width,a=r&&s.matchPatterns[r]||s.matchPatterns[s.defaultMatchWidth],i=e.match(a);if(!i)return null;var o=i[0],l=r&&s.parsePatterns[r]||s.parsePatterns[s.defaultParseWidth],c=Array.isArray(l)?pE(l,function(m){return m.test(o)}):fE(l,function(m){return m.test(o)}),h;h=s.valueCallback?s.valueCallback(c):c,h=t.valueCallback?t.valueCallback(h):h;var u=e.slice(o.length);return{value:h,rest:u}}}function fE(s,e){for(var t in s)if(s.hasOwnProperty(t)&&e(s[t]))return t}function pE(s,e){for(var t=0;t<s.length;t++)if(e(s[t]))return t}function mb(s){return function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=e.match(s.matchPattern);if(!r)return null;var a=r[0],i=e.match(s.parsePattern);if(!i)return null;var o=s.valueCallback?s.valueCallback(i[0]):i[0];o=t.valueCallback?t.valueCallback(o):o;var l=e.slice(a.length);return{value:o,rest:l}}}var xE=/^(\d+)(th|st|nd|rd)?/i,bE=/\d+/i,yE={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},vE={any:[/^b/i,/^(a|c)/i]},wE={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},kE={any:[/1/i,/2/i,/3/i,/4/i]},_E={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},NE={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},jE={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},EE={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},SE={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},TE={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},IE={ordinalNumber:mb({matchPattern:xE,parsePattern:bE,valueCallback:function(e){return parseInt(e,10)}}),era:er({matchPatterns:yE,defaultMatchWidth:"wide",parsePatterns:vE,defaultParseWidth:"any"}),quarter:er({matchPatterns:wE,defaultMatchWidth:"wide",parsePatterns:kE,defaultParseWidth:"any",valueCallback:function(e){return e+1}}),month:er({matchPatterns:_E,defaultMatchWidth:"wide",parsePatterns:NE,defaultParseWidth:"any"}),day:er({matchPatterns:jE,defaultMatchWidth:"wide",parsePatterns:EE,defaultParseWidth:"any"}),dayPeriod:er({matchPatterns:SE,defaultMatchWidth:"any",parsePatterns:TE,defaultParseWidth:"any"})},AE={code:"en-US",formatDistance:eE,formatLong:nE,formatRelative:iE,localize:gE,match:IE,options:{weekStartsOn:0,firstWeekContainsDate:1}},CE=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,DE=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,ME=/^'([^]*?)'?$/,$E=/''/g,RE=/[a-zA-Z]/;function gb(s,e,t){var r,a,i,o,l,c,h,u,m,g,p,j,_,y,M,D,T,R;Dt(2,arguments);var P=String(e),C=Fa(),N=(r=(a=t==null?void 0:t.locale)!==null&&a!==void 0?a:C.locale)!==null&&r!==void 0?r:AE,b=cr((i=(o=(l=(c=t==null?void 0:t.firstWeekContainsDate)!==null&&c!==void 0?c:t==null||(h=t.locale)===null||h===void 0||(u=h.options)===null||u===void 0?void 0:u.firstWeekContainsDate)!==null&&l!==void 0?l:C.firstWeekContainsDate)!==null&&o!==void 0?o:(m=C.locale)===null||m===void 0||(g=m.options)===null||g===void 0?void 0:g.firstWeekContainsDate)!==null&&i!==void 0?i:1);if(!(b>=1&&b<=7))throw new RangeError("firstWeekContainsDate must be between 1 and 7 inclusively");var v=cr((p=(j=(_=(y=t==null?void 0:t.weekStartsOn)!==null&&y!==void 0?y:t==null||(M=t.locale)===null||M===void 0||(D=M.options)===null||D===void 0?void 0:D.weekStartsOn)!==null&&_!==void 0?_:C.weekStartsOn)!==null&&j!==void 0?j:(T=C.locale)===null||T===void 0||(R=T.options)===null||R===void 0?void 0:R.weekStartsOn)!==null&&p!==void 0?p:0);if(!(v>=0&&v<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");if(!N.localize)throw new RangeError("locale must contain localize property");if(!N.formatLong)throw new RangeError("locale must contain formatLong property");var S=qt(s);if(!$4(S))throw new RangeError("Invalid time value");var E=C4(S),k=O4(S,E),w={firstWeekContainsDate:b,weekStartsOn:v,locale:N,_originalDate:S},Q=P.match(DE).map(function(ae){var V=ae[0];if(V==="p"||V==="P"){var X=K4[V];return X(ae,N.formatLong)}return ae}).join("").match(CE).map(function(ae){if(ae==="''")return"'";var V=ae[0];if(V==="'")return PE(ae);var X=q4[V];if(X)return!(t!=null&&t.useAdditionalWeekYearTokens)&&J4(ae)&&Qg(ae,e,String(s)),!(t!=null&&t.useAdditionalDayOfYearTokens)&&X4(ae)&&Qg(ae,e,String(s)),X(k,ae,N.localize,w);if(V.match(RE))throw new RangeError("Format string contains an unescaped latin alphabet character `"+V+"`");return ae}).join("");return Q}function PE(s){var e=s.match(ME);return e?e[1].replace($E,"'"):s}function OE(s,e){Dt(2,arguments);var t=qt(s),r=qt(e);return t.getTime()<r.getTime()}function Rs(s,e){var t;Dt(1,arguments);var r=cr((t=void 0)!==null&&t!==void 0?t:2);if(r!==2&&r!==1&&r!==0)throw new RangeError("additionalDigits must be 0, 1 or 2");if(!(typeof s=="string"||Object.prototype.toString.call(s)==="[object String]"))return new Date(NaN);var a=UE(s),i;if(a.date){var o=BE(a.date,r);i=zE(o.restDateString,o.year)}if(!i||isNaN(i.getTime()))return new Date(NaN);var l=i.getTime(),c=0,h;if(a.time&&(c=HE(a.time),isNaN(c)))return new Date(NaN);if(a.timezone){if(h=WE(a.timezone),isNaN(h))return new Date(NaN)}else{var u=new Date(l+c),m=new Date(0);return m.setFullYear(u.getUTCFullYear(),u.getUTCMonth(),u.getUTCDate()),m.setHours(u.getUTCHours(),u.getUTCMinutes(),u.getUTCSeconds(),u.getUTCMilliseconds()),m}return new Date(l+c+h)}var Mo={dateTimeDelimiter:/[T ]/,timeZoneDelimiter:/[Z ]/i,timezone:/([Z+-].*)$/},LE=/^-?(?:(\d{3})|(\d{2})(?:-?(\d{2}))?|W(\d{2})(?:-?(\d{1}))?|)$/,VE=/^(\d{2}(?:[.,]\d*)?)(?::?(\d{2}(?:[.,]\d*)?))?(?::?(\d{2}(?:[.,]\d*)?))?$/,FE=/^([+-])(\d{2})(?::?(\d{2}))?$/;function UE(s){var e={},t=s.split(Mo.dateTimeDelimiter),r;if(t.length>2)return e;if(/:/.test(t[0])?r=t[0]:(e.date=t[0],r=t[1],Mo.timeZoneDelimiter.test(e.date)&&(e.date=s.split(Mo.timeZoneDelimiter)[0],r=s.substr(e.date.length,s.length))),r){var a=Mo.timezone.exec(r);a?(e.time=r.replace(a[1],""),e.timezone=a[1]):e.time=r}return e}function BE(s,e){var t=new RegExp("^(?:(\\d{4}|[+-]\\d{"+(4+e)+"})|(\\d{2}|[+-]\\d{"+(2+e)+"})$)"),r=s.match(t);if(!r)return{year:NaN,restDateString:""};var a=r[1]?parseInt(r[1]):null,i=r[2]?parseInt(r[2]):null;return{year:i===null?a:i*100,restDateString:s.slice((r[1]||r[2]).length)}}function zE(s,e){if(e===null)return new Date(NaN);var t=s.match(LE);if(!t)return new Date(NaN);var r=!!t[4],a=Ja(t[1]),i=Ja(t[2])-1,o=Ja(t[3]),l=Ja(t[4]),c=Ja(t[5])-1;if(r)return QE(e,l,c)?qE(e,l,c):new Date(NaN);var h=new Date(0);return!KE(e,i,o)||!YE(e,a)?new Date(NaN):(h.setUTCFullYear(e,i,Math.max(a,o)),h)}function Ja(s){return s?parseInt(s):1}function HE(s){var e=s.match(VE);if(!e)return NaN;var t=td(e[1]),r=td(e[2]),a=td(e[3]);return XE(t,r,a)?t*cb+r*lb+a*1e3:NaN}function td(s){return s&&parseFloat(s.replace(",","."))||0}function WE(s){if(s==="Z")return 0;var e=s.match(FE);if(!e)return 0;var t=e[1]==="+"?-1:1,r=parseInt(e[2]),a=e[3]&&parseInt(e[3])||0;return JE(r,a)?t*(r*cb+a*lb):NaN}function qE(s,e,t){var r=new Date(0);r.setUTCFullYear(s,0,4);var a=r.getUTCDay()||7,i=(e-1)*7+t+1-a;return r.setUTCDate(r.getUTCDate()+i),r}var GE=[31,null,31,30,31,30,31,31,30,31,30,31];function fb(s){return s%400===0||s%4===0&&s%100!==0}function KE(s,e,t){return e>=0&&e<=11&&t>=1&&t<=(GE[e]||(fb(s)?29:28))}function YE(s,e){return e>=1&&e<=(fb(s)?366:365)}function QE(s,e,t){return e>=1&&e<=53&&t>=0&&t<=6}function XE(s,e,t){return s===24?e===0&&t===0:t>=0&&t<60&&e>=0&&e<60&&s>=0&&s<25}function JE(s,e){return e>=0&&e<=59}function Xg(s,e,t){Dt(2,arguments);var r=Aa(s,t),a=Aa(e,t);return r.getTime()===a.getTime()}function Za(s,e){if(s.one!==void 0&&e===1)return s.one;var t=e%10,r=e%100;return t===1&&r!==11?s.singularNominative.replace("{{count}}",String(e)):t>=2&&t<=4&&(r<10||r>20)?s.singularGenitive.replace("{{count}}",String(e)):s.pluralGenitive.replace("{{count}}",String(e))}function ms(s){return function(e,t){return t!=null&&t.addSuffix?t.comparison&&t.comparison>0?s.future?Za(s.future,e):"через "+Za(s.regular,e):s.past?Za(s.past,e):Za(s.regular,e)+" назад":Za(s.regular,e)}}var ZE={lessThanXSeconds:ms({regular:{one:"меньше секунды",singularNominative:"меньше {{count}} секунды",singularGenitive:"меньше {{count}} секунд",pluralGenitive:"меньше {{count}} секунд"},future:{one:"меньше, чем через секунду",singularNominative:"меньше, чем через {{count}} секунду",singularGenitive:"меньше, чем через {{count}} секунды",pluralGenitive:"меньше, чем через {{count}} секунд"}}),xSeconds:ms({regular:{singularNominative:"{{count}} секунда",singularGenitive:"{{count}} секунды",pluralGenitive:"{{count}} секунд"},past:{singularNominative:"{{count}} секунду назад",singularGenitive:"{{count}} секунды назад",pluralGenitive:"{{count}} секунд назад"},future:{singularNominative:"через {{count}} секунду",singularGenitive:"через {{count}} секунды",pluralGenitive:"через {{count}} секунд"}}),halfAMinute:function(e,t){return t!=null&&t.addSuffix?t.comparison&&t.comparison>0?"через полминуты":"полминуты назад":"полминуты"},lessThanXMinutes:ms({regular:{one:"меньше минуты",singularNominative:"меньше {{count}} минуты",singularGenitive:"меньше {{count}} минут",pluralGenitive:"меньше {{count}} минут"},future:{one:"меньше, чем через минуту",singularNominative:"меньше, чем через {{count}} минуту",singularGenitive:"меньше, чем через {{count}} минуты",pluralGenitive:"меньше, чем через {{count}} минут"}}),xMinutes:ms({regular:{singularNominative:"{{count}} минута",singularGenitive:"{{count}} минуты",pluralGenitive:"{{count}} минут"},past:{singularNominative:"{{count}} минуту назад",singularGenitive:"{{count}} минуты назад",pluralGenitive:"{{count}} минут назад"},future:{singularNominative:"через {{count}} минуту",singularGenitive:"через {{count}} минуты",pluralGenitive:"через {{count}} минут"}}),aboutXHours:ms({regular:{singularNominative:"около {{count}} часа",singularGenitive:"около {{count}} часов",pluralGenitive:"около {{count}} часов"},future:{singularNominative:"приблизительно через {{count}} час",singularGenitive:"приблизительно через {{count}} часа",pluralGenitive:"приблизительно через {{count}} часов"}}),xHours:ms({regular:{singularNominative:"{{count}} час",singularGenitive:"{{count}} часа",pluralGenitive:"{{count}} часов"}}),xDays:ms({regular:{singularNominative:"{{count}} день",singularGenitive:"{{count}} дня",pluralGenitive:"{{count}} дней"}}),aboutXWeeks:ms({regular:{singularNominative:"около {{count}} недели",singularGenitive:"около {{count}} недель",pluralGenitive:"около {{count}} недель"},future:{singularNominative:"приблизительно через {{count}} неделю",singularGenitive:"приблизительно через {{count}} недели",pluralGenitive:"приблизительно через {{count}} недель"}}),xWeeks:ms({regular:{singularNominative:"{{count}} неделя",singularGenitive:"{{count}} недели",pluralGenitive:"{{count}} недель"}}),aboutXMonths:ms({regular:{singularNominative:"около {{count}} месяца",singularGenitive:"около {{count}} месяцев",pluralGenitive:"около {{count}} месяцев"},future:{singularNominative:"приблизительно через {{count}} месяц",singularGenitive:"приблизительно через {{count}} месяца",pluralGenitive:"приблизительно через {{count}} месяцев"}}),xMonths:ms({regular:{singularNominative:"{{count}} месяц",singularGenitive:"{{count}} месяца",pluralGenitive:"{{count}} месяцев"}}),aboutXYears:ms({regular:{singularNominative:"около {{count}} года",singularGenitive:"около {{count}} лет",pluralGenitive:"около {{count}} лет"},future:{singularNominative:"приблизительно через {{count}} год",singularGenitive:"приблизительно через {{count}} года",pluralGenitive:"приблизительно через {{count}} лет"}}),xYears:ms({regular:{singularNominative:"{{count}} год",singularGenitive:"{{count}} года",pluralGenitive:"{{count}} лет"}}),overXYears:ms({regular:{singularNominative:"больше {{count}} года",singularGenitive:"больше {{count}} лет",pluralGenitive:"больше {{count}} лет"},future:{singularNominative:"больше, чем через {{count}} год",singularGenitive:"больше, чем через {{count}} года",pluralGenitive:"больше, чем через {{count}} лет"}}),almostXYears:ms({regular:{singularNominative:"почти {{count}} год",singularGenitive:"почти {{count}} года",pluralGenitive:"почти {{count}} лет"},future:{singularNominative:"почти через {{count}} год",singularGenitive:"почти через {{count}} года",pluralGenitive:"почти через {{count}} лет"}})},e5=function(e,t,r){return ZE[e](t,r)},t5={full:"EEEE, d MMMM y 'г.'",long:"d MMMM y 'г.'",medium:"d MMM y 'г.'",short:"dd.MM.y"},s5={full:"H:mm:ss zzzz",long:"H:mm:ss z",medium:"H:mm:ss",short:"H:mm"},r5={any:"{{date}}, {{time}}"},n5={date:pa({formats:t5,defaultWidth:"full"}),time:pa({formats:s5,defaultWidth:"full"}),dateTime:pa({formats:r5,defaultWidth:"any"})},gu=["воскресенье","понедельник","вторник","среду","четверг","пятницу","субботу"];function a5(s){var e=gu[s];switch(s){case 0:return"'в прошлое "+e+" в' p";case 1:case 2:case 4:return"'в прошлый "+e+" в' p";case 3:case 5:case 6:return"'в прошлую "+e+" в' p"}}function Jg(s){var e=gu[s];return s===2?"'во "+e+" в' p":"'в "+e+" в' p"}function i5(s){var e=gu[s];switch(s){case 0:return"'в следующее "+e+" в' p";case 1:case 2:case 4:return"'в следующий "+e+" в' p";case 3:case 5:case 6:return"'в следующую "+e+" в' p"}}var o5={lastWeek:function(e,t,r){var a=e.getUTCDay();return Xg(e,t,r)?Jg(a):a5(a)},yesterday:"'вчера в' p",today:"'сегодня в' p",tomorrow:"'завтра в' p",nextWeek:function(e,t,r){var a=e.getUTCDay();return Xg(e,t,r)?Jg(a):i5(a)},other:"P"},l5=function(e,t,r,a){var i=o5[e];return typeof i=="function"?i(t,r,a):i},c5={narrow:["до н.э.","н.э."],abbreviated:["до н. э.","н. э."],wide:["до нашей эры","нашей эры"]},d5={narrow:["1","2","3","4"],abbreviated:["1-й кв.","2-й кв.","3-й кв.","4-й кв."],wide:["1-й квартал","2-й квартал","3-й квартал","4-й квартал"]},h5={narrow:["Я","Ф","М","А","М","И","И","А","С","О","Н","Д"],abbreviated:["янв.","фев.","март","апр.","май","июнь","июль","авг.","сент.","окт.","нояб.","дек."],wide:["январь","февраль","март","апрель","май","июнь","июль","август","сентябрь","октябрь","ноябрь","декабрь"]},u5={narrow:["Я","Ф","М","А","М","И","И","А","С","О","Н","Д"],abbreviated:["янв.","фев.","мар.","апр.","мая","июн.","июл.","авг.","сент.","окт.","нояб.","дек."],wide:["января","февраля","марта","апреля","мая","июня","июля","августа","сентября","октября","ноября","декабря"]},m5={narrow:["В","П","В","С","Ч","П","С"],short:["вс","пн","вт","ср","чт","пт","сб"],abbreviated:["вск","пнд","втр","срд","чтв","птн","суб"],wide:["воскресенье","понедельник","вторник","среда","четверг","пятница","суббота"]},g5={narrow:{am:"ДП",pm:"ПП",midnight:"полн.",noon:"полд.",morning:"утро",afternoon:"день",evening:"веч.",night:"ночь"},abbreviated:{am:"ДП",pm:"ПП",midnight:"полн.",noon:"полд.",morning:"утро",afternoon:"день",evening:"веч.",night:"ночь"},wide:{am:"ДП",pm:"ПП",midnight:"полночь",noon:"полдень",morning:"утро",afternoon:"день",evening:"вечер",night:"ночь"}},f5={narrow:{am:"ДП",pm:"ПП",midnight:"полн.",noon:"полд.",morning:"утра",afternoon:"дня",evening:"веч.",night:"ночи"},abbreviated:{am:"ДП",pm:"ПП",midnight:"полн.",noon:"полд.",morning:"утра",afternoon:"дня",evening:"веч.",night:"ночи"},wide:{am:"ДП",pm:"ПП",midnight:"полночь",noon:"полдень",morning:"утра",afternoon:"дня",evening:"вечера",night:"ночи"}},p5=function(e,t){var r=Number(e),a=t==null?void 0:t.unit,i;return a==="date"?i="-е":a==="week"||a==="minute"||a==="second"?i="-я":i="-й",r+i},x5={ordinalNumber:p5,era:Zs({values:c5,defaultWidth:"wide"}),quarter:Zs({values:d5,defaultWidth:"wide",argumentCallback:function(e){return e-1}}),month:Zs({values:h5,defaultWidth:"wide",formattingValues:u5,defaultFormattingWidth:"wide"}),day:Zs({values:m5,defaultWidth:"wide"}),dayPeriod:Zs({values:g5,defaultWidth:"any",formattingValues:f5,defaultFormattingWidth:"wide"})},b5=/^(\d+)(-?(е|я|й|ое|ье|ая|ья|ый|ой|ий|ый))?/i,y5=/\d+/i,v5={narrow:/^((до )?н\.?\s?э\.?)/i,abbreviated:/^((до )?н\.?\s?э\.?)/i,wide:/^(до нашей эры|нашей эры|наша эра)/i},w5={any:[/^д/i,/^н/i]},k5={narrow:/^[1234]/i,abbreviated:/^[1234](-?[ыои]?й?)? кв.?/i,wide:/^[1234](-?[ыои]?й?)? квартал/i},_5={any:[/1/i,/2/i,/3/i,/4/i]},N5={narrow:/^[яфмаисонд]/i,abbreviated:/^(янв|фев|март?|апр|ма[йя]|июн[ья]?|июл[ья]?|авг|сент?|окт|нояб?|дек)\.?/i,wide:/^(январ[ья]|феврал[ья]|марта?|апрел[ья]|ма[йя]|июн[ья]|июл[ья]|августа?|сентябр[ья]|октябр[ья]|октябр[ья]|ноябр[ья]|декабр[ья])/i},j5={narrow:[/^я/i,/^ф/i,/^м/i,/^а/i,/^м/i,/^и/i,/^и/i,/^а/i,/^с/i,/^о/i,/^н/i,/^я/i],any:[/^я/i,/^ф/i,/^мар/i,/^ап/i,/^ма[йя]/i,/^июн/i,/^июл/i,/^ав/i,/^с/i,/^о/i,/^н/i,/^д/i]},E5={narrow:/^[впсч]/i,short:/^(вс|во|пн|по|вт|ср|чт|че|пт|пя|сб|су)\.?/i,abbreviated:/^(вск|вос|пнд|пон|втр|вто|срд|сре|чтв|чет|птн|пят|суб).?/i,wide:/^(воскресень[ея]|понедельника?|вторника?|сред[аы]|четверга?|пятниц[аы]|суббот[аы])/i},S5={narrow:[/^в/i,/^п/i,/^в/i,/^с/i,/^ч/i,/^п/i,/^с/i],any:[/^в[ос]/i,/^п[он]/i,/^в/i,/^ср/i,/^ч/i,/^п[ят]/i,/^с[уб]/i]},T5={narrow:/^([дп]п|полн\.?|полд\.?|утр[оа]|день|дня|веч\.?|ноч[ьи])/i,abbreviated:/^([дп]п|полн\.?|полд\.?|утр[оа]|день|дня|веч\.?|ноч[ьи])/i,wide:/^([дп]п|полночь|полдень|утр[оа]|день|дня|вечера?|ноч[ьи])/i},I5={any:{am:/^дп/i,pm:/^пп/i,midnight:/^полн/i,noon:/^полд/i,morning:/^у/i,afternoon:/^д[ен]/i,evening:/^в/i,night:/^н/i}},A5={ordinalNumber:mb({matchPattern:b5,parsePattern:y5,valueCallback:function(e){return parseInt(e,10)}}),era:er({matchPatterns:v5,defaultMatchWidth:"wide",parsePatterns:w5,defaultParseWidth:"any"}),quarter:er({matchPatterns:k5,defaultMatchWidth:"wide",parsePatterns:_5,defaultParseWidth:"any",valueCallback:function(e){return e+1}}),month:er({matchPatterns:N5,defaultMatchWidth:"wide",parsePatterns:j5,defaultParseWidth:"any"}),day:er({matchPatterns:E5,defaultMatchWidth:"wide",parsePatterns:S5,defaultParseWidth:"any"}),dayPeriod:er({matchPatterns:T5,defaultMatchWidth:"wide",parsePatterns:I5,defaultParseWidth:"any"})},C5={code:"ru",formatDistance:e5,formatLong:n5,formatRelative:l5,localize:x5,match:A5,options:{weekStartsOn:1,firstWeekContainsDate:1}};const oe=(s,e="dd.MM.yyyy")=>{try{const t=typeof s=="string"?Rs(s):s;return!t||Number.isNaN(t.getTime())?"":gb(t,e,{locale:C5})}catch{return""}},Hn=(s=new Date)=>{const e=A4(s,{weekStartsOn:1}),t=P4(s,{weekStartsOn:1});return{start:e,end:t}},fu=(s=new Date)=>{const{start:e,end:t}=Hn(s);return R4({start:e,end:t})},ca=(s,e)=>{const t=new Date,r=new Date(t);r.setHours(0,0,0,0),r.setDate(r.getDate()-(s-1));const a=new Date(t);return a.setHours(23,59,59,999),{start:r,end:a}},pb=(s,e)=>{const t=typeof s=="string"?Rs(s):s,r=typeof e=="string"?Rs(e):e;return D4(t,r)},xc=s=>s.reduce((e,t)=>{const[r,a]=t.start.split(":").map(Number),[i,o]=t.end.split(":").map(Number),l=r*60+a;let h=(i*60+o-l)/60;if(h<0&&(h+=24),t.breaks&&t.breaks.length>0){const u=t.breaks.reduce((m,g)=>{const[p,j]=g.start.split(":").map(Number),[_,y]=g.end.split(":").map(Number),M=p*60+j;let T=(_*60+y-M)/60;return T<0&&(T+=24),m+T},0);h-=u}return e+h},0),ws=s=>{const[e,t]=s.split(":").map(Number);return e*60+t},$l=(s,e)=>{if(!s||!e)return[];const t=Rs(s),r=Rs(e);if(OE(r,t))return[];const a=[],i=new Date(t);for(;i<=r;)a.push(oe(i,"yyyy-MM-dd")),i.setDate(i.getDate()+1);return a},xb=s=>{const e=Array.from(new Set(s.filter(Boolean)));return e.sort(),e},$o=(s,e)=>{const t=ws(s.start),r=ws(s.end),a=ws(e.start),i=ws(e.end),o=s.endDate||r<=t,l=e.endDate||i<=a;if(!o&&!l)return t<i&&r>a;const c=24*60,h=o?r+c:r,u=l?i+c:i;return t<u&&h>a},Vs=()=>{const s=new Date,e=3*60,t=s.getTimezoneOffset();return new Date(s.getTime()+(e+t)*60*1e3)},Zg=(s,e=Vs())=>{const t=e.getHours(),r=new Date(`${gb(e,"yyyy-MM-dd")}T${s}:00`);return t>=21||e>r},D5=s=>{const e=Math.floor(s),t=Math.round((s-e)*60);return e===0&&t===0?"0ч":e===0?`${t}м`:t===0?`${e}ч`:`${e}ч ${t}м`},gs=(s,e,t,r)=>{const a=s,i=e||s;if(i<t||a>r)return 0;const o=a>t?a:t,l=i<r?i:r,c=Rs(o),u=Rs(l).getTime()-c.getTime();return Math.floor(u/(1e3*60*60*24))+1},M5=30,ef=s=>s.toString().padStart(2,"0"),$5=()=>{const s=new Date;return s.setDate(s.getDate()-M5),{dateOnly:`${s.getFullYear()} -${ef(s.getMonth()+1)} -${ef(s.getDate())} `,iso:s.toISOString()}},Ro=async(s,e,t)=>{const r=ut(De,s),a=nt(r,$t(e,"<",t)),i=await Kt(a);await Promise.all(i.docs.map(o=>As(bt(De,s,o.id))))},R5=async()=>{try{const{dateOnly:s,iso:e}=$5();await Promise.all([Ro("workSlots","date",s),Ro("dayStatuses","date",s),Ro("earnings","date",s),Ro("referrals","createdAt",e)])}catch(s){console.error("Failed to cleanup old data",s)}},Is=async(s,e)=>{const t=ut(De,"workSlots");let r;s&&e||s?r=nt(t,$t("userId","==",s)):e?r=nt(t,$t("date","==",e)):r=nt(t);let i=(await Kt(r)).docs.map(o=>{const l=o.data(),c=((l==null?void 0:l.slots)||[]).map(h=>h.break&&!h.breaks?{...h,breaks:[h.break],break:void 0}:h);return{id:o.id,userId:(l==null?void 0:l.userId)||"",date:(l==null?void 0:l.date)||"",slots:c,participants:(l==null?void 0:l.participants)||[],...(l==null?void 0:l.comment)&&{comment:l.comment}}});return s&&e&&(i=i.filter(o=>o.date===e)),i.sort((o,l)=>o.date.localeCompare(l.date)),i},bb=async s=>{try{console.log("addWorkSlot: Starting, db initialized:",!!De);const e=ut(De,"workSlots");console.log("addWorkSlot: Collection reference created");const t=Object.fromEntries(Object.entries(s).filter(([a,i])=>i!==void 0));console.log("addWorkSlot: Clean slot prepared:",t),console.log("addWorkSlot: Calling addDoc...");const r=await Es(e,t);return console.log("addWorkSlot: Work slot added successfully:",r.id),r}catch(e){throw console.error("addWorkSlot: Error caught:",e),console.error("addWorkSlot: Error code:",e==null?void 0:e.code),console.error("addWorkSlot: Error message:",e==null?void 0:e.message),console.error("addWorkSlot: Full error:",JSON.stringify(e,null,2)),e}},yb=async(s,e)=>{const t=bt(De,"workSlots",s),r=Object.fromEntries(Object.entries(e).filter(([a,i])=>i!==void 0));await bs(t,r)},bc=async s=>{const e=bt(De,"workSlots",s);await As(e)},Ar=async(s,e)=>{const t=ut(De,"dayStatuses");let r;s?r=nt(t,$t("userId","==",s)):r=nt(t);let i=(await Kt(r)).docs.map(o=>{const l=o.data();return{id:o.id,userId:(l==null?void 0:l.userId)||"",date:(l==null?void 0:l.date)||"",type:(l==null?void 0:l.type)||"dayoff",...(l==null?void 0:l.comment)&&{comment:l.comment},...(l==null?void 0:l.endDate)&&{endDate:l.endDate}}});return i.sort((o,l)=>o.date.localeCompare(l.date)),i},yc=async s=>{try{const e=ut(De,"dayStatuses"),t=Object.fromEntries(Object.entries(s).filter(([a,i])=>i!==void 0));console.log("Adding day status:",t);const r=await Es(e,t);return console.log("Day status added successfully:",r.id),r}catch(e){throw console.error("Error in addDayStatus:",e),e}},hn=async(s,e)=>{const t=bt(De,"dayStatuses",s),r=Object.fromEntries(Object.entries(e).filter(([a,i])=>i!==void 0));await bs(t,r)},vc=async s=>{const e=bt(De,"dayStatuses",s);await As(e)},Kd=async s=>{const e=ut(De,"restrictions");let t;s!==void 0?t=nt(e,$t("isActive","==",s)):t=nt(e);const a=(await Kt(t)).docs.map(i=>{const o=i.data();return{id:i.id,type:(o==null?void 0:o.type)||"all",startDate:(o==null?void 0:o.startDate)||"",endDate:o==null?void 0:o.endDate,startTime:o==null?void 0:o.startTime,blockFutureDates:(o==null?void 0:o.blockFutureDates)||!1,comment:o==null?void 0:o.comment,createdBy:(o==null?void 0:o.createdBy)||"",createdAt:(o==null?void 0:o.createdAt)||"",isActive:(o==null?void 0:o.isActive)??!0}});return a.sort((i,o)=>i.startDate.localeCompare(o.startDate)),a},P5=async s=>{try{const e=ut(De,"restrictions"),t=Object.fromEntries(Object.entries(s).filter(([a,i])=>i!==void 0));return await Es(e,t)}catch(e){throw console.error("Error adding restriction:",e),e}},O5=async(s,e)=>{const t=bt(De,"restrictions",s),r=Object.fromEntries(Object.entries(e).filter(([a,i])=>i!==void 0));await bs(t,r)},L5=async s=>{const e=bt(De,"restrictions",s);await As(e)},Rl=async(s,e,t)=>{try{const r=await Kd(!0),a=new Date;for(const i of r){if(i.type!=="all"&&i.type!==s)continue;const o=new Date(e),l=new Date(`${i.startDate}${i.startTime?`T${i.startTime}`:""} `);if(i.blockFutureDates&&a>=l){const u=new Date(i.startDate),m=new Date(u);if(m.setDate(u.getDate()+1),o.toDateString()===m.toDateString())return{restricted:!0,restriction:i,reason:`После ${oe(l,"dd.MM.yyyy")}${i.startTime?` ${i.startTime}`:""} запрещено создавать ${sd(s)} на следующий день ${oe(m,"dd.MM.yyyy")} `}}const c=new Date(i.startDate);let h=!1;if(i.endDate){const u=new Date(i.endDate);h=o>=c&&o<=u}else h=o.getTime()===c.getTime();if(h){if(!i.startTime)return{restricted:!0,restriction:i,reason:`Запрещено создавать ${sd(s)} на ${oe(o,"dd.MM.yyyy")} `};if(t&&i.startTime){const u=t,m=i.startTime;if(u>=m)return{restricted:!0,restriction:i,reason:`Запрещено создавать ${sd(s)} после ${m} на ${oe(o,"dd.MM.yyyy")} `}}}}return{restricted:!1}}catch(r){return console.error("Error checking restrictions:",r),{restricted:!1}}},sd=s=>({slots:"слоты",dayoff:"выходные",sick:"больничные",vacation:"отпуска",absence:"прогулы",all:"любые записи"})[s],wc="approvalRequests",pu=s=>{const e=s.data(),t=new Date().toISOString();return{id:s.id,entity:(e==null?void 0:e.entity)||"slot",action:(e==null?void 0:e.action)||"create",status:(e==null?void 0:e.status)||"pending",authorId:(e==null?void 0:e.authorId)||"",targetUserId:(e==null?void 0:e.targetUserId)||"",before:(e==null?void 0:e.before)??null,after:(e==null?void 0:e.after)??null,comment:e==null?void 0:e.comment,adminComment:e==null?void 0:e.adminComment,reviewedBy:e==null?void 0:e.reviewedBy,createdAt:(e==null?void 0:e.createdAt)||t,updatedAt:(e==null?void 0:e.updatedAt)||(e==null?void 0:e.createdAt)||t}},V5=async s=>{const e=s.before,t=s.after;switch(s.action){case"create":{if(!t)throw new Error("No slot payload for creation");const{id:r,...a}=t;await bb(a);return}case"update":{const r=(t==null?void 0:t.id)||(e==null?void 0:e.id);if(!r||!t)throw new Error("No slot payload for update");const{id:a,...i}=t;await yb(r,i);return}case"delete":{if(!(e!=null&&e.id))throw new Error("No slot id for delete");await bc(e.id);return}default:return}},F5=async s=>{const e=s.before,t=s.after;switch(s.action){case"create":{if(!t)throw new Error("No status payload for creation");const{id:r,...a}=t;await yc(a);return}case"update":{const r=(t==null?void 0:t.id)||(e==null?void 0:e.id);if(!r||!t)throw new Error("No status payload for update");const{id:a,...i}=t;await hn(r,i);return}case"delete":{if(!(e!=null&&e.id))throw new Error("No status id for delete");await vc(e.id);return}default:return}},U5=async s=>{const e=s.before,t=s.after;switch(s.action){case"create":{if(!t)throw new Error("No earning payload for creation");const{id:r,...a}=t;await wb(a);return}case"update":{const r=(t==null?void 0:t.id)||(e==null?void 0:e.id);if(!r||!t)throw new Error("No earning payload for update");const{id:a,...i}=t;await kb(r,i);return}case"delete":{if(!(e!=null&&e.id))throw new Error("No earning id for delete");await _b(e.id);return}default:return}},B5=async s=>{const e=s.before,t=s.after;switch(s.action){case"create":{if(!t)throw new Error("No referral payload for creation");const{id:r,...a}=t;await jb(a);return}case"update":{const r=(t==null?void 0:t.id)||(e==null?void 0:e.id);if(!r||!t)throw new Error("No referral payload for update");const{id:a,...i}=t;await Sb(r,i);return}case"delete":{if(!(e!=null&&e.id))throw new Error("No referral id for delete");await xu(e.id);return}default:return}},z5=async s=>{const e=s.after;switch(s.action){case"update":{if(!e||!e.nickname)throw new Error("No nickname payload for update");await tS(s.targetUserId,e.nickname);return}case"delete":{await sS(s.targetUserId);return}default:return}},It=async s=>{const e=ut(De,wc),t=new Date().toISOString(),r={...s,status:"pending",createdAt:t,updatedAt:t},a=Object.fromEntries(Object.entries(r).filter(([,o])=>o!==void 0));return await Es(e,a)},vb=async(s,e,t)=>{const r=ut(De,wc);let a;a=nt(r);let o=(await Kt(a)).docs.map(pu);return o.sort((l,c)=>c.createdAt.localeCompare(l.createdAt)),o},tf=async(s,e,t)=>{const r=bt(De,wc,s),a=await jx(r);if(!a.exists())return;const i=pu(a);if(i.status!=="pending")return;i.entity==="slot"?await V5(i):i.entity==="status"?await F5(i):i.entity==="earning"?await U5(i):i.entity==="referral"?await B5(i):i.entity==="login"&&(await z5(i),Gd(i.targetUserId),await Ir(i.targetUserId));const o={status:"approved",reviewedBy:e,updatedAt:new Date().toISOString()},l=i.adminComment;l!==void 0&&(o.adminComment=l),await bs(r,o)},sf=async(s,e,t)=>{const r=bt(De,wc,s),a=await jx(r);!a.exists()||pu(a).status!=="pending"||await bs(r,{status:"rejected",adminComment:t,reviewedBy:e,updatedAt:new Date().toISOString()})},Ui=async(s,e,t)=>{const r=ut(De,"earnings");let a;s?a=nt(r):e&&t?a=nt(r,$t("date",">=",e),$t("date","<=",t)):a=nt(r);let o=(await Kt(a)).docs.map(l=>{const c=l.data();return{id:l.id,userId:(c==null?void 0:c.userId)||"",date:(c==null?void 0:c.date)||"",amount:(c==null?void 0:c.amount)||0,poolAmount:(c==null?void 0:c.poolAmount)||0,slotId:(c==null?void 0:c.slotId)||"",extraWalletsCount:(c==null?void 0:c.extraWalletsCount)||0,extraWalletsAmount:(c==null?void 0:c.extraWalletsAmount)||0,category:(c==null?void 0:c.category)||"other",participants:(c==null?void 0:c.participants)||[]}});return s&&(o=o.filter(l=>(l.participants&&l.participants.length>0?[...l.participants,l.userId]:[l.userId]).includes(s))),s&&e&&t?o=o.filter(l=>l.date>=e&&l.date<=t):!s&&e&&t&&(o=o.filter(l=>l.date>=e&&l.date<=t)),o.sort((l,c)=>c.date.localeCompare(l.date)),o},wb=async s=>{try{const e=ut(De,"earnings"),t=Object.fromEntries(Object.entries(s).filter(([a,i])=>i!==void 0));console.log("Adding earnings:",t);const r=await Es(e,t);return console.log("Earnings added successfully:",r.id),r}catch(e){throw console.error("Error in addEarnings:",e),e}},kb=async(s,e)=>{const t=bt(De,"earnings",s),r=Object.fromEntries(Object.entries(e).filter(([a,i])=>i!==void 0));await bs(t,r)},_b=async s=>{const e=bt(De,"earnings",s);await As(e)},Nb=async s=>{const e=ut(De,"ratings");let t=nt(e);return s&&(t=nt(t,$t("userId","==",s))),(await Kt(t)).docs.map(a=>{const i=a.data();return{id:a.id,userId:i.userId||"",earnings:i.earnings||0,messages:i.messages||0,initiatives:i.initiatives||0,signals:i.signals||0,profitableSignals:i.profitableSignals||0,referrals:i.referrals||0,daysOff:i.daysOff||0,sickDays:i.sickDays||0,vacationDays:i.vacationDays||0,absenceDays:i.absenceDays||0,poolAmount:i.poolAmount||0,rating:i.rating||0,lastUpdated:i.lastUpdated||new Date().toISOString()}})},H5=async()=>{const s=nt(ut(De,"teamRatingHistory"),Pr("date","asc"));return(await Kt(s)).docs.map(t=>({id:t.id,date:t.data().date,averageRating:t.data().averageRating}))},jb=async s=>{try{const e=ut(De,"referrals"),t=Object.fromEntries(Object.entries(s).filter(([a,i])=>i!==void 0));console.log("Adding referral:",t);const r=await Es(e,t);return console.log("Referral added successfully:",r.id),r}catch(e){throw console.error("Error in addReferral:",e),e}},Eb=async(s,e,t)=>{const r=ut(De,"referrals");let a;a=nt(r,Pr("createdAt","desc"));let o=(await Kt(a)).docs.map(l=>{const c=l.data();return{id:l.id,referralId:c.referralId,ownerId:c.ownerId,name:c.name,age:c.age,createdAt:c.createdAt,comment:c.comment}});return e&&t&&(o=o.filter(l=>l.createdAt>=e&&l.createdAt<=t)),o.sort((l,c)=>l.createdAt<c.createdAt?1:-1)},Sb=async(s,e)=>{const t=bt(De,"referrals",s),r=Object.fromEntries(Object.entries(e).filter(([a,i])=>i!==void 0));await bs(t,r)},xu=async s=>{const e=bt(De,"referrals",s);await As(e)},W5=async s=>{if(console.log("📝 Service site: Creating call:",{category:s.category,userId:s.userId,status:s.status,createdAt:s.createdAt}),!De)throw console.error("❌ Service site: Firestore db is not initialized"),new Error("Firestore database is not initialized");const e=ut(De,"calls"),t=await Es(e,s);return console.log("✅ Service site: Call created successfully with ID:",t.id),console.log("📊 Service site: Call data saved to Firestore:",s),t.id},q5=async s=>{const e=ut(De,"calls"),t=[];t.push(Pr("createdAt","desc"));let r;return t.length>0?r=nt(e,...t):r=nt(e,Pr("createdAt","desc")),(await Kt(r)).docs.map(o=>{var p,j,_,y,M,D,T,R;const l=o.data(),c=l.category||"memecoins",h=!l.details&&l.ticker?{memecoins:{coinName:l.pair||l.ticker,ticker:l.ticker||"",network:l.network||"solana",contract:l.contract,signalType:l.sentiment||"buy",reason:l.comment||l.risks||"",entryCap:l.entryPoint||"",targets:l.target||"",stopLoss:l.cancelConditions,riskLevel:l.riskLevel||"medium",risks:l.risks||"",holdPlan:"short",liquidityLocked:!1,traderComment:l.comment}}:{},u=l.details||h||{},m=l.riskLevel||((p=u.memecoins)==null?void 0:p.riskLevel)||((j=u.polymarket)==null?void 0:j.riskLevel)||((_=u.staking)==null?void 0:_.protocolRisk)||((y=u.spot)==null?void 0:y.riskLevel)||((M=u.futures)==null?void 0:M.riskLevel),g=l.sentiment||((D=u.memecoins)==null?void 0:D.signalType)||(((T=u.futures)==null?void 0:T.direction)==="long"?"buy":((R=u.futures)==null?void 0:R.direction)==="short"?"sell":void 0);return{id:o.id,userId:l.userId||"",category:c,details:u,sentiment:g,riskLevel:m,comment:l.comment,createdAt:l.createdAt||new Date().toISOString(),status:l.status||"active",maxProfit:l.maxProfit,currentPnL:l.currentPnL,currentMarketCap:l.currentMarketCap,signalMarketCap:l.signalMarketCap,currentPrice:l.currentPrice,entryPrice:l.entryPrice,tags:l.tags||[]}})},Tb=async(s,e)=>{const t=bt(De,"calls",s);await bs(t,e)},G5=async s=>{const e=bt(De,"calls",s);await As(e)},K5=async s=>{const e=ut(De,"tasks");return(await Es(e,s)).id},bu=async s=>{const e=ut(De,"tasks"),t=[];s!=null&&s.status&&t.push($t("status","==",s.status)),s!=null&&s.category&&t.push($t("category","==",s.category)),s!=null&&s.createdBy&&t.push($t("createdBy","==",s.createdBy)),t.push(Pr("createdAt","desc"));let r;t.length>0?r=nt(e,...t):r=nt(e,Pr("createdAt","desc"));const a=await Kt(r),i=g=>g==="high"||g==="low"||g==="urgent"?g:"medium",o=g=>g==="completed"||g==="closed"?g:"in_progress",l=(g=[])=>g.filter(p=>p==null?void 0:p.userId).slice(0,10).map(p=>({userId:p.userId,priority:i(p.priority),comment:p.comment,instruction:p.instruction}));let c=a.docs.map(g=>{const p=g.data(),_=((Array.isArray(p.assignees)?p.assignees:(p.assignedTo||[]).map(T=>({userId:T,priority:"medium"})))||[]).map(T=>({userId:T.userId||"",priority:i(T.priority),comment:T.comment})).filter(T=>!!T.userId),y=_.map(T=>T.userId),M=Array.isArray(p.coExecutors)?p.coExecutors:Array.isArray(p.executors)?p.executors:[],D=(p.stages||[]).map(T=>({id:T.id||`stage - ${Date.now()} `,name:T.name||"Этап",description:T.description,responsible:T.responsible==="all"?"all":Array.isArray(T.responsible)?T.responsible:(T.assignees||[]).map(R=>R.userId),assignees:l(T.assignees),stagePriority:i(T.stagePriority),requiresApproval:T.requiresApproval??!0,approvals:T.approvals||[],comments:T.comments||[],status:T.status||"pending"}));return{id:g.id,title:p.title||"",description:p.description,category:p.category||"trading",status:o(p.status),createdBy:p.createdBy||"",assignedTo:y,assignees:_,approvals:p.approvals||[],createdAt:p.createdAt||new Date().toISOString(),updatedAt:p.updatedAt||new Date().toISOString(),completedAt:p.completedAt,closedAt:p.closedAt,completedBy:p.completedBy,priority:i(p.priority),dueDate:p.dueDate||new Date().toISOString().split("T")[0],dueTime:p.dueTime||"12:00",startTime:p.startTime,mainExecutor:p.mainExecutor,leadExecutor:p.leadExecutor,deputies:p.deputies||[],coExecutors:M,executors:p.executors||[],curators:p.curators||[],leads:p.leads||[],stages:D,currentStageId:p.currentStageId,awaitingStageId:p.awaitingStageId,comments:p.comments||[],expectedResult:p.expectedResult,requiresApproval:p.requiresApproval??!0}});const h=new Date,u=new Date(h.getTime()-12*60*60*1e3),m=c.filter(g=>g.status==="closed"&&g.closedAt?new Date(g.closedAt)<u:!1);if(m.length>0&&(await Promise.all(m.map(g=>Ib(g.id))),c=c.filter(g=>!m.find(p=>p.id===g.id))),s!=null&&s.assignedTo)if(Array.isArray(s.assignedTo)){const g=s.assignedTo;g.length>0&&(c=c.filter(p=>g.some(j=>p.assignedTo.includes(j))))}else c=c.filter(g=>g.assignedTo.includes(s.assignedTo));return c},kr=async(s,e)=>{const t=bt(De,"tasks",s),r=Object.fromEntries(Object.entries({...e,updatedAt:new Date().toISOString()}).filter(([a,i])=>i!==void 0));await bs(t,r)},Ib=async s=>{const e=bt(De,"tasks",s);await As(e)},rf=async(s,e=!1)=>{const t=ut(De,"notes");let r;!e&&s?r=nt(t,$t("userId","==",s)):r=nt(t);const i=(await Kt(r)).docs.map(o=>{const l=o.data();return{id:o.id,userId:l.userId||"",title:l.title||"",text:l.text||"",priority:l.priority==="low"||l.priority==="high"?l.priority:"medium",createdAt:l.createdAt||new Date().toISOString(),updatedAt:l.updatedAt||new Date().toISOString()}});return i.sort((o,l)=>(l.updatedAt||"").localeCompare(o.updatedAt||"")),s&&!e?i.filter(o=>o.userId===s):i},Y5=async s=>{const e=ut(De,"notes"),t={...s,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};return(await Es(e,t)).id},Q5=async(s,e)=>{const t=bt(De,"notes",s),r=Object.fromEntries(Object.entries({...e,updatedAt:new Date().toISOString()}).filter(([a,i])=>i!==void 0));await bs(t,r)},X5=async s=>{const e=bt(De,"notes",s);await As(e)},J5=async()=>{const s=ut(De,"userActivities"),e=nt(s,Pr("loginAt","desc")),r=(await Kt(e)).docs.map(i=>{const o=i.data();return{id:i.id,userId:o.userId||"",loginAt:o.loginAt||new Date().toISOString(),logoutAt:o.logoutAt||void 0,browser:o.browser||"Unknown",userAgent:o.userAgent||"",sessionDuration:o.sessionDuration||void 0,isActive:o.isActive!==!1,pageViews:o.pageViews||[]}}),a=new Map;for(const i of r){const o=a.get(i.userId);(!o||new Date(i.loginAt)>new Date(o.loginAt))&&a.set(i.userId,i)}return Array.from(a.values())},Z5=async s=>{const e=ut(De,"userActivities");return(await Es(e,s)).id},Yd=async(s,e)=>{const t=bt(De,"userActivities",s),r=Object.fromEntries(Object.entries(e).filter(([a,i])=>i!==void 0));await bs(t,r)},rd=async(s,e,t)=>{await Yd(s,{logoutAt:e,sessionDuration:t,isActive:!1})},kc=async s=>{const e=ut(De,"userNicknames"),t=nt(e,$t("userId","==",s)),r=await Kt(t);if(r.empty)return null;const a=r.docs[0].data();return{id:r.docs[0].id,userId:a.userId||"",nickname:a.nickname||"",createdAt:a.createdAt||new Date().toISOString(),updatedAt:a.updatedAt||new Date().toISOString()}},eS=async s=>{const e=await kc(s);return(e==null?void 0:e.nickname)||null},tS=async(s,e)=>{const t=ut(De,"userNicknames"),r=await kc(s),a=new Date().toISOString();if(r){const i=bt(De,"userNicknames",r.id);return await bs(i,{nickname:e,updatedAt:a}),r.id}else return(await Es(t,{userId:s,nickname:e,createdAt:a,updatedAt:a})).id},sS=async s=>{const e=await kc(s);e&&await As(bt(De,"userNicknames",e.id))},rS=async()=>{const s=ut(De,"userActivities"),e=new Date,t=new Date(e.getTime()-24*60*60*1e3),r=nt(s,Pr("loginAt","desc"));return(await Kt(r)).docs.map(o=>{const l=o.data();return{id:o.id,userId:l.userId||"",loginAt:l.loginAt||new Date().toISOString(),logoutAt:l.logoutAt||void 0,browser:l.browser||"Unknown",userAgent:l.userAgent||"",sessionDuration:l.sessionDuration||void 0,isActive:l.isActive!==!1,pageViews:l.pageViews||[]}}).filter(o=>new Date(o.loginAt)>=t)},Ab=async(s,e)=>{const t=ut(De,"userConflicts");let r;return s&&e!==void 0?r=nt(t,$t("isActive","==",e),$t("userId","==",s)):s?r=nt(t,$t("userId","==",s)):e!==void 0?r=nt(t,$t("isActive","==",e)):r=nt(t),(await Kt(r)).docs.map(i=>{const o=i.data();return{id:i.id,userId:(o==null?void 0:o.userId)||"",restrictedUserId:(o==null?void 0:o.restrictedUserId)||"",reason:(o==null?void 0:o.reason)||"",createdBy:(o==null?void 0:o.createdBy)||"",createdAt:(o==null?void 0:o.createdAt)||"",isActive:(o==null?void 0:o.isActive)??!0}})},nS=async s=>{const e=ut(De,"userConflicts");return await Es(e,s)},nf=async(s,e)=>{const t=bt(De,"userConflicts",s);await bs(t,e)},aS=async s=>{const e=bt(De,"userConflicts",s);await As(e)},Qd=async(s,e)=>{const t=ut(De,"accessBlocks");let r;return s&&e!==void 0?r=nt(t,$t("isActive","==",e),$t("userId","==",s)):s?r=nt(t,$t("userId","==",s)):e!==void 0?r=nt(t,$t("isActive","==",e)):r=nt(t),(await Kt(r)).docs.map(i=>{const o=i.data();return{id:i.id,userId:o==null?void 0:o.userId,reason:(o==null?void 0:o.reason)||"",createdBy:(o==null?void 0:o.createdBy)||"",createdAt:(o==null?void 0:o.createdAt)||"",expiresAt:o==null?void 0:o.expiresAt,isActive:(o==null?void 0:o.isActive)??!0,blockFeatures:(o==null?void 0:o.blockFeatures)||[]}})},iS=async s=>{const e=ut(De,"accessBlocks");return await Es(e,s)},Pl=async(s,e)=>{const t=bt(De,"accessBlocks",s);await bs(t,e)},oS=async s=>{const e=bt(De,"accessBlocks",s);await As(e)},yu=async(s,e)=>{try{const t=await Qd(void 0,!0);for(const a of t)if(!a.userId&&a.blockFeatures.includes("all")||a.blockFeatures.includes(e)){if(a.expiresAt&&new Date(a.expiresAt)<new Date){await Pl(a.id,{isActive:!1});continue}return{hasAccess:!1,reason:a.reason,expiresAt:a.expiresAt}}const r=await Qd(s,!0);for(const a of r)if(a.blockFeatures.includes("all")||a.blockFeatures.includes(e)){if(a.expiresAt&&new Date(a.expiresAt)<new Date){await Pl(a.id,{isActive:!1});continue}return{hasAccess:!1,reason:a.reason,expiresAt:a.expiresAt}}return{hasAccess:!0,reason:void 0,expiresAt:void 0}}catch(t){return console.error("Error checking user access:",t),{hasAccess:!0,reason:void 0,expiresAt:void 0}}},lS=async()=>{const s=ut(De,"aiAlerts"),e=nt(s,Pr("createdAt","desc"));return(await Kt(e)).docs.map(r=>({id:r.id,...r.data()}))},cS=async s=>{const e=ut(De,"aiAlerts"),t=Object.fromEntries(Object.entries(s).filter(([a,i])=>i!==void 0));return await Es(e,t)},dS=async(s,e)=>{const t=bt(De,"aiAlerts",s),r=Object.fromEntries(Object.entries(e).filter(([a,i])=>i!==void 0));await bs(t,r)},hS=async s=>{const e=bt(De,"aiAlerts",s);await As(e)},af=[{value:"solana",label:"Solana"},{value:"ethereum",label:"ETH"},{value:"bsc",label:"BSC"},{value:"ton",label:"TON"},{value:"base",label:"Base"},{value:"sui",label:"SUI"},{value:"monad",label:"Monad"},{value:"polygon",label:"Polygon"}],sa={memecoins:{label:"Мемкоины",gradient:"from-emerald-300 to-teal-400",icon:n.jsx(Xi,{className:"w-5 h-5"}),pastelBg:"bg-emerald-50",pastelBorder:"border-emerald-100",pastelText:"text-emerald-800"},futures:{label:"Фьючерсы",gradient:"from-sky-300 to-indigo-400",icon:n.jsx(Ql,{className:"w-5 h-5"}),pastelBg:"bg-sky-50",pastelBorder:"border-sky-100",pastelText:"text-sky-800"},nft:{label:"NFT",gradient:"from-purple-300 to-pink-300",icon:n.jsx(Yl,{className:"w-5 h-5"}),pastelBg:"bg-purple-50",pastelBorder:"border-purple-100",pastelText:"text-purple-800"},spot:{label:"Спот",gradient:"from-amber-300 to-orange-300",icon:n.jsx(fs,{className:"w-5 h-5"}),pastelBg:"bg-amber-50",pastelBorder:"border-amber-100",pastelText:"text-amber-800"},polymarket:{label:"Polymarket",gradient:"from-rose-300 to-red-300",icon:n.jsx(os,{className:"w-5 h-5"}),pastelBg:"bg-rose-50",pastelBorder:"border-rose-100",pastelText:"text-rose-800"},staking:{label:"Стейкинг",gradient:"from-cyan-300 to-blue-300",icon:n.jsx(Ot,{className:"w-5 h-5"}),pastelBg:"bg-cyan-50",pastelBorder:"border-cyan-100",pastelText:"text-cyan-800"}},uS={memecoins:{basic:{title:"Основная информация",icon:n.jsx($s,{className:"w-4 h-4"}),description:"Базовые данные о монете"},entry:{title:"Зоны входа",icon:n.jsx(ks,{className:"w-4 h-4"}),description:"Условия для входа в позицию"},targets:{title:"Цели и риски",icon:n.jsx(Ut,{className:"w-4 h-4"}),description:"План прибыли и управления рисками"},additional:{title:"Дополнительно",icon:n.jsx(Yr,{className:"w-4 h-4"}),description:"Дополнительные настройки и комментарии"}},futures:{basic:{title:"Основная информация",icon:n.jsx($s,{className:"w-4 h-4"}),description:"Данные о паре и направлении"},entry:{title:"Зоны входа",icon:n.jsx(ks,{className:"w-4 h-4"}),description:"Условия входа и размер позиции"},targets:{title:"Цели и риски",icon:n.jsx(Ut,{className:"w-4 h-4"}),description:"План прибыли и стоп-лоссы"},strategy:{title:"Стратегия",icon:n.jsx(os,{className:"w-4 h-4"}),description:"Тип сигнала и анализ"},additional:{title:"Дополнительно",icon:n.jsx(Yr,{className:"w-4 h-4"}),description:"Комментарии и детали"}},nft:{basic:{title:"Основная информация",icon:n.jsx($s,{className:"w-4 h-4"}),description:"Данные о NFT и коллекции"},entry:{title:"Условия входа",icon:n.jsx(ks,{className:"w-4 h-4"}),description:"Цена и условия покупки"},targets:{title:"Цели и риски",icon:n.jsx(Ut,{className:"w-4 h-4"}),description:"План продажи и риски"},additional:{title:"Дополнительно",icon:n.jsx(Yr,{className:"w-4 h-4"}),description:"Анализ и комментарии"}},spot:{basic:{title:"Основная информация",icon:n.jsx($s,{className:"w-4 h-4"}),description:"Данные о монете"},entry:{title:"Зоны входа",icon:n.jsx(ks,{className:"w-4 h-4"}),description:"Условия входа в позицию"},targets:{title:"Цели и риски",icon:n.jsx(Ut,{className:"w-4 h-4"}),description:"План прибыли и стоп-лоссы"},additional:{title:"Дополнительно",icon:n.jsx(Yr,{className:"w-4 h-4"}),description:"Анализ и комментарии"}},polymarket:{basic:{title:"Основная информация",icon:n.jsx($s,{className:"w-4 h-4"}),description:"Данные о событии"},entry:{title:"Условия входа",icon:n.jsx(ks,{className:"w-4 h-4"}),description:"Позиция и цена входа"},targets:{title:"Цели и риски",icon:n.jsx(Ut,{className:"w-4 h-4"}),description:"План прибыли и риски"},additional:{title:"Дополнительно",icon:n.jsx(Yr,{className:"w-4 h-4"}),description:"Анализ и детали"}},staking:{basic:{title:"Основная информация",icon:n.jsx($s,{className:"w-4 h-4"}),description:"Данные о стейкинге"},entry:{title:"Условия входа",icon:n.jsx(ks,{className:"w-4 h-4"}),description:"Платформа и условия"},targets:{title:"Риски и анализ",icon:n.jsx(Xt,{className:"w-4 h-4"}),description:"Оценка рисков"},additional:{title:"Дополнительно",icon:n.jsx(Yr,{className:"w-4 h-4"}),description:"Комментарии и детали"}}},of={memecoins:[{key:"coinName",label:"Название монеты",placeholder:"PEPE",section:"basic"},{key:"ticker",label:"Тикер",placeholder:"PEPE",section:"basic"},{key:"network",label:"Сеть",type:"select",options:af,section:"basic"},{key:"contract",label:"Контракт",placeholder:"0x...",section:"basic"},{key:"signalType",label:"Тип сигнала",type:"select",options:[{value:"buy",label:"Buy"},{value:"sell",label:"Sell"},{value:"hold",label:"Hold"},{value:"alert",label:"Alert"}],section:"basic"},{key:"reason",label:"Причина входа",placeholder:"Хайп, крупные покупки, листинг...",type:"textarea",section:"entry"},{key:"entryCap",label:"Зона входа в капитализации",placeholder:"10M-15M",section:"entry"},{key:"targets",label:"Цели (TP1/TP2/TP3)",placeholder:"20M / 30M / 50M",section:"targets"},{key:"stopLoss",label:"Стоп-лосс",placeholder:"5M или -25%",section:"targets"},{key:"riskLevel",label:"Риск-уровень",type:"select",options:[{value:"low",label:"Низкий"},{value:"medium",label:"Средний"},{value:"high",label:"Высокий"},{value:"ultra",label:"Ультра-высокий"}],section:"targets"},{key:"risks",label:"Риски",placeholder:"Разворот тренда, низкая ликвидность",type:"textarea",section:"targets"},{key:"holdPlan",label:"План удержания",type:"select",options:[{value:"flip",label:"Флип"},{value:"short",label:"Краткосрок"},{value:"medium",label:"Среднесрок"},{value:"long",label:"Дальнесрок"}],section:"additional"},{key:"liquidityLocked",label:"Залочена ли ликвидность",type:"checkbox",section:"additional"},{key:"traderComment",label:"Комментарий трейдера",type:"textarea",placeholder:"Доп. наблюдения, планы",section:"additional"}],futures:[{key:"pair",label:"Пара",placeholder:"BTC/USDT",section:"basic"},{key:"direction",label:"Направление",type:"select",options:[{value:"long",label:"Long"},{value:"short",label:"Short"}],section:"basic"},{key:"leverage",label:"Рекомендованное плечо",placeholder:"x3 - x10",section:"entry"},{key:"entryPrice",label:"Цена входа",placeholder:"69500",section:"entry"},{key:"entryZone",label:"Зоны входа (min-max)",placeholder:"69000 - 70000",section:"entry"},{key:"positionSize",label:"Размер позиции (% от депо)",placeholder:"2-5%",section:"entry"},{key:"targets",label:"Цели (TP1/TP2/TP3)",placeholder:"71000 / 72500 / 74000",section:"targets"},{key:"stopLoss",label:"SL уровень",placeholder:"68000",section:"targets"},{key:"riskLevel",label:"Риск-уровень",type:"select",options:[{value:"low",label:"Низкий"},{value:"medium",label:"Средний"},{value:"high",label:"Высокий"},{value:"ultra",label:"Ультра-высокий"}],section:"targets"},{key:"signalStyle",label:"Тип сигнала",type:"select",options:[{value:"breakout",label:"Breakout"},{value:"retest",label:"Retest"},{value:"range",label:"Range"},{value:"scalping",label:"Scalping"},{value:"swing",label:"Swing"}],section:"strategy"},{key:"timeframe",label:"Таймфрейм анализа",type:"select",options:[{value:"1m",label:"1m"},{value:"5m",label:"5m"},{value:"15m",label:"15m"},{value:"1h",label:"1h"},{value:"4h",label:"4h"}],section:"strategy"},{key:"reason",label:"Причина входа (анализ)",placeholder:"Тренд, объемы, дивергенция...",type:"textarea",section:"strategy"},{key:"risks",label:"Риски",placeholder:"Резкий вброс, низкая волатильность",type:"textarea",section:"additional"}],nft:[{key:"collectionLink",label:"Коллекция (ссылка)",placeholder:"https://...",section:"basic"},{key:"nftLink",label:"NFT (ссылка)",placeholder:"https://.../item",section:"basic"},{key:"marketplace",label:"Маркетплейс",placeholder:"OpenSea / Magic Eden",section:"basic"},{key:"network",label:"Сеть",type:"select",options:af,section:"basic"},{key:"entryPrice",label:"Рекомендованная цена входа",placeholder:"1.2 ETH",section:"entry"},{key:"rarity",label:"Редкость / атрибуты",placeholder:"Rank < 5%",section:"entry"},{key:"minLiquidity",label:"Минимальная ликвидность",placeholder:"Floor 2 ETH, объём 120 ETH",section:"entry"},{key:"signalType",label:"Тип сигнала",type:"select",options:[{value:"buy",label:"Buy"},{value:"sell",label:"Sell"},{value:"mint",label:"Mint"}],section:"entry"},{key:"holdingHorizon",label:"Срок удержания",type:"select",options:[{value:"flip",label:"Скоростной флип"},{value:"short",label:"Краткосрок"},{value:"medium",label:"Среднесрок"},{value:"long",label:"Долгосрок"}],section:"targets"},{key:"targetPrice",label:"Цель продажи / Target price",placeholder:"3 ETH",section:"targets"},{key:"risks",label:"Риски",placeholder:"Падение спроса, фальшивый объём",type:"textarea",section:"targets"},{key:"reason",label:"Причина входа",placeholder:"Минт, хайп, инсайд",type:"textarea",section:"additional"},{key:"traderComment",label:"Комментарий трейдера",type:"textarea",placeholder:"Что смотрим, когда фиксируем",section:"additional"}],spot:[{key:"coin",label:"Монета",placeholder:"BTC",section:"basic"},{key:"entryCap",label:"Капитализация входа",placeholder:"500M",section:"entry"},{key:"positionSize",label:"Размер позиции",placeholder:"5-10% портфеля",section:"entry"},{key:"targets",label:"Цели (TP1/TP2/TP3)",placeholder:"550M / 650M / 750M",section:"targets"},{key:"stopLoss",label:"SL",placeholder:"-10%",section:"targets"},{key:"holdingHorizon",label:"Горизонт удержания",type:"select",options:[{value:"short",label:"Краткосрок"},{value:"medium",label:"Среднесрок"},{value:"long",label:"Долгосрок"}],section:"targets"},{key:"riskLevel",label:"Риск-уровень",type:"select",options:[{value:"low",label:"Низкий"},{value:"medium",label:"Средний"},{value:"high",label:"Высокий"},{value:"ultra",label:"Ультра-высокий"}],section:"targets"},{key:"reason",label:"Причина входа",placeholder:"Фундаментал, хайп",type:"textarea",section:"additional"},{key:"risks",label:"Риски",placeholder:"Регуляторика, конкуренты",type:"textarea",section:"additional"},{key:"traderComment",label:"Комментарий",type:"textarea",placeholder:"Условия фиксации, обновления",section:"additional"}],polymarket:[{key:"event",label:"Событие",placeholder:"Trump wins 2025",section:"basic"},{key:"eventDeadline",label:"Срок исхода события",placeholder:"31.12.2025",section:"basic"},{key:"positionType",label:"Тип позиции",type:"select",options:[{value:"yes",label:"Yes"},{value:"no",label:"No"}],section:"entry"},{key:"entryPrice",label:"Цена входа (%)",placeholder:"42%",section:"entry"},{key:"expectedProbability",label:"Ожидаемая вероятность (%)",placeholder:"65%",section:"entry"},{key:"maxStake",label:"Максимальный объём ставки",placeholder:"до $5k",section:"entry"},{key:"targetPlan",label:"Цель",placeholder:"Продажа до события или удержание",section:"targets"},{key:"riskLevel",label:"Риск",type:"select",options:[{value:"low",label:"Низкий"},{value:"medium",label:"Средний"},{value:"high",label:"Высокий"},{value:"ultra",label:"Ультра-высокий"}],section:"targets"},{key:"risks",label:"Риски",placeholder:"Неопределённость новостей, низкая ликвидность",type:"textarea",section:"targets"},{key:"reason",label:"Причина входа",placeholder:"Аналитика, инсайд",type:"textarea",section:"additional"}],staking:[{key:"coin",label:"Монета",placeholder:"SOL",section:"basic"},{key:"platform",label:"Платформа",placeholder:"Jito, Lido...",section:"entry"},{key:"term",label:"Срок стейкинга",type:"select",options:[{value:"flexible",label:"Гибкий"},{value:"30d",label:"30 дней"},{value:"90d",label:"90 дней"},{value:"fixed",label:"Фиксированный"}],section:"entry"},{key:"apy",label:"APY",placeholder:"12-18%",section:"entry"},{key:"minDeposit",label:"Минимальный депозит",placeholder:"100 USDT",section:"entry"},{key:"action",label:"Тип сигнала",type:"select",options:[{value:"enter",label:"Вход"},{value:"exit",label:"Выход"},{value:"rebalance",label:"Перераспределение"}],section:"entry"},{key:"protocolRisk",label:"Риски протокола",type:"select",options:[{value:"low",label:"Низкие"},{value:"medium",label:"Средние"},{value:"high",label:"Высокие"},{value:"ultra",label:"Ультра"}],section:"targets"},{key:"risks",label:"Риски",placeholder:"Смарт-контракт, ликвидность",type:"textarea",section:"targets"},{key:"reason",label:"Причина",placeholder:"Рост доходности",type:"textarea",section:"additional"},{key:"traderComment",label:"Комментарий трейдера",type:"textarea",placeholder:"Тактика выхода, дополнительные условия",section:"additional"}]},lf=()=>({memecoins:{coinName:"",ticker:"",network:"solana",contract:"",signalType:"buy",reason:"",entryCap:"",targets:"",stopLoss:"",riskLevel:"medium",risks:"",holdPlan:"short",liquidityLocked:!1,traderComment:""},futures:{pair:"",direction:"long",leverage:"",entryPrice:"",entryZone:"",targets:"",stopLoss:"",signalStyle:"breakout",positionSize:"",reason:"",timeframe:"1h",risks:"",riskLevel:"medium"},nft:{collectionLink:"",nftLink:"",marketplace:"",network:"ethereum",entryPrice:"",rarity:"",signalType:"buy",reason:"",holdingHorizon:"short",minLiquidity:"",targetPrice:"",traderComment:"",risks:""},spot:{coin:"",entryCap:"",targets:"",stopLoss:"",holdingHorizon:"medium",reason:"",positionSize:"",risks:"",traderComment:"",riskLevel:"medium"},polymarket:{event:"",positionType:"yes",entryPrice:"",expectedProbability:"",reason:"",eventDeadline:"",riskLevel:"medium",maxStake:"",risks:"",targetPlan:""},staking:{coin:"",platform:"",term:"flexible",apy:"",minDeposit:"",protocolRisk:"medium",action:"enter",reason:"",risks:"",traderComment:""}}),cf=(s,e)=>({memecoins:{...s.memecoins,...(e==null?void 0:e.memecoins)||{}},futures:{...s.futures,...(e==null?void 0:e.futures)||{}},nft:{...s.nft,...(e==null?void 0:e.nft)||{}},spot:{...s.spot,...(e==null?void 0:e.spot)||{}},polymarket:{...s.polymarket,...(e==null?void 0:e.polymarket)||{}},staking:{...s.staking,...(e==null?void 0:e.staking)||{}}}),mS=({onSuccess:s,onCancel:e,callToEdit:t,initialCategory:r})=>{const{theme:a}=lt(),{user:i}=_t(),[o,l]=I.useState(!1),[c,h]=I.useState(""),[u,m]=I.useState(!1),g=cf(lf(),t==null?void 0:t.details),[p,j]=I.useState((t==null?void 0:t.category)||r||"memecoins"),[_,y]=I.useState((t==null?void 0:t.comment)||""),[M,D]=I.useState(g);I.useEffect(()=>{const $=cf(lf(),t==null?void 0:t.details);D($),j((t==null?void 0:t.category)||r||"memecoins"),y((t==null?void 0:t.comment)||"")},[t,r]);const T=a==="dark"?"text-white":"text-gray-900",R=a==="dark"?"border-gray-800":"border-gray-200",P=a==="dark"?"bg-gray-700/60":"bg-gray-50",C=a==="dark"?"text-gray-400":"text-gray-500",N=C,b=a==="dark"?"bg-[#121212]":"bg-white",v=($,O)=>{D(J=>({...J,[p]:{...J[p],[$]:O}}))},S=$=>($==null?void 0:$.riskLevel)||($==null?void 0:$.protocolRisk)||void 0,E=$=>{if($!=null&&$.signalType)return $.signalType;if(($==null?void 0:$.direction)==="long")return"buy";if(($==null?void 0:$.direction)==="short")return"sell"},w=(()=>{const O=of[p].filter(Z=>Z.required),J=M[p]||{};let Y=0;return O.forEach(Z=>{const L=J[Z.key];L!=null&&L!==""&&Y++}),{filled:Y,total:O.length,percentage:O.length>0?Math.round(Y/O.length*100):100}})(),Q={low:"bg-emerald-500/10 text-emerald-600 border border-emerald-500/20",medium:"bg-blue-500/10 text-blue-600 border border-blue-500/20",high:"bg-amber-500/10 text-amber-600 border border-amber-500/20",ultra:"bg-red-500/10 text-red-600 border border-red-500/20"},ae={memecoins:{bg:a==="dark"?"bg-emerald-500/10":"bg-emerald-50",text:a==="dark"?"text-emerald-100":"text-emerald-800",border:a==="dark"?"border-emerald-500/30":"border-emerald-200",chipBg:a==="dark"?"bg-emerald-500/20":"bg-emerald-500/10"},futures:{bg:a==="dark"?"bg-sky-500/10":"bg-sky-50",text:a==="dark"?"text-sky-100":"text-sky-800",border:a==="dark"?"border-sky-500/30":"border-sky-200",chipBg:a==="dark"?"bg-sky-500/20":"bg-sky-500/10"},nft:{bg:a==="dark"?"bg-purple-500/10":"bg-purple-50",text:a==="dark"?"text-purple-100":"text-purple-800",border:a==="dark"?"border-purple-500/30":"border-purple-200",chipBg:a==="dark"?"bg-purple-500/20":"bg-purple-500/10"},spot:{bg:a==="dark"?"bg-amber-500/10":"bg-amber-50",text:a==="dark"?"text-amber-100":"text-amber-800",border:a==="dark"?"border-amber-500/30":"border-amber-200",chipBg:a==="dark"?"bg-amber-500/20":"bg-amber-500/10"},polymarket:{bg:a==="dark"?"bg-rose-500/10":"bg-rose-50",text:a==="dark"?"text-rose-100":"text-rose-800",border:a==="dark"?"border-rose-500/30":"border-rose-200",chipBg:a==="dark"?"bg-rose-500/20":"bg-rose-500/10"},staking:{bg:a==="dark"?"bg-cyan-500/10":"bg-cyan-50",text:a==="dark"?"text-cyan-100":"text-cyan-800",border:a==="dark"?"border-cyan-500/30":"border-cyan-200",chipBg:a==="dark"?"bg-cyan-500/20":"bg-cyan-500/10"}},V=$=>{var O;return((O=$.details)==null?void 0:O[$.category])||{}},X=$=>{const O=V($);switch($.category){case"memecoins":return O.coinName||O.ticker||"Мемкоин";case"futures":return O.pair||"Фьючерс";case"nft":return O.collectionLink||"NFT коллекция";case"spot":return O.coin||"Спот";case"polymarket":return O.event||"Polymarket событие";case"staking":return O.coin||"Стейкинг";default:return"Сигнал"}},he=$=>{const O=V($);switch($.category){case"memecoins":return`${O.ticker||""} ${O.network?`• ${String(O.network).toUpperCase()}`:""}`.trim();case"futures":return`${O.direction==="long"?"Long":"Short"} • ${O.timeframe||""}`;case"nft":return`${O.marketplace||""}${O.network?` • ${String(O.network).toUpperCase()}`:""}`;case"spot":return O.holdingHorizon?`Горизонт: ${O.holdingHorizon}`:"";case"polymarket":return`${O.positionType==="yes"?"YES":"NO"} • ${O.entryPrice||""}`;case"staking":return`${O.platform||""}${O.term?` • ${O.term}`:""}`;default:return""}},B=$=>$.riskLevel||V($).riskLevel||V($).protocolRisk||"medium",te=($,O=28)=>{if(!$)return"";if($.length<=O)return $;const J=$.slice(0,Math.floor(O/2)),Y=$.slice(-6);return`${J}...${Y}`},ve=$=>{const O=V($),J=B($),Y=ae[$.category],Z=[],L=(ge,H,se)=>{H&&Z.push({label:ge,value:H,icon:se})};switch($.category){case"memecoins":L("Монета",O.coinName,n.jsx(fs,{className:"w-4 h-4"})),L("Тикер",te(O.ticker,8),n.jsx(Fp,{className:"w-4 h-4"})),L("Сеть",O.network?String(O.network).toUpperCase():"",n.jsx(Vp,{className:"w-4 h-4"})),L("Тип сигнала",O.signalType?O.signalType.toUpperCase():"",n.jsx(ha,{className:"w-4 h-4"})),L("Зона входа",O.entryCap,n.jsx(ks,{className:"w-4 h-4"})),L("Цели",O.targets,n.jsx(os,{className:"w-4 h-4"})),L("SL",O.stopLoss,n.jsx(da,{className:"w-4 h-4"})),L("План",O.holdPlan,n.jsx(on,{className:"w-4 h-4"})),L("Ликвидность",O.liquidityLocked?"Залочена":"",n.jsx(Ot,{className:"w-4 h-4"}));break;case"futures":L("Пара",O.pair,n.jsx(hh,{className:"w-4 h-4"})),L("Направление",O.direction?O.direction.toUpperCase():"",n.jsx(Ut,{className:"w-4 h-4"})),L("Плечо",O.leverage,n.jsx($n,{className:"w-4 h-4"})),L("Зона входа",O.entryZone||O.entryPrice,n.jsx(ks,{className:"w-4 h-4"})),L("Цели",O.targets,n.jsx(os,{className:"w-4 h-4"})),L("SL",O.stopLoss,n.jsx(da,{className:"w-4 h-4"})),L("Стиль",O.signalStyle,n.jsx(ha,{className:"w-4 h-4"})),L("Размер позиции",O.positionSize,n.jsx(en,{className:"w-4 h-4"})),L("Таймфрейм",O.timeframe,n.jsx(xh,{className:"w-4 h-4"}));break;case"nft":L("Коллекция",O.collectionLink,n.jsx(xd,{className:"w-4 h-4"})),L("Маркетплейс",O.marketplace,n.jsx(hl,{className:"w-4 h-4"})),L("Сеть",O.network?String(O.network).toUpperCase():"",n.jsx(Bp,{className:"w-4 h-4"})),L("Вход",O.entryPrice,n.jsx(ks,{className:"w-4 h-4"})),L("Редкость",O.rarity,n.jsx(xs,{className:"w-4 h-4"})),L("Тип сигнала",O.signalType?O.signalType.toUpperCase():"",n.jsx(ha,{className:"w-4 h-4"})),L("Срок удержания",O.holdingHorizon,n.jsx(on,{className:"w-4 h-4"})),L("Мин. ликвидность",O.minLiquidity,n.jsx($n,{className:"w-4 h-4"})),L("Target",O.targetPrice,n.jsx(os,{className:"w-4 h-4"}));break;case"spot":L("Монета",O.coin,n.jsx(fs,{className:"w-4 h-4"})),L("Зона входа",O.entryCap,n.jsx(ks,{className:"w-4 h-4"})),L("Цели",O.targets,n.jsx(os,{className:"w-4 h-4"})),L("SL",O.stopLoss,n.jsx(da,{className:"w-4 h-4"})),L("Горизонт",O.holdingHorizon,n.jsx(on,{className:"w-4 h-4"})),L("Размер",O.positionSize,n.jsx(en,{className:"w-4 h-4"}));break;case"polymarket":L("Событие",O.event,n.jsx(vr,{className:"w-4 h-4"})),L("Тип",O.positionType?O.positionType.toUpperCase():"",n.jsx(Ot,{className:"w-4 h-4"})),L("Вход %",O.entryPrice,n.jsx(en,{className:"w-4 h-4"})),L("Ожидание %",O.expectedProbability,n.jsx($n,{className:"w-4 h-4"})),L("Цель",O.targetPlan,n.jsx(os,{className:"w-4 h-4"})),L("Макс ставка",O.maxStake,n.jsx(fs,{className:"w-4 h-4"}));break;case"staking":L("Монета",O.coin,n.jsx(fs,{className:"w-4 h-4"})),L("Платформа",O.platform,n.jsx(hl,{className:"w-4 h-4"})),L("Срок",O.term,n.jsx(ul,{className:"w-4 h-4"})),L("APY",O.apy,n.jsx(en,{className:"w-4 h-4"})),L("Мин. депозит",O.minDeposit,n.jsx(fs,{className:"w-4 h-4"})),L("Тип сигнала",O.action,n.jsx(Ot,{className:"w-4 h-4"}));break}const fe=Z.filter(ge=>ge.value);return fe.length?n.jsxs("div",{className:`rounded-2xl border ${R} ${a==="dark"?"bg-gray-900/60":"bg-white"}`,children:[n.jsxs("div",{className:`flex items-center gap-2 px-4 py-3 border-b ${R} ${a==="dark"?"bg-white/5":"bg-gray-50"}`,children:[n.jsx(xs,{className:"w-4 h-4 text-amber-500"}),n.jsx("p",{className:`text-sm font-semibold ${T}`,children:"Ключевые метрики"}),n.jsxs("span",{className:`ml-auto text-[11px] font-semibold px-3 py-1 rounded-full ${Q[J]}`,children:["Риск: ",J]})]}),n.jsx("div",{className:"divide-y divide-gray-200/70 dark:divide-white/10",children:fe.map(ge=>n.jsx("div",{className:"flex items-center justify-between gap-3 px-4 py-3",children:n.jsxs("div",{className:"flex items-start gap-3",children:[n.jsx("div",{className:`p-2 rounded-xl border ${Y.border} ${Y.bg} ${Y.text}`,children:ge.icon}),n.jsxs("div",{className:"flex-1 min-w-0",children:[n.jsx("p",{className:`text-xs uppercase tracking-wide ${N}`,children:ge.label}),n.jsx("p",{className:`${T} font-semibold whitespace-pre-wrap break-words`,children:ge.value})]})]})},ge.label))})]}):null},W=()=>{const $=M[p],O={[p]:$},J=E($),Y=S($);return{id:"preview",userId:(i==null?void 0:i.id)||"unknown",category:p,details:O,createdAt:new Date().toISOString(),status:"active",tags:[],sentiment:J,riskLevel:Y,comment:_}},F=()=>{m(!0)},re=async $=>{$.preventDefault(),h(""),l(!0);try{const O=M[p],J={...t==null?void 0:t.details,[p]:O},Z={userId:(t==null?void 0:t.userId)||(i==null?void 0:i.id)||"unknown",category:p,details:J,createdAt:(t==null?void 0:t.createdAt)||new Date().toISOString(),status:(t==null?void 0:t.status)||"active",tags:(t==null?void 0:t.tags)||[]},L=_==null?void 0:_.trim();L&&(Z.comment=L);const fe=E(O);fe&&(Z.sentiment=fe);const ge=S(O);ge&&(Z.riskLevel=ge),(t==null?void 0:t.maxProfit)!==void 0&&(Z.maxProfit=t.maxProfit),(t==null?void 0:t.currentPnL)!==void 0&&(Z.currentPnL=t.currentPnL),(t==null?void 0:t.currentMarketCap)!==void 0&&(Z.currentMarketCap=t.currentMarketCap),(t==null?void 0:t.signalMarketCap)!==void 0&&(Z.signalMarketCap=t.signalMarketCap),(t==null?void 0:t.currentPrice)!==void 0&&(Z.currentPrice=t.currentPrice),(t==null?void 0:t.entryPrice)!==void 0&&(Z.entryPrice=t.entryPrice),t?await Tb(t.id,Z):await W5(Z),s==null||s()}catch(O){console.error("Error creating call:",O);const J=(O==null?void 0:O.message)||(O==null?void 0:O.code)||"Ошибка при сохранении сигнала";h(J)}finally{l(!1)}},de=$=>{const J=(M[p]||{})[$.key],Y=`w-full px-4 py-2 rounded-lg border ${R} ${P} ${T} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`;if($.type==="textarea")return n.jsx("textarea",{value:J||"",onChange:Z=>v($.key,Z.target.value),className:`${Y} min-h-[100px] resize-y`,placeholder:$.placeholder});if($.type==="select"&&$.options){const Z=$.options.length<=3?"grid-cols-1 sm:grid-cols-3":$.options.length<=4?"grid-cols-2 sm:grid-cols-4":"grid-cols-2 sm:grid-cols-3";return n.jsx("div",{className:`grid ${Z} gap-2 sm:gap-3`,children:$.options.map(L=>{const fe=J===L.value;return n.jsx("button",{type:"button",onClick:()=>v($.key,L.value),className:`px-3 py-3 sm:py-2 rounded-lg border-2 text-sm font-medium transition-all duration-300 min-h-[44px] sm:min-h-[40px] hover:shadow-md focus:outline-none focus:ring-2 focus:ring-[#4E6E49]/30 ${fe?"border-[#4E6E49] bg-gradient-to-r from-[#4E6E49] to-emerald-600 text-white shadow-md shadow-emerald-300/30 scale-[1.02] ring-2 ring-[#4E6E49]/20":`border-gray-200 dark:border-gray-700 ${a==="dark"?"text-gray-300 hover:border-gray-600 hover:bg-gray-800":"text-gray-700 hover:border-gray-400 hover:bg-gray-50"} active:scale-95 hover:-translate-y-0.5`}`,children:L.label},L.value)})})}return $.type==="checkbox"?n.jsxs("label",{className:"inline-flex items-center gap-3 cursor-pointer select-none p-3 sm:p-3 rounded-lg border border-gray-200 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-800 hover:border-gray-300 dark:hover:border-gray-600 transition-all duration-200 min-h-[48px] sm:min-h-[44px] hover:shadow-sm",children:[n.jsx("input",{type:"checkbox",checked:!!J,onChange:Z=>v($.key,Z.target.checked),className:"accent-[#4E6E49] w-5 h-5 sm:w-4 sm:h-4"}),n.jsx("span",{className:`font-medium ${T} text-sm sm:text-base`,children:$.label})]}):n.jsx("input",{type:"text",value:J||"",onChange:Z=>v($.key,Z.target.value),className:Y,placeholder:$.placeholder})};return n.jsxs("form",{onSubmit:re,className:"space-y-6",children:[c&&n.jsx("div",{className:`p-4 rounded-lg ${a==="dark"?"bg-red-900/30 border border-red-700 text-red-300":"bg-red-50 border border-red-200 text-red-800"}`,children:c}),n.jsxs("div",{className:`rounded-2xl border ${R} ${a==="dark"?"bg-gray-800/60":"bg-white"} p-4 sm:p-6`,children:[n.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[n.jsx("div",{className:"w-10 h-10 rounded-xl flex items-center justify-center text-white shadow-lg",style:{background:"linear-gradient(135deg, #4E6E49, #3b8d5a)"},children:n.jsx(os,{className:"w-5 h-5"})}),n.jsxs("div",{children:[n.jsx("p",{className:`text-lg font-bold ${T}`,children:"Выберите тип сигнала"}),n.jsx("p",{className:`text-xs ${C}`,children:"Какая категория лучше всего описывает ваш сигнал?"})]})]}),n.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-3 gap-2 sm:gap-3",children:Object.keys(sa).map($=>{const O=sa[$],J=p===$;return n.jsx("button",{type:"button",onClick:()=>j($),className:`p-4 rounded-xl border-2 transition-all duration-300 hover:shadow-md hover:-translate-y-0.5 active:scale-95 ${J?"border-[#4E6E49] bg-gradient-to-br from-[#4E6E49]/10 to-emerald-500/10 shadow-md shadow-emerald-300/20 scale-[1.02] ring-2 ring-[#4E6E49]/20":"border-gray-200 dark:border-gray-700 hover:border-gray-300 dark:hover:border-gray-600 hover:shadow-lg"}`,children:n.jsxs("div",{className:"flex flex-col items-center gap-2 text-center",children:[n.jsx("div",{className:`p-2 rounded-lg ${J?"bg-[#4E6E49] text-white":"bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-300"} transition-colors`,children:O.icon}),n.jsx("span",{className:`text-sm font-semibold ${J?"text-[#4E6E49]":T}`,children:O.label})]})},$)})})]}),n.jsxs("div",{className:`rounded-2xl border ${R} ${a==="dark"?"bg-gray-800/60":"bg-white"} p-4 sm:p-6 space-y-4`,children:[n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx("div",{className:"hidden sm:flex w-10 h-10 rounded-xl items-center justify-center text-white shadow-lg",style:{background:"linear-gradient(135deg, #4E6E49, #3b8d5a)"},children:n.jsx("div",{className:"w-5 h-5",children:sa[p].icon})}),n.jsxs("div",{className:"hidden sm:block",children:[n.jsxs("p",{className:`text-lg font-bold ${T}`,children:[sa[p].label," - Детали сигнала"]}),n.jsx("p",{className:`text-xs ${C}`,children:"Заполните все необходимые поля"})]}),n.jsx("div",{className:"sm:hidden",children:n.jsx("p",{className:`text-sm font-bold ${T}`,children:sa[p].label})})]}),w.percentage<100&&n.jsxs("div",{className:"text-right",children:[n.jsx("div",{className:`w-16 h-2 rounded-full overflow-hidden ${a==="dark"?"bg-gray-700":"bg-gray-200"} shadow-inner`,children:n.jsx("div",{className:"h-full rounded-full transition-all duration-500 ease-out bg-gradient-to-r from-[#4E6E49] to-emerald-600",style:{width:`${w.percentage}%`}})}),n.jsxs("p",{className:`text-xs ${C} mt-1`,children:[w.filled,"/",w.total]})]}),w.percentage===100&&n.jsx("div",{className:"text-right",children:n.jsx("div",{className:"w-8 h-8 rounded-full bg-emerald-500 flex items-center justify-center",children:n.jsx(Ls,{className:"w-4 h-4 text-white"})})})]}),n.jsx("div",{className:"space-y-6",children:Object.entries(uS[p]).map(([$,O],J)=>{const Y=of[p].filter(Z=>Z.section===$);return Y.length===0?null:n.jsxs("div",{className:"space-y-4 animate-in fade-in-0 slide-in-from-bottom-4 duration-500",style:{animationDelay:`${J*100}ms`},children:[n.jsxs("div",{className:"flex items-center gap-2 pb-2 border-b border-gray-200 dark:border-gray-700",children:[n.jsx("div",{className:`p-1.5 rounded-lg transition-colors duration-200 ${a==="dark"?"bg-gray-700 text-gray-300 hover:bg-gray-600":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:O.icon}),n.jsxs("div",{children:[n.jsx("h3",{className:`text-sm font-bold ${T}`,children:O.title}),O.description&&n.jsx("p",{className:`text-xs ${C}`,children:O.description})]})]}),n.jsx("div",{className:"grid grid-cols-1 gap-4",children:Y.map(Z=>n.jsxs("div",{className:"space-y-2",children:[Z.type!=="checkbox"&&n.jsx("label",{className:`text-sm font-semibold ${T}`,children:Z.label}),de(Z)]},Z.key))})]},$)})})]}),n.jsxs("div",{children:[n.jsx("label",{className:`block text-sm font-medium ${T} mb-2`,children:"Общий комментарий или доп. заметки"}),n.jsx("textarea",{value:_,onChange:$=>y($.target.value),className:`w-full px-4 py-3 rounded-lg border ${R} ${P} ${T} focus:outline-none focus:ring-2 focus:ring-[#4E6E49] min-h-[90px] resize-y`,placeholder:"Здесь можно оставить чеклист для апдейтов, условия выхода, алерты."})]}),n.jsx("div",{className:"flex flex-col gap-3 sm:gap-4",children:n.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 sm:gap-4",children:[n.jsxs("button",{type:"button",onClick:F,className:`px-6 py-4 sm:py-3 rounded-lg font-semibold border ${R} ${a==="dark"?"text-white hover:bg-gray-800 active:bg-gray-800":"text-gray-800 hover:bg-gray-100 active:bg-gray-200"} transition-colors min-h-[48px] sm:min-h-[44px]`,children:[n.jsx(ml,{className:"w-4 h-4 inline mr-2"}),"Предпросмотр"]}),n.jsx("button",{type:"submit",disabled:o,className:`flex-1 py-4 sm:py-3 rounded-lg font-semibold transition-all shadow-md min-h-[48px] sm:min-h-[44px] ${a==="dark"?"bg-gradient-to-r from-[#4E6E49] to-emerald-700 text-white hover:scale-[1.01] active:scale-[0.98] disabled:bg-gray-700":"bg-gradient-to-r from-[#4E6E49] to-emerald-600 text-white hover:shadow-lg active:shadow-md disabled:bg-gray-300 disabled:text-gray-600"}`,children:o?"Сохраняем...":t?"Обновить сигнал":"Создать сигнал"}),e&&n.jsx("button",{type:"button",onClick:e,className:`px-6 py-4 sm:py-3 rounded-lg font-semibold border ${R} ${a==="dark"?"text-white hover:bg-gray-800 active:bg-gray-800":"text-gray-800 hover:bg-gray-100 active:bg-gray-200"} min-h-[48px] sm:min-h-[44px]`,children:"Отмена"})]})}),u&&(()=>{const $=W(),O=sa[p],J=Re.find(Y=>Y.id===$.userId);return n.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-[70] flex items-start sm:items-center justify-center p-4 overflow-y-auto",children:n.jsx("div",{className:`${b} rounded-2xl shadow-2xl border ${R} max-w-4xl w-full max-h-[90vh] overflow-hidden`,children:n.jsxs("div",{className:"flex flex-col h-full",children:[n.jsxs("div",{className:`p-6 flex items-center justify-between sticky top-0 z-20 ${b} border-b ${R} shadow-sm`,children:[n.jsxs("h2",{className:`text-2xl font-bold ${T} flex items-center gap-2`,children:[n.jsx(ml,{className:"w-5 h-5"}),"Предпросмотр сигнала"]}),n.jsx("button",{onClick:()=>m(!1),className:`p-2 rounded-xl ${a==="dark"?"hover:bg-gray-800":"hover:bg-gray-100"}`,children:n.jsx(Ft,{className:`w-5 h-5 ${N}`})})]}),n.jsxs("div",{className:"px-6 pb-6 pt-2 overflow-y-auto flex-1 max-h-[75vh]",children:[n.jsxs("div",{className:`rounded-3xl border-2 shadow-xl overflow-hidden mb-6 ${ae[p].border} ${ae[p].bg}`,children:[n.jsxs("div",{className:`px-5 py-4 flex flex-wrap items-center justify-between gap-3 border-b ${a==="dark"?"border-white/10 bg-white/5":"border-white/70 bg-white/70"}`,children:[n.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[n.jsxs("span",{className:`flex items-center gap-2 px-3 py-1.5 rounded-full text-sm font-semibold border ${ae[p].border} ${ae[p].chipBg||""} ${ae[p].text}`,children:[O.icon,O.label]}),n.jsx("span",{className:"px-3 py-1.5 rounded-full text-xs font-semibold bg-emerald-500/15 text-emerald-500 border border-emerald-500/20",children:"Активен"}),n.jsxs("span",{className:`px-3 py-1.5 rounded-full text-xs font-semibold ${Q[$.riskLevel||"medium"]}`,children:["Риск: ",$.riskLevel||"medium"]})]}),n.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[n.jsx("div",{className:`px-3 py-1.5 rounded-xl text-xs font-semibold border ${a==="dark"?"bg-gray-800/70 text-gray-200 border-white/10":"bg-white text-gray-700 border-gray-200"}`,children:"Создано только что"}),J&&n.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 rounded-xl border border-white/10 bg-black/5 dark:bg-white/5",children:[n.jsx("div",{className:"w-8 h-8 rounded-full bg-gradient-to-r from-[#4E6E49] to-emerald-600 text-white flex items-center justify-center text-sm font-bold",children:J.name[0]}),n.jsx("span",{className:`text-xs ${N}`,children:J.name})]})]})]}),n.jsxs("div",{className:"p-5 space-y-5",children:[n.jsx("div",{className:"grid md:grid-cols-[1.15fr_auto] gap-4 items-start",children:n.jsxs("div",{className:"space-y-1",children:[n.jsx("p",{className:`text-2xl font-bold ${T}`,children:X($)}),n.jsx("p",{className:`text-sm ${N}`,children:he($)})]})}),ve($),$.comment&&n.jsxs("div",{className:`rounded-xl border ${R} ${a==="dark"?"bg-gray-900/60":"bg-gray-50"} p-4`,children:[n.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[n.jsx(na,{className:"w-4 h-4 text-amber-500"}),n.jsx("p",{className:`text-sm font-semibold ${T}`,children:"Общий комментарий"})]}),n.jsx("p",{className:`${T} whitespace-pre-wrap`,children:$.comment})]})]})]}),n.jsxs("div",{className:"flex gap-4",children:[n.jsx("button",{onClick:()=>m(!1),className:`flex-1 px-4 py-3 rounded-xl border ${R} ${a==="dark"?"text-white hover:bg-gray-800":"text-gray-800 hover:bg-gray-100"} font-semibold`,children:"Вернуться к редактированию"}),n.jsxs("button",{onClick:()=>{m(!1);const Y=document.querySelector("form");Y==null||Y.requestSubmit()},className:`flex-1 px-4 py-3 rounded-xl font-semibold transition-all ${w.percentage===100?"bg-gradient-to-r from-[#4E6E49] to-emerald-600 text-white shadow-md hover:shadow-lg":"bg-gray-400 text-gray-200 cursor-not-allowed"}`,children:[n.jsx(Ls,{className:"w-4 h-4 inline mr-2"}),"Создать сигнал"]})]})]})]})})})})()]})},Ol="modal-open";let wi=0;const gS=()=>{typeof document>"u"||(wi===0&&(document.body.classList.add(Ol),document.documentElement.classList.add(Ol)),wi+=1)},fS=()=>{typeof document>"u"||(wi=Math.max(wi-1,0),wi===0&&(document.body.classList.remove(Ol),document.documentElement.classList.remove(Ol)))},Ur=(s=!0)=>{I.useEffect(()=>{if(s)return gS(),()=>{fS()}},[s])},ei={memecoins:{label:"Мемкоины",gradient:"from-emerald-400 to-teal-500",chip:"bg-emerald-500/10 text-emerald-600",icon:n.jsx(Xi,{className:"w-4 h-4"})},futures:{label:"Фьючерсы",gradient:"from-blue-400 to-indigo-500",chip:"bg-blue-500/10 text-blue-600",icon:n.jsx(Ql,{className:"w-4 h-4"})},nft:{label:"NFT",gradient:"from-purple-400 to-pink-500",chip:"bg-purple-500/10 text-purple-600",icon:n.jsx(Yl,{className:"w-4 h-4"})},spot:{label:"Спот",gradient:"from-amber-400 to-orange-500",chip:"bg-amber-500/10 text-amber-600",icon:n.jsx(fs,{className:"w-4 h-4"})},polymarket:{label:"Polymarket",gradient:"from-rose-400 to-red-500",chip:"bg-rose-500/10 text-rose-600",icon:n.jsx(os,{className:"w-4 h-4"})},staking:{label:"Стейкинг",gradient:"from-cyan-400 to-blue-500",chip:"bg-cyan-500/10 text-cyan-600",icon:n.jsx(Ot,{className:"w-4 h-4"})}},Po={all:{label:"Все",className:""},active:{label:"Активен",className:"bg-emerald-500/15 text-emerald-500 border border-emerald-500/20"},completed:{label:"Завершен",className:"bg-blue-500/15 text-blue-500 border border-blue-500/20"},cancelled:{label:"Отменен",className:"bg-red-500/15 text-red-500 border border-red-500/20"},reviewed:{label:"На рассмотрении",className:"bg-gray-500/15 text-gray-500 border border-gray-500/20"}},df={low:"bg-emerald-500/10 text-emerald-600 border border-emerald-500/20",medium:"bg-blue-500/10 text-blue-600 border border-blue-500/20",high:"bg-amber-500/10 text-amber-600 border border-amber-500/20",ultra:"bg-red-500/10 text-red-600 border border-red-500/20"},pS=()=>{const{theme:s}=lt(),[e,t]=I.useState([]),[r,a]=I.useState(!0),[i,o]=I.useState(!1),[l,c]=I.useState(!1),[h,u]=I.useState(null),[m,g]=I.useState(null),[p,j]=I.useState(null),[_,y]=I.useState("memecoins"),[M,D]=I.useState(null),[T,R]=I.useState(""),[P,C]=I.useState("all"),[N,b]=I.useState("all"),[v,S]=I.useState("all"),[E,k]=I.useState("all");Ur(i||l||!!m),I.useEffect(()=>{w()},[]);const w=async()=>{a(!0);try{const K=await q5();t(K)}catch(K){console.error("Error loading calls:",K),t([])}finally{a(!1)}},Q=s==="dark"?"bg-[#121212]":"bg-white",ae=s==="dark"?"text-white":"text-gray-900",V=s==="dark"?"text-gray-400":"text-gray-600",X=s==="dark"?"border-gray-800":"border-gray-200",B=`rounded-2xl p-4 sm:p-6 md:p-8 border-2 ${s==="dark"?"border-[#4E6E49]/30 bg-gradient-to-br from-[#1a1a1a] via-[#1a1a1a] to-[#0A0A0A]":"border-green-200 bg-gradient-to-br from-white via-green-50/30 to-white"}`,te=`rounded-2xl border ${s==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white"}`,ve={memecoins:{bg:s==="dark"?"bg-emerald-500/10":"bg-emerald-50",text:s==="dark"?"text-emerald-100":"text-emerald-800",border:s==="dark"?"border-emerald-500/30":"border-emerald-200",chipBg:s==="dark"?"bg-emerald-500/20":"bg-emerald-500/10"},futures:{bg:s==="dark"?"bg-sky-500/10":"bg-sky-50",text:s==="dark"?"text-sky-100":"text-sky-800",border:s==="dark"?"border-sky-500/30":"border-sky-200",chipBg:s==="dark"?"bg-sky-500/20":"bg-sky-500/10"},nft:{bg:s==="dark"?"bg-purple-500/10":"bg-purple-50",text:s==="dark"?"text-purple-100":"text-purple-800",border:s==="dark"?"border-purple-500/30":"border-purple-200",chipBg:s==="dark"?"bg-purple-500/20":"bg-purple-500/10"},spot:{bg:s==="dark"?"bg-amber-500/10":"bg-amber-50",text:s==="dark"?"text-amber-100":"text-amber-800",border:s==="dark"?"border-amber-500/30":"border-amber-200",chipBg:s==="dark"?"bg-amber-500/20":"bg-amber-500/10"},polymarket:{bg:s==="dark"?"bg-rose-500/10":"bg-rose-50",text:s==="dark"?"text-rose-100":"text-rose-800",border:s==="dark"?"border-rose-500/30":"border-rose-200",chipBg:s==="dark"?"bg-rose-500/20":"bg-rose-500/10"},staking:{bg:s==="dark"?"bg-cyan-500/10":"bg-cyan-50",text:s==="dark"?"text-cyan-100":"text-cyan-800",border:s==="dark"?"border-cyan-500/30":"border-cyan-200",chipBg:s==="dark"?"bg-cyan-500/20":"bg-cyan-500/10"}},W=()=>{o(!1),j(null),w()},F=()=>{o(!1),j(null)},re=K=>{j(K),y(K.category),o(!0)},de=K=>{u(K),c(!0)},$=async()=>{if(h)try{await G5(h),c(!1),u(null),w()}catch(K){console.error("Error deleting call:",K),alert("Ошибка при удалении сигнала")}},O=async()=>{if(m)try{await Tb(m,{status:"cancelled"}),g(null),w()}catch(K){console.error("Error cancelling call:",K),alert("Ошибка при отмене сигнала")}},J=async K=>{try{await navigator.clipboard.writeText(K),D(K),setTimeout(()=>D(null),1800)}catch(q){console.error("Failed to copy:",q)}},Y=K=>{var q;return((q=K.details)==null?void 0:q[K.category])||{}},Z=K=>{const q=Y(K);switch(K.category){case"memecoins":return q.coinName||q.ticker||"Мемкоин";case"futures":return q.pair||"Фьючерс";case"nft":return q.collectionLink||"NFT коллекция";case"spot":return q.coin||"Спот";case"polymarket":return q.event||"Polymarket событие";case"staking":return q.coin||"Стейкинг";default:return"Сигнал"}},L=K=>{const q=Y(K);switch(K.category){case"memecoins":return`${q.ticker||""} ${q.network?`• ${String(q.network).toUpperCase()}`:""}`.trim();case"futures":return`${q.direction==="long"?"Long":"Short"} • ${q.timeframe||""}`;case"nft":return`${q.marketplace||""}${q.network?` • ${String(q.network).toUpperCase()}`:""}`;case"spot":return q.holdingHorizon?`Горизонт: ${q.holdingHorizon}`:"";case"polymarket":return`${q.positionType==="yes"?"YES":"NO"} • ${q.entryPrice||""}`;case"staking":return`${q.platform||""}${q.term?` • ${q.term}`:""}`;default:return""}},fe=K=>K.riskLevel||Y(K).riskLevel||Y(K).protocolRisk||"medium",ge=K=>{const q=Y(K);return[K.category,K.status,K.comment,q.coinName,q.ticker,q.pair,q.reason,q.targets,q.event,q.marketplace,q.platform,q.entryCap,q.entryZone,q.network].filter(Boolean).join(" ").toLowerCase()},H=e.filter(K=>P!=="all"&&K.status!==P||N!=="all"&&K.category!==N||v!=="all"&&fe(K)!==v||E!=="all"&&K.userId!==E?!1:T.trim()?ge(K).includes(T.toLowerCase()):!0),se=I.useMemo(()=>e.reduce((K,q)=>(K[q.category]||(K[q.category]={total:0,active:0}),K[q.category].total+=1,q.status==="active"&&(K[q.category].active+=1),K),{memecoins:{total:0,active:0},futures:{total:0,active:0},nft:{total:0,active:0},spot:{total:0,active:0},polymarket:{total:0,active:0},staking:{total:0,active:0}}),[e]),je=I.useMemo(()=>({total:e.length,active:e.filter(K=>K.status==="active").length,completed:e.filter(K=>K.status==="completed").length,highRisk:e.filter(K=>fe(K)==="high"||fe(K)==="ultra").length}),[e]),Se=s==="dark"?"bg-gray-800 text-gray-200 border border-gray-700":"bg-white text-gray-700 border border-gray-200",G="bg-gradient-to-r from-emerald-400 to-teal-500 text-white shadow-md shadow-emerald-300/30",xe=(K,q,Ce)=>n.jsxs("div",{className:`p-4 rounded-xl border ${X} ${s==="dark"?"bg-gray-800/70":"bg-gray-50"}`,children:[n.jsx("p",{className:`text-xs uppercase tracking-wider ${V}`,children:K}),n.jsx("p",{className:`text-2xl font-bold ${Ce}`,children:q})]}),z={low:"Низкий",medium:"Средний",high:"Высокий",ultra:"Ультра"},ce={flip:"Flip",short:"Короткий",medium:"Средний",long:"Длинный"},ke={flexible:"Гибкий","30d":"30 дней","90d":"90 дней",fixed:"Фикс."},ue={enter:"Вход",exit:"Выход",rebalance:"Ребаланс"},$e={yes:"YES",no:"NO"},Oe=(K,q=28)=>{if(!K)return"";if(K.length<=q)return K;const Ce=K.slice(0,Math.floor(q/2)),Le=K.slice(-6);return`${Ce}...${Le}`},U=K=>K?K.includes("%")?K:`${K}%`:"",_e=K=>{if(!K)return"";const q=new Date(K);if(Number.isNaN(q.getTime()))return K;const Ce=new Date,Le=q.getTime()-Ce.getTime(),Ue=q.toLocaleString("ru-RU",{day:"2-digit",month:"short",hour:"2-digit",minute:"2-digit"});if(Le<=0)return`${Ue} (истек)`;const ye=Math.max(0,Math.floor(Le/(1e3*60))),mt=Math.floor(ye/(60*24)),qe=Math.floor(ye%(60*24)/60),et=ye%60,Te=[mt>0?`${mt}д`:null,qe>0?`${qe}ч`:null,et>0?`${et}м`:null].filter(Boolean).slice(0,2).join(" ");return`${Ue} (через ${Te||"минуты"})`},Pe=K=>{const q=Y(K),Ce=fe(K),Le=ve[K.category],Ue=[],ye=(qe,et,Te,Ve)=>{et&&Ue.push({label:qe,value:et,icon:Te,copyValue:Ve??et})};switch(K.category){case"memecoins":ye("Монета",q.coinName,n.jsx(fs,{className:"w-4 h-4"})),ye("Тикер",Oe(q.ticker,8),n.jsx(Fp,{className:"w-4 h-4"}),q.ticker),ye("Сеть",q.network?String(q.network).toUpperCase():"",n.jsx(Vp,{className:"w-4 h-4"})),ye("Контракт",Oe(q.contract,12),n.jsx(Hv,{className:"w-4 h-4"}),q.contract),ye("Тип сигнала",q.signalType?q.signalType.toUpperCase():"",n.jsx(ha,{className:"w-4 h-4"})),ye("Зона входа",q.entryCap,n.jsx(ks,{className:"w-4 h-4"})),ye("Цели",q.targets,n.jsx(os,{className:"w-4 h-4"})),ye("SL",q.stopLoss,n.jsx(da,{className:"w-4 h-4"})),ye("План",ce[q.holdPlan]||q.holdPlan,n.jsx(on,{className:"w-4 h-4"})),ye("Ликвидность",q.liquidityLocked?"Залочена":"",n.jsx(Ot,{className:"w-4 h-4"})),ye("Риск",z[Ce]||Ce,n.jsx(Qa,{className:"w-4 h-4"})),ye("Риски",q.risks,n.jsx(Xt,{className:"w-4 h-4"})),ye("Комментарий",q.traderComment,n.jsx(na,{className:"w-4 h-4"})),ye("Причина входа",q.reason,n.jsx(vr,{className:"w-4 h-4"}));break;case"futures":ye("Пара",q.pair,n.jsx(hh,{className:"w-4 h-4"}),q.pair),ye("Направление",q.direction?q.direction.toUpperCase():"",n.jsx(Ut,{className:"w-4 h-4"})),ye("Плечо",q.leverage,n.jsx($n,{className:"w-4 h-4"})),ye("Зона входа",q.entryZone||q.entryPrice,n.jsx(ks,{className:"w-4 h-4"})),ye("Цели",q.targets,n.jsx(os,{className:"w-4 h-4"})),ye("SL",q.stopLoss,n.jsx(da,{className:"w-4 h-4"})),ye("Стиль",q.signalStyle,n.jsx(ha,{className:"w-4 h-4"})),ye("Размер позиции",q.positionSize,n.jsx(en,{className:"w-4 h-4"})),ye("Таймфрейм",q.timeframe,n.jsx(xh,{className:"w-4 h-4"})),ye("Риск",z[Ce]||Ce,n.jsx(Qa,{className:"w-4 h-4"})),ye("Риски",q.risks,n.jsx(Xt,{className:"w-4 h-4"})),ye("Причина входа",q.reason,n.jsx(vr,{className:"w-4 h-4"}));break;case"nft":ye("Коллекция",Oe(q.collectionLink),n.jsx(xd,{className:"w-4 h-4"}),q.collectionLink),ye("NFT",Oe(q.nftLink),n.jsx(xd,{className:"w-4 h-4"}),q.nftLink),ye("Маркетплейс",q.marketplace,n.jsx(hl,{className:"w-4 h-4"})),ye("Сеть",q.network?String(q.network).toUpperCase():"",n.jsx(Bp,{className:"w-4 h-4"})),ye("Вход",q.entryPrice,n.jsx(ks,{className:"w-4 h-4"})),ye("Редкость",q.rarity,n.jsx(xs,{className:"w-4 h-4"})),ye("Тип сигнала",q.signalType?q.signalType.toUpperCase():"",n.jsx(ha,{className:"w-4 h-4"})),ye("Срок удержания",ce[q.holdingHorizon]||q.holdingHorizon,n.jsx(on,{className:"w-4 h-4"})),ye("Мин. ликвидность",q.minLiquidity,n.jsx($n,{className:"w-4 h-4"})),ye("Target",q.targetPrice,n.jsx(os,{className:"w-4 h-4"})),ye("Риски",q.risks,n.jsx(Xt,{className:"w-4 h-4"})),ye("Комментарий",q.traderComment,n.jsx(na,{className:"w-4 h-4"})),ye("Причина входа",q.reason,n.jsx(vr,{className:"w-4 h-4"}));break;case"spot":ye("Монета",q.coin,n.jsx(fs,{className:"w-4 h-4"})),ye("Зона входа",q.entryCap,n.jsx(ks,{className:"w-4 h-4"})),ye("Цели",q.targets,n.jsx(os,{className:"w-4 h-4"})),ye("SL",q.stopLoss,n.jsx(da,{className:"w-4 h-4"})),ye("Горизонт",ce[q.holdingHorizon]||q.holdingHorizon,n.jsx(on,{className:"w-4 h-4"})),ye("Размер",q.positionSize,n.jsx(en,{className:"w-4 h-4"})),ye("Риск",q.riskLevel?z[q.riskLevel]:void 0,n.jsx(Qa,{className:"w-4 h-4"})),ye("Риски",q.risks,n.jsx(Xt,{className:"w-4 h-4"})),ye("Комментарий",q.traderComment,n.jsx(na,{className:"w-4 h-4"})),ye("Причина входа",q.reason,n.jsx(vr,{className:"w-4 h-4"}));break;case"polymarket":const qe=q.positionType;ye("Событие",q.event,n.jsx(vr,{className:"w-4 h-4"})),ye("Тип",qe?$e[qe]:"",n.jsx(Ot,{className:"w-4 h-4"})),ye("Вход %",U(q.entryPrice),n.jsx(en,{className:"w-4 h-4"})),ye("Ожидание %",U(q.expectedProbability),n.jsx($n,{className:"w-4 h-4"})),ye("Цель",q.targetPlan,n.jsx(os,{className:"w-4 h-4"})),ye("Макс ставка",q.maxStake,n.jsx(fs,{className:"w-4 h-4"})),ye("Срок исхода",_e(q.eventDeadline),n.jsx(ul,{className:"w-4 h-4"})),ye("Риск",z[Ce]||Ce,n.jsx(Qa,{className:"w-4 h-4"})),ye("Риски",q.risks,n.jsx(Xt,{className:"w-4 h-4"})),ye("Комментарий",q.traderComment,n.jsx(na,{className:"w-4 h-4"})),ye("Причина входа",q.reason,n.jsx(vr,{className:"w-4 h-4"}));break;case"staking":ye("Монета",q.coin,n.jsx(fs,{className:"w-4 h-4"})),ye("Платформа",q.platform,n.jsx(hl,{className:"w-4 h-4"})),ye("Срок",ke[q.term]||q.term,n.jsx(ul,{className:"w-4 h-4"})),ye("APY",U(q.apy),n.jsx(en,{className:"w-4 h-4"})),ye("Мин. депозит",q.minDeposit,n.jsx(fs,{className:"w-4 h-4"})),ye("Тип сигнала",ue[q.action]||q.action,n.jsx(Ot,{className:"w-4 h-4"})),ye("Риск протокола",q.protocolRisk?z[q.protocolRisk]:void 0,n.jsx(Qa,{className:"w-4 h-4"})),ye("Риски",q.risks,n.jsx(Xt,{className:"w-4 h-4"})),ye("Комментарий",q.traderComment,n.jsx(na,{className:"w-4 h-4"})),ye("Причина входа",q.reason,n.jsx(vr,{className:"w-4 h-4"}));break}const mt=Ue.filter(qe=>qe.value);return mt.length?n.jsxs("div",{className:`rounded-2xl border ${X} ${s==="dark"?"bg-gray-900/60":"bg-white"}`,children:[n.jsxs("div",{className:`flex items-center gap-2 px-4 py-3 border-b ${X} ${s==="dark"?"bg-white/5":"bg-gray-50"}`,children:[n.jsx(xs,{className:"w-4 h-4 text-amber-500"}),n.jsx("p",{className:`text-sm font-semibold ${ae}`,children:"Ключевые метрики"}),n.jsxs("span",{className:`ml-auto text-[11px] font-semibold px-3 py-1 rounded-full ${df[Ce]}`,children:["Риск: ",z[Ce]||Ce]})]}),n.jsx("div",{className:"divide-y divide-gray-200/70 dark:divide-white/10",children:mt.map(qe=>n.jsxs("div",{className:"flex items-center justify-between gap-3 px-4 py-3",children:[n.jsxs("div",{className:"flex items-start gap-3",children:[n.jsx("div",{className:`p-2 rounded-xl border ${Le.border} ${Le.bg} ${Le.text}`,children:qe.icon}),n.jsxs("div",{className:"flex-1 min-w-0",children:[n.jsx("p",{className:`text-xs uppercase tracking-wide ${V}`,children:qe.label}),n.jsx("p",{className:`${ae} font-semibold whitespace-pre-wrap break-words`,children:qe.value})]})]}),qe.copyValue&&n.jsx("button",{onClick:()=>J(qe.copyValue),className:`p-2 rounded-lg border ${X} ${s==="dark"?"hover:bg-gray-800 bg-white/5":"hover:bg-gray-100 bg-white"} transition-colors`,title:"Копировать",children:M===qe.copyValue?n.jsx(Ls,{className:"w-4 h-4 text-emerald-500"}):n.jsx(Ai,{className:"w-4 h-4"})})]},qe.label))})]}):null};return n.jsxs("div",{className:"space-y-10 pb-20",children:[n.jsxs("div",{className:`relative overflow-hidden ${B} p-5 sm:p-6 md:p-8 ${s==="dark"?"bg-gradient-to-br from-[#0e1b2c] via-[#0c1827] to-[#0a1420]":"bg-gradient-to-br from-white via-emerald-50/40 to-sky-50"}`,children:[n.jsxs("div",{className:"absolute inset-0 pointer-events-none",children:[n.jsx("div",{className:"absolute -top-32 -left-16 w-80 h-80 bg-gradient-to-br from-[#4E6E49]/18 via-sky-500/8 to-transparent blur-3xl"}),n.jsx("div",{className:"absolute top-0 right-0 w-[26rem] h-[26rem] bg-gradient-to-bl from-sky-400/14 via-emerald-400/12 to-transparent blur-3xl"}),n.jsx("div",{className:"absolute bottom-[-140px] left-14 w-80 h-80 bg-gradient-to-tr from-sky-300/12 via-[#4E6E49]/12 to-transparent blur-3xl"})]}),n.jsx("div",{className:"relative z-10 grid grid-cols-1 gap-5",children:n.jsx("div",{className:`${te} backdrop-blur p-4 sm:p-5 space-y-4`,children:n.jsx("div",{className:"flex flex-col gap-4 sm:gap-5 lg:flex-row lg:items-center lg:justify-between",children:n.jsxs("div",{className:"flex flex-col sm:flex-row items-center gap-3 w-full sm:w-auto",children:[n.jsx("div",{className:"hidden sm:block p-3 rounded-2xl bg-white/80 dark:bg-white/5 border border-white/40 dark:border-white/10 shadow-lg",children:n.jsx(pd,{className:"w-6 h-6 text-[#4E6E49]"})}),n.jsx("div",{className:"flex items-center text-center sm:text-left w-full sm:w-auto justify-center sm:justify-start",children:n.jsx("h1",{className:`text-xl sm:text-3xl font-extrabold leading-tight ${s==="dark"?"text-white":"text-gray-900"}`,children:"Signals HUB"})})]})})})})]}),n.jsxs("div",{className:`${B} shadow-2xl relative overflow-hidden p-6 sm:p-8`,children:[n.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-white/5 to-transparent pointer-events-none"}),n.jsx("div",{className:"relative z-10 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-5",children:Object.keys(ei).map(K=>{const q=ei[K],Ce=se[K],Le=ve[K];return n.jsxs("button",{onClick:()=>{y(K),j(null),o(!0)},className:`p-5 rounded-[1.5rem] border-2 ${Le.border} ${Le.bg} text-left shadow-lg hover:shadow-xl transition-all hover:-translate-y-1 space-y-3 group/card relative overflow-hidden`,children:[n.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-white/10 to-transparent opacity-0 group-hover/card:opacity-100 transition-opacity"}),n.jsxs("div",{className:"flex items-start justify-between gap-3 relative z-10",children:[n.jsxs("div",{className:`flex items-center gap-2 px-3 py-1.5 rounded-full text-[11px] font-bold ${Le.text} bg-white/10 border border-white/10 backdrop-blur-md`,children:[q.icon,n.jsx("span",{children:q.label})]}),n.jsx("span",{className:`px-2.5 py-1 rounded-lg text-[10px] font-bold border ${Le.border} ${Le.text} ${s==="dark"?"bg-black/20":"bg-white/50"} group-hover/card:bg-[#4E6E49] group-hover/card:text-white group-hover/card:border-transparent transition-all`,children:"Добавить"})]}),n.jsxs("div",{className:"pl-1 relative z-10",children:[n.jsx("p",{className:`text-3xl font-black ${ae} leading-none mb-1 group-hover/card:scale-105 transition-transform origin-left`,children:(Ce==null?void 0:Ce.total)||0}),n.jsxs("p",{className:`text-[10px] uppercase tracking-wider font-bold ${V} opacity-80`,children:["Всего сигналов • Активных ",(Ce==null?void 0:Ce.active)||0]})]})]},K)})})]}),n.jsxs("div",{className:`${B} !p-0 shadow-2xl`,children:[n.jsx("div",{className:"p-6 sm:p-8 space-y-8",children:n.jsxs("div",{className:"flex flex-col gap-3",children:[n.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[n.jsxs("div",{className:"flex items-center gap-2 text-sm font-semibold",children:[n.jsx(mh,{className:`w-4 h-4 ${V}`}),n.jsx("span",{className:ae,children:"Фильтры"})]}),n.jsx("div",{className:"flex flex-wrap gap-2",children:Object.keys(Po).map(K=>n.jsx("button",{onClick:()=>C(K),className:`px-3 py-1.5 rounded-xl text-sm font-semibold transition-all ${P===K?G:Se}`,children:Po[K].label},K))})]}),n.jsxs("div",{className:"flex flex-col gap-2",children:[n.jsxs("label",{className:`text-xs uppercase tracking-wider ${V} flex items-center gap-2`,children:[n.jsx(fh,{className:"w-4 h-4"}),"Поиск по всем сферам ",n.jsxs("span",{className:"text-[11px] text-gray-500 dark:text-gray-400",children:[H.length,"/",e.length]})]}),n.jsx("input",{value:T,onChange:K=>R(K.target.value),placeholder:"тикер, событие, сеть, причина...",className:`w-full px-3 py-2 rounded-xl border ${X} ${s==="dark"?"bg-gray-800":"bg-gray-50"} ${ae} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]/60`})]}),n.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[n.jsx("span",{className:`text-xs ${V} uppercase tracking-wider`,children:"Сфера:"}),n.jsx("button",{onClick:()=>b("all"),className:`px-3 py-1.5 rounded-full text-sm font-semibold border ${N==="all"?G:Se}`,children:"Все"}),Object.keys(ei).map(K=>n.jsx("button",{onClick:()=>b(N===K?"all":K),className:`px-3 py-1.5 rounded-full text-sm font-semibold border ${N===K?G:Se}`,children:ei[K].label},K))]}),n.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[n.jsx("span",{className:`text-xs ${V} uppercase tracking-wider`,children:"Риск:"}),["all","low","medium","high","ultra"].map(K=>n.jsx("button",{onClick:()=>S(K),className:`px-3 py-1.5 rounded-full text-sm font-semibold border ${v===K?G:Se}`,children:K==="all"?"Все":K},K))]}),n.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[n.jsx("span",{className:`text-xs ${V} uppercase tracking-wider`,children:"Трейдер:"}),n.jsxs("select",{value:E,onChange:K=>k(K.target.value),className:`px-3 py-2 rounded-lg border ${X} ${s==="dark"?"bg-gray-800 text-white":"bg-gray-50 text-gray-900"} text-sm focus:outline-none focus:ring-2 focus:ring-emerald-500/50`,children:[n.jsx("option",{value:"all",children:"Все трейдеры"}),Re.map(K=>n.jsx("option",{value:K.id,children:K.name},K.id))]})]}),n.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:[xe("Всего сигналов",je.total,ae),xe("Активных",je.active,"text-emerald-500"),xe("Завершено",je.completed,"text-blue-500"),xe("High risk",je.highRisk,"text-amber-500")]})]})}),i&&n.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-[70] flex items-start sm:items-center justify-center p-4 overflow-y-auto",children:n.jsx("div",{className:`${Q} rounded-2xl shadow-2xl border ${X} max-w-3xl w-full max-h-[90vh] overflow-hidden`,children:n.jsxs("div",{className:"flex flex-col h-full",children:[n.jsxs("div",{className:`p-6 flex items-center justify-between sticky top-0 z-20 ${Q} border-b ${X} shadow-sm`,children:[n.jsx("h2",{className:`text-2xl font-bold ${ae}`,children:p?"Редактировать сигнал":"Создать сигнал"}),n.jsx("button",{onClick:F,className:`p-2 rounded-xl ${s==="dark"?"hover:bg-gray-800":"hover:bg-gray-100"}`,children:n.jsx(Ft,{className:`w-5 h-5 ${V}`})})]}),n.jsx("div",{className:"px-6 pb-6 pt-2 overflow-y-auto flex-1 max-h-[75vh]",children:n.jsx(mS,{callToEdit:p,onSuccess:W,onCancel:F,initialCategory:_})})]})})}),l&&n.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-[70] flex items-start sm:items-center justify-center p-4 overflow-y-auto overscroll-contain",children:n.jsx("div",{className:`${Q} rounded-2xl shadow-2xl border ${X} max-w-md w-full`,children:n.jsxs("div",{className:"p-6 space-y-4",children:[n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx(Xt,{className:"w-6 h-6 text-red-500"}),n.jsxs("div",{children:[n.jsx("h3",{className:`text-xl font-bold ${ae}`,children:"Удалить сигнал?"}),n.jsx("p",{className:V,children:"Это действие нельзя отменить"})]})]}),n.jsxs("div",{className:"flex gap-3",children:[n.jsx("button",{onClick:()=>{c(!1),u(null)},className:`flex-1 px-4 py-3 rounded-xl border ${X} ${s==="dark"?"text-white":"text-gray-800"}`,children:"Отмена"}),n.jsx("button",{onClick:$,className:"flex-1 px-4 py-3 rounded-xl bg-red-600 text-white font-semibold hover:bg-red-700",children:"Удалить"})]})]})})}),m&&n.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-[70] flex items-start sm:items-center justify-center p-4 overflow-y-auto overscroll-contain",children:n.jsx("div",{className:`${Q} rounded-2xl shadow-2xl border ${X} max-w-md w-full`,children:n.jsxs("div",{className:"p-6 space-y-4",children:[n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx(Xt,{className:"w-6 h-6 text-amber-500"}),n.jsxs("div",{children:[n.jsx("h3",{className:`text-xl font-bold ${ae}`,children:"Отменить сигнал?"}),n.jsx("p",{className:V,children:"Статус станет «Отменен», запись останется в списке."})]})]}),n.jsxs("div",{className:"flex gap-3",children:[n.jsx("button",{onClick:()=>g(null),className:`flex-1 px-4 py-3 rounded-xl border ${X} ${s==="dark"?"text-white":"text-gray-800"}`,children:"Отмена"}),n.jsx("button",{onClick:O,className:"flex-1 px-4 py-3 rounded-xl bg-amber-500 text-white font-semibold hover:bg-amber-600",children:"Отменить"})]})]})})}),!i&&n.jsx(n.Fragment,{children:r?n.jsxs("div",{className:`${Q} rounded-2xl p-12 text-center ${X} border shadow-xl`,children:[n.jsx("div",{className:"animate-spin rounded-full h-14 w-14 border-4 border-[#4E6E49] border-t-transparent mx-auto mb-4"}),n.jsx("p",{className:`${V} text-lg`,children:"Загрузка сигналов..."})]}):e.length===0?n.jsxs("div",{className:`${Q} rounded-[2rem] p-16 text-center ${X} border-2 shadow-2xl backdrop-blur-sm relative overflow-hidden group`,children:[n.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-[#4E6E49]/5 via-transparent to-emerald-500/5 opacity-0 group-hover:opacity-100 transition-opacity"}),n.jsx(xs,{className:`w-20 h-20 mx-auto mb-6 ${V} animate-pulse`}),n.jsx("p",{className:`text-2xl font-black ${ae} mb-2`,children:"Пока пусто"}),n.jsx("p",{className:`${V} text-lg`,children:"Создайте первый сигнал в новой структуре"})]}):H.length===0?n.jsxs("div",{className:`${Q} rounded-2xl p-12 text-center ${X} border shadow-xl`,children:[n.jsx(xs,{className:`w-16 h-16 mx-auto mb-4 ${V}`}),n.jsx("p",{className:`text-xl font-bold ${ae}`,children:"Нет совпадений"}),n.jsxs("p",{className:V,children:["Сигналы есть (",e.length,"), но фильтр ничего не нашел."]})]}):n.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-5 px-4 py-2",children:H.map(K=>{const q=ei[K.category],Ce=Po[K.status]||Po.active,Le=fe(K),Ue=Y(K),ye=Re.find(Te=>Te.id===K.userId),mt=Ue.ticker||Ue.pair||Ue.coin||Z(K),qe=new Date(K.createdAt).toLocaleDateString("ru-RU",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"}),et=ve[K.category];return n.jsxs("div",{className:`rounded-3xl border-2 shadow-xl overflow-hidden transition-all hover:-translate-y-1 ${et.border} ${et.bg}`,children:[n.jsxs("div",{className:`px-5 py-4 flex flex-wrap items-center justify-between gap-3 border-b ${s==="dark"?"border-white/10 bg-white/5":"border-white/70 bg-white/70"}`,children:[n.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[n.jsxs("span",{className:`flex items-center gap-2 px-3 py-1.5 rounded-full text-sm font-semibold border ${et.border} ${et.chipBg||""} ${et.text}`,children:[q.icon,q.label]}),n.jsx("span",{className:`px-3 py-1.5 rounded-full text-xs font-semibold ${Ce.className}`,children:Ce.label}),n.jsxs("span",{className:`px-3 py-1.5 rounded-full text-xs font-semibold ${df[Le]}`,children:["Риск: ",Le]})]}),n.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[n.jsxs("div",{className:`px-3 py-1.5 rounded-xl text-xs font-semibold border ${s==="dark"?"bg-gray-800/70 text-gray-200 border-white/10":"bg-white text-gray-700 border-gray-200"}`,children:[n.jsx("span",{className:"opacity-70",children:"Создано "}),qe]}),ye&&n.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 rounded-xl border border-white/10 bg-black/5 dark:bg-white/5",children:[n.jsx("div",{className:"w-8 h-8 rounded-full bg-gradient-to-r from-[#4E6E49] to-emerald-600 text-white flex items-center justify-center text-sm font-bold",children:ye.name[0]}),n.jsx("span",{className:`text-xs ${V}`,children:ye.name})]}),n.jsxs("div",{className:"flex items-center gap-1",children:[n.jsx("button",{onClick:()=>re(K),className:`p-2 rounded-lg ${s==="dark"?"hover:bg-gray-800":"hover:bg-gray-100"}`,children:n.jsx(ps,{className:"w-4 h-4"})}),K.status!=="cancelled"&&n.jsx("button",{onClick:()=>g(K.id),className:`p-2 rounded-lg ${s==="dark"?"hover:bg-gray-800":"hover:bg-gray-100"}`,children:n.jsx(Ft,{className:"w-4 h-4 text-amber-500"})}),n.jsx("button",{onClick:()=>de(K.id),className:`p-2 rounded-lg ${s==="dark"?"hover:bg-gray-800":"hover:bg-gray-100"}`,children:n.jsx(Bt,{className:"w-4 h-4 text-red-500"})})]})]})]}),n.jsxs("div",{className:"p-5 space-y-5",children:[n.jsxs("div",{className:"grid md:grid-cols-[1.15fr_auto] gap-4 items-start",children:[n.jsxs("div",{className:"space-y-1",children:[n.jsx("p",{className:`text-2xl font-bold ${ae}`,children:Z(K)}),n.jsx("p",{className:`text-sm ${V}`,children:L(K)})]}),n.jsx("div",{className:"flex flex-wrap gap-2 justify-end",children:n.jsx("button",{onClick:()=>J(mt),className:`p-2 rounded-xl border ${X} ${s==="dark"?"hover:bg-gray-800 bg-white/5":"hover:bg-gray-100 bg-white"} transition-colors`,title:"Копировать",children:M===mt?n.jsx(Ls,{className:"w-4 h-4 text-emerald-500"}):n.jsx(Ai,{className:"w-4 h-4"})})})]}),Pe(K)]})]},K.id)})})})]})]})},xn=({userId:s,className:e="",fallback:t="unknown",formatter:r})=>{const i=pc(s)||t;return n.jsx("span",{className:e,children:r?r(i):i})},xS=({selectedUserId:s,slotFilter:e,onEditSlot:t,onEditStatus:r,refreshKey:a})=>{const{theme:i}=lt(),{user:o}=_t(),{isAdmin:l}=Ct(),[c,h]=I.useState([]),[u,m]=I.useState([]),[g,p]=I.useState(new Date),[j,_]=I.useState(!0),[y,M]=I.useState({}),D=oe(new Date,"yyyy-MM-dd"),T={artyom:"1",adel:"2",kseniya:"3",olga:"4",anastasia:"5"},R=B=>{const te=Re.find(ve=>ve.id===B)||Re.find(ve=>T[B]===ve.id);return Tt((te==null?void 0:te.id)||B)},P=fu(g),C=s?Re.filter(B=>B.id===s):Re;I.useEffect(()=>{N()},[s,g,a]),I.useEffect(()=>{const B=()=>{N(!0)};return window.addEventListener("focus",B),()=>window.removeEventListener("focus",B)},[]);const N=async(B=!1)=>{B||_(!0);try{const te=new Date(P[0]);te.setHours(0,0,0,0);const ve=new Date(P[6]);ve.setHours(23,59,59,999);const W=oe(te,"yyyy-MM-dd"),F=oe(ve,"yyyy-MM-dd"),[re,de]=await Promise.all([Is(),Ar()]),$=re.filter(Z=>Z.date>=W&&Z.date<=F),O=de.filter(Z=>{const L=Z.date,fe=Z.endDate||Z.date;return L<=F&&fe>=W}),J=s?$.filter(Z=>Z.userId===s):$,Y=s?O.filter(Z=>Z.userId===s):O;h(J),m(Y)}catch(te){console.error("Error loading data:",te)}finally{B||_(!1)}},b=async B=>{if(!l&&(o==null?void 0:o.id)!==B.userId){alert("Только администратор может удалять чужие слоты");return}if(l){confirm("Удалить слот?")&&(await bc(B.id),N());return}confirm("Отправить на согласование удаление слота?")&&(await It({entity:"slot",action:"delete",authorId:(o==null?void 0:o.id)||B.userId,targetUserId:B.userId,before:B,after:null,comment:B.comment}),N())},v=async(B,te)=>{if(!l&&(o==null?void 0:o.id)!==B.userId){alert("Только администратор может удалять чужие статусы");return}if(B.endDate&&te){const ve=B.date,W=B.endDate;if(te===ve){if(confirm(l?"Удалить первый день диапазона?":"Отправить на согласование удаление первого дня диапазона?")){const F=new Date(ve+"T00:00:00");F.setDate(F.getDate()+1);const re=oe(F,"yyyy-MM-dd");l?await hn(B.id,{...B,date:re}):await It({entity:"status",action:"update",authorId:(o==null?void 0:o.id)||B.userId,targetUserId:B.userId,before:B,after:{...B,date:re},comment:B.comment}),N()}return}if(te===W){if(confirm(l?"Удалить последний день диапазона?":"Отправить на согласование удаление последнего дня диапазона?")){const F=new Date(W+"T00:00:00");F.setDate(F.getDate()-1);const re=oe(F,"yyyy-MM-dd");l?await hn(B.id,{...B,endDate:re}):await It({entity:"status",action:"update",authorId:(o==null?void 0:o.id)||B.userId,targetUserId:B.userId,before:B,after:{...B,endDate:re},comment:B.comment}),N()}return}if(te>ve&&te<W){if(confirm(l?"Удалить этот день? Диапазон будет разбит на две части.":"Отправить на согласование удаление этого дня? Диапазон будет разбит на две части.")){const F=new Date(te+"T00:00:00");F.setDate(F.getDate()-1);const re=oe(F,"yyyy-MM-dd");if(l){await hn(B.id,{...B,endDate:re});const de=new Date(te+"T00:00:00");de.setDate(de.getDate()+1);const $=oe(de,"yyyy-MM-dd");await yc({userId:B.userId,date:$,endDate:W,type:B.type,comment:B.comment})}else{await It({entity:"status",action:"update",authorId:(o==null?void 0:o.id)||B.userId,targetUserId:B.userId,before:B,after:{...B,endDate:re},comment:B.comment});const de=new Date(te+"T00:00:00");de.setDate(de.getDate()+1);const $=oe(de,"yyyy-MM-dd");await It({entity:"status",action:"create",authorId:(o==null?void 0:o.id)||B.userId,targetUserId:B.userId,before:null,after:{id:"",userId:B.userId,date:$,endDate:W,type:B.type,comment:B.comment},comment:B.comment})}N()}return}}l?confirm("Удалить статус?")&&(await vc(B.id),N()):confirm("Отправить на согласование удаление статуса?")&&(await It({entity:"status",action:"delete",authorId:(o==null?void 0:o.id)||B.userId,targetUserId:B.userId,before:B,after:null,comment:B.comment}),N())},S=B=>{const te=Vs(),ve=new Date(te);ve.setHours(0,0,0,0);const W=new Date(B.date);if(W.setHours(0,0,0,0),W>ve)return!0;if(W.getTime()===ve.getTime()){const $=Vs(),O=$.getHours()*60+$.getMinutes();return B.slots.some(J=>{if(J.endDate){const fe=new Date(J.endDate);if(fe.setHours(0,0,0,0),new Date(ve).setHours(23,59,59),fe>ve)return!0;if(fe.getTime()===ve.getTime()){const[H,se]=J.end.split(":").map(Number);return H*60+se>O}return!1}const[Y,Z]=J.end.split(":").map(Number);return Y*60+Z>O})}const F=Vs(),re=F.getHours()*60+F.getMinutes();return B.slots.some($=>{if($.endDate){const O=new Date($.endDate);if(O.setHours(0,0,0,0),O>ve)return!0;if(O.getTime()===ve.getTime()){const[J,Y]=$.end.split(":").map(Number);return J*60+Y>re}return!1}return!1})},E=(B,te)=>{const ve=c.find(W=>W.userId===B&&W.date===te)||null;if(ve&&e!=="all"){const W=S(ve);if(e==="upcoming"&&!W||e==="completed"&&W)return null}return ve},k=(B,te)=>u.find(ve=>ve.userId!==B?!1:ve.endDate?ve.date<=te&&ve.endDate>=te:ve.date===te)||null,w=B=>{const{start:te,end:ve}=Hn(g),W=oe(te,"yyyy-MM-dd"),F=oe(ve,"yyyy-MM-dd"),$=c.filter(ge=>ge.userId===B).filter(ge=>ge.date>=W&&ge.date<=F).reduce((ge,H)=>ge+xc(H.slots),0),O=u.filter(ge=>ge.userId===B),J=ge=>O.filter(H=>H.type===ge).reduce((H,se)=>H+gs(se.date,se.endDate,W,F),0),Y=J("dayoff"),Z=J("sick"),L=J("vacation"),fe=J("absence");return{totalHours:$,daysOff:Y,sickDays:Z,vacationDays:L,absenceDays:fe}},Q=B=>{const te=new Date(g);B==="prev"?te.setDate(te.getDate()-7):te.setDate(te.getDate()+7),p(te)},ae=B=>{M(te=>({...te,[B]:!te[B]}))};if(j)return n.jsx("div",{className:`rounded-lg p-8 text-center ${i==="dark"?"bg-[#1a1a1a]":"bg-white"}`,children:n.jsx("p",{className:i==="dark"?"text-gray-400":"text-gray-600",children:"Загрузка..."})});const V=i==="dark"?"text-white":"text-gray-900",X=i==="dark"?"text-gray-400":"text-gray-500",he={dayoff:"bg-amber-500/10 text-amber-500 border border-amber-500/20",sick:"bg-orange-500/10 text-orange-500 border border-orange-500/20",vacation:"bg-sky-500/10 text-sky-500 border border-sky-500/20",absence:"bg-rose-500/10 text-rose-500 border border-rose-500/20"};return n.jsxs("div",{className:`rounded-2xl ${i==="dark"?"bg-[#0b1015]":"bg-white"} overflow-visible`,children:[n.jsxs("div",{className:`p-4 border-b ${i==="dark"?"border-white/5":"border-gray-100"} flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between`,children:[n.jsxs("button",{onClick:()=>Q("prev"),className:`px-4 py-2 text-sm font-bold rounded-xl transition-all flex items-center gap-2 hover:scale-105 active:scale-95 ${i==="dark"?"bg-[#151a21] text-gray-300 hover:text-white hover:bg-[#1f2937]":"bg-gray-50 text-gray-600 hover:bg-gray-100"}`,children:[n.jsx(an,{className:"w-4 h-4 rotate-90"}),n.jsx("span",{children:"Пред. неделя"})]}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx(Fr,{className:`w-5 h-5 ${i==="dark"?"text-emerald-500":"text-emerald-600"}`}),n.jsxs("span",{className:`${V} font-black text-lg tracking-tight`,children:[oe(P[0],"d MMMM")," — ",oe(P[6],"d MMMM yyyy")]})]}),n.jsxs("button",{onClick:()=>Q("next"),className:`px-4 py-2 text-sm font-bold rounded-xl transition-all flex items-center gap-2 hover:scale-105 active:scale-95 ${i==="dark"?"bg-[#151a21] text-gray-300 hover:text-white hover:bg-[#1f2937]":"bg-gray-50 text-gray-600 hover:bg-gray-100"}`,children:[n.jsx("span",{children:"След. неделя"}),n.jsx(an,{className:"w-4 h-4 -rotate-90"})]})]}),n.jsx("div",{className:"overflow-x-auto",children:n.jsx("div",{className:"min-w-full inline-block align-middle",children:n.jsxs("table",{className:"w-full border-collapse",children:[n.jsx("thead",{className:"sticky top-0 z-30",children:n.jsxs("tr",{className:`${i==="dark"?"bg-[#0b1015]":"bg-white"}`,children:[n.jsx("th",{className:`p-3 text-left text-[10px] font-bold uppercase tracking-wider ${X} sticky left-0 z-30 ${i==="dark"?"bg-[#0b1015]":"bg-white"}`,children:"Участник"}),P.map(B=>{const te=oe(B,"yyyy-MM-dd")===D;return n.jsx("th",{className:"p-1 min-w-[100px] lg:min-w-[120px]",children:n.jsxs("div",{className:`mx-auto w-full p-1.5 rounded-xl border transition-colors ${te?"bg-emerald-500/10 border-emerald-500/50 text-emerald-500":i==="dark"?"bg-[#151a21] border-white/5 text-gray-400":"bg-gray-50 border-gray-100 text-gray-500"}`,children:[n.jsx("div",{className:"text-[9px] uppercase font-bold opacity-70 mb-0.5",children:oe(B,"EEE")}),n.jsx("div",{className:"text-xs font-black",children:oe(B,"dd.MM")})]})},B.toISOString())}),n.jsx("th",{className:`p-3 text-center text-[10px] font-bold uppercase tracking-wider ${X} min-w-[110px]`,children:"Итоги"})]})}),n.jsx("tbody",{className:`divide-y ${i==="dark"?"divide-white/5":"divide-gray-100"}`,children:C.map((B,te)=>{const ve=w(B.id),W=te%2===0?i==="dark"?"bg-[#0f141a]":"bg-gray-50/30":"transparent";return n.jsxs("tr",{className:`${W} hover:bg-emerald-500/5 transition-colors group`,children:[n.jsx("td",{className:`p-2 sticky left-0 z-20 ${W} group-hover:bg-[#1a2029] transition-colors align-middle`,children:n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsxs("div",{className:"relative",children:[B.avatar?n.jsx("img",{src:B.avatar,alt:R(B.id),className:"w-8 h-8 rounded-full object-cover border border-emerald-500/20 shadow-sm",onError:F=>{const re=F.target;re.style.display="none";const de=re.nextElementSibling;de&&(de.style.display="flex")}}):null,n.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center font-bold text-xs ${i==="dark"?"bg-[#1f2937] text-gray-300":"bg-gray-200 text-gray-600"} ${B.avatar?"absolute inset-0 hidden":""}`,children:n.jsx(xn,{userId:B.id,formatter:F=>F.charAt(0).toUpperCase()})}),n.jsx("div",{className:"absolute -bottom-0.5 -right-0.5 w-2.5 h-2.5 rounded-full bg-emerald-500 border-2 border-[#0b1015]"})]}),n.jsxs("div",{children:[n.jsx("div",{className:`font-bold text-[13px] leading-tight ${V}`,children:n.jsx(xn,{userId:B.id})}),n.jsx("div",{className:"text-[9px] text-gray-500 font-medium uppercase tracking-tight",children:"Member"})]})]})}),P.map(F=>{const re=oe(F,"yyyy-MM-dd"),de=E(B.id,re),$=k(B.id,re);return n.jsx("td",{className:"p-1.5 align-middle",children:de?n.jsx("div",{className:"flex flex-col items-center gap-1.5",children:de.slots.map((O,J)=>{const Y=`${de.id}-${J}`,Z=y[Y];return n.jsxs("div",{className:"w-full flex flex-col items-center gap-1.5 group/timecard",children:[n.jsxs("div",{className:`w-full max-w-[120px] rounded-xl p-2 text-[10px] font-bold transition-all relative overflow-hidden shadow-md ${i==="dark"?"bg-[#1a1f26] border border-white/5 text-gray-200":"bg-gray-100 text-gray-700"}`,children:[n.jsxs("div",{className:"flex flex-col items-center gap-1.5",children:[n.jsxs("div",{className:"flex items-center gap-1 opacity-80",children:[n.jsx(Ks,{className:"w-3 h-3"}),n.jsxs("span",{className:"whitespace-nowrap tracking-tight",children:[O.start," - ",O.end]})]}),O.breaks&&O.breaks.length>0&&n.jsx("button",{onClick:()=>ae(Y),className:"p-0.5 hover:bg-white/10 rounded-md transition-colors",children:Z?n.jsx(Pp,{className:"w-3 h-3"}):n.jsx(an,{className:"w-3 h-3"})})]}),Z&&O.breaks&&O.breaks.length>0&&n.jsx("div",{className:"mt-1.5 pt-1.5 border-t border-white/10 space-y-0.5 w-full text-center",children:O.breaks.map((L,fe)=>n.jsxs("div",{className:"text-[9px] opacity-70 font-medium",children:[L.start," - ",L.end]},fe))})]}),n.jsxs("div",{className:"flex items-center gap-2 opacity-0 group-hover/timecard:opacity-100 transition-opacity duration-200",children:[n.jsx("button",{onClick:()=>t(de),className:`transition-all hover:scale-110 ${i==="dark"?"text-blue-400 hover:text-blue-300":"text-blue-600 hover:text-blue-500"}`,children:n.jsx(ps,{className:"w-3.5 h-3.5"})}),n.jsx("button",{onClick:()=>b(de),className:`transition-all hover:scale-110 ${i==="dark"?"text-rose-500 hover:text-rose-400":"text-rose-600 hover:text-rose-500"}`,children:n.jsx(Bt,{className:"w-3.5 h-3.5"})})]})]},J)})}):$?n.jsxs("div",{className:"flex flex-col items-center gap-1.5 group/status",children:[n.jsx("div",{className:`w-full max-w-[120px] rounded-lg p-2 text-[10px] font-black text-center border shadow-sm ${i==="dark"?"bg-[#2A3441]/40":"bg-white"} ${he[$.type]}`,children:$.type==="dayoff"?"Выходной":$.type==="sick"?"Больничный":$.type==="vacation"?"Отпуск":"Прогул"}),n.jsxs("div",{className:"flex items-center gap-2 opacity-0 group-hover/status:opacity-100 transition-opacity duration-200",children:[n.jsx("button",{onClick:()=>r($),className:`transition-all hover:scale-110 ${i==="dark"?"text-blue-400 hover:text-blue-300":"text-blue-600 hover:text-blue-500"}`,children:n.jsx(ps,{className:"w-3.5 h-3.5"})}),n.jsx("button",{onClick:()=>v($,re),className:`transition-all hover:scale-110 ${i==="dark"?"text-rose-500 hover:text-rose-400":"text-rose-600 hover:text-rose-500"}`,children:n.jsx(Bt,{className:"w-3.5 h-3.5"})})]})]}):n.jsx("div",{className:"h-8 w-full max-w-[120px] mx-auto rounded-lg border border-dashed border-gray-700/20 dark:border-white/5 opacity-20"})},re)}),n.jsx("td",{className:"p-2 align-middle",children:n.jsxs("div",{className:"space-y-1 py-1 min-w-[110px] text-center ml-2",children:[n.jsxs("div",{className:`text-[12px] font-medium leading-tight ${V}`,children:["Часов: ",ve.totalHours.toFixed(1)]}),n.jsxs("div",{className:`text-[12px] font-medium leading-tight ${V}`,children:["Выходных: ",ve.daysOff]}),n.jsxs("div",{className:`text-[12px] font-medium leading-tight ${V}`,children:["Больничных: ",ve.sickDays]}),n.jsxs("div",{className:`text-[12px] font-medium leading-tight ${V}`,children:["Отпусков: ",ve.vacationDays]}),n.jsxs("div",{className:`text-[12px] font-medium leading-tight ${V}`,children:["Прогулов: ",ve.absenceDays]})]})})]},B.id)})})]})})})]})},bS=({selectedUserId:s,slotFilter:e,onEditSlot:t,onEditStatus:r,refreshKey:a})=>{const{theme:i}=lt(),{user:o}=_t(),{isAdmin:l}=Ct(),[c,h]=I.useState([]),[u,m]=I.useState([]),[g,p]=I.useState(new Date),[j,_]=I.useState(!0),[y,M]=I.useState({}),D={artyom:"1",adel:"2",kseniya:"3",olga:"4",anastasia:"5"},T=V=>{const X=Re.find(he=>he.id===V)||Re.find(he=>D[V]===he.id);return{member:X,displayName:Tt((X==null?void 0:X.id)||V)}},R=fu(g),P=new Date;I.useEffect(()=>{C()},[s,g,a]),I.useEffect(()=>{const V=()=>{C(!0)};return window.addEventListener("focus",V),()=>window.removeEventListener("focus",V)},[]);const C=async(V=!1)=>{V||_(!0);try{const X=new Date(R[0]);X.setHours(0,0,0,0);const he=new Date(R[6]);he.setHours(23,59,59,999);const B=oe(X,"yyyy-MM-dd"),te=oe(he,"yyyy-MM-dd"),[ve,W]=await Promise.all([Is(),Ar()]),F=ve.filter(O=>O.date>=B&&O.date<=te),re=W.filter(O=>{const J=O.date,Y=O.endDate||O.date;return J<=te&&Y>=B}),de=s?F.filter(O=>O.userId===s):F,$=s?re.filter(O=>O.userId===s):re;console.log("Loaded slots (week view):",{weekStart:B,weekEnd:te,allSlotsCount:ve.length,weekSlotsCount:F.length,filteredSlotsCount:de.length,selectedUserId:s}),h(de),m($)}catch(X){console.error("Error loading data:",X)}finally{V||_(!1)}},N=async V=>{if(!l&&(o==null?void 0:o.id)!==V.userId){alert("Только администратор может удалять чужие слоты");return}if(l){confirm("Удалить слот?")&&(await bc(V.id),C());return}confirm("Отправить на согласование удаление слота?")&&(await It({entity:"slot",action:"delete",authorId:(o==null?void 0:o.id)||V.userId,targetUserId:V.userId,before:V,after:null,comment:V.comment}),C())},b=async(V,X)=>{if(!l&&(o==null?void 0:o.id)!==V.userId){alert("Только администратор может удалять чужие статусы");return}if(V.endDate&&X){const he=V.date,B=V.endDate;if(X===he){if(confirm(l?"Удалить первый день диапазона?":"Отправить на согласование удаление первого дня диапазона?")){const te=new Date(Rs(he));te.setDate(te.getDate()+1);const ve=oe(te,"yyyy-MM-dd");l?await hn(V.id,{...V,date:ve}):await It({entity:"status",action:"update",authorId:(o==null?void 0:o.id)||V.userId,targetUserId:V.userId,before:V,after:{...V,date:ve},comment:V.comment}),C()}return}if(X===B){if(confirm(l?"Удалить последний день диапазона?":"Отправить на согласование удаление последнего дня диапазона?")){const te=new Date(Rs(B));te.setDate(te.getDate()-1);const ve=oe(te,"yyyy-MM-dd");l?await hn(V.id,{...V,endDate:ve}):await It({entity:"status",action:"update",authorId:(o==null?void 0:o.id)||V.userId,targetUserId:V.userId,before:V,after:{...V,endDate:ve},comment:V.comment}),C()}return}if(X>he&&X<B){if(confirm(l?"Удалить этот день? Диапазон будет разбит на две части.":"Отправить на согласование удаление этого дня? Диапазон будет разбит на две части.")){const te=new Date(Rs(X));te.setDate(te.getDate()-1);const ve=oe(te,"yyyy-MM-dd");if(l){await hn(V.id,{...V,endDate:ve});const W=new Date(Rs(X));W.setDate(W.getDate()+1);const F=oe(W,"yyyy-MM-dd");await yc({userId:V.userId,date:F,endDate:B,type:V.type,comment:V.comment})}else{await It({entity:"status",action:"update",authorId:(o==null?void 0:o.id)||V.userId,targetUserId:V.userId,before:V,after:{...V,endDate:ve},comment:V.comment});const W=new Date(Rs(X));W.setDate(W.getDate()+1);const F=oe(W,"yyyy-MM-dd");await It({entity:"status",action:"create",authorId:(o==null?void 0:o.id)||V.userId,targetUserId:V.userId,before:null,after:{id:"",userId:V.userId,date:F,endDate:B,type:V.type,comment:V.comment},comment:V.comment})}C()}return}}l?confirm("Удалить статус?")&&(await vc(V.id),C()):confirm("Отправить на согласование удаление статуса?")&&(await It({entity:"status",action:"delete",authorId:(o==null?void 0:o.id)||V.userId,targetUserId:V.userId,before:V,after:null,comment:V.comment}),C())},v=V=>{const X=Vs(),he=new Date(X);he.setHours(0,0,0,0);const B=new Date(V.date);if(B.setHours(0,0,0,0),B>he)return!0;if(B.getTime()===he.getTime()){const F=Vs(),re=F.getHours()*60+F.getMinutes();return V.slots.some(de=>{if(de.endDate){const Y=new Date(de.endDate);if(Y.setHours(0,0,0,0),new Date(he).setHours(23,59,59),Y>he)return!0;if(Y.getTime()===he.getTime()){const[L,fe]=de.end.split(":").map(Number);return L*60+fe>re}return!1}const[$,O]=de.end.split(":").map(Number);return $*60+O>re})}const te=Vs(),ve=te.getHours()*60+te.getMinutes();return V.slots.some(F=>{if(F.endDate){const re=new Date(F.endDate);if(re.setHours(0,0,0,0),re>he)return!0;if(re.getTime()===he.getTime()){const[de,$]=F.end.split(":").map(Number);return de*60+$>ve}return!1}return!1})},S=V=>{let X=c.filter(he=>he.date===V);return e!=="all"&&(X=X.filter(he=>{const B=v(he);return e==="upcoming"?B:e==="completed"?!B:!0})),X},E=V=>u.filter(X=>X.endDate?X.date<=V&&X.endDate>=V:X.date===V),k=V=>{const X=new Date(g);V==="prev"?X.setDate(X.getDate()-7):X.setDate(X.getDate()+7),p(X)},w=V=>{M(X=>({...X,[V]:!X[V]}))};if(j)return n.jsx("div",{className:`rounded-lg p-8 text-center ${i==="dark"?"bg-[#1a1a1a]":"bg-white"}`,children:n.jsx("p",{className:i==="dark"?"text-gray-400":"text-gray-600",children:"Загрузка..."})});const Q=i==="dark"?"text-white":"text-gray-900",ae={dayoff:"bg-amber-500/10 text-amber-500 border border-amber-500/20",sick:"bg-orange-500/10 text-orange-500 border border-orange-500/20",vacation:"bg-sky-500/10 text-sky-500 border border-sky-500/20",absence:"bg-rose-500/10 text-rose-500 border border-rose-500/20"};return n.jsxs("div",{className:`rounded-2xl ${i==="dark"?"bg-transparent":"bg-white"} overflow-visible`,children:[n.jsxs("div",{className:`p-3 sm:p-4 border-b ${i==="dark"?"border-white/5":"border-gray-100"} flex flex-col gap-2 sm:gap-3 sm:flex-row sm:items-center sm:justify-between`,children:[n.jsxs("button",{onClick:()=>k("prev"),className:`px-4 py-2 text-sm font-bold rounded-xl transition-all flex items-center gap-2 hover:scale-105 active:scale-95 ${i==="dark"?"bg-[#151a21] text-gray-300 hover:text-white hover:bg-[#1f2937]":"bg-gray-50 text-gray-600 hover:bg-gray-100"}`,children:[n.jsx(an,{className:"w-4 h-4 rotate-90"}),n.jsx("span",{children:"Пред. неделя"})]}),n.jsxs("span",{className:`${Q} font-black text-lg tracking-tight whitespace-nowrap`,children:[oe(R[0],"d MMMM")," — ",oe(R[6],"d MMMM yyyy")]}),n.jsxs("button",{onClick:()=>k("next"),className:`px-4 py-2 text-sm font-bold rounded-xl transition-all flex items-center gap-2 hover:scale-105 active:scale-95 ${i==="dark"?"bg-[#151a21] text-gray-300 hover:text-white hover:bg-[#1f2937]":"bg-gray-50 text-gray-600 hover:bg-gray-100"}`,children:[n.jsx("span",{children:"След. неделя"}),n.jsx(an,{className:"w-4 h-4 -rotate-90"})]})]}),n.jsx("div",{className:"p-3 sm:p-4 space-y-3 sm:space-y-4",children:R.map(V=>{const X=oe(V,"yyyy-MM-dd"),he=S(X),B=E(X),te=pb(V,P),ve="relative rounded-xl p-4 sm:p-5 border transition-all duration-300",W=i==="dark"?"bg-[#0b1015] border-white/5 shadow-md":"bg-gray-50 border-gray-200 shadow-sm",F=i==="dark"?"border-emerald-500/50 bg-emerald-500/5 ring-1 ring-emerald-500/20":"border-emerald-300 bg-emerald-50 ring-2 ring-emerald-200/70";return n.jsxs("div",{className:`${ve} ${W} ${te?F:""}`,children:[te&&n.jsxs("div",{className:"absolute top-3 right-3 inline-flex items-center gap-2 px-3 py-1 rounded-full bg-emerald-500 text-white text-xs font-semibold shadow-lg ring-2 ring-white/50 dark:ring-emerald-200/30",children:[n.jsx("span",{className:"w-2 h-2 rounded-full bg-white animate-ping"}),n.jsx("span",{className:"relative",children:"Сегодня"})]}),n.jsx("h3",{className:`text-lg font-semibold mb-3 ${Q}`,children:oe(V,"dd.MM.yyyy")}),n.jsxs("div",{className:"space-y-3 sm:space-y-4",children:[B.map(re=>{const{displayName:de}=T(re.userId);return n.jsxs("div",{className:`relative flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 p-4 rounded-2xl border-2 transition-all duration-300 hover:shadow-xl backdrop-blur text-center sm:text-left ring-1 ring-inset ring-black/5 dark:ring-white/5 ${ae[re.type]}`,children:[n.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2 justify-center sm:justify-start w-full",children:[n.jsx("span",{className:"font-semibold text-base sm:text-lg",children:de}),n.jsx("span",{className:"inline-flex items-center gap-2 px-3 py-1 rounded-full bg-white/70 dark:bg-white/10 text-xs sm:text-sm font-semibold",children:re.type==="dayoff"?"Выходной":re.type==="sick"?"Больничный":re.type==="vacation"?"Отпуск":"Прогул"})]}),n.jsx("div",{className:"flex gap-2 justify-center sm:justify-end w-full",children:l||(o==null?void 0:o.id)===re.userId?n.jsxs(n.Fragment,{children:[n.jsx("button",{onClick:()=>r(re),className:`p-1 rounded transition-colors ${i==="dark"?"bg-white/10 hover:bg-white/20 text-white":"bg-white border border-gray-200 text-gray-700 hover:bg-gray-100"}`,children:n.jsx(ps,{className:"w-4 h-4 text-current"})}),n.jsx("button",{onClick:()=>b(re,X),className:`p-1 rounded transition-colors ${i==="dark"?"bg-white/10 hover:bg-white/20 text-white":"bg-white border border-gray-200 text-gray-700 hover:bg-gray-100"}`,children:n.jsx(Bt,{className:"w-4 h-4 text-current"})})]}):n.jsxs(n.Fragment,{children:[n.jsx("button",{disabled:!0,className:`p-1 cursor-not-allowed rounded ${i==="dark"?"bg-white/5 text-white/60":"bg-gray-100 text-gray-400 border border-gray-200"}`,title:"Вы можете редактировать только свои статусы",children:n.jsx(ps,{className:"w-4 h-4 text-current opacity-60"})}),n.jsx("button",{disabled:!0,className:`p-1 cursor-not-allowed rounded ${i==="dark"?"bg-white/5 text-white/60":"bg-gray-100 text-gray-400 border border-gray-200"}`,title:"Вы можете удалять только свои статусы",children:n.jsx(Bt,{className:"w-4 h-4 text-current opacity-60"})})]})})]},re.id)}),he.map(re=>{const{member:de,displayName:$}=T(re.userId),O=v(re),J=O?"bg-gradient-to-r from-emerald-500 to-teal-600 border-emerald-300/40":"bg-gradient-to-r from-slate-500 to-slate-700 border-slate-300/40",Y=O?Fr:Qi;return n.jsxs("div",{className:`group relative space-y-2 sm:space-y-3 p-3 sm:p-4 ${J} rounded-lg sm:rounded-xl shadow-xl border-2 transition-all duration-300 hover:shadow-2xl active:scale-[0.98] sm:hover:scale-[1.03] mb-2 sm:mb-3 ${O?"hover:border-emerald-200/80 ring-2 ring-emerald-200/40 hover:ring-4 hover:ring-emerald-200/60":"hover:border-slate-200/80 ring-2 ring-slate-200/40 hover:ring-4 hover:ring-slate-200/60"}`,children:[n.jsxs("div",{className:"flex items-center justify-between border-b border-white/20 pb-2 sm:pb-3",children:[n.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 min-w-0 flex-1",children:[n.jsxs("div",{className:"relative flex-shrink-0 group/avatar",children:[de!=null&&de.avatar?n.jsx("img",{src:de.avatar,alt:$,className:`w-8 h-8 sm:w-9 sm:h-9 md:w-10 md:h-10 lg:w-11 lg:h-11 rounded-full object-cover border-2 shadow-xl transition-all duration-300 group-hover/avatar:scale-110 group-hover/avatar:shadow-2xl ${O?"border-white/50 ring-2 ring-white/40 ring-offset-2 ring-offset-emerald-400/30 group-hover/avatar:ring-4 group-hover/avatar:ring-white/60":"border-white/40 ring-2 ring-white/30 ring-offset-2 ring-offset-slate-400/30 group-hover/avatar:ring-4 group-hover/avatar:ring-white/50"}`,onError:Z=>{const L=Z.target;L.style.display="none";const fe=L.nextElementSibling;fe&&(fe.style.display="flex")}}):null,n.jsx("div",{className:`w-8 h-8 sm:w-9 sm:h-9 md:w-10 md:h-10 lg:w-11 lg:h-11 rounded-full flex items-center justify-center font-bold text-xs sm:text-sm transition-all duration-300 shadow-xl group-hover/avatar:scale-110 group-hover/avatar:shadow-2xl ${O?"bg-white/25 backdrop-blur-md border-2 border-white/40 ring-2 ring-white/30 group-hover/avatar:ring-4 group-hover/avatar:ring-white/60":"bg-white/15 backdrop-blur-md border-2 border-white/30 ring-2 ring-white/20 group-hover/avatar:ring-4 group-hover/avatar:ring-white/50"} ${de!=null&&de.avatar?"absolute inset-0 hidden":""}`,children:$.charAt(0).toUpperCase()}),n.jsx("div",{className:`absolute -bottom-0.5 -right-0.5 w-2.5 h-2.5 sm:w-3 sm:h-3 md:w-3.5 md:h-3.5 rounded-full border border-white sm:border-2 shadow-lg animate-pulse opacity-0 group-hover/avatar:opacity-100 transition-opacity duration-300 ${O?"bg-emerald-300":"bg-slate-400"}`})]}),n.jsx("span",{className:"text-white font-bold text-sm sm:text-base group-hover:scale-105 transition-transform duration-300 truncate",children:$})]}),n.jsx("div",{className:"flex gap-2",children:l||(o==null?void 0:o.id)===re.userId?n.jsxs(n.Fragment,{children:[n.jsx("button",{onClick:()=>t(re),className:"p-1.5 bg-white/20 hover:bg-white/30 rounded-lg transition-colors",children:n.jsx(ps,{className:"w-4 h-4 text-white"})}),n.jsx("button",{onClick:()=>N(re),className:"p-1.5 bg-white/20 hover:bg-white/30 rounded-lg transition-colors",children:n.jsx(Bt,{className:"w-4 h-4 text-white"})})]}):n.jsxs(n.Fragment,{children:[n.jsx("button",{disabled:!0,className:"p-1.5 bg-white/10 cursor-not-allowed rounded-lg",title:"Вы можете редактировать только свои слоты",children:n.jsx(ps,{className:"w-4 h-4 text-white/50"})}),n.jsx("button",{disabled:!0,className:"p-1.5 bg-white/10 cursor-not-allowed rounded-lg",title:"Вы можете удалять только свои слоты",children:n.jsx(Bt,{className:"w-4 h-4 text-white/50"})})]})})]}),n.jsx("div",{className:"space-y-2",children:re.slots.map((Z,L)=>n.jsxs("div",{className:"space-y-1.5",children:[n.jsx("div",{className:`bg-white/25 backdrop-blur-md rounded-md sm:rounded-lg px-2 sm:px-3 py-1.5 sm:py-2 border-2 transition-all duration-300 hover:scale-105 hover:shadow-xl ${O?"border-white/40 ring-2 ring-white/20 hover:border-white/60 hover:ring-4 hover:ring-white/40":"border-white/30 ring-2 ring-white/10 hover:border-white/50 hover:ring-4 hover:ring-white/30"}`,children:n.jsxs("div",{className:"flex items-center gap-1.5 sm:gap-2 flex-wrap",children:[n.jsx(Y,{className:`w-3.5 h-3.5 sm:w-4 sm:h-4 text-white flex-shrink-0 ${O?"animate-pulse":""}`}),n.jsxs("span",{className:"text-white font-bold text-xs sm:text-sm whitespace-nowrap",children:[Z.start," - ",Z.end]}),Z.endDate&&n.jsxs("span",{className:"text-white/80 font-medium text-[10px] sm:text-xs whitespace-nowrap",children:["(до ",oe(new Date(Z.endDate),"dd.MM"),")"]})]})}),Z.breaks&&Z.breaks.length>0&&n.jsx("div",{className:"flex justify-center",children:n.jsx("button",{onClick:()=>w(re.id),className:`p-1 rounded-md transition-all duration-200 hover:scale-110 ${y[re.id]?"text-white hover:text-white/80":"text-white/70 hover:text-white"}`,title:y[re.id]?"Скрыть перерывы":"Показать перерывы",children:y[re.id]?n.jsx(Pp,{className:"w-4 h-4"}):n.jsx(an,{className:"w-4 h-4"})})}),Z.breaks&&Z.breaks.length>0&&y[re.id]&&n.jsxs("div",{className:"space-y-1 w-full",children:[n.jsx("div",{className:`text-[10px] ${i==="dark"?"text-gray-300":"text-gray-700"} font-medium text-center sm:text-left`,children:"Перерывы:"}),Z.breaks.map((fe,ge)=>n.jsx("div",{className:`${i==="dark"?"bg-gray-700/95":"bg-white"} ${i==="dark"?"text-gray-200":"text-gray-900"} border-2 ${i==="dark"?"border-orange-500/60":"border-orange-300"} rounded-md sm:rounded-lg px-2 sm:px-3 py-1 sm:py-1.5 text-[10px] sm:text-xs font-semibold shadow-lg transition-all duration-300 hover:scale-105 hover:shadow-xl ${i==="dark"?"hover:border-orange-400/80 hover:shadow-orange-500/30 ring-2 ring-orange-500/20 hover:ring-4 hover:ring-orange-400/40":"hover:border-orange-400 hover:shadow-orange-400/30 ring-2 ring-orange-300/20 hover:ring-4 hover:ring-orange-300/40"} w-full`,children:n.jsxs("span",{className:"flex items-center gap-1 sm:gap-1.5 justify-center flex-wrap w-full",children:[n.jsx("span",{className:`w-1 h-1 sm:w-1.5 sm:h-1.5 rounded-full ${i==="dark"?"bg-orange-400":"bg-orange-500"} animate-pulse flex-shrink-0`}),n.jsxs("span",{className:"whitespace-nowrap",children:[fe.start," - ",fe.end]})]})},ge))]})]},L))})]},re.id)}),he.length===0&&B.length===0&&X===oe(P,"yyyy-MM-dd")&&n.jsx("div",{className:`rounded-lg px-3 py-2 text-xs font-semibold ring-1 ring-inset ring-black/5 dark:ring-white/10 ${ae.absence}`,children:"Прогул"}),he.length===0&&B.length===0&&X!==oe(P,"yyyy-MM-dd")&&n.jsx("p",{className:`text-sm ${i==="dark"?"text-gray-400":"text-gray-600"}`,children:"Нет данных"})]})]},X)})})]})},yS=({selectedUserId:s,onSelect:e})=>{const{theme:t}=lt(),[r,a]=I.useState(!1),[i,o]=I.useState(""),l=I.useRef(null),c=Re.find(m=>m.id===s),h=pc(s||"");I.useEffect(()=>{const m=g=>{l.current&&!l.current.contains(g.target)&&a(!1)};return document.addEventListener("mousedown",m),()=>document.removeEventListener("mousedown",m)},[]);const u=Re.filter(m=>{const g=m.name.toLowerCase(),p=m.login.toLowerCase(),j=i.toLowerCase();return g.includes(j)||p.includes(j)});return n.jsxs("div",{className:"relative w-full",ref:l,children:[n.jsxs("button",{onClick:()=>a(!r),className:`w-full flex items-center justify-between gap-3 px-4 py-2.5 rounded-xl border transition-all ${t==="dark"?"bg-[#151a21] border-white/5 text-gray-300 hover:border-emerald-500/30":"bg-gray-50 border-gray-200 text-gray-700 hover:border-emerald-500"}`,children:[n.jsx("div",{className:"flex items-center gap-2.5 overflow-hidden",children:c?n.jsxs(n.Fragment,{children:[c.avatar?n.jsx("img",{src:c.avatar,alt:"",className:"w-5 h-5 rounded-full object-cover flex-shrink-0"}):n.jsx("div",{className:"w-5 h-5 rounded-full flex items-center justify-center text-[10px] bg-emerald-500/20 text-emerald-500 flex-shrink-0",children:n.jsx(Rn,{size:12})}),n.jsx("span",{className:"text-sm font-bold truncate",children:h||c.name})]}):n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"w-5 h-5 rounded-full flex items-center justify-center border border-dashed border-gray-500 flex-shrink-0",children:n.jsx(Rn,{size:12,className:"text-gray-500"})}),n.jsx("span",{className:"text-sm font-semibold text-gray-500",children:"Все участники..."})]})}),n.jsx(an,{size:16,className:`text-gray-500 transition-transform ${r?"rotate-180":""}`})]}),r&&n.jsxs("div",{className:`absolute z-50 top-full mt-2 w-full min-w-[240px] rounded-2xl border shadow-2xl overflow-hidden animate-in fade-in slide-in-from-top-2 duration-200 ${t==="dark"?"bg-[#1a1f26] border-white/10":"bg-white border-gray-200"}`,children:[n.jsx("div",{className:"p-3 border-b border-white/5",children:n.jsxs("div",{className:"relative",children:[n.jsx(fh,{size:14,className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-500"}),n.jsx("input",{type:"text",placeholder:"Поиск участника...",value:i,onChange:m=>o(m.target.value),className:`w-full pl-9 pr-8 py-2 rounded-lg text-xs font-medium outline-none transition-all ${t==="dark"?"bg-black/20 text-gray-300 focus:bg-black/40":"bg-gray-100 text-gray-700 focus:bg-gray-200"}`,autoFocus:!0}),i&&n.jsx("button",{onClick:()=>o(""),className:"absolute right-2 top-1/2 -translate-y-1/2 p-1 hover:text-rose-500",children:n.jsx(Ft,{size:12})})]})}),n.jsxs("div",{className:"max-h-[300px] overflow-y-auto p-1.5 custom-scrollbar",children:[n.jsxs("button",{onClick:()=>{e(null),a(!1)},className:`w-full flex items-center gap-3 px-3 py-2 rounded-lg transition-all text-left ${s?t==="dark"?"hover:bg-white/5 text-gray-400":"hover:bg-gray-50 text-gray-600":t==="dark"?"bg-emerald-500/10 text-emerald-400":"bg-emerald-50 text-emerald-600"}`,children:[n.jsx("div",{className:"w-6 h-6 rounded-full flex items-center justify-center border border-dashed border-gray-500 text-[10px]",children:n.jsx(Rn,{size:12})}),n.jsx("span",{className:"text-xs font-bold",children:"Все участники"})]}),u.map(m=>n.jsx(vS,{member:m,isSelected:s===m.id,onSelect:g=>{e(g),a(!1)},theme:t},m.id)),u.length===0&&n.jsx("div",{className:"p-4 text-center",children:n.jsx("p",{className:"text-[10px] text-gray-500",children:"Никого не нашли :("})})]})]})]})},vS=({member:s,isSelected:e,onSelect:t,theme:r})=>{const a=pc(s.id);return n.jsxs("button",{onClick:()=>t(s.id),className:`w-full flex items-center gap-3 px-3 py-2 rounded-lg transition-all text-left group ${e?r==="dark"?"bg-emerald-500/10 text-emerald-400":"bg-emerald-50 text-emerald-600":r==="dark"?"hover:bg-white/5 text-gray-300":"hover:bg-gray-50 text-gray-700"}`,children:[n.jsx("div",{className:"relative",children:s.avatar?n.jsx("img",{src:s.avatar,alt:"",className:"w-6 h-6 rounded-full object-cover group-hover:ring-2 ring-emerald-500/30 transition-all"}):n.jsx("div",{className:`w-6 h-6 rounded-full flex items-center justify-center text-[10px] ${e?"bg-emerald-500/20 text-emerald-500":"bg-gray-500/10 text-gray-500"}`,children:s.name[0]})}),n.jsxs("div",{className:"flex flex-col min-w-0",children:[n.jsx("span",{className:"text-xs font-bold truncate",children:a||s.name}),n.jsx("span",{className:"text-[9px] opacity-50 truncate",children:s.login})]})]})},wS=({slot:s,onClose:e,onSave:t})=>{var Yt;const{user:r}=_t(),{theme:a}=lt(),{isAdmin:i}=Ct(),o=a==="dark"?"text-white":"text-gray-900",l=(s==null?void 0:s.date)||oe(new Date,"yyyy-MM-dd"),[c,h]=I.useState(l),[u,m]=I.useState(s!=null&&s.userId?[s.userId]:r!=null&&r.id?[r.id]:[]),[g,p]=I.useState(((Yt=s==null?void 0:s.slots)==null?void 0:Yt.map(ie=>{const Ne=ie;return Ne.break&&!Ne.breaks?{...ie,breaks:[Ne.break]}:ie}))||[]),[j,_]=I.useState(""),[y,M]=I.useState(""),[D,T]=I.useState(!1),[R,P]=I.useState(""),[C,N]=I.useState(""),[b,v]=I.useState(null),[S,E]=I.useState(null),[k,w]=I.useState(null),[Q,ae]=I.useState(null),[V,X]=I.useState((s==null?void 0:s.comment)||""),[he,B]=I.useState(!1),[te,ve]=I.useState([]),[W,F]=I.useState(!1),[re,de]=I.useState([]),[$,O]=I.useState("single"),[J,Y]=I.useState(l),[Z,L]=I.useState(l),[fe,ge]=I.useState(l),[H,se]=I.useState([]),[je,Se]=I.useState(""),[G,xe]=I.useState(!1);Ur();const z=["Пн","Вт","Ср","Чт","Пт","Сб","Вс"],ce=i&&!s;I.useEffect(()=>{console.log("SlotForm mounted, user:",r==null?void 0:r.name,"slots count:",g.length)},[]),I.useEffect(()=>{if(he&&c){const ie=new Date(c),Ne=ie.getDay()===0?6:ie.getDay()-1;ve([Ne])}},[he,c]),I.useEffect(()=>{W||de([])},[W]),I.useEffect(()=>{$!=="single"&&(B(!1),ve([]),F(!1),de([]))},[$]);const ke=()=>{var st;if(!j||!y){Se("Заполните время начала и окончания");return}const ie=ws(j)>=ws(y),Ne=D||ie;if(ie&&!D){Se('Время окончания должно быть позже времени начала. Включите "Переходит через полночь" для слотов, переходящих на следующий день.');return}let Ae;if(Ne&&c){const ze=new Date(c);ze.setDate(ze.getDate()+1),Ae=oe(ze,"yyyy-MM-dd")}const Ze=b!==null?((st=g[b])==null?void 0:st.breaks)||[]:[],Xe={start:j,end:y,...Ae&&{endDate:Ae},breaks:Ze};if(b!==null){const ze=[...g];ze[b]=Xe,p(ze)}else p([...g,Xe]);_(""),M(""),T(!1),P(""),N(""),v(null),E(null),Se("")},ue=ie=>{const Ne=g[ie];if(!Ne)return;const Ae=!!Ne.endDate||ws(Ne.end)<=ws(Ne.start);_(Ne.start),M(Ne.end),T(Ae),v(ie),E(null),w(null),ae(null),P(""),N(""),Se("")},$e=()=>{v(null),_(""),M(""),T(!1),Se("")},Oe=ie=>{if(!R||!C){Se("Заполните время начала и окончания перерыва");return}const Ne=g[ie];if(!Ne)return;if(R>=C){Se("Время окончания перерыва должно быть позже времени начала");return}const Ae=ws(R),Ze=ws(C),Xe=ws(Ne.start),st=ws(Ne.end),ze=Ne.endDate||st<=Xe;let Be=!1;if(ze){const ne=Ae>=Xe&&Ae<1440&&Ze>Ae&&Ze<=1440&&Ze>Ae,me=Ae>=0&&Ae<=st&&Ze>Ae&&Ze<=st,Qe=Ae>=Xe&&Ae<1440&&Ze>0&&Ze<=st&&Ae>Ze;Be=ne||me||Qe}else Be=Ae>=Xe&&Ze<=st&&Ze>Ae;if(!Be){Se(`Перерыв должен быть в пределах времени слота (${Ne.start} - ${Ne.end})`);return}const Ge=Ne.breaks||[];for(let St=0;St<Ge.length;St++){if(k===ie&&Q===St)continue;const ne=Ge[St];if(R>=ne.start&&R<ne.end||C>ne.start&&C<=ne.end||R<=ne.start&&C>=ne.end){Se("Перерывы не должны пересекаться");return}}let at;k===ie&&Q!==null?(at=[...Ge],at[Q]={start:R,end:C},at.sort((St,ne)=>St.start.localeCompare(ne.start))):at=[...Ge,{start:R,end:C}].sort((St,ne)=>St.start.localeCompare(ne.start));const yt=[...g];yt[ie]={...Ne,breaks:at},p(yt),P(""),N(""),E(null),w(null),ae(null),Se("")},U=(ie,Ne)=>{const Ae=g[ie];if(!Ae||!Ae.breaks||!Ae.breaks[Ne])return;const Ze=Ae.breaks[Ne];w(ie),ae(Ne),E(ie),P(Ze.start),N(Ze.end),Se("")},_e=()=>{P(""),N(""),E(null),w(null),ae(null),Se("")},Pe=(ie,Ne)=>{const Ae=g[ie];if(!Ae||!Ae.breaks)return;const Ze=Ae.breaks.filter((st,ze)=>ze!==Ne),Xe=[...g];Xe[ie]={...Ae,breaks:Ze.length>0?Ze:void 0},p(Xe)},K=ie=>{p(g.filter((Ne,Ae)=>Ae!==ie)),b===ie&&$e()},q=ie=>{te.includes(ie)?ve(te.filter(Ne=>Ne!==ie)):ve([...te,ie])},Ce=ie=>{re.includes(ie)?de(re.filter(Ne=>Ne!==ie)):de([...re,ie])},Le=ie=>{m(Ne=>Ne.includes(ie)?Ne.filter(Ae=>Ae!==ie):[...Ne,ie])},Ue=()=>{u.length===Re.length?m([]):m(Re.map(ie=>ie.id))},ye=()=>{if(!fe)return;const ie=xb([...H,fe]);se(ie),ge("")},mt=ie=>{se(Ne=>Ne.filter(Ae=>Ae!==ie))},qe=()=>{if(ce){if($==="range")return $l(J,Z);if($==="multiple")return H}if($==="single"){if(he&&te.length>0){const ie=[],Ne=new Date(c),Ae=new Date(Ne.getFullYear(),Ne.getMonth()+1,0),Ze=te[0],Xe=new Date(Ne);for(;Xe<=Ae;)(Xe.getDay()===0?6:Xe.getDay()-1)===Ze&&ie.push(oe(Xe,"yyyy-MM-dd")),Xe.setDate(Xe.getDate()+1);return ie}if(W&&re.length>0){const ie=[],Ne=new Date(c),Ae=Ne.getDay()===0?6:Ne.getDay()-1;Ne.setDate(Ne.getDate()-Ae);for(let Ze=0;Ze<7;Ze++){const Xe=new Date(Ne);Xe.setDate(Ne.getDate()+Ze);const st=Xe.getDay()===0?6:Xe.getDay()-1;re.includes(st)&&ie.push(oe(Xe,"yyyy-MM-dd"))}return ie}return[c]}return $==="range"?$l(J,Z):H},et=()=>s?[s.userId]:ce?u:i&&!r?u.length>0?u:[]:r!=null&&r.id?[r.id]:[],Te=ie=>Tt(ie),Ve=async(ie,Ne,Ae)=>{if(Ae){const st=await Ab(Ae,!0);for(const ze of st){const Be=await Is(ze.restrictedUserId,ie);for(const Ge of Ne){for(const at of Be)if($o(Ge,at.slots[0]))return`Ваше время пересекается со слотом ${Te(ze.restrictedUserId)} (${at.slots[0].start}-${at.slots[0].end}). ${ze.reason||"Выберите другое время."}`;if(Ge.endDate){const at=await Is(ze.restrictedUserId,Ge.endDate);for(const yt of at)if($o(Ge,yt.slots[0]))return`Ваше время пересекается со слотом ${Te(ze.restrictedUserId)} (${yt.slots[0].start}-${yt.slots[0].end}). ${ze.reason||"Выберите другое время."}`}}}}const Xe=(await Is(void 0,ie)).filter(st=>st.id!==(s==null?void 0:s.id));for(const st of Ne){for(const ze of Xe)if($o(st,ze.slots[0])&&ze.participants.length>=3)return`Слот ${st.start}-${st.end} уже занят максимальным количеством участников (3)`;if(st.endDate){const Be=(await Is(void 0,st.endDate)).filter(Ge=>Ge.id!==(s==null?void 0:s.id));for(const Ge of Be)if($o(st,Ge.slots[0])&&Ge.participants.length>=3)return`Слот ${st.start}-${st.end} (до ${st.endDate}) уже занят максимальным количеством участников (3)`}}return null},wt=async()=>{if(console.log("handleSave called"),!i&&!r){console.log("No user found"),Se("Пользователь не найден");return}if(g.length===0){Se("Добавьте хотя бы один временной интервал");return}if(s&&!i&&r&&s.userId!==r.id){Se("Вы можете редактировать только свои слоты"),xe(!1);return}const ie=et();if(ie.length===0){Se("Выберите хотя бы одного участника");return}const Ne=qe();if(Ne.length===0){Se("Выберите даты");return}const Ae=new Date;Ae.setHours(0,0,0,0);const Ze=oe(Ae,"yyyy-MM-dd"),Xe=Be=>Be<Ze,st=(Be,Ge)=>{const at=new Date(Be),yt=new Date(Ge);return at.setHours(0,0,0,0),yt.setHours(0,0,0,0),Math.round((yt.getTime()-at.getTime())/(1e3*60*60*24))},ze=async(Be,Ge,at=[Be])=>{const yt=g.map(me=>{const Qe=!me.endDate&&ws(me.end)<=ws(me.start),ys=me.endDate?st(c,me.endDate):Qe?1:0;if(ys>0){const ur=new Date(Ge);return ur.setDate(ur.getDate()+ys),{...me,endDate:oe(ur,"yyyy-MM-dd")}}return{...me,...me.endDate?{endDate:me.endDate}:{}}});if(!i){const me=yt.length>0?yt[0].start:void 0,Qe=await Rl("slots",Ge,me);if(Qe.restricted)throw new Error(`[${Te(Be)} • ${oe(new Date(Ge),"dd.MM.yyyy")}] ${Qe.reason}`);for(const ys of yt)if(ys.endDate&&ys.endDate!==Ge){const ur=await Rl("slots",ys.endDate);if(ur.restricted)throw new Error(`[${Te(Be)} • ${oe(new Date(ys.endDate),"dd.MM.yyyy")}] ${ur.reason}`)}}const St=await Ve(Ge,yt,Be);if(St)throw new Error(`[${Te(Be)} • ${oe(new Date(Ge),"dd.MM.yyyy")}] ${St}`);const ne={id:(s==null?void 0:s.id)||"",userId:Be,date:Ge,slots:yt,...V&&{comment:V},participants:at};if(i)if(s){const{id:me,...Qe}=ne;await yb(s.id,Qe)}else{const{id:me,...Qe}=ne;await bb(Qe)}else await It({entity:"slot",action:s?"update":"create",authorId:(r==null?void 0:r.id)||Be,targetUserId:Be,before:s||null,after:ne,comment:V||void 0})};console.log("Starting save process..."),Se(""),xe(!0);try{if(s){await ze(s.userId,c,s.participants||[s.userId]),t();return}if(W&&re.length>0){const Be=qe();for(const Ge of Be)if(!Xe(Ge))for(const at of ie)await ze(at,Ge)}else if(he&&te.length>0){const Be=new Date(c),Ge=Be.getMonth(),at=Be.getFullYear(),yt=new Date(at,Ge+1,0).getDate();for(let St=1;St<=yt;St++){const ne=new Date(at,Ge,St),me=ne.getDay()===0?6:ne.getDay()-1;if(te.includes(me)){const Qe=oe(ne,"yyyy-MM-dd");if(Xe(Qe))continue;for(const ys of ie)await ze(ys,Qe)}}}else if(ce&&$!=="single")for(const Be of Ne)for(const Ge of ie)await ze(Ge,Be);else for(const Be of ie)await ze(Be,c);t()}catch(Be){console.error("Error saving slot:",Be);const Ge=Be.message||Be.code||"Ошибка при сохранении";Se(Ge)}finally{xe(!1)}},ct=ce?qe():[c],Cs=g.map(ie=>`${ie.start}–${ie.end}${ie.endDate?" (+1)":""}`);return n.jsx("div",{className:"fixed inset-0 bg-slate-950/75 backdrop-blur-xl flex items-start sm:items-center justify-center z-[70] p-4 sm:p-6 touch-manipulation overflow-y-auto",children:n.jsx("div",{className:`w-full max-w-5xl rounded-3xl shadow-[0_24px_80px_rgba(0,0,0,0.45)] border ${a==="dark"?"bg-gradient-to-br from-[#0c1320] via-[#0b1220] to-[#08111b] border-white/10":"bg-gradient-to-br from-white via-slate-50 to-white border-slate-200"} max-h-[90vh] overflow-y-auto`,children:n.jsxs("div",{className:"p-4 sm:p-6 lg:p-7 flex flex-col h-full min-h-0 overflow-y-auto",children:[n.jsxs("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between",children:[n.jsxs("div",{className:"space-y-1",children:[n.jsx("div",{className:"flex items-center gap-2 text-xs font-semibold text-[#4E6E49] tracking-tight",children:n.jsx("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full bg-[#4E6E49]/10 text-[#4E6E49] border border-[#4E6E49]/30",children:s?"Редактирование слота":"Создание слота"})}),n.jsx("h3",{className:`text-2xl sm:text-3xl font-bold ${o}`,children:s?"Редактировать слот":"Добавить слот"})]}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsxs("div",{className:`px-3 py-2 rounded-xl border text-xs sm:text-sm ${a==="dark"?"border-white/10 bg-white/5 text-gray-200":"border-slate-200 bg-slate-50 text-slate-700"}`,children:[s?"Редактирование":"Создание"," · ",g.length||0," интервал(ов)"]}),n.jsx("button",{onClick:e,className:`p-2.5 rounded-full border ${a==="dark"?"border-white/10 text-gray-200 hover:bg-white/5":"border-slate-200 text-slate-600 hover:bg-slate-100"} transition-colors touch-manipulation`,"aria-label":"Закрыть",children:n.jsx(Ft,{className:"w-4 h-4 sm:w-5 sm:h-5"})})]})]}),n.jsxs("div",{className:"mt-5 grid lg:grid-cols-[0.9fr_1.6fr] gap-4 lg:gap-6 flex-1 min-h-0",children:[n.jsxs("aside",{className:`rounded-2xl border ${a==="dark"?"border-white/10 bg-white/5":"border-slate-200 bg-white"} p-4 sm:p-5 space-y-4 sticky top-0 self-start max-h-full overflow-y-auto`,children:[n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsx("p",{className:"text-sm font-semibold",children:"Навигация"}),n.jsx("span",{className:"text-[11px] uppercase tracking-wide text-[#4E6E49] font-semibold",children:"4 шага"})]}),n.jsx("div",{className:"space-y-2",children:[{label:"Участники",detail:u.length>0?n.jsx("div",{className:"flex flex-wrap gap-x-1",children:u.map((ie,Ne)=>n.jsxs("span",{children:[n.jsx(xn,{userId:ie}),Ne<u.length-1?",":""]},ie))}):"Не выбрано",done:u.length>0||!!s},{label:"Даты",detail:ct.slice(0,2).map(ie=>oe(ie,"dd.MM")).join(", ")||"Выберите дату",done:ct.length>0},{label:"Время",detail:Cs.slice(0,2).join(" · ")||"Добавьте интервал",done:g.length>0},{label:"Комментарий",detail:V?"Заполнен":"Необязателен",done:!!V}].map((ie,Ne)=>n.jsxs("div",{className:`flex items-start gap-3 rounded-xl border px-3 py-3 ${a==="dark"?"border-white/10 bg-white/5":"border-slate-200 bg-slate-50"}`,children:[n.jsx("span",{className:`mt-0.5 inline-flex h-6 w-6 items-center justify-center rounded-full text-xs font-bold ${ie.done?"bg-[#4E6E49] text-white":a==="dark"?"bg-slate-800 text-gray-300":"bg-slate-200 text-slate-700"}`,children:Ne+1}),n.jsxs("div",{className:"flex-1 min-w-0",children:[n.jsx("p",{className:"text-sm font-semibold",children:ie.label}),n.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400 truncate",children:ie.detail})]})]},ie.label))})]}),n.jsxs("div",{className:"space-y-4 overflow-y-auto overscroll-contain pr-1 pb-6 flex-1 min-h-0",children:[ce&&n.jsxs("div",{children:[n.jsx("label",{className:`block text-xs sm:text-sm font-medium mb-2 ${a==="dark"?"text-gray-300":"text-gray-700"}`,children:"Участники"}),n.jsxs("div",{className:"space-y-3",children:[n.jsx("div",{className:"flex flex-wrap gap-2",children:Re.map(ie=>n.jsxs("label",{className:`px-3 py-1.5 rounded-full border cursor-pointer text-sm flex items-center gap-2 ${u.includes(ie.id)?"bg-[#4E6E49] border-[#4E6E49] text-white":a==="dark"?"bg-gray-700 border-gray-800 text-gray-200":"bg-gray-100 border-gray-300 text-gray-700"}`,children:[n.jsx("input",{type:"checkbox",checked:u.includes(ie.id),onChange:()=>Le(ie.id),className:"hidden"}),n.jsx(xn,{userId:ie.id})]},ie.id))}),n.jsx("button",{type:"button",onClick:Ue,className:"text-sm text-[#4E6E49] hover:text-[#4E6E49]",children:u.length===Re.length?"Снять выделение":"Выбрать всех"})]})]}),ce&&n.jsxs("div",{children:[n.jsx("p",{className:`text-xs sm:text-sm font-medium mb-2 ${a==="dark"?"text-gray-300":"text-gray-700"}`,children:"Формат выбора дат"}),n.jsx("div",{className:"flex flex-wrap gap-4",children:[{value:"single",label:"Один день"},{value:"range",label:"Диапазон дат"},{value:"multiple",label:"Конкретные даты"}].map(ie=>n.jsxs("label",{className:"flex items-center gap-2 text-sm cursor-pointer",children:[n.jsx("input",{type:"radio",value:ie.value,checked:$===ie.value,onChange:Ne=>O(Ne.target.value)}),n.jsx("span",{className:a==="dark"?"text-gray-200":"text-gray-700",children:ie.label})]},ie.value))})]}),(!ce||$==="single")&&n.jsxs("div",{children:[n.jsx("label",{className:`block text-xs sm:text-sm font-medium mb-2 ${a==="dark"?"text-gray-300":"text-gray-700"}`,children:"Дата"}),n.jsx("input",{type:"date",value:c,onChange:ie=>h(ie.target.value),className:`w-full px-3 sm:px-4 py-2 sm:py-2.5 text-sm sm:text-base rounded-lg border touch-manipulation ${a==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`})]}),ce&&$==="range"&&n.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[n.jsxs("div",{children:[n.jsx("label",{className:`block text-xs sm:text-sm font-medium mb-2 ${a==="dark"?"text-gray-300":"text-gray-700"}`,children:"Начало диапазона"}),n.jsx("input",{type:"date",value:J,onChange:ie=>Y(ie.target.value),className:`w-full px-3 sm:px-4 py-2 sm:py-2.5 text-sm sm:text-base rounded-lg border touch-manipulation ${a==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`})]}),n.jsxs("div",{children:[n.jsx("label",{className:`block text-xs sm:text-sm font-medium mb-2 ${a==="dark"?"text-gray-300":"text-gray-700"}`,children:"Конец диапазона"}),n.jsx("input",{type:"date",value:Z,min:J,onChange:ie=>L(ie.target.value),className:`w-full px-3 sm:px-4 py-2 sm:py-2.5 text-sm sm:text-base rounded-lg border touch-manipulation ${a==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`})]})]}),ce&&$==="multiple"&&n.jsxs("div",{children:[n.jsx("label",{className:`block text-xs sm:text-sm font-medium mb-2 ${a==="dark"?"text-gray-300":"text-gray-700"}`,children:"Выбранные даты"}),n.jsxs("div",{className:"flex flex-col gap-3",children:[n.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[n.jsx("input",{type:"date",value:fe,onChange:ie=>ge(ie.target.value),className:`flex-1 px-3 sm:px-4 py-2 sm:py-2.5 text-sm sm:text-base rounded-lg border touch-manipulation ${a==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`}),n.jsx("button",{type:"button",onClick:ye,className:"px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg transition-colors",children:"Добавить"})]}),H.length>0?n.jsx("div",{className:"flex flex-wrap gap-2",children:H.map(ie=>n.jsxs("span",{className:"inline-flex items-center gap-2 px-3 py-1.5 rounded-full bg-gray-100 text-gray-800 text-sm",children:[oe(ie,"dd.MM.yyyy"),n.jsx("button",{type:"button",onClick:()=>mt(ie),className:"text-red-500 hover:text-red-600",children:"x"})]},ie))}):n.jsx("p",{className:"text-sm text-gray-500",children:"Пока не выбрано ни одной даты"})]})]}),n.jsxs("div",{children:[n.jsx("label",{className:`block text-xs sm:text-sm font-medium mb-2 ${a==="dark"?"text-gray-300":"text-gray-700"}`,children:"Временные слоты"}),n.jsxs("div",{className:"space-y-2 mb-2",children:[n.jsx("div",{className:"flex flex-col sm:flex-row gap-2",children:n.jsxs("div",{className:"flex gap-2 flex-1",children:[n.jsx("input",{type:"time",value:j,onChange:ie=>_(ie.target.value),className:`flex-1 px-3 sm:px-4 py-2 sm:py-2.5 text-sm sm:text-base rounded-lg border touch-manipulation ${a==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`,placeholder:"Начало"}),n.jsx("span",{className:"mx-1 sm:mx-2 text-gray-500 text-sm sm:text-base flex items-center",children:"—"}),n.jsx("input",{type:"time",value:y,onChange:ie=>M(ie.target.value),className:`flex-1 px-3 sm:px-4 py-2 sm:py-2.5 text-sm sm:text-base rounded-lg border touch-manipulation ${a==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`,placeholder:"Окончание"})]})}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("input",{type:"checkbox",id:"crossMidnight",checked:D,onChange:ie=>{T(ie.target.checked)},className:`w-4 h-4 rounded border-2 ${a==="dark"?"border-gray-800 bg-gray-700 checked:bg-[#4E6E49] checked:border-[#4E6E49]":"border-gray-300 bg-white checked:bg-[#4E6E49] checked:border-[#4E6E49]"} focus:ring-2 focus:ring-[#4E6E49] cursor-pointer touch-manipulation`}),n.jsx("label",{htmlFor:"crossMidnight",className:`text-xs sm:text-sm font-medium cursor-pointer ${a==="dark"?"text-gray-300":"text-gray-700"}`,children:"Переходит через полночь (на следующий день)"})]}),n.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[n.jsx("button",{onClick:ke,className:"w-full px-4 py-2 bg-[#4E6E49] hover:bg-[#4E6E49] text-white rounded-lg transition-colors flex items-center justify-center gap-2",children:b!==null?n.jsxs(n.Fragment,{children:[n.jsx(ps,{className:"w-4 h-4"}),"Сохранить слот"]}):n.jsxs(n.Fragment,{children:[n.jsx(Cr,{className:"w-4 h-4"}),"Добавить слот"]})}),b!==null&&n.jsx("button",{onClick:$e,className:`w-full sm:w-auto px-4 py-2 rounded-lg border ${a==="dark"?"border-gray-700 text-gray-200 hover:bg-gray-700":"border-gray-300 text-gray-800 hover:bg-gray-100"}`,children:"Отмена"})]})]}),n.jsx("div",{className:"space-y-3",children:g.map((ie,Ne)=>n.jsxs("div",{className:`flex flex-col gap-2 p-3 rounded-lg ${a==="dark"?"bg-gray-700":"bg-gray-100"}`,children:[n.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-2",children:[n.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[n.jsxs("span",{className:o,children:[ie.start," - ",ie.end]}),ie.endDate&&n.jsxs("span",{className:`text-xs px-2 py-0.5 rounded-full ${a==="dark"?"bg-blue-500/20 text-blue-400 border border-blue-500/30":"bg-blue-100 text-blue-700 border border-blue-300"}`,children:["до ",oe(new Date(ie.endDate),"dd.MM.yyyy")]})]}),n.jsxs("div",{className:"flex items-center gap-1",children:[n.jsx("button",{onClick:()=>ue(Ne),className:"p-1 text-blue-500 hover:bg-blue-500 hover:text-white rounded transition-colors flex-shrink-0",title:"Редактировать слот",children:n.jsx(ps,{className:"w-4 h-4"})}),n.jsx("button",{onClick:()=>K(Ne),className:"p-1 text-red-500 hover:bg-red-500 hover:text-white rounded transition-colors flex-shrink-0",title:"Удалить слот",children:n.jsx(Bt,{className:"w-4 h-4"})})]})]}),ie.breaks&&ie.breaks.length>0&&n.jsxs("div",{className:"ml-4 space-y-1",children:[n.jsx("span",{className:`text-xs ${a==="dark"?"text-gray-400":"text-gray-600"}`,children:"Перерывы:"}),ie.breaks.map((Ae,Ze)=>k===Ne&&Q===Ze?null:n.jsxs("div",{className:"flex items-center justify-between gap-2",children:[n.jsxs("span",{className:`text-sm ${a==="dark"?"text-gray-300":"text-gray-700"}`,children:[Ae.start," - ",Ae.end]}),n.jsxs("div",{className:"flex gap-1",children:[n.jsx("button",{onClick:()=>U(Ne,Ze),className:"p-1 text-blue-400 hover:bg-blue-400 hover:text-white rounded transition-colors",title:"Редактировать перерыв",children:n.jsx(ps,{className:"w-3 h-3"})}),n.jsx("button",{onClick:()=>Pe(Ne,Ze),className:"p-1 text-red-400 hover:bg-red-400 hover:text-white rounded transition-colors",title:"Удалить перерыв",children:n.jsx(Ft,{className:"w-3 h-3"})})]})]},Ze))]}),n.jsx("div",{className:"ml-4 space-y-2 border-t pt-2 border-gray-500 border-opacity-30",children:S===Ne?n.jsxs("div",{className:"space-y-2",children:[n.jsxs("div",{className:"flex gap-2",children:[n.jsx("input",{type:"time",value:R,onChange:Ae=>P(Ae.target.value),className:`flex-1 px-3 py-1.5 text-sm rounded-lg border ${a==="dark"?"bg-gray-600 border-gray-500 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`,placeholder:"Начало"}),n.jsx("input",{type:"time",value:C,onChange:Ae=>N(Ae.target.value),className:`flex-1 px-3 py-1.5 text-sm rounded-lg border ${a==="dark"?"bg-gray-600 border-gray-500 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`,placeholder:"Конец"})]}),n.jsxs("div",{className:"flex gap-2",children:[n.jsx("button",{onClick:()=>Oe(Ne),className:"flex-1 px-3 py-1.5 text-sm bg-[#4E6E49] hover:bg-[#4E6E49] text-white rounded-lg transition-colors",children:k===Ne&&Q!==null?"Сохранить":"Добавить перерыв"}),n.jsx("button",{onClick:_e,className:"px-3 py-1.5 text-sm bg-gray-500 hover:bg-gray-600 text-white rounded-lg transition-colors",children:"Отмена"})]})]}):n.jsxs("button",{onClick:()=>{E(Ne),P(""),N(""),w(null),ae(null),Se("")},className:"w-full px-3 py-1.5 text-sm bg-blue-500 hover:bg-blue-600 text-white rounded-lg transition-colors flex items-center justify-center gap-1",children:[n.jsx(Cr,{className:"w-3 h-3"}),"Добавить перерыв"]})})]},Ne))}),g.length>0&&n.jsxs("p",{className:`text-sm mt-2 ${a==="dark"?"text-gray-400":"text-gray-600"}`,children:["Всего часов: ",xc(g).toFixed(1)]})]}),(!ce||$==="single")&&n.jsxs("div",{children:[n.jsx("p",{className:`text-xs sm:text-sm font-medium mb-3 ${a==="dark"?"text-gray-300":"text-gray-700"}`,children:"Повторы"}),n.jsxs("div",{className:"grid sm:grid-cols-2 gap-3",children:[n.jsxs("button",{type:"button",onClick:()=>{F(!W),Se("")},className:`text-left rounded-xl border px-4 py-4 transition-all shadow-sm flex items-start gap-3 h-full ${W?"bg-blue-100 text-blue-800 border-blue-200 dark:bg-blue-900/30 dark:text-blue-100 dark:border-blue-800 ring-2 ring-blue-500/50 shadow-lg":a==="dark"?"border-white/10 bg-white/5 text-gray-200 hover:border-white/30":"border-slate-200 bg-white text-gray-800 hover:border-slate-300"}`,children:[n.jsx(Pv,{className:"w-5 h-5 flex-shrink-0 mt-0.5"}),n.jsxs("div",{className:"flex-1 min-w-0",children:[n.jsx("p",{className:"font-semibold text-sm",children:"Повтор на неделю"}),n.jsx("p",{className:"text-xs mt-1 opacity-80",children:"Актуальная неделя по дням"}),W&&n.jsx("div",{className:"mt-3 flex flex-wrap gap-2",children:z.map((ie,Ne)=>n.jsx("button",{type:"button",onClick:Ae=>{Ae.stopPropagation(),Ce(Ne)},className:`px-2 py-1 rounded-lg text-xs transition-colors ${re.includes(Ne)?"bg-blue-600 text-white":a==="dark"?"bg-gray-700 text-gray-300":"bg-gray-200 text-gray-700"}`,children:ie},Ne))})]})]}),n.jsxs("button",{type:"button",onClick:()=>{B(!he),Se("")},className:`text-left rounded-xl border px-4 py-4 transition-all shadow-sm flex items-start gap-3 h-full ${he?"bg-purple-100 text-purple-800 border-purple-200 dark:bg-purple-900/30 dark:text-purple-100 dark:border-purple-800 ring-2 ring-purple-500/50 shadow-lg":a==="dark"?"border-white/10 bg-white/5 text-gray-200 hover:border-white/30":"border-slate-200 bg-white text-gray-800 hover:border-slate-300"}`,children:[n.jsx(Fr,{className:"w-5 h-5 flex-shrink-0 mt-0.5"}),n.jsxs("div",{className:"flex-1 min-w-0",children:[n.jsx("p",{className:"font-semibold text-sm",children:"Повтор по месяцу"}),n.jsx("p",{className:"text-xs mt-1 opacity-80",children:"На месяц вперед по дням"}),he&&n.jsx("div",{className:"mt-3 flex flex-wrap gap-2",children:z.map((ie,Ne)=>n.jsx("button",{type:"button",onClick:Ae=>{Ae.stopPropagation(),q(Ne)},className:`px-2 py-1 rounded-lg text-xs transition-colors ${te.includes(Ne)?"bg-purple-600 text-white":a==="dark"?"bg-gray-700 text-gray-300":"bg-gray-200 text-gray-700"}`,children:ie},Ne))})]})]})]})]}),n.jsxs("div",{children:[n.jsx("label",{className:`block text-xs sm:text-sm font-medium mb-2 ${a==="dark"?"text-gray-300":"text-gray-700"}`,children:"Комментарий"}),n.jsx("textarea",{value:V,onChange:ie=>X(ie.target.value),rows:3,className:`w-full px-3 sm:px-4 py-2 sm:py-2.5 text-sm sm:text-base rounded-lg border touch-manipulation resize-y ${a==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`,placeholder:"Добавьте комментарий (необязательно)"})]}),je&&n.jsx("div",{className:"p-3 bg-red-500 text-white rounded-lg text-sm",children:je}),n.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 sm:gap-3 pt-2",children:[n.jsx("button",{onClick:ie=>{console.log("Save button clicked!",{loading:G,slotsCount:g.length,disabled:G||g.length===0}),ie.preventDefault(),wt()},disabled:G||g.length===0,className:"flex-1 px-4 py-2.5 sm:py-2 bg-[#4E6E49] hover:bg-[#4E6E49] disabled:bg-gray-400 disabled:cursor-not-allowed text-white rounded-lg sm:rounded-xl transition-colors text-sm sm:text-base font-medium touch-manipulation active:scale-95 disabled:active:scale-100",children:G?"Ошибка добавления слота":"Отправить на согласование"}),n.jsx("button",{onClick:e,className:`px-4 py-2.5 sm:py-2 rounded-lg sm:rounded-xl transition-colors text-sm sm:text-base font-medium touch-manipulation active:scale-95 ${a==="dark"?"bg-gray-700 hover:bg-gray-600 active:bg-gray-500":"bg-gray-200 hover:bg-gray-300 active:bg-gray-400"}`,children:"Отмена"})]})]})]})]})})})},kS=({type:s,status:e,onClose:t,onSave:r})=>{const{user:a}=_t(),{theme:i}=lt(),{isAdmin:o}=Ct(),l=i==="dark"?"text-white":"text-gray-900",c=(e==null?void 0:e.date)||oe(new Date,"yyyy-MM-dd"),[h,u]=I.useState(e!=null&&e.userId?[e.userId]:a!=null&&a.id?[a.id]:[]),[m,g]=I.useState(c),[p,j]=I.useState((e==null?void 0:e.endDate)||c),[_,y]=I.useState(!!(e!=null&&e.endDate)),[M,D]=I.useState((e==null?void 0:e.comment)||""),[T,R]=I.useState(s||(e==null?void 0:e.type)||null),[P,C]=I.useState(""),[N,b]=I.useState(!1),[v,S]=I.useState("single"),[E,k]=I.useState(c),[w,Q]=I.useState(c),[ae,V]=I.useState(c),[X,he]=I.useState([]),[B,te]=I.useState(!1),[ve,W]=I.useState([]),[F,re]=I.useState(!1),[de,$]=I.useState([]),O=o&&!e,J=["Пн","Вт","Ср","Чт","Пт","Сб","Вс"];Ur(),I.useEffect(()=>{_||j(m)},[_,m]),I.useEffect(()=>{O&&v!=="single"&&y(!1)},[O,v]),I.useEffect(()=>{B||W([])},[B]),I.useEffect(()=>{if(F&&m){const U=new Date(m),_e=U.getDay()===0?6:U.getDay()-1;$([_e])}},[F,m]),I.useEffect(()=>{v!=="single"&&(te(!1),W([]),re(!1),$([]))},[v]);const Y=U=>{u(_e=>_e.includes(U)?_e.filter(Pe=>Pe!==U):[..._e,U])},Z=()=>{h.length===Re.length?u([]):u(Re.map(U=>U.id))},L=()=>{if(!ae)return;const U=xb([...X,ae]);he(U),V("")},fe=U=>{he(_e=>_e.filter(Pe=>Pe!==U))},ge=()=>e?[e.userId]:O?h:o&&!a?h.length>0?h:[]:a!=null&&a.id?[a.id]:[],H=U=>Tt(U),se=U=>{if(O){if(v==="range")return E&&w?U==="dayoff"?$l(E,w).map(Pe=>({date:Pe})):[{date:E,endDate:w}]:[];if(v==="multiple")return U==="dayoff"?X.map(Pe=>({date:Pe})):X.map(Pe=>({date:Pe,endDate:Pe}))}if(v==="single"&&U==="dayoff"){if(F&&de.length>0){const Pe=[],K=new Date(m),q=new Date(K.getFullYear(),K.getMonth()+1,0),Ce=de[0],Le=new Date(K);for(;Le<=q;)(Le.getDay()===0?6:Le.getDay()-1)===Ce&&Pe.push(oe(Le,"yyyy-MM-dd")),Le.setDate(Le.getDate()+1);return Pe.map(Ue=>({date:Ue}))}if(B&&ve.length>0){const Pe=[],K=new Date(m),q=K.getDay()===0?6:K.getDay()-1;K.setDate(K.getDate()-q);for(let Ce=0;Ce<7;Ce++){const Le=new Date(K);Le.setDate(K.getDate()+Ce);const Ue=Le.getDay()===0?6:Le.getDay()-1;ve.includes(Ue)&&Pe.push(oe(Le,"yyyy-MM-dd"))}return Pe.map(Ce=>({date:Ce}))}}if(U==="dayoff"){if(v==="range")return $l(E,w).map(Pe=>({date:Pe}));if(v==="multiple")return X.map(Pe=>({date:Pe}))}if(v==="range"&&E&&w)return[{date:E,endDate:w}];if(v==="multiple")return X.map(Pe=>({date:Pe,endDate:Pe}));const _e={date:m};return U!=="dayoff"&&(_||e!=null&&e.endDate)&&(_e.endDate=p),[_e]},je=async(U,_e,Pe,K)=>{if(o)return null;if(!a)return"Пользователь не найден";const q=new Date,Ce=new Date(_e),Le=new Date(Pe||_e);if(K==="dayoff"&&pb(Ce,q))return"Нельзя установить выходной на сегодня. Выберите смену или возьмите больничный.";if(K==="sick"){const Ue=new Date;Ue.setHours(0,0,0,0);const ye=new Date(Ue);ye.setDate(ye.getDate()+2);const mt=new Date(_e);if(mt.setHours(0,0,0,0),mt<Ue||mt>ye)return"Больничный можно взять только на актуальную дату и + 2 суток. Нельзя выбрать заранее.";const qe=Math.ceil((Le.getTime()-Ce.getTime())/(1e3*60*60*24))+1;if(qe<1)return"Больничный должен быть минимум на 1 день";if(qe>14)return"Больничный может длиться не более 14 календарных дней в месяце";const et=new Date(Ce.getFullYear(),Ce.getMonth(),1),Te=new Date(Ce.getFullYear(),Ce.getMonth()+1,0);if((await Ar(U)).filter(ct=>ct.type==="sick"&&ct.date>=oe(et,"yyyy-MM-dd")&&ct.date<=oe(Te,"yyyy-MM-dd")).length+qe>14)return"Больничный ограничен 14 днями в месяц"}if(K==="vacation"){if(Math.ceil((Le.getTime()-Ce.getTime())/864e5)+1>14)return"Отпуск не может быть больше 14 дней в месяце";const ye=new Date(Ce.getFullYear(),0,1),mt=new Date(Ce.getFullYear(),11,31);if((await Ar(U)).filter(Te=>Te.type==="vacation"&&Te.date>=oe(ye,"yyyy-MM-dd")&&Te.date<=oe(mt,"yyyy-MM-dd")).length>=6)return"Не более 6 отпусков в год"}if(K==="dayoff"){const Ue=new Date(Ce);Ue.setDate(Ue.getDate()-Ue.getDay()+1);const ye=new Date(Ue);ye.setDate(Ue.getDate()+6);let qe=(await Ar(U)).filter(et=>et.type==="dayoff"&&et.date>=oe(Ue,"yyyy-MM-dd")&&et.date<=oe(ye,"yyyy-MM-dd"));if(e&&(qe=qe.filter(et=>et.id!==e.id)),qe.length>=4)return"Выходные на неделе ограничены максимум 4 днями"}return null},Se=async()=>{if(console.log("handleSave called (DayStatusForm)"),!o&&!a){console.log("No user found"),C("Пользователь не найден");return}if(!T){C("Выберите тип отсутствия");return}if(e&&!o&&a&&e.userId!==a.id){C("Вы можете редактировать только свои статусы"),b(!1);return}const U=ge();if(U.length===0){C("Выберите хотя бы одного участника");return}if(O&&v==="range"){if(!E||!w){C("Укажите даты начала и окончания");return}if(new Date(w)<new Date(E)){C("Дата окончания не может быть раньше даты начала");return}}const _e=se(T);if(_e.length===0){C("Выберите даты");return}const Pe=async(K,q)=>{if(!o){const Le=await Rl(T,q.date);if(Le.restricted)throw new Error(`[${H(K)} • ${oe(new Date(q.date),"dd.MM.yyyy")}] ${Le.reason}`);const Ue=await je(K,q.date,q.endDate,T);if(Ue)throw new Error(`[${H(K)} • ${oe(q.date,"dd.MM.yyyy")}] ${Ue}`)}const Ce={id:(e==null?void 0:e.id)||"",userId:K,date:q.date,type:T,...q.endDate&&{endDate:q.endDate},...M&&{comment:M}};if(o){const{id:Le,...Ue}=Ce;e?await hn(e.id,Ue):await yc(Ue)}else await It({entity:"status",action:e?"update":"create",authorId:(a==null?void 0:a.id)||K,targetUserId:K,before:e||null,after:Ce,comment:M||void 0})};console.log("Starting save process..."),C(""),b(!0);try{if(e){const K={date:m};T!=="dayoff"&&(_||e.endDate)&&(K.endDate=p),await Pe(e.userId,K),r();return}for(const K of U)for(const q of _e)await Pe(K,q);r()}catch(K){console.error("Error saving day status:",K);const q=K.message||K.code||"Ошибка при сохранении";C(q)}finally{b(!1)}},G={dayoff:"bg-yellow-500",sick:"bg-purple-500",vacation:"bg-orange-500",absence:"bg-red-500"},xe=O&&v==="range"?[`${oe(E,"dd.MM")}–${oe(w,"dd.MM")}`]:O&&v==="multiple"?X.map(U=>oe(U,"dd.MM")):[oe(m,"dd.MM")],z=h.map(U=>H(U)).join(", "),ce=[{label:"Тип",detail:T?T==="dayoff"?"Выходной":T==="sick"?"Больничный":T==="vacation"?"Отпуск":"Прогул":"Не выбран",done:!!T,anchor:"#type"},{label:"Members",detail:z||"Не выбрано",done:h.length>0||!!e,anchor:"#members"},{label:"Даты",detail:xe.slice(0,2).join(" · "),done:xe.length>0,anchor:"#dates"},{label:"Комментарий",detail:M?"Заполнен":"Необязателен",done:!!M,anchor:"#notes"}],ke=Math.round(ce.filter(U=>U.done).length/ce.length*100),ue=[{value:"single",label:"Один день",hint:"Быстрая отметка",icon:"•"},{value:"range",label:T==="dayoff"?"Диапазон (каждый день)":"Диапазон дат",hint:"Поток дней",icon:"⎯⎯"},{value:"multiple",label:"Конкретные даты",hint:"Точечный выбор",icon:"◎"}],Oe=T?`${e?"Редактировать":"Добавить"} ${{dayoff:"выходной",sick:"больничный",vacation:"отпуск",absence:"прогул"}[T]}`:"Добавить отсутствие";return n.jsx("div",{className:"fixed inset-0 bg-slate-950/80 backdrop-blur-xl flex items-start sm:items-center justify-center z-[70] p-4 sm:p-6 touch-manipulation overflow-y-auto overscroll-contain modal-scroll",children:n.jsx("div",{className:`w-full max-w-[52rem] rounded-3xl shadow-[0_28px_80px_rgba(0,0,0,0.55)] border ${i==="dark"?"bg-[#0b1222] border-white/10":"bg-white border-slate-200"} max-h-[85dvh] sm:max-h-[calc(100dvh-96px)] overflow-y-auto relative`,children:n.jsxs("div",{className:"relative p-4 sm:p-6 lg:p-7 flex flex-col h-full min-h-0 overflow-y-auto modal-scroll",children:[n.jsxs("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-start sm:justify-between",children:[n.jsxs("div",{className:"space-y-2",children:[n.jsx("h3",{className:`text-2xl sm:text-3xl font-bold ${l}`,children:Oe}),n.jsx("div",{className:"flex flex-wrap gap-2",children:ce.map((U,_e)=>n.jsxs("a",{href:U.anchor,className:`inline-flex items-center gap-2 px-3 py-1.5 rounded-full border text-xs transition ${U.done?"bg-[#4E6E49] border-[#4E6E49] text-white shadow-sm":i==="dark"?"border-white/15 bg-white/5 text-gray-200 hover:border-white/30":"border-slate-200 bg-white text-gray-700 hover:border-slate-300"}`,children:[n.jsx("span",{className:"font-semibold",children:_e+1}),n.jsx("span",{className:"whitespace-nowrap",children:U.label})]},U.label))}),s==="dayoff"&&n.jsx("div",{className:"flex flex-wrap gap-2 text-xs sm:text-sm",children:["Один выходной","Диапазон дней","Несколько дат"].map(U=>n.jsx("span",{className:`px-3 py-1.5 rounded-full border ${i==="dark"?"border-white/10 text-gray-200 bg-white/5":"border-slate-200 text-gray-700 bg-slate-50"}`,children:U},U))})]}),n.jsx("button",{onClick:t,className:`p-2.5 rounded-full border shadow-sm transition hover:-translate-y-0.5 active:translate-y-0 ${i==="dark"?"border-white/10 text-gray-200 hover:bg-white/5":"border-slate-200 text-slate-600 hover:bg-slate-100"}`,children:n.jsx(Ft,{className:"w-5 h-5"})})]}),n.jsx("div",{className:`mt-5 rounded-2xl border ${i==="dark"?"border-white/10 bg-white/5":"border-slate-200 bg-white"} p-4 sm:p-5 shadow-inner`,children:n.jsxs("div",{className:"grid md:grid-cols-3 gap-3 md:gap-4",children:[n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx("div",{className:"h-10 w-10 rounded-2xl bg-gradient-to-br from-emerald-500/20 to-emerald-400/10 flex items-center justify-center text-emerald-600 dark:text-emerald-300 text-lg font-semibold border border-emerald-500/30",children:"👥"}),n.jsxs("div",{children:[n.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Members"}),n.jsx("p",{className:"text-sm font-semibold text-gray-900 dark:text-gray-100 line-clamp-2",children:z||"Не выбрано"})]})]}),n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx("div",{className:"h-10 w-10 rounded-2xl bg-gradient-to-br from-blue-500/20 to-indigo-500/10 flex items-center justify-center text-blue-600 dark:text-blue-300 text-lg font-semibold border border-blue-500/30",children:"📅"}),n.jsxs("div",{children:[n.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Даты"}),n.jsx("p",{className:"text-sm font-semibold text-gray-900 dark:text-gray-100 line-clamp-2",children:xe.length>0?xe.join(" · "):"Не выбрано"})]})]}),n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx("div",{className:"h-10 w-10 rounded-2xl bg-gradient-to-br from-amber-500/20 to-orange-500/10 flex items-center justify-center text-amber-600 dark:text-amber-300 text-lg font-semibold border border-amber-500/30",children:"✏️"}),n.jsxs("div",{children:[n.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Комментарий"}),n.jsx("p",{className:"text-sm font-semibold text-gray-900 dark:text-gray-100 line-clamp-2",children:M||"Необязателен"})]})]})]})}),n.jsxs("div",{className:"mt-5 grid lg:grid-cols-[0.9fr_1.4fr] gap-4 lg:gap-6 flex-1 overflow-hidden",children:[n.jsxs("aside",{className:`rounded-2xl border ${i==="dark"?"border-white/10 bg-white/5":"border-slate-200 bg-white"} p-4 sm:p-5 space-y-4 sticky top-2 self-start max-h-full overflow-y-auto`,children:[n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsx("p",{className:"text-sm font-semibold",children:"Навигация"}),n.jsxs("span",{className:"text-[11px] uppercase tracking-wide text-[#4E6E49] font-semibold",children:[ce.length," шага"]})]}),n.jsx("div",{className:"h-1.5 rounded-full bg-slate-200 dark:bg-white/10 overflow-hidden",children:n.jsx("div",{className:"h-full rounded-full bg-gradient-to-r from-[#4E6E49] via-emerald-500 to-lime-400 transition-all",style:{width:`${ke}%`}})}),n.jsx("div",{className:"space-y-2",children:ce.map((U,_e)=>n.jsxs("a",{href:U.anchor,className:`flex items-start gap-3 rounded-xl border px-3 py-3 transition ${i==="dark"?"border-white/10 bg-white/5 hover:border-white/30":"border-slate-200 bg-slate-50 hover:border-slate-300"}`,children:[n.jsx("span",{className:`mt-0.5 inline-flex h-7 w-7 items-center justify-center rounded-full text-xs font-bold ${U.done?"bg-[#4E6E49] text-white shadow-sm":i==="dark"?"bg-slate-800 text-gray-300":"bg-slate-200 text-slate-700"}`,children:_e+1}),n.jsxs("div",{className:"flex-1 min-w-0",children:[n.jsx("p",{className:"text-sm font-semibold",children:U.label}),n.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 truncate",children:U.detail||"—"})]}),n.jsx("span",{className:"text-[11px] text-gray-400",children:U.done?"✓":""})]},U.label))})]}),n.jsxs("div",{className:"space-y-5 overflow-y-auto overscroll-contain pr-1 pb-6 flex-1 min-h-0",children:[!e&&!s&&n.jsxs("div",{id:"type",className:"scroll-mt-20 space-y-2",children:[n.jsx("p",{className:`text-xs sm:text-sm font-medium ${i==="dark"?"text-gray-300":"text-gray-700"}`,children:"Тип отсутствия"}),n.jsx("div",{className:"grid sm:grid-cols-3 gap-2",children:[{key:"dayoff",label:"Выходной",icon:"🌙"},{key:"sick",label:"Больничный",icon:"🏥"},{key:"vacation",label:"Отпуск",icon:"✈️"},...o?[{key:"absence",label:"Прогул",icon:"🚫"}]:[]].map(U=>n.jsxs("button",{type:"button",onClick:()=>R(U.key),className:`px-4 py-3 rounded-xl border text-sm font-semibold transition ${T===U.key?"border-[#4E6E49] bg-[#4E6E49]/10 text-[#4E6E49] shadow-sm":i==="dark"?"border-white/10 bg-white/5 text-gray-200 hover:border-white/30":"border-slate-200 bg-white text-gray-800 hover:border-slate-300"}`,children:[n.jsx("span",{className:"text-lg",children:U.icon}),n.jsx("span",{className:"block mt-1",children:U.label})]},U.key))})]}),O&&n.jsxs("div",{id:"members",className:"scroll-mt-20",children:[n.jsx("label",{className:`block text-xs sm:text-sm font-medium mb-2 ${i==="dark"?"text-gray-300":"text-gray-700"}`,children:"Members"}),n.jsxs("div",{className:"space-y-3 rounded-2xl border border-dashed border-[#4E6E49]/30 p-3 sm:p-4 bg-[#4E6E49]/5 dark:bg-[#4E6E49]/10",children:[n.jsx("div",{className:"flex flex-wrap gap-2",children:Re.map(U=>{const _e=h.includes(U.id);return n.jsxs("label",{className:`px-3 py-1.5 rounded-full border cursor-pointer text-sm flex items-center gap-2 transition ${_e?"bg-[#4E6E49] border-[#4E6E49] text-white shadow-sm":i==="dark"?"bg-gray-800/60 border-gray-800 text-gray-200 hover:border-gray-600":"bg-gray-100 border-gray-300 text-gray-700 hover:border-gray-400"}`,children:[n.jsx("input",{type:"checkbox",checked:_e,onChange:()=>Y(U.id),className:"hidden"}),Tt(U.id)]},U.id)})}),n.jsxs("div",{className:"flex items-center justify-between text-sm",children:[n.jsx("span",{className:`${i==="dark"?"text-gray-300":"text-gray-700"}`,children:"Быстрый выбор"}),n.jsx("button",{type:"button",onClick:Z,className:"text-sm text-[#4E6E49] hover:text-[#4E6E49] font-semibold",children:h.length===Re.length?"Снять выделение":"Выбрать всех"})]})]})]}),O&&n.jsxs("div",{id:"dates",className:"scroll-mt-20",children:[n.jsx("p",{className:`text-xs sm:text-sm font-medium mb-2 ${i==="dark"?"text-gray-300":"text-gray-700"}`,children:"Формат выбора дат"}),n.jsx("div",{className:"grid sm:grid-cols-3 gap-2",children:ue.map(U=>{const _e=v===U.value;return n.jsxs("button",{type:"button",onClick:()=>S(U.value),className:`w-full text-left px-3 py-3 rounded-xl border transition flex flex-col gap-1 ${_e?"border-[#4E6E49] bg-[#4E6E49]/10 text-[#4E6E49] shadow-sm":i==="dark"?"border-white/10 bg-white/5 text-gray-200 hover:border-white/30":"border-slate-200 bg-white text-gray-800 hover:border-slate-300"}`,children:[n.jsx("span",{className:"text-lg leading-none",children:U.icon}),n.jsx("span",{className:"text-sm font-semibold",children:U.label}),n.jsx("span",{className:"text-[11px] text-gray-500 dark:text-gray-400",children:U.hint})]},U.value)})})]}),!O&&s==="dayoff"&&n.jsxs("div",{id:"dates",className:"scroll-mt-20",children:[n.jsx("p",{className:`text-xs sm:text-sm font-medium mb-2 ${i==="dark"?"text-gray-300":"text-gray-700"}`,children:"Формат выбора дат"}),n.jsx("div",{className:"grid sm:grid-cols-3 gap-2",children:ue.map(U=>{const _e=v===U.value;return n.jsxs("button",{type:"button",onClick:()=>S(U.value),className:`w-full text-left px-3 py-3 rounded-xl border transition flex flex-col gap-1 ${_e?"border-[#4E6E49] bg-[#4E6E49]/10 text-[#4E6E49] shadow-sm":i==="dark"?"border-white/10 bg-white/5 text-gray-200 hover:border-white/30":"border-slate-200 bg-white text-gray-800 hover:border-slate-300"}`,children:[n.jsx("span",{className:"text-lg leading-none",children:U.icon}),n.jsx("span",{className:"text-sm font-semibold",children:U.label}),n.jsx("span",{className:"text-[11px] text-gray-500 dark:text-gray-400",children:U.hint})]},U.value)})})]}),(!O||v==="single")&&n.jsxs("div",{children:[n.jsx("label",{className:`block text-xs sm:text-sm font-medium mb-2 ${i==="dark"?"text-gray-300":"text-gray-700"}`,children:"Дата начала"}),n.jsx("input",{type:"date",value:m,onChange:U=>g(U.target.value),className:`w-full px-3 sm:px-4 py-2 sm:py-2.5 text-sm sm:text-base rounded-lg border touch-manipulation ${i==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`})]}),O&&v==="range"&&n.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[n.jsxs("div",{children:[n.jsx("label",{className:`block text-xs sm:text-sm font-medium mb-2 ${i==="dark"?"text-gray-300":"text-gray-700"}`,children:"Начало"}),n.jsx("input",{type:"date",value:E,onChange:U=>k(U.target.value),className:`w-full px-3 sm:px-4 py-2 sm:py-2.5 text-sm sm:text-base rounded-lg border touch-manipulation ${i==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`})]}),n.jsxs("div",{children:[n.jsx("label",{className:`block text-xs sm:text-sm font-medium mb-2 ${i==="dark"?"text-gray-300":"text-gray-700"}`,children:"Конец"}),n.jsx("input",{type:"date",value:w,min:E,onChange:U=>Q(U.target.value),className:`w-full px-3 sm:px-4 py-2 sm:py-2.5 text-sm sm:text-base rounded-lg border touch-manipulation ${i==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`})]})]}),!O&&s==="dayoff"&&v==="range"&&n.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[n.jsxs("div",{children:[n.jsx("label",{className:`block text-xs sm:text-sm font-medium mb-2 ${i==="dark"?"text-gray-300":"text-gray-700"}`,children:"Начало"}),n.jsx("input",{type:"date",value:E,onChange:U=>k(U.target.value),className:`w-full px-3 sm:px-4 py-2 sm:py-2.5 text-sm sm:text-base rounded-lg border touch-manipulation ${i==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`})]}),n.jsxs("div",{children:[n.jsx("label",{className:`block text-xs sm:text-sm font-medium mb-2 ${i==="dark"?"text-gray-300":"text-gray-700"}`,children:"Конец"}),n.jsx("input",{type:"date",value:w,min:E,onChange:U=>Q(U.target.value),className:`w-full px-3 sm:px-4 py-2 sm:py-2.5 text-sm sm:text-base rounded-lg border touch-manipulation ${i==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`})]})]}),O&&v==="multiple"&&n.jsxs("div",{children:[n.jsx("label",{className:`block text-xs sm:text-sm font-medium mb-2 ${i==="dark"?"text-gray-300":"text-gray-700"}`,children:"Выбранные даты"}),n.jsxs("div",{className:"flex flex-col gap-3",children:[n.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[n.jsx("input",{type:"date",value:ae,onChange:U=>V(U.target.value),className:`flex-1 px-3 sm:px-4 py-2 sm:py-2.5 text-sm sm:text-base rounded-lg border touch-manipulation ${i==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`}),n.jsx("button",{type:"button",onClick:L,className:"px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg transition-colors",children:"Добавить"})]}),X.length>0?n.jsx("div",{className:"flex flex-wrap gap-2",children:X.map(U=>n.jsxs("span",{className:"inline-flex items-center gap-2 px-3 py-1.5 rounded-full bg-gray-100 text-gray-800 text-sm",children:[oe(U,"dd.MM.yyyy"),n.jsx("button",{type:"button",onClick:()=>fe(U),className:"text-red-500 hover:text-red-600",children:"x"})]},U))}):n.jsx("p",{className:"text-sm text-gray-500",children:"Пока не выбрано ни одной даты"})]})]}),!O&&s==="dayoff"&&v==="multiple"&&n.jsxs("div",{children:[n.jsx("label",{className:`block text-xs sm:text-sm font-medium mb-2 ${i==="dark"?"text-gray-300":"text-gray-700"}`,children:"Выбранные даты"}),n.jsxs("div",{className:"flex flex-col gap-3",children:[n.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[n.jsx("input",{type:"date",value:ae,onChange:U=>V(U.target.value),className:`flex-1 px-3 sm:px-4 py-2 sm:py-2.5 text-sm sm:text-base rounded-lg border touch-manipulation ${i==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`}),n.jsx("button",{type:"button",onClick:L,className:"px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg transition-colors",children:"Добавить"})]}),X.length>0?n.jsx("div",{className:"flex flex-wrap gap-2",children:X.map(U=>n.jsxs("span",{className:"inline-flex items-center gap-2 px-3 py-1.5 rounded-full bg-gray-100 text-gray-800 text-sm",children:[oe(U,"dd.MM.yyyy"),n.jsx("button",{type:"button",onClick:()=>fe(U),className:"text-red-500 hover:text-red-600",children:"x"})]},U))}):n.jsx("p",{className:"text-sm text-gray-500",children:"Пока не выбрано ни одной даты"})]})]}),v==="single"&&!O&&T==="dayoff"&&n.jsxs("div",{className:"space-y-3",children:[n.jsxs("div",{className:"rounded-xl border border-gray-200 dark:border-gray-800 p-3 sm:p-4 space-y-3",children:[n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{children:[n.jsx("p",{className:`text-sm sm:text-base font-semibold ${l}`,children:"Повтор на неделю"}),n.jsx("p",{className:`text-xs ${i==="dark"?"text-gray-400":"text-gray-600"}`,children:"Выберите дни текущей недели"})]}),n.jsxs("label",{className:"inline-flex items-center gap-2",children:[n.jsx("input",{type:"checkbox",checked:B,onChange:U=>te(U.target.checked),className:"w-4 h-4"}),n.jsx("span",{className:"text-sm",children:"Активировать"})]})]}),B&&n.jsx("div",{className:"flex flex-wrap gap-2",children:J.map((U,_e)=>{const Pe=ve.includes(_e);return n.jsx("button",{type:"button",onClick:()=>W(K=>Pe?K.filter(q=>q!==_e):[...K,_e]),className:`px-3 py-1 rounded-lg border text-sm ${Pe?"border-[#4E6E49] bg-[#4E6E49]/10 text-[#4E6E49]":i==="dark"?"border-white/10 bg-white/5 text-gray-200":"border-gray-200 bg-white text-gray-800"}`,children:U},U)})})]}),n.jsxs("div",{className:"rounded-xl border border-gray-200 dark:border-gray-800 p-3 sm:p-4 space-y-3",children:[n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{children:[n.jsx("p",{className:`text-sm sm:text-base font-semibold ${l}`,children:"Повтор по месяцу"}),n.jsx("p",{className:`text-xs ${i==="dark"?"text-gray-400":"text-gray-600"}`,children:"На тот же день недели до конца месяца"})]}),n.jsxs("label",{className:"inline-flex items-center gap-2",children:[n.jsx("input",{type:"checkbox",checked:F,onChange:U=>re(U.target.checked),className:"w-4 h-4"}),n.jsx("span",{className:"text-sm",children:"Активировать"})]})]}),F&&n.jsx("div",{className:"flex flex-wrap gap-2",children:J.map((U,_e)=>n.jsx("span",{className:`px-3 py-1 rounded-lg border text-sm ${de.includes(_e)?"border-[#4E6E49] bg-[#4E6E49]/10 text-[#4E6E49]":i==="dark"?"border-white/10 bg-white/5 text-gray-200":"border-gray-200 bg-white text-gray-800"}`,children:U},U))})]})]}),(T==="sick"||T==="vacation")&&(!O||v==="single")&&n.jsxs("label",{className:"flex items-center gap-2",children:[n.jsx("input",{type:"checkbox",checked:_,onChange:U=>y(U.target.checked),className:"w-4 h-4"}),n.jsx("span",{className:`${i==="dark"?"text-gray-300":"text-gray-700"}`,children:"Несколько дней"})]}),_&&n.jsxs("div",{children:[n.jsx("label",{className:`block text-xs sm:text-sm font-medium mb-2 ${i==="dark"?"text-gray-300":"text-gray-700"}`,children:"Дата окончания"}),n.jsx("input",{type:"date",value:p,onChange:U=>j(U.target.value),min:m,className:`w-full px-3 sm:px-4 py-2 sm:py-2.5 text-sm sm:text-base rounded-lg border touch-manipulation ${i==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`})]}),n.jsxs("div",{children:[n.jsx("label",{className:`block text-xs sm:text-sm font-medium mb-2 ${i==="dark"?"text-gray-300":"text-gray-700"}`,children:"Комментарий"}),n.jsx("textarea",{value:M,onChange:U=>D(U.target.value),rows:3,className:`w-full px-3 sm:px-4 py-2 sm:py-2.5 text-sm sm:text-base rounded-lg border touch-manipulation resize-y ${i==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`,placeholder:"Добавьте комментарий (необязательно)"})]}),P&&n.jsx("div",{className:"p-3 bg-red-500 text-white rounded-lg text-sm",children:P}),n.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 sm:gap-3 pt-2",children:[n.jsx("button",{onClick:Se,disabled:N||!T,className:`flex-1 px-4 py-2.5 sm:py-2 ${T?G[T]:"bg-gray-400"} hover:opacity-90 disabled:opacity-50 disabled:cursor-not-allowed text-white rounded-lg sm:rounded-xl transition-colors text-sm sm:text-base font-medium touch-manipulation active:scale-95 disabled:active:scale-100`,children:N?"Отправка...":o?"Сохранить":"Отправить на согласование"}),n.jsx("button",{onClick:t,className:`px-4 py-2.5 sm:py-2 rounded-lg sm:rounded-xl transition-colors text-sm sm:text-base font-medium touch-manipulation active:scale-95 ${i==="dark"?"bg-gray-700 hover:bg-gray-600 active:bg-gray-500":"bg-gray-200 hover:bg-gray-300 active:bg-gray-400"}`,children:"Отмена"})]})]})]})]})})})},_S=({onClose:s,onSave:e})=>{const{user:t}=_t(),{theme:r}=lt(),{isAdmin:a}=Ct(),i=r==="dark"?"text-white":"text-gray-900",[o,l]=I.useState(a?[]:t!=null&&t.id?[t.id]:[]),[c,h]=I.useState("slots"),[u,m]=I.useState(!1),[g,p]=I.useState(!1),[j,_]=I.useState(!1),[y,M]=I.useState([]),[D,T]=I.useState([]),[R,P]=I.useState(""),[C,N]=I.useState(""),[b,v]=I.useState(""),[S,E]=I.useState(""),[k,w]=I.useState(!1);Ur();const Q=["Пн","Вт","Ср","Чт","Пт","Сб","Вс"],ae=u?y.length>0?y.map(W=>Q[W]).join(", "):"Дни недели":g?D[0]?`${oe(D[0],"dd.MM")} +${Math.max(D.length-1,0)}`:"Добавьте даты":j?C&&b?`${oe(C,"dd.MM")}–${oe(b,"dd.MM")}`:"Укажите диапазон":"Выберите режим",V=o.map(W=>Tt(W)).join(", "),X=W=>{l(F=>F.includes(W)?F.filter(re=>re!==W):[...F,W])},he=(W,F,re)=>{if(F&&re.some(Boolean)){E("Снимите галочку с другой функции, чтобы активировать эту");return}W(F),F||E("")},B=()=>{if(!R){E("Выберите дату");return}if(D.includes(R)){E("Эта дата уже добавлена");return}T([...D,R].sort()),P(""),E("")},te=W=>T(D.filter(F=>F!==W)),ve=async()=>{if(!a&&!t){E("Пользователь не найден");return}const W=a?o:t?[t.id]:[];if(W.length===0){E("Выберите хотя бы одного участника");return}if(!u&&!g&&!j){E("Выберите способ удаления");return}if(u&&y.length===0){E("Выберите день недели");return}if(g&&D.length===0){E("Добавьте хотя бы одну дату");return}if(j){if(!C||!b){E("Укажите начальную и конечную дату диапазона");return}if(C>b){E("Начальная дата должна быть раньше конечной");return}}E(""),w(!0);try{const F=await Promise.all(W.map(se=>Is(se))),re=await Promise.all(W.map(se=>Ar(se))),de=F.flat(),$=re.flat(),O=(se,je)=>!C||!b?!1:!((je||se)<C||se>b),J=(se,je)=>D.length===0?!1:je?D.some(Se=>Se>=se&&Se<=(je||se)):D.includes(se),Y=(se,je)=>{if(y.length===0)return!1;const Se=[],G=new Date(se+"T00:00:00"),xe=je?new Date(je+"T00:00:00"):new Date(se+"T00:00:00");let z=G;for(;z<=xe;)Se.push(oe(z,"yyyy-MM-dd")),z.setDate(z.getDate()+1);return Se.some(ce=>{const ke=new Date(ce+"T00:00:00"),ue=ke.getDay()===0?6:ke.getDay()-1;return y.includes(ue)})};let Z=[];if(c==="slots"?Z=de.filter(se=>!!(u&&Y(se.date)||g&&D.includes(se.date)||j&&O(se.date))).map(se=>se.id):Z=$.filter(se=>se.type!==c?!1:!!(u&&Y(se.date,se.endDate)||g&&J(se.date,se.endDate)||j&&O(se.date,se.endDate))).map(se=>se.id),Z.length===0){E("Ничего не найдено под выбранные условия"),w(!1);return}const L=W.length>1?`${W.length} участников`:Tt(W[0])||"участника",fe=y.map(se=>Q[se]).join(", "),ge=c==="slots"?"слоты":c==="dayoff"?"выходные":c==="sick"?"больничные":c==="vacation"?"отпуска":"прогулы",H=u?`по дням недели (${fe})`:g?`по датам: ${D.map(se=>oe(se,"dd.MM")).join(", ")}`:`по диапазону ${oe(C,"dd.MM")} — ${oe(b,"dd.MM")}`;if(!confirm(`Удалить ${ge} (${Z.length}) ${H} для ${L}?`)){w(!1);return}if(a)if(c==="slots")for(const se of Z)await bc(se);else for(const se of Z)await vc(se);else if(c==="slots")for(const se of Z){const je=de.find(Se=>Se.id===se);je&&await It({entity:"slot",action:"delete",authorId:(t==null?void 0:t.id)||"",targetUserId:je.userId,before:je,after:null,comment:`Удаление слота ${oe(je.date,"dd.MM.yyyy")}`})}else for(const se of Z){const je=$.find(Se=>Se.id===se);je&&await It({entity:"status",action:"delete",authorId:(t==null?void 0:t.id)||"",targetUserId:je.userId,before:je,after:null,comment:`Удаление ${c==="dayoff"?"выходного":c==="sick"?"больничного":c==="vacation"?"отпуска":"прогула"} ${oe(je.date,"dd.MM.yyyy")}`})}e(),s()}catch(F){console.error("Error deleting items:",F),E("Ошибка при удалении")}finally{w(!1)}};return n.jsx("div",{className:"fixed inset-0 bg-slate-950/75 backdrop-blur-xl flex items-start sm:items-center justify-center z-[70] p-4 sm:p-6 overflow-y-auto overscroll-contain modal-scroll",children:n.jsx("div",{className:`w-full max-w-5xl rounded-3xl shadow-[0_24px_80px_rgba(0,0,0,0.45)] border ${r==="dark"?"bg-gradient-to-br from-[#0c1320] via-[#0b1220] to-[#08111b] border-white/10":"bg-gradient-to-br from-white via-slate-50 to-white border-slate-200"} max-h-[85dvh] sm:max-h-[calc(100dvh-96px)] overflow-y-auto`,children:n.jsxs("div",{className:"p-5 sm:p-6 lg:p-7 flex flex-col h-full min-h-0 overflow-y-auto modal-scroll",children:[n.jsxs("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between",children:[n.jsxs("div",{className:"space-y-1",children:[n.jsx("div",{className:"flex items-center gap-2 text-xs font-semibold text-[#4E6E49] tracking-tight",children:n.jsx("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full bg-[#4E6E49]/10 text-[#4E6E49] border border-[#4E6E49]/30",children:"Очистить расписание"})}),n.jsx("h3",{className:`text-2xl sm:text-3xl font-bold ${i}`,children:"Удаление слотов и отсутствий"})]}),n.jsx("button",{onClick:s,className:`p-2.5 rounded-full border ${r==="dark"?"border-white/10 text-gray-200 hover:bg-white/5":"border-slate-200 text-slate-600 hover:bg-slate-100"}`,children:n.jsx(Ft,{className:"w-5 h-5"})})]}),n.jsxs("div",{className:"mt-5 grid lg:grid-cols-[0.95fr_1.45fr] gap-4 lg:gap-6 flex-1 overflow-hidden",children:[n.jsxs("aside",{className:`rounded-2xl border ${r==="dark"?"border-white/10 bg-white/5":"border-slate-200 bg-white"} p-4 sm:p-5 space-y-4 sticky top-0 self-start max-h-full overflow-y-auto`,children:[n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsx("p",{className:"text-sm font-semibold",children:"Навигация"}),n.jsx("span",{className:"text-[11px] uppercase tracking-wide text-[#4E6E49] font-semibold",children:"3 шага"})]}),n.jsx("div",{className:"space-y-2",children:[{label:"Участники",detail:V||"Не выбрано",done:o.length>0||!a},{label:"Тип удаления",detail:c==="slots"?"Слоты":c==="dayoff"?"Выходные":c==="sick"?"Больничные":c==="vacation"?"Отпуска":"Прогулы",done:!0},{label:"Режим",detail:ae,done:ae!=="Выберите режим"}].map((W,F)=>n.jsxs("div",{className:`flex items-start gap-3 rounded-xl border px-3 py-3 ${r==="dark"?"border-white/10 bg-white/5":"border-slate-200 bg-slate-50"}`,children:[n.jsx("span",{className:`mt-0.5 inline-flex h-6 w-6 items-center justify-center rounded-full text-xs font-bold ${W.done?"bg-[#4E6E49] text-white":r==="dark"?"bg-slate-800 text-gray-300":"bg-slate-200 text-slate-700"}`,children:F+1}),n.jsxs("div",{className:"flex-1",children:[n.jsx("p",{className:"text-sm font-semibold",children:W.label}),n.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 truncate",children:W.detail||"—"})]})]},W.label))}),n.jsxs("div",{className:`rounded-xl border px-3 py-3 space-y-2 ${r==="dark"?"border-emerald-900/50 bg-emerald-900/20":"border-emerald-100 bg-emerald-50"}`,children:[n.jsx("p",{className:"text-xs uppercase tracking-wide text-emerald-600 font-semibold",children:"Подсказка"}),n.jsx("p",{className:"text-sm text-emerald-700 dark:text-emerald-200",children:"Один режим за раз: дни недели, конкретные даты или диапазон."})]})]}),n.jsxs("div",{className:"space-y-4 overflow-y-auto overscroll-contain pr-1 pb-6 flex-1 min-h-0",children:[n.jsxs("div",{className:"space-y-2",children:[n.jsx("p",{className:`text-sm font-semibold ${i}`,children:"Что удаляем"}),n.jsx("div",{className:"flex flex-wrap gap-2",children:[{key:"slots",label:"Слоты"},{key:"dayoff",label:"Выходные"},{key:"sick",label:"Больничные"},{key:"vacation",label:"Отпуска"},...a?[{key:"absence",label:"Прогулы"}]:[]].map(W=>n.jsx("button",{onClick:()=>h(W.key),className:`px-3 py-1.5 rounded-lg border text-sm ${c===W.key?"bg-red-500 text-white border-red-500":r==="dark"?"bg-gray-700 text-gray-200 border-gray-700 hover:bg-gray-600":"bg-gray-100 text-gray-800 border-gray-200 hover:bg-gray-200"}`,children:W.label},W.key))})]}),a&&n.jsxs("div",{className:"space-y-2",children:[n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsx("p",{className:`text-sm font-semibold ${i}`,children:"Участники"}),n.jsx("button",{onClick:()=>l(W=>W.length===Re.length?[]:Re.map(F=>F.id)),className:"text-xs text-[#4E6E49] font-semibold",children:o.length===Re.length?"Снять выделение":"Выбрать всех"})]}),n.jsx("div",{className:"flex flex-wrap gap-2",children:Re.map(W=>{const F=o.includes(W.id);return n.jsx("button",{onClick:()=>X(W.id),className:`px-3 py-1.5 rounded-lg transition-colors text-sm ${F?"bg-red-500 text-white":r==="dark"?"bg-gray-700 text-gray-300 hover:bg-gray-600":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:Tt(W.id)},W.id)})})]}),n.jsxs("label",{className:"flex items-center gap-2",children:[n.jsx("input",{type:"checkbox",checked:u,onChange:W=>he(m,W.target.checked,[g,j]),className:"w-4 h-4"}),n.jsx("span",{className:`${r==="dark"?"text-gray-300":"text-gray-700"}`,children:"Удалить по дню недели"})]}),u&&n.jsxs("div",{className:"ml-6",children:[n.jsx("p",{className:`text-sm mb-2 ${r==="dark"?"text-gray-400":"text-gray-600"}`,children:"Выберите дни недели:"}),n.jsx("div",{className:"flex gap-2 flex-wrap",children:Q.map((W,F)=>{const re=y.includes(F);return n.jsx("button",{onClick:()=>M(de=>re?de.filter($=>$!==F):[...de,F]),className:`px-3 py-1 rounded-lg transition-colors ${re?"bg-red-500 text-white":r==="dark"?"bg-gray-700 text-gray-300":"bg-gray-200 text-gray-700"}`,children:W},W)})})]}),n.jsxs("label",{className:"flex items-center gap-2",children:[n.jsx("input",{type:"checkbox",checked:g,onChange:W=>he(p,W.target.checked,[u,j]),className:"w-4 h-4"}),n.jsx("span",{className:`${r==="dark"?"text-gray-300":"text-gray-700"}`,children:"Удалить по конкретным датам"})]}),g&&n.jsxs("div",{className:"ml-6 space-y-3",children:[n.jsxs("div",{className:"flex gap-2",children:[n.jsx("input",{type:"date",value:R,onChange:W=>P(W.target.value),className:`flex-1 px-4 py-2 rounded-lg border ${r==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-red-500`}),n.jsx("button",{onClick:B,className:"px-4 py-2 bg-[#4E6E49] hover:bg-[#4E6E49] text-white rounded-lg transition-colors",children:"Добавить"})]}),D.length>0&&n.jsxs("div",{className:"space-y-2",children:[n.jsxs("p",{className:`text-sm ${r==="dark"?"text-gray-400":"text-gray-600"}`,children:["Выбранные даты (",D.length,"):"]}),n.jsx("div",{className:"flex flex-wrap gap-2",children:D.map(W=>n.jsxs("div",{className:`flex items-center gap-2 px-3 py-1 rounded-lg ${r==="dark"?"bg-gray-700":"bg-gray-100"}`,children:[n.jsx("span",{className:i,children:oe(W,"dd.MM.yyyy")}),n.jsx("button",{onClick:()=>te(W),className:"p-1 text-red-500 hover:bg-red-500 hover:text-white rounded transition-colors",children:n.jsx(Ft,{className:"w-3 h-3"})})]},W))})]})]}),n.jsxs("label",{className:"flex items-center gap-2",children:[n.jsx("input",{type:"checkbox",checked:j,onChange:W=>he(_,W.target.checked,[u,g]),className:"w-4 h-4"}),n.jsx("span",{className:`${r==="dark"?"text-gray-300":"text-gray-700"}`,children:"Удалить по диапазону дат"})]}),j&&n.jsxs("div",{className:"ml-6 space-y-3",children:[n.jsxs("div",{className:"flex gap-2",children:[n.jsxs("div",{className:"flex-1",children:[n.jsx("label",{className:`block text-xs mb-1 ${r==="dark"?"text-gray-400":"text-gray-600"}`,children:"Начальная дата"}),n.jsx("input",{type:"date",value:C,onChange:W=>N(W.target.value),className:`w-full px-4 py-2 rounded-lg border ${r==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-red-500`})]}),n.jsxs("div",{className:"flex-1",children:[n.jsx("label",{className:`block text-xs mb-1 ${r==="dark"?"text-gray-400":"text-gray-600"}`,children:"Конечная дата"}),n.jsx("input",{type:"date",value:b,onChange:W=>v(W.target.value),min:C,className:`w-full px-4 py-2 rounded-lg border ${r==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-red-500`})]})]}),C&&b&&n.jsxs("p",{className:`text-sm ${r==="dark"?"text-gray-400":"text-gray-600"}`,children:["Будет удалено: с ",oe(C,"dd.MM.yyyy")," по ",oe(b,"dd.MM.yyyy")]})]}),S&&n.jsx("div",{className:"p-3 bg-red-500 text-white rounded-lg text-sm",children:S}),n.jsxs("div",{className:"flex gap-3",children:[n.jsxs("button",{onClick:ve,disabled:k||!u&&!g&&!j,className:"flex-1 px-4 py-2 bg-red-500 hover:bg-red-600 disabled:bg-gray-400 disabled:cursor-not-allowed text-white rounded-lg transition-colors flex items-center justify-center gap-2",children:[n.jsx(Bt,{className:"w-4 h-4"}),k?a?"Удаление...":"Отправка на согласование...":a?"Очистить расписание":"Отправить на согласование"]}),n.jsx("button",{onClick:s,className:`px-4 py-2 rounded-lg transition-colors ${r==="dark"?"bg-gray-700 hover:bg-gray-600":"bg-gray-200 hover:bg-gray-300"}`,children:"Отмена"})]})]})]})]})})})},NS=({onClose:s,onSave:e})=>{const{user:t}=_t(),{theme:r}=lt(),{isAdmin:a}=Ct(),i=r==="dark"?"text-white":"text-gray-900",[o,l]=I.useState("all"),[c,h]=I.useState(oe(new Date,"yyyy-MM-dd")),[u,m]=I.useState(oe(new Date,"yyyy-MM-dd")),[g,p]=I.useState(!1),[j,_]=I.useState(""),[y,M]=I.useState(!1),[D,T]=I.useState(""),[R,P]=I.useState(""),[C,N]=I.useState(!1),[b,v]=I.useState(!0),[S,E]=I.useState(!1),[k,w]=I.useState([]),[Q,ae]=I.useState(!1),[V,X]=I.useState(!1),[he,B]=I.useState(null);Ur(),I.useEffect(()=>{g||m(c)},[g,c]),I.useEffect(()=>{te()},[]);const te=async()=>{if(a){ae(!0);try{const $=await Kd();w($)}catch($){console.error("Error loading restrictions:",$)}finally{ae(!1)}}},ve=$=>{B($),l($.type),h($.startDate),m($.endDate||$.startDate),p(!!$.endDate),_($.startTime||""),M(!!$.startTime),T($.comment||""),v($.isActive),E($.blockFutureDates||!1),X(!0),P("")},W=async $=>{if(confirm("Вы уверены, что хотите удалить это ограничение?"))try{await L5($),await te(),P("")}catch(O){console.error("Error deleting restriction:",O),P(O.message||"Ошибка при удалении ограничения")}},F=()=>{B(null),l("all"),h(oe(new Date,"yyyy-MM-dd")),m(oe(new Date,"yyyy-MM-dd")),p(!1),_(""),M(!1),T(""),v(!0),E(!1),X(!0),P("")},re={slots:"Слоты",dayoff:"Выходные",sick:"Больничные",vacation:"Отпуска",absence:"Прогулы",all:"Всё"},de=async()=>{if(console.log("handleSave called, isAdmin:",a,"user:",t),!a){P("Только администратор может управлять ограничениями. Активируйте админ режим на странице входа.");return}if(!c){P("Выберите дату начала ограничения");return}if(g&&u&&c>u){P("Дата окончания должна быть позже даты начала");return}try{const $=await Kd(!0),O=he==null?void 0:he.id;if($.some(Y=>{if(Y.id===O)return!1;const Z=new Date(Y.startDate),L=Y.endDate?new Date(Y.endDate):Z,fe=new Date(c),H=!((g&&u?new Date(u):fe)<Z||fe>L),se=Y.type===o||Y.type==="all"||o==="all";return H&&se})){P("Уже существует пересекающееся ограничение для этого типа/периода");return}}catch($){console.error("Error checking restrictions:",$)}P(""),N(!0);try{const $={type:o,startDate:c,...g&&u!==c&&{endDate:u},...y&&j&&{startTime:j},...S&&{blockFutureDates:S},...D&&{comment:D},createdBy:(t==null?void 0:t.id)||"admin",createdAt:(he==null?void 0:he.createdAt)||new Date().toISOString(),isActive:b};he?await O5(he.id,$):await P5($),await te(),X(!1),e()}catch($){console.error("Error saving restriction:",$),P($.message||"Ошибка при сохранении ограничения")}finally{N(!1)}};return n.jsx("div",{className:"fixed inset-0 bg-slate-950/75 backdrop-blur-xl flex items-start sm:items-center justify-center z-[70] p-4 sm:p-6 touch-manipulation overflow-y-auto",children:n.jsx("div",{className:`w-full max-w-2xl rounded-3xl shadow-[0_24px_80px_rgba(0,0,0,0.45)] border ${r==="dark"?"bg-gradient-to-br from-[#0c1320] via-[#0b1220] to-[#08111b] border-white/10":"bg-gradient-to-br from-white via-slate-50 to-white border-slate-200"} max-h-[90vh] overflow-y-auto`,children:n.jsxs("div",{className:"p-4 sm:p-6 lg:p-7 flex flex-col h-full min-h-0 overflow-y-auto",children:[n.jsxs("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between",children:[n.jsxs("div",{className:"space-y-1",children:[n.jsx("div",{className:"flex items-center gap-2 text-xs font-semibold text-orange-600 tracking-tight",children:n.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full bg-orange-500/10 text-orange-600 border border-orange-500/30",children:[n.jsx(Ot,{className:"w-3 h-3"}),"Управление ограничениями"]})}),n.jsx("h3",{className:`text-2xl sm:text-3xl font-bold ${i}`,children:"Ограничения для команды"}),n.jsx("p",{className:`text-sm ${r==="dark"?"text-gray-400":"text-gray-600"}`,children:"Запретить участникам создавать определённые записи в указанный период"})]}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsxs("div",{className:`px-3 py-2 rounded-xl border text-xs sm:text-sm ${r==="dark"?"border-white/10 bg-white/5 text-gray-200":"border-slate-200 bg-slate-50 text-slate-700"}`,children:["Админ · Управление ",a?"(активен)":"(не активен)"]}),n.jsx("button",{onClick:s,className:`p-2.5 rounded-full border ${r==="dark"?"border-white/10 text-gray-200 hover:bg-white/5":"border-slate-200 text-slate-600 hover:bg-slate-100"} transition-colors touch-manipulation`,"aria-label":"Закрыть",children:n.jsx(Ft,{className:"w-4 h-4 sm:w-5 sm:h-5"})})]})]}),n.jsxs("div",{className:"mt-5 space-y-6 flex-1 min-h-0",children:[n.jsxs("div",{children:[n.jsxs("div",{className:"flex items-center justify-between mb-4",children:[n.jsx("h4",{className:`text-lg font-semibold ${i}`,children:"Существующие ограничения"}),n.jsxs("div",{className:"flex gap-2",children:[n.jsxs("button",{onClick:F,className:`flex items-center gap-2 px-3 py-2 rounded-lg text-sm font-medium transition-colors ${V?"bg-orange-500 text-white":r==="dark"?"bg-gray-700 text-gray-200 hover:bg-gray-600":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:[n.jsx(Cr,{className:"w-4 h-4"}),V?"Создать новое":"Создать ограничение"]}),n.jsxs("button",{onClick:async()=>{const $=oe(new Date,"yyyy-MM-dd"),O=await Rl("slots",$,"10:00");alert(`Test result: ${O.restricted?"BLOCKED":"ALLOWED"}
${O.reason||"No restrictions"}`)},className:"flex items-center gap-2 px-3 py-2 rounded-lg text-sm font-medium bg-blue-500 text-white hover:bg-blue-600 transition-colors",children:[n.jsx(Ot,{className:"w-4 h-4"}),"Тест ограничений"]})]})]}),Q?n.jsx("div",{className:`p-6 rounded-xl border ${r==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-gray-50"} text-center`,children:n.jsx("p",{className:r==="dark"?"text-gray-400":"text-gray-600",children:"Загрузка..."})}):k.length===0?n.jsxs("div",{className:`p-6 rounded-xl border ${r==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-gray-50"} text-center`,children:[n.jsx(Xt,{className:`w-8 h-8 mx-auto mb-2 ${r==="dark"?"text-gray-400":"text-gray-500"}`}),n.jsx("p",{className:r==="dark"?"text-gray-400":"text-gray-600",children:"Нет активных ограничений"})]}):n.jsx("div",{className:"space-y-3",children:k.map($=>n.jsx("div",{className:`p-4 rounded-xl border transition-all ${$.isActive?r==="dark"?"border-orange-500/30 bg-orange-500/5":"border-orange-200 bg-orange-50":r==="dark"?"border-gray-600 bg-gray-800/50":"border-gray-300 bg-gray-100"}`,children:n.jsxs("div",{className:"flex items-start justify-between",children:[n.jsxs("div",{className:"flex-1",children:[n.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[n.jsxs("span",{className:`inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium ${$.isActive?"bg-orange-100 text-orange-800 dark:bg-orange-900/50 dark:text-orange-200":"bg-gray-100 text-gray-600 dark:bg-gray-700 dark:text-gray-400"}`,children:[$.isActive?n.jsx(Xt,{className:"w-3 h-3"}):n.jsx(Ot,{className:"w-3 h-3"}),re[$.type]]}),!$.isActive&&n.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Неактивно"})]}),n.jsxs("div",{className:"space-y-1 text-sm",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx(Fr,{className:"w-4 h-4 text-gray-500"}),n.jsx("span",{className:i,children:$.endDate?`${oe($.startDate,"dd.MM.yyyy")} - ${oe($.endDate,"dd.MM.yyyy")}`:oe($.startDate,"dd.MM.yyyy")})]}),$.startTime&&n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx(Ks,{className:"w-4 h-4 text-gray-500"}),n.jsxs("span",{className:r==="dark"?"text-gray-300":"text-gray-700",children:["С ",$.startTime]})]}),$.blockFutureDates&&n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx(Xt,{className:"w-4 h-4 text-amber-500"}),n.jsx("span",{className:`text-xs ${r==="dark"?"text-amber-300":"text-amber-700"}`,children:"Блокировка следующего дня после наступления времени ограничения"})]}),$.comment&&n.jsx("div",{className:"text-gray-600 dark:text-gray-400 italic",children:$.comment})]})]}),n.jsxs("div",{className:"flex items-center gap-1 ml-4",children:[n.jsx("button",{onClick:()=>ve($),className:"p-2 text-blue-500 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded-lg transition-colors",title:"Редактировать",children:n.jsx(ps,{className:"w-4 h-4"})}),n.jsx("button",{onClick:()=>W($.id),className:"p-2 text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition-colors",title:"Удалить",children:n.jsx(Bt,{className:"w-4 h-4"})})]})]})},$.id))})]}),V&&n.jsxs("div",{className:"border-t pt-6",children:[n.jsx("h4",{className:`text-lg font-semibold mb-4 ${i}`,children:he?"Редактировать ограничение":"Создать новое ограничение"}),n.jsxs("div",{children:[n.jsx("label",{className:`block text-xs sm:text-sm font-medium mb-3 ${r==="dark"?"text-gray-300":"text-gray-700"}`,children:"Что запретить"}),n.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-3",children:Object.entries(re).map(([$,O])=>n.jsxs("label",{className:`relative flex items-center gap-3 p-3 rounded-xl border cursor-pointer transition-all ${o===$?"bg-orange-100 text-orange-800 border-orange-200 dark:bg-orange-900/30 dark:text-orange-100 dark:border-orange-800 ring-2 ring-orange-500/50 shadow-lg":r==="dark"?"border-white/10 bg-white/5 text-gray-200 hover:border-white/30":"border-slate-200 bg-white text-gray-800 hover:border-slate-300"}`,children:[n.jsx("input",{type:"radio",value:$,checked:o===$,onChange:J=>l(J.target.value),className:"hidden"}),n.jsx("span",{className:`text-sm font-semibold ${o===$?"text-orange-700 dark:text-orange-200":""}`,children:O})]},$))})]}),n.jsxs("div",{children:[n.jsx("label",{className:`block text-xs sm:text-sm font-medium mb-3 ${r==="dark"?"text-gray-300":"text-gray-700"}`,children:"Период ограничения"}),n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{className:"flex items-center gap-4",children:[n.jsxs("label",{className:"flex items-center gap-2 text-sm cursor-pointer",children:[n.jsx("input",{type:"radio",checked:!g,onChange:()=>p(!1),className:`w-4 h-4 rounded border-2 ${r==="dark"?"border-gray-800 bg-gray-700 checked:bg-[#4E6E49] checked:border-[#4E6E49]":"border-gray-300 bg-white checked:bg-[#4E6E49] checked:border-[#4E6E49]"} focus:ring-2 focus:ring-[#4E6E49] cursor-pointer touch-manipulation`}),n.jsx("span",{className:r==="dark"?"text-gray-200":"text-gray-700",children:"Один день"})]}),n.jsxs("label",{className:"flex items-center gap-2 text-sm cursor-pointer",children:[n.jsx("input",{type:"radio",checked:g,onChange:()=>p(!0),className:`w-4 h-4 rounded border-2 ${r==="dark"?"border-gray-800 bg-gray-700 checked:bg-[#4E6E49] checked:border-[#4E6E49]":"border-gray-300 bg-white checked:bg-[#4E6E49] checked:border-[#4E6E49]"} focus:ring-2 focus:ring-[#4E6E49] cursor-pointer touch-manipulation`}),n.jsx("span",{className:r==="dark"?"text-gray-200":"text-gray-700",children:"Диапазон дат"})]})]}),n.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[n.jsxs("div",{children:[n.jsx("label",{className:`block text-xs sm:text-sm font-medium mb-2 ${r==="dark"?"text-gray-300":"text-gray-700"}`,children:"Дата начала"}),n.jsx("input",{type:"date",value:c,onChange:$=>h($.target.value),className:`w-full px-3 sm:px-4 py-2 sm:py-2.5 text-sm sm:text-base rounded-lg border touch-manipulation ${r==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`})]}),g&&n.jsxs("div",{children:[n.jsx("label",{className:`block text-xs sm:text-sm font-medium mb-2 ${r==="dark"?"text-gray-300":"text-gray-700"}`,children:"Дата окончания"}),n.jsx("input",{type:"date",value:u,min:c,onChange:$=>m($.target.value),className:`w-full px-3 sm:px-4 py-2 sm:py-2.5 text-sm sm:text-base rounded-lg border touch-manipulation ${r==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`})]})]})]})]}),n.jsxs("div",{children:[n.jsx("label",{className:`block text-xs sm:text-sm font-medium mb-3 ${r==="dark"?"text-gray-300":"text-gray-700"}`,children:"Временное ограничение"}),n.jsxs("div",{className:"space-y-3",children:[n.jsxs("label",{className:"flex items-center gap-2 text-sm cursor-pointer",children:[n.jsx("input",{type:"checkbox",checked:y,onChange:$=>M($.target.checked),className:`w-4 h-4 rounded border-2 ${r==="dark"?"border-gray-800 bg-gray-700 checked:bg-[#4E6E49] checked:border-[#4E6E49]":"border-gray-300 bg-white checked:bg-[#4E6E49] checked:border-[#4E6E49]"} focus:ring-2 focus:ring-[#4E6E49] cursor-pointer touch-manipulation`}),n.jsx("span",{className:r==="dark"?"text-gray-200":"text-gray-700",children:"Запретить начиная с определённого времени"})]}),y&&n.jsxs("div",{className:"ml-6",children:[n.jsx("label",{className:`block text-xs sm:text-sm font-medium mb-2 ${r==="dark"?"text-gray-300":"text-gray-700"}`,children:"Время начала ограничения"}),n.jsx("input",{type:"time",value:j,onChange:$=>_($.target.value),className:`w-full max-w-xs px-3 sm:px-4 py-2 sm:py-2.5 text-sm sm:text-base rounded-lg border touch-manipulation ${r==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`})]})]})]}),n.jsxs("div",{children:[n.jsx("label",{className:`block text-xs sm:text-sm font-medium mb-2 ${r==="dark"?"text-gray-300":"text-gray-700"}`,children:"Комментарий"}),n.jsx("textarea",{value:D,onChange:$=>T($.target.value),rows:3,className:`w-full px-3 sm:px-4 py-2 sm:py-2.5 text-sm sm:text-base rounded-lg border touch-manipulation resize-y ${r==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`,placeholder:"Причина ограничения (необязательно)"})]}),he&&n.jsx("div",{children:n.jsxs("label",{className:"flex items-center gap-2 text-sm cursor-pointer",children:[n.jsx("input",{type:"checkbox",checked:b,onChange:$=>v($.target.checked),className:`w-4 h-4 rounded border-2 ${r==="dark"?"border-gray-800 bg-gray-700 checked:bg-[#4E6E49] checked:border-[#4E6E49]":"border-gray-300 bg-white checked:bg-[#4E6E49] checked:border-[#4E6E49]"} focus:ring-2 focus:ring-[#4E6E49] cursor-pointer touch-manipulation`}),n.jsx("span",{className:r==="dark"?"text-gray-200":"text-gray-700",children:"Ограничение активно"})]})}),n.jsxs("div",{children:[n.jsxs("label",{className:"flex items-center gap-2 text-sm cursor-pointer",children:[n.jsx("input",{type:"checkbox",checked:S,onChange:$=>E($.target.checked),className:`w-4 h-4 rounded border-2 ${r==="dark"?"border-gray-800 bg-gray-700 checked:bg-[#4E6E49] checked:border-[#4E6E49]":"border-gray-300 bg-white checked:bg-[#4E6E49] checked:border-[#4E6E49]"} focus:ring-2 focus:ring-[#4E6E49] cursor-pointer touch-manipulation`}),n.jsx("span",{className:r==="dark"?"text-gray-200":"text-gray-700",children:"После наступления даты/времени ограничения блокировать создание записей только на следующий день"})]}),S&&n.jsx("p",{className:`mt-2 text-xs ${r==="dark"?"text-gray-400":"text-gray-600"}`,children:"Пример: после 14.12 21:00 нельзя будет создавать слоты/отпуска только на 15.12 (следующий день)"})]}),R&&n.jsx("div",{className:"p-3 bg-red-500 text-white rounded-lg text-sm",children:R}),n.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 sm:gap-3 pt-2",children:[n.jsx("button",{onClick:de,disabled:C,className:"flex-1 px-4 py-2.5 sm:py-2 bg-orange-500 hover:bg-orange-600 disabled:bg-gray-400 disabled:cursor-not-allowed text-white rounded-lg sm:rounded-xl transition-colors text-sm sm:text-base font-medium touch-manipulation active:scale-95 disabled:active:scale-100",children:C?"Сохранение...":he?"Сохранить изменения":"Создать ограничение"}),n.jsx("button",{onClick:s,className:`px-4 py-2.5 sm:py-2 rounded-lg sm:rounded-xl transition-colors text-sm sm:text-base font-medium touch-manipulation active:scale-95 ${r==="dark"?"bg-gray-700 hover:bg-gray-600 active:bg-gray-500":"bg-gray-200 hover:bg-gray-300 active:bg-gray-400"}`,children:"Отмена"})]})]})]})]})})})},jS=({onClose:s})=>{const{theme:e}=lt(),{user:t}=_t(),{isAdmin:r}=Ct();Ur();const[a,i]=I.useState([]),[o,l]=I.useState(!0),[c,h]=I.useState(!1),[u,m]=I.useState(""),[g,p]=I.useState(null),[j,_]=I.useState(!1),[y,M]=I.useState({userId:"",restrictedUserId:"",reason:"",isActive:!0});I.useEffect(()=>{D()},[]);const D=async()=>{try{const S=await Ab();i(S)}catch(S){console.error("Error loading conflicts:",S)}finally{l(!1)}},T=async S=>{if(S.preventDefault(),!t&&!r){m("Пользователь не найден (необходима авторизация)");return}h(!0),m("");try{const E={...y,createdBy:(t==null?void 0:t.id)||"admin",createdAt:new Date().toISOString()};g?await nf(g.id,E):await nS(E),await D(),N(),_(!1),p(null)}catch(E){console.error("Error saving conflict:",E),m(E.message||"Ошибка при сохранении конфликта")}finally{h(!1)}},R=S=>{p(S),M({userId:S.userId,restrictedUserId:S.restrictedUserId,reason:S.reason||"",isActive:S.isActive}),m(""),_(!0)},P=async S=>{if(confirm("Удалить конфликт?"))try{await aS(S),await D()}catch(E){console.error("Error deleting conflict:",E)}},C=async S=>{try{await nf(S.id,{isActive:!S.isActive}),await D()}catch(E){console.error("Error toggling conflict status:",E)}},N=()=>{m(""),M({userId:"",restrictedUserId:"",reason:"",isActive:!0})},b=S=>{const E=Re.find(k=>k.id===S);return(E==null?void 0:E.name)||S},v=Re.filter(S=>S.id!==y.userId);return o?n.jsx("div",{className:"flex items-center justify-center p-8",children:n.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-4 border-[#4E6E49] border-t-transparent"})}):n.jsx("div",{className:"fixed inset-0 bg-slate-950/75 backdrop-blur-xl flex items-start sm:items-center justify-center z-[70] p-4 overflow-y-auto touch-manipulation",children:n.jsxs("div",{className:`w-full max-w-4xl rounded-3xl shadow-[0_24px_80px_rgba(0,0,0,0.45)] border ${e==="dark"?"bg-gradient-to-br from-[#0c1320] via-[#0b1220] to-[#08111b] border-white/10":"bg-gradient-to-br from-white via-slate-50 to-white border-slate-200"} max-h-[90vh] overflow-hidden flex flex-col`,children:[n.jsx("div",{className:"p-6 border-b border-white/10",children:n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx("div",{className:"w-10 h-10 rounded-xl flex items-center justify-center bg-red-500/10 text-red-500",children:n.jsx(vd,{className:"w-5 h-5"})}),n.jsxs("div",{children:[n.jsx("h3",{className:`text-xl font-bold ${e==="dark"?"text-white":"text-gray-900"}`,children:"Управление конфликтами пользователей"}),n.jsx("p",{className:`text-sm ${e==="dark"?"text-gray-400":"text-gray-600"}`,children:"Настройте ограничения на совместную работу пользователей"})]})]}),n.jsx("button",{onClick:s,className:`p-2 rounded-full border ${e==="dark"?"border-white/10 text-gray-200 hover:bg-white/5":"border-slate-200 text-slate-600 hover:bg-slate-100"} transition-colors`,children:n.jsx(Ft,{className:"w-5 h-5"})})]})}),n.jsx("div",{className:"flex-1 overflow-y-auto",children:n.jsx("div",{className:"p-6",children:n.jsxs("div",{className:"space-y-6",children:[(j||g)&&n.jsxs("div",{className:`rounded-2xl border p-6 ${e==="dark"?"border-white/10 bg-white/5":"border-slate-200 bg-slate-50"}`,children:[n.jsx("h4",{className:`text-lg font-semibold mb-4 ${e==="dark"?"text-white":"text-gray-900"}`,children:g?"Редактировать конфликт":"Добавить конфликт"}),u&&n.jsxs("div",{className:"mb-4 p-3 rounded-lg bg-red-500/10 border border-red-500/20 flex items-start gap-3",children:[n.jsx(Kl,{className:"w-5 h-5 text-red-500 shrink-0 mt-0.5"}),n.jsx("p",{className:"text-sm text-red-500",children:u})]}),n.jsxs("form",{onSubmit:T,className:"space-y-4",children:[n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[n.jsxs("div",{children:[n.jsx("label",{className:`block text-sm font-medium mb-2 ${e==="dark"?"text-gray-300":"text-gray-700"}`,children:"Пользователь"}),n.jsxs("select",{value:y.userId,onChange:S=>M(E=>({...E,userId:S.target.value})),className:`w-full px-3 py-2 rounded-lg border ${e==="dark"?"bg-gray-700 border-gray-600 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`,required:!0,children:[n.jsx("option",{value:"",children:"Выберите пользователя"}),Re.map(S=>n.jsx("option",{value:S.id,children:S.name},S.id))]})]}),n.jsxs("div",{children:[n.jsx("label",{className:`block text-sm font-medium mb-2 ${e==="dark"?"text-gray-300":"text-gray-700"}`,children:"Запрещено работать с"}),n.jsxs("select",{value:y.restrictedUserId,onChange:S=>M(E=>({...E,restrictedUserId:S.target.value})),className:`w-full px-3 py-2 rounded-lg border ${e==="dark"?"bg-gray-700 border-gray-600 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`,required:!0,children:[n.jsx("option",{value:"",children:"Выберите пользователя"}),v.map(S=>n.jsx("option",{value:S.id,children:S.name},S.id))]})]})]}),n.jsxs("div",{children:[n.jsx("label",{className:`block text-sm font-medium mb-2 ${e==="dark"?"text-gray-300":"text-gray-700"}`,children:"Причина (опционально)"}),n.jsx("textarea",{value:y.reason,onChange:S=>M(E=>({...E,reason:S.target.value})),className:`w-full px-3 py-2 rounded-lg border resize-none ${e==="dark"?"bg-gray-700 border-gray-600 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`,rows:3,placeholder:"Объяснение ограничения..."})]}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("input",{type:"checkbox",id:"isActive",checked:y.isActive,onChange:S=>M(E=>({...E,isActive:S.target.checked})),className:"rounded border-gray-300 text-[#4E6E49] focus:ring-[#4E6E49]"}),n.jsx("label",{htmlFor:"isActive",className:`text-sm ${e==="dark"?"text-gray-300":"text-gray-700"}`,children:"Активно"})]}),n.jsxs("div",{className:"flex gap-3 pt-4",children:[n.jsx("button",{type:"submit",disabled:c,className:"flex-1 px-4 py-2 bg-[#4E6E49] hover:bg-[#4E6E49] text-white rounded-lg transition-colors disabled:opacity-50 flex items-center justify-center gap-2",children:c?n.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-white border-t-transparent"}):n.jsxs(n.Fragment,{children:[n.jsx(gh,{className:"w-4 h-4"}),g?"Сохранить":"Добавить"]})}),n.jsx("button",{type:"button",onClick:()=>{N(),_(!1),p(null)},className:`px-4 py-2 rounded-lg border ${e==="dark"?"border-gray-600 text-gray-200 hover:bg-gray-700":"border-gray-300 text-gray-700 hover:bg-gray-100"} transition-colors`,children:"Отмена"})]})]})]}),n.jsxs("div",{className:`rounded-2xl border ${e==="dark"?"border-white/10 bg-white/5":"border-slate-200 bg-white"}`,children:[n.jsx("div",{className:"p-6 border-b border-white/10",children:n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("h4",{className:`text-lg font-semibold ${e==="dark"?"text-white":"text-gray-900"}`,children:["Активные конфликты (",a.filter(S=>S.isActive).length,")"]}),n.jsxs("button",{onClick:()=>{m(""),_(!0)},className:"px-4 py-2 bg-[#4E6E49] hover:bg-[#4E6E49] text-white rounded-lg transition-colors flex items-center gap-2",children:[n.jsx(Cr,{className:"w-4 h-4"}),"Добавить конфликт"]})]})}),n.jsx("div",{className:"p-6",children:a.length===0?n.jsxs("div",{className:"text-center py-8",children:[n.jsx(vd,{className:`w-12 h-12 mx-auto mb-4 ${e==="dark"?"text-gray-600":"text-gray-400"}`}),n.jsx("p",{className:`text-lg ${e==="dark"?"text-gray-400":"text-gray-600"}`,children:"Нет настроенных конфликтов"})]}):n.jsx("div",{className:"space-y-4",children:a.map(S=>n.jsxs("div",{className:`flex items-center justify-between p-4 rounded-xl border ${S.isActive?e==="dark"?"border-red-500/30 bg-red-500/10":"border-red-200 bg-red-50":e==="dark"?"border-gray-600 bg-gray-700/50":"border-gray-200 bg-gray-50"}`,children:[n.jsxs("div",{className:"flex-1",children:[n.jsxs("div",{className:`font-medium ${e==="dark"?"text-white":"text-gray-900"}`,children:[b(S.userId)," ↔ ",b(S.restrictedUserId)]}),S.reason&&n.jsx("div",{className:`text-sm mt-1 ${e==="dark"?"text-gray-400":"text-gray-600"}`,children:S.reason}),n.jsxs("div",{className:"text-xs mt-1 text-gray-500",children:["Создано: ",new Date(S.createdAt).toLocaleDateString("ru-RU")]})]}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("button",{onClick:()=>C(S),className:`px-3 py-1 rounded-full text-xs font-medium transition-colors ${S.isActive?"bg-red-500 text-white":e==="dark"?"bg-gray-600 text-gray-300":"bg-gray-200 text-gray-700"}`,children:S.isActive?"Активен":"Неактивен"}),n.jsx("button",{onClick:()=>R(S),className:`p-2 rounded-lg ${e==="dark"?"hover:bg-gray-700 text-gray-400":"hover:bg-gray-100 text-gray-600"} transition-colors`,children:n.jsx(ps,{className:"w-4 h-4"})}),n.jsx("button",{onClick:()=>P(S.id),className:"p-2 rounded-lg text-red-500 hover:bg-red-500 hover:text-white transition-colors",children:n.jsx(Bt,{className:"w-4 h-4"})})]})]},S.id))})})]})]})})})]})})},hf=[{value:"all",label:"Весь доступ",description:"Блокировать весь сайт"},{value:"login",label:"Вход в систему",description:"Запретить авторизацию"},{value:"slots",label:"Управление слотами",description:"Блокировать создание/редактирование слотов"},{value:"earnings",label:"Доходы",description:"Блокировать добавление доходов"},{value:"tasks",label:"Задачи",description:"Блокировать управление задачами"},{value:"rating",label:"Рейтинг",description:"Блокировать просмотр рейтинга"},{value:"profile",label:"Профиль",description:"Блокировать редактирование профиля"},{value:"admin",label:"Админ-панель",description:"Блокировать доступ к админке"}],ES=({onClose:s})=>{const{theme:e}=lt(),{user:t}=_t(),{isAdmin:r}=Ct();Ur();const[a,i]=I.useState([]),[o,l]=I.useState(!0),[c,h]=I.useState(!1),[u,m]=I.useState(""),[g,p]=I.useState(null),[j,_]=I.useState(!1),[y,M]=I.useState({userId:"",reason:"",expiresAt:"",blockFeatures:[],isActive:!0});I.useEffect(()=>{D()},[]);const D=async()=>{try{const k=await Qd();i(k)}catch(k){console.error("Error loading blocks:",k)}finally{l(!1)}},T=async k=>{if(k.preventDefault(),!t&&!r){m("Пользователь не найден (необходима авторизация)");return}h(!0),m("");try{const w={reason:y.reason,blockFeatures:y.blockFeatures,isActive:y.isActive,createdBy:(t==null?void 0:t.id)||"admin",createdAt:new Date().toISOString(),...y.userId?{userId:y.userId}:{},...y.expiresAt?{expiresAt:y.expiresAt}:{}};g?await Pl(g.id,w):await iS(w),await D(),b(),_(!1),p(null)}catch(w){console.error("Error saving block:",w),m(w.message||"Ошибка при сохранении блокировки")}finally{h(!1)}},R=k=>{p(k),M({userId:k.userId||"",reason:k.reason,expiresAt:k.expiresAt||"",blockFeatures:k.blockFeatures,isActive:k.isActive}),m(""),_(!0)},P=async k=>{if(confirm("Удалить блокировку доступа?"))try{await oS(k),await D()}catch(w){console.error("Error deleting block:",w)}},C=async k=>{try{await Pl(k.id,{isActive:!k.isActive}),await D()}catch(w){console.error("Error toggling block status:",w)}},N=k=>{M(w=>({...w,blockFeatures:w.blockFeatures.includes(k)?w.blockFeatures.filter(Q=>Q!==k):[...w.blockFeatures,k]}))},b=()=>{m(""),M({userId:"",reason:"",expiresAt:"",blockFeatures:[],isActive:!0})},v=k=>{if(!k)return"Все пользователи";const w=Re.find(Q=>Q.id===k);return(w==null?void 0:w.name)||k},S=k=>{const w=hf.find(Q=>Q.value===k);return(w==null?void 0:w.label)||k},E=k=>k?new Date(k)<new Date:!1;return o?n.jsx("div",{className:"flex items-center justify-center p-8",children:n.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-4 border-[#4E6E49] border-t-transparent"})}):n.jsx("div",{className:"fixed inset-0 bg-slate-950/75 backdrop-blur-xl flex items-start sm:items-center justify-center z-[70] p-4 overflow-y-auto touch-manipulation",children:n.jsxs("div",{className:`w-full max-w-4xl rounded-3xl shadow-[0_24px_80px_rgba(0,0,0,0.45)] border ${e==="dark"?"bg-gradient-to-br from-[#0c1320] via-[#0b1220] to-[#08111b] border-white/10":"bg-gradient-to-br from-white via-slate-50 to-white border-slate-200"} max-h-[90vh] overflow-hidden flex flex-col`,children:[n.jsx("div",{className:"p-6 border-b border-white/10",children:n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx("div",{className:"w-10 h-10 rounded-xl flex items-center justify-center bg-red-500/10 text-red-500",children:n.jsx(ph,{className:"w-5 h-5"})}),n.jsxs("div",{children:[n.jsx("h3",{className:`text-xl font-bold ${e==="dark"?"text-white":"text-gray-900"}`,children:"Управление доступом"}),n.jsx("p",{className:`text-sm ${e==="dark"?"text-gray-400":"text-gray-600"}`,children:"Блокировка доступа к функциям сайта"})]})]}),n.jsx("button",{onClick:s,className:`p-2 rounded-full border ${e==="dark"?"border-white/10 text-gray-200 hover:bg-white/5":"border-slate-200 text-slate-600 hover:bg-slate-100"} transition-colors`,children:n.jsx(Ft,{className:"w-5 h-5"})})]})}),n.jsx("div",{className:"flex-1 overflow-y-auto",children:n.jsx("div",{className:"p-6",children:n.jsxs("div",{className:"space-y-6",children:[(j||g)&&n.jsxs("div",{className:`rounded-2xl border p-6 ${e==="dark"?"border-white/10 bg-white/5":"border-slate-200 bg-slate-50"}`,children:[n.jsx("h4",{className:`text-lg font-semibold mb-4 ${e==="dark"?"text-white":"text-gray-900"}`,children:g?"Редактировать блокировку":"Добавить блокировку"}),u&&n.jsxs("div",{className:"mb-4 p-3 rounded-lg bg-red-500/10 border border-red-500/20 flex items-start gap-3",children:[n.jsx(Kl,{className:"w-5 h-5 text-red-500 shrink-0 mt-0.5"}),n.jsx("p",{className:"text-sm text-red-500",children:u})]}),n.jsxs("form",{onSubmit:T,className:"space-y-4",children:[n.jsxs("div",{children:[n.jsx("label",{className:`block text-sm font-medium mb-2 ${e==="dark"?"text-gray-300":"text-gray-700"}`,children:"Пользователь (оставьте пустым для блокировки всем)"}),n.jsxs("select",{value:y.userId,onChange:k=>M(w=>({...w,userId:k.target.value})),className:`w-full px-3 py-2 rounded-lg border ${e==="dark"?"bg-gray-700 border-gray-600 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`,children:[n.jsx("option",{value:"",children:"Все пользователи"}),Re.map(k=>n.jsx("option",{value:k.id,children:k.name},k.id))]})]}),n.jsxs("div",{children:[n.jsx("label",{className:`block text-sm font-medium mb-2 ${e==="dark"?"text-gray-300":"text-gray-700"}`,children:"Блокируемые функции"}),n.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:hf.map(k=>n.jsxs("label",{className:`flex items-start gap-3 p-3 rounded-lg border cursor-pointer transition-colors ${y.blockFeatures.includes(k.value)?e==="dark"?"border-red-500/50 bg-red-500/10":"border-red-200 bg-red-50":e==="dark"?"border-gray-600 hover:border-gray-500":"border-gray-200 hover:border-gray-300"}`,children:[n.jsx("input",{type:"checkbox",checked:y.blockFeatures.includes(k.value),onChange:()=>N(k.value),className:"mt-0.5 rounded border-gray-300 text-red-500 focus:ring-red-500"}),n.jsxs("div",{className:"flex-1",children:[n.jsx("div",{className:`font-medium text-sm ${e==="dark"?"text-white":"text-gray-900"}`,children:k.label}),n.jsx("div",{className:`text-xs ${e==="dark"?"text-gray-400":"text-gray-600"}`,children:k.description})]})]},k.value))})]}),n.jsxs("div",{children:[n.jsx("label",{className:`block text-sm font-medium mb-2 ${e==="dark"?"text-gray-300":"text-gray-700"}`,children:"Причина блокировки *"}),n.jsx("textarea",{value:y.reason,onChange:k=>M(w=>({...w,reason:k.target.value})),className:`w-full px-3 py-2 rounded-lg border resize-none ${e==="dark"?"bg-gray-700 border-gray-600 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`,rows:3,placeholder:"Объяснение блокировки...",required:!0})]}),n.jsxs("div",{children:[n.jsx("label",{className:`block text-sm font-medium mb-2 ${e==="dark"?"text-gray-300":"text-gray-700"}`,children:"Дата окончания (опционально)"}),n.jsx("input",{type:"datetime-local",value:y.expiresAt,onChange:k=>M(w=>({...w,expiresAt:k.target.value})),className:`w-full px-3 py-2 rounded-lg border ${e==="dark"?"bg-gray-700 border-gray-600 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`})]}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("input",{type:"checkbox",id:"isActive",checked:y.isActive,onChange:k=>M(w=>({...w,isActive:k.target.checked})),className:"rounded border-gray-300 text-red-500 focus:ring-red-500"}),n.jsx("label",{htmlFor:"isActive",className:`text-sm ${e==="dark"?"text-gray-300":"text-gray-700"}`,children:"Активна"})]}),n.jsxs("div",{className:"flex gap-3 pt-4",children:[n.jsx("button",{type:"submit",disabled:c||y.blockFeatures.length===0,className:"flex-1 px-4 py-2 bg-red-500 hover:bg-red-600 text-white rounded-lg transition-colors disabled:opacity-50 flex items-center justify-center gap-2",children:c?n.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-white border-t-transparent"}):n.jsxs(n.Fragment,{children:[n.jsx(gh,{className:"w-4 h-4"}),g?"Сохранить":"Заблокировать"]})}),n.jsx("button",{type:"button",onClick:()=>{b(),_(!1),p(null)},className:`px-4 py-2 rounded-lg border ${e==="dark"?"border-gray-600 text-gray-200 hover:bg-gray-700":"border-gray-300 text-gray-700 hover:bg-gray-100"} transition-colors`,children:"Отмена"})]})]})]}),n.jsxs("div",{className:`rounded-2xl border ${e==="dark"?"border-white/10 bg-white/5":"border-slate-200 bg-white"}`,children:[n.jsx("div",{className:"p-6 border-b border-white/10",children:n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("h4",{className:`text-lg font-semibold ${e==="dark"?"text-white":"text-gray-900"}`,children:["Активные блокировки (",a.filter(k=>k.isActive).length,")"]}),n.jsxs("button",{onClick:()=>{m(""),_(!0)},className:"px-4 py-2 bg-red-500 hover:bg-red-600 text-white rounded-lg transition-colors flex items-center gap-2",children:[n.jsx(Cr,{className:"w-4 h-4"}),"Добавить блокировку"]})]})}),n.jsx("div",{className:"p-6",children:a.length===0?n.jsxs("div",{className:"text-center py-8",children:[n.jsx(Ot,{className:`w-12 h-12 mx-auto mb-4 ${e==="dark"?"text-gray-600":"text-gray-400"}`}),n.jsx("p",{className:`text-lg ${e==="dark"?"text-gray-400":"text-gray-600"}`,children:"Нет активных блокировок"})]}):n.jsx("div",{className:"space-y-4",children:a.map(k=>n.jsxs("div",{className:`flex items-center justify-between p-4 rounded-xl border ${k.isActive&&!E(k.expiresAt)?e==="dark"?"border-red-500/30 bg-red-500/10":"border-red-200 bg-red-50":e==="dark"?"border-gray-600 bg-gray-700/50":"border-gray-200 bg-gray-50"}`,children:[n.jsxs("div",{className:"flex-1",children:[n.jsx("div",{className:`font-medium ${e==="dark"?"text-white":"text-gray-900"}`,children:v(k.userId)}),n.jsx("div",{className:`text-sm mt-1 ${e==="dark"?"text-gray-400":"text-gray-600"}`,children:k.reason}),n.jsxs("div",{className:"flex items-center gap-4 mt-2",children:[n.jsxs("div",{className:"text-xs text-gray-500",children:["Функции: ",k.blockFeatures.map(w=>S(w)).join(", ")]}),k.expiresAt&&n.jsxs("div",{className:`flex items-center gap-1 text-xs ${E(k.expiresAt)?"text-gray-500":"text-amber-600"}`,children:[n.jsx(Ks,{className:"w-3 h-3"}),E(k.expiresAt)?"Истекла":`До ${new Date(k.expiresAt).toLocaleString("ru-RU")}`]})]})]}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("button",{onClick:()=>C(k),className:`px-3 py-1 rounded-full text-xs font-medium transition-colors ${k.isActive&&!E(k.expiresAt)?"bg-red-500 text-white":e==="dark"?"bg-gray-600 text-gray-300":"bg-gray-200 text-gray-700"}`,children:k.isActive&&!E(k.expiresAt)?"Активна":"Неактивна"}),n.jsx("button",{onClick:()=>R(k),className:`p-2 rounded-lg ${e==="dark"?"hover:bg-gray-700 text-gray-400":"hover:bg-gray-100 text-gray-600"} transition-colors`,children:n.jsx(ps,{className:"w-4 h-4"})}),n.jsx("button",{onClick:()=>P(k.id),className:"p-2 rounded-lg text-red-500 hover:bg-red-500 hover:text-white transition-colors",children:n.jsx(Bt,{className:"w-4 h-4"})})]})]},k.id))})})]})]})})})]})})},SS=()=>{const{theme:s}=lt(),{isAdmin:e}=Ct(),[t,r]=I.useState("table"),[a]=I.useState("all"),[i,o]=I.useState(!1),[l,c]=I.useState(!1),[h,u]=I.useState(!1),[m,g]=I.useState(!1),[p,j]=I.useState(!1),[_,y]=I.useState(!1),[M,D]=I.useState(null),[T,R]=I.useState(null),[P,C]=I.useState(null),[N,b]=I.useState(null),[v,S]=I.useState(0),[E,k]=I.useState({slotsThisWeek:0,activeMembers:0,upcomingSlots:0,completedSlots:0,recommendedWeek:0,recommendedDay:0,mostActive:"",leastActive:[],remainingSlots:0,todaySlots:0}),[w,Q]=I.useState({nextStart:null,activeEnd:null}),[ae,V]=I.useState({nextStart:"—",activeRemaining:"—"});I.useEffect(()=>{ve()},[]),I.useEffect(()=>{const ge=(je,Se)=>{if(!je)return"—";const G=je.getTime()-Date.now();if(G<=0)return Se?"Слот завершён":"Уже начался";const xe=Math.floor(G/6e4),z=Math.floor(xe/(60*24)),ce=Math.floor(xe%(60*24)/60),ke=xe%60;return z>0?`${z}д ${ce}ч`:ce>0?`${ce}ч ${ke}м`:`${Math.max(ke,1)}м`},H=()=>{V({nextStart:ge(w.nextStart,!1),activeRemaining:ge(w.activeEnd,!0)})};H();const se=setInterval(H,6e4);return()=>clearInterval(se)},[w]);const X=ge=>{const H=Vs(),se=new Date(H);se.setHours(0,0,0,0);const je=new Date(ge.date);if(je.setHours(0,0,0,0),je>se)return!0;if(je.getTime()===se.getTime()){const z=Vs(),ce=z.getHours()*60+z.getMinutes();return ge.slots.some(ke=>{if(ke.endDate){const U=new Date(ke.endDate);if(U.setHours(0,0,0,0),U>se)return!0;if(U.getTime()===se.getTime()){const[_e,Pe]=ke.end.split(":").map(Number);return _e*60+Pe>ce}return!1}const[ue,$e]=ke.end.split(":").map(Number);return ue*60+$e>ce})}const Se=Vs(),G=Se.getHours()*60+Se.getMinutes();return ge.slots.some(z=>{if(z.endDate){const ce=new Date(z.endDate);if(ce.setHours(0,0,0,0),ce>se)return!0;if(ce.getTime()===se.getTime()){const[ke,ue]=z.end.split(":").map(Number);return ke*60+ue>G}return!1}return!1})},he={1:"Dex",2:"Enowk",3:"Xenia",4:"Olenka",5:"Sydney"},B={artyom:"1",adel:"2",kseniya:"3",olga:"4",anastasia:"5"},te=ge=>{const H=Re.find(se=>se.id===ge)||Re.find(se=>B[ge]===se.id);return he[(H==null?void 0:H.id)||ge]||(H==null?void 0:H.name)||ge},ve=async()=>{var ge,H;try{const se=new Date,je=fu(se),Se=oe(je[0],"yyyy-MM-dd"),G=oe(je[6],"yyyy-MM-dd"),xe=oe(se,"yyyy-MM-dd"),[z,ce]=await Promise.all([Is(),Ar()]),ke=z.filter(Ve=>Ve.date>=Se&&Ve.date<=G),ue=z.filter(Ve=>Ve.date===xe),$e=new Set([...ke.flatMap(Ve=>[Ve.userId,...Ve.participants||[]]),...ce.map(Ve=>Ve.userId)]),Oe=ke.filter(X).length,U=ke.length-Oe,_e=Math.max(0,15-ke.length),Pe=Math.max(0,3-ue.length),K={};Re.forEach(Ve=>{K[Ve.id]=0}),ke.forEach(Ve=>{new Set([Ve.userId,...Ve.participants||[]]).forEach(ct=>{K[ct]!==void 0&&(K[ct]=(K[ct]||0)+1)})});const q=Object.entries(K).sort((Ve,wt)=>wt[1]-Ve[1]),Ce=(ge=q[0])!=null&&ge[1]?te(q[0][0]):"Нет данных",Le=Math.min(...Object.values(K)),Ue=Object.entries(K).filter(([,Ve])=>Ve===Le).map(([Ve])=>te(Ve)).slice(0,3),ye=z.flatMap(Ve=>{const wt=Ve.date;return(Ve.slots||[]).map(ct=>{const Cs=new Date(`${wt}T${ct.start}`);let Yt=ct.endDate?new Date(`${ct.endDate}T${ct.end}`):new Date(`${wt}T${ct.end}`);if(!ct.endDate&&Yt.getTime()<=Cs.getTime()){const ie=new Date(wt);ie.setDate(ie.getDate()+1),Yt=new Date(`${oe(ie,"yyyy-MM-dd")}T${ct.end}`)}return{start:Cs,end:Yt}})}),mt=ye.filter(Ve=>se>=Ve.start&&se<=Ve.end),qe=mt.length?new Date(Math.min(...mt.map(Ve=>Ve.end.getTime()))):null,Te=((H=ye.filter(Ve=>Ve.start>se).sort((Ve,wt)=>Ve.start.getTime()-wt.start.getTime())[0])==null?void 0:H.start)||null;k({slotsThisWeek:ke.length,activeMembers:$e.size,upcomingSlots:Oe,completedSlots:U,recommendedWeek:_e,recommendedDay:Pe,mostActive:Ce,leastActive:Ue,remainingSlots:Oe,todaySlots:ue.length}),Q({nextStart:Te,activeEnd:qe})}catch(se){console.error("Error loading stats:",se)}},W=()=>{C(null),o(!0)},F=ge=>{C(ge),o(!0)},re=()=>{D(null),b(null),u(!0)},de=ge=>{b(ge),D(ge.type),u(!0)},$=()=>{c(!0)},O=()=>{g(!0)},J=()=>{j(!0)},Y=()=>{y(!0)},Z=()=>{o(!1),c(!1),u(!1),g(!1),j(!1),y(!1),D(null),C(null),b(null),ve(),S(ge=>ge+1)},L=ge=>{r(ge)},fe=[{label:"Сколько ещё добавить слотов",value:`${Math.max(E.recommendedDay,0)} в день`,note:`Неделя: ${Math.max(E.recommendedWeek,0)} до цели 15`,icon:n.jsx(Js,{className:"w-5 h-5 text-emerald-400"}),tone:"emerald",bgClass:"bg-emerald-500/5",borderClass:"border-emerald-500/20"},{label:"Сколько осталось слотов",value:E.remainingSlots,note:"предстоящие",icon:n.jsx(Kv,{className:"w-5 h-5 text-blue-400"}),tone:"blue",bgClass:"bg-blue-500/5",borderClass:"border-blue-500/20"},{label:"Активные члены",value:E.activeMembers,note:"за неделю",icon:n.jsx(qn,{className:"w-5 h-5 text-purple-400"}),tone:"purple",bgClass:"bg-purple-500/5",borderClass:"border-purple-500/20"},{label:"Завершено слотов на неделе",value:E.completedSlots,note:"факт",icon:n.jsx(pd,{className:"w-5 h-5 text-emerald-400"}),tone:"emerald",bgClass:"bg-emerald-500/5",borderClass:"border-emerald-500/20"},{label:"Таймер ближайшего слота",value:ae.nextStart,note:"до старта",icon:n.jsx(xh,{className:"w-5 h-5 text-sky-400"}),tone:"sky",bgClass:"bg-sky-500/5",borderClass:"border-sky-500/20"},{label:"До окончания активного слота",value:ae.activeRemaining,note:"если слот идёт",icon:n.jsx(Ks,{className:"w-5 h-5 text-pink-400"}),tone:"pink",bgClass:"bg-pink-500/5",borderClass:"border-pink-500/20"},{label:"Самый активный член недели",value:E.mostActive||"Нет данных",note:"по слотам",icon:n.jsx(hh,{className:"w-5 h-5 text-amber-400"}),tone:"amber",bgClass:"bg-amber-500/5",borderClass:"border-amber-500/20"},{label:"Самые неактивные члены недели",value:E.leastActive.length?E.leastActive.join(", "):"Нет данных",note:"минимум слотов",icon:n.jsx($v,{className:"w-5 h-5 text-slate-400"}),tone:"slate",bgClass:"bg-slate-500/5",borderClass:"border-slate-500/20"}];return n.jsxs("div",{className:"space-y-6",children:[n.jsxs("div",{className:"space-y-6",children:[n.jsx("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:n.jsxs("div",{className:"flex items-center gap-4",children:[n.jsx("div",{className:"p-3 bg-emerald-500/10 rounded-2xl border border-emerald-500/20",children:n.jsx(pd,{className:"w-8 h-8 text-emerald-500"})}),n.jsxs("div",{children:[n.jsx("h1",{className:`text-2xl md:text-3xl font-black tracking-tight ${s==="dark"?"text-white":"text-gray-900"}`,children:"AVF Schedule"}),n.jsx("p",{className:`text-sm font-medium ${s==="dark"?"text-gray-400":"text-gray-500"}`,children:"Управление сменами и активностью ApeVault Frontier"})]})]})}),n.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:fe.map((ge,H)=>n.jsxs("div",{className:`relative overflow-hidden rounded-2xl p-5 border transition-all duration-300 hover:shadow-lg group ${s==="dark"?`${ge.bgClass} ${ge.borderClass} hover:border-opacity-50`:"bg-white border-gray-100 hover:border-emerald-500/20"}`,children:[n.jsxs("div",{className:"flex justify-between items-start mb-4",children:[n.jsx("span",{className:`text-[10px] font-bold uppercase tracking-wider ${s==="dark"?"text-gray-400":"text-gray-500"}`,children:ge.label}),n.jsx("div",{className:`p-2 rounded-xl transition-colors ${s==="dark"?"bg-white/5 group-hover:bg-white/10":"bg-gray-100 group-hover:bg-gray-200"}`,children:ge.icon})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx("div",{className:`text-2xl font-black tracking-tight ${s==="dark"?"text-white":"text-gray-900"}`,children:ge.value}),n.jsx("div",{className:"text-[11px] font-medium text-gray-500",children:ge.note})]})]},H))})]}),n.jsx("div",{className:`sticky top-4 z-40 p-2 rounded-2xl border shadow-xl backdrop-blur-xl ${s==="dark"?"bg-[#0b1015]/80 border-white/10":"bg-white/80 border-gray-200"}`,children:n.jsxs("div",{className:"flex flex-col lg:flex-row items-center justify-between gap-4 p-2",children:[n.jsxs("div",{className:`flex items-center gap-1 p-1 rounded-xl border ${s==="dark"?"bg-[#151a21] border-white/5":"bg-gray-50 border-gray-200"}`,children:[n.jsxs("button",{onClick:()=>L("table"),className:`flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-bold transition-all ${t==="table"?"bg-[#2A3441] text-white shadow-lg ring-1 ring-white/10":"text-gray-400 hover:text-gray-200"}`,children:[n.jsx(dw,{className:"w-4 h-4"}),n.jsx("span",{children:"Таблица"})]}),n.jsxs("button",{onClick:()=>L("week"),className:`flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-bold transition-all ${t==="week"?"bg-[#4E6E49] text-white shadow-lg shadow-emerald-900/20":"text-gray-400 hover:text-gray-200"}`,children:[n.jsx(Fr,{className:"w-4 h-4"}),n.jsx("span",{children:"Неделя"})]})]}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsxs("button",{onClick:W,className:"flex items-center gap-2 px-6 py-2.5 rounded-xl bg-emerald-500 hover:bg-emerald-600 text-white font-bold text-sm transition-all shadow-lg shadow-emerald-500/20 hover:scale-105 active:scale-95",children:[n.jsx(zp,{className:"w-4 h-4"}),n.jsx("span",{children:"Добавить слот"})]}),n.jsxs("button",{onClick:re,className:`flex items-center gap-2 px-4 py-2.5 rounded-xl border font-bold text-sm transition-all hover:scale-105 active:scale-95 ${s==="dark"?"border-white/10 bg-white/5 text-gray-300 hover:bg-white/10 hover:text-white":"border-gray-200 bg-gray-50 text-gray-600 hover:bg-gray-100"}`,children:[n.jsx(vd,{className:"w-4 h-4"}),n.jsx("span",{className:"hidden sm:inline",children:"Отсутствие"})]}),n.jsx("button",{onClick:$,className:"p-2.5 rounded-xl border border-rose-500/20 bg-rose-500/10 text-rose-500 hover:bg-rose-500/20 transition-all",title:"Очистить",children:n.jsx(Bt,{className:"w-5 h-5"})})]}),n.jsx("div",{className:"flex items-center gap-2 w-full lg:w-72",children:n.jsx(yS,{selectedUserId:T,onSelect:R})}),e&&n.jsx("div",{className:"flex gap-1",children:[{icon:n.jsx(Ot,{className:"w-4 h-4"}),action:O,title:"Ограничения"},{icon:n.jsx(Ot,{className:"w-4 h-4"}),action:J,title:"Конфликты"},{icon:n.jsx(ph,{className:"w-4 h-4"}),action:Y,title:"Блокировки"}].map((ge,H)=>n.jsx("button",{onClick:ge.action,title:ge.title,className:`p-2.5 rounded-xl border ${s==="dark"?"border-white/10 bg-white/5 text-gray-400 hover:text-white":"border-gray-200 text-gray-500"}`,children:ge.icon},H))})]})}),n.jsx("div",{className:`rounded-2xl border overflow-hidden ${s==="dark"?"bg-[#0b1015] border-white/5":"bg-white border-gray-200"}`,children:n.jsx("div",{className:"p-0",children:t==="table"?n.jsx(xS,{selectedUserId:T,slotFilter:a,refreshKey:v,onEditSlot:F,onEditStatus:de}):n.jsx(bS,{selectedUserId:T,slotFilter:a,refreshKey:v,onEditSlot:F,onEditStatus:de})})}),i&&n.jsx(wS,{slot:P,onClose:Z,onSave:Z}),l&&n.jsx(_S,{onClose:Z,onSave:Z}),h&&n.jsx(kS,{type:M||void 0,status:N,onClose:Z,onSave:Z}),m&&n.jsx(NS,{onClose:Z,onSave:Z}),p&&n.jsx(jS,{onClose:()=>j(!1)}),_&&n.jsx(ES,{onClose:()=>y(!1)})]})},ti=.45,TS=({onClose:s,onSave:e,editingEarning:t})=>{var Y,Z;const{user:r}=_t(),{isAdmin:a}=Ct(),{theme:i}=lt(),o=i==="dark"?"text-white":"text-gray-900",l=!!t,[c,h]=I.useState((t==null?void 0:t.date)||oe(new Date,"yyyy-MM-dd")),[u,m]=I.useState((t==null?void 0:t.slotId)||""),[g,p]=I.useState((t==null?void 0:t.amount.toString())||""),[j,_]=I.useState(((Y=t==null?void 0:t.extraWalletsCount)==null?void 0:Y.toString())||""),[y,M]=I.useState(((Z=t==null?void 0:t.extraWalletsAmount)==null?void 0:Z.toString())||""),[D,T]=I.useState((t==null?void 0:t.category)||"memecoins"),[R,P]=I.useState(t?t.participants.length>1:!1),[C,N]=I.useState(t?t.participants.filter(L=>L!==t.userId):[]),[b,v]=I.useState([]),[S,E]=I.useState([]),[k,w]=I.useState(""),[Q,ae]=I.useState(!1);Ur();const V=(L,fe="w-4 h-4")=>{switch(L){case"memecoins":return n.jsx(Xi,{className:fe});case"futures":return n.jsx(Ql,{className:fe});case"nft":return n.jsx(Yl,{className:fe});case"spot":return n.jsx(fs,{className:fe});case"polymarket":return n.jsx(uh,{className:fe});case"staking":return n.jsx(Ji,{className:fe});default:return n.jsx(xs,{className:fe})}},X=()=>{var L;return l&&t?(L=t.participants)!=null&&L.length?t.participants:[t.userId]:a&&!r?C:r?R?Array.from(new Set([r.id,...C])):[r.id]:[]},he=X(),B=he.length,te=B||1,ve=L=>{const fe=parseFloat(L.replace(",","."));return Number.isFinite(fe)?fe:0},W=I.useMemo(()=>{const L=ve(g),fe=ve(y),ge=Math.max(L+fe,0),H=ge>0?parseFloat((ge*ti).toFixed(2)):0,se=Math.max(ge-H,0),je=te>0?parseFloat((se/te).toFixed(2)):0;return{gross:ge,pool:H,net:se,share:je}},[g,y,te]);I.useEffect(()=>{F()},[c,r,l]);const F=async()=>{if(!(!a&&!r&&!l))try{const L=l||a?await Is(void 0,c):await Is(r.id,c),fe=Vs(),ge=oe(fe,"yyyy-MM-dd"),H=l?L:L.filter(se=>{if(c!==ge)return a;const je=se.slots[se.slots.length-1];return Zg(je.end,fe)||a});v(H)}catch(L){console.error("Error loading slots:",L)}},re=L=>{C.includes(L)?N(C.filter(fe=>fe!==L)):N([...C,L])},de=()=>{const L=ve(g),fe=ve(y),ge=parseInt(j||"0",10);if(!L&&!fe)return w("Укажите сумму заработка (основную или по доп. кошелькам)"),null;if(L<0||fe<0)return w("Суммы не могут быть отрицательными"),null;if(!D)return w("Выберите сферу заработка"),null;const H=X();if(H.length===0)return w("Выберите хотя бы одного участника"),null;const se=L+fe;return{id:crypto.randomUUID?crypto.randomUUID():`${Date.now()}-${Math.random()}`,category:D,amount:se,extraWalletsAmount:fe,extraWalletsCount:Number.isFinite(ge)?ge:0,participants:H}},$=()=>{w("");const L=de();L&&(E([...S,L]),p(""),M(""),_(""),N([]),P(!1))},O=L=>{E(fe=>fe.filter(ge=>ge.id!==L))},J=async()=>{if(!a&&!r&&!l){w("Пользователь не найден");return}w(""),ae(!0);try{if(!u){w("Выберите слот"),ae(!1);return}const L=b.find(H=>H.id===u);if(!L&&!l){w("Выбранный слот не найден"),ae(!1);return}if(!a&&!l){const H=Vs(),se=oe(H,"yyyy-MM-dd");if(c!==se){w("Можно добавить заработок только за сегодня"),ae(!1);return}if(L){const je=L.slots[L.slots.length-1];if(!Zg(je.end,H)){w("Слот еще идет или еще не начат. Можно добавить заработок после 21:00 МСК или после окончания слота"),ae(!1);return}}}const fe=H=>({userId:H.userId,date:c,amount:H.amount,poolAmount:H.poolAmount,slotId:u,category:H.category,participants:H.participants,extraWalletsAmount:H.extraWalletsAmount,extraWalletsCount:H.extraWalletsCount}),ge=async(H,se,je)=>{a?se==="update"&&t?await kb(t.id,H):await wb(H):await It({entity:"earning",action:se,authorId:(r==null?void 0:r.id)||H.userId,targetUserId:H.userId,before:je||null,after:{id:(t==null?void 0:t.id)||"",...H}})};if(l&&t){const H=de();if(!H){ae(!1);return}await ge(fe({userId:t.userId,amount:H.amount,poolAmount:parseFloat((H.amount*ti).toFixed(2)),category:H.category,participants:H.participants,extraWalletsAmount:H.extraWalletsAmount,extraWalletsCount:H.extraWalletsCount}),"update",t)}else{let H=S;if(H.length===0){const se=de();if(!se){ae(!1);return}H=[se]}for(const se of H)await ge(fe({userId:se.participants[0],amount:se.amount,poolAmount:parseFloat((se.amount*ti).toFixed(2)),category:se.category,participants:se.participants,extraWalletsAmount:se.extraWalletsAmount,extraWalletsCount:se.extraWalletsCount}),"create")}e()}catch(L){console.error("Error saving earnings:",L);const fe=L.message||L.code||"Ошибка при сохранении";w(fe)}finally{ae(!1)}};return n.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-start sm:items-center justify-center z-[70] p-4 sm:p-6 touch-manipulation overflow-y-auto overflow-x-hidden overscroll-contain modal-scroll",children:n.jsxs("div",{className:`w-full max-w-[540px] sm:max-w-3xl rounded-2xl sm:rounded-3xl shadow-xl ${i==="dark"?"bg-[#1a1a1a]":"bg-white"} max-h-[85dvh] sm:max-h-[calc(100dvh-96px)] flex flex-col overflow-hidden`,children:[n.jsx("div",{className:"flex-shrink-0 p-4 sm:p-6",children:n.jsxs("div",{className:"flex items-center justify-between mb-4 sm:mb-6",children:[n.jsx("h3",{className:`text-lg sm:text-xl font-bold ${o} pr-2`,children:l?"Редактировать заработок":"Добавить заработок"}),n.jsx("button",{onClick:s,className:`p-1.5 sm:p-2 rounded-lg flex-shrink-0 ${i==="dark"?"hover:bg-gray-700 active:bg-gray-600 text-gray-200":"hover:bg-gray-100 active:bg-gray-200 text-gray-700"} transition-colors touch-manipulation`,"aria-label":"Закрыть",children:n.jsx(Ft,{className:"w-4 h-4 sm:w-5 sm:h-5"})})]})}),n.jsx("div",{className:"flex-1 min-h-0 overflow-y-auto overflow-x-hidden overscroll-contain modal-scroll px-4 sm:px-6",children:n.jsxs("div",{className:"space-y-3 sm:space-y-4 pb-8 min-w-0",children:[n.jsxs("div",{children:[n.jsxs("label",{className:`flex flex-col sm:flex-row sm:items-center sm:justify-between text-xs sm:text-sm font-medium mb-2 gap-1 sm:gap-2 ${i==="dark"?"text-gray-300":"text-gray-700"}`,children:[n.jsx("span",{children:"Дата"}),!a&&!l&&n.jsx("span",{className:"text-[10px] sm:text-xs text-gray-400 whitespace-nowrap",children:"Доступна только текущая дата"})]}),n.jsx("input",{type:"date",value:c,onChange:L=>h(L.target.value),disabled:!a&&!l,className:`w-full px-3 sm:px-4 py-2 sm:py-2.5 text-sm sm:text-base rounded-lg border touch-manipulation ${i==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49] disabled:opacity-50 disabled:cursor-not-allowed`}),l&&!a&&n.jsx("p",{className:`mt-1 text-xs ${i==="dark"?"text-gray-400":"text-gray-500"}`,children:"Только администратор может изменить дату"})]}),n.jsxs("div",{children:[n.jsx("label",{className:`block text-xs sm:text-sm font-medium mb-2 ${i==="dark"?"text-gray-300":"text-gray-700"}`,children:"Слот"}),n.jsxs("select",{value:u,onChange:L=>m(L.target.value),className:`w-full px-3 sm:px-4 py-2 sm:py-2.5 text-sm sm:text-base rounded-lg border touch-manipulation ${i==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`,children:[n.jsx("option",{value:"",children:"Выберите слот"}),b.map(L=>n.jsx("option",{value:L.id,children:L.slots.map(fe=>`${fe.start}-${fe.end}`).join(", ")},L.id)),l&&t&&!b.find(L=>L.id===t.slotId)&&n.jsx("option",{value:t.slotId,disabled:!0,children:"[Текущий слот - не найден]"})]}),l&&t&&!b.find(L=>L.id===t.slotId)&&n.jsx("p",{className:`mt-1 text-xs ${i==="dark"?"text-gray-400":"text-gray-500"}`,children:"Текущий слот не найден в списке. Выберите другой слот или оставьте текущий."})]}),n.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[n.jsxs("div",{children:[n.jsx("label",{className:`block text-xs sm:text-sm font-medium mb-2 ${i==="dark"?"text-gray-300":"text-gray-700"}`,children:"Сумма заработка (руб.)"}),n.jsx("input",{type:"number",value:g,onChange:L=>p(L.target.value),className:`w-full px-3 sm:px-4 py-2 sm:py-2.5 text-sm sm:text-base rounded-lg border touch-manipulation ${i==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`,placeholder:"0",min:"0",step:"100"})]}),n.jsxs("div",{className:"space-y-2",children:[n.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[n.jsxs("div",{children:[n.jsx("label",{className:`block text-xs sm:text-sm font-medium mb-2 ${i==="dark"?"text-gray-300":"text-gray-700"}`,children:"Кол-во доп. кошельков"}),n.jsx("input",{type:"number",value:j,onChange:L=>_(L.target.value),className:`w-full px-3 sm:px-4 py-2 sm:py-2.5 text-sm sm:text-base rounded-lg border touch-manipulation ${i==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`,placeholder:"0",min:"0",step:"1"})]}),n.jsxs("div",{children:[n.jsx("label",{className:`block text-xs sm:text-sm font-medium mb-2 ${i==="dark"?"text-gray-300":"text-gray-700"}`,children:"Доп. кошельки (руб.)"}),n.jsx("input",{type:"number",value:y,onChange:L=>M(L.target.value),className:`w-full px-3 sm:px-4 py-2 sm:py-2.5 text-sm sm:text-base rounded-lg border touch-manipulation ${i==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`,placeholder:"0",min:"0",step:"100"})]})]}),n.jsx("div",{className:"space-y-1 text-[11px] text-gray-500",children:n.jsx("p",{children:"Общая сумма = основная + доп. кошельки. Пул 45% считается с общей суммы."})})]})]}),n.jsxs("div",{className:"space-y-2",children:[n.jsxs("div",{className:"flex items-center justify-between gap-2",children:[n.jsx("label",{className:`text-xs sm:text-sm font-medium ${i==="dark"?"text-gray-300":"text-gray-700"}`,children:"Сфера заработка"}),n.jsx("span",{className:"text-[10px] sm:text-xs text-gray-400",children:"Влияет на статистику"})]}),n.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-2",children:Object.entries(_r).map(([L,fe])=>n.jsxs("button",{type:"button",onClick:()=>T(L),className:`flex items-center gap-2 px-3 py-2 rounded-lg border text-left transition-all ${D===L?"border-[#4E6E49] bg-[#4E6E49]/10 text-[#4E6E49]":i==="dark"?"border-gray-800 bg-gray-800/60 text-gray-200 hover:border-[#4E6E49]/40":"border-gray-200 bg-white text-gray-800 hover:border-[#4E6E49]/40"}`,children:[n.jsx("span",{className:"p-1.5 rounded-lg bg-gray-100 dark:bg-gray-800/80",children:V(L,"w-4 h-4")}),n.jsxs("div",{className:"flex flex-col leading-tight",children:[n.jsx("span",{className:"text-sm font-semibold",children:fe.label}),n.jsx("span",{className:"text-[11px] text-gray-500",children:"45% пул / 55% чистыми"})]})]},L))})]}),n.jsxs(n.Fragment,{children:[n.jsxs("label",{className:"flex items-center gap-2",children:[n.jsx("input",{type:"checkbox",checked:R,onChange:L=>P(L.target.checked),className:"w-4 h-4"}),n.jsx("span",{className:`${i==="dark"?"text-gray-300":"text-gray-700"}`,children:"Отметить несколько участников"})]}),(R||a&&!r)&&n.jsx("div",{className:"ml-0 sm:ml-2 grid grid-cols-2 sm:grid-cols-3 gap-2",children:Re.filter(L=>!r||L.id!==r.id).map(L=>n.jsxs("label",{className:"flex items-center gap-2 rounded-lg px-2 py-1 border border-gray-200 dark:border-gray-800",children:[n.jsx("input",{type:"checkbox",checked:C.includes(L.id),onChange:()=>re(L.id),className:"w-4 h-4"}),n.jsx("span",{className:i==="dark"?"text-gray-300":"text-gray-700",children:Tt(L.id)})]},L.id))})]}),n.jsxs("div",{className:`p-4 rounded-xl border ${i==="dark"?"border-gray-800 bg-gray-900/60":"border-gray-200 bg-gray-50"}`,children:[n.jsxs("div",{className:"flex items-center justify-between gap-2 mb-3",children:[n.jsxs("div",{children:[n.jsx("p",{className:`text-xs font-semibold ${i==="dark"?"text-gray-200":"text-gray-800"}`,children:"Авторасчет"}),n.jsx("p",{className:"text-[11px] text-gray-500",children:"Пул 45% + деление между участниками"})]}),n.jsxs("span",{className:"text-[11px] px-2 py-1 rounded-full bg-[#4E6E49]/10 text-[#4E6E49] font-semibold",children:[B||0," участн."]})]}),n.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-2 mb-3",children:[n.jsxs("div",{className:`p-3 rounded-lg ${i==="dark"?"bg-gray-800/70":"bg-white"}`,children:[n.jsx("p",{className:"text-[11px] text-gray-500",children:"Пул (45%)"}),n.jsxs("p",{className:"text-lg font-bold text-purple-500",children:[W.pool.toFixed(2)," ₽"]})]}),n.jsxs("div",{className:`p-3 rounded-lg ${i==="dark"?"bg-gray-800/70":"bg-white"}`,children:[n.jsx("p",{className:"text-[11px] text-gray-500",children:"Чистыми после пула"}),n.jsxs("p",{className:"text-lg font-bold text-emerald-500",children:[W.net.toFixed(2)," ₽"]})]}),n.jsxs("div",{className:`p-3 rounded-lg ${i==="dark"?"bg-gray-800/70":"bg-white"}`,children:[n.jsx("p",{className:"text-[11px] text-gray-500",children:"На каждого"}),n.jsxs("p",{className:"text-lg font-bold text-[#4E6E49]",children:[W.share.toFixed(2)," ₽"]})]})]}),n.jsxs("div",{className:`text-xs ${i==="dark"?"text-gray-400":"text-gray-600"} mb-1`,children:["Отмеченные участники получат по ",W.share.toFixed(2)," ₽"]}),n.jsx("div",{className:"flex flex-wrap gap-2",children:he.length===0?n.jsx("span",{className:"text-xs text-gray-400",children:"Нет выбранных участников"}):he.map(L=>n.jsx("span",{className:`px-2.5 py-1 rounded-full text-xs font-semibold border ${i==="dark"?"border-gray-800 bg-gray-800/70 text-gray-100":"border-gray-200 bg-white text-gray-800"}`,children:Tt(L)},L))})]}),!l&&S.length>0&&n.jsxs("div",{className:`rounded-xl border ${i==="dark"?"border-gray-800 bg-gray-900/70":"border-gray-200 bg-gray-50"} p-3 sm:p-4 space-y-3`,children:[n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsx("p",{className:`text-sm font-semibold ${i==="dark"?"text-gray-200":"text-gray-800"}`,children:"Добавленные записи"}),n.jsxs("span",{className:"text-xs text-gray-500",children:[S.length," шт."]})]}),n.jsx("div",{className:"space-y-2 max-h-64 overflow-y-auto pr-1",children:S.map(L=>n.jsxs("div",{className:`flex flex-col sm:flex-row sm:items-center justify-between gap-3 p-3 rounded-lg border ${i==="dark"?"border-gray-800 bg-gray-800/60":"border-gray-200 bg-white"}`,children:[n.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[n.jsx("div",{className:"p-2 rounded-lg bg-gray-100 dark:bg-gray-900/70",children:V(L.category,"w-4 h-4")}),n.jsxs("div",{className:"min-w-0",children:[n.jsxs("p",{className:"text-sm font-semibold flex items-center gap-2",children:[_r[L.category].label,n.jsxs("span",{className:"text-[11px] text-gray-500",children:["(",L.participants.length," уч.)"]})]}),n.jsxs("p",{className:"text-xs text-gray-500 whitespace-normal break-words",children:["Гросс ",L.amount.toFixed(0)," ₽ • Пул ",(L.amount*ti).toFixed(0)," ₽ • Чистыми ",(L.amount-L.amount*ti).toFixed(0)," ₽"]}),L.extraWalletsAmount>0&&n.jsxs("p",{className:"text-[11px] text-gray-500",children:["Доп. кошельки: ",L.extraWalletsCount," на ",L.extraWalletsAmount.toFixed(0)," ₽"]})]})]}),n.jsx("button",{type:"button",onClick:()=>O(L.id),className:`self-start sm:self-center p-2 rounded-lg ${i==="dark"?"hover:bg-gray-700 text-red-400":"hover:bg-gray-100 text-red-600"}`,"aria-label":"Удалить запись",children:n.jsx(Bt,{className:"w-4 h-4"})})]},L.id))})]}),k&&n.jsx("div",{className:"p-3 bg-red-500 text-white rounded-lg text-sm",children:k}),n.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 sm:gap-3 pt-2",children:[!l&&n.jsxs("button",{type:"button",onClick:$,disabled:Q,className:"flex-1 sm:flex-none sm:px-4 px-4 py-2.5 sm:py-2 border border-[#4E6E49] text-[#4E6E49] rounded-lg sm:rounded-xl font-medium flex items-center justify-center gap-2 hover:bg-[#4E6E49]/10 active:scale-95 transition-colors",children:[n.jsx(zp,{className:"w-4 h-4"}),"Добавить в список"]}),n.jsx("button",{onClick:J,disabled:Q,className:"flex-1 px-4 py-2.5 sm:py-2 bg-[#4E6E49] hover:bg-[#4E6E49] disabled:bg-gray-400 disabled:cursor-not-allowed text-white rounded-lg sm:rounded-xl transition-colors text-sm sm:text-base font-medium touch-manipulation active:scale-95 disabled:active:scale-100",children:Q?"Сохранение...":l?"Сохранить":"Сохранить все"}),n.jsx("button",{type:"button",onClick:s,className:`flex-1 px-4 py-2.5 sm:py-2 rounded-lg sm:rounded-xl border text-sm sm:text-base font-medium transition-colors touch-manipulation active:scale-95 ${i==="dark"?"border-gray-700 text-gray-200 hover:bg-gray-800":"border-gray-300 text-gray-800 hover:bg-gray-100"}`,children:"Отмена"})]})]})})]})})},IS=({earnings:s})=>{const{theme:e}=lt(),t=.45,r=Hn(),a=oe(r.start,"yyyy-MM-dd"),i=oe(r.end,"yyyy-MM-dd"),o=oe(new Date(new Date().getFullYear(),new Date().getMonth(),1),"yyyy-MM-dd"),l=oe(new Date(new Date().getFullYear(),new Date().getMonth()+1,0),"yyyy-MM-dd"),c=(m,g,p)=>{const j=s.filter(D=>(D.participants&&D.participants.length>0?[...D.participants,D.userId]:[D.userId]).includes(m)&&D.date>=g&&D.date<=p),_=j.reduce((D,T)=>{const R=T.participants&&T.participants.length>0?T.participants.length:1,P=T.poolAmount||T.amount*t,C=Math.max(T.amount-P,0);return D+C/R},0),y=j.reduce((D,T)=>{const R=T.participants&&T.participants.length>0?T.participants.length:1,P=T.poolAmount||T.amount*t;return D+P/R},0),M=Array.from(new Set(j.map(D=>D.category))).filter(D=>D!=="other");return{totalEarnings:_,totalPool:y,count:j.length,categories:M}},h=Re.map(m=>{const g=c(m.id,o,l),p=c(m.id,a,i);return{...m,...g,weeklyNet:p.totalEarnings}}).sort((m,g)=>g.totalEarnings-m.totalEarnings),u=5e4;return n.jsx("div",{className:`overflow-hidden rounded-3xl border shadow-2xl ${e==="dark"?"bg-[#0b1015] border-white/5":"bg-white border-gray-100"}`,children:n.jsxs("table",{className:"w-full text-left border-collapse",children:[n.jsx("thead",{children:n.jsxs("tr",{className:e==="dark"?"bg-white/5":"bg-gray-50",children:[n.jsx("th",{className:"px-6 py-5 text-[10px] font-black uppercase tracking-widest text-gray-500",children:"Ранг"}),n.jsx("th",{className:"px-6 py-5 text-[10px] font-black uppercase tracking-widest text-gray-500",children:"Участник"}),n.jsx("th",{className:"px-6 py-5 text-[10px] font-black uppercase tracking-widest text-gray-500",children:"Сферы"}),n.jsx("th",{className:"px-6 py-5 text-[10px] font-black uppercase tracking-widest text-gray-500 text-right",children:"Сумма пула"}),n.jsx("th",{className:"px-6 py-5 text-[10px] font-black uppercase tracking-widest text-gray-500 text-right",children:"Чистые средства"}),n.jsx("th",{className:"px-6 py-5 text-[10px] font-black uppercase tracking-widest text-gray-500 text-right",children:"KPI"})]})}),n.jsx("tbody",{className:"divide-y divide-white/5",children:h.map((m,g)=>{const p=m.weeklyNet/u*100,j=g===0?"text-amber-500":g===1?"text-gray-400":g===2?"text-orange-500":"text-gray-600",_=m.avatar;return n.jsxs("tr",{className:`group transition-all duration-300 ${e==="dark"?"hover:bg-white/[0.02]":"hover:bg-gray-50"}`,children:[n.jsx("td",{className:"px-6 py-5",children:n.jsxs("span",{className:`text-sm font-black ${j}`,children:["#",g+1]})}),n.jsx("td",{className:"px-6 py-5",children:n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsxs("div",{className:"relative",children:[_?n.jsx("img",{src:_,alt:"",className:"w-9 h-9 rounded-full object-cover ring-2 ring-white/5"}):n.jsx("div",{className:"w-9 h-9 rounded-full bg-emerald-500/20 flex items-center justify-center text-sm font-black text-emerald-500",children:m.name[0]}),n.jsx("div",{className:"absolute -bottom-1 -right-1 w-3 h-3 bg-emerald-500 border-2 border-[#0b1015] rounded-full"})]}),n.jsxs("div",{children:[n.jsx("p",{className:`text-sm font-black ${e==="dark"?"text-white":"text-gray-900"}`,children:Tt(m.id)}),n.jsx("p",{className:"text-[10px] font-bold text-gray-500 uppercase tracking-widest",children:"Frontier Team"})]})]})}),n.jsx("td",{className:"px-6 py-5",children:n.jsx("div",{className:"flex flex-wrap gap-1.5",children:m.categories.length>0?m.categories.map(y=>{var M;return n.jsx("span",{className:`px-2 py-0.5 rounded-md text-[9px] font-black uppercase tracking-tight border ${e==="dark"?"bg-white/5 border-white/10 text-gray-400":"bg-gray-100 border-gray-200 text-gray-600"}`,children:((M=_r[y])==null?void 0:M.label)||y},y)}):n.jsx("span",{className:"text-[10px] text-gray-500 font-bold uppercase",children:"—"})})}),n.jsx("td",{className:"px-6 py-5 text-right",children:n.jsxs("span",{className:`text-sm font-black ${e==="dark"?"text-gray-300":"text-gray-700"}`,children:[m.totalPool.toLocaleString()," ₽"]})}),n.jsx("td",{className:"px-6 py-5 text-right",children:n.jsxs("span",{className:"text-sm font-black text-emerald-500",children:[m.totalEarnings.toLocaleString()," ₽"]})}),n.jsx("td",{className:"px-6 py-5 text-right w-48",children:n.jsxs("div",{className:"flex items-center justify-end gap-3",children:[n.jsx("div",{className:`w-24 h-1.5 rounded-full overflow-hidden ${e==="dark"?"bg-white/5":"bg-gray-100"}`,children:n.jsx("div",{className:`h-full rounded-full transition-all duration-1000 ${e==="dark"?"bg-white":"bg-black"}`,style:{width:`${Math.min(p,100)}%`}})}),n.jsxs("span",{className:"text-[10px] font-black text-gray-500",children:[p.toFixed(0),"%"]})]})})]},m.id)})})]})})},AS=({earnings:s,onEdit:e,onDelete:t})=>{const{theme:r}=lt(),{user:a}=_t(),{isAdmin:i}=Ct(),[o,l]=I.useState(null),c=.45,h=(T,R="w-4 h-4")=>{switch(T){case"memecoins":return n.jsx(Xi,{className:R});case"futures":return n.jsx(Ql,{className:R});case"nft":return n.jsx(Yl,{className:R});case"spot":return n.jsx(fs,{className:R});case"polymarket":return n.jsx(uh,{className:R});case"staking":return n.jsx(Ji,{className:R});default:return n.jsx(xs,{className:R})}},u=async T=>{if(confirm("Вы уверены, что хотите удалить эту запись о заработке?")){l(T.id);try{i?await _b(T.id):await It({entity:"earning",action:"delete",authorId:(a==null?void 0:a.id)||T.userId,targetUserId:T.userId,before:T,after:null}),t()}catch(R){console.error("Error deleting earnings:",R),alert("Ошибка при удалении записи")}finally{l(null)}}},m=T=>T.participants&&T.participants.length>0?T.participants:[T.userId],g=T=>T.poolAmount||T.amount*c,p=T=>Math.max(T.amount-g(T),0),j=T=>{const R=m(T);return R.length?p(T)/R.length:p(T)},_=T=>_r[T]||_r.other,y=T=>Tt(T)||T,M=T=>i||T.userId===(a==null?void 0:a.id),D=[...s].sort((T,R)=>R.date.localeCompare(T.date));return D.length===0?n.jsxs("div",{className:`rounded-2xl p-8 text-center border-2 ${r==="dark"?"bg-[#1a1a1a] border-gray-800":"bg-white border-gray-200"} shadow-md`,children:[n.jsx("p",{className:`${r==="dark"?"text-gray-400":"text-gray-600"} text-lg`,children:"Пока нет записей о заработке"}),n.jsx("p",{className:"text-gray-500 text-sm mt-2",children:"Добавьте первую запись, чтобы начать отслеживать доходы команды"})]}):n.jsxs("div",{className:`rounded-3xl overflow-hidden border shadow-2xl ${r==="dark"?"bg-[#0b1015] border-white/5":"bg-white border-gray-100"}`,children:[n.jsx("div",{className:"p-6 border-b border-white/5 flex items-center justify-between",children:n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx("div",{className:"p-2 bg-blue-500/10 rounded-xl",children:n.jsx(jm,{className:"w-5 h-5 text-blue-400"})}),n.jsx("h3",{className:`text-lg font-black tracking-tight ${r==="dark"?"text-white":"text-gray-900"}`,children:"История выплат"})]})}),n.jsx("div",{className:"overflow-x-auto",children:n.jsxs("table",{className:"w-full text-left border-collapse",children:[n.jsx("thead",{children:n.jsxs("tr",{className:r==="dark"?"bg-white/5":"bg-gray-50",children:[n.jsx("th",{className:"px-6 py-4 text-[10px] font-black uppercase tracking-wider text-gray-500 whitespace-nowrap",children:"Дата"}),n.jsx("th",{className:"px-6 py-4 text-[10px] font-black uppercase tracking-wider text-gray-500",children:"Сфера"}),n.jsx("th",{className:"px-6 py-4 text-[10px] font-black uppercase tracking-wider text-gray-500",children:"Команда"}),n.jsx("th",{className:"px-6 py-4 text-[10px] font-black uppercase tracking-wider text-gray-500 text-right",children:"Выплата"}),n.jsx("th",{className:"px-6 py-4 text-[10px] font-black uppercase tracking-wider text-gray-500 text-right",children:"В Пул"}),n.jsx("th",{className:"px-6 py-4 text-[10px] font-black uppercase tracking-wider text-gray-500 text-center",children:"Действия"})]})}),n.jsx("tbody",{className:"divide-y divide-white/5",children:D.map(T=>{const R=m(T),P=_(T.category),C=p(T),N=j(T),b=M(T);return n.jsxs("tr",{className:`group/row transition-colors ${r==="dark"?"hover:bg-white/[0.02]":"hover:bg-gray-50"}`,children:[n.jsx("td",{className:"px-6 py-5 whitespace-nowrap",children:n.jsx("span",{className:`text-[12px] font-bold ${r==="dark"?"text-gray-400":"text-gray-600"}`,children:oe(new Date(T.date+"T00:00:00"),"dd.MM")})}),n.jsx("td",{className:"px-6 py-5",children:n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("div",{className:"p-1.5 bg-white/5 rounded-lg",children:h(T.category,"w-3.5 h-3.5 text-gray-400")}),n.jsx("span",{className:`text-xs font-bold ${r==="dark"?"text-gray-300":"text-gray-900"}`,children:P.label})]})}),n.jsx("td",{className:"px-6 py-5",children:n.jsx("div",{className:"flex flex-wrap gap-1.5 max-w-[200px]",children:R.map(v=>n.jsx("span",{className:`px-2 py-0.5 rounded-md text-[10px] font-black tracking-tight border ${r==="dark"?"border-white/5 bg-white/5 text-gray-400":"border-gray-100 bg-gray-50 text-gray-600"}`,children:y(v)},v))})}),n.jsx("td",{className:"px-6 py-5 text-right",children:n.jsxs("div",{className:"flex flex-col items-end",children:[n.jsxs("span",{className:"text-sm font-black text-emerald-500",children:[C.toFixed(0)," ₽"]}),R.length>1&&n.jsxs("span",{className:"text-[10px] font-medium text-gray-500",children:["по ",N.toFixed(0)," ₽"]})]})}),n.jsx("td",{className:"px-6 py-5 text-right",children:n.jsxs("span",{className:"text-sm font-bold text-purple-400 opacity-60",children:[g(T).toFixed(0)," ₽"]})}),n.jsx("td",{className:"px-6 py-5 text-center",children:b?n.jsxs("div",{className:"flex items-center justify-center gap-2 opacity-0 group-hover/row:opacity-100 transition-opacity duration-200",children:[n.jsx("button",{onClick:()=>e(T),className:"p-2 rounded-xl border border-blue-500/20 bg-blue-500/5 text-blue-400 hover:bg-blue-500/20 transition-all",children:n.jsx(jm,{className:"w-3.5 h-3.5"})}),n.jsx("button",{onClick:()=>u(T),disabled:o===T.id,className:"p-2 rounded-xl border border-rose-500/20 bg-rose-500/5 text-rose-500 hover:bg-rose-500/20 transition-all disabled:opacity-50",children:n.jsx(Bt,{className:"w-3.5 h-3.5"})})]}):n.jsx("span",{className:"text-gray-700 text-xs",children:"—"})})]},T.id)})})]})})]})},CS=()=>{const{theme:s}=lt(),[e,t]=I.useState(!1),[r,a]=I.useState(null),[i,o]=I.useState([]),[l,c]=I.useState(!0),[h,u]=I.useState({weekTotal:0,weekPool:0,weekNet:0,monthTotal:0,monthPool:0,monthNet:0}),m=.45,g=Object.keys(_r),p=s==="dark"?"bg-[#1a1a1a]":"bg-white",j=k=>k.poolAmount||k.amount*m,_=k=>Math.max(k.amount-j(k),0),y=k=>{var w;return(w=k.participants)!=null&&w.length?k.participants:[k.userId]},M=()=>{const k=Hn(),w=oe(k.start,"yyyy-MM-dd"),Q=oe(k.end,"yyyy-MM-dd"),ae=oe(new Date(new Date().getFullYear(),new Date().getMonth(),1),"yyyy-MM-dd"),V=oe(new Date(new Date().getFullYear(),new Date().getMonth()+1,0),"yyyy-MM-dd"),X=i.filter(B=>B.date>=w&&B.date<=Q),he=i.filter(B=>B.date>=ae&&B.date<=V);u({weekTotal:X.reduce((B,te)=>B+te.amount,0),weekPool:X.reduce((B,te)=>B+j(te),0),weekNet:X.reduce((B,te)=>B+_(te),0),monthTotal:he.reduce((B,te)=>B+te.amount,0),monthPool:he.reduce((B,te)=>B+j(te),0),monthNet:he.reduce((B,te)=>B+_(te),0)})};I.useEffect(()=>{D()},[]),I.useEffect(()=>{M()},[i]),I.useEffect(()=>{const k=async w=>{const Q=w,{userId:ae}=Q.detail||{};if(ae)await Ir(ae);else for(const V of Re)await Ir(V.id);o(V=>[...V])};return window.addEventListener("nicknameUpdated",k),()=>{window.removeEventListener("nicknameUpdated",k)}},[]);const D=async()=>{c(!0);try{const k=await Ui();o(k)}catch(k){console.error("Error loading earnings:",k)}finally{c(!1)}},T=k=>{a(k),t(!0)},R=()=>{t(!1),a(null)},P=()=>{t(!1),a(null),D()},C=g.map(k=>{const w=i.filter(B=>B.category===k),Q=w.reduce((B,te)=>B+te.amount,0),ae=w.reduce((B,te)=>B+j(te),0),V=w.reduce((B,te)=>B+_(te),0),X=new Map;w.forEach(B=>{const te=y(B),ve=_(B)/Math.max(te.length,1);te.forEach(W=>{X.set(W,(X.get(W)||0)+ve)})});const he=Array.from(X.entries()).sort((B,te)=>te[1]-B[1]).slice(0,2);return{key:k,gross:Q,pool:ae,net:V,count:w.length,topParticipants:he}}).filter(k=>k.key!=="other"),N=C.reduce((k,w)=>k+w.net,0),b=C.map(k=>({...k,share:N>0?k.net/N*100:0})).sort((k,w)=>w.share-k.share),v=Re.map(k=>{const w=i.filter(X=>y(X).includes(k.id)),Q=w.reduce((X,he)=>{const B=_(he)/Math.max(y(he).length,1);return X+B},0),ae=w.reduce((X,he)=>{const B=j(he)/Math.max(y(he).length,1);return X+B},0),V=w.reduce((X,he)=>{const B=he.amount/Math.max(y(he).length,1);return X+B},0);return{...k,net:Q,poolShare:ae,grossContribution:V}}).sort((k,w)=>w.net-k.net),S=[...C].sort((k,w)=>w.net-k.net)[0],E=v[0];return n.jsxs("div",{className:"space-y-6",children:[n.jsxs("div",{className:"space-y-6",children:[n.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[n.jsxs("div",{className:"flex items-center gap-4",children:[n.jsx("div",{className:"p-3 bg-emerald-500/10 rounded-2xl border border-emerald-500/20",children:n.jsx(va,{className:"w-8 h-8 text-emerald-500"})}),n.jsxs("div",{children:[n.jsx("h1",{className:`text-2xl md:text-3xl font-black tracking-tight ${s==="dark"?"text-white":"text-gray-900"}`,children:"AVF Profit"}),n.jsx("p",{className:`text-sm font-medium ${s==="dark"?"text-gray-400":"text-gray-500"}`,children:"Мониторинг доходов и распределение пула"})]})]}),n.jsxs("button",{onClick:()=>t(!0),className:"flex items-center gap-2 px-6 py-3 rounded-xl bg-emerald-500 hover:bg-emerald-600 text-white font-bold text-sm transition-all shadow-lg shadow-emerald-500/20 hover:scale-105 active:scale-95",children:[n.jsx(Cr,{className:"w-4 h-4"}),n.jsx("span",{children:"Добавить заработок"})]})]}),n.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[{label:"НЕДЕЛЯ (ЧИСТЫМИ)",value:`${h.weekNet.toLocaleString()} ₽`,badgeIcon:n.jsx(vw,{className:"w-4 h-4 text-emerald-500"}),changeType:"positive",icon:n.jsx(Ut,{className:"w-5 h-5 text-emerald-400"}),bgClass:"bg-emerald-500/5",borderClass:"border-emerald-500/10"},{label:"НЕДЕЛЯ (ПУЛ)",value:`${h.weekPool.toLocaleString()} ₽`,badgeIcon:n.jsx(Ji,{className:"w-4 h-4 text-blue-400"}),icon:n.jsx(Eo,{className:"w-5 h-5 text-blue-400"}),bgClass:"bg-blue-500/5",borderClass:"border-blue-500/10"},{label:"МЕСЯЦ (ЧИСТЫМИ)",value:`${h.monthNet.toLocaleString()} ₽`,isTrend:!0,icon:n.jsx(bw,{className:"w-5 h-5 text-purple-400"}),bgClass:"bg-purple-500/5",borderClass:"border-purple-500/10"},{label:"МЕСЯЦ (ПУЛ)",value:`${h.monthPool.toLocaleString()} ₽`,isCoins:!0,icon:n.jsx(fs,{className:"w-5 h-5 text-orange-400"}),bgClass:"bg-orange-500/5",borderClass:"border-orange-500/10",change:void 0,badgeIcon:void 0}].map((k,w)=>n.jsxs("div",{className:`relative overflow-hidden rounded-2xl p-5 border transition-all duration-300 hover:shadow-xl group ${s==="dark"?`${k.bgClass} ${k.borderClass} hover:border-white/20`:"bg-white border-gray-100 hover:border-emerald-500/20 shadow-sm"}`,children:[n.jsxs("div",{className:"flex justify-between items-start mb-6",children:[n.jsx("span",{className:`text-[10px] font-black uppercase tracking-widest ${s==="dark"?"text-gray-500":"text-gray-400"}`,children:k.label}),k.change&&n.jsx("span",{className:"px-2 py-0.5 rounded-full bg-emerald-500/10 text-emerald-500 text-[10px] font-black",children:k.change}),"badgeIcon"in k&&k.badgeIcon&&n.jsx("div",{className:"p-1 bg-emerald-500/10 rounded-lg",children:k.badgeIcon}),k.isTrend&&n.jsx(Ut,{className:"w-4 h-4 text-purple-500/40"}),k.isCoins&&n.jsx(Eo,{className:"w-4 h-4 text-orange-500/40"})]}),n.jsx("div",{className:"flex items-end justify-between",children:n.jsx("div",{className:`text-2xl md:text-3xl font-black tracking-tight ${s==="dark"?"text-white":"text-gray-900"}`,children:k.value})})]},w))})]}),n.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-12 gap-6",children:[n.jsxs("div",{className:`lg:col-span-3 rounded-2xl p-6 ${p} border ${s==="dark"?"border-white/5":"border-gray-100"} shadow-xl`,children:[n.jsxs("div",{className:"flex items-center gap-3 mb-8",children:[n.jsx("div",{className:"p-2 bg-[#4E6E49]/10 rounded-lg",children:n.jsx(aw,{className:"w-5 h-5 text-[#4E6E49]"})}),n.jsx("h3",{className:`text-sm font-black uppercase tracking-widest ${s==="dark"?"text-white":"text-gray-900"}`,children:"Доли заработка"})]}),n.jsx("div",{className:"space-y-6",children:b.map(k=>{const w=_r[k.key];return n.jsxs("div",{className:"space-y-2",children:[n.jsxs("div",{className:"flex justify-between items-center text-[11px] font-black uppercase",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("div",{className:`w-2 h-2 rounded-full ${w.accent==="emerald"?"bg-emerald-500":w.accent==="blue"?"bg-blue-500":w.accent==="purple"?"bg-purple-500":w.accent==="amber"?"bg-amber-500":w.accent==="pink"?"bg-pink-500":w.accent==="indigo"?"bg-indigo-500":"bg-gray-500"}`}),n.jsx("span",{className:s==="dark"?"text-gray-300":"text-gray-700",children:w.label})]}),n.jsxs("span",{className:s==="dark"?"text-white":"text-gray-900",children:[k.share.toFixed(0),"%"]})]}),n.jsx("div",{className:"h-1.5 w-full bg-white/5 rounded-full overflow-hidden",children:n.jsx("div",{className:`h-full rounded-full ${w.accent==="emerald"?"bg-emerald-500":w.accent==="blue"?"bg-blue-500":w.accent==="purple"?"bg-purple-500":w.accent==="amber"?"bg-amber-500":w.accent==="pink"?"bg-pink-500":w.accent==="indigo"?"bg-indigo-500":"bg-gray-500"}`,style:{width:`${k.share}%`}})})]},k.key)})})]}),n.jsxs("div",{className:`lg:col-span-9 rounded-2xl p-6 ${p} border ${s==="dark"?"border-white/5":"border-gray-100"} shadow-xl`,children:[n.jsx("div",{className:"flex items-center justify-between mb-8",children:n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx("div",{className:"p-2 bg-blue-500/10 rounded-lg",children:n.jsx(uh,{className:"w-5 h-5 text-blue-400"})}),n.jsx("h3",{className:`text-sm font-black uppercase tracking-widest ${s==="dark"?"text-white":"text-gray-900"}`,children:"Детализация дохода по сферам"})]})}),n.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:b.map(k=>{const w=_r[k.key];return n.jsxs("div",{className:`p-4 rounded-xl border ${s==="dark"?"bg-black/20 border-white/5 hover:border-white/10":"bg-gray-50 border-gray-200"} transition-all group`,children:[n.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[n.jsx("div",{className:`w-2 h-2 rounded-full ${w.accent==="emerald"?"bg-emerald-500":w.accent==="blue"?"bg-blue-500":w.accent==="purple"?"bg-purple-500":w.accent==="amber"?"bg-amber-500":w.accent==="pink"?"bg-pink-500":w.accent==="indigo"?"bg-indigo-500":"bg-gray-500"}`}),n.jsx("span",{className:`text-xs font-black uppercase tracking-widest ${s==="dark"?"text-white":"text-gray-900"}`,children:w.label})]}),n.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[n.jsxs("div",{children:[n.jsx("p",{className:"text-[9px] font-black text-gray-500 uppercase mb-1",children:"ЧИСТЫМИ"}),n.jsxs("p",{className:`text-sm font-black ${s==="dark"?"text-white":"text-gray-900"}`,children:[k.net.toLocaleString()," ₽"]})]}),n.jsxs("div",{className:"text-right",children:[n.jsx("p",{className:"text-[9px] font-black text-gray-500 uppercase mb-1",children:"В ПУЛ"}),n.jsxs("p",{className:`text-sm font-black ${s==="dark"?"text-white":"text-gray-900"}`,children:[k.pool.toLocaleString()," ₽"]})]})]}),n.jsx("div",{className:"h-1 w-full bg-white/5 rounded-full overflow-hidden",children:n.jsx("div",{className:`h-full rounded-full transition-all duration-500 ${w.accent==="emerald"?"bg-emerald-500 focus:bg-emerald-400":w.accent==="blue"?"bg-blue-500 focus:bg-blue-400":w.accent==="purple"?"bg-purple-500 focus:bg-purple-400":w.accent==="amber"?"bg-amber-500 focus:bg-amber-400":w.accent==="pink"?"bg-pink-500 focus:bg-pink-400":w.accent==="indigo"?"bg-indigo-500 focus:bg-indigo-400":"bg-gray-500"}`,style:{width:`${k.share}%`}})})]},k.key)})})]})]}),n.jsxs("div",{id:"earn-insights",className:`relative overflow-hidden rounded-3xl p-8 ${s==="dark"?"bg-[#0b1015] border-white/5":"bg-white border-gray-100"} border shadow-2xl`,children:[n.jsx("div",{className:"absolute top-0 right-0 w-64 h-64 bg-emerald-500/5 blur-3xl rounded-full -mr-32 -mt-32"}),n.jsxs("div",{className:"relative z-10 space-y-8",children:[n.jsxs("div",{children:[n.jsx("h3",{className:`text-lg font-black tracking-tight ${s==="dark"?"text-white":"text-gray-900"}`,children:"Инсайты Эффективности"}),n.jsx("p",{className:"text-xs text-gray-500",children:"Аналитика доходности по направлениям и участникам"})]}),n.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[{label:"Топ категория",value:S?_r[S.key].label:"—",note:"+14% ROI",icon:n.jsx(Ut,{className:"w-5 h-5 text-emerald-500"})},{label:"Лидер недели",value:E?E.name:"—",note:E?`${E.net.toLocaleString()} ₽ чистого`:"Нет данных",icon:n.jsx(xs,{className:"w-5 h-5 text-amber-500"})},{label:"Доля пула в работе",value:h.monthTotal?`${Math.round(h.monthPool/h.monthTotal*100)}%`:"68%",note:h.monthTotal?`Доступно ${h.monthPool.toLocaleString()} ₽`:"Доступно 0 ₽",icon:n.jsx(Eo,{className:"w-5 h-5 text-blue-500"})},{label:"Средняя выплата",value:i.length?`${(i.reduce((k,w)=>k+_(w),0)/i.length).toFixed(0)} ₽`:"0 ₽",note:"↑ 5%",icon:n.jsx(va,{className:"w-5 h-5 text-emerald-500"})}].map((k,w)=>n.jsx("div",{className:`p-5 rounded-2xl border ${s==="dark"?"bg-white/5 border-white/5 shadow-inner":"bg-gray-50 border-gray-100"}`,children:n.jsxs("div",{className:"flex flex-col h-full justify-between",children:[n.jsxs("div",{className:"flex justify-between items-start mb-4",children:[n.jsx("span",{className:"text-[10px] font-black uppercase tracking-widest text-gray-500",children:k.label}),k.icon]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx("p",{className:`text-lg font-black leading-tight ${s==="dark"?"text-white":"text-gray-900"}`,children:k.value}),n.jsx("p",{className:"text-[10px] font-black uppercase tracking-widest text-[#4E6E49]",children:k.note})]})]})},w))})]})]}),n.jsx("div",{className:"pt-8 border-t border-white/5",children:l?n.jsx("div",{className:`rounded-2xl p-12 text-center border border-dashed ${s==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-gray-50"}`,children:n.jsxs("div",{className:"flex flex-col items-center gap-4",children:[n.jsx("div",{className:"w-10 h-10 border-4 border-emerald-500/20 border-t-emerald-500 rounded-full animate-spin"}),n.jsx("p",{className:`text-sm font-medium ${s==="dark"?"text-gray-400":"text-gray-500"}`,children:"Загрузка данных..."})]})}):n.jsx("div",{className:"space-y-12",children:n.jsxs("div",{id:"earn-history",className:"space-y-8",children:[n.jsx("div",{className:"flex items-center justify-between",children:n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx("div",{className:"p-2 bg-emerald-500/10 rounded-xl",children:n.jsx(Ut,{className:"w-5 h-5 text-emerald-500"})}),n.jsx("h3",{className:`text-lg font-black tracking-tight ${s==="dark"?"text-white":"text-gray-900"}`,children:"Лидеры по доходу"})]})}),n.jsx(IS,{earnings:i}),n.jsxs("div",{className:"space-y-6",children:[n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx("div",{className:"p-2 bg-purple-500/10 rounded-xl",children:n.jsx(Eo,{className:"w-5 h-5 text-purple-400"})}),n.jsx("h3",{className:`text-lg font-black tracking-tight ${s==="dark"?"text-white":"text-gray-900"}`,children:"Личные Накопления"})]}),n.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-5 gap-4",children:v.map(k=>n.jsxs("div",{className:`relative overflow-hidden rounded-2xl p-5 border shadow-xl ${s==="dark"?"bg-white/5 border-white/5":"bg-white border-gray-100"}`,children:[n.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[n.jsx("div",{className:"relative",children:k.avatar?n.jsx("img",{src:k.avatar,alt:"",className:"w-8 h-8 rounded-full object-cover ring-2 ring-white/10"}):n.jsx("div",{className:"w-8 h-8 rounded-full bg-emerald-500/20 flex items-center justify-center text-xs font-black text-emerald-500",children:k.name[0]})}),n.jsxs("div",{children:[n.jsx("p",{className:`text-sm font-black truncate max-w-[100px] ${s==="dark"?"text-white":"text-gray-900"}`,children:k.name}),n.jsx("p",{className:"text-[10px] text-gray-500 font-bold uppercase tracking-widest",children:k.login})]})]}),n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{className:"space-y-1",children:[n.jsx("p",{className:"text-[9px] font-black text-gray-500 uppercase tracking-widest",children:"Всего заработано"}),n.jsxs("p",{className:"text-base font-black text-emerald-500",children:[k.grossContribution.toLocaleString()," ₽"]})]}),n.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[n.jsxs("div",{className:"space-y-1",children:[n.jsx("p",{className:"text-[8px] font-black text-gray-500 uppercase tracking-widest",children:"В ПУЛ"}),n.jsxs("p",{className:`text-[11px] font-black ${s==="dark"?"text-gray-300":"text-gray-700"}`,children:[k.poolShare.toLocaleString()," ₽"]})]}),n.jsxs("div",{className:"space-y-1 text-right",children:[n.jsx("p",{className:"text-[8px] font-black text-gray-500 uppercase tracking-widest",children:"ПОЛУЧЕНО"}),n.jsxs("p",{className:`text-[11px] font-black ${s==="dark"?"text-gray-300":"text-gray-700"}`,children:[k.net.toLocaleString()," ₽"]})]})]}),n.jsx("div",{className:"h-1 w-full bg-white/5 rounded-full overflow-hidden",children:n.jsx("div",{className:"h-full bg-emerald-500 rounded-full",style:{width:`${Math.min(k.net/k.grossContribution*100,100)}%`}})})]})]},k.id))})]}),n.jsx("div",{className:"pt-8 border-t border-white/5",children:n.jsx(AS,{earnings:i,onEdit:T,onDelete:D})})]})})}),e&&n.jsx(TS,{onClose:R,onSave:P,editingEarning:r})]})},Cb=(s,e=0,t=0,r=0,a=0,i=0)=>{console.log("calculateRating input:",{userId:s.userId,weeklyDaysOff:r,weeklySickDays:a,data_sickDays:s.sickDays,data_vacationDays:s.vacationDays,ninetyDayVacationDays:i,data_absenceDays:s.absenceDays,weeklyHours:e,weeklyEarnings:t});let o=0,l=0;r<2?(l=5,o+=5):r>3&&(l=-15,o-=15),console.log("DaysOff calculation:",{weeklyDaysOff:r,daysOffPoints:l,currentRating:o});let c=0;a<3&&s.sickDays<=9?(c=5,o+=5):(a>4||s.sickDays>10)&&(c=-15,o-=15),console.log("SickDays calculation:",{weeklySickDays:a,monthlySickDays:s.sickDays,sickDaysPoints:c,currentRating:o});let h=0;s.vacationDays<12&&i<=30?(h=10,o+=10):(s.vacationDays>12||i>30)&&(h=-10,o-=10),console.log("Vacation calculation:",{monthlyVacationDays:s.vacationDays,ninetyDayVacationDays:i,vacationDaysPoints:h,currentRating:o});let u=0;s.absenceDays>2&&(u=30),console.log("Absence penalty:",{absenceDays:s.absenceDays,absencePenalty:u,currentRating:o}),e>=20?o+=25:e>=15&&(o+=15),t>=6e3?o+=30:t>=3e3&&(o+=15);const m=Math.min(s.referrals*5,30);return o+=m,o=Math.max(0,o-u),console.log("Final rating calculation:",{ratingAfterAbsencePenalty:o,finalRating:Math.min(o,100)}),Math.min(o,100)},Db=(s,e=0,t=0,r=0,a=0,i=0)=>{let o=0;r<2?o=5:r>3&&(o=-15);let l=0;a<3&&s.sickDays<=9?l=5:(a>4||s.sickDays>10)&&(l=-15);let c=0;s.vacationDays<12&&i<=30?c=10:(s.vacationDays>12||i>30)&&(c=-10);let h=0;s.absenceDays>2&&(h=-30);let u=0;e>=20?u=25:e>=15&&(u=15);let m=0;t>=6e3?m=30:t>=3e3&&(m=15);const g=Math.min(s.referrals*5,30),p=o+l+c+u+m+g,j=Math.min(Math.max(0,p+h),100);return{daysOff:r,daysOffPoints:o,sickDays:s.sickDays,sickDaysPoints:l,vacationDays:s.vacationDays,vacationDaysPoints:c,absenceDays:s.absenceDays,absenceDaysPoints:h,weeklyHours:e,weeklyHoursPoints:u,weeklyEarnings:t,weeklyEarningsPoints:m,referrals:s.referrals,referralsPoints:g,totalRating:j}},DS=s=>s<20?{status:"excluded",label:"Исключен",description:"Участник исключается из сообщества",color:"#dc2626"}:s>=21&&s<=45?{status:"warning",label:"Исправиться",description:"Необходимо улучшить показатели",color:"#f59e0b"}:{status:"ok",label:"В команде",description:"Участник в команде",color:"#10b981"},MS=({rating:s,place:e})=>{var N;const{theme:t}=lt(),[r,a]=I.useState(null),i=Re.find(b=>b.id===s.userId),o=t==="dark"?"text-white":"text-gray-900",l=t==="dark"?"text-gray-400":"text-gray-600",c=t==="dark"?"bg-[#0f0f0f]":"bg-white",h=t==="dark"?"border-white/10":"border-gray-200",u=t==="dark"?"hover:bg-white/5":"hover:bg-gray-50",m=t==="dark"?"bg-white/5":"bg-gray-50/80",g=s.rating<=0?"4%":`${Math.min(s.rating,100)}%`,p=s.rating>=80?"bg-emerald-500":s.rating>=60?"bg-blue-500":s.rating>=40?"bg-amber-500":"bg-rose-500",j=s.rating>=80?"#10b981":s.rating>=60?"#3b82f6":s.rating>=40?"#f59e0b":"#f43f5e",y={1:{bg:t==="dark"?"bg-emerald-500/10":"bg-emerald-50",border:t==="dark"?"border-emerald-400/30":"border-emerald-200",text:t==="dark"?"text-emerald-100":"text-emerald-900",icon:t==="dark"?"text-emerald-200":"text-emerald-600",soft:t==="dark"?"bg-emerald-500/8":"bg-emerald-50"},2:{bg:t==="dark"?"bg-sky-500/10":"bg-sky-50",border:t==="dark"?"border-sky-400/30":"border-sky-200",text:t==="dark"?"text-sky-100":"text-sky-900",icon:t==="dark"?"text-sky-200":"text-sky-600",soft:t==="dark"?"bg-sky-500/8":"bg-sky-50"},3:{bg:t==="dark"?"bg-purple-500/10":"bg-purple-50",border:t==="dark"?"border-purple-400/30":"border-purple-200",text:t==="dark"?"text-purple-100":"text-purple-900",icon:t==="dark"?"text-purple-200":"text-purple-600",soft:t==="dark"?"bg-purple-500/8":"bg-purple-50"},4:{bg:t==="dark"?"bg-amber-500/10":"bg-amber-50",border:t==="dark"?"border-amber-400/30":"border-amber-200",text:t==="dark"?"text-amber-100":"text-amber-900",icon:t==="dark"?"text-amber-200":"text-amber-600",soft:t==="dark"?"bg-amber-500/8":"bg-amber-50"},5:{bg:t==="dark"?"bg-rose-500/10":"bg-rose-50",border:t==="dark"?"border-rose-400/30":"border-rose-200",text:t==="dark"?"text-rose-100":"text-rose-900",icon:t==="dark"?"text-rose-200":"text-rose-600",soft:t==="dark"?"bg-rose-500/8":"bg-rose-50"},default:{bg:t==="dark"?"bg-white/5":"bg-gray-50",border:t==="dark"?"border-white/10":"border-gray-200",text:t==="dark"?"text-white":"text-gray-900",icon:t==="dark"?"text-white":"text-gray-700",soft:t==="dark"?"bg-white/5":"bg-gray-50"}}[(i==null?void 0:i.id)||"default"],M=s.breakdown?[{icon:n.jsx(Fr,{className:"w-5 h-5"}),label:"Выходные",value:`${s.breakdown.daysOff} день`,points:s.breakdown.daysOffPoints,maxPoints:5,explanation:"Менее 2 выходных в неделю = +5% к рейтингу. Более 3 выходных = -15%. Показывает стабильность присутствия.",threshold:"<2 дня: +5% | >3 дня: -15%",color:"bg-amber-200 text-amber-900"},{icon:n.jsx(qv,{className:"w-5 h-5"}),label:"Больничные",value:`${s.breakdown.sickDays} дней`,points:s.breakdown.sickDaysPoints,maxPoints:5,explanation:"Менее 3 дней больничных в неделю И ≤9 дней в месяц = +5%. Более 4 дней в неделю ИЛИ >10 дней в месяц = -15%.",threshold:"<3/нед + ≤9/мес: +5% | >4/нед или >10/мес: -15%",color:"bg-purple-200 text-purple-900"},{icon:n.jsx(iw,{className:"w-5 h-5"}),label:"Отпуск",value:`${s.breakdown.vacationDays} дней`,points:s.breakdown.vacationDaysPoints,maxPoints:10,explanation:"Менее 12 дней отпуска в месяц И ≤30 дней за 90 дней = +10%. Более 12 дней в месяц ИЛИ >30 дней за 90 дней = -10%.",threshold:"<12/мес + ≤30/90дн: +10% | >12/мес или >30/90дн: -10%",color:"bg-orange-200 text-orange-900"},{icon:n.jsx(Xt,{className:"w-5 h-5"}),label:"Прогулы",value:`${s.breakdown.absenceDays} дней`,points:s.breakdown.absenceDaysPoints,maxPoints:0,explanation:"До 1 прогула в неделю = рейтинг не страдает. Более 2 прогулов = -30% к рейтингу. Учитывается за последние 7 дней.",threshold:"≤1 дня",color:"bg-red-200 text-red-900"},{icon:n.jsx(Ks,{className:"w-5 h-5"}),label:"Часы работы",value:D5(s.breakdown.weeklyHours),points:s.breakdown.weeklyHoursPoints,maxPoints:25,explanation:"20+ часов в неделю = 25% к рейтингу. 15-19 часов = 15%. Менее 15 часов = 0%. Показывает объем работы за неделю.",threshold:"≥20ч: 25% | ≥15ч: 15%",color:"bg-blue-200 text-blue-900"},{icon:n.jsx(va,{className:"w-5 h-5"}),label:"Заработок",value:`${s.breakdown.weeklyEarnings.toFixed(2)} ₽`,points:s.breakdown.weeklyEarningsPoints,maxPoints:30,explanation:"6000+ ₽ в неделю = 30% к рейтингу. 3000-5999 ₽ = 15%. Менее 3000 ₽ = 0%. Основной показатель эффективности.",threshold:"≥6000₽: 30% | ≥3000₽: 15%",color:"bg-emerald-200 text-emerald-900"},{icon:n.jsx(qn,{className:"w-5 h-5"}),label:"Рефералы",value:`${s.breakdown.referrals} чел.`,points:s.breakdown.referralsPoints,maxPoints:30,explanation:"5% к рейтингу за каждого реферала. Максимум 30% (6 рефералов). Учитываются за последние 30 дней. Показывает активность по привлечению новых участников.",threshold:"5% за каждого (макс 30%)",color:"bg-pink-200 text-pink-900"}]:[],D=M.filter(b=>b.label!=="Прогулы").reduce((b,v)=>b+v.points,0),T=((N=M.find(b=>b.label==="Прогулы"))==null?void 0:N.points)||0,R=Math.max(0,Math.min(100,D+T)),P=DS(s.rating),C=(()=>{if(!e)return null;const b=e.rank,v=b===1?{bg:"from-amber-400 to-amber-600",ring:"ring-amber-300/50",icon:"🥇"}:b===2?{bg:"from-slate-300 to-slate-500",ring:"ring-slate-300/50",icon:"🥈"}:b===3?{bg:"from-amber-200 to-amber-500",ring:"ring-amber-200/40",icon:"🥉"}:{bg:"from-gray-200 to-gray-400",ring:"ring-gray-200/40",icon:b.toString()};return n.jsx("div",{className:"absolute top-3 right-3",children:n.jsx("div",{className:`w-10 h-10 rounded-full bg-gradient-to-br ${v.bg} ring-4 ${v.ring} shadow-lg grid place-items-center text-lg font-semibold`,children:v.icon})})})();return n.jsxs("div",{className:`relative rounded-2xl p-6 ${c} shadow-sm border ${h} transition-colors`,children:[C,n.jsxs("div",{className:"mb-5 flex flex-col gap-3",children:[n.jsx("div",{className:"flex items-start justify-between gap-3",children:n.jsxs("div",{className:"min-w-0",children:[n.jsx("p",{className:`text-[11px] uppercase tracking-[0.12em] ${l}`,children:"Участник"}),n.jsx("div",{className:"flex items-center gap-2 flex-wrap",children:n.jsx("h3",{className:`text-2xl font-bold ${o} truncate`,children:n.jsx(xn,{userId:s.userId,fallback:"unknown"})})}),n.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[n.jsxs("span",{className:`px-2.5 py-1 rounded-lg text-xs font-semibold border ${y.border} ${y.bg} ${y.text} flex items-center gap-1`,children:[n.jsx("span",{className:`text-lg leading-none ${y.icon}`,children:"●"}),n.jsx("span",{children:"Ник"})]}),n.jsx("div",{className:"flex items-center gap-2",children:n.jsxs("span",{className:"text-lg font-bold",style:{color:j},children:[s.rating.toFixed(1),"%"]})})]})]})}),n.jsxs("div",{children:[n.jsx("div",{className:"w-full bg-gray-200/70 dark:bg-gray-800 rounded-full h-6 overflow-hidden shadow-inner",children:n.jsx("div",{className:`h-full transition-all duration-500 flex items-center justify-center text-sm font-semibold text-white ${p}`,style:{width:g,minWidth:s.rating<=0?"40px":void 0},children:s.rating>=8&&n.jsxs("span",{children:[s.rating.toFixed(0),"%"]})})}),n.jsxs("div",{className:"flex justify-between mt-1",children:[n.jsx("span",{className:`text-xs ${l}`,children:"Общий рейтинг"}),n.jsxs("span",{className:`text-xs font-semibold ${l}`,children:[R,"/100 баллов"]})]})]}),n.jsxs("div",{className:"mt-3",children:[n.jsxs("div",{className:"inline-flex items-center gap-2 px-3 py-1.5 rounded-lg border text-sm font-medium",style:{backgroundColor:`${P.color}15`,borderColor:`${P.color}40`,color:P.color},children:[n.jsx("div",{className:"w-2 h-2 rounded-full animate-pulse",style:{backgroundColor:P.color}}),n.jsx("span",{children:P.label})]}),n.jsx("p",{className:`text-xs mt-1 ${l}`,children:P.description})]})]}),s.breakdown&&n.jsxs("div",{className:"space-y-3 mb-6",children:[n.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[n.jsx(Ut,{className:`w-5 h-5 ${l}`}),n.jsx("h4",{className:`text-lg font-semibold ${o}`,children:"Детальный разбор рейтинга"})]}),M.map((b,v)=>{const S=b.maxPoints>0?b.points/b.maxPoints*100:0,E=r===v;return n.jsxs("div",{className:`rounded-lg border ${h} overflow-hidden transition-all ${E?"shadow-md":""}`,children:[n.jsx("button",{onClick:()=>a(E?null:v),className:`w-full p-4 flex items-center justify-between ${u} transition-colors`,children:n.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[n.jsx("div",{className:`p-2 rounded-lg ${b.color} flex-shrink-0`,children:b.icon}),n.jsxs("div",{className:"flex-1 min-w-0",children:[n.jsxs("div",{className:"flex items-center justify-between mb-1",children:[n.jsx("span",{className:`font-semibold ${o} truncate`,children:b.label}),n.jsxs("span",{className:`font-bold ml-2 ${b.points>0?"text-[#4E6E49]":"text-red-500"}`,children:[b.points,"/",b.maxPoints]})]}),n.jsx("div",{className:"w-full bg-gray-200 dark:bg-gray-800 rounded-full h-2 overflow-hidden",children:n.jsx("div",{className:`h-full transition-all duration-300 ${b.color}`,style:{width:`${S}%`}})}),n.jsxs("div",{className:"flex items-center justify-between mt-1",children:[n.jsx("span",{className:`text-xs ${l} truncate mr-2`,children:b.value}),n.jsx("span",{className:`text-xs ${l} whitespace-nowrap`,children:b.threshold})]})]}),n.jsx($s,{className:`w-4 h-4 flex-shrink-0 ml-2 ${l} transition-transform ${E?"rotate-180":""}`})]})}),E&&n.jsx("div",{className:`px-4 pb-4 pt-2 border-t ${h} ${m}`,children:n.jsx("p",{className:`text-sm ${l} leading-relaxed`,children:b.explanation})})]},v)})]}),n.jsxs("div",{className:`pt-4 border-t ${h}`,children:[n.jsx("h4",{className:`text-sm font-semibold mb-3 ${o}`,children:"Дополнительная статистика"}),n.jsxs("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[n.jsxs("div",{className:`p-3 rounded-lg ${m}`,children:[n.jsx("div",{className:`text-xs ${l} mb-1`,children:"Заработок (месяц)"}),n.jsxs("div",{className:`text-lg font-bold ${o}`,children:[s.earnings.toFixed(0)," ₽"]})]}),n.jsxs("div",{className:`p-3 rounded-lg ${m}`,children:[n.jsx("div",{className:`text-xs ${l} mb-1`,children:"В пул"}),n.jsxs("div",{className:`text-lg font-bold ${o}`,children:[s.poolAmount.toFixed(0)," ₽"]})]}),n.jsxs("div",{className:`p-3 rounded-lg ${m}`,children:[n.jsx("div",{className:`text-xs ${l} mb-1`,children:"Прогулы (неделя)"}),n.jsxs("div",{className:`text-lg font-bold ${o}`,children:[s.absenceDays," дней"]})]}),n.jsxs("div",{className:`p-3 rounded-lg ${m}`,children:[n.jsx("div",{className:`text-xs ${l} mb-1`,children:"Сигналы"}),n.jsxs("div",{className:`text-lg font-bold ${o}`,children:[s.signals,"/",s.profitableSignals]})]})]})]})]})},nd=()=>`REF-${Math.random().toString(36).slice(2,8).toUpperCase()}`,$S=({referral:s,onClose:e,onSave:t})=>{const{user:r}=_t(),{isAdmin:a}=Ct(),{theme:i}=lt(),[o,l]=I.useState(""),[c,h]=I.useState(""),[u,m]=I.useState(""),[g,p]=I.useState(nd()),[j,_]=I.useState(""),[y,M]=I.useState(!1),[D,T]=I.useState(!1);I.useEffect(()=>{s?(l(s.name),h(String(s.age)),p(s.referralId),m(s.comment||"")):(l(""),h(""),m(""),p(nd()))},[s]);const R=!!s,P=R?"Редактировать реферала":"Добавить реферала",C=i==="dark"?"bg-gray-700 hover:bg-gray-600 text-white":"bg-gray-200 hover:bg-gray-300 text-gray-900",N=i==="dark"?"text-gray-300":"text-gray-700",b=i==="dark"?"text-white":"text-gray-900",v=async()=>{if(!s){if(!r){_("Пользователь не найден. Для добавления реферала необходимо войти как участник.");return}}if(!o.trim()||!c.trim()){_("Заполните имя и возраст");return}const E=Number(c);if(Number.isNaN(E)||E<16){_("Возраст должен быть числом не меньше 16");return}M(!0),_("");const k={referralId:g,ownerId:(s==null?void 0:s.ownerId)||r.id,name:o.trim(),age:E,createdAt:(s==null?void 0:s.createdAt)||new Date().toISOString(),...u.trim()&&{comment:u.trim()}};try{s?a?await Sb(s.id,k):await It({entity:"referral",action:"update",authorId:(r==null?void 0:r.id)||s.ownerId,targetUserId:s.ownerId,before:s,after:{id:s.id,...k}}):a?await jb(k):await It({entity:"referral",action:"create",authorId:r.id,targetUserId:r.id,before:null,after:{id:"",...k}}),t()}catch(w){console.error("Error saving referral:",w);const Q=w.message||w.code||"Не удалось сохранить реферала";_(Q)}finally{M(!1)}},S=async()=>{if(s&&confirm(`Удалить реферала ${s.name}?`)){T(!0);try{a?await xu(s.id):await It({entity:"referral",action:"delete",authorId:(r==null?void 0:r.id)||s.ownerId,targetUserId:s.ownerId,before:s,after:null}),t()}catch(E){console.error("Error deleting referral:",E);const k=E.message||E.code||"Не удалось удалить реферала";_(k)}finally{T(!1)}}};return n.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-start sm:items-center justify-center z-[70] p-4 sm:py-0 overflow-y-auto overflow-x-hidden overscroll-contain modal-scroll",children:n.jsxs("div",{className:`w-full max-w-md rounded-lg shadow-xl ${i==="dark"?"bg-[#1a1a1a]":"bg-white"} max-h-[90vh] flex flex-col overflow-hidden`,children:[n.jsx("div",{className:"flex-shrink-0 p-6 pb-4",children:n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsx("h3",{className:`text-xl font-bold ${b}`,children:P}),n.jsx("button",{onClick:e,className:`p-2 rounded-lg flex-shrink-0 ${C}`,"aria-label":"Закрыть",children:n.jsx(Ft,{className:"w-5 h-5"})})]})}),n.jsx("div",{className:"flex-1 min-h-0 overflow-y-auto overflow-x-hidden overscroll-contain modal-scroll px-6 pb-6",children:n.jsxs("div",{className:"space-y-4 min-w-0",children:[n.jsxs("div",{children:[n.jsx("label",{className:`block text-sm font-medium mb-2 ${N}`,children:"Имя"}),n.jsx("input",{type:"text",value:o,onChange:E=>l(E.target.value),className:`w-full px-4 py-2 rounded-lg border ${i==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`,placeholder:"Введите имя"})]}),n.jsxs("div",{children:[n.jsx("label",{className:`block text-sm font-medium mb-2 ${N}`,children:"Возраст"}),n.jsx("input",{type:"number",value:c,onChange:E=>h(E.target.value),className:`w-full px-4 py-2 rounded-lg border ${i==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`,placeholder:"18",min:16})]}),n.jsxs("div",{children:[n.jsx("label",{className:`block text-sm font-medium mb-2 ${N}`,children:"Комментарий"}),n.jsx("textarea",{value:u,onChange:E=>m(E.target.value),rows:3,className:`w-full px-4 py-2 rounded-lg border ${i==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]`,placeholder:"Например, источник лида или статус"})]}),n.jsxs("div",{children:[n.jsx("label",{className:`block text-sm font-medium mb-2 ${N}`,children:"ID реферала"}),n.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[n.jsx("input",{type:"text",value:g,readOnly:R,onChange:E=>p(E.target.value),className:`flex-1 px-4 py-2 rounded-lg border ${i==="dark"?"bg-gray-700 border-gray-800 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#4E6E49] ${R?"opacity-80 cursor-not-allowed":""}`}),!R&&n.jsxs("button",{type:"button",onClick:()=>p(nd()),className:"px-3 py-2 bg-[#4E6E49] hover:bg-[#4E6E49] text-white rounded-lg transition-colors flex items-center justify-center gap-1 text-sm",children:[n.jsx(ow,{className:"w-4 h-4"}),"Новый"]})]}),n.jsx("p",{className:`text-xs mt-1 ${i==="dark"?"text-gray-400":"text-gray-500"}`,children:"ID генерируется автоматически и используется для учета."})]}),j&&n.jsx("div",{className:"p-3 bg-red-500 text-white rounded-lg text-sm",children:j}),n.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[R&&n.jsxs("button",{onClick:S,disabled:D,className:"flex-1 px-4 py-2 bg-red-500 hover:bg-red-600 disabled:bg-red-300 text-white rounded-lg transition-colors flex items-center justify-center gap-2",children:[n.jsx(Bt,{className:"w-4 h-4"}),D?"Удаление...":"Удалить"]}),n.jsx("button",{onClick:v,disabled:y,className:"flex-1 px-4 py-2 bg-[#4E6E49] hover:bg-[#4E6E49] disabled:bg-gray-400 disabled:cursor-not-allowed text-white rounded-lg transition-colors",children:y?"Сохранение...":"Сохранить"}),n.jsx("button",{onClick:e,className:`px-4 py-2 rounded-lg transition-colors ${C}`,children:"Отмена"})]})]})})]})})};/*!
 * @kurkle/color v0.3.4
 * https://github.com/kurkle/color#readme
 * (c) 2024 Jukka Kurkela
 * Released under the MIT License
 */function uo(s){return s+.5|0}const rn=(s,e,t)=>Math.max(Math.min(s,t),e);function hi(s){return rn(uo(s*2.55),0,255)}function un(s){return rn(uo(s*255),0,255)}function wr(s){return rn(uo(s/2.55)/100,0,1)}function uf(s){return rn(uo(s*100),0,100)}const Ds={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,A:10,B:11,C:12,D:13,E:14,F:15,a:10,b:11,c:12,d:13,e:14,f:15},Xd=[..."0123456789ABCDEF"],RS=s=>Xd[s&15],PS=s=>Xd[(s&240)>>4]+Xd[s&15],Oo=s=>(s&240)>>4===(s&15),OS=s=>Oo(s.r)&&Oo(s.g)&&Oo(s.b)&&Oo(s.a);function LS(s){var e=s.length,t;return s[0]==="#"&&(e===4||e===5?t={r:255&Ds[s[1]]*17,g:255&Ds[s[2]]*17,b:255&Ds[s[3]]*17,a:e===5?Ds[s[4]]*17:255}:(e===7||e===9)&&(t={r:Ds[s[1]]<<4|Ds[s[2]],g:Ds[s[3]]<<4|Ds[s[4]],b:Ds[s[5]]<<4|Ds[s[6]],a:e===9?Ds[s[7]]<<4|Ds[s[8]]:255})),t}const VS=(s,e)=>s<255?e(s):"";function FS(s){var e=OS(s)?RS:PS;return s?"#"+e(s.r)+e(s.g)+e(s.b)+VS(s.a,e):void 0}const US=/^(hsla?|hwb|hsv)\(\s*([-+.e\d]+)(?:deg)?[\s,]+([-+.e\d]+)%[\s,]+([-+.e\d]+)%(?:[\s,]+([-+.e\d]+)(%)?)?\s*\)$/;function Mb(s,e,t){const r=e*Math.min(t,1-t),a=(i,o=(i+s/30)%12)=>t-r*Math.max(Math.min(o-3,9-o,1),-1);return[a(0),a(8),a(4)]}function BS(s,e,t){const r=(a,i=(a+s/60)%6)=>t-t*e*Math.max(Math.min(i,4-i,1),0);return[r(5),r(3),r(1)]}function zS(s,e,t){const r=Mb(s,1,.5);let a;for(e+t>1&&(a=1/(e+t),e*=a,t*=a),a=0;a<3;a++)r[a]*=1-e-t,r[a]+=e;return r}function HS(s,e,t,r,a){return s===a?(e-t)/r+(e<t?6:0):e===a?(t-s)/r+2:(s-e)/r+4}function vu(s){const t=s.r/255,r=s.g/255,a=s.b/255,i=Math.max(t,r,a),o=Math.min(t,r,a),l=(i+o)/2;let c,h,u;return i!==o&&(u=i-o,h=l>.5?u/(2-i-o):u/(i+o),c=HS(t,r,a,u,i),c=c*60+.5),[c|0,h||0,l]}function wu(s,e,t,r){return(Array.isArray(e)?s(e[0],e[1],e[2]):s(e,t,r)).map(un)}function ku(s,e,t){return wu(Mb,s,e,t)}function WS(s,e,t){return wu(zS,s,e,t)}function qS(s,e,t){return wu(BS,s,e,t)}function $b(s){return(s%360+360)%360}function GS(s){const e=US.exec(s);let t=255,r;if(!e)return;e[5]!==r&&(t=e[6]?hi(+e[5]):un(+e[5]));const a=$b(+e[2]),i=+e[3]/100,o=+e[4]/100;return e[1]==="hwb"?r=WS(a,i,o):e[1]==="hsv"?r=qS(a,i,o):r=ku(a,i,o),{r:r[0],g:r[1],b:r[2],a:t}}function KS(s,e){var t=vu(s);t[0]=$b(t[0]+e),t=ku(t),s.r=t[0],s.g=t[1],s.b=t[2]}function YS(s){if(!s)return;const e=vu(s),t=e[0],r=uf(e[1]),a=uf(e[2]);return s.a<255?`hsla(${t}, ${r}%, ${a}%, ${wr(s.a)})`:`hsl(${t}, ${r}%, ${a}%)`}const mf={x:"dark",Z:"light",Y:"re",X:"blu",W:"gr",V:"medium",U:"slate",A:"ee",T:"ol",S:"or",B:"ra",C:"lateg",D:"ights",R:"in",Q:"turquois",E:"hi",P:"ro",O:"al",N:"le",M:"de",L:"yello",F:"en",K:"ch",G:"arks",H:"ea",I:"ightg",J:"wh"},gf={OiceXe:"f0f8ff",antiquewEte:"faebd7",aqua:"ffff",aquamarRe:"7fffd4",azuY:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"0",blanKedOmond:"ffebcd",Xe:"ff",XeviTet:"8a2be2",bPwn:"a52a2a",burlywood:"deb887",caMtXe:"5f9ea0",KartYuse:"7fff00",KocTate:"d2691e",cSO:"ff7f50",cSnflowerXe:"6495ed",cSnsilk:"fff8dc",crimson:"dc143c",cyan:"ffff",xXe:"8b",xcyan:"8b8b",xgTMnPd:"b8860b",xWay:"a9a9a9",xgYF:"6400",xgYy:"a9a9a9",xkhaki:"bdb76b",xmagFta:"8b008b",xTivegYF:"556b2f",xSange:"ff8c00",xScEd:"9932cc",xYd:"8b0000",xsOmon:"e9967a",xsHgYF:"8fbc8f",xUXe:"483d8b",xUWay:"2f4f4f",xUgYy:"2f4f4f",xQe:"ced1",xviTet:"9400d3",dAppRk:"ff1493",dApskyXe:"bfff",dimWay:"696969",dimgYy:"696969",dodgerXe:"1e90ff",fiYbrick:"b22222",flSOwEte:"fffaf0",foYstWAn:"228b22",fuKsia:"ff00ff",gaRsbSo:"dcdcdc",ghostwEte:"f8f8ff",gTd:"ffd700",gTMnPd:"daa520",Way:"808080",gYF:"8000",gYFLw:"adff2f",gYy:"808080",honeyMw:"f0fff0",hotpRk:"ff69b4",RdianYd:"cd5c5c",Rdigo:"4b0082",ivSy:"fffff0",khaki:"f0e68c",lavFMr:"e6e6fa",lavFMrXsh:"fff0f5",lawngYF:"7cfc00",NmoncEffon:"fffacd",ZXe:"add8e6",ZcSO:"f08080",Zcyan:"e0ffff",ZgTMnPdLw:"fafad2",ZWay:"d3d3d3",ZgYF:"90ee90",ZgYy:"d3d3d3",ZpRk:"ffb6c1",ZsOmon:"ffa07a",ZsHgYF:"20b2aa",ZskyXe:"87cefa",ZUWay:"778899",ZUgYy:"778899",ZstAlXe:"b0c4de",ZLw:"ffffe0",lime:"ff00",limegYF:"32cd32",lRF:"faf0e6",magFta:"ff00ff",maPon:"800000",VaquamarRe:"66cdaa",VXe:"cd",VScEd:"ba55d3",VpurpN:"9370db",VsHgYF:"3cb371",VUXe:"7b68ee",VsprRggYF:"fa9a",VQe:"48d1cc",VviTetYd:"c71585",midnightXe:"191970",mRtcYam:"f5fffa",mistyPse:"ffe4e1",moccasR:"ffe4b5",navajowEte:"ffdead",navy:"80",Tdlace:"fdf5e6",Tive:"808000",TivedBb:"6b8e23",Sange:"ffa500",SangeYd:"ff4500",ScEd:"da70d6",pOegTMnPd:"eee8aa",pOegYF:"98fb98",pOeQe:"afeeee",pOeviTetYd:"db7093",papayawEp:"ffefd5",pHKpuff:"ffdab9",peru:"cd853f",pRk:"ffc0cb",plum:"dda0dd",powMrXe:"b0e0e6",purpN:"800080",YbeccapurpN:"663399",Yd:"ff0000",Psybrown:"bc8f8f",PyOXe:"4169e1",saddNbPwn:"8b4513",sOmon:"fa8072",sandybPwn:"f4a460",sHgYF:"2e8b57",sHshell:"fff5ee",siFna:"a0522d",silver:"c0c0c0",skyXe:"87ceeb",UXe:"6a5acd",UWay:"708090",UgYy:"708090",snow:"fffafa",sprRggYF:"ff7f",stAlXe:"4682b4",tan:"d2b48c",teO:"8080",tEstN:"d8bfd8",tomato:"ff6347",Qe:"40e0d0",viTet:"ee82ee",JHt:"f5deb3",wEte:"ffffff",wEtesmoke:"f5f5f5",Lw:"ffff00",LwgYF:"9acd32"};function QS(){const s={},e=Object.keys(gf),t=Object.keys(mf);let r,a,i,o,l;for(r=0;r<e.length;r++){for(o=l=e[r],a=0;a<t.length;a++)i=t[a],l=l.replace(i,mf[i]);i=parseInt(gf[o],16),s[l]=[i>>16&255,i>>8&255,i&255]}return s}let Lo;function XS(s){Lo||(Lo=QS(),Lo.transparent=[0,0,0,0]);const e=Lo[s.toLowerCase()];return e&&{r:e[0],g:e[1],b:e[2],a:e.length===4?e[3]:255}}const JS=/^rgba?\(\s*([-+.\d]+)(%)?[\s,]+([-+.e\d]+)(%)?[\s,]+([-+.e\d]+)(%)?(?:[\s,/]+([-+.e\d]+)(%)?)?\s*\)$/;function ZS(s){const e=JS.exec(s);let t=255,r,a,i;if(e){if(e[7]!==r){const o=+e[7];t=e[8]?hi(o):rn(o*255,0,255)}return r=+e[1],a=+e[3],i=+e[5],r=255&(e[2]?hi(r):rn(r,0,255)),a=255&(e[4]?hi(a):rn(a,0,255)),i=255&(e[6]?hi(i):rn(i,0,255)),{r,g:a,b:i,a:t}}}function eT(s){return s&&(s.a<255?`rgba(${s.r}, ${s.g}, ${s.b}, ${wr(s.a)})`:`rgb(${s.r}, ${s.g}, ${s.b})`)}const ad=s=>s<=.0031308?s*12.92:Math.pow(s,1/2.4)*1.055-.055,ra=s=>s<=.04045?s/12.92:Math.pow((s+.055)/1.055,2.4);function tT(s,e,t){const r=ra(wr(s.r)),a=ra(wr(s.g)),i=ra(wr(s.b));return{r:un(ad(r+t*(ra(wr(e.r))-r))),g:un(ad(a+t*(ra(wr(e.g))-a))),b:un(ad(i+t*(ra(wr(e.b))-i))),a:s.a+t*(e.a-s.a)}}function Vo(s,e,t){if(s){let r=vu(s);r[e]=Math.max(0,Math.min(r[e]+r[e]*t,e===0?360:1)),r=ku(r),s.r=r[0],s.g=r[1],s.b=r[2]}}function Rb(s,e){return s&&Object.assign(e||{},s)}function ff(s){var e={r:0,g:0,b:0,a:255};return Array.isArray(s)?s.length>=3&&(e={r:s[0],g:s[1],b:s[2],a:255},s.length>3&&(e.a=un(s[3]))):(e=Rb(s,{r:0,g:0,b:0,a:1}),e.a=un(e.a)),e}function sT(s){return s.charAt(0)==="r"?ZS(s):GS(s)}class Bi{constructor(e){if(e instanceof Bi)return e;const t=typeof e;let r;t==="object"?r=ff(e):t==="string"&&(r=LS(e)||XS(e)||sT(e)),this._rgb=r,this._valid=!!r}get valid(){return this._valid}get rgb(){var e=Rb(this._rgb);return e&&(e.a=wr(e.a)),e}set rgb(e){this._rgb=ff(e)}rgbString(){return this._valid?eT(this._rgb):void 0}hexString(){return this._valid?FS(this._rgb):void 0}hslString(){return this._valid?YS(this._rgb):void 0}mix(e,t){if(e){const r=this.rgb,a=e.rgb;let i;const o=t===i?.5:t,l=2*o-1,c=r.a-a.a,h=((l*c===-1?l:(l+c)/(1+l*c))+1)/2;i=1-h,r.r=255&h*r.r+i*a.r+.5,r.g=255&h*r.g+i*a.g+.5,r.b=255&h*r.b+i*a.b+.5,r.a=o*r.a+(1-o)*a.a,this.rgb=r}return this}interpolate(e,t){return e&&(this._rgb=tT(this._rgb,e._rgb,t)),this}clone(){return new Bi(this.rgb)}alpha(e){return this._rgb.a=un(e),this}clearer(e){const t=this._rgb;return t.a*=1-e,this}greyscale(){const e=this._rgb,t=uo(e.r*.3+e.g*.59+e.b*.11);return e.r=e.g=e.b=t,this}opaquer(e){const t=this._rgb;return t.a*=1+e,this}negate(){const e=this._rgb;return e.r=255-e.r,e.g=255-e.g,e.b=255-e.b,this}lighten(e){return Vo(this._rgb,2,e),this}darken(e){return Vo(this._rgb,2,-e),this}saturate(e){return Vo(this._rgb,1,e),this}desaturate(e){return Vo(this._rgb,1,-e),this}rotate(e){return KS(this._rgb,e),this}}/*!
 * Chart.js v4.5.1
 * https://www.chartjs.org
 * (c) 2025 Chart.js Contributors
 * Released under the MIT License
 */function fr(){}const rT=(()=>{let s=0;return()=>s++})();function kt(s){return s==null}function Wt(s){if(Array.isArray&&Array.isArray(s))return!0;const e=Object.prototype.toString.call(s);return e.slice(0,7)==="[object"&&e.slice(-6)==="Array]"}function gt(s){return s!==null&&Object.prototype.toString.call(s)==="[object Object]"}function Fs(s){return(typeof s=="number"||s instanceof Number)&&isFinite(+s)}function Ys(s,e){return Fs(s)?s:e}function ot(s,e){return typeof s>"u"?e:s}const nT=(s,e)=>typeof s=="string"&&s.endsWith("%")?parseFloat(s)/100*e:+s;function jt(s,e,t){if(s&&typeof s.call=="function")return s.apply(t,e)}function pt(s,e,t,r){let a,i,o;if(Wt(s))for(i=s.length,a=0;a<i;a++)e.call(t,s[a],a);else if(gt(s))for(o=Object.keys(s),i=o.length,a=0;a<i;a++)e.call(t,s[o[a]],o[a])}function Ll(s,e){let t,r,a,i;if(!s||!e||s.length!==e.length)return!1;for(t=0,r=s.length;t<r;++t)if(a=s[t],i=e[t],a.datasetIndex!==i.datasetIndex||a.index!==i.index)return!1;return!0}function Vl(s){if(Wt(s))return s.map(Vl);if(gt(s)){const e=Object.create(null),t=Object.keys(s),r=t.length;let a=0;for(;a<r;++a)e[t[a]]=Vl(s[t[a]]);return e}return s}function Pb(s){return["__proto__","prototype","constructor"].indexOf(s)===-1}function aT(s,e,t,r){if(!Pb(s))return;const a=e[s],i=t[s];gt(a)&&gt(i)?zi(a,i,r):e[s]=Vl(i)}function zi(s,e,t){const r=Wt(e)?e:[e],a=r.length;if(!gt(s))return s;t=t||{};const i=t.merger||aT;let o;for(let l=0;l<a;++l){if(o=r[l],!gt(o))continue;const c=Object.keys(o);for(let h=0,u=c.length;h<u;++h)i(c[h],s,o,t)}return s}function ki(s,e){return zi(s,e,{merger:iT})}function iT(s,e,t){if(!Pb(s))return;const r=e[s],a=t[s];gt(r)&&gt(a)?ki(r,a):Object.prototype.hasOwnProperty.call(e,s)||(e[s]=Vl(a))}const pf={"":s=>s,x:s=>s.x,y:s=>s.y};function oT(s){const e=s.split("."),t=[];let r="";for(const a of e)r+=a,r.endsWith("\\")?r=r.slice(0,-1)+".":(t.push(r),r="");return t}function lT(s){const e=oT(s);return t=>{for(const r of e){if(r==="")break;t=t&&t[r]}return t}}function Fl(s,e){return(pf[e]||(pf[e]=lT(e)))(s)}function _u(s){return s.charAt(0).toUpperCase()+s.slice(1)}const Ul=s=>typeof s<"u",bn=s=>typeof s=="function",xf=(s,e)=>{if(s.size!==e.size)return!1;for(const t of s)if(!e.has(t))return!1;return!0};function cT(s){return s.type==="mouseup"||s.type==="click"||s.type==="contextmenu"}const Gt=Math.PI,ir=2*Gt,dT=ir+Gt,Bl=Number.POSITIVE_INFINITY,hT=Gt/180,Ws=Gt/2,_n=Gt/4,bf=Gt*2/3,Ob=Math.log10,Ca=Math.sign;function _i(s,e,t){return Math.abs(s-e)<t}function yf(s){const e=Math.round(s);s=_i(s,e,s/1e3)?e:s;const t=Math.pow(10,Math.floor(Ob(s))),r=s/t;return(r<=1?1:r<=2?2:r<=5?5:10)*t}function uT(s){const e=[],t=Math.sqrt(s);let r;for(r=1;r<t;r++)s%r===0&&(e.push(r),e.push(s/r));return t===(t|0)&&e.push(t),e.sort((a,i)=>a-i).pop(),e}function mT(s){return typeof s=="symbol"||typeof s=="object"&&s!==null&&!(Symbol.toPrimitive in s||"toString"in s||"valueOf"in s)}function Hi(s){return!mT(s)&&!isNaN(parseFloat(s))&&isFinite(s)}function gT(s,e){const t=Math.round(s);return t-e<=s&&t+e>=s}function fT(s,e,t){let r,a,i;for(r=0,a=s.length;r<a;r++)i=s[r][t],isNaN(i)||(e.min=Math.min(e.min,i),e.max=Math.max(e.max,i))}function Cn(s){return s*(Gt/180)}function pT(s){return s*(180/Gt)}function vf(s){if(!Fs(s))return;let e=1,t=0;for(;Math.round(s*e)/e!==s;)e*=10,t++;return t}function xT(s,e){const t=e.x-s.x,r=e.y-s.y,a=Math.sqrt(t*t+r*r);let i=Math.atan2(r,t);return i<-.5*Gt&&(i+=ir),{angle:i,distance:a}}function Jd(s,e){return Math.sqrt(Math.pow(e.x-s.x,2)+Math.pow(e.y-s.y,2))}function bT(s,e){return(s-e+dT)%ir-Gt}function Kr(s){return(s%ir+ir)%ir}function Lb(s,e,t,r){const a=Kr(s),i=Kr(e),o=Kr(t),l=Kr(i-a),c=Kr(o-a),h=Kr(a-i),u=Kr(a-o);return a===i||a===o||r&&i===o||l>c&&h<u}function Ps(s,e,t){return Math.max(e,Math.min(t,s))}function yT(s){return Ps(s,-32768,32767)}function ui(s,e,t,r=1e-6){return s>=Math.min(e,t)-r&&s<=Math.max(e,t)+r}function Nu(s,e,t){t=t||(o=>s[o]<e);let r=s.length-1,a=0,i;for(;r-a>1;)i=a+r>>1,t(i)?a=i:r=i;return{lo:a,hi:r}}const Dn=(s,e,t,r)=>Nu(s,t,r?a=>{const i=s[a][e];return i<t||i===t&&s[a+1][e]===t}:a=>s[a][e]<t),vT=(s,e,t)=>Nu(s,t,r=>s[r][e]>=t);function wT(s,e,t){let r=0,a=s.length;for(;r<a&&s[r]<e;)r++;for(;a>r&&s[a-1]>t;)a--;return r>0||a<s.length?s.slice(r,a):s}const Vb=["push","pop","shift","splice","unshift"];function kT(s,e){if(s._chartjs){s._chartjs.listeners.push(e);return}Object.defineProperty(s,"_chartjs",{configurable:!0,enumerable:!1,value:{listeners:[e]}}),Vb.forEach(t=>{const r="_onData"+_u(t),a=s[t];Object.defineProperty(s,t,{configurable:!0,enumerable:!1,value(...i){const o=a.apply(this,i);return s._chartjs.listeners.forEach(l=>{typeof l[r]=="function"&&l[r](...i)}),o}})})}function wf(s,e){const t=s._chartjs;if(!t)return;const r=t.listeners,a=r.indexOf(e);a!==-1&&r.splice(a,1),!(r.length>0)&&(Vb.forEach(i=>{delete s[i]}),delete s._chartjs)}function _T(s){const e=new Set(s);return e.size===s.length?s:Array.from(e)}const Fb=function(){return typeof window>"u"?function(s){return s()}:window.requestAnimationFrame}();function Ub(s,e){let t=[],r=!1;return function(...a){t=a,r||(r=!0,Fb.call(window,()=>{r=!1,s.apply(e,t)}))}}function NT(s,e){let t;return function(...r){return e?(clearTimeout(t),t=setTimeout(s,e,r)):s.apply(this,r),e}}const ju=s=>s==="start"?"left":s==="end"?"right":"center",as=(s,e,t)=>s==="start"?e:s==="end"?t:(e+t)/2,jT=(s,e,t,r)=>s===(r?"left":"right")?t:s==="center"?(e+t)/2:e;function ET(s,e,t){const r=e.length;let a=0,i=r;if(s._sorted){const{iScale:o,vScale:l,_parsed:c}=s,h=s.dataset&&s.dataset.options?s.dataset.options.spanGaps:null,u=o.axis,{min:m,max:g,minDefined:p,maxDefined:j}=o.getUserBounds();if(p){if(a=Math.min(Dn(c,u,m).lo,t?r:Dn(e,u,o.getPixelForValue(m)).lo),h){const _=c.slice(0,a+1).reverse().findIndex(y=>!kt(y[l.axis]));a-=Math.max(0,_)}a=Ps(a,0,r-1)}if(j){let _=Math.max(Dn(c,o.axis,g,!0).hi+1,t?0:Dn(e,u,o.getPixelForValue(g),!0).hi+1);if(h){const y=c.slice(_-1).findIndex(M=>!kt(M[l.axis]));_+=Math.max(0,y)}i=Ps(_,a,r)-a}else i=r-a}return{start:a,count:i}}function ST(s){const{xScale:e,yScale:t,_scaleRanges:r}=s,a={xmin:e.min,xmax:e.max,ymin:t.min,ymax:t.max};if(!r)return s._scaleRanges=a,!0;const i=r.xmin!==e.min||r.xmax!==e.max||r.ymin!==t.min||r.ymax!==t.max;return Object.assign(r,a),i}const Fo=s=>s===0||s===1,kf=(s,e,t)=>-(Math.pow(2,10*(s-=1))*Math.sin((s-e)*ir/t)),_f=(s,e,t)=>Math.pow(2,-10*s)*Math.sin((s-e)*ir/t)+1,Ni={linear:s=>s,easeInQuad:s=>s*s,easeOutQuad:s=>-s*(s-2),easeInOutQuad:s=>(s/=.5)<1?.5*s*s:-.5*(--s*(s-2)-1),easeInCubic:s=>s*s*s,easeOutCubic:s=>(s-=1)*s*s+1,easeInOutCubic:s=>(s/=.5)<1?.5*s*s*s:.5*((s-=2)*s*s+2),easeInQuart:s=>s*s*s*s,easeOutQuart:s=>-((s-=1)*s*s*s-1),easeInOutQuart:s=>(s/=.5)<1?.5*s*s*s*s:-.5*((s-=2)*s*s*s-2),easeInQuint:s=>s*s*s*s*s,easeOutQuint:s=>(s-=1)*s*s*s*s+1,easeInOutQuint:s=>(s/=.5)<1?.5*s*s*s*s*s:.5*((s-=2)*s*s*s*s+2),easeInSine:s=>-Math.cos(s*Ws)+1,easeOutSine:s=>Math.sin(s*Ws),easeInOutSine:s=>-.5*(Math.cos(Gt*s)-1),easeInExpo:s=>s===0?0:Math.pow(2,10*(s-1)),easeOutExpo:s=>s===1?1:-Math.pow(2,-10*s)+1,easeInOutExpo:s=>Fo(s)?s:s<.5?.5*Math.pow(2,10*(s*2-1)):.5*(-Math.pow(2,-10*(s*2-1))+2),easeInCirc:s=>s>=1?s:-(Math.sqrt(1-s*s)-1),easeOutCirc:s=>Math.sqrt(1-(s-=1)*s),easeInOutCirc:s=>(s/=.5)<1?-.5*(Math.sqrt(1-s*s)-1):.5*(Math.sqrt(1-(s-=2)*s)+1),easeInElastic:s=>Fo(s)?s:kf(s,.075,.3),easeOutElastic:s=>Fo(s)?s:_f(s,.075,.3),easeInOutElastic(s){return Fo(s)?s:s<.5?.5*kf(s*2,.1125,.45):.5+.5*_f(s*2-1,.1125,.45)},easeInBack(s){return s*s*((1.70158+1)*s-1.70158)},easeOutBack(s){return(s-=1)*s*((1.70158+1)*s+1.70158)+1},easeInOutBack(s){let e=1.70158;return(s/=.5)<1?.5*(s*s*(((e*=1.525)+1)*s-e)):.5*((s-=2)*s*(((e*=1.525)+1)*s+e)+2)},easeInBounce:s=>1-Ni.easeOutBounce(1-s),easeOutBounce(s){return s<1/2.75?7.5625*s*s:s<2/2.75?7.5625*(s-=1.5/2.75)*s+.75:s<2.5/2.75?7.5625*(s-=2.25/2.75)*s+.9375:7.5625*(s-=2.625/2.75)*s+.984375},easeInOutBounce:s=>s<.5?Ni.easeInBounce(s*2)*.5:Ni.easeOutBounce(s*2-1)*.5+.5};function Eu(s){if(s&&typeof s=="object"){const e=s.toString();return e==="[object CanvasPattern]"||e==="[object CanvasGradient]"}return!1}function Nf(s){return Eu(s)?s:new Bi(s)}function id(s){return Eu(s)?s:new Bi(s).saturate(.5).darken(.1).hexString()}const TT=["x","y","borderWidth","radius","tension"],IT=["color","borderColor","backgroundColor"];function AT(s){s.set("animation",{delay:void 0,duration:1e3,easing:"easeOutQuart",fn:void 0,from:void 0,loop:void 0,to:void 0,type:void 0}),s.describe("animation",{_fallback:!1,_indexable:!1,_scriptable:e=>e!=="onProgress"&&e!=="onComplete"&&e!=="fn"}),s.set("animations",{colors:{type:"color",properties:IT},numbers:{type:"number",properties:TT}}),s.describe("animations",{_fallback:"animation"}),s.set("transitions",{active:{animation:{duration:400}},resize:{animation:{duration:0}},show:{animations:{colors:{from:"transparent"},visible:{type:"boolean",duration:0}}},hide:{animations:{colors:{to:"transparent"},visible:{type:"boolean",easing:"linear",fn:e=>e|0}}}})}function CT(s){s.set("layout",{autoPadding:!0,padding:{top:0,right:0,bottom:0,left:0}})}const jf=new Map;function DT(s,e){e=e||{};const t=s+JSON.stringify(e);let r=jf.get(t);return r||(r=new Intl.NumberFormat(s,e),jf.set(t,r)),r}function Bb(s,e,t){return DT(e,t).format(s)}const MT={values(s){return Wt(s)?s:""+s},numeric(s,e,t){if(s===0)return"0";const r=this.chart.options.locale;let a,i=s;if(t.length>1){const h=Math.max(Math.abs(t[0].value),Math.abs(t[t.length-1].value));(h<1e-4||h>1e15)&&(a="scientific"),i=$T(s,t)}const o=Ob(Math.abs(i)),l=isNaN(o)?1:Math.max(Math.min(-1*Math.floor(o),20),0),c={notation:a,minimumFractionDigits:l,maximumFractionDigits:l};return Object.assign(c,this.options.ticks.format),Bb(s,r,c)}};function $T(s,e){let t=e.length>3?e[2].value-e[1].value:e[1].value-e[0].value;return Math.abs(t)>=1&&s!==Math.floor(s)&&(t=s-Math.floor(s)),t}var zb={formatters:MT};function RT(s){s.set("scale",{display:!0,offset:!1,reverse:!1,beginAtZero:!1,bounds:"ticks",clip:!0,grace:0,grid:{display:!0,lineWidth:1,drawOnChartArea:!0,drawTicks:!0,tickLength:8,tickWidth:(e,t)=>t.lineWidth,tickColor:(e,t)=>t.color,offset:!1},border:{display:!0,dash:[],dashOffset:0,width:1},title:{display:!1,text:"",padding:{top:4,bottom:4}},ticks:{minRotation:0,maxRotation:50,mirror:!1,textStrokeWidth:0,textStrokeColor:"",padding:3,display:!0,autoSkip:!0,autoSkipPadding:3,labelOffset:0,callback:zb.formatters.values,minor:{},major:{},align:"center",crossAlign:"near",showLabelBackdrop:!1,backdropColor:"rgba(255, 255, 255, 0.75)",backdropPadding:2}}),s.route("scale.ticks","color","","color"),s.route("scale.grid","color","","borderColor"),s.route("scale.border","color","","borderColor"),s.route("scale.title","color","","color"),s.describe("scale",{_fallback:!1,_scriptable:e=>!e.startsWith("before")&&!e.startsWith("after")&&e!=="callback"&&e!=="parser",_indexable:e=>e!=="borderDash"&&e!=="tickBorderDash"&&e!=="dash"}),s.describe("scales",{_fallback:"scale"}),s.describe("scale.ticks",{_scriptable:e=>e!=="backdropPadding"&&e!=="callback",_indexable:e=>e!=="backdropPadding"})}const Wn=Object.create(null),Zd=Object.create(null);function ji(s,e){if(!e)return s;const t=e.split(".");for(let r=0,a=t.length;r<a;++r){const i=t[r];s=s[i]||(s[i]=Object.create(null))}return s}function od(s,e,t){return typeof e=="string"?zi(ji(s,e),t):zi(ji(s,""),e)}class PT{constructor(e,t){this.animation=void 0,this.backgroundColor="rgba(0,0,0,0.1)",this.borderColor="rgba(0,0,0,0.1)",this.color="#666",this.datasets={},this.devicePixelRatio=r=>r.chart.platform.getDevicePixelRatio(),this.elements={},this.events=["mousemove","mouseout","click","touchstart","touchmove"],this.font={family:"'Helvetica Neue', 'Helvetica', 'Arial', sans-serif",size:12,style:"normal",lineHeight:1.2,weight:null},this.hover={},this.hoverBackgroundColor=(r,a)=>id(a.backgroundColor),this.hoverBorderColor=(r,a)=>id(a.borderColor),this.hoverColor=(r,a)=>id(a.color),this.indexAxis="x",this.interaction={mode:"nearest",intersect:!0,includeInvisible:!1},this.maintainAspectRatio=!0,this.onHover=null,this.onClick=null,this.parsing=!0,this.plugins={},this.responsive=!0,this.scale=void 0,this.scales={},this.showLine=!0,this.drawActiveElementsOnTop=!0,this.describe(e),this.apply(t)}set(e,t){return od(this,e,t)}get(e){return ji(this,e)}describe(e,t){return od(Zd,e,t)}override(e,t){return od(Wn,e,t)}route(e,t,r,a){const i=ji(this,e),o=ji(this,r),l="_"+t;Object.defineProperties(i,{[l]:{value:i[t],writable:!0},[t]:{enumerable:!0,get(){const c=this[l],h=o[a];return gt(c)?Object.assign({},h,c):ot(c,h)},set(c){this[l]=c}}})}apply(e){e.forEach(t=>t(this))}}var Pt=new PT({_scriptable:s=>!s.startsWith("on"),_indexable:s=>s!=="events",hover:{_fallback:"interaction"},interaction:{_scriptable:!1,_indexable:!1}},[AT,CT,RT]);function OT(s){return!s||kt(s.size)||kt(s.family)?null:(s.style?s.style+" ":"")+(s.weight?s.weight+" ":"")+s.size+"px "+s.family}function Ef(s,e,t,r,a){let i=e[a];return i||(i=e[a]=s.measureText(a).width,t.push(a)),i>r&&(r=i),r}function Nn(s,e,t){const r=s.currentDevicePixelRatio,a=t!==0?Math.max(t/2,.5):0;return Math.round((e-a)*r)/r+a}function Sf(s,e){!e&&!s||(e=e||s.getContext("2d"),e.save(),e.resetTransform(),e.clearRect(0,0,s.width,s.height),e.restore())}function eh(s,e,t,r){Hb(s,e,t,r,null)}function Hb(s,e,t,r,a){let i,o,l,c,h,u,m,g;const p=e.pointStyle,j=e.rotation,_=e.radius;let y=(j||0)*hT;if(p&&typeof p=="object"&&(i=p.toString(),i==="[object HTMLImageElement]"||i==="[object HTMLCanvasElement]")){s.save(),s.translate(t,r),s.rotate(y),s.drawImage(p,-p.width/2,-p.height/2,p.width,p.height),s.restore();return}if(!(isNaN(_)||_<=0)){switch(s.beginPath(),p){default:a?s.ellipse(t,r,a/2,_,0,0,ir):s.arc(t,r,_,0,ir),s.closePath();break;case"triangle":u=a?a/2:_,s.moveTo(t+Math.sin(y)*u,r-Math.cos(y)*_),y+=bf,s.lineTo(t+Math.sin(y)*u,r-Math.cos(y)*_),y+=bf,s.lineTo(t+Math.sin(y)*u,r-Math.cos(y)*_),s.closePath();break;case"rectRounded":h=_*.516,c=_-h,o=Math.cos(y+_n)*c,m=Math.cos(y+_n)*(a?a/2-h:c),l=Math.sin(y+_n)*c,g=Math.sin(y+_n)*(a?a/2-h:c),s.arc(t-m,r-l,h,y-Gt,y-Ws),s.arc(t+g,r-o,h,y-Ws,y),s.arc(t+m,r+l,h,y,y+Ws),s.arc(t-g,r+o,h,y+Ws,y+Gt),s.closePath();break;case"rect":if(!j){c=Math.SQRT1_2*_,u=a?a/2:c,s.rect(t-u,r-c,2*u,2*c);break}y+=_n;case"rectRot":m=Math.cos(y)*(a?a/2:_),o=Math.cos(y)*_,l=Math.sin(y)*_,g=Math.sin(y)*(a?a/2:_),s.moveTo(t-m,r-l),s.lineTo(t+g,r-o),s.lineTo(t+m,r+l),s.lineTo(t-g,r+o),s.closePath();break;case"crossRot":y+=_n;case"cross":m=Math.cos(y)*(a?a/2:_),o=Math.cos(y)*_,l=Math.sin(y)*_,g=Math.sin(y)*(a?a/2:_),s.moveTo(t-m,r-l),s.lineTo(t+m,r+l),s.moveTo(t+g,r-o),s.lineTo(t-g,r+o);break;case"star":m=Math.cos(y)*(a?a/2:_),o=Math.cos(y)*_,l=Math.sin(y)*_,g=Math.sin(y)*(a?a/2:_),s.moveTo(t-m,r-l),s.lineTo(t+m,r+l),s.moveTo(t+g,r-o),s.lineTo(t-g,r+o),y+=_n,m=Math.cos(y)*(a?a/2:_),o=Math.cos(y)*_,l=Math.sin(y)*_,g=Math.sin(y)*(a?a/2:_),s.moveTo(t-m,r-l),s.lineTo(t+m,r+l),s.moveTo(t+g,r-o),s.lineTo(t-g,r+o);break;case"line":o=a?a/2:Math.cos(y)*_,l=Math.sin(y)*_,s.moveTo(t-o,r-l),s.lineTo(t+o,r+l);break;case"dash":s.moveTo(t,r),s.lineTo(t+Math.cos(y)*(a?a/2:_),r+Math.sin(y)*_);break;case!1:s.closePath();break}s.fill(),e.borderWidth>0&&s.stroke()}}function Wi(s,e,t){return t=t||.5,!e||s&&s.x>e.left-t&&s.x<e.right+t&&s.y>e.top-t&&s.y<e.bottom+t}function Su(s,e){s.save(),s.beginPath(),s.rect(e.left,e.top,e.right-e.left,e.bottom-e.top),s.clip()}function Tu(s){s.restore()}function LT(s,e,t,r,a){if(!e)return s.lineTo(t.x,t.y);if(a==="middle"){const i=(e.x+t.x)/2;s.lineTo(i,e.y),s.lineTo(i,t.y)}else a==="after"!=!!r?s.lineTo(e.x,t.y):s.lineTo(t.x,e.y);s.lineTo(t.x,t.y)}function VT(s,e,t,r){if(!e)return s.lineTo(t.x,t.y);s.bezierCurveTo(r?e.cp1x:e.cp2x,r?e.cp1y:e.cp2y,r?t.cp2x:t.cp1x,r?t.cp2y:t.cp1y,t.x,t.y)}function FT(s,e){e.translation&&s.translate(e.translation[0],e.translation[1]),kt(e.rotation)||s.rotate(e.rotation),e.color&&(s.fillStyle=e.color),e.textAlign&&(s.textAlign=e.textAlign),e.textBaseline&&(s.textBaseline=e.textBaseline)}function UT(s,e,t,r,a){if(a.strikethrough||a.underline){const i=s.measureText(r),o=e-i.actualBoundingBoxLeft,l=e+i.actualBoundingBoxRight,c=t-i.actualBoundingBoxAscent,h=t+i.actualBoundingBoxDescent,u=a.strikethrough?(c+h)/2:h;s.strokeStyle=s.fillStyle,s.beginPath(),s.lineWidth=a.decorationWidth||2,s.moveTo(o,u),s.lineTo(l,u),s.stroke()}}function BT(s,e){const t=s.fillStyle;s.fillStyle=e.color,s.fillRect(e.left,e.top,e.width,e.height),s.fillStyle=t}function qi(s,e,t,r,a,i={}){const o=Wt(e)?e:[e],l=i.strokeWidth>0&&i.strokeColor!=="";let c,h;for(s.save(),s.font=a.string,FT(s,i),c=0;c<o.length;++c)h=o[c],i.backdrop&&BT(s,i.backdrop),l&&(i.strokeColor&&(s.strokeStyle=i.strokeColor),kt(i.strokeWidth)||(s.lineWidth=i.strokeWidth),s.strokeText(h,t,r,i.maxWidth)),s.fillText(h,t,r,i.maxWidth),UT(s,t,r,h,i),r+=Number(a.lineHeight);s.restore()}function th(s,e){const{x:t,y:r,w:a,h:i,radius:o}=e;s.arc(t+o.topLeft,r+o.topLeft,o.topLeft,1.5*Gt,Gt,!0),s.lineTo(t,r+i-o.bottomLeft),s.arc(t+o.bottomLeft,r+i-o.bottomLeft,o.bottomLeft,Gt,Ws,!0),s.lineTo(t+a-o.bottomRight,r+i),s.arc(t+a-o.bottomRight,r+i-o.bottomRight,o.bottomRight,Ws,0,!0),s.lineTo(t+a,r+o.topRight),s.arc(t+a-o.topRight,r+o.topRight,o.topRight,0,-Ws,!0),s.lineTo(t+o.topLeft,r)}const zT=/^(normal|(\d+(?:\.\d+)?)(px|em|%)?)$/,HT=/^(normal|italic|initial|inherit|unset|(oblique( -?[0-9]?[0-9]deg)?))$/;function WT(s,e){const t=(""+s).match(zT);if(!t||t[1]==="normal")return e*1.2;switch(s=+t[2],t[3]){case"px":return s;case"%":s/=100;break}return e*s}const qT=s=>+s||0;function Wb(s,e){const t={},r=gt(e),a=r?Object.keys(e):e,i=gt(s)?r?o=>ot(s[o],s[e[o]]):o=>s[o]:()=>s;for(const o of a)t[o]=qT(i(o));return t}function GT(s){return Wb(s,{top:"y",right:"x",bottom:"y",left:"x"})}function Ei(s){return Wb(s,["topLeft","topRight","bottomLeft","bottomRight"])}function Us(s){const e=GT(s);return e.width=e.left+e.right,e.height=e.top+e.bottom,e}function cs(s,e){s=s||{},e=e||Pt.font;let t=ot(s.size,e.size);typeof t=="string"&&(t=parseInt(t,10));let r=ot(s.style,e.style);r&&!(""+r).match(HT)&&(console.warn('Invalid font style specified: "'+r+'"'),r=void 0);const a={family:ot(s.family,e.family),lineHeight:WT(ot(s.lineHeight,e.lineHeight),t),size:t,style:r,weight:ot(s.weight,e.weight),string:""};return a.string=OT(a),a}function Uo(s,e,t,r){let a,i,o;for(a=0,i=s.length;a<i;++a)if(o=s[a],o!==void 0&&o!==void 0)return o}function KT(s,e,t){const{min:r,max:a}=s,i=nT(e,(a-r)/2),o=(l,c)=>t&&l===0?0:l+c;return{min:o(r,-Math.abs(i)),max:o(a,i)}}function Xn(s,e){return Object.assign(Object.create(s),e)}function Iu(s,e=[""],t,r,a=()=>s[0]){const i=t||s;typeof r>"u"&&(r=Yb("_fallback",s));const o={[Symbol.toStringTag]:"Object",_cacheable:!0,_scopes:s,_rootScopes:i,_fallback:r,_getTarget:a,override:l=>Iu([l,...s],e,i,r)};return new Proxy(o,{deleteProperty(l,c){return delete l[c],delete l._keys,delete s[0][c],!0},get(l,c){return Gb(l,c,()=>sI(c,e,s,l))},getOwnPropertyDescriptor(l,c){return Reflect.getOwnPropertyDescriptor(l._scopes[0],c)},getPrototypeOf(){return Reflect.getPrototypeOf(s[0])},has(l,c){return If(l).includes(c)},ownKeys(l){return If(l)},set(l,c,h){const u=l._storage||(l._storage=a());return l[c]=u[c]=h,delete l._keys,!0}})}function Da(s,e,t,r){const a={_cacheable:!1,_proxy:s,_context:e,_subProxy:t,_stack:new Set,_descriptors:qb(s,r),setContext:i=>Da(s,i,t,r),override:i=>Da(s.override(i),e,t,r)};return new Proxy(a,{deleteProperty(i,o){return delete i[o],delete s[o],!0},get(i,o,l){return Gb(i,o,()=>QT(i,o,l))},getOwnPropertyDescriptor(i,o){return i._descriptors.allKeys?Reflect.has(s,o)?{enumerable:!0,configurable:!0}:void 0:Reflect.getOwnPropertyDescriptor(s,o)},getPrototypeOf(){return Reflect.getPrototypeOf(s)},has(i,o){return Reflect.has(s,o)},ownKeys(){return Reflect.ownKeys(s)},set(i,o,l){return s[o]=l,delete i[o],!0}})}function qb(s,e={scriptable:!0,indexable:!0}){const{_scriptable:t=e.scriptable,_indexable:r=e.indexable,_allKeys:a=e.allKeys}=s;return{allKeys:a,scriptable:t,indexable:r,isScriptable:bn(t)?t:()=>t,isIndexable:bn(r)?r:()=>r}}const YT=(s,e)=>s?s+_u(e):e,Au=(s,e)=>gt(e)&&s!=="adapters"&&(Object.getPrototypeOf(e)===null||e.constructor===Object);function Gb(s,e,t){if(Object.prototype.hasOwnProperty.call(s,e)||e==="constructor")return s[e];const r=t();return s[e]=r,r}function QT(s,e,t){const{_proxy:r,_context:a,_subProxy:i,_descriptors:o}=s;let l=r[e];return bn(l)&&o.isScriptable(e)&&(l=XT(e,l,s,t)),Wt(l)&&l.length&&(l=JT(e,l,s,o.isIndexable)),Au(e,l)&&(l=Da(l,a,i&&i[e],o)),l}function XT(s,e,t,r){const{_proxy:a,_context:i,_subProxy:o,_stack:l}=t;if(l.has(s))throw new Error("Recursion detected: "+Array.from(l).join("->")+"->"+s);l.add(s);let c=e(i,o||r);return l.delete(s),Au(s,c)&&(c=Cu(a._scopes,a,s,c)),c}function JT(s,e,t,r){const{_proxy:a,_context:i,_subProxy:o,_descriptors:l}=t;if(typeof i.index<"u"&&r(s))return e[i.index%e.length];if(gt(e[0])){const c=e,h=a._scopes.filter(u=>u!==c);e=[];for(const u of c){const m=Cu(h,a,s,u);e.push(Da(m,i,o&&o[s],l))}}return e}function Kb(s,e,t){return bn(s)?s(e,t):s}const ZT=(s,e)=>s===!0?e:typeof s=="string"?Fl(e,s):void 0;function eI(s,e,t,r,a){for(const i of e){const o=ZT(t,i);if(o){s.add(o);const l=Kb(o._fallback,t,a);if(typeof l<"u"&&l!==t&&l!==r)return l}else if(o===!1&&typeof r<"u"&&t!==r)return null}return!1}function Cu(s,e,t,r){const a=e._rootScopes,i=Kb(e._fallback,t,r),o=[...s,...a],l=new Set;l.add(r);let c=Tf(l,o,t,i||t,r);return c===null||typeof i<"u"&&i!==t&&(c=Tf(l,o,i,c,r),c===null)?!1:Iu(Array.from(l),[""],a,i,()=>tI(e,t,r))}function Tf(s,e,t,r,a){for(;t;)t=eI(s,e,t,r,a);return t}function tI(s,e,t){const r=s._getTarget();e in r||(r[e]={});const a=r[e];return Wt(a)&&gt(t)?t:a||{}}function sI(s,e,t,r){let a;for(const i of e)if(a=Yb(YT(i,s),t),typeof a<"u")return Au(s,a)?Cu(t,r,s,a):a}function Yb(s,e){for(const t of e){if(!t)continue;const r=t[s];if(typeof r<"u")return r}}function If(s){let e=s._keys;return e||(e=s._keys=rI(s._scopes)),e}function rI(s){const e=new Set;for(const t of s)for(const r of Object.keys(t).filter(a=>!a.startsWith("_")))e.add(r);return Array.from(e)}const nI=Number.EPSILON||1e-14,Ma=(s,e)=>e<s.length&&!s[e].skip&&s[e],Qb=s=>s==="x"?"y":"x";function aI(s,e,t,r){const a=s.skip?e:s,i=e,o=t.skip?e:t,l=Jd(i,a),c=Jd(o,i);let h=l/(l+c),u=c/(l+c);h=isNaN(h)?0:h,u=isNaN(u)?0:u;const m=r*h,g=r*u;return{previous:{x:i.x-m*(o.x-a.x),y:i.y-m*(o.y-a.y)},next:{x:i.x+g*(o.x-a.x),y:i.y+g*(o.y-a.y)}}}function iI(s,e,t){const r=s.length;let a,i,o,l,c,h=Ma(s,0);for(let u=0;u<r-1;++u)if(c=h,h=Ma(s,u+1),!(!c||!h)){if(_i(e[u],0,nI)){t[u]=t[u+1]=0;continue}a=t[u]/e[u],i=t[u+1]/e[u],l=Math.pow(a,2)+Math.pow(i,2),!(l<=9)&&(o=3/Math.sqrt(l),t[u]=a*o*e[u],t[u+1]=i*o*e[u])}}function oI(s,e,t="x"){const r=Qb(t),a=s.length;let i,o,l,c=Ma(s,0);for(let h=0;h<a;++h){if(o=l,l=c,c=Ma(s,h+1),!l)continue;const u=l[t],m=l[r];o&&(i=(u-o[t])/3,l[`cp1${t}`]=u-i,l[`cp1${r}`]=m-i*e[h]),c&&(i=(c[t]-u)/3,l[`cp2${t}`]=u+i,l[`cp2${r}`]=m+i*e[h])}}function lI(s,e="x"){const t=Qb(e),r=s.length,a=Array(r).fill(0),i=Array(r);let o,l,c,h=Ma(s,0);for(o=0;o<r;++o)if(l=c,c=h,h=Ma(s,o+1),!!c){if(h){const u=h[e]-c[e];a[o]=u!==0?(h[t]-c[t])/u:0}i[o]=l?h?Ca(a[o-1])!==Ca(a[o])?0:(a[o-1]+a[o])/2:a[o-1]:a[o]}iI(s,a,i),oI(s,i,e)}function Bo(s,e,t){return Math.max(Math.min(s,t),e)}function cI(s,e){let t,r,a,i,o,l=Wi(s[0],e);for(t=0,r=s.length;t<r;++t)o=i,i=l,l=t<r-1&&Wi(s[t+1],e),i&&(a=s[t],o&&(a.cp1x=Bo(a.cp1x,e.left,e.right),a.cp1y=Bo(a.cp1y,e.top,e.bottom)),l&&(a.cp2x=Bo(a.cp2x,e.left,e.right),a.cp2y=Bo(a.cp2y,e.top,e.bottom)))}function dI(s,e,t,r,a){let i,o,l,c;if(e.spanGaps&&(s=s.filter(h=>!h.skip)),e.cubicInterpolationMode==="monotone")lI(s,a);else{let h=r?s[s.length-1]:s[0];for(i=0,o=s.length;i<o;++i)l=s[i],c=aI(h,l,s[Math.min(i+1,o-(r?0:1))%o],e.tension),l.cp1x=c.previous.x,l.cp1y=c.previous.y,l.cp2x=c.next.x,l.cp2y=c.next.y,h=l}e.capBezierPoints&&cI(s,t)}function Du(){return typeof window<"u"&&typeof document<"u"}function Mu(s){let e=s.parentNode;return e&&e.toString()==="[object ShadowRoot]"&&(e=e.host),e}function zl(s,e,t){let r;return typeof s=="string"?(r=parseInt(s,10),s.indexOf("%")!==-1&&(r=r/100*e.parentNode[t])):r=s,r}const _c=s=>s.ownerDocument.defaultView.getComputedStyle(s,null);function hI(s,e){return _c(s).getPropertyValue(e)}const uI=["top","right","bottom","left"];function Ln(s,e,t){const r={};t=t?"-"+t:"";for(let a=0;a<4;a++){const i=uI[a];r[i]=parseFloat(s[e+"-"+i+t])||0}return r.width=r.left+r.right,r.height=r.top+r.bottom,r}const mI=(s,e,t)=>(s>0||e>0)&&(!t||!t.shadowRoot);function gI(s,e){const t=s.touches,r=t&&t.length?t[0]:s,{offsetX:a,offsetY:i}=r;let o=!1,l,c;if(mI(a,i,s.target))l=a,c=i;else{const h=e.getBoundingClientRect();l=r.clientX-h.left,c=r.clientY-h.top,o=!0}return{x:l,y:c,box:o}}function Tn(s,e){if("native"in s)return s;const{canvas:t,currentDevicePixelRatio:r}=e,a=_c(t),i=a.boxSizing==="border-box",o=Ln(a,"padding"),l=Ln(a,"border","width"),{x:c,y:h,box:u}=gI(s,t),m=o.left+(u&&l.left),g=o.top+(u&&l.top);let{width:p,height:j}=e;return i&&(p-=o.width+l.width,j-=o.height+l.height),{x:Math.round((c-m)/p*t.width/r),y:Math.round((h-g)/j*t.height/r)}}function fI(s,e,t){let r,a;if(e===void 0||t===void 0){const i=s&&Mu(s);if(!i)e=s.clientWidth,t=s.clientHeight;else{const o=i.getBoundingClientRect(),l=_c(i),c=Ln(l,"border","width"),h=Ln(l,"padding");e=o.width-h.width-c.width,t=o.height-h.height-c.height,r=zl(l.maxWidth,i,"clientWidth"),a=zl(l.maxHeight,i,"clientHeight")}}return{width:e,height:t,maxWidth:r||Bl,maxHeight:a||Bl}}const nn=s=>Math.round(s*10)/10;function pI(s,e,t,r){const a=_c(s),i=Ln(a,"margin"),o=zl(a.maxWidth,s,"clientWidth")||Bl,l=zl(a.maxHeight,s,"clientHeight")||Bl,c=fI(s,e,t);let{width:h,height:u}=c;if(a.boxSizing==="content-box"){const g=Ln(a,"border","width"),p=Ln(a,"padding");h-=p.width+g.width,u-=p.height+g.height}return h=Math.max(0,h-i.width),u=Math.max(0,r?h/r:u-i.height),h=nn(Math.min(h,o,c.maxWidth)),u=nn(Math.min(u,l,c.maxHeight)),h&&!u&&(u=nn(h/2)),(e!==void 0||t!==void 0)&&r&&c.height&&u>c.height&&(u=c.height,h=nn(Math.floor(u*r))),{width:h,height:u}}function Af(s,e,t){const r=e||1,a=nn(s.height*r),i=nn(s.width*r);s.height=nn(s.height),s.width=nn(s.width);const o=s.canvas;return o.style&&(t||!o.style.height&&!o.style.width)&&(o.style.height=`${s.height}px`,o.style.width=`${s.width}px`),s.currentDevicePixelRatio!==r||o.height!==a||o.width!==i?(s.currentDevicePixelRatio=r,o.height=a,o.width=i,s.ctx.setTransform(r,0,0,r,0,0),!0):!1}const xI=function(){let s=!1;try{const e={get passive(){return s=!0,!1}};Du()&&(window.addEventListener("test",null,e),window.removeEventListener("test",null,e))}catch{}return s}();function Cf(s,e){const t=hI(s,e),r=t&&t.match(/^(\d+)(\.\d+)?px$/);return r?+r[1]:void 0}function In(s,e,t,r){return{x:s.x+t*(e.x-s.x),y:s.y+t*(e.y-s.y)}}function bI(s,e,t,r){return{x:s.x+t*(e.x-s.x),y:r==="middle"?t<.5?s.y:e.y:r==="after"?t<1?s.y:e.y:t>0?e.y:s.y}}function yI(s,e,t,r){const a={x:s.cp2x,y:s.cp2y},i={x:e.cp1x,y:e.cp1y},o=In(s,a,t),l=In(a,i,t),c=In(i,e,t),h=In(o,l,t),u=In(l,c,t);return In(h,u,t)}const vI=function(s,e){return{x(t){return s+s+e-t},setWidth(t){e=t},textAlign(t){return t==="center"?t:t==="right"?"left":"right"},xPlus(t,r){return t-r},leftForLtr(t,r){return t-r}}},wI=function(){return{x(s){return s},setWidth(s){},textAlign(s){return s},xPlus(s,e){return s+e},leftForLtr(s,e){return s}}};function xa(s,e,t){return s?vI(e,t):wI()}function Xb(s,e){let t,r;(e==="ltr"||e==="rtl")&&(t=s.canvas.style,r=[t.getPropertyValue("direction"),t.getPropertyPriority("direction")],t.setProperty("direction",e,"important"),s.prevTextDirection=r)}function Jb(s,e){e!==void 0&&(delete s.prevTextDirection,s.canvas.style.setProperty("direction",e[0],e[1]))}function Zb(s){return s==="angle"?{between:Lb,compare:bT,normalize:Kr}:{between:ui,compare:(e,t)=>e-t,normalize:e=>e}}function Df({start:s,end:e,count:t,loop:r,style:a}){return{start:s%t,end:e%t,loop:r&&(e-s+1)%t===0,style:a}}function kI(s,e,t){const{property:r,start:a,end:i}=t,{between:o,normalize:l}=Zb(r),c=e.length;let{start:h,end:u,loop:m}=s,g,p;if(m){for(h+=c,u+=c,g=0,p=c;g<p&&o(l(e[h%c][r]),a,i);++g)h--,u--;h%=c,u%=c}return u<h&&(u+=c),{start:h,end:u,loop:m,style:s.style}}function _I(s,e,t){if(!t)return[s];const{property:r,start:a,end:i}=t,o=e.length,{compare:l,between:c,normalize:h}=Zb(r),{start:u,end:m,loop:g,style:p}=kI(s,e,t),j=[];let _=!1,y=null,M,D,T;const R=()=>c(a,T,M)&&l(a,T)!==0,P=()=>l(i,M)===0||c(i,T,M),C=()=>_||R(),N=()=>!_||P();for(let b=u,v=u;b<=m;++b)D=e[b%o],!D.skip&&(M=h(D[r]),M!==T&&(_=c(M,a,i),y===null&&C()&&(y=l(M,a)===0?b:v),y!==null&&N()&&(j.push(Df({start:y,end:b,loop:g,count:o,style:p})),y=null),v=b,T=M));return y!==null&&j.push(Df({start:y,end:m,loop:g,count:o,style:p})),j}function NI(s,e){const t=[],r=s.segments;for(let a=0;a<r.length;a++){const i=_I(r[a],s.points,e);i.length&&t.push(...i)}return t}function jI(s,e,t,r){let a=0,i=e-1;if(t&&!r)for(;a<e&&!s[a].skip;)a++;for(;a<e&&s[a].skip;)a++;for(a%=e,t&&(i+=a);i>a&&s[i%e].skip;)i--;return i%=e,{start:a,end:i}}function EI(s,e,t,r){const a=s.length,i=[];let o=e,l=s[e],c;for(c=e+1;c<=t;++c){const h=s[c%a];h.skip||h.stop?l.skip||(r=!1,i.push({start:e%a,end:(c-1)%a,loop:r}),e=o=h.stop?c:null):(o=c,l.skip&&(e=c)),l=h}return o!==null&&i.push({start:e%a,end:o%a,loop:r}),i}function SI(s,e){const t=s.points,r=s.options.spanGaps,a=t.length;if(!a)return[];const i=!!s._loop,{start:o,end:l}=jI(t,a,i,r);if(r===!0)return Mf(s,[{start:o,end:l,loop:i}],t,e);const c=l<o?l+a:l,h=!!s._fullLoop&&o===0&&l===a-1;return Mf(s,EI(t,o,c,h),t,e)}function Mf(s,e,t,r){return!r||!r.setContext||!t?e:TI(s,e,t,r)}function TI(s,e,t,r){const a=s._chart.getContext(),i=$f(s.options),{_datasetIndex:o,options:{spanGaps:l}}=s,c=t.length,h=[];let u=i,m=e[0].start,g=m;function p(j,_,y,M){const D=l?-1:1;if(j!==_){for(j+=c;t[j%c].skip;)j-=D;for(;t[_%c].skip;)_+=D;j%c!==_%c&&(h.push({start:j%c,end:_%c,loop:y,style:M}),u=M,m=_%c)}}for(const j of e){m=l?m:j.start;let _=t[m%c],y;for(g=m+1;g<=j.end;g++){const M=t[g%c];y=$f(r.setContext(Xn(a,{type:"segment",p0:_,p1:M,p0DataIndex:(g-1)%c,p1DataIndex:g%c,datasetIndex:o}))),II(y,u)&&p(m,g-1,j.loop,u),_=M,u=y}m<g-1&&p(m,g-1,j.loop,u)}return h}function $f(s){return{backgroundColor:s.backgroundColor,borderCapStyle:s.borderCapStyle,borderDash:s.borderDash,borderDashOffset:s.borderDashOffset,borderJoinStyle:s.borderJoinStyle,borderWidth:s.borderWidth,borderColor:s.borderColor}}function II(s,e){if(!e)return!1;const t=[],r=function(a,i){return Eu(i)?(t.includes(i)||t.push(i),t.indexOf(i)):i};return JSON.stringify(s,r)!==JSON.stringify(e,r)}function zo(s,e,t){return s.options.clip?s[t]:e[t]}function AI(s,e){const{xScale:t,yScale:r}=s;return t&&r?{left:zo(t,e,"left"),right:zo(t,e,"right"),top:zo(r,e,"top"),bottom:zo(r,e,"bottom")}:e}function CI(s,e){const t=e._clip;if(t.disabled)return!1;const r=AI(e,s.chartArea);return{left:t.left===!1?0:r.left-(t.left===!0?0:t.left),right:t.right===!1?s.width:r.right+(t.right===!0?0:t.right),top:t.top===!1?0:r.top-(t.top===!0?0:t.top),bottom:t.bottom===!1?s.height:r.bottom+(t.bottom===!0?0:t.bottom)}}/*!
 * Chart.js v4.5.1
 * https://www.chartjs.org
 * (c) 2025 Chart.js Contributors
 * Released under the MIT License
 */class DI{constructor(){this._request=null,this._charts=new Map,this._running=!1,this._lastDate=void 0}_notify(e,t,r,a){const i=t.listeners[a],o=t.duration;i.forEach(l=>l({chart:e,initial:t.initial,numSteps:o,currentStep:Math.min(r-t.start,o)}))}_refresh(){this._request||(this._running=!0,this._request=Fb.call(window,()=>{this._update(),this._request=null,this._running&&this._refresh()}))}_update(e=Date.now()){let t=0;this._charts.forEach((r,a)=>{if(!r.running||!r.items.length)return;const i=r.items;let o=i.length-1,l=!1,c;for(;o>=0;--o)c=i[o],c._active?(c._total>r.duration&&(r.duration=c._total),c.tick(e),l=!0):(i[o]=i[i.length-1],i.pop());l&&(a.draw(),this._notify(a,r,e,"progress")),i.length||(r.running=!1,this._notify(a,r,e,"complete"),r.initial=!1),t+=i.length}),this._lastDate=e,t===0&&(this._running=!1)}_getAnims(e){const t=this._charts;let r=t.get(e);return r||(r={running:!1,initial:!0,items:[],listeners:{complete:[],progress:[]}},t.set(e,r)),r}listen(e,t,r){this._getAnims(e).listeners[t].push(r)}add(e,t){!t||!t.length||this._getAnims(e).items.push(...t)}has(e){return this._getAnims(e).items.length>0}start(e){const t=this._charts.get(e);t&&(t.running=!0,t.start=Date.now(),t.duration=t.items.reduce((r,a)=>Math.max(r,a._duration),0),this._refresh())}running(e){if(!this._running)return!1;const t=this._charts.get(e);return!(!t||!t.running||!t.items.length)}stop(e){const t=this._charts.get(e);if(!t||!t.items.length)return;const r=t.items;let a=r.length-1;for(;a>=0;--a)r[a].cancel();t.items=[],this._notify(e,t,Date.now(),"complete")}remove(e){return this._charts.delete(e)}}var br=new DI;const Rf="transparent",MI={boolean(s,e,t){return t>.5?e:s},color(s,e,t){const r=Nf(s||Rf),a=r.valid&&Nf(e||Rf);return a&&a.valid?a.mix(r,t).hexString():e},number(s,e,t){return s+(e-s)*t}};class $I{constructor(e,t,r,a){const i=t[r];a=Uo([e.to,a,i,e.from]);const o=Uo([e.from,i,a]);this._active=!0,this._fn=e.fn||MI[e.type||typeof o],this._easing=Ni[e.easing]||Ni.linear,this._start=Math.floor(Date.now()+(e.delay||0)),this._duration=this._total=Math.floor(e.duration),this._loop=!!e.loop,this._target=t,this._prop=r,this._from=o,this._to=a,this._promises=void 0}active(){return this._active}update(e,t,r){if(this._active){this._notify(!1);const a=this._target[this._prop],i=r-this._start,o=this._duration-i;this._start=r,this._duration=Math.floor(Math.max(o,e.duration)),this._total+=i,this._loop=!!e.loop,this._to=Uo([e.to,t,a,e.from]),this._from=Uo([e.from,a,t])}}cancel(){this._active&&(this.tick(Date.now()),this._active=!1,this._notify(!1))}tick(e){const t=e-this._start,r=this._duration,a=this._prop,i=this._from,o=this._loop,l=this._to;let c;if(this._active=i!==l&&(o||t<r),!this._active){this._target[a]=l,this._notify(!0);return}if(t<0){this._target[a]=i;return}c=t/r%2,c=o&&c>1?2-c:c,c=this._easing(Math.min(1,Math.max(0,c))),this._target[a]=this._fn(i,l,c)}wait(){const e=this._promises||(this._promises=[]);return new Promise((t,r)=>{e.push({res:t,rej:r})})}_notify(e){const t=e?"res":"rej",r=this._promises||[];for(let a=0;a<r.length;a++)r[a][t]()}}class ey{constructor(e,t){this._chart=e,this._properties=new Map,this.configure(t)}configure(e){if(!gt(e))return;const t=Object.keys(Pt.animation),r=this._properties;Object.getOwnPropertyNames(e).forEach(a=>{const i=e[a];if(!gt(i))return;const o={};for(const l of t)o[l]=i[l];(Wt(i.properties)&&i.properties||[a]).forEach(l=>{(l===a||!r.has(l))&&r.set(l,o)})})}_animateOptions(e,t){const r=t.options,a=PI(e,r);if(!a)return[];const i=this._createAnimations(a,r);return r.$shared&&RI(e.options.$animations,r).then(()=>{e.options=r},()=>{}),i}_createAnimations(e,t){const r=this._properties,a=[],i=e.$animations||(e.$animations={}),o=Object.keys(t),l=Date.now();let c;for(c=o.length-1;c>=0;--c){const h=o[c];if(h.charAt(0)==="$")continue;if(h==="options"){a.push(...this._animateOptions(e,t));continue}const u=t[h];let m=i[h];const g=r.get(h);if(m)if(g&&m.active()){m.update(g,u,l);continue}else m.cancel();if(!g||!g.duration){e[h]=u;continue}i[h]=m=new $I(g,e,h,u),a.push(m)}return a}update(e,t){if(this._properties.size===0){Object.assign(e,t);return}const r=this._createAnimations(e,t);if(r.length)return br.add(this._chart,r),!0}}function RI(s,e){const t=[],r=Object.keys(e);for(let a=0;a<r.length;a++){const i=s[r[a]];i&&i.active()&&t.push(i.wait())}return Promise.all(t)}function PI(s,e){if(!e)return;let t=s.options;if(!t){s.options=e;return}return t.$shared&&(s.options=t=Object.assign({},t,{$shared:!1,$animations:{}})),t}function Pf(s,e){const t=s&&s.options||{},r=t.reverse,a=t.min===void 0?e:0,i=t.max===void 0?e:0;return{start:r?i:a,end:r?a:i}}function OI(s,e,t){if(t===!1)return!1;const r=Pf(s,t),a=Pf(e,t);return{top:a.end,right:r.end,bottom:a.start,left:r.start}}function LI(s){let e,t,r,a;return gt(s)?(e=s.top,t=s.right,r=s.bottom,a=s.left):e=t=r=a=s,{top:e,right:t,bottom:r,left:a,disabled:s===!1}}function ty(s,e){const t=[],r=s._getSortedDatasetMetas(e);let a,i;for(a=0,i=r.length;a<i;++a)t.push(r[a].index);return t}function Of(s,e,t,r={}){const a=s.keys,i=r.mode==="single";let o,l,c,h;if(e===null)return;let u=!1;for(o=0,l=a.length;o<l;++o){if(c=+a[o],c===t){if(u=!0,r.all)continue;break}h=s.values[c],Fs(h)&&(i||e===0||Ca(e)===Ca(h))&&(e+=h)}return!u&&!r.all?0:e}function VI(s,e){const{iScale:t,vScale:r}=e,a=t.axis==="x"?"x":"y",i=r.axis==="x"?"x":"y",o=Object.keys(s),l=new Array(o.length);let c,h,u;for(c=0,h=o.length;c<h;++c)u=o[c],l[c]={[a]:u,[i]:s[u]};return l}function ld(s,e){const t=s&&s.options.stacked;return t||t===void 0&&e.stack!==void 0}function FI(s,e,t){return`${s.id}.${e.id}.${t.stack||t.type}`}function UI(s){const{min:e,max:t,minDefined:r,maxDefined:a}=s.getUserBounds();return{min:r?e:Number.NEGATIVE_INFINITY,max:a?t:Number.POSITIVE_INFINITY}}function BI(s,e,t){const r=s[e]||(s[e]={});return r[t]||(r[t]={})}function Lf(s,e,t,r){for(const a of e.getMatchingVisibleMetas(r).reverse()){const i=s[a.index];if(t&&i>0||!t&&i<0)return a.index}return null}function Vf(s,e){const{chart:t,_cachedMeta:r}=s,a=t._stacks||(t._stacks={}),{iScale:i,vScale:o,index:l}=r,c=i.axis,h=o.axis,u=FI(i,o,r),m=e.length;let g;for(let p=0;p<m;++p){const j=e[p],{[c]:_,[h]:y}=j,M=j._stacks||(j._stacks={});g=M[h]=BI(a,u,_),g[l]=y,g._top=Lf(g,o,!0,r.type),g._bottom=Lf(g,o,!1,r.type);const D=g._visualValues||(g._visualValues={});D[l]=y}}function cd(s,e){const t=s.scales;return Object.keys(t).filter(r=>t[r].axis===e).shift()}function zI(s,e){return Xn(s,{active:!1,dataset:void 0,datasetIndex:e,index:e,mode:"default",type:"dataset"})}function HI(s,e,t){return Xn(s,{active:!1,dataIndex:e,parsed:void 0,raw:void 0,element:t,index:e,mode:"default",type:"data"})}function si(s,e){const t=s.controller.index,r=s.vScale&&s.vScale.axis;if(r){e=e||s._parsed;for(const a of e){const i=a._stacks;if(!i||i[r]===void 0||i[r][t]===void 0)return;delete i[r][t],i[r]._visualValues!==void 0&&i[r]._visualValues[t]!==void 0&&delete i[r]._visualValues[t]}}}const dd=s=>s==="reset"||s==="none",Ff=(s,e)=>e?s:Object.assign({},s),WI=(s,e,t)=>s&&!e.hidden&&e._stacked&&{keys:ty(t,!0),values:null};class Si{constructor(e,t){this.chart=e,this._ctx=e.ctx,this.index=t,this._cachedDataOpts={},this._cachedMeta=this.getMeta(),this._type=this._cachedMeta.type,this.options=void 0,this._parsing=!1,this._data=void 0,this._objectData=void 0,this._sharedOptions=void 0,this._drawStart=void 0,this._drawCount=void 0,this.enableOptionSharing=!1,this.supportsDecimation=!1,this.$context=void 0,this._syncList=[],this.datasetElementType=new.target.datasetElementType,this.dataElementType=new.target.dataElementType,this.initialize()}initialize(){const e=this._cachedMeta;this.configure(),this.linkScales(),e._stacked=ld(e.vScale,e),this.addElements(),this.options.fill&&!this.chart.isPluginEnabled("filler")&&console.warn("Tried to use the 'fill' option without the 'Filler' plugin enabled. Please import and register the 'Filler' plugin and make sure it is not disabled in the options")}updateIndex(e){this.index!==e&&si(this._cachedMeta),this.index=e}linkScales(){const e=this.chart,t=this._cachedMeta,r=this.getDataset(),a=(m,g,p,j)=>m==="x"?g:m==="r"?j:p,i=t.xAxisID=ot(r.xAxisID,cd(e,"x")),o=t.yAxisID=ot(r.yAxisID,cd(e,"y")),l=t.rAxisID=ot(r.rAxisID,cd(e,"r")),c=t.indexAxis,h=t.iAxisID=a(c,i,o,l),u=t.vAxisID=a(c,o,i,l);t.xScale=this.getScaleForId(i),t.yScale=this.getScaleForId(o),t.rScale=this.getScaleForId(l),t.iScale=this.getScaleForId(h),t.vScale=this.getScaleForId(u)}getDataset(){return this.chart.data.datasets[this.index]}getMeta(){return this.chart.getDatasetMeta(this.index)}getScaleForId(e){return this.chart.scales[e]}_getOtherScale(e){const t=this._cachedMeta;return e===t.iScale?t.vScale:t.iScale}reset(){this._update("reset")}_destroy(){const e=this._cachedMeta;this._data&&wf(this._data,this),e._stacked&&si(e)}_dataCheck(){const e=this.getDataset(),t=e.data||(e.data=[]),r=this._data;if(gt(t)){const a=this._cachedMeta;this._data=VI(t,a)}else if(r!==t){if(r){wf(r,this);const a=this._cachedMeta;si(a),a._parsed=[]}t&&Object.isExtensible(t)&&kT(t,this),this._syncList=[],this._data=t}}addElements(){const e=this._cachedMeta;this._dataCheck(),this.datasetElementType&&(e.dataset=new this.datasetElementType)}buildOrUpdateElements(e){const t=this._cachedMeta,r=this.getDataset();let a=!1;this._dataCheck();const i=t._stacked;t._stacked=ld(t.vScale,t),t.stack!==r.stack&&(a=!0,si(t),t.stack=r.stack),this._resyncElements(e),(a||i!==t._stacked)&&(Vf(this,t._parsed),t._stacked=ld(t.vScale,t))}configure(){const e=this.chart.config,t=e.datasetScopeKeys(this._type),r=e.getOptionScopes(this.getDataset(),t,!0);this.options=e.createResolver(r,this.getContext()),this._parsing=this.options.parsing,this._cachedDataOpts={}}parse(e,t){const{_cachedMeta:r,_data:a}=this,{iScale:i,_stacked:o}=r,l=i.axis;let c=e===0&&t===a.length?!0:r._sorted,h=e>0&&r._parsed[e-1],u,m,g;if(this._parsing===!1)r._parsed=a,r._sorted=!0,g=a;else{Wt(a[e])?g=this.parseArrayData(r,a,e,t):gt(a[e])?g=this.parseObjectData(r,a,e,t):g=this.parsePrimitiveData(r,a,e,t);const p=()=>m[l]===null||h&&m[l]<h[l];for(u=0;u<t;++u)r._parsed[u+e]=m=g[u],c&&(p()&&(c=!1),h=m);r._sorted=c}o&&Vf(this,g)}parsePrimitiveData(e,t,r,a){const{iScale:i,vScale:o}=e,l=i.axis,c=o.axis,h=i.getLabels(),u=i===o,m=new Array(a);let g,p,j;for(g=0,p=a;g<p;++g)j=g+r,m[g]={[l]:u||i.parse(h[j],j),[c]:o.parse(t[j],j)};return m}parseArrayData(e,t,r,a){const{xScale:i,yScale:o}=e,l=new Array(a);let c,h,u,m;for(c=0,h=a;c<h;++c)u=c+r,m=t[u],l[c]={x:i.parse(m[0],u),y:o.parse(m[1],u)};return l}parseObjectData(e,t,r,a){const{xScale:i,yScale:o}=e,{xAxisKey:l="x",yAxisKey:c="y"}=this._parsing,h=new Array(a);let u,m,g,p;for(u=0,m=a;u<m;++u)g=u+r,p=t[g],h[u]={x:i.parse(Fl(p,l),g),y:o.parse(Fl(p,c),g)};return h}getParsed(e){return this._cachedMeta._parsed[e]}getDataElement(e){return this._cachedMeta.data[e]}applyStack(e,t,r){const a=this.chart,i=this._cachedMeta,o=t[e.axis],l={keys:ty(a,!0),values:t._stacks[e.axis]._visualValues};return Of(l,o,i.index,{mode:r})}updateRangeFromParsed(e,t,r,a){const i=r[t.axis];let o=i===null?NaN:i;const l=a&&r._stacks[t.axis];a&&l&&(a.values=l,o=Of(a,i,this._cachedMeta.index)),e.min=Math.min(e.min,o),e.max=Math.max(e.max,o)}getMinMax(e,t){const r=this._cachedMeta,a=r._parsed,i=r._sorted&&e===r.iScale,o=a.length,l=this._getOtherScale(e),c=WI(t,r,this.chart),h={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY},{min:u,max:m}=UI(l);let g,p;function j(){p=a[g];const _=p[l.axis];return!Fs(p[e.axis])||u>_||m<_}for(g=0;g<o&&!(!j()&&(this.updateRangeFromParsed(h,e,p,c),i));++g);if(i){for(g=o-1;g>=0;--g)if(!j()){this.updateRangeFromParsed(h,e,p,c);break}}return h}getAllParsedValues(e){const t=this._cachedMeta._parsed,r=[];let a,i,o;for(a=0,i=t.length;a<i;++a)o=t[a][e.axis],Fs(o)&&r.push(o);return r}getMaxOverflow(){return!1}getLabelAndValue(e){const t=this._cachedMeta,r=t.iScale,a=t.vScale,i=this.getParsed(e);return{label:r?""+r.getLabelForValue(i[r.axis]):"",value:a?""+a.getLabelForValue(i[a.axis]):""}}_update(e){const t=this._cachedMeta;this.update(e||"default"),t._clip=LI(ot(this.options.clip,OI(t.xScale,t.yScale,this.getMaxOverflow())))}update(e){}draw(){const e=this._ctx,t=this.chart,r=this._cachedMeta,a=r.data||[],i=t.chartArea,o=[],l=this._drawStart||0,c=this._drawCount||a.length-l,h=this.options.drawActiveElementsOnTop;let u;for(r.dataset&&r.dataset.draw(e,i,l,c),u=l;u<l+c;++u){const m=a[u];m.hidden||(m.active&&h?o.push(m):m.draw(e,i))}for(u=0;u<o.length;++u)o[u].draw(e,i)}getStyle(e,t){const r=t?"active":"default";return e===void 0&&this._cachedMeta.dataset?this.resolveDatasetElementOptions(r):this.resolveDataElementOptions(e||0,r)}getContext(e,t,r){const a=this.getDataset();let i;if(e>=0&&e<this._cachedMeta.data.length){const o=this._cachedMeta.data[e];i=o.$context||(o.$context=HI(this.getContext(),e,o)),i.parsed=this.getParsed(e),i.raw=a.data[e],i.index=i.dataIndex=e}else i=this.$context||(this.$context=zI(this.chart.getContext(),this.index)),i.dataset=a,i.index=i.datasetIndex=this.index;return i.active=!!t,i.mode=r,i}resolveDatasetElementOptions(e){return this._resolveElementOptions(this.datasetElementType.id,e)}resolveDataElementOptions(e,t){return this._resolveElementOptions(this.dataElementType.id,t,e)}_resolveElementOptions(e,t="default",r){const a=t==="active",i=this._cachedDataOpts,o=e+"-"+t,l=i[o],c=this.enableOptionSharing&&Ul(r);if(l)return Ff(l,c);const h=this.chart.config,u=h.datasetElementScopeKeys(this._type,e),m=a?[`${e}Hover`,"hover",e,""]:[e,""],g=h.getOptionScopes(this.getDataset(),u),p=Object.keys(Pt.elements[e]),j=()=>this.getContext(r,a,t),_=h.resolveNamedOptions(g,p,j,m);return _.$shared&&(_.$shared=c,i[o]=Object.freeze(Ff(_,c))),_}_resolveAnimations(e,t,r){const a=this.chart,i=this._cachedDataOpts,o=`animation-${t}`,l=i[o];if(l)return l;let c;if(a.options.animation!==!1){const u=this.chart.config,m=u.datasetAnimationScopeKeys(this._type,t),g=u.getOptionScopes(this.getDataset(),m);c=u.createResolver(g,this.getContext(e,r,t))}const h=new ey(a,c&&c.animations);return c&&c._cacheable&&(i[o]=Object.freeze(h)),h}getSharedOptions(e){if(e.$shared)return this._sharedOptions||(this._sharedOptions=Object.assign({},e))}includeOptions(e,t){return!t||dd(e)||this.chart._animationsDisabled}_getSharedOptions(e,t){const r=this.resolveDataElementOptions(e,t),a=this._sharedOptions,i=this.getSharedOptions(r),o=this.includeOptions(t,i)||i!==a;return this.updateSharedOptions(i,t,r),{sharedOptions:i,includeOptions:o}}updateElement(e,t,r,a){dd(a)?Object.assign(e,r):this._resolveAnimations(t,a).update(e,r)}updateSharedOptions(e,t,r){e&&!dd(t)&&this._resolveAnimations(void 0,t).update(e,r)}_setStyle(e,t,r,a){e.active=a;const i=this.getStyle(t,a);this._resolveAnimations(t,r,a).update(e,{options:!a&&this.getSharedOptions(i)||i})}removeHoverStyle(e,t,r){this._setStyle(e,r,"active",!1)}setHoverStyle(e,t,r){this._setStyle(e,r,"active",!0)}_removeDatasetHoverStyle(){const e=this._cachedMeta.dataset;e&&this._setStyle(e,void 0,"active",!1)}_setDatasetHoverStyle(){const e=this._cachedMeta.dataset;e&&this._setStyle(e,void 0,"active",!0)}_resyncElements(e){const t=this._data,r=this._cachedMeta.data;for(const[l,c,h]of this._syncList)this[l](c,h);this._syncList=[];const a=r.length,i=t.length,o=Math.min(i,a);o&&this.parse(0,o),i>a?this._insertElements(a,i-a,e):i<a&&this._removeElements(i,a-i)}_insertElements(e,t,r=!0){const a=this._cachedMeta,i=a.data,o=e+t;let l;const c=h=>{for(h.length+=t,l=h.length-1;l>=o;l--)h[l]=h[l-t]};for(c(i),l=e;l<o;++l)i[l]=new this.dataElementType;this._parsing&&c(a._parsed),this.parse(e,t),r&&this.updateElements(i,e,t,"reset")}updateElements(e,t,r,a){}_removeElements(e,t){const r=this._cachedMeta;if(this._parsing){const a=r._parsed.splice(e,t);r._stacked&&si(r,a)}r.data.splice(e,t)}_sync(e){if(this._parsing)this._syncList.push(e);else{const[t,r,a]=e;this[t](r,a)}this.chart._dataChanges.push([this.index,...e])}_onDataPush(){const e=arguments.length;this._sync(["_insertElements",this.getDataset().data.length-e,e])}_onDataPop(){this._sync(["_removeElements",this._cachedMeta.data.length-1,1])}_onDataShift(){this._sync(["_removeElements",0,1])}_onDataSplice(e,t){t&&this._sync(["_removeElements",e,t]);const r=arguments.length-2;r&&this._sync(["_insertElements",e,r])}_onDataUnshift(){this._sync(["_insertElements",0,arguments.length])}}Je(Si,"defaults",{}),Je(Si,"datasetElementType",null),Je(Si,"dataElementType",null);class il extends Si{initialize(){this.enableOptionSharing=!0,this.supportsDecimation=!0,super.initialize()}update(e){const t=this._cachedMeta,{dataset:r,data:a=[],_dataset:i}=t,o=this.chart._animationsDisabled;let{start:l,count:c}=ET(t,a,o);this._drawStart=l,this._drawCount=c,ST(t)&&(l=0,c=a.length),r._chart=this.chart,r._datasetIndex=this.index,r._decimated=!!i._decimated,r.points=a;const h=this.resolveDatasetElementOptions(e);this.options.showLine||(h.borderWidth=0),h.segment=this.options.segment,this.updateElement(r,void 0,{animated:!o,options:h},e),this.updateElements(a,l,c,e)}updateElements(e,t,r,a){const i=a==="reset",{iScale:o,vScale:l,_stacked:c,_dataset:h}=this._cachedMeta,{sharedOptions:u,includeOptions:m}=this._getSharedOptions(t,a),g=o.axis,p=l.axis,{spanGaps:j,segment:_}=this.options,y=Hi(j)?j:Number.POSITIVE_INFINITY,M=this.chart._animationsDisabled||i||a==="none",D=t+r,T=e.length;let R=t>0&&this.getParsed(t-1);for(let P=0;P<T;++P){const C=e[P],N=M?C:{};if(P<t||P>=D){N.skip=!0;continue}const b=this.getParsed(P),v=kt(b[p]),S=N[g]=o.getPixelForValue(b[g],P),E=N[p]=i||v?l.getBasePixel():l.getPixelForValue(c?this.applyStack(l,b,c):b[p],P);N.skip=isNaN(S)||isNaN(E)||v,N.stop=P>0&&Math.abs(b[g]-R[g])>y,_&&(N.parsed=b,N.raw=h.data[P]),m&&(N.options=u||this.resolveDataElementOptions(P,C.active?"active":a)),M||this.updateElement(C,P,N,a),R=b}}getMaxOverflow(){const e=this._cachedMeta,t=e.dataset,r=t.options&&t.options.borderWidth||0,a=e.data||[];if(!a.length)return r;const i=a[0].size(this.resolveDataElementOptions(0)),o=a[a.length-1].size(this.resolveDataElementOptions(a.length-1));return Math.max(r,i,o)/2}draw(){const e=this._cachedMeta;e.dataset.updateControlPoints(this.chart.chartArea,e.iScale.axis),super.draw()}}Je(il,"id","line"),Je(il,"defaults",{datasetElementType:"line",dataElementType:"point",showLine:!0,spanGaps:!1}),Je(il,"overrides",{scales:{_index_:{type:"category"},_value_:{type:"linear"}}});function jn(){throw new Error("This method is not implemented: Check that a complete date adapter is provided.")}class $u{constructor(e){Je(this,"options");this.options=e||{}}static override(e){Object.assign($u.prototype,e)}init(){}formats(){return jn()}parse(){return jn()}format(){return jn()}add(){return jn()}diff(){return jn()}startOf(){return jn()}endOf(){return jn()}}var qI={_date:$u};function GI(s,e,t,r){const{controller:a,data:i,_sorted:o}=s,l=a._cachedMeta.iScale,c=s.dataset&&s.dataset.options?s.dataset.options.spanGaps:null;if(l&&e===l.axis&&e!=="r"&&o&&i.length){const h=l._reversePixels?vT:Dn;if(r){if(a._sharedOptions){const u=i[0],m=typeof u.getRange=="function"&&u.getRange(e);if(m){const g=h(i,e,t-m),p=h(i,e,t+m);return{lo:g.lo,hi:p.hi}}}}else{const u=h(i,e,t);if(c){const{vScale:m}=a._cachedMeta,{_parsed:g}=s,p=g.slice(0,u.lo+1).reverse().findIndex(_=>!kt(_[m.axis]));u.lo-=Math.max(0,p);const j=g.slice(u.hi).findIndex(_=>!kt(_[m.axis]));u.hi+=Math.max(0,j)}return u}}return{lo:0,hi:i.length-1}}function Nc(s,e,t,r,a){const i=s.getSortedVisibleDatasetMetas(),o=t[e];for(let l=0,c=i.length;l<c;++l){const{index:h,data:u}=i[l],{lo:m,hi:g}=GI(i[l],e,o,a);for(let p=m;p<=g;++p){const j=u[p];j.skip||r(j,h,p)}}}function KI(s){const e=s.indexOf("x")!==-1,t=s.indexOf("y")!==-1;return function(r,a){const i=e?Math.abs(r.x-a.x):0,o=t?Math.abs(r.y-a.y):0;return Math.sqrt(Math.pow(i,2)+Math.pow(o,2))}}function hd(s,e,t,r,a){const i=[];return!a&&!s.isPointInArea(e)||Nc(s,t,e,function(l,c,h){!a&&!Wi(l,s.chartArea,0)||l.inRange(e.x,e.y,r)&&i.push({element:l,datasetIndex:c,index:h})},!0),i}function YI(s,e,t,r){let a=[];function i(o,l,c){const{startAngle:h,endAngle:u}=o.getProps(["startAngle","endAngle"],r),{angle:m}=xT(o,{x:e.x,y:e.y});Lb(m,h,u)&&a.push({element:o,datasetIndex:l,index:c})}return Nc(s,t,e,i),a}function QI(s,e,t,r,a,i){let o=[];const l=KI(t);let c=Number.POSITIVE_INFINITY;function h(u,m,g){const p=u.inRange(e.x,e.y,a);if(r&&!p)return;const j=u.getCenterPoint(a);if(!(!!i||s.isPointInArea(j))&&!p)return;const y=l(e,j);y<c?(o=[{element:u,datasetIndex:m,index:g}],c=y):y===c&&o.push({element:u,datasetIndex:m,index:g})}return Nc(s,t,e,h),o}function ud(s,e,t,r,a,i){return!i&&!s.isPointInArea(e)?[]:t==="r"&&!r?YI(s,e,t,a):QI(s,e,t,r,a,i)}function Uf(s,e,t,r,a){const i=[],o=t==="x"?"inXRange":"inYRange";let l=!1;return Nc(s,t,e,(c,h,u)=>{c[o]&&c[o](e[t],a)&&(i.push({element:c,datasetIndex:h,index:u}),l=l||c.inRange(e.x,e.y,a))}),r&&!l?[]:i}var XI={modes:{index(s,e,t,r){const a=Tn(e,s),i=t.axis||"x",o=t.includeInvisible||!1,l=t.intersect?hd(s,a,i,r,o):ud(s,a,i,!1,r,o),c=[];return l.length?(s.getSortedVisibleDatasetMetas().forEach(h=>{const u=l[0].index,m=h.data[u];m&&!m.skip&&c.push({element:m,datasetIndex:h.index,index:u})}),c):[]},dataset(s,e,t,r){const a=Tn(e,s),i=t.axis||"xy",o=t.includeInvisible||!1;let l=t.intersect?hd(s,a,i,r,o):ud(s,a,i,!1,r,o);if(l.length>0){const c=l[0].datasetIndex,h=s.getDatasetMeta(c).data;l=[];for(let u=0;u<h.length;++u)l.push({element:h[u],datasetIndex:c,index:u})}return l},point(s,e,t,r){const a=Tn(e,s),i=t.axis||"xy",o=t.includeInvisible||!1;return hd(s,a,i,r,o)},nearest(s,e,t,r){const a=Tn(e,s),i=t.axis||"xy",o=t.includeInvisible||!1;return ud(s,a,i,t.intersect,r,o)},x(s,e,t,r){const a=Tn(e,s);return Uf(s,a,"x",t.intersect,r)},y(s,e,t,r){const a=Tn(e,s);return Uf(s,a,"y",t.intersect,r)}}};const sy=["left","top","right","bottom"];function ri(s,e){return s.filter(t=>t.pos===e)}function Bf(s,e){return s.filter(t=>sy.indexOf(t.pos)===-1&&t.box.axis===e)}function ni(s,e){return s.sort((t,r)=>{const a=e?r:t,i=e?t:r;return a.weight===i.weight?a.index-i.index:a.weight-i.weight})}function JI(s){const e=[];let t,r,a,i,o,l;for(t=0,r=(s||[]).length;t<r;++t)a=s[t],{position:i,options:{stack:o,stackWeight:l=1}}=a,e.push({index:t,box:a,pos:i,horizontal:a.isHorizontal(),weight:a.weight,stack:o&&i+o,stackWeight:l});return e}function ZI(s){const e={};for(const t of s){const{stack:r,pos:a,stackWeight:i}=t;if(!r||!sy.includes(a))continue;const o=e[r]||(e[r]={count:0,placed:0,weight:0,size:0});o.count++,o.weight+=i}return e}function eA(s,e){const t=ZI(s),{vBoxMaxWidth:r,hBoxMaxHeight:a}=e;let i,o,l;for(i=0,o=s.length;i<o;++i){l=s[i];const{fullSize:c}=l.box,h=t[l.stack],u=h&&l.stackWeight/h.weight;l.horizontal?(l.width=u?u*r:c&&e.availableWidth,l.height=a):(l.width=r,l.height=u?u*a:c&&e.availableHeight)}return t}function tA(s){const e=JI(s),t=ni(e.filter(h=>h.box.fullSize),!0),r=ni(ri(e,"left"),!0),a=ni(ri(e,"right")),i=ni(ri(e,"top"),!0),o=ni(ri(e,"bottom")),l=Bf(e,"x"),c=Bf(e,"y");return{fullSize:t,leftAndTop:r.concat(i),rightAndBottom:a.concat(c).concat(o).concat(l),chartArea:ri(e,"chartArea"),vertical:r.concat(a).concat(c),horizontal:i.concat(o).concat(l)}}function zf(s,e,t,r){return Math.max(s[t],e[t])+Math.max(s[r],e[r])}function ry(s,e){s.top=Math.max(s.top,e.top),s.left=Math.max(s.left,e.left),s.bottom=Math.max(s.bottom,e.bottom),s.right=Math.max(s.right,e.right)}function sA(s,e,t,r){const{pos:a,box:i}=t,o=s.maxPadding;if(!gt(a)){t.size&&(s[a]-=t.size);const m=r[t.stack]||{size:0,count:1};m.size=Math.max(m.size,t.horizontal?i.height:i.width),t.size=m.size/m.count,s[a]+=t.size}i.getPadding&&ry(o,i.getPadding());const l=Math.max(0,e.outerWidth-zf(o,s,"left","right")),c=Math.max(0,e.outerHeight-zf(o,s,"top","bottom")),h=l!==s.w,u=c!==s.h;return s.w=l,s.h=c,t.horizontal?{same:h,other:u}:{same:u,other:h}}function rA(s){const e=s.maxPadding;function t(r){const a=Math.max(e[r]-s[r],0);return s[r]+=a,a}s.y+=t("top"),s.x+=t("left"),t("right"),t("bottom")}function nA(s,e){const t=e.maxPadding;function r(a){const i={left:0,top:0,right:0,bottom:0};return a.forEach(o=>{i[o]=Math.max(e[o],t[o])}),i}return r(s?["left","right"]:["top","bottom"])}function mi(s,e,t,r){const a=[];let i,o,l,c,h,u;for(i=0,o=s.length,h=0;i<o;++i){l=s[i],c=l.box,c.update(l.width||e.w,l.height||e.h,nA(l.horizontal,e));const{same:m,other:g}=sA(e,t,l,r);h|=m&&a.length,u=u||g,c.fullSize||a.push(l)}return h&&mi(a,e,t,r)||u}function Ho(s,e,t,r,a){s.top=t,s.left=e,s.right=e+r,s.bottom=t+a,s.width=r,s.height=a}function Hf(s,e,t,r){const a=t.padding;let{x:i,y:o}=e;for(const l of s){const c=l.box,h=r[l.stack]||{placed:0,weight:1},u=l.stackWeight/h.weight||1;if(l.horizontal){const m=e.w*u,g=h.size||c.height;Ul(h.start)&&(o=h.start),c.fullSize?Ho(c,a.left,o,t.outerWidth-a.right-a.left,g):Ho(c,e.left+h.placed,o,m,g),h.start=o,h.placed+=m,o=c.bottom}else{const m=e.h*u,g=h.size||c.width;Ul(h.start)&&(i=h.start),c.fullSize?Ho(c,i,a.top,g,t.outerHeight-a.bottom-a.top):Ho(c,i,e.top+h.placed,g,m),h.start=i,h.placed+=m,i=c.right}}e.x=i,e.y=o}var Os={addBox(s,e){s.boxes||(s.boxes=[]),e.fullSize=e.fullSize||!1,e.position=e.position||"top",e.weight=e.weight||0,e._layers=e._layers||function(){return[{z:0,draw(t){e.draw(t)}}]},s.boxes.push(e)},removeBox(s,e){const t=s.boxes?s.boxes.indexOf(e):-1;t!==-1&&s.boxes.splice(t,1)},configure(s,e,t){e.fullSize=t.fullSize,e.position=t.position,e.weight=t.weight},update(s,e,t,r){if(!s)return;const a=Us(s.options.layout.padding),i=Math.max(e-a.width,0),o=Math.max(t-a.height,0),l=tA(s.boxes),c=l.vertical,h=l.horizontal;pt(s.boxes,_=>{typeof _.beforeLayout=="function"&&_.beforeLayout()});const u=c.reduce((_,y)=>y.box.options&&y.box.options.display===!1?_:_+1,0)||1,m=Object.freeze({outerWidth:e,outerHeight:t,padding:a,availableWidth:i,availableHeight:o,vBoxMaxWidth:i/2/u,hBoxMaxHeight:o/2}),g=Object.assign({},a);ry(g,Us(r));const p=Object.assign({maxPadding:g,w:i,h:o,x:a.left,y:a.top},a),j=eA(c.concat(h),m);mi(l.fullSize,p,m,j),mi(c,p,m,j),mi(h,p,m,j)&&mi(c,p,m,j),rA(p),Hf(l.leftAndTop,p,m,j),p.x+=p.w,p.y+=p.h,Hf(l.rightAndBottom,p,m,j),s.chartArea={left:p.left,top:p.top,right:p.left+p.w,bottom:p.top+p.h,height:p.h,width:p.w},pt(l.chartArea,_=>{const y=_.box;Object.assign(y,s.chartArea),y.update(p.w,p.h,{left:0,top:0,right:0,bottom:0})})}};class ny{acquireContext(e,t){}releaseContext(e){return!1}addEventListener(e,t,r){}removeEventListener(e,t,r){}getDevicePixelRatio(){return 1}getMaximumSize(e,t,r,a){return t=Math.max(0,t||e.width),r=r||e.height,{width:t,height:Math.max(0,a?Math.floor(t/a):r)}}isAttached(e){return!0}updateConfig(e){}}class aA extends ny{acquireContext(e){return e&&e.getContext&&e.getContext("2d")||null}updateConfig(e){e.options.animation=!1}}const ol="$chartjs",iA={touchstart:"mousedown",touchmove:"mousemove",touchend:"mouseup",pointerenter:"mouseenter",pointerdown:"mousedown",pointermove:"mousemove",pointerup:"mouseup",pointerleave:"mouseout",pointerout:"mouseout"},Wf=s=>s===null||s==="";function oA(s,e){const t=s.style,r=s.getAttribute("height"),a=s.getAttribute("width");if(s[ol]={initial:{height:r,width:a,style:{display:t.display,height:t.height,width:t.width}}},t.display=t.display||"block",t.boxSizing=t.boxSizing||"border-box",Wf(a)){const i=Cf(s,"width");i!==void 0&&(s.width=i)}if(Wf(r))if(s.style.height==="")s.height=s.width/(e||2);else{const i=Cf(s,"height");i!==void 0&&(s.height=i)}return s}const ay=xI?{passive:!0}:!1;function lA(s,e,t){s&&s.addEventListener(e,t,ay)}function cA(s,e,t){s&&s.canvas&&s.canvas.removeEventListener(e,t,ay)}function dA(s,e){const t=iA[s.type]||s.type,{x:r,y:a}=Tn(s,e);return{type:t,chart:e,native:s,x:r!==void 0?r:null,y:a!==void 0?a:null}}function Hl(s,e){for(const t of s)if(t===e||t.contains(e))return!0}function hA(s,e,t){const r=s.canvas,a=new MutationObserver(i=>{let o=!1;for(const l of i)o=o||Hl(l.addedNodes,r),o=o&&!Hl(l.removedNodes,r);o&&t()});return a.observe(document,{childList:!0,subtree:!0}),a}function uA(s,e,t){const r=s.canvas,a=new MutationObserver(i=>{let o=!1;for(const l of i)o=o||Hl(l.removedNodes,r),o=o&&!Hl(l.addedNodes,r);o&&t()});return a.observe(document,{childList:!0,subtree:!0}),a}const Gi=new Map;let qf=0;function iy(){const s=window.devicePixelRatio;s!==qf&&(qf=s,Gi.forEach((e,t)=>{t.currentDevicePixelRatio!==s&&e()}))}function mA(s,e){Gi.size||window.addEventListener("resize",iy),Gi.set(s,e)}function gA(s){Gi.delete(s),Gi.size||window.removeEventListener("resize",iy)}function fA(s,e,t){const r=s.canvas,a=r&&Mu(r);if(!a)return;const i=Ub((l,c)=>{const h=a.clientWidth;t(l,c),h<a.clientWidth&&t()},window),o=new ResizeObserver(l=>{const c=l[0],h=c.contentRect.width,u=c.contentRect.height;h===0&&u===0||i(h,u)});return o.observe(a),mA(s,i),o}function md(s,e,t){t&&t.disconnect(),e==="resize"&&gA(s)}function pA(s,e,t){const r=s.canvas,a=Ub(i=>{s.ctx!==null&&t(dA(i,s))},s);return lA(r,e,a),a}class xA extends ny{acquireContext(e,t){const r=e&&e.getContext&&e.getContext("2d");return r&&r.canvas===e?(oA(e,t),r):null}releaseContext(e){const t=e.canvas;if(!t[ol])return!1;const r=t[ol].initial;["height","width"].forEach(i=>{const o=r[i];kt(o)?t.removeAttribute(i):t.setAttribute(i,o)});const a=r.style||{};return Object.keys(a).forEach(i=>{t.style[i]=a[i]}),t.width=t.width,delete t[ol],!0}addEventListener(e,t,r){this.removeEventListener(e,t);const a=e.$proxies||(e.$proxies={}),o={attach:hA,detach:uA,resize:fA}[t]||pA;a[t]=o(e,t,r)}removeEventListener(e,t){const r=e.$proxies||(e.$proxies={}),a=r[t];if(!a)return;({attach:md,detach:md,resize:md}[t]||cA)(e,t,a),r[t]=void 0}getDevicePixelRatio(){return window.devicePixelRatio}getMaximumSize(e,t,r,a){return pI(e,t,r,a)}isAttached(e){const t=e&&Mu(e);return!!(t&&t.isConnected)}}function bA(s){return!Du()||typeof OffscreenCanvas<"u"&&s instanceof OffscreenCanvas?aA:xA}class Vr{constructor(){Je(this,"x");Je(this,"y");Je(this,"active",!1);Je(this,"options");Je(this,"$animations")}tooltipPosition(e){const{x:t,y:r}=this.getProps(["x","y"],e);return{x:t,y:r}}hasValue(){return Hi(this.x)&&Hi(this.y)}getProps(e,t){const r=this.$animations;if(!t||!r)return this;const a={};return e.forEach(i=>{a[i]=r[i]&&r[i].active()?r[i]._to:this[i]}),a}}Je(Vr,"defaults",{}),Je(Vr,"defaultRoutes");function yA(s,e){const t=s.options.ticks,r=vA(s),a=Math.min(t.maxTicksLimit||r,r),i=t.major.enabled?kA(e):[],o=i.length,l=i[0],c=i[o-1],h=[];if(o>a)return _A(e,h,i,o/a),h;const u=wA(i,e,a);if(o>0){let m,g;const p=o>1?Math.round((c-l)/(o-1)):null;for(Wo(e,h,u,kt(p)?0:l-p,l),m=0,g=o-1;m<g;m++)Wo(e,h,u,i[m],i[m+1]);return Wo(e,h,u,c,kt(p)?e.length:c+p),h}return Wo(e,h,u),h}function vA(s){const e=s.options.offset,t=s._tickSize(),r=s._length/t+(e?0:1),a=s._maxLength/t;return Math.floor(Math.min(r,a))}function wA(s,e,t){const r=NA(s),a=e.length/t;if(!r)return Math.max(a,1);const i=uT(r);for(let o=0,l=i.length-1;o<l;o++){const c=i[o];if(c>a)return c}return Math.max(a,1)}function kA(s){const e=[];let t,r;for(t=0,r=s.length;t<r;t++)s[t].major&&e.push(t);return e}function _A(s,e,t,r){let a=0,i=t[0],o;for(r=Math.ceil(r),o=0;o<s.length;o++)o===i&&(e.push(s[o]),a++,i=t[a*r])}function Wo(s,e,t,r,a){const i=ot(r,0),o=Math.min(ot(a,s.length),s.length);let l=0,c,h,u;for(t=Math.ceil(t),a&&(c=a-r,t=c/Math.floor(c/t)),u=i;u<0;)l++,u=Math.round(i+l*t);for(h=Math.max(i,0);h<o;h++)h===u&&(e.push(s[h]),l++,u=Math.round(i+l*t))}function NA(s){const e=s.length;let t,r;if(e<2)return!1;for(r=s[0],t=1;t<e;++t)if(s[t]-s[t-1]!==r)return!1;return r}const jA=s=>s==="left"?"right":s==="right"?"left":s,Gf=(s,e,t)=>e==="top"||e==="left"?s[e]+t:s[e]-t,Kf=(s,e)=>Math.min(e||s,s);function Yf(s,e){const t=[],r=s.length/e,a=s.length;let i=0;for(;i<a;i+=r)t.push(s[Math.floor(i)]);return t}function EA(s,e,t){const r=s.ticks.length,a=Math.min(e,r-1),i=s._startPixel,o=s._endPixel,l=1e-6;let c=s.getPixelForTick(a),h;if(!(t&&(r===1?h=Math.max(c-i,o-c):e===0?h=(s.getPixelForTick(1)-c)/2:h=(c-s.getPixelForTick(a-1))/2,c+=a<e?h:-h,c<i-l||c>o+l)))return c}function SA(s,e){pt(s,t=>{const r=t.gc,a=r.length/2;let i;if(a>e){for(i=0;i<a;++i)delete t.data[r[i]];r.splice(0,a)}})}function ai(s){return s.drawTicks?s.tickLength:0}function Qf(s,e){if(!s.display)return 0;const t=cs(s.font,e),r=Us(s.padding);return(Wt(s.text)?s.text.length:1)*t.lineHeight+r.height}function TA(s,e){return Xn(s,{scale:e,type:"scale"})}function IA(s,e,t){return Xn(s,{tick:t,index:e,type:"tick"})}function AA(s,e,t){let r=ju(s);return(t&&e!=="right"||!t&&e==="right")&&(r=jA(r)),r}function CA(s,e,t,r){const{top:a,left:i,bottom:o,right:l,chart:c}=s,{chartArea:h,scales:u}=c;let m=0,g,p,j;const _=o-a,y=l-i;if(s.isHorizontal()){if(p=as(r,i,l),gt(t)){const M=Object.keys(t)[0],D=t[M];j=u[M].getPixelForValue(D)+_-e}else t==="center"?j=(h.bottom+h.top)/2+_-e:j=Gf(s,t,e);g=l-i}else{if(gt(t)){const M=Object.keys(t)[0],D=t[M];p=u[M].getPixelForValue(D)-y+e}else t==="center"?p=(h.left+h.right)/2-y+e:p=Gf(s,t,e);j=as(r,o,a),m=t==="left"?-Ws:Ws}return{titleX:p,titleY:j,maxWidth:g,rotation:m}}class Ua extends Vr{constructor(e){super(),this.id=e.id,this.type=e.type,this.options=void 0,this.ctx=e.ctx,this.chart=e.chart,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this._margins={left:0,right:0,top:0,bottom:0},this.maxWidth=void 0,this.maxHeight=void 0,this.paddingTop=void 0,this.paddingBottom=void 0,this.paddingLeft=void 0,this.paddingRight=void 0,this.axis=void 0,this.labelRotation=void 0,this.min=void 0,this.max=void 0,this._range=void 0,this.ticks=[],this._gridLineItems=null,this._labelItems=null,this._labelSizes=null,this._length=0,this._maxLength=0,this._longestTextCache={},this._startPixel=void 0,this._endPixel=void 0,this._reversePixels=!1,this._userMax=void 0,this._userMin=void 0,this._suggestedMax=void 0,this._suggestedMin=void 0,this._ticksLength=0,this._borderValue=0,this._cache={},this._dataLimitsCached=!1,this.$context=void 0}init(e){this.options=e.setContext(this.getContext()),this.axis=e.axis,this._userMin=this.parse(e.min),this._userMax=this.parse(e.max),this._suggestedMin=this.parse(e.suggestedMin),this._suggestedMax=this.parse(e.suggestedMax)}parse(e,t){return e}getUserBounds(){let{_userMin:e,_userMax:t,_suggestedMin:r,_suggestedMax:a}=this;return e=Ys(e,Number.POSITIVE_INFINITY),t=Ys(t,Number.NEGATIVE_INFINITY),r=Ys(r,Number.POSITIVE_INFINITY),a=Ys(a,Number.NEGATIVE_INFINITY),{min:Ys(e,r),max:Ys(t,a),minDefined:Fs(e),maxDefined:Fs(t)}}getMinMax(e){let{min:t,max:r,minDefined:a,maxDefined:i}=this.getUserBounds(),o;if(a&&i)return{min:t,max:r};const l=this.getMatchingVisibleMetas();for(let c=0,h=l.length;c<h;++c)o=l[c].controller.getMinMax(this,e),a||(t=Math.min(t,o.min)),i||(r=Math.max(r,o.max));return t=i&&t>r?r:t,r=a&&t>r?t:r,{min:Ys(t,Ys(r,t)),max:Ys(r,Ys(t,r))}}getPadding(){return{left:this.paddingLeft||0,top:this.paddingTop||0,right:this.paddingRight||0,bottom:this.paddingBottom||0}}getTicks(){return this.ticks}getLabels(){const e=this.chart.data;return this.options.labels||(this.isHorizontal()?e.xLabels:e.yLabels)||e.labels||[]}getLabelItems(e=this.chart.chartArea){return this._labelItems||(this._labelItems=this._computeLabelItems(e))}beforeLayout(){this._cache={},this._dataLimitsCached=!1}beforeUpdate(){jt(this.options.beforeUpdate,[this])}update(e,t,r){const{beginAtZero:a,grace:i,ticks:o}=this.options,l=o.sampleSize;this.beforeUpdate(),this.maxWidth=e,this.maxHeight=t,this._margins=r=Object.assign({left:0,right:0,top:0,bottom:0},r),this.ticks=null,this._labelSizes=null,this._gridLineItems=null,this._labelItems=null,this.beforeSetDimensions(),this.setDimensions(),this.afterSetDimensions(),this._maxLength=this.isHorizontal()?this.width+r.left+r.right:this.height+r.top+r.bottom,this._dataLimitsCached||(this.beforeDataLimits(),this.determineDataLimits(),this.afterDataLimits(),this._range=KT(this,i,a),this._dataLimitsCached=!0),this.beforeBuildTicks(),this.ticks=this.buildTicks()||[],this.afterBuildTicks();const c=l<this.ticks.length;this._convertTicksToLabels(c?Yf(this.ticks,l):this.ticks),this.configure(),this.beforeCalculateLabelRotation(),this.calculateLabelRotation(),this.afterCalculateLabelRotation(),o.display&&(o.autoSkip||o.source==="auto")&&(this.ticks=yA(this,this.ticks),this._labelSizes=null,this.afterAutoSkip()),c&&this._convertTicksToLabels(this.ticks),this.beforeFit(),this.fit(),this.afterFit(),this.afterUpdate()}configure(){let e=this.options.reverse,t,r;this.isHorizontal()?(t=this.left,r=this.right):(t=this.top,r=this.bottom,e=!e),this._startPixel=t,this._endPixel=r,this._reversePixels=e,this._length=r-t,this._alignToPixels=this.options.alignToPixels}afterUpdate(){jt(this.options.afterUpdate,[this])}beforeSetDimensions(){jt(this.options.beforeSetDimensions,[this])}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=0,this.right=this.width):(this.height=this.maxHeight,this.top=0,this.bottom=this.height),this.paddingLeft=0,this.paddingTop=0,this.paddingRight=0,this.paddingBottom=0}afterSetDimensions(){jt(this.options.afterSetDimensions,[this])}_callHooks(e){this.chart.notifyPlugins(e,this.getContext()),jt(this.options[e],[this])}beforeDataLimits(){this._callHooks("beforeDataLimits")}determineDataLimits(){}afterDataLimits(){this._callHooks("afterDataLimits")}beforeBuildTicks(){this._callHooks("beforeBuildTicks")}buildTicks(){return[]}afterBuildTicks(){this._callHooks("afterBuildTicks")}beforeTickToLabelConversion(){jt(this.options.beforeTickToLabelConversion,[this])}generateTickLabels(e){const t=this.options.ticks;let r,a,i;for(r=0,a=e.length;r<a;r++)i=e[r],i.label=jt(t.callback,[i.value,r,e],this)}afterTickToLabelConversion(){jt(this.options.afterTickToLabelConversion,[this])}beforeCalculateLabelRotation(){jt(this.options.beforeCalculateLabelRotation,[this])}calculateLabelRotation(){const e=this.options,t=e.ticks,r=Kf(this.ticks.length,e.ticks.maxTicksLimit),a=t.minRotation||0,i=t.maxRotation;let o=a,l,c,h;if(!this._isVisible()||!t.display||a>=i||r<=1||!this.isHorizontal()){this.labelRotation=a;return}const u=this._getLabelSizes(),m=u.widest.width,g=u.highest.height,p=Ps(this.chart.width-m,0,this.maxWidth);l=e.offset?this.maxWidth/r:p/(r-1),m+6>l&&(l=p/(r-(e.offset?.5:1)),c=this.maxHeight-ai(e.grid)-t.padding-Qf(e.title,this.chart.options.font),h=Math.sqrt(m*m+g*g),o=pT(Math.min(Math.asin(Ps((u.highest.height+6)/l,-1,1)),Math.asin(Ps(c/h,-1,1))-Math.asin(Ps(g/h,-1,1)))),o=Math.max(a,Math.min(i,o))),this.labelRotation=o}afterCalculateLabelRotation(){jt(this.options.afterCalculateLabelRotation,[this])}afterAutoSkip(){}beforeFit(){jt(this.options.beforeFit,[this])}fit(){const e={width:0,height:0},{chart:t,options:{ticks:r,title:a,grid:i}}=this,o=this._isVisible(),l=this.isHorizontal();if(o){const c=Qf(a,t.options.font);if(l?(e.width=this.maxWidth,e.height=ai(i)+c):(e.height=this.maxHeight,e.width=ai(i)+c),r.display&&this.ticks.length){const{first:h,last:u,widest:m,highest:g}=this._getLabelSizes(),p=r.padding*2,j=Cn(this.labelRotation),_=Math.cos(j),y=Math.sin(j);if(l){const M=r.mirror?0:y*m.width+_*g.height;e.height=Math.min(this.maxHeight,e.height+M+p)}else{const M=r.mirror?0:_*m.width+y*g.height;e.width=Math.min(this.maxWidth,e.width+M+p)}this._calculatePadding(h,u,y,_)}}this._handleMargins(),l?(this.width=this._length=t.width-this._margins.left-this._margins.right,this.height=e.height):(this.width=e.width,this.height=this._length=t.height-this._margins.top-this._margins.bottom)}_calculatePadding(e,t,r,a){const{ticks:{align:i,padding:o},position:l}=this.options,c=this.labelRotation!==0,h=l!=="top"&&this.axis==="x";if(this.isHorizontal()){const u=this.getPixelForTick(0)-this.left,m=this.right-this.getPixelForTick(this.ticks.length-1);let g=0,p=0;c?h?(g=a*e.width,p=r*t.height):(g=r*e.height,p=a*t.width):i==="start"?p=t.width:i==="end"?g=e.width:i!=="inner"&&(g=e.width/2,p=t.width/2),this.paddingLeft=Math.max((g-u+o)*this.width/(this.width-u),0),this.paddingRight=Math.max((p-m+o)*this.width/(this.width-m),0)}else{let u=t.height/2,m=e.height/2;i==="start"?(u=0,m=e.height):i==="end"&&(u=t.height,m=0),this.paddingTop=u+o,this.paddingBottom=m+o}}_handleMargins(){this._margins&&(this._margins.left=Math.max(this.paddingLeft,this._margins.left),this._margins.top=Math.max(this.paddingTop,this._margins.top),this._margins.right=Math.max(this.paddingRight,this._margins.right),this._margins.bottom=Math.max(this.paddingBottom,this._margins.bottom))}afterFit(){jt(this.options.afterFit,[this])}isHorizontal(){const{axis:e,position:t}=this.options;return t==="top"||t==="bottom"||e==="x"}isFullSize(){return this.options.fullSize}_convertTicksToLabels(e){this.beforeTickToLabelConversion(),this.generateTickLabels(e);let t,r;for(t=0,r=e.length;t<r;t++)kt(e[t].label)&&(e.splice(t,1),r--,t--);this.afterTickToLabelConversion()}_getLabelSizes(){let e=this._labelSizes;if(!e){const t=this.options.ticks.sampleSize;let r=this.ticks;t<r.length&&(r=Yf(r,t)),this._labelSizes=e=this._computeLabelSizes(r,r.length,this.options.ticks.maxTicksLimit)}return e}_computeLabelSizes(e,t,r){const{ctx:a,_longestTextCache:i}=this,o=[],l=[],c=Math.floor(t/Kf(t,r));let h=0,u=0,m,g,p,j,_,y,M,D,T,R,P;for(m=0;m<t;m+=c){if(j=e[m].label,_=this._resolveTickFontOptions(m),a.font=y=_.string,M=i[y]=i[y]||{data:{},gc:[]},D=_.lineHeight,T=R=0,!kt(j)&&!Wt(j))T=Ef(a,M.data,M.gc,T,j),R=D;else if(Wt(j))for(g=0,p=j.length;g<p;++g)P=j[g],!kt(P)&&!Wt(P)&&(T=Ef(a,M.data,M.gc,T,P),R+=D);o.push(T),l.push(R),h=Math.max(T,h),u=Math.max(R,u)}SA(i,t);const C=o.indexOf(h),N=l.indexOf(u),b=v=>({width:o[v]||0,height:l[v]||0});return{first:b(0),last:b(t-1),widest:b(C),highest:b(N),widths:o,heights:l}}getLabelForValue(e){return e}getPixelForValue(e,t){return NaN}getValueForPixel(e){}getPixelForTick(e){const t=this.ticks;return e<0||e>t.length-1?null:this.getPixelForValue(t[e].value)}getPixelForDecimal(e){this._reversePixels&&(e=1-e);const t=this._startPixel+e*this._length;return yT(this._alignToPixels?Nn(this.chart,t,0):t)}getDecimalForPixel(e){const t=(e-this._startPixel)/this._length;return this._reversePixels?1-t:t}getBasePixel(){return this.getPixelForValue(this.getBaseValue())}getBaseValue(){const{min:e,max:t}=this;return e<0&&t<0?t:e>0&&t>0?e:0}getContext(e){const t=this.ticks||[];if(e>=0&&e<t.length){const r=t[e];return r.$context||(r.$context=IA(this.getContext(),e,r))}return this.$context||(this.$context=TA(this.chart.getContext(),this))}_tickSize(){const e=this.options.ticks,t=Cn(this.labelRotation),r=Math.abs(Math.cos(t)),a=Math.abs(Math.sin(t)),i=this._getLabelSizes(),o=e.autoSkipPadding||0,l=i?i.widest.width+o:0,c=i?i.highest.height+o:0;return this.isHorizontal()?c*r>l*a?l/r:c/a:c*a<l*r?c/r:l/a}_isVisible(){const e=this.options.display;return e!=="auto"?!!e:this.getMatchingVisibleMetas().length>0}_computeGridLineItems(e){const t=this.axis,r=this.chart,a=this.options,{grid:i,position:o,border:l}=a,c=i.offset,h=this.isHorizontal(),m=this.ticks.length+(c?1:0),g=ai(i),p=[],j=l.setContext(this.getContext()),_=j.display?j.width:0,y=_/2,M=function(V){return Nn(r,V,_)};let D,T,R,P,C,N,b,v,S,E,k,w;if(o==="top")D=M(this.bottom),N=this.bottom-g,v=D-y,E=M(e.top)+y,w=e.bottom;else if(o==="bottom")D=M(this.top),E=e.top,w=M(e.bottom)-y,N=D+y,v=this.top+g;else if(o==="left")D=M(this.right),C=this.right-g,b=D-y,S=M(e.left)+y,k=e.right;else if(o==="right")D=M(this.left),S=e.left,k=M(e.right)-y,C=D+y,b=this.left+g;else if(t==="x"){if(o==="center")D=M((e.top+e.bottom)/2+.5);else if(gt(o)){const V=Object.keys(o)[0],X=o[V];D=M(this.chart.scales[V].getPixelForValue(X))}E=e.top,w=e.bottom,N=D+y,v=N+g}else if(t==="y"){if(o==="center")D=M((e.left+e.right)/2);else if(gt(o)){const V=Object.keys(o)[0],X=o[V];D=M(this.chart.scales[V].getPixelForValue(X))}C=D-y,b=C-g,S=e.left,k=e.right}const Q=ot(a.ticks.maxTicksLimit,m),ae=Math.max(1,Math.ceil(m/Q));for(T=0;T<m;T+=ae){const V=this.getContext(T),X=i.setContext(V),he=l.setContext(V),B=X.lineWidth,te=X.color,ve=he.dash||[],W=he.dashOffset,F=X.tickWidth,re=X.tickColor,de=X.tickBorderDash||[],$=X.tickBorderDashOffset;R=EA(this,T,c),R!==void 0&&(P=Nn(r,R,B),h?C=b=S=k=P:N=v=E=w=P,p.push({tx1:C,ty1:N,tx2:b,ty2:v,x1:S,y1:E,x2:k,y2:w,width:B,color:te,borderDash:ve,borderDashOffset:W,tickWidth:F,tickColor:re,tickBorderDash:de,tickBorderDashOffset:$}))}return this._ticksLength=m,this._borderValue=D,p}_computeLabelItems(e){const t=this.axis,r=this.options,{position:a,ticks:i}=r,o=this.isHorizontal(),l=this.ticks,{align:c,crossAlign:h,padding:u,mirror:m}=i,g=ai(r.grid),p=g+u,j=m?-u:p,_=-Cn(this.labelRotation),y=[];let M,D,T,R,P,C,N,b,v,S,E,k,w="middle";if(a==="top")C=this.bottom-j,N=this._getXAxisLabelAlignment();else if(a==="bottom")C=this.top+j,N=this._getXAxisLabelAlignment();else if(a==="left"){const ae=this._getYAxisLabelAlignment(g);N=ae.textAlign,P=ae.x}else if(a==="right"){const ae=this._getYAxisLabelAlignment(g);N=ae.textAlign,P=ae.x}else if(t==="x"){if(a==="center")C=(e.top+e.bottom)/2+p;else if(gt(a)){const ae=Object.keys(a)[0],V=a[ae];C=this.chart.scales[ae].getPixelForValue(V)+p}N=this._getXAxisLabelAlignment()}else if(t==="y"){if(a==="center")P=(e.left+e.right)/2-p;else if(gt(a)){const ae=Object.keys(a)[0],V=a[ae];P=this.chart.scales[ae].getPixelForValue(V)}N=this._getYAxisLabelAlignment(g).textAlign}t==="y"&&(c==="start"?w="top":c==="end"&&(w="bottom"));const Q=this._getLabelSizes();for(M=0,D=l.length;M<D;++M){T=l[M],R=T.label;const ae=i.setContext(this.getContext(M));b=this.getPixelForTick(M)+i.labelOffset,v=this._resolveTickFontOptions(M),S=v.lineHeight,E=Wt(R)?R.length:1;const V=E/2,X=ae.color,he=ae.textStrokeColor,B=ae.textStrokeWidth;let te=N;o?(P=b,N==="inner"&&(M===D-1?te=this.options.reverse?"left":"right":M===0?te=this.options.reverse?"right":"left":te="center"),a==="top"?h==="near"||_!==0?k=-E*S+S/2:h==="center"?k=-Q.highest.height/2-V*S+S:k=-Q.highest.height+S/2:h==="near"||_!==0?k=S/2:h==="center"?k=Q.highest.height/2-V*S:k=Q.highest.height-E*S,m&&(k*=-1),_!==0&&!ae.showLabelBackdrop&&(P+=S/2*Math.sin(_))):(C=b,k=(1-E)*S/2);let ve;if(ae.showLabelBackdrop){const W=Us(ae.backdropPadding),F=Q.heights[M],re=Q.widths[M];let de=k-W.top,$=0-W.left;switch(w){case"middle":de-=F/2;break;case"bottom":de-=F;break}switch(N){case"center":$-=re/2;break;case"right":$-=re;break;case"inner":M===D-1?$-=re:M>0&&($-=re/2);break}ve={left:$,top:de,width:re+W.width,height:F+W.height,color:ae.backdropColor}}y.push({label:R,font:v,textOffset:k,options:{rotation:_,color:X,strokeColor:he,strokeWidth:B,textAlign:te,textBaseline:w,translation:[P,C],backdrop:ve}})}return y}_getXAxisLabelAlignment(){const{position:e,ticks:t}=this.options;if(-Cn(this.labelRotation))return e==="top"?"left":"right";let a="center";return t.align==="start"?a="left":t.align==="end"?a="right":t.align==="inner"&&(a="inner"),a}_getYAxisLabelAlignment(e){const{position:t,ticks:{crossAlign:r,mirror:a,padding:i}}=this.options,o=this._getLabelSizes(),l=e+i,c=o.widest.width;let h,u;return t==="left"?a?(u=this.right+i,r==="near"?h="left":r==="center"?(h="center",u+=c/2):(h="right",u+=c)):(u=this.right-l,r==="near"?h="right":r==="center"?(h="center",u-=c/2):(h="left",u=this.left)):t==="right"?a?(u=this.left+i,r==="near"?h="right":r==="center"?(h="center",u-=c/2):(h="left",u-=c)):(u=this.left+l,r==="near"?h="left":r==="center"?(h="center",u+=c/2):(h="right",u=this.right)):h="right",{textAlign:h,x:u}}_computeLabelArea(){if(this.options.ticks.mirror)return;const e=this.chart,t=this.options.position;if(t==="left"||t==="right")return{top:0,left:this.left,bottom:e.height,right:this.right};if(t==="top"||t==="bottom")return{top:this.top,left:0,bottom:this.bottom,right:e.width}}drawBackground(){const{ctx:e,options:{backgroundColor:t},left:r,top:a,width:i,height:o}=this;t&&(e.save(),e.fillStyle=t,e.fillRect(r,a,i,o),e.restore())}getLineWidthForValue(e){const t=this.options.grid;if(!this._isVisible()||!t.display)return 0;const a=this.ticks.findIndex(i=>i.value===e);return a>=0?t.setContext(this.getContext(a)).lineWidth:0}drawGrid(e){const t=this.options.grid,r=this.ctx,a=this._gridLineItems||(this._gridLineItems=this._computeGridLineItems(e));let i,o;const l=(c,h,u)=>{!u.width||!u.color||(r.save(),r.lineWidth=u.width,r.strokeStyle=u.color,r.setLineDash(u.borderDash||[]),r.lineDashOffset=u.borderDashOffset,r.beginPath(),r.moveTo(c.x,c.y),r.lineTo(h.x,h.y),r.stroke(),r.restore())};if(t.display)for(i=0,o=a.length;i<o;++i){const c=a[i];t.drawOnChartArea&&l({x:c.x1,y:c.y1},{x:c.x2,y:c.y2},c),t.drawTicks&&l({x:c.tx1,y:c.ty1},{x:c.tx2,y:c.ty2},{color:c.tickColor,width:c.tickWidth,borderDash:c.tickBorderDash,borderDashOffset:c.tickBorderDashOffset})}}drawBorder(){const{chart:e,ctx:t,options:{border:r,grid:a}}=this,i=r.setContext(this.getContext()),o=r.display?i.width:0;if(!o)return;const l=a.setContext(this.getContext(0)).lineWidth,c=this._borderValue;let h,u,m,g;this.isHorizontal()?(h=Nn(e,this.left,o)-o/2,u=Nn(e,this.right,l)+l/2,m=g=c):(m=Nn(e,this.top,o)-o/2,g=Nn(e,this.bottom,l)+l/2,h=u=c),t.save(),t.lineWidth=i.width,t.strokeStyle=i.color,t.beginPath(),t.moveTo(h,m),t.lineTo(u,g),t.stroke(),t.restore()}drawLabels(e){if(!this.options.ticks.display)return;const r=this.ctx,a=this._computeLabelArea();a&&Su(r,a);const i=this.getLabelItems(e);for(const o of i){const l=o.options,c=o.font,h=o.label,u=o.textOffset;qi(r,h,0,u,c,l)}a&&Tu(r)}drawTitle(){const{ctx:e,options:{position:t,title:r,reverse:a}}=this;if(!r.display)return;const i=cs(r.font),o=Us(r.padding),l=r.align;let c=i.lineHeight/2;t==="bottom"||t==="center"||gt(t)?(c+=o.bottom,Wt(r.text)&&(c+=i.lineHeight*(r.text.length-1))):c+=o.top;const{titleX:h,titleY:u,maxWidth:m,rotation:g}=CA(this,c,t,l);qi(e,r.text,0,0,i,{color:r.color,maxWidth:m,rotation:g,textAlign:AA(l,t,a),textBaseline:"middle",translation:[h,u]})}draw(e){this._isVisible()&&(this.drawBackground(),this.drawGrid(e),this.drawBorder(),this.drawTitle(),this.drawLabels(e))}_layers(){const e=this.options,t=e.ticks&&e.ticks.z||0,r=ot(e.grid&&e.grid.z,-1),a=ot(e.border&&e.border.z,0);return!this._isVisible()||this.draw!==Ua.prototype.draw?[{z:t,draw:i=>{this.draw(i)}}]:[{z:r,draw:i=>{this.drawBackground(),this.drawGrid(i),this.drawTitle()}},{z:a,draw:()=>{this.drawBorder()}},{z:t,draw:i=>{this.drawLabels(i)}}]}getMatchingVisibleMetas(e){const t=this.chart.getSortedVisibleDatasetMetas(),r=this.axis+"AxisID",a=[];let i,o;for(i=0,o=t.length;i<o;++i){const l=t[i];l[r]===this.id&&(!e||l.type===e)&&a.push(l)}return a}_resolveTickFontOptions(e){const t=this.options.ticks.setContext(this.getContext(e));return cs(t.font)}_maxDigits(){const e=this._resolveTickFontOptions(0).lineHeight;return(this.isHorizontal()?this.width:this.height)/e}}class qo{constructor(e,t,r){this.type=e,this.scope=t,this.override=r,this.items=Object.create(null)}isForType(e){return Object.prototype.isPrototypeOf.call(this.type.prototype,e.prototype)}register(e){const t=Object.getPrototypeOf(e);let r;$A(t)&&(r=this.register(t));const a=this.items,i=e.id,o=this.scope+"."+i;if(!i)throw new Error("class does not have id: "+e);return i in a||(a[i]=e,DA(e,o,r),this.override&&Pt.override(e.id,e.overrides)),o}get(e){return this.items[e]}unregister(e){const t=this.items,r=e.id,a=this.scope;r in t&&delete t[r],a&&r in Pt[a]&&(delete Pt[a][r],this.override&&delete Wn[r])}}function DA(s,e,t){const r=zi(Object.create(null),[t?Pt.get(t):{},Pt.get(e),s.defaults]);Pt.set(e,r),s.defaultRoutes&&MA(e,s.defaultRoutes),s.descriptors&&Pt.describe(e,s.descriptors)}function MA(s,e){Object.keys(e).forEach(t=>{const r=t.split("."),a=r.pop(),i=[s].concat(r).join("."),o=e[t].split("."),l=o.pop(),c=o.join(".");Pt.route(i,a,c,l)})}function $A(s){return"id"in s&&"defaults"in s}class RA{constructor(){this.controllers=new qo(Si,"datasets",!0),this.elements=new qo(Vr,"elements"),this.plugins=new qo(Object,"plugins"),this.scales=new qo(Ua,"scales"),this._typedRegistries=[this.controllers,this.scales,this.elements]}add(...e){this._each("register",e)}remove(...e){this._each("unregister",e)}addControllers(...e){this._each("register",e,this.controllers)}addElements(...e){this._each("register",e,this.elements)}addPlugins(...e){this._each("register",e,this.plugins)}addScales(...e){this._each("register",e,this.scales)}getController(e){return this._get(e,this.controllers,"controller")}getElement(e){return this._get(e,this.elements,"element")}getPlugin(e){return this._get(e,this.plugins,"plugin")}getScale(e){return this._get(e,this.scales,"scale")}removeControllers(...e){this._each("unregister",e,this.controllers)}removeElements(...e){this._each("unregister",e,this.elements)}removePlugins(...e){this._each("unregister",e,this.plugins)}removeScales(...e){this._each("unregister",e,this.scales)}_each(e,t,r){[...t].forEach(a=>{const i=r||this._getRegistryForType(a);r||i.isForType(a)||i===this.plugins&&a.id?this._exec(e,i,a):pt(a,o=>{const l=r||this._getRegistryForType(o);this._exec(e,l,o)})})}_exec(e,t,r){const a=_u(e);jt(r["before"+a],[],r),t[e](r),jt(r["after"+a],[],r)}_getRegistryForType(e){for(let t=0;t<this._typedRegistries.length;t++){const r=this._typedRegistries[t];if(r.isForType(e))return r}return this.plugins}_get(e,t,r){const a=t.get(e);if(a===void 0)throw new Error('"'+e+'" is not a registered '+r+".");return a}}var Xs=new RA;class PA{constructor(){this._init=void 0}notify(e,t,r,a){if(t==="beforeInit"&&(this._init=this._createDescriptors(e,!0),this._notify(this._init,e,"install")),this._init===void 0)return;const i=a?this._descriptors(e).filter(a):this._descriptors(e),o=this._notify(i,e,t,r);return t==="afterDestroy"&&(this._notify(i,e,"stop"),this._notify(this._init,e,"uninstall"),this._init=void 0),o}_notify(e,t,r,a){a=a||{};for(const i of e){const o=i.plugin,l=o[r],c=[t,a,i.options];if(jt(l,c,o)===!1&&a.cancelable)return!1}return!0}invalidate(){kt(this._cache)||(this._oldCache=this._cache,this._cache=void 0)}_descriptors(e){if(this._cache)return this._cache;const t=this._cache=this._createDescriptors(e);return this._notifyStateChanges(e),t}_createDescriptors(e,t){const r=e&&e.config,a=ot(r.options&&r.options.plugins,{}),i=OA(r);return a===!1&&!t?[]:VA(e,i,a,t)}_notifyStateChanges(e){const t=this._oldCache||[],r=this._cache,a=(i,o)=>i.filter(l=>!o.some(c=>l.plugin.id===c.plugin.id));this._notify(a(t,r),e,"stop"),this._notify(a(r,t),e,"start")}}function OA(s){const e={},t=[],r=Object.keys(Xs.plugins.items);for(let i=0;i<r.length;i++)t.push(Xs.getPlugin(r[i]));const a=s.plugins||[];for(let i=0;i<a.length;i++){const o=a[i];t.indexOf(o)===-1&&(t.push(o),e[o.id]=!0)}return{plugins:t,localIds:e}}function LA(s,e){return!e&&s===!1?null:s===!0?{}:s}function VA(s,{plugins:e,localIds:t},r,a){const i=[],o=s.getContext();for(const l of e){const c=l.id,h=LA(r[c],a);h!==null&&i.push({plugin:l,options:FA(s.config,{plugin:l,local:t[c]},h,o)})}return i}function FA(s,{plugin:e,local:t},r,a){const i=s.pluginScopeKeys(e),o=s.getOptionScopes(r,i);return t&&e.defaults&&o.push(e.defaults),s.createResolver(o,a,[""],{scriptable:!1,indexable:!1,allKeys:!0})}function sh(s,e){const t=Pt.datasets[s]||{};return((e.datasets||{})[s]||{}).indexAxis||e.indexAxis||t.indexAxis||"x"}function UA(s,e){let t=s;return s==="_index_"?t=e:s==="_value_"&&(t=e==="x"?"y":"x"),t}function BA(s,e){return s===e?"_index_":"_value_"}function Xf(s){if(s==="x"||s==="y"||s==="r")return s}function zA(s){if(s==="top"||s==="bottom")return"x";if(s==="left"||s==="right")return"y"}function rh(s,...e){if(Xf(s))return s;for(const t of e){const r=t.axis||zA(t.position)||s.length>1&&Xf(s[0].toLowerCase());if(r)return r}throw new Error(`Cannot determine type of '${s}' axis. Please provide 'axis' or 'position' option.`)}function Jf(s,e,t){if(t[e+"AxisID"]===s)return{axis:e}}function HA(s,e){if(e.data&&e.data.datasets){const t=e.data.datasets.filter(r=>r.xAxisID===s||r.yAxisID===s);if(t.length)return Jf(s,"x",t[0])||Jf(s,"y",t[0])}return{}}function WA(s,e){const t=Wn[s.type]||{scales:{}},r=e.scales||{},a=sh(s.type,e),i=Object.create(null);return Object.keys(r).forEach(o=>{const l=r[o];if(!gt(l))return console.error(`Invalid scale configuration for scale: ${o}`);if(l._proxy)return console.warn(`Ignoring resolver passed as options for scale: ${o}`);const c=rh(o,l,HA(o,s),Pt.scales[l.type]),h=BA(c,a),u=t.scales||{};i[o]=ki(Object.create(null),[{axis:c},l,u[c],u[h]])}),s.data.datasets.forEach(o=>{const l=o.type||s.type,c=o.indexAxis||sh(l,e),u=(Wn[l]||{}).scales||{};Object.keys(u).forEach(m=>{const g=UA(m,c),p=o[g+"AxisID"]||g;i[p]=i[p]||Object.create(null),ki(i[p],[{axis:g},r[p],u[m]])})}),Object.keys(i).forEach(o=>{const l=i[o];ki(l,[Pt.scales[l.type],Pt.scale])}),i}function oy(s){const e=s.options||(s.options={});e.plugins=ot(e.plugins,{}),e.scales=WA(s,e)}function ly(s){return s=s||{},s.datasets=s.datasets||[],s.labels=s.labels||[],s}function qA(s){return s=s||{},s.data=ly(s.data),oy(s),s}const Zf=new Map,cy=new Set;function Go(s,e){let t=Zf.get(s);return t||(t=e(),Zf.set(s,t),cy.add(t)),t}const ii=(s,e,t)=>{const r=Fl(e,t);r!==void 0&&s.add(r)};class GA{constructor(e){this._config=qA(e),this._scopeCache=new Map,this._resolverCache=new Map}get platform(){return this._config.platform}get type(){return this._config.type}set type(e){this._config.type=e}get data(){return this._config.data}set data(e){this._config.data=ly(e)}get options(){return this._config.options}set options(e){this._config.options=e}get plugins(){return this._config.plugins}update(){const e=this._config;this.clearCache(),oy(e)}clearCache(){this._scopeCache.clear(),this._resolverCache.clear()}datasetScopeKeys(e){return Go(e,()=>[[`datasets.${e}`,""]])}datasetAnimationScopeKeys(e,t){return Go(`${e}.transition.${t}`,()=>[[`datasets.${e}.transitions.${t}`,`transitions.${t}`],[`datasets.${e}`,""]])}datasetElementScopeKeys(e,t){return Go(`${e}-${t}`,()=>[[`datasets.${e}.elements.${t}`,`datasets.${e}`,`elements.${t}`,""]])}pluginScopeKeys(e){const t=e.id,r=this.type;return Go(`${r}-plugin-${t}`,()=>[[`plugins.${t}`,...e.additionalOptionScopes||[]]])}_cachedScopes(e,t){const r=this._scopeCache;let a=r.get(e);return(!a||t)&&(a=new Map,r.set(e,a)),a}getOptionScopes(e,t,r){const{options:a,type:i}=this,o=this._cachedScopes(e,r),l=o.get(t);if(l)return l;const c=new Set;t.forEach(u=>{e&&(c.add(e),u.forEach(m=>ii(c,e,m))),u.forEach(m=>ii(c,a,m)),u.forEach(m=>ii(c,Wn[i]||{},m)),u.forEach(m=>ii(c,Pt,m)),u.forEach(m=>ii(c,Zd,m))});const h=Array.from(c);return h.length===0&&h.push(Object.create(null)),cy.has(t)&&o.set(t,h),h}chartOptionScopes(){const{options:e,type:t}=this;return[e,Wn[t]||{},Pt.datasets[t]||{},{type:t},Pt,Zd]}resolveNamedOptions(e,t,r,a=[""]){const i={$shared:!0},{resolver:o,subPrefixes:l}=ep(this._resolverCache,e,a);let c=o;if(YA(o,t)){i.$shared=!1,r=bn(r)?r():r;const h=this.createResolver(e,r,l);c=Da(o,r,h)}for(const h of t)i[h]=c[h];return i}createResolver(e,t,r=[""],a){const{resolver:i}=ep(this._resolverCache,e,r);return gt(t)?Da(i,t,void 0,a):i}}function ep(s,e,t){let r=s.get(e);r||(r=new Map,s.set(e,r));const a=t.join();let i=r.get(a);return i||(i={resolver:Iu(e,t),subPrefixes:t.filter(l=>!l.toLowerCase().includes("hover"))},r.set(a,i)),i}const KA=s=>gt(s)&&Object.getOwnPropertyNames(s).some(e=>bn(s[e]));function YA(s,e){const{isScriptable:t,isIndexable:r}=qb(s);for(const a of e){const i=t(a),o=r(a),l=(o||i)&&s[a];if(i&&(bn(l)||KA(l))||o&&Wt(l))return!0}return!1}var QA="4.5.1";const XA=["top","bottom","left","right","chartArea"];function tp(s,e){return s==="top"||s==="bottom"||XA.indexOf(s)===-1&&e==="x"}function sp(s,e){return function(t,r){return t[s]===r[s]?t[e]-r[e]:t[s]-r[s]}}function rp(s){const e=s.chart,t=e.options.animation;e.notifyPlugins("afterRender"),jt(t&&t.onComplete,[s],e)}function JA(s){const e=s.chart,t=e.options.animation;jt(t&&t.onProgress,[s],e)}function dy(s){return Du()&&typeof s=="string"?s=document.getElementById(s):s&&s.length&&(s=s[0]),s&&s.canvas&&(s=s.canvas),s}const ll={},np=s=>{const e=dy(s);return Object.values(ll).filter(t=>t.canvas===e).pop()};function ZA(s,e,t){const r=Object.keys(s);for(const a of r){const i=+a;if(i>=e){const o=s[a];delete s[a],(t>0||i>e)&&(s[i+t]=o)}}}function eC(s,e,t,r){return!t||s.type==="mouseout"?null:r?e:s}var Gr;let jc=(Gr=class{static register(...e){Xs.add(...e),ap()}static unregister(...e){Xs.remove(...e),ap()}constructor(e,t){const r=this.config=new GA(t),a=dy(e),i=np(a);if(i)throw new Error("Canvas is already in use. Chart with ID '"+i.id+"' must be destroyed before the canvas with ID '"+i.canvas.id+"' can be reused.");const o=r.createResolver(r.chartOptionScopes(),this.getContext());this.platform=new(r.platform||bA(a)),this.platform.updateConfig(r);const l=this.platform.acquireContext(a,o.aspectRatio),c=l&&l.canvas,h=c&&c.height,u=c&&c.width;if(this.id=rT(),this.ctx=l,this.canvas=c,this.width=u,this.height=h,this._options=o,this._aspectRatio=this.aspectRatio,this._layers=[],this._metasets=[],this._stacks=void 0,this.boxes=[],this.currentDevicePixelRatio=void 0,this.chartArea=void 0,this._active=[],this._lastEvent=void 0,this._listeners={},this._responsiveListeners=void 0,this._sortedMetasets=[],this.scales={},this._plugins=new PA,this.$proxies={},this._hiddenIndices={},this.attached=!1,this._animationsDisabled=void 0,this.$context=void 0,this._doResize=NT(m=>this.update(m),o.resizeDelay||0),this._dataChanges=[],ll[this.id]=this,!l||!c){console.error("Failed to create chart: can't acquire context from the given item");return}br.listen(this,"complete",rp),br.listen(this,"progress",JA),this._initialize(),this.attached&&this.update()}get aspectRatio(){const{options:{aspectRatio:e,maintainAspectRatio:t},width:r,height:a,_aspectRatio:i}=this;return kt(e)?t&&i?i:a?r/a:null:e}get data(){return this.config.data}set data(e){this.config.data=e}get options(){return this._options}set options(e){this.config.options=e}get registry(){return Xs}_initialize(){return this.notifyPlugins("beforeInit"),this.options.responsive?this.resize():Af(this,this.options.devicePixelRatio),this.bindEvents(),this.notifyPlugins("afterInit"),this}clear(){return Sf(this.canvas,this.ctx),this}stop(){return br.stop(this),this}resize(e,t){br.running(this)?this._resizeBeforeDraw={width:e,height:t}:this._resize(e,t)}_resize(e,t){const r=this.options,a=this.canvas,i=r.maintainAspectRatio&&this.aspectRatio,o=this.platform.getMaximumSize(a,e,t,i),l=r.devicePixelRatio||this.platform.getDevicePixelRatio(),c=this.width?"resize":"attach";this.width=o.width,this.height=o.height,this._aspectRatio=this.aspectRatio,Af(this,l,!0)&&(this.notifyPlugins("resize",{size:o}),jt(r.onResize,[this,o],this),this.attached&&this._doResize(c)&&this.render())}ensureScalesHaveIDs(){const t=this.options.scales||{};pt(t,(r,a)=>{r.id=a})}buildOrUpdateScales(){const e=this.options,t=e.scales,r=this.scales,a=Object.keys(r).reduce((o,l)=>(o[l]=!1,o),{});let i=[];t&&(i=i.concat(Object.keys(t).map(o=>{const l=t[o],c=rh(o,l),h=c==="r",u=c==="x";return{options:l,dposition:h?"chartArea":u?"bottom":"left",dtype:h?"radialLinear":u?"category":"linear"}}))),pt(i,o=>{const l=o.options,c=l.id,h=rh(c,l),u=ot(l.type,o.dtype);(l.position===void 0||tp(l.position,h)!==tp(o.dposition))&&(l.position=o.dposition),a[c]=!0;let m=null;if(c in r&&r[c].type===u)m=r[c];else{const g=Xs.getScale(u);m=new g({id:c,type:u,ctx:this.ctx,chart:this}),r[m.id]=m}m.init(l,e)}),pt(a,(o,l)=>{o||delete r[l]}),pt(r,o=>{Os.configure(this,o,o.options),Os.addBox(this,o)})}_updateMetasets(){const e=this._metasets,t=this.data.datasets.length,r=e.length;if(e.sort((a,i)=>a.index-i.index),r>t){for(let a=t;a<r;++a)this._destroyDatasetMeta(a);e.splice(t,r-t)}this._sortedMetasets=e.slice(0).sort(sp("order","index"))}_removeUnreferencedMetasets(){const{_metasets:e,data:{datasets:t}}=this;e.length>t.length&&delete this._stacks,e.forEach((r,a)=>{t.filter(i=>i===r._dataset).length===0&&this._destroyDatasetMeta(a)})}buildOrUpdateControllers(){const e=[],t=this.data.datasets;let r,a;for(this._removeUnreferencedMetasets(),r=0,a=t.length;r<a;r++){const i=t[r];let o=this.getDatasetMeta(r);const l=i.type||this.config.type;if(o.type&&o.type!==l&&(this._destroyDatasetMeta(r),o=this.getDatasetMeta(r)),o.type=l,o.indexAxis=i.indexAxis||sh(l,this.options),o.order=i.order||0,o.index=r,o.label=""+i.label,o.visible=this.isDatasetVisible(r),o.controller)o.controller.updateIndex(r),o.controller.linkScales();else{const c=Xs.getController(l),{datasetElementType:h,dataElementType:u}=Pt.datasets[l];Object.assign(c,{dataElementType:Xs.getElement(u),datasetElementType:h&&Xs.getElement(h)}),o.controller=new c(this,r),e.push(o.controller)}}return this._updateMetasets(),e}_resetElements(){pt(this.data.datasets,(e,t)=>{this.getDatasetMeta(t).controller.reset()},this)}reset(){this._resetElements(),this.notifyPlugins("reset")}update(e){const t=this.config;t.update();const r=this._options=t.createResolver(t.chartOptionScopes(),this.getContext()),a=this._animationsDisabled=!r.animation;if(this._updateScales(),this._checkEventBindings(),this._updateHiddenIndices(),this._plugins.invalidate(),this.notifyPlugins("beforeUpdate",{mode:e,cancelable:!0})===!1)return;const i=this.buildOrUpdateControllers();this.notifyPlugins("beforeElementsUpdate");let o=0;for(let h=0,u=this.data.datasets.length;h<u;h++){const{controller:m}=this.getDatasetMeta(h),g=!a&&i.indexOf(m)===-1;m.buildOrUpdateElements(g),o=Math.max(+m.getMaxOverflow(),o)}o=this._minPadding=r.layout.autoPadding?o:0,this._updateLayout(o),a||pt(i,h=>{h.reset()}),this._updateDatasets(e),this.notifyPlugins("afterUpdate",{mode:e}),this._layers.sort(sp("z","_idx"));const{_active:l,_lastEvent:c}=this;c?this._eventHandler(c,!0):l.length&&this._updateHoverStyles(l,l,!0),this.render()}_updateScales(){pt(this.scales,e=>{Os.removeBox(this,e)}),this.ensureScalesHaveIDs(),this.buildOrUpdateScales()}_checkEventBindings(){const e=this.options,t=new Set(Object.keys(this._listeners)),r=new Set(e.events);(!xf(t,r)||!!this._responsiveListeners!==e.responsive)&&(this.unbindEvents(),this.bindEvents())}_updateHiddenIndices(){const{_hiddenIndices:e}=this,t=this._getUniformDataChanges()||[];for(const{method:r,start:a,count:i}of t){const o=r==="_removeElements"?-i:i;ZA(e,a,o)}}_getUniformDataChanges(){const e=this._dataChanges;if(!e||!e.length)return;this._dataChanges=[];const t=this.data.datasets.length,r=i=>new Set(e.filter(o=>o[0]===i).map((o,l)=>l+","+o.splice(1).join(","))),a=r(0);for(let i=1;i<t;i++)if(!xf(a,r(i)))return;return Array.from(a).map(i=>i.split(",")).map(i=>({method:i[1],start:+i[2],count:+i[3]}))}_updateLayout(e){if(this.notifyPlugins("beforeLayout",{cancelable:!0})===!1)return;Os.update(this,this.width,this.height,e);const t=this.chartArea,r=t.width<=0||t.height<=0;this._layers=[],pt(this.boxes,a=>{r&&a.position==="chartArea"||(a.configure&&a.configure(),this._layers.push(...a._layers()))},this),this._layers.forEach((a,i)=>{a._idx=i}),this.notifyPlugins("afterLayout")}_updateDatasets(e){if(this.notifyPlugins("beforeDatasetsUpdate",{mode:e,cancelable:!0})!==!1){for(let t=0,r=this.data.datasets.length;t<r;++t)this.getDatasetMeta(t).controller.configure();for(let t=0,r=this.data.datasets.length;t<r;++t)this._updateDataset(t,bn(e)?e({datasetIndex:t}):e);this.notifyPlugins("afterDatasetsUpdate",{mode:e})}}_updateDataset(e,t){const r=this.getDatasetMeta(e),a={meta:r,index:e,mode:t,cancelable:!0};this.notifyPlugins("beforeDatasetUpdate",a)!==!1&&(r.controller._update(t),a.cancelable=!1,this.notifyPlugins("afterDatasetUpdate",a))}render(){this.notifyPlugins("beforeRender",{cancelable:!0})!==!1&&(br.has(this)?this.attached&&!br.running(this)&&br.start(this):(this.draw(),rp({chart:this})))}draw(){let e;if(this._resizeBeforeDraw){const{width:r,height:a}=this._resizeBeforeDraw;this._resizeBeforeDraw=null,this._resize(r,a)}if(this.clear(),this.width<=0||this.height<=0||this.notifyPlugins("beforeDraw",{cancelable:!0})===!1)return;const t=this._layers;for(e=0;e<t.length&&t[e].z<=0;++e)t[e].draw(this.chartArea);for(this._drawDatasets();e<t.length;++e)t[e].draw(this.chartArea);this.notifyPlugins("afterDraw")}_getSortedDatasetMetas(e){const t=this._sortedMetasets,r=[];let a,i;for(a=0,i=t.length;a<i;++a){const o=t[a];(!e||o.visible)&&r.push(o)}return r}getSortedVisibleDatasetMetas(){return this._getSortedDatasetMetas(!0)}_drawDatasets(){if(this.notifyPlugins("beforeDatasetsDraw",{cancelable:!0})===!1)return;const e=this.getSortedVisibleDatasetMetas();for(let t=e.length-1;t>=0;--t)this._drawDataset(e[t]);this.notifyPlugins("afterDatasetsDraw")}_drawDataset(e){const t=this.ctx,r={meta:e,index:e.index,cancelable:!0},a=CI(this,e);this.notifyPlugins("beforeDatasetDraw",r)!==!1&&(a&&Su(t,a),e.controller.draw(),a&&Tu(t),r.cancelable=!1,this.notifyPlugins("afterDatasetDraw",r))}isPointInArea(e){return Wi(e,this.chartArea,this._minPadding)}getElementsAtEventForMode(e,t,r,a){const i=XI.modes[t];return typeof i=="function"?i(this,e,r,a):[]}getDatasetMeta(e){const t=this.data.datasets[e],r=this._metasets;let a=r.filter(i=>i&&i._dataset===t).pop();return a||(a={type:null,data:[],dataset:null,controller:null,hidden:null,xAxisID:null,yAxisID:null,order:t&&t.order||0,index:e,_dataset:t,_parsed:[],_sorted:!1},r.push(a)),a}getContext(){return this.$context||(this.$context=Xn(null,{chart:this,type:"chart"}))}getVisibleDatasetCount(){return this.getSortedVisibleDatasetMetas().length}isDatasetVisible(e){const t=this.data.datasets[e];if(!t)return!1;const r=this.getDatasetMeta(e);return typeof r.hidden=="boolean"?!r.hidden:!t.hidden}setDatasetVisibility(e,t){const r=this.getDatasetMeta(e);r.hidden=!t}toggleDataVisibility(e){this._hiddenIndices[e]=!this._hiddenIndices[e]}getDataVisibility(e){return!this._hiddenIndices[e]}_updateVisibility(e,t,r){const a=r?"show":"hide",i=this.getDatasetMeta(e),o=i.controller._resolveAnimations(void 0,a);Ul(t)?(i.data[t].hidden=!r,this.update()):(this.setDatasetVisibility(e,r),o.update(i,{visible:r}),this.update(l=>l.datasetIndex===e?a:void 0))}hide(e,t){this._updateVisibility(e,t,!1)}show(e,t){this._updateVisibility(e,t,!0)}_destroyDatasetMeta(e){const t=this._metasets[e];t&&t.controller&&t.controller._destroy(),delete this._metasets[e]}_stop(){let e,t;for(this.stop(),br.remove(this),e=0,t=this.data.datasets.length;e<t;++e)this._destroyDatasetMeta(e)}destroy(){this.notifyPlugins("beforeDestroy");const{canvas:e,ctx:t}=this;this._stop(),this.config.clearCache(),e&&(this.unbindEvents(),Sf(e,t),this.platform.releaseContext(t),this.canvas=null,this.ctx=null),delete ll[this.id],this.notifyPlugins("afterDestroy")}toBase64Image(...e){return this.canvas.toDataURL(...e)}bindEvents(){this.bindUserEvents(),this.options.responsive?this.bindResponsiveEvents():this.attached=!0}bindUserEvents(){const e=this._listeners,t=this.platform,r=(i,o)=>{t.addEventListener(this,i,o),e[i]=o},a=(i,o,l)=>{i.offsetX=o,i.offsetY=l,this._eventHandler(i)};pt(this.options.events,i=>r(i,a))}bindResponsiveEvents(){this._responsiveListeners||(this._responsiveListeners={});const e=this._responsiveListeners,t=this.platform,r=(c,h)=>{t.addEventListener(this,c,h),e[c]=h},a=(c,h)=>{e[c]&&(t.removeEventListener(this,c,h),delete e[c])},i=(c,h)=>{this.canvas&&this.resize(c,h)};let o;const l=()=>{a("attach",l),this.attached=!0,this.resize(),r("resize",i),r("detach",o)};o=()=>{this.attached=!1,a("resize",i),this._stop(),this._resize(0,0),r("attach",l)},t.isAttached(this.canvas)?l():o()}unbindEvents(){pt(this._listeners,(e,t)=>{this.platform.removeEventListener(this,t,e)}),this._listeners={},pt(this._responsiveListeners,(e,t)=>{this.platform.removeEventListener(this,t,e)}),this._responsiveListeners=void 0}updateHoverStyle(e,t,r){const a=r?"set":"remove";let i,o,l,c;for(t==="dataset"&&(i=this.getDatasetMeta(e[0].datasetIndex),i.controller["_"+a+"DatasetHoverStyle"]()),l=0,c=e.length;l<c;++l){o=e[l];const h=o&&this.getDatasetMeta(o.datasetIndex).controller;h&&h[a+"HoverStyle"](o.element,o.datasetIndex,o.index)}}getActiveElements(){return this._active||[]}setActiveElements(e){const t=this._active||[],r=e.map(({datasetIndex:i,index:o})=>{const l=this.getDatasetMeta(i);if(!l)throw new Error("No dataset found at index "+i);return{datasetIndex:i,element:l.data[o],index:o}});!Ll(r,t)&&(this._active=r,this._lastEvent=null,this._updateHoverStyles(r,t))}notifyPlugins(e,t,r){return this._plugins.notify(this,e,t,r)}isPluginEnabled(e){return this._plugins._cache.filter(t=>t.plugin.id===e).length===1}_updateHoverStyles(e,t,r){const a=this.options.hover,i=(c,h)=>c.filter(u=>!h.some(m=>u.datasetIndex===m.datasetIndex&&u.index===m.index)),o=i(t,e),l=r?e:i(e,t);o.length&&this.updateHoverStyle(o,a.mode,!1),l.length&&a.mode&&this.updateHoverStyle(l,a.mode,!0)}_eventHandler(e,t){const r={event:e,replay:t,cancelable:!0,inChartArea:this.isPointInArea(e)},a=o=>(o.options.events||this.options.events).includes(e.native.type);if(this.notifyPlugins("beforeEvent",r,a)===!1)return;const i=this._handleEvent(e,t,r.inChartArea);return r.cancelable=!1,this.notifyPlugins("afterEvent",r,a),(i||r.changed)&&this.render(),this}_handleEvent(e,t,r){const{_active:a=[],options:i}=this,o=t,l=this._getActiveElements(e,a,r,o),c=cT(e),h=eC(e,this._lastEvent,r,c);r&&(this._lastEvent=null,jt(i.onHover,[e,l,this],this),c&&jt(i.onClick,[e,l,this],this));const u=!Ll(l,a);return(u||t)&&(this._active=l,this._updateHoverStyles(l,a,t)),this._lastEvent=h,u}_getActiveElements(e,t,r,a){if(e.type==="mouseout")return[];if(!r)return t;const i=this.options.hover;return this.getElementsAtEventForMode(e,i.mode,i,a)}},Je(Gr,"defaults",Pt),Je(Gr,"instances",ll),Je(Gr,"overrides",Wn),Je(Gr,"registry",Xs),Je(Gr,"version",QA),Je(Gr,"getChart",np),Gr);function ap(){return pt(jc.instances,s=>s._plugins.invalidate())}function hy(s,e,t=e){s.lineCap=ot(t.borderCapStyle,e.borderCapStyle),s.setLineDash(ot(t.borderDash,e.borderDash)),s.lineDashOffset=ot(t.borderDashOffset,e.borderDashOffset),s.lineJoin=ot(t.borderJoinStyle,e.borderJoinStyle),s.lineWidth=ot(t.borderWidth,e.borderWidth),s.strokeStyle=ot(t.borderColor,e.borderColor)}function tC(s,e,t){s.lineTo(t.x,t.y)}function sC(s){return s.stepped?LT:s.tension||s.cubicInterpolationMode==="monotone"?VT:tC}function uy(s,e,t={}){const r=s.length,{start:a=0,end:i=r-1}=t,{start:o,end:l}=e,c=Math.max(a,o),h=Math.min(i,l),u=a<o&&i<o||a>l&&i>l;return{count:r,start:c,loop:e.loop,ilen:h<c&&!u?r+h-c:h-c}}function rC(s,e,t,r){const{points:a,options:i}=e,{count:o,start:l,loop:c,ilen:h}=uy(a,t,r),u=sC(i);let{move:m=!0,reverse:g}=r||{},p,j,_;for(p=0;p<=h;++p)j=a[(l+(g?h-p:p))%o],!j.skip&&(m?(s.moveTo(j.x,j.y),m=!1):u(s,_,j,g,i.stepped),_=j);return c&&(j=a[(l+(g?h:0))%o],u(s,_,j,g,i.stepped)),!!c}function nC(s,e,t,r){const a=e.points,{count:i,start:o,ilen:l}=uy(a,t,r),{move:c=!0,reverse:h}=r||{};let u=0,m=0,g,p,j,_,y,M;const D=R=>(o+(h?l-R:R))%i,T=()=>{_!==y&&(s.lineTo(u,y),s.lineTo(u,_),s.lineTo(u,M))};for(c&&(p=a[D(0)],s.moveTo(p.x,p.y)),g=0;g<=l;++g){if(p=a[D(g)],p.skip)continue;const R=p.x,P=p.y,C=R|0;C===j?(P<_?_=P:P>y&&(y=P),u=(m*u+R)/++m):(T(),s.lineTo(R,P),j=C,m=0,_=y=P),M=P}T()}function nh(s){const e=s.options,t=e.borderDash&&e.borderDash.length;return!s._decimated&&!s._loop&&!e.tension&&e.cubicInterpolationMode!=="monotone"&&!e.stepped&&!t?nC:rC}function aC(s){return s.stepped?bI:s.tension||s.cubicInterpolationMode==="monotone"?yI:In}function iC(s,e,t,r){let a=e._path;a||(a=e._path=new Path2D,e.path(a,t,r)&&a.closePath()),hy(s,e.options),s.stroke(a)}function oC(s,e,t,r){const{segments:a,options:i}=e,o=nh(e);for(const l of a)hy(s,i,l.style),s.beginPath(),o(s,e,l,{start:t,end:t+r-1})&&s.closePath(),s.stroke()}const lC=typeof Path2D=="function";function cC(s,e,t,r){lC&&!e.options.segment?iC(s,e,t,r):oC(s,e,t,r)}class gi extends Vr{constructor(e){super(),this.animated=!0,this.options=void 0,this._chart=void 0,this._loop=void 0,this._fullLoop=void 0,this._path=void 0,this._points=void 0,this._segments=void 0,this._decimated=!1,this._pointsUpdated=!1,this._datasetIndex=void 0,e&&Object.assign(this,e)}updateControlPoints(e,t){const r=this.options;if((r.tension||r.cubicInterpolationMode==="monotone")&&!r.stepped&&!this._pointsUpdated){const a=r.spanGaps?this._loop:this._fullLoop;dI(this._points,r,e,a,t),this._pointsUpdated=!0}}set points(e){this._points=e,delete this._segments,delete this._path,this._pointsUpdated=!1}get points(){return this._points}get segments(){return this._segments||(this._segments=SI(this,this.options.segment))}first(){const e=this.segments,t=this.points;return e.length&&t[e[0].start]}last(){const e=this.segments,t=this.points,r=e.length;return r&&t[e[r-1].end]}interpolate(e,t){const r=this.options,a=e[t],i=this.points,o=NI(this,{property:t,start:a,end:a});if(!o.length)return;const l=[],c=aC(r);let h,u;for(h=0,u=o.length;h<u;++h){const{start:m,end:g}=o[h],p=i[m],j=i[g];if(p===j){l.push(p);continue}const _=Math.abs((a-p[t])/(j[t]-p[t])),y=c(p,j,_,r.stepped);y[t]=e[t],l.push(y)}return l.length===1?l[0]:l}pathSegment(e,t,r){return nh(this)(e,this,t,r)}path(e,t,r){const a=this.segments,i=nh(this);let o=this._loop;t=t||0,r=r||this.points.length-t;for(const l of a)o&=i(e,this,l,{start:t,end:t+r-1});return!!o}draw(e,t,r,a){const i=this.options||{};(this.points||[]).length&&i.borderWidth&&(e.save(),cC(e,this,r,a),e.restore()),this.animated&&(this._pointsUpdated=!1,this._path=void 0)}}Je(gi,"id","line"),Je(gi,"defaults",{borderCapStyle:"butt",borderDash:[],borderDashOffset:0,borderJoinStyle:"miter",borderWidth:3,capBezierPoints:!0,cubicInterpolationMode:"default",fill:!1,spanGaps:!1,stepped:!1,tension:0}),Je(gi,"defaultRoutes",{backgroundColor:"backgroundColor",borderColor:"borderColor"}),Je(gi,"descriptors",{_scriptable:!0,_indexable:e=>e!=="borderDash"&&e!=="fill"});function ip(s,e,t,r){const a=s.options,{[t]:i}=s.getProps([t],r);return Math.abs(e-i)<a.radius+a.hitRadius}class cl extends Vr{constructor(t){super();Je(this,"parsed");Je(this,"skip");Je(this,"stop");this.options=void 0,this.parsed=void 0,this.skip=void 0,this.stop=void 0,t&&Object.assign(this,t)}inRange(t,r,a){const i=this.options,{x:o,y:l}=this.getProps(["x","y"],a);return Math.pow(t-o,2)+Math.pow(r-l,2)<Math.pow(i.hitRadius+i.radius,2)}inXRange(t,r){return ip(this,t,"x",r)}inYRange(t,r){return ip(this,t,"y",r)}getCenterPoint(t){const{x:r,y:a}=this.getProps(["x","y"],t);return{x:r,y:a}}size(t){t=t||this.options||{};let r=t.radius||0;r=Math.max(r,r&&t.hoverRadius||0);const a=r&&t.borderWidth||0;return(r+a)*2}draw(t,r){const a=this.options;this.skip||a.radius<.1||!Wi(this,r,this.size(a)/2)||(t.strokeStyle=a.borderColor,t.lineWidth=a.borderWidth,t.fillStyle=a.backgroundColor,eh(t,a,this.x,this.y))}getRange(){const t=this.options||{};return t.radius+t.hitRadius}}Je(cl,"id","point"),Je(cl,"defaults",{borderWidth:1,hitRadius:1,hoverBorderWidth:1,hoverRadius:4,pointStyle:"circle",radius:3,rotation:0}),Je(cl,"defaultRoutes",{backgroundColor:"backgroundColor",borderColor:"borderColor"});const op=(s,e)=>{let{boxHeight:t=e,boxWidth:r=e}=s;return s.usePointStyle&&(t=Math.min(t,e),r=s.pointStyleWidth||Math.min(r,e)),{boxWidth:r,boxHeight:t,itemHeight:Math.max(e,t)}},dC=(s,e)=>s!==null&&e!==null&&s.datasetIndex===e.datasetIndex&&s.index===e.index;class lp extends Vr{constructor(e){super(),this._added=!1,this.legendHitBoxes=[],this._hoveredItem=null,this.doughnutMode=!1,this.chart=e.chart,this.options=e.options,this.ctx=e.ctx,this.legendItems=void 0,this.columnSizes=void 0,this.lineWidths=void 0,this.maxHeight=void 0,this.maxWidth=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.height=void 0,this.width=void 0,this._margins=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(e,t,r){this.maxWidth=e,this.maxHeight=t,this._margins=r,this.setDimensions(),this.buildLabels(),this.fit()}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=this._margins.left,this.right=this.width):(this.height=this.maxHeight,this.top=this._margins.top,this.bottom=this.height)}buildLabels(){const e=this.options.labels||{};let t=jt(e.generateLabels,[this.chart],this)||[];e.filter&&(t=t.filter(r=>e.filter(r,this.chart.data))),e.sort&&(t=t.sort((r,a)=>e.sort(r,a,this.chart.data))),this.options.reverse&&t.reverse(),this.legendItems=t}fit(){const{options:e,ctx:t}=this;if(!e.display){this.width=this.height=0;return}const r=e.labels,a=cs(r.font),i=a.size,o=this._computeTitleHeight(),{boxWidth:l,itemHeight:c}=op(r,i);let h,u;t.font=a.string,this.isHorizontal()?(h=this.maxWidth,u=this._fitRows(o,i,l,c)+10):(u=this.maxHeight,h=this._fitCols(o,a,l,c)+10),this.width=Math.min(h,e.maxWidth||this.maxWidth),this.height=Math.min(u,e.maxHeight||this.maxHeight)}_fitRows(e,t,r,a){const{ctx:i,maxWidth:o,options:{labels:{padding:l}}}=this,c=this.legendHitBoxes=[],h=this.lineWidths=[0],u=a+l;let m=e;i.textAlign="left",i.textBaseline="middle";let g=-1,p=-u;return this.legendItems.forEach((j,_)=>{const y=r+t/2+i.measureText(j.text).width;(_===0||h[h.length-1]+y+2*l>o)&&(m+=u,h[h.length-(_>0?0:1)]=0,p+=u,g++),c[_]={left:0,top:p,row:g,width:y,height:a},h[h.length-1]+=y+l}),m}_fitCols(e,t,r,a){const{ctx:i,maxHeight:o,options:{labels:{padding:l}}}=this,c=this.legendHitBoxes=[],h=this.columnSizes=[],u=o-e;let m=l,g=0,p=0,j=0,_=0;return this.legendItems.forEach((y,M)=>{const{itemWidth:D,itemHeight:T}=hC(r,t,i,y,a);M>0&&p+T+2*l>u&&(m+=g+l,h.push({width:g,height:p}),j+=g+l,_++,g=p=0),c[M]={left:j,top:p,col:_,width:D,height:T},g=Math.max(g,D),p+=T+l}),m+=g,h.push({width:g,height:p}),m}adjustHitBoxes(){if(!this.options.display)return;const e=this._computeTitleHeight(),{legendHitBoxes:t,options:{align:r,labels:{padding:a},rtl:i}}=this,o=xa(i,this.left,this.width);if(this.isHorizontal()){let l=0,c=as(r,this.left+a,this.right-this.lineWidths[l]);for(const h of t)l!==h.row&&(l=h.row,c=as(r,this.left+a,this.right-this.lineWidths[l])),h.top+=this.top+e+a,h.left=o.leftForLtr(o.x(c),h.width),c+=h.width+a}else{let l=0,c=as(r,this.top+e+a,this.bottom-this.columnSizes[l].height);for(const h of t)h.col!==l&&(l=h.col,c=as(r,this.top+e+a,this.bottom-this.columnSizes[l].height)),h.top=c,h.left+=this.left+a,h.left=o.leftForLtr(o.x(h.left),h.width),c+=h.height+a}}isHorizontal(){return this.options.position==="top"||this.options.position==="bottom"}draw(){if(this.options.display){const e=this.ctx;Su(e,this),this._draw(),Tu(e)}}_draw(){const{options:e,columnSizes:t,lineWidths:r,ctx:a}=this,{align:i,labels:o}=e,l=Pt.color,c=xa(e.rtl,this.left,this.width),h=cs(o.font),{padding:u}=o,m=h.size,g=m/2;let p;this.drawTitle(),a.textAlign=c.textAlign("left"),a.textBaseline="middle",a.lineWidth=.5,a.font=h.string;const{boxWidth:j,boxHeight:_,itemHeight:y}=op(o,m),M=function(C,N,b){if(isNaN(j)||j<=0||isNaN(_)||_<0)return;a.save();const v=ot(b.lineWidth,1);if(a.fillStyle=ot(b.fillStyle,l),a.lineCap=ot(b.lineCap,"butt"),a.lineDashOffset=ot(b.lineDashOffset,0),a.lineJoin=ot(b.lineJoin,"miter"),a.lineWidth=v,a.strokeStyle=ot(b.strokeStyle,l),a.setLineDash(ot(b.lineDash,[])),o.usePointStyle){const S={radius:_*Math.SQRT2/2,pointStyle:b.pointStyle,rotation:b.rotation,borderWidth:v},E=c.xPlus(C,j/2),k=N+g;Hb(a,S,E,k,o.pointStyleWidth&&j)}else{const S=N+Math.max((m-_)/2,0),E=c.leftForLtr(C,j),k=Ei(b.borderRadius);a.beginPath(),Object.values(k).some(w=>w!==0)?th(a,{x:E,y:S,w:j,h:_,radius:k}):a.rect(E,S,j,_),a.fill(),v!==0&&a.stroke()}a.restore()},D=function(C,N,b){qi(a,b.text,C,N+y/2,h,{strikethrough:b.hidden,textAlign:c.textAlign(b.textAlign)})},T=this.isHorizontal(),R=this._computeTitleHeight();T?p={x:as(i,this.left+u,this.right-r[0]),y:this.top+u+R,line:0}:p={x:this.left+u,y:as(i,this.top+R+u,this.bottom-t[0].height),line:0},Xb(this.ctx,e.textDirection);const P=y+u;this.legendItems.forEach((C,N)=>{a.strokeStyle=C.fontColor,a.fillStyle=C.fontColor;const b=a.measureText(C.text).width,v=c.textAlign(C.textAlign||(C.textAlign=o.textAlign)),S=j+g+b;let E=p.x,k=p.y;c.setWidth(this.width),T?N>0&&E+S+u>this.right&&(k=p.y+=P,p.line++,E=p.x=as(i,this.left+u,this.right-r[p.line])):N>0&&k+P>this.bottom&&(E=p.x=E+t[p.line].width+u,p.line++,k=p.y=as(i,this.top+R+u,this.bottom-t[p.line].height));const w=c.x(E);if(M(w,k,C),E=jT(v,E+j+g,T?E+S:this.right,e.rtl),D(c.x(E),k,C),T)p.x+=S+u;else if(typeof C.text!="string"){const Q=h.lineHeight;p.y+=my(C,Q)+u}else p.y+=P}),Jb(this.ctx,e.textDirection)}drawTitle(){const e=this.options,t=e.title,r=cs(t.font),a=Us(t.padding);if(!t.display)return;const i=xa(e.rtl,this.left,this.width),o=this.ctx,l=t.position,c=r.size/2,h=a.top+c;let u,m=this.left,g=this.width;if(this.isHorizontal())g=Math.max(...this.lineWidths),u=this.top+h,m=as(e.align,m,this.right-g);else{const j=this.columnSizes.reduce((_,y)=>Math.max(_,y.height),0);u=h+as(e.align,this.top,this.bottom-j-e.labels.padding-this._computeTitleHeight())}const p=as(l,m,m+g);o.textAlign=i.textAlign(ju(l)),o.textBaseline="middle",o.strokeStyle=t.color,o.fillStyle=t.color,o.font=r.string,qi(o,t.text,p,u,r)}_computeTitleHeight(){const e=this.options.title,t=cs(e.font),r=Us(e.padding);return e.display?t.lineHeight+r.height:0}_getLegendItemAt(e,t){let r,a,i;if(ui(e,this.left,this.right)&&ui(t,this.top,this.bottom)){for(i=this.legendHitBoxes,r=0;r<i.length;++r)if(a=i[r],ui(e,a.left,a.left+a.width)&&ui(t,a.top,a.top+a.height))return this.legendItems[r]}return null}handleEvent(e){const t=this.options;if(!gC(e.type,t))return;const r=this._getLegendItemAt(e.x,e.y);if(e.type==="mousemove"||e.type==="mouseout"){const a=this._hoveredItem,i=dC(a,r);a&&!i&&jt(t.onLeave,[e,a,this],this),this._hoveredItem=r,r&&!i&&jt(t.onHover,[e,r,this],this)}else r&&jt(t.onClick,[e,r,this],this)}}function hC(s,e,t,r,a){const i=uC(r,s,e,t),o=mC(a,r,e.lineHeight);return{itemWidth:i,itemHeight:o}}function uC(s,e,t,r){let a=s.text;return a&&typeof a!="string"&&(a=a.reduce((i,o)=>i.length>o.length?i:o)),e+t.size/2+r.measureText(a).width}function mC(s,e,t){let r=s;return typeof e.text!="string"&&(r=my(e,t)),r}function my(s,e){const t=s.text?s.text.length:0;return e*t}function gC(s,e){return!!((s==="mousemove"||s==="mouseout")&&(e.onHover||e.onLeave)||e.onClick&&(s==="click"||s==="mouseup"))}var fC={id:"legend",_element:lp,start(s,e,t){const r=s.legend=new lp({ctx:s.ctx,options:t,chart:s});Os.configure(s,r,t),Os.addBox(s,r)},stop(s){Os.removeBox(s,s.legend),delete s.legend},beforeUpdate(s,e,t){const r=s.legend;Os.configure(s,r,t),r.options=t},afterUpdate(s){const e=s.legend;e.buildLabels(),e.adjustHitBoxes()},afterEvent(s,e){e.replay||s.legend.handleEvent(e.event)},defaults:{display:!0,position:"top",align:"center",fullSize:!0,reverse:!1,weight:1e3,onClick(s,e,t){const r=e.datasetIndex,a=t.chart;a.isDatasetVisible(r)?(a.hide(r),e.hidden=!0):(a.show(r),e.hidden=!1)},onHover:null,onLeave:null,labels:{color:s=>s.chart.options.color,boxWidth:40,padding:10,generateLabels(s){const e=s.data.datasets,{labels:{usePointStyle:t,pointStyle:r,textAlign:a,color:i,useBorderRadius:o,borderRadius:l}}=s.legend.options;return s._getSortedDatasetMetas().map(c=>{const h=c.controller.getStyle(t?0:void 0),u=Us(h.borderWidth);return{text:e[c.index].label,fillStyle:h.backgroundColor,fontColor:i,hidden:!c.visible,lineCap:h.borderCapStyle,lineDash:h.borderDash,lineDashOffset:h.borderDashOffset,lineJoin:h.borderJoinStyle,lineWidth:(u.width+u.height)/4,strokeStyle:h.borderColor,pointStyle:r||h.pointStyle,rotation:h.rotation,textAlign:a||h.textAlign,borderRadius:o&&(l||h.borderRadius),datasetIndex:c.index}},this)}},title:{color:s=>s.chart.options.color,display:!1,position:"center",text:""}},descriptors:{_scriptable:s=>!s.startsWith("on"),labels:{_scriptable:s=>!["generateLabels","filter","sort"].includes(s)}}};class gy extends Vr{constructor(e){super(),this.chart=e.chart,this.options=e.options,this.ctx=e.ctx,this._padding=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(e,t){const r=this.options;if(this.left=0,this.top=0,!r.display){this.width=this.height=this.right=this.bottom=0;return}this.width=this.right=e,this.height=this.bottom=t;const a=Wt(r.text)?r.text.length:1;this._padding=Us(r.padding);const i=a*cs(r.font).lineHeight+this._padding.height;this.isHorizontal()?this.height=i:this.width=i}isHorizontal(){const e=this.options.position;return e==="top"||e==="bottom"}_drawArgs(e){const{top:t,left:r,bottom:a,right:i,options:o}=this,l=o.align;let c=0,h,u,m;return this.isHorizontal()?(u=as(l,r,i),m=t+e,h=i-r):(o.position==="left"?(u=r+e,m=as(l,a,t),c=Gt*-.5):(u=i-e,m=as(l,t,a),c=Gt*.5),h=a-t),{titleX:u,titleY:m,maxWidth:h,rotation:c}}draw(){const e=this.ctx,t=this.options;if(!t.display)return;const r=cs(t.font),i=r.lineHeight/2+this._padding.top,{titleX:o,titleY:l,maxWidth:c,rotation:h}=this._drawArgs(i);qi(e,t.text,0,0,r,{color:t.color,maxWidth:c,rotation:h,textAlign:ju(t.align),textBaseline:"middle",translation:[o,l]})}}function pC(s,e){const t=new gy({ctx:s.ctx,options:e,chart:s});Os.configure(s,t,e),Os.addBox(s,t),s.titleBlock=t}var xC={id:"title",_element:gy,start(s,e,t){pC(s,t)},stop(s){const e=s.titleBlock;Os.removeBox(s,e),delete s.titleBlock},beforeUpdate(s,e,t){const r=s.titleBlock;Os.configure(s,r,t),r.options=t},defaults:{align:"center",display:!1,font:{weight:"bold"},fullSize:!0,padding:10,position:"top",text:"",weight:2e3},defaultRoutes:{color:"color"},descriptors:{_scriptable:!0,_indexable:!1}};const fi={average(s){if(!s.length)return!1;let e,t,r=new Set,a=0,i=0;for(e=0,t=s.length;e<t;++e){const l=s[e].element;if(l&&l.hasValue()){const c=l.tooltipPosition();r.add(c.x),a+=c.y,++i}}return i===0||r.size===0?!1:{x:[...r].reduce((l,c)=>l+c)/r.size,y:a/i}},nearest(s,e){if(!s.length)return!1;let t=e.x,r=e.y,a=Number.POSITIVE_INFINITY,i,o,l;for(i=0,o=s.length;i<o;++i){const c=s[i].element;if(c&&c.hasValue()){const h=c.getCenterPoint(),u=Jd(e,h);u<a&&(a=u,l=c)}}if(l){const c=l.tooltipPosition();t=c.x,r=c.y}return{x:t,y:r}}};function Qs(s,e){return e&&(Wt(e)?Array.prototype.push.apply(s,e):s.push(e)),s}function yr(s){return(typeof s=="string"||s instanceof String)&&s.indexOf(`
`)>-1?s.split(`
`):s}function bC(s,e){const{element:t,datasetIndex:r,index:a}=e,i=s.getDatasetMeta(r).controller,{label:o,value:l}=i.getLabelAndValue(a);return{chart:s,label:o,parsed:i.getParsed(a),raw:s.data.datasets[r].data[a],formattedValue:l,dataset:i.getDataset(),dataIndex:a,datasetIndex:r,element:t}}function cp(s,e){const t=s.chart.ctx,{body:r,footer:a,title:i}=s,{boxWidth:o,boxHeight:l}=e,c=cs(e.bodyFont),h=cs(e.titleFont),u=cs(e.footerFont),m=i.length,g=a.length,p=r.length,j=Us(e.padding);let _=j.height,y=0,M=r.reduce((R,P)=>R+P.before.length+P.lines.length+P.after.length,0);if(M+=s.beforeBody.length+s.afterBody.length,m&&(_+=m*h.lineHeight+(m-1)*e.titleSpacing+e.titleMarginBottom),M){const R=e.displayColors?Math.max(l,c.lineHeight):c.lineHeight;_+=p*R+(M-p)*c.lineHeight+(M-1)*e.bodySpacing}g&&(_+=e.footerMarginTop+g*u.lineHeight+(g-1)*e.footerSpacing);let D=0;const T=function(R){y=Math.max(y,t.measureText(R).width+D)};return t.save(),t.font=h.string,pt(s.title,T),t.font=c.string,pt(s.beforeBody.concat(s.afterBody),T),D=e.displayColors?o+2+e.boxPadding:0,pt(r,R=>{pt(R.before,T),pt(R.lines,T),pt(R.after,T)}),D=0,t.font=u.string,pt(s.footer,T),t.restore(),y+=j.width,{width:y,height:_}}function yC(s,e){const{y:t,height:r}=e;return t<r/2?"top":t>s.height-r/2?"bottom":"center"}function vC(s,e,t,r){const{x:a,width:i}=r,o=t.caretSize+t.caretPadding;if(s==="left"&&a+i+o>e.width||s==="right"&&a-i-o<0)return!0}function wC(s,e,t,r){const{x:a,width:i}=t,{width:o,chartArea:{left:l,right:c}}=s;let h="center";return r==="center"?h=a<=(l+c)/2?"left":"right":a<=i/2?h="left":a>=o-i/2&&(h="right"),vC(h,s,e,t)&&(h="center"),h}function dp(s,e,t){const r=t.yAlign||e.yAlign||yC(s,t);return{xAlign:t.xAlign||e.xAlign||wC(s,e,t,r),yAlign:r}}function kC(s,e){let{x:t,width:r}=s;return e==="right"?t-=r:e==="center"&&(t-=r/2),t}function _C(s,e,t){let{y:r,height:a}=s;return e==="top"?r+=t:e==="bottom"?r-=a+t:r-=a/2,r}function hp(s,e,t,r){const{caretSize:a,caretPadding:i,cornerRadius:o}=s,{xAlign:l,yAlign:c}=t,h=a+i,{topLeft:u,topRight:m,bottomLeft:g,bottomRight:p}=Ei(o);let j=kC(e,l);const _=_C(e,c,h);return c==="center"?l==="left"?j+=h:l==="right"&&(j-=h):l==="left"?j-=Math.max(u,g)+a:l==="right"&&(j+=Math.max(m,p)+a),{x:Ps(j,0,r.width-e.width),y:Ps(_,0,r.height-e.height)}}function Ko(s,e,t){const r=Us(t.padding);return e==="center"?s.x+s.width/2:e==="right"?s.x+s.width-r.right:s.x+r.left}function up(s){return Qs([],yr(s))}function NC(s,e,t){return Xn(s,{tooltip:e,tooltipItems:t,type:"tooltip"})}function mp(s,e){const t=e&&e.dataset&&e.dataset.tooltip&&e.dataset.tooltip.callbacks;return t?s.override(t):s}const fy={beforeTitle:fr,title(s){if(s.length>0){const e=s[0],t=e.chart.data.labels,r=t?t.length:0;if(this&&this.options&&this.options.mode==="dataset")return e.dataset.label||"";if(e.label)return e.label;if(r>0&&e.dataIndex<r)return t[e.dataIndex]}return""},afterTitle:fr,beforeBody:fr,beforeLabel:fr,label(s){if(this&&this.options&&this.options.mode==="dataset")return s.label+": "+s.formattedValue||s.formattedValue;let e=s.dataset.label||"";e&&(e+=": ");const t=s.formattedValue;return kt(t)||(e+=t),e},labelColor(s){const t=s.chart.getDatasetMeta(s.datasetIndex).controller.getStyle(s.dataIndex);return{borderColor:t.borderColor,backgroundColor:t.backgroundColor,borderWidth:t.borderWidth,borderDash:t.borderDash,borderDashOffset:t.borderDashOffset,borderRadius:0}},labelTextColor(){return this.options.bodyColor},labelPointStyle(s){const t=s.chart.getDatasetMeta(s.datasetIndex).controller.getStyle(s.dataIndex);return{pointStyle:t.pointStyle,rotation:t.rotation}},afterLabel:fr,afterBody:fr,beforeFooter:fr,footer:fr,afterFooter:fr};function vs(s,e,t,r){const a=s[e].call(t,r);return typeof a>"u"?fy[e].call(t,r):a}class ah extends Vr{constructor(e){super(),this.opacity=0,this._active=[],this._eventPosition=void 0,this._size=void 0,this._cachedAnimations=void 0,this._tooltipItems=[],this.$animations=void 0,this.$context=void 0,this.chart=e.chart,this.options=e.options,this.dataPoints=void 0,this.title=void 0,this.beforeBody=void 0,this.body=void 0,this.afterBody=void 0,this.footer=void 0,this.xAlign=void 0,this.yAlign=void 0,this.x=void 0,this.y=void 0,this.height=void 0,this.width=void 0,this.caretX=void 0,this.caretY=void 0,this.labelColors=void 0,this.labelPointStyles=void 0,this.labelTextColors=void 0}initialize(e){this.options=e,this._cachedAnimations=void 0,this.$context=void 0}_resolveAnimations(){const e=this._cachedAnimations;if(e)return e;const t=this.chart,r=this.options.setContext(this.getContext()),a=r.enabled&&t.options.animation&&r.animations,i=new ey(this.chart,a);return a._cacheable&&(this._cachedAnimations=Object.freeze(i)),i}getContext(){return this.$context||(this.$context=NC(this.chart.getContext(),this,this._tooltipItems))}getTitle(e,t){const{callbacks:r}=t,a=vs(r,"beforeTitle",this,e),i=vs(r,"title",this,e),o=vs(r,"afterTitle",this,e);let l=[];return l=Qs(l,yr(a)),l=Qs(l,yr(i)),l=Qs(l,yr(o)),l}getBeforeBody(e,t){return up(vs(t.callbacks,"beforeBody",this,e))}getBody(e,t){const{callbacks:r}=t,a=[];return pt(e,i=>{const o={before:[],lines:[],after:[]},l=mp(r,i);Qs(o.before,yr(vs(l,"beforeLabel",this,i))),Qs(o.lines,vs(l,"label",this,i)),Qs(o.after,yr(vs(l,"afterLabel",this,i))),a.push(o)}),a}getAfterBody(e,t){return up(vs(t.callbacks,"afterBody",this,e))}getFooter(e,t){const{callbacks:r}=t,a=vs(r,"beforeFooter",this,e),i=vs(r,"footer",this,e),o=vs(r,"afterFooter",this,e);let l=[];return l=Qs(l,yr(a)),l=Qs(l,yr(i)),l=Qs(l,yr(o)),l}_createItems(e){const t=this._active,r=this.chart.data,a=[],i=[],o=[];let l=[],c,h;for(c=0,h=t.length;c<h;++c)l.push(bC(this.chart,t[c]));return e.filter&&(l=l.filter((u,m,g)=>e.filter(u,m,g,r))),e.itemSort&&(l=l.sort((u,m)=>e.itemSort(u,m,r))),pt(l,u=>{const m=mp(e.callbacks,u);a.push(vs(m,"labelColor",this,u)),i.push(vs(m,"labelPointStyle",this,u)),o.push(vs(m,"labelTextColor",this,u))}),this.labelColors=a,this.labelPointStyles=i,this.labelTextColors=o,this.dataPoints=l,l}update(e,t){const r=this.options.setContext(this.getContext()),a=this._active;let i,o=[];if(!a.length)this.opacity!==0&&(i={opacity:0});else{const l=fi[r.position].call(this,a,this._eventPosition);o=this._createItems(r),this.title=this.getTitle(o,r),this.beforeBody=this.getBeforeBody(o,r),this.body=this.getBody(o,r),this.afterBody=this.getAfterBody(o,r),this.footer=this.getFooter(o,r);const c=this._size=cp(this,r),h=Object.assign({},l,c),u=dp(this.chart,r,h),m=hp(r,h,u,this.chart);this.xAlign=u.xAlign,this.yAlign=u.yAlign,i={opacity:1,x:m.x,y:m.y,width:c.width,height:c.height,caretX:l.x,caretY:l.y}}this._tooltipItems=o,this.$context=void 0,i&&this._resolveAnimations().update(this,i),e&&r.external&&r.external.call(this,{chart:this.chart,tooltip:this,replay:t})}drawCaret(e,t,r,a){const i=this.getCaretPosition(e,r,a);t.lineTo(i.x1,i.y1),t.lineTo(i.x2,i.y2),t.lineTo(i.x3,i.y3)}getCaretPosition(e,t,r){const{xAlign:a,yAlign:i}=this,{caretSize:o,cornerRadius:l}=r,{topLeft:c,topRight:h,bottomLeft:u,bottomRight:m}=Ei(l),{x:g,y:p}=e,{width:j,height:_}=t;let y,M,D,T,R,P;return i==="center"?(R=p+_/2,a==="left"?(y=g,M=y-o,T=R+o,P=R-o):(y=g+j,M=y+o,T=R-o,P=R+o),D=y):(a==="left"?M=g+Math.max(c,u)+o:a==="right"?M=g+j-Math.max(h,m)-o:M=this.caretX,i==="top"?(T=p,R=T-o,y=M-o,D=M+o):(T=p+_,R=T+o,y=M+o,D=M-o),P=T),{x1:y,x2:M,x3:D,y1:T,y2:R,y3:P}}drawTitle(e,t,r){const a=this.title,i=a.length;let o,l,c;if(i){const h=xa(r.rtl,this.x,this.width);for(e.x=Ko(this,r.titleAlign,r),t.textAlign=h.textAlign(r.titleAlign),t.textBaseline="middle",o=cs(r.titleFont),l=r.titleSpacing,t.fillStyle=r.titleColor,t.font=o.string,c=0;c<i;++c)t.fillText(a[c],h.x(e.x),e.y+o.lineHeight/2),e.y+=o.lineHeight+l,c+1===i&&(e.y+=r.titleMarginBottom-l)}}_drawColorBox(e,t,r,a,i){const o=this.labelColors[r],l=this.labelPointStyles[r],{boxHeight:c,boxWidth:h}=i,u=cs(i.bodyFont),m=Ko(this,"left",i),g=a.x(m),p=c<u.lineHeight?(u.lineHeight-c)/2:0,j=t.y+p;if(i.usePointStyle){const _={radius:Math.min(h,c)/2,pointStyle:l.pointStyle,rotation:l.rotation,borderWidth:1},y=a.leftForLtr(g,h)+h/2,M=j+c/2;e.strokeStyle=i.multiKeyBackground,e.fillStyle=i.multiKeyBackground,eh(e,_,y,M),e.strokeStyle=o.borderColor,e.fillStyle=o.backgroundColor,eh(e,_,y,M)}else{e.lineWidth=gt(o.borderWidth)?Math.max(...Object.values(o.borderWidth)):o.borderWidth||1,e.strokeStyle=o.borderColor,e.setLineDash(o.borderDash||[]),e.lineDashOffset=o.borderDashOffset||0;const _=a.leftForLtr(g,h),y=a.leftForLtr(a.xPlus(g,1),h-2),M=Ei(o.borderRadius);Object.values(M).some(D=>D!==0)?(e.beginPath(),e.fillStyle=i.multiKeyBackground,th(e,{x:_,y:j,w:h,h:c,radius:M}),e.fill(),e.stroke(),e.fillStyle=o.backgroundColor,e.beginPath(),th(e,{x:y,y:j+1,w:h-2,h:c-2,radius:M}),e.fill()):(e.fillStyle=i.multiKeyBackground,e.fillRect(_,j,h,c),e.strokeRect(_,j,h,c),e.fillStyle=o.backgroundColor,e.fillRect(y,j+1,h-2,c-2))}e.fillStyle=this.labelTextColors[r]}drawBody(e,t,r){const{body:a}=this,{bodySpacing:i,bodyAlign:o,displayColors:l,boxHeight:c,boxWidth:h,boxPadding:u}=r,m=cs(r.bodyFont);let g=m.lineHeight,p=0;const j=xa(r.rtl,this.x,this.width),_=function(b){t.fillText(b,j.x(e.x+p),e.y+g/2),e.y+=g+i},y=j.textAlign(o);let M,D,T,R,P,C,N;for(t.textAlign=o,t.textBaseline="middle",t.font=m.string,e.x=Ko(this,y,r),t.fillStyle=r.bodyColor,pt(this.beforeBody,_),p=l&&y!=="right"?o==="center"?h/2+u:h+2+u:0,R=0,C=a.length;R<C;++R){for(M=a[R],D=this.labelTextColors[R],t.fillStyle=D,pt(M.before,_),T=M.lines,l&&T.length&&(this._drawColorBox(t,e,R,j,r),g=Math.max(m.lineHeight,c)),P=0,N=T.length;P<N;++P)_(T[P]),g=m.lineHeight;pt(M.after,_)}p=0,g=m.lineHeight,pt(this.afterBody,_),e.y-=i}drawFooter(e,t,r){const a=this.footer,i=a.length;let o,l;if(i){const c=xa(r.rtl,this.x,this.width);for(e.x=Ko(this,r.footerAlign,r),e.y+=r.footerMarginTop,t.textAlign=c.textAlign(r.footerAlign),t.textBaseline="middle",o=cs(r.footerFont),t.fillStyle=r.footerColor,t.font=o.string,l=0;l<i;++l)t.fillText(a[l],c.x(e.x),e.y+o.lineHeight/2),e.y+=o.lineHeight+r.footerSpacing}}drawBackground(e,t,r,a){const{xAlign:i,yAlign:o}=this,{x:l,y:c}=e,{width:h,height:u}=r,{topLeft:m,topRight:g,bottomLeft:p,bottomRight:j}=Ei(a.cornerRadius);t.fillStyle=a.backgroundColor,t.strokeStyle=a.borderColor,t.lineWidth=a.borderWidth,t.beginPath(),t.moveTo(l+m,c),o==="top"&&this.drawCaret(e,t,r,a),t.lineTo(l+h-g,c),t.quadraticCurveTo(l+h,c,l+h,c+g),o==="center"&&i==="right"&&this.drawCaret(e,t,r,a),t.lineTo(l+h,c+u-j),t.quadraticCurveTo(l+h,c+u,l+h-j,c+u),o==="bottom"&&this.drawCaret(e,t,r,a),t.lineTo(l+p,c+u),t.quadraticCurveTo(l,c+u,l,c+u-p),o==="center"&&i==="left"&&this.drawCaret(e,t,r,a),t.lineTo(l,c+m),t.quadraticCurveTo(l,c,l+m,c),t.closePath(),t.fill(),a.borderWidth>0&&t.stroke()}_updateAnimationTarget(e){const t=this.chart,r=this.$animations,a=r&&r.x,i=r&&r.y;if(a||i){const o=fi[e.position].call(this,this._active,this._eventPosition);if(!o)return;const l=this._size=cp(this,e),c=Object.assign({},o,this._size),h=dp(t,e,c),u=hp(e,c,h,t);(a._to!==u.x||i._to!==u.y)&&(this.xAlign=h.xAlign,this.yAlign=h.yAlign,this.width=l.width,this.height=l.height,this.caretX=o.x,this.caretY=o.y,this._resolveAnimations().update(this,u))}}_willRender(){return!!this.opacity}draw(e){const t=this.options.setContext(this.getContext());let r=this.opacity;if(!r)return;this._updateAnimationTarget(t);const a={width:this.width,height:this.height},i={x:this.x,y:this.y};r=Math.abs(r)<.001?0:r;const o=Us(t.padding),l=this.title.length||this.beforeBody.length||this.body.length||this.afterBody.length||this.footer.length;t.enabled&&l&&(e.save(),e.globalAlpha=r,this.drawBackground(i,e,a,t),Xb(e,t.textDirection),i.y+=o.top,this.drawTitle(i,e,t),this.drawBody(i,e,t),this.drawFooter(i,e,t),Jb(e,t.textDirection),e.restore())}getActiveElements(){return this._active||[]}setActiveElements(e,t){const r=this._active,a=e.map(({datasetIndex:l,index:c})=>{const h=this.chart.getDatasetMeta(l);if(!h)throw new Error("Cannot find a dataset at index "+l);return{datasetIndex:l,element:h.data[c],index:c}}),i=!Ll(r,a),o=this._positionChanged(a,t);(i||o)&&(this._active=a,this._eventPosition=t,this._ignoreReplayEvents=!0,this.update(!0))}handleEvent(e,t,r=!0){if(t&&this._ignoreReplayEvents)return!1;this._ignoreReplayEvents=!1;const a=this.options,i=this._active||[],o=this._getActiveElements(e,i,t,r),l=this._positionChanged(o,e),c=t||!Ll(o,i)||l;return c&&(this._active=o,(a.enabled||a.external)&&(this._eventPosition={x:e.x,y:e.y},this.update(!0,t))),c}_getActiveElements(e,t,r,a){const i=this.options;if(e.type==="mouseout")return[];if(!a)return t.filter(l=>this.chart.data.datasets[l.datasetIndex]&&this.chart.getDatasetMeta(l.datasetIndex).controller.getParsed(l.index)!==void 0);const o=this.chart.getElementsAtEventForMode(e,i.mode,i,r);return i.reverse&&o.reverse(),o}_positionChanged(e,t){const{caretX:r,caretY:a,options:i}=this,o=fi[i.position].call(this,e,t);return o!==!1&&(r!==o.x||a!==o.y)}}Je(ah,"positioners",fi);var jC={id:"tooltip",_element:ah,positioners:fi,afterInit(s,e,t){t&&(s.tooltip=new ah({chart:s,options:t}))},beforeUpdate(s,e,t){s.tooltip&&s.tooltip.initialize(t)},reset(s,e,t){s.tooltip&&s.tooltip.initialize(t)},afterDraw(s){const e=s.tooltip;if(e&&e._willRender()){const t={tooltip:e};if(s.notifyPlugins("beforeTooltipDraw",{...t,cancelable:!0})===!1)return;e.draw(s.ctx),s.notifyPlugins("afterTooltipDraw",t)}},afterEvent(s,e){if(s.tooltip){const t=e.replay;s.tooltip.handleEvent(e.event,t,e.inChartArea)&&(e.changed=!0)}},defaults:{enabled:!0,external:null,position:"average",backgroundColor:"rgba(0,0,0,0.8)",titleColor:"#fff",titleFont:{weight:"bold"},titleSpacing:2,titleMarginBottom:6,titleAlign:"left",bodyColor:"#fff",bodySpacing:2,bodyFont:{},bodyAlign:"left",footerColor:"#fff",footerSpacing:2,footerMarginTop:6,footerFont:{weight:"bold"},footerAlign:"left",padding:6,caretPadding:2,caretSize:5,cornerRadius:6,boxHeight:(s,e)=>e.bodyFont.size,boxWidth:(s,e)=>e.bodyFont.size,multiKeyBackground:"#fff",displayColors:!0,boxPadding:0,borderColor:"rgba(0,0,0,0)",borderWidth:0,animation:{duration:400,easing:"easeOutQuart"},animations:{numbers:{type:"number",properties:["x","y","width","height","caretX","caretY"]},opacity:{easing:"linear",duration:200}},callbacks:fy},defaultRoutes:{bodyFont:"font",footerFont:"font",titleFont:"font"},descriptors:{_scriptable:s=>s!=="filter"&&s!=="itemSort"&&s!=="external",_indexable:!1,callbacks:{_scriptable:!1,_indexable:!1},animation:{_fallback:!1},animations:{_fallback:"animation"}},additionalOptionScopes:["interaction"]};const EC=(s,e,t,r)=>(typeof e=="string"?(t=s.push(e)-1,r.unshift({index:t,label:e})):isNaN(e)&&(t=null),t);function SC(s,e,t,r){const a=s.indexOf(e);if(a===-1)return EC(s,e,t,r);const i=s.lastIndexOf(e);return a!==i?t:a}const TC=(s,e)=>s===null?null:Ps(Math.round(s),0,e);function gp(s){const e=this.getLabels();return s>=0&&s<e.length?e[s]:s}class ih extends Ua{constructor(e){super(e),this._startValue=void 0,this._valueRange=0,this._addedLabels=[]}init(e){const t=this._addedLabels;if(t.length){const r=this.getLabels();for(const{index:a,label:i}of t)r[a]===i&&r.splice(a,1);this._addedLabels=[]}super.init(e)}parse(e,t){if(kt(e))return null;const r=this.getLabels();return t=isFinite(t)&&r[t]===e?t:SC(r,e,ot(t,e),this._addedLabels),TC(t,r.length-1)}determineDataLimits(){const{minDefined:e,maxDefined:t}=this.getUserBounds();let{min:r,max:a}=this.getMinMax(!0);this.options.bounds==="ticks"&&(e||(r=0),t||(a=this.getLabels().length-1)),this.min=r,this.max=a}buildTicks(){const e=this.min,t=this.max,r=this.options.offset,a=[];let i=this.getLabels();i=e===0&&t===i.length-1?i:i.slice(e,t+1),this._valueRange=Math.max(i.length-(r?0:1),1),this._startValue=this.min-(r?.5:0);for(let o=e;o<=t;o++)a.push({value:o});return a}getLabelForValue(e){return gp.call(this,e)}configure(){super.configure(),this.isHorizontal()||(this._reversePixels=!this._reversePixels)}getPixelForValue(e){return typeof e!="number"&&(e=this.parse(e)),e===null?NaN:this.getPixelForDecimal((e-this._startValue)/this._valueRange)}getPixelForTick(e){const t=this.ticks;return e<0||e>t.length-1?null:this.getPixelForValue(t[e].value)}getValueForPixel(e){return Math.round(this._startValue+this.getDecimalForPixel(e)*this._valueRange)}getBasePixel(){return this.bottom}}Je(ih,"id","category"),Je(ih,"defaults",{ticks:{callback:gp}});function IC(s,e){const t=[],{bounds:a,step:i,min:o,max:l,precision:c,count:h,maxTicks:u,maxDigits:m,includeBounds:g}=s,p=i||1,j=u-1,{min:_,max:y}=e,M=!kt(o),D=!kt(l),T=!kt(h),R=(y-_)/(m+1);let P=yf((y-_)/j/p)*p,C,N,b,v;if(P<1e-14&&!M&&!D)return[{value:_},{value:y}];v=Math.ceil(y/P)-Math.floor(_/P),v>j&&(P=yf(v*P/j/p)*p),kt(c)||(C=Math.pow(10,c),P=Math.ceil(P*C)/C),a==="ticks"?(N=Math.floor(_/P)*P,b=Math.ceil(y/P)*P):(N=_,b=y),M&&D&&i&&gT((l-o)/i,P/1e3)?(v=Math.round(Math.min((l-o)/P,u)),P=(l-o)/v,N=o,b=l):T?(N=M?o:N,b=D?l:b,v=h-1,P=(b-N)/v):(v=(b-N)/P,_i(v,Math.round(v),P/1e3)?v=Math.round(v):v=Math.ceil(v));const S=Math.max(vf(P),vf(N));C=Math.pow(10,kt(c)?S:c),N=Math.round(N*C)/C,b=Math.round(b*C)/C;let E=0;for(M&&(g&&N!==o?(t.push({value:o}),N<o&&E++,_i(Math.round((N+E*P)*C)/C,o,fp(o,R,s))&&E++):N<o&&E++);E<v;++E){const k=Math.round((N+E*P)*C)/C;if(D&&k>l)break;t.push({value:k})}return D&&g&&b!==l?t.length&&_i(t[t.length-1].value,l,fp(l,R,s))?t[t.length-1].value=l:t.push({value:l}):(!D||b===l)&&t.push({value:b}),t}function fp(s,e,{horizontal:t,minRotation:r}){const a=Cn(r),i=(t?Math.sin(a):Math.cos(a))||.001,o=.75*e*(""+s).length;return Math.min(e/i,o)}class AC extends Ua{constructor(e){super(e),this.start=void 0,this.end=void 0,this._startValue=void 0,this._endValue=void 0,this._valueRange=0}parse(e,t){return kt(e)||(typeof e=="number"||e instanceof Number)&&!isFinite(+e)?null:+e}handleTickRangeOptions(){const{beginAtZero:e}=this.options,{minDefined:t,maxDefined:r}=this.getUserBounds();let{min:a,max:i}=this;const o=c=>a=t?a:c,l=c=>i=r?i:c;if(e){const c=Ca(a),h=Ca(i);c<0&&h<0?l(0):c>0&&h>0&&o(0)}if(a===i){let c=i===0?1:Math.abs(i*.05);l(i+c),e||o(a-c)}this.min=a,this.max=i}getTickLimit(){const e=this.options.ticks;let{maxTicksLimit:t,stepSize:r}=e,a;return r?(a=Math.ceil(this.max/r)-Math.floor(this.min/r)+1,a>1e3&&(console.warn(`scales.${this.id}.ticks.stepSize: ${r} would result generating up to ${a} ticks. Limiting to 1000.`),a=1e3)):(a=this.computeTickLimit(),t=t||11),t&&(a=Math.min(t,a)),a}computeTickLimit(){return Number.POSITIVE_INFINITY}buildTicks(){const e=this.options,t=e.ticks;let r=this.getTickLimit();r=Math.max(2,r);const a={maxTicks:r,bounds:e.bounds,min:e.min,max:e.max,precision:t.precision,step:t.stepSize,count:t.count,maxDigits:this._maxDigits(),horizontal:this.isHorizontal(),minRotation:t.minRotation||0,includeBounds:t.includeBounds!==!1},i=this._range||this,o=IC(a,i);return e.bounds==="ticks"&&fT(o,this,"value"),e.reverse?(o.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),o}configure(){const e=this.ticks;let t=this.min,r=this.max;if(super.configure(),this.options.offset&&e.length){const a=(r-t)/Math.max(e.length-1,1)/2;t-=a,r+=a}this._startValue=t,this._endValue=r,this._valueRange=r-t}getLabelForValue(e){return Bb(e,this.chart.options.locale,this.options.ticks.format)}}class oh extends AC{determineDataLimits(){const{min:e,max:t}=this.getMinMax(!0);this.min=Fs(e)?e:0,this.max=Fs(t)?t:1,this.handleTickRangeOptions()}computeTickLimit(){const e=this.isHorizontal(),t=e?this.width:this.height,r=Cn(this.options.ticks.minRotation),a=(e?Math.sin(r):Math.cos(r))||.001,i=this._resolveTickFontOptions(0);return Math.ceil(t/Math.min(40,i.lineHeight/a))}getPixelForValue(e){return e===null?NaN:this.getPixelForDecimal((e-this._startValue)/this._valueRange)}getValueForPixel(e){return this._startValue+this.getDecimalForPixel(e)*this._valueRange}}Je(oh,"id","linear"),Je(oh,"defaults",{ticks:{callback:zb.formatters.numeric}});const Ec={millisecond:{common:!0,size:1,steps:1e3},second:{common:!0,size:1e3,steps:60},minute:{common:!0,size:6e4,steps:60},hour:{common:!0,size:36e5,steps:24},day:{common:!0,size:864e5,steps:30},week:{common:!1,size:6048e5,steps:4},month:{common:!0,size:2628e6,steps:12},quarter:{common:!1,size:7884e6,steps:4},year:{common:!0,size:3154e7}},Ns=Object.keys(Ec);function pp(s,e){return s-e}function xp(s,e){if(kt(e))return null;const t=s._adapter,{parser:r,round:a,isoWeekday:i}=s._parseOpts;let o=e;return typeof r=="function"&&(o=r(o)),Fs(o)||(o=typeof r=="string"?t.parse(o,r):t.parse(o)),o===null?null:(a&&(o=a==="week"&&(Hi(i)||i===!0)?t.startOf(o,"isoWeek",i):t.startOf(o,a)),+o)}function bp(s,e,t,r){const a=Ns.length;for(let i=Ns.indexOf(s);i<a-1;++i){const o=Ec[Ns[i]],l=o.steps?o.steps:Number.MAX_SAFE_INTEGER;if(o.common&&Math.ceil((t-e)/(l*o.size))<=r)return Ns[i]}return Ns[a-1]}function CC(s,e,t,r,a){for(let i=Ns.length-1;i>=Ns.indexOf(t);i--){const o=Ns[i];if(Ec[o].common&&s._adapter.diff(a,r,o)>=e-1)return o}return Ns[t?Ns.indexOf(t):0]}function DC(s){for(let e=Ns.indexOf(s)+1,t=Ns.length;e<t;++e)if(Ec[Ns[e]].common)return Ns[e]}function yp(s,e,t){if(!t)s[e]=!0;else if(t.length){const{lo:r,hi:a}=Nu(t,e),i=t[r]>=e?t[r]:t[a];s[i]=!0}}function MC(s,e,t,r){const a=s._adapter,i=+a.startOf(e[0].value,r),o=e[e.length-1].value;let l,c;for(l=i;l<=o;l=+a.add(l,1,r))c=t[l],c>=0&&(e[c].major=!0);return e}function vp(s,e,t){const r=[],a={},i=e.length;let o,l;for(o=0;o<i;++o)l=e[o],a[l]=o,r.push({value:l,major:!1});return i===0||!t?r:MC(s,r,a,t)}class Wl extends Ua{constructor(e){super(e),this._cache={data:[],labels:[],all:[]},this._unit="day",this._majorUnit=void 0,this._offsets={},this._normalized=!1,this._parseOpts=void 0}init(e,t={}){const r=e.time||(e.time={}),a=this._adapter=new qI._date(e.adapters.date);a.init(t),ki(r.displayFormats,a.formats()),this._parseOpts={parser:r.parser,round:r.round,isoWeekday:r.isoWeekday},super.init(e),this._normalized=t.normalized}parse(e,t){return e===void 0?null:xp(this,e)}beforeLayout(){super.beforeLayout(),this._cache={data:[],labels:[],all:[]}}determineDataLimits(){const e=this.options,t=this._adapter,r=e.time.unit||"day";let{min:a,max:i,minDefined:o,maxDefined:l}=this.getUserBounds();function c(h){!o&&!isNaN(h.min)&&(a=Math.min(a,h.min)),!l&&!isNaN(h.max)&&(i=Math.max(i,h.max))}(!o||!l)&&(c(this._getLabelBounds()),(e.bounds!=="ticks"||e.ticks.source!=="labels")&&c(this.getMinMax(!1))),a=Fs(a)&&!isNaN(a)?a:+t.startOf(Date.now(),r),i=Fs(i)&&!isNaN(i)?i:+t.endOf(Date.now(),r)+1,this.min=Math.min(a,i-1),this.max=Math.max(a+1,i)}_getLabelBounds(){const e=this.getLabelTimestamps();let t=Number.POSITIVE_INFINITY,r=Number.NEGATIVE_INFINITY;return e.length&&(t=e[0],r=e[e.length-1]),{min:t,max:r}}buildTicks(){const e=this.options,t=e.time,r=e.ticks,a=r.source==="labels"?this.getLabelTimestamps():this._generate();e.bounds==="ticks"&&a.length&&(this.min=this._userMin||a[0],this.max=this._userMax||a[a.length-1]);const i=this.min,o=this.max,l=wT(a,i,o);return this._unit=t.unit||(r.autoSkip?bp(t.minUnit,this.min,this.max,this._getLabelCapacity(i)):CC(this,l.length,t.minUnit,this.min,this.max)),this._majorUnit=!r.major.enabled||this._unit==="year"?void 0:DC(this._unit),this.initOffsets(a),e.reverse&&l.reverse(),vp(this,l,this._majorUnit)}afterAutoSkip(){this.options.offsetAfterAutoskip&&this.initOffsets(this.ticks.map(e=>+e.value))}initOffsets(e=[]){let t=0,r=0,a,i;this.options.offset&&e.length&&(a=this.getDecimalForValue(e[0]),e.length===1?t=1-a:t=(this.getDecimalForValue(e[1])-a)/2,i=this.getDecimalForValue(e[e.length-1]),e.length===1?r=i:r=(i-this.getDecimalForValue(e[e.length-2]))/2);const o=e.length<3?.5:.25;t=Ps(t,0,o),r=Ps(r,0,o),this._offsets={start:t,end:r,factor:1/(t+1+r)}}_generate(){const e=this._adapter,t=this.min,r=this.max,a=this.options,i=a.time,o=i.unit||bp(i.minUnit,t,r,this._getLabelCapacity(t)),l=ot(a.ticks.stepSize,1),c=o==="week"?i.isoWeekday:!1,h=Hi(c)||c===!0,u={};let m=t,g,p;if(h&&(m=+e.startOf(m,"isoWeek",c)),m=+e.startOf(m,h?"day":o),e.diff(r,t,o)>1e5*l)throw new Error(t+" and "+r+" are too far apart with stepSize of "+l+" "+o);const j=a.ticks.source==="data"&&this.getDataTimestamps();for(g=m,p=0;g<r;g=+e.add(g,l,o),p++)yp(u,g,j);return(g===r||a.bounds==="ticks"||p===1)&&yp(u,g,j),Object.keys(u).sort(pp).map(_=>+_)}getLabelForValue(e){const t=this._adapter,r=this.options.time;return r.tooltipFormat?t.format(e,r.tooltipFormat):t.format(e,r.displayFormats.datetime)}format(e,t){const a=this.options.time.displayFormats,i=this._unit,o=t||a[i];return this._adapter.format(e,o)}_tickFormatFunction(e,t,r,a){const i=this.options,o=i.ticks.callback;if(o)return jt(o,[e,t,r],this);const l=i.time.displayFormats,c=this._unit,h=this._majorUnit,u=c&&l[c],m=h&&l[h],g=r[t],p=h&&m&&g&&g.major;return this._adapter.format(e,a||(p?m:u))}generateTickLabels(e){let t,r,a;for(t=0,r=e.length;t<r;++t)a=e[t],a.label=this._tickFormatFunction(a.value,t,e)}getDecimalForValue(e){return e===null?NaN:(e-this.min)/(this.max-this.min)}getPixelForValue(e){const t=this._offsets,r=this.getDecimalForValue(e);return this.getPixelForDecimal((t.start+r)*t.factor)}getValueForPixel(e){const t=this._offsets,r=this.getDecimalForPixel(e)/t.factor-t.end;return this.min+r*(this.max-this.min)}_getLabelSize(e){const t=this.options.ticks,r=this.ctx.measureText(e).width,a=Cn(this.isHorizontal()?t.maxRotation:t.minRotation),i=Math.cos(a),o=Math.sin(a),l=this._resolveTickFontOptions(0).size;return{w:r*i+l*o,h:r*o+l*i}}_getLabelCapacity(e){const t=this.options.time,r=t.displayFormats,a=r[t.unit]||r.millisecond,i=this._tickFormatFunction(e,0,vp(this,[e],this._majorUnit),a),o=this._getLabelSize(i),l=Math.floor(this.isHorizontal()?this.width/o.w:this.height/o.h)-1;return l>0?l:1}getDataTimestamps(){let e=this._cache.data||[],t,r;if(e.length)return e;const a=this.getMatchingVisibleMetas();if(this._normalized&&a.length)return this._cache.data=a[0].controller.getAllParsedValues(this);for(t=0,r=a.length;t<r;++t)e=e.concat(a[t].controller.getAllParsedValues(this));return this._cache.data=this.normalize(e)}getLabelTimestamps(){const e=this._cache.labels||[];let t,r;if(e.length)return e;const a=this.getLabels();for(t=0,r=a.length;t<r;++t)e.push(xp(this,a[t]));return this._cache.labels=this._normalized?e:this.normalize(e)}normalize(e){return _T(e.sort(pp))}}Je(Wl,"id","time"),Je(Wl,"defaults",{bounds:"data",adapters:{},time:{parser:!1,unit:!1,round:!1,isoWeekday:!1,minUnit:"millisecond",displayFormats:{}},ticks:{source:"auto",callback:!1,major:{enabled:!1}}});function Yo(s,e,t){let r=0,a=s.length-1,i,o,l,c;t?(e>=s[r].pos&&e<=s[a].pos&&({lo:r,hi:a}=Dn(s,"pos",e)),{pos:i,time:l}=s[r],{pos:o,time:c}=s[a]):(e>=s[r].time&&e<=s[a].time&&({lo:r,hi:a}=Dn(s,"time",e)),{time:i,pos:l}=s[r],{time:o,pos:c}=s[a]);const h=o-i;return h?l+(c-l)*(e-i)/h:l}class wp extends Wl{constructor(e){super(e),this._table=[],this._minPos=void 0,this._tableRange=void 0}initOffsets(){const e=this._getTimestampsForTable(),t=this._table=this.buildLookupTable(e);this._minPos=Yo(t,this.min),this._tableRange=Yo(t,this.max)-this._minPos,super.initOffsets(e)}buildLookupTable(e){const{min:t,max:r}=this,a=[],i=[];let o,l,c,h,u;for(o=0,l=e.length;o<l;++o)h=e[o],h>=t&&h<=r&&a.push(h);if(a.length<2)return[{time:t,pos:0},{time:r,pos:1}];for(o=0,l=a.length;o<l;++o)u=a[o+1],c=a[o-1],h=a[o],Math.round((u+c)/2)!==h&&i.push({time:h,pos:o/(l-1)});return i}_generate(){const e=this.min,t=this.max;let r=super.getDataTimestamps();return(!r.includes(e)||!r.length)&&r.splice(0,0,e),(!r.includes(t)||r.length===1)&&r.push(t),r.sort((a,i)=>a-i)}_getTimestampsForTable(){let e=this._cache.all||[];if(e.length)return e;const t=this.getDataTimestamps(),r=this.getLabelTimestamps();return t.length&&r.length?e=this.normalize(t.concat(r)):e=t.length?t:r,e=this._cache.all=e,e}getDecimalForValue(e){return(Yo(this._table,e)-this._minPos)/this._tableRange}getValueForPixel(e){const t=this._offsets,r=this.getDecimalForPixel(e)/t.factor-t.end;return Yo(this._table,r*this._tableRange+this._minPos,!0)}}Je(wp,"id","timeseries"),Je(wp,"defaults",Wl.defaults);const py="label";function kp(s,e){typeof s=="function"?s(e):s&&(s.current=e)}function $C(s,e){const t=s.options;t&&e&&Object.assign(t,e)}function xy(s,e){s.labels=e}function by(s,e,t=py){const r=[];s.datasets=e.map(a=>{const i=s.datasets.find(o=>o[t]===a[t]);return!i||!a.data||r.includes(i)?{...a}:(r.push(i),Object.assign(i,a),i)})}function RC(s,e=py){const t={labels:[],datasets:[]};return xy(t,s.labels),by(t,s.datasets,e),t}function PC(s,e){const{height:t=150,width:r=300,redraw:a=!1,datasetIdKey:i,type:o,data:l,options:c,plugins:h=[],fallbackContent:u,updateMode:m,...g}=s,p=I.useRef(null),j=I.useRef(null),_=()=>{p.current&&(j.current=new jc(p.current,{type:o,data:RC(l,i),options:c&&{...c},plugins:h}),kp(e,j.current))},y=()=>{kp(e,null),j.current&&(j.current.destroy(),j.current=null)};return I.useEffect(()=>{!a&&j.current&&c&&$C(j.current,c)},[a,c]),I.useEffect(()=>{!a&&j.current&&xy(j.current.config.data,l.labels)},[a,l.labels]),I.useEffect(()=>{!a&&j.current&&l.datasets&&by(j.current.config.data,l.datasets,i)},[a,l.datasets]),I.useEffect(()=>{j.current&&(a?(y(),setTimeout(_)):j.current.update(m))},[a,c,l.labels,l.datasets,m]),I.useEffect(()=>{j.current&&(y(),setTimeout(_))},[o]),I.useEffect(()=>(_(),()=>y()),[]),n.jsx("canvas",{ref:p,role:"img",height:t,width:r,...g,children:u})}const OC=I.forwardRef(PC);function LC(s,e){return jc.register(e),I.forwardRef((t,r)=>n.jsx(OC,{...t,ref:r,type:s}))}const VC=LC("line",il);jc.register(ih,oh,cl,gi,xC,jC,fC);const FC=({history:s,theme:e})=>{const t=I.useMemo(()=>{const a=s.map(o=>oe(o.date,"dd MMM")),i=s.map(o=>o.averageRating);return{labels:a,datasets:[{label:"Средний рейтинг команды",data:i,borderColor:e==="dark"?"#86EFAC":"#10B981",backgroundColor:e==="dark"?"rgba(134, 239, 172, 0.2)":"rgba(16, 185, 129, 0.2)",fill:!0,tension:.3}]}},[s,e]),r={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{mode:"index",intersect:!1,backgroundColor:e==="dark"?"rgba(255, 255, 255, 0.1)":"rgba(0, 0, 0, 0.7)",titleColor:"#fff",bodyColor:"#fff",borderColor:e==="dark"?"#48a35e":"#10B981",borderWidth:1,cornerRadius:6,padding:10}},scales:{x:{type:"category",display:!0,grid:{},ticks:{color:e==="dark"?"#cbd5e1":"#4b5563",autoSkip:!0,maxRotation:0,minRotation:0}},y:{type:"linear",display:!0,min:0,max:100,grid:{color:e==="dark"?"rgba(255, 255, 255, 0.1)":"rgba(0, 0, 0, 0.1)"},ticks:{color:e==="dark"?"#cbd5e1":"#4b5563",callback:function(a){return`${a}%`}}}}};return n.jsx("div",{className:"h-full w-full",children:n.jsx(VC,{data:t,options:r})})},UC=()=>{var Se;const{theme:s}=lt(),{user:e}=_t(),{isAdmin:t}=Ct(),[r,a]=I.useState([]),[i,o]=I.useState(!0),[l,c]=I.useState([]),[h,u]=I.useState(!1),[m,g]=I.useState(null),[p,j]=I.useState([]),[_,y]=I.useState([]),[M,D]=I.useState([]),[T,R]=I.useState(Hn().start),[P,C]=I.useState(null),[N,b]=I.useState("week");I.useEffect(()=>{v(),S()},[T,N,P]);const v=async()=>{o(!0);try{let G;N==="week"?G=Hn():N==="month"?G=ca(30):G=ca(90);const xe=oe(G.start,"yyyy-MM-dd"),z=oe(G.end,"yyyy-MM-dd"),ce=G.start.toISOString(),ke=G.end.toISOString(),ue=ca(90),$e=oe(ue.start,"yyyy-MM-dd"),Oe=oe(ue.end,"yyyy-MM-dd"),U=await Eb(void 0,ce,ke);c(U);const _e=[];for(const q of Re){const Le=(await Ui(q.id,xe,z)).reduce((ne,me)=>{const Qe=me.participants&&me.participants.length>0?me.participants.length:1;return ne+me.amount/Qe},0),Ue=await Ui(q.id,xe,z),ye=Ue.reduce((ne,me)=>{const Qe=me.participants&&me.participants.length>0?me.participants.length:1;return ne+me.amount/Qe},0),mt=Ue.reduce((ne,me)=>{const Qe=me.participants&&me.participants.length>0?me.participants.length:1;return ne+me.poolAmount/Qe},0),qe=await Ar(q.id),et=qe.filter(ne=>{const me=ne.date,Qe=ne.endDate||ne.date;return me<=z&&Qe>=xe}),Te=et.filter(ne=>ne.type==="dayoff").reduce((ne,me)=>ne+gs(me.date,me.endDate,xe,z),0),Ve=et.filter(ne=>ne.type==="sick").reduce((ne,me)=>ne+gs(me.date,me.endDate,xe,z),0),wt=et.filter(ne=>ne.type==="vacation").reduce((ne,me)=>ne+gs(me.date,me.endDate,xe,z),0),ct=et.filter(ne=>ne.type==="absence").reduce((ne,me)=>ne+gs(me.date,me.endDate,xe,z),0),Cs=qe.filter(ne=>{const me=ne.date,Qe=ne.endDate||ne.date;return me<=z&&Qe>=xe}),Yt=Cs.filter(ne=>ne.type==="dayoff").reduce((ne,me)=>ne+gs(me.date,me.endDate,xe,z),0),ie=Cs.filter(ne=>ne.type==="sick").reduce((ne,me)=>ne+gs(me.date,me.endDate,xe,z),0),Ae=qe.filter(ne=>{const me=ne.date,Qe=ne.endDate||ne.date;return me<=Oe&&Qe>=$e}).filter(ne=>ne.type==="vacation").reduce((ne,me)=>ne+gs(me.date,me.endDate,$e,Oe),0),st=(await Is(q.id)).filter(ne=>ne.date>=xe&&ne.date<=z).reduce((ne,me)=>ne+xc(me.slots),0),Be=(await Nb(q.id))[0]||{userId:q.id,earnings:0,messages:0,initiatives:0,signals:0,profitableSignals:0,referrals:0,daysOff:0,sickDays:0,vacationDays:0,absenceDays:0,poolAmount:0,rating:0,lastUpdated:new Date().toISOString()},Ge=U.filter(ne=>ne.ownerId===q.id).length,at={userId:q.id,earnings:ye,messages:Be.messages||0,initiatives:Be.initiatives||0,signals:Be.signals||0,profitableSignals:Be.profitableSignals||0,referrals:Ge,daysOff:Te,sickDays:Ve,vacationDays:wt,absenceDays:ct,poolAmount:mt,lastUpdated:new Date().toISOString()},yt=Cb(at,st,Le,Yt,ie,Ae),St=Db(at,st,Le,Yt,ie,Ae);_e.push({...at,rating:yt,breakdown:St})}_e.sort((q,Ce)=>Ce.rating-q.rating),a(_e);const Pe=await J5();j(Pe);const K=await rS();y(K)}catch(G){console.error("Error loading ratings:",G)}finally{o(!1)}},S=async()=>{try{const G=await H5();D(G)}catch(G){console.error("Error loading team rating history:",G)}},E=()=>{const G=new Date(T);N==="week"?G.setDate(G.getDate()-7):N==="month"?G.setMonth(G.getMonth()-1):G.setMonth(G.getMonth()-3),R(G)},k=()=>{const G=new Date(T);N==="week"?G.setDate(G.getDate()+7):N==="month"?G.setMonth(G.getMonth()+1):G.setMonth(G.getMonth()+3),R(G)},w=r.reduce((G,xe)=>G+xe.rating,0)/(r.length||1),Q=s==="dark"?"text-gray-400":"text-gray-600",ae=s==="dark"?"text-white":"text-gray-900",V="bg-[#10141c]",X="border-[#48a35e]/60",he="shadow-[0_24px_80px_rgba(0,0,0,0.45)]",B=s==="dark"?"text-white/70":"text-slate-600",te=s==="dark"?"text-white":"text-slate-900",ve=[{label:"80-100%",title:"Эталон",desc:"Стабильный вклад, примеры для команды",tone:"text-emerald-700 dark:text-emerald-100",bg:"bg-emerald-50 dark:bg-emerald-900/40 border-emerald-200/60 dark:border-emerald-700/60"},{label:"60-79%",title:"Уверенно",desc:"Держат темп, есть потенциал роста",tone:"text-blue-700 dark:text-blue-100",bg:"bg-blue-50 dark:bg-blue-900/40 border-blue-200/60 dark:border-blue-700/60"},{label:"40-59%",title:"В пути",desc:"Нужна точечная поддержка и фокус",tone:"text-amber-700 dark:text-amber-100",bg:"bg-amber-50 dark:bg-amber-900/40 border-amber-200/60 dark:border-amber-700/60"},{label:"0-39%",title:"Зона роста",desc:"Запускаем план восстановления",tone:"text-rose-700 dark:text-rose-100",bg:"bg-rose-50 dark:bg-rose-900/40 border-rose-200/60 dark:border-rose-700/60"}],W=G=>{if(!G.breakdown)return["Недостаточно данных — обновите статистику."];const xe=[];return G.breakdown.weeklyHoursPoints<25&&xe.push("Дотяни рабочие часы до 20+ в неделю (25%)."),G.breakdown.weeklyEarningsPoints<30&&xe.push("Увеличь недельный доход до 6000+ ₽ (30%)."),G.breakdown.referralsPoints<30&&xe.push("Добавь рефералов: до +30% (6 человек)."),G.breakdown.daysOffPoints<=0&&xe.push("Выходные: <2 дней в неделю для +5%."),G.breakdown.sickDaysPoints<=0&&xe.push("Больничные: <3 дней в неделю И ≤9 дней в месяц для +5%."),G.breakdown.vacationDaysPoints<=0&&xe.push("Отпуск: <12 дней в месяц И ≤30 дней за 90 дней для +10%."),xe.length?xe:["Отлично! Держи текущий темп."]},F=I.useMemo(()=>{let G=[...r];return P&&(G=G.filter(xe=>xe.userId===P)),G.sort((xe,z)=>z.rating-xe.rating)},[r,P]),re=I.useMemo(()=>{var ke,ue;if(!r.length)return{top:0,median:0,count:0,high:0};const G=[...r].sort(($e,Oe)=>Oe.rating-$e.rating),xe=((ke=G[0])==null?void 0:ke.rating)||0,z=((ue=G[Math.floor((G.length-1)/2)])==null?void 0:ue.rating)||xe,ce=G.filter($e=>$e.rating>=80).length;return{top:xe,median:z,count:G.length,high:ce}},[r]),de=F[0],$=de?Tt(de.userId):"—",O=new Date().toLocaleDateString("ru-RU"),J=[{label:"Средний рейтинг",value:`${w.toFixed(1)}%`,meta:"по команде за период",tone:"emerald",icon:Ut},{label:"Лидер периода",value:$,meta:de?`${de.rating.toFixed(1)}%`:"—",tone:"amber",icon:pw},{label:"80%+ участников",value:`${re.high}`,meta:"стабильно высоко",tone:"blue",icon:xs},{label:"Всего участников",value:`${r.length}`,meta:"в рейтинге",tone:"slate",icon:qn}],Y=[{label:"Медиана",value:`${re.median.toFixed(1)}%`,meta:"ровный темп",tone:"purple",icon:Nm},{label:"Рефералы за 30д",value:`${l.length}`,meta:"активность команды",tone:"pink",icon:xw},{label:"Обновление",value:O,meta:"автообновление данных",tone:"indigo",icon:$s}],Z=G=>G==="emerald"?s==="dark"?"bg-emerald-500/15 border-emerald-400/30 text-emerald-50":"bg-emerald-50 border-emerald-200 text-emerald-900":G==="amber"?s==="dark"?"bg-amber-500/15 border-amber-400/30 text-amber-50":"bg-amber-50 border-amber-200 text-amber-900":G==="blue"?s==="dark"?"bg-sky-500/15 border-sky-400/30 text-sky-50":"bg-sky-50 border-sky-200 text-sky-900":G==="purple"?s==="dark"?"bg-indigo-500/15 border-indigo-400/30 text-indigo-50":"bg-indigo-50 border-indigo-200 text-indigo-900":G==="pink"?s==="dark"?"bg-rose-500/15 border-rose-400/30 text-rose-50":"bg-rose-50 border-rose-200 text-rose-900":G==="indigo"?s==="dark"?"bg-indigo-500/15 border-indigo-400/30 text-indigo-50":"bg-indigo-50 border-indigo-200 text-indigo-900":s==="dark"?"bg-white/5 border-white/15 text-white":"bg-gray-50 border-gray-200 text-gray-900",L=G=>Tt(G)||"—";I.useEffect(()=>{(async()=>{Wg();for(const xe of Re)await Ir(xe.id)})()},[]),I.useEffect(()=>{const G=async xe=>{const z=xe,{userId:ce}=z.detail||{};if(ce)await Ir(ce),a(ke=>[...ke]);else{Wg();for(const ke of Re)await Ir(ke.id);a(ke=>[...ke])}};return window.addEventListener("nicknameUpdated",G),()=>{window.removeEventListener("nicknameUpdated",G)}},[]);const fe=()=>{g(null),u(!0)},ge=G=>{g(G),u(!0)},H=async G=>{(t||G.ownerId===(e==null?void 0:e.id))&&(t?await xu(G.id):await It({entity:"referral",action:"delete",authorId:(e==null?void 0:e.id)||G.ownerId,targetUserId:G.ownerId,before:G,after:null}),await v())},se=()=>{const G=new Date(T);let xe=new Date(T);return N==="week"?(xe.setDate(G.getDate()+6),`${oe(G,"dd MMM")} — ${oe(xe,"dd MMM")}`):N==="month"?(xe=ca(30).end,`${oe(G,"dd MMM")} — ${oe(xe,"dd MMM")}`):(xe.setMonth(G.getMonth()+3),xe.setDate(G.getDate()-1),`${oe(G,"dd MMM")} — ${oe(xe,"dd MMM")}`)},je={cardBg:s==="dark"?"bg-[#10141c]":"bg-white",cardBorder:s==="dark"?"border-[#48a35e]/60":"border-gray-200",buttonSecondary:s==="dark"?"bg-white/5 border-white/10 text-white hover:bg-white/10":"bg-gray-50 border-gray-200 text-gray-700 hover:bg-gray-100"};return n.jsxs("div",{className:"space-y-6",children:[n.jsxs("div",{className:`relative overflow-hidden rounded-3xl border ${X} shadow-[0_24px_80px_rgba(0,0,0,0.45)] ${V}`,children:[n.jsxs("div",{className:"absolute inset-0 pointer-events-none",children:[n.jsx("div",{className:"absolute -left-16 -bottom-10 w-80 h-80 bg-emerald-500/18 blur-3xl"}),n.jsx("div",{className:"absolute inset-0 bg-[radial-gradient(circle_at_50%_0%,rgba(255,255,255,0.08),transparent_45%)]"})]}),n.jsxs("div",{className:"relative p-6 sm:p-8 space-y-6",children:[n.jsxs("div",{className:"flex flex-col gap-4 lg:flex-row lg:items-start lg:justify-between",children:[n.jsx("div",{className:"space-y-3 max-w-3xl",children:n.jsxs("div",{className:"flex items-start gap-3",children:[n.jsx("div",{className:"p-3 rounded-2xl bg-white/10 border border-white/20 text-white shadow-inner",children:n.jsx(Ut,{className:"w-6 h-6 text-emerald-300"})}),n.jsxs("div",{className:"space-y-2",children:[n.jsx("h1",{className:"text-3xl sm:text-4xl font-black text-white leading-tight",children:"Рейтинг команды"}),n.jsxs("p",{className:"text-sm text-white/70",children:["Данные за ",N==="week"?"текущую неделю":N==="month"?"последние 30 дней":"последние 90 дней",". В фокусе KPI команды, динамика и реферальная активность."]}),n.jsx("div",{className:"flex flex-wrap gap-2",children:["Обзор","Динамика","Рефералы","Активность"].map((G,xe)=>n.jsx("span",{className:`px-4 py-1.5 rounded-full text-xs font-semibold border ${xe===0?"bg-emerald-500 text-white border-emerald-300/60 shadow-md":"bg-white/10 text-white border-white/20"}`,children:G},G))})]})]})}),n.jsxs("div",{className:"flex flex-col items-start lg:items-end gap-3 text-white",children:[n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx("button",{onClick:E,className:"p-2 rounded-full bg-white/10 border border-white/20 hover:bg-white/20 transition-colors",children:n.jsx(Vv,{className:"w-5 h-5 text-white/70"})}),n.jsx("span",{className:"text-sm font-semibold text-white",children:se()}),n.jsx("button",{onClick:k,className:"p-2 rounded-full bg-white/10 border border-white/20 hover:bg-white/20 transition-colors",children:n.jsx(Qo,{className:"w-5 h-5 text-white/70"})})]}),n.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[n.jsxs("div",{className:"relative",children:[n.jsx(mh,{className:`w-4 h-4 absolute left-3 top-1/2 -translate-y-1/2 ${Q}`}),n.jsxs("select",{value:P||"",onChange:G=>C(G.target.value||null),className:`pl-9 pr-4 py-2 rounded-xl text-sm font-semibold border ${je.cardBorder} ${je.cardBg} ${s==="dark"?"text-white":"text-gray-700"} appearance-none focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-transparent transition-all duration-200`,children:[n.jsx("option",{value:"",children:"Все участники"}),Re.map(G=>n.jsx("option",{value:G.id,children:G.name},G.id))]}),n.jsx(Qo,{className:`w-4 h-4 rotate-90 absolute right-3 top-1/2 -translate-y-1/2 ${Q} pointer-events-none`})]}),n.jsxs("div",{className:"relative",children:[n.jsx(Nm,{className:`w-4 h-4 absolute left-3 top-1/2 -translate-y-1/2 ${Q}`}),n.jsxs("select",{value:N,onChange:G=>b(G.target.value),className:`pl-9 pr-4 py-2 rounded-xl text-sm font-semibold border ${je.cardBorder} ${je.cardBg} ${s==="dark"?"text-white":"text-gray-700"} appearance-none focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-transparent transition-all duration-200`,children:[n.jsx("option",{value:"week",children:"По неделям"}),n.jsx("option",{value:"month",children:"По месяцам"})]}),n.jsx(Qo,{className:`w-4 h-4 rotate-90 absolute right-3 top-1/2 -translate-y-1/2 ${Q} pointer-events-none`})]})]})]})]}),n.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-4 gap-3",children:J.map(G=>{const xe=G.icon;return n.jsxs("div",{className:`relative overflow-hidden rounded-2xl border ${Z(G.tone)} p-4 backdrop-blur-sm`,children:[n.jsx("div",{className:"absolute right-3 top-3 opacity-20",children:n.jsx(xe,{className:"w-6 h-6"})}),n.jsx("div",{className:`text-xs uppercase tracking-[0.1em] font-semibold ${B}`,children:G.label}),n.jsx("div",{className:`mt-2 text-2xl font-bold ${te}`,children:G.value}),n.jsx("div",{className:`text-sm ${B}`,children:G.meta})]},G.label)})}),n.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-4 gap-3",children:Y.map(G=>{const xe=G.icon;return n.jsxs("div",{className:`relative overflow-hidden rounded-2xl border ${Z(G.tone)} p-4 backdrop-blur-sm`,children:[n.jsx("div",{className:"absolute right-3 top-3 opacity-20",children:n.jsx(xe,{className:"w-6 h-6"})}),n.jsx("div",{className:`text-xs uppercase tracking-[0.1em] font-semibold ${B}`,children:G.label}),n.jsx("div",{className:`mt-2 text-2xl font-bold ${te}`,children:G.value}),n.jsx("div",{className:`text-sm ${B}`,children:G.meta})]},G.label)})})]})]}),n.jsxs("div",{className:`rounded-3xl p-6 ${V} ${X} border shadow-lg`,children:[n.jsxs("div",{className:"flex items-center justify-between mb-4",children:[n.jsx("h2",{className:`text-xl font-bold ${ae}`,children:"Динамика среднего рейтинга команды"}),n.jsx("div",{children:n.jsx(zs,{to:"/faq#rating",children:n.jsx("button",{className:`px-3 py-1.5 rounded-lg text-xs font-semibold ${je.buttonSecondary}`,children:"Как считается рейтинг?"})})})]}),n.jsx("div",{className:"h-64 sm:h-80 md:h-96 w-full",children:M.length>0?n.jsx(FC,{history:M,theme:s}):n.jsx("div",{className:`flex items-center justify-center h-full text-center ${Q}`,children:"Нет данных для отображения графика рейтинга."})})]}),n.jsxs("div",{id:"rating-ref",className:`rounded-2xl p-6 sm:p-7 ${V} ${he} border ${X}`,children:[n.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between mb-4",children:[n.jsxs("div",{className:"space-y-1",children:[n.jsx("p",{className:`text-xs uppercase tracking-[0.12em] ${Q}`,children:"Рефералы · 30 дней"}),n.jsx("h3",{className:`text-2xl font-bold ${ae}`,children:"Привлеченные участники"}),n.jsxs("p",{className:`text-sm ${Q}`,children:["Всего добавлено: ",n.jsx("span",{className:"font-semibold",children:l.length})]})]}),n.jsxs("button",{onClick:fe,className:"px-4 py-3 rounded-xl transition-all duration-200 flex items-center justify-center gap-2 font-semibold shadow-md w-full sm:w-auto border border-indigo-200/70 bg-indigo-50 text-indigo-900 hover:bg-indigo-100 dark:bg-indigo-500/15 dark:border-indigo-400/30 dark:text-indigo-50",children:[n.jsx("span",{className:"text-xl",children:"➕"}),n.jsx("span",{children:"Добавить реферала"})]})]}),l.length?n.jsx("div",{className:"overflow-auto rounded-xl border border-white/10 bg-white/5",children:n.jsxs("table",{className:"min-w-[820px] w-full text-sm text-white/90",children:[n.jsx("thead",{className:"bg-white/5 text-white/70 text-left",children:n.jsxs("tr",{children:[n.jsx("th",{className:"py-3 px-4 font-semibold",children:"Кто привел"}),n.jsx("th",{className:"py-3 px-4 font-semibold",children:"Код"}),n.jsx("th",{className:"py-3 px-4 font-semibold",children:"Имя"}),n.jsx("th",{className:"py-3 px-4 font-semibold",children:"Комментарий"}),n.jsx("th",{className:"py-3 px-4 font-semibold text-right",children:"Действия"})]})}),n.jsx("tbody",{children:l.map(G=>{const xe=L(G.ownerId),z=t||G.ownerId===(e==null?void 0:e.id);return n.jsxs("tr",{className:"border-t border-white/10 hover:bg-white/5 transition-colors",children:[n.jsx("td",{className:"py-3 px-4 font-semibold text-white whitespace-nowrap",children:xe}),n.jsx("td",{className:"py-3 px-4 text-white/80 whitespace-nowrap",children:G.referralId}),n.jsx("td",{className:"py-3 px-4 text-white/80",children:G.name}),n.jsx("td",{className:"py-3 px-4 text-white/70",children:G.comment||"—"}),n.jsxs("td",{className:"py-3 px-4 text-right whitespace-nowrap flex items-center justify-end gap-2",children:[n.jsx("button",{onClick:()=>z&&ge(G),className:`px-3 py-1.5 rounded-lg text-xs font-semibold border border-white/20 bg-white/10 text-white transition ${z?"hover:bg-white/20":"opacity-40 cursor-not-allowed"}`,disabled:!z,children:"Редактировать"}),n.jsx("button",{onClick:()=>z&&H(G),className:`px-3 py-1.5 rounded-lg text-xs font-semibold border border-rose-300/60 bg-rose-500/20 text-rose-50 transition ${z?"hover:bg-rose-500/30":"opacity-40 cursor-not-allowed"}`,disabled:!z,children:"Удалить"})]})]},G.id)})})]})}):n.jsx("div",{className:"rounded-xl border border-white/10 bg-white/5 p-4 text-white/70",children:"Пока нет рефералов."})]}),n.jsxs("div",{id:"rating-method",className:`rounded-2xl p-6 sm:p-7 ${V} ${he} border ${X}`,children:[n.jsx("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between mb-4",children:n.jsxs("div",{className:"space-y-1",children:[n.jsx("p",{className:`text-xs uppercase tracking-[0.12em] ${Q}`,children:"Карточки участников"}),n.jsx("h3",{className:`text-2xl font-bold ${ae}`,children:"Детальная статистика"})]})}),i?n.jsxs("div",{className:`rounded-xl p-12 text-center ${s==="dark"?"bg-white/5":"bg-gray-50"} border ${X}`,children:[n.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-4 border-emerald-500 border-t-transparent mx-auto mb-4"}),n.jsx("p",{className:`text-lg font-semibold ${ae}`,children:"Загрузка рейтинга..."}),n.jsx("p",{className:`text-sm ${Q} mt-2`,children:"Подождите, собираем статистику"})]}):n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3 mb-6",children:[{label:"Топ-1",value:(Se=F[0])!=null&&Se.rating?`${F[0].rating.toFixed(1)}%`:"—"},{label:"Средний рейтинг",value:`${w.toFixed(1)}%`},{label:"Медиана",value:`${re.median.toFixed(1)}%`},{label:"Участников",value:F.length}].map(G=>n.jsxs("div",{className:`rounded-xl border ${X} ${s==="dark"?"bg-white/5":"bg-gray-50"} px-4 py-3`,children:[n.jsx("p",{className:`text-[11px] uppercase tracking-wide ${Q}`,children:G.label}),n.jsx("p",{className:`text-2xl font-extrabold ${ae}`,children:G.value})]},G.label))}),n.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-2 gap-6",children:F.map((G,xe)=>P&&G.userId!==P?null:n.jsx("div",{children:n.jsx(MS,{rating:G,place:{rank:xe+1}})},G.userId))})]})]}),n.jsxs("div",{className:`rounded-2xl p-6 sm:p-7 ${V} ${he} border ${X}`,children:[n.jsxs("div",{className:"flex flex-col gap-2 mb-4",children:[n.jsx("p",{className:`text-xs uppercase tracking-[0.12em] ${Q}`,children:"Методика"}),n.jsx("h3",{className:`text-2xl font-bold ${ae}`,children:"Как мы строим эффективность команды?"}),n.jsx("p",{className:`text-sm ${Q}`,children:"Четыре зоны, которые показывают, где сейчас участник и что делать дальше."})]}),n.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-4 gap-3",children:ve.map(G=>n.jsxs("div",{className:`rounded-xl border ${G.bg} p-3 transition`,children:[n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsx("span",{className:`text-xs font-semibold ${Q}`,children:G.label}),n.jsx("span",{className:"text-lg",children:"•"})]}),n.jsx("p",{className:`text-base font-semibold ${G.tone}`,children:G.title}),n.jsx("p",{className:`text-sm ${Q}`,children:G.desc})]},G.label))})]}),n.jsxs("div",{className:`rounded-2xl p-6 sm:p-7 ${V} ${he} border ${X}`,children:[n.jsxs("div",{className:"flex flex-col gap-2 mb-4",children:[n.jsx("p",{className:`text-xs uppercase tracking-[0.12em] ${Q}`,children:"Рекомендации"}),n.jsx("h3",{className:`text-2xl font-bold ${ae}`,children:"Что улучшить каждому"}),n.jsx("p",{className:`text-sm ${Q}`,children:"Динамические подсказки на основе текущих метрик рейтинга."})]}),n.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-3",children:F.map(G=>{const xe=W(G),z=L(G.userId),ce=G.rating>=80?"bg-emerald-500":G.rating>=60?"bg-blue-500":G.rating>=40?"bg-amber-500":"bg-rose-500",ke=G.rating>=80?"Эталон":G.rating>=60?"Уверенно":G.rating>=40?"В пути":"Зона роста";return n.jsxs("div",{className:"rounded-xl border border-white/10 bg-white/5 p-4 space-y-3",children:[n.jsxs("div",{className:"flex items-center justify-between gap-2",children:[n.jsxs("div",{className:"min-w-0",children:[n.jsx("p",{className:`text-xs uppercase tracking-[0.12em] ${Q}`,children:ke}),n.jsx("h4",{className:`text-lg font-bold ${ae} truncate`,children:z})]}),n.jsx("div",{className:"text-right",children:n.jsxs("div",{className:"text-2xl font-bold text-white",children:[G.rating.toFixed(1),"%"]})})]}),n.jsx("div",{className:"w-full bg-white/5 rounded-full h-3 overflow-hidden border border-white/10",children:n.jsx("div",{className:`h-full ${ce}`,style:{width:`${Math.min(G.rating,100)}%`}})}),n.jsx("ul",{className:"space-y-1 text-sm text-white/80",children:xe.map((ue,$e)=>n.jsxs("li",{className:"flex items-start gap-2",children:[n.jsx("span",{className:"text-xs mt-0.5"}),n.jsx("span",{children:ue})]},$e))})]},G.userId)})})]}),n.jsxs("div",{className:`rounded-2xl p-6 sm:p-7 ${V} ${he} border ${X}`,children:[n.jsxs("div",{className:"flex flex-col gap-2 mb-4",children:[n.jsx("p",{className:`text-xs uppercase tracking-[0.12em] ${Q}`,children:"Активность"}),n.jsx("h3",{className:`text-2xl font-bold ${ae}`,children:"Последняя активность на сайте"}),n.jsx("p",{className:`text-sm ${Q}`,children:"Информация о последнем посещении каждого участника."})]}),p.length>0?n.jsx("div",{className:"overflow-auto rounded-xl border border-white/10 bg-white/5",children:n.jsxs("table",{className:"min-w-[800px] w-full text-sm text-white/90",children:[n.jsx("thead",{className:"bg-white/5 text-white/70 text-left",children:n.jsxs("tr",{children:[n.jsx("th",{className:"py-3 px-4 font-semibold",children:"Участник"}),n.jsx("th",{className:"py-3 px-4 font-semibold",children:"Последний вход"}),n.jsx("th",{className:"py-3 px-4 font-semibold",children:"Браузер"}),n.jsx("th",{className:"py-3 px-4 font-semibold",children:"Время на сайте"}),n.jsx("th",{className:"py-3 px-4 font-semibold",children:"Выход"}),n.jsx("th",{className:"py-3 px-4 font-semibold",children:"Статус"})]})}),n.jsx("tbody",{children:Re.map(G=>{const xe=p.find(ke=>ke.userId===G.id),z=ke=>{if(!ke)return"—";const ue=Math.floor(ke/3600),$e=Math.floor(ke%3600/60),Oe=ke%60;return ue>0?`${ue}ч ${$e}м ${Oe}с`:$e>0?`${$e}м ${Oe}с`:`${Oe}с`},ce=ke=>{try{const ue=new Date(ke);return oe(ue,"dd.MM.yyyy HH:mm")}catch{return ke}};return n.jsxs("tr",{className:"border-t border-white/10 hover:bg-white/5 transition-colors",children:[n.jsx("td",{className:"py-3 px-4 font-semibold text-white whitespace-nowrap",children:Tt(G.id)}),n.jsx("td",{className:"py-3 px-4 text-white/80 whitespace-nowrap",children:xe?ce(xe.loginAt):"—"}),n.jsx("td",{className:"py-3 px-4 text-white/80 whitespace-nowrap",children:(xe==null?void 0:xe.browser)||"—"}),n.jsx("td",{className:"py-3 px-4 text-white/80 whitespace-nowrap",children:xe?z(xe.sessionDuration):"—"}),n.jsx("td",{className:"py-3 px-4 text-white/80 whitespace-nowrap",children:xe!=null&&xe.logoutAt?ce(xe.logoutAt):xe!=null&&xe.isActive?"Активен":"—"}),n.jsx("td",{className:"py-3 px-4 whitespace-nowrap",children:xe!=null&&xe.isActive?n.jsx("span",{className:"px-2 py-1 rounded-lg text-xs font-semibold bg-emerald-500/20 text-emerald-200 border border-emerald-400/30",children:"Онлайн"}):n.jsx("span",{className:"px-2 py-1 rounded-lg text-xs font-semibold bg-gray-500/20 text-gray-300 border border-gray-400/30",children:"Офлайн"})})]},G.id)})})]})}):n.jsx("div",{className:"rounded-xl border border-white/10 bg-white/5 p-4 text-white/70",children:"Данные об активности пока отсутствуют."}),n.jsxs("div",{className:"mt-6",children:[n.jsxs("div",{className:"flex flex-col gap-2 mb-4",children:[n.jsx("p",{className:`text-xs uppercase tracking-[0.12em] ${Q}`,children:"Статистика"}),n.jsx("h4",{className:`text-xl font-bold ${ae}`,children:"Активность за последние 24 часа"}),n.jsx("p",{className:`text-sm ${Q}`,children:"Сводная информация о посещениях за сутки."})]}),_.length>0?n.jsx("div",{className:"overflow-auto rounded-xl border border-white/10 bg-white/5",children:n.jsxs("table",{className:"min-w-[700px] w-full text-sm text-white/90",children:[n.jsx("thead",{className:"bg-white/5 text-white/70 text-left",children:n.jsxs("tr",{children:[n.jsx("th",{className:"py-3 px-4 font-semibold",children:"Участник"}),n.jsx("th",{className:"py-3 px-4 font-semibold",children:"Входов"}),n.jsx("th",{className:"py-3 px-4 font-semibold",children:"Общее время"}),n.jsx("th",{className:"py-3 px-4 font-semibold",children:"Среднее время сессии"}),n.jsx("th",{className:"py-3 px-4 font-semibold",children:"Последний вход"})]})}),n.jsx("tbody",{children:Re.map(G=>{const xe=_.filter(U=>U.userId===G.id),z=U=>{if(!U)return"—";const _e=Math.floor(U/3600),Pe=Math.floor(U%3600/60),K=U%60;return _e>0?`${_e}ч ${Pe}м ${K}с`:Pe>0?`${Pe}м ${K}с`:`${K}с`},ce=U=>{try{const _e=new Date(U);return oe(_e,"dd.MM.yyyy HH:mm")}catch{return U}},ke=xe.length,ue=xe.reduce((U,_e)=>U+(_e.sessionDuration||0),0),$e=ke>0?Math.floor(ue/ke):0,Oe=xe.length>0?xe.reduce((U,_e)=>new Date(_e.loginAt)>new Date(U.loginAt)?_e:U):null;return n.jsxs("tr",{className:"border-t border-white/10 hover:bg-white/5 transition-colors",children:[n.jsx("td",{className:"py-3 px-4 font-semibold text-white whitespace-nowrap",children:Tt(G.id)}),n.jsx("td",{className:"py-3 px-4 text-white/80 whitespace-nowrap text-center",children:ke>0?ke:"—"}),n.jsx("td",{className:"py-3 px-4 text-white/80 whitespace-nowrap",children:ue>0?z(ue):"—"}),n.jsx("td",{className:"py-3 px-4 text-white/80 whitespace-nowrap",children:$e>0?z($e):"—"}),n.jsx("td",{className:"py-3 px-4 text-white/80 whitespace-nowrap",children:Oe?ce(Oe.loginAt):"—"})]},G.id)})})]})}):n.jsx("div",{className:"rounded-xl border border-white/10 bg-white/5 p-4 text-white/70",children:"За последние 24 часа активности не зафиксировано."})]})]}),h&&n.jsx($S,{referral:m,onClose:()=>{u(!1),g(null)},onSave:()=>{u(!1),g(null),v()}})]})},Sc={trading:Ov,learning:ya,technical:Bv,stream:Hp,research:Wv,organization:Uv},BC=({onClose:s,onSave:e,editingTask:t})=>{var $,O;const{user:r}=_t(),{theme:a}=lt(),i=!!t,o=a==="dark"?"text-white":"text-gray-900",l=a==="dark"?"bg-[#1a1a1a]":"bg-white",c=a==="dark"?"bg-gray-800":"bg-gray-50",h=a==="dark"?"border-gray-800":"border-gray-300",[u,m]=I.useState((t==null?void 0:t.title)||""),[g,p]=I.useState((t==null?void 0:t.description)||""),[j,_]=I.useState((t==null?void 0:t.category)||"trading"),[y,M]=I.useState((t==null?void 0:t.priority)||"medium"),[D,T]=I.useState((t==null?void 0:t.expectedResult)||""),[R,P]=I.useState((t==null?void 0:t.dueDate)||oe(new Date,"yyyy-MM-dd")),[C,N]=I.useState((t==null?void 0:t.dueTime)||"12:00"),b=J=>({...J,assignees:J.assignees||[],approvals:J.approvals||[],requiresApproval:J.requiresApproval??!0,stagePriority:J.stagePriority||"medium",status:J.status||"pending"}),[v,S]=I.useState(($=t==null?void 0:t.stages)!=null&&$.length?t.stages.map(b):[b({id:"stage-1",name:"Этап 1",description:"",responsible:"all",assignees:[],approvals:[],stagePriority:"medium",requiresApproval:!0,status:"pending"})]),[E,k]=I.useState((t==null?void 0:t.currentStageId)||((O=v[0])==null?void 0:O.id)||"stage-1"),[w,Q]=I.useState(""),[ae,V]=I.useState(!1);Ur();const X=[{value:"urgent",label:"Экстренный",desc:"Нужно прямо сейчас",tone:a==="dark"?"bg-rose-600/20 border-rose-500/50 text-rose-100":"bg-rose-50 border-rose-200 text-rose-700"},{value:"high",label:"Высокий",desc:"Быстрый старт",tone:a==="dark"?"bg-red-500/15 border-red-500/40 text-red-100":"bg-red-50 border-red-200 text-red-700"},{value:"medium",label:"Средний",desc:"Плановый слот",tone:a==="dark"?"bg-amber-500/15 border-amber-500/40 text-amber-100":"bg-amber-50 border-amber-200 text-amber-700"},{value:"low",label:"Низкий",desc:"Фон",tone:a==="dark"?"bg-gray-500/15 border-gray-500/40 text-gray-100":"bg-gray-50 border-gray-200 text-gray-700"}],he=(J,Y)=>{S(Z=>Z.map(L=>L.id===J?{...L,...Y}:L))},B=(J,Y)=>{S(Z=>Z.map(L=>L.id!==J?L:L.assignees.find(ge=>ge.userId===Y)?{...L,assignees:L.assignees.filter(ge=>ge.userId!==Y)}:L.assignees.length>=10?L:{...L,assignees:[...L.assignees,{userId:Y,priority:"medium"}]}))},te=(J,Y,Z,L)=>{S(fe=>fe.map(ge=>{if(ge.id!==J)return ge;const H=ge.assignees.map(se=>se.userId===Y?{...se,[Z]:L}:se);return{...ge,assignees:H}}))},ve=()=>{const J=b({id:`stage-${Date.now()}`,name:`Этап ${v.length+1}`,description:"",responsible:"all",assignees:[],approvals:[],stagePriority:"medium",requiresApproval:!0,status:"pending"});S(Y=>[...Y,J]),E||k(J.id)},W=J=>{var Z;if(v.length===1)return;const Y=v.filter(L=>L.id!==J);S(Y),E===J&&k(((Z=Y[0])==null?void 0:Z.id)||"")},F=()=>u.trim()?!R||!C?"Укажите дедлайн (дата и время)":new Set(v.flatMap(Y=>Y.assignees.map(Z=>Z.userId))).size===0?"Добавьте исполнителей в этапах":"":"Введите название задачи",re=(J,Y)=>{const Z=J.assignees,L=Z.map(ge=>ge.userId),fe=L.map(ge=>{const H=Z.find(se=>se.userId===ge);return{userId:ge,status:"pending",updatedAt:Y,...H!=null&&H.comment?{comment:H.comment}:{}}});return{id:J.id,name:J.name,description:J.description,responsible:L,assignees:Z,stagePriority:J.stagePriority||"medium",requiresApproval:!0,approvals:fe,comments:J.comments||[],status:"pending"}},de=async()=>{var Z;const J=F();if(J){Q(J);return}if(!r){Q("Пользователь не найден");return}Q(""),V(!0);const Y=new Date().toISOString();try{const L=v.map(se=>re(se,Y)),fe=Array.from(new Set(L.flatMap(se=>{var je;return((je=se.assignees)==null?void 0:je.map(Se=>Se.userId))||[]}))),ge=fe.map(se=>({userId:se,status:"pending",updatedAt:Y})),H={title:u.trim(),description:g.trim()||void 0,category:j,priority:y,assignedTo:fe,assignees:fe.map(se=>({userId:se,priority:"medium"})),approvals:ge,stages:L,currentStageId:E||((Z=L[0])==null?void 0:Z.id),dueDate:R,dueTime:C,expectedResult:D.trim()||void 0,updatedAt:Y};if(i&&t)await kr(t.id,H);else{const se={...H,status:"in_progress",createdBy:r.id,createdAt:Y};await K5(se)}e()}catch(L){console.error("Error saving task:",L),Q("Ошибка при сохранении задачи")}finally{V(!1)}};return n.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-start sm:items-center justify-center z-[70] p-4 overflow-y-auto overscroll-contain modal-scroll touch-pan-y",children:n.jsx("div",{className:`${l} rounded-xl sm:rounded-2xl shadow-2xl w-full max-w-2xl max-h-[calc(100vh-48px)] sm:max-h-[calc(100vh-64px)] overflow-y-auto border-2 touch-pan-y ${a==="dark"?"border-[#4E6E49]/30 bg-gradient-to-br from-[#1a1a1a] via-[#1a1a1a] to-[#0A0A0A]":"border-green-200 bg-gradient-to-br from-white via-green-50/30 to-white"} relative`,children:n.jsxs("div",{className:"flex flex-col h-full min-h-0",children:[n.jsxs("div",{className:`sticky top-0 ${l} border-b ${h} p-4 sm:p-6 flex items-center justify-between z-10`,children:[n.jsxs("h2",{className:`text-xl sm:text-2xl font-bold ${o} flex items-center gap-2`,children:[n.jsx(Lp,{className:"w-5 h-5 sm:w-6 sm:h-6"}),i?"Редактировать задачу":"Новая задача"]}),n.jsx("button",{onClick:s,className:`p-2 rounded-lg transition-colors ${a==="dark"?"hover:bg-gray-700":"hover:bg-gray-100"}`,children:n.jsx(Ft,{className:"w-5 h-5"})})]}),n.jsxs("div",{className:"p-4 sm:p-6 space-y-4 sm:space-y-6 flex-1 min-h-0 overflow-y-auto overscroll-contain modal-scroll touch-pan-y pb-10",children:[w&&n.jsxs("div",{className:"p-3 rounded-lg bg-red-500/10 border border-red-500/30 flex items-center gap-2 text-red-500",children:[n.jsx(ew,{className:"w-5 h-5 flex-shrink-0"}),n.jsx("span",{className:"text-sm",children:w})]}),n.jsxs("div",{children:[n.jsx("label",{className:`block text-sm font-medium mb-2 ${o}`,children:"Название *"}),n.jsx("input",{value:u,onChange:J=>m(J.target.value),className:`w-full px-4 py-2.5 rounded-lg border ${h} ${c} ${o} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]/50`,placeholder:"Введите название задачи"})]}),n.jsxs("div",{children:[n.jsx("label",{className:`block text-sm font-medium mb-2 ${o}`,children:"Описание"}),n.jsx("textarea",{value:g,onChange:J=>p(J.target.value),rows:4,className:`w-full px-4 py-2.5 rounded-lg border ${h} ${c} ${o} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]/50`,placeholder:"Кратко опишите задачу"})]}),n.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[n.jsxs("div",{className:"space-y-3",children:[n.jsxs("label",{className:`block text-sm font-medium ${o} flex items-center gap-2`,children:[n.jsx(uw,{className:"w-4 h-4"}),"Категория"]}),n.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2 sm:gap-3",children:Object.entries(Ii).map(([J,{label:Y}])=>{const Z=Sc[J],L=j===J;return n.jsxs("button",{type:"button",onClick:()=>_(J),className:`p-3 rounded-lg border-2 text-sm font-semibold transition-all text-center ${L?a==="dark"?"border-[#4E6E49] bg-[#4E6E49]/15 text-[#4E6E49]":"border-[#4E6E49] bg-green-50 text-[#4E6E49]":a==="dark"?"border-gray-800 bg-gray-900 text-gray-200 hover:border-[#4E6E49]/40":"border-gray-200 bg-white text-gray-800 hover:border-[#4E6E49]/40"} flex items-center justify-center gap-2`,children:[n.jsx(Z,{className:"w-4 h-4"}),n.jsx("span",{children:Y})]},J)})})]}),n.jsxs("div",{className:"space-y-3",children:[n.jsxs("label",{className:`block text-sm font-medium ${o} flex items-center gap-2`,children:[n.jsx(xs,{className:"w-4 h-4"}),"Приоритет"]}),n.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2",children:X.map(J=>n.jsxs("button",{type:"button",onClick:()=>M(J.value),className:`p-3 rounded-lg border-2 text-left transition-all ${J.tone} ${y===J.value?"ring-2 ring-offset-2 ring-[#4E6E49] dark:ring-offset-[#1a1a1a]":""}`,children:[n.jsxs("div",{className:"flex items-center justify-between gap-2",children:[n.jsx("span",{className:"font-semibold text-sm",children:J.label}),y===J.value&&n.jsx("span",{className:"text-xs font-semibold",children:"выбрано"})]}),n.jsx("p",{className:"text-xs mt-1 opacity-80",children:J.desc})]},J.value))})]})]}),n.jsxs("div",{className:"space-y-3",children:[n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsx("label",{className:`block text-sm font-medium ${o}`,children:"Этапы и исполнители"}),n.jsxs("button",{type:"button",onClick:ve,className:`px-3 py-1.5 rounded-lg text-xs font-semibold ${a==="dark"?"bg-gray-700 hover:bg-gray-600 text-gray-200":"bg-gray-200 hover:bg-gray-300 text-gray-800"}`,children:[n.jsx(Cr,{className:"w-4 h-4 inline"})," Добавить этап"]})]}),n.jsx("div",{className:"space-y-3",children:v.map((J,Y)=>n.jsxs("div",{className:`p-3 rounded-lg border-2 ${h} ${c}`,children:[n.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[n.jsx("input",{value:J.name,onChange:Z=>he(J.id,{name:Z.target.value}),className:`flex-1 px-3 py-2 rounded-lg border ${h} ${a==="dark"?"bg-[#0f0f0f] text-gray-100":"bg-white text-gray-800"}`,placeholder:`Этап ${Y+1}`}),v.length>1&&n.jsx("button",{onClick:()=>W(J.id),className:`p-2 rounded-lg ${a==="dark"?"bg-red-500/20 text-red-200":"bg-red-100 text-red-700"}`,children:n.jsx(fw,{className:"w-4 h-4"})})]}),n.jsx("textarea",{value:J.description||"",onChange:Z=>he(J.id,{description:Z.target.value}),rows:2,className:`w-full px-3 py-2 rounded-lg border ${h} ${a==="dark"?"bg-[#0f0f0f] text-gray-100":"bg-white text-gray-800"}`,placeholder:"Описание этапа (опционально)"}),n.jsxs("div",{className:"mt-3 space-y-2",children:[n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("label",{className:`text-sm font-medium ${o} flex items-center gap-2`,children:[n.jsx(qn,{className:"w-4 h-4"}),"Исполнители этапа"]}),n.jsxs("span",{className:"text-[11px] text-gray-500",children:[J.assignees.length,"/10"]})]}),n.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-2",children:Re.map(Z=>{const L=J.assignees.some(fe=>fe.userId===Z.id);return n.jsx("button",{type:"button",onClick:()=>B(J.id,Z.id),className:`p-2 rounded-lg border text-left text-sm transition-all ${L?a==="dark"?"border-[#4E6E49] bg-[#4E6E49]/20":"border-[#4E6E49] bg-green-50":`${h} ${c}`}`,children:n.jsx("span",{className:L?"text-[#4E6E49]":o,children:Tt(Z.id)})},Z.id)})}),J.assignees.length>0&&n.jsx("div",{className:"space-y-2",children:J.assignees.map(Z=>{const L=Re.find(fe=>fe.id===Z.userId);return n.jsxs("div",{className:`p-2 rounded-lg border ${h} ${a==="dark"?"bg-[#0f0f0f]":"bg-white"}`,children:[n.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2",children:[n.jsx("div",{className:"text-sm font-medium",children:(L==null?void 0:L.name)||Z.userId}),n.jsxs("select",{value:Z.priority,onChange:fe=>te(J.id,Z.userId,"priority",fe.target.value),className:`px-3 py-1.5 rounded-lg border ${h} ${a==="dark"?"bg-[#1a1a1a] text-gray-100":"bg-white text-gray-700"}`,children:[n.jsx("option",{value:"urgent",children:"Экстренный"}),n.jsx("option",{value:"high",children:"Высокий"}),n.jsx("option",{value:"medium",children:"Средний"}),n.jsx("option",{value:"low",children:"Низкий"})]})]}),n.jsx("textarea",{value:Z.comment||"",onChange:fe=>te(J.id,Z.userId,"comment",fe.target.value),rows:2,className:`mt-2 w-full px-3 py-2 rounded-lg border ${h} ${a==="dark"?"bg-[#1a1a1a] text-gray-100":"bg-white text-gray-700"}`,placeholder:"Комментарий для исполнителя (опционально)"})]},Z.userId)})})]})]},J.id))})]}),n.jsxs("div",{children:[n.jsxs("label",{className:`block text-sm font-medium mb-2 ${o} flex items-center gap-2`,children:[n.jsx(os,{className:"w-4 h-4"}),"Какой результат должен быть"]}),n.jsx("textarea",{value:D,onChange:J=>T(J.target.value),rows:3,className:`w-full px-4 py-2.5 rounded-lg border ${h} ${c} ${o} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]/50`,placeholder:"Опишите ожидаемый итог"})]}),n.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[n.jsxs("div",{className:"space-y-1",children:[n.jsxs("label",{className:`text-sm font-medium ${o} flex items-center gap-2`,children:[n.jsx(Fr,{className:"w-4 h-4"}),"Дата дедлайна *"]}),n.jsx("input",{type:"date",value:R,onChange:J=>P(J.target.value),min:oe(new Date,"yyyy-MM-dd"),className:`w-full px-4 py-2.5 rounded-lg border ${h} ${c} ${o} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]/50`})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsxs("label",{className:`text-sm font-medium ${o} flex items-center gap-2`,children:[n.jsx(Ks,{className:"w-4 h-4"}),"Время дедлайна *"]}),n.jsx("input",{type:"time",value:C,onChange:J=>N(J.target.value),className:`w-full px-4 py-2.5 rounded-lg border ${h} ${c} ${o} focus:outline-none focus:ring-2 focus:ring-[#4E6E49]/50`})]})]}),n.jsxs("div",{className:`flex flex-col sm:flex-row gap-3 pt-4 border-t ${h}`,children:[n.jsx("button",{onClick:de,disabled:ae,className:`flex-1 px-6 py-3 rounded-lg font-semibold transition-all ${ae?"bg-gray-400 cursor-not-allowed":"bg-gradient-to-r from-[#4E6E49] to-emerald-700 hover:from-[#4E6E49] hover:to-emerald-700 text-white shadow-lg hover:shadow-xl transform hover:scale-[1.02]"}`,children:ae?"Сохранение...":i?"Сохранить":"Создать задачу"}),n.jsx("button",{onClick:s,className:`px-6 py-3 rounded-lg font-semibold transition-colors ${a==="dark"?"bg-gray-700 hover:bg-gray-600 text-gray-300":"bg-gray-200 hover:bg-gray-300 text-gray-700"}`,children:"Отмена"})]})]})]})})})},Ru=60*1e3,Ki=60*Ru,_p=24*Ki,zC=s=>{if(s<=0)return"Просрочено";const e=Math.floor(s/_p),t=Math.floor(s%_p/Ki),r=Math.floor(s%Ki/Ru);return e>0?`${e}д ${t}ч`:t>0?`${t}ч ${r}м`:`${Math.max(r,1)}м`},HC=s=>s<=0?"overdue":s<=Ki?"urgent":s<=6*Ki?"soon":"on_track",gd=(s,e)=>{if(!s||!e)return{label:"—",status:"unknown",isOverdue:!1};const r=new Date(`${s}T${e}`).getTime()-Date.now();if(Number.isNaN(r))return{label:"—",status:"unknown",isOverdue:!1};const a=HC(r);return{label:zC(r),status:a,isOverdue:a==="overdue"}},WC=(s,e)=>{const t=I.useMemo(()=>gd(s,e),[s,e]),[r,a]=I.useState(t);return I.useEffect(()=>{a(gd(s,e));const i=setInterval(()=>{a(gd(s,e))},Ru);return()=>clearInterval(i)},[s,e]),r},qC=(s,e)=>e==="dark"?{overdue:"bg-red-500/10 border-red-500/40 text-red-300",urgent:"bg-orange-500/10 border-orange-500/40 text-orange-200",soon:"bg-yellow-500/10 border-yellow-500/40 text-yellow-200",on_track:"bg-[#4E6E49]/10 border-[#4E6E49]/40 text-green-200",unknown:"bg-gray-600/30 border-gray-500/40 text-gray-200"}[s]:{overdue:"bg-red-50 border-red-200 text-red-600",urgent:"bg-orange-50 border-orange-200 text-orange-600",soon:"bg-yellow-50 border-yellow-200 text-yellow-700",on_track:"bg-green-50 border-green-200 text-[#4E6E49]",unknown:"bg-gray-100 border-gray-200 text-gray-600"}[s],yy=({dueDate:s,dueTime:e,theme:t,size:r="default"})=>{const{label:a,status:i}=WC(s,e),o=qC(i,t),l=r==="compact"?"px-2 py-0.5 text-[11px]":"px-2.5 py-1 text-xs sm:text-sm",c=r==="compact"?"w-3 h-3":"w-4 h-4";return n.jsxs("span",{className:`inline-flex items-center gap-1 rounded-full border font-medium ${l} ${o}`,children:[n.jsx(Ks,{className:c}),a]})},GC=({task:s,onEdit:e,onDelete:t,onUpdate:r})=>{const{user:a}=_t(),{isAdmin:i}=Ct(),{theme:o}=lt(),[l,c]=I.useState(!1),[h,u]=I.useState(!1),[m,g]=I.useState(""),p=o==="dark"?"text-white":"text-gray-900",j=o==="dark"?"bg-[#1a1a1a]":"bg-white",_=o==="dark"?"border-gray-800":"border-gray-300",y=Ii[s.category],M=Mn[s.status],D=Sc[s.category],T=s.assignees&&s.assignees.length>0?s.assignees:s.assignedTo.map(W=>({userId:W,priority:"medium"})),R=T.map(W=>W.userId),P=T.map(W=>{const F=Re.find(re=>re.id===W.userId);return F?{...W,member:F}:null}).filter(Boolean),C=i||(a==null?void 0:a.id)===s.createdBy||s.mainExecutor===(a==null?void 0:a.id),N=()=>{const W=new Date().toISOString(),re=(s.approvals||[]).filter($=>R.includes($.userId)).map($=>({userId:$.userId,status:$.status==="approved"?"approved":"pending",updatedAt:$.updatedAt||W,...$.comment?{comment:$.comment}:{}})),de=R.filter($=>!re.some(O=>O.userId===$)).map($=>({userId:$,status:"pending",updatedAt:W}));return[...re,...de]},b=()=>!!a&&R.includes(a.id),v=()=>i||(a==null?void 0:a.id)===s.createdBy,S=()=>{const W=N(),F=W.filter(re=>re.status==="approved").length;return{approvals:W,approved:F,total:R.length}},{approvals:E,approved:k,total:w}=S(),Q=E.find(W=>W.userId===(a==null?void 0:a.id)),ae=b()&&s.status==="in_progress"&&(!Q||Q.status!=="approved"),V=v()&&s.status==="completed",X=async()=>{if(!(!a||s.status!=="in_progress"||!b())){c(!0);try{const W=new Date().toISOString(),F=N().map($=>$.userId===a.id?{...$,status:"approved",updatedAt:W}:$),re=R.length>0&&R.every($=>F.find(O=>O.userId===$&&O.status==="approved")),de={approvals:F,updatedAt:W};re&&(de.status="completed",de.completedAt=W,de.completedBy=a.id),await kr(s.id,de),r()}catch(W){console.error("Error confirming task:",W)}finally{c(!1)}}},he=async()=>{if(!(!v()||s.status!=="completed")){c(!0);try{const W=new Date().toISOString();await kr(s.id,{status:"closed",closedAt:W,updatedAt:W}),r()}catch(W){console.error("Error closing task:",W)}finally{c(!1)}}},B=async()=>{if(!v())return;const W=(m||"").trim();if(W){c(!0);try{const F=new Date().toISOString(),re=R.map($=>({userId:$,status:"pending",updatedAt:F})),de={id:`c-${Date.now()}`,userId:(a==null?void 0:a.id)||"system",text:W,createdAt:F};await kr(s.id,{status:"in_progress",approvals:re,completedAt:void 0,completedBy:void 0,closedAt:void 0,comments:[...s.comments||[],de],updatedAt:F}),u(!1),g(""),r()}catch(F){console.error("Error returning task:",F)}finally{c(!1)}}},te=()=>({in_progress:o==="dark"?"bg-blue-500/20 border-blue-500/50 text-blue-400":"bg-blue-50 border-blue-200 text-blue-700",completed:o==="dark"?"bg-[#4E6E49]/20 border-[#4E6E49]/50 text-[#4E6E49]":"bg-green-50 border-green-200 text-[#4E6E49]",closed:o==="dark"?"bg-gray-500/20 border-gray-500/50 text-gray-400":"bg-gray-50 border-gray-200 text-gray-700"})[s.status],ve=()=>{const W={green:{bg:o==="dark"?"bg-[#4E6E49]/20":"bg-green-50",text:"text-[#4E6E49]"},blue:{bg:o==="dark"?"bg-blue-500/20":"bg-blue-50",text:o==="dark"?"text-blue-400":"text-blue-700"},purple:{bg:o==="dark"?"bg-purple-500/20":"bg-purple-50",text:o==="dark"?"text-purple-400":"text-purple-700"},red:{bg:o==="dark"?"bg-red-500/20":"bg-red-50",text:o==="dark"?"text-red-400":"text-red-700"},yellow:{bg:o==="dark"?"bg-yellow-500/20":"bg-yellow-50",text:o==="dark"?"text-yellow-400":"text-yellow-700"},indigo:{bg:o==="dark"?"bg-indigo-500/20":"bg-indigo-50",text:o==="dark"?"text-indigo-400":"text-indigo-700"}};return W[y.color]||W.green};return n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:`${j} rounded-xl border-2 ${_} p-4 sm:p-6 shadow-lg hover:shadow-xl transition-all ${o==="dark"?"hover:border-[#4E6E49]/50":"hover:border-[#4E6E49]"}`,children:[n.jsxs("div",{className:"flex items-start justify-between gap-3 mb-3",children:[n.jsxs("div",{className:"flex-1 min-w-0",children:[n.jsx("div",{className:"flex items-center gap-2 mb-2",children:n.jsx("h3",{className:`text-lg sm:text-xl font-bold ${p} truncate`,children:s.title})}),n.jsxs("div",{className:"flex flex-wrap items-center gap-2 sm:gap-3",children:[n.jsxs("span",{className:`px-2.5 py-1 rounded-lg text-xs sm:text-sm font-medium ${ve().bg} ${ve().text} inline-flex items-center gap-1.5`,children:[n.jsx(D,{className:"w-4 h-4"}),y.label]}),n.jsx("span",{className:`px-2.5 py-1 rounded-lg text-xs sm:text-sm font-medium border ${te()}`,children:M.label}),n.jsx("span",{className:`px-2.5 py-1 rounded-lg text-xs sm:text-sm font-medium border ${o==="dark"?"border-yellow-500/40 text-yellow-200 bg-yellow-500/10":"border-yellow-200 text-yellow-700 bg-yellow-50"}`,children:s.priority==="urgent"?"Экстренный приоритет":s.priority==="high"?"Высокий приоритет":s.priority==="medium"?"Средний приоритет":"Низкий приоритет"})]})]}),C&&n.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[n.jsx("button",{onClick:()=>e(s),className:`p-2 rounded-lg transition-colors ${o==="dark"?"hover:bg-gray-700":"hover:bg-gray-100"}`,title:"Редактировать",children:n.jsx(ps,{className:"w-4 h-4"})}),n.jsx("button",{onClick:()=>t(s.id),className:`p-2 rounded-lg transition-colors ${o==="dark"?"hover:bg-red-500/20 text-red-400":"hover:bg-red-50 text-red-600"}`,title:"Удалить",children:n.jsx(Bt,{className:"w-4 h-4"})})]})]}),s.description&&n.jsx("p",{className:`text-sm ${o==="dark"?"text-gray-300":"text-gray-600"} mb-4 line-clamp-2`,children:s.description}),n.jsxs("div",{className:"space-y-2 mb-4",children:[n.jsxs("div",{className:"flex flex-col gap-3",children:[n.jsxs("div",{className:"flex items-center gap-2 text-xs sm:text-sm",children:[n.jsx(Rn,{className:`w-4 h-4 ${o==="dark"?"text-blue-400":"text-blue-600"}`}),n.jsx("span",{className:`font-medium ${o==="dark"?"text-gray-300":"text-gray-700"}`,children:"Автор:"}),n.jsx("span",{className:o==="dark"?"text-gray-400":"text-gray-600",children:s.createdBy?Tt(s.createdBy):"Неизвестно"})]}),n.jsxs("div",{children:[n.jsxs("div",{className:"flex items-center gap-2 text-xs sm:text-sm",children:[n.jsx(qn,{className:"w-4 h-4 text-[#4E6E49]"}),n.jsx("span",{className:`font-medium ${o==="dark"?"text-gray-300":"text-gray-700"}`,children:"Исполнители:"})]}),P.length>0?n.jsx("div",{className:"mt-2 space-y-1",children:P.map(W=>n.jsx("div",{className:`text-sm ${o==="dark"?"text-gray-100":"text-gray-800"}`,children:Tt(W.member.id)},W.member.id))}):n.jsx("span",{className:"text-gray-500",children:"Не назначены"})]})]}),n.jsxs("div",{className:"flex items-center gap-3 flex-wrap text-xs sm:text-sm",children:[n.jsxs("span",{className:"inline-flex items-center gap-1",children:[n.jsx(Fr,{className:`w-4 h-4 ${o==="dark"?"text-gray-400":"text-gray-500"}`}),n.jsxs("span",{className:o==="dark"?"text-gray-400":"text-gray-600",children:["Дедлайн: ",oe(new Date(s.dueDate),"dd.MM.yyyy")," ",s.dueTime]})]}),n.jsx(yy,{dueDate:s.dueDate,dueTime:s.dueTime,theme:o})]}),w>0&&n.jsxs("div",{className:"flex items-center gap-2 text-xs sm:text-sm",children:[n.jsx(Kl,{className:`w-4 h-4 ${o==="dark"?"text-yellow-400":"text-yellow-600"}`}),n.jsxs("span",{className:o==="dark"?"text-yellow-400":"text-yellow-600",children:["Подтвердили: ",k,"/",w]})]})]}),n.jsxs("div",{className:`mt-4 p-3 rounded-lg border ${_} ${o==="dark"?"bg-[#1a1a1a]/70":"bg-gray-50"}`,children:[n.jsxs("div",{className:"flex items-center justify-between mb-2",children:[n.jsx("span",{className:"text-sm font-semibold",children:"Подтверждения исполнителей"}),n.jsxs("span",{className:"text-xs text-gray-500",children:[k,"/",w]})]}),E.length>0&&n.jsx("div",{className:"space-y-1 text-xs",children:E.map(W=>{const F=Re.find(de=>de.id===W.userId),re=W.status==="approved"?"подтвердил":"ожидает";return n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("span",{className:"flex items-center gap-1",children:[n.jsx("span",{className:"font-medium",children:(F==null?void 0:F.name)||W.userId}),n.jsxs("span",{className:"text-gray-500",children:["(",re,")"]})]}),W.comment&&n.jsx("span",{className:"text-gray-500 truncate max-w-[140px]",children:W.comment})]},W.userId)})})]}),n.jsxs("div",{className:`flex flex-wrap gap-2 pt-4 border-t ${_}`,children:[ae&&n.jsxs("button",{onClick:X,disabled:l,className:"flex-1 sm:flex-none px-4 py-2 bg-[#4E6E49] hover:bg-[#4E6E49] text-white rounded-lg text-sm font-medium transition-colors flex items-center justify-center gap-2 disabled:opacity-50",children:[n.jsx(Ls,{className:"w-4 h-4"}),"Подтвердить"]}),V&&n.jsxs(n.Fragment,{children:[n.jsxs("button",{onClick:he,disabled:l,className:"flex-1 sm:flex-none px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg text-sm font-medium transition-colors flex items-center justify-center gap-2 disabled:opacity-50",children:[n.jsx(Qi,{className:"w-4 h-4"}),"Закрыто"]}),n.jsxs("button",{onClick:()=>u(!0),disabled:l,className:"flex-1 sm:flex-none px-4 py-2 bg-red-500 hover:bg-red-600 text-white rounded-lg text-sm font-medium transition-colors flex items-center justify-center gap-2 disabled:opacity-50",children:[n.jsx(Ft,{className:"w-4 h-4"}),"Не выполнено"]})]}),s.status==="completed"&&!V&&n.jsx("span",{className:`text-xs ${o==="dark"?"text-gray-400":"text-gray-600"}`,children:"Ожидает подтверждения автора"})]})]}),h&&n.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-start sm:items-center justify-center z-[70] p-4 overflow-y-auto overscroll-contain modal-scroll",children:n.jsxs("div",{className:`${j} rounded-xl p-6 max-w-md w-full border-2 ${_}`,children:[n.jsx("h3",{className:`text-lg font-bold mb-4 ${p}`,children:"Не выполнено"}),n.jsx("textarea",{value:m,onChange:W=>g(W.target.value),placeholder:"Опишите, что нужно доработать",rows:3,className:`w-full px-4 py-2 rounded-lg border ${_} ${o==="dark"?"bg-gray-700":"bg-gray-50"} ${p} mb-4 focus:outline-none focus:ring-2 focus:ring-[#4E6E49]/50`}),n.jsxs("div",{className:"flex gap-3",children:[n.jsx("button",{onClick:B,disabled:l||!m.trim(),className:"flex-1 px-4 py-2 rounded-lg font-medium transition-colors bg-red-500 hover:bg-red-600 text-white disabled:opacity-50",children:"Отправить на доработку"}),n.jsx("button",{onClick:()=>{u(!1),g("")},className:`px-4 py-2 rounded-lg font-medium transition-colors ${o==="dark"?"bg-gray-700 hover:bg-gray-600":"bg-gray-200 hover:bg-gray-300"}`,children:"Отмена"})]})]})})]})},KC=({selectedCategory:s,selectedStatus:e,selectedUsers:t,onCategoryChange:r,onStatusChange:a,onUsersChange:i,onClear:o})=>{const{theme:l}=lt(),c=l==="dark"?"text-white":"text-gray-900",h=l==="dark"?"bg-[#1a1a1a]":"bg-white",u=l==="dark"?"border-gray-800":"border-gray-300",m=s!=="all"||e!=="all"||t.length>0,g=Re.filter(_=>t.includes(_.id)).map(_=>_.name),p=[{href:"#filter-status",label:"Статусы"},{href:"#filter-category",label:"Категории"},{href:"#filter-people",label:"Исполнители"}],j={in_progress:n.jsx(on,{className:"w-4 h-4"}),completed:n.jsx(Qi,{className:"w-4 h-4"}),closed:n.jsx(Mv,{className:"w-4 h-4"})};return n.jsxs("div",{className:`${h} rounded-xl border-2 ${u} p-4 sm:p-6 shadow-lg sticky top-4 space-y-4`,children:[n.jsxs("div",{className:"flex items-start justify-between gap-3",children:[n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx("div",{className:`p-2 rounded-lg ${l==="dark"?"bg-[#4E6E49]/20":"bg-green-50"}`,children:n.jsx(mh,{className:"w-5 h-5 text-[#4E6E49]"})}),n.jsxs("div",{children:[n.jsx("h3",{className:`text-lg font-bold ${c}`,children:"Фильтры"}),n.jsx("p",{className:`text-xs ${l==="dark"?"text-gray-400":"text-gray-500"}`,children:"Быстрая навигация по статусам, категориям и участникам"})]})]}),m&&n.jsxs("button",{onClick:o,className:`px-3 py-1.5 rounded-lg text-sm transition-all flex items-center gap-2 ${l==="dark"?"bg-red-500/20 hover:bg-red-500/30 text-red-300 border border-red-500/50":"bg-red-50 hover:bg-red-100 text-red-600 border border-red-200"}`,children:[n.jsx(Ft,{className:"w-4 h-4"}),n.jsx("span",{className:"hidden sm:inline",children:"Сбросить всё"})]})]}),n.jsx("div",{className:"flex flex-wrap gap-2",children:p.map(_=>n.jsxs("a",{href:_.href,className:`px-3 py-1.5 rounded-lg text-xs font-semibold border transition flex items-center gap-2 ${l==="dark"?"border-white/10 bg-white/5 text-gray-100 hover:border-[#4E6E49]/50":"border-gray-200 bg-white text-gray-800 hover:border-[#4E6E49]/50 hover:text-[#4E6E49]"}`,children:[n.jsx(Em,{className:"w-4 h-4"}),_.label]},_.href))}),n.jsxs("div",{className:`rounded-lg border ${u} ${l==="dark"?"bg-[#1f1f1f]":"bg-gray-50"} p-3 space-y-2`,children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx(sw,{className:"w-4 h-4 text-[#4E6E49]"}),n.jsx("p",{className:`text-sm font-semibold ${c}`,children:"Текущая подборка"})]}),n.jsx("div",{className:"flex flex-wrap gap-2",children:m?n.jsxs(n.Fragment,{children:[s!=="all"&&n.jsx("span",{className:"px-2.5 py-1 rounded-full text-xs font-semibold bg-emerald-500/10 text-emerald-700 dark:text-emerald-200 border border-emerald-500/30",children:Ii[s].label}),e!=="all"&&n.jsx("span",{className:"px-2.5 py-1 rounded-full text-xs font-semibold bg-sky-500/10 text-sky-700 dark:text-sky-200 border border-sky-500/30",children:Mn[e].label}),t.length>0&&n.jsx("span",{className:"px-2.5 py-1 rounded-full text-xs font-semibold bg-purple-500/10 text-purple-700 dark:text-purple-200 border border-purple-500/30",children:g.join(", ")})]}):n.jsx("span",{className:`text-xs ${l==="dark"?"text-gray-400":"text-gray-500"}`,children:"Фильтры не заданы"})})]}),n.jsxs("div",{className:"space-y-6",children:[n.jsxs("div",{id:"filter-status",className:"space-y-3",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx(Qv,{className:"w-4 h-4 text-yellow-500"}),n.jsx("label",{className:`block text-sm font-semibold ${c}`,children:"Статусы"})]}),n.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[n.jsxs("button",{onClick:()=>a("all"),className:`px-3 py-2 rounded-lg text-sm font-semibold transition-all border-2 ${e==="all"?l==="dark"?"bg-[#4E6E49]/20 border-[#4E6E49] text-[#4E6E49]":"bg-green-50 border-[#4E6E49] text-[#4E6E49]":`${l==="dark"?"bg-gray-800 border-gray-800 text-gray-200 hover:bg-gray-700":"bg-white border-gray-200 text-gray-700 hover:border-[#4E6E49]/40"}`} flex items-center gap-2 justify-start text-left w-full`,children:[n.jsx($n,{className:"w-4 h-4"}),"Целиком"]}),Object.entries(Mn).map(([_,{label:y,color:M}])=>{const D={yellow:l==="dark"?"bg-yellow-500/10 border-yellow-500/50 text-yellow-300":"bg-yellow-50 border-yellow-500/40 text-yellow-700",blue:l==="dark"?"bg-blue-500/10 border-blue-500/50 text-blue-300":"bg-blue-50 border-blue-500/40 text-blue-700",purple:l==="dark"?"bg-purple-500/10 border-purple-500/50 text-purple-200":"bg-purple-50 border-purple-500/40 text-purple-700",green:l==="dark"?"bg-emerald-500/10 border-emerald-500/50 text-emerald-200":"bg-emerald-50 border-emerald-500/40 text-emerald-700",gray:l==="dark"?"bg-gray-500/10 border-gray-500/50 text-gray-300":"bg-gray-50 border-gray-400/60 text-gray-700",red:l==="dark"?"bg-red-500/10 border-red-500/50 text-red-300":"bg-red-50 border-red-500/40 text-red-700"},T=D[M]||D.gray,R=j[_];return n.jsx("button",{onClick:()=>a(_),className:`px-3 py-2 rounded-lg text-sm font-semibold transition-all border-2 flex items-center justify-start gap-3 text-left ${e===_?T:l==="dark"?"bg-gray-900 border-gray-800 text-gray-200 hover:border-[#4E6E49]/40":"bg-white border-gray-200 text-gray-700 hover:border-[#4E6E49]/40"}`,children:n.jsxs("span",{className:"flex items-center gap-2",children:[R,y]})},_)})]})]}),n.jsxs("div",{id:"filter-category",className:"space-y-3",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx(xs,{className:"w-4 h-4 text-purple-500"}),n.jsx("label",{className:`block text-sm font-semibold ${c}`,children:"Категории"})]}),n.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2",children:[n.jsxs("button",{onClick:()=>r("all"),className:`px-3 py-3 rounded-lg text-sm font-semibold transition-all border-2 flex items-center gap-2 justify-start text-left w-full ${s==="all"?l==="dark"?"bg-[#4E6E49]/20 border-[#4E6E49] text-[#4E6E49]":"bg-green-50 border-[#4E6E49] text-[#4E6E49]":`${l==="dark"?"bg-gray-900 border-gray-800 text-gray-200 hover:border-[#4E6E49]/40":"bg-white border-gray-200 text-gray-700 hover:border-[#4E6E49]/40"}`}`,children:[n.jsx(Em,{className:"w-4 h-4"}),"Всё"]}),Object.entries(Ii).map(([_,{label:y}])=>{const M=Sc[_],D=s===_;return n.jsx("button",{onClick:()=>r(_),className:`px-3 py-3 rounded-lg text-sm font-semibold transition-all border-2 flex flex-col items-start gap-2 text-left leading-tight whitespace-normal ${D?l==="dark"?"bg-[#4E6E49]/20 border-[#4E6E49] text-[#4E6E49]":"bg-green-50 border-[#4E6E49] text-[#4E6E49]":`${l==="dark"?"bg-gray-900 border-gray-800 text-gray-200 hover:border-[#4E6E49]/40":"bg-white border-gray-200 text-gray-700 hover:border-[#4E6E49]/40"}`}`,children:n.jsxs("span",{className:"flex items-center gap-2 justify-start",children:[n.jsx(M,{className:"w-4 h-4"}),n.jsx("span",{className:"break-words",children:y})]})},_)})]})]}),n.jsxs("div",{id:"filter-people",className:"space-y-3",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx(qn,{className:"w-4 h-4 text-sky-500"}),n.jsx("label",{className:`block text-sm font-semibold ${c}`,children:"Исполнители"})]}),n.jsxs("div",{className:"flex flex-wrap gap-2",children:[n.jsx("button",{onClick:()=>i([]),className:`px-3 py-2 rounded-lg text-sm font-semibold transition-all border-2 ${t.length===0?l==="dark"?"bg-[#4E6E49]/20 border-[#4E6E49] text-[#4E6E49]":"bg-green-50 border-[#4E6E49] text-[#4E6E49]":`${l==="dark"?"bg-gray-900 border-gray-800 text-gray-200 hover:border-[#4E6E49]/40":"bg-white border-gray-200 text-gray-700 hover:border-[#4E6E49]/40"}`}`,children:"Все"}),Re.map(_=>{const y=t.includes(_.id);return n.jsxs("button",{onClick:()=>{i(y?t.filter(M=>M!==_.id):[...t,_.id])},className:`px-3 py-2 rounded-lg text-sm font-semibold transition-all border-2 flex items-center gap-2 ${y?l==="dark"?"bg-[#4E6E49]/20 border-[#4E6E49] text-[#4E6E49]":"bg-green-50 border-[#4E6E49] text-[#4E6E49]":`${l==="dark"?"bg-gray-900 border-gray-800 text-gray-200 hover:border-[#4E6E49]/40":"bg-white border-gray-200 text-gray-700 hover:border-[#4E6E49]/40"}`}`,children:[n.jsx(Fv,{className:`w-3 h-3 ${y?"text-[#4E6E49]":"text-gray-400"}`}),Tt(_.id)]},_.id)})]})]})]})]})},YC=({tasks:s,onUpdate:e,onEdit:t,onDelete:r})=>{var G,xe;const{theme:a}=lt(),{user:i}=_t(),{isAdmin:o}=Ct(),[l,c]=I.useState(null),[h,u]=I.useState(null),[m,g]=I.useState(null),[p,j]=I.useState(""),[_,y]=I.useState(null),[M,D]=I.useState(null),[T,R]=I.useState(null),[P,C]=I.useState(null),N=a==="dark"?"text-white":"text-gray-900",b=a==="dark"?"bg-[#1a1a1a]":"bg-white",v=a==="dark"?"border-gray-800":"border-gray-300",S=["in_progress","completed","closed"],E=z=>z.assignees&&z.assignees.length>0?z.assignees:z.assignedTo.map(ce=>({userId:ce,priority:"medium"})),k=z=>E(z).map(ce=>ce.userId),w=z=>{if(z.stages&&z.stages.length>0){const ce=z.awaitingStageId||z.currentStageId||z.stages[0].id;return z.stages.find(ke=>ke.id===ce)||z.stages[0]}return{id:"legacy-stage",name:"Этап",responsible:"all",approvals:z.approvals||[],status:"pending",comments:[]}},Q=z=>!!i&&z.createdBy===i.id,ae=z=>!!i&&z.mainExecutor===i.id,V=z=>!!i&&(z.leadExecutor===i.id||(z.leads||[]).includes(i.id)),X=z=>o||Q(z)||ae(z)||V(z),he=(z,ce)=>ce===z.createdBy?"A":ce===z.mainExecutor?"ГИ":ce===z.leadExecutor||(z.leads||[]).includes(ce)?"ВИ":"",B=z=>s.filter(ce=>ce.status===z),te=(z,ce)=>{if(_||!X(ce)){z.preventDefault();return}c(ce),z.dataTransfer.effectAllowed="move",z.dataTransfer.setData("text/plain",ce.id)},ve=z=>{z.preventDefault(),z.dataTransfer.dropEffect="move"},W=()=>{c(null)},F=(z,ce)=>{if(_||!X(ce))return;const ke=z.touches[0];D({x:ke.clientX,y:ke.clientY,task:ce})},re=z=>{if(!M)return;z.preventDefault();const ce=z.touches[0],ke=document.elementFromPoint(ce.clientX,ce.clientY);if(ke){const ue=ke.closest("[data-status]");if(ue){const $e=ue.getAttribute("data-status");$e&&R($e)}}},de=async(z,ce)=>{if(!M)return;const ke=z.changedTouches[0],ue=document.elementFromPoint(ke.clientX,ke.clientY);if(ue){const $e=ue.closest("[data-status]");if($e){const Oe=$e.getAttribute("data-status");Oe&&Oe!==ce&&await L(M.task,Oe)}}D(null),R(null)},$=z=>{const ce=k(z),ke=new Date().toISOString(),$e=(z.approvals||[]).filter(U=>ce.includes(U.userId)).map(U=>({userId:U.userId,status:U.status==="approved"?"approved":"pending",updatedAt:U.updatedAt||ke,...U.comment?{comment:U.comment}:{}})),Oe=ce.filter(U=>!$e.some(_e=>_e.userId===U)).map(U=>({userId:U,status:"pending",updatedAt:ke}));return[...$e,...Oe]},O=z=>{const ce=$(z),ke=k(z).length,ue=ce.filter($e=>$e.status==="approved").length;return{approvals:ce,approved:ue,total:ke}},J=z=>!!i&&k(z).includes(i.id),Y=z=>o||Q(z),Z=async(z,ce)=>{if(z.preventDefault(),z.stopPropagation(),!l||l.status===ce||_||!X(l)){c(null);return}const{approvals:ke,approved:ue,total:$e}=O(l),Oe=new Date().toISOString();if(ce==="completed"&&($e===0||ue<$e)){c(null);return}if(ce==="closed"&&(!Y(l)||l.status!=="completed")){c(null);return}const U={status:ce,updatedAt:Oe};ce==="completed"?(U.completedAt=Oe,U.completedBy=(i==null?void 0:i.id)||"system",U.approvals=ke):ce==="closed"?U.closedAt=Oe:ce==="in_progress"&&(U.approvals=k(l).map(_e=>({userId:_e,status:"pending",updatedAt:Oe})),U.completedAt=void 0,U.completedBy=void 0,U.closedAt=void 0),y(l.id);try{await kr(l.id,U),e()}catch(_e){console.error("Error updating task status:",_e)}finally{y(null),c(null)}},L=async(z,ce)=>{if(z.status===ce||_===z.id||!X(z)){u(null);return}const{approvals:ke,approved:ue,total:$e}=O(z),Oe=new Date().toISOString();if(ce==="completed"&&($e===0||ue<$e)){u(null);return}if(ce==="closed"&&(!Y(z)||z.status!=="completed")){u(null);return}const U={status:ce,updatedAt:Oe};ce==="completed"?(U.completedAt=Oe,U.completedBy=(i==null?void 0:i.id)||"system",U.approvals=ke):ce==="closed"?U.closedAt=Oe:ce==="in_progress"&&(U.approvals=k(z).map(_e=>({userId:_e,status:"pending",updatedAt:Oe})),U.completedAt=void 0,U.completedBy=void 0,U.closedAt=void 0),y(z.id);try{await kr(z.id,U),e(),u(null)}catch(_e){console.error("Error updating task status:",_e)}finally{y(null)}},fe=async z=>{if(!(!i||z.status!=="in_progress"||!J(z))){y(z.id);try{const ce=new Date().toISOString(),ke=$(z).map(U=>U.userId===i.id?{...U,status:"approved",updatedAt:ce}:U),ue=k(z),$e=ue.length>0&&ue.every(U=>ke.find(_e=>_e.userId===U&&_e.status==="approved")),Oe={approvals:ke,updatedAt:ce};$e&&(Oe.status="completed",Oe.completedAt=ce,Oe.completedBy=i.id),await kr(z.id,Oe),e()}catch(ce){console.error("Error confirming task:",ce)}finally{y(null)}}},ge=async z=>{if(!(!Y(z)||z.status!=="completed")){y(z.id);try{const ce=new Date().toISOString();await kr(z.id,{status:"closed",closedAt:ce,updatedAt:ce}),e()}catch(ce){console.error("Error closing task:",ce)}finally{y(null)}}},H=async(z,ce)=>{if(!Y(z))return;const ke=(ce||"").trim();if(ke){y(z.id);try{const ue=new Date().toISOString(),$e=k(z).map(U=>({userId:U,status:"pending",updatedAt:ue})),Oe={id:`c-${Date.now()}`,userId:(i==null?void 0:i.id)||"system",text:ke,createdAt:ue};await kr(z.id,{status:"in_progress",approvals:$e,completedAt:void 0,completedBy:void 0,closedAt:void 0,comments:[...z.comments||[],Oe],updatedAt:ue}),e(),g(null),j("")}catch(ue){console.error("Error returning task to work:",ue)}finally{y(null)}}},se=z=>({in_progress:a==="dark"?"bg-blue-500/20 border-blue-500/50":"bg-blue-50 border-blue-200",completed:a==="dark"?"bg-[#4E6E49]/20 border-[#4E6E49]/50":"bg-green-50 border-green-200",closed:a==="dark"?"bg-gray-500/20 border-gray-500/50":"bg-gray-50 border-gray-200"})[z],je=z=>({in_progress:a==="dark"?"text-blue-400":"text-blue-700",completed:"text-[#4E6E49]",closed:a==="dark"?"text-gray-400":"text-gray-700"})[z],Se=z=>{const ce=new Date;return new Date(`${z.dueDate}T${z.dueTime}`)<ce&&z.status!=="completed"&&z.status!=="closed"};return n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"overflow-x-auto pb-4 -mx-4 px-4",children:n.jsx("div",{className:"flex gap-3 sm:gap-4 min-w-max",children:S.map(z=>{const ce=B(z),ke=Mn[z];return n.jsxs("div",{"data-status":z,className:`flex-shrink-0 w-[280px] sm:w-80 ${b} rounded-xl border-2 ${v} p-3 sm:p-4 ${T===z?"border-[#4E6E49]":""}`,onDragOver:ve,onDrop:ue=>Z(ue,z),onTouchMove:re,children:[n.jsx("div",{className:`mb-3 sm:mb-4 pb-2 sm:pb-3 border-b ${v}`,children:n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsx("h3",{className:`text-base sm:text-lg font-bold ${je(z)}`,children:ke.label}),n.jsx("span",{className:`px-2 py-1 rounded-lg text-xs sm:text-sm font-medium ${se(z)} ${je(z)}`,children:ce.length})]})}),n.jsxs("div",{className:"space-y-2 sm:space-y-3 max-h-[calc(100vh-280px)] sm:max-h-[calc(100vh-300px)] overflow-y-auto",children:[ce.map(ue=>{var mt,qe,et;const $e=Se(ue),Oe=o||(i==null?void 0:i.id)===ue.createdBy||ue.mainExecutor===(i==null?void 0:i.id),U=w(ue),Pe=E(ue).map(Te=>{const Ve=Re.find(wt=>wt.id===Te.userId);return Ve?{...Te,member:Ve}:null}).filter(Boolean),{approvals:K,approved:q,total:Ce}=O(ue),Le=K.find(Te=>Te.userId===(i==null?void 0:i.id)),Ue=J(ue)&&ue.status==="in_progress"&&(!Le||Le.status!=="approved"),ye=Y(ue)&&ue.status==="completed";return n.jsxs("div",{draggable:!_&&X(ue),onDragStart:Te=>te(Te,ue),onDragEnd:W,onTouchStart:Te=>F(Te,ue),onTouchEnd:Te=>de(Te,z),className:`${b} rounded-lg border-2 ${v} p-2.5 sm:p-3 cursor-move hover:shadow-lg transition-all ${(l==null?void 0:l.id)===ue.id||(M==null?void 0:M.task.id)===ue.id?"opacity-50":""} ${$e?"border-red-500":""} ${_===ue.id?"opacity-50 pointer-events-none":""}`,children:[n.jsxs("div",{className:"flex items-start justify-between gap-2 mb-2",children:[n.jsx("h4",{className:`font-semibold text-xs sm:text-sm ${N} flex-1`,children:ue.title}),n.jsx("div",{className:"flex items-center gap-1 flex-shrink-0",children:n.jsxs("div",{className:"relative lg:hidden",children:[n.jsx("button",{onClick:()=>u((h==null?void 0:h.id)===ue.id?null:ue),className:`p-1 rounded ${a==="dark"?"hover:bg-gray-700":"hover:bg-gray-100"}`,children:n.jsx(tw,{className:"w-4 h-4"})}),(h==null?void 0:h.id)===ue.id&&n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"fixed inset-0 z-40",onClick:()=>u(null)}),n.jsx("div",{className:`absolute right-0 top-8 z-50 ${b} rounded-lg shadow-xl border-2 ${v} min-w-[200px]`,children:n.jsxs("div",{className:"p-2",children:[n.jsx("div",{className:`text-xs font-medium mb-2 px-2 py-1 ${a==="dark"?"text-gray-400":"text-gray-600"}`,children:"Изменить статус:"}),S.map(Te=>n.jsx("button",{onClick:()=>L(ue,Te),disabled:ue.status===Te||_===ue.id||!X(ue),className:`w-full text-left px-3 py-2 rounded-lg text-sm transition-colors mb-1 ${ue.status===Te?se(Te):a==="dark"?"hover:bg-gray-700":"hover:bg-gray-100"} ${ue.status===Te?je(Te):N} disabled:opacity-50`,children:Mn[Te].label},Te)),Oe&&n.jsxs(n.Fragment,{children:[n.jsx("div",{className:`border-t ${v} my-2`}),n.jsx("button",{onClick:()=>{u(null),t(ue)},className:`w-full text-left px-3 py-2 rounded-lg text-sm transition-colors mb-1 ${a==="dark"?"hover:bg-gray-700":"hover:bg-gray-100"} ${N}`,children:"Редактировать"}),n.jsx("button",{onClick:()=>{u(null),C(ue)},className:`w-full text-left px-3 py-2 rounded-lg text-sm transition-colors mb-1 ${a==="dark"?"hover:bg-gray-700":"hover:bg-gray-100"} ${N}`,children:"Всё о задаче"}),n.jsx("button",{onClick:()=>{u(null),r(ue.id)},className:`w-full text-left px-3 py-2 rounded-lg text-sm transition-colors ${a==="dark"?"hover:bg-red-500/20 text-red-400":"hover:bg-red-50 text-red-600"}`,children:"Удалить"})]})]})})]})]})})]}),n.jsxs("div",{className:"space-y-1.5 text-xs mb-2",children:[n.jsxs("div",{className:"space-y-1",children:[n.jsxs("div",{className:`flex items-center gap-1 ${a==="dark"?"text-blue-400":"text-blue-600"}`,children:[n.jsx("span",{className:"font-medium",children:"Автор:"}),n.jsx("span",{className:a==="dark"?"text-gray-400":"text-gray-600",children:((mt=Re.find(Te=>Te.id===ue.createdBy))==null?void 0:mt.name)||"Неизвестно"})]}),n.jsxs("div",{className:"flex flex-col gap-1",children:[n.jsx("div",{className:"flex items-center gap-1 text-[#4E6E49]",children:n.jsx("span",{className:"font-medium",children:"Исполнители:"})}),Pe.length>0?Pe.map(Te=>n.jsx("div",{className:`text-[11px] sm:text-xs ${a==="dark"?"text-gray-300":"text-gray-700"} flex flex-wrap gap-1`,children:n.jsx("span",{className:"font-medium",children:Tt(Te.member.id)})},Te.member.id)):n.jsx("span",{className:"text-gray-500",children:"Не назначены"})]})]}),n.jsxs("div",{className:`flex items-center gap-2 flex-wrap ${a==="dark"?"text-gray-400":"text-gray-600"}`,children:[n.jsxs("span",{className:"inline-flex items-center gap-1",children:[n.jsx(ul,{className:"w-3.5 h-3.5"}),oe(new Date(ue.dueDate),"dd.MM.yyyy")]}),n.jsxs("span",{className:"inline-flex items-center gap-1",children:[n.jsx(on,{className:"w-3.5 h-3.5"}),ue.dueTime]}),n.jsx(yy,{dueDate:ue.dueDate,dueTime:ue.dueTime,theme:a,size:"compact"})]}),n.jsx("div",{className:"flex items-center gap-1 text-[11px]",children:n.jsx("span",{className:`px-2 py-0.5 rounded-full border ${a==="dark"?"border-yellow-500/40 text-yellow-200 bg-yellow-500/10":"border-yellow-200 text-yellow-700 bg-yellow-50"}`,children:ue.priority==="urgent"?"Экстренный приоритет":ue.priority==="high"?"Высокий приоритет":ue.priority==="medium"?"Средний приоритет":"Низкий приоритет"})}),Ce>0&&n.jsxs("div",{className:`flex items-center justify-between gap-2 ${a==="dark"?"text-yellow-300":"text-yellow-700"}`,children:[n.jsxs("span",{className:"inline-flex items-center gap-1",children:[n.jsx(Kl,{className:"w-3 h-3"}),"Подтверждения исполнителей"]}),n.jsxs("span",{className:"text-[11px] font-semibold",children:[q,"/",Ce]})]}),ue.description&&n.jsx("p",{className:`line-clamp-2 ${a==="dark"?"text-gray-300":"text-gray-600"}`,children:ue.description}),K.length>0&&n.jsx("div",{className:`mt-1 space-y-1 ${a==="dark"?"text-gray-300":"text-gray-700"}`,children:K.map(Te=>{const Ve=Re.find(ct=>ct.id===Te.userId),wt=Te.status==="approved"?"подтвердил":"в ожидании";return n.jsxs("div",{className:"flex items-center justify-between text-[11px]",children:[n.jsxs("span",{className:"flex items-center gap-1",children:[n.jsxs("span",{className:"font-medium",children:[(Ve==null?void 0:Ve.name)||Te.userId,he(ue,Te.userId)&&n.jsx("span",{className:"ml-1 text-[10px] px-1 rounded bg-gray-200 dark:bg-gray-800",children:he(ue,Te.userId)})]}),n.jsxs("span",{className:"text-gray-500",children:["(",wt,")"]})]}),Te.comment&&n.jsx("span",{className:"truncate max-w-[140px] text-gray-500",children:Te.comment})]},Te.userId)})}),(((qe=ue.comments)==null?void 0:qe.length)||((et=U.comments)==null?void 0:et.length))&&n.jsx("div",{className:"mt-2 space-y-1",children:[...ue.comments||[],...U.comments||[]].map(Te=>{const Ve=Re.find(wt=>wt.id===Te.userId);return n.jsxs("div",{className:`text-[11px] ${a==="dark"?"text-gray-300":"text-gray-700"}`,children:[n.jsx("span",{className:"font-semibold",children:(Ve==null?void 0:Ve.name)||Te.userId})," ",n.jsx("span",{className:"text-gray-500",children:Te.stageId?"(этап)":"(задача)"}),": ",Te.text]},Te.id)})}),n.jsx("div",{className:"flex items-center gap-2 flex-wrap",children:n.jsx("span",{className:`px-1.5 py-0.5 rounded text-xs inline-flex items-center gap-1 ${se(z)} ${je(z)}`,children:(()=>{const Te=Sc[ue.category];return n.jsx(Te,{className:"w-3.5 h-3.5"})})()})})]}),n.jsx("div",{className:"flex justify-end mt-1",children:n.jsx("button",{onClick:()=>C(ue),className:`text-[11px] underline ${a==="dark"?"text-gray-300":"text-gray-600"} hover:text-[#4E6E49]`,children:"Всё о задаче"})}),n.jsxs("div",{className:`flex flex-col gap-2 mt-2 pt-2 border-t ${v}`,children:[Ue&&n.jsxs("button",{onClick:()=>fe(ue),disabled:_===ue.id,className:"w-full px-2 py-1.5 bg-[#4E6E49] hover:bg-emerald-700 text-white rounded-lg text-xs font-medium transition-colors flex items-center justify-center gap-1 disabled:opacity-50",children:[n.jsx(Ls,{className:"w-3 h-3"}),"Подтвердить"]}),ye&&n.jsxs("div",{className:"flex gap-2",children:[n.jsxs("button",{onClick:()=>ge(ue),disabled:_===ue.id,className:"flex-1 px-2 py-1.5 bg-blue-600 hover:bg-blue-700 text-white rounded-lg text-xs font-medium transition-colors flex items-center justify-center gap-1 disabled:opacity-50",children:[n.jsx(Ls,{className:"w-3 h-3"}),"Закрыто"]}),n.jsxs("button",{onClick:()=>{g({task:ue}),j("")},disabled:_===ue.id,className:"flex-1 px-2 py-1.5 bg-red-500 hover:bg-red-600 text-white rounded-lg text-xs font-medium transition-colors flex items-center justify-center gap-1 disabled:opacity-50",children:[n.jsx(Ft,{className:"w-3 h-3"}),"Не выполнено"]})]}),ue.status==="completed"&&!ye&&n.jsx("p",{className:`text-[11px] ${a==="dark"?"text-gray-400":"text-gray-500"}`,children:"Ожидает подтверждения автора"})]})]},ue.id)}),ce.length===0&&n.jsxs("div",{className:`text-center py-6 sm:py-8 ${a==="dark"?"text-gray-500":"text-gray-400"}`,children:[n.jsx(Sr,{className:"w-6 h-6 sm:w-8 sm:h-8 mx-auto mb-2 opacity-50"}),n.jsx("p",{className:"text-xs sm:text-sm",children:"Нет задач"})]})]})]},z)})})}),m&&n.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-start sm:items-center justify-center z-[70] p-4 overflow-y-auto overscroll-contain modal-scroll",children:n.jsxs("div",{className:`${b} rounded-xl p-6 max-w-md w-full border-2 ${v}`,children:[n.jsx("h3",{className:`text-lg font-bold mb-4 ${N}`,children:"Не выполнено"}),n.jsx("textarea",{value:p,onChange:z=>j(z.target.value),placeholder:"Опишите, что нужно доработать",rows:3,className:`w-full px-4 py-2 rounded-lg border ${v} ${a==="dark"?"bg-gray-700":"bg-gray-50"} ${N} mb-4 focus:outline-none focus:ring-2 focus:ring-[#4E6E49]/50`}),n.jsxs("div",{className:"flex gap-3",children:[n.jsx("button",{onClick:()=>m.task&&H(m.task,p),disabled:_===m.task.id||!p.trim(),className:"flex-1 px-4 py-2 rounded-lg font-medium transition-colors bg-red-500 hover:bg-red-600 text-white disabled:opacity-50",children:"Отправить на доработку"}),n.jsx("button",{onClick:()=>{g(null),j("")},className:`px-4 py-2 rounded-lg font-medium transition-colors ${a==="dark"?"bg-gray-700 hover:bg-gray-600":"bg-gray-200 hover:bg-gray-300"}`,children:"Отмена"})]})]})}),P&&n.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-start sm:items-center justify-center z-[70] p-4 overflow-y-auto overscroll-contain modal-scroll",children:n.jsxs("div",{className:`${b} rounded-xl p-6 max-w-2xl w-full border-2 ${v}`,children:[n.jsxs("div",{className:"flex items-center justify-between mb-4",children:[n.jsx("h3",{className:`text-lg font-bold ${N}`,children:"Всё о задаче"}),n.jsx("button",{onClick:()=>C(null),className:`p-2 rounded-lg ${a==="dark"?"hover:bg-gray-700":"hover:bg-gray-100"}`,children:n.jsx(Ft,{className:"w-4 h-4"})})]}),n.jsxs("div",{className:"space-y-4 text-sm",children:[n.jsxs("div",{children:[n.jsx("p",{className:"text-xs text-gray-500",children:"Название"}),n.jsx("p",{className:`font-semibold ${N}`,children:P.title})]}),P.description&&n.jsxs("div",{children:[n.jsx("p",{className:"text-xs text-gray-500",children:"Описание"}),n.jsx("p",{className:a==="dark"?"text-gray-300":"text-gray-700",children:P.description})]}),P.expectedResult&&n.jsxs("div",{children:[n.jsx("p",{className:"text-xs text-gray-500",children:"Ожидаемый результат"}),n.jsx("p",{className:a==="dark"?"text-gray-300":"text-gray-700",children:P.expectedResult})]}),n.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[n.jsxs("div",{children:[n.jsx("p",{className:"text-xs text-gray-500",children:"Автор"}),n.jsx("p",{className:N,children:((G=Re.find(z=>z.id===P.createdBy))==null?void 0:G.name)||P.createdBy})]}),n.jsxs("div",{children:[n.jsx("p",{className:"text-xs text-gray-500",children:"Категория"}),n.jsx("p",{className:N,children:((xe=Ii[P.category])==null?void 0:xe.label)||P.category})]}),n.jsxs("div",{children:[n.jsx("p",{className:"text-xs text-gray-500",children:"Приоритет"}),n.jsx("p",{className:N,children:P.priority==="urgent"?"Экстренный":P.priority==="high"?"Высокий":P.priority==="medium"?"Средний":"Низкий"})]}),n.jsxs("div",{children:[n.jsx("p",{className:"text-xs text-gray-500",children:"Дедлайн"}),n.jsxs("p",{className:N,children:[oe(new Date(P.dueDate),"dd.MM.yyyy")," · ",P.dueTime]})]})]}),n.jsxs("div",{children:[n.jsx("p",{className:"text-xs text-gray-500",children:"Статус"}),n.jsx("p",{className:`${N} font-semibold`,children:Mn[P.status].label})]}),P.stages&&P.stages.length>0&&n.jsxs("div",{className:"space-y-2",children:[n.jsx("p",{className:"text-xs text-gray-500",children:"Этапы"}),P.stages.map(z=>{var ce,ke;return n.jsxs("div",{className:`p-3 rounded border ${v} space-y-2`,children:[n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsx("p",{className:`font-semibold ${N}`,children:z.name}),n.jsxs("p",{className:"text-xs text-gray-500",children:[((ce=z.approvals)==null?void 0:ce.filter(ue=>ue.status==="approved").length)||0,"/",((ke=z.approvals)==null?void 0:ke.length)||0," подтверждений"]})]}),z.assignees&&z.assignees.length>0&&n.jsx("div",{className:"space-y-1 text-xs",children:z.assignees.map(ue=>{const $e=Re.find(Oe=>Oe.id===ue.userId);return n.jsx("div",{className:"flex items-start justify-between gap-2",children:n.jsx("span",{className:"font-medium",children:($e==null?void 0:$e.name)||ue.userId})},ue.userId)})})]},z.id)})]})]})]})})]})},QC=()=>{var J;const{theme:s}=lt(),{user:e}=_t(),[t,r]=I.useState(!1),[a,i]=I.useState(null),[o,l]=I.useState([]),[c,h]=I.useState(!0),[u,m]=I.useState("all"),[g,p]=I.useState("all"),[j,_]=I.useState([]),[y,M]=I.useState("kanban"),D=s==="dark"?"text-white":"text-gray-900",T=s==="dark"?"bg-[#1a1a1a]":"bg-white";I.useEffect(()=>{R()},[e]),I.useEffect(()=>{R()},[u,g,j]);const R=async()=>{h(!0);try{const Y={};u!=="all"&&(Y.category=u),g!=="all"&&(Y.status=g),j.length>0&&(Y.assignedTo=j);const Z=await bu(Y);l(Z)}catch(Y){console.error("Error loading tasks:",Y)}finally{h(!1)}},P=Y=>{i(Y),r(!0)},C=async Y=>{if(confirm("Вы уверены, что хотите удалить эту задачу?"))try{await Ib(Y),R()}catch(Z){console.error("Error deleting task:",Z)}},N=()=>{r(!1),i(null)},b=()=>{r(!1),i(null),R()},v=()=>{m("all"),p("all"),_([])},S=o.filter(Y=>!(u!=="all"&&Y.category!==u||g!=="all"&&Y.status!==g||j.length>0&&!j.some(Z=>Y.assignedTo.includes(Z)))),E={inProgress:o.filter(Y=>Y.status==="in_progress").length,completed:o.filter(Y=>Y.status==="completed").length,closed:o.filter(Y=>Y.status==="closed").length},k=new Date,w=oe(k,"yyyy-MM-dd"),Q=new Date(k);Q.setDate(k.getDate()-7);const ae=new Date(k);ae.setDate(k.getDate()-30);const V=o.filter(Y=>new Date(Y.createdAt)>=Q).length,X=o.filter(Y=>new Date(Y.createdAt)>=ae).length,he=o.filter(Y=>Y.completedAt&&Y.completedAt.startsWith(w)).length,B=e?o.filter(Y=>Y.mainExecutor===e.id||Y.leadExecutor===e.id||(Y.assignedTo||[]).includes(e.id)||(Y.coExecutors||[]).includes(e.id)):[],te=B.length,ve=o.length,W=ve?Math.round(E.inProgress/ve*100):0,F=(()=>{var L;const Y={};return o.forEach(fe=>{[fe.mainExecutor,fe.leadExecutor,...fe.assignedTo||[],...fe.coExecutors||[]].filter(Boolean).forEach(H=>{Y[H]=(Y[H]||0)+1})}),((L=Object.entries(Y).sort((fe,ge)=>ge[1]-fe[1])[0])==null?void 0:L[0])||""})(),re=F?((J=Re.find(Y=>Y.id===F))==null?void 0:J.name)||F:"—",de=o.filter(Y=>Y.status!=="completed"&&Y.status!=="closed").sort((Y,Z)=>new Date(`${Y.dueDate}T${Y.dueTime}`).getTime()-new Date(`${Z.dueDate}T${Z.dueTime}`).getTime())[0],$=[{label:"Всего задач на неделе",value:V,sub:"последние 7 дней",tone:"sky"},{label:"Всего задач на месяце",value:X,sub:"последние 30 дней",tone:"emerald"},{label:"Задач в работе",value:E.inProgress,sub:`${W}% от всех`,tone:"blue"},{label:"Отмечено исполнителями",value:E.completed,sub:"ожидают проверки автора",tone:"amber"},{label:"Самый активный исполнитель",value:re,sub:"по числу назначений",tone:"purple"},{label:"Закрыто автором",value:E.closed,sub:"финально подтверждено",tone:"slate"},{label:"Ближайший дедлайн",value:de?de.title:"Нет активных",sub:de?`${oe(new Date(de.dueDate),"dd.MM.yyyy")} · ${de.dueTime}`:"Свободное окно",tone:"pink"},{label:"Сделано задач за сегодня",value:he,sub:w,tone:"green"}],O=[{href:"#tasks-board",label:"Все задачи"},{href:"#my-tasks",label:"Мои задачи",action:()=>e&&_([e.id])},{href:"#tasks-stats",label:"Статистика"}];return n.jsxs("div",{className:"space-y-6",children:[n.jsxs("div",{className:`rounded-xl sm:rounded-2xl p-4 sm:p-6 md:p-8 ${T} shadow-xl border-2 ${s==="dark"?"border-[#4E6E49]/30 bg-gradient-to-br from-[#1a1a1a] via-[#1a1a1a] to-[#0A0A0A]":"border-green-200 bg-gradient-to-br from-white via-green-50/30 to-white"} relative overflow-hidden`,children:[n.jsx("div",{className:"absolute top-0 right-0 w-32 h-32 sm:w-64 sm:h-64 bg-gradient-to-br from-[#4E6E49]/10 to-emerald-700/10 rounded-full blur-3xl -mr-16 sm:-mr-32 -mt-16 sm:-mt-32"}),n.jsx("div",{className:"absolute bottom-0 left-0 w-24 h-24 sm:w-48 sm:h-48 bg-gradient-to-tr from-yellow-500/10 to-orange-500/10 rounded-full blur-2xl -ml-12 sm:-ml-24 -mb-12 sm:-mb-24"}),n.jsxs("div",{className:"relative z-10",children:[n.jsx("div",{className:"flex flex-col gap-4 sm:gap-6 lg:flex-row lg:items-start lg:justify-between mb-4 sm:mb-6",children:n.jsxs("div",{className:"flex-1",children:[n.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 mb-2",children:[n.jsx(Sr,{className:"w-6 h-6 sm:w-8 sm:h-8 text-[#4E6E49]"}),n.jsxs("h1",{className:`text-2xl sm:text-3xl md:text-4xl font-extrabold ${D} flex items-center gap-2`,children:["Task Team",n.jsx(xs,{className:`w-5 h-5 sm:w-6 sm:h-6 ${s==="dark"?"text-yellow-400":"text-yellow-600"}`})]})]}),n.jsx("p",{className:`text-sm sm:text-base ${s==="dark"?"text-gray-300":"text-gray-600"}`,children:"Управление задачами и заданиями команды"}),n.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:O.map(Y=>n.jsx("a",{href:Y.href,onClick:()=>{var Z;return(Z=Y.action)==null?void 0:Z.call(Y)},className:`px-3 py-1.5 rounded-lg text-xs font-semibold border transition ${s==="dark"?"border-white/10 bg-white/5 text-white hover:border-[#4E6E49]/50":"border-gray-200 bg-white text-gray-800 hover:border-[#4E6E49]/50 hover:text-[#4E6E49]"}`,children:Y.label},Y.href))})]})}),n.jsx("div",{id:"tasks-stats",className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3 sm:gap-4",children:$.map(Y=>{const L={emerald:{bg:s==="dark"?"bg-emerald-500/10":"bg-emerald-50",text:s==="dark"?"text-emerald-100":"text-emerald-800",border:s==="dark"?"border-emerald-500/30":"border-emerald-200"},sky:{bg:s==="dark"?"bg-sky-500/10":"bg-sky-50",text:s==="dark"?"text-sky-100":"text-sky-800",border:s==="dark"?"border-sky-500/30":"border-sky-200"},amber:{bg:s==="dark"?"bg-amber-500/10":"bg-amber-50",text:s==="dark"?"text-amber-100":"text-amber-800",border:s==="dark"?"border-amber-500/30":"border-amber-200"},blue:{bg:s==="dark"?"bg-blue-500/10":"bg-blue-50",text:s==="dark"?"text-blue-100":"text-blue-800",border:s==="dark"?"border-blue-500/30":"border-blue-200"},purple:{bg:s==="dark"?"bg-purple-500/10":"bg-purple-50",text:s==="dark"?"text-purple-100":"text-purple-800",border:s==="dark"?"border-purple-500/30":"border-purple-200"},slate:{bg:s==="dark"?"bg-gray-500/10":"bg-gray-50",text:s==="dark"?"text-gray-100":"text-gray-800",border:s==="dark"?"border-gray-500/30":"border-gray-200"},pink:{bg:s==="dark"?"bg-pink-500/10":"bg-pink-50",text:s==="dark"?"text-pink-100":"text-pink-800",border:s==="dark"?"border-pink-500/30":"border-pink-200"},green:{bg:s==="dark"?"bg-green-500/10":"bg-green-50",text:s==="dark"?"text-green-100":"text-green-800",border:s==="dark"?"border-green-500/30":"border-green-200"}}[Y.tone];return n.jsxs("div",{className:`p-4 rounded-xl border ${L.border} ${L.bg} shadow-sm space-y-1`,children:[n.jsx("p",{className:`text-xs font-semibold uppercase ${L.text}`,children:Y.label}),n.jsx("p",{className:`text-2xl font-extrabold ${D} truncate`,children:Y.value}),n.jsx("p",{className:`text-xs ${s==="dark"?"text-gray-400":"text-gray-600"}`,children:Y.sub})]},Y.label)})})]})]}),e&&n.jsxs("div",{id:"my-tasks",className:`rounded-xl sm:rounded-2xl p-4 sm:p-6 ${T} border-2 ${s==="dark"?"border-white/10":"border-gray-200"}`,children:[n.jsxs("div",{className:"flex items-center justify-between gap-3 mb-3",children:[n.jsxs("div",{children:[n.jsx("p",{className:`text-xs uppercase font-semibold ${s==="dark"?"text-gray-400":"text-gray-500"}`,children:"Мои задачи"}),n.jsx("p",{className:`text-xl font-bold ${D}`,children:te})]}),n.jsx("a",{href:"#tasks-board",className:`px-3 py-2 rounded-lg text-xs font-semibold border ${s==="dark"?"border-white/10 bg-white/5 text-white hover:border-[#4E6E49]/50":"border-gray-200 bg-white text-gray-800 hover:border-[#4E6E49]/50 hover:text-[#4E6E49]"}`,children:"Перейти на доску"})]}),B.length===0?n.jsx("p",{className:s==="dark"?"text-gray-400":"text-gray-600",children:"Нет назначенных задач"}):n.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:B.slice(0,4).map(Y=>n.jsxs("div",{className:`p-3 rounded-lg border ${s==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white"}`,children:[n.jsx("p",{className:`text-sm font-semibold ${D} truncate`,children:Y.title}),n.jsxs("p",{className:`text-xs ${s==="dark"?"text-gray-400":"text-gray-600"}`,children:[oe(new Date(Y.dueDate),"dd.MM.yyyy")," · ",Y.dueTime]}),n.jsx("p",{className:"text-xs mt-1",children:n.jsx("span",{className:`px-2 py-0.5 rounded-full ${s==="dark"?"bg-gray-800 text-gray-200":"bg-gray-100 text-gray-700"}`,children:Mn[Y.status].label})})]},Y.id))})]}),n.jsxs("div",{className:"flex flex-col lg:flex-row gap-4 sm:gap-6",id:"tasks-board",children:[n.jsx("div",{className:"lg:w-80 flex-shrink-0",children:n.jsx(KC,{selectedCategory:u,selectedStatus:g,selectedUsers:j,onCategoryChange:m,onStatusChange:p,onUsersChange:_,onClear:v})}),n.jsxs("div",{className:"flex-1",children:[n.jsxs("div",{className:"flex items-center justify-between mb-4 gap-3",children:[n.jsxs("h2",{className:`text-xl font-bold ${D}`,children:["Задачи (",S.length,")"]}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsxs("div",{className:`flex rounded-lg border-2 ${s==="dark"?"border-gray-800":"border-gray-300"} overflow-hidden`,children:[n.jsx("button",{onClick:()=>M("kanban"),className:`px-3 py-2 transition-colors ${y==="kanban"?"bg-[#4E6E49] text-white":s==="dark"?"bg-[#1a1a1a] text-gray-300 hover:bg-gray-700":"bg-white text-gray-700 hover:bg-gray-50"}`,title:"Kanban доска",children:n.jsx(Xv,{className:"w-4 h-4"})}),n.jsx("button",{onClick:()=>M("list"),className:`px-3 py-2 transition-colors ${y==="list"?"bg-[#4E6E49] text-white":s==="dark"?"bg-[#1a1a1a] text-gray-300 hover:bg-gray-700":"bg-white text-gray-700 hover:bg-gray-50"}`,title:"Список",children:n.jsx(Jv,{className:"w-4 h-4"})})]}),n.jsxs("button",{onClick:()=>r(!0),className:"px-4 py-2 bg-gradient-to-r from-[#4E6E49] to-emerald-700 hover:from-[#4E6E49] hover:to-emerald-700 text-white rounded-lg font-semibold transition-all shadow-lg hover:shadow-xl transform hover:scale-105 flex items-center gap-2",children:[n.jsx(Cr,{className:"w-5 h-5"}),n.jsx("span",{className:"hidden sm:inline",children:"Новая задача"}),n.jsx("span",{className:"sm:hidden",children:"Добавить"})]})]})]}),c?n.jsx("div",{className:`${T} rounded-xl p-8 text-center ${D}`,children:n.jsx("div",{className:"animate-pulse",children:"Загрузка..."})}):S.length===0?n.jsxs("div",{className:`${T} rounded-xl p-8 text-center border-2 ${s==="dark"?"border-gray-800":"border-gray-300"}`,children:[n.jsx(Sr,{className:`w-12 h-12 mx-auto mb-4 ${s==="dark"?"text-gray-600":"text-gray-400"}`}),n.jsx("p",{className:`text-lg font-medium ${D} mb-2`,children:"Нет задач"}),n.jsx("p",{className:`text-sm ${s==="dark"?"text-gray-400":"text-gray-600"}`,children:u!=="all"||g!=="all"||j.length>0?"Попробуйте изменить фильтры":"Создайте первую задачу"})]}):y==="kanban"?n.jsx(YC,{tasks:S,onUpdate:R,onEdit:P,onDelete:C}):n.jsx("div",{className:"grid grid-cols-1 gap-4 sm:gap-6",children:S.map(Y=>n.jsx(GC,{task:Y,onEdit:P,onDelete:C,onUpdate:R},Y.id))})]})]}),t&&n.jsx(BC,{onClose:N,onSave:b,editingTask:a})]})},XC=()=>{const{theme:s}=lt(),{isAdmin:e}=Ct(),t=s==="dark"?"text-white":"text-gray-900",r=s==="dark"?"text-gray-300":"text-gray-700",a=s==="dark"?"bg-[#1a1a1a]":"bg-white";return e?n.jsxs("div",{className:"space-y-6",children:[n.jsxs("div",{className:`rounded-2xl p-6 ${a} shadow-lg border-2 ${s==="dark"?"border-purple-500/30 bg-gradient-to-br from-[#1a1a1a] to-[#1a1a1a]/90":"border-purple-200 bg-gradient-to-br from-white to-purple-50/30"}`,children:[n.jsxs("div",{className:"flex items-start gap-4 mb-6",children:[n.jsx("div",{className:`p-3 rounded-xl ${s==="dark"?"bg-purple-500/20":"bg-purple-100"}`,children:n.jsx(Ot,{className:`w-8 h-8 ${s==="dark"?"text-purple-400":"text-purple-600"}`})}),n.jsxs("div",{className:"flex-1",children:[n.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[n.jsx("h1",{className:`text-3xl font-bold bg-gradient-to-r ${s==="dark"?"from-purple-400 to-pink-400 text-transparent bg-clip-text":"from-purple-600 to-pink-600 text-transparent bg-clip-text"}`,children:"Панель администратора"}),n.jsx(xs,{className:`w-5 h-5 ${s==="dark"?"text-yellow-400":"text-yellow-500"} animate-pulse`})]}),n.jsxs("p",{className:`${r} text-sm flex items-center gap-2`,children:[n.jsx(Ci,{className:"w-4 h-4"}),"Управление системой и командой ApeVault"]})]})]}),n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-6",children:[n.jsxs("div",{className:`p-4 rounded-xl border-2 ${s==="dark"?"bg-blue-500/10 border-blue-500/30":"bg-blue-50 border-blue-200"}`,children:[n.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[n.jsx("div",{className:`p-2 rounded-lg ${s==="dark"?"bg-blue-500/20":"bg-blue-100"}`,children:n.jsx(Ot,{className:`w-5 h-5 ${s==="dark"?"text-blue-400":"text-blue-600"}`})}),n.jsx("h3",{className:`font-semibold ${t}`,children:"Доступ к функциям"})]}),n.jsx("p",{className:`text-sm ${r}`,children:"В режиме администратора вы можете управлять слотами, статусами и заработком всех участников команды"})]}),n.jsxs("div",{className:"p-4 rounded-xl border-2 bg-[#4E6E49]/10 border-[#4E6E49]/30",children:[n.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[n.jsx("div",{className:`p-2 rounded-lg ${s==="dark"?"bg-[#4E6E49]/20":"bg-green-100"}`,children:n.jsx(Yv,{className:"w-5 h-5 text-[#4E6E49]"})}),n.jsx("h3",{className:`font-semibold ${t}`,children:"Безопасность"})]}),n.jsx("p",{className:`text-sm ${r}`,children:"Режим администратора требует ввода пароля. Не делитесь паролем с другими участниками"})]})]}),n.jsx("div",{className:`pt-4 border-t ${s==="dark"?"border-gray-800":"border-gray-200"}`,children:n.jsxs("div",{className:`flex items-center gap-3 p-4 rounded-xl ${s==="dark"?"bg-[#4E6E49]/20 border-2 border-[#4E6E49]/50":"bg-green-50 border-2 border-green-200"}`,children:[n.jsx("div",{className:`p-2 rounded-lg ${s==="dark"?"bg-[#4E6E49]/30":"bg-green-100"}`,children:n.jsx(Ot,{className:"w-6 h-6 text-[#4E6E49]"})}),n.jsxs("div",{children:[n.jsx("h3",{className:`font-semibold mb-1 ${t}`,children:"Режим администратора активен"}),n.jsx("p",{className:`text-sm ${r}`,children:"Вы вошли в систему как администратор. Все административные функции доступны."})]})]})})]}),n.jsxs("div",{className:`rounded-2xl p-6 ${a} shadow-lg border-2 ${s==="dark"?"border-gray-800":"border-gray-200"}`,children:[n.jsx("h2",{className:`text-xl font-semibold mb-4 ${t}`,children:"Возможности администратора"}),n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[n.jsxs("div",{className:`p-4 rounded-xl border ${s==="dark"?"border-gray-800 bg-gray-700/30":"border-gray-200 bg-gray-50"}`,children:[n.jsx("h3",{className:`font-semibold mb-2 ${t}`,children:"📅 Управление слотами"}),n.jsxs("ul",{className:`text-sm space-y-1 ${r} list-disc list-inside`,children:[n.jsx("li",{children:"Создание слотов для любого участника"}),n.jsx("li",{children:"Массовое создание слотов"}),n.jsx("li",{children:"Удаление слотов любого участника"}),n.jsx("li",{children:"Массовое удаление слотов"})]})]}),n.jsxs("div",{className:`p-4 rounded-xl border ${s==="dark"?"border-gray-800 bg-gray-700/30":"border-gray-200 bg-gray-50"}`,children:[n.jsx("h3",{className:`font-semibold mb-2 ${t}`,children:"📋 Управление статусами"}),n.jsxs("ul",{className:`text-sm space-y-1 ${r} list-disc list-inside`,children:[n.jsx("li",{children:"Установка выходных, больничных и отпуск"}),n.jsx("li",{children:"Массовое управление статусами"}),n.jsx("li",{children:"Удаление статусов любого участника"})]})]}),n.jsxs("div",{className:`p-4 rounded-xl border ${s==="dark"?"border-gray-800 bg-gray-700/30":"border-gray-200 bg-gray-50"}`,children:[n.jsx("h3",{className:`font-semibold mb-2 ${t}`,children:"💰 Управление заработком"}),n.jsxs("ul",{className:`text-sm space-y-1 ${r} list-disc list-inside`,children:[n.jsx("li",{children:"Добавление заработка за любую дату"}),n.jsx("li",{children:"Редактирование записей о заработке"}),n.jsx("li",{children:"Удаление записей о заработке"})]})]}),n.jsxs("div",{className:`p-4 rounded-xl border ${s==="dark"?"border-gray-800 bg-gray-700/30":"border-gray-200 bg-gray-50"}`,children:[n.jsx("h3",{className:`font-semibold mb-2 ${t}`,children:"📊 Дополнительно"}),n.jsxs("ul",{className:`text-sm space-y-1 ${r} list-disc list-inside`,children:[n.jsx("li",{children:"Удаление сообщений из подсчета"}),n.jsx("li",{children:"Полный доступ ко всем функциям"}),n.jsx("li",{children:"Просмотр и управление данными команды"})]})]})]})]})]}):n.jsx("div",{className:`rounded-2xl p-8 ${a} shadow-xl border-2 ${s==="dark"?"border-red-500/30 bg-gradient-to-br from-[#1a1a1a] to-[#0A0A0A]":"border-red-200 bg-gradient-to-br from-white to-red-50/20"} relative overflow-hidden`,children:n.jsxs("div",{className:"text-center",children:[n.jsx("div",{className:`inline-flex p-4 rounded-2xl mb-4 ${s==="dark"?"bg-red-500/20":"bg-red-100"}`,children:n.jsx(Ci,{className:`w-12 h-12 ${s==="dark"?"text-red-400":"text-red-600"}`})}),n.jsx("h2",{className:`text-2xl font-bold mb-2 ${t}`,children:"Доступ запрещен"}),n.jsx("p",{className:r,children:'Эта страница доступна только администраторам. Для входа используйте режим "Админ" на странице входа.'})]})})},JC=()=>{var ge;const{theme:s}=lt(),{user:e,logout:t}=_t(),{isAdmin:r,deactivateAdmin:a}=Ct(),i=Sp(),[o,l]=I.useState(!1),[c,h]=I.useState(!1),[u,m]=I.useState([]),[g,p]=I.useState(null),[j,_]=I.useState(null),[y,M]=I.useState(null),[D,T]=I.useState([]),[R,P]=I.useState({id:"",userId:"",title:"",text:"",priority:"medium",createdAt:"",updatedAt:""}),[C,N]=I.useState(!0),[b,v]=I.useState(!1),[S,E]=I.useState(""),[k,w]=I.useState(!1),[Q,ae]=I.useState(!1),V=pc((e==null?void 0:e.id)||""),X=e||(r?{name:"Администратор",login:"admin",password:dh}:null),he=e!=null&&e.id?(ge=Re.find(H=>H.id===e.id))==null?void 0:ge.avatar:void 0,B=X!=null&&X.name?X.name.charAt(0).toUpperCase():"A",te=s==="dark"?"text-white":"text-gray-900";I.useEffect(()=>{(e||r)&&ve()},[e,r]);const ve=async()=>{if(!(!e&&!r)){N(!0);try{const H=(e==null?void 0:e.id)||"admin",se=await bu({assignedTo:H});if(m(se),e){const je=Hn(),Se=oe(je.start,"yyyy-MM-dd"),G=oe(je.end,"yyyy-MM-dd"),xe=ca(30),z=oe(xe.start,"yyyy-MM-dd"),ce=oe(xe.end,"yyyy-MM-dd"),ke=xe.start.toISOString(),ue=xe.end.toISOString(),$e=ca(90),Oe=oe($e.start,"yyyy-MM-dd"),U=oe($e.end,"yyyy-MM-dd"),_e=await Ui(H,Se,G),Pe=_e.reduce((ne,me)=>{const Qe=me.participants&&me.participants.length>0?me.participants.length:1;return ne+me.amount/Qe},0),K=_e.reduce((ne,me)=>{const Qe=me.participants&&me.participants.length>0?me.participants.length:1;return ne+me.poolAmount/Qe},0),q=await Ui(H,z,ce),Ce=q.reduce((ne,me)=>{const Qe=me.participants&&me.participants.length>0?me.participants.length:1;return ne+me.amount/Qe},0),Le=q.reduce((ne,me)=>{const Qe=me.participants&&me.participants.length>0?me.participants.length:1;return ne+me.poolAmount/Qe},0),Ue=await Ar(H),ye=Ue.filter(ne=>{const me=ne.date,Qe=ne.endDate||ne.date;return me<=ce&&Qe>=z}),mt=ye.filter(ne=>ne.type==="dayoff").reduce((ne,me)=>ne+gs(me.date,me.endDate,z,ce),0),qe=ye.filter(ne=>ne.type==="sick").reduce((ne,me)=>ne+gs(me.date,me.endDate,z,ce),0),et=ye.filter(ne=>ne.type==="vacation").reduce((ne,me)=>ne+gs(me.date,me.endDate,z,ce),0),Te=ye.filter(ne=>ne.type==="absence").reduce((ne,me)=>ne+gs(me.date,me.endDate,z,ce),0),Ve=Ue.filter(ne=>{const me=ne.date,Qe=ne.endDate||ne.date;return me<=G&&Qe>=Se}),wt=Ve.filter(ne=>ne.type==="dayoff").reduce((ne,me)=>ne+gs(me.date,me.endDate,Se,G),0),ct=Ve.filter(ne=>ne.type==="sick").reduce((ne,me)=>ne+gs(me.date,me.endDate,Se,G),0),Yt=Ue.filter(ne=>{const me=ne.date,Qe=ne.endDate||ne.date;return me<=U&&Qe>=Oe}).filter(ne=>ne.type==="vacation").reduce((ne,me)=>ne+gs(me.date,me.endDate,Oe,U),0),Ae=(await Is(H)).filter(ne=>ne.date>=Se&&ne.date<=G).reduce((ne,me)=>ne+xc(me.slots),0),Xe=(await Nb(H))[0]||{userId:H,earnings:0,messages:0,initiatives:0,signals:0,profitableSignals:0,referrals:0,daysOff:0,sickDays:0,vacationDays:0,absenceDays:0,poolAmount:0,rating:0,lastUpdated:new Date().toISOString()},ze=(await Eb(void 0,ke,ue)).filter(ne=>ne.ownerId===H).length,Be={userId:H,earnings:Ce,messages:Xe.messages||0,initiatives:Xe.initiatives||0,signals:Xe.signals||0,profitableSignals:Xe.profitableSignals||0,referrals:ze,daysOff:mt,sickDays:qe,vacationDays:et,absenceDays:Te,poolAmount:Le,lastUpdated:new Date().toISOString()};console.log("Profile.tsx calculateRating call for user:",H,{weeklyHours:Ae,weeklyEarnings:Pe,weeklyDaysOff:wt,weeklySickDays:ct,ninetyDayVacationDays:Yt,updatedData:Be});const Ge=Cb(Be,Ae,Pe,wt,ct,Yt),at=Db(Be,Ae,Pe,wt,ct,Yt);p({...Be,rating:Ge}),_(at),M({total:Ce,pool:Le,net:Math.max(0,Ce-Le),weekly:{gross:Pe,pool:K,net:Math.max(0,Pe-K)}});const yt=e!=null&&e.id?`notes-cache-${e.id}`:null,St=ne=>{if(yt)try{localStorage.setItem(yt,JSON.stringify(ne))}catch(me){console.error("Error caching notes locally",me)}};try{if(e){const ne=await rf(e.id,r);T(ne),St(ne)}else if(r){const ne=await rf(void 0,!0);T(ne),St(ne)}}catch(ne){if(console.error("Error loading notes",ne),yt)try{const me=localStorage.getItem(yt);if(me){const Qe=JSON.parse(me);T(Qe)}}catch(me){console.error("Error loading cached notes",me)}}}}catch(H){console.error("Error loading profile data:",H)}finally{N(!1)}}},W=async()=>{if(!(e!=null&&e.id)||!R.title.trim()&&!R.text.trim())return;const H=e!=null&&e.id?`notes-cache-${e.id}`:null,se=je=>{if(H)try{localStorage.setItem(H,JSON.stringify(je))}catch(Se){console.error("Error caching notes locally",Se)}};try{if(R.id){await Q5(R.id,{title:R.title,text:R.text,priority:R.priority});const je=D.map(Se=>Se.id===R.id?{...Se,title:R.title,text:R.text,priority:R.priority,updatedAt:new Date().toISOString()}:Se);T(je),se(je)}else{const je=await Y5({userId:e.id,title:R.title,text:R.text,priority:R.priority}),Se=new Date().toISOString(),G=[{id:je,userId:e.id,title:R.title,text:R.text,priority:R.priority,createdAt:Se,updatedAt:Se},...D];T(G),se(G)}}catch(je){console.error("Error saving note",je)}finally{P({id:"",userId:"",title:"",text:"",priority:"medium",createdAt:"",updatedAt:""})}},F=H=>{const se=D.find(je=>je.id===H);se&&P(se)},re=async H=>{const se=e!=null&&e.id?`notes-cache-${e.id}`:null,je=Se=>{if(se)try{localStorage.setItem(se,JSON.stringify(Se))}catch(G){console.error("Error caching notes locally",G)}};try{await X5(H);const Se=D.filter(G=>G.id!==H);T(Se),je(Se),R.id===H&&P({id:"",userId:"",title:"",text:"",priority:"medium",createdAt:"",updatedAt:""})}catch(Se){console.error("Error deleting note",Se)}},de=()=>{r&&a(),t(),i("/login")},$=()=>{e!=null&&e.password&&(navigator.clipboard.writeText(e.password),h(!0),setTimeout(()=>h(!1),2e3))},O=()=>{const H=X==null?void 0:X.login;H&&(navigator.clipboard.writeText(H),v(!0),setTimeout(()=>v(!1),2e3))},J=async()=>{if(!(e!=null&&e.id)||!S.trim())return;const H=S.trim(),se=V||"";if(H===se){w(!1),E("");return}ae(!0);try{const je=await kc(e.id);await It({entity:"login",action:"update",authorId:e.id,targetUserId:e.id,before:je||{id:"",userId:e.id,nickname:se,createdAt:"",updatedAt:""},after:{id:"",userId:e.id,nickname:H,createdAt:"",updatedAt:""},comment:`Запрос на изменение ника с "${se}" на "${H}"`}),w(!1),E(""),alert("Запрос на изменение ника отправлен на согласование администратору")}catch(je){console.error("Error requesting nickname change:",je),alert("Ошибка при отправке запроса на изменение ника")}finally{ae(!1)}},Y=u.filter(H=>H.status==="in_progress").length,Z=u.filter(H=>H.status==="completed").length,L=u.filter(H=>H.status==="closed").length,fe={in_progress:{label:"В работе",classes:s==="dark"?"bg-blue-500/15 text-blue-100 border-blue-500/30":"bg-blue-50 text-blue-900 border-blue-200"},completed:{label:"Выполнена",classes:s==="dark"?"bg-emerald-500/15 text-emerald-50 border-emerald-500/30":"bg-emerald-50 text-emerald-900 border-emerald-200"},closed:{label:"Закрыта",classes:s==="dark"?"bg-gray-600/20 text-gray-100 border-gray-500/40":"bg-gray-50 text-gray-800 border-gray-200"}};return X?n.jsxs("div",{className:"space-y-6",children:[n.jsx("div",{className:`rounded-2xl p-6 border ${s==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white"} shadow-lg`,children:n.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4",children:[n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx("div",{className:"relative w-12 h-12 rounded-xl overflow-hidden shadow-lg border border-white/50 dark:border-white/10 bg-gradient-to-br from-[#4E6E49]/15 to-emerald-200/40 flex items-center justify-center",children:he?n.jsx("img",{src:he,alt:X.name,className:"w-full h-full object-cover",onError:H=>{const se=H.target;se.style.display="none"}}):n.jsx("span",{className:"text-lg font-extrabold text-[#4E6E49]",children:B})}),n.jsxs("div",{children:[n.jsx("p",{className:`text-xs uppercase tracking-[0.14em] ${s==="dark"?"text-gray-400":"text-gray-500"}`,children:"ApeVault Black Ops"}),n.jsx("h1",{className:`text-2xl sm:text-3xl font-extrabold ${te}`,children:"Личный кабинет"}),n.jsx("p",{className:`text-sm ${s==="dark"?"text-gray-300":"text-gray-600"}`,children:"Закрытый контур. Ваши данные и показатели."})]})]}),n.jsxs("div",{className:"flex flex-wrap gap-2",children:[n.jsxs("div",{className:"pill","data-active":"true",children:[n.jsx(Rn,{className:"w-4 h-4"}),n.jsx("span",{children:X.name})]}),r&&n.jsxs("div",{className:"pill","data-active":"true",children:[n.jsx(Ot,{className:"w-4 h-4"}),n.jsx("span",{children:"Администратор"})]}),n.jsxs("div",{className:"pill","data-active":"false",children:[n.jsx(Sr,{className:"w-4 h-4"}),n.jsxs("span",{children:[u.length," задач"]})]}),g&&n.jsxs("div",{className:"pill","data-active":"false",children:[n.jsx(Ut,{className:"w-4 h-4"}),n.jsxs("span",{children:[g.rating.toFixed(1),"%"]})]}),n.jsxs(zs,{to:"/rules",className:"inline-flex items-center gap-2 px-3 py-2 rounded-xl bg-gradient-to-r from-[#4E6E49] to-emerald-600 text-white text-sm font-semibold shadow-md hover:shadow-lg hover:-translate-y-0.5 transition-all",children:[n.jsx(ya,{className:"w-4 h-4"}),"Ознакомиться с правилами"]})]})]})}),C?n.jsx("div",{className:`rounded-xl p-8 text-center ${s==="dark"?"bg-white/5 text-white":"bg-white text-gray-800"} shadow`,children:"Загрузка..."}):n.jsxs("div",{className:"space-y-5",children:[n.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-[1.05fr_0.95fr] gap-4 items-stretch",children:[n.jsxs("div",{className:"space-y-4 flex flex-col",children:[n.jsxs("div",{className:`rounded-2xl p-5 border ${s==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white"} shadow flex-1`,children:[n.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[n.jsx("div",{className:`p-2.5 rounded-xl ${s==="dark"?"bg-blue-500/15 text-blue-200":"bg-blue-50 text-blue-700"}`,children:n.jsx(Rn,{className:"w-5 h-5"})}),n.jsxs("div",{children:[n.jsx("h2",{className:`text-lg font-bold ${te}`,children:"Профиль"}),n.jsx("p",{className:`text-xs ${s==="dark"?"text-gray-400":"text-gray-500"}`,children:"Доступ и учетные данные"})]})]}),n.jsxs("div",{className:"grid sm:grid-cols-2 gap-3",children:[n.jsxs("div",{className:`p-4 rounded-xl border ${s==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white"} shadow-sm`,children:[n.jsx("p",{className:`text-xs font-semibold uppercase tracking-wide ${s==="dark"?"text-gray-400":"text-gray-500"}`,children:"Имя"}),n.jsx("p",{className:`mt-1 text-lg font-bold ${te}`,children:X.name})]}),n.jsxs("div",{className:`p-4 rounded-xl border ${s==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white"} shadow-sm`,children:[n.jsxs("div",{className:"flex items-center justify-between mb-1",children:[n.jsx("p",{className:`text-xs font-semibold uppercase tracking-wide ${s==="dark"?"text-gray-400":"text-gray-500"}`,children:"Ник"}),!k&&e&&!r&&n.jsxs("button",{onClick:async()=>{w(!0),E(V||"")},className:`text-xs px-2 py-1 rounded-lg border transition ${s==="dark"?"border-white/10 bg-white/5 hover:border-white/30 text-white":"border-gray-200 bg-white hover:border-gray-300 text-gray-700"}`,children:[n.jsx(Uc,{className:"w-3 h-3 inline mr-1"}),"Изменить"]})]}),k?n.jsxs("div",{className:"space-y-2 mt-1",children:[n.jsx("input",{type:"text",value:S,onChange:H=>E(H.target.value),placeholder:"Введите новый ник",className:`w-full px-3 py-2 rounded-lg border ${s==="dark"?"border-white/10 bg-white/5 text-white":"border-gray-200 bg-white text-gray-900"} text-sm`,disabled:Q}),n.jsxs("div",{className:"flex gap-2",children:[n.jsx("button",{onClick:J,disabled:Q||!S.trim(),className:`px-3 py-1.5 rounded-lg text-xs font-semibold transition ${Q||!S.trim()?"opacity-50 cursor-not-allowed":"bg-[#4E6E49] text-white hover:bg-[#3d5639]"}`,children:Q?"Отправка...":"Отправить на согласование"}),n.jsx("button",{onClick:()=>{w(!1),E("")},disabled:Q,className:`px-3 py-1.5 rounded-lg text-xs font-semibold border transition ${s==="dark"?"border-white/10 bg-white/5 hover:border-white/30 text-white":"border-gray-200 bg-white hover:border-gray-300 text-gray-700"}`,children:"Отмена"})]}),n.jsx("p",{className:`text-xs ${s==="dark"?"text-gray-400":"text-gray-500"}`,children:"Изменение ника требует согласования администратора"})]}):n.jsx("div",{className:"flex items-center gap-2 mt-1",children:n.jsx("p",{className:`text-lg font-bold ${te}`,children:e!=null&&e.id?n.jsx(xn,{userId:e.id}):"—"})})]}),n.jsxs("div",{className:`p-4 rounded-xl border ${s==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white"} shadow-sm`,children:[n.jsx("p",{className:`text-xs font-semibold uppercase tracking-wide ${s==="dark"?"text-gray-400":"text-gray-500"}`,children:"Логин"}),n.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[n.jsx("p",{className:`text-lg font-bold ${te}`,children:X.login}),n.jsx("button",{onClick:O,className:`p-2 rounded-lg border transition ${b?"bg-[#4E6E49] text-white border-[#4E6E49]":s==="dark"?"border-white/10 bg-white/5 hover:border-white/30":"border-gray-200 bg-white hover:border-gray-300"}`,title:"Скопировать логин",children:b?n.jsx(Ls,{className:"w-4 h-4"}):n.jsx(Ai,{className:"w-4 h-4"})})]})]})]}),n.jsxs("div",{className:"mt-4 space-y-2",children:[n.jsx("label",{className:`text-sm font-semibold ${s==="dark"?"text-gray-300":"text-gray-700"} block`,children:"Пароль"}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("div",{className:`flex-1 px-4 py-3 rounded-lg border ${s==="dark"?"border-white/10 bg-white/5 text-white":"border-gray-200 bg-white text-gray-900"} font-mono text-sm`,children:o?X.password:"•".repeat(X.password.length)}),n.jsx("button",{onClick:()=>l(!o),className:`p-3 rounded-lg border ${s==="dark"?"border-white/10 bg-white/5 hover:border-white/30":"border-gray-200 bg-white hover:border-gray-300"} transition`,title:o?"Скрыть пароль":"Показать пароль",children:o?n.jsx(Op,{className:"w-5 h-5"}):n.jsx(ml,{className:"w-5 h-5"})}),n.jsx("button",{onClick:$,className:`p-3 rounded-lg border transition ${c?"bg-[#4E6E49] text-white border-[#4E6E49]":s==="dark"?"border-white/10 bg-white/5 hover:border-white/30":"border-gray-200 bg-white hover:border-gray-300"}`,title:"Скопировать пароль",children:c?n.jsx(Ls,{className:"w-5 h-5"}):n.jsx(Ai,{className:"w-5 h-5"})})]})]}),n.jsx("div",{className:"mt-4 grid gap-3 sm:grid-cols-1",children:n.jsxs("div",{className:`p-4 rounded-xl border ${s==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white"} shadow-sm`,children:[n.jsx("p",{className:`text-xs font-semibold uppercase tracking-wide ${s==="dark"?"text-gray-400":"text-gray-500"}`,children:"Учебная панель (преподаватель)"}),n.jsxs("div",{className:"mt-2 space-y-2 text-sm",children:[n.jsxs("div",{className:`${s==="dark"?"text-gray-300":"text-gray-700"}`,children:[n.jsx("span",{className:"font-semibold",children:"Имя: "}),n.jsx("span",{className:"font-medium",children:"в разработке"})]}),n.jsxs("div",{className:`${s==="dark"?"text-gray-300":"text-gray-700"}`,children:[n.jsx("span",{className:"font-semibold",children:"Логин: "}),n.jsx("span",{className:"font-medium",children:"в разработке"})]}),n.jsxs("div",{className:`${s==="dark"?"text-gray-300":"text-gray-700"}`,children:[n.jsx("span",{className:"font-semibold",children:"Пароль: "}),n.jsx("span",{className:"font-medium",children:"в разработке"})]})]})]})})]}),n.jsxs("div",{className:`rounded-2xl p-5 border ${s==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white"} shadow flex-1`,children:[n.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[n.jsx("div",{className:`p-2.5 rounded-xl ${s==="dark"?"bg-green-500/15 text-green-200":"bg-green-50 text-[#4E6E49]"}`,children:n.jsx(Sr,{className:"w-5 h-5"})}),n.jsxs("div",{children:[n.jsx("h2",{className:`text-lg font-bold ${te}`,children:"Мои задачи"}),n.jsx("p",{className:`text-xs ${s==="dark"?"text-gray-400":"text-gray-500"}`,children:"Сводка по статусам"})]})]}),n.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-3 mb-4",children:[{label:"В работе",value:Y,classes:s==="dark"?"bg-blue-500/15 border-blue-500/30 text-blue-100":"bg-blue-50 border-blue-200 text-blue-900"},{label:"Выполнено",value:Z,classes:s==="dark"?"bg-emerald-500/15 border-emerald-500/30 text-emerald-50":"bg-emerald-50 border-emerald-200 text-emerald-900"},{label:"Закрыто",value:L,classes:s==="dark"?"bg-gray-600/20 border-gray-500/40 text-gray-100":"bg-gray-50 border-gray-200 text-gray-800"},{label:"Всего",value:u.length,classes:s==="dark"?"bg-gray-600/20 border-gray-500/40 text-gray-100":"bg-gray-50 border-gray-200 text-gray-800"}].map(({label:H,value:se,classes:je})=>n.jsxs("div",{className:`p-4 rounded-xl border shadow-sm transition-all hover:translate-y-[-2px] ${je}`,children:[n.jsx("div",{className:"text-xs font-semibold mb-2 opacity-80",children:H}),n.jsx("div",{className:`text-3xl font-extrabold ${te}`,children:se})]},H))}),u.length>0&&n.jsxs("div",{className:"space-y-2 mb-4",children:[n.jsx("p",{className:`text-sm font-semibold ${s==="dark"?"text-gray-200":"text-gray-800"}`,children:"Активные задачи"}),n.jsx("div",{className:"space-y-2",children:u.slice(0,3).map(H=>n.jsxs("div",{className:`p-3 rounded-lg border ${s==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-gray-50"} shadow-sm`,children:[n.jsxs("div",{className:"flex items-start justify-between gap-2",children:[n.jsxs("div",{className:"min-w-0",children:[n.jsx("p",{className:`text-sm font-semibold ${te} truncate`,children:H.title}),n.jsxs("p",{className:`text-xs ${s==="dark"?"text-gray-400":"text-gray-600"}`,children:["Дедлайн: ",H.dueDate?oe(new Date(H.dueDate),"dd.MM.yyyy"):"—"," ",H.dueTime||""]})]}),n.jsx("span",{className:`text-[11px] px-2 py-1 rounded-full border ${fe[H.status].classes}`,children:fe[H.status].label})]}),H.description&&n.jsx("p",{className:`text-xs mt-2 ${s==="dark"?"text-gray-300":"text-gray-600"} line-clamp-2`,children:H.description})]},H.id))})]}),n.jsxs("div",{className:"mt-4 space-y-3",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx(cw,{className:"w-4 h-4 text-[#4E6E49]"}),n.jsx("p",{className:`text-sm font-semibold ${te}`,children:"Мои заметки"})]}),n.jsxs("div",{className:"grid gap-2 sm:grid-cols-2",children:[n.jsx("input",{type:"text",value:R.title,onChange:H=>P({...R,title:H.target.value}),placeholder:"Заголовок",className:`px-3 py-2 rounded-lg border ${s==="dark"?"border-white/10 bg-white/5 text-white":"border-gray-200 bg-white text-gray-900"} text-sm`}),n.jsx("div",{className:"flex gap-2",children:["low","medium","high"].map(H=>n.jsx("button",{onClick:()=>P({...R,priority:H}),className:`px-3 py-2 rounded-lg border text-sm flex-1 ${R.priority===H?"border-[#4E6E49] bg-[#4E6E49]/10 text-[#4E6E49]":s==="dark"?"border-white/10 bg-white/5 text-white":"border-gray-200 bg-white text-gray-800"}`,children:H==="low"?"Низкий":H==="medium"?"Средний":"Высокий"},H))})]}),n.jsx("textarea",{value:R.text,onChange:H=>P({...R,text:H.target.value}),rows:3,placeholder:"Текст заметки",className:`w-full px-3 py-2 rounded-lg border ${s==="dark"?"border-white/10 bg-white/5 text-white":"border-gray-200 bg-white text-gray-900"} text-sm`}),n.jsxs("div",{className:"flex gap-2",children:[n.jsxs("button",{onClick:W,className:`px-4 py-2 rounded-lg font-semibold flex items-center gap-2 ${e!=null&&e.id?s==="dark"?"bg-[#4E6E49]/20 text-[#4E6E49] border border-[#4E6E49]/40":"bg-gradient-to-r from-[#4E6E49] to-emerald-500 text-white":"bg-gray-300 text-gray-600 cursor-not-allowed"}`,disabled:!(e!=null&&e.id),children:[n.jsx(Uc,{className:"w-4 h-4"}),R.id?"Сохранить":"Добавить"]}),R.id&&n.jsx("button",{onClick:()=>P({id:"",userId:"",title:"",text:"",priority:"medium",createdAt:"",updatedAt:""}),className:`px-4 py-2 rounded-lg font-semibold border ${s==="dark"?"border-white/15 text-gray-200":"border-gray-200 text-gray-700"}`,children:"Отмена"})]}),D.length>0&&n.jsx("div",{className:"space-y-2",children:D.map(H=>n.jsx("div",{className:`p-3 rounded-lg border ${s==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-gray-50"} flex flex-col gap-1`,children:n.jsxs("div",{className:"flex items-start justify-between gap-2",children:[n.jsxs("div",{className:"min-w-0",children:[n.jsx("p",{className:`text-sm font-semibold ${te} truncate`,children:H.title||"Без названия"}),n.jsx("p",{className:`text-xs ${s==="dark"?"text-gray-400":"text-gray-600"} whitespace-pre-line`,children:H.text})]}),n.jsxs("div",{className:"flex items-center gap-1",children:[n.jsx("span",{className:`text-[11px] px-2 py-1 rounded-full border ${H.priority==="high"?"border-rose-200 bg-rose-50 text-rose-700 dark:border-rose-500/40 dark:bg-rose-500/15 dark:text-rose-50":H.priority==="medium"?"border-amber-200 bg-amber-50 text-amber-700 dark:border-amber-500/40 dark:bg-amber-500/15 dark:text-amber-50":"border-emerald-200 bg-emerald-50 text-emerald-700 dark:border-emerald-500/40 dark:bg-emerald-500/15 dark:text-emerald-50"}`,children:H.priority==="high"?"Высокий":H.priority==="medium"?"Средний":"Низкий"}),n.jsx("button",{onClick:()=>F(H.id),className:`p-1 rounded border ${s==="dark"?"border-white/10 text-gray-200":"border-gray-200 text-gray-700"}`,title:"Редактировать",children:n.jsx(Uc,{className:"w-4 h-4"})}),n.jsx("button",{onClick:()=>re(H.id),className:`p-1 rounded border ${s==="dark"?"border-white/10 text-red-200":"border-gray-200 text-red-600"}`,title:"Удалить",children:n.jsx(Bt,{className:"w-4 h-4"})})]})]})},H.id))})]}),n.jsx("div",{className:"mt-4",children:n.jsxs("button",{onClick:()=>i("/tasks"),className:`w-full px-4 py-3 rounded-lg font-semibold transition-all flex items-center justify-center gap-2 ${s==="dark"?"bg-gradient-to-r from-[#4E6E49]/20 to-emerald-700/20 text-[#4E6E49] border border-[#4E6E49]/40":"bg-gradient-to-r from-green-50 to-emerald-50 text-[#4E6E49] border border-green-200"}`,children:[n.jsx(Sr,{className:"w-4 h-4"}),"Перейти к задачам"]})})]})]}),n.jsxs("div",{className:"space-y-4 flex flex-col",children:[y&&n.jsxs("div",{className:`rounded-2xl p-5 border ${s==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white"} shadow flex-1`,children:[n.jsxs("div",{className:"flex items-center justify-between mb-4",children:[n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx("div",{className:`p-2.5 rounded-xl ${s==="dark"?"bg-emerald-500/20 text-emerald-200":"bg-emerald-50 text-emerald-700"}`,children:n.jsx(va,{className:"w-5 h-5"})}),n.jsxs("div",{children:[n.jsx("h2",{className:`text-lg font-bold ${te}`,children:"Мой заработок"}),n.jsx("p",{className:`text-xs ${s==="dark"?"text-gray-400":"text-gray-500"}`,children:"Суммы с учётом долей"})]})]}),n.jsx("div",{className:`px-3 py-1.5 rounded-full text-xs font-semibold border ${y.weekly.net>=1e4?"border-emerald-200 bg-emerald-50 text-emerald-800 dark:border-emerald-500/30 dark:bg-emerald-500/15 dark:text-emerald-100":"border-amber-200 bg-amber-50 text-amber-800 dark:border-amber-500/30 dark:bg-amber-500/15 dark:text-amber-100"}`,children:y.weekly.net>=1e4?"Вывод доступен":"Минимум 10 000 для вывода"})]}),n.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3 mb-4",children:[{label:"Всего заработано",value:y.total},{label:"Отправлено в пул",value:y.pool},{label:"Чистыми",value:y.net}].map(H=>n.jsxs("div",{className:`p-4 rounded-xl border shadow-sm ${s==="dark"?"border-white/10 bg-white/5":"border-gray-100 bg-gray-50"}`,children:[n.jsx("p",{className:"text-xs uppercase tracking-wide opacity-70",children:H.label}),n.jsxs("p",{className:`text-2xl font-extrabold ${te}`,children:[Math.round(H.value).toLocaleString("ru-RU")," ₽"]})]},H.label))}),n.jsxs("div",{className:`p-4 rounded-xl border ${s==="dark"?"border-white/10 bg-white/5":"border-emerald-50 bg-emerald-50/70"} flex flex-col gap-2`,children:[n.jsxs("div",{className:"flex items-center justify-between gap-2 flex-wrap",children:[n.jsxs("div",{children:[n.jsx("p",{className:`text-sm font-semibold ${te}`,children:"Активная неделя"}),n.jsx("p",{className:`text-xs ${s==="dark"?"text-gray-400":"text-gray-600"}`,children:"Понедельник, среда, пятница, суббота — дни вывода"})]}),n.jsx("span",{className:`text-xs px-3 py-1 rounded-full border ${y.weekly.net>=1e4?"border-emerald-200 bg-emerald-100 text-emerald-800 dark:border-emerald-500/40 dark:bg-emerald-500/15 dark:text-emerald-50":"border-amber-200 bg-amber-100 text-amber-800 dark:border-amber-500/40 dark:bg-amber-500/15 dark:text-amber-50"}`,children:y.weekly.net>=1e4?"Доступно к выводу":"Перенос на следующую неделю"})]}),n.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3",children:[{label:"Заработано за неделю",value:y.weekly.gross},{label:"В пул за неделю",value:y.weekly.pool},{label:"Чистыми за неделю",value:y.weekly.net}].map(H=>n.jsxs("div",{className:`p-3 rounded-lg border ${s==="dark"?"border-white/10 bg-white/5":"border-white/80 bg-white/80"} shadow-sm`,children:[n.jsx("p",{className:"text-[11px] uppercase tracking-wide opacity-70",children:H.label}),n.jsxs("p",{className:`text-lg font-bold ${te}`,children:[Math.round(H.value).toLocaleString("ru-RU")," ₽"]})]},H.label))}),y.weekly.net<1e4&&n.jsx("p",{className:`text-xs ${s==="dark"?"text-amber-200":"text-amber-700"}`,children:"Менее 10 000 ₽ чистыми за активную неделю — вывод недоступен, сумма переносится на следующую неделю."})]})]}),g&&j&&n.jsxs("div",{className:`rounded-2xl p-5 border ${s==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white"} shadow flex-1`,children:[n.jsxs("div",{className:"flex items-center justify-between mb-4",children:[n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx("div",{className:`p-2.5 rounded-xl ${s==="dark"?"bg-purple-500/20 text-purple-200":"bg-purple-50 text-purple-700"}`,children:n.jsx(Ut,{className:"w-5 h-5"})}),n.jsxs("div",{children:[n.jsx("h2",{className:`text-lg font-bold ${te}`,children:"Рейтинг"}),n.jsx("p",{className:`text-xs ${s==="dark"?"text-gray-400":"text-gray-500"}`,children:"Еженедельная оценка"})]})]}),n.jsx("div",{className:"pill","data-active":"true",children:n.jsxs("span",{className:"font-bold",children:[g.rating.toFixed(1),"%"]})})]}),n.jsxs("div",{className:`p-4 rounded-xl border ${s==="dark"?"border-white/10 bg-white/5":"border-gray-100 bg-gray-50"} mb-4`,children:[n.jsxs("div",{className:`text-4xl font-extrabold ${te}`,children:[g.rating.toFixed(1),"%"]}),n.jsx("p",{className:`text-xs mt-1 ${s==="dark"?"text-gray-400":"text-gray-600"}`,children:g.rating>=70?"Отличный результат":g.rating>=50?"Хороший темп":"Требуется усиление показателей"})]}),n.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[{label:"Выходные",value:`${j.daysOff} дн`,pts:j.daysOffPoints,classes:s==="dark"?"bg-slate-700/40 border-slate-600/60":"bg-slate-50 border-slate-200"},{label:"Больничные",value:`${g.sickDays} дн`,pts:j.sickDaysPoints,classes:s==="dark"?"bg-amber-500/15 border-amber-500/30":"bg-amber-50 border-amber-200"},{label:"Отпуск",value:`${g.vacationDays} дн`,pts:j.vacationDaysPoints,classes:s==="dark"?"bg-orange-500/15 border-orange-500/30":"bg-orange-50 border-orange-200"},{label:"Часы",value:`${j.weeklyHours.toFixed(1)} ч/нед`,pts:j.weeklyHoursPoints,classes:s==="dark"?"bg-blue-500/15 border-blue-500/30":"bg-blue-50 border-blue-200"},{label:"Заработок",value:`${j.weeklyEarnings.toFixed(0)} ₽/нед`,pts:j.weeklyEarningsPoints,classes:s==="dark"?"bg-emerald-500/15 border-emerald-500/30":"bg-emerald-50 border-emerald-200"},{label:"Рефералы",value:`${g.referrals}`,pts:j.referralsPoints,classes:s==="dark"?"bg-purple-500/15 border-purple-500/30":"bg-purple-50 border-purple-200"}].map(H=>n.jsxs("div",{className:`p-3 rounded-xl border shadow-sm ${H.classes}`,children:[n.jsx("div",{className:"text-xs font-semibold uppercase opacity-80",children:H.label}),n.jsx("div",{className:`text-lg font-bold ${te}`,children:H.value}),n.jsxs("div",{className:`text-sm ${s==="dark"?"text-gray-100":"text-gray-800"}`,children:[H.pts.toFixed(1),"%"]})]},H.label))}),n.jsxs("div",{className:`mt-4 p-4 rounded-xl border ${s==="dark"?"border-white/10 bg-white/5":"border-gray-100 bg-gray-50"}`,children:[n.jsxs("h3",{className:`text-sm font-bold ${te} mb-2 flex items-center gap-2`,children:[n.jsx($s,{className:"w-4 h-4"}),"Как считается рейтинг"]}),n.jsx("p",{className:`text-xs ${s==="dark"?"text-gray-300":"text-gray-700"}`,children:"7 параметров: выходные, больничные, отпуск (месяц), часы, доход, рефералы, сообщения (неделя). Максимум 100%."})]})]})]})]}),n.jsx("div",{className:`rounded-2xl p-5 border ${s==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white"} shadow`,children:n.jsxs("button",{onClick:de,className:`w-full px-6 py-3.5 rounded-lg font-semibold transition-all flex items-center justify-center gap-2 ${s==="dark"?"bg-gradient-to-r from-red-500/20 to-pink-500/20 text-red-300 border border-red-500/50":"bg-gradient-to-r from-red-50 to-pink-50 text-red-700 border border-red-200"}`,children:[n.jsx(Up,{className:"w-5 h-5"}),"Выйти из аккаунта"]})})]})]}):n.jsx("div",{className:"text-center py-12",children:n.jsx("p",{className:te,children:"Необходима авторизация"})})},ZC="/assets/image-779ddbd9-e512-4bda-8983-af1ab9237b7c-B_v6l7J0.png",eD=()=>{const{theme:s}=lt(),e=s==="dark"?"text-white":"text-gray-900",t=s==="dark"?"text-gray-400":"text-gray-600",r=[{title:"Финансовая грамотность",note:"Учимся управлять рисками, понимать токеномику и принимать решения на основе анализа, а не эмоций.",accent:"from-emerald-200 to-teal-200"},{title:"Приватность превыше всего",note:"Уважаем личные границы и используем инструменты, защищающие цифровую идентичность.",accent:"from-sky-200 to-blue-200"},{title:"Образование и развитие",note:"Учимся от основ блокчейна до продвинутых DeFi-стратегий и делимся знаниями.",accent:"from-amber-200 to-orange-200"},{title:"Честность и прозрачность",note:"Внутри клуба — открытость, честные сделки и уважение. Доверие строим действиями.",accent:"from-purple-200 to-indigo-200"},{title:"Инновации и эксперименты",note:"Тестируем новые протоколы, участвуем в DAO, не боимся быть первыми в трендах.",accent:"from-pink-200 to-rose-200"},{title:"Критическое мышление",note:"Не следуем слепо за хайпом: анализируем, проверяем источники и опираемся на здравый смысл.",accent:"from-cyan-200 to-teal-200"},{title:"Глобальное мышление",note:"Открыты к сотрудничеству с людьми из разных стран ради цифровой и финансовой свободы в рамках закона.",accent:"from-lime-200 to-green-200"},{title:"Свобода и ответственность",note:"Ценим свободу крипты и понимаем её цену: зрелость, самоконтроль и ответственность за решения.",accent:"from-gray-200 to-slate-200"}],a=[{label:"Что такое ApeVault?",value:"Клуб криптоэнтузиастов, где знания превращаются в действие."},{label:"Цель",value:"Объединить инвесторов и трейдеров ради роста дохода и безопасности входа в рынок."}];return n.jsxs("div",{className:"space-y-7 sm:space-y-8",children:[n.jsxs("div",{className:"section-card rounded-3xl p-6 sm:p-8 border border-white/60 dark:border-white/10 shadow-2xl relative overflow-hidden",children:[n.jsx("div",{className:"accent-dots"}),n.jsx("div",{className:"absolute inset-y-0 right-0 w-1/3 pointer-events-none bg-gradient-to-l from-[#4E6E49]/10 to-transparent blur-2xl"}),n.jsxs("div",{className:"relative z-10 flex flex-col gap-5 lg:flex-row lg:items-center lg:justify-between",children:[n.jsxs("div",{className:"space-y-3 max-w-3xl",children:[n.jsxs("div",{className:"inline-flex items-center gap-2 px-3 py-1.5 rounded-full border border-white/50 dark:border-white/10 bg-white/70 dark:bg-white/5 text-xs font-semibold uppercase tracking-[0.16em]",children:[n.jsx($s,{className:"w-4 h-4 text-[#4E6E49]"}),"ApeVault Community"]}),n.jsx("h1",{className:`text-3xl sm:text-4xl lg:text-5xl font-extrabold leading-tight ${e}`,children:"О нас и нашем сообществе"}),n.jsx("p",{className:`text-sm sm:text-base ${t} max-w-2xl`,children:"ApeVault — это пространство, где опытные криптоэнтузиасты объединяют знания и проверенные стратегии, чтобы безопасно заходить в рынок и расти вместе."}),n.jsx("div",{className:"flex flex-wrap gap-2",children:["Командные сессии","Проверенные стратегии","Прозрачные регламенты"].map(i=>n.jsx("span",{className:`px-3 py-1.5 rounded-full text-xs font-semibold border ${s==="dark"?"border-white/10 bg-white/5 text-white":"border-gray-200 bg-white text-gray-900"}`,children:i},i))})]}),n.jsx("div",{className:"grid grid-cols-2 gap-3 w-full max-w-xs lg:max-w-sm",children:[{label:"Участников",value:"50+"},{label:"Сессий / неделю",value:"10+"},{label:"Уроков",value:"100+"},{label:"Фокуса",value:"100% качество"}].map(i=>n.jsxs("div",{className:`rounded-2xl border p-3 sm:p-4 shadow-sm ${s==="dark"?"border-white/10 bg-white/5 text-white":"border-gray-200 bg-white text-gray-900"}`,children:[n.jsx("p",{className:"text-[11px] uppercase tracking-wide opacity-70",children:i.label}),n.jsx("p",{className:"text-xl font-extrabold leading-tight mt-1",children:i.value})]},i.label))})]})]}),n.jsxs("div",{className:"section-card rounded-3xl p-6 sm:p-7 border border-white/60 dark:border-white/10 shadow-xl relative overflow-hidden",children:[n.jsx("div",{className:"absolute top-0 right-0 w-40 h-40 bg-gradient-to-br from-emerald-500/10 to-blue-500/10 rounded-full blur-3xl -mr-16 -mt-16"}),n.jsxs("div",{className:"relative z-10 space-y-4",children:[n.jsxs("h2",{className:`text-2xl sm:text-3xl font-extrabold ${e} flex items-center gap-2`,children:[n.jsx(xs,{className:"w-6 h-6 text-[#4E6E49]"}),"Что такое ApeVault?"]}),n.jsx("div",{className:"grid gap-4 sm:grid-cols-2",children:a.map(i=>n.jsxs("div",{className:`rounded-2xl border p-4 sm:p-5 flex gap-3 items-start ${s==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white"}`,children:[n.jsx("div",{className:"p-2 rounded-xl bg-gradient-to-br from-[#4E6E49] to-emerald-600 text-white shadow-lg",children:n.jsx(Js,{className:"w-4 h-4"})}),n.jsxs("div",{className:"space-y-1",children:[n.jsx("p",{className:"text-xs uppercase tracking-wide text-[#4E6E49] font-semibold",children:i.label}),n.jsx("p",{className:`text-sm sm:text-base leading-relaxed ${e}`,children:i.value})]})]},i.label))})]})]}),n.jsxs("div",{className:"section-card rounded-3xl p-6 sm:p-7 border border-white/60 dark:border-white/10 shadow-xl relative overflow-hidden",children:[n.jsx("div",{className:"absolute -left-10 top-0 w-52 h-52 bg-gradient-to-br from-amber-400/10 to-rose-400/10 rounded-full blur-3xl"}),n.jsx("div",{className:"absolute -right-10 bottom-0 w-52 h-52 bg-gradient-to-br from-blue-400/10 to-emerald-400/10 rounded-full blur-3xl"}),n.jsxs("div",{className:"relative z-10 space-y-5",children:[n.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-3",children:[n.jsx("h2",{className:`text-2xl sm:text-3xl font-extrabold ${e}`,children:"Принципы, которые держат нас на вершине"}),n.jsxs("div",{className:"flex gap-2",children:[n.jsxs(zs,{to:"/rules",className:"pill justify-center text-center","data-active":"false",children:["Ознакомиться с правилами",n.jsx(Js,{className:"w-4 h-4"})]}),n.jsxs("a",{href:"#contacts",className:"pill","data-active":"false",children:["Контакты",n.jsx(Js,{className:"w-4 h-4"})]})]})]}),n.jsxs("div",{className:"grid lg:grid-cols-[1fr_420px_1fr] gap-6 items-center",children:[n.jsx("div",{className:"space-y-3",children:r.slice(0,4).map(i=>n.jsxs("div",{className:`rounded-2xl border px-4 py-3 flex items-start gap-3 ${s==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white/90"}`,children:[n.jsx("div",{className:`p-2 rounded-xl text-gray-900 bg-gradient-to-br ${i.accent}`,children:n.jsx(Js,{className:"w-4 h-4"})}),n.jsxs("div",{className:"space-y-1",children:[n.jsx("p",{className:`text-sm sm:text-base font-semibold ${e}`,children:i.title}),i.note&&n.jsx("p",{className:`text-xs ${t}`,children:i.note})]})]},i.title))}),n.jsxs("div",{className:`rounded-3xl border shadow-xl overflow-hidden relative ${s==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white/95"}`,children:[n.jsx("img",{src:ZC,alt:"Принципы ApeVault",className:"w-full h-full object-contain"}),n.jsx("div",{className:"absolute inset-0 pointer-events-none bg-gradient-to-b from-transparent via-transparent to-white/0"})]}),n.jsx("div",{className:"space-y-3",children:r.slice(4).map(i=>n.jsxs("div",{className:`rounded-2xl border px-4 py-3 flex items-start gap-3 ${s==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white/90"}`,children:[n.jsx("div",{className:`p-2 rounded-xl text-gray-900 bg-gradient-to-br ${i.accent}`,children:n.jsx(Js,{className:"w-4 h-4"})}),n.jsxs("div",{className:"space-y-1",children:[n.jsx("p",{className:`text-sm sm:text-base font-semibold ${e}`,children:i.title}),i.note&&n.jsx("p",{className:`text-xs ${t}`,children:i.note})]})]},i.title))})]})]})]}),n.jsxs("div",{id:"rules",className:"section-card rounded-3xl p-6 sm:p-7 border border-white/60 dark:border-white/10 shadow-xl relative overflow-hidden",children:[n.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-indigo-100/50 via-white/40 to-purple-100/40 dark:from-indigo-900/30 dark:via-transparent dark:to-purple-900/20"}),n.jsxs("div",{className:"relative z-10 grid gap-5 sm:grid-cols-[1.15fr_0.85fr] items-center",children:[n.jsxs("div",{className:"space-y-3",children:[n.jsxs("div",{className:"inline-flex items-center gap-2 px-3 py-1.5 rounded-full bg-white/80 dark:bg-white/10 border border-white/60 dark:border-white/10 text-xs font-semibold tracking-wide text-indigo-700 dark:text-white",children:[n.jsx(ya,{className:"w-4 h-4"}),"Правила сообщества"]}),n.jsx("h2",{className:`text-2xl sm:text-3xl font-extrabold ${e}`,children:"Простой регламент, чтобы оставаться на одной волне"}),n.jsx("p",{className:`text-sm sm:text-base ${t}`,children:"Подробно описали процессы, безопасность и взаимодействие, чтобы каждый чувствовал прозрачность и поддержку."}),n.jsx("div",{className:"flex flex-wrap gap-2",children:["Безопасность","Честные сделки","Уважение","Прозрачность"].map(i=>n.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-semibold border ${s==="dark"?"border-white/10 bg-white/5 text-white":"border-indigo-100 bg-white text-indigo-900"}`,children:i},i))}),n.jsxs(zs,{to:"/rules",className:"inline-flex items-center gap-2 px-5 py-3 rounded-xl bg-gradient-to-r from-indigo-500 to-purple-500 text-white font-semibold shadow-lg hover:shadow-xl hover:-translate-y-0.5 transition-all",children:[n.jsx(ya,{className:"w-5 h-5"}),n.jsx("span",{children:"Ознакомиться с правилами"}),n.jsx(Js,{className:"w-4 h-4"})]})]}),n.jsx("div",{className:`rounded-2xl border p-4 sm:p-5 shadow-lg ${s==="dark"?"border-white/10 bg-white/5":"border-white/80 bg-white/90"}`,children:n.jsx("div",{className:"space-y-3",children:["Короткие правила для быстрых решений","Фокус на безопасности и приватности","Прозрачные роли и ответственность","Действуем в рамках законодательства"].map(i=>n.jsxs("div",{className:"flex items-start gap-2",children:[n.jsx("div",{className:"w-2 h-2 rounded-full bg-indigo-500 mt-2"}),n.jsx("p",{className:`text-sm ${e}`,children:i})]},i))})})]})]}),n.jsxs("div",{id:"contacts",className:"section-card rounded-3xl p-6 sm:p-7 border border-white/60 dark:border-white/10 shadow-xl relative overflow-hidden",children:[n.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-rose-100/50 via-white/40 to-amber-100/40 dark:from-rose-900/25 dark:via-transparent dark:to-amber-900/20"}),n.jsxs("div",{className:"relative z-10 grid gap-5 sm:grid-cols-[0.9fr_1.1fr] items-center",children:[n.jsxs("div",{className:`p-4 rounded-2xl shadow-lg inline-flex items-center gap-3 ${s==="dark"?"bg-gradient-to-br from-rose-600 to-amber-600 text-white":"bg-gradient-to-br from-rose-500 to-amber-500 text-white"}`,children:[n.jsx(Zv,{className:"w-7 h-7"}),n.jsxs("div",{children:[n.jsx("p",{className:"text-xs uppercase tracking-wide",children:"Контакты клуба"}),n.jsx("p",{className:"text-base font-semibold",children:"Свяжитесь с нами"})]})]}),n.jsxs("div",{className:"grid gap-3 sm:grid-cols-2",children:[n.jsxs("div",{className:`rounded-2xl border p-4 shadow-md flex flex-col gap-2 ${s==="dark"?"border-white/10 bg-white/5":"border-white/80 bg-white/90"}`,children:[n.jsx("p",{className:"text-xs uppercase tracking-wide text-rose-600 dark:text-rose-200 font-semibold",children:"Администратор"}),n.jsx("p",{className:`text-lg font-extrabold ${e}`,children:"@artyommedoed"}),n.jsx("p",{className:`text-sm ${t}`,children:"По вопросам правил, доступов и регламентов."})]}),n.jsxs("div",{className:`rounded-2xl border p-4 shadow-md flex flex-col gap-2 ${s==="dark"?"border-white/10 bg-white/5":"border-white/80 bg-white/90"}`,children:[n.jsx("p",{className:"text-xs uppercase tracking-wide text-amber-600 dark:text-amber-200 font-semibold",children:"Обратная связь"}),n.jsx("p",{className:`text-lg font-extrabold ${e}`,children:"Командный чат"}),n.jsx("p",{className:`text-sm ${t}`,children:"Оперативные вопросы по продуктам и сессиям."}),n.jsxs("a",{href:"https://t.me/+vPZdPwPaaKI1MjAy",target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-2 text-sm font-semibold text-[#4E6E49] hover:text-emerald-600",children:["Присоединиться",n.jsx(Js,{className:"w-4 h-4"})]})]})]})]})]})]})},pr=({title:s,description:e,children:t})=>{const{theme:r}=lt(),a=r==="dark"?"text-white":"text-gray-900",i=r==="dark"?"text-gray-400":"text-gray-600";return n.jsx("div",{className:"section-card rounded-3xl p-6 sm:p-7 border border-white/60 dark:border-white/10 shadow-xl relative overflow-hidden",children:n.jsxs("div",{className:"relative z-10 space-y-4",children:[n.jsxs("div",{className:"flex items-start gap-3",children:[n.jsx("div",{className:"p-2 rounded-xl bg-gradient-to-br from-[#4E6E49]/20 to-emerald-500/15 text-[#4E6E49]",children:n.jsx(ya,{className:"w-5 h-5"})}),n.jsxs("div",{className:"space-y-1",children:[n.jsx("h2",{className:`text-xl sm:text-2xl font-extrabold ${a}`,children:s}),e&&n.jsx("p",{className:`text-sm ${i}`,children:e})]})]}),t]})})},tD=()=>{const{theme:s}=lt(),e=s==="dark"?"text-white":"text-gray-900",t=s==="dark"?"text-gray-400":"text-gray-600",r=["последовательной эскалации","объективности и равного применения","недопустимости злоупотребления полномочиями","исключения спорных трактовок и субъективности"],a=["единичные опоздания (не более 1 раза за календарную неделю)","некорректное выполнение инструкций без последствий вследствие заболевания или сбоев в ПО","нарушение регламента общения, не приводящее к конфликту"],i=["повторяющиеся нарушения регламента","несоблюдение правил торговой сессии","недостаточная подготовка к сессии","игнорирование инструкций ведущего","нарушение процедур безопасности данных или доступа"],o=["оскорбления участников","провокации и попытки вызвать конфликт","манипуляции и мошеннические действия","действия, создающие финансовые, репутационные или организационные риски","подрыв дисциплины и порядка в сообществе"],l=[{term:"Нарушение",text:"любое действие или бездействие, противоречащее регламентам ApeVault"},{term:"Предупреждение",text:"официальное уведомление о нарушении"},{term:"Выговор",text:"фиксируемая мера повышенной строгости при повторных нарушениях"},{term:"Ведущий торговой сессии",text:"управляет процессом и следит за соблюдением регламента на сессии"},{term:"Ответственный за сообщество",text:"назначенное лицо, управляющее дисциплиной и коммуникацией"},{term:"Повторное нарушение",text:"нарушение в течение 30 календарных дней после предыдущего"}];return n.jsxs("div",{className:"space-y-7 sm:space-y-8",children:[n.jsxs("div",{className:"section-card rounded-3xl p-6 sm:p-8 border border-white/60 dark:border-white/10 shadow-2xl relative overflow-hidden",children:[n.jsx("div",{className:"accent-dots"}),n.jsx("div",{className:"absolute inset-y-0 right-0 w-1/3 pointer-events-none bg-gradient-to-l from-[#4E6E49]/12 to-transparent blur-3xl"}),n.jsxs("div",{className:"relative z-10 flex flex-col gap-5 lg:flex-row lg:items-center lg:justify-between",children:[n.jsxs("div",{className:"space-y-4 max-w-3xl",children:[n.jsx("div",{className:"inline-flex items-center gap-2 px-3 py-1.5 rounded-full border border-white/50 dark:border-white/10 bg-white/70 dark:bg-white/5 text-xs font-semibold uppercase tracking-[0.16em] text-[#4E6E49]",children:"ApeVault Standard Operating Code — ASOC"}),n.jsx("h1",{className:`text-3xl sm:text-4xl lg:text-5xl font-extrabold leading-tight ${e}`,children:"Кодекс операционных процедур и регламентов платформы ApeVault"}),n.jsx("p",{className:`text-sm sm:text-base ${t}`,children:"Единые правила ответственности, дисциплинарных мер и прозрачных процедур для команды ApeVault."}),n.jsx("div",{className:"flex flex-wrap gap-2",children:["Ответственность","Прозрачность","Безопасность","Справедливость"].map(c=>n.jsx("span",{className:`px-3 py-1.5 rounded-full text-xs font-semibold border ${s==="dark"?"border-white/10 bg-white/5 text-white":"border-gray-200 bg-white text-gray-900"}`,children:c},c))})]}),n.jsxs("div",{className:`rounded-3xl border shadow-xl p-4 sm:p-5 w-full lg:max-w-sm ${s==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white"}`,children:[n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx("div",{className:"p-3 rounded-2xl bg-gradient-to-br from-[#4E6E49] to-emerald-600 text-white shadow-lg",children:n.jsx(Ji,{className:"w-6 h-6"})}),n.jsxs("div",{children:[n.jsx("p",{className:"text-xs uppercase tracking-wide text-[#4E6E49] font-semibold",children:"Назначение раздела"}),n.jsx("p",{className:`text-base font-semibold ${e}`,children:"Поддержание порядка и профессионализма команды"})]})]}),n.jsxs("div",{className:"mt-4 space-y-3",children:[n.jsxs("div",{className:"flex items-center gap-2 text-sm font-semibold text-[#4E6E49]",children:[n.jsx(Js,{className:"w-4 h-4"}),"Публичная версия правил доступна на сайте"]}),n.jsx("p",{className:`text-xs ${t}`,children:"Используйте кнопку «Правила» в навигации или в профиле, чтобы быстро открыть этот раздел."}),n.jsxs("a",{href:"/rules.pdf",download:!0,className:`inline-flex items-center gap-2 px-4 py-2.5 rounded-xl border transition-all shadow-sm hover:shadow-md hover:-translate-y-0.5 ${s==="dark"?"border-white/20 bg-white/10 text-white hover:bg-white/15":"border-[#4E6E49]/30 bg-[#4E6E49]/10 text-[#4E6E49] hover:bg-[#4E6E49]/15"}`,children:[n.jsx(zv,{className:"w-4 h-4"}),n.jsx("span",{className:"text-sm font-semibold",children:"Скачать правила (PDF)"})]})]})]})]})]}),n.jsxs(pr,{title:"Политика ответственности и меры дисциплинарного воздействия",description:"Единый порядок применения мер для поддержания порядка, прозрачности и профессионального уровня.",children:[n.jsxs("div",{className:`grid gap-4 sm:grid-cols-2 ${s==="dark"?"text-gray-200":"text-gray-900"}`,children:[n.jsxs("div",{className:`rounded-2xl border p-4 sm:p-5 ${s==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white"}`,children:[n.jsxs("div",{className:"flex items-center gap-2 text-sm font-semibold text-[#4E6E49]",children:[n.jsx(_m,{className:"w-4 h-4"}),"Цели дисциплинарной политики"]}),n.jsx("p",{className:`text-sm mt-2 ${t}`,children:"Обеспечить соблюдение регламентов, процедур и рабочих стандартов команды."})]}),n.jsxs("div",{className:`rounded-2xl border p-4 sm:p-5 ${s==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white"}`,children:[n.jsxs("div",{className:"flex items-center gap-2 text-sm font-semibold text-[#4E6E49]",children:[n.jsx(lw,{className:"w-4 h-4"}),"Принципы применения мер"]}),n.jsx("ul",{className:`text-sm mt-2 space-y-1 ${t}`,children:r.map(c=>n.jsxs("li",{children:["• ",c]},c))})]})]}),n.jsx("div",{className:`mt-3 text-sm ${t}`,children:"Меры ответственности применяются в зависимости от тяжести, регулярности и последствий нарушения."})]}),n.jsx(pr,{title:"Унифицированный регламент торговой деятельности ApeVault",description:"Нормы поведения на торговых сессиях, полномочия ведущего, перерывы, записи и конфиденциальность.",children:n.jsxs("div",{className:`space-y-4 text-sm ${t}`,children:[n.jsxs("div",{className:`rounded-2xl border p-4 sm:p-5 ${s==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white"}`,children:[n.jsx("p",{className:"text-base font-semibold text-[#4E6E49]",children:"1. Общие положения"}),n.jsxs("ul",{className:"mt-2 space-y-1",children:[n.jsx("li",{children:"• Регламент задаёт нормы участия, дисциплину, полномочия ведущего и ответственность."}),n.jsx("li",{children:"• Все участники обязаны ознакомиться с разделом до начала торговой деятельности."})]})]}),n.jsxs("div",{className:`rounded-2xl border p-4 sm:p-5 ${s==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white"}`,children:[n.jsx("p",{className:"text-base font-semibold text-[#4E6E49]",children:"2. Права и полномочия ведущего"}),n.jsx("p",{className:"mt-2 font-semibold text-[#4E6E49]",children:"Полномочия:"}),n.jsxs("ul",{className:"mt-1 space-y-1",children:[n.jsx("li",{children:"• Давать обязательные распоряжения по порядку, действиям, стратегии и дисциплине."}),n.jsx("li",{children:"• Требовать соблюдения тайминга, регламента и корректного поведения."}),n.jsx("li",{children:"• Приостанавливать участие нарушающих участников."}),n.jsx("li",{children:"• Объявлять перерывы и завершение сессии."}),n.jsx("li",{children:"• Фиксировать нарушения, выдавать предупреждения/выговоры, вводить временный запрет на участие."})]}),n.jsx("p",{className:"mt-3 font-semibold text-[#4E6E49]",children:"Ограничения:"}),n.jsxs("ul",{className:"mt-1 space-y-1",children:[n.jsx("li",{children:"• Не изменяет дисциплинарные меры, установленные регламентом."}),n.jsx("li",{children:"• Не принимает решения об исключении из команды (решает ответственный за команду)."}),n.jsx("li",{children:"• Не меняет торговую стратегию вне утверждённой методологии или плана сессии."})]})]}),n.jsxs("div",{className:`rounded-2xl border p-4 sm:p-5 space-y-3 ${s==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white"}`,children:[n.jsx("p",{className:"text-base font-semibold text-[#4E6E49]",children:"3. Порядок проведения сессии"}),n.jsxs("div",{children:[n.jsx("p",{className:"font-semibold",children:"Начало и окончание:"}),n.jsxs("ul",{className:"mt-1 space-y-1",children:[n.jsx("li",{children:"• Старт строго по времени слота."}),n.jsx("li",{children:"• Подключение за 3–5 минут до старта обязательно."}),n.jsx("li",{children:"• Окончание объявляет ведущий, не позднее 30 минут после окончания слота."})]})]}),n.jsxs("div",{children:[n.jsx("p",{className:"font-semibold",children:"Поведение во время торгов:"}),n.jsx("p",{className:"text-xs uppercase tracking-wide opacity-70 mt-1",children:"Запрещено:"}),n.jsxs("ul",{className:"space-y-1",children:[n.jsx("li",{children:"• Перебивать ведущего или участников."}),n.jsx("li",{children:"• Отвлекать команду сторонними вопросами."}),n.jsx("li",{children:"• Включать микрофон без необходимости, создавать шум."}),n.jsx("li",{children:"• Саботировать процесс или предлагать несогласованные решения."}),n.jsx("li",{children:"• Коммуницировать с кем-либо вне участников сессии."})]}),n.jsx("p",{className:"text-xs uppercase tracking-wide opacity-70 mt-2",children:"Обязано:"}),n.jsxs("ul",{className:"space-y-1",children:[n.jsx("li",{children:"• Следовать инструкциям ведущего и оперативно исполнять распоряжения."}),n.jsx("li",{children:"• Сохранять корректность и нейтральность в коммуникации."}),n.jsx("li",{children:"• Обеспечивать техническую готовность: связь, устройство, ПО."})]})]})]}),n.jsxs("div",{className:`rounded-2xl border p-4 sm:p-5 space-y-2 ${s==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white"}`,children:[n.jsx("p",{className:"text-base font-semibold text-[#4E6E49]",children:"4. Политика перерывов"}),n.jsxs("ul",{className:"space-y-1",children:[n.jsx("li",{children:"• Краткий перерыв — до 10 минут каждые 45 минут."}),n.jsx("li",{children:"• Большой перерыв — до 45 минут каждые 3 часа активной торговли."}),n.jsx("li",{children:"• Все перерывы объявляет ведущий."}),n.jsx("li",{children:"• Самовольные перерывы запрещены; нарушение дисциплины, если не согласовано в трекере слотов и с ответственным."})]})]}),n.jsxs("div",{className:`rounded-2xl border p-4 sm:p-5 space-y-2 ${s==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white"}`,children:[n.jsx("p",{className:"text-base font-semibold text-[#4E6E49]",children:"5. Правила записи сессий"}),n.jsxs("ul",{className:"space-y-1",children:[n.jsx("li",{children:"• Запись включает только ведущий или ответственный за сообщество."}),n.jsx("li",{children:"• Хранение — в закрытом архиве команды; доступ: ведущий, управляющий сообществом, ответственные аналитики."}),n.jsx("li",{children:"• Распространение вне команды запрещено."}),n.jsx("li",{children:"• Срок хранения определяет ведущий: до 3 лет, но ≥14 календарных дней."})]})]}),n.jsxs("div",{className:`rounded-2xl border p-4 sm:p-5 space-y-2 ${s==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white"}`,children:[n.jsx("p",{className:"text-base font-semibold text-[#4E6E49]",children:"6. Конфликт интересов"}),n.jsxs("ul",{className:"space-y-1",children:[n.jsx("li",{children:"• Запрещено действовать в интересах сторонних групп/конкурентов."}),n.jsx("li",{children:"• Запрещено передавать стратегию, аналитику, материалы, алгоритмы, сигналы и методики ApeVault третьим лицам."}),n.jsx("li",{children:"• Запрещено получать вознаграждение за внешние консультации, использующие опыт или данные ApeVault."}),n.jsx("li",{children:"• Запрещено участвовать в параллельных торговых группах, если это создаёт риск конфликта или утечки информации."})]})]}),n.jsxs("div",{className:`rounded-2xl border p-4 sm:p-5 space-y-2 ${s==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white"}`,children:[n.jsx("p",{className:"text-base font-semibold text-[#4E6E49]",children:"7. Конфиденциальность"}),n.jsxs("ul",{className:"space-y-1",children:[n.jsx("li",{children:"• Все материалы, данные, аналитика, торговые решения и внутренняя коммуникация — интеллектуальная собственность ApeVault."}),n.jsx("li",{children:"• Запрещено копировать, распространять или передавать информацию третьим лицам."}),n.jsx("li",{children:"• Запрещено создавать производные материалы без согласования с ответственным."}),n.jsx("li",{children:"• Запрещено публиковать скриншоты, отчёты или содержимое сессий в открытых источниках (кроме чата команды)."}),n.jsx("li",{children:"• Требование к среде: наушники и отсутствие посторонних рядом; не допускать, чтобы экран/звук были доступны третьим лицам."}),n.jsx("li",{className:"font-semibold text-[#4E6E49]",children:"Нарушение положений конфиденциальности — основание для немедленного исключения."})]})]})]})}),n.jsx(pr,{title:"Классификация нарушений",description:"Три уровня тяжести определяют, как быстро применяются ограничения.",children:n.jsxs("div",{className:"grid gap-4 lg:grid-cols-3",children:[n.jsxs("div",{className:`rounded-2xl border p-4 sm:p-5 ${s==="dark"?"border-white/10 bg-white/5":"border-amber-100 bg-white/95"}`,children:[n.jsxs("div",{className:"flex items-center gap-2 text-sm font-semibold text-amber-600 dark:text-amber-300",children:[n.jsx($s,{className:"w-4 h-4"}),"Незначительные"]}),n.jsx("ul",{className:`text-sm mt-2 space-y-1 ${t}`,children:a.map(c=>n.jsxs("li",{children:["• ",c]},c))})]}),n.jsxs("div",{className:`rounded-2xl border p-4 sm:p-5 ${s==="dark"?"border-white/10 bg-white/5":"border-orange-100 bg-white/95"}`,children:[n.jsxs("div",{className:"flex items-center gap-2 text-sm font-semibold text-orange-600 dark:text-orange-300",children:[n.jsx(Xt,{className:"w-4 h-4"}),"Средние"]}),n.jsx("ul",{className:`text-sm mt-2 space-y-1 ${t}`,children:i.map(c=>n.jsxs("li",{children:["• ",c]},c))})]}),n.jsxs("div",{className:`rounded-2xl border p-4 sm:p-5 ${s==="dark"?"border-white/10 bg-white/5":"border-rose-100 bg-white/95"}`,children:[n.jsxs("div",{className:"flex items-center gap-2 text-sm font-semibold text-rose-600 dark:text-rose-300",children:[n.jsx(Ci,{className:"w-4 h-4"}),"Грубые"]}),n.jsx("ul",{className:`text-sm mt-2 space-y-1 ${t}`,children:o.map(c=>n.jsxs("li",{children:["• ",c]},c))})]})]})}),n.jsx(pr,{title:"Меры дисциплинарного воздействия и ограничения",description:"Применяются последовательно, кроме случаев грубых нарушений.",children:n.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[n.jsxs("div",{className:`rounded-2xl border p-4 sm:p-5 space-y-2 ${s==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white"}`,children:[n.jsxs("div",{className:"flex items-center gap-2 text-sm font-semibold text-[#4E6E49]",children:[n.jsx(_m,{className:"w-4 h-4"}),"Порядок эскалации"]}),n.jsxs("ul",{className:`text-sm space-y-1 ${t}`,children:[n.jsx("li",{children:"• Напоминания — не более 1 в неделю, без последствий."}),n.jsx("li",{children:"• Предупреждения — не более 2 в неделю, при повторении незначительных или единичном среднем нарушении."}),n.jsx("li",{children:"• Выговоры — не более 2 в неделю, назначаются ведущим сессии или ответственным за сообщество."})]})]}),n.jsxs("div",{className:`rounded-2xl border p-4 sm:p-5 space-y-2 ${s==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white"}`,children:[n.jsxs("div",{className:"flex items-center gap-2 text-sm font-semibold text-[#4E6E49]",children:[n.jsx(Ci,{className:"w-4 h-4"}),"Ограничительные меры"]}),n.jsxs("ul",{className:`text-sm space-y-1 ${t}`,children:[n.jsx("li",{children:"• Ограничение доступа к торговым сессиям: 1-е — ≥3 дней; повторное — 1 неделя; систематическое — 2 недели; дальше — исключение без восстановления."}),n.jsx("li",{children:"• Немедленное исключение без эскалации за грубое нарушение, оскорбления, провокации или угрозу финансам/безопасности/репутации."})]})]})]})}),n.jsx(pr,{title:"Финансовые последствия",description:"Что происходит при систематических нарушениях и невыполнении мер.",children:n.jsx("div",{className:`rounded-2xl border p-4 sm:p-5 space-y-2 ${s==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white"}`,children:n.jsxs("ul",{className:`text-sm space-y-2 ${t}`,children:[n.jsx("li",{children:"• При систематических нарушениях и игнорировании мер может быть отказано в удовлетворении заявки на вывод средств, включая заработок за успешные сессии."}),n.jsx("li",{children:"• Перераспределение заработка: удержанные средства делятся между участниками, кроме тех, кто допустил два и более нарушений в неделю или более 6 нарушений в месяц."}),n.jsx("li",{children:"• Добровольно внесённые в пул или кошелёк команды средства не возвращаются при досрочном выходе или исключении за нарушения."})]})})}),n.jsx(pr,{title:"Фиксация нарушений и апелляции",description:"Прозрачный процесс учёта нарушений и возможность обжаловать решение.",children:n.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[n.jsxs("div",{className:`rounded-2xl border p-4 sm:p-5 space-y-2 ${s==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white"}`,children:[n.jsxs("div",{className:"flex items-center gap-2 text-sm font-semibold text-[#4E6E49]",children:[n.jsx(vr,{className:"w-4 h-4"}),"Порядок фиксации"]}),n.jsxs("ul",{className:`text-sm space-y-1 ${t}`,children:[n.jsx("li",{children:"• Все нарушения фиксируются ответственным за сообщество в отдельной ветви командного чата Telegram."}),n.jsx("li",{children:"• Обязательная фиксация: дата и время, тип нарушения, краткое описание ситуации, применённая мера."})]})]}),n.jsxs("div",{className:`rounded-2xl border p-4 sm:p-5 space-y-2 ${s==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white"}`,children:[n.jsxs("div",{className:"flex items-center gap-2 text-sm font-semibold text-[#4E6E49]",children:[n.jsx(Ks,{className:"w-4 h-4"}),"Процедура апелляции"]}),n.jsxs("ul",{className:`text-sm space-y-1 ${t}`,children:[n.jsx("li",{children:"• Апелляция подаётся в течение 24 часов с момента уведомления о мере."}),n.jsx("li",{children:"• Подача: ответственному за сообщество или назначенному куратору."}),n.jsx("li",{children:"• Рассмотрение: до 60 часов; решение окончательное."})]})]})]})}),n.jsx(pr,{title:"Принцип равного применения",description:"Меры действуют одинаково для всех участников.",children:n.jsx("div",{className:`rounded-2xl border p-4 sm:p-5 space-y-1 ${s==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white"}`,children:n.jsx("p",{className:`text-sm ${t}`,children:"Дисциплинарные меры применяются ко всем участникам независимо от стажа, роли в проекте, вклада, личных отношений или результатов торговых сессий. Привилегии и исключения не допускаются."})})}),n.jsx(pr,{title:"Определения",description:"Ключевые термины, чтобы избежать двусмысленностей.",children:n.jsx("div",{className:"grid gap-4 md:grid-cols-2",children:l.map(c=>n.jsxs("div",{className:`rounded-2xl border p-4 sm:p-5 space-y-1 ${s==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white"}`,children:[n.jsx("p",{className:"text-sm font-semibold text-[#4E6E49]",children:c.term}),n.jsx("p",{className:`text-sm ${t}`,children:c.text})]},c.term))})}),n.jsx(pr,{title:"Заключительные положения",description:"Кто может обновлять раздел и обязанность ознакомления.",children:n.jsx("div",{className:`rounded-2xl border p-4 sm:p-5 space-y-2 ${s==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-white"}`,children:n.jsxs("ul",{className:`text-sm space-y-1 ${t}`,children:[n.jsx("li",{children:"• Ответственный за сообщество или исполняющий обязанности оставляет за собой право корректировать и обновлять раздел при изменении процессов или структуры платформы."}),n.jsx("li",{children:"• Все участники обязаны ознакомиться с настоящей политикой и соблюдать её безусловно."})]})})})]})},sD={create:"Создание",update:"Изменение",delete:"Удаление"},rD={slot:"Слот",status:"Статус",earning:"Заработок",referral:"Реферал",login:"Ник"},nD={pending:"bg-amber-50 text-amber-900 border border-amber-200 shadow-inner dark:bg-amber-900/25 dark:text-amber-50 dark:border-amber-700",approved:"bg-emerald-50 text-emerald-900 border border-emerald-200 shadow-inner dark:bg-emerald-900/25 dark:text-emerald-50 dark:border-emerald-700",rejected:"bg-rose-50 text-rose-900 border border-rose-200 shadow-inner dark:bg-rose-900/25 dark:text-rose-50 dark:border-rose-700"},aD={pending:n.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-semibold bg-amber-100 text-amber-900 dark:bg-amber-900/40 dark:text-amber-100",children:[n.jsx(Ks,{className:"w-3 h-3"})," На согласовании"]}),approved:n.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-semibold bg-emerald-100 text-emerald-900 dark:bg-emerald-900/40 dark:text-emerald-100",children:[n.jsx(Qi,{className:"w-3 h-3"})," Принято"]}),rejected:n.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-semibold bg-rose-100 text-rose-900 dark:bg-rose-900/40 dark:text-rose-100",children:[n.jsx(gw,{className:"w-3 h-3"})," Отклонено"]})},Yi=s=>{if(!s)return"—";try{return oe(s,"dd.MM.yyyy")}catch{return"—"}},Np=s=>{var t,r;if(!s)return"—";const e=(r=(t=s.slots)==null?void 0:t.map(a=>`${a.start}-${a.end}${a.endDate?` (до ${Yi(a.endDate)})`:""}`))==null?void 0:r.join(", ");return`${Yi(s.date)}${e?` · ${e}`:""}`},jp=s=>{if(!s)return"—";const e=s.type==="dayoff"?"Выходной":s.type==="sick"?"Больничный":"Отпуск",t=s.endDate?` (${Yi(s.endDate)})`:"";return`${Yi(s.date)} · ${e}${t}`},iD=()=>{const{user:s}=_t(),{isAdmin:e}=Ct(),[t,r]=I.useState([]),[a,i]=I.useState(!0),[o,l]=I.useState(null),[c,h]=I.useState(!1),[u,m]=I.useState([]),[g,p]=I.useState(null),j=async()=>{i(!0),p(null);try{const C=await vb();let N=C;if(e){const b=new Date;b.setHours(b.getHours()-60),N=C.filter(v=>new Date(v.createdAt)>=b)}r(N)}catch(C){console.error("Не удалось загрузить заявки на согласование",C),p("Не удалось загрузить заявки")}finally{i(!1)}};I.useEffect(()=>{j()},[]);const _=async C=>{if(!o){l(C),p(null);try{const N=t.find(b=>b.id===C);await tf(C,(s==null?void 0:s.id)||"admin"),(N==null?void 0:N.entity)==="login"&&(Gd(N.targetUserId),await Ir(N.targetUserId),window.dispatchEvent(new CustomEvent("nicknameUpdated",{detail:{userId:N.targetUserId}}))),await j(),m(b=>b.filter(v=>v!==C))}catch(N){console.error("Ошибка при подтверждении",N),p(`Не удалось подтвердить заявку: ${(N==null?void 0:N.message)||N}`),await j()}finally{l(null)}}},y=async C=>{if(o)return;const N=prompt("Комментарий для отклонения заявки","Уточните детали")||"Отклонено без комментария";l(C),p(null);try{await sf(C,(s==null?void 0:s.id)||"admin",N),await j()}catch(b){console.error("Ошибка при отклонении",b),p("Не удалось отклонить заявку")}finally{l(null)}},M=async()=>{if(!(c||o||u.length===0)){h(!0),p(null);try{for(const C of u){const N=t.find(b=>b.id===C);await tf(C,(s==null?void 0:s.id)||"admin"),(N==null?void 0:N.entity)==="login"&&(Gd(N.targetUserId),await Ir(N.targetUserId),window.dispatchEvent(new CustomEvent("nicknameUpdated",{detail:{userId:N.targetUserId}})))}await j(),m([])}catch(C){console.error("Ошибка при подтверждении выбранных",C),p(`Не удалось подтвердить выбранные заявки: ${(C==null?void 0:C.message)||C}`),await j()}finally{h(!1)}}},D=async()=>{if(c||o||u.length===0)return;const C=prompt("Комментарий для отклонения выбранных заявок","Отклонено без комментария")||"Отклонено без комментария";if(C!==null){h(!0),p(null);try{for(const N of u)await sf(N,(s==null?void 0:s.id)||"admin",C);await j(),m([])}catch(N){console.error("Ошибка при отклонении выбранных",N),p(`Не удалось отклонить выбранные заявки: ${(N==null?void 0:N.message)||N}`),await j()}finally{h(!1)}}},T=C=>{m(N=>N.includes(C)?N.filter(b=>b!==C):[...N,C])},R=()=>{const C=t.filter(b=>b.status==="pending").map(b=>b.id),N=C.every(b=>u.includes(b));m(N?[]:C)},P=C=>{if(C.entity==="login"){const N=C.before,b=C.after,v=(N==null?void 0:N.nickname)||"—",S=(b==null?void 0:b.nickname)||"—";return`${v} → ${S}`}if(C.entity==="slot"){const N=C.before,b=C.after;return`${Np(N)} → ${Np(b)}`}if(C.entity==="status"){const N=C.before,b=C.after;return`${jp(N)} → ${jp(b)}`}return C.after?"Изменение":C.before?"Удаление":"Создание"};return a?n.jsx("div",{className:"rounded-xl border border-gray-200 dark:border-gray-800 p-6 text-center text-sm text-gray-600 dark:text-gray-300",children:"Загружаем заявки..."}):n.jsxs("div",{className:"rounded-xl border border-gray-200 dark:border-gray-800 overflow-hidden shadow-sm",children:[n.jsxs("div",{className:"p-4 sm:p-5 border-b border-gray-200 dark:border-gray-800 flex items-center justify-between",children:[n.jsxs("div",{children:[n.jsx("p",{className:"text-lg font-semibold",children:"Согласования"}),n.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Заявки на изменение слотов и статусов"})]}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("button",{onClick:M,disabled:c||o!==null||u.length===0,className:"text-sm px-3 py-2 rounded-lg bg-emerald-600 hover:bg-emerald-700 disabled:bg-emerald-400 text-white font-semibold",children:c?"Подтверждаем...":`Принять выбранные (${u.length})`}),n.jsx("button",{onClick:D,disabled:c||o!==null||u.length===0,className:"text-sm px-3 py-2 rounded-lg bg-rose-600 hover:bg-rose-700 disabled:bg-rose-400 text-white font-semibold",children:c?"Отклоняем...":`Отклонить выбранные (${u.length})`}),n.jsx("button",{onClick:j,className:"text-sm px-3 py-2 rounded-lg bg-gray-100 hover:bg-gray-200 dark:bg-gray-800 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-200",children:"Обновить"})]})]}),g&&n.jsx("div",{className:"px-4 py-3 bg-rose-100 text-rose-900 dark:bg-rose-900/30 dark:text-rose-100 text-sm",children:g}),n.jsx("div",{className:"overflow-x-auto",children:n.jsxs("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-800 text-sm",children:[n.jsx("thead",{className:"bg-gray-50 dark:bg-gray-900/40",children:n.jsxs("tr",{children:[n.jsx("th",{className:"px-4 py-3 text-left font-semibold text-gray-700 dark:text-gray-200",children:"Статус"}),n.jsx("th",{className:"px-4 py-3 text-left font-semibold text-gray-700 dark:text-gray-200",children:"Тип"}),n.jsx("th",{className:"px-4 py-3 text-left font-semibold text-gray-700 dark:text-gray-200",children:"Действие"}),n.jsx("th",{className:"px-4 py-3 text-left font-semibold text-gray-700 dark:text-gray-200",children:"Кто"}),n.jsx("th",{className:"px-4 py-3 text-left font-semibold text-gray-700 dark:text-gray-200",children:"Изменение"}),n.jsx("th",{className:"px-4 py-3 text-left font-semibold text-gray-700 dark:text-gray-200",children:"Комментарий"}),n.jsx("th",{className:"px-4 py-3 text-left font-semibold text-gray-700 dark:text-gray-200",children:"Действия"}),n.jsx("th",{className:"px-4 py-3 text-left font-semibold text-gray-700 dark:text-gray-200",children:n.jsx("button",{onClick:R,className:"inline-flex items-center gap-1 text-sm text-[#4E6E49] hover:text-emerald-700",title:"Выбрать все на согласовании",children:t.some(C=>C.status==="pending")?n.jsxs(n.Fragment,{children:[t.filter(C=>C.status==="pending").every(C=>u.includes(C.id))?n.jsx(Sr,{className:"w-4 h-4"}):n.jsx(Bc,{className:"w-4 h-4"})," Все"]}):n.jsx(Bc,{className:"w-4 h-4 opacity-50"})})})]})}),n.jsxs("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-800",children:[t.map(C=>n.jsxs("tr",{className:`bg-white dark:bg-[#0f1624] ${nD[C.status]}`,children:[n.jsx("td",{className:"px-4 py-3 align-top",children:aD[C.status]}),n.jsx("td",{className:"px-4 py-3 align-top font-semibold",children:rD[C.entity]}),n.jsx("td",{className:"px-4 py-3 align-top",children:sD[C.action]}),n.jsx("td",{className:"px-4 py-3 align-top",children:n.jsxs("div",{className:"flex flex-col gap-1",children:[n.jsx("span",{className:"font-semibold",children:n.jsx(xn,{userId:C.targetUserId})}),n.jsxs("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:["Автор: ",n.jsx(xn,{userId:C.authorId})]}),n.jsxs("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:["Создано: ",Yi(C.createdAt)," "]})]})}),n.jsxs("td",{className:"px-4 py-3 align-top",children:[n.jsx("div",{className:"text-xs sm:text-sm font-medium",children:P(C)}),C.after&&C.entity==="slot"&&C.after.comment&&n.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:["Комментарий слота: ",C.after.comment]}),C.after&&C.entity==="status"&&C.after.comment&&n.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:["Комментарий статуса: ",C.after.comment]})]}),n.jsxs("td",{className:"px-4 py-3 align-top",children:[n.jsx("div",{className:"text-xs sm:text-sm text-gray-700 dark:text-gray-200 whitespace-pre-wrap",children:C.comment||"—"}),C.adminComment&&n.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:["Ответ админа: ",C.adminComment]})]}),n.jsx("td",{className:"px-4 py-3 align-top",children:C.status==="pending"?n.jsxs("div",{className:"flex flex-col gap-2",children:[n.jsx("button",{onClick:()=>_(C.id),disabled:!!o,className:"px-3 py-2 rounded-lg bg-emerald-600 hover:bg-emerald-700 disabled:bg-emerald-400 text-white text-xs sm:text-sm font-semibold",children:o===C.id?"Применяем...":"Подтвердить и применить"}),n.jsx("button",{onClick:()=>y(C.id),disabled:!!o,className:"px-3 py-2 rounded-lg bg-rose-600 hover:bg-rose-700 disabled:bg-rose-400 text-white text-xs sm:text-sm font-semibold",children:o===C.id?"Отклоняем...":"Отклонить"})]}):n.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Действие выполнено"})}),n.jsx("td",{className:"px-4 py-3 align-top",children:C.status==="pending"?n.jsxs("button",{onClick:()=>T(C.id),className:"inline-flex items-center gap-1 text-sm text-[#4E6E49] hover:text-emerald-700",children:[u.includes(C.id)?n.jsx(Sr,{className:"w-4 h-4"}):n.jsx(Bc,{className:"w-4 h-4"}),n.jsx("span",{className:"sr-only",children:"Выбрать заявку"})]}):n.jsx("span",{className:"text-xs text-gray-400",children:"—"})})]},C.id)),t.length===0&&n.jsx("tr",{children:n.jsx("td",{colSpan:7,className:"px-4 py-6 text-center text-sm text-gray-500 dark:text-gray-400",children:"Нет заявок на согласование"})})]})]})})]})},oD=()=>{const{isAdmin:s}=Ct();return s?n.jsxs("div",{className:"max-w-6xl mx-auto px-4 sm:px-6 py-6 sm:py-8 space-y-6",children:[n.jsxs("div",{children:[n.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Администрирование"}),n.jsx("h1",{className:"text-2xl sm:text-3xl font-bold",children:"Согласования изменений"}),n.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Подтверждайте или отклоняйте изменения слотов, перерывов и статусов участников."})]}),n.jsx(iD,{})]}):n.jsx(dl,{to:"/management",replace:!0})},lD=()=>{const{theme:s}=lt(),e=s==="dark"?"text-gray-400":"text-gray-600",t=s==="dark"?"text-white":"text-gray-900",r=s==="dark"?"bg-[#10141c]":"bg-white",a="border-[#48a35e]/60",i=s==="dark"?"shadow-[0_24px_80px_rgba(0,0,0,0.45)]":"shadow-[0_24px_80px_rgba(0,0,0,0.15)]",o=s==="dark"?"bg-[#10141c]":"bg-white",l=s==="dark"?"border-[#48a35e]/60":"border-[#48a35e]/40",c=s==="dark"?"shadow-[0_24px_80px_rgba(0,0,0,0.45)]":"shadow-[0_24px_80px_rgba(0,0,0,0.1)]",h=s==="dark"?"bg-white/10 border-white/20":"bg-[#4E6E49]/10 border-[#4E6E49]/30",u=s==="dark"?"text-white":"text-[#4E6E49]",m=s==="dark"?"bg-white/10 border-white/20":"bg-gray-100 border-gray-300",g=s==="dark"?"text-white":"text-gray-800";return I.useEffect(()=>{const p=()=>{const C=document.querySelectorAll(".meme-checkbox"),N=document.getElementById("meme-progress-fill"),b=document.getElementById("meme-checked-count"),v=document.getElementById("meme-total-count"),S=document.getElementById("meme-progress-percentage");!C.length||!N||!b||!v||!S||(v.textContent=C.length.toString(),y(),C.forEach(E=>{E.addEventListener("change",j)}))},j=()=>{const C=document.querySelectorAll(".meme-checkbox"),N=document.querySelectorAll(".meme-checkbox:checked"),b=document.getElementById("meme-progress-fill"),v=document.getElementById("meme-checked-count"),S=document.getElementById("meme-progress-percentage");if(!b||!v||!S)return;const E=N.length,k=C.length,w=Math.round(E/k*100);v.textContent=E.toString(),S.textContent=w+"%",b.style.width=w+"%",C.forEach(Q=>{const ae=Q,V=Q.closest(".meme-item");ae.checked?V==null||V.classList.add("completed"):V==null||V.classList.remove("completed")}),_()},_=()=>{const C=document.querySelectorAll(".meme-checkbox"),N={};C.forEach(b=>{const v=b;N[v.id]=v.checked}),localStorage.setItem("memeChecklistProgress",JSON.stringify(N))},y=()=>{const C=document.querySelectorAll(".meme-checkbox"),N=localStorage.getItem("memeChecklistProgress");if(N){const b=JSON.parse(N);C.forEach(v=>{var E;const S=v;b[S.id]&&(S.checked=!0,(E=S.closest(".meme-item"))==null||E.classList.add("completed"))}),M()}},M=()=>{const C=document.querySelectorAll(".meme-checkbox"),N=document.querySelectorAll(".meme-checkbox:checked"),b=document.getElementById("meme-progress-fill"),v=document.getElementById("meme-checked-count"),S=document.getElementById("meme-progress-percentage");if(!b||!v||!S)return;const E=N.length,k=C.length,w=Math.round(E/k*100);v.textContent=E.toString(),S.textContent=w+"%",b.style.width=w+"%"},D=()=>{document.querySelectorAll(".meme-checkbox").forEach(N=>{var v;const b=N;b.checked=!1,(v=b.closest(".meme-item"))==null||v.classList.remove("completed")}),localStorage.removeItem("memeChecklistProgress"),M()},T=document.getElementById("meme-reset-button");T&&T.addEventListener("click",D),document.querySelectorAll(".meme-stage-title").forEach(C=>{C.addEventListener("click",N=>{const b=N.currentTarget.closest(".meme-stage");b==null||b.scrollIntoView({behavior:"smooth",block:"start"})})});const R={threshold:.1,rootMargin:"0px 0px -50px 0px"},P=new IntersectionObserver(C=>{C.forEach(N=>{N.isIntersecting&&N.target.setAttribute("style","opacity: 1; transform: translateY(0);")})},R);document.querySelectorAll(".meme-stage").forEach(C=>{C.setAttribute("style","opacity: 0; transform: translateY(30px); transition: opacity 0.6s ease, transform 0.6s ease;"),P.observe(C)}),p()},[]),n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:"space-y-6",children:[n.jsxs("div",{className:`relative overflow-hidden rounded-3xl border ${l} ${c} ${o}`,children:[n.jsxs("div",{className:"absolute inset-0 pointer-events-none",children:[n.jsx("div",{className:"absolute -left-16 -bottom-10 w-80 h-80 bg-emerald-500/18 blur-3xl"}),n.jsx("div",{className:`absolute inset-0 ${s==="dark"?"bg-[radial-gradient(circle_at_50%_0%,rgba(255,255,255,0.08),transparent_45%)]":"bg-[radial-gradient(circle_at_50%_0%,rgba(78,110,73,0.05),transparent_45%)]"}`})]}),n.jsx("div",{className:"relative p-6 sm:p-8 space-y-6",children:n.jsx("div",{className:"flex flex-col gap-4 lg:flex-row lg:items-start lg:justify-between",children:n.jsx("div",{className:"space-y-3 max-w-3xl",children:n.jsxs("div",{className:"flex items-start gap-3",children:[n.jsx("div",{className:`p-3 rounded-2xl ${h} ${u} shadow-inner`,children:n.jsx("span",{className:"text-2xl",children:"🐊"})}),n.jsxs("div",{className:"space-y-2",children:[n.jsx("h1",{className:`text-3xl sm:text-4xl font-black ${s==="dark"?"text-white":"text-gray-900"} leading-tight`,children:"Оценка мемкоина"}),n.jsx("p",{className:`text-sm ${s==="dark"?"text-white/70":"text-gray-600"}`,children:"Полный чек-лист проверки мемкоина. Систематический анализ для безопасного входа."}),n.jsx("div",{className:"flex flex-wrap gap-2",children:["Базовые метрики","Бандлы","Сообщество","DEV анализ"].map((p,j)=>n.jsx("span",{className:`px-4 py-1.5 rounded-full text-xs font-semibold border ${j===0?"bg-emerald-500 text-white border-emerald-300/60 shadow-md":`${m} ${g} border-gray-300`}`,children:p},p))})]})]})})})})]}),n.jsxs("div",{className:"space-y-6",children:[n.jsxs("div",{className:`meme-stage rounded-2xl p-6 sm:p-7 ${r} ${i} border ${a}`,children:[n.jsxs("div",{className:"flex flex-col gap-2 mb-6",children:[n.jsx("p",{className:`text-xs uppercase tracking-[0.12em] ${e}`,children:"Этап 1"}),n.jsx("h3",{className:`text-2xl font-bold ${t}`,children:"Базовые метрики (первичный фильтр)"}),n.jsx("p",{className:`text-sm ${e}`,children:"Убираем мусор, скам и неподходящие ранние фазы проекта."})]}),n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{className:`meme-item flex items-start gap-4 p-4 rounded-xl border ${s==="dark"?"border-white/10 bg-white/5 hover:bg-white/10":"border-gray-200 bg-gray-50 hover:bg-gray-100"} transition-all duration-200`,children:[n.jsx("input",{type:"checkbox",id:"meme-1-1",className:"meme-checkbox w-5 h-5 mt-1 accent-[#4E6E49] rounded flex-shrink-0"}),n.jsxs("label",{htmlFor:"meme-1-1",className:"flex-1 cursor-pointer",children:[n.jsx("strong",{className:`font-semibold block mb-2 ${t}`,children:"Market Cap"}),n.jsxs("ul",{className:`space-y-1 text-sm ${e}`,children:[n.jsx("li",{children:"• Капа ≤ 100k (оптимально 20–80k)."}),n.jsx("li",{children:"• Резкий скачок капы на старте без реальной ликвидности — минус."})]})]})]}),n.jsxs("div",{className:"meme-item flex items-start gap-4 p-4 rounded-xl ${theme === 'dark' ? 'border-white/10 bg-white/5 hover:bg-white/10' : 'border-gray-200 bg-gray-50 hover:bg-gray-100'} transition-all duration-200",children:[n.jsx("input",{type:"checkbox",id:"meme-1-2",className:"meme-checkbox w-5 h-5 mt-1 accent-[#4E6E49] rounded flex-shrink-0"}),n.jsxs("label",{htmlFor:"meme-1-2",className:"flex-1 cursor-pointer",children:[n.jsx("strong",{className:`font-semibold block mb-2 ${t}`,children:"Объём торгов"}),n.jsxs("ul",{className:`space-y-1 text-sm ${e}`,children:[n.jsx("li",{children:"• Объём > капы в 1.5–2 раза (лучше 2.5–3)."}),n.jsx("li",{children:"• Проверить синхронность: объём должен совпадать с движением цены."})]})]})]}),n.jsxs("div",{className:"meme-item flex items-start gap-4 p-4 rounded-xl ${theme === 'dark' ? 'border-white/10 bg-white/5 hover:bg-white/10' : 'border-gray-200 bg-gray-50 hover:bg-gray-100'} transition-all duration-200",children:[n.jsx("input",{type:"checkbox",id:"meme-1-3",className:"meme-checkbox w-5 h-5 mt-1 accent-[#4E6E49] rounded flex-shrink-0"}),n.jsxs("label",{htmlFor:"meme-1-3",className:"flex-1 cursor-pointer",children:[n.jsx("strong",{className:`font-semibold block mb-2 ${t}`,children:"Холдеры"}),n.jsxs("ul",{className:`space-y-1 text-sm ${e}`,children:[n.jsx("li",{children:"• Рост холдеров стабильный, без искусственных всплесков."}),n.jsx("li",{children:"• Проверить уникальность кошельков."})]})]})]}),n.jsxs("div",{className:"meme-item flex items-start gap-4 p-4 rounded-xl ${theme === 'dark' ? 'border-white/10 bg-white/5 hover:bg-white/10' : 'border-gray-200 bg-gray-50 hover:bg-gray-100'} transition-all duration-200",children:[n.jsx("input",{type:"checkbox",id:"meme-1-4",className:"meme-checkbox w-5 h-5 mt-1 accent-[#4E6E49] rounded flex-shrink-0"}),n.jsxs("label",{htmlFor:"meme-1-4",className:"flex-1 cursor-pointer",children:[n.jsx("strong",{className:`font-semibold block mb-2 ${t}`,children:"График"}),n.jsxs("ul",{className:"text-gray-700 dark:text-gray-300 space-y-1 text-sm",children:[n.jsx("li",{children:"• Органичный график, без параболического роста."}),n.jsx("li",{children:"• Нет вертикальных ракет на старте."})]})]})]}),n.jsxs("div",{className:"meme-item flex items-start gap-4 p-4 rounded-xl ${theme === 'dark' ? 'border-white/10 bg-white/5 hover:bg-white/10' : 'border-gray-200 bg-gray-50 hover:bg-gray-100'} transition-all duration-200",children:[n.jsx("input",{type:"checkbox",id:"meme-1-5",className:"meme-checkbox w-5 h-5 mt-1 accent-[#4E6E49] rounded flex-shrink-0"}),n.jsxs("label",{htmlFor:"meme-1-5",className:"flex-1 cursor-pointer",children:[n.jsx("strong",{className:`font-semibold block mb-2 ${t}`,children:"Ликвидность"}),n.jsxs("ul",{className:`space-y-1 text-sm ${e}`,children:[n.jsx("li",{children:"• Ликвидность > 15k (лучше 25–40k)."}),n.jsx("li",{children:"• Проверить соотношение ликвидности к капе."})]})]})]})]})]}),n.jsxs("div",{className:`meme-stage rounded-2xl p-6 sm:p-7 ${r} ${i} border ${a}`,children:[n.jsxs("div",{className:"flex flex-col gap-2 mb-6",children:[n.jsx("p",{className:`text-xs uppercase tracking-[0.12em] ${e}`,children:"Этап 2"}),n.jsx("h3",{className:`text-2xl font-bold ${t}`,children:"Бандлы (MEV-активность)"}),n.jsx("p",{className:`text-sm ${e}`,children:"Анализ влияния бандлеров на токен и рыночную манипуляцию."})]}),n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{className:"meme-item flex items-start gap-4 p-4 rounded-xl ${theme === 'dark' ? 'border-white/10 bg-white/5 hover:bg-white/10' : 'border-gray-200 bg-gray-50 hover:bg-gray-100'} transition-all duration-200",children:[n.jsx("input",{type:"checkbox",id:"meme-2-1",className:"meme-checkbox w-5 h-5 mt-1 accent-[#4E6E49] rounded flex-shrink-0"}),n.jsxs("label",{htmlFor:"meme-2-1",className:"flex-1 cursor-pointer",children:[n.jsx("strong",{className:`font-semibold block mb-2 ${t}`,children:"Откуплено бандлами"}),n.jsx("ul",{className:`space-y-1 text-sm ${e}`,children:n.jsx("li",{children:"• ≤ 100, максимум 200 SOL за весь период."})})]})]}),n.jsxs("div",{className:"meme-item flex items-start gap-4 p-4 rounded-xl ${theme === 'dark' ? 'border-white/10 bg-white/5 hover:bg-white/10' : 'border-gray-200 bg-gray-50 hover:bg-gray-100'} transition-all duration-200",children:[n.jsx("input",{type:"checkbox",id:"meme-2-2",className:"meme-checkbox w-5 h-5 mt-1 accent-[#4E6E49] rounded flex-shrink-0"}),n.jsxs("label",{htmlFor:"meme-2-2",className:"flex-1 cursor-pointer",children:[n.jsx("strong",{className:`font-semibold block mb-2 ${t}`,children:"Остаток бандлов"}),n.jsx("ul",{className:`space-y-1 text-sm ${e}`,children:n.jsx("li",{children:"• ≤ 30 SOL."})})]})]})]})]}),n.jsxs("div",{className:`meme-stage rounded-2xl p-6 sm:p-7 ${r} ${i} border ${a}`,children:[n.jsxs("div",{className:"flex flex-col gap-2 mb-6",children:[n.jsx("p",{className:`text-xs uppercase tracking-[0.12em] ${e}`,children:"Этап 3"}),n.jsx("h3",{className:`text-2xl font-bold ${t}`,children:"Сообщество и социальные сети"}),n.jsx("p",{className:`text-sm ${e}`,children:"Проверка органичности сообщества и качества информационного поля."})]}),n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{className:"meme-item flex items-start gap-4 p-4 rounded-xl ${theme === 'dark' ? 'border-white/10 bg-white/5 hover:bg-white/10' : 'border-gray-200 bg-gray-50 hover:bg-gray-100'} transition-all duration-200",children:[n.jsx("input",{type:"checkbox",id:"meme-3-1",className:"meme-checkbox w-5 h-5 mt-1 accent-[#4E6E49] rounded flex-shrink-0"}),n.jsxs("label",{htmlFor:"meme-3-1",className:"flex-1 cursor-pointer",children:[n.jsx("strong",{className:`font-semibold block mb-2 ${t}`,children:"Twitter"}),n.jsxs("ul",{className:`space-y-1 text-sm ${e}`,children:[n.jsx("li",{children:"• Посты каждые 1–3 минуты в первые часы."}),n.jsx("li",{children:"• Рост подписчиков органичный."})]})]})]}),n.jsxs("div",{className:"meme-item flex items-start gap-4 p-4 rounded-xl ${theme === 'dark' ? 'border-white/10 bg-white/5 hover:bg-white/10' : 'border-gray-200 bg-gray-50 hover:bg-gray-100'} transition-all duration-200",children:[n.jsx("input",{type:"checkbox",id:"meme-3-2",className:"meme-checkbox w-5 h-5 mt-1 accent-[#4E6E49] rounded flex-shrink-0"}),n.jsxs("label",{htmlFor:"meme-3-2",className:"flex-1 cursor-pointer",children:[n.jsx("strong",{className:`font-semibold block mb-2 ${t}`,children:"Сайт"}),n.jsx("ul",{className:`space-y-1 text-sm ${e}`,children:n.jsx("li",{children:"• Дизайн прикольный, ссылки рабочие."})})]})]})]})]}),n.jsxs("div",{className:`meme-stage rounded-2xl p-6 sm:p-7 ${r} ${i} border ${a}`,children:[n.jsxs("div",{className:"flex flex-col gap-2 mb-6",children:[n.jsx("p",{className:`text-xs uppercase tracking-[0.12em] ${e}`,children:"Этап 4"}),n.jsx("h3",{className:`text-2xl font-bold ${t}`,children:"DEV и контракт"}),n.jsx("p",{className:`text-sm ${e}`,children:"Исключение манипуляций, контроль и потенциальный скам."})]}),n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{className:"meme-item flex items-start gap-4 p-4 rounded-xl ${theme === 'dark' ? 'border-white/10 bg-white/5 hover:bg-white/10' : 'border-gray-200 bg-gray-50 hover:bg-gray-100'} transition-all duration-200",children:[n.jsx("input",{type:"checkbox",id:"meme-4-1",className:"meme-checkbox w-5 h-5 mt-1 accent-[#4E6E49] rounded flex-shrink-0"}),n.jsxs("label",{htmlFor:"meme-4-1",className:"flex-1 cursor-pointer",children:[n.jsx("strong",{className:`font-semibold block mb-2 ${t}`,children:"Активность DEV"}),n.jsxs("ul",{className:`space-y-1 text-sm ${e}`,children:[n.jsx("li",{children:"• Продал ли DEV: если да, то как много и в какой фазе."}),n.jsx("li",{children:"• Что делает DEV сейчас: покупки, сливы, пополнение ликвы?"})]})]})]}),n.jsxs("div",{className:"meme-item flex items-start gap-4 p-4 rounded-xl ${theme === 'dark' ? 'border-white/10 bg-white/5 hover:bg-white/10' : 'border-gray-200 bg-gray-50 hover:bg-gray-100'} transition-all duration-200",children:[n.jsx("input",{type:"checkbox",id:"meme-4-2",className:"meme-checkbox w-5 h-5 mt-1 accent-[#4E6E49] rounded flex-shrink-0"}),n.jsxs("label",{htmlFor:"meme-4-2",className:"flex-1 cursor-pointer",children:[n.jsx("strong",{className:`font-semibold block mb-2 ${t}`,children:"История монет DEV"}),n.jsxs("ul",{className:`space-y-1 text-sm ${e}`,children:[n.jsx("li",{children:"• Создавал ли ранее токены."}),n.jsx("li",{children:"• Как они себя вели (пампы/дампы, длительность жизни)."})]})]})]}),n.jsxs("div",{className:"meme-item flex items-start gap-4 p-4 rounded-xl ${theme === 'dark' ? 'border-white/10 bg-white/5 hover:bg-white/10' : 'border-gray-200 bg-gray-50 hover:bg-gray-100'} transition-all duration-200",children:[n.jsx("input",{type:"checkbox",id:"meme-4-3",className:"meme-checkbox w-5 h-5 mt-1 accent-[#4E6E49] rounded flex-shrink-0"}),n.jsxs("label",{htmlFor:"meme-4-3",className:"flex-1 cursor-pointer",children:[n.jsx("strong",{className:`font-semibold block mb-2 ${t}`,children:"Токены DEV"}),n.jsx("ul",{className:`space-y-1 text-sm ${e}`,children:n.jsx("li",{children:"• Если перевёл более 15% — высокий риск."})})]})]}),n.jsxs("div",{className:"meme-item flex items-start gap-4 p-4 rounded-xl ${theme === 'dark' ? 'border-white/10 bg-white/5 hover:bg-white/10' : 'border-gray-200 bg-gray-50 hover:bg-gray-100'} transition-all duration-200",children:[n.jsx("input",{type:"checkbox",id:"meme-4-4",className:"meme-checkbox w-5 h-5 mt-1 accent-[#4E6E49] rounded flex-shrink-0"}),n.jsxs("label",{htmlFor:"meme-4-4",className:"flex-1 cursor-pointer",children:[n.jsx("strong",{className:`font-semibold block mb-2 ${t}`,children:"Безопасность контракта"}),n.jsxs("ul",{className:`space-y-1 text-sm ${e}`,children:[n.jsx("li",{children:"• Mint отключён."}),n.jsx("li",{children:"• Freeze отключён."}),n.jsx("li",{children:"• Trading limits отключены."}),n.jsx("li",{children:"• Владелец LP — сожжён или передан в отказ (renounce)."})]})]})]}),n.jsxs("div",{className:"meme-item flex items-start gap-4 p-4 rounded-xl ${theme === 'dark' ? 'border-white/10 bg-white/5 hover:bg-white/10' : 'border-gray-200 bg-gray-50 hover:bg-gray-100'} transition-all duration-200",children:[n.jsx("input",{type:"checkbox",id:"meme-4-5",className:"meme-checkbox w-5 h-5 mt-1 accent-[#4E6E49] rounded flex-shrink-0"}),n.jsxs("label",{htmlFor:"meme-4-5",className:"flex-1 cursor-pointer",children:[n.jsx("strong",{className:`font-semibold block mb-2 ${t}`,children:"Curve-Manipulation Check"}),n.jsxs("ul",{className:`space-y-1 text-sm ${e}`,children:[n.jsx("li",{children:"• Нет скрытых функций, влияющих на цену."}),n.jsx("li",{children:"• Проверить контракт на сторонних аудит-ботах."})]})]})]})]})]}),n.jsxs("div",{className:`meme-stage rounded-2xl p-6 sm:p-7 ${r} ${i} border ${a}`,children:[n.jsxs("div",{className:"flex flex-col gap-2 mb-6",children:[n.jsx("p",{className:`text-xs uppercase tracking-[0.12em] ${e}`,children:"Этап 5"}),n.jsx("h3",{className:`text-2xl font-bold ${t}`,children:"Распределение холдеров"}),n.jsx("p",{className:`text-sm ${e}`,children:"Убедиться, что флоат распределён и нет доминирующих кластеров."})]}),n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{className:"meme-item flex items-start gap-4 p-4 rounded-xl ${theme === 'dark' ? 'border-white/10 bg-white/5 hover:bg-white/10' : 'border-gray-200 bg-gray-50 hover:bg-gray-100'} transition-all duration-200",children:[n.jsx("input",{type:"checkbox",id:"meme-5-1",className:"meme-checkbox w-5 h-5 mt-1 accent-[#4E6E49] rounded flex-shrink-0"}),n.jsxs("label",{htmlFor:"meme-5-1",className:"flex-1 cursor-pointer",children:[n.jsx("strong",{className:`font-semibold block mb-2 ${t}`,children:"Топ-кошельки"}),n.jsxs("ul",{className:`space-y-1 text-sm ${e}`,children:[n.jsx("li",{children:"• Топ-держатели ≤ 5–7%."}),n.jsx("li",{children:"• Оптимально: ранний лидер имеет не более 3–4%."})]})]})]}),n.jsxs("div",{className:"meme-item flex items-start gap-4 p-4 rounded-xl ${theme === 'dark' ? 'border-white/10 bg-white/5 hover:bg-white/10' : 'border-gray-200 bg-gray-50 hover:bg-gray-100'} transition-all duration-200",children:[n.jsx("input",{type:"checkbox",id:"meme-5-2",className:"meme-checkbox w-5 h-5 mt-1 accent-[#4E6E49] rounded flex-shrink-0"}),n.jsxs("label",{htmlFor:"meme-5-2",className:"flex-1 cursor-pointer",children:[n.jsx("strong",{className:`font-semibold block mb-2 ${t}`,children:"Кластеры"}),n.jsxs("ul",{className:`space-y-1 text-sm ${e}`,children:[n.jsx("li",{children:"• Нет крупных связанных кошельков."}),n.jsx("li",{children:'• Нет "пачек" кошельков, созданных в одну минуту.'})]})]})]}),n.jsxs("div",{className:"meme-item flex items-start gap-4 p-4 rounded-xl ${theme === 'dark' ? 'border-white/10 bg-white/5 hover:bg-white/10' : 'border-gray-200 bg-gray-50 hover:bg-gray-100'} transition-all duration-200",children:[n.jsx("input",{type:"checkbox",id:"meme-5-3",className:"meme-checkbox w-5 h-5 mt-1 accent-[#4E6E49] rounded flex-shrink-0"}),n.jsxs("label",{htmlFor:"meme-5-3",className:"flex-1 cursor-pointer",children:[n.jsx("strong",{className:`font-semibold block mb-2 ${t}`,children:"Фермы"}),n.jsxs("ul",{className:`space-y-1 text-sm ${e}`,children:[n.jsx("li",{children:"• Фермы не перегружены."}),n.jsx("li",{children:"• Нет пачки фармеров с одинаковой стратегией."})]})]})]}),n.jsxs("div",{className:"meme-item flex items-start gap-4 p-4 rounded-xl ${theme === 'dark' ? 'border-white/10 bg-white/5 hover:bg-white/10' : 'border-gray-200 bg-gray-50 hover:bg-gray-100'} transition-all duration-200",children:[n.jsx("input",{type:"checkbox",id:"meme-5-4",className:"meme-checkbox w-5 h-5 mt-1 accent-[#4E6E49] rounded flex-shrink-0"}),n.jsxs("label",{htmlFor:"meme-5-4",className:"flex-1 cursor-pointer",children:[n.jsx("strong",{className:`font-semibold block mb-2 ${t}`,children:"PNL/RPL-анализ"}),n.jsx("ul",{className:`space-y-1 text-sm ${e}`,children:n.jsx("li",{children:"• Холдеры не сидят в прибыли 4–5х (сливы неизбежны)."})})]})]}),n.jsxs("div",{className:"meme-item flex items-start gap-4 p-4 rounded-xl ${theme === 'dark' ? 'border-white/10 bg-white/5 hover:bg-white/10' : 'border-gray-200 bg-gray-50 hover:bg-gray-100'} transition-all duration-200",children:[n.jsx("input",{type:"checkbox",id:"meme-5-5",className:"meme-checkbox w-5 h-5 mt-1 accent-[#4E6E49] rounded flex-shrink-0"}),n.jsxs("label",{htmlFor:"meme-5-5",className:"flex-1 cursor-pointer",children:[n.jsx("strong",{className:`font-semibold block mb-2 ${t}`,children:"Активность торговли"}),n.jsxs("ul",{className:`space-y-1 text-sm ${e}`,children:[n.jsx("li",{children:"• Нет торговли только команды."}),n.jsx("li",{children:"• Есть новые кошельки."}),n.jsx("li",{children:"• Нет явного копитрейдинга."})]})]})]}),n.jsxs("div",{className:"meme-item flex items-start gap-4 p-4 rounded-xl ${theme === 'dark' ? 'border-white/10 bg-white/5 hover:bg-white/10' : 'border-gray-200 bg-gray-50 hover:bg-gray-100'} transition-all duration-200",children:[n.jsx("input",{type:"checkbox",id:"meme-5-6",className:"meme-checkbox w-5 h-5 mt-1 accent-[#4E6E49] rounded flex-shrink-0"}),n.jsxs("label",{htmlFor:"meme-5-6",className:"flex-1 cursor-pointer",children:[n.jsx("strong",{className:`font-semibold block mb-2 ${t}`,children:"Время удержания токена"}),n.jsx("ul",{className:`space-y-1 text-sm ${e}`,children:n.jsx("li",{children:"• Если все держат ≤3 минут — чистый скальпинг, можно словить дамп."})})]})]})]})]}),n.jsxs("div",{className:`meme-stage rounded-2xl p-6 sm:p-7 ${r} ${i} border ${a}`,children:[n.jsxs("div",{className:"flex flex-col gap-2 mb-6",children:[n.jsx("p",{className:`text-xs uppercase tracking-[0.12em] ${e}`,children:"Этап 6"}),n.jsx("h3",{className:`text-2xl font-bold ${t}`,children:"Технический вход"}),n.jsx("p",{className:`text-sm ${e}`,children:"Войти по адекватной цене после фильтрации ончейн-данных."})]}),n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{className:"meme-item flex items-start gap-4 p-4 rounded-xl ${theme === 'dark' ? 'border-white/10 bg-white/5 hover:bg-white/10' : 'border-gray-200 bg-gray-50 hover:bg-gray-100'} transition-all duration-200",children:[n.jsx("input",{type:"checkbox",id:"meme-6-1",className:"meme-checkbox w-5 h-5 mt-1 accent-[#4E6E49] rounded flex-shrink-0"}),n.jsxs("label",{htmlFor:"meme-6-1",className:"flex-1 cursor-pointer",children:[n.jsx("strong",{className:`font-semibold block mb-2 ${t}`,children:"Фибо"}),n.jsx("ul",{className:`space-y-1 text-sm ${e}`,children:n.jsx("li",{children:"• Строим сетку по ключевому импульсу."})})]})]}),n.jsxs("div",{className:"meme-item flex items-start gap-4 p-4 rounded-xl ${theme === 'dark' ? 'border-white/10 bg-white/5 hover:bg-white/10' : 'border-gray-200 bg-gray-50 hover:bg-gray-100'} transition-all duration-200",children:[n.jsx("input",{type:"checkbox",id:"meme-6-2",className:"meme-checkbox w-5 h-5 mt-1 accent-[#4E6E49] rounded flex-shrink-0"}),n.jsxs("label",{htmlFor:"meme-6-2",className:"flex-1 cursor-pointer",children:[n.jsx("strong",{className:`font-semibold block mb-2 ${t}`,children:"Уровни"}),n.jsx("ul",{className:`space-y-1 text-sm ${e}`,children:n.jsx("li",{children:"• Совпадение 0.5/0.618/0.702 с зонами проторговки."})})]})]}),n.jsxs("div",{className:"meme-item flex items-start gap-4 p-4 rounded-xl ${theme === 'dark' ? 'border-white/10 bg-white/5 hover:bg-white/10' : 'border-gray-200 bg-gray-50 hover:bg-gray-100'} transition-all duration-200",children:[n.jsx("input",{type:"checkbox",id:"meme-6-3",className:"meme-checkbox w-5 h-5 mt-1 accent-[#4E6E49] rounded flex-shrink-0"}),n.jsxs("label",{htmlFor:"meme-6-3",className:"flex-1 cursor-pointer",children:[n.jsx("strong",{className:`font-semibold block mb-2 ${t}`,children:"Вход"}),n.jsx("ul",{className:`space-y-1 text-sm ${e}`,children:n.jsx("li",{children:"• 50–70% откат от локального хая."})})]})]}),n.jsxs("div",{className:"meme-item flex items-start gap-4 p-4 rounded-xl ${theme === 'dark' ? 'border-white/10 bg-white/5 hover:bg-white/10' : 'border-gray-200 bg-gray-50 hover:bg-gray-100'} transition-all duration-200",children:[n.jsx("input",{type:"checkbox",id:"meme-6-4",className:"meme-checkbox w-5 h-5 mt-1 accent-[#4E6E49] rounded flex-shrink-0"}),n.jsxs("label",{htmlFor:"meme-6-4",className:"flex-1 cursor-pointer",children:[n.jsx("strong",{className:`font-semibold block mb-2 ${t}`,children:"Дополнительно"}),n.jsxs("ul",{className:`space-y-1 text-sm ${e}`,children:[n.jsx("li",{children:"• Проверить, есть ли ликвидность на уровнях покупок."}),n.jsx("li",{children:"• Проверить объёмы на откате: ослабление продавцов."}),n.jsx("li",{children:"• Проверить, не обновляет ли токен лоу (в таком случае вход отменяется)."})]})]})]})]})]}),n.jsxs("div",{className:`meme-stage rounded-2xl p-6 sm:p-7 ${r} ${i} border ${a}`,children:[n.jsxs("div",{className:"flex flex-col gap-2 mb-6",children:[n.jsx("p",{className:`text-xs uppercase tracking-[0.12em] ${e}`,children:"Этап 7"}),n.jsx("h3",{className:`text-2xl font-bold ${t}`,children:"Анализ риска"}),n.jsx("p",{className:`text-sm ${e}`,children:"Формализовать риск-менеджмент."})]}),n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{className:"meme-item flex items-start gap-4 p-4 rounded-xl ${theme === 'dark' ? 'border-white/10 bg-white/5 hover:bg-white/10' : 'border-gray-200 bg-gray-50 hover:bg-gray-100'} transition-all duration-200",children:[n.jsx("input",{type:"checkbox",id:"meme-7-1",className:"meme-checkbox w-5 h-5 mt-1 accent-[#4E6E49] rounded flex-shrink-0"}),n.jsxs("label",{htmlFor:"meme-7-1",className:"flex-1 cursor-pointer",children:[n.jsx("strong",{className:`font-semibold block mb-2 ${t}`,children:"Стоп-логика"}),n.jsxs("ul",{className:`space-y-1 text-sm ${e}`,children:[n.jsx("li",{children:"• Стоп по структуре (обновление локального лоу)."}),n.jsx("li",{children:"• Стоп по ончейн-сигналу (DEV слил, появились новые бандлы, появились киты)."})]})]})]}),n.jsxs("div",{className:"meme-item flex items-start gap-4 p-4 rounded-xl ${theme === 'dark' ? 'border-white/10 bg-white/5 hover:bg-white/10' : 'border-gray-200 bg-gray-50 hover:bg-gray-100'} transition-all duration-200",children:[n.jsx("input",{type:"checkbox",id:"meme-7-2",className:"meme-checkbox w-5 h-5 mt-1 accent-[#4E6E49] rounded flex-shrink-0"}),n.jsxs("label",{htmlFor:"meme-7-2",className:"flex-1 cursor-pointer",children:[n.jsx("strong",{className:`font-semibold block mb-2 ${t}`,children:"Целевые зоны"}),n.jsx("ul",{className:`space-y-1 text-sm ${e}`,children:n.jsx("li",{children:"• Минимум 2 стратегии выхода: частичный выход на 1.5–2х, остальное — трейл."})})]})]})]})]}),n.jsxs("div",{className:`meme-stage rounded-2xl p-6 sm:p-7 ${r} ${i} border ${a}`,children:[n.jsxs("div",{className:"flex flex-col gap-2 mb-6",children:[n.jsx("p",{className:`text-xs uppercase tracking-[0.12em] ${e}`,children:"Напоминание"}),n.jsx("h3",{className:`text-2xl font-bold ${t}`,children:"Ключевые правила входа в сделки"}),n.jsx("p",{className:`text-sm ${e}`,children:"Трейдинг-дисциплина превыше всего."})]}),n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[n.jsxs("div",{className:`meme-item flex items-start gap-3 p-4 rounded-xl ${s==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-gray-50"}`,children:[n.jsx(Ut,{className:"w-6 h-6 text-[#4E6E49]"}),n.jsxs("div",{children:[n.jsx("strong",{className:`font-semibold block mb-1 ${t}`,children:"Уровни Фибоначчи"}),n.jsx("p",{className:`text-sm ${e}`,children:"Заходим только когда уровни поддержки совпадают с зоной проторговки и на прошлом уровне были высокие объёмы."})]})]}),n.jsxs("div",{className:`meme-item flex items-start gap-3 p-4 rounded-xl ${s==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-gray-50"}`,children:[n.jsx(os,{className:"w-6 h-6 text-[#4E6E49]"}),n.jsxs("div",{children:[n.jsx("strong",{className:`font-semibold block mb-1 ${t}`,children:"Зона входа"}),n.jsx("p",{className:`text-sm ${e}`,children:"Преимущественно заходим в канале 0.7, в идеале — строго от линии 0.7."})]})]}),n.jsxs("div",{className:`meme-item flex items-start gap-3 p-4 rounded-xl ${s==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-gray-50"}`,children:[n.jsx(Ji,{className:"w-6 h-6 text-[#4E6E49]"}),n.jsxs("div",{children:[n.jsx("strong",{className:`font-semibold block mb-1 ${t}`,children:"Stop Loss"}),n.jsx("p",{className:`text-sm ${e}`,children:"Устанавливаем от линии 0.7 до 50% от позиции в зависимости от волатильности."})]})]}),n.jsxs("div",{className:`meme-item flex items-start gap-3 p-4 rounded-xl ${s==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-gray-50"}`,children:[n.jsx(Xt,{className:"w-6 h-6 text-[#4E6E49]"}),n.jsxs("div",{children:[n.jsx("strong",{className:`font-semibold block mb-1 ${t}`,children:"Альтернативный вход"}),n.jsx("p",{className:`text-sm ${e}`,children:"Допустимо заходить по уровню 0.6, но только при наличии активного роста холдеров."})]})]}),n.jsxs("div",{className:`meme-item flex items-start gap-3 p-4 rounded-xl ${s==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-gray-50"}`,children:[n.jsx(Xi,{className:"w-6 h-6 text-[#4E6E49]"}),n.jsxs("div",{children:[n.jsx("strong",{className:`font-semibold block mb-1 ${t}`,children:"Сигнал роста"}),n.jsx("p",{className:`text-sm ${e}`,children:"Рост холдеров при сильной поддержке = высокая вероятность скачка вверх."})]})]}),n.jsxs("div",{className:`meme-item flex items-start gap-3 p-4 rounded-xl ${s==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-gray-50"}`,children:[n.jsx(va,{className:"w-6 h-6 text-[#4E6E49]"}),n.jsxs("div",{children:[n.jsx("strong",{className:`font-semibold block mb-1 ${t}`,children:"Take Profit"}),n.jsx("p",{className:`text-sm ${e}`,children:"Целевые зоны 30-45% от входа, шаг фиксации прибыли — 12%."})]})]}),n.jsxs("div",{className:`meme-item flex items-start gap-3 p-4 rounded-xl ${s==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-gray-50"}`,children:[n.jsx(Gv,{className:"w-6 h-6 text-[#4E6E49]"}),n.jsxs("div",{children:[n.jsx("strong",{className:`font-semibold block mb-1 ${t}`,children:"Правило выхода"}),n.jsx("p",{className:`text-sm ${e}`,children:"По общему правилу фиксируем максимум на 70-80% позиции, если токен продолжает движение — выходим в оранжевой зоне Фибоначчи."})]})]}),n.jsxs("div",{className:`meme-item flex items-start gap-3 p-4 rounded-xl ${s==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-gray-50"}`,children:[n.jsx(Ks,{className:"w-6 h-6 text-[#4E6E49]"}),n.jsxs("div",{children:[n.jsx("strong",{className:`font-semibold block mb-1 ${t}`,children:"Тайминг входа"}),n.jsx("p",{className:`text-sm ${e}`,children:"Помните, что в токен лучше заходить спустя 10-15 минут от миграции, чтобы избежать ранних рисков."})]})]}),n.jsxs("div",{className:`meme-item flex items-start gap-3 p-4 rounded-xl ${s==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-gray-50"}`,children:[n.jsx(Lv,{className:"w-6 h-6 text-[#4E6E49]"}),n.jsxs("div",{children:[n.jsx("strong",{className:`font-semibold block mb-1 ${t}`,children:"Минимальные суммы"}),n.jsx("p",{className:`text-sm ${e}`,children:"Старайтесь проверять токен минимальными суммами, если не уверены — достаточно 10-15 секунд анализа."})]})]}),n.jsxs("div",{className:`meme-item flex items-start gap-3 p-4 rounded-xl ${s==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-gray-50"}`,children:[n.jsx(fh,{className:"w-6 h-6 text-[#4E6E49]"}),n.jsxs("div",{children:[n.jsx("strong",{className:`font-semibold block mb-1 ${t}`,children:"Сервисы проверки"}),n.jsxs("p",{className:`text-sm ${e}`,children:["Используйте для анализа: ",n.jsx("a",{href:"https://rugcheck.xyz",className:"underline text-[#4E6E49]",target:"_blank",children:"rugcheck.xyz"})," и ",n.jsx("a",{href:"https://gmgn.ai/?chain=sol",className:"underline text-[#4E6E49]",target:"_blank",children:"gmgn.ai"})]})]})]})]})]}),n.jsxs("div",{className:`rounded-2xl p-6 sm:p-7 ${r} ${i} border ${a}`,children:[n.jsxs("div",{className:"flex flex-col gap-2 mb-4",children:[n.jsx("p",{className:`text-xs uppercase tracking-[0.12em] ${e}`,children:"Прогресс"}),n.jsx("h3",{className:`text-2xl font-bold ${t}`,children:"Состояние проверки"}),n.jsx("p",{className:`text-sm ${e}`,children:"Отмечайте выполненные пункты для отслеживания прогресса анализа."})]}),n.jsxs("div",{className:"space-y-6",children:[n.jsxs("div",{className:"text-center",children:[n.jsx("div",{id:"meme-progress-percentage",className:"text-6xl font-bold text-[#4E6E49] mb-2",children:"0%"}),n.jsx("p",{className:`text-sm ${e}`,children:"завершено"})]}),n.jsx("div",{className:`w-full h-8 ${s==="dark"?"bg-white/5":"bg-gray-200"} rounded-full overflow-hidden border ${s==="dark"?"border-white/10":"border-gray-300"}`,children:n.jsx("div",{id:"meme-progress-fill",className:"h-full bg-gradient-to-r from-[#4E6E49] to-[#6b8f5f] transition-all duration-800 ease-out relative",children:n.jsx("div",{className:"absolute right-3 top-1/2 -translate-y-1/2 text-white text-sm opacity-0 animate-pulse",children:"🐊"})})}),n.jsx("div",{className:"flex items-center justify-between text-center",children:n.jsxs("div",{className:"flex-1",children:[n.jsxs("div",{className:`text-2xl font-bold ${t}`,children:[n.jsx("span",{id:"meme-checked-count",children:"0"}),n.jsx("span",{className:`text-sm ${e} ml-1`,children:"из"}),n.jsx("span",{id:"meme-total-count",className:`text-sm ${e} ml-1`,children:"0"})]}),n.jsx("p",{className:`text-xs ${e} mt-1`,children:"пунктов выполнено"})]})}),n.jsx("div",{className:"flex justify-center",children:n.jsxs("button",{id:"meme-reset-button",className:`px-6 py-3 rounded-xl transition-all duration-200 border ${s==="dark"?"border-rose-300/60 bg-rose-500/20 text-rose-50 hover:bg-rose-500/30":"border-rose-400 bg-rose-50 text-rose-700 hover:bg-rose-100"} font-semibold flex items-center gap-2`,children:[n.jsx("span",{children:"🗑️"}),n.jsx("span",{children:"Сбросить прогресс"})]})})]})]})]})]}),n.jsx("style",{children:`
        .completed {
          background: rgba(255, 255, 255, 0.1) !important;
          border-color: #4E6E49 !important;
        }

        .meme-item.completed strong {
          color: #4E6E49 !important;
        }

        .meme-checkbox:checked {
          background-color: #4E6E49;
          border-color: #4E6E49;
        }

        .meme-checkbox:checked::after {
          content: '🐊';
          position: absolute;
          top: 50%;
          left: 50%;
          transform: translate(-50%, -50%);
          font-size: 12px;
          color: white;
        }
      `})]})},cD=()=>{const{theme:s}=lt(),{user:e}=_t(),[t,r]=I.useState([]),[a,i]=I.useState(!0),[o,l]=I.useState(!1),[c,h]=I.useState(null),[u,m]=I.useState(null),[g,p]=I.useState(!1),[j,_]=I.useState(!1),[y,M]=I.useState({signalDate:new Date().toISOString().split("T")[0],signalTime:new Date().toLocaleTimeString("ru-RU",{hour:"2-digit",minute:"2-digit"}),marketCap:"",address:"",maxDrop:"",maxProfit:"",comment:""}),D=s==="dark"?"text-gray-400":"text-gray-600",T=s==="dark"?"text-white":"text-gray-900",R=s==="dark"?"bg-[#10141c]":"bg-white",P=s==="dark"?"border-[#48a35e]/30":"border-[#48a35e]/20",C=s==="dark"?"shadow-[0_24px_80px_rgba(0,0,0,0.45)]":"shadow-[0_24px_80px_rgba(0,0,0,0.15)]";I.useEffect(()=>{N()},[]);const N=async()=>{try{const Q=await lS();r(Q)}catch(Q){console.error("Error loading alerts:",Q)}finally{i(!1)}},b=(Q,ae)=>{navigator.clipboard.writeText(Q),m(ae),setTimeout(()=>m(null),2e3)},v=()=>{const Q=t.map(V=>`${V.signalDate}	${V.signalTime}	${V.marketCap||"-"}	${V.address}	${V.maxDrop||"-"}	${V.maxProfit||"-"}	${V.comment||""}`).join(`
`);navigator.clipboard.writeText(`Дата	Время	Market Cap	Адрес	Макс. Падение	Макс. Профит	Комментарий
`+Q),p(!0),setTimeout(()=>p(!1),2e3)},S=()=>{const Q=`
      <table border="1">
        <thead>
          <tr>
            <th>Дата</th>
            <th>Время</th>
            <th>Market Cap</th>
            <th>Адрес</th>
            <th>Макс. Падение</th>
            <th>Макс. Профит</th>
            <th>Комментарий</th>
          </tr>
        </thead>
        <tbody>
          ${t.map(he=>`
            <tr>
              <td>${he.signalDate}</td>
              <td>${he.signalTime}</td>
              <td>${he.marketCap||"-"}</td>
              <td>${he.address}</td>
              <td>${he.maxDrop||"-"}</td>
              <td>${he.maxProfit||"-"}</td>
              <td>${he.comment||""}</td>
            </tr>
          `).join("")}
        </tbody>
      </table>
    `,ae="text/html",V=new Blob([Q],{type:ae}),X=[new ClipboardItem({[ae]:V})];navigator.clipboard.write(X),_(!0),setTimeout(()=>_(!1),2e3)},E=async Q=>{if(confirm("Удалить алерт?"))try{await hS(Q),await N()}catch(ae){console.error("Error deleting alert:",ae)}},k=Q=>{h(Q),M(Q),l(!0)},w=async Q=>{Q.preventDefault();try{c?await dS(c.id,y):await cS({...y,createdAt:new Date().toISOString(),createdBy:(e==null?void 0:e.id)||"admin"}),l(!1),h(null),M({signalDate:new Date().toISOString().split("T")[0],signalTime:new Date().toLocaleTimeString("ru-RU",{hour:"2-digit",minute:"2-digit"}),marketCap:"",address:"",maxDrop:"",maxProfit:"",comment:""}),await N()}catch(ae){console.error("Error saving alert:",ae)}};return n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:"space-y-6",children:[n.jsxs("div",{className:`relative overflow-hidden rounded-3xl border ${P} ${C} ${R}`,children:[n.jsxs("div",{className:"absolute inset-0 pointer-events-none",children:[n.jsx("div",{className:"absolute -left-16 -bottom-10 w-80 h-80 bg-emerald-500/10 blur-3xl"}),n.jsx("div",{className:`absolute inset-0 ${s==="dark"?"bg-[radial-gradient(circle_at_50%_0%,rgba(255,255,255,0.05),transparent_45%)]":"bg-[radial-gradient(circle_at_50%_0%,rgba(78,110,73,0.05),transparent_45%)]"}`})]}),n.jsxs("div",{className:"relative p-6 sm:p-8 flex flex-col lg:flex-row items-stretch lg:items-center justify-between gap-6",children:[n.jsxs("div",{className:"flex items-center gap-4",children:[n.jsx("div",{className:`p-3 rounded-2xl ${s==="dark"?"bg-white/10 border-white/20":"bg-[#4E6E49]/10 border-[#4E6E49]/30"} shadow-inner`,children:n.jsx(mw,{className:`w-8 h-8 ${s==="dark"?"text-white":"text-[#4E6E49]"}`})}),n.jsxs("div",{children:[n.jsx("h1",{className:`text-3xl font-black ${T}`,children:"AI - AO Alerts"}),n.jsx("p",{className:`text-sm ${D}`,children:"Мониторинг сигналов искусственного интеллекта"})]})]}),n.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[n.jsx("button",{onClick:v,disabled:t.length===0,className:`px-4 py-2 rounded-xl text-sm font-semibold transition-all flex items-center gap-2 border ${s==="dark"?"bg-white/5 border-white/10 hover:bg-white/10 text-gray-300":"bg-gray-100 border-gray-200 hover:bg-gray-200 text-gray-700"} disabled:opacity-50`,children:g?n.jsxs(n.Fragment,{children:[n.jsx(Ls,{className:"w-4 h-4 text-green-500"}),n.jsx("span",{children:"Данные скопированы"})]}):n.jsxs(n.Fragment,{children:[n.jsx(Lp,{className:"w-4 h-4"}),n.jsx("span",{children:"Копировать данные"})]})}),n.jsx("button",{onClick:S,disabled:t.length===0,className:`px-4 py-2 rounded-xl text-sm font-semibold transition-all flex items-center gap-2 border ${s==="dark"?"bg-white/5 border-white/10 hover:bg-white/10 text-gray-300":"bg-gray-100 border-gray-200 hover:bg-gray-200 text-gray-700"} disabled:opacity-50`,children:j?n.jsxs(n.Fragment,{children:[n.jsx(Ls,{className:"w-4 h-4 text-green-500"}),n.jsx("span",{children:"Таблица скопирована"})]}):n.jsxs(n.Fragment,{children:[n.jsx(hw,{className:"w-4 h-4"}),n.jsx("span",{children:"Копировать таблицу"})]})}),n.jsxs("button",{onClick:()=>{h(null),M({signalDate:new Date().toISOString().split("T")[0],signalTime:new Date().toLocaleTimeString("ru-RU",{hour:"2-digit",minute:"2-digit"})}),l(!0)},className:"px-4 py-2 rounded-xl bg-[#4E6E49] hover:bg-[#3d5a39] text-white font-semibold transition-colors flex items-center gap-2 shadow-lg shadow-[#4E6E49]/20 ml-auto",children:[n.jsx(Cr,{className:"w-4 h-4"}),n.jsx("span",{children:"Добавить сигнал"})]})]})]})]}),n.jsx("div",{className:`relative overflow-hidden rounded-3xl border ${P} ${C} ${R}`,children:n.jsx("div",{className:"overflow-x-auto",children:n.jsxs("table",{className:"w-full text-left border-collapse",children:[n.jsx("thead",{children:n.jsxs("tr",{className:`border-b ${s==="dark"?"border-white/10 bg-white/5":"border-gray-200 bg-gray-50"}`,children:[n.jsx("th",{className:`p-4 text-xs uppercase tracking-wider font-semibold ${D}`,children:"Дата/Время"}),n.jsx("th",{className:`p-4 text-xs uppercase tracking-wider font-semibold ${D}`,children:"Капитализация"}),n.jsx("th",{className:`p-4 text-xs uppercase tracking-wider font-semibold ${D}`,children:"Адрес"}),n.jsx("th",{className:`p-4 text-xs uppercase tracking-wider font-semibold ${D}`,children:"Макс. Падение"}),n.jsx("th",{className:`p-4 text-xs uppercase tracking-wider font-semibold ${D}`,children:"Макс. Профит"}),n.jsx("th",{className:`p-4 text-xs uppercase tracking-wider font-semibold ${D}`,children:"Действия"})]})}),n.jsx("tbody",{className:`divide-y ${s==="dark"?"divide-white/5":"divide-gray-100"}`,children:a?n.jsx("tr",{children:n.jsx("td",{colSpan:6,className:"p-8 text-center text-gray-500",children:"Загрузка..."})}):t.length===0?n.jsx("tr",{children:n.jsx("td",{colSpan:6,className:"p-8 text-center text-gray-500",children:"Нет сигналов"})}):t.map(Q=>n.jsxs("tr",{className:`${s==="dark"?"hover:bg-white/5":"hover:bg-gray-50"} transition-colors`,children:[n.jsxs("td",{className:"p-4 whitespace-nowrap",children:[n.jsx("div",{className:`font-mono font-medium ${T}`,children:Q.signalDate}),n.jsx("div",{className:`text-xs ${D}`,children:Q.signalTime})]}),n.jsx("td",{className:"p-4 whitespace-nowrap",children:n.jsx("div",{className:`font-mono ${T}`,children:Q.marketCap||"-"})}),n.jsx("td",{className:"p-4",children:n.jsxs("div",{className:"flex items-center gap-2 max-w-[200px]",children:[n.jsx("div",{className:`truncate font-mono text-sm ${s==="dark"?"text-blue-400":"text-blue-600"}`,children:Q.address}),n.jsx("button",{onClick:()=>b(Q.address,Q.id),className:`p-1.5 rounded-lg hover:bg-white/10 transition-colors ${D}`,children:u===Q.id?n.jsx(Ls,{className:"w-3 h-3 text-green-500"}):n.jsx(Ai,{className:"w-3 h-3"})})]})}),n.jsxs("td",{className:"p-4 whitespace-nowrap",children:[n.jsx("span",{className:`font-mono ${Q.maxDrop&&Q.maxDrop.startsWith("-")?"text-red-500":T}`,children:Q.maxDrop||"-"}),Q.comment&&n.jsx("div",{className:`text-xs ${D} mt-1`,children:Q.comment})]}),n.jsx("td",{className:"p-4 whitespace-nowrap",children:n.jsx("span",{className:"font-mono text-green-500 font-bold",children:Q.maxProfit||"-"})}),n.jsx("td",{className:"p-4 whitespace-nowrap",children:n.jsxs("div",{className:"flex items-center gap-1",children:[n.jsx("button",{onClick:()=>k(Q),className:`p-2 rounded-lg hover:bg-white/10 transition-colors ${s==="dark"?"text-blue-400":"text-blue-600"}`,children:n.jsx(ps,{className:"w-4 h-4"})}),n.jsx("button",{onClick:()=>E(Q.id),className:"p-2 rounded-lg hover:bg-red-500/10 text-red-500 transition-colors",children:n.jsx(Bt,{className:"w-4 h-4"})})]})})]},Q.id))})]})})})]}),o&&n.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm",children:n.jsxs("div",{className:`w-full max-w-lg rounded-3xl ${R} ${P} border shadow-2xl overflow-hidden`,children:[n.jsxs("div",{className:`p-6 border-b ${s==="dark"?"border-white/10":"border-gray-100"} flex items-center justify-between`,children:[n.jsx("h3",{className:`text-xl font-bold ${T}`,children:c?"Редактировать сигнал":"Новый сигнал"}),n.jsx("button",{onClick:()=>l(!1),className:`p-2 rounded-lg hover:bg-white/10 ${D}`,children:n.jsx(Ft,{className:"w-5 h-5"})})]}),n.jsxs("form",{onSubmit:w,className:"p-6 space-y-4",children:[n.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:`text-xs font-semibold uppercase ${D}`,children:"Дата"}),n.jsx("input",{type:"date",required:!0,value:y.signalDate,onChange:Q=>M({...y,signalDate:Q.target.value}),className:`w-full p-3 rounded-xl border outline-none transition-all ${s==="dark"?"bg-black/30 border-white/10 text-white focus:border-[#4E6E49]":"bg-white border-gray-200 text-gray-900 focus:border-[#4E6E49]"}`})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:`text-xs font-semibold uppercase ${D}`,children:"Время"}),n.jsx("input",{type:"time",required:!0,value:y.signalTime,onChange:Q=>M({...y,signalTime:Q.target.value}),className:`w-full p-3 rounded-xl border outline-none transition-all ${s==="dark"?"bg-black/30 border-white/10 text-white focus:border-[#4E6E49]":"bg-white border-gray-200 text-gray-900 focus:border-[#4E6E49]"}`})]})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:`text-xs font-semibold uppercase ${D}`,children:"Адрес токена"}),n.jsx("input",{type:"text",required:!0,placeholder:"Адрес контракта...",value:y.address||"",onChange:Q=>M({...y,address:Q.target.value}),className:`w-full p-3 rounded-xl border outline-none transition-all font-mono text-sm ${s==="dark"?"bg-black/30 border-white/10 text-white focus:border-[#4E6E49]":"bg-white border-gray-200 text-gray-900 focus:border-[#4E6E49]"}`})]}),n.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:`text-xs font-semibold uppercase ${D}`,children:"Market Cap"}),n.jsx("input",{type:"text",placeholder:"e.g. 300,77",value:y.marketCap||"",onChange:Q=>M({...y,marketCap:Q.target.value}),className:`w-full p-3 rounded-xl border outline-none transition-all ${s==="dark"?"bg-black/30 border-white/10 text-white focus:border-[#4E6E49]":"bg-white border-gray-200 text-gray-900 focus:border-[#4E6E49]"}`})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:`text-xs font-semibold uppercase ${D}`,children:"Макс. Падение"}),n.jsx("input",{type:"text",placeholder:"e.g. -16",value:y.maxDrop||"",onChange:Q=>M({...y,maxDrop:Q.target.value}),className:`w-full p-3 rounded-xl border outline-none transition-all ${s==="dark"?"bg-black/30 border-white/10 text-white focus:border-[#4E6E49]":"bg-white border-gray-200 text-gray-900 focus:border-[#4E6E49]"}`})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:`text-xs font-semibold uppercase ${D}`,children:"Макс. Профит"}),n.jsx("input",{type:"text",placeholder:"e.g. +28",value:y.maxProfit||"",onChange:Q=>M({...y,maxProfit:Q.target.value}),className:`w-full p-3 rounded-xl border outline-none transition-all ${s==="dark"?"bg-black/30 border-white/10 text-white focus:border-[#4E6E49]":"bg-white border-gray-200 text-gray-900 focus:border-[#4E6E49]"}`})]})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:`text-xs font-semibold uppercase ${D}`,children:"Комментарий"}),n.jsx("input",{type:"text",placeholder:"Дополнительная информация...",value:y.comment||"",onChange:Q=>M({...y,comment:Q.target.value}),className:`w-full p-3 rounded-xl border outline-none transition-all ${s==="dark"?"bg-black/30 border-white/10 text-white focus:border-[#4E6E49]":"bg-white border-gray-200 text-gray-900 focus:border-[#4E6E49]"}`})]}),n.jsxs("div",{className:"pt-4 flex gap-3",children:[n.jsx("button",{type:"button",onClick:()=>l(!1),className:`flex-1 py-3 rounded-xl font-semibold transition-colors ${s==="dark"?"bg-white/5 hover:bg-white/10 text-white":"bg-gray-100 hover:bg-gray-200 text-gray-800"}`,children:"Отмена"}),n.jsxs("button",{type:"submit",className:"flex-1 py-3 rounded-xl bg-[#4E6E49] hover:bg-[#3d5a39] text-white font-semibold transition-colors flex items-center justify-center gap-2",children:[n.jsx(gh,{className:"w-4 h-4"}),n.jsx("span",{children:"Сохранить"})]})]})]})]})})]})},Ms=({children:s})=>{const{isAuthenticated:e,user:t}=_t(),{isAdmin:r}=Ct(),a=Tp(),[i,o]=I.useState(null),[l,c]=I.useState("");if(!e&&!r)return n.jsx(dl,{to:"/login",replace:!0});const h=u=>u==="/admin"?"admin":u==="/management"?"slots":u==="/earnings"?"earnings":u==="/tasks"?"tasks":u==="/rating"?"rating":u==="/profile"?"profile":u==="/approvals"?"admin":"login";return I.useEffect(()=>{(async()=>{if(!t||r){o(!0);return}const m=h(a.pathname);try{const g=await yu(t.id,m);o(g.hasAccess),c(g.reason||"Доступ запрещен")}catch(g){console.error("Error checking access:",g),o(!0)}})()},[t,r,a.pathname]),i===null?n.jsx("div",{className:"flex items-center justify-center min-h-screen",children:n.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-4 border-[#4E6E49] border-t-transparent"})}):i?n.jsx(n.Fragment,{children:s}):n.jsx("div",{className:"flex items-center justify-center min-h-screen p-4",children:n.jsxs("div",{className:"text-center max-w-md",children:[n.jsx("div",{className:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4",children:n.jsx("svg",{className:"w-8 h-8 text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})})}),n.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-2",children:"Доступ запрещен"}),n.jsx("p",{className:"text-gray-600",children:l})]})})},dD=()=>{const{user:s}=_t(),[e,t]=I.useState(""),[r,a]=I.useState(),[i,o]=I.useState(!0),[l,c]=I.useState(!1);if(I.useEffect(()=>{(async()=>{if(!s){o(!1);return}try{const m=await yu(s.id,"login");m.hasAccess?c(!1):(t(m.reason||"Доступ заблокирован"),a(m.expiresAt),c(!0))}catch(m){console.error("Error checking access:",m),t("Ошибка проверки доступа"),c(!0)}finally{o(!1)}})()},[s]),!l)return null;if(i)return n.jsx("div",{className:"fixed inset-0 bg-slate-950 flex items-center justify-center z-50",children:n.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-4 border-[#4E6E49] border-t-transparent"})});if(!e)return null;const h=u=>{if(!u)return"навсегда";const m=new Date(u);return m<=new Date?"навсегда":m.toLocaleString("ru-RU",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})};return n.jsx("div",{className:"fixed inset-0 bg-slate-950 flex items-center justify-center z-50 p-4",children:n.jsxs("div",{className:"max-w-md w-full bg-white dark:bg-gray-900 rounded-2xl shadow-2xl border border-gray-200 dark:border-gray-700 p-8 text-center",children:[n.jsxs("div",{className:"mb-6",children:[n.jsx("div",{className:"w-16 h-16 bg-red-100 dark:bg-red-900/30 rounded-full flex items-center justify-center mx-auto mb-4",children:n.jsx(ph,{className:"w-8 h-8 text-red-600 dark:text-red-400"})}),n.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-2",children:"Доступ заблокирован"}),n.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-4",children:e})]}),n.jsx("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-4 mb-6",children:n.jsxs("div",{className:"flex items-center justify-center gap-2 text-sm text-gray-600 dark:text-gray-400",children:[n.jsx(Ks,{className:"w-4 h-4"}),n.jsxs("span",{children:["Блокировка до: ",h(r)]})]})}),n.jsx("div",{className:"bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-800 rounded-lg p-4",children:n.jsxs("div",{className:"flex items-start gap-3",children:[n.jsx(Xt,{className:"w-5 h-5 text-amber-600 dark:text-amber-400 flex-shrink-0 mt-0.5"}),n.jsxs("div",{className:"text-left",children:[n.jsx("p",{className:"text-sm font-medium text-amber-800 dark:text-amber-200 mb-1",children:"Свяжитесь с администратором"}),n.jsx("p",{className:"text-sm text-amber-700 dark:text-amber-300",children:"Для восстановления доступа обратитесь к администратору системы"})]})]})}),n.jsx("div",{className:"mt-6 text-xs text-gray-500 dark:text-gray-500",children:"ApeVault Team"})]})})},hD=s=>s.includes("Chrome")&&!s.includes("Edg")&&!s.includes("OPR")?"Chrome":s.includes("Firefox")?"Firefox":s.includes("Safari")&&!s.includes("Chrome")?"Safari":s.includes("Edg")?"Edge":s.includes("OPR")?"Opera":"Unknown",uD=()=>{const{user:s}=_t(),e=I.useRef(null),t=I.useRef(Date.now()),r=I.useRef(!1);I.useEffect(()=>{if(!(s!=null&&s.id)||r.current)return;(async()=>{r.current=!0,t.current=Date.now();const c=navigator.userAgent,h=hD(c);try{const u=await Z5({userId:s.id,loginAt:new Date().toISOString(),browser:h,userAgent:c,isActive:!0,pageViews:[]});e.current=u}catch(u){console.error("Failed to track user activity:",u)}})();const i=()=>{if(e.current){const c=Date.now(),h=Math.floor((c-t.current)/1e3);rd(e.current,new Date().toISOString(),h).catch(u=>console.error("Failed to update activity on unload:",u))}},o=setInterval(async()=>{if(e.current&&!document.hidden){const c=Date.now(),h=Math.floor((c-t.current)/1e3);try{await Yd(e.current,{sessionDuration:h,isActive:!0})}catch(u){console.error("Failed to update activity duration:",u)}}},3e4),l=async()=>{if(document.hidden&&e.current){const c=Date.now(),h=Math.floor((c-t.current)/1e3);try{await rd(e.current,new Date().toISOString(),h)}catch(u){console.error("Failed to update activity on visibility change:",u)}}else if(!document.hidden&&e.current)try{await Yd(e.current,{isActive:!0})}catch(c){console.error("Failed to reactivate activity:",c)}};return window.addEventListener("beforeunload",i),document.addEventListener("visibilitychange",l),()=>{if(clearInterval(o),window.removeEventListener("beforeunload",i),document.removeEventListener("visibilitychange",l),e.current){const c=Date.now(),h=Math.floor((c-t.current)/1e3);rd(e.current,new Date().toISOString(),h).catch(u=>console.error("Failed to update activity on unmount:",u))}}},[s==null?void 0:s.id])},mD=({children:s})=>{const{theme:e,toggleTheme:t}=lt(),{isAdmin:r,activateAdmin:a,deactivateAdmin:i}=Ct(),{user:o,logout:l}=_t(),c=Tp(),[h,u]=I.useState(!1),[m,g]=I.useState(!1),[p,j]=I.useState(()=>localStorage.getItem("sidebarCollapsed")==="true"),[_,y]=I.useState([]),[M,D]=I.useState(new Set);uD(),I.useEffect(()=>{(async()=>{if(!o||r){D(new Set(["slots","earnings","tasks","rating","profile","admin"]));return}const S=["slots","earnings","tasks","rating","profile"],E=new Set;for(const k of S)try{(await yu(o.id,k)).hasAccess&&E.add(k)}catch(w){console.error(`Error checking access to ${k}:`,w),E.add(k)}D(E)})()},[o,r]);const R=[{path:"/call",label:"AVF HUB",icon:Hp,feature:"slots"},{path:"/management",label:"AVF Schedule",icon:Fr,feature:"slots"},{path:"/tasks",label:"AVF Tasks",icon:Sr,feature:"tasks"},{path:"/earnings",label:"AVF Profit",icon:va,feature:"earnings"},{path:"/rating",label:"AVF Score",icon:Ut,feature:"rating"},{path:"/about",label:"AVF NFO",icon:$s,feature:"profile"},...r?[{path:"/approvals",label:"AVF Check",icon:Qi,feature:"admin"}]:[]].filter(v=>!v.feature||M.has(v.feature)||r),P=[{path:"/meme-evaluation",label:"Оценка мема",icon:Ut},{path:"/ai-ao-alerts",label:"ИИ - АО Alerts",icon:Xt}],C=P.some(v=>c.pathname===v.path);I.useEffect(()=>{u(!1)},[c.pathname]),I.useEffect(()=>{const v=async()=>{try{if(r||!o){y([]);return}const E=[],k=Date.now()-6*60*60*1e3,w=Date.now(),Q=60*60*1e3,ae=`viewedNotifications_${o.id}`,V=JSON.parse(localStorage.getItem(ae)||"[]"),he=(await vb()).filter(F=>{if(F.authorId!==o.id&&F.targetUserId!==o.id)return!1;const re=Date.parse(F.updatedAt||F.createdAt);return!(Number.isNaN(re)||re<k||V.includes(`approval_${F.id}`))}).map(F=>{const re=Date.parse(F.updatedAt||F.createdAt||new Date().toISOString());return{id:`approval_${F.id}`,status:F.status,text:`${F.entity==="slot"?"Слот":F.entity==="status"?"Статус":F.entity==="login"?"Ник":F.entity==="earning"?"Заработок":F.entity==="referral"?"Реферал":"Изменение"} • ${F.status==="approved"?"Подтверждено":F.status==="rejected"?"Отклонено":"На согласовании"}${F.adminComment?`: ${F.adminComment}`:""}`,time:oe(F.updatedAt||F.createdAt||new Date().toISOString(),"dd.MM HH:mm"),timestamp:Number.isNaN(re)?w:re}});E.push(...he);const te=(await bu({assignedTo:o.id})).filter(F=>{const re=Date.parse(F.createdAt),de=!Number.isNaN(re)&&re>=k&&!V.includes(`task_new_${F.id}`);if(!F.dueDate||!F.dueTime)return de;const O=new Date(`${F.dueDate}T${F.dueTime}`).getTime();if(Number.isNaN(O))return de;const J=O-w,Y=J>0&&J<=Q&&!V.includes(`task_due_${F.id}`),Z=J<0&&J>=-k&&!V.includes(`task_overdue_${F.id}`);return de||Y||Z}).map(F=>{const re=Date.parse(F.createdAt);if(!Number.isNaN(re)&&re>=k&&!V.includes(`task_new_${F.id}`)){const Y=Date.parse(F.createdAt);return{id:`task_new_${F.id}`,status:"new",text:`Новая задача: ${F.title}`,time:oe(F.createdAt,"dd.MM HH:mm"),timestamp:Number.isNaN(Y)?w:Y}}if(!F.dueDate||!F.dueTime)return null;const $=new Date(`${F.dueDate}T${F.dueTime}`),O=$.getTime();if(Number.isNaN(O))return null;const J=O-w;return J>0&&J<=Q&&!V.includes(`task_due_${F.id}`)?{id:`task_due_${F.id}`,status:"due",text:`Дедлайн через час: ${F.title}`,time:oe($.toISOString(),"dd.MM HH:mm"),timestamp:O}:J<0&&J>=-k&&!V.includes(`task_overdue_${F.id}`)?{id:`task_overdue_${F.id}`,status:"overdue",text:`Просрочен дедлайн: ${F.title}`,time:oe($.toISOString(),"dd.MM HH:mm"),timestamp:O}:null}).filter(F=>F!==null);E.push(...te);const W=(await Is(o.id)).filter(F=>{if(V.includes(`slot_ended_${F.id}`)||!F.slots||F.slots.length===0)return!1;const re=F.slots[F.slots.length-1];if(!re)return!1;let de;if(re.endDate){de=new Date(re.endDate);const[O,J]=re.end.split(":").map(Number);de.setHours(O,J,0,0)}else{de=new Date(F.date);const[O,J]=re.end.split(":").map(Number);de.setHours(O,J,0,0)}const $=de.getTime();return Number.isNaN($)?!1:$<w&&$>=w-k}).map(F=>{const re=F.slots[F.slots.length-1];let de;if(re.endDate){de=new Date(re.endDate);const[$,O]=re.end.split(":").map(Number);de.setHours($,O,0,0)}else{de=new Date(F.date);const[$,O]=re.end.split(":").map(Number);de.setHours($,O,0,0)}return{id:`slot_ended_${F.id}`,status:"ended",text:`Слот завершился: ${oe(F.date,"dd.MM.yyyy")}`,time:oe(de.toISOString(),"dd.MM HH:mm"),timestamp:de.getTime()}});E.push(...W),E.sort((F,re)=>(re.timestamp||0)-(F.timestamp||0)),y(E.map(({timestamp:F,...re})=>re))}catch(E){console.error("Failed to load notifications",E)}};v();const S=setInterval(v,2*60*1e3);return()=>clearInterval(S)},[o,r]);const N=()=>{const v=!p;j(v),localStorage.setItem("sidebarCollapsed",String(v))},b=v=>v.split(" ").map(S=>S[0]).join("").toUpperCase().substring(0,2);return n.jsxs("div",{className:`min-h-screen ${e==="dark"?"dark bg-[#0b0f17]":"bg-[#f8fafc]"}`,children:[n.jsxs("div",{className:"absolute inset-0 pointer-events-none -z-10 overflow-hidden",children:[n.jsx("div",{className:"absolute -top-24 -left-12 w-80 h-80 bg-gradient-to-br from-[#4E6E49]/25 via-transparent to-transparent blur-3xl"}),n.jsx("div",{className:"absolute top-8 right-0 w-[520px] h-[520px] bg-gradient-to-bl from-blue-500/12 via-purple-500/10 to-transparent blur-3xl"}),n.jsx("div",{className:"absolute bottom-[-120px] left-12 w-96 h-96 bg-gradient-to-tr from-amber-400/10 to-[#4E6E49]/12 blur-3xl"}),n.jsx("div",{className:"floating-grid"})]}),n.jsxs("div",{className:"flex flex-col lg:flex-row min-h-screen",children:[n.jsxs("aside",{className:`hidden xl:flex ${p?"w-20":"w-72"} h-screen fixed left-0 top-0 flex-col glass-panel border-r border-white/40 dark:border-white/10 z-50 transition-all duration-500 ease-[cubic-bezier(0.4,0,0.2,1)]`,children:[n.jsx("div",{className:"accent-dots"}),n.jsx("button",{onClick:N,className:`absolute top-6 -right-0 transition-all duration-500 z-50 ${p?"right-1/2 translate-x-1/2":"right-4"} p-2 rounded-xl bg-[#4E6E49]/10 hover:bg-[#4E6E49]/20 text-[#4E6E49] dark:text-gray-400 dark:hover:text-white border border-[#4E6E49]/20 dark:border-white/10 group`,children:p?n.jsx(nw,{className:"w-5 h-5 transition-transform group-hover:scale-110"}):n.jsx(rw,{className:"w-5 h-5 transition-transform group-hover:scale-110"})}),n.jsx("div",{className:`p-6 pb-2 transition-all duration-500 origin-left overflow-hidden ${p?"opacity-0 scale-90 w-0 px-0 translate-x-[-100%]":"opacity-100 scale-100"}`,children:n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx("div",{className:"w-10 h-10 flex items-center justify-center",children:n.jsx("img",{src:wd,alt:"ApeVault",className:"w-9 h-9 object-contain filter drop-shadow-[0_0_8px_rgba(78,110,73,0.3)]"})}),n.jsxs("div",{className:"flex flex-col whitespace-nowrap",children:[n.jsx("span",{className:"text-sm font-black tracking-widest text-[#4E6E49] dark:text-white uppercase transition-opacity duration-300",children:"ApeVault"}),n.jsx("span",{className:"text-[10px] font-bold text-gray-400 -mt-1 uppercase tracking-tighter transition-opacity duration-300",children:"Frontier"})]})]})}),n.jsxs("div",{className:`relative z-10 px-6 pb-4 flex items-center gap-2 transition-all duration-500 ${p?"flex-col px-4 items-center":""}`,children:[n.jsx("button",{onClick:t,className:"flex-1 flex items-center justify-center p-2 rounded-xl border border-gray-200 dark:border-white/10 hover:bg-gray-100 dark:hover:bg-white/5 transition-colors w-full",children:e==="dark"?n.jsx(yd,{className:"w-4 h-4 text-amber-300"}):n.jsx(bd,{className:"w-4 h-4 text-gray-700"})}),!p&&n.jsxs("button",{onClick:()=>g(!m),className:`flex-1 flex items-center justify-center relative p-2 rounded-xl border border-gray-200 dark:border-white/10 hover:bg-gray-100 dark:hover:bg-white/5 transition-colors w-full ${m?"bg-amber-500/10":""}`,children:[n.jsx(Rv,{className:"w-4 h-4"}),_.length>0&&n.jsx("span",{className:"absolute top-2 right-[35%] w-2 h-2 bg-red-500 rounded-full"})]})]}),m&&n.jsx("div",{className:"mx-4 mb-4 p-3 glass-panel rounded-xl border border-white/20 shadow-xl max-h-60 overflow-y-auto space-y-2 relative z-20",children:_.length===0?n.jsx("p",{className:"text-[10px] text-gray-500",children:"Нет уведомлений"}):_.map(v=>n.jsxs("div",{className:"text-[10px] p-2 rounded-lg bg-black/5 dark:bg-white/5",children:[n.jsx("p",{className:"font-bold",children:v.text}),n.jsx("p",{className:"opacity-60",children:v.time})]},v.id))}),n.jsx("div",{className:`h-px w-full bg-gradient-to-r from-transparent via-gray-200/50 dark:via-white/10 to-transparent my-2 transition-opacity duration-500 ${p?"opacity-0":"opacity-100"}`}),n.jsxs("nav",{className:"relative z-10 flex-1 px-4 py-4 space-y-1 overflow-y-auto no-scrollbar",children:[n.jsxs("div",{className:"space-y-1 relative group/tools",children:[n.jsxs("button",{onClick:()=>!p&&u(!h),className:`w-full flex items-center gap-3 px-4 py-3 rounded-xl transition-all duration-300 ${C?"bg-[#4E6E49]/15 text-[#4E6E49]":"text-gray-500 hover:bg-gray-100/50 dark:hover:bg-white/5"} ${p?"justify-center px-0":""}`,children:[n.jsx(Yr,{className:`w-4 h-4 transition-transform duration-500 ${p?"group-hover/tools:rotate-90":""}`}),!p&&n.jsxs(n.Fragment,{children:[n.jsx("span",{className:"font-bold flex-1 text-left",children:"Tools"}),n.jsx(an,{className:`w-4 h-4 transition-transform ${h?"rotate-180":""}`})]})]}),p&&n.jsx("div",{className:"absolute left-full top-0 invisible group-hover/tools:visible opacity-0 group-hover/tools:opacity-100 transition-all duration-300 translate-x-3 group-hover/tools:translate-x-1 z-[100]",children:n.jsxs("div",{className:"ml-2 glass-panel border border-white/40 dark:border-white/10 rounded-2xl p-2 min-w-[200px] shadow-2xl backdrop-blur-2xl",children:[n.jsx("div",{className:"px-3 py-2 mb-1 border-b border-white/10",children:n.jsx("p",{className:"text-[10px] font-black uppercase tracking-widest text-[#4E6E49]",children:"Инструменты"})}),P.map(v=>n.jsxs(zs,{to:v.path,className:`flex items-center gap-3 px-3 py-2.5 rounded-xl text-sm font-bold transition-all ${c.pathname===v.path?"bg-[#4E6E49] text-white":"text-gray-500 hover:bg-[#4E6E49]/10 hover:text-[#4E6E49]"}`,children:[n.jsx(v.icon,{className:"w-3.5 h-3.5"}),n.jsx("span",{children:v.label})]},v.path))]})}),h&&!p&&n.jsx("div",{className:"pl-11 pr-4 py-1 space-y-1 animate-in fade-in slide-in-from-top-1 duration-300",children:P.map(v=>n.jsx(zs,{to:v.path,className:`block py-2 text-sm font-medium transition-colors ${c.pathname===v.path?"text-[#4E6E49]":"text-gray-400 hover:text-[#4E6E49]"}`,children:v.label},v.path))})]}),R.map(v=>n.jsxs(zs,{to:v.path,className:`flex items-center gap-3 px-4 py-3 rounded-xl transition-all duration-300 ${c.pathname===v.path?"bg-[#4E6E49] text-white shadow-lg shadow-[#4E6E49]/30":"text-gray-500 hover:bg-gray-100/50 dark:hover:bg-white/5 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white"} ${p?"justify-center px-0":""}`,children:[n.jsx(v.icon,{className:"w-4 h-4"}),!p&&n.jsx("span",{className:"font-bold text-sm tracking-tight",children:v.label})]},v.path))]}),n.jsxs("div",{className:`relative z-10 m-4 space-y-2 transition-all duration-500 ${p?"m-2 space-y-4":""}`,children:[n.jsxs(zs,{to:"/profile",className:`p-4 rounded-2xl flex items-center gap-3 transition-all group ${c.pathname==="/profile"?"bg-[#4E6E49]/10 border border-[#4E6E49]/30":"border border-gray-200/50 dark:border-white/5 hover:bg-gray-100/50 dark:hover:bg-white/5"} ${p?"p-0 h-12 w-12 items-center justify-center mx-auto border-0":""}`,children:[n.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center font-bold text-sm shadow-inner shrink-0 ${e==="dark"?"bg-emerald-500/20 text-[#4E6E49]":"bg-[#4E6E49]/10 text-[#4E6E49]"}`,children:o!=null&&o.avatar?n.jsx("img",{src:o.avatar,className:"w-full h-full rounded-full object-cover"}):b((o==null?void 0:o.name)||"User")}),!p&&n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:"flex-1 min-w-0",children:[n.jsx("p",{className:"text-sm font-bold truncate dark:text-white",children:(o==null?void 0:o.name)||"Administrator"}),n.jsx("p",{className:"text-[10px] text-gray-500 font-medium truncate",children:(o==null?void 0:o.login)||"admin@apevault.io"})]}),n.jsx(Qo,{className:"w-4 h-4 text-gray-400 group-hover:text-[#4E6E49] transition-colors"})]})]}),n.jsxs("div",{className:`flex gap-2 transition-all duration-500 ${p?"flex-col gap-4 px-2":""}`,children:[n.jsxs("button",{onClick:()=>{l(),i(),window.location.href="/login"},className:`flex-1 flex items-center justify-center gap-2 py-2.5 rounded-xl border border-red-500/20 bg-red-500/5 text-red-500 hover:bg-red-500/10 transition-colors text-xs font-bold ${p?"w-full px-0 border-0":""}`,children:[n.jsx(Up,{className:"w-3.5 h-3.5"}),!p&&n.jsx("span",{children:"Выйти"})]}),(o==null?void 0:o.name)==="Артём"&&!r&&n.jsxs("button",{onClick:()=>a(dh),className:`flex-1 flex items-center justify-center gap-2 py-2.5 rounded-xl border border-[#4E6E49]/20 bg-[#4E6E49]/5 text-[#4E6E49] hover:bg-[#4E6E49]/10 transition-colors text-xs font-bold ${p?"border-0":""}`,children:[n.jsx(Ot,{className:"w-3.5 h-3.5"}),!p&&n.jsx("span",{children:"Админ"})]}),r&&n.jsxs("button",{onClick:i,className:`flex-1 flex items-center justify-center gap-2 py-2.5 rounded-xl border border-amber-500/20 bg-amber-500/5 text-amber-500 hover:bg-amber-500/10 transition-colors text-xs font-bold ${p?"border-0":""}`,children:[n.jsx(yw,{className:"w-3.5 h-3.5"}),!p&&n.jsx("span",{children:"Стоп"})]})]})]})]}),n.jsx("div",{className:`flex-1 ${p?"xl:pl-20":"xl:pl-72"} min-h-screen transition-all duration-500 ease-[cubic-bezier(0.4,0,0.2,1)]`,children:n.jsx("main",{className:"page-shell",children:s})}),n.jsxs("nav",{className:"xl:hidden fixed bottom-4 left-0 right-0 px-3 z-50",children:[n.jsx("div",{className:"max-w-5xl mx-auto",children:n.jsx("div",{className:"glass-panel rounded-2xl shadow-2xl border border-white/60 dark:border-white/10 overflow-hidden",children:n.jsxs("div",{className:"flex divide-x divide-white/40 dark:divide-white/5 w-full overflow-x-auto no-scrollbar",children:[n.jsxs("button",{onClick:()=>u(!h),className:`flex-none w-20 flex flex-col items-center justify-center gap-1 py-3 ${C?"text-[#4E6E49]":"text-gray-400"}`,children:[n.jsx(Yr,{className:"w-5 h-5"}),n.jsx("span",{className:"text-[10px] font-bold",children:"Tools"})]}),R.map(v=>n.jsxs(zs,{to:v.path,className:`flex-none w-20 flex flex-col items-center justify-center gap-1 py-3 ${c.pathname===v.path?"text-[#4E6E49]":"text-gray-400"}`,children:[n.jsx(v.icon,{className:"w-5 h-5"}),n.jsx("span",{className:"text-[10px] font-bold",children:v.label.replace("AVF ","")})]},v.path)),n.jsxs(zs,{to:"/profile",className:`flex-none min-w-[120px] flex items-center gap-2 px-3 py-2 ${c.pathname==="/profile"?"text-[#4E6E49]":"text-gray-400"}`,children:[n.jsx("div",{className:"w-8 h-8 rounded-full bg-[#4E6E49]/10 flex items-center justify-center text-[10px] font-bold flex-shrink-0",children:b((o==null?void 0:o.name)||"AU")}),n.jsxs("div",{className:"min-w-0 flex flex-col items-start px-1",children:[n.jsx("span",{className:"text-[10px] font-bold truncate w-full text-left",children:(o==null?void 0:o.name)||"User"}),n.jsx("span",{className:"text-[8px] opacity-60 truncate w-full text-left",children:(o==null?void 0:o.login)||"id"})]})]})]})})}),h&&n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"fixed inset-0 bg-black/40 backdrop-blur-sm z-[-1]",onClick:()=>u(!1)}),n.jsx("div",{className:"absolute bottom-20 left-4 right-4 glass-panel rounded-2xl border border-white/40 overflow-hidden animate-fade-in",children:P.map(v=>n.jsxs(zs,{to:v.path,onClick:()=>u(!1),className:"flex items-center gap-3 p-4 border-b border-white/10 last:border-0",children:[n.jsx(v.icon,{className:"w-4 h-4 text-[#4E6E49]"}),n.jsx("span",{className:"font-bold text-sm flex-1",children:v.label}),n.jsx(Js,{className:"w-4 h-4 opacity-40"})]},v.path))})]})]})]})]})},gD=()=>n.jsx(mD,{children:n.jsx(Hy,{})});function fD(){const{isAuthenticated:s}=_t(),{isAdmin:e}=Ct(),{theme:t}=lt();return I.useEffect(()=>{document.body.classList.toggle("dark",t==="dark")},[t]),I.useEffect(()=>{R5().catch(r=>console.error("Cleanup failed",r))},[]),n.jsxs(Wy,{children:[n.jsx(dD,{}),n.jsxs(qy,{children:[n.jsx(us,{path:"/login",element:!s&&!e?n.jsx(ww,{}):n.jsx(dl,{to:"/management",replace:!0})}),n.jsxs(us,{element:n.jsx(gD,{}),children:[n.jsx(us,{path:"/call",element:n.jsx(Ms,{children:n.jsx(pS,{})})}),n.jsx(us,{path:"/management",element:n.jsx(Ms,{children:n.jsx(SS,{})})}),n.jsx(us,{path:"/earnings",element:n.jsx(Ms,{children:n.jsx(CS,{})})}),n.jsx(us,{path:"/rating",element:n.jsx(Ms,{children:n.jsx(UC,{})})}),n.jsx(us,{path:"/tasks",element:n.jsx(Ms,{children:n.jsx(QC,{})})}),n.jsx(us,{path:"/about",element:n.jsx(Ms,{children:n.jsx(eD,{})})}),n.jsx(us,{path:"/rules",element:n.jsx(Ms,{children:n.jsx(tD,{})})}),n.jsx(us,{path:"/approvals",element:n.jsx(Ms,{children:n.jsx(oD,{})})}),n.jsx(us,{path:"/admin",element:n.jsx(Ms,{children:n.jsx(XC,{})})}),n.jsx(us,{path:"/profile",element:n.jsx(Ms,{children:n.jsx(JC,{})})}),n.jsx(us,{path:"/meme-evaluation",element:n.jsx(Ms,{children:n.jsx(lD,{})})}),n.jsx(us,{path:"/ai-ao-alerts",element:n.jsx(Ms,{children:n.jsx(cD,{})})})]}),n.jsx(us,{path:"/",element:n.jsx(dl,{to:s||e?"/management":"/login",replace:!0})})]})]})}fd.createRoot(document.getElementById("root")).render(n.jsx(Ep.StrictMode,{children:n.jsx(fD,{})}));
